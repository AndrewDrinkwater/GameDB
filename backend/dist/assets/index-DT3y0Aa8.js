(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function r(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(l){if(l.ep)return;l.ep=!0;const c=r(l);fetch(l.href,c)}})();function Ri(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Eh={exports:{}},Co={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kx;function SC(){if(Kx)return Co;Kx=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function r(i,l,c){var f=null;if(c!==void 0&&(f=""+c),l.key!==void 0&&(f=""+l.key),"key"in l){c={};for(var m in l)m!=="key"&&(c[m]=l[m])}else c=l;return l=c.ref,{$$typeof:e,type:i,key:f,ref:l!==void 0?l:null,props:c}}return Co.Fragment=t,Co.jsx=r,Co.jsxs=r,Co}var Wx;function wC(){return Wx||(Wx=1,Eh.exports=SC()),Eh.exports}var a=wC(),jh={exports:{}},tn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zx;function NC(){if(Zx)return tn;Zx=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),f=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),v=Symbol.iterator;function S(M){return M===null||typeof M!="object"?null:(M=v&&M[v]||M["@@iterator"],typeof M=="function"?M:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N=Object.assign,E={};function C(M,q,Y){this.props=M,this.context=q,this.refs=E,this.updater=Y||w}C.prototype.isReactComponent={},C.prototype.setState=function(M,q){if(typeof M!="object"&&typeof M!="function"&&M!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,M,q,"setState")},C.prototype.forceUpdate=function(M){this.updater.enqueueForceUpdate(this,M,"forceUpdate")};function A(){}A.prototype=C.prototype;function O(M,q,Y){this.props=M,this.context=q,this.refs=E,this.updater=Y||w}var _=O.prototype=new A;_.constructor=O,N(_,C.prototype),_.isPureReactComponent=!0;var R=Array.isArray;function D(){}var j={H:null,A:null,T:null,S:null},z=Object.prototype.hasOwnProperty;function P(M,q,Y){var J=Y.ref;return{$$typeof:e,type:M,key:q,ref:J!==void 0?J:null,props:Y}}function X(M,q){return P(M.type,q,M.props)}function H(M){return typeof M=="object"&&M!==null&&M.$$typeof===e}function G(M){var q={"=":"=0",":":"=2"};return"$"+M.replace(/[=:]/g,function(Y){return q[Y]})}var V=/\/+/g;function k(M,q){return typeof M=="object"&&M!==null&&M.key!=null?G(""+M.key):q.toString(36)}function F(M){switch(M.status){case"fulfilled":return M.value;case"rejected":throw M.reason;default:switch(typeof M.status=="string"?M.then(D,D):(M.status="pending",M.then(function(q){M.status==="pending"&&(M.status="fulfilled",M.value=q)},function(q){M.status==="pending"&&(M.status="rejected",M.reason=q)})),M.status){case"fulfilled":return M.value;case"rejected":throw M.reason}}throw M}function I(M,q,Y,J,ie){var Z=typeof M;(Z==="undefined"||Z==="boolean")&&(M=null);var fe=!1;if(M===null)fe=!0;else switch(Z){case"bigint":case"string":case"number":fe=!0;break;case"object":switch(M.$$typeof){case e:case t:fe=!0;break;case y:return fe=M._init,I(fe(M._payload),q,Y,J,ie)}}if(fe)return ie=ie(M),fe=J===""?"."+k(M,0):J,R(ie)?(Y="",fe!=null&&(Y=fe.replace(V,"$&/")+"/"),I(ie,q,Y,"",function(ne){return ne})):ie!=null&&(H(ie)&&(ie=X(ie,Y+(ie.key==null||M&&M.key===ie.key?"":(""+ie.key).replace(V,"$&/")+"/")+fe)),q.push(ie)),1;fe=0;var Q=J===""?".":J+":";if(R(M))for(var se=0;se<M.length;se++)J=M[se],Z=Q+k(J,se),fe+=I(J,q,Y,Z,ie);else if(se=S(M),typeof se=="function")for(M=se.call(M),se=0;!(J=M.next()).done;)J=J.value,Z=Q+k(J,se++),fe+=I(J,q,Y,Z,ie);else if(Z==="object"){if(typeof M.then=="function")return I(F(M),q,Y,J,ie);throw q=String(M),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return fe}function L(M,q,Y){if(M==null)return M;var J=[],ie=0;return I(M,J,"","",function(Z){return q.call(Y,Z,ie++)}),J}function $(M){if(M._status===-1){var q=M._result;q=q(),q.then(function(Y){(M._status===0||M._status===-1)&&(M._status=1,M._result=Y)},function(Y){(M._status===0||M._status===-1)&&(M._status=2,M._result=Y)}),M._status===-1&&(M._status=0,M._result=q)}if(M._status===1)return M._result.default;throw M._result}var T=typeof reportError=="function"?reportError:function(M){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof M=="object"&&M!==null&&typeof M.message=="string"?String(M.message):String(M),error:M});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",M);return}console.error(M)},U={map:L,forEach:function(M,q,Y){L(M,function(){q.apply(this,arguments)},Y)},count:function(M){var q=0;return L(M,function(){q++}),q},toArray:function(M){return L(M,function(q){return q})||[]},only:function(M){if(!H(M))throw Error("React.Children.only expected to receive a single React element child.");return M}};return tn.Activity=g,tn.Children=U,tn.Component=C,tn.Fragment=r,tn.Profiler=l,tn.PureComponent=O,tn.StrictMode=i,tn.Suspense=h,tn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=j,tn.__COMPILER_RUNTIME={__proto__:null,c:function(M){return j.H.useMemoCache(M)}},tn.cache=function(M){return function(){return M.apply(null,arguments)}},tn.cacheSignal=function(){return null},tn.cloneElement=function(M,q,Y){if(M==null)throw Error("The argument must be a React element, but you passed "+M+".");var J=N({},M.props),ie=M.key;if(q!=null)for(Z in q.key!==void 0&&(ie=""+q.key),q)!z.call(q,Z)||Z==="key"||Z==="__self"||Z==="__source"||Z==="ref"&&q.ref===void 0||(J[Z]=q[Z]);var Z=arguments.length-2;if(Z===1)J.children=Y;else if(1<Z){for(var fe=Array(Z),Q=0;Q<Z;Q++)fe[Q]=arguments[Q+2];J.children=fe}return P(M.type,ie,J)},tn.createContext=function(M){return M={$$typeof:f,_currentValue:M,_currentValue2:M,_threadCount:0,Provider:null,Consumer:null},M.Provider=M,M.Consumer={$$typeof:c,_context:M},M},tn.createElement=function(M,q,Y){var J,ie={},Z=null;if(q!=null)for(J in q.key!==void 0&&(Z=""+q.key),q)z.call(q,J)&&J!=="key"&&J!=="__self"&&J!=="__source"&&(ie[J]=q[J]);var fe=arguments.length-2;if(fe===1)ie.children=Y;else if(1<fe){for(var Q=Array(fe),se=0;se<fe;se++)Q[se]=arguments[se+2];ie.children=Q}if(M&&M.defaultProps)for(J in fe=M.defaultProps,fe)ie[J]===void 0&&(ie[J]=fe[J]);return P(M,Z,ie)},tn.createRef=function(){return{current:null}},tn.forwardRef=function(M){return{$$typeof:m,render:M}},tn.isValidElement=H,tn.lazy=function(M){return{$$typeof:y,_payload:{_status:-1,_result:M},_init:$}},tn.memo=function(M,q){return{$$typeof:p,type:M,compare:q===void 0?null:q}},tn.startTransition=function(M){var q=j.T,Y={};j.T=Y;try{var J=M(),ie=j.S;ie!==null&&ie(Y,J),typeof J=="object"&&J!==null&&typeof J.then=="function"&&J.then(D,T)}catch(Z){T(Z)}finally{q!==null&&Y.types!==null&&(q.types=Y.types),j.T=q}},tn.unstable_useCacheRefresh=function(){return j.H.useCacheRefresh()},tn.use=function(M){return j.H.use(M)},tn.useActionState=function(M,q,Y){return j.H.useActionState(M,q,Y)},tn.useCallback=function(M,q){return j.H.useCallback(M,q)},tn.useContext=function(M){return j.H.useContext(M)},tn.useDebugValue=function(){},tn.useDeferredValue=function(M,q){return j.H.useDeferredValue(M,q)},tn.useEffect=function(M,q){return j.H.useEffect(M,q)},tn.useEffectEvent=function(M){return j.H.useEffectEvent(M)},tn.useId=function(){return j.H.useId()},tn.useImperativeHandle=function(M,q,Y){return j.H.useImperativeHandle(M,q,Y)},tn.useInsertionEffect=function(M,q){return j.H.useInsertionEffect(M,q)},tn.useLayoutEffect=function(M,q){return j.H.useLayoutEffect(M,q)},tn.useMemo=function(M,q){return j.H.useMemo(M,q)},tn.useOptimistic=function(M,q){return j.H.useOptimistic(M,q)},tn.useReducer=function(M,q,Y){return j.H.useReducer(M,q,Y)},tn.useRef=function(M){return j.H.useRef(M)},tn.useState=function(M){return j.H.useState(M)},tn.useSyncExternalStore=function(M,q,Y){return j.H.useSyncExternalStore(M,q,Y)},tn.useTransition=function(){return j.H.useTransition()},tn.version="19.2.0",tn}var Qx;function Sc(){return Qx||(Qx=1,jh.exports=NC()),jh.exports}var u=Sc();const De=Ri(u);var _h={exports:{}},Ao={},Ch={exports:{}},Ah={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jx;function EC(){return Jx||(Jx=1,(function(e){function t(I,L){var $=I.length;I.push(L);e:for(;0<$;){var T=$-1>>>1,U=I[T];if(0<l(U,L))I[T]=L,I[$]=U,$=T;else break e}}function r(I){return I.length===0?null:I[0]}function i(I){if(I.length===0)return null;var L=I[0],$=I.pop();if($!==L){I[0]=$;e:for(var T=0,U=I.length,M=U>>>1;T<M;){var q=2*(T+1)-1,Y=I[q],J=q+1,ie=I[J];if(0>l(Y,$))J<U&&0>l(ie,Y)?(I[T]=ie,I[J]=$,T=J):(I[T]=Y,I[q]=$,T=q);else if(J<U&&0>l(ie,$))I[T]=ie,I[J]=$,T=J;else break e}}return L}function l(I,L){var $=I.sortIndex-L.sortIndex;return $!==0?$:I.id-L.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;e.unstable_now=function(){return c.now()}}else{var f=Date,m=f.now();e.unstable_now=function(){return f.now()-m}}var h=[],p=[],y=1,g=null,v=3,S=!1,w=!1,N=!1,E=!1,C=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;function _(I){for(var L=r(p);L!==null;){if(L.callback===null)i(p);else if(L.startTime<=I)i(p),L.sortIndex=L.expirationTime,t(h,L);else break;L=r(p)}}function R(I){if(N=!1,_(I),!w)if(r(h)!==null)w=!0,D||(D=!0,G());else{var L=r(p);L!==null&&F(R,L.startTime-I)}}var D=!1,j=-1,z=5,P=-1;function X(){return E?!0:!(e.unstable_now()-P<z)}function H(){if(E=!1,D){var I=e.unstable_now();P=I;var L=!0;try{e:{w=!1,N&&(N=!1,A(j),j=-1),S=!0;var $=v;try{t:{for(_(I),g=r(h);g!==null&&!(g.expirationTime>I&&X());){var T=g.callback;if(typeof T=="function"){g.callback=null,v=g.priorityLevel;var U=T(g.expirationTime<=I);if(I=e.unstable_now(),typeof U=="function"){g.callback=U,_(I),L=!0;break t}g===r(h)&&i(h),_(I)}else i(h);g=r(h)}if(g!==null)L=!0;else{var M=r(p);M!==null&&F(R,M.startTime-I),L=!1}}break e}finally{g=null,v=$,S=!1}L=void 0}}finally{L?G():D=!1}}}var G;if(typeof O=="function")G=function(){O(H)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,k=V.port2;V.port1.onmessage=H,G=function(){k.postMessage(null)}}else G=function(){C(H,0)};function F(I,L){j=C(function(){I(e.unstable_now())},L)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(I){I.callback=null},e.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):z=0<I?Math.floor(1e3/I):5},e.unstable_getCurrentPriorityLevel=function(){return v},e.unstable_next=function(I){switch(v){case 1:case 2:case 3:var L=3;break;default:L=v}var $=v;v=L;try{return I()}finally{v=$}},e.unstable_requestPaint=function(){E=!0},e.unstable_runWithPriority=function(I,L){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var $=v;v=I;try{return L()}finally{v=$}},e.unstable_scheduleCallback=function(I,L,$){var T=e.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?T+$:T):$=T,I){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=$+U,I={id:y++,callback:L,priorityLevel:I,startTime:$,expirationTime:U,sortIndex:-1},$>T?(I.sortIndex=$,t(p,I),r(h)===null&&I===r(p)&&(N?(A(j),j=-1):N=!0,F(R,$-T))):(I.sortIndex=U,t(h,I),w||S||(w=!0,D||(D=!0,G()))),I},e.unstable_shouldYield=X,e.unstable_wrapCallback=function(I){var L=v;return function(){var $=v;v=L;try{return I.apply(this,arguments)}finally{v=$}}}})(Ah)),Ah}var e0;function jC(){return e0||(e0=1,Ch.exports=EC()),Ch.exports}var Th={exports:{}},ya={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t0;function _C(){if(t0)return ya;t0=1;var e=Sc();function t(h){var p="https://react.dev/errors/"+h;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)p+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+h+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var i={d:{f:r,r:function(){throw Error(t(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},l=Symbol.for("react.portal");function c(h,p,y){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:g==null?null:""+g,children:h,containerInfo:p,implementation:y}}var f=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function m(h,p){if(h==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return ya.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,ya.createPortal=function(h,p){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(t(299));return c(h,p,null,y)},ya.flushSync=function(h){var p=f.T,y=i.p;try{if(f.T=null,i.p=2,h)return h()}finally{f.T=p,i.p=y,i.d.f()}},ya.preconnect=function(h,p){typeof h=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,i.d.C(h,p))},ya.prefetchDNS=function(h){typeof h=="string"&&i.d.D(h)},ya.preinit=function(h,p){if(typeof h=="string"&&p&&typeof p.as=="string"){var y=p.as,g=m(y,p.crossOrigin),v=typeof p.integrity=="string"?p.integrity:void 0,S=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;y==="style"?i.d.S(h,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:g,integrity:v,fetchPriority:S}):y==="script"&&i.d.X(h,{crossOrigin:g,integrity:v,fetchPriority:S,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},ya.preinitModule=function(h,p){if(typeof h=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var y=m(p.as,p.crossOrigin);i.d.M(h,{crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&i.d.M(h)},ya.preload=function(h,p){if(typeof h=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var y=p.as,g=m(y,p.crossOrigin);i.d.L(h,y,{crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},ya.preloadModule=function(h,p){if(typeof h=="string")if(p){var y=m(p.as,p.crossOrigin);i.d.m(h,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else i.d.m(h)},ya.requestFormReset=function(h){i.d.r(h)},ya.unstable_batchedUpdates=function(h,p){return h(p)},ya.useFormState=function(h,p,y){return f.H.useFormState(h,p,y)},ya.useFormStatus=function(){return f.H.useHostTransitionStatus()},ya.version="19.2.0",ya}var n0;function Fw(){if(n0)return Th.exports;n0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Th.exports=_C(),Th.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a0;function CC(){if(a0)return Ao;a0=1;var e=jC(),t=Sc(),r=Fw();function i(n){var s="https://react.dev/errors/"+n;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)s+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+n+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function c(n){var s=n,o=n;if(n.alternate)for(;s.return;)s=s.return;else{n=s;do s=n,(s.flags&4098)!==0&&(o=s.return),n=s.return;while(n)}return s.tag===3?o:null}function f(n){if(n.tag===13){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function m(n){if(n.tag===31){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function h(n){if(c(n)!==n)throw Error(i(188))}function p(n){var s=n.alternate;if(!s){if(s=c(n),s===null)throw Error(i(188));return s!==n?null:n}for(var o=n,d=s;;){var b=o.return;if(b===null)break;var x=b.alternate;if(x===null){if(d=b.return,d!==null){o=d;continue}break}if(b.child===x.child){for(x=b.child;x;){if(x===o)return h(b),n;if(x===d)return h(b),s;x=x.sibling}throw Error(i(188))}if(o.return!==d.return)o=b,d=x;else{for(var B=!1,W=b.child;W;){if(W===o){B=!0,o=b,d=x;break}if(W===d){B=!0,d=b,o=x;break}W=W.sibling}if(!B){for(W=x.child;W;){if(W===o){B=!0,o=x,d=b;break}if(W===d){B=!0,d=x,o=b;break}W=W.sibling}if(!B)throw Error(i(189))}}if(o.alternate!==d)throw Error(i(190))}if(o.tag!==3)throw Error(i(188));return o.stateNode.current===o?n:s}function y(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n;for(n=n.child;n!==null;){if(s=y(n),s!==null)return s;n=n.sibling}return null}var g=Object.assign,v=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),A=Symbol.for("react.consumer"),O=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),D=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),z=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),X=Symbol.for("react.memo_cache_sentinel"),H=Symbol.iterator;function G(n){return n===null||typeof n!="object"?null:(n=H&&n[H]||n["@@iterator"],typeof n=="function"?n:null)}var V=Symbol.for("react.client.reference");function k(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===V?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case N:return"Fragment";case C:return"Profiler";case E:return"StrictMode";case R:return"Suspense";case D:return"SuspenseList";case P:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case w:return"Portal";case O:return n.displayName||"Context";case A:return(n._context.displayName||"Context")+".Consumer";case _:var s=n.render;return n=n.displayName,n||(n=s.displayName||s.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case j:return s=n.displayName||null,s!==null?s:k(n.type)||"Memo";case z:s=n._payload,n=n._init;try{return k(n(s))}catch{}}return null}var F=Array.isArray,I=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$={pending:!1,data:null,method:null,action:null},T=[],U=-1;function M(n){return{current:n}}function q(n){0>U||(n.current=T[U],T[U]=null,U--)}function Y(n,s){U++,T[U]=n.current,n.current=s}var J=M(null),ie=M(null),Z=M(null),fe=M(null);function Q(n,s){switch(Y(Z,s),Y(ie,n),Y(J,null),s.nodeType){case 9:case 11:n=(n=s.documentElement)&&(n=n.namespaceURI)?bx(n):0;break;default:if(n=s.tagName,s=s.namespaceURI)s=bx(s),n=vx(s,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}q(J),Y(J,n)}function se(){q(J),q(ie),q(Z)}function ne(n){n.memoizedState!==null&&Y(fe,n);var s=J.current,o=vx(s,n.type);s!==o&&(Y(ie,n),Y(J,o))}function we(n){ie.current===n&&(q(J),q(ie)),fe.current===n&&(q(fe),No._currentValue=$)}var Ie,Me;function Ae(n){if(Ie===void 0)try{throw Error()}catch(o){var s=o.stack.trim().match(/\n( *(at )?)/);Ie=s&&s[1]||"",Me=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ie+n+Me}var it=!1;function $e(n,s){if(!n||it)return"";it=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(s){var lt=function(){throw Error()};if(Object.defineProperty(lt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(lt,[])}catch(Ye){var Fe=Ye}Reflect.construct(n,[],lt)}else{try{lt.call()}catch(Ye){Fe=Ye}n.call(lt.prototype)}}else{try{throw Error()}catch(Ye){Fe=Ye}(lt=n())&&typeof lt.catch=="function"&&lt.catch(function(){})}}catch(Ye){if(Ye&&Fe&&typeof Ye.stack=="string")return[Ye.stack,Fe.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=d.DetermineComponentFrameRoot(),B=x[0],W=x[1];if(B&&W){var pe=B.split(`
`),ze=W.split(`
`);for(b=d=0;d<pe.length&&!pe[d].includes("DetermineComponentFrameRoot");)d++;for(;b<ze.length&&!ze[b].includes("DetermineComponentFrameRoot");)b++;if(d===pe.length||b===ze.length)for(d=pe.length-1,b=ze.length-1;1<=d&&0<=b&&pe[d]!==ze[b];)b--;for(;1<=d&&0<=b;d--,b--)if(pe[d]!==ze[b]){if(d!==1||b!==1)do if(d--,b--,0>b||pe[d]!==ze[b]){var tt=`
`+pe[d].replace(" at new "," at ");return n.displayName&&tt.includes("<anonymous>")&&(tt=tt.replace("<anonymous>",n.displayName)),tt}while(1<=d&&0<=b);break}}}finally{it=!1,Error.prepareStackTrace=o}return(o=n?n.displayName||n.name:"")?Ae(o):""}function nt(n,s){switch(n.tag){case 26:case 27:case 5:return Ae(n.type);case 16:return Ae("Lazy");case 13:return n.child!==s&&s!==null?Ae("Suspense Fallback"):Ae("Suspense");case 19:return Ae("SuspenseList");case 0:case 15:return $e(n.type,!1);case 11:return $e(n.type.render,!1);case 1:return $e(n.type,!0);case 31:return Ae("Activity");default:return""}}function Le(n){try{var s="",o=null;do s+=nt(n,o),o=n,n=n.return;while(n);return s}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var wt=Object.prototype.hasOwnProperty,Tt=e.unstable_scheduleCallback,Ct=e.unstable_cancelCallback,At=e.unstable_shouldYield,Ue=e.unstable_requestPaint,Je=e.unstable_now,de=e.unstable_getCurrentPriorityLevel,ue=e.unstable_ImmediatePriority,ye=e.unstable_UserBlockingPriority,Ve=e.unstable_NormalPriority,ee=e.unstable_LowPriority,me=e.unstable_IdlePriority,he=e.log,Se=e.unstable_setDisableYieldValue,We=null,Xe=null;function et(n){if(typeof he=="function"&&Se(n),Xe&&typeof Xe.setStrictMode=="function")try{Xe.setStrictMode(We,n)}catch{}}var Te=Math.clz32?Math.clz32:Nt,mt=Math.log,Dt=Math.LN2;function Nt(n){return n>>>=0,n===0?32:31-(mt(n)/Dt|0)|0}var Ge=256,vt=262144,Mt=4194304;function Bt(n){var s=n&42;if(s!==0)return s;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return n&261888;case 262144:case 524288:case 1048576:case 2097152:return n&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function Jt(n,s,o){var d=n.pendingLanes;if(d===0)return 0;var b=0,x=n.suspendedLanes,B=n.pingedLanes;n=n.warmLanes;var W=d&134217727;return W!==0?(d=W&~x,d!==0?b=Bt(d):(B&=W,B!==0?b=Bt(B):o||(o=W&~n,o!==0&&(b=Bt(o))))):(W=d&~x,W!==0?b=Bt(W):B!==0?b=Bt(B):o||(o=d&~n,o!==0&&(b=Bt(o)))),b===0?0:s!==0&&s!==b&&(s&x)===0&&(x=b&-b,o=s&-s,x>=o||x===32&&(o&4194048)!==0)?s:b}function Et(n,s){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&s)===0}function zt(n,s){switch(n){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $t(){var n=Mt;return Mt<<=1,(Mt&62914560)===0&&(Mt=4194304),n}function kt(n){for(var s=[],o=0;31>o;o++)s.push(n);return s}function te(n,s){n.pendingLanes|=s,s!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function be(n,s,o,d,b,x){var B=n.pendingLanes;n.pendingLanes=o,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=o,n.entangledLanes&=o,n.errorRecoveryDisabledLanes&=o,n.shellSuspendCounter=0;var W=n.entanglements,pe=n.expirationTimes,ze=n.hiddenUpdates;for(o=B&~o;0<o;){var tt=31-Te(o),lt=1<<tt;W[tt]=0,pe[tt]=-1;var Fe=ze[tt];if(Fe!==null)for(ze[tt]=null,tt=0;tt<Fe.length;tt++){var Ye=Fe[tt];Ye!==null&&(Ye.lane&=-536870913)}o&=~lt}d!==0&&ve(n,d,0),x!==0&&b===0&&n.tag!==0&&(n.suspendedLanes|=x&~(B&~s))}function ve(n,s,o){n.pendingLanes|=s,n.suspendedLanes&=~s;var d=31-Te(s);n.entangledLanes|=s,n.entanglements[d]=n.entanglements[d]|1073741824|o&261930}function Be(n,s){var o=n.entangledLanes|=s;for(n=n.entanglements;o;){var d=31-Te(o),b=1<<d;b&s|n[d]&s&&(n[d]|=s),o&=~b}}function ot(n,s){var o=s&-s;return o=(o&42)!==0?1:xt(o),(o&(n.suspendedLanes|s))!==0?0:o}function xt(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function re(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function je(){var n=L.p;return n!==0?n:(n=window.event,n===void 0?32:qx(n.type))}function He(n,s){var o=L.p;try{return L.p=n,s()}finally{L.p=o}}var ut=Math.random().toString(36).slice(2),dt="__reactFiber$"+ut,Ee="__reactProps$"+ut,at="__reactContainer$"+ut,le="__reactEvents$"+ut,st="__reactListeners$"+ut,ct="__reactHandles$"+ut,yt="__reactResources$"+ut,oe="__reactMarker$"+ut;function Ze(n){delete n[dt],delete n[Ee],delete n[le],delete n[st],delete n[ct]}function Ke(n){var s=n[dt];if(s)return s;for(var o=n.parentNode;o;){if(s=o[at]||o[dt]){if(o=s.alternate,s.child!==null||o!==null&&o.child!==null)for(n=_x(n);n!==null;){if(o=n[dt])return o;n=_x(n)}return s}n=o,o=n.parentNode}return null}function ft(n){if(n=n[dt]||n[at]){var s=n.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return n}return null}function Qe(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n.stateNode;throw Error(i(33))}function pt(n){var s=n[yt];return s||(s=n[yt]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function ke(n){n[oe]=!0}var Pe=new Set,ht={};function K(n,s){ae(n,s),ae(n+"Capture",s)}function ae(n,s){for(ht[n]=s,n=0;n<s.length;n++)Pe.add(s[n])}var Ne=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),qe={},gt={};function St(n){return wt.call(gt,n)?!0:wt.call(qe,n)?!1:Ne.test(n)?gt[n]=!0:(qe[n]=!0,!1)}function _t(n,s,o){if(St(s))if(o===null)n.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":n.removeAttribute(s);return;case"boolean":var d=s.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){n.removeAttribute(s);return}}n.setAttribute(s,""+o)}}function qt(n,s,o){if(o===null)n.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(s);return}n.setAttribute(s,""+o)}}function en(n,s,o,d){if(d===null)n.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(o);return}n.setAttributeNS(s,o,""+d)}}function dn(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Zt(n){var s=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function sa(n,s,o){var d=Object.getOwnPropertyDescriptor(n.constructor.prototype,s);if(!n.hasOwnProperty(s)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var b=d.get,x=d.set;return Object.defineProperty(n,s,{configurable:!0,get:function(){return b.call(this)},set:function(B){o=""+B,x.call(this,B)}}),Object.defineProperty(n,s,{enumerable:d.enumerable}),{getValue:function(){return o},setValue:function(B){o=""+B},stopTracking:function(){n._valueTracker=null,delete n[s]}}}}function ba(n){if(!n._valueTracker){var s=Zt(n)?"checked":"value";n._valueTracker=sa(n,s,""+n[s])}}function zs(n){if(!n)return!1;var s=n._valueTracker;if(!s)return!0;var o=s.getValue(),d="";return n&&(d=Zt(n)?n.checked?"true":"false":n.value),n=d,n!==o?(s.setValue(n),!0):!1}function va(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var $s=/[\n"\\]/g;function la(n){return n.replace($s,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function ei(n,s,o,d,b,x,B,W){n.name="",B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?n.type=B:n.removeAttribute("type"),s!=null?B==="number"?(s===0&&n.value===""||n.value!=s)&&(n.value=""+dn(s)):n.value!==""+dn(s)&&(n.value=""+dn(s)):B!=="submit"&&B!=="reset"||n.removeAttribute("value"),s!=null?qn(n,B,dn(s)):o!=null?qn(n,B,dn(o)):d!=null&&n.removeAttribute("value"),b==null&&x!=null&&(n.defaultChecked=!!x),b!=null&&(n.checked=b&&typeof b!="function"&&typeof b!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?n.name=""+dn(W):n.removeAttribute("name")}function ti(n,s,o,d,b,x,B,W){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(n.type=x),s!=null||o!=null){if(!(x!=="submit"&&x!=="reset"||s!=null)){ba(n);return}o=o!=null?""+dn(o):"",s=s!=null?""+dn(s):o,W||s===n.value||(n.value=s),n.defaultValue=s}d=d??b,d=typeof d!="function"&&typeof d!="symbol"&&!!d,n.checked=W?n.checked:!!d,n.defaultChecked=!!d,B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"&&(n.name=B),ba(n)}function qn(n,s,o){s==="number"&&va(n.ownerDocument)===n||n.defaultValue===""+o||(n.defaultValue=""+o)}function La(n,s,o,d){if(n=n.options,s){s={};for(var b=0;b<o.length;b++)s["$"+o[b]]=!0;for(o=0;o<n.length;o++)b=s.hasOwnProperty("$"+n[o].value),n[o].selected!==b&&(n[o].selected=b),b&&d&&(n[o].defaultSelected=!0)}else{for(o=""+dn(o),s=null,b=0;b<n.length;b++){if(n[b].value===o){n[b].selected=!0,d&&(n[b].defaultSelected=!0);return}s!==null||n[b].disabled||(s=n[b])}s!==null&&(s.selected=!0)}}function Ns(n,s,o){if(s!=null&&(s=""+dn(s),s!==n.value&&(n.value=s),o==null)){n.defaultValue!==s&&(n.defaultValue=s);return}n.defaultValue=o!=null?""+dn(o):""}function ce(n,s,o,d){if(s==null){if(d!=null){if(o!=null)throw Error(i(92));if(F(d)){if(1<d.length)throw Error(i(93));d=d[0]}o=d}o==null&&(o=""),s=o}o=dn(s),n.defaultValue=o,d=n.textContent,d===o&&d!==""&&d!==null&&(n.value=d),ba(n)}function _e(n,s){if(s){var o=n.firstChild;if(o&&o===n.lastChild&&o.nodeType===3){o.nodeValue=s;return}}n.textContent=s}var Ht=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function pn(n,s,o){var d=s.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?d?n.setProperty(s,""):s==="float"?n.cssFloat="":n[s]="":d?n.setProperty(s,o):typeof o!="number"||o===0||Ht.has(s)?s==="float"?n.cssFloat=o:n[s]=(""+o).trim():n[s]=o+"px"}function fn(n,s,o){if(s!=null&&typeof s!="object")throw Error(i(62));if(n=n.style,o!=null){for(var d in o)!o.hasOwnProperty(d)||s!=null&&s.hasOwnProperty(d)||(d.indexOf("--")===0?n.setProperty(d,""):d==="float"?n.cssFloat="":n[d]="");for(var b in s)d=s[b],s.hasOwnProperty(b)&&o[b]!==d&&pn(n,b,d)}else for(var x in s)s.hasOwnProperty(x)&&pn(n,x,s[x])}function Pt(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jn=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Hn=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Bn(n){return Hn.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}function oa(){}var ge=null;function Re(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var bt=null,It=null;function Gt(n){var s=ft(n);if(s&&(n=s.stateNode)){var o=n[Ee]||null;e:switch(n=s.stateNode,s.type){case"input":if(ei(n,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),s=o.name,o.type==="radio"&&s!=null){for(o=n;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+la(""+s)+'"][type="radio"]'),s=0;s<o.length;s++){var d=o[s];if(d!==n&&d.form===n.form){var b=d[Ee]||null;if(!b)throw Error(i(90));ei(d,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(s=0;s<o.length;s++)d=o[s],d.form===n.form&&zs(d)}break e;case"textarea":Ns(n,o.value,o.defaultValue);break e;case"select":s=o.value,s!=null&&La(n,!!o.multiple,s,!1)}}}var an=!1;function xn(n,s,o){if(an)return n(s,o);an=!0;try{var d=n(s);return d}finally{if(an=!1,(bt!==null||It!==null)&&(mu(),bt&&(s=bt,n=It,It=bt=null,Gt(s),n)))for(s=0;s<n.length;s++)Gt(n[s])}}function Kt(n,s){var o=n.stateNode;if(o===null)return null;var d=o[Ee]||null;if(d===null)return null;o=d[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(n=n.type,d=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!d;break e;default:n=!1}if(n)return null;if(o&&typeof o!="function")throw Error(i(231,s,typeof o));return o}var vn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ca=!1;if(vn)try{var Yt={};Object.defineProperty(Yt,"passive",{get:function(){ca=!0}}),window.addEventListener("test",Yt,Yt),window.removeEventListener("test",Yt,Yt)}catch{ca=!1}var Wn=null,Ka=null,Ii=null;function Li(){if(Ii)return Ii;var n,s=Ka,o=s.length,d,b="value"in Wn?Wn.value:Wn.textContent,x=b.length;for(n=0;n<o&&s[n]===b[n];n++);var B=o-n;for(d=1;d<=B&&s[o-d]===b[x-d];d++);return Ii=b.slice(n,1<d?1-d:void 0)}function Oi(n){var s=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&s===13&&(n=13)):n=s,n===10&&(n=13),32<=n||n===13?n:0}function zi(){return!0}function xg(){return!1}function Ea(n){function s(o,d,b,x,B){this._reactName=o,this._targetInst=b,this.type=d,this.nativeEvent=x,this.target=B,this.currentTarget=null;for(var W in n)n.hasOwnProperty(W)&&(o=n[W],this[W]=o?o(x):x[W]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?zi:xg,this.isPropagationStopped=xg,this}return g(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=zi)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=zi)},persist:function(){},isPersistent:zi}),s}var ni={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Mc=Ea(ni),Ul=g({},ni,{view:0,detail:0}),vj=Ea(Ul),_f,Cf,ql,Rc=g({},Ul,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tf,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==ql&&(ql&&n.type==="mousemove"?(_f=n.screenX-ql.screenX,Cf=n.screenY-ql.screenY):Cf=_f=0,ql=n),_f)},movementY:function(n){return"movementY"in n?n.movementY:Cf}}),Sg=Ea(Rc),xj=g({},Rc,{dataTransfer:0}),Sj=Ea(xj),wj=g({},Ul,{relatedTarget:0}),Af=Ea(wj),Nj=g({},ni,{animationName:0,elapsedTime:0,pseudoElement:0}),Ej=Ea(Nj),jj=g({},ni,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),_j=Ea(jj),Cj=g({},ni,{data:0}),wg=Ea(Cj),Aj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Mj={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rj(n){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(n):(n=Mj[n])?!!s[n]:!1}function Tf(){return Rj}var kj=g({},Ul,{key:function(n){if(n.key){var s=Aj[n.key]||n.key;if(s!=="Unidentified")return s}return n.type==="keypress"?(n=Oi(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Tj[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tf,charCode:function(n){return n.type==="keypress"?Oi(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Oi(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Dj=Ea(kj),Ij=g({},Rc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ng=Ea(Ij),Lj=g({},Ul,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tf}),Oj=Ea(Lj),zj=g({},ni,{propertyName:0,elapsedTime:0,pseudoElement:0}),$j=Ea(zj),Fj=g({},Rc,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Bj=Ea(Fj),Uj=g({},ni,{newState:0,oldState:0}),qj=Ea(Uj),Hj=[9,13,27,32],Mf=vn&&"CompositionEvent"in window,Hl=null;vn&&"documentMode"in document&&(Hl=document.documentMode);var Pj=vn&&"TextEvent"in window&&!Hl,Eg=vn&&(!Mf||Hl&&8<Hl&&11>=Hl),jg=" ",_g=!1;function Cg(n,s){switch(n){case"keyup":return Hj.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ag(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var $i=!1;function Vj(n,s){switch(n){case"compositionend":return Ag(s);case"keypress":return s.which!==32?null:(_g=!0,jg);case"textInput":return n=s.data,n===jg&&_g?null:n;default:return null}}function Yj(n,s){if($i)return n==="compositionend"||!Mf&&Cg(n,s)?(n=Li(),Ii=Ka=Wn=null,$i=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Eg&&s.locale!=="ko"?null:s.data;default:return null}}var Gj={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Tg(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s==="input"?!!Gj[n.type]:s==="textarea"}function Mg(n,s,o,d){bt?It?It.push(d):It=[d]:bt=d,s=xu(s,"onChange"),0<s.length&&(o=new Mc("onChange","change",null,o,d),n.push({event:o,listeners:s}))}var Pl=null,Vl=null;function Xj(n){fx(n,0)}function kc(n){var s=Qe(n);if(zs(s))return n}function Rg(n,s){if(n==="change")return s}var kg=!1;if(vn){var Rf;if(vn){var kf="oninput"in document;if(!kf){var Dg=document.createElement("div");Dg.setAttribute("oninput","return;"),kf=typeof Dg.oninput=="function"}Rf=kf}else Rf=!1;kg=Rf&&(!document.documentMode||9<document.documentMode)}function Ig(){Pl&&(Pl.detachEvent("onpropertychange",Lg),Vl=Pl=null)}function Lg(n){if(n.propertyName==="value"&&kc(Vl)){var s=[];Mg(s,Vl,n,Re(n)),xn(Xj,s)}}function Kj(n,s,o){n==="focusin"?(Ig(),Pl=s,Vl=o,Pl.attachEvent("onpropertychange",Lg)):n==="focusout"&&Ig()}function Wj(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return kc(Vl)}function Zj(n,s){if(n==="click")return kc(s)}function Qj(n,s){if(n==="input"||n==="change")return kc(s)}function Jj(n,s){return n===s&&(n!==0||1/n===1/s)||n!==n&&s!==s}var Oa=typeof Object.is=="function"?Object.is:Jj;function Yl(n,s){if(Oa(n,s))return!0;if(typeof n!="object"||n===null||typeof s!="object"||s===null)return!1;var o=Object.keys(n),d=Object.keys(s);if(o.length!==d.length)return!1;for(d=0;d<o.length;d++){var b=o[d];if(!wt.call(s,b)||!Oa(n[b],s[b]))return!1}return!0}function Og(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function zg(n,s){var o=Og(n);n=0;for(var d;o;){if(o.nodeType===3){if(d=n+o.textContent.length,n<=s&&d>=s)return{node:o,offset:s-n};n=d}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Og(o)}}function $g(n,s){return n&&s?n===s?!0:n&&n.nodeType===3?!1:s&&s.nodeType===3?$g(n,s.parentNode):"contains"in n?n.contains(s):n.compareDocumentPosition?!!(n.compareDocumentPosition(s)&16):!1:!1}function Fg(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var s=va(n.document);s instanceof n.HTMLIFrameElement;){try{var o=typeof s.contentWindow.location.href=="string"}catch{o=!1}if(o)n=s.contentWindow;else break;s=va(n.document)}return s}function Df(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s&&(s==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||s==="textarea"||n.contentEditable==="true")}var e_=vn&&"documentMode"in document&&11>=document.documentMode,Fi=null,If=null,Gl=null,Lf=!1;function Bg(n,s,o){var d=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Lf||Fi==null||Fi!==va(d)||(d=Fi,"selectionStart"in d&&Df(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Gl&&Yl(Gl,d)||(Gl=d,d=xu(If,"onSelect"),0<d.length&&(s=new Mc("onSelect","select",null,s,o),n.push({event:s,listeners:d}),s.target=Fi)))}function ai(n,s){var o={};return o[n.toLowerCase()]=s.toLowerCase(),o["Webkit"+n]="webkit"+s,o["Moz"+n]="moz"+s,o}var Bi={animationend:ai("Animation","AnimationEnd"),animationiteration:ai("Animation","AnimationIteration"),animationstart:ai("Animation","AnimationStart"),transitionrun:ai("Transition","TransitionRun"),transitionstart:ai("Transition","TransitionStart"),transitioncancel:ai("Transition","TransitionCancel"),transitionend:ai("Transition","TransitionEnd")},Of={},Ug={};vn&&(Ug=document.createElement("div").style,"AnimationEvent"in window||(delete Bi.animationend.animation,delete Bi.animationiteration.animation,delete Bi.animationstart.animation),"TransitionEvent"in window||delete Bi.transitionend.transition);function si(n){if(Of[n])return Of[n];if(!Bi[n])return n;var s=Bi[n],o;for(o in s)if(s.hasOwnProperty(o)&&o in Ug)return Of[n]=s[o];return n}var qg=si("animationend"),Hg=si("animationiteration"),Pg=si("animationstart"),t_=si("transitionrun"),n_=si("transitionstart"),a_=si("transitioncancel"),Vg=si("transitionend"),Yg=new Map,zf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");zf.push("scrollEnd");function us(n,s){Yg.set(n,s),K(s,[n])}var Dc=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)},Wa=[],Ui=0,$f=0;function Ic(){for(var n=Ui,s=$f=Ui=0;s<n;){var o=Wa[s];Wa[s++]=null;var d=Wa[s];Wa[s++]=null;var b=Wa[s];Wa[s++]=null;var x=Wa[s];if(Wa[s++]=null,d!==null&&b!==null){var B=d.pending;B===null?b.next=b:(b.next=B.next,B.next=b),d.pending=b}x!==0&&Gg(o,b,x)}}function Lc(n,s,o,d){Wa[Ui++]=n,Wa[Ui++]=s,Wa[Ui++]=o,Wa[Ui++]=d,$f|=d,n.lanes|=d,n=n.alternate,n!==null&&(n.lanes|=d)}function Ff(n,s,o,d){return Lc(n,s,o,d),Oc(n)}function ri(n,s){return Lc(n,null,null,s),Oc(n)}function Gg(n,s,o){n.lanes|=o;var d=n.alternate;d!==null&&(d.lanes|=o);for(var b=!1,x=n.return;x!==null;)x.childLanes|=o,d=x.alternate,d!==null&&(d.childLanes|=o),x.tag===22&&(n=x.stateNode,n===null||n._visibility&1||(b=!0)),n=x,x=x.return;return n.tag===3?(x=n.stateNode,b&&s!==null&&(b=31-Te(o),n=x.hiddenUpdates,d=n[b],d===null?n[b]=[s]:d.push(s),s.lane=o|536870912),x):null}function Oc(n){if(50<yo)throw yo=0,Xm=null,Error(i(185));for(var s=n.return;s!==null;)n=s,s=n.return;return n.tag===3?n.stateNode:null}var qi={};function s_(n,s,o,d){this.tag=n,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function za(n,s,o,d){return new s_(n,s,o,d)}function Bf(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Fs(n,s){var o=n.alternate;return o===null?(o=za(n.tag,s,n.key,n.mode),o.elementType=n.elementType,o.type=n.type,o.stateNode=n.stateNode,o.alternate=n,n.alternate=o):(o.pendingProps=s,o.type=n.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=n.flags&65011712,o.childLanes=n.childLanes,o.lanes=n.lanes,o.child=n.child,o.memoizedProps=n.memoizedProps,o.memoizedState=n.memoizedState,o.updateQueue=n.updateQueue,s=n.dependencies,o.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},o.sibling=n.sibling,o.index=n.index,o.ref=n.ref,o.refCleanup=n.refCleanup,o}function Xg(n,s){n.flags&=65011714;var o=n.alternate;return o===null?(n.childLanes=0,n.lanes=s,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=o.childLanes,n.lanes=o.lanes,n.child=o.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=o.memoizedProps,n.memoizedState=o.memoizedState,n.updateQueue=o.updateQueue,n.type=o.type,s=o.dependencies,n.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),n}function zc(n,s,o,d,b,x){var B=0;if(d=n,typeof n=="function")Bf(n)&&(B=1);else if(typeof n=="string")B=cC(n,o,J.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case P:return n=za(31,o,s,b),n.elementType=P,n.lanes=x,n;case N:return ii(o.children,b,x,s);case E:B=8,b|=24;break;case C:return n=za(12,o,s,b|2),n.elementType=C,n.lanes=x,n;case R:return n=za(13,o,s,b),n.elementType=R,n.lanes=x,n;case D:return n=za(19,o,s,b),n.elementType=D,n.lanes=x,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case O:B=10;break e;case A:B=9;break e;case _:B=11;break e;case j:B=14;break e;case z:B=16,d=null;break e}B=29,o=Error(i(130,n===null?"null":typeof n,"")),d=null}return s=za(B,o,s,b),s.elementType=n,s.type=d,s.lanes=x,s}function ii(n,s,o,d){return n=za(7,n,d,s),n.lanes=o,n}function Uf(n,s,o){return n=za(6,n,null,s),n.lanes=o,n}function Kg(n){var s=za(18,null,null,0);return s.stateNode=n,s}function qf(n,s,o){return s=za(4,n.children!==null?n.children:[],n.key,s),s.lanes=o,s.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},s}var Wg=new WeakMap;function Za(n,s){if(typeof n=="object"&&n!==null){var o=Wg.get(n);return o!==void 0?o:(s={value:n,source:s,stack:Le(s)},Wg.set(n,s),s)}return{value:n,source:s,stack:Le(s)}}var Hi=[],Pi=0,$c=null,Xl=0,Qa=[],Ja=0,mr=null,Es=1,js="";function Bs(n,s){Hi[Pi++]=Xl,Hi[Pi++]=$c,$c=n,Xl=s}function Zg(n,s,o){Qa[Ja++]=Es,Qa[Ja++]=js,Qa[Ja++]=mr,mr=n;var d=Es;n=js;var b=32-Te(d)-1;d&=~(1<<b),o+=1;var x=32-Te(s)+b;if(30<x){var B=b-b%5;x=(d&(1<<B)-1).toString(32),d>>=B,b-=B,Es=1<<32-Te(s)+b|o<<b|d,js=x+n}else Es=1<<x|o<<b|d,js=n}function Hf(n){n.return!==null&&(Bs(n,1),Zg(n,1,0))}function Pf(n){for(;n===$c;)$c=Hi[--Pi],Hi[Pi]=null,Xl=Hi[--Pi],Hi[Pi]=null;for(;n===mr;)mr=Qa[--Ja],Qa[Ja]=null,js=Qa[--Ja],Qa[Ja]=null,Es=Qa[--Ja],Qa[Ja]=null}function Qg(n,s){Qa[Ja++]=Es,Qa[Ja++]=js,Qa[Ja++]=mr,Es=s.id,js=s.overflow,mr=n}var ua=null,On=null,bn=!1,hr=null,es=!1,Vf=Error(i(519));function pr(n){var s=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Kl(Za(s,n)),Vf}function Jg(n){var s=n.stateNode,o=n.type,d=n.memoizedProps;switch(s[dt]=n,s[Ee]=d,o){case"dialog":hn("cancel",s),hn("close",s);break;case"iframe":case"object":case"embed":hn("load",s);break;case"video":case"audio":for(o=0;o<bo.length;o++)hn(bo[o],s);break;case"source":hn("error",s);break;case"img":case"image":case"link":hn("error",s),hn("load",s);break;case"details":hn("toggle",s);break;case"input":hn("invalid",s),ti(s,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":hn("invalid",s);break;case"textarea":hn("invalid",s),ce(s,d.value,d.defaultValue,d.children)}o=d.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||s.textContent===""+o||d.suppressHydrationWarning===!0||yx(s.textContent,o)?(d.popover!=null&&(hn("beforetoggle",s),hn("toggle",s)),d.onScroll!=null&&hn("scroll",s),d.onScrollEnd!=null&&hn("scrollend",s),d.onClick!=null&&(s.onclick=oa),s=!0):s=!1,s||pr(n,!0)}function eb(n){for(ua=n.return;ua;)switch(ua.tag){case 5:case 31:case 13:es=!1;return;case 27:case 3:es=!0;return;default:ua=ua.return}}function Vi(n){if(n!==ua)return!1;if(!bn)return eb(n),bn=!0,!1;var s=n.tag,o;if((o=s!==3&&s!==27)&&((o=s===5)&&(o=n.type,o=!(o!=="form"&&o!=="button")||ch(n.type,n.memoizedProps)),o=!o),o&&On&&pr(n),eb(n),s===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));On=jx(n)}else if(s===31){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));On=jx(n)}else s===27?(s=On,Tr(n.type)?(n=hh,hh=null,On=n):On=s):On=ua?ns(n.stateNode.nextSibling):null;return!0}function li(){On=ua=null,bn=!1}function Yf(){var n=hr;return n!==null&&(Aa===null?Aa=n:Aa.push.apply(Aa,n),hr=null),n}function Kl(n){hr===null?hr=[n]:hr.push(n)}var Gf=M(null),oi=null,Us=null;function yr(n,s,o){Y(Gf,s._currentValue),s._currentValue=o}function qs(n){n._currentValue=Gf.current,q(Gf)}function Xf(n,s,o){for(;n!==null;){var d=n.alternate;if((n.childLanes&s)!==s?(n.childLanes|=s,d!==null&&(d.childLanes|=s)):d!==null&&(d.childLanes&s)!==s&&(d.childLanes|=s),n===o)break;n=n.return}}function Kf(n,s,o,d){var b=n.child;for(b!==null&&(b.return=n);b!==null;){var x=b.dependencies;if(x!==null){var B=b.child;x=x.firstContext;e:for(;x!==null;){var W=x;x=b;for(var pe=0;pe<s.length;pe++)if(W.context===s[pe]){x.lanes|=o,W=x.alternate,W!==null&&(W.lanes|=o),Xf(x.return,o,n),d||(B=null);break e}x=W.next}}else if(b.tag===18){if(B=b.return,B===null)throw Error(i(341));B.lanes|=o,x=B.alternate,x!==null&&(x.lanes|=o),Xf(B,o,n),B=null}else B=b.child;if(B!==null)B.return=b;else for(B=b;B!==null;){if(B===n){B=null;break}if(b=B.sibling,b!==null){b.return=B.return,B=b;break}B=B.return}b=B}}function Yi(n,s,o,d){n=null;for(var b=s,x=!1;b!==null;){if(!x){if((b.flags&524288)!==0)x=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var B=b.alternate;if(B===null)throw Error(i(387));if(B=B.memoizedProps,B!==null){var W=b.type;Oa(b.pendingProps.value,B.value)||(n!==null?n.push(W):n=[W])}}else if(b===fe.current){if(B=b.alternate,B===null)throw Error(i(387));B.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(n!==null?n.push(No):n=[No])}b=b.return}n!==null&&Kf(s,n,o,d),s.flags|=262144}function Fc(n){for(n=n.firstContext;n!==null;){if(!Oa(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function ci(n){oi=n,Us=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function da(n){return tb(oi,n)}function Bc(n,s){return oi===null&&ci(n),tb(n,s)}function tb(n,s){var o=s._currentValue;if(s={context:s,memoizedValue:o,next:null},Us===null){if(n===null)throw Error(i(308));Us=s,n.dependencies={lanes:0,firstContext:s},n.flags|=524288}else Us=Us.next=s;return o}var r_=typeof AbortController<"u"?AbortController:function(){var n=[],s=this.signal={aborted:!1,addEventListener:function(o,d){n.push(d)}};this.abort=function(){s.aborted=!0,n.forEach(function(o){return o()})}},i_=e.unstable_scheduleCallback,l_=e.unstable_NormalPriority,Zn={$$typeof:O,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Wf(){return{controller:new r_,data:new Map,refCount:0}}function Wl(n){n.refCount--,n.refCount===0&&i_(l_,function(){n.controller.abort()})}var Zl=null,Zf=0,Gi=0,Xi=null;function o_(n,s){if(Zl===null){var o=Zl=[];Zf=0,Gi=eh(),Xi={status:"pending",value:void 0,then:function(d){o.push(d)}}}return Zf++,s.then(nb,nb),s}function nb(){if(--Zf===0&&Zl!==null){Xi!==null&&(Xi.status="fulfilled");var n=Zl;Zl=null,Gi=0,Xi=null;for(var s=0;s<n.length;s++)(0,n[s])()}}function c_(n,s){var o=[],d={status:"pending",value:null,reason:null,then:function(b){o.push(b)}};return n.then(function(){d.status="fulfilled",d.value=s;for(var b=0;b<o.length;b++)(0,o[b])(s)},function(b){for(d.status="rejected",d.reason=b,b=0;b<o.length;b++)(0,o[b])(void 0)}),d}var ab=I.S;I.S=function(n,s){Bv=Je(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&o_(n,s),ab!==null&&ab(n,s)};var ui=M(null);function Qf(){var n=ui.current;return n!==null?n:In.pooledCache}function Uc(n,s){s===null?Y(ui,ui.current):Y(ui,s.pool)}function sb(){var n=Qf();return n===null?null:{parent:Zn._currentValue,pool:n}}var Ki=Error(i(460)),Jf=Error(i(474)),qc=Error(i(542)),Hc={then:function(){}};function rb(n){return n=n.status,n==="fulfilled"||n==="rejected"}function ib(n,s,o){switch(o=n[o],o===void 0?n.push(s):o!==s&&(s.then(oa,oa),s=o),s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,ob(n),n;default:if(typeof s.status=="string")s.then(oa,oa);else{if(n=In,n!==null&&100<n.shellSuspendCounter)throw Error(i(482));n=s,n.status="pending",n.then(function(d){if(s.status==="pending"){var b=s;b.status="fulfilled",b.value=d}},function(d){if(s.status==="pending"){var b=s;b.status="rejected",b.reason=d}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,ob(n),n}throw fi=s,Ki}}function di(n){try{var s=n._init;return s(n._payload)}catch(o){throw o!==null&&typeof o=="object"&&typeof o.then=="function"?(fi=o,Ki):o}}var fi=null;function lb(){if(fi===null)throw Error(i(459));var n=fi;return fi=null,n}function ob(n){if(n===Ki||n===qc)throw Error(i(483))}var Wi=null,Ql=0;function Pc(n){var s=Ql;return Ql+=1,Wi===null&&(Wi=[]),ib(Wi,n,s)}function Jl(n,s){s=s.props.ref,n.ref=s!==void 0?s:null}function Vc(n,s){throw s.$$typeof===v?Error(i(525)):(n=Object.prototype.toString.call(s),Error(i(31,n==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":n)))}function cb(n){function s(Ce,xe){if(n){var Oe=Ce.deletions;Oe===null?(Ce.deletions=[xe],Ce.flags|=16):Oe.push(xe)}}function o(Ce,xe){if(!n)return null;for(;xe!==null;)s(Ce,xe),xe=xe.sibling;return null}function d(Ce){for(var xe=new Map;Ce!==null;)Ce.key!==null?xe.set(Ce.key,Ce):xe.set(Ce.index,Ce),Ce=Ce.sibling;return xe}function b(Ce,xe){return Ce=Fs(Ce,xe),Ce.index=0,Ce.sibling=null,Ce}function x(Ce,xe,Oe){return Ce.index=Oe,n?(Oe=Ce.alternate,Oe!==null?(Oe=Oe.index,Oe<xe?(Ce.flags|=67108866,xe):Oe):(Ce.flags|=67108866,xe)):(Ce.flags|=1048576,xe)}function B(Ce){return n&&Ce.alternate===null&&(Ce.flags|=67108866),Ce}function W(Ce,xe,Oe,rt){return xe===null||xe.tag!==6?(xe=Uf(Oe,Ce.mode,rt),xe.return=Ce,xe):(xe=b(xe,Oe),xe.return=Ce,xe)}function pe(Ce,xe,Oe,rt){var Vt=Oe.type;return Vt===N?tt(Ce,xe,Oe.props.children,rt,Oe.key):xe!==null&&(xe.elementType===Vt||typeof Vt=="object"&&Vt!==null&&Vt.$$typeof===z&&di(Vt)===xe.type)?(xe=b(xe,Oe.props),Jl(xe,Oe),xe.return=Ce,xe):(xe=zc(Oe.type,Oe.key,Oe.props,null,Ce.mode,rt),Jl(xe,Oe),xe.return=Ce,xe)}function ze(Ce,xe,Oe,rt){return xe===null||xe.tag!==4||xe.stateNode.containerInfo!==Oe.containerInfo||xe.stateNode.implementation!==Oe.implementation?(xe=qf(Oe,Ce.mode,rt),xe.return=Ce,xe):(xe=b(xe,Oe.children||[]),xe.return=Ce,xe)}function tt(Ce,xe,Oe,rt,Vt){return xe===null||xe.tag!==7?(xe=ii(Oe,Ce.mode,rt,Vt),xe.return=Ce,xe):(xe=b(xe,Oe),xe.return=Ce,xe)}function lt(Ce,xe,Oe){if(typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint")return xe=Uf(""+xe,Ce.mode,Oe),xe.return=Ce,xe;if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case S:return Oe=zc(xe.type,xe.key,xe.props,null,Ce.mode,Oe),Jl(Oe,xe),Oe.return=Ce,Oe;case w:return xe=qf(xe,Ce.mode,Oe),xe.return=Ce,xe;case z:return xe=di(xe),lt(Ce,xe,Oe)}if(F(xe)||G(xe))return xe=ii(xe,Ce.mode,Oe,null),xe.return=Ce,xe;if(typeof xe.then=="function")return lt(Ce,Pc(xe),Oe);if(xe.$$typeof===O)return lt(Ce,Bc(Ce,xe),Oe);Vc(Ce,xe)}return null}function Fe(Ce,xe,Oe,rt){var Vt=xe!==null?xe.key:null;if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number"||typeof Oe=="bigint")return Vt!==null?null:W(Ce,xe,""+Oe,rt);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case S:return Oe.key===Vt?pe(Ce,xe,Oe,rt):null;case w:return Oe.key===Vt?ze(Ce,xe,Oe,rt):null;case z:return Oe=di(Oe),Fe(Ce,xe,Oe,rt)}if(F(Oe)||G(Oe))return Vt!==null?null:tt(Ce,xe,Oe,rt,null);if(typeof Oe.then=="function")return Fe(Ce,xe,Pc(Oe),rt);if(Oe.$$typeof===O)return Fe(Ce,xe,Bc(Ce,Oe),rt);Vc(Ce,Oe)}return null}function Ye(Ce,xe,Oe,rt,Vt){if(typeof rt=="string"&&rt!==""||typeof rt=="number"||typeof rt=="bigint")return Ce=Ce.get(Oe)||null,W(xe,Ce,""+rt,Vt);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case S:return Ce=Ce.get(rt.key===null?Oe:rt.key)||null,pe(xe,Ce,rt,Vt);case w:return Ce=Ce.get(rt.key===null?Oe:rt.key)||null,ze(xe,Ce,rt,Vt);case z:return rt=di(rt),Ye(Ce,xe,Oe,rt,Vt)}if(F(rt)||G(rt))return Ce=Ce.get(Oe)||null,tt(xe,Ce,rt,Vt,null);if(typeof rt.then=="function")return Ye(Ce,xe,Oe,Pc(rt),Vt);if(rt.$$typeof===O)return Ye(Ce,xe,Oe,Bc(xe,rt),Vt);Vc(xe,rt)}return null}function Ot(Ce,xe,Oe,rt){for(var Vt=null,Sn=null,Ft=xe,sn=xe=0,gn=null;Ft!==null&&sn<Oe.length;sn++){Ft.index>sn?(gn=Ft,Ft=null):gn=Ft.sibling;var wn=Fe(Ce,Ft,Oe[sn],rt);if(wn===null){Ft===null&&(Ft=gn);break}n&&Ft&&wn.alternate===null&&s(Ce,Ft),xe=x(wn,xe,sn),Sn===null?Vt=wn:Sn.sibling=wn,Sn=wn,Ft=gn}if(sn===Oe.length)return o(Ce,Ft),bn&&Bs(Ce,sn),Vt;if(Ft===null){for(;sn<Oe.length;sn++)Ft=lt(Ce,Oe[sn],rt),Ft!==null&&(xe=x(Ft,xe,sn),Sn===null?Vt=Ft:Sn.sibling=Ft,Sn=Ft);return bn&&Bs(Ce,sn),Vt}for(Ft=d(Ft);sn<Oe.length;sn++)gn=Ye(Ft,Ce,sn,Oe[sn],rt),gn!==null&&(n&&gn.alternate!==null&&Ft.delete(gn.key===null?sn:gn.key),xe=x(gn,xe,sn),Sn===null?Vt=gn:Sn.sibling=gn,Sn=gn);return n&&Ft.forEach(function(Ir){return s(Ce,Ir)}),bn&&Bs(Ce,sn),Vt}function Wt(Ce,xe,Oe,rt){if(Oe==null)throw Error(i(151));for(var Vt=null,Sn=null,Ft=xe,sn=xe=0,gn=null,wn=Oe.next();Ft!==null&&!wn.done;sn++,wn=Oe.next()){Ft.index>sn?(gn=Ft,Ft=null):gn=Ft.sibling;var Ir=Fe(Ce,Ft,wn.value,rt);if(Ir===null){Ft===null&&(Ft=gn);break}n&&Ft&&Ir.alternate===null&&s(Ce,Ft),xe=x(Ir,xe,sn),Sn===null?Vt=Ir:Sn.sibling=Ir,Sn=Ir,Ft=gn}if(wn.done)return o(Ce,Ft),bn&&Bs(Ce,sn),Vt;if(Ft===null){for(;!wn.done;sn++,wn=Oe.next())wn=lt(Ce,wn.value,rt),wn!==null&&(xe=x(wn,xe,sn),Sn===null?Vt=wn:Sn.sibling=wn,Sn=wn);return bn&&Bs(Ce,sn),Vt}for(Ft=d(Ft);!wn.done;sn++,wn=Oe.next())wn=Ye(Ft,Ce,sn,wn.value,rt),wn!==null&&(n&&wn.alternate!==null&&Ft.delete(wn.key===null?sn:wn.key),xe=x(wn,xe,sn),Sn===null?Vt=wn:Sn.sibling=wn,Sn=wn);return n&&Ft.forEach(function(xC){return s(Ce,xC)}),bn&&Bs(Ce,sn),Vt}function Dn(Ce,xe,Oe,rt){if(typeof Oe=="object"&&Oe!==null&&Oe.type===N&&Oe.key===null&&(Oe=Oe.props.children),typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case S:e:{for(var Vt=Oe.key;xe!==null;){if(xe.key===Vt){if(Vt=Oe.type,Vt===N){if(xe.tag===7){o(Ce,xe.sibling),rt=b(xe,Oe.props.children),rt.return=Ce,Ce=rt;break e}}else if(xe.elementType===Vt||typeof Vt=="object"&&Vt!==null&&Vt.$$typeof===z&&di(Vt)===xe.type){o(Ce,xe.sibling),rt=b(xe,Oe.props),Jl(rt,Oe),rt.return=Ce,Ce=rt;break e}o(Ce,xe);break}else s(Ce,xe);xe=xe.sibling}Oe.type===N?(rt=ii(Oe.props.children,Ce.mode,rt,Oe.key),rt.return=Ce,Ce=rt):(rt=zc(Oe.type,Oe.key,Oe.props,null,Ce.mode,rt),Jl(rt,Oe),rt.return=Ce,Ce=rt)}return B(Ce);case w:e:{for(Vt=Oe.key;xe!==null;){if(xe.key===Vt)if(xe.tag===4&&xe.stateNode.containerInfo===Oe.containerInfo&&xe.stateNode.implementation===Oe.implementation){o(Ce,xe.sibling),rt=b(xe,Oe.children||[]),rt.return=Ce,Ce=rt;break e}else{o(Ce,xe);break}else s(Ce,xe);xe=xe.sibling}rt=qf(Oe,Ce.mode,rt),rt.return=Ce,Ce=rt}return B(Ce);case z:return Oe=di(Oe),Dn(Ce,xe,Oe,rt)}if(F(Oe))return Ot(Ce,xe,Oe,rt);if(G(Oe)){if(Vt=G(Oe),typeof Vt!="function")throw Error(i(150));return Oe=Vt.call(Oe),Wt(Ce,xe,Oe,rt)}if(typeof Oe.then=="function")return Dn(Ce,xe,Pc(Oe),rt);if(Oe.$$typeof===O)return Dn(Ce,xe,Bc(Ce,Oe),rt);Vc(Ce,Oe)}return typeof Oe=="string"&&Oe!==""||typeof Oe=="number"||typeof Oe=="bigint"?(Oe=""+Oe,xe!==null&&xe.tag===6?(o(Ce,xe.sibling),rt=b(xe,Oe),rt.return=Ce,Ce=rt):(o(Ce,xe),rt=Uf(Oe,Ce.mode,rt),rt.return=Ce,Ce=rt),B(Ce)):o(Ce,xe)}return function(Ce,xe,Oe,rt){try{Ql=0;var Vt=Dn(Ce,xe,Oe,rt);return Wi=null,Vt}catch(Ft){if(Ft===Ki||Ft===qc)throw Ft;var Sn=za(29,Ft,null,Ce.mode);return Sn.lanes=rt,Sn.return=Ce,Sn}finally{}}}var mi=cb(!0),ub=cb(!1),gr=!1;function em(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function tm(n,s){n=n.updateQueue,s.updateQueue===n&&(s.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function br(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function vr(n,s,o){var d=n.updateQueue;if(d===null)return null;if(d=d.shared,(_n&2)!==0){var b=d.pending;return b===null?s.next=s:(s.next=b.next,b.next=s),d.pending=s,s=Oc(n),Gg(n,null,o),s}return Lc(n,d,s,o),Oc(n)}function eo(n,s,o){if(s=s.updateQueue,s!==null&&(s=s.shared,(o&4194048)!==0)){var d=s.lanes;d&=n.pendingLanes,o|=d,s.lanes=o,Be(n,o)}}function nm(n,s){var o=n.updateQueue,d=n.alternate;if(d!==null&&(d=d.updateQueue,o===d)){var b=null,x=null;if(o=o.firstBaseUpdate,o!==null){do{var B={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};x===null?b=x=B:x=x.next=B,o=o.next}while(o!==null);x===null?b=x=s:x=x.next=s}else b=x=s;o={baseState:d.baseState,firstBaseUpdate:b,lastBaseUpdate:x,shared:d.shared,callbacks:d.callbacks},n.updateQueue=o;return}n=o.lastBaseUpdate,n===null?o.firstBaseUpdate=s:n.next=s,o.lastBaseUpdate=s}var am=!1;function to(){if(am){var n=Xi;if(n!==null)throw n}}function no(n,s,o,d){am=!1;var b=n.updateQueue;gr=!1;var x=b.firstBaseUpdate,B=b.lastBaseUpdate,W=b.shared.pending;if(W!==null){b.shared.pending=null;var pe=W,ze=pe.next;pe.next=null,B===null?x=ze:B.next=ze,B=pe;var tt=n.alternate;tt!==null&&(tt=tt.updateQueue,W=tt.lastBaseUpdate,W!==B&&(W===null?tt.firstBaseUpdate=ze:W.next=ze,tt.lastBaseUpdate=pe))}if(x!==null){var lt=b.baseState;B=0,tt=ze=pe=null,W=x;do{var Fe=W.lane&-536870913,Ye=Fe!==W.lane;if(Ye?(yn&Fe)===Fe:(d&Fe)===Fe){Fe!==0&&Fe===Gi&&(am=!0),tt!==null&&(tt=tt.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var Ot=n,Wt=W;Fe=s;var Dn=o;switch(Wt.tag){case 1:if(Ot=Wt.payload,typeof Ot=="function"){lt=Ot.call(Dn,lt,Fe);break e}lt=Ot;break e;case 3:Ot.flags=Ot.flags&-65537|128;case 0:if(Ot=Wt.payload,Fe=typeof Ot=="function"?Ot.call(Dn,lt,Fe):Ot,Fe==null)break e;lt=g({},lt,Fe);break e;case 2:gr=!0}}Fe=W.callback,Fe!==null&&(n.flags|=64,Ye&&(n.flags|=8192),Ye=b.callbacks,Ye===null?b.callbacks=[Fe]:Ye.push(Fe))}else Ye={lane:Fe,tag:W.tag,payload:W.payload,callback:W.callback,next:null},tt===null?(ze=tt=Ye,pe=lt):tt=tt.next=Ye,B|=Fe;if(W=W.next,W===null){if(W=b.shared.pending,W===null)break;Ye=W,W=Ye.next,Ye.next=null,b.lastBaseUpdate=Ye,b.shared.pending=null}}while(!0);tt===null&&(pe=lt),b.baseState=pe,b.firstBaseUpdate=ze,b.lastBaseUpdate=tt,x===null&&(b.shared.lanes=0),Er|=B,n.lanes=B,n.memoizedState=lt}}function db(n,s){if(typeof n!="function")throw Error(i(191,n));n.call(s)}function fb(n,s){var o=n.callbacks;if(o!==null)for(n.callbacks=null,n=0;n<o.length;n++)db(o[n],s)}var Zi=M(null),Yc=M(0);function mb(n,s){n=Zs,Y(Yc,n),Y(Zi,s),Zs=n|s.baseLanes}function sm(){Y(Yc,Zs),Y(Zi,Zi.current)}function rm(){Zs=Yc.current,q(Zi),q(Yc)}var $a=M(null),ts=null;function xr(n){var s=n.alternate;Y(Xn,Xn.current&1),Y($a,n),ts===null&&(s===null||Zi.current!==null||s.memoizedState!==null)&&(ts=n)}function im(n){Y(Xn,Xn.current),Y($a,n),ts===null&&(ts=n)}function hb(n){n.tag===22?(Y(Xn,Xn.current),Y($a,n),ts===null&&(ts=n)):Sr()}function Sr(){Y(Xn,Xn.current),Y($a,$a.current)}function Fa(n){q($a),ts===n&&(ts=null),q(Xn)}var Xn=M(0);function Gc(n){for(var s=n;s!==null;){if(s.tag===13){var o=s.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||fh(o)||mh(o)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Hs=0,nn=null,Rn=null,Qn=null,Xc=!1,Qi=!1,hi=!1,Kc=0,ao=0,Ji=null,u_=0;function Pn(){throw Error(i(321))}function lm(n,s){if(s===null)return!1;for(var o=0;o<s.length&&o<n.length;o++)if(!Oa(n[o],s[o]))return!1;return!0}function om(n,s,o,d,b,x){return Hs=x,nn=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,I.H=n===null||n.memoizedState===null?Zb:Nm,hi=!1,x=o(d,b),hi=!1,Qi&&(x=yb(s,o,d,b)),pb(n),x}function pb(n){I.H=io;var s=Rn!==null&&Rn.next!==null;if(Hs=0,Qn=Rn=nn=null,Xc=!1,ao=0,Ji=null,s)throw Error(i(300));n===null||Jn||(n=n.dependencies,n!==null&&Fc(n)&&(Jn=!0))}function yb(n,s,o,d){nn=n;var b=0;do{if(Qi&&(Ji=null),ao=0,Qi=!1,25<=b)throw Error(i(301));if(b+=1,Qn=Rn=null,n.updateQueue!=null){var x=n.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}I.H=Qb,x=s(o,d)}while(Qi);return x}function d_(){var n=I.H,s=n.useState()[0];return s=typeof s.then=="function"?so(s):s,n=n.useState()[0],(Rn!==null?Rn.memoizedState:null)!==n&&(nn.flags|=1024),s}function cm(){var n=Kc!==0;return Kc=0,n}function um(n,s,o){s.updateQueue=n.updateQueue,s.flags&=-2053,n.lanes&=~o}function dm(n){if(Xc){for(n=n.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}Xc=!1}Hs=0,Qn=Rn=nn=null,Qi=!1,ao=Kc=0,Ji=null}function xa(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qn===null?nn.memoizedState=Qn=n:Qn=Qn.next=n,Qn}function Kn(){if(Rn===null){var n=nn.alternate;n=n!==null?n.memoizedState:null}else n=Rn.next;var s=Qn===null?nn.memoizedState:Qn.next;if(s!==null)Qn=s,Rn=n;else{if(n===null)throw nn.alternate===null?Error(i(467)):Error(i(310));Rn=n,n={memoizedState:Rn.memoizedState,baseState:Rn.baseState,baseQueue:Rn.baseQueue,queue:Rn.queue,next:null},Qn===null?nn.memoizedState=Qn=n:Qn=Qn.next=n}return Qn}function Wc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function so(n){var s=ao;return ao+=1,Ji===null&&(Ji=[]),n=ib(Ji,n,s),s=nn,(Qn===null?s.memoizedState:Qn.next)===null&&(s=s.alternate,I.H=s===null||s.memoizedState===null?Zb:Nm),n}function Zc(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return so(n);if(n.$$typeof===O)return da(n)}throw Error(i(438,String(n)))}function fm(n){var s=null,o=nn.updateQueue;if(o!==null&&(s=o.memoCache),s==null){var d=nn.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(s={data:d.data.map(function(b){return b.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),o===null&&(o=Wc(),nn.updateQueue=o),o.memoCache=s,o=s.data[s.index],o===void 0)for(o=s.data[s.index]=Array(n),d=0;d<n;d++)o[d]=X;return s.index++,o}function Ps(n,s){return typeof s=="function"?s(n):s}function Qc(n){var s=Kn();return mm(s,Rn,n)}function mm(n,s,o){var d=n.queue;if(d===null)throw Error(i(311));d.lastRenderedReducer=o;var b=n.baseQueue,x=d.pending;if(x!==null){if(b!==null){var B=b.next;b.next=x.next,x.next=B}s.baseQueue=b=x,d.pending=null}if(x=n.baseState,b===null)n.memoizedState=x;else{s=b.next;var W=B=null,pe=null,ze=s,tt=!1;do{var lt=ze.lane&-536870913;if(lt!==ze.lane?(yn&lt)===lt:(Hs&lt)===lt){var Fe=ze.revertLane;if(Fe===0)pe!==null&&(pe=pe.next={lane:0,revertLane:0,gesture:null,action:ze.action,hasEagerState:ze.hasEagerState,eagerState:ze.eagerState,next:null}),lt===Gi&&(tt=!0);else if((Hs&Fe)===Fe){ze=ze.next,Fe===Gi&&(tt=!0);continue}else lt={lane:0,revertLane:ze.revertLane,gesture:null,action:ze.action,hasEagerState:ze.hasEagerState,eagerState:ze.eagerState,next:null},pe===null?(W=pe=lt,B=x):pe=pe.next=lt,nn.lanes|=Fe,Er|=Fe;lt=ze.action,hi&&o(x,lt),x=ze.hasEagerState?ze.eagerState:o(x,lt)}else Fe={lane:lt,revertLane:ze.revertLane,gesture:ze.gesture,action:ze.action,hasEagerState:ze.hasEagerState,eagerState:ze.eagerState,next:null},pe===null?(W=pe=Fe,B=x):pe=pe.next=Fe,nn.lanes|=lt,Er|=lt;ze=ze.next}while(ze!==null&&ze!==s);if(pe===null?B=x:pe.next=W,!Oa(x,n.memoizedState)&&(Jn=!0,tt&&(o=Xi,o!==null)))throw o;n.memoizedState=x,n.baseState=B,n.baseQueue=pe,d.lastRenderedState=x}return b===null&&(d.lanes=0),[n.memoizedState,d.dispatch]}function hm(n){var s=Kn(),o=s.queue;if(o===null)throw Error(i(311));o.lastRenderedReducer=n;var d=o.dispatch,b=o.pending,x=s.memoizedState;if(b!==null){o.pending=null;var B=b=b.next;do x=n(x,B.action),B=B.next;while(B!==b);Oa(x,s.memoizedState)||(Jn=!0),s.memoizedState=x,s.baseQueue===null&&(s.baseState=x),o.lastRenderedState=x}return[x,d]}function gb(n,s,o){var d=nn,b=Kn(),x=bn;if(x){if(o===void 0)throw Error(i(407));o=o()}else o=s();var B=!Oa((Rn||b).memoizedState,o);if(B&&(b.memoizedState=o,Jn=!0),b=b.queue,gm(xb.bind(null,d,b,n),[n]),b.getSnapshot!==s||B||Qn!==null&&Qn.memoizedState.tag&1){if(d.flags|=2048,el(9,{destroy:void 0},vb.bind(null,d,b,o,s),null),In===null)throw Error(i(349));x||(Hs&127)!==0||bb(d,s,o)}return o}function bb(n,s,o){n.flags|=16384,n={getSnapshot:s,value:o},s=nn.updateQueue,s===null?(s=Wc(),nn.updateQueue=s,s.stores=[n]):(o=s.stores,o===null?s.stores=[n]:o.push(n))}function vb(n,s,o,d){s.value=o,s.getSnapshot=d,Sb(s)&&wb(n)}function xb(n,s,o){return o(function(){Sb(s)&&wb(n)})}function Sb(n){var s=n.getSnapshot;n=n.value;try{var o=s();return!Oa(n,o)}catch{return!0}}function wb(n){var s=ri(n,2);s!==null&&Ta(s,n,2)}function pm(n){var s=xa();if(typeof n=="function"){var o=n;if(n=o(),hi){et(!0);try{o()}finally{et(!1)}}}return s.memoizedState=s.baseState=n,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ps,lastRenderedState:n},s}function Nb(n,s,o,d){return n.baseState=o,mm(n,Rn,typeof d=="function"?d:Ps)}function f_(n,s,o,d,b){if(tu(n))throw Error(i(485));if(n=s.action,n!==null){var x={payload:b,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(B){x.listeners.push(B)}};I.T!==null?o(!0):x.isTransition=!1,d(x),o=s.pending,o===null?(x.next=s.pending=x,Eb(s,x)):(x.next=o.next,s.pending=o.next=x)}}function Eb(n,s){var o=s.action,d=s.payload,b=n.state;if(s.isTransition){var x=I.T,B={};I.T=B;try{var W=o(b,d),pe=I.S;pe!==null&&pe(B,W),jb(n,s,W)}catch(ze){ym(n,s,ze)}finally{x!==null&&B.types!==null&&(x.types=B.types),I.T=x}}else try{x=o(b,d),jb(n,s,x)}catch(ze){ym(n,s,ze)}}function jb(n,s,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(d){_b(n,s,d)},function(d){return ym(n,s,d)}):_b(n,s,o)}function _b(n,s,o){s.status="fulfilled",s.value=o,Cb(s),n.state=o,s=n.pending,s!==null&&(o=s.next,o===s?n.pending=null:(o=o.next,s.next=o,Eb(n,o)))}function ym(n,s,o){var d=n.pending;if(n.pending=null,d!==null){d=d.next;do s.status="rejected",s.reason=o,Cb(s),s=s.next;while(s!==d)}n.action=null}function Cb(n){n=n.listeners;for(var s=0;s<n.length;s++)(0,n[s])()}function Ab(n,s){return s}function Tb(n,s){if(bn){var o=In.formState;if(o!==null){e:{var d=nn;if(bn){if(On){t:{for(var b=On,x=es;b.nodeType!==8;){if(!x){b=null;break t}if(b=ns(b.nextSibling),b===null){b=null;break t}}x=b.data,b=x==="F!"||x==="F"?b:null}if(b){On=ns(b.nextSibling),d=b.data==="F!";break e}}pr(d)}d=!1}d&&(s=o[0])}}return o=xa(),o.memoizedState=o.baseState=s,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ab,lastRenderedState:s},o.queue=d,o=Xb.bind(null,nn,d),d.dispatch=o,d=pm(!1),x=wm.bind(null,nn,!1,d.queue),d=xa(),b={state:s,dispatch:null,action:n,pending:null},d.queue=b,o=f_.bind(null,nn,b,x,o),b.dispatch=o,d.memoizedState=n,[s,o,!1]}function Mb(n){var s=Kn();return Rb(s,Rn,n)}function Rb(n,s,o){if(s=mm(n,s,Ab)[0],n=Qc(Ps)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var d=so(s)}catch(B){throw B===Ki?qc:B}else d=s;s=Kn();var b=s.queue,x=b.dispatch;return o!==s.memoizedState&&(nn.flags|=2048,el(9,{destroy:void 0},m_.bind(null,b,o),null)),[d,x,n]}function m_(n,s){n.action=s}function kb(n){var s=Kn(),o=Rn;if(o!==null)return Rb(s,o,n);Kn(),s=s.memoizedState,o=Kn();var d=o.queue.dispatch;return o.memoizedState=n,[s,d,!1]}function el(n,s,o,d){return n={tag:n,create:o,deps:d,inst:s,next:null},s=nn.updateQueue,s===null&&(s=Wc(),nn.updateQueue=s),o=s.lastEffect,o===null?s.lastEffect=n.next=n:(d=o.next,o.next=n,n.next=d,s.lastEffect=n),n}function Db(){return Kn().memoizedState}function Jc(n,s,o,d){var b=xa();nn.flags|=n,b.memoizedState=el(1|s,{destroy:void 0},o,d===void 0?null:d)}function eu(n,s,o,d){var b=Kn();d=d===void 0?null:d;var x=b.memoizedState.inst;Rn!==null&&d!==null&&lm(d,Rn.memoizedState.deps)?b.memoizedState=el(s,x,o,d):(nn.flags|=n,b.memoizedState=el(1|s,x,o,d))}function Ib(n,s){Jc(8390656,8,n,s)}function gm(n,s){eu(2048,8,n,s)}function h_(n){nn.flags|=4;var s=nn.updateQueue;if(s===null)s=Wc(),nn.updateQueue=s,s.events=[n];else{var o=s.events;o===null?s.events=[n]:o.push(n)}}function Lb(n){var s=Kn().memoizedState;return h_({ref:s,nextImpl:n}),function(){if((_n&2)!==0)throw Error(i(440));return s.impl.apply(void 0,arguments)}}function Ob(n,s){return eu(4,2,n,s)}function zb(n,s){return eu(4,4,n,s)}function $b(n,s){if(typeof s=="function"){n=n();var o=s(n);return function(){typeof o=="function"?o():s(null)}}if(s!=null)return n=n(),s.current=n,function(){s.current=null}}function Fb(n,s,o){o=o!=null?o.concat([n]):null,eu(4,4,$b.bind(null,s,n),o)}function bm(){}function Bb(n,s){var o=Kn();s=s===void 0?null:s;var d=o.memoizedState;return s!==null&&lm(s,d[1])?d[0]:(o.memoizedState=[n,s],n)}function Ub(n,s){var o=Kn();s=s===void 0?null:s;var d=o.memoizedState;if(s!==null&&lm(s,d[1]))return d[0];if(d=n(),hi){et(!0);try{n()}finally{et(!1)}}return o.memoizedState=[d,s],d}function vm(n,s,o){return o===void 0||(Hs&1073741824)!==0&&(yn&261930)===0?n.memoizedState=s:(n.memoizedState=o,n=qv(),nn.lanes|=n,Er|=n,o)}function qb(n,s,o,d){return Oa(o,s)?o:Zi.current!==null?(n=vm(n,o,d),Oa(n,s)||(Jn=!0),n):(Hs&42)===0||(Hs&1073741824)!==0&&(yn&261930)===0?(Jn=!0,n.memoizedState=o):(n=qv(),nn.lanes|=n,Er|=n,s)}function Hb(n,s,o,d,b){var x=L.p;L.p=x!==0&&8>x?x:8;var B=I.T,W={};I.T=W,wm(n,!1,s,o);try{var pe=b(),ze=I.S;if(ze!==null&&ze(W,pe),pe!==null&&typeof pe=="object"&&typeof pe.then=="function"){var tt=c_(pe,d);ro(n,s,tt,qa(n))}else ro(n,s,d,qa(n))}catch(lt){ro(n,s,{then:function(){},status:"rejected",reason:lt},qa())}finally{L.p=x,B!==null&&W.types!==null&&(B.types=W.types),I.T=B}}function p_(){}function xm(n,s,o,d){if(n.tag!==5)throw Error(i(476));var b=Pb(n).queue;Hb(n,b,s,$,o===null?p_:function(){return Vb(n),o(d)})}function Pb(n){var s=n.memoizedState;if(s!==null)return s;s={memoizedState:$,baseState:$,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ps,lastRenderedState:$},next:null};var o={};return s.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ps,lastRenderedState:o},next:null},n.memoizedState=s,n=n.alternate,n!==null&&(n.memoizedState=s),s}function Vb(n){var s=Pb(n);s.next===null&&(s=n.alternate.memoizedState),ro(n,s.next.queue,{},qa())}function Sm(){return da(No)}function Yb(){return Kn().memoizedState}function Gb(){return Kn().memoizedState}function y_(n){for(var s=n.return;s!==null;){switch(s.tag){case 24:case 3:var o=qa();n=br(o);var d=vr(s,n,o);d!==null&&(Ta(d,s,o),eo(d,s,o)),s={cache:Wf()},n.payload=s;return}s=s.return}}function g_(n,s,o){var d=qa();o={lane:d,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},tu(n)?Kb(s,o):(o=Ff(n,s,o,d),o!==null&&(Ta(o,n,d),Wb(o,s,d)))}function Xb(n,s,o){var d=qa();ro(n,s,o,d)}function ro(n,s,o,d){var b={lane:d,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null};if(tu(n))Kb(s,b);else{var x=n.alternate;if(n.lanes===0&&(x===null||x.lanes===0)&&(x=s.lastRenderedReducer,x!==null))try{var B=s.lastRenderedState,W=x(B,o);if(b.hasEagerState=!0,b.eagerState=W,Oa(W,B))return Lc(n,s,b,0),In===null&&Ic(),!1}catch{}finally{}if(o=Ff(n,s,b,d),o!==null)return Ta(o,n,d),Wb(o,s,d),!0}return!1}function wm(n,s,o,d){if(d={lane:2,revertLane:eh(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},tu(n)){if(s)throw Error(i(479))}else s=Ff(n,o,d,2),s!==null&&Ta(s,n,2)}function tu(n){var s=n.alternate;return n===nn||s!==null&&s===nn}function Kb(n,s){Qi=Xc=!0;var o=n.pending;o===null?s.next=s:(s.next=o.next,o.next=s),n.pending=s}function Wb(n,s,o){if((o&4194048)!==0){var d=s.lanes;d&=n.pendingLanes,o|=d,s.lanes=o,Be(n,o)}}var io={readContext:da,use:Zc,useCallback:Pn,useContext:Pn,useEffect:Pn,useImperativeHandle:Pn,useLayoutEffect:Pn,useInsertionEffect:Pn,useMemo:Pn,useReducer:Pn,useRef:Pn,useState:Pn,useDebugValue:Pn,useDeferredValue:Pn,useTransition:Pn,useSyncExternalStore:Pn,useId:Pn,useHostTransitionStatus:Pn,useFormState:Pn,useActionState:Pn,useOptimistic:Pn,useMemoCache:Pn,useCacheRefresh:Pn};io.useEffectEvent=Pn;var Zb={readContext:da,use:Zc,useCallback:function(n,s){return xa().memoizedState=[n,s===void 0?null:s],n},useContext:da,useEffect:Ib,useImperativeHandle:function(n,s,o){o=o!=null?o.concat([n]):null,Jc(4194308,4,$b.bind(null,s,n),o)},useLayoutEffect:function(n,s){return Jc(4194308,4,n,s)},useInsertionEffect:function(n,s){Jc(4,2,n,s)},useMemo:function(n,s){var o=xa();s=s===void 0?null:s;var d=n();if(hi){et(!0);try{n()}finally{et(!1)}}return o.memoizedState=[d,s],d},useReducer:function(n,s,o){var d=xa();if(o!==void 0){var b=o(s);if(hi){et(!0);try{o(s)}finally{et(!1)}}}else b=s;return d.memoizedState=d.baseState=b,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:b},d.queue=n,n=n.dispatch=g_.bind(null,nn,n),[d.memoizedState,n]},useRef:function(n){var s=xa();return n={current:n},s.memoizedState=n},useState:function(n){n=pm(n);var s=n.queue,o=Xb.bind(null,nn,s);return s.dispatch=o,[n.memoizedState,o]},useDebugValue:bm,useDeferredValue:function(n,s){var o=xa();return vm(o,n,s)},useTransition:function(){var n=pm(!1);return n=Hb.bind(null,nn,n.queue,!0,!1),xa().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,s,o){var d=nn,b=xa();if(bn){if(o===void 0)throw Error(i(407));o=o()}else{if(o=s(),In===null)throw Error(i(349));(yn&127)!==0||bb(d,s,o)}b.memoizedState=o;var x={value:o,getSnapshot:s};return b.queue=x,Ib(xb.bind(null,d,x,n),[n]),d.flags|=2048,el(9,{destroy:void 0},vb.bind(null,d,x,o,s),null),o},useId:function(){var n=xa(),s=In.identifierPrefix;if(bn){var o=js,d=Es;o=(d&~(1<<32-Te(d)-1)).toString(32)+o,s="_"+s+"R_"+o,o=Kc++,0<o&&(s+="H"+o.toString(32)),s+="_"}else o=u_++,s="_"+s+"r_"+o.toString(32)+"_";return n.memoizedState=s},useHostTransitionStatus:Sm,useFormState:Tb,useActionState:Tb,useOptimistic:function(n){var s=xa();s.memoizedState=s.baseState=n;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=o,s=wm.bind(null,nn,!0,o),o.dispatch=s,[n,s]},useMemoCache:fm,useCacheRefresh:function(){return xa().memoizedState=y_.bind(null,nn)},useEffectEvent:function(n){var s=xa(),o={impl:n};return s.memoizedState=o,function(){if((_n&2)!==0)throw Error(i(440));return o.impl.apply(void 0,arguments)}}},Nm={readContext:da,use:Zc,useCallback:Bb,useContext:da,useEffect:gm,useImperativeHandle:Fb,useInsertionEffect:Ob,useLayoutEffect:zb,useMemo:Ub,useReducer:Qc,useRef:Db,useState:function(){return Qc(Ps)},useDebugValue:bm,useDeferredValue:function(n,s){var o=Kn();return qb(o,Rn.memoizedState,n,s)},useTransition:function(){var n=Qc(Ps)[0],s=Kn().memoizedState;return[typeof n=="boolean"?n:so(n),s]},useSyncExternalStore:gb,useId:Yb,useHostTransitionStatus:Sm,useFormState:Mb,useActionState:Mb,useOptimistic:function(n,s){var o=Kn();return Nb(o,Rn,n,s)},useMemoCache:fm,useCacheRefresh:Gb};Nm.useEffectEvent=Lb;var Qb={readContext:da,use:Zc,useCallback:Bb,useContext:da,useEffect:gm,useImperativeHandle:Fb,useInsertionEffect:Ob,useLayoutEffect:zb,useMemo:Ub,useReducer:hm,useRef:Db,useState:function(){return hm(Ps)},useDebugValue:bm,useDeferredValue:function(n,s){var o=Kn();return Rn===null?vm(o,n,s):qb(o,Rn.memoizedState,n,s)},useTransition:function(){var n=hm(Ps)[0],s=Kn().memoizedState;return[typeof n=="boolean"?n:so(n),s]},useSyncExternalStore:gb,useId:Yb,useHostTransitionStatus:Sm,useFormState:kb,useActionState:kb,useOptimistic:function(n,s){var o=Kn();return Rn!==null?Nb(o,Rn,n,s):(o.baseState=n,[n,o.queue.dispatch])},useMemoCache:fm,useCacheRefresh:Gb};Qb.useEffectEvent=Lb;function Em(n,s,o,d){s=n.memoizedState,o=o(d,s),o=o==null?s:g({},s,o),n.memoizedState=o,n.lanes===0&&(n.updateQueue.baseState=o)}var jm={enqueueSetState:function(n,s,o){n=n._reactInternals;var d=qa(),b=br(d);b.payload=s,o!=null&&(b.callback=o),s=vr(n,b,d),s!==null&&(Ta(s,n,d),eo(s,n,d))},enqueueReplaceState:function(n,s,o){n=n._reactInternals;var d=qa(),b=br(d);b.tag=1,b.payload=s,o!=null&&(b.callback=o),s=vr(n,b,d),s!==null&&(Ta(s,n,d),eo(s,n,d))},enqueueForceUpdate:function(n,s){n=n._reactInternals;var o=qa(),d=br(o);d.tag=2,s!=null&&(d.callback=s),s=vr(n,d,o),s!==null&&(Ta(s,n,o),eo(s,n,o))}};function Jb(n,s,o,d,b,x,B){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(d,x,B):s.prototype&&s.prototype.isPureReactComponent?!Yl(o,d)||!Yl(b,x):!0}function ev(n,s,o,d){n=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(o,d),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(o,d),s.state!==n&&jm.enqueueReplaceState(s,s.state,null)}function pi(n,s){var o=s;if("ref"in s){o={};for(var d in s)d!=="ref"&&(o[d]=s[d])}if(n=n.defaultProps){o===s&&(o=g({},o));for(var b in n)o[b]===void 0&&(o[b]=n[b])}return o}function tv(n){Dc(n)}function nv(n){console.error(n)}function av(n){Dc(n)}function nu(n,s){try{var o=n.onUncaughtError;o(s.value,{componentStack:s.stack})}catch(d){setTimeout(function(){throw d})}}function sv(n,s,o){try{var d=n.onCaughtError;d(o.value,{componentStack:o.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function _m(n,s,o){return o=br(o),o.tag=3,o.payload={element:null},o.callback=function(){nu(n,s)},o}function rv(n){return n=br(n),n.tag=3,n}function iv(n,s,o,d){var b=o.type.getDerivedStateFromError;if(typeof b=="function"){var x=d.value;n.payload=function(){return b(x)},n.callback=function(){sv(s,o,d)}}var B=o.stateNode;B!==null&&typeof B.componentDidCatch=="function"&&(n.callback=function(){sv(s,o,d),typeof b!="function"&&(jr===null?jr=new Set([this]):jr.add(this));var W=d.stack;this.componentDidCatch(d.value,{componentStack:W!==null?W:""})})}function b_(n,s,o,d,b){if(o.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(s=o.alternate,s!==null&&Yi(s,o,b,!0),o=$a.current,o!==null){switch(o.tag){case 31:case 13:return ts===null?hu():o.alternate===null&&Vn===0&&(Vn=3),o.flags&=-257,o.flags|=65536,o.lanes=b,d===Hc?o.flags|=16384:(s=o.updateQueue,s===null?o.updateQueue=new Set([d]):s.add(d),Zm(n,d,b)),!1;case 22:return o.flags|=65536,d===Hc?o.flags|=16384:(s=o.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([d])},o.updateQueue=s):(o=s.retryQueue,o===null?s.retryQueue=new Set([d]):o.add(d)),Zm(n,d,b)),!1}throw Error(i(435,o.tag))}return Zm(n,d,b),hu(),!1}if(bn)return s=$a.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=b,d!==Vf&&(n=Error(i(422),{cause:d}),Kl(Za(n,o)))):(d!==Vf&&(s=Error(i(423),{cause:d}),Kl(Za(s,o))),n=n.current.alternate,n.flags|=65536,b&=-b,n.lanes|=b,d=Za(d,o),b=_m(n.stateNode,d,b),nm(n,b),Vn!==4&&(Vn=2)),!1;var x=Error(i(520),{cause:d});if(x=Za(x,o),po===null?po=[x]:po.push(x),Vn!==4&&(Vn=2),s===null)return!0;d=Za(d,o),o=s;do{switch(o.tag){case 3:return o.flags|=65536,n=b&-b,o.lanes|=n,n=_m(o.stateNode,d,n),nm(o,n),!1;case 1:if(s=o.type,x=o.stateNode,(o.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(jr===null||!jr.has(x))))return o.flags|=65536,b&=-b,o.lanes|=b,b=rv(b),iv(b,n,o,d),nm(o,b),!1}o=o.return}while(o!==null);return!1}var Cm=Error(i(461)),Jn=!1;function fa(n,s,o,d){s.child=n===null?ub(s,null,o,d):mi(s,n.child,o,d)}function lv(n,s,o,d,b){o=o.render;var x=s.ref;if("ref"in d){var B={};for(var W in d)W!=="ref"&&(B[W]=d[W])}else B=d;return ci(s),d=om(n,s,o,B,x,b),W=cm(),n!==null&&!Jn?(um(n,s,b),Vs(n,s,b)):(bn&&W&&Hf(s),s.flags|=1,fa(n,s,d,b),s.child)}function ov(n,s,o,d,b){if(n===null){var x=o.type;return typeof x=="function"&&!Bf(x)&&x.defaultProps===void 0&&o.compare===null?(s.tag=15,s.type=x,cv(n,s,x,d,b)):(n=zc(o.type,null,d,s,s.mode,b),n.ref=s.ref,n.return=s,s.child=n)}if(x=n.child,!Lm(n,b)){var B=x.memoizedProps;if(o=o.compare,o=o!==null?o:Yl,o(B,d)&&n.ref===s.ref)return Vs(n,s,b)}return s.flags|=1,n=Fs(x,d),n.ref=s.ref,n.return=s,s.child=n}function cv(n,s,o,d,b){if(n!==null){var x=n.memoizedProps;if(Yl(x,d)&&n.ref===s.ref)if(Jn=!1,s.pendingProps=d=x,Lm(n,b))(n.flags&131072)!==0&&(Jn=!0);else return s.lanes=n.lanes,Vs(n,s,b)}return Am(n,s,o,d,b)}function uv(n,s,o,d){var b=d.children,x=n!==null?n.memoizedState:null;if(n===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((s.flags&128)!==0){if(x=x!==null?x.baseLanes|o:o,n!==null){for(d=s.child=n.child,b=0;d!==null;)b=b|d.lanes|d.childLanes,d=d.sibling;d=b&~x}else d=0,s.child=null;return dv(n,s,x,o,d)}if((o&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},n!==null&&Uc(s,x!==null?x.cachePool:null),x!==null?mb(s,x):sm(),hb(s);else return d=s.lanes=536870912,dv(n,s,x!==null?x.baseLanes|o:o,o,d)}else x!==null?(Uc(s,x.cachePool),mb(s,x),Sr(),s.memoizedState=null):(n!==null&&Uc(s,null),sm(),Sr());return fa(n,s,b,o),s.child}function lo(n,s){return n!==null&&n.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function dv(n,s,o,d,b){var x=Qf();return x=x===null?null:{parent:Zn._currentValue,pool:x},s.memoizedState={baseLanes:o,cachePool:x},n!==null&&Uc(s,null),sm(),hb(s),n!==null&&Yi(n,s,d,!0),s.childLanes=b,null}function au(n,s){return s=ru({mode:s.mode,children:s.children},n.mode),s.ref=n.ref,n.child=s,s.return=n,s}function fv(n,s,o){return mi(s,n.child,null,o),n=au(s,s.pendingProps),n.flags|=2,Fa(s),s.memoizedState=null,n}function v_(n,s,o){var d=s.pendingProps,b=(s.flags&128)!==0;if(s.flags&=-129,n===null){if(bn){if(d.mode==="hidden")return n=au(s,d),s.lanes=536870912,lo(null,n);if(im(s),(n=On)?(n=Ex(n,es),n=n!==null&&n.data==="&"?n:null,n!==null&&(s.memoizedState={dehydrated:n,treeContext:mr!==null?{id:Es,overflow:js}:null,retryLane:536870912,hydrationErrors:null},o=Kg(n),o.return=s,s.child=o,ua=s,On=null)):n=null,n===null)throw pr(s);return s.lanes=536870912,null}return au(s,d)}var x=n.memoizedState;if(x!==null){var B=x.dehydrated;if(im(s),b)if(s.flags&256)s.flags&=-257,s=fv(n,s,o);else if(s.memoizedState!==null)s.child=n.child,s.flags|=128,s=null;else throw Error(i(558));else if(Jn||Yi(n,s,o,!1),b=(o&n.childLanes)!==0,Jn||b){if(d=In,d!==null&&(B=ot(d,o),B!==0&&B!==x.retryLane))throw x.retryLane=B,ri(n,B),Ta(d,n,B),Cm;hu(),s=fv(n,s,o)}else n=x.treeContext,On=ns(B.nextSibling),ua=s,bn=!0,hr=null,es=!1,n!==null&&Qg(s,n),s=au(s,d),s.flags|=4096;return s}return n=Fs(n.child,{mode:d.mode,children:d.children}),n.ref=s.ref,s.child=n,n.return=s,n}function su(n,s){var o=s.ref;if(o===null)n!==null&&n.ref!==null&&(s.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(i(284));(n===null||n.ref!==o)&&(s.flags|=4194816)}}function Am(n,s,o,d,b){return ci(s),o=om(n,s,o,d,void 0,b),d=cm(),n!==null&&!Jn?(um(n,s,b),Vs(n,s,b)):(bn&&d&&Hf(s),s.flags|=1,fa(n,s,o,b),s.child)}function mv(n,s,o,d,b,x){return ci(s),s.updateQueue=null,o=yb(s,d,o,b),pb(n),d=cm(),n!==null&&!Jn?(um(n,s,x),Vs(n,s,x)):(bn&&d&&Hf(s),s.flags|=1,fa(n,s,o,x),s.child)}function hv(n,s,o,d,b){if(ci(s),s.stateNode===null){var x=qi,B=o.contextType;typeof B=="object"&&B!==null&&(x=da(B)),x=new o(d,x),s.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=jm,s.stateNode=x,x._reactInternals=s,x=s.stateNode,x.props=d,x.state=s.memoizedState,x.refs={},em(s),B=o.contextType,x.context=typeof B=="object"&&B!==null?da(B):qi,x.state=s.memoizedState,B=o.getDerivedStateFromProps,typeof B=="function"&&(Em(s,o,B,d),x.state=s.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(B=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),B!==x.state&&jm.enqueueReplaceState(x,x.state,null),no(s,d,x,b),to(),x.state=s.memoizedState),typeof x.componentDidMount=="function"&&(s.flags|=4194308),d=!0}else if(n===null){x=s.stateNode;var W=s.memoizedProps,pe=pi(o,W);x.props=pe;var ze=x.context,tt=o.contextType;B=qi,typeof tt=="object"&&tt!==null&&(B=da(tt));var lt=o.getDerivedStateFromProps;tt=typeof lt=="function"||typeof x.getSnapshotBeforeUpdate=="function",W=s.pendingProps!==W,tt||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(W||ze!==B)&&ev(s,x,d,B),gr=!1;var Fe=s.memoizedState;x.state=Fe,no(s,d,x,b),to(),ze=s.memoizedState,W||Fe!==ze||gr?(typeof lt=="function"&&(Em(s,o,lt,d),ze=s.memoizedState),(pe=gr||Jb(s,o,pe,d,Fe,ze,B))?(tt||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(s.flags|=4194308)):(typeof x.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=d,s.memoizedState=ze),x.props=d,x.state=ze,x.context=B,d=pe):(typeof x.componentDidMount=="function"&&(s.flags|=4194308),d=!1)}else{x=s.stateNode,tm(n,s),B=s.memoizedProps,tt=pi(o,B),x.props=tt,lt=s.pendingProps,Fe=x.context,ze=o.contextType,pe=qi,typeof ze=="object"&&ze!==null&&(pe=da(ze)),W=o.getDerivedStateFromProps,(ze=typeof W=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(B!==lt||Fe!==pe)&&ev(s,x,d,pe),gr=!1,Fe=s.memoizedState,x.state=Fe,no(s,d,x,b),to();var Ye=s.memoizedState;B!==lt||Fe!==Ye||gr||n!==null&&n.dependencies!==null&&Fc(n.dependencies)?(typeof W=="function"&&(Em(s,o,W,d),Ye=s.memoizedState),(tt=gr||Jb(s,o,tt,d,Fe,Ye,pe)||n!==null&&n.dependencies!==null&&Fc(n.dependencies))?(ze||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(d,Ye,pe),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(d,Ye,pe)),typeof x.componentDidUpdate=="function"&&(s.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof x.componentDidUpdate!="function"||B===n.memoizedProps&&Fe===n.memoizedState||(s.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||B===n.memoizedProps&&Fe===n.memoizedState||(s.flags|=1024),s.memoizedProps=d,s.memoizedState=Ye),x.props=d,x.state=Ye,x.context=pe,d=tt):(typeof x.componentDidUpdate!="function"||B===n.memoizedProps&&Fe===n.memoizedState||(s.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||B===n.memoizedProps&&Fe===n.memoizedState||(s.flags|=1024),d=!1)}return x=d,su(n,s),d=(s.flags&128)!==0,x||d?(x=s.stateNode,o=d&&typeof o.getDerivedStateFromError!="function"?null:x.render(),s.flags|=1,n!==null&&d?(s.child=mi(s,n.child,null,b),s.child=mi(s,null,o,b)):fa(n,s,o,b),s.memoizedState=x.state,n=s.child):n=Vs(n,s,b),n}function pv(n,s,o,d){return li(),s.flags|=256,fa(n,s,o,d),s.child}var Tm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Mm(n){return{baseLanes:n,cachePool:sb()}}function Rm(n,s,o){return n=n!==null?n.childLanes&~o:0,s&&(n|=Ua),n}function yv(n,s,o){var d=s.pendingProps,b=!1,x=(s.flags&128)!==0,B;if((B=x)||(B=n!==null&&n.memoizedState===null?!1:(Xn.current&2)!==0),B&&(b=!0,s.flags&=-129),B=(s.flags&32)!==0,s.flags&=-33,n===null){if(bn){if(b?xr(s):Sr(),(n=On)?(n=Ex(n,es),n=n!==null&&n.data!=="&"?n:null,n!==null&&(s.memoizedState={dehydrated:n,treeContext:mr!==null?{id:Es,overflow:js}:null,retryLane:536870912,hydrationErrors:null},o=Kg(n),o.return=s,s.child=o,ua=s,On=null)):n=null,n===null)throw pr(s);return mh(n)?s.lanes=32:s.lanes=536870912,null}var W=d.children;return d=d.fallback,b?(Sr(),b=s.mode,W=ru({mode:"hidden",children:W},b),d=ii(d,b,o,null),W.return=s,d.return=s,W.sibling=d,s.child=W,d=s.child,d.memoizedState=Mm(o),d.childLanes=Rm(n,B,o),s.memoizedState=Tm,lo(null,d)):(xr(s),km(s,W))}var pe=n.memoizedState;if(pe!==null&&(W=pe.dehydrated,W!==null)){if(x)s.flags&256?(xr(s),s.flags&=-257,s=Dm(n,s,o)):s.memoizedState!==null?(Sr(),s.child=n.child,s.flags|=128,s=null):(Sr(),W=d.fallback,b=s.mode,d=ru({mode:"visible",children:d.children},b),W=ii(W,b,o,null),W.flags|=2,d.return=s,W.return=s,d.sibling=W,s.child=d,mi(s,n.child,null,o),d=s.child,d.memoizedState=Mm(o),d.childLanes=Rm(n,B,o),s.memoizedState=Tm,s=lo(null,d));else if(xr(s),mh(W)){if(B=W.nextSibling&&W.nextSibling.dataset,B)var ze=B.dgst;B=ze,d=Error(i(419)),d.stack="",d.digest=B,Kl({value:d,source:null,stack:null}),s=Dm(n,s,o)}else if(Jn||Yi(n,s,o,!1),B=(o&n.childLanes)!==0,Jn||B){if(B=In,B!==null&&(d=ot(B,o),d!==0&&d!==pe.retryLane))throw pe.retryLane=d,ri(n,d),Ta(B,n,d),Cm;fh(W)||hu(),s=Dm(n,s,o)}else fh(W)?(s.flags|=192,s.child=n.child,s=null):(n=pe.treeContext,On=ns(W.nextSibling),ua=s,bn=!0,hr=null,es=!1,n!==null&&Qg(s,n),s=km(s,d.children),s.flags|=4096);return s}return b?(Sr(),W=d.fallback,b=s.mode,pe=n.child,ze=pe.sibling,d=Fs(pe,{mode:"hidden",children:d.children}),d.subtreeFlags=pe.subtreeFlags&65011712,ze!==null?W=Fs(ze,W):(W=ii(W,b,o,null),W.flags|=2),W.return=s,d.return=s,d.sibling=W,s.child=d,lo(null,d),d=s.child,W=n.child.memoizedState,W===null?W=Mm(o):(b=W.cachePool,b!==null?(pe=Zn._currentValue,b=b.parent!==pe?{parent:pe,pool:pe}:b):b=sb(),W={baseLanes:W.baseLanes|o,cachePool:b}),d.memoizedState=W,d.childLanes=Rm(n,B,o),s.memoizedState=Tm,lo(n.child,d)):(xr(s),o=n.child,n=o.sibling,o=Fs(o,{mode:"visible",children:d.children}),o.return=s,o.sibling=null,n!==null&&(B=s.deletions,B===null?(s.deletions=[n],s.flags|=16):B.push(n)),s.child=o,s.memoizedState=null,o)}function km(n,s){return s=ru({mode:"visible",children:s},n.mode),s.return=n,n.child=s}function ru(n,s){return n=za(22,n,null,s),n.lanes=0,n}function Dm(n,s,o){return mi(s,n.child,null,o),n=km(s,s.pendingProps.children),n.flags|=2,s.memoizedState=null,n}function gv(n,s,o){n.lanes|=s;var d=n.alternate;d!==null&&(d.lanes|=s),Xf(n.return,s,o)}function Im(n,s,o,d,b,x){var B=n.memoizedState;B===null?n.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:d,tail:o,tailMode:b,treeForkCount:x}:(B.isBackwards=s,B.rendering=null,B.renderingStartTime=0,B.last=d,B.tail=o,B.tailMode=b,B.treeForkCount=x)}function bv(n,s,o){var d=s.pendingProps,b=d.revealOrder,x=d.tail;d=d.children;var B=Xn.current,W=(B&2)!==0;if(W?(B=B&1|2,s.flags|=128):B&=1,Y(Xn,B),fa(n,s,d,o),d=bn?Xl:0,!W&&n!==null&&(n.flags&128)!==0)e:for(n=s.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&gv(n,o,s);else if(n.tag===19)gv(n,o,s);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break e;for(;n.sibling===null;){if(n.return===null||n.return===s)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}switch(b){case"forwards":for(o=s.child,b=null;o!==null;)n=o.alternate,n!==null&&Gc(n)===null&&(b=o),o=o.sibling;o=b,o===null?(b=s.child,s.child=null):(b=o.sibling,o.sibling=null),Im(s,!1,b,o,x,d);break;case"backwards":case"unstable_legacy-backwards":for(o=null,b=s.child,s.child=null;b!==null;){if(n=b.alternate,n!==null&&Gc(n)===null){s.child=b;break}n=b.sibling,b.sibling=o,o=b,b=n}Im(s,!0,o,null,x,d);break;case"together":Im(s,!1,null,null,void 0,d);break;default:s.memoizedState=null}return s.child}function Vs(n,s,o){if(n!==null&&(s.dependencies=n.dependencies),Er|=s.lanes,(o&s.childLanes)===0)if(n!==null){if(Yi(n,s,o,!1),(o&s.childLanes)===0)return null}else return null;if(n!==null&&s.child!==n.child)throw Error(i(153));if(s.child!==null){for(n=s.child,o=Fs(n,n.pendingProps),s.child=o,o.return=s;n.sibling!==null;)n=n.sibling,o=o.sibling=Fs(n,n.pendingProps),o.return=s;o.sibling=null}return s.child}function Lm(n,s){return(n.lanes&s)!==0?!0:(n=n.dependencies,!!(n!==null&&Fc(n)))}function x_(n,s,o){switch(s.tag){case 3:Q(s,s.stateNode.containerInfo),yr(s,Zn,n.memoizedState.cache),li();break;case 27:case 5:ne(s);break;case 4:Q(s,s.stateNode.containerInfo);break;case 10:yr(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,im(s),null;break;case 13:var d=s.memoizedState;if(d!==null)return d.dehydrated!==null?(xr(s),s.flags|=128,null):(o&s.child.childLanes)!==0?yv(n,s,o):(xr(s),n=Vs(n,s,o),n!==null?n.sibling:null);xr(s);break;case 19:var b=(n.flags&128)!==0;if(d=(o&s.childLanes)!==0,d||(Yi(n,s,o,!1),d=(o&s.childLanes)!==0),b){if(d)return bv(n,s,o);s.flags|=128}if(b=s.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),Y(Xn,Xn.current),d)break;return null;case 22:return s.lanes=0,uv(n,s,o,s.pendingProps);case 24:yr(s,Zn,n.memoizedState.cache)}return Vs(n,s,o)}function vv(n,s,o){if(n!==null)if(n.memoizedProps!==s.pendingProps)Jn=!0;else{if(!Lm(n,o)&&(s.flags&128)===0)return Jn=!1,x_(n,s,o);Jn=(n.flags&131072)!==0}else Jn=!1,bn&&(s.flags&1048576)!==0&&Zg(s,Xl,s.index);switch(s.lanes=0,s.tag){case 16:e:{var d=s.pendingProps;if(n=di(s.elementType),s.type=n,typeof n=="function")Bf(n)?(d=pi(n,d),s.tag=1,s=hv(null,s,n,d,o)):(s.tag=0,s=Am(null,s,n,d,o));else{if(n!=null){var b=n.$$typeof;if(b===_){s.tag=11,s=lv(null,s,n,d,o);break e}else if(b===j){s.tag=14,s=ov(null,s,n,d,o);break e}}throw s=k(n)||n,Error(i(306,s,""))}}return s;case 0:return Am(n,s,s.type,s.pendingProps,o);case 1:return d=s.type,b=pi(d,s.pendingProps),hv(n,s,d,b,o);case 3:e:{if(Q(s,s.stateNode.containerInfo),n===null)throw Error(i(387));d=s.pendingProps;var x=s.memoizedState;b=x.element,tm(n,s),no(s,d,null,o);var B=s.memoizedState;if(d=B.cache,yr(s,Zn,d),d!==x.cache&&Kf(s,[Zn],o,!0),to(),d=B.element,x.isDehydrated)if(x={element:d,isDehydrated:!1,cache:B.cache},s.updateQueue.baseState=x,s.memoizedState=x,s.flags&256){s=pv(n,s,d,o);break e}else if(d!==b){b=Za(Error(i(424)),s),Kl(b),s=pv(n,s,d,o);break e}else{switch(n=s.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(On=ns(n.firstChild),ua=s,bn=!0,hr=null,es=!0,o=ub(s,null,d,o),s.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling}else{if(li(),d===b){s=Vs(n,s,o);break e}fa(n,s,d,o)}s=s.child}return s;case 26:return su(n,s),n===null?(o=Mx(s.type,null,s.pendingProps,null))?s.memoizedState=o:bn||(o=s.type,n=s.pendingProps,d=Su(Z.current).createElement(o),d[dt]=s,d[Ee]=n,ma(d,o,n),ke(d),s.stateNode=d):s.memoizedState=Mx(s.type,n.memoizedProps,s.pendingProps,n.memoizedState),null;case 27:return ne(s),n===null&&bn&&(d=s.stateNode=Cx(s.type,s.pendingProps,Z.current),ua=s,es=!0,b=On,Tr(s.type)?(hh=b,On=ns(d.firstChild)):On=b),fa(n,s,s.pendingProps.children,o),su(n,s),n===null&&(s.flags|=4194304),s.child;case 5:return n===null&&bn&&((b=d=On)&&(d=W_(d,s.type,s.pendingProps,es),d!==null?(s.stateNode=d,ua=s,On=ns(d.firstChild),es=!1,b=!0):b=!1),b||pr(s)),ne(s),b=s.type,x=s.pendingProps,B=n!==null?n.memoizedProps:null,d=x.children,ch(b,x)?d=null:B!==null&&ch(b,B)&&(s.flags|=32),s.memoizedState!==null&&(b=om(n,s,d_,null,null,o),No._currentValue=b),su(n,s),fa(n,s,d,o),s.child;case 6:return n===null&&bn&&((n=o=On)&&(o=Z_(o,s.pendingProps,es),o!==null?(s.stateNode=o,ua=s,On=null,n=!0):n=!1),n||pr(s)),null;case 13:return yv(n,s,o);case 4:return Q(s,s.stateNode.containerInfo),d=s.pendingProps,n===null?s.child=mi(s,null,d,o):fa(n,s,d,o),s.child;case 11:return lv(n,s,s.type,s.pendingProps,o);case 7:return fa(n,s,s.pendingProps,o),s.child;case 8:return fa(n,s,s.pendingProps.children,o),s.child;case 12:return fa(n,s,s.pendingProps.children,o),s.child;case 10:return d=s.pendingProps,yr(s,s.type,d.value),fa(n,s,d.children,o),s.child;case 9:return b=s.type._context,d=s.pendingProps.children,ci(s),b=da(b),d=d(b),s.flags|=1,fa(n,s,d,o),s.child;case 14:return ov(n,s,s.type,s.pendingProps,o);case 15:return cv(n,s,s.type,s.pendingProps,o);case 19:return bv(n,s,o);case 31:return v_(n,s,o);case 22:return uv(n,s,o,s.pendingProps);case 24:return ci(s),d=da(Zn),n===null?(b=Qf(),b===null&&(b=In,x=Wf(),b.pooledCache=x,x.refCount++,x!==null&&(b.pooledCacheLanes|=o),b=x),s.memoizedState={parent:d,cache:b},em(s),yr(s,Zn,b)):((n.lanes&o)!==0&&(tm(n,s),no(s,null,null,o),to()),b=n.memoizedState,x=s.memoizedState,b.parent!==d?(b={parent:d,cache:d},s.memoizedState=b,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=b),yr(s,Zn,d)):(d=x.cache,yr(s,Zn,d),d!==b.cache&&Kf(s,[Zn],o,!0))),fa(n,s,s.pendingProps.children,o),s.child;case 29:throw s.pendingProps}throw Error(i(156,s.tag))}function Ys(n){n.flags|=4}function Om(n,s,o,d,b){if((s=(n.mode&32)!==0)&&(s=!1),s){if(n.flags|=16777216,(b&335544128)===b)if(n.stateNode.complete)n.flags|=8192;else if(Yv())n.flags|=8192;else throw fi=Hc,Jf}else n.flags&=-16777217}function xv(n,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!Lx(s))if(Yv())n.flags|=8192;else throw fi=Hc,Jf}function iu(n,s){s!==null&&(n.flags|=4),n.flags&16384&&(s=n.tag!==22?$t():536870912,n.lanes|=s,sl|=s)}function oo(n,s){if(!bn)switch(n.tailMode){case"hidden":s=n.tail;for(var o=null;s!==null;)s.alternate!==null&&(o=s),s=s.sibling;o===null?n.tail=null:o.sibling=null;break;case"collapsed":o=n.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?s||n.tail===null?n.tail=null:n.tail.sibling=null:d.sibling=null}}function zn(n){var s=n.alternate!==null&&n.alternate.child===n.child,o=0,d=0;if(s)for(var b=n.child;b!==null;)o|=b.lanes|b.childLanes,d|=b.subtreeFlags&65011712,d|=b.flags&65011712,b.return=n,b=b.sibling;else for(b=n.child;b!==null;)o|=b.lanes|b.childLanes,d|=b.subtreeFlags,d|=b.flags,b.return=n,b=b.sibling;return n.subtreeFlags|=d,n.childLanes=o,s}function S_(n,s,o){var d=s.pendingProps;switch(Pf(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zn(s),null;case 1:return zn(s),null;case 3:return o=s.stateNode,d=null,n!==null&&(d=n.memoizedState.cache),s.memoizedState.cache!==d&&(s.flags|=2048),qs(Zn),se(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(n===null||n.child===null)&&(Vi(s)?Ys(s):n===null||n.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Yf())),zn(s),null;case 26:var b=s.type,x=s.memoizedState;return n===null?(Ys(s),x!==null?(zn(s),xv(s,x)):(zn(s),Om(s,b,null,d,o))):x?x!==n.memoizedState?(Ys(s),zn(s),xv(s,x)):(zn(s),s.flags&=-16777217):(n=n.memoizedProps,n!==d&&Ys(s),zn(s),Om(s,b,n,d,o)),null;case 27:if(we(s),o=Z.current,b=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==d&&Ys(s);else{if(!d){if(s.stateNode===null)throw Error(i(166));return zn(s),null}n=J.current,Vi(s)?Jg(s):(n=Cx(b,d,o),s.stateNode=n,Ys(s))}return zn(s),null;case 5:if(we(s),b=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==d&&Ys(s);else{if(!d){if(s.stateNode===null)throw Error(i(166));return zn(s),null}if(x=J.current,Vi(s))Jg(s);else{var B=Su(Z.current);switch(x){case 1:x=B.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:x=B.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":x=B.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":x=B.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":x=B.createElement("div"),x.innerHTML="<script><\/script>",x=x.removeChild(x.firstChild);break;case"select":x=typeof d.is=="string"?B.createElement("select",{is:d.is}):B.createElement("select"),d.multiple?x.multiple=!0:d.size&&(x.size=d.size);break;default:x=typeof d.is=="string"?B.createElement(b,{is:d.is}):B.createElement(b)}}x[dt]=s,x[Ee]=d;e:for(B=s.child;B!==null;){if(B.tag===5||B.tag===6)x.appendChild(B.stateNode);else if(B.tag!==4&&B.tag!==27&&B.child!==null){B.child.return=B,B=B.child;continue}if(B===s)break e;for(;B.sibling===null;){if(B.return===null||B.return===s)break e;B=B.return}B.sibling.return=B.return,B=B.sibling}s.stateNode=x;e:switch(ma(x,b,d),b){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&Ys(s)}}return zn(s),Om(s,s.type,n===null?null:n.memoizedProps,s.pendingProps,o),null;case 6:if(n&&s.stateNode!=null)n.memoizedProps!==d&&Ys(s);else{if(typeof d!="string"&&s.stateNode===null)throw Error(i(166));if(n=Z.current,Vi(s)){if(n=s.stateNode,o=s.memoizedProps,d=null,b=ua,b!==null)switch(b.tag){case 27:case 5:d=b.memoizedProps}n[dt]=s,n=!!(n.nodeValue===o||d!==null&&d.suppressHydrationWarning===!0||yx(n.nodeValue,o)),n||pr(s,!0)}else n=Su(n).createTextNode(d),n[dt]=s,s.stateNode=n}return zn(s),null;case 31:if(o=s.memoizedState,n===null||n.memoizedState!==null){if(d=Vi(s),o!==null){if(n===null){if(!d)throw Error(i(318));if(n=s.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(557));n[dt]=s}else li(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;zn(s),n=!1}else o=Yf(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=o),n=!0;if(!n)return s.flags&256?(Fa(s),s):(Fa(s),null);if((s.flags&128)!==0)throw Error(i(558))}return zn(s),null;case 13:if(d=s.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(b=Vi(s),d!==null&&d.dehydrated!==null){if(n===null){if(!b)throw Error(i(318));if(b=s.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(i(317));b[dt]=s}else li(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;zn(s),b=!1}else b=Yf(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=b),b=!0;if(!b)return s.flags&256?(Fa(s),s):(Fa(s),null)}return Fa(s),(s.flags&128)!==0?(s.lanes=o,s):(o=d!==null,n=n!==null&&n.memoizedState!==null,o&&(d=s.child,b=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(b=d.alternate.memoizedState.cachePool.pool),x=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(x=d.memoizedState.cachePool.pool),x!==b&&(d.flags|=2048)),o!==n&&o&&(s.child.flags|=8192),iu(s,s.updateQueue),zn(s),null);case 4:return se(),n===null&&sh(s.stateNode.containerInfo),zn(s),null;case 10:return qs(s.type),zn(s),null;case 19:if(q(Xn),d=s.memoizedState,d===null)return zn(s),null;if(b=(s.flags&128)!==0,x=d.rendering,x===null)if(b)oo(d,!1);else{if(Vn!==0||n!==null&&(n.flags&128)!==0)for(n=s.child;n!==null;){if(x=Gc(n),x!==null){for(s.flags|=128,oo(d,!1),n=x.updateQueue,s.updateQueue=n,iu(s,n),s.subtreeFlags=0,n=o,o=s.child;o!==null;)Xg(o,n),o=o.sibling;return Y(Xn,Xn.current&1|2),bn&&Bs(s,d.treeForkCount),s.child}n=n.sibling}d.tail!==null&&Je()>du&&(s.flags|=128,b=!0,oo(d,!1),s.lanes=4194304)}else{if(!b)if(n=Gc(x),n!==null){if(s.flags|=128,b=!0,n=n.updateQueue,s.updateQueue=n,iu(s,n),oo(d,!0),d.tail===null&&d.tailMode==="hidden"&&!x.alternate&&!bn)return zn(s),null}else 2*Je()-d.renderingStartTime>du&&o!==536870912&&(s.flags|=128,b=!0,oo(d,!1),s.lanes=4194304);d.isBackwards?(x.sibling=s.child,s.child=x):(n=d.last,n!==null?n.sibling=x:s.child=x,d.last=x)}return d.tail!==null?(n=d.tail,d.rendering=n,d.tail=n.sibling,d.renderingStartTime=Je(),n.sibling=null,o=Xn.current,Y(Xn,b?o&1|2:o&1),bn&&Bs(s,d.treeForkCount),n):(zn(s),null);case 22:case 23:return Fa(s),rm(),d=s.memoizedState!==null,n!==null?n.memoizedState!==null!==d&&(s.flags|=8192):d&&(s.flags|=8192),d?(o&536870912)!==0&&(s.flags&128)===0&&(zn(s),s.subtreeFlags&6&&(s.flags|=8192)):zn(s),o=s.updateQueue,o!==null&&iu(s,o.retryQueue),o=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),d=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(d=s.memoizedState.cachePool.pool),d!==o&&(s.flags|=2048),n!==null&&q(ui),null;case 24:return o=null,n!==null&&(o=n.memoizedState.cache),s.memoizedState.cache!==o&&(s.flags|=2048),qs(Zn),zn(s),null;case 25:return null;case 30:return null}throw Error(i(156,s.tag))}function w_(n,s){switch(Pf(s),s.tag){case 1:return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 3:return qs(Zn),se(),n=s.flags,(n&65536)!==0&&(n&128)===0?(s.flags=n&-65537|128,s):null;case 26:case 27:case 5:return we(s),null;case 31:if(s.memoizedState!==null){if(Fa(s),s.alternate===null)throw Error(i(340));li()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 13:if(Fa(s),n=s.memoizedState,n!==null&&n.dehydrated!==null){if(s.alternate===null)throw Error(i(340));li()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 19:return q(Xn),null;case 4:return se(),null;case 10:return qs(s.type),null;case 22:case 23:return Fa(s),rm(),n!==null&&q(ui),n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 24:return qs(Zn),null;case 25:return null;default:return null}}function Sv(n,s){switch(Pf(s),s.tag){case 3:qs(Zn),se();break;case 26:case 27:case 5:we(s);break;case 4:se();break;case 31:s.memoizedState!==null&&Fa(s);break;case 13:Fa(s);break;case 19:q(Xn);break;case 10:qs(s.type);break;case 22:case 23:Fa(s),rm(),n!==null&&q(ui);break;case 24:qs(Zn)}}function co(n,s){try{var o=s.updateQueue,d=o!==null?o.lastEffect:null;if(d!==null){var b=d.next;o=b;do{if((o.tag&n)===n){d=void 0;var x=o.create,B=o.inst;d=x(),B.destroy=d}o=o.next}while(o!==b)}}catch(W){Tn(s,s.return,W)}}function wr(n,s,o){try{var d=s.updateQueue,b=d!==null?d.lastEffect:null;if(b!==null){var x=b.next;d=x;do{if((d.tag&n)===n){var B=d.inst,W=B.destroy;if(W!==void 0){B.destroy=void 0,b=s;var pe=o,ze=W;try{ze()}catch(tt){Tn(b,pe,tt)}}}d=d.next}while(d!==x)}}catch(tt){Tn(s,s.return,tt)}}function wv(n){var s=n.updateQueue;if(s!==null){var o=n.stateNode;try{fb(s,o)}catch(d){Tn(n,n.return,d)}}}function Nv(n,s,o){o.props=pi(n.type,n.memoizedProps),o.state=n.memoizedState;try{o.componentWillUnmount()}catch(d){Tn(n,s,d)}}function uo(n,s){try{var o=n.ref;if(o!==null){switch(n.tag){case 26:case 27:case 5:var d=n.stateNode;break;case 30:d=n.stateNode;break;default:d=n.stateNode}typeof o=="function"?n.refCleanup=o(d):o.current=d}}catch(b){Tn(n,s,b)}}function _s(n,s){var o=n.ref,d=n.refCleanup;if(o!==null)if(typeof d=="function")try{d()}catch(b){Tn(n,s,b)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(b){Tn(n,s,b)}else o.current=null}function Ev(n){var s=n.type,o=n.memoizedProps,d=n.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":o.autoFocus&&d.focus();break e;case"img":o.src?d.src=o.src:o.srcSet&&(d.srcset=o.srcSet)}}catch(b){Tn(n,n.return,b)}}function zm(n,s,o){try{var d=n.stateNode;P_(d,n.type,o,s),d[Ee]=s}catch(b){Tn(n,n.return,b)}}function jv(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&Tr(n.type)||n.tag===4}function $m(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||jv(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&Tr(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Fm(n,s,o){var d=n.tag;if(d===5||d===6)n=n.stateNode,s?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(n,s):(s=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,s.appendChild(n),o=o._reactRootContainer,o!=null||s.onclick!==null||(s.onclick=oa));else if(d!==4&&(d===27&&Tr(n.type)&&(o=n.stateNode,s=null),n=n.child,n!==null))for(Fm(n,s,o),n=n.sibling;n!==null;)Fm(n,s,o),n=n.sibling}function lu(n,s,o){var d=n.tag;if(d===5||d===6)n=n.stateNode,s?o.insertBefore(n,s):o.appendChild(n);else if(d!==4&&(d===27&&Tr(n.type)&&(o=n.stateNode),n=n.child,n!==null))for(lu(n,s,o),n=n.sibling;n!==null;)lu(n,s,o),n=n.sibling}function _v(n){var s=n.stateNode,o=n.memoizedProps;try{for(var d=n.type,b=s.attributes;b.length;)s.removeAttributeNode(b[0]);ma(s,d,o),s[dt]=n,s[Ee]=o}catch(x){Tn(n,n.return,x)}}var Gs=!1,ea=!1,Bm=!1,Cv=typeof WeakSet=="function"?WeakSet:Set,ra=null;function N_(n,s){if(n=n.containerInfo,lh=Au,n=Fg(n),Df(n)){if("selectionStart"in n)var o={start:n.selectionStart,end:n.selectionEnd};else e:{o=(o=n.ownerDocument)&&o.defaultView||window;var d=o.getSelection&&o.getSelection();if(d&&d.rangeCount!==0){o=d.anchorNode;var b=d.anchorOffset,x=d.focusNode;d=d.focusOffset;try{o.nodeType,x.nodeType}catch{o=null;break e}var B=0,W=-1,pe=-1,ze=0,tt=0,lt=n,Fe=null;t:for(;;){for(var Ye;lt!==o||b!==0&&lt.nodeType!==3||(W=B+b),lt!==x||d!==0&&lt.nodeType!==3||(pe=B+d),lt.nodeType===3&&(B+=lt.nodeValue.length),(Ye=lt.firstChild)!==null;)Fe=lt,lt=Ye;for(;;){if(lt===n)break t;if(Fe===o&&++ze===b&&(W=B),Fe===x&&++tt===d&&(pe=B),(Ye=lt.nextSibling)!==null)break;lt=Fe,Fe=lt.parentNode}lt=Ye}o=W===-1||pe===-1?null:{start:W,end:pe}}else o=null}o=o||{start:0,end:0}}else o=null;for(oh={focusedElem:n,selectionRange:o},Au=!1,ra=s;ra!==null;)if(s=ra,n=s.child,(s.subtreeFlags&1028)!==0&&n!==null)n.return=s,ra=n;else for(;ra!==null;){switch(s=ra,x=s.alternate,n=s.flags,s.tag){case 0:if((n&4)!==0&&(n=s.updateQueue,n=n!==null?n.events:null,n!==null))for(o=0;o<n.length;o++)b=n[o],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((n&1024)!==0&&x!==null){n=void 0,o=s,b=x.memoizedProps,x=x.memoizedState,d=o.stateNode;try{var Ot=pi(o.type,b);n=d.getSnapshotBeforeUpdate(Ot,x),d.__reactInternalSnapshotBeforeUpdate=n}catch(Wt){Tn(o,o.return,Wt)}}break;case 3:if((n&1024)!==0){if(n=s.stateNode.containerInfo,o=n.nodeType,o===9)dh(n);else if(o===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":dh(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(i(163))}if(n=s.sibling,n!==null){n.return=s.return,ra=n;break}ra=s.return}}function Av(n,s,o){var d=o.flags;switch(o.tag){case 0:case 11:case 15:Ks(n,o),d&4&&co(5,o);break;case 1:if(Ks(n,o),d&4)if(n=o.stateNode,s===null)try{n.componentDidMount()}catch(B){Tn(o,o.return,B)}else{var b=pi(o.type,s.memoizedProps);s=s.memoizedState;try{n.componentDidUpdate(b,s,n.__reactInternalSnapshotBeforeUpdate)}catch(B){Tn(o,o.return,B)}}d&64&&wv(o),d&512&&uo(o,o.return);break;case 3:if(Ks(n,o),d&64&&(n=o.updateQueue,n!==null)){if(s=null,o.child!==null)switch(o.child.tag){case 27:case 5:s=o.child.stateNode;break;case 1:s=o.child.stateNode}try{fb(n,s)}catch(B){Tn(o,o.return,B)}}break;case 27:s===null&&d&4&&_v(o);case 26:case 5:Ks(n,o),s===null&&d&4&&Ev(o),d&512&&uo(o,o.return);break;case 12:Ks(n,o);break;case 31:Ks(n,o),d&4&&Rv(n,o);break;case 13:Ks(n,o),d&4&&kv(n,o),d&64&&(n=o.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(o=k_.bind(null,o),Q_(n,o))));break;case 22:if(d=o.memoizedState!==null||Gs,!d){s=s!==null&&s.memoizedState!==null||ea,b=Gs;var x=ea;Gs=d,(ea=s)&&!x?Ws(n,o,(o.subtreeFlags&8772)!==0):Ks(n,o),Gs=b,ea=x}break;case 30:break;default:Ks(n,o)}}function Tv(n){var s=n.alternate;s!==null&&(n.alternate=null,Tv(s)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(s=n.stateNode,s!==null&&Ze(s)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var Fn=null,ja=!1;function Xs(n,s,o){for(o=o.child;o!==null;)Mv(n,s,o),o=o.sibling}function Mv(n,s,o){if(Xe&&typeof Xe.onCommitFiberUnmount=="function")try{Xe.onCommitFiberUnmount(We,o)}catch{}switch(o.tag){case 26:ea||_s(o,s),Xs(n,s,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:ea||_s(o,s);var d=Fn,b=ja;Tr(o.type)&&(Fn=o.stateNode,ja=!1),Xs(n,s,o),xo(o.stateNode),Fn=d,ja=b;break;case 5:ea||_s(o,s);case 6:if(d=Fn,b=ja,Fn=null,Xs(n,s,o),Fn=d,ja=b,Fn!==null)if(ja)try{(Fn.nodeType===9?Fn.body:Fn.nodeName==="HTML"?Fn.ownerDocument.body:Fn).removeChild(o.stateNode)}catch(x){Tn(o,s,x)}else try{Fn.removeChild(o.stateNode)}catch(x){Tn(o,s,x)}break;case 18:Fn!==null&&(ja?(n=Fn,wx(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,o.stateNode),fl(n)):wx(Fn,o.stateNode));break;case 4:d=Fn,b=ja,Fn=o.stateNode.containerInfo,ja=!0,Xs(n,s,o),Fn=d,ja=b;break;case 0:case 11:case 14:case 15:wr(2,o,s),ea||wr(4,o,s),Xs(n,s,o);break;case 1:ea||(_s(o,s),d=o.stateNode,typeof d.componentWillUnmount=="function"&&Nv(o,s,d)),Xs(n,s,o);break;case 21:Xs(n,s,o);break;case 22:ea=(d=ea)||o.memoizedState!==null,Xs(n,s,o),ea=d;break;default:Xs(n,s,o)}}function Rv(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null))){n=n.dehydrated;try{fl(n)}catch(o){Tn(s,s.return,o)}}}function kv(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{fl(n)}catch(o){Tn(s,s.return,o)}}function E_(n){switch(n.tag){case 31:case 13:case 19:var s=n.stateNode;return s===null&&(s=n.stateNode=new Cv),s;case 22:return n=n.stateNode,s=n._retryCache,s===null&&(s=n._retryCache=new Cv),s;default:throw Error(i(435,n.tag))}}function ou(n,s){var o=E_(n);s.forEach(function(d){if(!o.has(d)){o.add(d);var b=D_.bind(null,n,d);d.then(b,b)}})}function _a(n,s){var o=s.deletions;if(o!==null)for(var d=0;d<o.length;d++){var b=o[d],x=n,B=s,W=B;e:for(;W!==null;){switch(W.tag){case 27:if(Tr(W.type)){Fn=W.stateNode,ja=!1;break e}break;case 5:Fn=W.stateNode,ja=!1;break e;case 3:case 4:Fn=W.stateNode.containerInfo,ja=!0;break e}W=W.return}if(Fn===null)throw Error(i(160));Mv(x,B,b),Fn=null,ja=!1,x=b.alternate,x!==null&&(x.return=null),b.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Dv(s,n),s=s.sibling}var ds=null;function Dv(n,s){var o=n.alternate,d=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:_a(s,n),Ca(n),d&4&&(wr(3,n,n.return),co(3,n),wr(5,n,n.return));break;case 1:_a(s,n),Ca(n),d&512&&(ea||o===null||_s(o,o.return)),d&64&&Gs&&(n=n.updateQueue,n!==null&&(d=n.callbacks,d!==null&&(o=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=o===null?d:o.concat(d))));break;case 26:var b=ds;if(_a(s,n),Ca(n),d&512&&(ea||o===null||_s(o,o.return)),d&4){var x=o!==null?o.memoizedState:null;if(d=n.memoizedState,o===null)if(d===null)if(n.stateNode===null){e:{d=n.type,o=n.memoizedProps,b=b.ownerDocument||b;t:switch(d){case"title":x=b.getElementsByTagName("title")[0],(!x||x[oe]||x[dt]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=b.createElement(d),b.head.insertBefore(x,b.querySelector("head > title"))),ma(x,d,o),x[dt]=n,ke(x),d=x;break e;case"link":var B=Dx("link","href",b).get(d+(o.href||""));if(B){for(var W=0;W<B.length;W++)if(x=B[W],x.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&x.getAttribute("rel")===(o.rel==null?null:o.rel)&&x.getAttribute("title")===(o.title==null?null:o.title)&&x.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){B.splice(W,1);break t}}x=b.createElement(d),ma(x,d,o),b.head.appendChild(x);break;case"meta":if(B=Dx("meta","content",b).get(d+(o.content||""))){for(W=0;W<B.length;W++)if(x=B[W],x.getAttribute("content")===(o.content==null?null:""+o.content)&&x.getAttribute("name")===(o.name==null?null:o.name)&&x.getAttribute("property")===(o.property==null?null:o.property)&&x.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&x.getAttribute("charset")===(o.charSet==null?null:o.charSet)){B.splice(W,1);break t}}x=b.createElement(d),ma(x,d,o),b.head.appendChild(x);break;default:throw Error(i(468,d))}x[dt]=n,ke(x),d=x}n.stateNode=d}else Ix(b,n.type,n.stateNode);else n.stateNode=kx(b,d,n.memoizedProps);else x!==d?(x===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):x.count--,d===null?Ix(b,n.type,n.stateNode):kx(b,d,n.memoizedProps)):d===null&&n.stateNode!==null&&zm(n,n.memoizedProps,o.memoizedProps)}break;case 27:_a(s,n),Ca(n),d&512&&(ea||o===null||_s(o,o.return)),o!==null&&d&4&&zm(n,n.memoizedProps,o.memoizedProps);break;case 5:if(_a(s,n),Ca(n),d&512&&(ea||o===null||_s(o,o.return)),n.flags&32){b=n.stateNode;try{_e(b,"")}catch(Ot){Tn(n,n.return,Ot)}}d&4&&n.stateNode!=null&&(b=n.memoizedProps,zm(n,b,o!==null?o.memoizedProps:b)),d&1024&&(Bm=!0);break;case 6:if(_a(s,n),Ca(n),d&4){if(n.stateNode===null)throw Error(i(162));d=n.memoizedProps,o=n.stateNode;try{o.nodeValue=d}catch(Ot){Tn(n,n.return,Ot)}}break;case 3:if(Eu=null,b=ds,ds=wu(s.containerInfo),_a(s,n),ds=b,Ca(n),d&4&&o!==null&&o.memoizedState.isDehydrated)try{fl(s.containerInfo)}catch(Ot){Tn(n,n.return,Ot)}Bm&&(Bm=!1,Iv(n));break;case 4:d=ds,ds=wu(n.stateNode.containerInfo),_a(s,n),Ca(n),ds=d;break;case 12:_a(s,n),Ca(n);break;case 31:_a(s,n),Ca(n),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,ou(n,d)));break;case 13:_a(s,n),Ca(n),n.child.flags&8192&&n.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(uu=Je()),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,ou(n,d)));break;case 22:b=n.memoizedState!==null;var pe=o!==null&&o.memoizedState!==null,ze=Gs,tt=ea;if(Gs=ze||b,ea=tt||pe,_a(s,n),ea=tt,Gs=ze,Ca(n),d&8192)e:for(s=n.stateNode,s._visibility=b?s._visibility&-2:s._visibility|1,b&&(o===null||pe||Gs||ea||yi(n)),o=null,s=n;;){if(s.tag===5||s.tag===26){if(o===null){pe=o=s;try{if(x=pe.stateNode,b)B=x.style,typeof B.setProperty=="function"?B.setProperty("display","none","important"):B.display="none";else{W=pe.stateNode;var lt=pe.memoizedProps.style,Fe=lt!=null&&lt.hasOwnProperty("display")?lt.display:null;W.style.display=Fe==null||typeof Fe=="boolean"?"":(""+Fe).trim()}}catch(Ot){Tn(pe,pe.return,Ot)}}}else if(s.tag===6){if(o===null){pe=s;try{pe.stateNode.nodeValue=b?"":pe.memoizedProps}catch(Ot){Tn(pe,pe.return,Ot)}}}else if(s.tag===18){if(o===null){pe=s;try{var Ye=pe.stateNode;b?Nx(Ye,!0):Nx(pe.stateNode,!1)}catch(Ot){Tn(pe,pe.return,Ot)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===n)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break e;for(;s.sibling===null;){if(s.return===null||s.return===n)break e;o===s&&(o=null),s=s.return}o===s&&(o=null),s.sibling.return=s.return,s=s.sibling}d&4&&(d=n.updateQueue,d!==null&&(o=d.retryQueue,o!==null&&(d.retryQueue=null,ou(n,o))));break;case 19:_a(s,n),Ca(n),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,ou(n,d)));break;case 30:break;case 21:break;default:_a(s,n),Ca(n)}}function Ca(n){var s=n.flags;if(s&2){try{for(var o,d=n.return;d!==null;){if(jv(d)){o=d;break}d=d.return}if(o==null)throw Error(i(160));switch(o.tag){case 27:var b=o.stateNode,x=$m(n);lu(n,x,b);break;case 5:var B=o.stateNode;o.flags&32&&(_e(B,""),o.flags&=-33);var W=$m(n);lu(n,W,B);break;case 3:case 4:var pe=o.stateNode.containerInfo,ze=$m(n);Fm(n,ze,pe);break;default:throw Error(i(161))}}catch(tt){Tn(n,n.return,tt)}n.flags&=-3}s&4096&&(n.flags&=-4097)}function Iv(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var s=n;Iv(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),n=n.sibling}}function Ks(n,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)Av(n,s.alternate,s),s=s.sibling}function yi(n){for(n=n.child;n!==null;){var s=n;switch(s.tag){case 0:case 11:case 14:case 15:wr(4,s,s.return),yi(s);break;case 1:_s(s,s.return);var o=s.stateNode;typeof o.componentWillUnmount=="function"&&Nv(s,s.return,o),yi(s);break;case 27:xo(s.stateNode);case 26:case 5:_s(s,s.return),yi(s);break;case 22:s.memoizedState===null&&yi(s);break;case 30:yi(s);break;default:yi(s)}n=n.sibling}}function Ws(n,s,o){for(o=o&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var d=s.alternate,b=n,x=s,B=x.flags;switch(x.tag){case 0:case 11:case 15:Ws(b,x,o),co(4,x);break;case 1:if(Ws(b,x,o),d=x,b=d.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(ze){Tn(d,d.return,ze)}if(d=x,b=d.updateQueue,b!==null){var W=d.stateNode;try{var pe=b.shared.hiddenCallbacks;if(pe!==null)for(b.shared.hiddenCallbacks=null,b=0;b<pe.length;b++)db(pe[b],W)}catch(ze){Tn(d,d.return,ze)}}o&&B&64&&wv(x),uo(x,x.return);break;case 27:_v(x);case 26:case 5:Ws(b,x,o),o&&d===null&&B&4&&Ev(x),uo(x,x.return);break;case 12:Ws(b,x,o);break;case 31:Ws(b,x,o),o&&B&4&&Rv(b,x);break;case 13:Ws(b,x,o),o&&B&4&&kv(b,x);break;case 22:x.memoizedState===null&&Ws(b,x,o),uo(x,x.return);break;case 30:break;default:Ws(b,x,o)}s=s.sibling}}function Um(n,s){var o=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),n=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(n=s.memoizedState.cachePool.pool),n!==o&&(n!=null&&n.refCount++,o!=null&&Wl(o))}function qm(n,s){n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&Wl(n))}function fs(n,s,o,d){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Lv(n,s,o,d),s=s.sibling}function Lv(n,s,o,d){var b=s.flags;switch(s.tag){case 0:case 11:case 15:fs(n,s,o,d),b&2048&&co(9,s);break;case 1:fs(n,s,o,d);break;case 3:fs(n,s,o,d),b&2048&&(n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&Wl(n)));break;case 12:if(b&2048){fs(n,s,o,d),n=s.stateNode;try{var x=s.memoizedProps,B=x.id,W=x.onPostCommit;typeof W=="function"&&W(B,s.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(pe){Tn(s,s.return,pe)}}else fs(n,s,o,d);break;case 31:fs(n,s,o,d);break;case 13:fs(n,s,o,d);break;case 23:break;case 22:x=s.stateNode,B=s.alternate,s.memoizedState!==null?x._visibility&2?fs(n,s,o,d):fo(n,s):x._visibility&2?fs(n,s,o,d):(x._visibility|=2,tl(n,s,o,d,(s.subtreeFlags&10256)!==0||!1)),b&2048&&Um(B,s);break;case 24:fs(n,s,o,d),b&2048&&qm(s.alternate,s);break;default:fs(n,s,o,d)}}function tl(n,s,o,d,b){for(b=b&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var x=n,B=s,W=o,pe=d,ze=B.flags;switch(B.tag){case 0:case 11:case 15:tl(x,B,W,pe,b),co(8,B);break;case 23:break;case 22:var tt=B.stateNode;B.memoizedState!==null?tt._visibility&2?tl(x,B,W,pe,b):fo(x,B):(tt._visibility|=2,tl(x,B,W,pe,b)),b&&ze&2048&&Um(B.alternate,B);break;case 24:tl(x,B,W,pe,b),b&&ze&2048&&qm(B.alternate,B);break;default:tl(x,B,W,pe,b)}s=s.sibling}}function fo(n,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var o=n,d=s,b=d.flags;switch(d.tag){case 22:fo(o,d),b&2048&&Um(d.alternate,d);break;case 24:fo(o,d),b&2048&&qm(d.alternate,d);break;default:fo(o,d)}s=s.sibling}}var mo=8192;function nl(n,s,o){if(n.subtreeFlags&mo)for(n=n.child;n!==null;)Ov(n,s,o),n=n.sibling}function Ov(n,s,o){switch(n.tag){case 26:nl(n,s,o),n.flags&mo&&n.memoizedState!==null&&uC(o,ds,n.memoizedState,n.memoizedProps);break;case 5:nl(n,s,o);break;case 3:case 4:var d=ds;ds=wu(n.stateNode.containerInfo),nl(n,s,o),ds=d;break;case 22:n.memoizedState===null&&(d=n.alternate,d!==null&&d.memoizedState!==null?(d=mo,mo=16777216,nl(n,s,o),mo=d):nl(n,s,o));break;default:nl(n,s,o)}}function zv(n){var s=n.alternate;if(s!==null&&(n=s.child,n!==null)){s.child=null;do s=n.sibling,n.sibling=null,n=s;while(n!==null)}}function ho(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var d=s[o];ra=d,Fv(d,n)}zv(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)$v(n),n=n.sibling}function $v(n){switch(n.tag){case 0:case 11:case 15:ho(n),n.flags&2048&&wr(9,n,n.return);break;case 3:ho(n);break;case 12:ho(n);break;case 22:var s=n.stateNode;n.memoizedState!==null&&s._visibility&2&&(n.return===null||n.return.tag!==13)?(s._visibility&=-3,cu(n)):ho(n);break;default:ho(n)}}function cu(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var d=s[o];ra=d,Fv(d,n)}zv(n)}for(n=n.child;n!==null;){switch(s=n,s.tag){case 0:case 11:case 15:wr(8,s,s.return),cu(s);break;case 22:o=s.stateNode,o._visibility&2&&(o._visibility&=-3,cu(s));break;default:cu(s)}n=n.sibling}}function Fv(n,s){for(;ra!==null;){var o=ra;switch(o.tag){case 0:case 11:case 15:wr(8,o,s);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var d=o.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Wl(o.memoizedState.cache)}if(d=o.child,d!==null)d.return=o,ra=d;else e:for(o=n;ra!==null;){d=ra;var b=d.sibling,x=d.return;if(Tv(d),d===o){ra=null;break e}if(b!==null){b.return=x,ra=b;break e}ra=x}}}var j_={getCacheForType:function(n){var s=da(Zn),o=s.data.get(n);return o===void 0&&(o=n(),s.data.set(n,o)),o},cacheSignal:function(){return da(Zn).controller.signal}},__=typeof WeakMap=="function"?WeakMap:Map,_n=0,In=null,mn=null,yn=0,An=0,Ba=null,Nr=!1,al=!1,Hm=!1,Zs=0,Vn=0,Er=0,gi=0,Pm=0,Ua=0,sl=0,po=null,Aa=null,Vm=!1,uu=0,Bv=0,du=1/0,fu=null,jr=null,ta=0,_r=null,rl=null,Qs=0,Ym=0,Gm=null,Uv=null,yo=0,Xm=null;function qa(){return(_n&2)!==0&&yn!==0?yn&-yn:I.T!==null?eh():je()}function qv(){if(Ua===0)if((yn&536870912)===0||bn){var n=vt;vt<<=1,(vt&3932160)===0&&(vt=262144),Ua=n}else Ua=536870912;return n=$a.current,n!==null&&(n.flags|=32),Ua}function Ta(n,s,o){(n===In&&(An===2||An===9)||n.cancelPendingCommit!==null)&&(il(n,0),Cr(n,yn,Ua,!1)),te(n,o),((_n&2)===0||n!==In)&&(n===In&&((_n&2)===0&&(gi|=o),Vn===4&&Cr(n,yn,Ua,!1)),Cs(n))}function Hv(n,s,o){if((_n&6)!==0)throw Error(i(327));var d=!o&&(s&127)===0&&(s&n.expiredLanes)===0||Et(n,s),b=d?T_(n,s):Wm(n,s,!0),x=d;do{if(b===0){al&&!d&&Cr(n,s,0,!1);break}else{if(o=n.current.alternate,x&&!C_(o)){b=Wm(n,s,!1),x=!1;continue}if(b===2){if(x=s,n.errorRecoveryDisabledLanes&x)var B=0;else B=n.pendingLanes&-536870913,B=B!==0?B:B&536870912?536870912:0;if(B!==0){s=B;e:{var W=n;b=po;var pe=W.current.memoizedState.isDehydrated;if(pe&&(il(W,B).flags|=256),B=Wm(W,B,!1),B!==2){if(Hm&&!pe){W.errorRecoveryDisabledLanes|=x,gi|=x,b=4;break e}x=Aa,Aa=b,x!==null&&(Aa===null?Aa=x:Aa.push.apply(Aa,x))}b=B}if(x=!1,b!==2)continue}}if(b===1){il(n,0),Cr(n,s,0,!0);break}e:{switch(d=n,x=b,x){case 0:case 1:throw Error(i(345));case 4:if((s&4194048)!==s)break;case 6:Cr(d,s,Ua,!Nr);break e;case 2:Aa=null;break;case 3:case 5:break;default:throw Error(i(329))}if((s&62914560)===s&&(b=uu+300-Je(),10<b)){if(Cr(d,s,Ua,!Nr),Jt(d,0,!0)!==0)break e;Qs=s,d.timeoutHandle=xx(Pv.bind(null,d,o,Aa,fu,Vm,s,Ua,gi,sl,Nr,x,"Throttled",-0,0),b);break e}Pv(d,o,Aa,fu,Vm,s,Ua,gi,sl,Nr,x,null,-0,0)}}break}while(!0);Cs(n)}function Pv(n,s,o,d,b,x,B,W,pe,ze,tt,lt,Fe,Ye){if(n.timeoutHandle=-1,lt=s.subtreeFlags,lt&8192||(lt&16785408)===16785408){lt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:oa},Ov(s,x,lt);var Ot=(x&62914560)===x?uu-Je():(x&4194048)===x?Bv-Je():0;if(Ot=dC(lt,Ot),Ot!==null){Qs=x,n.cancelPendingCommit=Ot(Qv.bind(null,n,s,x,o,d,b,B,W,pe,tt,lt,null,Fe,Ye)),Cr(n,x,B,!ze);return}}Qv(n,s,x,o,d,b,B,W,pe)}function C_(n){for(var s=n;;){var o=s.tag;if((o===0||o===11||o===15)&&s.flags&16384&&(o=s.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var d=0;d<o.length;d++){var b=o[d],x=b.getSnapshot;b=b.value;try{if(!Oa(x(),b))return!1}catch{return!1}}if(o=s.child,s.subtreeFlags&16384&&o!==null)o.return=s,s=o;else{if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Cr(n,s,o,d){s&=~Pm,s&=~gi,n.suspendedLanes|=s,n.pingedLanes&=~s,d&&(n.warmLanes|=s),d=n.expirationTimes;for(var b=s;0<b;){var x=31-Te(b),B=1<<x;d[x]=-1,b&=~B}o!==0&&ve(n,o,s)}function mu(){return(_n&6)===0?(go(0),!1):!0}function Km(){if(mn!==null){if(An===0)var n=mn.return;else n=mn,Us=oi=null,dm(n),Wi=null,Ql=0,n=mn;for(;n!==null;)Sv(n.alternate,n),n=n.return;mn=null}}function il(n,s){var o=n.timeoutHandle;o!==-1&&(n.timeoutHandle=-1,G_(o)),o=n.cancelPendingCommit,o!==null&&(n.cancelPendingCommit=null,o()),Qs=0,Km(),In=n,mn=o=Fs(n.current,null),yn=s,An=0,Ba=null,Nr=!1,al=Et(n,s),Hm=!1,sl=Ua=Pm=gi=Er=Vn=0,Aa=po=null,Vm=!1,(s&8)!==0&&(s|=s&32);var d=n.entangledLanes;if(d!==0)for(n=n.entanglements,d&=s;0<d;){var b=31-Te(d),x=1<<b;s|=n[b],d&=~x}return Zs=s,Ic(),o}function Vv(n,s){nn=null,I.H=io,s===Ki||s===qc?(s=lb(),An=3):s===Jf?(s=lb(),An=4):An=s===Cm?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Ba=s,mn===null&&(Vn=1,nu(n,Za(s,n.current)))}function Yv(){var n=$a.current;return n===null?!0:(yn&4194048)===yn?ts===null:(yn&62914560)===yn||(yn&536870912)!==0?n===ts:!1}function Gv(){var n=I.H;return I.H=io,n===null?io:n}function Xv(){var n=I.A;return I.A=j_,n}function hu(){Vn=4,Nr||(yn&4194048)!==yn&&$a.current!==null||(al=!0),(Er&134217727)===0&&(gi&134217727)===0||In===null||Cr(In,yn,Ua,!1)}function Wm(n,s,o){var d=_n;_n|=2;var b=Gv(),x=Xv();(In!==n||yn!==s)&&(fu=null,il(n,s)),s=!1;var B=Vn;e:do try{if(An!==0&&mn!==null){var W=mn,pe=Ba;switch(An){case 8:Km(),B=6;break e;case 3:case 2:case 9:case 6:$a.current===null&&(s=!0);var ze=An;if(An=0,Ba=null,ll(n,W,pe,ze),o&&al){B=0;break e}break;default:ze=An,An=0,Ba=null,ll(n,W,pe,ze)}}A_(),B=Vn;break}catch(tt){Vv(n,tt)}while(!0);return s&&n.shellSuspendCounter++,Us=oi=null,_n=d,I.H=b,I.A=x,mn===null&&(In=null,yn=0,Ic()),B}function A_(){for(;mn!==null;)Kv(mn)}function T_(n,s){var o=_n;_n|=2;var d=Gv(),b=Xv();In!==n||yn!==s?(fu=null,du=Je()+500,il(n,s)):al=Et(n,s);e:do try{if(An!==0&&mn!==null){s=mn;var x=Ba;t:switch(An){case 1:An=0,Ba=null,ll(n,s,x,1);break;case 2:case 9:if(rb(x)){An=0,Ba=null,Wv(s);break}s=function(){An!==2&&An!==9||In!==n||(An=7),Cs(n)},x.then(s,s);break e;case 3:An=7;break e;case 4:An=5;break e;case 7:rb(x)?(An=0,Ba=null,Wv(s)):(An=0,Ba=null,ll(n,s,x,7));break;case 5:var B=null;switch(mn.tag){case 26:B=mn.memoizedState;case 5:case 27:var W=mn;if(B?Lx(B):W.stateNode.complete){An=0,Ba=null;var pe=W.sibling;if(pe!==null)mn=pe;else{var ze=W.return;ze!==null?(mn=ze,pu(ze)):mn=null}break t}}An=0,Ba=null,ll(n,s,x,5);break;case 6:An=0,Ba=null,ll(n,s,x,6);break;case 8:Km(),Vn=6;break e;default:throw Error(i(462))}}M_();break}catch(tt){Vv(n,tt)}while(!0);return Us=oi=null,I.H=d,I.A=b,_n=o,mn!==null?0:(In=null,yn=0,Ic(),Vn)}function M_(){for(;mn!==null&&!At();)Kv(mn)}function Kv(n){var s=vv(n.alternate,n,Zs);n.memoizedProps=n.pendingProps,s===null?pu(n):mn=s}function Wv(n){var s=n,o=s.alternate;switch(s.tag){case 15:case 0:s=mv(o,s,s.pendingProps,s.type,void 0,yn);break;case 11:s=mv(o,s,s.pendingProps,s.type.render,s.ref,yn);break;case 5:dm(s);default:Sv(o,s),s=mn=Xg(s,Zs),s=vv(o,s,Zs)}n.memoizedProps=n.pendingProps,s===null?pu(n):mn=s}function ll(n,s,o,d){Us=oi=null,dm(s),Wi=null,Ql=0;var b=s.return;try{if(b_(n,b,s,o,yn)){Vn=1,nu(n,Za(o,n.current)),mn=null;return}}catch(x){if(b!==null)throw mn=b,x;Vn=1,nu(n,Za(o,n.current)),mn=null;return}s.flags&32768?(bn||d===1?n=!0:al||(yn&536870912)!==0?n=!1:(Nr=n=!0,(d===2||d===9||d===3||d===6)&&(d=$a.current,d!==null&&d.tag===13&&(d.flags|=16384))),Zv(s,n)):pu(s)}function pu(n){var s=n;do{if((s.flags&32768)!==0){Zv(s,Nr);return}n=s.return;var o=S_(s.alternate,s,Zs);if(o!==null){mn=o;return}if(s=s.sibling,s!==null){mn=s;return}mn=s=n}while(s!==null);Vn===0&&(Vn=5)}function Zv(n,s){do{var o=w_(n.alternate,n);if(o!==null){o.flags&=32767,mn=o;return}if(o=n.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!s&&(n=n.sibling,n!==null)){mn=n;return}mn=n=o}while(n!==null);Vn=6,mn=null}function Qv(n,s,o,d,b,x,B,W,pe){n.cancelPendingCommit=null;do yu();while(ta!==0);if((_n&6)!==0)throw Error(i(327));if(s!==null){if(s===n.current)throw Error(i(177));if(x=s.lanes|s.childLanes,x|=$f,be(n,o,x,B,W,pe),n===In&&(mn=In=null,yn=0),rl=s,_r=n,Qs=o,Ym=x,Gm=b,Uv=d,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,I_(Ve,function(){return ax(),null})):(n.callbackNode=null,n.callbackPriority=0),d=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||d){d=I.T,I.T=null,b=L.p,L.p=2,B=_n,_n|=4;try{N_(n,s,o)}finally{_n=B,L.p=b,I.T=d}}ta=1,Jv(),ex(),tx()}}function Jv(){if(ta===1){ta=0;var n=_r,s=rl,o=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||o){o=I.T,I.T=null;var d=L.p;L.p=2;var b=_n;_n|=4;try{Dv(s,n);var x=oh,B=Fg(n.containerInfo),W=x.focusedElem,pe=x.selectionRange;if(B!==W&&W&&W.ownerDocument&&$g(W.ownerDocument.documentElement,W)){if(pe!==null&&Df(W)){var ze=pe.start,tt=pe.end;if(tt===void 0&&(tt=ze),"selectionStart"in W)W.selectionStart=ze,W.selectionEnd=Math.min(tt,W.value.length);else{var lt=W.ownerDocument||document,Fe=lt&&lt.defaultView||window;if(Fe.getSelection){var Ye=Fe.getSelection(),Ot=W.textContent.length,Wt=Math.min(pe.start,Ot),Dn=pe.end===void 0?Wt:Math.min(pe.end,Ot);!Ye.extend&&Wt>Dn&&(B=Dn,Dn=Wt,Wt=B);var Ce=zg(W,Wt),xe=zg(W,Dn);if(Ce&&xe&&(Ye.rangeCount!==1||Ye.anchorNode!==Ce.node||Ye.anchorOffset!==Ce.offset||Ye.focusNode!==xe.node||Ye.focusOffset!==xe.offset)){var Oe=lt.createRange();Oe.setStart(Ce.node,Ce.offset),Ye.removeAllRanges(),Wt>Dn?(Ye.addRange(Oe),Ye.extend(xe.node,xe.offset)):(Oe.setEnd(xe.node,xe.offset),Ye.addRange(Oe))}}}}for(lt=[],Ye=W;Ye=Ye.parentNode;)Ye.nodeType===1&&lt.push({element:Ye,left:Ye.scrollLeft,top:Ye.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<lt.length;W++){var rt=lt[W];rt.element.scrollLeft=rt.left,rt.element.scrollTop=rt.top}}Au=!!lh,oh=lh=null}finally{_n=b,L.p=d,I.T=o}}n.current=s,ta=2}}function ex(){if(ta===2){ta=0;var n=_r,s=rl,o=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||o){o=I.T,I.T=null;var d=L.p;L.p=2;var b=_n;_n|=4;try{Av(n,s.alternate,s)}finally{_n=b,L.p=d,I.T=o}}ta=3}}function tx(){if(ta===4||ta===3){ta=0,Ue();var n=_r,s=rl,o=Qs,d=Uv;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?ta=5:(ta=0,rl=_r=null,nx(n,n.pendingLanes));var b=n.pendingLanes;if(b===0&&(jr=null),re(o),s=s.stateNode,Xe&&typeof Xe.onCommitFiberRoot=="function")try{Xe.onCommitFiberRoot(We,s,void 0,(s.current.flags&128)===128)}catch{}if(d!==null){s=I.T,b=L.p,L.p=2,I.T=null;try{for(var x=n.onRecoverableError,B=0;B<d.length;B++){var W=d[B];x(W.value,{componentStack:W.stack})}}finally{I.T=s,L.p=b}}(Qs&3)!==0&&yu(),Cs(n),b=n.pendingLanes,(o&261930)!==0&&(b&42)!==0?n===Xm?yo++:(yo=0,Xm=n):yo=0,go(0)}}function nx(n,s){(n.pooledCacheLanes&=s)===0&&(s=n.pooledCache,s!=null&&(n.pooledCache=null,Wl(s)))}function yu(){return Jv(),ex(),tx(),ax()}function ax(){if(ta!==5)return!1;var n=_r,s=Ym;Ym=0;var o=re(Qs),d=I.T,b=L.p;try{L.p=32>o?32:o,I.T=null,o=Gm,Gm=null;var x=_r,B=Qs;if(ta=0,rl=_r=null,Qs=0,(_n&6)!==0)throw Error(i(331));var W=_n;if(_n|=4,$v(x.current),Lv(x,x.current,B,o),_n=W,go(0,!1),Xe&&typeof Xe.onPostCommitFiberRoot=="function")try{Xe.onPostCommitFiberRoot(We,x)}catch{}return!0}finally{L.p=b,I.T=d,nx(n,s)}}function sx(n,s,o){s=Za(o,s),s=_m(n.stateNode,s,2),n=vr(n,s,2),n!==null&&(te(n,2),Cs(n))}function Tn(n,s,o){if(n.tag===3)sx(n,n,o);else for(;s!==null;){if(s.tag===3){sx(s,n,o);break}else if(s.tag===1){var d=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(jr===null||!jr.has(d))){n=Za(o,n),o=rv(2),d=vr(s,o,2),d!==null&&(iv(o,d,s,n),te(d,2),Cs(d));break}}s=s.return}}function Zm(n,s,o){var d=n.pingCache;if(d===null){d=n.pingCache=new __;var b=new Set;d.set(s,b)}else b=d.get(s),b===void 0&&(b=new Set,d.set(s,b));b.has(o)||(Hm=!0,b.add(o),n=R_.bind(null,n,s,o),s.then(n,n))}function R_(n,s,o){var d=n.pingCache;d!==null&&d.delete(s),n.pingedLanes|=n.suspendedLanes&o,n.warmLanes&=~o,In===n&&(yn&o)===o&&(Vn===4||Vn===3&&(yn&62914560)===yn&&300>Je()-uu?(_n&2)===0&&il(n,0):Pm|=o,sl===yn&&(sl=0)),Cs(n)}function rx(n,s){s===0&&(s=$t()),n=ri(n,s),n!==null&&(te(n,s),Cs(n))}function k_(n){var s=n.memoizedState,o=0;s!==null&&(o=s.retryLane),rx(n,o)}function D_(n,s){var o=0;switch(n.tag){case 31:case 13:var d=n.stateNode,b=n.memoizedState;b!==null&&(o=b.retryLane);break;case 19:d=n.stateNode;break;case 22:d=n.stateNode._retryCache;break;default:throw Error(i(314))}d!==null&&d.delete(s),rx(n,o)}function I_(n,s){return Tt(n,s)}var gu=null,ol=null,Qm=!1,bu=!1,Jm=!1,Ar=0;function Cs(n){n!==ol&&n.next===null&&(ol===null?gu=ol=n:ol=ol.next=n),bu=!0,Qm||(Qm=!0,O_())}function go(n,s){if(!Jm&&bu){Jm=!0;do for(var o=!1,d=gu;d!==null;){if(n!==0){var b=d.pendingLanes;if(b===0)var x=0;else{var B=d.suspendedLanes,W=d.pingedLanes;x=(1<<31-Te(42|n)+1)-1,x&=b&~(B&~W),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(o=!0,cx(d,x))}else x=yn,x=Jt(d,d===In?x:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(x&3)===0||Et(d,x)||(o=!0,cx(d,x));d=d.next}while(o);Jm=!1}}function L_(){ix()}function ix(){bu=Qm=!1;var n=0;Ar!==0&&Y_()&&(n=Ar);for(var s=Je(),o=null,d=gu;d!==null;){var b=d.next,x=lx(d,s);x===0?(d.next=null,o===null?gu=b:o.next=b,b===null&&(ol=o)):(o=d,(n!==0||(x&3)!==0)&&(bu=!0)),d=b}ta!==0&&ta!==5||go(n),Ar!==0&&(Ar=0)}function lx(n,s){for(var o=n.suspendedLanes,d=n.pingedLanes,b=n.expirationTimes,x=n.pendingLanes&-62914561;0<x;){var B=31-Te(x),W=1<<B,pe=b[B];pe===-1?((W&o)===0||(W&d)!==0)&&(b[B]=zt(W,s)):pe<=s&&(n.expiredLanes|=W),x&=~W}if(s=In,o=yn,o=Jt(n,n===s?o:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),d=n.callbackNode,o===0||n===s&&(An===2||An===9)||n.cancelPendingCommit!==null)return d!==null&&d!==null&&Ct(d),n.callbackNode=null,n.callbackPriority=0;if((o&3)===0||Et(n,o)){if(s=o&-o,s===n.callbackPriority)return s;switch(d!==null&&Ct(d),re(o)){case 2:case 8:o=ye;break;case 32:o=Ve;break;case 268435456:o=me;break;default:o=Ve}return d=ox.bind(null,n),o=Tt(o,d),n.callbackPriority=s,n.callbackNode=o,s}return d!==null&&d!==null&&Ct(d),n.callbackPriority=2,n.callbackNode=null,2}function ox(n,s){if(ta!==0&&ta!==5)return n.callbackNode=null,n.callbackPriority=0,null;var o=n.callbackNode;if(yu()&&n.callbackNode!==o)return null;var d=yn;return d=Jt(n,n===In?d:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),d===0?null:(Hv(n,d,s),lx(n,Je()),n.callbackNode!=null&&n.callbackNode===o?ox.bind(null,n):null)}function cx(n,s){if(yu())return null;Hv(n,s,!0)}function O_(){X_(function(){(_n&6)!==0?Tt(ue,L_):ix()})}function eh(){if(Ar===0){var n=Gi;n===0&&(n=Ge,Ge<<=1,(Ge&261888)===0&&(Ge=256)),Ar=n}return Ar}function ux(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:Bn(""+n)}function dx(n,s){var o=s.ownerDocument.createElement("input");return o.name=s.name,o.value=s.value,n.id&&o.setAttribute("form",n.id),s.parentNode.insertBefore(o,s),n=new FormData(n),o.parentNode.removeChild(o),n}function z_(n,s,o,d,b){if(s==="submit"&&o&&o.stateNode===b){var x=ux((b[Ee]||null).action),B=d.submitter;B&&(s=(s=B[Ee]||null)?ux(s.formAction):B.getAttribute("formAction"),s!==null&&(x=s,B=null));var W=new Mc("action","action",null,d,b);n.push({event:W,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(Ar!==0){var pe=B?dx(b,B):new FormData(b);xm(o,{pending:!0,data:pe,method:b.method,action:x},null,pe)}}else typeof x=="function"&&(W.preventDefault(),pe=B?dx(b,B):new FormData(b),xm(o,{pending:!0,data:pe,method:b.method,action:x},x,pe))},currentTarget:b}]})}}for(var th=0;th<zf.length;th++){var nh=zf[th],$_=nh.toLowerCase(),F_=nh[0].toUpperCase()+nh.slice(1);us($_,"on"+F_)}us(qg,"onAnimationEnd"),us(Hg,"onAnimationIteration"),us(Pg,"onAnimationStart"),us("dblclick","onDoubleClick"),us("focusin","onFocus"),us("focusout","onBlur"),us(t_,"onTransitionRun"),us(n_,"onTransitionStart"),us(a_,"onTransitionCancel"),us(Vg,"onTransitionEnd"),ae("onMouseEnter",["mouseout","mouseover"]),ae("onMouseLeave",["mouseout","mouseover"]),ae("onPointerEnter",["pointerout","pointerover"]),ae("onPointerLeave",["pointerout","pointerover"]),K("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),K("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),K("onBeforeInput",["compositionend","keypress","textInput","paste"]),K("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),K("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),K("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var bo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),B_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(bo));function fx(n,s){s=(s&4)!==0;for(var o=0;o<n.length;o++){var d=n[o],b=d.event;d=d.listeners;e:{var x=void 0;if(s)for(var B=d.length-1;0<=B;B--){var W=d[B],pe=W.instance,ze=W.currentTarget;if(W=W.listener,pe!==x&&b.isPropagationStopped())break e;x=W,b.currentTarget=ze;try{x(b)}catch(tt){Dc(tt)}b.currentTarget=null,x=pe}else for(B=0;B<d.length;B++){if(W=d[B],pe=W.instance,ze=W.currentTarget,W=W.listener,pe!==x&&b.isPropagationStopped())break e;x=W,b.currentTarget=ze;try{x(b)}catch(tt){Dc(tt)}b.currentTarget=null,x=pe}}}}function hn(n,s){var o=s[le];o===void 0&&(o=s[le]=new Set);var d=n+"__bubble";o.has(d)||(mx(s,n,2,!1),o.add(d))}function ah(n,s,o){var d=0;s&&(d|=4),mx(o,n,d,s)}var vu="_reactListening"+Math.random().toString(36).slice(2);function sh(n){if(!n[vu]){n[vu]=!0,Pe.forEach(function(o){o!=="selectionchange"&&(B_.has(o)||ah(o,!1,n),ah(o,!0,n))});var s=n.nodeType===9?n:n.ownerDocument;s===null||s[vu]||(s[vu]=!0,ah("selectionchange",!1,s))}}function mx(n,s,o,d){switch(qx(s)){case 2:var b=hC;break;case 8:b=pC;break;default:b=vh}o=b.bind(null,s,o,n),b=void 0,!ca||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(b=!0),d?b!==void 0?n.addEventListener(s,o,{capture:!0,passive:b}):n.addEventListener(s,o,!0):b!==void 0?n.addEventListener(s,o,{passive:b}):n.addEventListener(s,o,!1)}function rh(n,s,o,d,b){var x=d;if((s&1)===0&&(s&2)===0&&d!==null)e:for(;;){if(d===null)return;var B=d.tag;if(B===3||B===4){var W=d.stateNode.containerInfo;if(W===b)break;if(B===4)for(B=d.return;B!==null;){var pe=B.tag;if((pe===3||pe===4)&&B.stateNode.containerInfo===b)return;B=B.return}for(;W!==null;){if(B=Ke(W),B===null)return;if(pe=B.tag,pe===5||pe===6||pe===26||pe===27){d=x=B;continue e}W=W.parentNode}}d=d.return}xn(function(){var ze=x,tt=Re(o),lt=[];e:{var Fe=Yg.get(n);if(Fe!==void 0){var Ye=Mc,Ot=n;switch(n){case"keypress":if(Oi(o)===0)break e;case"keydown":case"keyup":Ye=Dj;break;case"focusin":Ot="focus",Ye=Af;break;case"focusout":Ot="blur",Ye=Af;break;case"beforeblur":case"afterblur":Ye=Af;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ye=Sg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ye=Sj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ye=Oj;break;case qg:case Hg:case Pg:Ye=Ej;break;case Vg:Ye=$j;break;case"scroll":case"scrollend":Ye=vj;break;case"wheel":Ye=Bj;break;case"copy":case"cut":case"paste":Ye=_j;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ye=Ng;break;case"toggle":case"beforetoggle":Ye=qj}var Wt=(s&4)!==0,Dn=!Wt&&(n==="scroll"||n==="scrollend"),Ce=Wt?Fe!==null?Fe+"Capture":null:Fe;Wt=[];for(var xe=ze,Oe;xe!==null;){var rt=xe;if(Oe=rt.stateNode,rt=rt.tag,rt!==5&&rt!==26&&rt!==27||Oe===null||Ce===null||(rt=Kt(xe,Ce),rt!=null&&Wt.push(vo(xe,rt,Oe))),Dn)break;xe=xe.return}0<Wt.length&&(Fe=new Ye(Fe,Ot,null,o,tt),lt.push({event:Fe,listeners:Wt}))}}if((s&7)===0){e:{if(Fe=n==="mouseover"||n==="pointerover",Ye=n==="mouseout"||n==="pointerout",Fe&&o!==ge&&(Ot=o.relatedTarget||o.fromElement)&&(Ke(Ot)||Ot[at]))break e;if((Ye||Fe)&&(Fe=tt.window===tt?tt:(Fe=tt.ownerDocument)?Fe.defaultView||Fe.parentWindow:window,Ye?(Ot=o.relatedTarget||o.toElement,Ye=ze,Ot=Ot?Ke(Ot):null,Ot!==null&&(Dn=c(Ot),Wt=Ot.tag,Ot!==Dn||Wt!==5&&Wt!==27&&Wt!==6)&&(Ot=null)):(Ye=null,Ot=ze),Ye!==Ot)){if(Wt=Sg,rt="onMouseLeave",Ce="onMouseEnter",xe="mouse",(n==="pointerout"||n==="pointerover")&&(Wt=Ng,rt="onPointerLeave",Ce="onPointerEnter",xe="pointer"),Dn=Ye==null?Fe:Qe(Ye),Oe=Ot==null?Fe:Qe(Ot),Fe=new Wt(rt,xe+"leave",Ye,o,tt),Fe.target=Dn,Fe.relatedTarget=Oe,rt=null,Ke(tt)===ze&&(Wt=new Wt(Ce,xe+"enter",Ot,o,tt),Wt.target=Oe,Wt.relatedTarget=Dn,rt=Wt),Dn=rt,Ye&&Ot)t:{for(Wt=U_,Ce=Ye,xe=Ot,Oe=0,rt=Ce;rt;rt=Wt(rt))Oe++;rt=0;for(var Vt=xe;Vt;Vt=Wt(Vt))rt++;for(;0<Oe-rt;)Ce=Wt(Ce),Oe--;for(;0<rt-Oe;)xe=Wt(xe),rt--;for(;Oe--;){if(Ce===xe||xe!==null&&Ce===xe.alternate){Wt=Ce;break t}Ce=Wt(Ce),xe=Wt(xe)}Wt=null}else Wt=null;Ye!==null&&hx(lt,Fe,Ye,Wt,!1),Ot!==null&&Dn!==null&&hx(lt,Dn,Ot,Wt,!0)}}e:{if(Fe=ze?Qe(ze):window,Ye=Fe.nodeName&&Fe.nodeName.toLowerCase(),Ye==="select"||Ye==="input"&&Fe.type==="file")var Sn=Rg;else if(Tg(Fe))if(kg)Sn=Qj;else{Sn=Wj;var Ft=Kj}else Ye=Fe.nodeName,!Ye||Ye.toLowerCase()!=="input"||Fe.type!=="checkbox"&&Fe.type!=="radio"?ze&&Pt(ze.elementType)&&(Sn=Rg):Sn=Zj;if(Sn&&(Sn=Sn(n,ze))){Mg(lt,Sn,o,tt);break e}Ft&&Ft(n,Fe,ze),n==="focusout"&&ze&&Fe.type==="number"&&ze.memoizedProps.value!=null&&qn(Fe,"number",Fe.value)}switch(Ft=ze?Qe(ze):window,n){case"focusin":(Tg(Ft)||Ft.contentEditable==="true")&&(Fi=Ft,If=ze,Gl=null);break;case"focusout":Gl=If=Fi=null;break;case"mousedown":Lf=!0;break;case"contextmenu":case"mouseup":case"dragend":Lf=!1,Bg(lt,o,tt);break;case"selectionchange":if(e_)break;case"keydown":case"keyup":Bg(lt,o,tt)}var sn;if(Mf)e:{switch(n){case"compositionstart":var gn="onCompositionStart";break e;case"compositionend":gn="onCompositionEnd";break e;case"compositionupdate":gn="onCompositionUpdate";break e}gn=void 0}else $i?Cg(n,o)&&(gn="onCompositionEnd"):n==="keydown"&&o.keyCode===229&&(gn="onCompositionStart");gn&&(Eg&&o.locale!=="ko"&&($i||gn!=="onCompositionStart"?gn==="onCompositionEnd"&&$i&&(sn=Li()):(Wn=tt,Ka="value"in Wn?Wn.value:Wn.textContent,$i=!0)),Ft=xu(ze,gn),0<Ft.length&&(gn=new wg(gn,n,null,o,tt),lt.push({event:gn,listeners:Ft}),sn?gn.data=sn:(sn=Ag(o),sn!==null&&(gn.data=sn)))),(sn=Pj?Vj(n,o):Yj(n,o))&&(gn=xu(ze,"onBeforeInput"),0<gn.length&&(Ft=new wg("onBeforeInput","beforeinput",null,o,tt),lt.push({event:Ft,listeners:gn}),Ft.data=sn)),z_(lt,n,ze,o,tt)}fx(lt,s)})}function vo(n,s,o){return{instance:n,listener:s,currentTarget:o}}function xu(n,s){for(var o=s+"Capture",d=[];n!==null;){var b=n,x=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||x===null||(b=Kt(n,o),b!=null&&d.unshift(vo(n,b,x)),b=Kt(n,s),b!=null&&d.push(vo(n,b,x))),n.tag===3)return d;n=n.return}return[]}function U_(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function hx(n,s,o,d,b){for(var x=s._reactName,B=[];o!==null&&o!==d;){var W=o,pe=W.alternate,ze=W.stateNode;if(W=W.tag,pe!==null&&pe===d)break;W!==5&&W!==26&&W!==27||ze===null||(pe=ze,b?(ze=Kt(o,x),ze!=null&&B.unshift(vo(o,ze,pe))):b||(ze=Kt(o,x),ze!=null&&B.push(vo(o,ze,pe)))),o=o.return}B.length!==0&&n.push({event:s,listeners:B})}var q_=/\r\n?/g,H_=/\u0000|\uFFFD/g;function px(n){return(typeof n=="string"?n:""+n).replace(q_,`
`).replace(H_,"")}function yx(n,s){return s=px(s),px(n)===s}function kn(n,s,o,d,b,x){switch(o){case"children":typeof d=="string"?s==="body"||s==="textarea"&&d===""||_e(n,d):(typeof d=="number"||typeof d=="bigint")&&s!=="body"&&_e(n,""+d);break;case"className":qt(n,"class",d);break;case"tabIndex":qt(n,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":qt(n,o,d);break;case"style":fn(n,d,x);break;case"data":if(s!=="object"){qt(n,"data",d);break}case"src":case"href":if(d===""&&(s!=="a"||o!=="href")){n.removeAttribute(o);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){n.removeAttribute(o);break}d=Bn(""+d),n.setAttribute(o,d);break;case"action":case"formAction":if(typeof d=="function"){n.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(o==="formAction"?(s!=="input"&&kn(n,s,"name",b.name,b,null),kn(n,s,"formEncType",b.formEncType,b,null),kn(n,s,"formMethod",b.formMethod,b,null),kn(n,s,"formTarget",b.formTarget,b,null)):(kn(n,s,"encType",b.encType,b,null),kn(n,s,"method",b.method,b,null),kn(n,s,"target",b.target,b,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){n.removeAttribute(o);break}d=Bn(""+d),n.setAttribute(o,d);break;case"onClick":d!=null&&(n.onclick=oa);break;case"onScroll":d!=null&&hn("scroll",n);break;case"onScrollEnd":d!=null&&hn("scrollend",n);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(o=d.__html,o!=null){if(b.children!=null)throw Error(i(60));n.innerHTML=o}}break;case"multiple":n.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":n.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){n.removeAttribute("xlink:href");break}o=Bn(""+d),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(o,""+d):n.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(o,""):n.removeAttribute(o);break;case"capture":case"download":d===!0?n.setAttribute(o,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(o,d):n.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?n.setAttribute(o,d):n.removeAttribute(o);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?n.removeAttribute(o):n.setAttribute(o,d);break;case"popover":hn("beforetoggle",n),hn("toggle",n),_t(n,"popover",d);break;case"xlinkActuate":en(n,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":en(n,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":en(n,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":en(n,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":en(n,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":en(n,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":en(n,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":en(n,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":en(n,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":_t(n,"is",d);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=jn.get(o)||o,_t(n,o,d))}}function ih(n,s,o,d,b,x){switch(o){case"style":fn(n,d,x);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(o=d.__html,o!=null){if(b.children!=null)throw Error(i(60));n.innerHTML=o}}break;case"children":typeof d=="string"?_e(n,d):(typeof d=="number"||typeof d=="bigint")&&_e(n,""+d);break;case"onScroll":d!=null&&hn("scroll",n);break;case"onScrollEnd":d!=null&&hn("scrollend",n);break;case"onClick":d!=null&&(n.onclick=oa);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ht.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(b=o.endsWith("Capture"),s=o.slice(2,b?o.length-7:void 0),x=n[Ee]||null,x=x!=null?x[o]:null,typeof x=="function"&&n.removeEventListener(s,x,b),typeof d=="function")){typeof x!="function"&&x!==null&&(o in n?n[o]=null:n.hasAttribute(o)&&n.removeAttribute(o)),n.addEventListener(s,d,b);break e}o in n?n[o]=d:d===!0?n.setAttribute(o,""):_t(n,o,d)}}}function ma(n,s,o){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":hn("error",n),hn("load",n);var d=!1,b=!1,x;for(x in o)if(o.hasOwnProperty(x)){var B=o[x];if(B!=null)switch(x){case"src":d=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:kn(n,s,x,B,o,null)}}b&&kn(n,s,"srcSet",o.srcSet,o,null),d&&kn(n,s,"src",o.src,o,null);return;case"input":hn("invalid",n);var W=x=B=b=null,pe=null,ze=null;for(d in o)if(o.hasOwnProperty(d)){var tt=o[d];if(tt!=null)switch(d){case"name":b=tt;break;case"type":B=tt;break;case"checked":pe=tt;break;case"defaultChecked":ze=tt;break;case"value":x=tt;break;case"defaultValue":W=tt;break;case"children":case"dangerouslySetInnerHTML":if(tt!=null)throw Error(i(137,s));break;default:kn(n,s,d,tt,o,null)}}ti(n,x,W,pe,ze,B,b,!1);return;case"select":hn("invalid",n),d=B=x=null;for(b in o)if(o.hasOwnProperty(b)&&(W=o[b],W!=null))switch(b){case"value":x=W;break;case"defaultValue":B=W;break;case"multiple":d=W;default:kn(n,s,b,W,o,null)}s=x,o=B,n.multiple=!!d,s!=null?La(n,!!d,s,!1):o!=null&&La(n,!!d,o,!0);return;case"textarea":hn("invalid",n),x=b=d=null;for(B in o)if(o.hasOwnProperty(B)&&(W=o[B],W!=null))switch(B){case"value":d=W;break;case"defaultValue":b=W;break;case"children":x=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(i(91));break;default:kn(n,s,B,W,o,null)}ce(n,d,b,x);return;case"option":for(pe in o)if(o.hasOwnProperty(pe)&&(d=o[pe],d!=null))switch(pe){case"selected":n.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:kn(n,s,pe,d,o,null)}return;case"dialog":hn("beforetoggle",n),hn("toggle",n),hn("cancel",n),hn("close",n);break;case"iframe":case"object":hn("load",n);break;case"video":case"audio":for(d=0;d<bo.length;d++)hn(bo[d],n);break;case"image":hn("error",n),hn("load",n);break;case"details":hn("toggle",n);break;case"embed":case"source":case"link":hn("error",n),hn("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ze in o)if(o.hasOwnProperty(ze)&&(d=o[ze],d!=null))switch(ze){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:kn(n,s,ze,d,o,null)}return;default:if(Pt(s)){for(tt in o)o.hasOwnProperty(tt)&&(d=o[tt],d!==void 0&&ih(n,s,tt,d,o,void 0));return}}for(W in o)o.hasOwnProperty(W)&&(d=o[W],d!=null&&kn(n,s,W,d,o,null))}function P_(n,s,o,d){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,x=null,B=null,W=null,pe=null,ze=null,tt=null;for(Ye in o){var lt=o[Ye];if(o.hasOwnProperty(Ye)&&lt!=null)switch(Ye){case"checked":break;case"value":break;case"defaultValue":pe=lt;default:d.hasOwnProperty(Ye)||kn(n,s,Ye,null,d,lt)}}for(var Fe in d){var Ye=d[Fe];if(lt=o[Fe],d.hasOwnProperty(Fe)&&(Ye!=null||lt!=null))switch(Fe){case"type":x=Ye;break;case"name":b=Ye;break;case"checked":ze=Ye;break;case"defaultChecked":tt=Ye;break;case"value":B=Ye;break;case"defaultValue":W=Ye;break;case"children":case"dangerouslySetInnerHTML":if(Ye!=null)throw Error(i(137,s));break;default:Ye!==lt&&kn(n,s,Fe,Ye,d,lt)}}ei(n,B,W,pe,ze,tt,x,b);return;case"select":Ye=B=W=Fe=null;for(x in o)if(pe=o[x],o.hasOwnProperty(x)&&pe!=null)switch(x){case"value":break;case"multiple":Ye=pe;default:d.hasOwnProperty(x)||kn(n,s,x,null,d,pe)}for(b in d)if(x=d[b],pe=o[b],d.hasOwnProperty(b)&&(x!=null||pe!=null))switch(b){case"value":Fe=x;break;case"defaultValue":W=x;break;case"multiple":B=x;default:x!==pe&&kn(n,s,b,x,d,pe)}s=W,o=B,d=Ye,Fe!=null?La(n,!!o,Fe,!1):!!d!=!!o&&(s!=null?La(n,!!o,s,!0):La(n,!!o,o?[]:"",!1));return;case"textarea":Ye=Fe=null;for(W in o)if(b=o[W],o.hasOwnProperty(W)&&b!=null&&!d.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:kn(n,s,W,null,d,b)}for(B in d)if(b=d[B],x=o[B],d.hasOwnProperty(B)&&(b!=null||x!=null))switch(B){case"value":Fe=b;break;case"defaultValue":Ye=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(i(91));break;default:b!==x&&kn(n,s,B,b,d,x)}Ns(n,Fe,Ye);return;case"option":for(var Ot in o)if(Fe=o[Ot],o.hasOwnProperty(Ot)&&Fe!=null&&!d.hasOwnProperty(Ot))switch(Ot){case"selected":n.selected=!1;break;default:kn(n,s,Ot,null,d,Fe)}for(pe in d)if(Fe=d[pe],Ye=o[pe],d.hasOwnProperty(pe)&&Fe!==Ye&&(Fe!=null||Ye!=null))switch(pe){case"selected":n.selected=Fe&&typeof Fe!="function"&&typeof Fe!="symbol";break;default:kn(n,s,pe,Fe,d,Ye)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Wt in o)Fe=o[Wt],o.hasOwnProperty(Wt)&&Fe!=null&&!d.hasOwnProperty(Wt)&&kn(n,s,Wt,null,d,Fe);for(ze in d)if(Fe=d[ze],Ye=o[ze],d.hasOwnProperty(ze)&&Fe!==Ye&&(Fe!=null||Ye!=null))switch(ze){case"children":case"dangerouslySetInnerHTML":if(Fe!=null)throw Error(i(137,s));break;default:kn(n,s,ze,Fe,d,Ye)}return;default:if(Pt(s)){for(var Dn in o)Fe=o[Dn],o.hasOwnProperty(Dn)&&Fe!==void 0&&!d.hasOwnProperty(Dn)&&ih(n,s,Dn,void 0,d,Fe);for(tt in d)Fe=d[tt],Ye=o[tt],!d.hasOwnProperty(tt)||Fe===Ye||Fe===void 0&&Ye===void 0||ih(n,s,tt,Fe,d,Ye);return}}for(var Ce in o)Fe=o[Ce],o.hasOwnProperty(Ce)&&Fe!=null&&!d.hasOwnProperty(Ce)&&kn(n,s,Ce,null,d,Fe);for(lt in d)Fe=d[lt],Ye=o[lt],!d.hasOwnProperty(lt)||Fe===Ye||Fe==null&&Ye==null||kn(n,s,lt,Fe,d,Ye)}function gx(n){switch(n){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function V_(){if(typeof performance.getEntriesByType=="function"){for(var n=0,s=0,o=performance.getEntriesByType("resource"),d=0;d<o.length;d++){var b=o[d],x=b.transferSize,B=b.initiatorType,W=b.duration;if(x&&W&&gx(B)){for(B=0,W=b.responseEnd,d+=1;d<o.length;d++){var pe=o[d],ze=pe.startTime;if(ze>W)break;var tt=pe.transferSize,lt=pe.initiatorType;tt&&gx(lt)&&(pe=pe.responseEnd,B+=tt*(pe<W?1:(W-ze)/(pe-ze)))}if(--d,s+=8*(x+B)/(b.duration/1e3),n++,10<n)break}}if(0<n)return s/n/1e6}return navigator.connection&&(n=navigator.connection.downlink,typeof n=="number")?n:5}var lh=null,oh=null;function Su(n){return n.nodeType===9?n:n.ownerDocument}function bx(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function vx(n,s){if(n===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&s==="foreignObject"?0:n}function ch(n,s){return n==="textarea"||n==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var uh=null;function Y_(){var n=window.event;return n&&n.type==="popstate"?n===uh?!1:(uh=n,!0):(uh=null,!1)}var xx=typeof setTimeout=="function"?setTimeout:void 0,G_=typeof clearTimeout=="function"?clearTimeout:void 0,Sx=typeof Promise=="function"?Promise:void 0,X_=typeof queueMicrotask=="function"?queueMicrotask:typeof Sx<"u"?function(n){return Sx.resolve(null).then(n).catch(K_)}:xx;function K_(n){setTimeout(function(){throw n})}function Tr(n){return n==="head"}function wx(n,s){var o=s,d=0;do{var b=o.nextSibling;if(n.removeChild(o),b&&b.nodeType===8)if(o=b.data,o==="/$"||o==="/&"){if(d===0){n.removeChild(b),fl(s);return}d--}else if(o==="$"||o==="$?"||o==="$~"||o==="$!"||o==="&")d++;else if(o==="html")xo(n.ownerDocument.documentElement);else if(o==="head"){o=n.ownerDocument.head,xo(o);for(var x=o.firstChild;x;){var B=x.nextSibling,W=x.nodeName;x[oe]||W==="SCRIPT"||W==="STYLE"||W==="LINK"&&x.rel.toLowerCase()==="stylesheet"||o.removeChild(x),x=B}}else o==="body"&&xo(n.ownerDocument.body);o=b}while(o);fl(s)}function Nx(n,s){var o=n;n=0;do{var d=o.nextSibling;if(o.nodeType===1?s?(o._stashedDisplay=o.style.display,o.style.display="none"):(o.style.display=o._stashedDisplay||"",o.getAttribute("style")===""&&o.removeAttribute("style")):o.nodeType===3&&(s?(o._stashedText=o.nodeValue,o.nodeValue=""):o.nodeValue=o._stashedText||""),d&&d.nodeType===8)if(o=d.data,o==="/$"){if(n===0)break;n--}else o!=="$"&&o!=="$?"&&o!=="$~"&&o!=="$!"||n++;o=d}while(o)}function dh(n){var s=n.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var o=s;switch(s=s.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":dh(o),Ze(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}n.removeChild(o)}}function W_(n,s,o,d){for(;n.nodeType===1;){var b=o;if(n.nodeName.toLowerCase()!==s.toLowerCase()){if(!d&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(d){if(!n[oe])switch(s){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(x=n.getAttribute("rel"),x==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(x!==b.rel||n.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||n.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||n.getAttribute("title")!==(b.title==null?null:b.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(x=n.getAttribute("src"),(x!==(b.src==null?null:b.src)||n.getAttribute("type")!==(b.type==null?null:b.type)||n.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&x&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(s==="input"&&n.type==="hidden"){var x=b.name==null?null:""+b.name;if(b.type==="hidden"&&n.getAttribute("name")===x)return n}else return n;if(n=ns(n.nextSibling),n===null)break}return null}function Z_(n,s,o){if(s==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!o||(n=ns(n.nextSibling),n===null))return null;return n}function Ex(n,s){for(;n.nodeType!==8;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!s||(n=ns(n.nextSibling),n===null))return null;return n}function fh(n){return n.data==="$?"||n.data==="$~"}function mh(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState!=="loading"}function Q_(n,s){var o=n.ownerDocument;if(n.data==="$~")n._reactRetry=s;else if(n.data!=="$?"||o.readyState!=="loading")s();else{var d=function(){s(),o.removeEventListener("DOMContentLoaded",d)};o.addEventListener("DOMContentLoaded",d),n._reactRetry=d}}function ns(n){for(;n!=null;n=n.nextSibling){var s=n.nodeType;if(s===1||s===3)break;if(s===8){if(s=n.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return n}var hh=null;function jx(n){n=n.nextSibling;for(var s=0;n;){if(n.nodeType===8){var o=n.data;if(o==="/$"||o==="/&"){if(s===0)return ns(n.nextSibling);s--}else o!=="$"&&o!=="$!"&&o!=="$?"&&o!=="$~"&&o!=="&"||s++}n=n.nextSibling}return null}function _x(n){n=n.previousSibling;for(var s=0;n;){if(n.nodeType===8){var o=n.data;if(o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"){if(s===0)return n;s--}else o!=="/$"&&o!=="/&"||s++}n=n.previousSibling}return null}function Cx(n,s,o){switch(s=Su(o),n){case"html":if(n=s.documentElement,!n)throw Error(i(452));return n;case"head":if(n=s.head,!n)throw Error(i(453));return n;case"body":if(n=s.body,!n)throw Error(i(454));return n;default:throw Error(i(451))}}function xo(n){for(var s=n.attributes;s.length;)n.removeAttributeNode(s[0]);Ze(n)}var as=new Map,Ax=new Set;function wu(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var Js=L.d;L.d={f:J_,r:eC,D:tC,C:nC,L:aC,m:sC,X:iC,S:rC,M:lC};function J_(){var n=Js.f(),s=mu();return n||s}function eC(n){var s=ft(n);s!==null&&s.tag===5&&s.type==="form"?Vb(s):Js.r(n)}var cl=typeof document>"u"?null:document;function Tx(n,s,o){var d=cl;if(d&&typeof s=="string"&&s){var b=la(s);b='link[rel="'+n+'"][href="'+b+'"]',typeof o=="string"&&(b+='[crossorigin="'+o+'"]'),Ax.has(b)||(Ax.add(b),n={rel:n,crossOrigin:o,href:s},d.querySelector(b)===null&&(s=d.createElement("link"),ma(s,"link",n),ke(s),d.head.appendChild(s)))}}function tC(n){Js.D(n),Tx("dns-prefetch",n,null)}function nC(n,s){Js.C(n,s),Tx("preconnect",n,s)}function aC(n,s,o){Js.L(n,s,o);var d=cl;if(d&&n&&s){var b='link[rel="preload"][as="'+la(s)+'"]';s==="image"&&o&&o.imageSrcSet?(b+='[imagesrcset="'+la(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(b+='[imagesizes="'+la(o.imageSizes)+'"]')):b+='[href="'+la(n)+'"]';var x=b;switch(s){case"style":x=ul(n);break;case"script":x=dl(n)}as.has(x)||(n=g({rel:"preload",href:s==="image"&&o&&o.imageSrcSet?void 0:n,as:s},o),as.set(x,n),d.querySelector(b)!==null||s==="style"&&d.querySelector(So(x))||s==="script"&&d.querySelector(wo(x))||(s=d.createElement("link"),ma(s,"link",n),ke(s),d.head.appendChild(s)))}}function sC(n,s){Js.m(n,s);var o=cl;if(o&&n){var d=s&&typeof s.as=="string"?s.as:"script",b='link[rel="modulepreload"][as="'+la(d)+'"][href="'+la(n)+'"]',x=b;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=dl(n)}if(!as.has(x)&&(n=g({rel:"modulepreload",href:n},s),as.set(x,n),o.querySelector(b)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(wo(x)))return}d=o.createElement("link"),ma(d,"link",n),ke(d),o.head.appendChild(d)}}}function rC(n,s,o){Js.S(n,s,o);var d=cl;if(d&&n){var b=pt(d).hoistableStyles,x=ul(n);s=s||"default";var B=b.get(x);if(!B){var W={loading:0,preload:null};if(B=d.querySelector(So(x)))W.loading=5;else{n=g({rel:"stylesheet",href:n,"data-precedence":s},o),(o=as.get(x))&&ph(n,o);var pe=B=d.createElement("link");ke(pe),ma(pe,"link",n),pe._p=new Promise(function(ze,tt){pe.onload=ze,pe.onerror=tt}),pe.addEventListener("load",function(){W.loading|=1}),pe.addEventListener("error",function(){W.loading|=2}),W.loading|=4,Nu(B,s,d)}B={type:"stylesheet",instance:B,count:1,state:W},b.set(x,B)}}}function iC(n,s){Js.X(n,s);var o=cl;if(o&&n){var d=pt(o).hoistableScripts,b=dl(n),x=d.get(b);x||(x=o.querySelector(wo(b)),x||(n=g({src:n,async:!0},s),(s=as.get(b))&&yh(n,s),x=o.createElement("script"),ke(x),ma(x,"link",n),o.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},d.set(b,x))}}function lC(n,s){Js.M(n,s);var o=cl;if(o&&n){var d=pt(o).hoistableScripts,b=dl(n),x=d.get(b);x||(x=o.querySelector(wo(b)),x||(n=g({src:n,async:!0,type:"module"},s),(s=as.get(b))&&yh(n,s),x=o.createElement("script"),ke(x),ma(x,"link",n),o.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},d.set(b,x))}}function Mx(n,s,o,d){var b=(b=Z.current)?wu(b):null;if(!b)throw Error(i(446));switch(n){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(s=ul(o.href),o=pt(b).hoistableStyles,d=o.get(s),d||(d={type:"style",instance:null,count:0,state:null},o.set(s,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){n=ul(o.href);var x=pt(b).hoistableStyles,B=x.get(n);if(B||(b=b.ownerDocument||b,B={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(n,B),(x=b.querySelector(So(n)))&&!x._p&&(B.instance=x,B.state.loading=5),as.has(n)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},as.set(n,o),x||oC(b,n,o,B.state))),s&&d===null)throw Error(i(528,""));return B}if(s&&d!==null)throw Error(i(529,""));return null;case"script":return s=o.async,o=o.src,typeof o=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=dl(o),o=pt(b).hoistableScripts,d=o.get(s),d||(d={type:"script",instance:null,count:0,state:null},o.set(s,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,n))}}function ul(n){return'href="'+la(n)+'"'}function So(n){return'link[rel="stylesheet"]['+n+"]"}function Rx(n){return g({},n,{"data-precedence":n.precedence,precedence:null})}function oC(n,s,o,d){n.querySelector('link[rel="preload"][as="style"]['+s+"]")?d.loading=1:(s=n.createElement("link"),d.preload=s,s.addEventListener("load",function(){return d.loading|=1}),s.addEventListener("error",function(){return d.loading|=2}),ma(s,"link",o),ke(s),n.head.appendChild(s))}function dl(n){return'[src="'+la(n)+'"]'}function wo(n){return"script[async]"+n}function kx(n,s,o){if(s.count++,s.instance===null)switch(s.type){case"style":var d=n.querySelector('style[data-href~="'+la(o.href)+'"]');if(d)return s.instance=d,ke(d),d;var b=g({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return d=(n.ownerDocument||n).createElement("style"),ke(d),ma(d,"style",b),Nu(d,o.precedence,n),s.instance=d;case"stylesheet":b=ul(o.href);var x=n.querySelector(So(b));if(x)return s.state.loading|=4,s.instance=x,ke(x),x;d=Rx(o),(b=as.get(b))&&ph(d,b),x=(n.ownerDocument||n).createElement("link"),ke(x);var B=x;return B._p=new Promise(function(W,pe){B.onload=W,B.onerror=pe}),ma(x,"link",d),s.state.loading|=4,Nu(x,o.precedence,n),s.instance=x;case"script":return x=dl(o.src),(b=n.querySelector(wo(x)))?(s.instance=b,ke(b),b):(d=o,(b=as.get(x))&&(d=g({},o),yh(d,b)),n=n.ownerDocument||n,b=n.createElement("script"),ke(b),ma(b,"link",d),n.head.appendChild(b),s.instance=b);case"void":return null;default:throw Error(i(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(d=s.instance,s.state.loading|=4,Nu(d,o.precedence,n));return s.instance}function Nu(n,s,o){for(var d=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=d.length?d[d.length-1]:null,x=b,B=0;B<d.length;B++){var W=d[B];if(W.dataset.precedence===s)x=W;else if(x!==b)break}x?x.parentNode.insertBefore(n,x.nextSibling):(s=o.nodeType===9?o.head:o,s.insertBefore(n,s.firstChild))}function ph(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.title==null&&(n.title=s.title)}function yh(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.integrity==null&&(n.integrity=s.integrity)}var Eu=null;function Dx(n,s,o){if(Eu===null){var d=new Map,b=Eu=new Map;b.set(o,d)}else b=Eu,d=b.get(o),d||(d=new Map,b.set(o,d));if(d.has(n))return d;for(d.set(n,null),o=o.getElementsByTagName(n),b=0;b<o.length;b++){var x=o[b];if(!(x[oe]||x[dt]||n==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var B=x.getAttribute(s)||"";B=n+B;var W=d.get(B);W?W.push(x):d.set(B,[x])}}return d}function Ix(n,s,o){n=n.ownerDocument||n,n.head.insertBefore(o,s==="title"?n.querySelector("head > title"):null)}function cC(n,s,o){if(o===1||s.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return n=s.disabled,typeof s.precedence=="string"&&n==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Lx(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}function uC(n,s,o,d){if(o.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var b=ul(d.href),x=s.querySelector(So(b));if(x){s=x._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(n.count++,n=ju.bind(n),s.then(n,n)),o.state.loading|=4,o.instance=x,ke(x);return}x=s.ownerDocument||s,d=Rx(d),(b=as.get(b))&&ph(d,b),x=x.createElement("link"),ke(x);var B=x;B._p=new Promise(function(W,pe){B.onload=W,B.onerror=pe}),ma(x,"link",d),o.instance=x}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(o,s),(s=o.state.preload)&&(o.state.loading&3)===0&&(n.count++,o=ju.bind(n),s.addEventListener("load",o),s.addEventListener("error",o))}}var gh=0;function dC(n,s){return n.stylesheets&&n.count===0&&Cu(n,n.stylesheets),0<n.count||0<n.imgCount?function(o){var d=setTimeout(function(){if(n.stylesheets&&Cu(n,n.stylesheets),n.unsuspend){var x=n.unsuspend;n.unsuspend=null,x()}},6e4+s);0<n.imgBytes&&gh===0&&(gh=62500*V_());var b=setTimeout(function(){if(n.waitingForImages=!1,n.count===0&&(n.stylesheets&&Cu(n,n.stylesheets),n.unsuspend)){var x=n.unsuspend;n.unsuspend=null,x()}},(n.imgBytes>gh?50:800)+s);return n.unsuspend=o,function(){n.unsuspend=null,clearTimeout(d),clearTimeout(b)}}:null}function ju(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Cu(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var _u=null;function Cu(n,s){n.stylesheets=null,n.unsuspend!==null&&(n.count++,_u=new Map,s.forEach(fC,n),_u=null,ju.call(n))}function fC(n,s){if(!(s.state.loading&4)){var o=_u.get(n);if(o)var d=o.get(null);else{o=new Map,_u.set(n,o);for(var b=n.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<b.length;x++){var B=b[x];(B.nodeName==="LINK"||B.getAttribute("media")!=="not all")&&(o.set(B.dataset.precedence,B),d=B)}d&&o.set(null,d)}b=s.instance,B=b.getAttribute("data-precedence"),x=o.get(B)||d,x===d&&o.set(null,b),o.set(B,b),this.count++,d=ju.bind(this),b.addEventListener("load",d),b.addEventListener("error",d),x?x.parentNode.insertBefore(b,x.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(b,n.firstChild)),s.state.loading|=4}}var No={$$typeof:O,Provider:null,Consumer:null,_currentValue:$,_currentValue2:$,_threadCount:0};function mC(n,s,o,d,b,x,B,W,pe){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=kt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kt(0),this.hiddenUpdates=kt(null),this.identifierPrefix=d,this.onUncaughtError=b,this.onCaughtError=x,this.onRecoverableError=B,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=pe,this.incompleteTransitions=new Map}function Ox(n,s,o,d,b,x,B,W,pe,ze,tt,lt){return n=new mC(n,s,o,B,pe,ze,tt,lt,W),s=1,x===!0&&(s|=24),x=za(3,null,null,s),n.current=x,x.stateNode=n,s=Wf(),s.refCount++,n.pooledCache=s,s.refCount++,x.memoizedState={element:d,isDehydrated:o,cache:s},em(x),n}function zx(n){return n?(n=qi,n):qi}function $x(n,s,o,d,b,x){b=zx(b),d.context===null?d.context=b:d.pendingContext=b,d=br(s),d.payload={element:o},x=x===void 0?null:x,x!==null&&(d.callback=x),o=vr(n,d,s),o!==null&&(Ta(o,n,s),eo(o,n,s))}function Fx(n,s){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var o=n.retryLane;n.retryLane=o!==0&&o<s?o:s}}function bh(n,s){Fx(n,s),(n=n.alternate)&&Fx(n,s)}function Bx(n){if(n.tag===13||n.tag===31){var s=ri(n,67108864);s!==null&&Ta(s,n,67108864),bh(n,67108864)}}function Ux(n){if(n.tag===13||n.tag===31){var s=qa();s=xt(s);var o=ri(n,s);o!==null&&Ta(o,n,s),bh(n,s)}}var Au=!0;function hC(n,s,o,d){var b=I.T;I.T=null;var x=L.p;try{L.p=2,vh(n,s,o,d)}finally{L.p=x,I.T=b}}function pC(n,s,o,d){var b=I.T;I.T=null;var x=L.p;try{L.p=8,vh(n,s,o,d)}finally{L.p=x,I.T=b}}function vh(n,s,o,d){if(Au){var b=xh(d);if(b===null)rh(n,s,d,Tu,o),Hx(n,d);else if(gC(b,n,s,o,d))d.stopPropagation();else if(Hx(n,d),s&4&&-1<yC.indexOf(n)){for(;b!==null;){var x=ft(b);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var B=Bt(x.pendingLanes);if(B!==0){var W=x;for(W.pendingLanes|=2,W.entangledLanes|=2;B;){var pe=1<<31-Te(B);W.entanglements[1]|=pe,B&=~pe}Cs(x),(_n&6)===0&&(du=Je()+500,go(0))}}break;case 31:case 13:W=ri(x,2),W!==null&&Ta(W,x,2),mu(),bh(x,2)}if(x=xh(d),x===null&&rh(n,s,d,Tu,o),x===b)break;b=x}b!==null&&d.stopPropagation()}else rh(n,s,d,null,o)}}function xh(n){return n=Re(n),Sh(n)}var Tu=null;function Sh(n){if(Tu=null,n=Ke(n),n!==null){var s=c(n);if(s===null)n=null;else{var o=s.tag;if(o===13){if(n=f(s),n!==null)return n;n=null}else if(o===31){if(n=m(s),n!==null)return n;n=null}else if(o===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;n=null}else s!==n&&(n=null)}}return Tu=n,null}function qx(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(de()){case ue:return 2;case ye:return 8;case Ve:case ee:return 32;case me:return 268435456;default:return 32}default:return 32}}var wh=!1,Mr=null,Rr=null,kr=null,Eo=new Map,jo=new Map,Dr=[],yC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Hx(n,s){switch(n){case"focusin":case"focusout":Mr=null;break;case"dragenter":case"dragleave":Rr=null;break;case"mouseover":case"mouseout":kr=null;break;case"pointerover":case"pointerout":Eo.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":jo.delete(s.pointerId)}}function _o(n,s,o,d,b,x){return n===null||n.nativeEvent!==x?(n={blockedOn:s,domEventName:o,eventSystemFlags:d,nativeEvent:x,targetContainers:[b]},s!==null&&(s=ft(s),s!==null&&Bx(s)),n):(n.eventSystemFlags|=d,s=n.targetContainers,b!==null&&s.indexOf(b)===-1&&s.push(b),n)}function gC(n,s,o,d,b){switch(s){case"focusin":return Mr=_o(Mr,n,s,o,d,b),!0;case"dragenter":return Rr=_o(Rr,n,s,o,d,b),!0;case"mouseover":return kr=_o(kr,n,s,o,d,b),!0;case"pointerover":var x=b.pointerId;return Eo.set(x,_o(Eo.get(x)||null,n,s,o,d,b)),!0;case"gotpointercapture":return x=b.pointerId,jo.set(x,_o(jo.get(x)||null,n,s,o,d,b)),!0}return!1}function Px(n){var s=Ke(n.target);if(s!==null){var o=c(s);if(o!==null){if(s=o.tag,s===13){if(s=f(o),s!==null){n.blockedOn=s,He(n.priority,function(){Ux(o)});return}}else if(s===31){if(s=m(o),s!==null){n.blockedOn=s,He(n.priority,function(){Ux(o)});return}}else if(s===3&&o.stateNode.current.memoizedState.isDehydrated){n.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Mu(n){if(n.blockedOn!==null)return!1;for(var s=n.targetContainers;0<s.length;){var o=xh(n.nativeEvent);if(o===null){o=n.nativeEvent;var d=new o.constructor(o.type,o);ge=d,o.target.dispatchEvent(d),ge=null}else return s=ft(o),s!==null&&Bx(s),n.blockedOn=o,!1;s.shift()}return!0}function Vx(n,s,o){Mu(n)&&o.delete(s)}function bC(){wh=!1,Mr!==null&&Mu(Mr)&&(Mr=null),Rr!==null&&Mu(Rr)&&(Rr=null),kr!==null&&Mu(kr)&&(kr=null),Eo.forEach(Vx),jo.forEach(Vx)}function Ru(n,s){n.blockedOn===s&&(n.blockedOn=null,wh||(wh=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,bC)))}var ku=null;function Yx(n){ku!==n&&(ku=n,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){ku===n&&(ku=null);for(var s=0;s<n.length;s+=3){var o=n[s],d=n[s+1],b=n[s+2];if(typeof d!="function"){if(Sh(d||o)===null)continue;break}var x=ft(o);x!==null&&(n.splice(s,3),s-=3,xm(x,{pending:!0,data:b,method:o.method,action:d},d,b))}}))}function fl(n){function s(pe){return Ru(pe,n)}Mr!==null&&Ru(Mr,n),Rr!==null&&Ru(Rr,n),kr!==null&&Ru(kr,n),Eo.forEach(s),jo.forEach(s);for(var o=0;o<Dr.length;o++){var d=Dr[o];d.blockedOn===n&&(d.blockedOn=null)}for(;0<Dr.length&&(o=Dr[0],o.blockedOn===null);)Px(o),o.blockedOn===null&&Dr.shift();if(o=(n.ownerDocument||n).$$reactFormReplay,o!=null)for(d=0;d<o.length;d+=3){var b=o[d],x=o[d+1],B=b[Ee]||null;if(typeof x=="function")B||Yx(o);else if(B){var W=null;if(x&&x.hasAttribute("formAction")){if(b=x,B=x[Ee]||null)W=B.formAction;else if(Sh(b)!==null)continue}else W=B.action;typeof W=="function"?o[d+1]=W:(o.splice(d,3),d-=3),Yx(o)}}}function Gx(){function n(x){x.canIntercept&&x.info==="react-transition"&&x.intercept({handler:function(){return new Promise(function(B){return b=B})},focusReset:"manual",scroll:"manual"})}function s(){b!==null&&(b(),b=null),d||setTimeout(o,20)}function o(){if(!d&&!navigation.transition){var x=navigation.currentEntry;x&&x.url!=null&&navigation.navigate(x.url,{state:x.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,b=null;return navigation.addEventListener("navigate",n),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(o,100),function(){d=!0,navigation.removeEventListener("navigate",n),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),b!==null&&(b(),b=null)}}}function Nh(n){this._internalRoot=n}Du.prototype.render=Nh.prototype.render=function(n){var s=this._internalRoot;if(s===null)throw Error(i(409));var o=s.current,d=qa();$x(o,d,n,s,null,null)},Du.prototype.unmount=Nh.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var s=n.containerInfo;$x(n.current,2,null,n,null,null),mu(),s[at]=null}};function Du(n){this._internalRoot=n}Du.prototype.unstable_scheduleHydration=function(n){if(n){var s=je();n={blockedOn:null,target:n,priority:s};for(var o=0;o<Dr.length&&s!==0&&s<Dr[o].priority;o++);Dr.splice(o,0,n),o===0&&Px(n)}};var Xx=t.version;if(Xx!=="19.2.0")throw Error(i(527,Xx,"19.2.0"));L.findDOMNode=function(n){var s=n._reactInternals;if(s===void 0)throw typeof n.render=="function"?Error(i(188)):(n=Object.keys(n).join(","),Error(i(268,n)));return n=p(s),n=n!==null?y(n):null,n=n===null?null:n.stateNode,n};var vC={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:I,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Iu.isDisabled&&Iu.supportsFiber)try{We=Iu.inject(vC),Xe=Iu}catch{}}return Ao.createRoot=function(n,s){if(!l(n))throw Error(i(299));var o=!1,d="",b=tv,x=nv,B=av;return s!=null&&(s.unstable_strictMode===!0&&(o=!0),s.identifierPrefix!==void 0&&(d=s.identifierPrefix),s.onUncaughtError!==void 0&&(b=s.onUncaughtError),s.onCaughtError!==void 0&&(x=s.onCaughtError),s.onRecoverableError!==void 0&&(B=s.onRecoverableError)),s=Ox(n,1,!1,null,null,o,d,null,b,x,B,Gx),n[at]=s.current,sh(n),new Nh(s)},Ao.hydrateRoot=function(n,s,o){if(!l(n))throw Error(i(299));var d=!1,b="",x=tv,B=nv,W=av,pe=null;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(b=o.identifierPrefix),o.onUncaughtError!==void 0&&(x=o.onUncaughtError),o.onCaughtError!==void 0&&(B=o.onCaughtError),o.onRecoverableError!==void 0&&(W=o.onRecoverableError),o.formState!==void 0&&(pe=o.formState)),s=Ox(n,1,!0,s,o??null,d,b,pe,x,B,W,Gx),s.context=zx(null),o=s.current,d=qa(),d=xt(d),b=br(d),b.callback=null,vr(o,b,d),o=d,s.current.lanes=o,te(s,o),Cs(s),n[at]=s.current,sh(n),new Du(s)},Ao.version="19.2.0",Ao}var s0;function AC(){if(s0)return _h.exports;s0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),_h.exports=CC(),_h.exports}var TC=AC();/**
 * react-router v7.9.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Bw=e=>{throw TypeError(e)},MC=(e,t,r)=>t.has(e)||Bw("Cannot "+r),Mh=(e,t,r)=>(MC(e,t,"read from private field"),r?r.call(e):t.get(e)),RC=(e,t,r)=>t.has(e)?Bw("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),r0="popstate";function kC(e={}){function t(i,l){let{pathname:c,search:f,hash:m}=i.location;return ac("",{pathname:c,search:f,hash:m},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function r(i,l){return typeof l=="string"?l:Gr(l)}return IC(t,r,null,e)}function rn(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Gn(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function DC(){return Math.random().toString(36).substring(2,10)}function i0(e,t){return{usr:e.state,key:e.key,idx:t}}function ac(e,t,r=null,i){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof t=="string"?Zr(t):t,state:r,key:t&&t.key||i||DC()}}function Gr({pathname:e="/",search:t="",hash:r=""}){return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Zr(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substring(r),e=e.substring(0,r));let i=e.indexOf("?");i>=0&&(t.search=e.substring(i),e=e.substring(0,i)),e&&(t.pathname=e)}return t}function IC(e,t,r,i={}){let{window:l=document.defaultView,v5Compat:c=!1}=i,f=l.history,m="POP",h=null,p=y();p==null&&(p=0,f.replaceState({...f.state,idx:p},""));function y(){return(f.state||{idx:null}).idx}function g(){m="POP";let E=y(),C=E==null?null:E-p;p=E,h&&h({action:m,location:N.location,delta:C})}function v(E,C){m="PUSH";let A=ac(N.location,E,C);p=y()+1;let O=i0(A,p),_=N.createHref(A);try{f.pushState(O,"",_)}catch(R){if(R instanceof DOMException&&R.name==="DataCloneError")throw R;l.location.assign(_)}c&&h&&h({action:m,location:N.location,delta:1})}function S(E,C){m="REPLACE";let A=ac(N.location,E,C);p=y();let O=i0(A,p),_=N.createHref(A);f.replaceState(O,"",_),c&&h&&h({action:m,location:N.location,delta:0})}function w(E){return Uw(E)}let N={get action(){return m},get location(){return e(l,f)},listen(E){if(h)throw new Error("A history only accepts one active listener");return l.addEventListener(r0,g),h=E,()=>{l.removeEventListener(r0,g),h=null}},createHref(E){return t(l,E)},createURL:w,encodeLocation(E){let C=w(E);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:v,replace:S,go(E){return f.go(E)}};return N}function Uw(e,t=!1){let r="http://localhost";typeof window<"u"&&(r=window.location.origin!=="null"?window.location.origin:window.location.href),rn(r,"No window.location.(origin|href) available to create URL");let i=typeof e=="string"?e:Gr(e);return i=i.replace(/ $/,"%20"),!t&&i.startsWith("//")&&(i=r+i),new URL(i,r)}var Go,l0=class{constructor(e){if(RC(this,Go,new Map),e)for(let[t,r]of e)this.set(t,r)}get(e){if(Mh(this,Go).has(e))return Mh(this,Go).get(e);if(e.defaultValue!==void 0)return e.defaultValue;throw new Error("No value found for context")}set(e,t){Mh(this,Go).set(e,t)}};Go=new WeakMap;var LC=new Set(["lazy","caseSensitive","path","id","index","children"]);function OC(e){return LC.has(e)}var zC=new Set(["lazy","caseSensitive","path","id","index","middleware","children"]);function $C(e){return zC.has(e)}function FC(e){return e.index===!0}function sc(e,t,r=[],i={},l=!1){return e.map((c,f)=>{let m=[...r,String(f)],h=typeof c.id=="string"?c.id:m.join("-");if(rn(c.index!==!0||!c.children,"Cannot specify children on an index route"),rn(l||!i[h],`Found a route id collision on id "${h}".  Route id's must be globally unique within Data Router usages`),FC(c)){let p={...c,...t(c),id:h};return i[h]=p,p}else{let p={...c,...t(c),id:h,children:void 0};return i[h]=p,c.children&&(p.children=sc(c.children,t,m,i,l)),p}})}function Ur(e,t,r="/"){return dd(e,t,r,!1)}function dd(e,t,r,i){let l=typeof t=="string"?Zr(t):t,c=Da(l.pathname||"/",r);if(c==null)return null;let f=qw(e);UC(f);let m=null;for(let h=0;m==null&&h<f.length;++h){let p=QC(c);m=WC(f[h],p,i)}return m}function BC(e,t){let{route:r,pathname:i,params:l}=e;return{id:r.id,pathname:i,params:l,data:t[r.id],loaderData:t[r.id],handle:r.handle}}function qw(e,t=[],r=[],i="",l=!1){let c=(f,m,h=l,p)=>{let y={relativePath:p===void 0?f.path||"":p,caseSensitive:f.caseSensitive===!0,childrenIndex:m,route:f};if(y.relativePath.startsWith("/")){if(!y.relativePath.startsWith(i)&&h)return;rn(y.relativePath.startsWith(i),`Absolute route path "${y.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),y.relativePath=y.relativePath.slice(i.length)}let g=ks([i,y.relativePath]),v=r.concat(y);f.children&&f.children.length>0&&(rn(f.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),qw(f.children,t,v,g,h)),!(f.path==null&&!f.index)&&t.push({path:g,score:XC(g,f.index),routesMeta:v})};return e.forEach((f,m)=>{if(f.path===""||!f.path?.includes("?"))c(f,m);else for(let h of Hw(f.path))c(f,m,!0,h)}),t}function Hw(e){let t=e.split("/");if(t.length===0)return[];let[r,...i]=t,l=r.endsWith("?"),c=r.replace(/\?$/,"");if(i.length===0)return l?[c,""]:[c];let f=Hw(i.join("/")),m=[];return m.push(...f.map(h=>h===""?c:[c,h].join("/"))),l&&m.push(...f),m.map(h=>e.startsWith("/")&&h===""?"/":h)}function UC(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:KC(t.routesMeta.map(i=>i.childrenIndex),r.routesMeta.map(i=>i.childrenIndex)))}var qC=/^:[\w-]+$/,HC=3,PC=2,VC=1,YC=10,GC=-2,o0=e=>e==="*";function XC(e,t){let r=e.split("/"),i=r.length;return r.some(o0)&&(i+=GC),t&&(i+=PC),r.filter(l=>!o0(l)).reduce((l,c)=>l+(qC.test(c)?HC:c===""?VC:YC),i)}function KC(e,t){return e.length===t.length&&e.slice(0,-1).every((i,l)=>i===t[l])?e[e.length-1]-t[t.length-1]:0}function WC(e,t,r=!1){let{routesMeta:i}=e,l={},c="/",f=[];for(let m=0;m<i.length;++m){let h=i[m],p=m===i.length-1,y=c==="/"?t:t.slice(c.length)||"/",g=_d({path:h.relativePath,caseSensitive:h.caseSensitive,end:p},y),v=h.route;if(!g&&p&&r&&!i[i.length-1].route.index&&(g=_d({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},y)),!g)return null;Object.assign(l,g.params),f.push({params:l,pathname:ks([c,g.pathname]),pathnameBase:nA(ks([c,g.pathnameBase])),route:v}),g.pathnameBase!=="/"&&(c=ks([c,g.pathnameBase]))}return f}function _d(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,i]=ZC(e.path,e.caseSensitive,e.end),l=t.match(r);if(!l)return null;let c=l[0],f=c.replace(/(.)\/+$/,"$1"),m=l.slice(1);return{params:i.reduce((p,{paramName:y,isOptional:g},v)=>{if(y==="*"){let w=m[v]||"";f=c.slice(0,c.length-w.length).replace(/(.)\/+$/,"$1")}const S=m[v];return g&&!S?p[y]=void 0:p[y]=(S||"").replace(/%2F/g,"/"),p},{}),pathname:c,pathnameBase:f,pattern:e}}function ZC(e,t=!1,r=!0){Gn(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let i=[],l="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,m,h)=>(i.push({paramName:m,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(i.push({paramName:"*"}),l+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?l+="\\/*$":e!==""&&e!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,t?void 0:"i"),i]}function QC(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Gn(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function Da(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,i=e.charAt(r);return i&&i!=="/"?null:e.slice(r)||"/"}function JC({basename:e,pathname:t}){return t==="/"?e:ks([e,t])}function eA(e,t="/"){let{pathname:r,search:i="",hash:l=""}=typeof e=="string"?Zr(e):e;return{pathname:r?r.startsWith("/")?r:tA(r,t):t,search:aA(i),hash:sA(l)}}function tA(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(l=>{l===".."?r.length>1&&r.pop():l!=="."&&r.push(l)}),r.length>1?r.join("/"):"/"}function Rh(e,t,r,i){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Pw(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function Gd(e){let t=Pw(e);return t.map((r,i)=>i===t.length-1?r.pathname:r.pathnameBase)}function Xd(e,t,r,i=!1){let l;typeof e=="string"?l=Zr(e):(l={...e},rn(!l.pathname||!l.pathname.includes("?"),Rh("?","pathname","search",l)),rn(!l.pathname||!l.pathname.includes("#"),Rh("#","pathname","hash",l)),rn(!l.search||!l.search.includes("#"),Rh("#","search","hash",l)));let c=e===""||l.pathname==="",f=c?"/":l.pathname,m;if(f==null)m=r;else{let g=t.length-1;if(!i&&f.startsWith("..")){let v=f.split("/");for(;v[0]==="..";)v.shift(),g-=1;l.pathname=v.join("/")}m=g>=0?t[g]:"/"}let h=eA(l,m),p=f&&f!=="/"&&f.endsWith("/"),y=(c||f===".")&&r.endsWith("/");return!h.pathname.endsWith("/")&&(p||y)&&(h.pathname+="/"),h}var ks=e=>e.join("/").replace(/\/\/+/g,"/"),nA=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),aA=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,sA=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e,Cd=class{constructor(e,t,r,i=!1){this.status=e,this.statusText=t||"",this.internal=i,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}};function rc(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}var Vw=["POST","PUT","PATCH","DELETE"],rA=new Set(Vw),iA=["GET",...Vw],lA=new Set(iA),oA=new Set([301,302,303,307,308]),cA=new Set([307,308]),kh={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},uA={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Si={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},dA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Sy=e=>dA.test(e),fA=e=>({hasErrorBoundary:!!e.hasErrorBoundary}),Yw="remix-router-transitions",Gw=Symbol("ResetLoaderData");function mA(e){const t=e.window?e.window:typeof window<"u"?window:void 0,r=typeof t<"u"&&typeof t.document<"u"&&typeof t.document.createElement<"u";rn(e.routes.length>0,"You must provide a non-empty routes array to createRouter");let i=e.hydrationRouteProperties||[],l=e.mapRouteProperties||fA,c={},f=sc(e.routes,l,void 0,c),m,h=e.basename||"/";h.startsWith("/")||(h=`/${h}`);let p=e.dataStrategy||bA,y={...e.future},g=null,v=new Set,S=null,w=null,N=null,E=e.hydrationData!=null,C=Ur(f,e.history.location,h),A=!1,O=null,_;if(C==null&&!e.patchRoutesOnNavigation){let te=rs(404,{pathname:e.history.location.pathname}),{matches:be,route:ve}=Lu(f);_=!0,C=be,O={[ve.id]:te}}else if(C&&!e.hydrationData&&Et(C,f,e.history.location.pathname).active&&(C=null),C)if(C.some(te=>te.route.lazy))_=!1;else if(!C.some(te=>wy(te.route)))_=!0;else{let te=e.hydrationData?e.hydrationData.loaderData:null,be=e.hydrationData?e.hydrationData.errors:null;if(be){let ve=C.findIndex(Be=>be[Be.route.id]!==void 0);_=C.slice(0,ve+1).every(Be=>!Ip(Be.route,te,be))}else _=C.every(ve=>!Ip(ve.route,te,be))}else{_=!1,C=[];let te=Et(null,f,e.history.location.pathname);te.active&&te.matches&&(A=!0,C=te.matches)}let R,D={historyAction:e.history.action,location:e.history.location,matches:C,initialized:_,navigation:kh,restoreScrollPosition:e.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:e.hydrationData&&e.hydrationData.loaderData||{},actionData:e.hydrationData&&e.hydrationData.actionData||null,errors:e.hydrationData&&e.hydrationData.errors||O,fetchers:new Map,blockers:new Map},j="POP",z=!1,P,X=!1,H=new Map,G=null,V=!1,k=!1,F=new Set,I=new Map,L=0,$=-1,T=new Map,U=new Set,M=new Map,q=new Map,Y=new Set,J=new Map,ie,Z=null;function fe(){if(g=e.history.listen(({action:te,location:be,delta:ve})=>{if(ie){ie(),ie=void 0;return}Gn(J.size===0||ve!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let Be=Nt({currentLocation:D.location,nextLocation:be,historyAction:te});if(Be&&ve!=null){let ot=new Promise(xt=>{ie=xt});e.history.go(ve*-1),Dt(Be,{state:"blocked",location:be,proceed(){Dt(Be,{state:"proceeding",proceed:void 0,reset:void 0,location:be}),ot.then(()=>e.history.go(ve))},reset(){let xt=new Map(D.blockers);xt.set(Be,Si),ne({blockers:xt})}});return}return Ae(te,be)}),r){DA(t,H);let te=()=>IA(t,H);t.addEventListener("pagehide",te),G=()=>t.removeEventListener("pagehide",te)}return D.initialized||Ae("POP",D.location,{initialHydration:!0}),R}function Q(){g&&g(),G&&G(),v.clear(),P&&P.abort(),D.fetchers.forEach((te,be)=>me(be)),D.blockers.forEach((te,be)=>mt(be))}function se(te){return v.add(te),()=>v.delete(te)}function ne(te,be={}){te.matches&&(te.matches=te.matches.map(ot=>{let xt=c[ot.route.id],re=ot.route;return re.element!==xt.element||re.errorElement!==xt.errorElement||re.hydrateFallbackElement!==xt.hydrateFallbackElement?{...ot,route:xt}:ot})),D={...D,...te};let ve=[],Be=[];D.fetchers.forEach((ot,xt)=>{ot.state==="idle"&&(Y.has(xt)?ve.push(xt):Be.push(xt))}),Y.forEach(ot=>{!D.fetchers.has(ot)&&!I.has(ot)&&ve.push(ot)}),[...v].forEach(ot=>ot(D,{deletedFetchers:ve,viewTransitionOpts:be.viewTransitionOpts,flushSync:be.flushSync===!0})),ve.forEach(ot=>me(ot)),Be.forEach(ot=>D.fetchers.delete(ot))}function we(te,be,{flushSync:ve}={}){let Be=D.actionData!=null&&D.navigation.formMethod!=null&&Ma(D.navigation.formMethod)&&D.navigation.state==="loading"&&te.state?._isRedirect!==!0,ot;be.actionData?Object.keys(be.actionData).length>0?ot=be.actionData:ot=null:Be?ot=D.actionData:ot=null;let xt=be.loaderData?b0(D.loaderData,be.loaderData,be.matches||[],be.errors):D.loaderData,re=D.blockers;re.size>0&&(re=new Map(re),re.forEach((dt,Ee)=>re.set(Ee,Si)));let je=V?!1:Jt(te,be.matches||D.matches),He=z===!0||D.navigation.formMethod!=null&&Ma(D.navigation.formMethod)&&te.state?._isRedirect!==!0;m&&(f=m,m=void 0),V||j==="POP"||(j==="PUSH"?e.history.push(te,te.state):j==="REPLACE"&&e.history.replace(te,te.state));let ut;if(j==="POP"){let dt=H.get(D.location.pathname);dt&&dt.has(te.pathname)?ut={currentLocation:D.location,nextLocation:te}:H.has(te.pathname)&&(ut={currentLocation:te,nextLocation:D.location})}else if(X){let dt=H.get(D.location.pathname);dt?dt.add(te.pathname):(dt=new Set([te.pathname]),H.set(D.location.pathname,dt)),ut={currentLocation:D.location,nextLocation:te}}ne({...be,actionData:ot,loaderData:xt,historyAction:j,location:te,initialized:!0,navigation:kh,revalidation:"idle",restoreScrollPosition:je,preventScrollReset:He,blockers:re},{viewTransitionOpts:ut,flushSync:ve===!0}),j="POP",z=!1,X=!1,V=!1,k=!1,Z?.resolve(),Z=null}async function Ie(te,be){if(typeof te=="number"){e.history.go(te);return}let ve=Dp(D.location,D.matches,h,te,be?.fromRouteId,be?.relative),{path:Be,submission:ot,error:xt}=c0(!1,ve,be),re=D.location,je=ac(D.location,Be,be&&be.state);je={...je,...e.history.encodeLocation(je)};let He=be&&be.replace!=null?be.replace:void 0,ut="PUSH";He===!0?ut="REPLACE":He===!1||ot!=null&&Ma(ot.formMethod)&&ot.formAction===D.location.pathname+D.location.search&&(ut="REPLACE");let dt=be&&"preventScrollReset"in be?be.preventScrollReset===!0:void 0,Ee=(be&&be.flushSync)===!0,at=Nt({currentLocation:re,nextLocation:je,historyAction:ut});if(at){Dt(at,{state:"blocked",location:je,proceed(){Dt(at,{state:"proceeding",proceed:void 0,reset:void 0,location:je}),Ie(te,be)},reset(){let le=new Map(D.blockers);le.set(at,Si),ne({blockers:le})}});return}await Ae(ut,je,{submission:ot,pendingError:xt,preventScrollReset:dt,replace:be&&be.replace,enableViewTransition:be&&be.viewTransition,flushSync:Ee})}function Me(){Z||(Z=LA()),de(),ne({revalidation:"loading"});let te=Z.promise;return D.navigation.state==="submitting"?te:D.navigation.state==="idle"?(Ae(D.historyAction,D.location,{startUninterruptedRevalidation:!0}),te):(Ae(j||D.historyAction,D.navigation.location,{overrideNavigation:D.navigation,enableViewTransition:X===!0}),te)}async function Ae(te,be,ve){P&&P.abort(),P=null,j=te,V=(ve&&ve.startUninterruptedRevalidation)===!0,Bt(D.location,D.matches),z=(ve&&ve.preventScrollReset)===!0,X=(ve&&ve.enableViewTransition)===!0;let Be=m||f,ot=ve&&ve.overrideNavigation,xt=ve?.initialHydration&&D.matches&&D.matches.length>0&&!A?D.matches:Ur(Be,be,h),re=(ve&&ve.flushSync)===!0;if(xt&&D.initialized&&!k&&_A(D.location,be)&&!(ve&&ve.submission&&Ma(ve.submission.formMethod))){we(be,{matches:xt},{flushSync:re});return}let je=Et(xt,Be,be.pathname);if(je.active&&je.matches&&(xt=je.matches),!xt){let{error:ct,notFoundMatches:yt,route:oe}=Ge(be.pathname);we(be,{matches:yt,loaderData:{},errors:{[oe.id]:ct}},{flushSync:re});return}P=new AbortController;let He=Sl(e.history,be,P.signal,ve&&ve.submission),ut=e.getContext?await e.getContext():new l0,dt;if(ve&&ve.pendingError)dt=[qr(xt).route.id,{type:"error",error:ve.pendingError}];else if(ve&&ve.submission&&Ma(ve.submission.formMethod)){let ct=await it(He,be,ve.submission,xt,ut,je.active,ve&&ve.initialHydration===!0,{replace:ve.replace,flushSync:re});if(ct.shortCircuited)return;if(ct.pendingActionResult){let[yt,oe]=ct.pendingActionResult;if(Ha(oe)&&rc(oe.error)&&oe.error.status===404){P=null,we(be,{matches:ct.matches,loaderData:{},errors:{[yt]:oe.error}});return}}xt=ct.matches||xt,dt=ct.pendingActionResult,ot=Dh(be,ve.submission),re=!1,je.active=!1,He=Sl(e.history,He.url,He.signal)}let{shortCircuited:Ee,matches:at,loaderData:le,errors:st}=await $e(He,be,xt,ut,je.active,ot,ve&&ve.submission,ve&&ve.fetcherSubmission,ve&&ve.replace,ve&&ve.initialHydration===!0,re,dt);Ee||(P=null,we(be,{matches:at||xt,...v0(dt),loaderData:le,errors:st}))}async function it(te,be,ve,Be,ot,xt,re,je={}){de();let He=RA(be,ve);if(ne({navigation:He},{flushSync:je.flushSync===!0}),xt){let Ee=await zt(Be,be.pathname,te.signal);if(Ee.type==="aborted")return{shortCircuited:!0};if(Ee.type==="error"){if(Ee.partialMatches.length===0){let{matches:le,route:st}=Lu(f);return{matches:le,pendingActionResult:[st.id,{type:"error",error:Ee.error}]}}let at=qr(Ee.partialMatches).route.id;return{matches:Ee.partialMatches,pendingActionResult:[at,{type:"error",error:Ee.error}]}}else if(Ee.matches)Be=Ee.matches;else{let{notFoundMatches:at,error:le,route:st}=Ge(be.pathname);return{matches:at,pendingActionResult:[st.id,{type:"error",error:le}]}}}let ut,dt=fd(Be,be);if(!dt.route.action&&!dt.route.lazy)ut={type:"error",error:rs(405,{method:te.method,pathname:be.pathname,routeId:dt.route.id})};else{let Ee=Nl(l,c,te,Be,dt,re?[]:i,ot),at=await Ue(te,Ee,ot,null);if(ut=at[dt.route.id],!ut){for(let le of Be)if(at[le.route.id]){ut=at[le.route.id];break}}if(te.signal.aborted)return{shortCircuited:!0}}if(Ni(ut)){let Ee;return je&&je.replace!=null?Ee=je.replace:Ee=p0(ut.response.headers.get("Location"),new URL(te.url),h)===D.location.pathname+D.location.search,await At(te,ut,!0,{submission:ve,replace:Ee}),{shortCircuited:!0}}if(Ha(ut)){let Ee=qr(Be,dt.route.id);return(je&&je.replace)!==!0&&(j="PUSH"),{matches:Be,pendingActionResult:[Ee.route.id,ut,dt.route.id]}}return{matches:Be,pendingActionResult:[dt.route.id,ut]}}async function $e(te,be,ve,Be,ot,xt,re,je,He,ut,dt,Ee){let at=xt||Dh(be,re),le=re||je||S0(at),st=!V&&!ut;if(ot){if(st){let Ne=nt(Ee);ne({navigation:at,...Ne!==void 0?{actionData:Ne}:{}},{flushSync:dt})}let ae=await zt(ve,be.pathname,te.signal);if(ae.type==="aborted")return{shortCircuited:!0};if(ae.type==="error"){if(ae.partialMatches.length===0){let{matches:qe,route:gt}=Lu(f);return{matches:qe,loaderData:{},errors:{[gt.id]:ae.error}}}let Ne=qr(ae.partialMatches).route.id;return{matches:ae.partialMatches,loaderData:{},errors:{[Ne]:ae.error}}}else if(ae.matches)ve=ae.matches;else{let{error:Ne,notFoundMatches:qe,route:gt}=Ge(be.pathname);return{matches:qe,loaderData:{},errors:{[gt.id]:Ne}}}}let ct=m||f,{dsMatches:yt,revalidatingFetchers:oe}=u0(te,Be,l,c,e.history,D,ve,le,be,ut?[]:i,ut===!0,k,F,Y,M,U,ct,h,e.patchRoutesOnNavigation!=null,Ee);if($=++L,!e.dataStrategy&&!yt.some(ae=>ae.shouldLoad)&&!yt.some(ae=>ae.route.middleware&&ae.route.middleware.length>0)&&oe.length===0){let ae=Xe();return we(be,{matches:ve,loaderData:{},errors:Ee&&Ha(Ee[1])?{[Ee[0]]:Ee[1].error}:null,...v0(Ee),...ae?{fetchers:new Map(D.fetchers)}:{}},{flushSync:dt}),{shortCircuited:!0}}if(st){let ae={};if(!ot){ae.navigation=at;let Ne=nt(Ee);Ne!==void 0&&(ae.actionData=Ne)}oe.length>0&&(ae.fetchers=Le(oe)),ne(ae,{flushSync:dt})}oe.forEach(ae=>{Se(ae.key),ae.controller&&I.set(ae.key,ae.controller)});let Ze=()=>oe.forEach(ae=>Se(ae.key));P&&P.signal.addEventListener("abort",Ze);let{loaderResults:Ke,fetcherResults:ft}=await Je(yt,oe,te,Be);if(te.signal.aborted)return{shortCircuited:!0};P&&P.signal.removeEventListener("abort",Ze),oe.forEach(ae=>I.delete(ae.key));let Qe=Ou(Ke);if(Qe)return await At(te,Qe.result,!0,{replace:He}),{shortCircuited:!0};if(Qe=Ou(ft),Qe)return U.add(Qe.key),await At(te,Qe.result,!0,{replace:He}),{shortCircuited:!0};let{loaderData:pt,errors:ke}=g0(D,ve,Ke,Ee,oe,ft);ut&&D.errors&&(ke={...D.errors,...ke});let Pe=Xe(),ht=et($),K=Pe||ht||oe.length>0;return{matches:ve,loaderData:pt,errors:ke,...K?{fetchers:new Map(D.fetchers)}:{}}}function nt(te){if(te&&!Ha(te[1]))return{[te[0]]:te[1].data};if(D.actionData)return Object.keys(D.actionData).length===0?null:D.actionData}function Le(te){return te.forEach(be=>{let ve=D.fetchers.get(be.key),Be=To(void 0,ve?ve.data:void 0);D.fetchers.set(be.key,Be)}),new Map(D.fetchers)}async function wt(te,be,ve,Be){Se(te);let ot=(Be&&Be.flushSync)===!0,xt=m||f,re=Dp(D.location,D.matches,h,ve,be,Be?.relative),je=Ur(xt,re,h),He=Et(je,xt,re);if(He.active&&He.matches&&(je=He.matches),!je){ye(te,be,rs(404,{pathname:re}),{flushSync:ot});return}let{path:ut,submission:dt,error:Ee}=c0(!0,re,Be);if(Ee){ye(te,be,Ee,{flushSync:ot});return}let at=e.getContext?await e.getContext():new l0,le=(Be&&Be.preventScrollReset)===!0;if(dt&&Ma(dt.formMethod)){await Tt(te,be,ut,je,at,He.active,ot,le,dt);return}M.set(te,{routeId:be,path:ut}),await Ct(te,be,ut,je,at,He.active,ot,le,dt)}async function Tt(te,be,ve,Be,ot,xt,re,je,He){de(),M.delete(te);let ut=D.fetchers.get(te);ue(te,kA(He,ut),{flushSync:re});let dt=new AbortController,Ee=Sl(e.history,ve,dt.signal,He);if(xt){let St=await zt(Be,new URL(Ee.url).pathname,Ee.signal,te);if(St.type==="aborted")return;if(St.type==="error"){ye(te,be,St.error,{flushSync:re});return}else if(St.matches)Be=St.matches;else{ye(te,be,rs(404,{pathname:ve}),{flushSync:re});return}}let at=fd(Be,ve);if(!at.route.action&&!at.route.lazy){let St=rs(405,{method:He.formMethod,pathname:ve,routeId:be});ye(te,be,St,{flushSync:re});return}I.set(te,dt);let le=L,st=Nl(l,c,Ee,Be,at,i,ot),yt=(await Ue(Ee,st,ot,te))[at.route.id];if(Ee.signal.aborted){I.get(te)===dt&&I.delete(te);return}if(Y.has(te)){if(Ni(yt)||Ha(yt)){ue(te,nr(void 0));return}}else{if(Ni(yt))if(I.delete(te),$>le){ue(te,nr(void 0));return}else return U.add(te),ue(te,To(He)),At(Ee,yt,!1,{fetcherSubmission:He,preventScrollReset:je});if(Ha(yt)){ye(te,be,yt.error);return}}let oe=D.navigation.location||D.location,Ze=Sl(e.history,oe,dt.signal),Ke=m||f,ft=D.navigation.state!=="idle"?Ur(Ke,D.navigation.location,h):D.matches;rn(ft,"Didn't find any matches after fetcher action");let Qe=++L;T.set(te,Qe);let pt=To(He,yt.data);D.fetchers.set(te,pt);let{dsMatches:ke,revalidatingFetchers:Pe}=u0(Ze,ot,l,c,e.history,D,ft,He,oe,i,!1,k,F,Y,M,U,Ke,h,e.patchRoutesOnNavigation!=null,[at.route.id,yt]);Pe.filter(St=>St.key!==te).forEach(St=>{let _t=St.key,qt=D.fetchers.get(_t),en=To(void 0,qt?qt.data:void 0);D.fetchers.set(_t,en),Se(_t),St.controller&&I.set(_t,St.controller)}),ne({fetchers:new Map(D.fetchers)});let ht=()=>Pe.forEach(St=>Se(St.key));dt.signal.addEventListener("abort",ht);let{loaderResults:K,fetcherResults:ae}=await Je(ke,Pe,Ze,ot);if(dt.signal.aborted)return;if(dt.signal.removeEventListener("abort",ht),T.delete(te),I.delete(te),Pe.forEach(St=>I.delete(St.key)),D.fetchers.has(te)){let St=nr(yt.data);D.fetchers.set(te,St)}let Ne=Ou(K);if(Ne)return At(Ze,Ne.result,!1,{preventScrollReset:je});if(Ne=Ou(ae),Ne)return U.add(Ne.key),At(Ze,Ne.result,!1,{preventScrollReset:je});let{loaderData:qe,errors:gt}=g0(D,ft,K,void 0,Pe,ae);et(Qe),D.navigation.state==="loading"&&Qe>$?(rn(j,"Expected pending action"),P&&P.abort(),we(D.navigation.location,{matches:ft,loaderData:qe,errors:gt,fetchers:new Map(D.fetchers)})):(ne({errors:gt,loaderData:b0(D.loaderData,qe,ft,gt),fetchers:new Map(D.fetchers)}),k=!1)}async function Ct(te,be,ve,Be,ot,xt,re,je,He){let ut=D.fetchers.get(te);ue(te,To(He,ut?ut.data:void 0),{flushSync:re});let dt=new AbortController,Ee=Sl(e.history,ve,dt.signal);if(xt){let oe=await zt(Be,new URL(Ee.url).pathname,Ee.signal,te);if(oe.type==="aborted")return;if(oe.type==="error"){ye(te,be,oe.error,{flushSync:re});return}else if(oe.matches)Be=oe.matches;else{ye(te,be,rs(404,{pathname:ve}),{flushSync:re});return}}let at=fd(Be,ve);I.set(te,dt);let le=L,st=Nl(l,c,Ee,Be,at,i,ot),yt=(await Ue(Ee,st,ot,te))[at.route.id];if(I.get(te)===dt&&I.delete(te),!Ee.signal.aborted){if(Y.has(te)){ue(te,nr(void 0));return}if(Ni(yt))if($>le){ue(te,nr(void 0));return}else{U.add(te),await At(Ee,yt,!1,{preventScrollReset:je});return}if(Ha(yt)){ye(te,be,yt.error);return}ue(te,nr(yt.data))}}async function At(te,be,ve,{submission:Be,fetcherSubmission:ot,preventScrollReset:xt,replace:re}={}){be.response.headers.has("X-Remix-Revalidate")&&(k=!0);let je=be.response.headers.get("Location");rn(je,"Expected a Location header on the redirect Response"),je=p0(je,new URL(te.url),h);let He=ac(D.location,je,{_isRedirect:!0});if(r){let st=!1;if(be.response.headers.has("X-Remix-Reload-Document"))st=!0;else if(Sy(je)){const ct=Uw(je,!0);st=ct.origin!==t.location.origin||Da(ct.pathname,h)==null}if(st){re?t.location.replace(je):t.location.assign(je);return}}P=null;let ut=re===!0||be.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:dt,formAction:Ee,formEncType:at}=D.navigation;!Be&&!ot&&dt&&Ee&&at&&(Be=S0(D.navigation));let le=Be||ot;if(cA.has(be.response.status)&&le&&Ma(le.formMethod))await Ae(ut,He,{submission:{...le,formAction:je},preventScrollReset:xt||z,enableViewTransition:ve?X:void 0});else{let st=Dh(He,Be);await Ae(ut,He,{overrideNavigation:st,fetcherSubmission:ot,preventScrollReset:xt||z,enableViewTransition:ve?X:void 0})}}async function Ue(te,be,ve,Be){let ot,xt={};try{ot=await xA(p,te,be,Be,ve,!1)}catch(re){return be.filter(je=>je.shouldLoad).forEach(je=>{xt[je.route.id]={type:"error",error:re}}),xt}if(te.signal.aborted)return xt;for(let[re,je]of Object.entries(ot))if(TA(je)){let He=je.result;xt[re]={type:"redirect",response:EA(He,te,re,be,h)}}else xt[re]=await NA(je);return xt}async function Je(te,be,ve,Be){let ot=Ue(ve,te,Be,null),xt=Promise.all(be.map(async He=>{if(He.matches&&He.match&&He.request&&He.controller){let dt=(await Ue(He.request,He.matches,Be,He.key))[He.match.route.id];return{[He.key]:dt}}else return Promise.resolve({[He.key]:{type:"error",error:rs(404,{pathname:He.path})}})})),re=await ot,je=(await xt).reduce((He,ut)=>Object.assign(He,ut),{});return{loaderResults:re,fetcherResults:je}}function de(){k=!0,M.forEach((te,be)=>{I.has(be)&&F.add(be),Se(be)})}function ue(te,be,ve={}){D.fetchers.set(te,be),ne({fetchers:new Map(D.fetchers)},{flushSync:(ve&&ve.flushSync)===!0})}function ye(te,be,ve,Be={}){let ot=qr(D.matches,be);me(te),ne({errors:{[ot.route.id]:ve},fetchers:new Map(D.fetchers)},{flushSync:(Be&&Be.flushSync)===!0})}function Ve(te){return q.set(te,(q.get(te)||0)+1),Y.has(te)&&Y.delete(te),D.fetchers.get(te)||uA}function ee(te,be){Se(te,be?.reason),ue(te,nr(null))}function me(te){let be=D.fetchers.get(te);I.has(te)&&!(be&&be.state==="loading"&&T.has(te))&&Se(te),M.delete(te),T.delete(te),U.delete(te),Y.delete(te),F.delete(te),D.fetchers.delete(te)}function he(te){let be=(q.get(te)||0)-1;be<=0?(q.delete(te),Y.add(te)):q.set(te,be),ne({fetchers:new Map(D.fetchers)})}function Se(te,be){let ve=I.get(te);ve&&(ve.abort(be),I.delete(te))}function We(te){for(let be of te){let ve=Ve(be),Be=nr(ve.data);D.fetchers.set(be,Be)}}function Xe(){let te=[],be=!1;for(let ve of U){let Be=D.fetchers.get(ve);rn(Be,`Expected fetcher: ${ve}`),Be.state==="loading"&&(U.delete(ve),te.push(ve),be=!0)}return We(te),be}function et(te){let be=[];for(let[ve,Be]of T)if(Be<te){let ot=D.fetchers.get(ve);rn(ot,`Expected fetcher: ${ve}`),ot.state==="loading"&&(Se(ve),T.delete(ve),be.push(ve))}return We(be),be.length>0}function Te(te,be){let ve=D.blockers.get(te)||Si;return J.get(te)!==be&&J.set(te,be),ve}function mt(te){D.blockers.delete(te),J.delete(te)}function Dt(te,be){let ve=D.blockers.get(te)||Si;rn(ve.state==="unblocked"&&be.state==="blocked"||ve.state==="blocked"&&be.state==="blocked"||ve.state==="blocked"&&be.state==="proceeding"||ve.state==="blocked"&&be.state==="unblocked"||ve.state==="proceeding"&&be.state==="unblocked",`Invalid blocker state transition: ${ve.state} -> ${be.state}`);let Be=new Map(D.blockers);Be.set(te,be),ne({blockers:Be})}function Nt({currentLocation:te,nextLocation:be,historyAction:ve}){if(J.size===0)return;J.size>1&&Gn(!1,"A router only supports one blocker at a time");let Be=Array.from(J.entries()),[ot,xt]=Be[Be.length-1],re=D.blockers.get(ot);if(!(re&&re.state==="proceeding")&&xt({currentLocation:te,nextLocation:be,historyAction:ve}))return ot}function Ge(te){let be=rs(404,{pathname:te}),ve=m||f,{matches:Be,route:ot}=Lu(ve);return{notFoundMatches:Be,route:ot,error:be}}function vt(te,be,ve){if(S=te,N=be,w=ve||null,!E&&D.navigation===kh){E=!0;let Be=Jt(D.location,D.matches);Be!=null&&ne({restoreScrollPosition:Be})}return()=>{S=null,N=null,w=null}}function Mt(te,be){return w&&w(te,be.map(Be=>BC(Be,D.loaderData)))||te.key}function Bt(te,be){if(S&&N){let ve=Mt(te,be);S[ve]=N()}}function Jt(te,be){if(S){let ve=Mt(te,be),Be=S[ve];if(typeof Be=="number")return Be}return null}function Et(te,be,ve){if(e.patchRoutesOnNavigation)if(te){if(Object.keys(te[0].params).length>0)return{active:!0,matches:dd(be,ve,h,!0)}}else return{active:!0,matches:dd(be,ve,h,!0)||[]};return{active:!1,matches:null}}async function zt(te,be,ve,Be){if(!e.patchRoutesOnNavigation)return{type:"success",matches:te};let ot=te;for(;;){let xt=m==null,re=m||f,je=c;try{await e.patchRoutesOnNavigation({signal:ve,path:be,matches:ot,fetcherKey:Be,patch:(dt,Ee)=>{ve.aborted||d0(dt,Ee,re,je,l,!1)}})}catch(dt){return{type:"error",error:dt,partialMatches:ot}}finally{xt&&!ve.aborted&&(f=[...f])}if(ve.aborted)return{type:"aborted"};let He=Ur(re,be,h);if(He)return{type:"success",matches:He};let ut=dd(re,be,h,!0);if(!ut||ot.length===ut.length&&ot.every((dt,Ee)=>dt.route.id===ut[Ee].route.id))return{type:"success",matches:null};ot=ut}}function $t(te){c={},m=sc(te,l,void 0,c)}function kt(te,be,ve=!1){let Be=m==null;d0(te,be,m||f,c,l,ve),Be&&(f=[...f],ne({}))}return R={get basename(){return h},get future(){return y},get state(){return D},get routes(){return f},get window(){return t},initialize:fe,subscribe:se,enableScrollRestoration:vt,navigate:Ie,fetch:wt,revalidate:Me,createHref:te=>e.history.createHref(te),encodeLocation:te=>e.history.encodeLocation(te),getFetcher:Ve,resetFetcher:ee,deleteFetcher:he,dispose:Q,getBlocker:Te,deleteBlocker:mt,patchRoutes:kt,_internalFetchControllers:I,_internalSetRoutes:$t,_internalSetStateDoNotUseOrYouWillBreakYourApp(te){ne(te)}},R}function hA(e){return e!=null&&("formData"in e&&e.formData!=null||"body"in e&&e.body!==void 0)}function Dp(e,t,r,i,l,c){let f,m;if(l){f=[];for(let p of t)if(f.push(p),p.route.id===l){m=p;break}}else f=t,m=t[t.length-1];let h=Xd(i||".",Gd(f),Da(e.pathname,r)||e.pathname,c==="path");if(i==null&&(h.search=e.search,h.hash=e.hash),(i==null||i===""||i===".")&&m){let p=Ny(h.search);if(m.route.index&&!p)h.search=h.search?h.search.replace(/^\?/,"?index&"):"?index";else if(!m.route.index&&p){let y=new URLSearchParams(h.search),g=y.getAll("index");y.delete("index"),g.filter(S=>S).forEach(S=>y.append("index",S));let v=y.toString();h.search=v?`?${v}`:""}}return r!=="/"&&(h.pathname=JC({basename:r,pathname:h.pathname})),Gr(h)}function c0(e,t,r){if(!r||!hA(r))return{path:t};if(r.formMethod&&!MA(r.formMethod))return{path:t,error:rs(405,{method:r.formMethod})};let i=()=>({path:t,error:rs(400,{type:"invalid-body"})}),c=(r.formMethod||"get").toUpperCase(),f=Jw(t);if(r.body!==void 0){if(r.formEncType==="text/plain"){if(!Ma(c))return i();let g=typeof r.body=="string"?r.body:r.body instanceof FormData||r.body instanceof URLSearchParams?Array.from(r.body.entries()).reduce((v,[S,w])=>`${v}${S}=${w}
`,""):String(r.body);return{path:t,submission:{formMethod:c,formAction:f,formEncType:r.formEncType,formData:void 0,json:void 0,text:g}}}else if(r.formEncType==="application/json"){if(!Ma(c))return i();try{let g=typeof r.body=="string"?JSON.parse(r.body):r.body;return{path:t,submission:{formMethod:c,formAction:f,formEncType:r.formEncType,formData:void 0,json:g,text:void 0}}}catch{return i()}}}rn(typeof FormData=="function","FormData is not available in this environment");let m,h;if(r.formData)m=Op(r.formData),h=r.formData;else if(r.body instanceof FormData)m=Op(r.body),h=r.body;else if(r.body instanceof URLSearchParams)m=r.body,h=y0(m);else if(r.body==null)m=new URLSearchParams,h=new FormData;else try{m=new URLSearchParams(r.body),h=y0(m)}catch{return i()}let p={formMethod:c,formAction:f,formEncType:r&&r.formEncType||"application/x-www-form-urlencoded",formData:h,json:void 0,text:void 0};if(Ma(p.formMethod))return{path:t,submission:p};let y=Zr(t);return e&&y.search&&Ny(y.search)&&m.append("index",""),y.search=`?${m}`,{path:Gr(y),submission:p}}function u0(e,t,r,i,l,c,f,m,h,p,y,g,v,S,w,N,E,C,A,O){let _=O?Ha(O[1])?O[1].error:O[1].data:void 0,R=l.createURL(c.location),D=l.createURL(h),j;if(y&&c.errors){let V=Object.keys(c.errors)[0];j=f.findIndex(k=>k.route.id===V)}else if(O&&Ha(O[1])){let V=O[0];j=f.findIndex(k=>k.route.id===V)-1}let z=O?O[1].statusCode:void 0,P=z&&z>=400,X={currentUrl:R,currentParams:c.matches[0]?.params||{},nextUrl:D,nextParams:f[0].params,...m,actionResult:_,actionStatus:z},H=f.map((V,k)=>{let{route:F}=V,I=null;if(j!=null&&k>j?I=!1:F.lazy?I=!0:wy(F)?y?I=Ip(F,c.loaderData,c.errors):pA(c.loaderData,c.matches[k],V)&&(I=!0):I=!1,I!==null)return Lp(r,i,e,V,p,t,I);let L=P?!1:g||R.pathname+R.search===D.pathname+D.search||R.search!==D.search||yA(c.matches[k],V),$={...X,defaultShouldRevalidate:L},T=Ad(V,$);return Lp(r,i,e,V,p,t,T,$)}),G=[];return w.forEach((V,k)=>{if(y||!f.some(q=>q.route.id===V.routeId)||S.has(k))return;let F=c.fetchers.get(k),I=F&&F.state!=="idle"&&F.data===void 0,L=Ur(E,V.path,C);if(!L){if(A&&I)return;G.push({key:k,routeId:V.routeId,path:V.path,matches:null,match:null,request:null,controller:null});return}if(N.has(k))return;let $=fd(L,V.path),T=new AbortController,U=Sl(l,V.path,T.signal),M=null;if(v.has(k))v.delete(k),M=Nl(r,i,U,L,$,p,t);else if(I)g&&(M=Nl(r,i,U,L,$,p,t));else{let q={...X,defaultShouldRevalidate:P?!1:g};Ad($,q)&&(M=Nl(r,i,U,L,$,p,t,q))}M&&G.push({key:k,routeId:V.routeId,path:V.path,matches:M,match:$,request:U,controller:T})}),{dsMatches:H,revalidatingFetchers:G}}function wy(e){return e.loader!=null||e.middleware!=null&&e.middleware.length>0}function Ip(e,t,r){if(e.lazy)return!0;if(!wy(e))return!1;let i=t!=null&&e.id in t,l=r!=null&&r[e.id]!==void 0;return!i&&l?!1:typeof e.loader=="function"&&e.loader.hydrate===!0?!0:!i&&!l}function pA(e,t,r){let i=!t||r.route.id!==t.route.id,l=!e.hasOwnProperty(r.route.id);return i||l}function yA(e,t){let r=e.route.path;return e.pathname!==t.pathname||r!=null&&r.endsWith("*")&&e.params["*"]!==t.params["*"]}function Ad(e,t){if(e.route.shouldRevalidate){let r=e.route.shouldRevalidate(t);if(typeof r=="boolean")return r}return t.defaultShouldRevalidate}function d0(e,t,r,i,l,c){let f;if(e){let p=i[e];rn(p,`No route found to patch children into: routeId = ${e}`),p.children||(p.children=[]),f=p.children}else f=r;let m=[],h=[];if(t.forEach(p=>{let y=f.find(g=>Xw(p,g));y?h.push({existingRoute:y,newRoute:p}):m.push(p)}),m.length>0){let p=sc(m,l,[e||"_","patch",String(f?.length||"0")],i);f.push(...p)}if(c&&h.length>0)for(let p=0;p<h.length;p++){let{existingRoute:y,newRoute:g}=h[p],v=y,[S]=sc([g],l,[],{},!0);Object.assign(v,{element:S.element?S.element:v.element,errorElement:S.errorElement?S.errorElement:v.errorElement,hydrateFallbackElement:S.hydrateFallbackElement?S.hydrateFallbackElement:v.hydrateFallbackElement})}}function Xw(e,t){return"id"in e&&"id"in t&&e.id===t.id?!0:e.index===t.index&&e.path===t.path&&e.caseSensitive===t.caseSensitive?(!e.children||e.children.length===0)&&(!t.children||t.children.length===0)?!0:e.children.every((r,i)=>t.children?.some(l=>Xw(r,l))):!1}var f0=new WeakMap,Kw=({key:e,route:t,manifest:r,mapRouteProperties:i})=>{let l=r[t.id];if(rn(l,"No route found in manifest"),!l.lazy||typeof l.lazy!="object")return;let c=l.lazy[e];if(!c)return;let f=f0.get(l);f||(f={},f0.set(l,f));let m=f[e];if(m)return m;let h=(async()=>{let p=OC(e),g=l[e]!==void 0&&e!=="hasErrorBoundary";if(p)Gn(!p,"Route property "+e+" is not a supported lazy route property. This property will be ignored."),f[e]=Promise.resolve();else if(g)Gn(!1,`Route "${l.id}" has a static property "${e}" defined. The lazy property will be ignored.`);else{let v=await c();v!=null&&(Object.assign(l,{[e]:v}),Object.assign(l,i(l)))}typeof l.lazy=="object"&&(l.lazy[e]=void 0,Object.values(l.lazy).every(v=>v===void 0)&&(l.lazy=void 0))})();return f[e]=h,h},m0=new WeakMap;function gA(e,t,r,i,l){let c=r[e.id];if(rn(c,"No route found in manifest"),!e.lazy)return{lazyRoutePromise:void 0,lazyHandlerPromise:void 0};if(typeof e.lazy=="function"){let y=m0.get(c);if(y)return{lazyRoutePromise:y,lazyHandlerPromise:y};let g=(async()=>{rn(typeof e.lazy=="function","No lazy route function found");let v=await e.lazy(),S={};for(let w in v){let N=v[w];if(N===void 0)continue;let E=$C(w),A=c[w]!==void 0&&w!=="hasErrorBoundary";E?Gn(!E,"Route property "+w+" is not a supported property to be returned from a lazy route function. This property will be ignored."):A?Gn(!A,`Route "${c.id}" has a static property "${w}" defined but its lazy function is also returning a value for this property. The lazy route property "${w}" will be ignored.`):S[w]=N}Object.assign(c,S),Object.assign(c,{...i(c),lazy:void 0})})();return m0.set(c,g),g.catch(()=>{}),{lazyRoutePromise:g,lazyHandlerPromise:g}}let f=Object.keys(e.lazy),m=[],h;for(let y of f){if(l&&l.includes(y))continue;let g=Kw({key:y,route:e,manifest:r,mapRouteProperties:i});g&&(m.push(g),y===t&&(h=g))}let p=m.length>0?Promise.all(m).then(()=>{}):void 0;return p?.catch(()=>{}),h?.catch(()=>{}),{lazyRoutePromise:p,lazyHandlerPromise:h}}async function h0(e){let t=e.matches.filter(l=>l.shouldLoad),r={};return(await Promise.all(t.map(l=>l.resolve()))).forEach((l,c)=>{r[t[c].route.id]=l}),r}async function bA(e){return e.matches.some(t=>t.route.middleware)?Ww(e,()=>h0(e)):h0(e)}function Ww(e,t){return vA(e,t,i=>i,CA,r);function r(i,l,c){if(c)return Promise.resolve(Object.assign(c.value,{[l]:{type:"error",result:i}}));{let{matches:f}=e,m=Math.min(Math.max(f.findIndex(p=>p.route.id===l),0),Math.max(f.findIndex(p=>p.unstable_shouldCallHandler()),0)),h=qr(f,f[m].route.id).route.id;return Promise.resolve({[h]:{type:"error",result:i}})}}}async function vA(e,t,r,i,l){let{matches:c,request:f,params:m,context:h}=e,p=c.flatMap(g=>g.route.middleware?g.route.middleware.map(v=>[g.route.id,v]):[]);return await Zw({request:f,params:m,context:h},p,t,r,i,l)}async function Zw(e,t,r,i,l,c,f=0){let{request:m}=e;if(m.signal.aborted)throw m.signal.reason??new Error(`Request aborted: ${m.method} ${m.url}`);let h=t[f];if(!h)return await r();let[p,y]=h,g,v=async()=>{if(g)throw new Error("You may only call `next()` once per middleware");try{return g={value:await Zw(e,t,r,i,l,c,f+1)},g.value}catch(S){return g={value:await c(S,p,g)},g.value}};try{let S=await y(e,v),w=S!=null?i(S):void 0;return l(w)?w:g?w??g.value:(g={value:await v()},g.value)}catch(S){return await c(S,p,g)}}function Qw(e,t,r,i,l){let c=Kw({key:"middleware",route:i.route,manifest:t,mapRouteProperties:e}),f=gA(i.route,Ma(r.method)?"action":"loader",t,e,l);return{middleware:c,route:f.lazyRoutePromise,handler:f.lazyHandlerPromise}}function Lp(e,t,r,i,l,c,f,m=null){let h=!1,p=Qw(e,t,r,i,l);return{...i,_lazyPromises:p,shouldLoad:f,unstable_shouldRevalidateArgs:m,unstable_shouldCallHandler(y){return h=!0,m?typeof y=="boolean"?Ad(i,{...m,defaultShouldRevalidate:y}):Ad(i,m):f},resolve(y){let{lazy:g,loader:v,middleware:S}=i.route,w=h||f||y&&!Ma(r.method)&&(g||v),N=S&&S.length>0&&!v&&!g;return w&&!N?SA({request:r,match:i,lazyHandlerPromise:p?.handler,lazyRoutePromise:p?.route,handlerOverride:y,scopedContext:c}):Promise.resolve({type:"data",result:void 0})}}}function Nl(e,t,r,i,l,c,f,m=null){return i.map(h=>h.route.id!==l.route.id?{...h,shouldLoad:!1,unstable_shouldRevalidateArgs:m,unstable_shouldCallHandler:()=>!1,_lazyPromises:Qw(e,t,r,h,c),resolve:()=>Promise.resolve({type:"data",result:void 0})}:Lp(e,t,r,h,c,f,!0,m))}async function xA(e,t,r,i,l,c){r.some(p=>p._lazyPromises?.middleware)&&await Promise.all(r.map(p=>p._lazyPromises?.middleware));let f={request:t,params:r[0].params,context:l,matches:r},h=await e({...f,fetcherKey:i,runClientMiddleware:p=>{let y=f;return Ww(y,()=>p({...y,fetcherKey:i,runClientMiddleware:()=>{throw new Error("Cannot call `runClientMiddleware()` from within an `runClientMiddleware` handler")}}))}});try{await Promise.all(r.flatMap(p=>[p._lazyPromises?.handler,p._lazyPromises?.route]))}catch{}return h}async function SA({request:e,match:t,lazyHandlerPromise:r,lazyRoutePromise:i,handlerOverride:l,scopedContext:c}){let f,m,h=Ma(e.method),p=h?"action":"loader",y=g=>{let v,S=new Promise((E,C)=>v=C);m=()=>v(),e.signal.addEventListener("abort",m);let w=E=>typeof g!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${p}" [routeId: ${t.route.id}]`)):g({request:e,params:t.params,context:c},...E!==void 0?[E]:[]),N=(async()=>{try{return{type:"data",result:await(l?l(C=>w(C)):w())}}catch(E){return{type:"error",result:E}}})();return Promise.race([N,S])};try{let g=h?t.route.action:t.route.loader;if(r||i)if(g){let v,[S]=await Promise.all([y(g).catch(w=>{v=w}),r,i]);if(v!==void 0)throw v;f=S}else{await r;let v=h?t.route.action:t.route.loader;if(v)[f]=await Promise.all([y(v),i]);else if(p==="action"){let S=new URL(e.url),w=S.pathname+S.search;throw rs(405,{method:e.method,pathname:w,routeId:t.route.id})}else return{type:"data",result:void 0}}else if(g)f=await y(g);else{let v=new URL(e.url),S=v.pathname+v.search;throw rs(404,{pathname:S})}}catch(g){return{type:"error",result:g}}finally{m&&e.signal.removeEventListener("abort",m)}return f}async function wA(e){let t=e.headers.get("Content-Type");return t&&/\bapplication\/json\b/.test(t)?e.body==null?null:e.json():e.text()}async function NA(e){let{result:t,type:r}=e;if(e1(t)){let i;try{i=await wA(t)}catch(l){return{type:"error",error:l}}return r==="error"?{type:"error",error:new Cd(t.status,t.statusText,i),statusCode:t.status,headers:t.headers}:{type:"data",data:i,statusCode:t.status,headers:t.headers}}return r==="error"?x0(t)?t.data instanceof Error?{type:"error",error:t.data,statusCode:t.init?.status,headers:t.init?.headers?new Headers(t.init.headers):void 0}:{type:"error",error:new Cd(t.init?.status||500,void 0,t.data),statusCode:rc(t)?t.status:void 0,headers:t.init?.headers?new Headers(t.init.headers):void 0}:{type:"error",error:t,statusCode:rc(t)?t.status:void 0}:x0(t)?{type:"data",data:t.data,statusCode:t.init?.status,headers:t.init?.headers?new Headers(t.init.headers):void 0}:{type:"data",data:t}}function EA(e,t,r,i,l){let c=e.headers.get("Location");if(rn(c,"Redirects returned/thrown from loaders/actions must have a Location header"),!Sy(c)){let f=i.slice(0,i.findIndex(m=>m.route.id===r)+1);c=Dp(new URL(t.url),f,l,c),e.headers.set("Location",c)}return e}function p0(e,t,r){if(Sy(e)){let i=e,l=i.startsWith("//")?new URL(t.protocol+i):new URL(i),c=Da(l.pathname,r)!=null;if(l.origin===t.origin&&c)return l.pathname+l.search+l.hash}return e}function Sl(e,t,r,i){let l=e.createURL(Jw(t)).toString(),c={signal:r};if(i&&Ma(i.formMethod)){let{formMethod:f,formEncType:m}=i;c.method=f.toUpperCase(),m==="application/json"?(c.headers=new Headers({"Content-Type":m}),c.body=JSON.stringify(i.json)):m==="text/plain"?c.body=i.text:m==="application/x-www-form-urlencoded"&&i.formData?c.body=Op(i.formData):c.body=i.formData}return new Request(l,c)}function Op(e){let t=new URLSearchParams;for(let[r,i]of e.entries())t.append(r,typeof i=="string"?i:i.name);return t}function y0(e){let t=new FormData;for(let[r,i]of e.entries())t.append(r,i);return t}function jA(e,t,r,i=!1,l=!1){let c={},f=null,m,h=!1,p={},y=r&&Ha(r[1])?r[1].error:void 0;return e.forEach(g=>{if(!(g.route.id in t))return;let v=g.route.id,S=t[v];if(rn(!Ni(S),"Cannot handle redirect results in processLoaderData"),Ha(S)){let w=S.error;if(y!==void 0&&(w=y,y=void 0),f=f||{},l)f[v]=w;else{let N=qr(e,v);f[N.route.id]==null&&(f[N.route.id]=w)}i||(c[v]=Gw),h||(h=!0,m=rc(S.error)?S.error.status:500),S.headers&&(p[v]=S.headers)}else c[v]=S.data,S.statusCode&&S.statusCode!==200&&!h&&(m=S.statusCode),S.headers&&(p[v]=S.headers)}),y!==void 0&&r&&(f={[r[0]]:y},r[2]&&(c[r[2]]=void 0)),{loaderData:c,errors:f,statusCode:m||200,loaderHeaders:p}}function g0(e,t,r,i,l,c){let{loaderData:f,errors:m}=jA(t,r,i);return l.filter(h=>!h.matches||h.matches.some(p=>p.shouldLoad)).forEach(h=>{let{key:p,match:y,controller:g}=h;if(g&&g.signal.aborted)return;let v=c[p];if(rn(v,"Did not find corresponding fetcher result"),Ha(v)){let S=qr(e.matches,y?.route.id);m&&m[S.route.id]||(m={...m,[S.route.id]:v.error}),e.fetchers.delete(p)}else if(Ni(v))rn(!1,"Unhandled fetcher revalidation redirect");else{let S=nr(v.data);e.fetchers.set(p,S)}}),{loaderData:f,errors:m}}function b0(e,t,r,i){let l=Object.entries(t).filter(([,c])=>c!==Gw).reduce((c,[f,m])=>(c[f]=m,c),{});for(let c of r){let f=c.route.id;if(!t.hasOwnProperty(f)&&e.hasOwnProperty(f)&&c.route.loader&&(l[f]=e[f]),i&&i.hasOwnProperty(f))break}return l}function v0(e){return e?Ha(e[1])?{actionData:{}}:{actionData:{[e[0]]:e[1].data}}:{}}function qr(e,t){return(t?e.slice(0,e.findIndex(i=>i.route.id===t)+1):[...e]).reverse().find(i=>i.route.hasErrorBoundary===!0)||e[0]}function Lu(e){let t=e.length===1?e[0]:e.find(r=>r.index||!r.path||r.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:t}],route:t}}function rs(e,{pathname:t,routeId:r,method:i,type:l,message:c}={}){let f="Unknown Server Error",m="Unknown @remix-run/router error";return e===400?(f="Bad Request",i&&t&&r?m=`You made a ${i} request to "${t}" but did not provide a \`loader\` for route "${r}", so there is no way to handle the request.`:l==="invalid-body"&&(m="Unable to encode submission body")):e===403?(f="Forbidden",m=`Route "${r}" does not match URL "${t}"`):e===404?(f="Not Found",m=`No route matches URL "${t}"`):e===405&&(f="Method Not Allowed",i&&t&&r?m=`You made a ${i.toUpperCase()} request to "${t}" but did not provide an \`action\` for route "${r}", so there is no way to handle the request.`:i&&(m=`Invalid request method "${i.toUpperCase()}"`)),new Cd(e||500,f,new Error(m),!0)}function Ou(e){let t=Object.entries(e);for(let r=t.length-1;r>=0;r--){let[i,l]=t[r];if(Ni(l))return{key:i,result:l}}}function Jw(e){let t=typeof e=="string"?Zr(e):e;return Gr({...t,hash:""})}function _A(e,t){return e.pathname!==t.pathname||e.search!==t.search?!1:e.hash===""?t.hash!=="":e.hash===t.hash?!0:t.hash!==""}function CA(e){return e!=null&&typeof e=="object"&&Object.entries(e).every(([t,r])=>typeof t=="string"&&AA(r))}function AA(e){return e!=null&&typeof e=="object"&&"type"in e&&"result"in e&&(e.type==="data"||e.type==="error")}function TA(e){return e1(e.result)&&oA.has(e.result.status)}function Ha(e){return e.type==="error"}function Ni(e){return(e&&e.type)==="redirect"}function x0(e){return typeof e=="object"&&e!=null&&"type"in e&&"data"in e&&"init"in e&&e.type==="DataWithResponseInit"}function e1(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.headers=="object"&&typeof e.body<"u"}function MA(e){return lA.has(e.toUpperCase())}function Ma(e){return rA.has(e.toUpperCase())}function Ny(e){return new URLSearchParams(e).getAll("index").some(t=>t==="")}function fd(e,t){let r=typeof t=="string"?Zr(t).search:t.search;if(e[e.length-1].route.index&&Ny(r||""))return e[e.length-1];let i=Pw(e);return i[i.length-1]}function S0(e){let{formMethod:t,formAction:r,formEncType:i,text:l,formData:c,json:f}=e;if(!(!t||!r||!i)){if(l!=null)return{formMethod:t,formAction:r,formEncType:i,formData:void 0,json:void 0,text:l};if(c!=null)return{formMethod:t,formAction:r,formEncType:i,formData:c,json:void 0,text:void 0};if(f!==void 0)return{formMethod:t,formAction:r,formEncType:i,formData:void 0,json:f,text:void 0}}}function Dh(e,t){return t?{state:"loading",location:e,formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text}:{state:"loading",location:e,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function RA(e,t){return{state:"submitting",location:e,formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text}}function To(e,t){return e?{state:"loading",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:t}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function kA(e,t){return{state:"submitting",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:t?t.data:void 0}}function nr(e){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function DA(e,t){try{let r=e.sessionStorage.getItem(Yw);if(r){let i=JSON.parse(r);for(let[l,c]of Object.entries(i||{}))c&&Array.isArray(c)&&t.set(l,new Set(c||[]))}}catch{}}function IA(e,t){if(t.size>0){let r={};for(let[i,l]of t)r[i]=[...l];try{e.sessionStorage.setItem(Yw,JSON.stringify(r))}catch(i){Gn(!1,`Failed to save applied view transitions in sessionStorage (${i}).`)}}}function LA(){let e,t,r=new Promise((i,l)=>{e=async c=>{i(c);try{await r}catch{}},t=async c=>{l(c);try{await r}catch{}}});return{promise:r,resolve:e,reject:t}}var ki=u.createContext(null);ki.displayName="DataRouter";var wc=u.createContext(null);wc.displayName="DataRouterState";u.createContext(!1);var Ey=u.createContext({isTransitioning:!1});Ey.displayName="ViewTransition";var t1=u.createContext(new Map);t1.displayName="Fetchers";var OA=u.createContext(null);OA.displayName="Await";var xs=u.createContext(null);xs.displayName="Navigation";var Kd=u.createContext(null);Kd.displayName="Location";var cs=u.createContext({outlet:null,matches:[],isDataRoute:!1});cs.displayName="Route";var jy=u.createContext(null);jy.displayName="RouteError";function zA(e,{relative:t}={}){rn(Il(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:i}=u.useContext(xs),{hash:l,pathname:c,search:f}=Nc(e,{relative:t}),m=c;return r!=="/"&&(m=c==="/"?r:ks([r,c])),i.createHref({pathname:m,search:f,hash:l})}function Il(){return u.useContext(Kd)!=null}function Xa(){return rn(Il(),"useLocation() may be used only in the context of a <Router> component."),u.useContext(Kd).location}var n1="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function a1(e){u.useContext(xs).static||u.useLayoutEffect(e)}function $n(){let{isDataRoute:e}=u.useContext(cs);return e?ZA():$A()}function $A(){rn(Il(),"useNavigate() may be used only in the context of a <Router> component.");let e=u.useContext(ki),{basename:t,navigator:r}=u.useContext(xs),{matches:i}=u.useContext(cs),{pathname:l}=Xa(),c=JSON.stringify(Gd(i)),f=u.useRef(!1);return a1(()=>{f.current=!0}),u.useCallback((h,p={})=>{if(Gn(f.current,n1),!f.current)return;if(typeof h=="number"){r.go(h);return}let y=Xd(h,JSON.parse(c),l,p.relative==="path");e==null&&t!=="/"&&(y.pathname=y.pathname==="/"?t:ks([t,y.pathname])),(p.replace?r.replace:r.push)(y,p.state,p)},[t,r,c,l,e])}var FA=u.createContext(null);function BA(e){let t=u.useContext(cs).outlet;return u.useMemo(()=>t&&u.createElement(FA.Provider,{value:e},t),[t,e])}function Ss(){let{matches:e}=u.useContext(cs),t=e[e.length-1];return t?t.params:{}}function Nc(e,{relative:t}={}){let{matches:r}=u.useContext(cs),{pathname:i}=Xa(),l=JSON.stringify(Gd(r));return u.useMemo(()=>Xd(e,JSON.parse(l),i,t==="path"),[e,l,i,t])}function UA(e,t,r,i,l){rn(Il(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:c}=u.useContext(xs),{matches:f}=u.useContext(cs),m=f[f.length-1],h=m?m.params:{},p=m?m.pathname:"/",y=m?m.pathnameBase:"/",g=m&&m.route;{let A=g&&g.path||"";l1(p,!g||A.endsWith("*")||A.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${p}" (under <Route path="${A}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${A}"> to <Route path="${A==="/"?"*":`${A}/*`}">.`)}let v=Xa(),S;S=v;let w=S.pathname||"/",N=w;if(y!=="/"){let A=y.replace(/^\//,"").split("/");N="/"+w.replace(/^\//,"").split("/").slice(A.length).join("/")}let E=Ur(e,{pathname:N});return Gn(g||E!=null,`No routes matched location "${S.pathname}${S.search}${S.hash}" `),Gn(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${S.pathname}${S.search}${S.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),YA(E&&E.map(A=>Object.assign({},A,{params:Object.assign({},h,A.params),pathname:ks([y,c.encodeLocation?c.encodeLocation(A.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:A.pathname]),pathnameBase:A.pathnameBase==="/"?y:ks([y,c.encodeLocation?c.encodeLocation(A.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:A.pathnameBase])})),f,r,i,l)}function qA(){let e=KA(),t=rc(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",l={padding:"0.5rem",backgroundColor:i},c={padding:"2px 4px",backgroundColor:i},f=null;return console.error("Error handled by React Router default ErrorBoundary:",e),f=u.createElement(u.Fragment,null,u.createElement("p",null," Hey developer "),u.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",u.createElement("code",{style:c},"ErrorBoundary")," or"," ",u.createElement("code",{style:c},"errorElement")," prop on your route.")),u.createElement(u.Fragment,null,u.createElement("h2",null,"Unexpected Application Error!"),u.createElement("h3",{style:{fontStyle:"italic"}},t),r?u.createElement("pre",{style:l},r):null,f)}var HA=u.createElement(qA,null),PA=class extends u.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.unstable_onError?this.props.unstable_onError(e,t):console.error("React Router caught the following error during render",e)}render(){return this.state.error!==void 0?u.createElement(cs.Provider,{value:this.props.routeContext},u.createElement(jy.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function VA({routeContext:e,match:t,children:r}){let i=u.useContext(ki);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),u.createElement(cs.Provider,{value:e},r)}function YA(e,t=[],r=null,i=null,l=null){if(e==null){if(!r)return null;if(r.errors)e=r.matches;else if(t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let c=e,f=r?.errors;if(f!=null){let p=c.findIndex(y=>y.route.id&&f?.[y.route.id]!==void 0);rn(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(f).join(",")}`),c=c.slice(0,Math.min(c.length,p+1))}let m=!1,h=-1;if(r)for(let p=0;p<c.length;p++){let y=c[p];if((y.route.HydrateFallback||y.route.hydrateFallbackElement)&&(h=p),y.route.id){let{loaderData:g,errors:v}=r,S=y.route.loader&&!g.hasOwnProperty(y.route.id)&&(!v||v[y.route.id]===void 0);if(y.route.lazy||S){m=!0,h>=0?c=c.slice(0,h+1):c=[c[0]];break}}}return c.reduceRight((p,y,g)=>{let v,S=!1,w=null,N=null;r&&(v=f&&y.route.id?f[y.route.id]:void 0,w=y.route.errorElement||HA,m&&(h<0&&g===0?(l1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),S=!0,N=null):h===g&&(S=!0,N=y.route.hydrateFallbackElement||null)));let E=t.concat(c.slice(0,g+1)),C=()=>{let A;return v?A=w:S?A=N:y.route.Component?A=u.createElement(y.route.Component,null):y.route.element?A=y.route.element:A=p,u.createElement(VA,{match:y,routeContext:{outlet:p,matches:E,isDataRoute:r!=null},children:A})};return r&&(y.route.ErrorBoundary||y.route.errorElement||g===0)?u.createElement(PA,{location:r.location,revalidation:r.revalidation,component:w,error:v,children:C(),routeContext:{outlet:null,matches:E,isDataRoute:!0},unstable_onError:i}):C()},null)}function _y(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function s1(e){let t=u.useContext(ki);return rn(t,_y(e)),t}function r1(e){let t=u.useContext(wc);return rn(t,_y(e)),t}function GA(e){let t=u.useContext(cs);return rn(t,_y(e)),t}function Cy(e){let t=GA(e),r=t.matches[t.matches.length-1];return rn(r.route.id,`${e} can only be used on routes that contain a unique "id"`),r.route.id}function XA(){return Cy("useRouteId")}function KA(){let e=u.useContext(jy),t=r1("useRouteError"),r=Cy("useRouteError");return e!==void 0?e:t.errors?.[r]}var WA=0;function i1(e){let{router:t,basename:r}=s1("useBlocker"),i=r1("useBlocker"),[l,c]=u.useState(""),f=u.useCallback(m=>{if(typeof e!="function")return!!e;if(r==="/")return e(m);let{currentLocation:h,nextLocation:p,historyAction:y}=m;return e({currentLocation:{...h,pathname:Da(h.pathname,r)||h.pathname},nextLocation:{...p,pathname:Da(p.pathname,r)||p.pathname},historyAction:y})},[r,e]);return u.useEffect(()=>{let m=String(++WA);return c(m),()=>t.deleteBlocker(m)},[t]),u.useEffect(()=>{l!==""&&t.getBlocker(l,f)},[t,l,f]),l&&i.blockers.has(l)?i.blockers.get(l):Si}function ZA(){let{router:e}=s1("useNavigate"),t=Cy("useNavigate"),r=u.useRef(!1);return a1(()=>{r.current=!0}),u.useCallback(async(l,c={})=>{Gn(r.current,n1),r.current&&(typeof l=="number"?e.navigate(l):await e.navigate(l,{fromRouteId:t,...c}))},[e,t])}var w0={};function l1(e,t,r){!t&&!w0[e]&&(w0[e]=!0,Gn(!1,r))}var N0={};function E0(e,t){!e&&!N0[t]&&(N0[t]=!0,console.warn(t))}function QA(e){let t={hasErrorBoundary:e.hasErrorBoundary||e.ErrorBoundary!=null||e.errorElement!=null};return e.Component&&(e.element&&Gn(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(t,{element:u.createElement(e.Component),Component:void 0})),e.HydrateFallback&&(e.hydrateFallbackElement&&Gn(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(t,{hydrateFallbackElement:u.createElement(e.HydrateFallback),HydrateFallback:void 0})),e.ErrorBoundary&&(e.errorElement&&Gn(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(t,{errorElement:u.createElement(e.ErrorBoundary),ErrorBoundary:void 0})),t}var JA=["HydrateFallback","hydrateFallbackElement"],e2=class{constructor(){this.status="pending",this.promise=new Promise((e,t)=>{this.resolve=r=>{this.status==="pending"&&(this.status="resolved",e(r))},this.reject=r=>{this.status==="pending"&&(this.status="rejected",t(r))}})}};function t2({router:e,flushSync:t,unstable_onError:r}){let[i,l]=u.useState(e.state),[c,f]=u.useState(),[m,h]=u.useState({isTransitioning:!1}),[p,y]=u.useState(),[g,v]=u.useState(),[S,w]=u.useState(),N=u.useRef(new Map),E=u.useCallback(R=>{l(D=>(R.errors&&r&&Object.entries(R.errors).forEach(([j,z])=>{D.errors?.[j]!==z&&r(z)}),R))},[r]),C=u.useCallback((R,{deletedFetchers:D,flushSync:j,viewTransitionOpts:z})=>{R.fetchers.forEach((X,H)=>{X.data!==void 0&&N.current.set(H,X.data)}),D.forEach(X=>N.current.delete(X)),E0(j===!1||t!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let P=e.window!=null&&e.window.document!=null&&typeof e.window.document.startViewTransition=="function";if(E0(z==null||P,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!z||!P){t&&j?t(()=>E(R)):u.startTransition(()=>E(R));return}if(t&&j){t(()=>{g&&(p&&p.resolve(),g.skipTransition()),h({isTransitioning:!0,flushSync:!0,currentLocation:z.currentLocation,nextLocation:z.nextLocation})});let X=e.window.document.startViewTransition(()=>{t(()=>E(R))});X.finished.finally(()=>{t(()=>{y(void 0),v(void 0),f(void 0),h({isTransitioning:!1})})}),t(()=>v(X));return}g?(p&&p.resolve(),g.skipTransition(),w({state:R,currentLocation:z.currentLocation,nextLocation:z.nextLocation})):(f(R),h({isTransitioning:!0,flushSync:!1,currentLocation:z.currentLocation,nextLocation:z.nextLocation}))},[e.window,t,g,p,E]);u.useLayoutEffect(()=>e.subscribe(C),[e,C]),u.useEffect(()=>{m.isTransitioning&&!m.flushSync&&y(new e2)},[m]),u.useEffect(()=>{if(p&&c&&e.window){let R=c,D=p.promise,j=e.window.document.startViewTransition(async()=>{u.startTransition(()=>E(R)),await D});j.finished.finally(()=>{y(void 0),v(void 0),f(void 0),h({isTransitioning:!1})}),v(j)}},[c,p,e.window,E]),u.useEffect(()=>{p&&c&&i.location.key===c.location.key&&p.resolve()},[p,g,i.location,c]),u.useEffect(()=>{!m.isTransitioning&&S&&(f(S.state),h({isTransitioning:!0,flushSync:!1,currentLocation:S.currentLocation,nextLocation:S.nextLocation}),w(void 0))},[m.isTransitioning,S]);let A=u.useMemo(()=>({createHref:e.createHref,encodeLocation:e.encodeLocation,go:R=>e.navigate(R),push:(R,D,j)=>e.navigate(R,{state:D,preventScrollReset:j?.preventScrollReset}),replace:(R,D,j)=>e.navigate(R,{replace:!0,state:D,preventScrollReset:j?.preventScrollReset})}),[e]),O=e.basename||"/",_=u.useMemo(()=>({router:e,navigator:A,static:!1,basename:O,unstable_onError:r}),[e,A,O,r]);return u.createElement(u.Fragment,null,u.createElement(ki.Provider,{value:_},u.createElement(wc.Provider,{value:i},u.createElement(t1.Provider,{value:N.current},u.createElement(Ey.Provider,{value:m},u.createElement(r2,{basename:O,location:i.location,navigationType:i.historyAction,navigator:A},u.createElement(n2,{routes:e.routes,future:e.future,state:i,unstable_onError:r})))))),null)}var n2=u.memo(a2);function a2({routes:e,future:t,state:r,unstable_onError:i}){return UA(e,void 0,r,i,t)}function Xo({to:e,replace:t,state:r,relative:i}){rn(Il(),"<Navigate> may be used only in the context of a <Router> component.");let{static:l}=u.useContext(xs);Gn(!l,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:c}=u.useContext(cs),{pathname:f}=Xa(),m=$n(),h=Xd(e,Gd(c),f,i==="path"),p=JSON.stringify(h);return u.useEffect(()=>{m(JSON.parse(p),{replace:t,state:r,relative:i})},[m,p,i,t,r]),null}function s2(e){return BA(e.context)}function Xt(e){rn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function r2({basename:e="/",children:t=null,location:r,navigationType:i="POP",navigator:l,static:c=!1}){rn(!Il(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let f=e.replace(/^\/*/,"/"),m=u.useMemo(()=>({basename:f,navigator:l,static:c,future:{}}),[f,l,c]);typeof r=="string"&&(r=Zr(r));let{pathname:h="/",search:p="",hash:y="",state:g=null,key:v="default"}=r,S=u.useMemo(()=>{let w=Da(h,f);return w==null?null:{location:{pathname:w,search:p,hash:y,state:g,key:v},navigationType:i}},[f,h,p,y,g,v,i]);return Gn(S!=null,`<Router basename="${f}"> is not able to match the URL "${h}${p}${y}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:u.createElement(xs.Provider,{value:m},u.createElement(Kd.Provider,{children:t,value:S}))}function zp(e,t=[]){let r=[];return u.Children.forEach(e,(i,l)=>{if(!u.isValidElement(i))return;let c=[...t,l];if(i.type===u.Fragment){r.push.apply(r,zp(i.props.children,c));return}rn(i.type===Xt,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),rn(!i.props.index||!i.props.children,"An index route cannot have child routes.");let f={id:i.props.id||c.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(f.children=zp(i.props.children,c)),r.push(f)}),r}var i2=zp,md="get",hd="application/x-www-form-urlencoded";function Wd(e){return e!=null&&typeof e.tagName=="string"}function l2(e){return Wd(e)&&e.tagName.toLowerCase()==="button"}function o2(e){return Wd(e)&&e.tagName.toLowerCase()==="form"}function c2(e){return Wd(e)&&e.tagName.toLowerCase()==="input"}function u2(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function d2(e,t){return e.button===0&&(!t||t==="_self")&&!u2(e)}function $p(e=""){return new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let i=e[r];return t.concat(Array.isArray(i)?i.map(l=>[r,l]):[[r,i]])},[]))}function f2(e,t){let r=$p(e);return t&&t.forEach((i,l)=>{r.has(l)||t.getAll(l).forEach(c=>{r.append(l,c)})}),r}var zu=null;function m2(){if(zu===null)try{new FormData(document.createElement("form"),0),zu=!1}catch{zu=!0}return zu}var h2=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ih(e){return e!=null&&!h2.has(e)?(Gn(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${hd}"`),null):e}function p2(e,t){let r,i,l,c,f;if(o2(e)){let m=e.getAttribute("action");i=m?Da(m,t):null,r=e.getAttribute("method")||md,l=Ih(e.getAttribute("enctype"))||hd,c=new FormData(e)}else if(l2(e)||c2(e)&&(e.type==="submit"||e.type==="image")){let m=e.form;if(m==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=e.getAttribute("formaction")||m.getAttribute("action");if(i=h?Da(h,t):null,r=e.getAttribute("formmethod")||m.getAttribute("method")||md,l=Ih(e.getAttribute("formenctype"))||Ih(m.getAttribute("enctype"))||hd,c=new FormData(m,e),!m2()){let{name:p,type:y,value:g}=e;if(y==="image"){let v=p?`${p}.`:"";c.append(`${v}x`,"0"),c.append(`${v}y`,"0")}else p&&c.append(p,g)}}else{if(Wd(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=md,i=null,l=hd,f=e}return c&&l==="text/plain"&&(f=c,c=void 0),{action:i,method:r.toLowerCase(),encType:l,formData:c,body:f}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Ay(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function y2(e,t,r){let i=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return i.pathname==="/"?i.pathname=`_root.${r}`:t&&Da(i.pathname,t)==="/"?i.pathname=`${t.replace(/\/$/,"")}/_root.${r}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${r}`,i}async function g2(e,t){if(e.id in t)return t[e.id];try{let r=await import(e.module);return t[e.id]=r,r}catch(r){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function b2(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function v2(e,t,r){let i=await Promise.all(e.map(async l=>{let c=t.routes[l.route.id];if(c){let f=await g2(c,r);return f.links?f.links():[]}return[]}));return N2(i.flat(1).filter(b2).filter(l=>l.rel==="stylesheet"||l.rel==="preload").map(l=>l.rel==="stylesheet"?{...l,rel:"prefetch",as:"style"}:{...l,rel:"prefetch"}))}function j0(e,t,r,i,l,c){let f=(h,p)=>r[p]?h.route.id!==r[p].route.id:!0,m=(h,p)=>r[p].pathname!==h.pathname||r[p].route.path?.endsWith("*")&&r[p].params["*"]!==h.params["*"];return c==="assets"?t.filter((h,p)=>f(h,p)||m(h,p)):c==="data"?t.filter((h,p)=>{let y=i.routes[h.route.id];if(!y||!y.hasLoader)return!1;if(f(h,p)||m(h,p))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(l.pathname+l.search+l.hash,window.origin),currentParams:r[0]?.params||{},nextUrl:new URL(e,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function x2(e,t,{includeHydrateFallback:r}={}){return S2(e.map(i=>{let l=t.routes[i.route.id];if(!l)return[];let c=[l.module];return l.clientActionModule&&(c=c.concat(l.clientActionModule)),l.clientLoaderModule&&(c=c.concat(l.clientLoaderModule)),r&&l.hydrateFallbackModule&&(c=c.concat(l.hydrateFallbackModule)),l.imports&&(c=c.concat(l.imports)),c}).flat(1))}function S2(e){return[...new Set(e)]}function w2(e){let t={},r=Object.keys(e).sort();for(let i of r)t[i]=e[i];return t}function N2(e,t){let r=new Set;return new Set(t),e.reduce((i,l)=>{let c=JSON.stringify(w2(l));return r.has(c)||(r.add(c),i.push({key:c,link:l})),i},[])}function o1(){let e=u.useContext(ki);return Ay(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function E2(){let e=u.useContext(wc);return Ay(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var Ty=u.createContext(void 0);Ty.displayName="FrameworkContext";function c1(){let e=u.useContext(Ty);return Ay(e,"You must render this element inside a <HydratedRouter> element"),e}function j2(e,t){let r=u.useContext(Ty),[i,l]=u.useState(!1),[c,f]=u.useState(!1),{onFocus:m,onBlur:h,onMouseEnter:p,onMouseLeave:y,onTouchStart:g}=t,v=u.useRef(null);u.useEffect(()=>{if(e==="render"&&f(!0),e==="viewport"){let N=C=>{C.forEach(A=>{f(A.isIntersecting)})},E=new IntersectionObserver(N,{threshold:.5});return v.current&&E.observe(v.current),()=>{E.disconnect()}}},[e]),u.useEffect(()=>{if(i){let N=setTimeout(()=>{f(!0)},100);return()=>{clearTimeout(N)}}},[i]);let S=()=>{l(!0)},w=()=>{l(!1),f(!1)};return r?e!=="intent"?[c,v,{}]:[c,v,{onFocus:Mo(m,S),onBlur:Mo(h,w),onMouseEnter:Mo(p,S),onMouseLeave:Mo(y,w),onTouchStart:Mo(g,S)}]:[!1,v,{}]}function Mo(e,t){return r=>{e&&e(r),r.defaultPrevented||t(r)}}function _2({page:e,...t}){let{router:r}=o1(),i=u.useMemo(()=>Ur(r.routes,e,r.basename),[r.routes,e,r.basename]);return i?u.createElement(A2,{page:e,matches:i,...t}):null}function C2(e){let{manifest:t,routeModules:r}=c1(),[i,l]=u.useState([]);return u.useEffect(()=>{let c=!1;return v2(e,t,r).then(f=>{c||l(f)}),()=>{c=!0}},[e,t,r]),i}function A2({page:e,matches:t,...r}){let i=Xa(),{manifest:l,routeModules:c}=c1(),{basename:f}=o1(),{loaderData:m,matches:h}=E2(),p=u.useMemo(()=>j0(e,t,h,l,i,"data"),[e,t,h,l,i]),y=u.useMemo(()=>j0(e,t,h,l,i,"assets"),[e,t,h,l,i]),g=u.useMemo(()=>{if(e===i.pathname+i.search+i.hash)return[];let w=new Set,N=!1;if(t.forEach(C=>{let A=l.routes[C.route.id];!A||!A.hasLoader||(!p.some(O=>O.route.id===C.route.id)&&C.route.id in m&&c[C.route.id]?.shouldRevalidate||A.hasClientLoader?N=!0:w.add(C.route.id))}),w.size===0)return[];let E=y2(e,f,"data");return N&&w.size>0&&E.searchParams.set("_routes",t.filter(C=>w.has(C.route.id)).map(C=>C.route.id).join(",")),[E.pathname+E.search]},[f,m,i,l,p,t,e,c]),v=u.useMemo(()=>x2(y,l),[y,l]),S=C2(y);return u.createElement(u.Fragment,null,g.map(w=>u.createElement("link",{key:w,rel:"prefetch",as:"fetch",href:w,...r})),v.map(w=>u.createElement("link",{key:w,rel:"modulepreload",href:w,...r})),S.map(({key:w,link:N})=>u.createElement("link",{key:w,nonce:r.nonce,...N})))}function T2(...e){return t=>{e.forEach(r=>{typeof r=="function"?r(t):r!=null&&(r.current=t)})}}var u1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{u1&&(window.__reactRouterVersion="7.9.3")}catch{}function M2(e,t){return mA({basename:t?.basename,getContext:t?.getContext,future:t?.future,history:kC({window:t?.window}),hydrationData:R2(),routes:e,mapRouteProperties:QA,hydrationRouteProperties:JA,dataStrategy:t?.dataStrategy,patchRoutesOnNavigation:t?.patchRoutesOnNavigation,window:t?.window}).initialize()}function R2(){let e=window?.__staticRouterHydrationData;return e&&e.errors&&(e={...e,errors:k2(e.errors)}),e}function k2(e){if(!e)return null;let t=Object.entries(e),r={};for(let[i,l]of t)if(l&&l.__type==="RouteErrorResponse")r[i]=new Cd(l.status,l.statusText,l.data,l.internal===!0);else if(l&&l.__type==="Error"){if(l.__subType){let c=window[l.__subType];if(typeof c=="function")try{let f=new c(l.message);f.stack="",r[i]=f}catch{}}if(r[i]==null){let c=new Error(l.message);c.stack="",r[i]=c}}else r[i]=l;return r}var d1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Qt=u.forwardRef(function({onClick:t,discover:r="render",prefetch:i="none",relative:l,reloadDocument:c,replace:f,state:m,target:h,to:p,preventScrollReset:y,viewTransition:g,...v},S){let{basename:w}=u.useContext(xs),N=typeof p=="string"&&d1.test(p),E,C=!1;if(typeof p=="string"&&N&&(E=p,u1))try{let P=new URL(window.location.href),X=p.startsWith("//")?new URL(P.protocol+p):new URL(p),H=Da(X.pathname,w);X.origin===P.origin&&H!=null?p=H+X.search+X.hash:C=!0}catch{Gn(!1,`<Link to="${p}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let A=zA(p,{relative:l}),[O,_,R]=j2(i,v),D=O2(p,{replace:f,state:m,target:h,preventScrollReset:y,relative:l,viewTransition:g});function j(P){t&&t(P),P.defaultPrevented||D(P)}let z=u.createElement("a",{...v,...R,href:E||A,onClick:C||c?t:j,ref:T2(S,_),target:h,"data-discover":!N&&r==="render"?"true":void 0});return O&&!N?u.createElement(u.Fragment,null,z,u.createElement(_2,{page:A})):z});Qt.displayName="Link";var D2=u.forwardRef(function({"aria-current":t="page",caseSensitive:r=!1,className:i="",end:l=!1,style:c,to:f,viewTransition:m,children:h,...p},y){let g=Nc(f,{relative:p.relative}),v=Xa(),S=u.useContext(wc),{navigator:w,basename:N}=u.useContext(xs),E=S!=null&&H2(g)&&m===!0,C=w.encodeLocation?w.encodeLocation(g).pathname:g.pathname,A=v.pathname,O=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;r||(A=A.toLowerCase(),O=O?O.toLowerCase():null,C=C.toLowerCase()),O&&N&&(O=Da(O,N)||O);const _=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let R=A===C||!l&&A.startsWith(C)&&A.charAt(_)==="/",D=O!=null&&(O===C||!l&&O.startsWith(C)&&O.charAt(C.length)==="/"),j={isActive:R,isPending:D,isTransitioning:E},z=R?t:void 0,P;typeof i=="function"?P=i(j):P=[i,R?"active":null,D?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let X=typeof c=="function"?c(j):c;return u.createElement(Qt,{...p,"aria-current":z,className:P,ref:y,style:X,to:f,viewTransition:m},typeof h=="function"?h(j):h)});D2.displayName="NavLink";var I2=u.forwardRef(({discover:e="render",fetcherKey:t,navigate:r,reloadDocument:i,replace:l,state:c,method:f=md,action:m,onSubmit:h,relative:p,preventScrollReset:y,viewTransition:g,...v},S)=>{let w=B2(),N=U2(m,{relative:p}),E=f.toLowerCase()==="get"?"get":"post",C=typeof m=="string"&&d1.test(m),A=O=>{if(h&&h(O),O.defaultPrevented)return;O.preventDefault();let _=O.nativeEvent.submitter,R=_?.getAttribute("formmethod")||f;w(_||O.currentTarget,{fetcherKey:t,method:R,navigate:r,replace:l,state:c,relative:p,preventScrollReset:y,viewTransition:g})};return u.createElement("form",{ref:S,method:E,action:N,onSubmit:i?h:A,...v,"data-discover":!C&&e==="render"?"true":void 0})});I2.displayName="Form";function L2(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function f1(e){let t=u.useContext(ki);return rn(t,L2(e)),t}function O2(e,{target:t,replace:r,state:i,preventScrollReset:l,relative:c,viewTransition:f}={}){let m=$n(),h=Xa(),p=Nc(e,{relative:c});return u.useCallback(y=>{if(d2(y,t)){y.preventDefault();let g=r!==void 0?r:Gr(h)===Gr(p);m(e,{replace:g,state:i,preventScrollReset:l,relative:c,viewTransition:f})}},[h,m,p,r,i,t,e,l,c,f])}function z2(e){Gn(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=u.useRef($p(e)),r=u.useRef(!1),i=Xa(),l=u.useMemo(()=>f2(i.search,r.current?null:t.current),[i.search]),c=$n(),f=u.useCallback((m,h)=>{const p=$p(typeof m=="function"?m(new URLSearchParams(l)):m);r.current=!0,c("?"+p,h)},[c,l]);return[l,f]}var $2=0,F2=()=>`__${String(++$2)}__`;function B2(){let{router:e}=f1("useSubmit"),{basename:t}=u.useContext(xs),r=XA();return u.useCallback(async(i,l={})=>{let{action:c,method:f,encType:m,formData:h,body:p}=p2(i,t);if(l.navigate===!1){let y=l.fetcherKey||F2();await e.fetch(y,r,l.action||c,{preventScrollReset:l.preventScrollReset,formData:h,body:p,formMethod:l.method||f,formEncType:l.encType||m,flushSync:l.flushSync})}else await e.navigate(l.action||c,{preventScrollReset:l.preventScrollReset,formData:h,body:p,formMethod:l.method||f,formEncType:l.encType||m,replace:l.replace,state:l.state,fromRouteId:r,flushSync:l.flushSync,viewTransition:l.viewTransition})},[e,t,r])}function U2(e,{relative:t}={}){let{basename:r}=u.useContext(xs),i=u.useContext(cs);rn(i,"useFormAction must be used inside a RouteContext");let[l]=i.matches.slice(-1),c={...Nc(e||".",{relative:t})},f=Xa();if(e==null){c.search=f.search;let m=new URLSearchParams(c.search),h=m.getAll("index");if(h.some(y=>y==="")){m.delete("index"),h.filter(g=>g).forEach(g=>m.append("index",g));let y=m.toString();c.search=y?`?${y}`:""}}return(!e||e===".")&&l.route.index&&(c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(c.pathname=c.pathname==="/"?r:ks([r,c.pathname])),Gr(c)}function m1(e,t){let{capture:r}=t||{};u.useEffect(()=>{let i=r!=null?{capture:r}:void 0;return window.addEventListener("beforeunload",e,i),()=>{window.removeEventListener("beforeunload",e,i)}},[e,r])}function q2({when:e,message:t}){let r=i1(e);u.useEffect(()=>{r.state==="blocked"&&(window.confirm(t)?setTimeout(r.proceed,0):r.reset())},[r,t]),u.useEffect(()=>{r.state==="blocked"&&!e&&r.reset()},[r,e])}function H2(e,{relative:t}={}){let r=u.useContext(Ey);rn(r!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=f1("useViewTransitionState"),l=Nc(e,{relative:t});if(!r.isTransitioning)return!1;let c=Da(r.currentLocation.pathname,i)||r.currentLocation.pathname,f=Da(r.nextLocation.pathname,i)||r.nextLocation.pathname;return _d(l.pathname,f)!=null||_d(l.pathname,c)!=null}var Ec=Fw();const h1=Ri(Ec);function P2(e){return u.createElement(t2,{flushSync:Ec.flushSync,...e})}/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V2=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Y2=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,i)=>i?i.toUpperCase():r.toLowerCase()),_0=e=>{const t=Y2(e);return t.charAt(0).toUpperCase()+t.slice(1)},p1=(...e)=>e.filter((t,r,i)=>!!t&&t.trim()!==""&&i.indexOf(t)===r).join(" ").trim(),G2=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var X2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K2=u.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:i,className:l="",children:c,iconNode:f,...m},h)=>u.createElement("svg",{ref:h,...X2,width:t,height:t,stroke:e,strokeWidth:i?Number(r)*24/Number(t):r,className:p1("lucide",l),...!c&&!G2(m)&&{"aria-hidden":"true"},...m},[...f.map(([p,y])=>u.createElement(p,y)),...Array.isArray(c)?c:[c]]));/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=(e,t)=>{const r=u.forwardRef(({className:i,...l},c)=>u.createElement(K2,{ref:c,iconNode:t,className:p1(`lucide-${V2(_0(e))}`,`lucide-${e}`,i),...l}));return r.displayName=_0(e),r};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W2=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],C0=Lt("arrow-down",W2);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z2=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],My=Lt("arrow-left",Z2);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q2=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],y1=Lt("arrow-right",Q2);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J2=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],A0=Lt("arrow-up",J2);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eT=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}]],Ry=Lt("bell-ring",eT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tT=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Td=Lt("bell",tT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nT=[["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M14 7a4 4 0 0 1 4 4v3a6 6 0 0 1-12 0v-3a4 4 0 0 1 4-4z",key:"uouzyp"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M21 21a4 4 0 0 0-3.81-4",key:"1b0z45"}],["path",{d:"M21 5a4 4 0 0 1-3.55 3.97",key:"5cxbf6"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M3 21a4 4 0 0 1 3.81-4",key:"1fjd4g"}],["path",{d:"M3 5a4 4 0 0 0 3.55 3.97",key:"1d7oge"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M9 7.13V6a3 3 0 1 1 6 0v1.13",key:"1vgav8"}]],ky=Lt("bug",nT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aT=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],T0=Lt("calendar-days",aT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sT=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],rT=Lt("check-check",sT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iT=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],g1=Lt("check",iT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lT=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Hr=Lt("chevron-down",lT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oT=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Dy=Lt("chevron-right",oT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Pa=Lt("circle-alert",cT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Zd=Lt("circle-check",uT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dT=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],fT=Lt("circle-play",dT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mT=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Iy=Lt("clock",mT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hT=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],M0=Lt("cloud-upload",hT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pT=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],yT=Lt("crown",pT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gT=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],R0=Lt("database",gT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bT=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],vT=Lt("download",bT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xT=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],b1=Lt("eye",xT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ST=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],wT=Lt("file-check",ST);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NT=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Fp=Lt("file-text",NT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ET=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Qd=Lt("funnel",ET);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jT=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],_T=Lt("grip-vertical",jT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CT=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],v1=Lt("history",CT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AT=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],TT=Lt("image",AT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Ly=Lt("info",MT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RT=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],x1=Lt("layers",RT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kT=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],k0=Lt("link-2",kT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DT=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],S1=Lt("list-checks",DT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IT=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],D0=Lt("list",IT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LT=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Nn=Lt("loader-circle",LT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OT=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],zT=Lt("log-out",OT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $T=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],FT=Lt("lock",$T);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BT=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],UT=Lt("maximize-2",BT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qT=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],HT=Lt("menu",qT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PT=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],VT=Lt("message-square",PT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YT=[["path",{d:"M5 12h14",key:"1ays0h"}]],w1=Lt("minus",YT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GT=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],XT=Lt("moon",GT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KT=[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]],Bp=Lt("notebook-pen",KT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WT=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ZT=Lt("pen-line",WT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QT=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],N1=Lt("pen",QT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JT=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],ir=Lt("pencil",JT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eM=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],tM=Lt("pin",eM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nM=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Ya=Lt("plus",nM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aM=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Ll=Lt("rotate-ccw",aM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sM=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],I0=Lt("save",sM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rM=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],ic=Lt("search",rM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iM=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],lM=Lt("send",iM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oM=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],E1=Lt("settings",oM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cM=[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]],uM=Lt("shapes",cM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dM=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],j1=Lt("shield-check",dM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fM=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M9 12h6",key:"1c52cq"}],["path",{d:"M12 9v6",key:"199k2o"}]],mM=Lt("shield-plus",fM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hM=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],pM=Lt("sliders-horizontal",hM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yM=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Di=Lt("sparkles",yM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gM=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],bM=Lt("sun",gM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vM=[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5",key:"hbey2j"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18",key:"1hf58s"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20",key:"pidxm4"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21",key:"1pehsh"}]],xM=Lt("swords",vM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Oy=Lt("target",SM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wM=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ha=Lt("trash-2",wM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NM=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ra=Lt("triangle-alert",NM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EM=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],jM=Lt("upload",EM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _M=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],_1=Lt("users",_M);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CM=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],AM=Lt("user",CM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TM=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],MM=Lt("workflow",TM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RM=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ia=Lt("x",RM),Cn="http://ttrdb.eu-west-2.elasticbeanstalk.com/api".replace(/\/$/,"")||"http://localhost:3000/api",kM=Object.freeze(Object.defineProperty({__proto__:null,API_BASE:Cn},Symbol.toStringTag,{value:"Module"})),C1=u.createContext(null);function DM({children:e}){const[t,r]=u.useState(null),[i,l]=u.useState(null),[c,f]=u.useState(!1);u.useEffect(()=>{try{const p=localStorage.getItem("gamedb_session");if(p){const y=JSON.parse(p);y?.user&&y?.token?(r(y.user),l(y.token)):(console.warn(" Incomplete session found, clearing..."),localStorage.removeItem("gamedb_session"))}}catch(p){console.warn(" Invalid stored session, clearing...",p),localStorage.removeItem("gamedb_session")}finally{f(!0)}},[]),u.useEffect(()=>{c&&(i&&t?localStorage.setItem("gamedb_session",JSON.stringify({user:t,token:i})):localStorage.removeItem("gamedb_session"))},[i,t,c]);const m=async(p,y)=>{try{const v=await(await fetch(`${Cn}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:p,password:y})})).json();if(console.log(" Raw login response:",v),!v.success||!v.token)throw new Error(v.message||"Invalid credentials");return r(v.user),l(v.token),localStorage.setItem("gamedb_session",JSON.stringify({user:v.user,token:v.token})),console.log(" Login successful:",v.user),!0}catch(g){return console.error(" Login error:",g.message),alert(`Login failed: ${g.message}`),!1}},h=()=>{r(null),l(null),localStorage.removeItem("gamedb_session")};return c?a.jsx(C1.Provider,{value:{user:t,token:i,sessionReady:c,login:m,logout:h},children:e}):a.jsx("div",{className:"loading-screen",children:"Loading session..."})}function En(){return u.useContext(C1)}function Qr(){try{return JSON.parse(localStorage.getItem("gamedb_session"))?.token||null}catch{return null}}async function IM(e=5,t=200){for(let r=0;r<e;r++){const i=Qr();if(i)return i;await new Promise(l=>setTimeout(l,t))}return null}async function dr(){const e=await IM();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function fr(e,t="request"){if(e.status===401)throw console.warn(` Unauthorized during ${t}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${e.status} ${r}`)}return e.json()}async function jc(e={}){const t=await dr(),r=new URLSearchParams;Object.entries(e).forEach(([f,m])=>{m!=null&&m!==""&&r.set(f,m)});const i=r.toString(),l=i?`${Cn}/campaigns?${i}`:`${Cn}/campaigns`,c=await fetch(l,{headers:t});return fr(c,"fetch campaigns")}async function LM(e){const t=await dr(),r=await fetch(`${Cn}/campaigns`,{method:"POST",headers:t,body:JSON.stringify(e)});return fr(r,"create campaign")}async function OM(e,t){const r=await dr(),i=await fetch(`${Cn}/campaigns/${e}`,{method:"PUT",headers:r,body:JSON.stringify(t)});return fr(i,"update campaign")}async function zM(e){const t=await dr(),r=await fetch(`${Cn}/campaigns/${e}`,{method:"DELETE",headers:t});return fr(r,"delete campaign")}async function $M(e,t={}){if(!e)throw new Error("campaignId is required to fetch notes");const r=await dr(),i=new URLSearchParams;Object.entries(t).forEach(([m,h])=>{if(!(h==null||h==="")){if(Array.isArray(h)){h.map(p=>p==null?"":String(p)).filter(p=>p.trim()!=="").forEach(p=>{i.append(`${m}[]`,p)});return}i.set(m,h)}});const l=i.toString(),c=`${Cn}/campaigns/${e}/entity-notes${l?`?${l}`:""}`,f=await fetch(c,{headers:r});return fr(f,"fetch campaign entity notes")}async function FM(e){if(!e)throw new Error("campaignId is required to fetch session notes");const t=await dr(),r=`${Cn}/campaigns/${e}/session-notes`,i=await fetch(r,{headers:t});return fr(i,"fetch campaign session notes")}async function BM(e,t={}){if(!e)throw new Error("campaignId is required to create a session note");const r=await dr(),i=await fetch(`${Cn}/campaigns/${e}/session-notes`,{method:"POST",headers:r,body:JSON.stringify(t)});return fr(i,"create session note")}async function UM(e,t,r={}){if(!e)throw new Error("campaignId is required to update a session note");if(!t)throw new Error("noteId is required to update a session note");const i=await dr(),l=await fetch(`${Cn}/campaigns/${e}/session-notes/${t}`,{method:"PUT",headers:i,body:JSON.stringify(r)});return fr(l,"update session note")}async function qM(e,t){if(!e)throw new Error("campaignId is required to delete a session note");if(!t)throw new Error("noteId is required to delete a session note");const r=await dr(),i=await fetch(`${Cn}/campaigns/${e}/session-notes/${t}`,{method:"DELETE",headers:r});return fr(i,"delete session note")}async function HM(e=5,t=200){for(let r=0;r<e;r++){const i=Qr();if(i)return i;await new Promise(l=>setTimeout(l,t))}return null}async function Jd(){const e=await HM();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function ef(e,t="request"){if(e.status===401)throw console.warn(` Unauthorized during ${t}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${e.status} ${r}`)}return e.json()}async function Ol(){const e=await Jd(),t=await fetch(`${Cn}/worlds`,{headers:e});return ef(t,"fetch worlds")}async function PM(e){const t=await Jd(),r=await fetch(`${Cn}/worlds`,{method:"POST",headers:t,body:JSON.stringify(e)});return ef(r,"create world")}async function VM(e,t){const r=await Jd(),i=await fetch(`${Cn}/worlds/${e}`,{method:"PUT",headers:r,body:JSON.stringify(t)});return ef(i,"update world")}async function YM(e){const t=await Jd(),r=await fetch(`${Cn}/worlds/${e}`,{method:"DELETE",headers:t});return ef(r,"delete world")}const A1=u.createContext(null),pd="gamedb_campaign_context",GM=new Set(["dm","player"]),Ro=(e,t)=>{if(typeof window>"u")return;const r=e?String(e):"",i=r?"":t?String(t):"";try{r?localStorage.setItem(pd,JSON.stringify({type:"campaign",id:r})):i?localStorage.setItem(pd,JSON.stringify({type:"world",id:i})):localStorage.removeItem(pd)}catch(l){console.warn(" Unable to persist campaign context",l)}},XM=e=>{if(!e||typeof e!="string")return{type:"",id:""};try{const t=JSON.parse(e);if(t&&typeof t=="object"){const r=t.type==="world"?"world":"campaign",i=t.id?String(t.id):"";if(i)return{type:r,id:i}}}catch{if(e.trim())return{type:"campaign",id:e.trim()}}return e.trim()?{type:"campaign",id:e.trim()}:{type:"",id:""}},KM=(e,t)=>Array.isArray(e)?t?t.role==="system_admin"?e:e.filter(r=>Array.isArray(r?.members)&&r.members.some(i=>i?.user_id===t.id&&GM.has(i?.role))):[]:[];function WM({children:e}){const{user:t,sessionReady:r}=En(),[i,l]=u.useState([]),[c,f]=u.useState(!1),[m,h]=u.useState(""),[p,y]=u.useState(""),[g,v]=u.useState([]),[S,w]=u.useState(!1),[N,E]=u.useState(""),[C,A]=u.useState(""),[O,_]=u.useState(""),[R,D]=u.useState(!1);u.useEffect(()=>{if(r)try{const T=localStorage.getItem(pd);if(!T){y(""),A("");return}const{type:U,id:M}=XM(T);U==="world"?(A(M),y("")):U==="campaign"?(y(M),A("")):(y(""),A(""))}catch(T){console.warn(" Unable to restore campaign context",T),y(""),A("")}finally{D(!0)}},[r]),u.useEffect(()=>{!r||!R||Ro(p,C)},[p,C,r,R]);const j=u.useCallback(async()=>{if(!r||!t)return l([]),h(""),[];f(!0),h("");try{const T=await jc(),U=Array.isArray(T?.data)?T.data:Array.isArray(T)?T:[],M=KM(U,t);return l(M),y(q=>q&&M.some(J=>String(J.id)===String(q))?q:""),M}catch(T){return console.error(" Failed to load campaigns",T),h(T.message||"Failed to load campaigns"),l([]),[]}finally{f(!1)}},[r,t]),z=u.useCallback(async()=>{if(!r||!t)return v([]),E(""),[];w(!0),E("");try{const T=await Ol(),U=Array.isArray(T?.data)?T.data:Array.isArray(T)?T:[];return v(U),A(M=>M&&U.some(Y=>String(Y.id)===String(M))?M:""),U}catch(T){return console.error(" Failed to load worlds",T),E(T.message||"Failed to load worlds"),v([]),[]}finally{w(!1)}},[r,t]);u.useEffect(()=>{if(!(!r||!R)){if(!t){l([]),y(""),h(""),f(!1),v([]),A(""),E(""),w(!1);return}j(),z()}},[r,R,t,j,z]);const P=u.useCallback(T=>{const U=T==null?"":String(T);y(U),U?(A(""),_(""),Ro(U,"")):Ro("","")},[]),X=u.useCallback(T=>{const U=T==null?"":String(T);A(U),U?(y(""),_(""),Ro("",U)):Ro("","")},[]);u.useEffect(()=>{_("")},[p]);const H=u.useCallback(T=>{const U=T==null?"":String(T);_(U)},[]),G=u.useMemo(()=>p&&i.find(T=>String(T.id)===String(p))||null,[i,p]),V=u.useMemo(()=>C&&g.find(T=>String(T.id)===String(C))||null,[g,C]),k=u.useMemo(()=>p?"campaign":C?"world":"",[p,C]),F=u.useMemo(()=>k==="world"&&V?V:G?.world?G.world:V,[k,V,G]),I=u.useMemo(()=>F?.id?String(F.id):"",[F]),L=u.useMemo(()=>`${k||"none"}:${p||C||""||"none"}:${I||"none"}:${O||"none"}`,[p,C,k,I,O]),$=u.useMemo(()=>({campaigns:i,selectedCampaign:G,selectedCampaignId:p,setSelectedCampaignId:P,worlds:g,worldLoading:S,worldError:N,selectedWorld:V,selectedWorldId:C,setSelectedWorldId:X,viewAsCharacterId:O,setViewAsCharacterId:H,selectedContextType:k,activeWorld:F,activeWorldId:I,contextKey:L,loading:c,error:m,refreshCampaigns:j,refreshWorlds:z}),[i,G,p,P,g,S,N,V,C,X,O,H,k,F,I,L,c,m,j,z]);return a.jsx(A1.Provider,{value:$,children:e})}function Un(){const e=u.useContext(A1);if(!e)throw new Error("useCampaignContext must be used within a CampaignProvider");return e}const T1=u.createContext(null),ZM=()=>{if(typeof window>"u")return"light";const e=window.localStorage.getItem("theme");return e==="light"||e==="dark"?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"};function QM({children:e}){const[t,r]=u.useState(ZM);u.useEffect(()=>{typeof document>"u"||(document.body.classList.remove("theme-light","theme-dark"),document.body.classList.add(t==="dark"?"theme-dark":"theme-light"),document.documentElement.setAttribute("data-theme",t),window.localStorage.setItem("theme",t))},[t]),u.useEffect(()=>{if(typeof window>"u")return;const l=window.matchMedia("(prefers-color-scheme: dark)"),c=f=>{r(f.matches?"dark":"light")};if(!window.localStorage.getItem("theme"))return l.addEventListener("change",c),()=>l.removeEventListener("change",c)},[]);const i=u.useMemo(()=>({theme:t,setTheme:r,toggleTheme:()=>r(l=>l==="dark"?"light":"dark")}),[t]);return a.jsx(T1.Provider,{value:i,children:e})}function JM(){const e=u.useContext(T1);if(!e)throw new Error("useTheme must be used within a ThemeProvider");return e}const eR=768;function zy(e=eR){const[t,r]=u.useState(()=>typeof window>"u"?!1:window.matchMedia(`(max-width: ${e}px)`).matches);return u.useEffect(()=>{if(typeof window>"u")return;const i=window.matchMedia(`(max-width: ${e}px)`),l=c=>{r(c.matches)};return r(i.matches),typeof i.addEventListener=="function"?(i.addEventListener("change",l),()=>i.removeEventListener("change",l)):(i.addListener(l),()=>i.removeListener(l))},[e]),t}async function tR(e=5,t=200){for(let r=0;r<e;r++){const i=Qr();if(i)return i;await new Promise(l=>setTimeout(l,t))}return null}async function tf(){const e=await tR();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function nf(e,t="request"){if(e.status===401)throw console.warn(` Unauthorized during ${t}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${e.status} ${r}`)}return e.json()}async function Is(e={}){const t=await tf(),r=new URLSearchParams;Object.entries(e).forEach(([f,m])=>{m!=null&&m!==""&&r.set(f,m)});const i=r.toString(),l=i?`${Cn}/characters?${i}`:`${Cn}/characters`,c=await fetch(l,{headers:t});return nf(c,"fetch characters")}async function nR(e){const t=await tf(),r=await fetch(`${Cn}/characters`,{method:"POST",headers:t,body:JSON.stringify(e)});return nf(r,"create character")}async function aR(e,t){const r=await tf(),i=await fetch(`${Cn}/characters/${e}`,{method:"PUT",headers:r,body:JSON.stringify(t)});return nf(i,"update character")}async function sR(e){const t=await tf(),r=await fetch(`${Cn}/characters/${e}`,{method:"DELETE",headers:t});return nf(r,"delete character")}const L0="drawer-panel-open",rR=300,Lh={sm:"360px",md:"420px",lg:"560px"},iR=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])",'[tabindex]:not([tabindex="-1"])'],lR=()=>{const e=document.createElement("div");return e.className="drawer-portal-container",e},oR=(e,t)=>e?typeof e=="number"?`${e}px`:String(e):t&&Lh[t]?Lh[t]:Lh.md;function Xr({isOpen:e,onClose:t,title:r,description:i,children:l,footer:c,footerActions:f,width:m,size:h="md",labelledBy:p,closeLabel:y="Close panel",className:g="",mobileFull:v=!0}){const S=u.useRef(null),w=u.useRef(null),N=u.useRef(null),E=u.useRef(null),[C,A]=u.useState(e),[O,_]=u.useState(!1),R=u.useMemo(()=>p||`drawer-${Math.random().toString(36).slice(2)}`,[p]),D=i?`${R}-description`:void 0,j=oR(m,h);if(u.useEffect(()=>(S.current||(S.current=lR(),document.body.appendChild(S.current)),()=>{S.current&&S.current.parentNode&&S.current.parentNode.removeChild(S.current),S.current=null}),[]),u.useEffect(()=>e?(E.current&&(clearTimeout(E.current),E.current=null),A(!0),_(!1),()=>{}):C?(_(!0),E.current=setTimeout(()=>{A(!1),_(!1),E.current=null},rR),()=>{E.current&&(clearTimeout(E.current),E.current=null)}):()=>{},[e,C]),u.useEffect(()=>{if(!e)return;N.current=document.activeElement instanceof HTMLElement?document.activeElement:null,document.body.classList.add(L0);const H=()=>w.current?Array.from(w.current.querySelectorAll(iR.join(","))).filter(I=>I instanceof HTMLElement&&I.offsetParent!==null):[],G=()=>{const L=H()[0];L?L.focus({preventScroll:!0}):w.current&&w.current.focus({preventScroll:!0})},V=I=>{if(I.key==="Escape"){I.preventDefault(),t?.();return}if(I.key!=="Tab")return;const L=H();if(L.length===0){I.preventDefault(),w.current?.focus({preventScroll:!0});return}const $=L[0],T=L[L.length-1],U=document.activeElement;if(I.shiftKey){(U===$||!w.current?.contains(U))&&(I.preventDefault(),T.focus({preventScroll:!0}));return}U===T&&(I.preventDefault(),$.focus({preventScroll:!0}))},k=I=>{w.current?.contains(I.target)||G()},F=setTimeout(()=>{if(!w.current)return;const I=w.current.querySelector("[data-autofocus]");if(I instanceof HTMLElement){I.focus({preventScroll:!0});return}G()},20);return document.addEventListener("keydown",V),document.addEventListener("focusin",k),()=>{clearTimeout(F),document.removeEventListener("keydown",V),document.removeEventListener("focusin",k),document.body.classList.remove(L0),N.current instanceof HTMLElement&&N.current.focus({preventScroll:!0})}},[e,t]),!C||!S.current)return null;const z=["drawer-panel-wrapper",e?"drawer-panel-wrapper--open":"",O?"drawer-panel-wrapper--closing":""].filter(Boolean).join(" "),P=["drawer-panel",h?`drawer-panel--${h}`:"",v?"drawer-panel--mobile-full":"",g].filter(Boolean).join(" "),X=f??c;return Ec.createPortal(a.jsxs("div",{className:z,role:"presentation",children:[a.jsx("div",{className:"drawer-panel-overlay",onClick:t,role:"presentation"}),a.jsxs("aside",{ref:w,className:P,role:"dialog","aria-modal":"true","aria-labelledby":R,"aria-describedby":D,tabIndex:-1,style:{"--drawer-panel-width":j},children:[a.jsxs("div",{className:"drawer-panel-header",children:[a.jsxs("div",{className:"drawer-panel-heading",children:[a.jsx("h2",{id:R,children:r}),i?a.jsx("p",{id:D,className:"drawer-panel-description",children:i}):null]}),a.jsx("button",{type:"button",className:"icon-btn",onClick:t,"aria-label":y,children:""})]}),a.jsx("div",{className:"drawer-panel-body",children:l}),X?a.jsx("div",{className:"drawer-panel-footer",children:X}):null]})]}),S.current)}const af="app_history",M1=100,Up="history:updated",R1=()=>typeof window<"u"?window:null,sf=()=>!!R1()?.localStorage,k1=e=>{const t=R1();if(t)try{t.dispatchEvent(new CustomEvent(Up,{detail:Array.isArray(e)?e:[]}))}catch(r){console.warn(" Failed to broadcast history change",r)}},qp=e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t},$y=e=>{if(!e||e.id===void 0||e.id===null||!e.type)return null;const t=qp(e.viewedAt)||new Date,r=e.worldId??e.world_id??e.worldID??e.world?.id??e.world?.world_id??null,i=e.worldName??e.world_name??e.world?.name??null;return{id:String(e.id),type:String(e.type),title:e.title?String(e.title):"Untitled record",viewedAt:t.toISOString(),...r?{worldId:String(r)}:{},...i?{worldName:String(i)}:{}}},cR=e=>e.slice().sort((t,r)=>{const i=qp(t?.viewedAt),l=qp(r?.viewedAt),c=i?i.getTime():0;return(l?l.getTime():0)-c}),Hp=()=>{if(!sf())return[];try{const e=window.localStorage.getItem(af);if(!e)return[];const t=JSON.parse(e);if(!Array.isArray(t))return[];const r=t.map($y).filter(Boolean);return cR(r)}catch(e){return console.warn(" Failed to parse stored history",e),[]}},uR=e=>{if(!sf())return[];if(!Array.isArray(e))return[];const t=e.map($y).filter(Boolean).slice(0,M1);return window.localStorage.setItem(af,JSON.stringify(t)),k1(t),t},dR=e=>{if(!sf())return[];const t=$y(e);if(!t)return Hp();const r=Hp().filter(l=>!(l.id===t.id&&l.type===t.type)),i=[t,...r].slice(0,M1);return uR(i),i},fR=()=>{sf()&&(window.localStorage.removeItem(af),k1([]))},Oh=()=>typeof window>"u"?[]:Hp();function D1(e=null){const[t,r]=u.useState(()=>Oh()),i=u.useCallback(()=>{const m=Oh();return r(m),m},[]),l=u.useCallback(m=>{if(!m)return Oh();const h=dR(m);return r(h),h},[]),c=u.useCallback(()=>{fR(),r([])},[]);u.useEffect(()=>{i()},[i]);const f=u.useMemo(()=>{if(!e)return null;const{id:m,type:h,title:p,viewedAt:y}=e;if(m==null||!h)return null;const g={id:m,type:h,title:p,viewedAt:y},v=e.worldId??e.world_id??e.world?.id??e.world?.world_id??null,S=e.worldName??e.world_name??e.world?.name??null;return v!=null&&(g.worldId=v),S&&(g.worldName=S),g},[e]);return u.useEffect(()=>{f&&l(f)},[f,l]),u.useEffect(()=>{if(typeof window>"u")return;const m=p=>{p.key&&p.key!==af||i()},h=()=>{i()};return window.addEventListener("storage",m),window.addEventListener(Up,h),()=>{window.removeEventListener("storage",m),window.removeEventListener(Up,h)}},[i]),{history:t,addEntry:l,refreshHistory:i,clearHistory:c}}const I1=3600*1e3,mR=24*I1,hR=e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t},Pp=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),pR=(e,t)=>{if(!e)return"older";const r=t.getTime()-e.getTime();if(r<I1)return"lastHour";if(Pp(e,t))return"today";const i=new Date(t);return i.setDate(t.getDate()-1),Pp(e,i)?"yesterday":r<7*mR?"lastSevenDays":"older"},yR=[{key:"lastHour",label:"Last hour"},{key:"today",label:"Today"},{key:"yesterday",label:"Yesterday"},{key:"lastSevenDays",label:"Last seven days"},{key:"older",label:"Older"}],gR=(e,t)=>{if(!e)return"";if(Pp(e,t)){const l=String(e.getHours()).padStart(2,"0"),c=String(e.getMinutes()).padStart(2,"0");return`${l}.${c}`}const r=String(e.getDate()).padStart(2,"0"),i=e.toLocaleString(void 0,{month:"short"});return`${r} ${i}`},bR=e=>{if(!e)return"record";const t=String(e);return t.includes(":")?t.split(":").pop().replace(/[-_]+/g," "):t.replace(/_/g," ")},vR=e=>!e?.type||!e?.id?null:String(e.type).toLowerCase().startsWith("entity")?`/entities/${e.id}`:null;function xR({isOpen:e,onClose:t}){const{history:r,clearHistory:i}=D1(),{campaigns:l,worlds:c,loading:f,worldLoading:m,selectedContextType:h,activeWorldId:p}=Un(),y=new Date,g=u.useMemo(()=>!f&&!m,[f,m]),v=u.useMemo(()=>{const A=new Set,O=_=>{if(!_&&_!==0)return;const R=String(_);R&&A.add(R)};return Array.isArray(c)&&c.forEach(_=>{O(_?.id??_?.world_id)}),Array.isArray(l)&&l.forEach(_=>{O(_?.world?.id??_?.world_id)}),A},[l,c]),S=u.useMemo(()=>!h||!p?"":String(p),[h,p]),w=u.useMemo(()=>!Array.isArray(r)||r.length===0?[]:!g||!v.size?r:r.filter(A=>{if(!A)return!1;if(!String(A.type||"").toLowerCase().startsWith("entity"))return!0;const _=A.worldId??A.world_id??A.world?.id??A.world?.world_id??null;return S&&(!_||String(_)!==S)?!1:_?v.has(String(_)):!0}),[r,v,g,S]),N=g&&Array.isArray(r)&&r.length>0&&w.length<r.length,E=u.useMemo(()=>{if(!Array.isArray(w)||w.length===0)return[];const A=new Date,O=yR.map(R=>({...R,items:[]})),_=new Map(O.map(R=>[R.key,R]));return w.forEach(R=>{const D=hR(R?.viewedAt),j=pR(D,A),z=_.get(j);z&&z.items.push({...R,parsedDate:D})}),O.filter(R=>R.items.length>0)},[w]),C=()=>{i()};return a.jsx(Xr,{isOpen:e,onClose:t,title:"History",description:"Recently viewed records",size:"sm",children:a.jsxs("div",{className:"history-tab",children:[a.jsxs("div",{className:"history-tab-header",children:[a.jsxs("div",{className:"history-tab-title",children:[a.jsx(Iy,{size:18}),a.jsx("span",{children:"Recently viewed"})]}),a.jsxs("button",{type:"button",className:"history-clear-btn",onClick:C,disabled:!r.length,children:[a.jsx(ha,{size:14}),"Clear"]})]}),!w.length&&a.jsx("p",{className:"history-empty",children:N?"You do not currently have access to any records in your recent history.":"No records viewed yet. Start exploring to build a history."}),E.map(A=>a.jsxs("section",{className:"history-group",children:[a.jsx("h3",{className:"history-group-title",children:A.label}),a.jsx("ul",{className:"history-entry-list",children:A.items.map(O=>{const _=vR(O),R=a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"history-entry-title",children:O.title||"Untitled record"}),a.jsxs("div",{className:"history-entry-meta",children:[a.jsx("span",{className:"history-entry-type",children:bR(O.type)}),a.jsx("time",{className:"history-entry-time",children:gR(O.parsedDate,y)})]})]});return a.jsx("li",{children:_?a.jsx(Qt,{to:_,className:"history-entry history-entry-link",onClick:t,children:R}):a.jsx("div",{className:"history-entry",children:R})},`${O.type}-${O.id}`)})})]},A.key))]})})}const SR="gamedb_campaign_context",wR="X-Campaign-Context-Id",NR=e=>{if(!e||typeof e!="string")return null;try{const r=JSON.parse(e);if(r&&typeof r=="object"){const i=r.type==="world"?"world":"campaign",l=r.id?String(r.id):"";return l?{type:i,id:l}:null}}catch{const r=e.trim();if(r)return{type:"campaign",id:r}}const t=e.trim();return t?{type:"campaign",id:t}:null};async function ko(e,t,r,i={}){const{headers:l,includeCampaignContext:c=!0,...f}=i||{},m=typeof FormData<"u"&&r instanceof FormData,h={...m?{}:{"Content-Type":"application/json"},...l},p=Qr();if(p&&(h.Authorization=`Bearer ${p}`),c)try{const N=localStorage.getItem(SR);if(N){const E=NR(N);E?.type==="campaign"&&E.id&&(h[wR]=E.id)}}catch(N){console.warn(" Unable to include campaign context header",N)}const y=(()=>{if(r!==void 0)return m?r:JSON.stringify(r)})(),g=await fetch(`${Cn}${t}`,{method:e,headers:h,body:y,...f}),S=(g.headers.get("content-type")||"").includes("application/json"),w=S?await g.json():await g.text();if(!g.ok){g.status===401&&(localStorage.removeItem("gamedb_session"),setTimeout(()=>{window.location.pathname!=="/login"&&(window.location.href="/login")},150));const N=S&&w?.message||(typeof w=="string"?w:"Request failed"),E=new Error(N);throw E.status=g.status,E}return w}const Rt={get:(e,t)=>ko("GET",e,void 0,t),post:(e,t,r)=>ko("POST",e,t,r),put:(e,t,r)=>ko("PUT",e,t,r),patch:(e,t,r)=>ko("PATCH",e,t,r),delete:(e,t)=>ko("DELETE",e,void 0,t)},L1=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([l,c])=>{c!=null&&c!==""&&t.set(l,c)});const r=t.toString(),i=r?`/notifications?${r}`:"/notifications";return Rt.get(i)},ER=e=>Rt.patch(`/notifications/${e}/read`),jR=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([l,c])=>{c!=null&&c!==""&&t.set(l,c)});const r=t.toString(),i=r?`/notifications/read-all?${r}`:"/notifications/read-all";return Rt.patch(i)},_R=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([l,c])=>{c!=null&&c!==""&&t.set(l,c)});const r=t.toString(),i=r?`/notifications/unread-count?${r}`:"/notifications/unread-count";return Rt.get(i)},O1=u.createContext(null),zh=3e4,CR=12e4;function AR({children:e}){const{user:t,sessionReady:r}=En(),[i,l]=u.useState([]),[c,f]=u.useState(0),[m,h]=u.useState(!1),[p,y]=u.useState(""),g=u.useRef(null),v=u.useRef(null),S=u.useRef(!0);u.useEffect(()=>{const _=()=>{S.current=!document.hidden,!document.hidden&&v.current&&Date.now()-v.current>zh&&(w(),N())};return document.addEventListener("visibilitychange",_),()=>{document.removeEventListener("visibilitychange",_)}},[]);const w=u.useCallback(async()=>{if(!t?.id||!r){l([]),h(!1);return}h(!0),y("");try{const _=await L1({limit:50}),R=Array.isArray(_?.data)?_.data:[];l(R),v.current=Date.now()}catch(_){console.error(" Failed to load notifications",_),y(_.message||"Failed to load notifications")}finally{h(!1)}},[t?.id,r]),N=u.useCallback(async()=>{if(!t?.id||!r){f(0);return}try{const R=(await _R())?.count??0;f(R)}catch(_){console.error(" Failed to load unread count",_)}},[t?.id,r]),E=u.useCallback(()=>{w(),N()},[w,N]),C=u.useCallback(async _=>{if(_)try{await ER(_),l(R=>R.map(D=>D.id===_?{...D,read:!0,readAt:new Date().toISOString()}:D)),f(R=>Math.max(0,R-1))}catch(R){throw console.error(" Failed to mark notification read",R),R}},[]),A=u.useCallback(async(_={})=>{try{await jR(_),l(R=>R.map(D=>({...D,read:!0,readAt:new Date().toISOString()}))),f(0)}catch(R){throw console.error(" Failed to mark all notifications read",R),R}},[]);u.useEffect(()=>{if(!t?.id||!r){g.current&&(clearInterval(g.current),g.current=null),l([]),f(0);return}w(),N();const _=()=>{g.current&&clearInterval(g.current);const D=S.current?zh:CR;g.current=setInterval(()=>{S.current?(N(),(!v.current||Date.now()-v.current>zh*2)&&w()):N()},D)};_();const R=()=>{S.current=!document.hidden,_()};return document.addEventListener("visibilitychange",R),()=>{g.current&&(clearInterval(g.current),g.current=null),document.removeEventListener("visibilitychange",R)}},[t?.id,r,w,N]);const O=u.useMemo(()=>({notifications:i,unreadCount:c,loading:m,error:p,refresh:E,markRead:C,markAllRead:A}),[i,c,m,p,E,C,A]);return a.jsx(O1.Provider,{value:O,children:e})}function TR(){const e=u.useContext(O1);if(!e)throw new Error("useNotifications must be used within NotificationProvider");return e}function z1(){return TR()}function $1({open:e,campaignName:t,onSwitch:r,onCancel:i}){return e?a.jsx("div",{className:"unsaved-dialog-backdrop",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"unsaved-dialog",role:"document",children:[a.jsxs("div",{className:"unsaved-dialog-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"unsaved-dialog-label",children:"Campaign context"}),a.jsx("h2",{children:"Switch campaign context?"})]}),a.jsx("button",{type:"button",className:"icon-btn","aria-label":"Close dialog",onClick:i,children:a.jsx(Ia,{size:18})})]}),a.jsxs("div",{className:"unsaved-dialog-body",children:[a.jsxs("p",{children:["This notification is for the campaign ",a.jsx("strong",{children:t||"another campaign"}),". You're currently viewing a different campaign context."]}),a.jsx("p",{className:"unsaved-dialog-help",children:"Would you like to switch to the correct campaign context to view this notification?"})]}),a.jsxs("div",{className:"unsaved-dialog-actions",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:r,children:"Switch campaign context"}),a.jsx("button",{type:"button",className:"btn cancel",onClick:i,children:"Cancel"})]})]})}):null}const MR=e=>{if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const i=new Date-t,l=Math.floor(i/6e4),c=Math.floor(i/36e5),f=Math.floor(i/864e5);return l<1?"Just now":l<60?`${l}m ago`:c<24?`${c}h ago`:f<7?`${f}d ago`:t.toLocaleDateString(void 0,{month:"short",day:"numeric"})},RR=e=>{const{type:t,metadata:r={}}=e;switch(t){case"entity_comment":return`${r.author_name||"Someone"} commented on ${r.entity_name||"an entity"}`;case"entity_mention_entity_note":return`${r.author_name||"Someone"} mentioned ${r.related_entity_name||"an entity"} in a note`;case"entity_mention_session_note":return`${r.author_name||"Someone"} mentioned ${r.related_entity_name||"an entity"} in a session note`;case"session_note_added":return`${r.author_name||"Someone"} created a session note${r.campaign_name?` for ${r.campaign_name}`:""}`;case"session_note_updated":return`${r.author_name||"Someone"} updated a session note${r.campaign_name?` for ${r.campaign_name}`:""}`;case"request_note_added":return`${r.author_name||"Someone"} added a note to "${r.request_title||"a feature/bug"}"`;case"request_status_changed":return`Status changed for "${r.request_title||"a feature/bug"}"`;case"request_assigned":return`You were assigned to "${r.request_title||"a feature/bug"}"`;default:return"New notification"}};function kR(){const{notifications:e,unreadCount:t,loading:r,markRead:i}=z1(),{selectedCampaignId:l,setSelectedCampaignId:c}=Un(),f=$n(),[m,h]=u.useState(!1),p=u.useRef(null),[y,g]=u.useState({open:!1,notification:null});u.useEffect(()=>{const A=O=>{p.current&&!p.current.contains(O.target)&&h(!1)};if(m)return document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)}},[m]);const v=e.filter(A=>!A.read).slice(0,5),S=A=>{if(h(!1),A.actionUrl)f(A.actionUrl);else{const{type:O,metadata:_={}}=A;if(O==="entity_comment"||O==="entity_mention_entity_note"){const R=_.entity_id||_.related_entity_id,D=A.campaignId||A.campaign?.id||l;R&&f(`/entities/${R}${D?`?campaignId=${D}`:""}#notes`)}else if(O==="session_note_added"||O==="session_note_updated"||O==="entity_mention_session_note"){const R=A.campaignId||A.campaign?.id||_.target_id||l;f(`/notes/session${R?`?campaignId=${R}`:""}`)}else if(O==="request_note_added"||O==="request_status_changed"||O==="request_assigned"){const R=_.request_id||_.requestId;f(R?`/requests/${R}`:"/requests")}else f("/notifications")}},w=async A=>{if(!A.read)try{await i(A.id)}catch(R){console.error("Failed to mark notification read",R)}const O=A.campaignId||A.campaign?.id||"";if(O&&O!==(l||"")){g({open:!0,notification:A});return}S(A)},N=()=>{const{notification:A}=y;if(!A)return;const O=A.campaignId||A.campaign?.id||"";O&&c(O),g({open:!1,notification:null}),setTimeout(()=>{S(A)},100)},E=()=>{g({open:!1,notification:null})},C=v.length>0;return a.jsxs("div",{className:"notification-widget",ref:p,children:[a.jsxs("button",{type:"button",className:"notification-widget-button",onClick:()=>h(!m),title:"Notifications",children:[t>0?a.jsx(Ry,{size:20}):a.jsx(Td,{size:20}),t>0&&a.jsx("span",{className:"notification-widget-badge",children:t>99?"99+":t})]}),m&&a.jsxs("div",{className:"notification-widget-dropdown",children:[a.jsxs("div",{className:"notification-widget-header",children:[a.jsx("h3",{children:"Notifications"}),t>0&&a.jsxs("span",{className:"notification-widget-count",children:[t," unread"]})]}),r?a.jsx("div",{className:"notification-widget-loading",children:"Loading..."}):C?a.jsx("div",{className:"notification-widget-list",children:v.map(A=>a.jsxs("div",{className:`notification-widget-item ${A.read?"read":"unread"}`,onClick:()=>w(A),children:[a.jsxs("div",{className:"notification-widget-item-content",children:[a.jsx("p",{className:"notification-widget-item-message",children:RR(A)}),a.jsx("span",{className:"notification-widget-item-time",children:MR(A.createdAt)})]}),!A.read&&a.jsx("div",{className:"notification-widget-item-dot"})]},A.id))}):a.jsx("div",{className:"notification-widget-empty",children:"No new notifications"}),a.jsx("div",{className:"notification-widget-footer",children:a.jsxs(Qt,{to:"/notifications",className:"notification-widget-view-all",onClick:()=>h(!1),children:["View all notifications ",a.jsx(Dy,{size:14})]})})]}),a.jsx($1,{open:y.open,campaignName:y.notification?.campaign?.name||"",onSwitch:N,onCancel:E})]})}const DR=(e={})=>{const t=new URLSearchParams,r=e.viewAsCharacterId??e.characterId??e.character_id??e.viewAs;if(r!=null){const i=String(r).trim();i&&t.set("viewAsCharacterId",i)}return t.toString()},lc=(e,t={})=>{if(!e)return Promise.reject(new Error("worldId is required to load entities"));const r=new URLSearchParams,i=DR(t);i&&r.set("viewAsCharacterId",new URLSearchParams(i).get("viewAsCharacterId")),t.importance!==void 0&&t.importance!==null&&(Array.isArray(t.importance)?t.importance:[t.importance]).forEach(m=>{m!=null&&r.append("importance[]",m)});const l=r.toString(),c=l?`?${l}`:"";return Rt.get(`/worlds/${e}/entities${c}`)},IR=()=>Rt.get("/entities/unassigned"),or=e=>Rt.get(`/entities/${e}`),rf=({worldId:e,query:t,typeIds:r=[],limit:i=20,offset:l=0})=>{if(!e)return Promise.reject(new Error("worldId is required"));const c=new URLSearchParams;c.set("worldId",e),t&&c.set("q",t),(Array.isArray(r)?r:[r]).map(h=>h==null?"":String(h).trim()).filter(Boolean).forEach(h=>{c.append("typeIds[]",h)}),i!=null&&c.set("limit",i),l!=null&&c.set("offset",l);const m=c.toString();return Rt.get(`/entities/search${m?`?${m}`:""}`)},LR=({query:e,campaignId:t,worldId:r,limit:i=20,offset:l=0})=>{const c=new URLSearchParams;e&&c.set("q",e),t&&c.set("campaignId",t),r&&c.set("worldId",r),i!=null&&c.set("limit",i),l!=null&&c.set("offset",l);const f=c.toString();return Rt.get(`/entities/global-search${f?`?${f}`:""}`)},Fy=e=>Rt.post("/entities",e),By=(e,t)=>Rt.patch(`/entities/${e}`,t),OR=(e,t)=>Rt.patch(`/entities/${e}/importance`,{importance:t}),zR=e=>Rt.delete(`/entities/${e}`),F1=(e,t)=>{if(!e)return Promise.reject(new Error("entityId is required"));if(!t)return Promise.reject(new Error("file is required"));const r=new FormData;return r.append("file",t),Rt.post(`/entities/${e}/image`,r)},B1=e=>e?Rt.delete(`/entities/${e}/image`):Promise.reject(new Error("entityId is required")),$R=(e,t)=>Rt.post(`/entities/${e}/secrets`,t),FR=(e,t,r)=>Rt.patch(`/entities/${e}/secrets/${t}`,r),BR=(e,t={})=>{const r=new URLSearchParams,i=t.campaignId??t.campaign_id;i&&r.set("campaignId",i);const l=r.toString();return Rt.get(`/entities/${e}/notes${l?`?${l}`:""}`)},UR=(e,t={})=>{const r=new URLSearchParams,i=t.campaignId??t.campaign_id;i&&r.set("campaignId",i);const l=r.toString();return Rt.get(`/entities/${e}/mentions/entity-notes${l?`?${l}`:""}`)},qR=(e,t={})=>{const r=new URLSearchParams,i=t.campaignId??t.campaign_id;i&&r.set("campaignId",i);const l=r.toString();return Rt.get(`/entities/${e}/mentions/session-notes${l?`?${l}`:""}`)},HR=(e,t)=>Rt.post(`/entities/${e}/notes`,t),U1=(e,t,r)=>Rt.patch(`/entities/${e}/notes/${t}`,r),q1=(e,t,r={})=>{const i=new URLSearchParams,l=r.campaignId??r.campaign_id;l&&i.set("campaignId",l);const c=i.toString();return Rt.delete(`/entities/${e}/notes/${t}${c?`?${c}`:""}`)},PR=async(e,t=1)=>{const r=new URLSearchParams;if(t!=null){const c=Number(t);!Number.isNaN(c)&&c>0&&r.set("depth",String(c))}const i=r.toString(),l=await Rt.get(`/entities/${e}/graph${i?`?${i}`:""}`,{credentials:"include"});if(!l?.success)throw new Error(l?.message||"Failed to load graph");return l.data},VR=300,YR=(e,t)=>{const[r,i]=u.useState(e);return u.useEffect(()=>{const l=setTimeout(()=>i(e),t);return()=>clearTimeout(l)},[e,t]),r},$u=e=>({name:"Name",description:"Description",notes:"Notes",mentions:"Mentions",relationships:"Relationships",title:"Title",content:"Content"})[e]||e;function O0({isMobile:e,onClose:t}){const r=$n(),{selectedCampaignId:i,activeWorldId:l}=Un(),[c,f]=u.useState(""),m=!!(i||l),[h,p]=u.useState({entities:[],sessionNotes:[]}),[y,g]=u.useState(!1),[v,S]=u.useState(""),[w,N]=u.useState(-1),[E,C]=u.useState(!1),A=YR(c,VR),O=u.useRef(null),_=u.useRef(null),R=u.useRef(0),D=u.useMemo(()=>{const F=[];return h.entities.forEach(I=>{F.push({type:"entity",data:I})}),h.sessionNotes.forEach(I=>{F.push({type:"sessionNote",data:I})}),F},[h]),j=D.length>0,z=E&&(c.trim().length>0||j),P=u.useCallback(async F=>{if(!F.trim()){p({entities:[],sessionNotes:[]}),g(!1);return}if(!m){S("Please select a campaign or world context to search"),p({entities:[],sessionNotes:[]}),g(!1);return}const I=++R.current;g(!0),S("");try{const L=await LR({query:F,campaignId:i,worldId:l,limit:20,offset:0});if(I!==R.current)return;const $=L?.data||{entities:[],sessionNotes:[]};p({entities:Array.isArray($.entities)?$.entities:[],sessionNotes:Array.isArray($.sessionNotes)?$.sessionNotes:[]})}catch(L){if(I!==R.current)return;S(L.message||"Failed to search"),p({entities:[],sessionNotes:[]})}finally{I===R.current&&g(!1)}},[l,i,m]);u.useEffect(()=>{A.trim().length>0?P(A):(p({entities:[],sessionNotes:[]}),g(!1))},[A,P]),u.useEffect(()=>{E&&_.current&&!e&&_.current.focus()},[E,e]),u.useEffect(()=>{const F=I=>{O.current&&!O.current.contains(I.target)&&(e||C(!1))};if(E)return document.addEventListener("mousedown",F),()=>document.removeEventListener("mousedown",F)},[E,e]),u.useEffect(()=>{const F=I=>{if(z)if(I.key==="ArrowDown")I.preventDefault(),N(L=>L<D.length-1?L+1:L);else if(I.key==="ArrowUp")I.preventDefault(),N(L=>L>0?L-1:-1);else if(I.key==="Enter"&&w>=0){I.preventDefault();const L=D[w];L&&G(L)}else I.key==="Escape"&&(I.preventDefault(),C(!1),f(""),e&&t&&t())};if(z)return document.addEventListener("keydown",F),()=>document.removeEventListener("keydown",F)},[z,w,D,e,t]);const X=F=>{f(F.target.value),N(-1),E||C(!0)},H=()=>{C(!0)},G=F=>{F.type==="entity"?r(`/entities/${F.data.id}`):F.type==="sessionNote"&&r(`/campaigns/${i}/session-notes`),C(!1),f(""),e&&t&&t()},V=()=>{f(""),p({entities:[],sessionNotes:[]}),N(-1),e&&t&&t()},k=F=>{if(!F)return"";try{return new Date(F).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return F}};return e?a.jsxs("div",{className:"global-search-mobile",children:[a.jsx("div",{className:"global-search-mobile-overlay",onClick:t}),a.jsxs("div",{className:"global-search-mobile-content",children:[a.jsxs("div",{className:`global-search-input-wrapper ${m?"":"disabled"}`,children:[a.jsx(ic,{size:20,className:"global-search-icon"}),a.jsx("input",{ref:_,type:"text",className:"global-search-input",placeholder:m?"Search entities and session notes...":"Select a campaign or world to search",value:c,onChange:X,onFocus:H,disabled:!m,autoFocus:!0}),c&&a.jsx("button",{type:"button",className:"global-search-clear",onClick:V,"aria-label":"Clear search",children:a.jsx(Ia,{size:16})})]}),z&&a.jsxs("div",{className:"global-search-results",children:[y&&a.jsx("div",{className:"global-search-loading",children:a.jsx("span",{children:"Searching..."})}),!y&&v&&a.jsx("div",{className:"global-search-error",children:a.jsx("span",{children:v})}),!y&&!v&&!j&&c.trim().length>0&&a.jsx("div",{className:"global-search-empty",children:a.jsx("span",{children:"No results found"})}),!y&&!v&&j&&a.jsx("div",{className:"global-search-results-list",children:D.map((F,I)=>a.jsx("button",{type:"button",className:`global-search-result-item ${I===w?"selected":""}`,onClick:()=>G(F),children:F.type==="entity"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"global-search-result-header",children:[a.jsx("span",{className:"global-search-result-name",children:F.data.name}),F.data.typeName&&a.jsx("span",{className:"global-search-result-type",children:F.data.typeName})]}),a.jsx("div",{className:"global-search-result-meta",children:a.jsxs("span",{className:"global-search-match-type",children:["Matched in ",$u(F.data.matchType)]})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"global-search-result-header",children:[a.jsx("span",{className:"global-search-result-name",children:F.data.session_title||"Session Note"}),a.jsx("span",{className:"global-search-result-type",children:"Session Note"})]}),a.jsx("div",{className:"global-search-result-meta",children:a.jsxs("span",{className:"global-search-match-type",children:[k(F.data.session_date),"  Matched in"," ",$u(F.data.matchType)]})})]})},`${F.type}-${F.data.id}`))})]})]})]}):a.jsxs("div",{className:"global-search",ref:O,children:[a.jsxs("div",{className:`global-search-input-wrapper ${m?"":"disabled"}`,children:[a.jsx(ic,{size:18,className:"global-search-icon"}),a.jsx("input",{ref:_,type:"text",className:"global-search-input",placeholder:m?"Search entities and session notes...":"Select a campaign or world to search",value:c,onChange:X,onFocus:H,disabled:!m}),c&&a.jsx("button",{type:"button",className:"global-search-clear",onClick:V,"aria-label":"Clear search",children:a.jsx(Ia,{size:16})})]}),z&&a.jsxs("div",{className:"global-search-dropdown",children:[y&&a.jsx("div",{className:"global-search-loading",children:a.jsx("span",{children:"Searching..."})}),!y&&v&&a.jsx("div",{className:"global-search-error",children:a.jsx("span",{children:v})}),!y&&!v&&!j&&c.trim().length>0&&a.jsx("div",{className:"global-search-empty",children:a.jsx("span",{children:"No results found"})}),!y&&!v&&j&&a.jsx("div",{className:"global-search-results-list",children:D.map((F,I)=>a.jsx("button",{type:"button",className:`global-search-result-item ${I===w?"selected":""}`,onClick:()=>G(F),children:F.type==="entity"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"global-search-result-header",children:[a.jsx("span",{className:"global-search-result-name",children:F.data.name}),F.data.typeName&&a.jsx("span",{className:"global-search-result-type",children:F.data.typeName})]}),a.jsx("div",{className:"global-search-result-meta",children:a.jsxs("span",{className:"global-search-match-type",children:["Matched in ",$u(F.data.matchType)]})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"global-search-result-header",children:[a.jsx("span",{className:"global-search-result-name",children:F.data.session_title||"Session Note"}),a.jsx("span",{className:"global-search-result-type",children:"Session Note"})]}),a.jsx("div",{className:"global-search-result-meta",children:a.jsxs("span",{className:"global-search-match-type",children:[k(F.data.session_date),"  Matched in"," ",$u(F.data.matchType)]})})]})},`${F.type}-${F.data.id}`))})]})]})}function GR({onMenuToggle:e}){const[t,r]=u.useState(!1),i=u.useRef(null),{user:l,logout:c}=En(),{theme:f,toggleTheme:m}=JM(),{campaigns:h,selectedCampaignId:p,setSelectedCampaignId:y,selectedCampaign:g,loading:v,error:S,worlds:w,selectedWorld:N,selectedWorldId:E,setSelectedWorldId:C,worldLoading:A,worldError:O,viewAsCharacterId:_,setViewAsCharacterId:R}=Un();u.useEffect(()=>{const $e=nt=>{i.current&&!i.current.contains(nt.target)&&r(!1)};return document.addEventListener("mousedown",$e),()=>document.removeEventListener("mousedown",$e)},[]);const D=$e=>{y($e.target.value)},j=$e=>{C($e.target.value)},z=zy(),[P,X]=u.useState([]),[H,G]=u.useState(!1),[V,k]=u.useState(""),[F,I]=u.useState(!1),[L,$]=u.useState(!1),[T,U]=u.useState(!1),M=u.useMemo(()=>!g||!l?"":g.members?.find(nt=>nt?.user_id===l.id)?.role||"",[g,l]),q=u.useMemo(()=>{if(!g?.world)return"";const $e=g.world;return $e.created_by||$e.creator?.id||$e.owner_id||$e.owner?.id||""},[g]),Y=u.useMemo(()=>!p||!l?!1:l.role==="system_admin"||M==="dm"?!0:q?String(q)===String(l.id):!1,[M,p,q,l]);u.useEffect(()=>{Y||R("")},[Y,R]),u.useEffect(()=>{let $e=!1;if(!Y||!p){X([]),G(!1),k("");return}return(async()=>{G(!0),k("");try{const Le=await Is({scope:"others",campaign_id:p}),wt=Array.isArray(Le?.data)?Le.data:Array.isArray(Le)?Le:[];if($e)return;const Tt=wt.map(Ct=>{if(!Ct?.id)return null;const At=Ct.name||"Unnamed character",Ue=Ct.player?.username||Ct.player?.email||Ct.player?.name||"";return{id:String(Ct.id),label:Ue?`${At} (${Ue})`:At}}).filter(Boolean).sort((Ct,At)=>Ct.label.localeCompare(At.label,void 0,{sensitivity:"base"}));X(Tt)}catch(Le){$e||(console.error(" Failed to load characters for view-as context",Le),X([]),k(Le.message||"Unable to load characters"),R(""))}finally{$e||G(!1)}})(),()=>{$e=!0}},[Y,p,R]);const J=u.useMemo(()=>{if(H)return"Loading characters";if(V)return V;if(!_)return"Viewing entities as yourself (DM/owner)";const $e=P.find(nt=>nt.id===_);return $e?`Viewing as ${$e.label}`:"Viewing as selected character"},[_,P,V,H]),ie=u.useMemo(()=>v?"Loading campaigns":S?"Unable to load campaigns":h.length?g?`${g.name}${g.world?.name?`  ${g.world.name}`:""}`:"Select a campaign":"No eligible campaigns",[h,S,v,g]),Z=u.useMemo(()=>g?.world?g.world.name?`Campaign world  ${g.world.name}`:"Campaign world selected":A?"Loading worlds":O?"Unable to load worlds":w.length?N?N.name?`World  ${N.name}`:"Selected world":"Select a world":"No accessible worlds",[g,N,A,O,w.length]),fe=u.useMemo(()=>{const $e=new Set,nt=[];if(w.forEach(Le=>{if(!Le?.id)return;const wt=String(Le.id);$e.has(wt)||(nt.push({id:wt,name:Le.name||`World #${wt}`}),$e.add(wt))}),g?.world?.id){const Le=String(g.world.id);$e.has(Le)||nt.unshift({id:Le,name:g.world.name||"Campaign world"})}return nt},[w,g]);u.useEffect(()=>{z||I(!1)},[z]);const Q=$e=>{if(!l)return"";const nt=$e?.members?.find(Le=>Le.user_id===l.id);return nt?nt.role==="dm"?"DM":nt.role==="player"?"Player":nt.role||"":l.role==="system_admin"?"System Admin":""},se=()=>I(!1),ne=a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"campaign-selector",title:ie,children:[a.jsx("label",{htmlFor:"campaign-context-select",children:"Campaign"}),a.jsxs("select",{id:"campaign-context-select",value:p,onChange:D,disabled:v||!h.length&&!p,children:[a.jsx("option",{value:"",children:v?"Loading campaigns":S?"Unable to load campaigns":h.length?"Select a campaign":"No campaigns available"}),h.map($e=>{const nt=Q($e),Le=[nt?`as ${nt}`:null,$e.world?.name?`World: ${$e.world.name}`:null].filter(Boolean).join("  "),wt=Le?`${$e.name} (${Le})`:$e.name;return a.jsx("option",{value:$e.id,children:wt},$e.id)})]})]}),a.jsxs("div",{className:"campaign-selector",title:Z,children:[a.jsx("label",{htmlFor:"world-context-select",children:"World"}),a.jsxs("select",{id:"world-context-select",value:E,onChange:j,disabled:A,children:[a.jsx("option",{value:"",children:g?.world?g.world.name?`Using ${g.world.name}`:"Using campaign world":A?"Loading worlds":O?"Unable to load worlds":w.length?"Select a world":"No worlds available"}),fe.map($e=>a.jsx("option",{value:$e.id,children:$e.name},$e.id))]})]}),Y&&a.jsxs("div",{className:"campaign-selector",title:J,children:[a.jsx("label",{htmlFor:"character-context-select",children:"View as"}),a.jsxs("select",{id:"character-context-select",value:_,onChange:$e=>R($e.target.value),disabled:H||!!V,children:[a.jsx("option",{value:"",children:H?"Loading characters":V||"Entire campaign context"}),P.map($e=>a.jsx("option",{value:$e.id,children:$e.label},$e.id))]})]})]}),we=a.jsx("button",{type:"button",className:`menu-btn ${z?"menu-btn-icon":"menu-btn-text"}`,onClick:e,"aria-label":z?"Toggle navigation menu":void 0,children:z?a.jsx(HT,{size:20}):"Menu"}),Ie=a.jsx("button",{type:"button",className:`history-btn ${z?"history-btn-icon":"history-btn-text"}`,title:"View recently viewed records","aria-label":z?"Open history":void 0,onClick:()=>$(!0),children:z?a.jsx(Iy,{size:20}):"History"}),Me=a.jsx("button",{type:"button",className:`context-btn ${z?"context-btn-icon":"context-btn-text"}`,onClick:()=>I(!0),"aria-label":z?"Change context":void 0,title:z?"Change context":void 0,disabled:!z,children:z?a.jsx(x1,{size:20}):"Context"}),Ae=!!(p||E),it=a.jsx("button",{type:"button",className:`search-btn ${z?"search-btn-icon":"search-btn-text"} ${Ae?"":"disabled"}`,onClick:()=>Ae&&U(!0),"aria-label":z?"Open search":void 0,title:z?Ae?"Open search":"Select a campaign or world to search":void 0,disabled:!Ae,children:z?a.jsx(ic,{size:20}):"Search"});return a.jsxs("header",{className:"app-header",children:[a.jsx("div",{className:"header-start",children:z?a.jsxs(a.Fragment,{children:[a.jsx("h1",{className:"title",children:a.jsx(Qt,{to:"/",className:"title-link",children:"GameDB"})}),we,Me,it,Ie]}):a.jsxs(a.Fragment,{children:[a.jsx("h1",{className:"title",children:a.jsx(Qt,{to:"/",className:"title-link",children:"GameDB"})}),we,Ie]})}),!z&&a.jsxs("div",{className:"header-center",children:[ne,(p||E)&&a.jsx(O0,{isMobile:!1})]}),a.jsx("div",{className:"header-end",children:a.jsx(kR,{})}),a.jsxs("div",{className:"user-menu",ref:i,children:[a.jsx("button",{className:"user-icon",onClick:()=>r(!t),title:"User Menu",children:a.jsx(AM,{size:20})}),t&&a.jsxs("div",{className:"user-dropdown",children:[a.jsxs("div",{className:"user-info",children:[a.jsx("strong",{children:l?.username||"User"}),a.jsx("br",{}),a.jsx("small",{children:l?.role||""})]}),a.jsxs("button",{className:"dropdown-action",onClick:m,children:[f==="dark"?a.jsx(bM,{size:16}):a.jsx(XT,{size:16}),f==="dark"?"Light mode":"Dark mode"]}),a.jsxs(Qt,{to:"/security",className:"dropdown-action",onClick:()=>r(!1),children:[a.jsx(FT,{size:16}),"Security"]}),a.jsxs("button",{className:"dropdown-action logout",onClick:c,children:[a.jsx(zT,{size:16}),"Logout"]})]})]}),z&&F&&a.jsxs("div",{className:"mobile-context-overlay",role:"dialog","aria-modal":"true",children:[a.jsx("button",{className:"mobile-context-overlay-close",onClick:se,"aria-label":"Close context picker"}),a.jsxs("div",{className:"mobile-context-panel",children:[a.jsxs("div",{className:"mobile-context-header",children:[a.jsx("h2",{children:"Choose context"}),a.jsx("button",{type:"button",onClick:se,"aria-label":"Close context picker",children:a.jsx(Ia,{size:20})})]}),a.jsx("div",{className:"mobile-context-body",children:ne})]})]}),a.jsx(xR,{isOpen:L,onClose:()=>$(!1)}),z&&T&&a.jsx(O0,{isMobile:!0,onClose:()=>U(!1)})]})}const XR=e=>e==null?"":String(e).trim(),Jr=e=>{let t={};typeof e=="string"?t={worldId:e}:e&&typeof e=="object"&&!Array.isArray(e)&&(t={...e});const r=new URLSearchParams,i=XR(t.worldId??t.world_id);if(!i)return Promise.reject(new Error("worldId is required to list entity types"));r.set("worldId",i);const l=r.toString(),c=l?`?${l}`:"";return Rt.get(`/entity-types${c}`)},KR=e=>Rt.post("/entity-types",e),WR=e=>Rt.get(`/entity-types/${e}`),ZR=(e,t)=>Rt.patch(`/entity-types/${e}`,t),QR=e=>Rt.delete(`/entity-types/${e}`),lf=(e,t="perform this action")=>e==null||e===""?Promise.reject(new Error(`Entity type id is required to ${t}`)):null,of=e=>{const t=lf(e,"load entity type field order");return t||Rt.get(`/entity-types/${e}/field-order`)},JR=(e,t)=>{const r=lf(e,"update entity type field order");return r||Rt.put(`/entity-types/${e}/field-order`,t)},cf=e=>{const t=lf(e,"load entity type field rules");return t||Rt.get(`/entity-types/${e}/field-rules`)},ek=(e,t)=>{const r=lf(e,"create entity type field rule");return r||Rt.post(`/entity-types/${e}/field-rules`,t)},H1=(e,t="perform this action")=>e==null||e===""?Promise.reject(new Error(`Field rule id is required to ${t}`)):null,$h=(e,t)=>{const r=H1(e,"update this field rule");return r||Rt.patch(`/entity-type-field-rules/${e}`,t)},tk=e=>{const t=H1(e,"delete this field rule");return t||Rt.delete(`/entity-type-field-rules/${e}`)},P1=(e,t={})=>{if(!e)return Promise.reject(new Error("worldId is required to load entity type usage"));const r=new URLSearchParams,i=t.viewAsCharacterId??t.characterId??t.character_id??t.viewAs;if(i!=null){const f=String(i).trim();f&&r.set("viewAsCharacterId",f)}const l=r.toString(),c=l?`?${l}`:"";return Rt.get(`/worlds/${e}/entity-types${c}`)},nk=e=>Rt.get(`/entity-types/${e}/list-columns`),ak=(e,t)=>Rt.patch(`/entity-types/${e}/list-columns`,t);function sk({open:e,pinned:t,allowPinning:r=!0,onPinToggle:i,onClose:l}){const c=Xa(),{user:f}=En(),{selectedCampaign:m,selectedCampaignId:h,activeWorld:p,activeWorldId:y,viewAsCharacterId:g,contextKey:v}=Un(),[S,w]=u.useState(!1),[N,E]=u.useState(!1),[C,A]=u.useState(!1),[O,_]=u.useState(!1),[R,D]=u.useState(!1),[j,z]=u.useState([]),[P,X]=u.useState(!1),[H,G]=u.useState("");u.useEffect(()=>{z([]),G("")},[v]);const k=u.useMemo(()=>new URLSearchParams(c.search),[c.search]).get("entityType")??"",F=c.pathname==="/entities"||c.pathname.startsWith("/entities/"),I=y||"",L=f?.role==="system_admin",$=!!y,T=u.useMemo(()=>!m||!f?"":m.members?.find(Ae=>Ae?.user_id===f.id)?.role??"",[m,f]),U=u.useMemo(()=>{if(!p||!f?.id)return!1;const Me=p.created_by??p.creator?.id??p.owner_id??p.owner?.id??"";return Me?String(Me)===String(f.id):!1},[p,f?.id]),M=!!($&&(L||T==="dm"||U)),q=!!($&&(L||U)),Y=!!($&&(L||U)),J=!!($&&(L||U)),ie=!!($&&U),Z=u.useMemo(()=>!m||!Array.isArray(m.members)||!f?.id?!1:m.members.some(Me=>Me?.user_id===f.id&&Me?.role==="player"),[m,f]),fe=u.useMemo(()=>!m||!Array.isArray(m.members)||!f?.id?!1:m.members.some(Me=>Me?.user_id===f.id&&Me?.role==="dm"),[m,f]),Q=!!($&&(M||q||Y||J||ie)),se=u.useMemo(()=>h?L?!0:fe||Z:!1,[L,fe,Z,h]);u.useEffect(()=>{let Me=!1;if(!I){z([]),G(""),X(!1);return}return(async()=>{X(!0),G("");try{const it=await P1(I,{viewAsCharacterId:g}),$e=Array.isArray(it?.data)?it.data:Array.isArray(it)?it:[];Me||z($e)}catch(it){Me||(console.error(" Failed to load entity types for world",it),z([]),G("Unable to load entity types"))}finally{Me||X(!1)}})(),()=>{Me=!0}},[I,v,g]);const ne=u.useCallback(Me=>Me==="/"?c.pathname==="/":c.pathname===Me||c.pathname.startsWith(`${Me}/`),[c.pathname]),we=u.useCallback(Me=>{$||(Me.preventDefault(),alert("Please select a campaign or world context before viewing entities."))},[$]),Ie=u.useCallback(Me=>{if(t||Me.defaultPrevented)return;const Ae=Me.target,it=Ae instanceof Element?Ae:Ae?.parentElement;if(!it||typeof it.closest!="function")return;const $e=it.closest("a");$e&&Me.currentTarget.contains($e)&&l()},[t,l]);return a.jsxs("aside",{className:`sidebar ${e?"open":"closed"}`,children:[a.jsxs("div",{className:"sidebar-header",children:[a.jsx("span",{children:"Navigation"}),r&&a.jsx("button",{type:"button",className:`pin-btn ${t?"pinned":""}`,title:t?"Unpin menu":"Pin menu","aria-pressed":t,onClick:i,children:a.jsx(tM,{size:16,className:"pin-icon"})})]}),a.jsxs("nav",{className:"nav-links",onClick:t?void 0:Ie,children:[a.jsx(Qt,{to:"/",className:ne("/")?"active":"",children:"Home"}),a.jsx(Qt,{to:"/worlds",className:ne("/worlds")?"active":"",children:"Worlds"}),Q&&a.jsxs("div",{className:`nav-group ${C?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>A(Me=>!Me),"aria-expanded":!C,"aria-controls":"world-admin-nav",children:[a.jsx("span",{className:"nav-heading",children:"World Admin"}),a.jsx(Hr,{size:14,className:`nav-heading-icon ${C?"collapsed":""}`})]}),a.jsxs("div",{id:"world-admin-nav",className:"nav-sub-links",children:[M&&a.jsxs(Qt,{to:"/entities",className:`nav-entity-link ${F&&!k?"active":""}`,onClick:we,children:[a.jsx(R0,{size:16,className:"nav-icon"}),a.jsx("span",{children:"All Entities"})]}),M&&a.jsxs(Qt,{to:"/entity-relationships",className:`nav-entity-link ${ne("/entity-relationships")?"active":""}`,children:[a.jsx(k0,{size:16,className:"nav-icon"}),a.jsx("span",{children:"All Relationships"})]}),q&&a.jsxs(Qt,{to:"/entity-types",className:`nav-entity-link ${ne("/entity-types")?"active":""}`,children:[a.jsx(uM,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Entity Types"})]}),Y&&a.jsxs(Qt,{to:"/entities/bulk-upload",className:`nav-entity-link ${ne("/entities/bulk-upload")?"active":""}`,children:[a.jsx(R0,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Bulk Entity Upload"})]}),J&&a.jsxs(Qt,{to:"/relationship-types",className:`nav-entity-link ${ne("/relationship-types")?"active":""}`,children:[a.jsx(k0,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Relationship Types"})]}),ie&&I&&a.jsxs(Qt,{to:`/worlds/${I}/access/bulk`,className:`nav-entity-link ${ne(`/worlds/${I}/access/bulk`)?"active":""}`,children:[a.jsx(j1,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Bulk Access Editor"})]}),ie&&I&&a.jsxs(Qt,{to:`/worlds/${I}/collections`,className:`nav-entity-link ${ne(`/worlds/${I}/collections`)?"active":""}`,children:[a.jsx(x1,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Collections"})]}),ie&&I&&a.jsxs(Qt,{to:`/worlds/${I}/access/audit`,className:`nav-entity-link ${ne(`/worlds/${I}/access/audit`)?"active":""}`,children:[a.jsx(v1,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Access Audit Log"})]}),U&&!$&&a.jsx("span",{className:"nav-helper",children:"Select a world you own to use the bulk access tools"})]})]}),a.jsxs("div",{className:`nav-group ${S?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>w(Me=>!Me),"aria-expanded":!S,"aria-controls":"campaigns-nav",children:[a.jsx("span",{className:"nav-heading",children:"Campaigns"}),a.jsx(Hr,{size:14,className:`nav-heading-icon ${S?"collapsed":""}`})]}),a.jsxs("div",{id:"campaigns-nav",className:"nav-sub-links",children:[a.jsx(Qt,{to:"/campaigns/my",className:ne("/campaigns/my")?"active":"",children:"My Campaigns"}),a.jsx(Qt,{to:"/campaigns/all",className:ne("/campaigns/all")?"active":"",children:"All"})]})]}),a.jsxs("div",{className:`nav-group ${O?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>_(Me=>!Me),"aria-expanded":!O,"aria-controls":"entities-nav",children:[a.jsx("span",{className:"nav-heading",children:"Entities"}),a.jsx(Hr,{size:14,className:`nav-heading-icon ${O?"collapsed":""}`})]}),a.jsxs("div",{id:"entities-nav",className:"nav-sub-links",children:[P&&a.jsx("span",{className:"nav-helper",children:"Loading entity types"}),!P&&H&&a.jsx("span",{className:"nav-helper error",children:H}),!P&&!H&&j.length===0&&a.jsx("span",{className:"nav-helper",children:$?"No entities in this world yet":"Select a campaign or world context to see entity types"}),j.map(Me=>a.jsxs(Qt,{to:`/entities?entityType=${Me.id}`,className:`nav-entity-type ${F&&k===Me.id?"active":""}`,children:[a.jsx("span",{className:"nav-entity-label",children:Me.name}),a.jsx("span",{className:"nav-entity-count",children:Me.entityCount})]},Me.id))]})]}),a.jsxs("div",{className:`nav-group ${R?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>D(Me=>!Me),"aria-expanded":!R,"aria-controls":"notes-nav",children:[a.jsx("span",{className:"nav-heading",children:"Notes"}),a.jsx(Hr,{size:14,className:`nav-heading-icon ${R?"collapsed":""}`})]}),a.jsxs("div",{id:"notes-nav",className:"nav-sub-links",children:[!h&&a.jsx("span",{className:"nav-helper",children:"Select a campaign to view notes"}),h&&!se&&a.jsx("span",{className:"nav-helper",children:"Notes are available to campaign members"}),se&&a.jsxs(a.Fragment,{children:[a.jsxs(Qt,{to:"/notes/session",className:ne("/notes/session")?"active":"",children:[a.jsx(Bp,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Session Notes"})]}),a.jsxs(Qt,{to:"/notes/entities",className:ne("/notes/entities")?"active":"",children:[a.jsx(Fp,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Entity Notes"})]})]})]})]}),a.jsxs("div",{className:`nav-group ${N?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>E(Me=>!Me),"aria-expanded":!N,"aria-controls":"characters-nav",children:[a.jsx("span",{className:"nav-heading",children:"Characters"}),a.jsx(Hr,{size:14,className:`nav-heading-icon ${N?"collapsed":""}`})]}),a.jsxs("div",{id:"characters-nav",className:"nav-sub-links",children:[a.jsx(Qt,{to:"/characters/my",className:ne("/characters/my")?"active":"",children:"My Characters"}),h&&Z&&a.jsx(Qt,{to:"/characters/companions",className:ne("/characters/companions")?"active":"",children:"My Companions"}),h&&fe&&a.jsx(Qt,{to:"/characters/others",className:ne("/characters/others")?"active":"",children:"All Characters"}),f?.role==="system_admin"&&a.jsx(Qt,{to:"/characters/all",className:ne("/characters/all")?"active admin-link":"admin-link",children:"All Characters"})]})]}),a.jsxs(Qt,{to:"/requests",className:ne("/requests")?"active":"",children:[a.jsx(Fp,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Feature/Bugs"})]}),f?.role==="system_admin"&&a.jsx(Qt,{to:"/users",className:c.pathname==="/users"?"active admin-link":"admin-link",title:"User Management (Admin Only)",children:"Users"})]})]})}function rk(){const e=()=>typeof window>"u"?!1:window.matchMedia("(max-width: 768px)").matches,[t,r]=u.useState(e),[i,l]=u.useState(()=>!e()),[c,f]=u.useState(!1),m=Xa(),h=u.useRef(i),p=u.useRef(!0);u.useEffect(()=>{if(typeof window>"u")return;const N=window.matchMedia("(max-width: 768px)"),E=C=>{r(C.matches)};return r(N.matches),typeof N.addEventListener=="function"?(N.addEventListener("change",E),()=>N.removeEventListener("change",E)):(N.addListener(E),()=>N.removeListener(E))},[]),u.useEffect(()=>{if(t)l(!1),f(!1);else{const N=p.current;l(N),f(E=>N?!1:E)}},[t]);const y=u.useCallback(()=>{f(N=>!N)},[]),g=u.useCallback(()=>{t||l(N=>{const E=!N;return p.current=E,f(!E),E})},[t]);u.useEffect(()=>{h.current=i},[i]),u.useEffect(()=>{if(i||!c)return;const N=E=>{const C=E.target;(C instanceof Element?C:C&&"parentElement"in C?C.parentElement:null)?.closest?.(".sidebar")||f(!1)};return document.addEventListener("mousedown",N),()=>{document.removeEventListener("mousedown",N)}},[i,c]),u.useEffect(()=>{h.current||f(!1)},[m.pathname,m.search]);const v=(m.pathname||"").match(/^\/entities\/([^/]+)\/?$/),S=!!(v&&v[1]!=="bulk-upload"),w=["content",i?"pinned":"",S?"content--entity-detail":""].filter(Boolean).join(" ");return a.jsxs("div",{className:"app-shell",children:[a.jsx(GR,{onMenuToggle:y}),a.jsxs("div",{className:"app-body",children:[a.jsx(sk,{open:c||i,pinned:i,allowPinning:!t,onPinToggle:g,onClose:()=>f(!1)}),!i&&c&&a.jsx("button",{type:"button",className:"sidebar-overlay","aria-label":"Close navigation menu",onClick:()=>f(!1)}),a.jsxs("main",{className:w,children:[a.jsx(s2,{})," "]})]})]})}const Fu={dm:1,player:2,other:3},ik=(e,t)=>!e||!Array.isArray(e.members)||!t?null:e.members.find(r=>r?.user_id===t)??null;function lk(){const{user:e}=En(),{campaigns:t,loading:r,error:i,selectedCampaignId:l,setSelectedCampaignId:c,selectedCampaign:f,refreshCampaigns:m}=Un(),h=e?.username||"Adventurer",[p,y]=u.useState([]),[g,v]=u.useState([]),[S,w]=u.useState(!1),[N,E]=u.useState(!1),[C,A]=u.useState(""),[O,_]=u.useState(""),R=u.useMemo(()=>Array.isArray(t)?[...t].map(H=>({campaign:H,membership:ik(H,e?.id)})).sort((H,G)=>{const V=Fu[H.membership?.role]??Fu.other,k=Fu[G.membership?.role]??Fu.other;return V!==k?V-k:H.campaign.name.localeCompare(G.campaign.name)}):[],[t,e?.id]),D=H=>{H&&c(String(H))};u.useEffect(()=>{let H=!1;if(y([]),v([]),A(""),_(""),!l||!e?.id)return w(!1),E(!1),()=>{H=!0};const G=k=>(Array.isArray(k?.data)?k.data:Array.isArray(k)?k:[]).map(I=>{const L=Number(I?.level);return{id:I?.id,name:I?.name||"Unnamed character",className:I?.class||"",level:Number.isNaN(L)?null:L,isActive:I?.is_active??!0,playerName:I?.player?.username||""}});return(async()=>{w(!0),E(!1);try{const k=await Is({scope:"my",campaign_id:l});if(H)return;const F=G(k);if(y(F),A(""),w(!1),F.length>0){E(!0);try{const I=await Is({scope:"companions",campaign_id:l});if(H)return;const L=G(I);v(L),_("")}catch(I){if(H)return;console.error(" Failed to load companions for home widgets",I),v([]),_(I.message||"Failed to load companions")}finally{H||E(!1)}}else v([]),_(""),E(!1)}catch(k){if(H)return;console.error(" Failed to load characters for home widgets",k),y([]),v([]),A(k.message||"Failed to load characters"),_(""),w(!1),E(!1)}})(),()=>{H=!0}},[l,e?.id]);const j=()=>r?a.jsxs("div",{className:"home-empty-state",children:[a.jsx(Nn,{className:"spin",size:24}),a.jsx("p",{children:"Loading your campaigns"})]}):i?a.jsxs("div",{className:"home-empty-state error",children:[a.jsx("p",{children:i}),a.jsx("button",{type:"button",className:"home-refresh",onClick:m,children:"Try again"})]}):R.length?a.jsx("div",{className:"campaign-grid",children:R.map(({campaign:H,membership:G})=>{const V=String(H.id),k=l===V,F=G?.role??"guest",I=F==="dm"?"Dungeon Master":F==="player"?"Player":"Observer";return a.jsxs("button",{type:"button",className:`campaign-card ${F} ${k?"active":""}`,onClick:()=>D(V),"aria-pressed":k,children:[a.jsxs("header",{children:[a.jsxs("span",{className:"campaign-role","aria-label":`Role: ${I}`,children:[F==="dm"?a.jsx(yT,{size:18}):a.jsx(xM,{size:18}),I]}),k&&a.jsx("span",{className:"campaign-pill",children:"Active"})]}),a.jsxs("div",{className:"campaign-body",children:[a.jsx("h3",{children:H.name}),H.world?.name&&a.jsxs("p",{className:"campaign-world",children:["World  ",H.world.name]})]}),a.jsx("footer",{children:a.jsx("span",{children:"Set campaign context"})})]},V)})}):a.jsxs("div",{className:"home-empty-state",children:[a.jsx(Di,{size:24}),a.jsx("p",{children:"No campaigns yet. Join one to get started!"})]}),z=()=>S?a.jsxs("div",{className:"home-widget-empty",children:[a.jsx(Nn,{className:"spin",size:20}),a.jsx("p",{children:"Loading your characters"})]}):C?a.jsx("div",{className:"home-widget-error",children:a.jsx("p",{children:C})}):p.length?a.jsx("div",{className:"home-card-grid",children:p.map(H=>a.jsxs("article",{className:"home-card",children:[a.jsxs("header",{children:[a.jsx("h3",{children:H.name}),a.jsx("span",{className:`home-card-status ${H.isActive?"active":"inactive"}`,children:H.isActive?"Active":"Inactive"})]}),a.jsxs("div",{className:"home-card-meta",children:[H.className&&a.jsx("span",{children:H.className}),H.level!==null&&a.jsxs("span",{children:["Level ",H.level]})]})]},H.id))}):a.jsx("div",{className:"home-widget-empty",children:a.jsx("p",{children:"No characters in this campaign yet."})}),P=()=>N?a.jsxs("div",{className:"home-widget-empty",children:[a.jsx(Nn,{className:"spin",size:20}),a.jsx("p",{children:"Loading companions"})]}):O?a.jsx("div",{className:"home-widget-error",children:a.jsx("p",{children:O})}):g.length?a.jsx("div",{className:"home-card-grid",children:g.map(H=>a.jsxs("article",{className:"home-card",children:[a.jsxs("header",{children:[a.jsx("h3",{children:H.name}),a.jsx("span",{className:`home-card-status ${H.isActive?"active":"inactive"}`,children:H.isActive?"Active":"Inactive"})]}),a.jsxs("div",{className:"home-card-meta",children:[H.className&&a.jsx("span",{children:H.className}),H.level!==null&&a.jsxs("span",{children:["Level ",H.level]})]}),H.playerName&&a.jsxs("p",{className:"home-card-player",children:["Played by ",H.playerName]})]},H.id))}):a.jsx("div",{className:"home-widget-empty",children:a.jsx("p",{children:"No companions discovered in this campaign yet."})}),X=!!f&&p.length>0&&!C;return a.jsxs("div",{className:"home-page",children:[a.jsxs("section",{className:"home-hero",children:[a.jsxs("div",{className:"home-hero-text",children:[a.jsx("p",{className:"home-eyebrow",children:"Your Tabletop Worldbuilding Database"}),a.jsxs("h1",{children:["Welcome, ",h,"."]}),a.jsx("p",{className:"home-description",children:"Select a campaign to explore and build the world."})]}),f&&a.jsxs("div",{className:"home-active-campaign",children:[a.jsx("span",{className:"home-active-label",children:"Currently focused"}),a.jsx("h2",{children:f.name}),f.world?.name&&a.jsx("p",{children:f.world.name})]})]}),a.jsxs("section",{className:"home-section",children:[a.jsxs("div",{className:"home-section-header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"Your campaigns"}),a.jsx("p",{children:"Choose a tile below to update the active campaign context."})]}),a.jsx("button",{type:"button",className:"home-refresh",onClick:m,disabled:r,children:"Refresh"})]}),j()]}),X&&a.jsxs(a.Fragment,{children:[a.jsxs("section",{className:"home-section",children:[a.jsxs("div",{className:"home-section-header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"My Characters"}),a.jsxs("p",{children:["Quick access to your heroes in ",f.name,"."]})]}),a.jsx(Qt,{to:"/characters/my",className:"home-link",children:"Manage"})]}),z()]}),a.jsxs("section",{className:"home-section",children:[a.jsxs("div",{className:"home-section-header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"My Companions"}),a.jsxs("p",{children:["Meet the fellow adventurers journeying in ",f.name,"."]})]}),a.jsx(Qt,{to:"/characters/companions",className:"home-link",children:"View list"})]}),P()]})]})]})}function ok({columns:e,visibleCols:t,onChange:r,onClose:i}){const l=u.useRef(null);u.useEffect(()=>{const m=h=>{l.current&&!l.current.contains(h.target)&&i()};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[i]);const c=m=>{r(t.includes(m)?t.filter(h=>h!==m):[...t,m])},f=()=>{r(e.map(m=>m.key)),i()};return a.jsxs("div",{className:"column-picker",ref:l,children:[a.jsx("div",{className:"column-picker-list",children:e.map(m=>a.jsxs("label",{className:"column-option",children:[a.jsx("input",{type:"checkbox",checked:t.includes(m.key),onChange:()=>c(m.key)}),m.label]},m.key))}),a.jsx("button",{className:"reset-btn",onClick:f,children:"Reset Columns"})]})}function Uy({value:e,onChange:t,placeholder:r="Search...",ariaLabel:i}){return a.jsx("input",{className:"search-input compact",type:"text",placeholder:r,"aria-label":i||r,value:e,onChange:l=>t(l.target.value)})}const ck={text:"string",string:"string",varchar:"string",number:"number",integer:"number",float:"number",decimal:"number",numeric:"number",boolean:"boolean",bool:"boolean",checkbox:"boolean",date:"date",datetime:"date",timestamp:"date"},z0={string:[{value:"contains",label:"contains"},{value:"not_contains",label:"doesn't contain"},{value:"equals",label:"is exactly"},{value:"not_equals",label:"is not"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"}],number:[{value:"equals",label:"is"},{value:"not_equals",label:"is not"},{value:"greater_than",label:"is greater than"},{value:"less_than",label:"is less than"},{value:"greater_or_equal",label:"is on or above"},{value:"less_or_equal",label:"is on or below"}],boolean:[{value:"is_true",label:"is true"},{value:"is_false",label:"is false"}],date:[{value:"on",label:"is on"},{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"on_or_before",label:"is on or before"},{value:"on_or_after",label:"is on or after"}]},Ei={logic:"AND",conditions:[]},zl=e=>{if(!e)return"string";const t=String(e).toLowerCase();return ck[t]||"string"},Vp=e=>{const t=zl(e);return z0[t]||z0.string},V1=(e,t="string")=>{if(e==null||e==="")return"Unassigned";const r=zl(t);if(Array.isArray(e))return e.length?e.map(i=>V1(i,t)).join(", "):"Unassigned";if(r==="date"){const i=e instanceof Date?e:new Date(e);return Number.isNaN(i.getTime())?String(e):i.toLocaleDateString()}return r==="boolean"?e?"True":"False":String(e)},Md=e=>{if(e==null||e==="")return null;const t=Number(e);return Number.isNaN(t)?null:t},Rd=e=>{if(e==null||e==="")return null;const t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?null:t},Yp=e=>{if(e==null||e==="")return null;if(typeof e=="string"){const t=e.trim();return t.length>0?t:null}if(typeof e=="object"&&!Array.isArray(e)){const t=e.id??e.value??e.key??e.slug??e.uuid??null;return t!=null?String(t).trim():null}if(Array.isArray(e)){for(const t of e){const r=Yp(t);if(r)return r}return null}return null},Y1=e=>{if(e==null)return"";if(typeof e=="string")return e.toLowerCase();if(typeof e=="number")return String(e);if(typeof e=="boolean")return e?"true":"false";if(e instanceof Date)return e.toISOString().toLowerCase();if(Array.isArray(e))return e.map(t=>Y1(t)).filter(Boolean).join(" ");if(typeof e=="object")try{return JSON.stringify(e).toLowerCase()}catch{return""}return String(e).toLowerCase()},uk=e=>{const t=e.trim().toLowerCase();return t?r=>Y1(r).includes(t):()=>!0},dk=(e,t)=>e.localeCompare(t,void 0,{sensitivity:"base"}),fk=(e,t,r="string")=>{const i=zl(r),l=e==null||e==="",c=t==null||t==="";if(l&&c)return 0;if(l)return 1;if(c)return-1;if(i==="number"){const f=Md(e),m=Md(t);return f===null&&m===null?0:f===null?1:m===null?-1:f-m}if(i==="date"){const f=Rd(e),m=Rd(t);return!f&&!m?0:f?m?f.getTime()-m.getTime():-1:1}if(i==="boolean"){const f=!!e;return f===!!t?0:f?-1:1}return dk(String(e),String(t))},mk=(e,t,r="string")=>{const{operator:i,value:l}=t,c=zl(r),f=r&&String(r).toLowerCase()==="reference",m=h=>{if(f){const S=Yp(h),w=Yp(l)||String(l??"").trim(),N=S?String(S).toLowerCase():"",E=w?String(w).toLowerCase():"";switch(i){case"equals":return N===E&&N.length>0;case"not_equals":return N!==E||N.length===0;case"contains":return N.includes(E);case"not_contains":return!N.includes(E)}}if(c==="number"){const S=Md(h),w=Md(l);if(S===null&&w===null)return i==="equals";if(S===null||w===null)return!1;switch(i){case"equals":return S===w;case"not_equals":return S!==w;case"greater_than":return S>w;case"less_than":return S<w;case"greater_or_equal":return S>=w;case"less_or_equal":return S<=w;default:return!1}}if(c==="date"){const S=Rd(h),w=Rd(l);if(!S||!w)return!1;switch(i){case"on":return S.getFullYear()===w.getFullYear()&&S.getMonth()===w.getMonth()&&S.getDate()===w.getDate();case"before":return S.getTime()<w.getTime();case"after":return S.getTime()>w.getTime();case"on_or_before":return S.getTime()<=w.getTime();case"on_or_after":return S.getTime()>=w.getTime();default:return!1}}if(c==="boolean"){const S=!!h;return i==="is_true"?S===!0:i==="is_false"?S===!1:i==="equals"?S===(String(l).toLowerCase()==="true"):i==="not_equals"?S!==(String(l).toLowerCase()==="true"):!1}const p=String(h??""),y=String(l??""),g=p.toLowerCase(),v=y.toLowerCase();switch(i){case"contains":return g.includes(v);case"not_contains":return!g.includes(v);case"equals":return g===v;case"not_equals":return g!==v;case"starts_with":return g.startsWith(v);case"ends_with":return g.endsWith(v);default:return!1}};return Array.isArray(e)?e.length===0?m(""):i==="not_contains"?e.every(h=>!m(h)):e.some(h=>m(h)):m(e)},G1=e=>{if(!e||typeof e!="object")return!1;const{conditions:t}=e;return Array.isArray(t)?t.some(r=>r.field&&r.operator):!1},yd=(e="",t="string")=>({id:`condition-${Math.random().toString(36).slice(2)}`,field:e,operator:Vp(t)[0]?.value||"equals",value:""}),$0=(e,t)=>{if(!e||!t||typeof t!="string")return;const r=t.split(".");let i=e;for(const l of r){if(i==null)return;i=i[l]}return i},Do=e=>Array.isArray(e)?e:[],hk=(e=[])=>e.map(t=>({...t,dataType:zl(t.dataType||t.type)})),pk={};function X1(e,t=pk){const r=u.useMemo(()=>hk(t.columns||[]),[t.columns]),i=u.useMemo(()=>new Map(r.map(L=>[L.key,L])),[r]),l=u.useCallback((L,$)=>{const T=i.get($)||{};return typeof T.accessor=="function"?T.accessor(L):T.path?$0(L,T.path):$0(L,$)??L?.[$]},[i]),[c,f]=u.useState(""),[m,h]=u.useState({key:"",direction:"asc"}),[p,y]=u.useState(""),[g,v]=u.useState(Ei),[S,w]=u.useState(new Set),N=u.useCallback(()=>{w(new Set)},[]),E=u.useCallback(L=>{L&&h($=>{if($.key===L){const T=$.direction==="asc"?"desc":"asc";return{key:L,direction:T}}return{key:L,direction:"asc"}})},[]),C=u.useCallback(L=>{y($=>{const T=$===L?"":L;return T!==$&&N(),T})},[N]),A=u.useMemo(()=>uk(c),[c]),O=u.useMemo(()=>r.filter(L=>L.searchable!==!1),[r]),_=u.useMemo(()=>{if(!c)return Do(e);const L=A;return Do(e).filter($=>O.some(T=>{const U=l($,T.key);return L(U)}))},[e,A,l,O,c]),R=u.useMemo(()=>g||Ei,[g]),D=u.useMemo(()=>Do(R.conditions),[R]),j=(R.logic||"AND").toUpperCase()==="OR"?"OR":"AND",z=G1(R),P=u.useMemo(()=>z?_.filter(L=>{const $=D.map(T=>{const U=i.get(T.field);if(!U||!T.operator)return!1;const M=l(L,T.field);return mk(M,T,U.dataType)});return j==="OR"?$.some(Boolean):$.every(Boolean)}):_,[_,D,i,l,j,z]),X=u.useMemo(()=>{const L=Do(P);if(!m.key)return L;const $=i.get(m.key);if(!$)return L;const T=[...L];return T.sort((U,M)=>{const q=l(U,m.key),Y=l(M,m.key),J=fk(q,Y,$.dataType);return m.direction==="asc"?J:-J}),T},[P,m,i,l]),H=u.useMemo(()=>{if(!p)return[];const L=i.get(p);if(!L)return[];const $=[],T=new Map;return X.forEach(U=>{const M=l(U,p),q=V1(M,L.dataType),Y=`${p}:${q}`;T.has(Y)||(T.set(Y,$.length),$.push({id:Y,value:M,label:q,items:[]}));const J=T.get(Y);$[J].items.push(U)}),$},[X,p,i,l]),G=u.useCallback(L=>{L&&w($=>{const T=new Set($);return T.has(L)?T.delete(L):T.add(L),T})},[]),V=u.useCallback(L=>L?S.has(L):!1,[S]),k=u.useCallback(()=>{v(Ei)},[]),F=u.useCallback(L=>{if(!L||typeof L!="object"){v(Ei);return}const $=(L.logic||"AND").toUpperCase()==="OR"?"OR":"AND",T=Do(L.conditions).map(U=>{const M=i.get(U.field);return M?{...U,field:M.key,operator:U.operator||yd(M.key,M.dataType).operator,value:U.value??""}:null});v({logic:$,conditions:T.filter(Boolean)})},[i]);return{searchTerm:c,setSearchTerm:f,sortState:m,toggleSort:E,groupBy:p,setGroupBy:C,filters:R,setFilters:F,clearFilters:k,filterActive:z,data:X,groups:H,visibleData:p?H:X,getValue:l,toggleGroupCollapse:G,isGroupCollapsed:V,columns:r}}const K1=e=>{if(!e||typeof e!="object")return e;const t=e.imageData!==void 0?e.imageData:e.image_data!==void 0?e.image_data:null,r=e.imageMimeType!==void 0?e.imageMimeType:e.image_mime_type!==void 0?e.image_mime_type:null;return e.imageData===t&&e.imageMimeType===r?e:{...e,imageData:t,imageMimeType:r}},Va=e=>{if(!e||typeof e!="object")return null;const t=e.data&&typeof e.data=="object"&&"id"in e.data?e.data:e.entity&&typeof e.entity=="object"&&"id"in e.entity?e.entity:"id"in e?e:null;return t?K1(t):null},$l=e=>{if(!e||typeof e!="object")return"";const t=e.imageData??e.image_data,r=e.imageMimeType??e.image_mime_type;return!t||!r?"":`data:${r};base64,${t}`},yk=Object.freeze([]);function oc({worldId:e,label:t,value:r,onChange:i,allowedTypeIds:l=[],disabled:c=!1,placeholder:f="Search entities",staticOptions:m,minSearchLength:h=2,onResolved:p,required:y=!1}){const[g,v]=u.useState(""),[S,w]=u.useState([]),[N,E]=u.useState(!1),[C,A]=u.useState(!1),[O,_]=u.useState(null),[R,D]=u.useState(""),j=u.useRef(null),z=u.useRef(null),P=u.useRef(p),X=u.useMemo(()=>[...l],[JSON.stringify(l)]),H=Array.isArray(m)?m:yk,G=u.useMemo(()=>Array.isArray(H)?H.map((U,M)=>{if(U==null)return null;if(typeof U=="object"){const Y=U.value??U.id??U.key??U.slug??`static-${M}`;if(Y==null)return null;const J=U.label??U.name??U.title??U.display??U.displayName??Y;return{id:String(Y),name:String(J),entity_type:U.entity_type||U.entityType||null,typeName:U.typeName||null,_static:!0}}const q=String(U);return{id:q,name:q,_static:!0}}).filter(Boolean):[],[H]),V=U=>{if(!U)return"";const M=U.entity_type?.name||U.entityType?.name||U.typeName||U.type?.name||"";return M?`${U.name} (${M})`:U.name};u.useEffect(()=>{c&&A(!1)},[c]),u.useEffect(()=>()=>{z.current&&clearTimeout(z.current)},[]),u.useEffect(()=>{if(!r){_(null),v("");return}if(typeof r=="object"&&r.id){const Y=V(r);(!O||O.id!==r.id)&&(_(r),v(Y));return}if(typeof r!="string")return;const U=r;if(O?.id===U)return;const M=G.find(Y=>String(Y.id)===String(U));if(M){_(M),v(V(M));return}let q=!1;return(async()=>{try{const Y=await or(U);if(q)return;const J=Va(Y);if(J?.id){_(J),v(V(J));return}}catch(Y){q||console.warn("Entity lookup failed",Y)}q||(_({id:U,name:U}),v(U))})(),()=>{q=!0}},[r,G,O?.id]),u.useEffect(()=>{if(!g.trim()||O||c)return;const U=g.trim();if(U.length<h){w([]);return}return z.current&&clearTimeout(z.current),z.current=setTimeout(()=>{if(!e){w([]),E(!1);return}(async()=>{try{E(!0),D("");const M=await rf({worldId:e,query:U,typeIds:X,limit:20}),q=Array.isArray(M?.data)?M.data:M;w(Array.isArray(q)?q:[])}catch(M){console.error("Entity search failed",M),w([]),D(M.message||"Failed to search entities.")}finally{E(!1)}})()},400),()=>{z.current&&clearTimeout(z.current)}},[g,e,O,X,c,h]),u.useEffect(()=>{const U=M=>{j.current&&!j.current.contains(M.target)&&A(!1)};return document.addEventListener("mousedown",U),()=>document.removeEventListener("mousedown",U)},[]),u.useEffect(()=>{P.current=p},[p]),u.useEffect(()=>{P.current?.(O||null)},[O]);const k=u.useMemo(()=>{if(!G.length)return[];if(!g.trim())return G;const U=g.trim().toLowerCase();return G.filter(M=>V(M).toLowerCase().includes(U))},[G,g]),F=u.useMemo(()=>{const U=new Map,M=[];return k.forEach(q=>{const Y=q?.id;if(Y==null)return;const J=String(Y);U.has(J)||(U.set(J,!0),M.push(q))}),S.forEach(q=>{const Y=q?.id;if(Y==null)return;const J=String(Y);U.has(J)||(U.set(J,!0),M.push(q))}),M},[k,S]),I=U=>{U&&(_(U),v(V(U)),A(!1),w([]),D(""),i?.(U))},L=()=>{_(null),v(""),w([]),D(""),A(!1),i?.(null)},$=C&&F.length>0,T=C&&!N&&!F.length&&g.trim().length>=h&&!O;return a.jsxs("div",{className:"entity-search-select",ref:j,children:[t&&a.jsx("label",{children:t}),a.jsxs("div",{className:"entity-search-wrapper",children:[a.jsx("input",{type:"text",value:g,required:y,onChange:U=>{const M=U.target.value;v(M),_(null),c||A(!0)},onFocus:()=>{c||A(!0)},disabled:c,placeholder:f,className:"entity-search-input"}),O&&!c&&a.jsx("button",{type:"button",className:"clear-btn",onClick:L,title:"Clear selection","aria-label":"Clear selection",children:""})]}),N&&a.jsx("div",{className:"small text-muted",children:"Searching"}),R&&a.jsx("div",{className:"small text-warning",children:R}),$&&a.jsx("ul",{className:"entity-results",children:F.map(U=>a.jsx("li",{onMouseDown:M=>M.preventDefault(),onClick:()=>I(U),className:O?.id===U.id?"selected":"",children:V(U)},U.id))}),T&&a.jsx("div",{className:"small text-muted",style:{marginTop:"0.25rem"},children:"No matches found."})]})}const F0=e=>Array.isArray(e)?e:[],gk=e=>{const t=e?.options?.choices;return!Array.isArray(t)||t.length===0?[]:t.map((r,i)=>{if(r==null)return null;if(typeof r=="object"){const c=r.value??r.id??r.key??r.slug??`choice-${i}`,f=r.label??r.name??r.title??r.display??c;return c==null?null:{value:String(c),label:String(f??c)}}const l=String(r);return{value:l,label:l}}).filter(Boolean)};function W1({open:e,onClose:t,fields:r=[],value:i=Ei,worldId:l,onApply:c}){const f=Array.isArray(r)?r:[],m=f[0]?.key||"",[h,p]=u.useState(i.logic||"AND"),[y,g]=u.useState(()=>{const D=F0(i.conditions);return D.length>0?D.map(j=>({...j})):[yd(m,f[0]?.dataType)]}),[v,S]=u.useState(new Map);u.useEffect(()=>{if(!e)return;p(i.logic||"AND");const D=F0(i.conditions);D.length>0?g(D.map(j=>({...j}))):g([yd(m,f[0]?.dataType)])},[e,i,m,f]);const w=()=>{const D=y[0]?.field||m,j=f.find(z=>z.key===D);g(z=>[...z,yd(D,j?.dataType)])},N=(D,j)=>{g(z=>{const P=[...z],X=f.find(H=>H.key===j);return P[D]={...P[D],field:j,operator:Vp(X?.dataType)[0]?.value||"equals",value:""},P})},E=(D,j)=>{g(z=>{const P=[...z];return P[D]={...P[D],operator:j},P})},C=(D,j)=>{g(z=>{const P=[...z];return P[D]={...P[D],value:j},P})},A=D=>{g(j=>{if(j.length===1)return j;const z=[...j];return z.splice(D,1),z})},O=()=>{const D=y.map(j=>({...j})).filter(j=>j.field&&j.operator);if(D.length===0){c?.(Ei);return}c?.({logic:h,conditions:D})},_=u.useMemo(()=>(Array.isArray(r)?r:[]).map(j=>({...j,originalDataType:j.dataType||j.type||"string",dataType:zl(j.dataType||j.type)})),[r]),R=u.useCallback((D,j)=>{if(!D){S(X=>{const H=new Map(X),G=y[j];return G?.value&&H.delete(String(G.value)),H});return}const z=String(D.id),P=D.name||`Entity ${z}`;S(X=>{const H=new Map(X);return H.set(z,P),H})},[y]);return e?a.jsx("div",{className:"condition-modal-backdrop",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"condition-modal",children:[a.jsxs("div",{className:"condition-modal-header",children:[a.jsx("h2",{children:"Filters"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:t,"aria-label":"Close filters",children:a.jsx(Ia,{size:18})})]}),a.jsxs("div",{className:"condition-logic",children:[a.jsx("span",{children:"Match records where"}),a.jsxs("div",{className:"logic-toggle",role:"group","aria-label":"Filter logic",children:[a.jsx("button",{type:"button",className:`logic-btn${h==="AND"?" is-active":""}`,onClick:()=>p("AND"),children:"All conditions (AND)"}),a.jsx("button",{type:"button",className:`logic-btn${h==="OR"?" is-active":""}`,onClick:()=>p("OR"),children:"Any condition (OR)"})]})]}),a.jsx("div",{className:"condition-list",children:Array.isArray(y)&&y.map((D,j)=>{const z=_.find(V=>V.key===D.field)||_[0]||{dataType:"string",key:""},P=Vp(z.dataType),X=Array.isArray(P)?P:[],H=D.operator||X[0]?.value||"equals",G=!["is_true","is_false"].includes(H);return a.jsxs("div",{className:"condition-row",children:[a.jsx("select",{className:"condition-field",value:D.field||z.key,onChange:V=>N(j,V.target.value),children:_.map(V=>a.jsx("option",{value:V.key,children:V.label},V.key))}),a.jsx("select",{className:"condition-operator",value:H,onChange:V=>E(j,V.target.value),children:X.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))}),G?(()=>{const V=z.originalDataType||z.dataType,k=V==="boolean"||V==="bool",F=V==="enum",I=z.referenceTypeId||z.reference_type_id||z.referenceType?.id||null,L=(V==="reference"||z.dataType==="reference")&&I,$=(H==="equals"||H==="not_equals")&&(k||F||L);if($&&k)return a.jsxs("select",{className:"condition-value",value:D.value??"",onChange:T=>C(j,T.target.value),children:[a.jsx("option",{value:"",children:"Select..."}),a.jsx("option",{value:"true",children:"True"}),a.jsx("option",{value:"false",children:"False"})]});if($&&F){const T=gk(z),U=Array.isArray(T)?T:[];return U.length===0?a.jsx("input",{className:"condition-value",type:"text",value:D.value??"",onChange:M=>C(j,M.target.value),placeholder:"Value"}):a.jsxs("select",{className:"condition-value",value:D.value??"",onChange:M=>C(j,M.target.value),children:[a.jsx("option",{value:"",children:"Select..."}),U.map(M=>a.jsx("option",{value:M.value,children:M.label},M.value))]})}if($&&L){const T=z.referenceTypeId||z.reference_type_id||z.referenceType?.id||null,U=T?String(T).trim():null,M=z.referenceTypeName||z.reference_type_name||z.referenceType?.name||"entities",q=D.value,Y=U&&U.length>0?[U]:[],J=q||null;return a.jsx("div",{className:"condition-value-reference",children:a.jsx(oc,{worldId:l,value:J,allowedTypeIds:Y,placeholder:`Search ${M.toLowerCase()}...`,disabled:!l||!U,onChange:ie=>{if(!ie)C(j,""),R(null,j);else{const Z=String(ie.id);C(j,Z),R(ie,j)}},onResolved:ie=>R(ie,j),minSearchLength:2})})}return a.jsx("input",{className:"condition-value",type:z.dataType==="number"?"number":z.dataType==="date"?"date":"text",value:D.value??"",onChange:T=>C(j,T.target.value),placeholder:"Value"})})():a.jsx("span",{className:"condition-value placeholder",children:"No value"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>A(j),disabled:y.length===1,"aria-label":"Remove condition",children:a.jsx(ha,{size:16})})]},D.id||`${D.field}-${j}`)})}),a.jsxs("div",{className:"condition-actions",children:[a.jsxs("button",{type:"button",className:"btn secondary",onClick:w,children:[a.jsx(Ya,{size:16})," Add condition"]}),a.jsxs("div",{className:"condition-action-right",children:[G1(i)&&a.jsx("button",{type:"button",className:"btn ghost",onClick:()=>c?.(Ei),children:"Clear filters"}),a.jsx("button",{type:"button",className:"btn submit",onClick:O,children:"Apply filters"})]})]})]})}):null}function uf({data:e,columns:t,title:r,extraActions:i,onRowClick:l}){const[c,f]=u.useState(t.map(R=>R.key)),[m,h]=u.useState(!1),[p,y]=u.useState(!1),[g,v]=u.useState({open:!1,column:null,x:0,y:0}),S=u.useMemo(()=>t.map(R=>({...R,dataType:R.dataType||R.type||"string"})),[t]),w=X1(e,{columns:S}),N=S.filter(R=>c.includes(R.key));u.useEffect(()=>{f(R=>{const D=S.map(z=>z.key),j=R.filter(z=>D.includes(z));return D.forEach(z=>{j.includes(z)||j.push(z)}),j.length===R.length&&j.every((z,P)=>z===R[P])?R:j})},[S]);const E=R=>{w.toggleSort(R.key)},C=(R,D)=>{R.preventDefault(),v({open:!0,column:D,x:R.clientX,y:R.clientY})};u.useEffect(()=>{if(!g.open)return;const R=()=>v({open:!1,column:null,x:0,y:0});return window.addEventListener("click",R),window.addEventListener("contextmenu",R),()=>{window.removeEventListener("click",R),window.removeEventListener("contextmenu",R)}},[g.open]);const A=R=>{w.setGroupBy(R.key),v({open:!1,column:null,x:0,y:0})},O=(R,D)=>{if(typeof D.render=="function")return D.render(R,w.getValue(R,D.key));const j=R[D.key];return j!==void 0?j:w.getValue(R,D.key)},_=w.groupBy?w.groups.some(R=>R.items.length>0):w.data.length>0;return a.jsxs("div",{className:"list-viewer",children:[a.jsxs("div",{className:"list-viewer-header",children:[a.jsx("h2",{children:r}),a.jsxs("div",{className:"list-controls",children:[i&&a.jsx("div",{className:"extra-actions",children:i}),a.jsx(Uy,{value:w.searchTerm,onChange:w.setSearchTerm,placeholder:`Search ${r.toLowerCase()}...`}),a.jsxs("button",{type:"button",className:`btn secondary compact${w.filterActive?" is-active":""}`,onClick:()=>y(!0),children:[a.jsx(Qd,{size:16})," Filters"]}),a.jsxs("div",{className:"column-picker-wrapper",children:[a.jsx("button",{className:"icon-btn",title:"Column settings",onClick:()=>h(R=>!R),children:a.jsx(E1,{size:18})}),m&&a.jsx("div",{className:"column-picker-popover",children:a.jsx(ok,{columns:S,visibleCols:c,onChange:f,onClose:()=>h(!1)})})]})]})]}),_?a.jsx("div",{className:"list-viewer-table-wrapper",children:a.jsxs("table",{children:[a.jsx("thead",{children:a.jsx("tr",{children:N.map(R=>{const D=w.sortState.key===R.key,j=w.sortState.direction,z=w.groupBy===R.key;return a.jsx("th",{onClick:()=>E(R),onContextMenu:P=>C(P,R),className:"sortable-header",role:"button",tabIndex:0,children:a.jsxs("span",{className:"header-label",children:[R.label,D&&a.jsx("span",{className:"sort-indicator",children:j==="asc"?"":""}),z&&a.jsx("span",{className:"group-indicator",children:"Grouped"})]})},R.key)})})}),a.jsx("tbody",{children:w.groupBy?w.groups.map(R=>a.jsxs(u.Fragment,{children:[a.jsx("tr",{className:"group-header-row",children:a.jsxs("td",{colSpan:N.length,children:[a.jsx("button",{type:"button",className:"group-toggle",onClick:()=>w.toggleGroupCollapse(R.id),children:w.isGroupCollapsed(R.id)?a.jsx(Dy,{size:14}):a.jsx(Hr,{size:14})}),a.jsxs("span",{className:"group-label",children:[R.label," ",a.jsxs("span",{className:"group-count",children:["(",R.items.length,")"]})]})]})}),!w.isGroupCollapsed(R.id)&&R.items.map(D=>a.jsx("tr",{onClick:()=>l&&l(D),className:l?"clickable-row":"",children:N.map(j=>a.jsx("td",{"data-column":j.label||j.key,children:O(D,j)},j.key))},D.id))]},R.id)):w.data.map(R=>a.jsx("tr",{onClick:()=>l&&l(R),className:l?"clickable-row":"",children:N.map(D=>a.jsx("td",{"data-column":D.label||D.key,children:O(R,D)},D.key))},R.id))})]})}):a.jsx("div",{className:"empty-state",children:a.jsx("p",{children:"No results found."})}),g.open&&g.column&&a.jsxs("div",{className:"column-context-menu",style:{top:g.y,left:g.x},role:"menu",children:[a.jsx("button",{type:"button",onClick:()=>A(g.column),children:w.groupBy===g.column.key?"Remove grouping":`Group by ${g.column.label}`}),w.groupBy&&w.groupBy!==g.column.key&&a.jsx("button",{type:"button",onClick:()=>A({key:""}),children:"Clear grouping"})]}),a.jsx(W1,{open:p,onClose:()=>y(!1),fields:S.map(R=>({key:R.key,label:R.label,dataType:R.dataType})),value:w.filters,onApply:R=>{w.setFilters(R),y(!1)}})]})}const bk="modulepreload",vk=function(e){return"/"+e},B0={},Z1=function(t,r,i){let l=Promise.resolve();if(r&&r.length>0){let p=function(y){return Promise.all(y.map(g=>Promise.resolve(g).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};var f=p;document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),h=m?.nonce||m?.getAttribute("nonce");l=p(r.map(y=>{if(y=vk(y),y in B0)return;B0[y]=!0;const g=y.endsWith(".css"),v=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${v}`))return;const S=document.createElement("link");if(S.rel=g?"stylesheet":bk,g||(S.as="script"),S.crossOrigin="",S.href=y,h&&S.setAttribute("nonce",h),document.head.appendChild(S),g)return new Promise((w,N)=>{S.addEventListener("load",w),S.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${y}`)))})}))}function c(m){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=m,window.dispatchEvent(h),!h.defaultPrevented)throw m}return l.then(m=>{for(const h of m||[])h.status==="rejected"&&c(h.reason);return t().catch(c)})};function Q1(e){if(!e&&e!==0)return null;if(typeof e=="object"&&e!==null){const r=e.value??e.id??e.key??e.slug??null;if(r==null)return null;const i=e.label??e.name??e.title??e.username??e.email??String(r);return{value:String(r),label:String(i),raw:e}}const t=String(e);return{value:t,label:t,raw:e}}function Rs({selected:e=[],options:t=[],onChange:r,placeholder:i="Search and select...",disabled:l=!1,noOptionsMessage:c="No options available.",loading:f=!1,inputId:m}){const[h,p]=u.useState(""),[y,g]=u.useState(!1),v=u.useRef(null),S=u.useMemo(()=>{const j=t.map(P=>Q1(P)).filter(Boolean),z=new Set;return j.filter(P=>{const X=P.value;return z.has(X)?!1:(z.add(X),!0)})},[t]),w=u.useMemo(()=>{const j=new Set;return e.forEach(z=>{z!=null&&j.add(String(z))}),j},[e]),N=u.useMemo(()=>{const j=new Map(S.map(z=>[z.value,z]));return Array.from(w).map(z=>{const P=j.get(z);return P||{value:z,label:z}})},[S,w]),E=u.useMemo(()=>S.filter(j=>!w.has(j.value)),[S,w]),C=u.useMemo(()=>{if(!h)return E;const j=h.toLowerCase();return E.filter(z=>z.label.toLowerCase().includes(j))},[E,h]);u.useEffect(()=>{if(!y)return;const j=z=>{v.current&&(v.current.contains(z.target)||g(!1))};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[y]);const A=j=>{if(l)return;const z=[],P=new Set;j.forEach(X=>{if(X==null)return;const H=String(X);P.has(H)||(P.add(H),z.push(H))}),r?.(z)},O=j=>{if(!j)return;const z=[...w,j.value];A(z),p(""),g(!1)},_=j=>{const z=String(j),P=Array.from(w).filter(X=>X!==z);A(P)},R=y&&!l,D=()=>f?"Loading options...":E.length===0?w.size>0?"All options selected.":c:"No matches found.";return a.jsxs("div",{className:`list-collector ${l?"disabled":""}`,ref:v,children:[a.jsxs("div",{className:"list-collector-input-wrapper",children:[a.jsx("input",{id:m,type:"text",className:"list-collector-input",value:h,placeholder:i,disabled:l,onFocus:()=>!l&&g(!0),onChange:j=>{p(j.target.value),y||g(!0)},onKeyDown:j=>{j.key==="Enter"&&C.length>0&&(j.preventDefault(),O(C[0])),j.key==="Escape"&&(g(!1),j.currentTarget.blur())}}),a.jsx("span",{className:"list-collector-icon","aria-hidden":"true",children:""})]}),R&&a.jsx("div",{className:"list-collector-dropdown",children:C.length>0?a.jsx("ul",{children:C.map(j=>a.jsx("li",{children:a.jsx("button",{type:"button",onMouseDown:z=>z.preventDefault(),onClick:()=>O(j),className:"list-collector-option",children:j.label})},j.value))}):a.jsx("div",{className:"list-collector-empty",children:D()})}),N.length>0&&a.jsx("div",{className:"list-collector-pills",children:N.map(j=>a.jsxs("span",{className:"list-collector-pill",children:[a.jsx("span",{className:"pill-label",children:j.label}),!l&&a.jsx("button",{type:"button",className:"pill-remove",onClick:()=>_(j.value),"aria-label":`Remove ${j.label}`,children:""})]},j.value))})]})}const xk=e=>e===null?"null":e===void 0?"undefined":Array.isArray(e)?"array":e instanceof Date?"date":typeof e,df=(e,t,r={})=>{const i=(c,f,m,h="<<anonymous>>")=>{const p=f[m];return p==null?(c&&console.warn(`[PropTypes] Prop "${m}" is marked as required in "${h}", but its value is ${String(p)}.`),null):e(p,f,m,h)?(r.afterValidate&&r.afterValidate(p,f,m,h),null):(console.warn(`[PropTypes] Invalid prop "${m}" supplied to "${h}". Expected ${t}, but received ${xk(p)}.`),null)},l=i.bind(null,!1);return l.isRequired=i.bind(null,!0),l._validate=c=>c==null||e(c),l._expectedDescription=t,l},Bu=e=>df(t=>typeof t===e,e),Sk=()=>df(e=>e!==null&&typeof e=="object"&&!Array.isArray(e)&&!(e instanceof Date),"object"),wk=e=>{const t=c=>Array.isArray(c)?!e||typeof e!="function"?!0:c.every(f=>e._validate?e._validate(f):!0):!1,r=(c,f,m,h)=>{Array.isArray(c)&&(!e||typeof e!="function"||c.forEach((p,y)=>{try{e({[`${m}[${y}]`]:p},`${m}[${y}]`,h)}catch{}}))},i=`an array of ${e?._expectedDescription??"the specified type"}`,l=df(t,i,{afterValidate:r});return l._validate=c=>c==null?!0:Array.isArray(c)?c.every(f=>e&&e._validate?e._validate(f):!0):!1,l},Nk=e=>{const t=Array.isArray(e)?e.filter(Boolean):[],r=c=>t.some(f=>f&&typeof f._validate=="function"?f._validate(c):!0),i=t.map(c=>c?._expectedDescription).filter(Boolean),l=i.length>0?i.join(", "):"one of the specified types";return df(r,l)},ln={string:Bu("string"),number:Bu("number"),bool:Bu("boolean"),func:Bu("function"),object:Sk(),arrayOf:e=>wk(e),oneOfType:e=>Nk(e)},Kr=e=>e?Array.isArray(e)?e:Array.isArray(e.data)?e.data:[]:[],Gp=e=>{if(e==null)return null;if(typeof e=="string"){const t=e.trim();return t?t.toLowerCase():null}if(typeof e=="number")return String(e);if(typeof e=="object"){if(Array.isArray(e)){for(const t of e){const r=Gp(t);if(r)return r}return null}return Gp(e.fieldKey??e.field_key??e.key??e.name??e.id)??null}return null},Mn=(e,t)=>{const r=Gp(t);r&&e.add(r)},Ek=e=>{if(!e||typeof e!="object")return[];const t=new Set;return Mn(t,e.id),Mn(t,e.field_id),Mn(t,e.entity_type_field_id),Mn(t,e.fieldId),Mn(t,e.name),Mn(t,e.key),Mn(t,e.field),Mn(t,e.metadataField),Mn(t,e.metadata_field),e?.sourceField&&Mn(t,e.sourceField),e?.source_field&&Mn(t,e.source_field),Array.from(t)},jk=e=>Array.isArray(e)?e.map((t,r)=>{if(!t||typeof t!="object")return null;const i=new Set;if(Mn(i,t.fieldKey),Mn(i,t.field_key),Mn(i,t.field),Mn(i,t.fieldName),Mn(i,t.field_name),Mn(i,t.fieldId),Mn(i,t.field_id),Mn(i,t.target),Mn(i,t.targetField),Mn(i,t.target_field),Mn(i,t.metadataField),Mn(i,t.metadata_field),Mn(i,t.entity_type_field_id),Mn(i,t.name),Mn(i,t.key),t.field&&typeof t.field=="object"&&(Mn(i,t.field.id),Mn(i,t.field.name),Mn(i,t.field.key)),!i.size)return null;const l=(y,g=0)=>{if(y==null||y==="")return g;const v=Number(y);return Number.isFinite(v)?v:g},c=l(t.sectionOrder??t.section_order??t.sectionIndex??t.section_index,0),f=l(t.column??t.columnOrder??t.column_index??t.columnIndex,0),m=l(t.fieldOrder??t.field_order??t.order??t.order_index??t.position??t.sortOrder??t.sort_order,r),h=l(t.priority??t.weight??t.rank,r),p=c*1e6+f*1e4+m*100+h;return{identifiers:Array.from(i),rank:p,sectionOrder:c,columnOrder:f,fieldPosition:m,priority:h}}).filter(Boolean):[],qy=(e=[],t=[])=>{if(!Array.isArray(e)||e.length===0)return[];const r=jk(t),i=new Map;r.length>0&&r.forEach(f=>{f.identifiers.forEach(m=>{i.has(m)||i.set(m,f.rank)})});const l=(f,m)=>{if(f==null||f==="")return m;const h=Number(f);return Number.isFinite(h)?h:m},c=e.map((f,m)=>{const h=Ek(f);let p=Number.POSITIVE_INFINITY;h.forEach(g=>{if(!g)return;const v=i.get(g);v!==void 0&&v<p&&(p=v)});const y=l(f?.sortOrder??f?.sort_order,m);return{field:f,rank:p,fallbackSort:y,index:m}});return c.sort((f,m)=>{const h=Number.isFinite(f.rank),p=Number.isFinite(m.rank);return h&&p&&f.rank!==m.rank?f.rank-m.rank:h&&!p?-1:!h&&p?1:f.fallbackSort!==m.fallbackSort?f.fallbackSort-m.fallbackSort:f.index-m.index}),c.map(f=>f.field)},Hy=e=>!!e&&typeof e=="object"&&!Array.isArray(e),_k=e=>Array.isArray(e)?e:e==null?[]:[e],vs=e=>e==null?null:typeof e=="string"?e.trim()||null:typeof e=="number"?String(e):Hy(e)?vs(e.field??e.fieldKey??e.field_name??e.source??e.sourceField??e.source_field??e.key??e.name??e.target??e.targetField??e.target_field??e.metadataField??e.metadata_field??e.id)??null:null,Ck=e=>{if(!e||typeof e!="object")return null;const t=l=>l==null?null:String(l).trim()||null,r=t(e.key??e.name??e.field);if(r&&r.startsWith("metadata."))return r;const i=t(e.metadataField??e.metadata_field)||(r&&!r.includes(".")?r:null)||t(e.name);return i?i.startsWith("metadata.")?i:`metadata.${i}`:r},Ak=(e=[])=>{const t=new Map,r=(i,l)=>{if(!i||!l)return;const c=vs(i),f=vs(l);!c||!f||(t.set(c,f),t.set(c.toLowerCase(),f))};return e.forEach(i=>{if(!i||typeof i!="object")return;const l=Ck(i);if(!l)return;r(l,l),[i.id,i.field_id,i.fieldId,i.entity_type_field_id,i.field,i.name,i.key,i.metadataField,i.metadata_field,i.fieldKey,i.field_key,i.target,i.targetField,i.target_field,i.source,i.sourceField,i.source_field].forEach(f=>r(f,l))}),t},Tk={eq:"equals","=":"equals","==":"equals","===":"equals",equals:"equals",equal:"equals",match:"equals",matches:"equals",ne:"not_equals","!=":"not_equals","!==":"not_equals",not:"not_equals",notequals:"not_equals",not_equals:"not_equals",different:"not_equals",contains:"contains",includes:"contains",has:"contains",not_contains:"not_contains",excludes:"not_contains",notincludes:"not_contains",in:"in",any:"in",within:"in",not_in:"not_in",none:"not_in",outside:"not_in",gt:"gt",greater:"gt",greater_than:"gt",gte:"gte",ge:"gte",greater_or_equal:"gte",lt:"lt",less:"lt",less_than:"lt",lte:"lte",le:"lte",less_or_equal:"lte",is_set:"is_set",isset:"is_set",set:"is_set",exists:"is_set",present:"is_set",is_not_set:"is_not_set",notset:"is_not_set",missing:"is_not_set",empty:"is_empty",is_empty:"is_empty",not_empty:"is_not_empty",filled:"is_not_empty",truthy:"truthy",falsy:"falsy"},Mk=e=>{if(e==null)return"equals";const t=String(e).trim().toLowerCase();return Tk[t]??"equals"},Rk={all:"all",every:"all",and:"all",any:"any",some:"any",or:"any",either:"any",none:"none",not:"none"},kk=e=>{if(e==null)return"all";const t=String(e).trim().toLowerCase();return Rk[t]??"all"},Dk={show:"show",display:"show",reveal:"show",visible:"show",enable:"show",hide:"hide",remove:"hide",conceal:"hide",hidden:"hide",disable:"hide",require:"require",required:"require",mandatory:"require",optional:"optional",option:"optional",allow:"optional"},Ik=e=>{if(e==null)return null;const t=String(e).trim().toLowerCase();return Dk[t]??null},U0=(e,t=0)=>{if(!e)return null;if(!Hy(e)){if(typeof e=="string"){const[f,...m]=e.split("="),h=vs(f);if(!h)return null;const p=m.join("=").trim();return{field:h,operator:"equals",values:p?[p]:[]}}return null}const r=vs(e.field??e.fieldKey??e.field_name??e.source??e.sourceField??e.source_field??e.input??e.left??e.property??e.key??e.name);if(!r)return null;const i=Mk(e.operator??e.comparator??e.condition??e.type),l=e.values??e.value??e.match??e.compareTo??e.matchValue??e.expected,c=_k(l).filter(f=>f!==void 0);return{field:r,operator:i,values:c,id:e.id??`condition-${t}`}},Lk=e=>{const t=["conditions","criteria","when","rules","predicates","matchers"];for(const i of t)if(Array.isArray(e?.[i]))return e[i].map((l,c)=>U0(l,c)).filter(Boolean);const r=U0(e,0);return r?[r]:[]},Fh=(e,t=0)=>{if(!e||!Hy(e)&&typeof e!="string")return null;if(typeof e=="string"){const l=vs(e);return l?{target:l,action:"show",id:`action-${t}`}:null}const r=vs(e.target??e.targetField??e.target_field??e.field??e.fieldKey??e.field_name??e.path??e.name??e.key??e.metadataField??e.metadata_field),i=Ik(e.action??e.type??e.behavior??e.behaviour??e.effect??e.command);return!r||!i?null:{target:r,action:i,id:e.id??`action-${t}`}},Ok=e=>{const t=["actions","effects","apply","then","responses"];for(const i of t)if(Array.isArray(e?.[i]))return e[i].map((l,c)=>Fh(l,c)).filter(Boolean);if(Array.isArray(e?.targets)&&e.targets.length>0)return e.targets.map((i,l)=>Fh({target:i,action:e.action??e.effect??e.behavior??e.behaviour},l)).filter(Boolean);const r=e.target??e.targetField??e.target_field??e.actionTarget??e.fieldTarget??e.metadataField??e.metadata_field;return r&&(e.action||e.effect||e.behavior||e.behaviour)?[Fh({target:r,action:e.action??e.effect??e.behavior??e.behaviour})].filter(Boolean):[]},Xp=e=>{if(e==null)return"";if(typeof e=="number"&&Number.isFinite(e))return String(e);if(typeof e=="boolean")return e?"true":"false";if(e instanceof Date)return String(e.getTime());if(typeof e=="string")return e.trim().toLowerCase();if(Array.isArray(e))return e.map(t=>Xp(t));if(typeof e=="object")try{return JSON.stringify(e)}catch{return String(e)}return String(e)},hs=(e,t)=>{if(Array.isArray(e))return e.some(f=>hs(f,t));if(Array.isArray(t))return t.some(f=>hs(e,f));const r=Number(e),i=Number(t);if(!Number.isNaN(r)&&!Number.isNaN(i))return r===i;const l=Xp(e),c=Xp(t);return l===c},ml=e=>e==null?!1:typeof e=="string"?e.trim().length>0:Array.isArray(e)?e.length>0:e instanceof Date?!0:typeof e=="object"?Object.keys(e).length>0:!0,zk=(e,t)=>{if(t==null)return;let r=t;if(typeof r!="string"){const l=vs(r);if(!l)return;r=l}if(!r)return;const i=r.replace(/\[(.*?)\]/g,(l,c)=>`.${c.replace(/^['"]|['"]$/g,"")}`).split(".").map(l=>l.trim()).filter(l=>l.length>0);if(i.length)return i.reduce((l,c)=>{if(l!=null)return c==="*"?l:l[c]},e)},Bh=(e,t)=>{if(!e)return!1;const{field:r,operator:i,values:l=[]}=e,c=zk(t,r);switch(i){case"equals":return l.length?l.some(f=>hs(c,f)):!1;case"not_equals":return l.length?l.every(f=>!hs(c,f)):ml(c);case"contains":return Array.isArray(c)?c.some(f=>l.some(m=>hs(f,m))):typeof c=="string"?l.some(f=>f==null?!1:c.toLowerCase().includes(String(f).toLowerCase())):!1;case"not_contains":return Array.isArray(c)?c.every(f=>l.every(m=>!hs(f,m))):typeof c=="string"?l.every(f=>f==null?!0:!c.toLowerCase().includes(String(f).toLowerCase())):!0;case"in":return l.length?Array.isArray(c)?c.some(f=>l.some(m=>hs(f,m))):l.some(f=>hs(c,f)):!1;case"not_in":return l.length?Array.isArray(c)?c.every(f=>l.every(m=>!hs(f,m))):l.every(f=>!hs(c,f)):!0;case"gt":case"gte":case"lt":case"lte":{const f=Number(c);if(Number.isNaN(f))return!1;const m=l.find(p=>p!=null),h=Number(m);return Number.isNaN(h)?!1:i==="gt"?f>h:i==="gte"?f>=h:i==="lt"?f<h:f<=h}case"is_set":return ml(c);case"is_not_set":return!ml(c);case"is_empty":return!ml(c);case"is_not_empty":return ml(c);case"truthy":return!!c;case"falsy":return!c;default:return l.length?l.some(f=>hs(c,f)):ml(c)}},$k=(e,t)=>{const r=Array.isArray(e?.conditions)?e.conditions:[];if(r.length===0)return!0;switch(e?.matchMode){case"any":return r.some(i=>Bh(i,t));case"none":return!r.some(i=>Bh(i,t));case"all":default:return r.every(i=>Bh(i,t))}},Py=(e=[],t=[])=>{if(!Array.isArray(e))return[];const r=Ak(t),i=c=>{const f=vs(c);if(!f)return typeof c=="string"?c:null;if(r.size>0){const m=r.get(f)||r.get(f.toLowerCase());if(m)return m}return f},l=e.map((c,f)=>{if(!c||typeof c!="object"||c.disabled||c.enabled===!1)return null;const m=Array.isArray(c.conditions)&&Array.isArray(c.actions)&&c.conditions.every(w=>w?.field&&w?.operator)&&c.actions.every(w=>w?.target&&w?.action),h=m?c.conditions.map(w=>({...w})):Lk(c),p=m?c.actions.map(w=>({...w})):Ok(c);if(!h.length||!p.length)return null;const y=h.map(w=>{const N=i(w?.field);return N?{...w,field:N}:null}).filter(Boolean),g=p.map(w=>{const N=i(w?.target);return N?{...w,target:N}:null}).filter(Boolean);if(!y.length||!g.length)return null;const v=c.priority??c.order??c.sort??c.rank??f,S=Number.isFinite(Number(v))?Number(v):f;return{id:c.id??`field-rule-${f}`,name:c.name??c.label??"",matchMode:kk(c.matchMode??c.match_mode??c.matchType??c.logic??c.condition),conditions:y,actions:g,priority:S}}).filter(Boolean);return l.sort((c,f)=>c.priority-f.priority),l},Vy=(e,t={})=>{const r=Array.isArray(e)?e:[],i=t&&typeof t=="object"?t:{},l={},c=new Set;return r.forEach(f=>{!f||!$k(f,i)||f.actions.forEach(h=>{if(!h?.target||!h?.action)return;const p=h.target,y=vs(p)?.toLowerCase()??null;l[p]=h.action,y&&l[y]===void 0&&(l[y]=h.action),h.action==="show"?(c.add(p),y&&c.add(y)):h.action==="hide"&&(c.delete(p),y&&c.delete(y))})}),{actionsByField:l,showRuleTargets:c}},cc=(e,t,r=new Set,i=!0)=>{if(!e)return!1;const l=typeof t=="string"?t.toLowerCase():"",c=vs(e)?.toLowerCase()??null;return r instanceof Set&&(r.has(e)||(c?r.has(c):!1))||l==="show"?!1:l==="hide"||l==="hidden"||i===!1},J1=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?typeof e=="string"?e:String(e):t.toLocaleString()},Fk=e=>{const t=e?.value;if(t==null)return"";switch(e?.dataType){case"boolean":return!!t;case"number":{const r=Number(t);return Number.isNaN(r)?t:r}case"enum":return typeof t=="object"&&t!==null?t.value??t.id??t.key??t.slug??t.name??"":t;case"date":return J1(t);case"reference":if(typeof t=="object"&&t!==null){const r=t.label??t.name??t.title??t.display??t.displayName??t.text??t.value??t.id;if(r==null)try{return JSON.stringify(t,null,2)}catch(i){return console.warn(" Failed to serialise reference metadata field",i),String(t)}return String(r)}return t;case"text":if(typeof t=="object")try{return JSON.stringify(t,null,2)}catch(r){return console.warn(" Failed to serialise text metadata field",r),String(t)}return t;default:if(typeof t=="object")try{return JSON.stringify(t,null,2)}catch(r){return console.warn(" Failed to serialise metadata field",r),String(t)}return t}},Bk=e=>{const t=e?.value;return t==null?e?.dataType==="boolean"?!1:"":e?.dataType==="boolean"?!!t:e?.dataType==="reference"&&typeof t=="object"&&t!==null?t.value??t.id??t.key??t.slug??t.uuid??"":t},eN=(e=[])=>!Array.isArray(e)||e.length===0?{}:e.reduce((t,r)=>(r?.name&&(t[r.name]=Fk(r)),t),{}),Uk=(e=[])=>!Array.isArray(e)||e.length===0?{}:e.reduce((t,r)=>(r?.name&&(t[r.name]=Bk(r)),t),{}),qk=(e=[])=>!Array.isArray(e)||e.length===0?{}:e.reduce((t,r)=>{if(!r?.name||r.dataType!=="reference")return t;const i=(()=>{if(r.displayValue)return r.displayValue;if(r.display)return r.display;if(r.selectedLabel)return r.selectedLabel;const l=r.value;return!l||typeof l!="object"?null:l.label??l.name??l.title??l.display??l.displayName??l.text??l.value??l.id??null})();return i==null||(t[r.name]=String(i)),t},{}),Yy=e=>{if(e==null||e==="")return null;if(typeof e=="string"){const t=e.trim();return t.length>0?t:null}if(typeof e=="number"||typeof e=="bigint")return String(e);if(typeof e=="object"&&!Array.isArray(e)){const t=e.id??e.value??e.entity_id??e.entityId??e.key??e.slug??e.uuid??null;if(t!=null){const r=String(t).trim();return r.length>0?r:null}return null}if(Array.isArray(e)){for(const t of e){const r=Yy(t);if(r)return r}return null}return null},Gy=e=>{if(e==null)return null;if(typeof e=="object"&&!Array.isArray(e)){const t=e.displayValue??e.display??e.label??e.name??e.title??e.displayName??e.text??null;if(t!=null){const r=String(t).trim();return r.length>0?r:null}return null}if(Array.isArray(e)){for(const t of e){const r=Gy(t);if(r)return r}return null}return null},q0=450,Uh="preparing-open",tN=e=>{if(e==null)return"";if(Array.isArray(e)){const t=e.map(r=>r==null?null:typeof r=="object"?r.label||r.name||r.title||r.value||r.id||null:String(r)).filter(Boolean);return t.length>0?t.join(", "):""}if(typeof e=="object")try{return JSON.stringify(e,null,2)}catch(t){return console.warn(" Failed to serialise metadata value",t),String(e)}return typeof e=="boolean"?e?"Yes":"No":e===""?"":String(e)},H0=e=>{if(!e||typeof e!="object")return null;const t=e.displayValue??e.label??e.name??e.title??e.display??e.displayName??e.text??e.value??e.id;return t==null?null:String(t)},Hk=e=>{if(!e)return"";const{dataType:t,value:r}=e;if(r==null)return t==="boolean"?"No":"";switch(t){case"boolean":return r?"Yes":"No";case"number":{const i=Number(r);return Number.isNaN(i)?String(r):String(i)}case"enum":return typeof r=="object"&&r!==null?r.label||r.name||r.title||r.value||r.id||"":String(r);case"reference":{if(Array.isArray(r)){const i=r.map(c=>c==null?null:typeof c=="object"?H0(c)||null:String(c)).filter(Boolean);if(i.length>0)return i.join(", ");const l=e.displayValue||e.display||e.selectedLabel||e.referenceName||e.referenceLabel;return l?String(l):""}if(typeof r=="object"&&r!==null){const i=H0(r);if(i)return i;try{return JSON.stringify(r,null,2)}catch(l){return console.warn(" Failed to serialise reference metadata value",l),String(r)}}if(r==="")return"";if(e.displayValue||e.display||e.selectedLabel){const i=e.displayValue||e.display||e.selectedLabel;return i?String(i):""}return String(r)}case"date":return J1(r);case"text":default:return tN(r)}},Pk=(e,t)=>{if(!e)return[];const r=Array.isArray(e.fields)?e.fields:[];if(r.length>0)return qy(r,t).filter(c=>c?.name||c?.label).map((c,f)=>{const m=c.name||c.label||`field-${f}`,h=c.label||c.name||`Field ${f+1}`,p=c?.name?`metadata.${c.name}`:c?.key||m,y=c.visibleByDefault!==void 0?!!c.visibleByDefault:c.visible_by_default!==void 0?!!c.visible_by_default:!0;return{key:m,label:h,value:Hk(c),fieldKey:p,visibleByDefault:y}});const i=e.metadata&&typeof e.metadata=="object"&&e.metadata||e.meta&&typeof e.meta=="object"&&e.meta||null;return i?Object.entries(i).map(([l,c])=>({key:l,label:l,value:tN(c),fieldKey:l&&`metadata.${l}`,visibleByDefault:!0})):[]},Vk=e=>{if(!e)return{};if(Array.isArray(e.fields)&&e.fields.length>0)return eN(e.fields);const t=e.metadata&&typeof e.metadata=="object"&&e.metadata||e.meta&&typeof e.meta=="object"&&e.meta||null;return t?{...t}:{}};function Xy({entity:e,entityId:t,onClose:r,isLoading:i=!1,error:l="",fallbackName:c="",fieldOrder:f=[],fieldRules:m=[]}){const h=$n(),[p,y]=u.useState(()=>t?{entity:e,entityId:t,isLoading:i,error:l,fallbackName:c}:null),[g,v]=u.useState(t?"open":"closed"),S=u.useRef(null),w=u.useRef(null);u.useEffect(()=>()=>{w.current&&(clearTimeout(w.current),w.current=null)},[]),u.useEffect(()=>{if(t&&S.current?.entityId===t&&(S.current={entity:e,entityId:t,isLoading:i,error:l,fallbackName:c}),t){if(!p){y({entity:e,entityId:t,isLoading:i,error:l,fallbackName:c}),v(Uh);return}if(p.entityId===t){y(M=>!M||M.entity===e&&M.isLoading===i&&M.error===l&&M.fallbackName===(c||M.fallbackName||"")?M:{...M,entity:e,isLoading:i,error:l,fallbackName:c||M.fallbackName||""}),g==="closing"&&w.current?(clearTimeout(w.current),w.current=null,S.current=null,v("opening")):g==="closed"&&v(Uh);return}S.current={entity:e,entityId:t,isLoading:i,error:l,fallbackName:c},g!=="closing"&&v("closing"),w.current||(w.current=setTimeout(()=>{y(S.current),S.current=null,v("opening"),w.current=null},q0));return}p&&(g!=="closing"&&v("closing"),w.current||(S.current=null,w.current=setTimeout(()=>{y(null),v("closed"),w.current=null},q0)))},[e,t,i,l,c,p,g]),u.useEffect(()=>{if(g!==Uh)return;const M=requestAnimationFrame(()=>{v("opening")});return()=>cancelAnimationFrame(M)},[g]),u.useEffect(()=>{if(g!=="opening")return;const M=requestAnimationFrame(()=>{v("open")});return()=>cancelAnimationFrame(M)},[g]);const N=!!p,E=g==="closing",C=p?.entity,A=p?.entityId,O=p?.isLoading??!1,_=p?.error??"",R=p?.fallbackName,D=C?.fields,j=u.useMemo(()=>Py(m,D),[m,D]),z=u.useMemo(()=>Vk(C),[C]),P=u.useMemo(()=>({metadata:z}),[z]),X=u.useMemo(()=>Vy(j,P),[j,P]),H=u.useMemo(()=>Pk(C,f),[C,f]),G=u.useMemo(()=>{if(!H.length)return[];const M=X?.actionsByField??{},q=X?.showRuleTargets??new Set;return H.filter(Y=>{if(!Y?.fieldKey)return!0;const J=M[Y.fieldKey],ie=Y.visibleByDefault!==void 0?!!Y.visibleByDefault:Y.visible_by_default!==void 0?!!Y.visible_by_default:!0;return!cc(Y.fieldKey,J,q,ie)})},[H,X]),V=G.length>0,k=C?.name||R||(O?"Loading entity":"Unknown entity"),F=C?.type?.name||C?.typeName||"Entity",I=u.useMemo(()=>$l(C),[C]);if(!N)return null;const $=["entity-info-drawer-wrapper",g==="open"?"entity-info-drawer-wrapper--open":"",g==="opening"?"entity-info-drawer-wrapper--opening":"",E?"entity-info-drawer-wrapper--closing":""].filter(Boolean).join(" "),T=()=>{A&&h(`/entities/${A}`)},U=!!A&&!O&&!_;return a.jsxs("div",{className:$,role:"presentation",children:[a.jsx("div",{className:"entity-info-drawer__overlay",onClick:r,role:"presentation"}),a.jsxs("aside",{className:"entity-info-drawer",role:"complementary","aria-label":"Entity details",children:[a.jsxs("header",{className:"entity-info-drawer__header",children:[a.jsxs("div",{className:"entity-info-drawer__header-top",children:[a.jsx("p",{className:"entity-info-drawer__type",title:F,children:F}),a.jsxs("div",{className:"entity-info-drawer__actions",children:[a.jsx("button",{type:"button",className:"entity-info-drawer__link",onClick:T,disabled:!U,children:"Go to Record"}),a.jsx("button",{type:"button",className:"entity-info-drawer__close",onClick:r,"aria-label":"Close entity details",children:""})]})]}),a.jsx("h2",{className:"entity-info-drawer__title",title:k,children:k})]}),I&&!O&&!_?a.jsx("div",{className:"entity-info-drawer__image",children:a.jsx("img",{src:I,alt:`Portrait of ${k}`,loading:"lazy"})}):null,C?.summary&&!O&&!_&&a.jsx("p",{className:"entity-info-drawer__summary",children:C.summary}),!C?.summary&&C?.description&&!O&&!_&&a.jsx("p",{className:"entity-info-drawer__summary",children:C.description}),O&&a.jsx("p",{className:"entity-info-drawer__status","aria-live":"polite",children:"Loading entity information"}),!!_&&!O&&a.jsx("p",{className:"entity-info-drawer__status entity-info-drawer__status--error","aria-live":"assertive",children:_}),!O&&!_&&V&&a.jsx("dl",{className:"entity-info-drawer__metadata",children:G.map(M=>a.jsxs("div",{className:"entity-info-drawer__metadata-item",children:[a.jsx("dt",{children:M.label}),a.jsx("dd",{children:M.value})]},M.key))}),!O&&!_&&!V&&a.jsx("p",{className:"entity-info-drawer__status",children:"No additional metadata available."})]})]})}Xy.propTypes={entityId:ln.string,onClose:ln.func.isRequired,isLoading:ln.bool,error:ln.string,fallbackName:ln.string,fieldOrder:ln.arrayOf(ln.object),fieldRules:ln.arrayOf(ln.object)};function Ls({entityId:e,entityName:t="entity",className:r=""}){const[i,l]=u.useState(!1),[c,f]=u.useState(!1),[m,h]=u.useState(null),[p,y]=u.useState(""),[g,v]=u.useState([]),[S,w]=u.useState([]),N=u.useRef(null),E=u.useMemo(()=>e==null?null:String(e),[e]);u.useEffect(()=>(N.current||(N.current=document.createElement("div"),document.body.appendChild(N.current)),()=>{N.current&&N.current.parentNode&&(N.current.parentNode.removeChild(N.current),N.current=null)}),[]);const C=u.useCallback(()=>{l(!1),y(""),h(null),f(!1)},[]),A=R=>{if(R.preventDefault(),R.stopPropagation(),e==null)return;const D=typeof t=="string"?t.trim():"";E&&D&&h(j=>j&&j.id===E?j.name||!D?j:{...j,name:D}:{id:E,name:D}),l(!0)};u.useEffect(()=>{if(!E)return;const R=typeof t=="string"?t.trim():"";R&&h(D=>!D||D.id!==E||D.name===R||D.name&&D.name!==R?D:{...D,name:R})},[E,t]),u.useEffect(()=>{if(!i||!E)return;let R=!1;return(async()=>{f(!0),y("");try{const j=await or(E);if(R)return;const z=Va(j);if(!z){h(null),y("Entity not found");return}h(z)}catch(j){if(R)return;console.error(" Failed to load entity preview",j),h(null),y(j.message||"Failed to load entity information")}finally{R||f(!1)}})(),()=>{R=!0}},[i,E]);const O=u.useMemo(()=>m&&(m.entity_type_id||m.entityType?.id||m.entity_type?.id)||null,[m]);u.useEffect(()=>{if(!O){v([]),w([]);return}if(!i)return;let R=!1;return(async()=>{try{const[j,z]=await Promise.all([of(O).catch(P=>(console.error(" Failed to load preview field order",P),null)),cf(O).catch(P=>(console.error(" Failed to load preview field rules",P),null))]);if(R)return;v(Kr(j)),w(Kr(z))}catch(j){if(R)return;console.error(" Failed to load preview field layout",j),v([]),w([])}})(),()=>{R=!0}},[i,O]),u.useEffect(()=>{if(!i)return;const R=D=>{D.key==="Escape"&&(D.preventDefault(),C())};return window.addEventListener("keydown",R),()=>{window.removeEventListener("keydown",R)}},[i,C]);const _=i&&N.current?a.jsx(Xy,{entityId:E,entity:m,isLoading:c,error:p,fallbackName:t,onClose:C,fieldOrder:g,fieldRules:S}):null;return a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:`entity-info-trigger ${r}`.trim(),onClick:A,"aria-label":`View details for ${t}`,children:a.jsx(Ly,{size:16,"aria-hidden":"true"})}),N.current&&Ec.createPortal(_,N.current)]})}Ls.propTypes={entityId:ln.oneOfType([ln.string,ln.number]).isRequired,entityName:ln.string,className:ln.string};function ff({field:e,data:t,onChange:r,mode:i="edit"}){const l=e.key||e.name||e.field||"",[c,f]=u.useState([]),[m,h]=u.useState(!e.optionsSource),[p,y]=u.useState(()=>JSON.stringify(e.optionsCriteria??null)),[g,v]=u.useState(()=>({selectedLabel:e?.selectedLabel?String(e.selectedLabel):"",selectedValue:null})),S=i==="view";async function w(T=5,U=200){for(let M=0;M<T;M++){const q=Qr();if(q)return q;await new Promise(Y=>setTimeout(Y,U))}return null}const N=u.useCallback(T=>{if(T==null)return"null";try{return JSON.stringify(T)}catch(U){return console.warn(" Unable to serialise options criteria",U),String(T)}},[]);u.useEffect(()=>{const T=N(e.optionsCriteria??null);y(U=>U===T?U:T)},[e.optionsCriteria,N]),u.useEffect(()=>{let T=!0;return(async()=>{if(!e.optionsSource){T&&(f([]),h(!0));return}const{API_BASE:M}=await Z1(async()=>{const{API_BASE:se}=await Promise.resolve().then(()=>kM);return{API_BASE:se}},[]);let q=null;const Y=new URLSearchParams;let J=null;const ie=se=>{if(se==null)return null;if(typeof se=="string"){const ne=new URLSearchParams(se);return ne.get("world_id")||ne.get("worldId")}if(Array.isArray(se)){for(const ne of se)if(Array.isArray(ne)&&ne.length>=2){const[we,Ie]=ne;if(we==="world_id"||we==="worldId")return Ie}else if(ne&&typeof ne=="object"){const we=ie(ne);if(we)return we}return null}return typeof se=="object"&&(se.world_id||se.worldId)||null},Z=se=>{if(se==null)return null;if(typeof se=="string"){const ne=new URLSearchParams(se);ne.delete("world_id"),ne.delete("worldId");const we=ne.toString();return we||null}if(Array.isArray(se)){const ne=se.map(we=>{if(Array.isArray(we)&&we.length>=2){const[Ie,Me]=we;return Ie==="world_id"||Ie==="worldId"?null:[Ie,Me]}if(we&&typeof we=="object"){const Ie=Z(we);return Ie||null}return we}).filter(we=>we==null?!1:Array.isArray(we)?!0:typeof we=="object"?Object.keys(we).length>0:!0);return ne.length>0?ne:null}if(typeof se=="object"){const ne={...se};return delete ne.world_id,delete ne.worldId,Object.keys(ne).length>0?ne:null}return se};switch(e.optionsSource){case"worlds":q="/worlds";break;case"campaigns":q="/campaigns";break;case"entities":{const se=ie(e.optionsCriteria),ne=e.worldId||e.world_id||t?.world_id||t?.worldId||null,we=se||ne;if(!we){console.warn(" Unable to resolve world id for entity options"),q=null;break}q=`/worlds/${we}/entities`,J=Z(e.optionsCriteria);break}case"users":q="/users";break;case"players":{q="/users";const se=e.roles||"player,user";Y.set("roles",se);break}default:q=null}if(!q){T&&(f([]),h(!0));return}const Q=(()=>{try{let se;if(q.startsWith("http"))se=new URL(q);else{const Ie=M.replace(/\/$/,""),Me=q.startsWith("/")?q:`/${q}`;se=new URL(`${Ie}${Me}`)}Y.forEach((Ie,Me)=>{Ie!=null&&se.searchParams.append(Me,Ie)});const ne=J??e.optionsCriteria,we=Ie=>{if(!(!Ie&&Ie!==0)){if(typeof Ie=="string"){new URLSearchParams(Ie).forEach((Ae,it)=>{se.searchParams.append(it,Ae)});return}if(Array.isArray(Ie)){Ie.forEach(Me=>{if(Array.isArray(Me)&&Me.length>=2){const[Ae,it]=Me;if(it==null)return;Array.isArray(it)?it.forEach($e=>{$e!=null&&se.searchParams.append(Ae,$e)}):se.searchParams.append(Ae,it);return}typeof Me=="object"&&Me!==null&&we(Me)});return}typeof Ie=="object"&&Object.entries(Ie).forEach(([Me,Ae])=>{Ae!=null&&(Array.isArray(Ae)?Ae.forEach(it=>{it!=null&&se.searchParams.append(Me,it)}):se.searchParams.append(Me,Ae))})}};return we(ne),se}catch(se){return console.error(" Failed to construct options endpoint URL",se),null}})();if(!Q){T&&(f([]),h(!0));return}T&&h(!1);try{const se=await w();if(!se){console.warn(" No auth token available when loading options"),T&&h(!0);return}const ne=await fetch(Q,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${se}`}}),we=ne.headers.get("content-type");if(!we||!we.includes("application/json")){const $e=await ne.text();console.error(` ${e.optionsSource} returned non-JSON response:`,{status:ne.status,statusText:ne.statusText,contentType:we,url:Q.toString(),preview:$e.substring(0,200)}),T&&h(!0);return}const Ie=await ne.json();if(!ne.ok){console.warn(` ${e.optionsSource} fetch failed`,Ie),T&&h(!0);return}e.optionsSource==="worlds"&&console.log(" Worlds response:",Ie);const Me=$e=>{if(!$e||typeof $e!="object")return null;const nt=e.optionValueKey||"id",Le=e.optionLabelKey||"name",wt=$e?.[nt]??$e?.id??null;if(!wt)return null;let Tt=$e?.[Le];if(!Tt){const Ct=["name","title","username"];for(const At of Ct)if($e?.[At]){Tt=$e[At];break}}return Tt||(Tt=String(wt)),{value:wt,label:Tt}},it=(Array.isArray(Ie?.data)?Ie.data:Array.isArray(Ie)?Ie:[]).map(Me).filter(Boolean);T&&(f(it),h(!0),it.length===0&&console.warn(` ${e.optionsSource} returned no data`,Ie))}catch(se){console.error(` Failed to load ${e.optionsSource}:`,se),T&&h(!0)}})(),()=>{T=!1}},[e.optionsSource,e.optionLabelKey,e.optionValueKey,p,e.roles,e.worldId,e.world_id,t?.world_id,t?.worldId]),u.useEffect(()=>{e?.selectedLabel&&v(T=>T.selectedLabel===String(e.selectedLabel)?T:{...T,selectedLabel:String(e.selectedLabel)})},[e?.selectedLabel]);const E=e.label||l,C=(e.type||"text").toLowerCase(),A=e.referenceTypeId??e.reference_type_id??e.referenceType?.id??null,O=e.referenceTypeName??e.reference_type_name??e.referenceType?.name??"",_=l.includes(".")?l.split(".").reduce((T,U)=>T?T[U]:void 0,t):t?.[l],R=["checkbox","boolean"].includes(C)?!!_:C==="multiselect"?Array.isArray(_)?_.map(T=>{if(T==null)return null;if(typeof T=="object"){const U=e.optionValueKey||"id",M=T?.[U]??T?.id??T?.value??T?.key??null;return M==null?null:String(M)}return String(T)}).filter(T=>T!=null):typeof _=="string"&&_.length>0?_.split(",").map(T=>T.trim()).filter(Boolean):[]:_??"",D=e.readonly||e.disabled,j=S||D,z=T=>T==null||T===""?"":Array.isArray(T)?T.length>0?T.join(", "):"":typeof T=="boolean"?T?"Yes":"No":String(T),P=z(R),X=T=>r?.(l,T.target.value),H=T=>r?.(l,T.target.checked),G=u.useCallback((T,U)=>{if(!(!U||typeof U!="string")&&!(!T||typeof T!="object"))return U.includes(".")?U.split(".").filter(M=>M.length>0).reduce((M,q)=>{if(M!=null&&typeof M=="object")return M[q]},T):T?.[U]},[]),V=u.useCallback(()=>{const T=[e.worldId,e.world_id,t?.worldId,t?.world_id];e.world&&typeof e.world=="object"&&T.push(e.world.id,e.world.world_id),t?.world&&typeof t.world=="object"&&T.push(t.world.id,t.world.world_id),t?.metadata&&typeof t.metadata=="object"&&T.push(t.metadata.worldId,t.metadata.world_id);for(const U of T){if(U==null)continue;const M=String(U).trim();if(M)return M}return""},[e.worldId,e.world_id,e.world,t?.worldId,t?.world_id,t?.world,t?.metadata]),k=C==="reference"&&R!==void 0&&R!==null?String(R):"",F=u.useMemo(()=>{if(C!=="reference")return[];const T=e.options?.choices;return Array.isArray(T)?T.map((U,M)=>{if(U==null)return null;if(typeof U=="object"){const Y=U.value??U.id??U.key??U.slug??`choice-${M}`;if(Y==null)return null;const J=U.label??U.name??U.title??U.display??U.displayName??Y;return{value:String(Y),label:String(J)}}const q=String(U);return{value:q,label:q}}).filter(Boolean):[]},[C,e.options?.choices]);if(u.useEffect(()=>{C==="reference"&&(k||v(T=>!T.selectedLabel&&!T.selectedValue?T:{...T,selectedLabel:"",selectedValue:null}))},[C,k]),u.useEffect(()=>{if(C!=="reference"||!k)return;const T=F.find(M=>M.value===k),U=(()=>{if(typeof e.value=="object"&&e.value!==null){const M=e.value.label??e.value.name??e.value.title??e.value.display??e.value.displayName??e.value.text??e.value.value??e.value.id??null;if(M!=null){const q=String(M).trim();if(q)return q}}return T?.label?String(T.label):""})();if(!U){v(M=>M.selectedValue===k?M:{...M,selectedValue:k});return}v(M=>M.selectedValue===k&&M.selectedLabel===U?M:{...M,selectedLabel:U,selectedValue:k})},[C,k,e.value,F]),!l)return console.warn(" Field without key/name skipped:",e),null;const I=T=>{const U=[];return e.helpText&&U.push(a.jsx("p",{className:"help-text",children:e.helpText},"help")),T&&U.push(a.jsx("p",{className:"help-text warning",children:e.noOptionsMessage||"No options available."},"empty")),U};if(C==="reference"){const T=V(),U=typeof O=="string"&&O.trim()?O.trim():"entities",M=F.length>0,Y=!!!(A&&T)&&!M;if(j){let Q=(e.displayKey&&G(t,e.displayKey)?G(t,e.displayKey):null)??g.selectedLabel??F.find(we=>we.value===k)?.label??"";!Q&&k&&(Q=k);const se=Yy(_||e.value||k),ne=Gy(_||e.value)||Q||k;return a.jsxs("div",{className:`form-group ${j?"readonly":""}`,children:[a.jsx("label",{children:E}),a.jsxs("div",{style:{position:"relative",display:"inline-block",width:"100%"},children:[a.jsx("input",{type:"text",value:z(Q),disabled:!0,className:"readonly-control",style:{paddingRight:se?"2.5rem":"0.8rem",width:"100%"}}),se&&a.jsx("div",{style:{position:"absolute",right:"0.5rem",top:"50%",transform:"translateY(-50%)",zIndex:1},children:a.jsx(Ls,{entityId:se,entityName:ne,className:"entity-info-trigger--field-button"})})]}),I(!1)]})}const J=fe=>{if(!fe){r?.(l,""),v(we=>({...we,selectedLabel:"",selectedValue:null}));return}const Q=fe.id??fe.value??fe.key??fe.slug??fe.uuid??null;if(Q==null){r?.(l,"");return}const se=String(Q),ne=fe.name??fe.label??fe.title??fe.display??fe.displayName??"";r?.(l,se),v(we=>({...we,selectedLabel:ne||we.selectedLabel||se,selectedValue:se}))},ie=fe=>{if(!fe){v(we=>({...we,selectedLabel:"",selectedValue:null}));return}const Q=fe.id??fe.value??fe.key??fe.slug??fe.uuid??null;if(Q==null)return;const se=String(Q),ne=fe.name??fe.label??fe.title??fe.display??fe.displayName??"";v(we=>we.selectedValue===se&&we.selectedLabel===ne?we:{...we,selectedLabel:ne||we.selectedLabel||se,selectedValue:se})},Z=k&&g.selectedLabel?{id:k,name:g.selectedLabel}:k;return a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:E}),a.jsx(oc,{worldId:T,value:Z,allowedTypeIds:A?[A]:[],disabled:Y,placeholder:`Search ${U.toLowerCase()}...`,staticOptions:F,onChange:J,onResolved:ie,required:!!e.required}),!A&&a.jsx("p",{className:"help-text warning",children:"Reference type configuration is missing."}),A&&!T&&a.jsx("p",{className:"help-text warning",children:"Select a world to search for entities."}),I(!1)]})}if(["select","dropdown"].includes(C)){const T=[...e.options||[],...c],U=R??"",M=m&&e.optionsSource&&T.length===0;if(j){const q=T.find(ie=>ie?typeof ie=="object"?String(ie.value)===String(U):String(ie)===String(U):!1),Y=e.displayKey&&G(t,e.displayKey)?G(t,e.displayKey):null,J=z(Y||(q?typeof q=="object"?q.label??q.value:q:U));return a.jsxs("div",{className:`form-group ${j?"readonly":""}`,children:[a.jsx("label",{children:E}),a.jsx("input",{type:"text",value:J,disabled:!0,className:"readonly-control"}),I(!1)]})}return a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:E}),a.jsx("div",{className:"select-wrapper",children:a.jsxs("select",{value:U,onChange:X,disabled:M,children:[a.jsx("option",{value:"",children:"Select..."}),T.map((q,Y)=>{const J=typeof q=="object"?q.value:q,ie=typeof q=="object"?q.label:q;return a.jsx("option",{value:J,children:ie},J||Y)})]})}),I(M)]})}if(C==="multiselect"){const T=[...Array.isArray(e.selectedOptions)?e.selectedOptions:[],...Array.isArray(e.prefillOptions)?e.prefillOptions:[]],U=[...e.options||[],...c,...T].map((ie,Z)=>{const fe=Q1(ie);if(fe)return fe;if(typeof ie=="object"&&ie!==null){const se=ie.value??ie.id??ie.key??ie.slug??`opt-${Z}`,ne=ie.label??ie.name??ie.title??ie.username??ie.email??se;return se==null?null:{value:String(se),label:String(ne)}}if(ie==null)return null;const Q=String(ie);return{value:Q,label:Q}}).filter(Boolean),M=new Map,q=U.filter(ie=>{const Z=String(ie.value);return M.has(Z)?!1:(M.set(Z,ie),!0)}),Y=Array.isArray(R)?R.map(ie=>String(ie)).filter(Boolean):[],J=m&&e.optionsSource&&q.length===0;if(j){const ie=Y.map(Z=>{const fe=M.get(String(Z));return fe?fe.label??fe.value??String(Z):String(Z)}).filter(Boolean);return a.jsxs("div",{className:`form-group ${j?"readonly":""}`,children:[a.jsx("label",{children:E}),a.jsx("textarea",{className:"textarea-field",value:ie.length?ie.join(`
`):"",readOnly:!0}),I(!1)]})}return a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:E}),a.jsx(Rs,{selected:Y,options:q,onChange:ie=>r?.(l,ie),placeholder:e.placeholder||"Search and select...",noOptionsMessage:e.noOptionsMessage||"No options available.",loading:!m&&!!e.optionsSource}),I(J)]})}if(["textarea","multiline"].includes(C))return a.jsxs("div",{className:`form-group ${j?"readonly":""}`,children:[a.jsx("label",{children:E}),a.jsx("textarea",{className:"textarea-field",rows:e.rows||4,value:j?P:R,onChange:X,disabled:j}),I(!1)]});if(["checkbox","boolean"].includes(C))return a.jsxs("div",{className:"form-group checkbox",children:[a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:!!R,onChange:H,disabled:j}),E]}),I(!1)]});if(C==="readonly"){const T=R?.username||R?.name||R||"-";return a.jsxs("div",{className:"form-group readonly",children:[a.jsx("label",{children:E}),a.jsx("div",{className:"readonly-value",children:T}),I(!1)]})}const L=(j?"text":e.inputType)||"text",$=(()=>{if(R==null)return"";if(new Set(["number","date","datetime-local","month","time","week","range"]).has(L)&&typeof R=="string"){const U=R.trim();if(!U||U==="")return""}return R})();return j?a.jsxs("div",{className:"form-group readonly",children:[a.jsx("label",{children:E}),a.jsx("div",{className:"readonly-value",children:P}),I(!1)]}):a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:E}),a.jsx("input",{type:L,value:$,onChange:X,placeholder:e.placeholder||"",className:j?"readonly-control":void 0}),I(!1)]})}const nN="You have unsaved changes. Select Cancel to stay here and save, or OK to leave without saving.";function Yk(e,t=nN,r){const i=u.useCallback(({currentLocation:l,nextLocation:c})=>!e||r?.current?!1:!(l.pathname===c.pathname&&l.search===c.search&&l.hash===c.hash),[e,r]);q2({when:i,message:t}),m1(u.useCallback(l=>{!e||r?.current||(l.preventDefault(),l.returnValue="")},[e,r]),{capture:!0})}function Gk({schema:e,initialData:t={},onSubmit:r,onCancel:i,onDelete:l,hideActions:c=!1,enableUnsavedPrompt:f=!0,onStateChange:m,fieldRules:h},p){const[y,g]=u.useState(()=>t?{...t}:{}),[v,S]=u.useState(()=>JSON.stringify(t??{})),[w,N]=u.useState(""),[E,C]=u.useState("success"),[A,O]=u.useState(!1),[_,R]=u.useState(()=>({actionsByField:{},showRuleTargets:new Set})),D=u.useMemo(()=>{if(!e)return[];const q=Array.isArray(e.fields)?e.fields.filter(J=>J&&typeof J=="object"):[],Y=Array.isArray(e.sections)?e.sections.flatMap(J=>Array.isArray(J?.fields)?J.fields:[]).filter(J=>J&&typeof J=="object"):[];return q.length===0&&Y.length===0?[]:[...Y,...q]},[e]),j=u.useMemo(()=>{const q=Array.isArray(h)?h:[];return Py(q,D)},[h,D]);u.useEffect(()=>{const q=t?{...t}:{};g(q),S(JSON.stringify(t??{})),N(""),C("success")},[t]),u.useEffect(()=>{if(!j.length){R({actionsByField:{},showRuleTargets:new Set});return}const q=Vy(j,y);R(q)},[j,y]);const z=u.useMemo(()=>Array.isArray(e?.sections)&&e.sections.length>0?e.sections:Array.isArray(e?.fields)?[{title:e.title,columns:e.columns||1,fields:e.fields}]:[],[e]),P=(q,Y,J)=>{if(!Y||Y.length===0)return q;const ie={...q||{}};let Z=ie;for(let fe=0;fe<Y.length;fe+=1){const Q=Y[fe];if(fe===Y.length-1)Z[Q]=J;else{const ne=Z[Q],we=ne&&typeof ne=="object"&&!Array.isArray(ne)?{...ne}:{};Z[Q]=we,Z=we}}return ie},X=(q,Y)=>{if(!(!Y||typeof Y!="string")&&!(!q||typeof q!="object"))return Y.includes(".")?Y.split(".").filter(J=>J.length>0).reduce((J,ie)=>{if(J!=null&&typeof J=="object")return J[ie]},q):q?.[Y]},H=(q,Y)=>{!q||typeof q!="string"||g(J=>{if(!q.includes("."))return{...J||{},[q]:Y};const ie=q.split(".").filter(Z=>Z.length>0);return ie.length===0?{...J||{}}:P(J,ie,Y)})},G=u.useMemo(()=>JSON.stringify(y??{}),[y]),V=u.useMemo(()=>G!==v,[G,v]),k=u.useRef(!1);u.useEffect(()=>{V||(k.current=!1)},[V]),u.useEffect(()=>{V&&w&&(N(""),C("success"))},[V,w]),u.useEffect(()=>{typeof m=="function"&&m({isDirty:V,isSubmitting:A})},[V,A,m]),Yk(f&&V,void 0,k);const I=u.useCallback(()=>{if(!z.length)return!0;const q=[];return z.forEach(Y=>{(Array.isArray(Y.fields)?Y.fields:[]).forEach(ie=>{const Z=ie?.key||ie?.name||ie?.field;if(!Z)return;const fe=_.actionsByField[Z],Q=ie?.visibleByDefault!==void 0?!!ie.visibleByDefault:ie?.visible_by_default!==void 0?!!ie.visible_by_default:!0;if(cc(Z,fe,_.showRuleTargets,Q)||!(!!ie?.required||fe==="require"))return;const ne=X(y,Z);(Array.isArray(ne)?ne.length>0:ne!=null&&ne!=="")||q.push(ie.label||ie.name||Z)})}),q.length>0?(C("error"),N(`Please complete required fields: ${q.join(", ")}`),!1):!0},[z,y,_]),L=u.useCallback(async()=>{if(!r)return!0;if(!I())return!1;const q=JSON.stringify(y??{});O(!0),C("success"),N(""),k.current=!0;try{const Y=await r(y);if(Y===!1)return k.current=!1,!1;const J=Y&&typeof Y=="object"&&!Array.isArray(Y)?Y:{};S(q);const ie=typeof Y=="string"?Y:J.message||e?.saveSuccessMessage||"";if(ie){const Z=J.status==="error"?"error":"success";C(Z),N(ie)}return k.current=!1,J}catch(Y){return console.error("Failed to submit form:",Y),C("error"),N(Y.message||"Failed to save changes."),k.current=!1,!1}finally{O(!1)}},[y,r,e,I]),$=async q=>{q.preventDefault(),await L()},T=()=>{i&&(!V||window.confirm(nN))&&(S(G),k.current=!0,i())},U=async()=>{if(l)try{await l(y)&&(S(G),k.current=!0)}catch(q){console.error("Failed to delete record:",q)}},M=u.useCallback((q=t)=>{const Y=q?{...q}:{};g(Y),S(JSON.stringify(q??{})),N(""),C("success"),k.current=!1},[t]);return u.useImperativeHandle(p,()=>({submit:L,reset:M,isDirty:()=>V,isSubmitting:()=>A}),[L,M,V,A]),a.jsxs("form",{className:"record-form",onSubmit:$,children:[a.jsx("h2",{className:"form-title",children:e?.title||"Record"}),z.map((q,Y)=>a.jsxs("div",{className:"form-section",children:[q.title?a.jsx("h3",{children:q.title}):null,a.jsx("div",{className:`form-grid cols-${q.columns||1} ${(q.columns||1)>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":""}`,children:(q.fields||[]).map((J,ie)=>{if(!J||typeof J!="object")return console.warn(" Skipping invalid field in schema:",J),null;const Z=J.key||J.name||J.field||`field-${ie}`,fe=_.actionsByField[Z],Q=J.visibleByDefault!==void 0?!!J.visibleByDefault:J.visible_by_default!==void 0?!!J.visible_by_default:!0;if(cc(Z,fe,_.showRuleTargets,Q))return null;const se={...J};fe==="disable"&&(se.disabled=!0),fe==="require"&&(se.required=!0);const ne=J.span||J.colSpan||null,we=a.jsx(ff,{field:se,data:y,onChange:H,mode:"edit"},`${Z}-${ie}`);return ne&&Number.isFinite(ne)&&ne>1?a.jsx("div",{style:{gridColumn:`span ${ne}`},children:we},`${Z}-${ie}-wrapper`):we})})]},Y)),w?a.jsx("div",{className:`form-feedback ${E}`,role:E==="error"?"alert":"status",children:w}):null,c?null:a.jsxs("div",{className:"form-actions sticky-actions",role:"toolbar",children:[a.jsx("div",{className:"left-actions",children:l?a.jsx("button",{type:"button",className:"btn delete",onClick:U,disabled:A,children:e?.deleteLabel||"Delete"}):null}),a.jsxs("div",{className:"right-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:T,disabled:A,children:e?.cancelLabel||"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:A,children:e?.saveLabel||"Save"})]})]})]})}const gs=u.forwardRef(Gk),Xk="Create New World",Kk=[{title:"General",columns:2,fields:[{key:"name",label:"Name",type:"text"},{key:"system",label:"System",type:"text"}]},{title:"Entity Creation",columns:1,fields:[{key:"entity_creation_scope",label:"Who can create entities?",type:"select",options:[{value:"owner_dm",label:"World Owner & DMs"},{value:"all_players",label:"All Players (campaign scoped)"}],helpText:"When set to All Players, campaign members can only create entities scoped to their campaign."}]},{title:"Description",columns:1,fields:[{key:"description",label:"Description",type:"textarea"}]}],Wk={title:Xk,sections:Kk},uc={OWNER_DMS:"owner_dm",ALL_PLAYERS:"all_players"},qh=[{value:uc.OWNER_DMS,label:"World Owner / DMs"},{value:uc.ALL_PLAYERS,label:"All Players (campaign scoped)"}],aN=e=>{if(!e)return qh[0].label;const t=String(e).trim().toLowerCase(),r=qh.find(i=>i.value===t);return r?r.label:qh[0].label};function Zk(){const e=$n(),{token:t,sessionReady:r}=En(),[i,l]=u.useState([]),[c,f]=u.useState(!1),[m,h]=u.useState(null),[p,y]=u.useState(!1),g=u.useCallback(async()=>{if(t){f(!0),h(null);try{const E=await Ol();l(E?.data||E||[])}catch(E){console.error(" Failed to load worlds:",E),h(E.message)}finally{f(!1)}}},[t]);u.useEffect(()=>{r&&t&&g()},[r,t,g]);const v=[{key:"name",label:"Name"},{key:"system",label:"System"},{key:"status",label:"Status"},{key:"entity_creation_scope",label:"Entity Creation",render:E=>aN(E.entity_creation_scope)},{key:"description",label:"Description"},{key:"createdAt",label:"Created"}],S=()=>y(!0),w=()=>y(!1),N=async E=>{try{return(await PM(E)).success?(await g(),y(!1),!0):!1}catch(C){return alert(`Failed to create world: ${C.message}`),!1}};return r?t?c?a.jsx("p",{children:"Loading worlds..."}):m?a.jsxs("p",{className:"error",children:["Error: ",m]}):p?a.jsx(gs,{schema:Wk,initialData:{entity_creation_scope:uc.OWNER_DMS},onSubmit:N,onCancel:w,showUpdateAction:!1}):a.jsx(uf,{data:i,columns:v,title:"Worlds",extraActions:a.jsx("button",{type:"button",className:"btn submit",onClick:S,children:"+ New"}),onRowClick:E=>e(`/worlds/${E.id}`)}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}function sN({schema:e,data:t={},onClose:r,closeLabel:i="Back",infoMessage:l}){const c=u.useMemo(()=>Array.isArray(e?.sections)&&e.sections.length>0?e.sections:Array.isArray(e?.fields)?[{title:e.title,columns:e.columns||1,fields:e.fields}]:[],[e]);return a.jsxs("div",{className:"record-form record-view",children:[a.jsx("h2",{className:"form-title",children:e?.title||"Details"}),c.map((f,m)=>a.jsxs("div",{className:"form-section",children:[f.title?a.jsx("h3",{children:f.title}):null,a.jsx("div",{className:`form-grid cols-${f.columns||1}`,children:(f.fields||[]).map((h,p)=>!h||typeof h!="object"?(console.warn(" Skipping invalid field in schema:",h),null):a.jsx(ff,{field:h,data:t,mode:"view"},`${h.key||h.name||h.field||"field"}-${p}`))})]},m)),l?a.jsx("p",{className:"record-info",children:l}):null,r?a.jsxs("div",{className:"form-actions sticky-actions view-actions",role:"toolbar",children:[a.jsx("div",{className:"left-actions","aria-hidden":"true"}),a.jsx("div",{className:"right-actions",children:a.jsx("button",{type:"button",className:"btn cancel",onClick:r,children:i})})]}):null]})}const Qk="Edit World",Jk=[{title:"General",columns:2,fields:[{key:"name",label:"Name",type:"text"},{key:"system",label:"System",type:"text"},{key:"status",label:"Status",type:"select",options:[{value:"active",label:"Active"},{value:"archived",label:"Archived"}]}]},{title:"Entity Creation",columns:1,fields:[{key:"entity_creation_scope",label:"Who can create entities?",type:"select",options:[{value:"owner_dm",label:"World Owner & DMs"},{value:"all_players",label:"All Players (campaign scoped)"}],helpText:"When set to All Players, campaign members can only create entities scoped to their campaign."}]},{title:"Description",columns:1,fields:[{key:"description",label:"Description",type:"textarea"}]},{title:"Metadata",columns:2,fields:[{key:"created_by",label:"Created By",type:"readonly"},{key:"createdAt",label:"Created Date",type:"readonly"},{key:"updatedAt",label:"Updated Date",type:"readonly"}]}],e3={title:Qk,sections:Jk},t3="World Details",n3=[{title:"General",columns:2,fields:[{name:"name",label:"Name",type:"text"},{name:"system",label:"System",type:"text"},{name:"statusLabel",label:"Status",type:"text"},{name:"entityCreationScopeLabel",label:"Entity Creation",type:"text"}]},{title:"Description",columns:1,fields:[{name:"description",label:"Description",type:"textarea"}]},{title:"Metadata",columns:2,fields:[{name:"ownerName",label:"Created By",type:"text"},{name:"createdAt",label:"Created",type:"text"},{name:"updatedAt",label:"Updated",type:"text"}]}],a3={title:t3,sections:n3},Vr=e=>{if(!e)return"";const t=e instanceof Date?e:new Date(e);if(Number.isNaN(t.getTime()))return typeof e=="string"?e:"";const r=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+1).padStart(2,"0"),l=t.getFullYear(),c=String(t.getHours()).padStart(2,"0"),f=String(t.getMinutes()).padStart(2,"0");return`${r}/${i}/${l} ${c}:${f}`};function s3(){const{id:e}=Ss(),t=$n(),{user:r,token:i,sessionReady:l}=En(),[c,f]=u.useState(null),[m,h]=u.useState(!0),[p,y]=u.useState(null),g=u.useCallback(async()=>{try{const C=await Ol(),A=(C?.data||C||[]).find(O=>O.id===e);f(A),A||y("World not found")}catch(C){console.error(" Failed to load world:",C),y(C.message)}finally{h(!1)}},[e]);u.useEffect(()=>{l&&i&&g()},[l,i,g]);const v=async(C,A={})=>{const{stayOnPage:O=!1}=A;try{const _={name:C?.name,description:C?.description,system:C?.system,status:C?.status,entity_creation_scope:C?.entity_creation_scope},R=await VM(e,_);if(R.success){const D=R.data||{...c,..._};return f(D),O?{message:"World updated successfully."}:(t("/worlds"),!0)}return!1}catch(_){return alert(`Failed to update world: ${_.message}`),!1}},S=async()=>{if(!confirm("Delete this world?"))return!1;try{return(await YM(e)).success?(t("/worlds"),!0):!1}catch(C){return alert(`Failed to delete world: ${C.message}`),!1}},w=u.useMemo(()=>!c||!r?!1:r.role==="system_admin"?!0:c.created_by===r.id,[r,c]),N=u.useMemo(()=>c?{...c,created_by:c.creator||c.created_by}:null,[c]),E=u.useMemo(()=>{if(!c)return null;const C=c.status||"",A=C.length>0?C.charAt(0).toUpperCase()+C.slice(1):"",O=aN(c.entity_creation_scope),_=c.creator?.username||c.creator?.name||c.created_by||"";return{name:c.name||"",system:c.system||"",statusLabel:A,entityCreationScopeLabel:O,description:c.description||"",ownerName:_,createdAt:Vr(c.createdAt),updatedAt:Vr(c.updatedAt)}},[c]);return l?i?m?a.jsx("p",{children:"Loading world..."}):p?a.jsxs("p",{className:"error",children:["Error: ",p]}):c?w?a.jsx(gs,{schema:e3,initialData:N||c,onSubmit:v,onDelete:S,onCancel:()=>t("/worlds")}):a.jsx(sN,{schema:a3,data:E||{},onClose:()=>t("/worlds"),closeLabel:"Back to worlds",infoMessage:"You can view this world but only the creator or a system admin can make changes."}):a.jsx("p",{children:"World not found"}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}async function r3(e=5,t=200){for(let r=0;r<e;r++){const i=Qr();if(i)return i;await new Promise(l=>setTimeout(l,t))}return null}async function Ky(){const e=await r3();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function Wy(e,t="request"){if(e.status===401)throw new Error("Unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${e.status} ${r}`)}return e.json()}async function i3(e){if(!e)throw new Error("campaignId is required");const t=await Ky(),r=new URL(`${Cn}/user-campaign-roles`);r.searchParams.set("campaign_id",e);const i=await fetch(r.toString(),{headers:t});return Wy(i,"load campaign members")}async function l3(e,t){const r=await Ky(),i=await fetch(`${Cn}/user-campaign-roles/${e}`,{method:"PUT",headers:r,body:JSON.stringify(t)});return Wy(i,"update campaign assignment")}async function o3(e){const t=await Ky(),r=await fetch(`${Cn}/user-campaign-roles/${e}`,{method:"DELETE",headers:t});return Wy(r,"remove user from campaign")}const c3=[{label:"Dungeon Master",value:"dm"},{label:"Player",value:"player"},{label:"Observer",value:"observer"}];function u3({campaignId:e,canManage:t,onMembersChanged:r}){const[i,l]=u.useState([]),[c,f]=u.useState(!0),[m,h]=u.useState(null),p=u.useCallback(async()=>{if(e){h(null),f(!0);try{const S=(await i3(e))?.data||[];l(S)}catch(v){h(v.message)}finally{f(!1)}}},[e]);u.useEffect(()=>{p()},[p]);const y=async(v,S)=>{h(null);try{const N=(await l3(v,{role:S}))?.data;N&&l(E=>{const C=E.map(A=>A.id===N.id?N:A);return typeof r=="function"&&r(C),C})}catch(w){h(w.message)}},g=async v=>{if(confirm("Remove this user from the campaign?")){h(null);try{await o3(v),l(S=>{const w=S.filter(N=>N.id!==v);return typeof r=="function"&&r(w),w})}catch(S){h(S.message)}}};return e?a.jsx(a.Fragment,{children:a.jsxs("div",{className:"panel",children:[a.jsx("div",{className:"panel-header",children:a.jsx("h3",{children:"Campaign Members"})}),m&&a.jsx("p",{className:"error",children:m}),c?a.jsx("p",{children:"Loading members"}):i.length===0?a.jsx("p",{children:"No users associated with this campaign yet."}):a.jsxs("table",{className:"compact-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"User"}),a.jsx("th",{children:"Role"}),a.jsx("th",{children:"Added"}),t?a.jsx("th",{children:"Actions"}):null]})}),a.jsx("tbody",{children:i.map(v=>a.jsxs("tr",{children:[a.jsx("td",{children:v.user?.username||v.user?.email||v.user_id}),a.jsx("td",{children:t?a.jsx("select",{value:v.role,onChange:S=>y(v.id,S.target.value),children:c3.map(S=>a.jsx("option",{value:S.value,children:S.label},S.value))}):v.role}),a.jsx("td",{children:v.createdAt?new Date(v.createdAt).toLocaleString():""}),t?a.jsx("td",{children:a.jsx("button",{type:"button",className:"btn danger",onClick:()=>g(v.id),children:"Remove"})}):null]},v.id))})]}),t?a.jsx("p",{className:"help-text",children:"Manage who can participate through the Players list. Update roles here to promote Dungeon Masters or set observers."}):null]})}):null}const d3="New Campaign",f3=[{name:"world_id",label:"World",type:"select",optionsSource:"worlds",optionsCriteria:{owned_only:!0},required:!0},{name:"name",label:"Name",type:"text",required:!0,placeholder:"Enter campaign name"},{name:"description",label:"Description",type:"textarea",placeholder:"Brief description of the campaign world"},{name:"status",label:"Status",type:"select",options:[{label:"Draft",value:"draft"},{label:"Active",value:"active"},{label:"Completed",value:"completed"},{label:"Archived",value:"archived"}],default:"draft"}],m3="Create Campaign",h3={title:d3,fields:f3,submitLabel:m3},p3="Edit Campaign",y3=[{name:"world_id",label:"World",type:"select",optionsSource:"worlds",required:!0,readonly:!0},{name:"name",label:"Name",type:"text",required:!0},{name:"description",label:"Description",type:"textarea"},{name:"status",label:"Status",type:"select",options:[{label:"Draft",value:"draft"},{label:"Active",value:"active"},{label:"Completed",value:"completed"},{label:"Archived",value:"archived"}]},{name:"player_ids",label:"Players",type:"multiselect",optionsSource:"players",optionLabelKey:"username",optionValueKey:"id",helpText:"Players selected here can create characters in this campaign.",noOptionsMessage:"No eligible players are currently available."}],g3="Save Changes",b3="Delete Campaign",P0={title:p3,fields:y3,submitLabel:g3,deleteLabel:b3},v3="Campaign Details",x3=[{title:"Overview",columns:2,fields:[{name:"name",label:"Name",type:"text"},{name:"statusLabel",label:"Status",type:"text"},{name:"worldName",label:"World",type:"text"},{name:"ownerName",label:"Owner",type:"text"}]},{title:"Description",columns:1,fields:[{name:"description",label:"Description",type:"textarea"}]},{title:"Metadata",columns:2,fields:[{name:"createdAt",label:"Created",type:"text"},{name:"updatedAt",label:"Updated",type:"text"}]}],S3={title:v3,sections:x3};function Uu({scope:e="all"}){const t=$n(),{id:r}=Ss(),{user:i,token:l,sessionReady:c}=En(),[f,m]=u.useState([]),[h,p]=u.useState(!1),[y,g]=u.useState("list"),[v,S]=u.useState(null),[w,N]=u.useState(null),[E,C]=u.useState("details"),A=u.useMemo(()=>`/campaigns/${e}`,[e]),O=u.useCallback(Q=>{if(!Q)return Q;const se=Array.isArray(Q.members)?Q.members.filter(ne=>ne.role==="player"):[];return{...Q,ownerName:Q.owner?.username||"",worldName:Q.world?.name||"",player_ids:se.map(ne=>ne.user_id)}},[]),_=u.useCallback(async()=>{if(l){p(!0),N(null);try{const Q=await jc(),ne=(Q?.data||Q||[]).map(we=>O(we));m(ne)}catch(Q){N(Q.message)}finally{p(!1)}}},[l,O]);u.useEffect(()=>{c&&l&&_()},[c,l,_]),u.useEffect(()=>{g("list"),S(null),C("details")},[e]),u.useEffect(()=>{if(!r){y!=="new"&&g("list"),S(null);return}const Q=f.find(ne=>String(ne.id)===r);if(!Q){h||t(A,{replace:!0});return}const se=!!i&&(i.role==="system_admin"||Q.created_by===i.id);S(Q),g(se?"edit":"view")},[r,f,t,A,h,y,i]),u.useEffect(()=>{C("details")},[v?.id]);const R=u.useMemo(()=>[{key:"name",label:"Name"},{key:"worldName",label:"World"},{key:"ownerName",label:"Owner"},{key:"status",label:"Status"},{key:"description",label:"Description"},{key:"createdAt",label:"Created"}],[]),D=Q=>!Q||!i?!1:i.role==="system_admin"||Q.created_by===i.id,j=u.useMemo(()=>{if(i?.role!=="system_admin")return P0;const Q=JSON.parse(JSON.stringify(P0)),se={name:"created_by",label:"Owner",type:"select",optionsSource:"users",optionLabelKey:"username",optionValueKey:"id"};if(Array.isArray(Q.fields)){const ne=Q.fields.findIndex(we=>we?.name==="created_by");if(ne>=0)Q.fields[ne]={...Q.fields[ne],...se};else{const we=Math.min(2,Q.fields.length);Q.fields.splice(we,0,se)}}return Q},[i]),z=()=>{t(A),g("new"),S(null)},P=()=>{g("list"),S(null),t(A)},X=async Q=>{try{return(await LM(Q)).success?(await _(),t(A),g("list"),S(null),!0):!1}catch(se){return alert(`Failed to create campaign: ${se.message}`),!1}},H=async(Q,se={})=>{const{stayOnPage:ne=!1}=se;if(!D(v))return alert("You do not have permission to update this campaign."),!1;const we={...Q};Object.prototype.hasOwnProperty.call(Q,"player_ids")&&(Array.isArray(Q.player_ids)?we.player_ids=Q.player_ids.filter(Ie=>Ie!=null&&Ie!==""):typeof Q.player_ids=="string"&&Q.player_ids!==""?we.player_ids=[Q.player_ids]:we.player_ids=[]);try{const Ie=await OM(v.id,we);if(Ie.success){const Me=O(Ie.data);return m(Ae=>Ae.map(it=>it.id===Me.id?Me:it)),S(Ae=>!Ae||Ae.id!==Me.id?Ae:Me),ne?{message:"Campaign updated successfully."}:(g("list"),S(null),t(A),!0)}return!1}catch(Ie){return alert(`Failed to update campaign: ${Ie.message}`),!1}},G=u.useCallback((Q,se)=>{const ne=we=>{if(!Array.isArray(we))return{members:[],playerIds:[]};const Ie=we.filter(Me=>Me.role==="player");return{members:we,playerIds:Ie.map(Me=>Me.user_id)}};m(we=>we.map(Ie=>{if(Ie.id!==Q)return Ie;const{members:Me,playerIds:Ae}=ne(se);return{...Ie,members:Me,player_ids:Ae}})),S(we=>{if(!we||we.id!==Q)return we;const{members:Ie,playerIds:Me}=ne(se);return{...we,members:Ie,player_ids:Me}})},[]),V=async Q=>{const se=Q||v,ne=se?.id;if(!ne)return!1;if(!D(se))return alert("You do not have permission to delete this campaign."),!1;if(!confirm("Delete this campaign?"))return!1;try{return(await zM(ne)).success?(await _(),g("list"),S(null),t(A),!0):!1}catch(we){return alert(we.message),!1}},k=()=>{g("list"),S(null),t(A)},F=u.useMemo(()=>{if(!v)return null;const Q=v.created_by??v.owner?.id??"",se=Array.isArray(v.members)?v.members.filter(ne=>ne.role==="player"):[];return{...v,created_by:Q,player_ids:se.map(ne=>ne.user_id)}},[v]),I=u.useMemo(()=>{const Q=JSON.parse(JSON.stringify(j));return Array.isArray(Q.fields)?Q.fields=Q.fields.filter(se=>se?.name!=="player_ids"):Array.isArray(Q.sections)&&(Q.sections=Q.sections.map(se=>({...se,fields:(se.fields||[]).filter(ne=>ne?.name!=="player_ids")})).filter(se=>se.fields&&se.fields.length>0)),Q.title="Campaign Details",Q},[j]),L=u.useMemo(()=>{if(!v||!Array.isArray(v.members))return[];const Q=new Set;return v.members.map(se=>{const ne=se?.user_id??se?.user?.id;if(!ne)return null;const we=String(ne);if(Q.has(we))return null;Q.add(we);const Ie=se?.user?.username||se?.user?.displayName||se?.user?.display_name||se?.user?.name||se?.user?.email||se?.display_name||we;return{value:we,label:Ie}}).filter(Boolean)},[v]),$=u.useMemo(()=>{const Q={title:"Campaign Membership",fields:[]},se=we=>{if(!we)return null;if(Array.isArray(we.fields)){for(const Ie of we.fields)if(Ie?.name==="player_ids")return Ie}return null};let ne=null;if(Array.isArray(j.fields))ne=se(j);else if(Array.isArray(j.sections)){for(const we of j.sections)if(ne=se(we),ne)break}if(ne){const we=JSON.parse(JSON.stringify(ne));L.length>0&&(we.selectedOptions=L),Q.fields=[we]}return Q},[j,L]),T=u.useMemo(()=>F?{player_ids:F.player_ids??[]}:null,[F]),U=u.useMemo(()=>{if(!v)return null;const Q=v.status||"",se=Q?Q.charAt(0).toUpperCase()+Q.slice(1):"";return{...v,statusLabel:se,createdAt:Vr(v.createdAt),updatedAt:Vr(v.updatedAt)}},[v]),M=u.useMemo(()=>e==="my"?i?.id?f.filter(Q=>Q.created_by===i.id):[]:f,[f,e,i]),q=e==="my"?"My Campaigns":"All Campaigns",Y=e==="my"?"Back to my campaigns":"Back to all campaigns",J=u.useMemo(()=>!v||!Array.isArray(v.members)||!i?.id?!1:v.members.some(Q=>Q?.user_id===i.id&&Q?.role==="dm"),[v,i]),ie=v?`/campaigns/${v.id}/access/bulk`:"",fe=e!=="my"&&!!(v&&J)&&ie?a.jsxs("div",{className:"campaign-access-cta",children:[a.jsxs("div",{children:[a.jsx("p",{className:"campaign-access-eyebrow",children:"Campaign Tools"}),a.jsxs("h3",{children:["Manage entity access for ",v.name]}),a.jsx("p",{className:"campaign-access-copy",children:"The Campaign Access Editor keeps changes scoped to this campaigns members."})]}),a.jsx("div",{className:"campaign-access-actions",children:a.jsx(Qt,{to:ie,className:"btn outline",children:"Open Access Editor"})})]}):null;return c?l?h?a.jsx("p",{children:"Loading campaigns..."}):w?a.jsxs("p",{className:"error",children:["Error: ",w]}):y==="new"?a.jsx(gs,{schema:h3,initialData:{},onSubmit:X,onCancel:P,showUpdateAction:!1}):y==="edit"&&v&&F?a.jsxs("div",{className:"campaign-editor",children:[fe,a.jsxs("div",{className:"campaign-tabs",role:"tablist","aria-label":"Campaign editor tabs",children:[a.jsx("button",{type:"button",role:"tab","aria-selected":E==="details",className:`campaign-tab${E==="details"?" is-active":""}`,onClick:()=>C("details"),children:"Details"}),a.jsx("button",{type:"button",role:"tab","aria-selected":E==="membership",className:`campaign-tab${E==="membership"?" is-active":""}`,onClick:()=>C("membership"),children:"Membership"})]}),a.jsx("div",{className:"campaign-tab-panel",role:"tabpanel",children:E==="details"?a.jsx(gs,{schema:I,initialData:F,onSubmit:H,onDelete:V,onCancel:P}):a.jsxs("div",{className:"campaign-membership",children:[a.jsx(gs,{schema:$,initialData:T,onSubmit:H,onCancel:P}),a.jsx(u3,{campaignId:v.id,canManage:D(v),onMembersChanged:Q=>G(v.id,Q)})]})})]}):y==="view"&&v?a.jsxs("div",{className:"campaign-view-wrapper",children:[fe,a.jsx(sN,{schema:S3,data:U||{},onClose:k,closeLabel:Y,infoMessage:"You can view this campaign but only the owner or a system admin can make changes."})]}):a.jsx(uf,{data:M,columns:R,title:q,extraActions:a.jsx("button",{type:"button",className:"btn submit",onClick:z,children:"+ New"}),onRowClick:Q=>{S(Q),g(D(Q)?"edit":"view"),t(`${A}/${Q.id}`)}}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const w3="New Character",N3=[{title:"Associations",columns:2,fields:[{key:"campaign_id",label:"Campaign",type:"select",optionsSource:"campaigns",required:!0,noOptionsMessage:"You do not have any campaigns available for character creation.",helpText:"Only campaigns you own or have been added to as a player are listed here."},{key:"user_id",label:"Player",type:"select",optionsSource:"users",optionLabelKey:"username",required:!0}]},{title:"Character Details",columns:2,fields:[{key:"name",label:"Name",type:"text",placeholder:"Character name",required:!0},{key:"level",label:"Level",type:"text",inputType:"number",placeholder:"1"},{key:"class",label:"Class",type:"text",placeholder:"Fighter, Wizard..."},{key:"race",label:"Race",type:"text",placeholder:"Elf, Human..."},{key:"alignment",label:"Alignment",type:"text",placeholder:"Neutral Good"},{key:"is_active",label:"Active Character",type:"checkbox"}]},{title:"Notes",columns:1,fields:[{key:"notes",label:"Notes",type:"textarea",rows:6,placeholder:"Backstory, hooks, etc."}]}],E3={title:w3,sections:N3},j3="Edit Character",_3=[{title:"Associations",columns:2,fields:[{key:"campaign_id",label:"Campaign",type:"select",optionsSource:"campaigns",required:!0},{key:"user_id",label:"Player",type:"select",optionsSource:"users",optionLabelKey:"username",required:!0}]},{title:"Character Details",columns:2,fields:[{key:"name",label:"Name",type:"text",required:!0},{key:"level",label:"Level",type:"text",inputType:"number"},{key:"class",label:"Class",type:"text"},{key:"race",label:"Race",type:"text"},{key:"alignment",label:"Alignment",type:"text"},{key:"is_active",label:"Active Character",type:"checkbox"}]},{title:"Notes",columns:1,fields:[{key:"notes",label:"Notes",type:"textarea",rows:6}]}],C3={title:j3,sections:_3},Io=(e={})=>({id:e.id,name:e.name||"",race:e.race||"",class:e.class||"",level:e.level??1,alignment:e.alignment||"",notes:e.notes||"",is_active:e.is_active??!0,campaign_id:e.campaign_id||"",user_id:e.user_id||""}),V0=(e={})=>{const t=Number(e.level);return{name:e.name,race:e.race||null,class:e.class||null,level:Number.isNaN(t)?1:t,alignment:e.alignment||null,notes:e.notes||null,is_active:!!e.is_active,campaign_id:e.campaign_id||null,user_id:e.user_id||null}};function Lr({scope:e="my"}){const t=$n(),{id:r}=Ss(),{token:i,sessionReady:l,user:c}=En(),{selectedCampaign:f,selectedCampaignId:m,setSelectedCampaignId:h}=Un(),[p,y]=u.useState([]),[g,v]=u.useState(!1),[S,w]=u.useState(null),[N,E]=u.useState("list"),[C,A]=u.useState(null),[O,_]=u.useState(null),[R,D]=u.useState(""),j=u.useMemo(()=>`/characters/${e}`,[e]),z=u.useMemo(()=>!f||!Array.isArray(f.members)||!c?.id?!1:f.members.some(M=>M?.user_id===c.id&&M?.role==="player"),[f,c]),P=u.useMemo(()=>!f||!Array.isArray(f.members)||!c?.id?!1:f.members.some(M=>M?.user_id===c.id&&M?.role==="dm"),[f,c]),X=u.useMemo(()=>{switch(e){case"my":return"My Characters";case"others":return f?.name?`All Characters  ${f.name}`:"All Characters";case"all":return"All Characters";case"companions":return f?.name?`My Companions  ${f.name}`:"My Companions";default:return"Characters"}},[e,f]),H=e==="my"||c?.role==="system_admin";u.useEffect(()=>{e==="all"&&c&&c.role!=="system_admin"&&t("/characters/my",{replace:!0})},[e,c,t]),u.useEffect(()=>{E("list"),A(null),_(null),D("")},[e]),u.useEffect(()=>{if(!r){N!=="new"&&E("list"),A(null),_(null);return}const M=p.find(Y=>String(Y.id)===r);if(!M){g||t(j,{replace:!0});return}if(!(M.isOwned||c?.role==="system_admin")){t(j,{replace:!0});return}A(M.formValues||Io(M)),_(M.id),E("edit")},[r,p,c,t,j,g,N]);const G=u.useCallback(async()=>{if(i&&!(e==="all"&&c&&c.role!=="system_admin")){if(w(null),e==="companions"){if(!m){y([]),D("Select a campaign to view your companions. Use Go to Campaign from My Characters to set one."),v(!1);return}if(!z){y([]),D("You must be a player in the selected campaign to view companions."),v(!1);return}}if(e==="others"){if(!m){y([]),D("Select a campaign to view all characters. Use Go to Campaign from My Characters to set one."),v(!1);return}if(!P){y([]),D("You must be a DM in the selected campaign to view all characters."),v(!1);return}}D(""),v(!0);try{const M={scope:e};(e==="companions"||e==="others"||e==="my"&&m)&&(M.campaign_id=m);const q=await Is(M),Y=(q?.data||q||[]).map(J=>({...J,playerName:J.player?.username||"",campaignName:J.campaign?.name||"",status:J.is_active?"Active":"Inactive",formValues:Io(J),isOwned:J.user_id===c?.id}));y(Y)}catch(M){console.error(" Failed to load characters:",M),w(M.message)}finally{v(!1)}}},[i,e,c,m,z,P]);u.useEffect(()=>{l&&i&&G()},[l,i,G]);const V=e==="my"&&!m,k=u.useMemo(()=>[{key:"name",label:"Name"},{key:"class",label:"Class"},{key:"level",label:"Level"},{key:"race",label:"Race"},{key:"alignment",label:"Alignment"},{key:"playerName",label:"Player"},{key:"campaignName",label:"Campaign"},{key:"status",label:"Status"}],[]),F=u.useMemo(()=>V?[...k,{key:"campaignAction",label:"Actions",render:M=>M.campaign_id?a.jsx("button",{type:"button",className:"btn secondary compact",onClick:q=>{q.stopPropagation(),h(String(M.campaign_id))},children:"Go to Campaign"}):"No campaign"}]:k,[k,V,h]),I=()=>{H&&(t(j),E("new"),A(null),_(null))},L=()=>{E("list"),A(null),_(null),t(j)},$=async M=>{try{return await nR(V0(M)),E("list"),A(null),t(j),await G(),!0}catch(q){return alert(`Error creating character: ${q.message}`),!1}},T=async(M,q={})=>{const{stayOnPage:Y=!1}=q;if(!O)return!1;try{const J=await aR(O,V0(M)),ie=J?.data||J||{id:O};if(await G(),Y){const Z=Io(ie&&typeof ie=="object"?ie:{...M,id:O});return A(Z),{message:"Character updated successfully."}}return E("list"),A(null),_(null),t(j),!0}catch(J){return alert(`Error updating character: ${J.message}`),!1}},U=async()=>{if(!O||!confirm("Delete this character?"))return!1;try{return await sR(O),E("list"),A(null),_(null),t(j),await G(),!0}catch(M){return alert(`Error deleting character: ${M.message}`),!1}};return l?i?g?a.jsx("p",{children:"Loading characters..."}):S?a.jsx("p",{className:"error",children:S}):N==="new"?a.jsx(gs,{schema:E3,initialData:{level:1,is_active:!0,user_id:c?.role==="system_admin"?"":c?.id||""},onSubmit:$,onCancel:L,showUpdateAction:!1}):N==="edit"?a.jsx(gs,{schema:C3,initialData:C||{},onSubmit:T,onCancel:L,onDelete:U}):N==="list"&&R?a.jsx("div",{className:"empty-state",children:a.jsx("p",{children:R})}):a.jsx(uf,{data:p,columns:F,title:X,extraActions:H?a.jsx("button",{type:"button",className:"btn submit",onClick:I,children:"+ New"}):null,onRowClick:M=>{(M.isOwned||c?.role==="system_admin")&&(t(`${j}/${M.id}`),A(M.formValues||Io(M)),_(M.id),E("edit"))}}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}function mf(){const e=Qr();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function hf(e,t="request"){if(e.status===401)throw new Error("Unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${r}`)}return e.json()}async function Zy(){const e=await fetch(`${Cn}/users`,{headers:mf()});return hf(e,"fetch users")}async function A3(e){const t=await fetch(`${Cn}/users`,{method:"POST",headers:mf(),body:JSON.stringify(e)});return hf(t,"create user")}async function T3(e,t){const r=await fetch(`${Cn}/users/${e}`,{method:"PUT",headers:mf(),body:JSON.stringify(t)});return hf(r,"update user")}async function M3(e){const t=await fetch(`${Cn}/users/${e}`,{method:"DELETE",headers:mf()});return hf(t,"delete user")}const R3="Create New User",k3=[{title:"Account Details",columns:2,fields:[{key:"username",label:"Username",type:"text",placeholder:"Enter username"},{key:"email",label:"Email",type:"text",inputType:"email",placeholder:"user@example.com"},{key:"password",label:"Password",type:"text",inputType:"password",placeholder:"Choose a secure password"},{key:"role",label:"Role",type:"select",options:[{value:"user",label:"User"},{value:"system_admin",label:"System Admin"}],default:"user"}]}],D3={title:R3,sections:k3},I3="Edit User",L3=[{title:"Account Details",columns:2,fields:[{key:"username",label:"Username",type:"text"},{key:"email",label:"Email",type:"text",inputType:"email"},{key:"role",label:"Role",type:"select",options:[{value:"user",label:"User"},{value:"system_admin",label:"System Admin"}]},{key:"password",label:"New Password",type:"text",inputType:"password",placeholder:"Leave blank to keep current password"}]}],O3={title:I3,sections:L3};function z3(){const{user:e,token:t,sessionReady:r}=En(),[i,l]=u.useState([]),[c,f]=u.useState(!1),[m,h]=u.useState(null),[p,y]=u.useState("list"),[g,v]=u.useState(null),S=u.useCallback(async()=>{if(!(!t||e?.role!=="system_admin")){f(!0),h(null);try{const _=await Zy();l(_?.data||_||[])}catch(_){console.error(" Failed to load users:",_),h(_.message)}finally{f(!1)}}},[t,e?.role]);u.useEffect(()=>{r&&t&&e?.role==="system_admin"&&S()},[r,t,e?.role,S]);const w=[{key:"username",label:"Username"},{key:"email",label:"Email"},{key:"role",label:"Role"},{key:"createdAt",label:"Created"}],N=()=>{v(null),y("new")},E=()=>{y("list"),v(null)},C=async _=>{try{const R={username:_.username,email:_.email,password:_.password,role:_.role||"user"};return await A3(R),y("list"),v(null),await S(),!0}catch(R){return alert(`Error creating user: ${R.message}`),!1}},A=async(_,R={})=>{const{stayOnPage:D=!1}=R;if(!g?.id)return!1;try{const j={username:_.username,email:_.email,role:_.role};_.password&&(j.password=_.password);const P=(await T3(g.id,j))?.data||{...g,...j};return await S(),D?(v(P),{message:"User updated successfully."}):(y("list"),v(null),!0)}catch(j){return alert(`Error updating user: ${j.message}`),!1}},O=async()=>{if(!g?.id||!confirm(`Delete user "${g.username}"?`))return!1;try{return await M3(g.id),y("list"),v(null),await S(),!0}catch(_){return alert(`Error deleting user: ${_.message}`),!1}};return r?t?!e||e.role!=="system_admin"?a.jsx("p",{className:"error",children:"Access denied. Admins only."}):c?a.jsx("p",{children:"Loading users..."}):m?a.jsxs("p",{className:"error",children:["Error: ",m]}):p==="new"?a.jsx(gs,{schema:D3,initialData:{},onSubmit:C,onCancel:E,showUpdateAction:!1}):p==="edit"?a.jsx(gs,{schema:O3,initialData:g||{},onSubmit:A,onCancel:E,onDelete:O}):a.jsx(uf,{data:i,columns:w,title:"Users",extraActions:a.jsx("button",{type:"button",className:"btn submit",onClick:N,children:"+ New"}),onRowClick:_=>{v(_),y("edit")}}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}function $3(){const{login:e}=En(),t=$n(),[r,i]=u.useState(""),[l,c]=u.useState(""),[f,m]=u.useState(""),[h,p]=u.useState(!1),y=async g=>{g.preventDefault(),m(""),p(!0);try{await e(r,l)?t("/"):m("Invalid username or password")}catch{m("Login failed. Please try again.")}finally{p(!1)}};return a.jsx("div",{className:"login-page",children:a.jsxs("div",{className:"login-card",children:[a.jsx("h1",{className:"login-title",children:"GameDB"}),a.jsx("p",{className:"login-subtitle",children:"Sign in to your account"}),a.jsxs("form",{onSubmit:y,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Username"}),a.jsx("input",{type:"text",value:r,onChange:g=>i(g.target.value),placeholder:"Enter username",required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Password"}),a.jsx("input",{type:"password",value:l,onChange:g=>c(g.target.value),placeholder:"Enter password",required:!0})]}),f&&a.jsx("p",{className:"error-msg",children:f}),a.jsx("button",{type:"submit",disabled:h,children:h?"Signing in...":"Sign In"})]})]})})}const rN=e=>Rt.get(`/entity-types/${e}/fields`),F3=(e,t)=>Rt.post(`/entity-types/${e}/fields`,t),B3=(e,t)=>Rt.patch(`/entity-type-fields/${e}`,t),U3=e=>Rt.delete(`/entity-type-fields/${e}`),q3=[{value:"global",label:"Global"},{value:"selective",label:"Selective"},{value:"hidden",label:"Hidden"}],H3=[{value:"global",label:"Global"},{value:"selective",label:"Selective"},{value:"hidden",label:"Hidden"},{value:"owner_only",label:"Owner only"}],bi=(e,t)=>`${e}-${t}`;function iN({canEdit:e,accessSettings:t,accessOptions:r,accessOptionsLoading:i,accessSaving:l,onSettingChange:c,idPrefix:f="entity-access"}){const m=!e||l,h=bi(f,"read-mode"),p=bi(f,"read-campaigns"),y=bi(f,"read-users"),g=bi(f,"read-characters"),v=bi(f,"write-mode"),S=bi(f,"write-campaigns"),w=bi(f,"write-users");return a.jsxs("div",{className:"entity-access-columns",children:[a.jsxs("div",{className:"entity-access-column",children:[a.jsx("h3",{children:"Read access"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:h,children:"Visibility"}),a.jsx("select",{id:h,value:t.readMode,onChange:N=>c("readMode",N.target.value),disabled:m,children:q3.map(N=>a.jsx("option",{value:N.value,children:N.label},N.value))})]}),t.readMode==="selective"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:p,children:"Campaigns"}),a.jsx(Rs,{inputId:p,selected:t.readCampaigns,options:r.campaigns||[],onChange:N=>c("readCampaigns",N),placeholder:"Select campaigns...",noOptionsMessage:i?"Loading campaigns...":"No campaigns available for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Members of selected campaigns can view this entity."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:y,children:"Users"}),a.jsx(Rs,{inputId:y,selected:t.readUsers,options:r.users||[],onChange:N=>c("readUsers",N),placeholder:"Select users...",noOptionsMessage:i?"Loading users...":"No eligible users found for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Choose players who have characters in this world."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:g,children:"Characters"}),a.jsx(Rs,{inputId:g,selected:t.readCharacters,options:r.characters||[],onChange:N=>c("readCharacters",N),placeholder:"Select characters...",noOptionsMessage:i?"Loading characters...":"No characters available for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Grant visibility to specific characters regardless of campaign."})]})]})]}),a.jsxs("div",{className:"entity-access-column",children:[a.jsx("h3",{children:"Write access"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:v,children:"Write"}),a.jsx("select",{id:v,value:t.writeMode,onChange:N=>c("writeMode",N.target.value),disabled:m,children:H3.map(N=>a.jsx("option",{value:N.value,children:N.label},N.value))})]}),t.writeMode==="selective"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:S,children:"Campaigns"}),a.jsx(Rs,{inputId:S,selected:t.writeCampaigns,options:r.campaigns||[],onChange:N=>c("writeCampaigns",N),placeholder:"Select campaigns...",noOptionsMessage:i?"Loading campaigns...":"No campaigns available for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Dungeon Masters of these campaigns can edit this entity."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:w,children:"Users"}),a.jsx(Rs,{inputId:w,selected:t.writeUsers,options:r.users||[],onChange:N=>c("writeUsers",N),placeholder:"Select users...",noOptionsMessage:i?"Loading users...":"No eligible users found for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Grant edit access to specific players with characters here."})]})]})]})]})}const qu=e=>!e||typeof e!="string"?"":e.trim(),Y0=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[];async function lN(e){if(!e)return{campaigns:[],users:[],characters:[]};const[t,r]=await Promise.all([jc({world_id:e}),Is({world_id:e})]),l=Y0(t).map(h=>({value:String(h.id),label:h.name||"Untitled campaign"})),c=Y0(r),f=new Map,m=new Map;return c.forEach(h=>{const p=h?.user_id||h?.player?.id;if(!p)return;const y=String(p);if(f.has(y))return;const g=h?.player||{},v=qu(g.username),S=qu(g.email);let w=v||S||`User ${y.slice(0,8)}`;v&&S&&v!==S&&(w=`${v} (${S})`),f.set(y,{value:y,label:w});const N=h?.id||h?.character_id;if(!N)return;const E=qu(h.name)||"Unnamed character",C=qu(h?.campaign?.name||h?.campaign_name||""),A=C?`${E}  ${C}`:E;m.set(String(N),{value:String(N),label:A})}),{campaigns:l,users:Array.from(f.values()),characters:Array.from(m.values())}}const Hh=(e,t,r)=>Number.isNaN(e)?t:Math.min(Math.max(e,t),r),P3=220,V3=3;function oN({src:e,size:t=P3,onCropChange:r,className:i="",zoomLabel:l="Zoom"}){const[c,f]=u.useState({width:0,height:0}),[m,h]=u.useState(1),[p,y]=u.useState({x:0,y:0}),[g,v]=u.useState(!1),S=u.useRef({x:0,y:0}),w=u.useRef(null),N=u.useRef(null);u.useEffect(()=>{if(!e){f({width:0,height:0});return}let H=!1;const G=new Image;return G.onload=()=>{H||f({width:G.naturalWidth,height:G.naturalHeight})},G.onerror=()=>{H||f({width:0,height:0})},G.src=e,()=>{H=!0}},[e]);const E=u.useMemo(()=>{if(!c.width||!c.height)return 1;const H=t/c.width,G=t/c.height;return Math.max(H,G)},[c,t]);u.useEffect(()=>{if(!c.width||!c.height)return;h(E);const H=c.width*E,G=c.height*E;y({x:(t-H)/2,y:(t-G)/2})},[c,E,t]);const C=u.useCallback((H,G=m)=>{if(!c.width||!c.height)return H;const V=c.width*G,k=c.height*G,F=Math.min(0,t-V),I=Math.max(0,t-V),L=Math.min(0,t-k),$=Math.max(0,t-k);return{x:Hh(H.x,F,I),y:Hh(H.y,L,$)}},[c,m,t]),A=H=>{if(!e)return;H.preventDefault(),N.current?.setPointerCapture?.(H.pointerId),w.current=H.pointerId,S.current={x:H.clientX,y:H.clientY},v(!0)},O=H=>{if(!g)return;H.preventDefault();const G=H.clientX-S.current.x,V=H.clientY-S.current.y;S.current={x:H.clientX,y:H.clientY},y(k=>C({x:k.x+G,y:k.y+V}))},_=u.useCallback(()=>{const H=N.current;w.current!==null&&(H?.releasePointerCapture?.(w.current),w.current=null),v(!1)},[]),R=E*V3,D=Math.max(E/50,.01),j=R-E>.001,z=H=>{const G=Hh(Number(H.target.value),E,R);h(G),y(V=>C(V,G))};u.useEffect(()=>{typeof r=="function"&&(!c.width||!c.height||!e||r({offset:p,scale:m,containerSize:t,naturalWidth:c.width,naturalHeight:c.height}))},[p,m,t,c,r,e]),u.useEffect(()=>{const H=N.current;if(!H)return;const G=()=>_(),V=()=>_();return H.addEventListener("pointerup",G),H.addEventListener("pointerleave",V),H.addEventListener("pointercancel",V),()=>{H.removeEventListener("pointerup",G),H.removeEventListener("pointerleave",V),H.removeEventListener("pointercancel",V)}},[_]);const P=c.width*m,X=c.height*m;return a.jsxs("div",{className:`image-cropper ${i}`.trim(),children:[a.jsxs("div",{className:`image-cropper__frame${g?" is-dragging":""}`,ref:N,style:{width:t,height:t},onPointerDown:A,onPointerMove:O,role:"presentation",children:[e?a.jsx("img",{src:e,alt:"Selected artwork preview",draggable:!1,style:{width:P,height:X,transform:`translate(${p.x}px, ${p.y}px)`}}):a.jsx("div",{className:"image-cropper__empty",children:"Unable to preview image"}),a.jsx("div",{className:"image-cropper__outline","aria-hidden":"true"}),a.jsx("div",{className:"image-cropper__instructions","aria-hidden":"true",children:"Drag to reposition"})]}),j?a.jsxs("label",{className:"image-cropper__zoom",children:[a.jsx("span",{children:l}),a.jsx("input",{type:"range",min:E,max:R,step:D,value:m,onChange:z})]}):a.jsx("p",{className:"image-cropper__zoom image-cropper__zoom--disabled",children:"Zoom unavailable for this image"})]})}const cN=async(e,t,r={})=>{if(!e||!t)return e;const{offset:i,scale:l,containerSize:c,naturalWidth:f,naturalHeight:m}=t;if(!i||!l||!c||!f||!m||typeof createImageBitmap!="function")return e;try{const h=await createImageBitmap(e),p=f?h.width/f:1,y=m?h.height/m:1,g=(p+y)/2||1,v=l*g,S=c/v,w=c/v,N=(0-i.x)/l*g,E=(0-i.y)/l*g,C=Math.min(Math.max(S,1),h.width),A=Math.min(Math.max(w,1),h.height),O=h.width-C,_=h.height-A,R=Math.min(Math.max(N,0),Math.max(O,0)),D=Math.min(Math.max(E,0),Math.max(_,0)),j=document.createElement("canvas");j.width=Math.round(C),j.height=Math.round(A),j.getContext("2d").drawImage(h,R,D,C,A,0,0,j.width,j.height),h.close?.();const P=r.mimeType||e.type||"image/jpeg",X=r.quality||(P==="image/png"?void 0:.92),H=await new Promise((V,k)=>{j.toBlob(F=>{F?V(F):k(new Error("Unable to crop image"))},P,X)}),G=(()=>{if(!e.name)return"cropped-image";const V=P==="image/png"?".png":".jpg";return e.name.toLowerCase().endsWith(V)?e.name:`${e.name.includes(".")?e.name.slice(0,e.name.lastIndexOf(".")):e.name}${V}`})();return new File([H],G,{type:P})}catch(h){return console.warn(" Unable to crop image, using original selection",h),e}},Y3=[{value:"hidden",label:"Hidden"},{value:"partial",label:"Partial"},{value:"visible",label:"Visible"}],G3=new Set(["image/png","image/jpeg","image/jpg"]),X3=2*1024*1024,K3=new Set(["global","selective","hidden"]),W3=new Set(["global","selective","hidden","owner_only"]),Hu=()=>({campaigns:[],users:[],characters:[]}),Ph=(e="")=>{const t=String(e||"").trim();return t?{readMode:"selective",readCampaigns:[t],readUsers:[],readCharacters:[],writeMode:"selective",writeCampaigns:[t],writeUsers:[]}:{readMode:"global",readCampaigns:[],readUsers:[],readCharacters:[],writeMode:"global",writeCampaigns:[],writeUsers:[]}},Z3=e=>Number.isFinite(e)?e>=1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:e>=1024?`${(e/1024).toFixed(1)} KB`:`${e} bytes`:"",Q3=e=>{const t=e?.options?.choices;return!Array.isArray(t)||t.length===0?[]:t.map((r,i)=>{if(r==null)return null;if(typeof r=="object"){const c=r.value??r.id??r.key??r.slug??`choice-${i}`,f=r.label??r.name??r.title??r.display??c;return c==null?null:{value:c,label:String(f??c)}}const l=String(r);return{value:l,label:l}}).filter(Boolean)},J3=e=>{if(!e)return"";if(e instanceof Date)return e.toISOString().slice(0,10);if(typeof e=="string"){const r=e.trim();if(!r)return"";if(/^\d{4}-\d{2}-\d{2}/.test(r))return r.slice(0,10);const i=new Date(r);return Number.isNaN(i.getTime())?"":i.toISOString().slice(0,10)}const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toISOString().slice(0,10)},e4=(e,t)=>{if(e==null)return"";switch(t?.dataType||t?.data_type){case"boolean":{if(typeof e=="boolean")return e?"true":"false";if(typeof e=="number")return e!==0?"true":"false";if(typeof e=="string"){const i=e.trim().toLowerCase();if(i==="true"||i==="false")return i}return""}case"number":return e===""?"":String(e);case"date":return J3(e);case"reference":{if(typeof e=="object"&&e!==null){const i=e.id??e.value??e.entity_id??e.entityId??null;if(i!=null)return String(i)}return String(e)}default:return String(e)}},t4=(e,t)=>{const r=t?.dataType||t?.data_type;if(e!=null){if(typeof e=="string"){const i=e.trim();if(r!=="boolean"&&i==="")return"";e=i}switch(r){case"number":{if(e==="")return"";const i=Number(e);return Number.isNaN(i)?e:i}case"boolean":{if(typeof e=="boolean")return e;if(typeof e=="number")return e!==0;if(typeof e=="string"){const i=e.toLowerCase();if(i==="true")return!0;if(i==="false")return!1}return e}case"reference":return typeof e=="string"?e.trim():e;default:return e}}},G0="entity-form-advanced-open",n4=e=>{if(e==null)return"";if(typeof e=="object")try{return JSON.stringify(e)}catch{return""}return String(e)},a4=e=>{const t=e.trim();if(t.length===0)return"";if(t==="true")return!0;if(t==="false")return!1;const r=t[0],i=t[t.length-1];if(r==="{"&&i==="}"||r==="["&&i==="]")try{return JSON.parse(t)}catch{return e}return e};function uN({worldId:e,entityId:t,onCancel:r,onSaved:i,formId:l="entity-form",onStateChange:c,hideActions:f=!1,selectedEntityTypeId:m="",activeView:h="details",onViewChange:p,defaultCampaignId:y=""}){const g=!!t,v=u.useRef(0),S=u.useRef(null),w=u.useRef(null),N=u.useRef(null),E=u.useRef(String(y??"")),C=u.useCallback((le="",st="")=>(v.current+=1,{id:v.current,key:le,value:st}),[v]),[A,O]=u.useState([]),[_,R]=u.useState(!1),[D,j]=u.useState(!1),[z,P]=u.useState(!1),[X,H]=u.useState(!1),[G,V]=u.useState(""),[k,F]=u.useState({name:"",description:"",entityTypeId:m||"",visibility:"visible"}),[I,L]=u.useState(()=>(v.current=0,[C()])),[$,T]=u.useState([]),[U,M]=u.useState({}),[q,Y]=u.useState({}),[J,ie]=u.useState(()=>Ph(y)),[Z,fe]=u.useState(()=>Hu()),[Q,se]=u.useState(!1),[ne,we]=u.useState(""),Ie=u.useRef(!1),[Me,Ae]=u.useState(null),[it,$e]=u.useState(null),[nt,Le]=u.useState(null),[wt,Tt]=u.useState(""),[Ct,At]=u.useState(""),[Ue,Je]=u.useState(!1),[de,ue]=u.useState(!1),[ye,Ve]=u.useState(()=>{if(typeof window>"u")return!1;try{return window.sessionStorage?.getItem(G0)==="true"}catch(le){return console.warn(" Unable to read advanced options preference",le),!1}}),ee=u.useMemo(()=>I.some(le=>le.key.trim()!==""||le.value.trim()!==""),[I]),me=u.useCallback(le=>{if(le&&typeof URL<"u")try{URL.revokeObjectURL(le)}catch(st){console.warn("Unable to revoke preview URL",st)}},[]),he=u.useCallback(()=>{$e(null),Le(null),At(""),Tt(le=>(me(le),"")),w.current&&(w.current.value=""),N.current&&(N.current.value="")},[me]);u.useEffect(()=>()=>{me(wt)},[me,wt]);const Se=u.useCallback(le=>{const st=le.target.files?.[0];if(st){if(!G3.has(st.type)){At("Only PNG or JPG images are allowed."),le.target.value="";return}if(st.size>X3){At("Image must be smaller than 2 MB."),le.target.value="";return}At(""),$e(st),Le(null),Tt(ct=>(me(ct),URL.createObjectURL(st)))}},[me]),We=u.useCallback(()=>{!t||Ue||de||D||w.current?.click()},[t,de,Ue,D]),Xe=u.useCallback(le=>{if(!le){Ae(null);return}const st=le.imageData??le.image_data??null,ct=le.imageMimeType??le.image_mime_type??null;Ae(st&&ct?{imageData:st,imageMimeType:ct}:null)},[]),et=u.useCallback(async()=>{if(!t)return null;const le=await or(t),st=Va(le);return st&&Xe(st),st},[Xe,t]),Te=u.useCallback(async()=>{if(!(!t||!it)){Je(!0),At("");try{const le=nt?await cN(it,nt):it;await F1(t,le),await et(),he()}catch(le){At(le.message||"Failed to upload image")}finally{Je(!1)}}},[t,it,nt,et,he]),mt=u.useCallback(async()=>{if(!(!t||Ue||de)){At(""),ue(!0);try{await B1(t),await et(),he()}catch(le){At(le.message||"Failed to remove image")}finally{ue(!1)}}},[t,de,Ue,et,he]),Dt=u.useMemo(()=>{const le="PNG or JPG up to 2 MB.";return it?`${le} Selected: ${it.name} (${Z3(it.size)})`:le},[it]),Nt=it?a.jsxs("div",{className:"entity-image-actions",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:Te,disabled:Ue,children:Ue?"Uploading":"Save Image"}),a.jsx("button",{type:"button",className:"btn secondary",onClick:he,disabled:Ue,children:"Cancel"})]}):null,Ge=u.useCallback(le=>le.length>0?le:[C()],[C]),vt=u.useCallback(le=>{if(v.current=0,!le||typeof le!="object"||Array.isArray(le))return[C()];const st=Object.entries(le);return st.length===0?[C()]:st.map(([ct,yt])=>C(ct,n4(yt)))},[C]);u.useEffect(()=>{let le=!1;return(async()=>{if(le||V(""),!e){O([]),R(!1);return}R(!0);try{const ct=await Jr({worldId:e}),yt=Array.isArray(ct)?ct:Array.isArray(ct?.data)?ct.data:[];if(!le){const oe=yt.map(Ze=>{const Ke=Ze?.id||Ze?.entity_type_id||Ze?.entityTypeId||"";return Ke?{id:Ke,name:Ze?.name||Ze?.label||Ze?.title||"Untitled"}:null}).filter(Boolean);O(oe)}}catch(ct){le||(V(ct.message||"Failed to load entity types"),O([]))}finally{le||R(!1)}})(),()=>{le=!0}},[e]),u.useEffect(()=>{if(!e){F(le=>({...le,entityTypeId:""}));return}F(le=>!le.entityTypeId||A.some(ct=>ct.id===le.entityTypeId)?le:{...le,entityTypeId:""})},[e,A]),u.useEffect(()=>{let le=!1;const st=()=>{v.current=0,F({name:"",description:"",entityTypeId:m||"",visibility:"visible"}),L([C()]),T([]),M({}),V(""),p?.("details");const yt=Ph(E.current);ie(yt),Ie.current=!1,fe(Hu()),we(""),Ae(null),he()};if(!g)return st(),j(!1),S.current=null,()=>{};const ct=async()=>{j(!0),V(""),At("");try{const yt=await or(t),oe=Va(yt);if(!oe)throw new Error("Entity not found");if(!le){const Ze=vt(oe.metadata);F({name:oe.name||"",description:oe.description||"",entityTypeId:oe.entity_type_id||oe.entityType?.id||"",visibility:oe.visibility||"visible"}),L(Ge(Ze)),Xe(oe),he()}}catch(yt){le||V(yt.message||"Failed to load entity")}finally{le||j(!1)}};return S.current!==t&&(Ae(null),he(),S.current=t),ct(),()=>{le=!0}},[t,g,Ge,C,vt,m,p,Xe,he]);const Mt=le=>st=>{const{value:ct}=st.target;F(yt=>({...yt,[le]:ct}))},Bt=(le,st)=>ct=>{const{value:yt}=ct.target;L(oe=>oe.map(Ze=>Ze.id===le?{...Ze,[st]:yt}:Ze))},Jt=()=>{L(le=>[...le,C()])},Et=le=>{L(st=>Ge(st.filter(ct=>ct.id!==le)))},zt=le=>st=>{const{value:ct}=st.target;M(yt=>({...yt,[le]:ct}))},$t=u.useCallback((le,st)=>{we(""),ie(ct=>{const yt={...ct};if(le==="readMode"||le==="writeMode"){const oe=typeof st=="string"?st.trim().toLowerCase():"global";return le==="readMode"?(yt.readMode=K3.has(oe)?oe:"global",yt.readMode!=="selective"&&(yt.readCampaigns=[],yt.readUsers=[],yt.readCharacters=[])):(yt.writeMode=W3.has(oe)?oe:"global",yt.writeMode!=="selective"&&(yt.writeCampaigns=[],yt.writeUsers=[])),yt}return["readCampaigns","readUsers","readCharacters","writeCampaigns","writeUsers"].includes(le)?(yt[le]=Array.isArray(st)?st.map(oe=>String(oe).trim()).filter(Boolean):[],yt):(yt[le]=st,yt)})},[]);u.useEffect(()=>{Ie.current=!1,fe(Hu()),we("")},[e]),u.useEffect(()=>{if(g)return;const le=String(y??"");if(le===E.current)return;const st=Ph(le);E.current=le,ie(st)},[y,g]),u.useEffect(()=>{if(h!=="access"||!e||Ie.current)return;let le=!1;return se(!0),we(""),(async()=>{try{const ct=await lN(e);if(le)return;fe({campaigns:ct.campaigns??[],users:ct.users??[],characters:ct.characters??[]}),Ie.current=!0}catch(ct){if(le)return;fe(Hu()),we(ct.message||"Failed to load access options"),Ie.current=!1}finally{le||se(!1)}})(),()=>{le=!0}},[h,e]);const kt=u.useCallback(()=>{Ve(le=>{const st=!le;try{typeof window<"u"&&window.sessionStorage?.setItem(G0,st?"true":"false")}catch(ct){console.warn(" Unable to persist advanced options preference",ct)}return st})},[]),te=async le=>{if(le.preventDefault(),!e&&!g){V("A world must be selected before creating an entity.");return}const st=k.name.trim();if(!st){V("Name is required.");return}const ct=k.entityTypeId||m||"";if(!ct){V("Entity type is required.");return}const yt=g&&k.visibility||"visible";if(g&&!Y3.some(ft=>ft.value===yt)){V("Invalid visibility selected.");return}let oe={};if(g)I.forEach(({key:ft,value:Qe})=>{const pt=ft.trim();pt&&(oe[pt]=a4(Qe))});else if($.length>0){const ft={};for(const Qe of $){const pt=Qe.name,ke=U[pt],Pe=ke!=null&&(typeof ke!="string"||ke.trim()!=="");if(Qe.required&&!Pe){const ht=Qe.label||Qe.name;V(`${ht} is required.`);return}Pe&&(ft[pt]=t4(ke,Qe))}oe=ft}const Ze=k.description?k.description.trim():"",Ke={name:st,description:Ze,visibility:yt,metadata:oe,entity_type_id:ct};try{if(H(!0),V(""),g)await By(t,Ke);else{const ft={read_access:J.readMode,write_access:J.writeMode,read_campaign_ids:J.readMode==="selective"?J.readCampaigns:[],read_user_ids:J.readMode==="selective"?J.readUsers:[],read_character_ids:J.readMode==="selective"?J.readCharacters:[],write_campaign_ids:J.writeMode==="selective"?J.writeCampaigns:[],write_user_ids:J.writeMode==="selective"?J.writeUsers:[]};await Fy({...Ke,...ft,world_id:e})}i?.(g?"edit":"create")}catch(ft){V(ft.message||"Failed to save entity")}finally{H(!1)}},be=_||D||z,ve=!g,Be=ve&&h==="access";u.useEffect(()=>{if(p){if(!ve&&h!=="details"){p("details");return}Be&&!e&&p("details")}},[h,ve,Be,p,e]),u.useEffect(()=>{if(!c)return;c({mode:g?"edit":"create",saving:X,isBusy:be,submitLabel:X?"Saving...":g?"Save Changes":"Create Entity",submitDisabled:X||be,cancelDisabled:X,accessButtonVisible:ve,accessButtonDisabled:X||be||!e&&!Be})},[c,g,X,be,ve,Be,e]),u.useEffect(()=>{g||F(le=>({...le,entityTypeId:m||""}))},[g,m]);const ot=u.useMemo(()=>g?"":k.entityTypeId?k.entityTypeId:m||"",[g,m,k.entityTypeId]);u.useEffect(()=>{if(g){T([]),M({}),Y({});return}if(!ot){T([]),M({}),Y({});return}let le=!1;return(async()=>{P(!0);try{const ct=await rN(ot),yt=Array.isArray(ct)?ct:Array.isArray(ct?.data)?ct.data:[];if(le)return;const oe=yt.map(Ke=>{if(!Ke)return null;const ft=Ke.name||Ke.field_name;if(!ft)return null;const Qe=Ke.data_type||Ke.dataType||"text",pt=Ke.reference_type_id??Ke.referenceTypeId??Ke.referenceType?.id??null,ke=Ke.reference_type_name??Ke.referenceTypeName??Ke.referenceType?.name??"",Pe=Ke.reference_filter??Ke.referenceFilter??Ke.referenceFilterJson??{};return{id:Ke.id||ft,name:ft,label:Ke.label||Ke.name||ft,dataType:Qe,required:!!Ke.required,options:Ke.options||{},defaultValue:Ke.default_value??Ke.defaultValue??null,referenceTypeId:pt,referenceTypeName:ke,referenceFilter:Pe}}).filter(Boolean);T(oe),Y({});const Ze={};oe.forEach(Ke=>{const ft=Ke.defaultValue;ft!=null&&ft!==""?Ze[Ke.name]=e4(ft,Ke):Ze[Ke.name]=""}),M(Ze)}catch(ct){le||(V(ct.message||"Failed to load metadata fields"),T([]),M({}),Y({}))}finally{le||P(!1)}})(),()=>{le=!0}},[ot,g]);const xt=u.useMemo(()=>{const le=k.entityTypeId||m||"";return le&&A.find(st=>st.id===le)||null},[A,k.entityTypeId,m]),re=le=>{const st=`metadata-field-${le.id}`,ct=U[le.name]??"",yt=!!le.required;switch(le.dataType){case"boolean":return a.jsxs("select",{id:st,value:ct,onChange:zt(le.name),disabled:X||z,required:yt,children:[a.jsx("option",{value:"",children:"Select..."}),a.jsx("option",{value:"true",children:"True"}),a.jsx("option",{value:"false",children:"False"})]});case"enum":{const oe=Q3(le);return a.jsxs("select",{id:st,value:ct,onChange:zt(le.name),disabled:X||z,required:yt,children:[a.jsx("option",{value:"",children:"Select..."}),oe.map(Ze=>a.jsx("option",{value:Ze.value,children:Ze.label},Ze.value))]})}case"reference":{const oe=le.referenceTypeId??le.reference_type_id??null,Ze=oe?String(oe).trim():null,Ke=le.referenceTypeName||"entities",ft=typeof Ke=="string"&&Ke.trim()?Ke.trim():"entities",Qe=Array.isArray(le.options?.choices)?le.options.choices.map((_t,qt)=>{if(_t==null)return null;if(typeof _t=="object"){const dn=_t.value??_t.id??_t.key??_t.slug??`choice-${qt}`;if(dn==null)return null;const Zt=_t.label??_t.name??_t.title??_t.display??_t.displayName??dn;return{value:String(dn),label:String(Zt)}}const en=String(_t);return{value:en,label:en}}).filter(Boolean):[],pt=Qe.length>0,Pe=X||z||!pt&&!!!(e&&Ze),ht=q[le.name]||"",K=!ht&&ct&&Qe.find(_t=>String(_t.value)===String(ct))?.label||"",ae=ct&&(ht||K)?{id:ct,name:ht||K}:ct,Ne=ct?String(ct):"",qe=q[le.name]||K||ft,gt=_t=>{if(!_t){M(Zt=>({...Zt,[le.name]:""})),Y(Zt=>{if(!Zt[le.name])return Zt;const sa={...Zt};return delete sa[le.name],sa});return}const qt=_t.id??_t.value??_t.key??_t.slug??_t.uuid??null;if(qt==null){M(Zt=>({...Zt,[le.name]:""}));return}const en=String(qt),dn=_t.name??_t.label??_t.title??_t.display??_t.displayName??"";M(Zt=>({...Zt,[le.name]:en})),Y(Zt=>({...Zt,[le.name]:dn||en}))},St=_t=>{if(!_t){Y(Zt=>{if(!Zt[le.name])return Zt;const sa={...Zt};return delete sa[le.name],sa});return}const qt=_t.id??_t.value??_t.key??_t.slug??_t.uuid??null;if(qt==null)return;const en=String(qt),dn=_t.name??_t.label??_t.title??_t.display??_t.displayName??"";Y(Zt=>Zt[le.name]===(dn||en)?Zt:{...Zt,[le.name]:dn||en})};return a.jsxs("div",{className:"reference-field-control",children:[a.jsxs("div",{className:"reference-field-input-row",children:[a.jsx(oc,{worldId:e,value:ae,allowedTypeIds:Ze&&Ze.length>0?[Ze]:[],placeholder:`Search ${ft.toLowerCase()}...`,disabled:Pe,staticOptions:Qe,onChange:gt,onResolved:St,required:yt}),Ne&&a.jsx(Ls,{entityId:Ne,entityName:qe,className:"reference-field-info-btn"})]}),!Ze&&a.jsx("p",{className:"field-hint warning",children:"Reference type configuration is missing."}),Ze&&!e&&a.jsx("p",{className:"field-hint warning",children:"Select a world to search for entities."})]})}case"number":return a.jsx("input",{id:st,type:"number",value:ct,onChange:zt(le.name),disabled:X||z,required:yt});case"text":return a.jsx("textarea",{id:st,value:ct,onChange:zt(le.name),disabled:X||z,rows:4,required:yt});case"date":return a.jsx("input",{id:st,type:"date",value:ct,onChange:zt(le.name),disabled:X||z,required:yt});default:return a.jsx("input",{id:st,type:"text",value:ct,onChange:zt(le.name),disabled:X||z,required:yt})}},je=!g&&!!m,He=!g&&$.length>0,ut=()=>a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-type",children:"Type *"}),je?a.jsx("input",{id:"entity-type",type:"text",value:xt?.name||"",readOnly:!0,disabled:!0}):a.jsxs("select",{id:"entity-type",value:k.entityTypeId,onChange:Mt("entityTypeId"),disabled:X||_,required:!0,children:[a.jsx("option",{value:"",children:"Select type..."}),A.map(le=>a.jsx("option",{value:le.id,children:le.name},le.id))]})]}),dt=wt||$l(Me),Ee=k.name?`${k.name} artwork`:"Entity artwork",at=()=>a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-name",children:"Name *"}),a.jsx("input",{id:"entity-name",type:"text",value:k.name,onChange:Mt("name"),placeholder:"e.g. Waterdeep",disabled:X,required:!0,"data-autofocus":!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-description",children:"Description"}),a.jsx("textarea",{id:"entity-description",value:k.description,onChange:Mt("description"),placeholder:"Optional summary of the entity",rows:4,disabled:X})]})]});return a.jsxs("form",{id:l,className:"entity-form",onSubmit:te,children:[be?a.jsx("div",{className:"form-loading",children:"Loading..."}):a.jsx(a.Fragment,{children:Be?a.jsxs("section",{className:"entity-card entity-access-card drawer-access-card",children:[a.jsx("h3",{className:"entity-card-title",children:"Manage access"}),a.jsx("p",{className:"entity-access-note help-text",children:"Configure who can view and edit this entity. Users with write access will automatically receive read access."}),ne&&a.jsx("div",{className:"alert error",role:"alert",children:ne}),e?a.jsx(iN,{canEdit:!X,accessSettings:J,accessOptions:Z,accessOptionsLoading:Q,accessSaving:X,onSettingChange:$t,idPrefix:"entity-create-access"}):a.jsx("p",{className:"entity-empty-state",children:"Assign this entity to a world to configure access settings."})]}):a.jsxs(a.Fragment,{children:[g&&Me?a.jsxs("div",{className:"entity-form-image-wrapper",children:[a.jsxs("div",{className:"entity-form-image-panel","aria-live":"polite",children:[a.jsx("div",{className:`entity-image-preview ${dt?"has-image":""}`.trim(),children:dt?a.jsx("img",{src:dt,alt:Ee,loading:"lazy"}):a.jsx("div",{className:"entity-image-placeholder",children:a.jsx("p",{children:"No image"})})}),a.jsxs("div",{className:"entity-form-image-panel-actions",children:[a.jsx("button",{type:"button",className:"btn secondary",onClick:We,disabled:!t||Ue||de||D,children:Ue?"Uploading":"Replace Image"}),a.jsx("button",{type:"button",className:"btn secondary",onClick:mt,disabled:!t||de||Ue,children:de?"Removing":"Remove Image"})]}),Nt,a.jsx("input",{type:"file",ref:w,accept:"image/png,image/jpeg",onChange:Se,hidden:!0,disabled:!t||Ue||de}),a.jsx("p",{className:"entity-image-helper",children:Dt}),Ct?a.jsx("p",{className:"entity-image-status entity-image-status--error",children:Ct}):null,!Ct&&Ue?a.jsx("p",{className:"entity-image-status",children:"Uploading image"}):null,!Ct&&de?a.jsx("p",{className:"entity-image-status",children:"Removing image"}):null]}),a.jsx("div",{className:"entity-form-image-fields",children:at()})]}):at(),!g&&ut(),g&&!Me?a.jsxs("div",{className:"form-group entity-form-upload-section",children:[a.jsx("label",{htmlFor:"entity-image-upload",children:"Upload image"}),a.jsx("input",{id:"entity-image-upload",type:"file",accept:"image/png,image/jpeg",ref:N,onChange:Se,disabled:!t||Ue||de}),it&&wt?a.jsx("div",{className:"entity-form-upload-preview",children:a.jsx(oN,{src:wt,size:220,zoomLabel:"Zoom to crop",onCropChange:Le})}):null,Nt,a.jsx("p",{className:"entity-image-helper",children:Dt}),Ct?a.jsx("p",{className:"entity-image-status entity-image-status--error",children:Ct}):null,!Ct&&Ue?a.jsx("p",{className:"entity-image-status",children:"Uploading image"}):null,!Ct&&de?a.jsx("p",{className:"entity-image-status",children:"Removing image"}):null]}):null,He&&a.jsxs("div",{className:"metadata-field-section",children:[a.jsx("h3",{children:"Information"}),$.map(le=>a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`metadata-field-${le.id}`,children:[le.label,le.required?" *":""]}),re(le)]},le.id))]}),ve&&!e&&a.jsx("p",{className:"help-text",children:"Assign a world to configure access controls."}),g&&a.jsx("div",{className:"form-two-column",children:ut()}),g&&a.jsxs("div",{className:"advanced-options",children:[a.jsxs("button",{type:"button",className:"advanced-options-toggle",onClick:kt,"aria-expanded":ye,children:[a.jsx("span",{children:"Advanced options"}),ee?a.jsx("span",{className:"advanced-indicator",children:"Metadata added"}):null,a.jsx("span",{className:"advanced-chevron","aria-hidden":"true",children:ye?"":""})]}),ye&&a.jsx("div",{className:"advanced-options-body",children:a.jsxs("div",{className:"metadata-editor",children:[a.jsxs("div",{className:"metadata-header",children:[a.jsxs("h3",{children:["Metadata ",ee?"":"(optional)"]}),a.jsx("button",{type:"button",className:"btn neutral",onClick:Jt,disabled:X,children:"Add field"})]}),a.jsx("div",{className:"metadata-list",children:I.map((le,st)=>a.jsxs("div",{className:"metadata-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`metadata-key-${le.id}`,className:"sr-only",children:["Metadata key ",st+1]}),a.jsx("input",{id:`metadata-key-${le.id}`,type:"text",placeholder:"Key",value:le.key,onChange:Bt(le.id,"key"),disabled:X})]}),a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`metadata-value-${le.id}`,className:"sr-only",children:["Metadata value ",st+1]}),a.jsx("input",{id:`metadata-value-${le.id}`,type:"text",placeholder:"Value",value:le.value,onChange:Bt(le.id,"value"),disabled:X})]}),a.jsx("div",{className:"metadata-actions",children:a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Et(le.id),disabled:X||I.length===1,title:"Remove field",children:""})})]},le.id))})]})})]})]})}),G&&a.jsx("div",{className:"form-error",role:"alert",children:G}),!f&&a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:r,disabled:X,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:X||be,children:X?"Saving...":g?"Save Changes":"Create Entity"})]})]})}const s4={visible:"badge-visible",partial:"badge-partial",hidden:"badge-hidden"},r4=new Set(["system_admin"]),X0="entityType",ss=["name","type","visibility","createdAt"],Pu=[{key:"name",label:"Name",type:"core"},{key:"type",label:"Type",type:"core"},{key:"importance",label:"Importance",type:"core"},{key:"visibility",label:"Visibility",type:"core"},{key:"createdAt",label:"Created",type:"core"},{key:"description",label:"Description",type:"core"}],Vh="user",K0="system",hl=(e="create")=>({mode:e,submitLabel:e==="edit"?"Save Changes":"Create Entity",submitDisabled:!1,cancelDisabled:!1,accessButtonVisible:!1,accessButtonDisabled:!1}),Yh=(e=[],t=[])=>e.length!==t.length?!1:e.every((r,i)=>r===t[i]),Gh=(e,t,r)=>{const i=new Set(r),l=[];if(Array.isArray(e)&&e.forEach(f=>{if(typeof f!="string")return;const m=f.trim();!m||!i.has(m)||l.includes(m)||l.push(m)}),l.length>0)return l;const c=Array.isArray(t)?t.filter(f=>typeof f=="string"&&i.has(f)):[];return c.length>0?[...c]:i.size>0?[i.values().next().value]:[]},i4=e=>{if(!e||typeof e!="object")return"";const t=e.displayValue??e.display??e.label??e.displayName??e.text??e.name??e.title??e.value??e.id??null;return t!=null?String(t).trim():""},Qy=e=>!e||typeof e!="object"?!1:Array.isArray(e)?e.some(t=>Qy(t)):Object.prototype.hasOwnProperty.call(e,"displayValue")||Object.prototype.hasOwnProperty.call(e,"display")||Object.prototype.hasOwnProperty.call(e,"label"),dN=e=>{if(e==null)return"";if(Array.isArray(e)){const t=e.map(r=>dN(r)).filter(r=>!!r);return t.length?t.join(", "):""}return typeof e=="object"?i4(e):String(e).trim()},Xh=(e,t=null)=>{if(e==null)return"";const r=t?.dataType||t?.data_type||"";if(r==="reference"||Qy(e))return dN(e)||"";if(typeof e=="boolean")return e?"Yes":"No";if(typeof e=="number")return Number.isFinite(e)?String(e):"";if(r==="number"){const c=Number(e);return Number.isFinite(c)?String(c):""}if(e instanceof Date)return e.toLocaleDateString();if(r==="date"||typeof e=="string"&&r==="text"){const c=new Date(e);if(!Number.isNaN(c.getTime()))return c.toLocaleDateString()}if(Array.isArray(e))return e.length===0?"":e.filter(c=>c!=null&&String(c).trim()!=="").map(c=>typeof c=="string"?c.trim():String(c)).join(", ");if(typeof e=="object")try{return JSON.stringify(e)}catch(c){return console.warn(" Failed to stringify metadata value",c),""}return String(e).trim()||""};function l4(){const{user:e,token:t,sessionReady:r}=En(),{selectedCampaign:i,selectedCampaignId:l,activeWorld:c,activeWorldId:f,selectedContextType:m,viewAsCharacterId:h,contextKey:p}=Un(),[y,g]=z2(),v=zy(),[S,w]=u.useState([]),[N,E]=u.useState(!1),[C,A]=u.useState(""),[O,_]=u.useState(!1),[R,D]=u.useState(null),[j,z]=u.useState(""),[P,X]=u.useState(""),[H,G]=u.useState(null),[V,k]=u.useState(null),[F,I]=u.useState(!1),[L,$]=u.useState(""),[T,U]=u.useState(null),[M,q]=u.useState(null),[Y,J]=u.useState(()=>[...ss]),[ie,Z]=u.useState(()=>[...ss]),[fe,Q]=u.useState(!1),[se,ne]=u.useState(""),[we,Ie]=u.useState(""),[Me,Ae]=u.useState(""),[it,$e]=u.useState(""),[nt,Le]=u.useState(()=>hl("create")),[wt,Tt]=u.useState("details"),[Ct,At]=u.useState(!1),[Ue,Je]=u.useState({open:!1,columnKey:"",columnLabel:"",x:0,y:0}),[de,ue]=u.useState(!1),[ye,Ve]=u.useState([]),ee=y.toString(),me=f||"",he=!!me,Se=y.get(X0)??"",We=!!Se,Xe=u.useRef(`entity-form-${Math.random().toString(36).slice(2)}`),et=u.useRef(`${me}:${p}`),Te=u.useCallback((ce,_e="info")=>{G({message:ce,tone:_e})},[]);u.useEffect(()=>{!v||!fe||Q(!1)},[v,fe]),u.useEffect(()=>{nt.accessButtonVisible||wt!=="details"&&Tt("details")},[nt.accessButtonVisible,wt]),u.useEffect(()=>{if(!Ue.open)return;const ce=()=>Je({open:!1,columnKey:"",columnLabel:"",x:0,y:0});return window.addEventListener("click",ce),window.addEventListener("contextmenu",ce),()=>{window.removeEventListener("click",ce),window.removeEventListener("contextmenu",ce)}},[Ue.open]),u.useEffect(()=>{if(!H)return;const ce=setTimeout(()=>G(null),3500);return()=>clearTimeout(ce)},[H]);const mt=u.useCallback(ce=>{if(!ce)return"";const _e=new Date(ce);return Number.isNaN(_e.getTime())?"":_e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},[]),Dt=u.useMemo(()=>!i||!e?"":i.members?.find(_e=>_e.user_id===e.id)?.role||"",[i,e]),Nt=u.useMemo(()=>{if(!c||!e?.id)return!1;const ce=c.created_by||c.creator?.id||c.owner_id||c.owner?.id||"";return ce?String(ce)===String(e.id):!1},[c,e?.id]),Ge=u.useMemo(()=>e?r4.has(e.role)?!0:me?m==="world"?Nt:!!(i&&(Dt==="dm"||Nt)):!1:!1,[e,me,m,i,Dt,Nt]),vt=c?.entity_creation_scope??"",Mt=u.useMemo(()=>!l||!i||!e||vt!==uc.ALL_PLAYERS?!1:Dt==="player",[l,i,e,vt,Dt]),Bt=Ge||Mt,Jt=e?.role==="system_admin",Et=u.useCallback(async(ce,_e={})=>{if(!t)return w([]),[];const{useUnassigned:Ht=!1,viewAsCharacterId:pn=""}=_e;if(Ht){if(!Jt)return w([]),A("Only system administrators can view unassigned entities"),[];E(!0),A("");try{const Pt=await IR(),jn=Array.isArray(Pt)?Pt:Array.isArray(Pt?.data)?Pt.data:[];return w(jn),jn}catch(Pt){return console.error(" Failed to load unassigned entities",Pt),A(Pt.message||"Failed to load unassigned entities"),w([]),[]}finally{E(!1)}}const fn=ce??me;if(!fn)return w([]),[];E(!0),A("");try{const Pt=await lc(fn,{viewAsCharacterId:pn,importance:ye.length>0?ye:void 0}),jn=Array.isArray(Pt)?Pt:Array.isArray(Pt?.data)?Pt.data:[];return w(jn),jn}catch(Pt){return console.error(" Failed to load entities",Pt),A(Pt.message||"Failed to load entities"),w([]),[]}finally{E(!1)}},[t,me,Jt,p]);u.useEffect(()=>{if(!t){w([]);return}if(de){Et(null,{useUnassigned:!0});return}if(!me){w([]);return}Et(me,{viewAsCharacterId:h})},[me,t,de,Et,p,h,ye]),u.useEffect(()=>{if(de){et.current=`${me}:${p}`;return}const ce=`${me}:${p}`;et.current!==ce&&(O&&(_(!1),D(null)),z(""),Le(hl("create")),A(""),G(null),et.current=ce)},[me,p,O,de]),u.useEffect(()=>{!Jt&&de&&ue(!1)},[Jt,de]),u.useEffect(()=>{de&&O&&(_(!1),D(null),z(""),Le(hl("create")))},[de,O]),u.useEffect(()=>{if(Q(!1),ne(""),!Se||!t||!r){k(null),$(""),U(null),q(null),J([...ss]),Z([...ss]),I(!1);return}let ce=!1;return(async()=>{I(!0),$("");try{const Ht=await nk(Se);if(ce)return;const pn=Ht?.data??Ht??{},fn=pn.data??pn,Pt=Array.isArray(fn.coreColumns)&&fn.coreColumns.length?fn.coreColumns:Pu,jn=new Map(Pu.map(Yt=>[Yt.key,Yt])),Hn=Pt.map(Yt=>{const Wn=jn.get(Yt.key)??{};return{...Wn,...Yt,type:"core",label:Yt.label||Wn.label||Yt.key}}),Bn=Pu.filter(Yt=>!Hn.some(Wn=>Wn.key===Yt.key)),oa=[...Hn,...Bn],Re=(Array.isArray(fn.metadataColumns)?fn.metadataColumns:[]).filter(Yt=>typeof Yt?.key=="string").map(Yt=>({key:Yt.key,name:Yt.name||Yt.key.replace(/^metadata\./,""),label:Yt.label||Yt.name||Yt.key.replace(/^metadata\./,""),dataType:Yt.dataType||Yt.data_type||"",required:!!Yt.required,options:Yt.options||Yt.choices||{},referenceTypeId:Yt.referenceTypeId||Yt.reference_type_id||null,referenceTypeName:Yt.referenceTypeName||Yt.reference_type_name||"",referenceFilter:Yt.referenceFilter||Yt.reference_filter||Yt.referenceFilterJson||{}})).sort((Yt,Wn)=>Yt.label.localeCompare(Wn.label,void 0,{sensitivity:"base"})),bt=new Set([...oa.map(Yt=>Yt.key),...Re.map(Yt=>Yt.key)]);ss.forEach(Yt=>bt.add(Yt));const It=Gh(ss,ss,bt),Gt=fn.systemDefault?.columns,an=Array.isArray(Gt)&&Gt.length?Gh(Gt,It,bt):[...It],xn=fn.userPreference?.columns,Kt=Array.isArray(xn)&&xn.length>0,vn=Kt?Gh(xn,an,bt):[],ca=Kt&&vn.length?vn:an;k({coreColumns:oa,metadataColumns:Re}),q(an.length?{columns:[...an],updatedAt:fn.systemDefault?.updatedAt??null}:null),U(Kt&&vn.length?{columns:[...vn],updatedAt:fn.userPreference?.updatedAt??null}:null),J([...ca]),Z([...ca])}catch(Ht){if(ce)return;console.error(" Failed to load column configuration",Ht),$(Ht.message||"Failed to load column configuration"),k(null),U(null),q(null),J([...ss]),Z([...ss])}finally{ce||I(!1)}})(),()=>{ce=!0}},[Se,t,r]);const zt=u.useMemo(()=>{let ce=S;return Se&&(ce=ce.filter(_e=>(_e.entity_type_id||_e.entityType?.id||_e.entity_type?.id||"")===Se)),ye.length>0&&l&&(ce=ce.filter(_e=>{const Ht=_e.importance||null;return ye.includes(Ht)})),ce},[S,Se,ye,l]),$t=u.useMemo(()=>{if(!Se)return"";const ce=S.find(_e=>(_e.entity_type_id||_e.entityType?.id||_e.entity_type?.id||"")===Se);return ce?.entityType?.name||ce?.entity_type?.name||""},[S,Se]),kt=u.useMemo(()=>{const ce=[],_e=new Set,Ht=(Pt,jn)=>{if(!Pt||typeof Pt!="object")return;const Hn=typeof Pt.key=="string"?Pt.key.trim():"";if(!Hn||_e.has(Hn))return;const Bn=Pt.label||Pt.name||(typeof Pt.title=="string"?Pt.title:""),oa=typeof Bn=="string"&&Bn.trim()?Bn.trim():Hn;ce.push({...Pt,key:Hn,label:oa,type:Pt.type||jn}),_e.add(Hn)};return(V?.coreColumns??Pu).forEach(Pt=>Ht(Pt,"core")),(V?.metadataColumns??[]).forEach(Pt=>Ht(Pt,"metadata")),ce},[V]),te=u.useMemo(()=>{const ce=new Map;return kt.forEach(_e=>{ce.set(_e.key,{..._e,type:_e.type==="metadata"?"metadata":"core"})}),ce},[kt]),be=u.useMemo(()=>Array.from(te.keys()),[te]),ve=u.useMemo(()=>{const ce=ss.filter(_e=>te.has(_e));return ce.length>0?ce:be.length>0?[be[0]]:[...ss]},[be,te]),Be=u.useMemo(()=>{if(v){const ce=[];return te.has("name")&&ce.push("name"),te.has("description")&&ce.push("description"),ce.length>0?ce:ve.filter(_e=>te.has(_e))}return Se?Y:ss},[v,te,ve,Se,Y]);u.useEffect(()=>{Se&&J(ce=>{const _e=ce.filter(Ht=>te.has(Ht));return _e.length>0?_e:ve})},[Se,te,ve]),u.useEffect(()=>{Z([...Y])},[Y]);const ot=u.useMemo(()=>{const ce=Be.map(_e=>te.get(_e)).filter(Boolean);return ce.length>0?ce:ve.map(_e=>te.get(_e)).filter(Boolean)},[Be,te,ve]),xt=M?.columns??ve,re=T?.columns??xt,je=!!Se&&!Yh(ie,re),He=!!Se&&!Yh(ie,xt),ut=we===Vh,dt=we===K0,Ee=Yh(ie,xt),at=()=>{Z([...xt]),ne(""),Ae(""),$e("")},le=ce=>{Se&&Z(_e=>_e.includes(ce)?_e.length===1?(ne("You must keep at least one column selected."),_e):(ne(""),Me===ce&&(Ae(""),$e("")),_e.filter(Ht=>Ht!==ce)):te.has(ce)?(ne(""),[..._e,ce]):_e)},st=(ce,_e)=>{Se&&ie.includes(ce)&&(Ae(ce),$e(""),_e?.dataTransfer&&(_e.dataTransfer.effectAllowed="move",_e.dataTransfer.setData("text/plain",ce)))},ct=(ce,_e)=>{!Me||Me===ce||ie.includes(ce)&&(_e&&(_e.preventDefault(),_e.dataTransfer&&(_e.dataTransfer.dropEffect="move")),$e(ce))},yt=ce=>{Se&&(Z(_e=>{if(!Me||Me===ce)return _e;const Ht=_e.indexOf(Me),pn=_e.indexOf(ce);if(Ht===-1||pn===-1)return _e;const fn=[..._e],[Pt]=fn.splice(Ht,1),jn=Ht<pn?Math.max(pn-1,0):pn;return fn.splice(jn,0,Pt),fn}),$e(""),Ae(""))},oe=()=>{Se&&(Z(ce=>{if(!Me||!ce.includes(Me))return ce;const _e=ce.filter(Ht=>Ht!==Me);return _e.push(Me),_e}),$e(""),Ae(""))},Ze=()=>{$e(""),Ae("")},Ke=()=>{Se&&(ne(""),Q(ce=>{const _e=!ce;return!ce&&_e&&(Z([...Y]),Ae(""),$e("")),ce&&!_e&&(Ae(""),$e("")),_e}))},ft=()=>{Q(!1),$e(""),Ae("")},Qe=async ce=>{if(Se){if(ie.length===0){ne("Please select at least one column.");return}Ie(ce),ne("");try{await ak(Se,{scope:ce,columns:ie}),ce===Vh?(U({columns:[...ie],updatedAt:new Date().toISOString()}),J([...ie]),ft(),Te("Column preference saved","success")):(q({columns:[...ie],updatedAt:new Date().toISOString()}),J([...ie]),Te("System default updated","success"))}catch(_e){console.error(" Failed to save column selection",_e),ne(_e.message||"Failed to save column settings")}finally{Ie("")}}},pt=u.useCallback(ce=>ce?.entityType?.name||ce?.entity_type?.name||"",[]),ke=u.useCallback((ce,_e)=>{if(!ce)return"";switch(_e){case"name":return ce.name||"";case"type":return pt(ce);case"visibility":return ce.visibility||"visible";case"createdAt":return ce.createdAt||ce.created_at||"";case"description":return ce.description||"";default:{if(_e.startsWith("metadata.")){const Ht=ce.metadata&&typeof ce.metadata=="object"?ce.metadata:{},pn=_e.replace(/^metadata\./,"");return Ht?.[pn]}return ce[_e]}}},[pt]),Pe=u.useCallback(ce=>{if(ce==null||ce==="")return null;if(typeof ce=="string"){const _e=ce.trim();return _e.length>0?_e:null}if(typeof ce=="object"&&!Array.isArray(ce)){const _e=ce.id??ce.value??ce.key??ce.slug??ce.uuid??null;return _e!=null?String(_e).trim():null}if(Array.isArray(ce)){for(const _e of ce){const Ht=Pe(_e);if(Ht)return Ht}return null}return null},[]),ht=u.useMemo(()=>{const ce=[];return te.forEach(_e=>{const pn=(_e.type==="metadata"?_e.dataType||_e.data_type||"string":_e.dataType)||(_e.key==="createdAt"?"date":"string"),fn=pn==="reference"||_e.dataType&&String(_e.dataType).toLowerCase()==="reference"||_e.data_type&&String(_e.data_type).toLowerCase()==="reference",Pt=jn=>{const Hn=ke(jn,_e.key);if(fn){const Bn=Pe(Hn);return Bn!==null?Bn:Hn}return Hn};ce.push({key:_e.key,label:_e.label||_e.name||_e.key,dataType:pn,accessor:Pt})}),ce},[te,ke,Pe]),K=u.useMemo(()=>new Map(ht.map(ce=>[ce.key,ce])),[ht]),ae=X1(zt,{columns:ht}),Ne=u.useCallback(ce=>{const _e=ae.groupBy?te.get(ae.groupBy):null;if(!_e)return Xh(ce);if(_e.key==="visibility"){const Ht=typeof ce=="string"?ce:"";return Ht?Ht.charAt(0).toUpperCase()+Ht.slice(1):"Hidden"}return _e.key==="createdAt"?mt(ce):_e.key==="type"?ce||"Unassigned":_e.key.startsWith("metadata.")?Xh(ce,_e):_e.key==="name"||_e.key==="description"?ce?String(ce):"":ce?String(ce):"Unassigned"},[te,ae.groupBy,mt]),qe=u.useMemo(()=>ht.map(ce=>{const _e=te.get(ce.key),Ht=_e?.data_type||_e?.dataType||ce.dataType,pn={key:ce.key,label:K.get(ce.key)?.label||ce.label||ce.key,dataType:ce.dataType,originalDataType:Ht};_e?.options&&(pn.options=_e.options);const fn=_e?.referenceTypeId||_e?.reference_type_id;fn&&(pn.referenceTypeId=fn);const Pt=_e?.referenceTypeName||_e?.referenceType?.name;Pt&&(pn.referenceTypeName=Pt);const jn=_e?.referenceFilter||_e?.reference_filter;return jn&&(pn.referenceFilter=jn),pn}),[ht,K,te]),gt=ce=>{ce&&ae.toggleSort(ce)},St=(ce,_e)=>{ce.preventDefault(),Je({open:!0,columnKey:_e.key,columnLabel:_e.label||_e.name||_e.key,x:ce.clientX,y:ce.clientY})},_t=ce=>{ae.setGroupBy(ce),Je({open:!1,columnKey:"",columnLabel:"",x:0,y:0})},qt=(ce,_e)=>{const Ht=_e.metadata&&typeof _e.metadata=="object"?_e.metadata:{};switch(ce.key){case"name":const pn=l?_e.importance:null,fn={critical:"",important:"",medium:""};return a.jsxs(a.Fragment,{children:[a.jsx(Qt,{to:`/entities/${_e.id}`,state:{fromEntities:{search:ee}},className:"entity-name-link",children:_e.name}),_e.id?a.jsxs(a.Fragment,{children:["",a.jsx(Ls,{entityId:_e.id,entityName:_e.name||"entity"})]}):null,pn&&a.jsxs(a.Fragment,{children:["",a.jsx("span",{className:"entity-importance-indicator",title:`Importance: ${pn}`,children:fn[pn]||""})]})]});case"type":return pt(_e);case"visibility":{const Pt=_e.visibility||"visible",jn=s4[Pt]||"badge-hidden";return a.jsx("span",{className:`visibility-badge ${jn}`,children:Pt.charAt(0).toUpperCase()+Pt.slice(1)})}case"createdAt":return mt(_e.createdAt||_e.created_at);case"description":return _e.description?_e.description:"";case"importance":{if(!l)return"";const Pt=_e.importance;if(!Pt)return"";const jn={critical:"Critical",important:"Important",medium:"Medium"},Hn={critical:"#dc2626",important:"#ea580c",medium:"#6b7280"};return a.jsx("span",{className:"importance-badge",style:{"--importance-color":Hn[Pt]},children:jn[Pt]||Pt})}default:{if(ce.key.startsWith("metadata.")){const Pt=ce.key.replace(/^metadata\./,""),jn=Ht?.[Pt],Hn=Xh(jn,ce);if(((ce?.dataType||ce?.data_type||"")==="reference"||Qy(jn))&&jn!==null&&jn!==void 0){const ge=Yy(jn),Re=Gy(jn)||Hn||"entity";if(ge)return a.jsxs(a.Fragment,{children:[Hn,"",a.jsx(Ls,{entityId:ge,entityName:Re})]})}return Hn}return""}}},en=()=>{_(!1),D(null),z(""),Le(hl("create")),Tt("details")},dn=async ce=>{en(),de?await Et(null,{useUnassigned:!0}):me&&await Et(me,{viewAsCharacterId:h}),Te(ce==="create"?"Entity created":"Entity updated","success")},Zt=async ce=>{if(!(!Ge||!ce?.id||!window.confirm(`Delete entity "${ce.name}"? This action cannot be undone.`)))try{X(ce.id),await zR(ce.id),Te("Entity deleted","success"),de?await Et(null,{useUnassigned:!0}):me&&await Et(me,{viewAsCharacterId:h})}catch(Ht){console.error(" Failed to delete entity",Ht),Te(Ht.message||"Failed to delete entity","error")}finally{X("")}},sa=()=>{if(de){Et(null,{useUnassigned:!0});return}me&&Et(me,{viewAsCharacterId:h})},ba=()=>{!Bt||!me||de||(D(null),z(""),Le(hl("create")),Tt("details"),_(!0))},zs=ce=>{if(!Ge||!ce?.id)return;const _e=typeof ce.name=="string"?ce.name.trim():"";D(ce.id),z(_e),Le(hl("edit")),Tt("details"),_(!0)},va=u.useCallback(ce=>{ce&&Le(_e=>({..._e,...ce}))},[]),$s=u.useMemo(()=>{if(!R)return"";const ce=S.find(Ht=>Ht.id===R);return typeof ce?.name=="string"&&ce.name.trim()||typeof j=="string"&&j.trim()||""||"Untitled entity"},[S,R,j]),la=R?`Edit Entity: ${$s}`:"Add Entity",ei=u.useCallback(()=>{g(ce=>{const _e=new URLSearchParams(ce);return _e.delete(X0),_e})},[g]);if(!r)return a.jsx("p",{children:"Restoring session..."});if(!t)return a.jsx("p",{children:"Authenticating..."});const ti=zt.length>0,qn=ae.groupBy?ae.groups.some(ce=>ce.items.length>0):ae.data.length>0,La=`entities-page${v?" entities-page--mobile":""}`,Ns=i?`${i.name}${c?.name?`  ${c.name}`:""}`:he?`World  ${c?.name||"Untitled world"}`:"";return a.jsxs("section",{className:La,children:[a.jsx("div",{className:"entities-header",children:a.jsxs("div",{className:"entities-header-top",children:[a.jsxs("div",{className:"entities-header-left",children:[a.jsx("h1",{children:"Entities"}),de?a.jsx("p",{className:"entities-subtitle",children:"Showing entities without a world assignment."}):he?a.jsx("p",{className:"entities-subtitle",children:Ns}):a.jsx("p",{className:"entities-subtitle",children:"Select a campaign or world you own to choose a world context."})]}),a.jsxs("div",{className:"entities-header-controls-row",children:[a.jsx(Uy,{value:ae.searchTerm,onChange:ae.setSearchTerm,placeholder:"Search entities...",ariaLabel:"Search entities"}),a.jsxs("div",{className:"entities-controls",children:[Jt&&a.jsx("button",{type:"button",className:`btn secondary compact${de?" is-active":""}`,onClick:()=>ue(ce=>!ce),"aria-pressed":de,title:de?"Show entities for the selected world":"Show entities that do not have a world assigned",children:"No World"}),l&&a.jsxs("div",{className:"entities-importance-filters",children:[["critical","important","medium"].map(ce=>{const _e=ye.includes(ce);return a.jsx("button",{type:"button",className:`btn secondary compact importance-filter importance-${ce}${_e?" is-active":""}`,onClick:()=>{Ve(Ht=>_e?Ht.filter(pn=>pn!==ce):[...Ht,ce])},title:`Filter by ${ce} importance`,children:ce.charAt(0).toUpperCase()+ce.slice(1)},ce)}),ye.length>0&&a.jsx("button",{type:"button",className:"btn secondary compact importance-filter-clear",onClick:()=>Ve([]),title:"Clear importance filters",children:a.jsx(Ia,{size:14})})]}),a.jsxs("div",{className:"entities-filters-refresh-group",children:[a.jsxs("button",{type:"button",className:`btn secondary compact${ae.filterActive?" is-active":""}`,onClick:()=>At(!0),children:[a.jsx(Qd,{size:16})," Filters"]}),a.jsx("button",{type:"button",className:"icon-btn",title:"Refresh entities",onClick:sa,disabled:N||!de&&!me,children:a.jsx(Ll,{size:16})})]}),!v&&We&&a.jsxs("div",{className:"entities-column-menu-wrapper",children:[a.jsxs("button",{type:"button",className:"btn secondary compact","aria-haspopup":"dialog",onClick:Ke,children:[a.jsx(pM,{size:16})," Columns"]}),fe&&a.jsx("div",{className:"entities-column-drawer-overlay",role:"presentation",onClick:ft,children:a.jsxs("div",{className:"entities-column-drawer",role:"dialog","aria-modal":"true","aria-labelledby":"column-drawer-title",onClick:ce=>ce.stopPropagation(),children:[a.jsxs("div",{className:"entities-column-drawer-header",children:[a.jsxs("div",{children:[a.jsxs("h3",{id:"column-drawer-title",children:["Columns for ",$t||"selected type"]}),a.jsx("p",{className:"entities-column-info",children:"Choose which fields are visible in this list. Drag the handle to reorder selected columns and save to keep your personal preference."})]}),a.jsx("button",{type:"button",className:"icon-btn",onClick:ft,title:"Close column settings",children:a.jsx(Ia,{size:16})})]}),a.jsx("div",{className:"entities-column-drawer-body",children:F?a.jsx("p",{className:"entities-column-info",children:"Loading columns"}):L?a.jsx("div",{className:"alert error",role:"alert",children:L}):a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"entities-column-hint",children:"Checked columns appear in the table. Drag the grip icon to adjust their display order."}),a.jsxs("ul",{className:"entities-column-list",children:[ie.map(ce=>{const _e=kt.find(fn=>fn.key===ce);if(!_e)return null;const Ht=Me===ce,pn=_e.type==="metadata"?"Metadata":"Core";return a.jsxs(u.Fragment,{children:[it===ce&&a.jsx("div",{className:"drop-indicator"}),a.jsxs("li",{className:`entities-column-item${Ht?" is-dragging":""}`,draggable:!0,onDragStart:fn=>st(ce,fn),onDragOver:fn=>ct(ce,fn),onDrop:()=>yt(ce),onDragEnd:Ze,children:[a.jsxs("div",{className:"entities-column-item-main",children:[a.jsx("input",{type:"checkbox",checked:!0,onChange:()=>le(ce)}),a.jsx("label",{className:"entities-column-name",children:_e.label}),a.jsx("span",{className:"entities-column-type-badge",children:pn})]}),a.jsx("button",{type:"button",className:"entities-column-handle",draggable:!0,onDragStart:fn=>st(ce,fn),children:a.jsx(_T,{size:18})})]})]},ce)}),Me&&it==="__end"&&a.jsx("div",{className:"drop-indicator end"}),kt.filter(ce=>!ie.includes(ce.key)).map(ce=>{const _e=ce.type==="metadata"?"Metadata":"Core";return a.jsxs("li",{className:"entities-column-item inactive",children:[a.jsxs("div",{className:"entities-column-item-main",children:[a.jsx("input",{type:"checkbox",checked:!1,onChange:()=>le(ce.key)}),a.jsx("label",{className:"entities-column-name",children:ce.label}),a.jsx("span",{className:"entities-column-type-badge",children:_e})]}),a.jsx("div",{className:"entities-column-handle-placeholder"})]},ce.key)})]}),Me&&a.jsx("div",{className:`entities-column-dropzone${it==="__end"?" is-active":""}`,onDragOver:ce=>{Me&&(ce.preventDefault(),ce.dataTransfer&&(ce.dataTransfer.dropEffect="move"),$e("__end"))},onDragLeave:()=>{it==="__end"&&$e("")},onDrop:ce=>{ce.preventDefault(),oe()},children:"Drop here to move column to the end"}),kt.every(ce=>ce.type!=="metadata")&&a.jsx("p",{className:"entities-column-empty",children:"This entity type does not have metadata fields yet."}),se&&a.jsx("p",{className:"entities-column-error",children:se})]})}),a.jsxs("div",{className:"entities-column-drawer-footer",children:[a.jsx("div",{className:"entities-column-footer-left",children:a.jsx("button",{type:"button",className:"btn secondary",onClick:at,disabled:F||Ee,children:"Use system default"})}),a.jsxs("div",{className:"entities-column-footer-right",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:()=>Qe(Vh),disabled:F||ut||!je,children:ut?"Saving":"Save for me"}),Jt&&a.jsxs("div",{className:"entities-column-admin",children:[a.jsx("span",{className:"entities-column-admin-label",children:"System settings (admin only)"}),a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>Qe(K0),disabled:F||dt||!He,title:"Set these columns as the default for all users",children:dt?"Saving":"Set as system default"})]})]})]})]})})]})]}),a.jsxs("button",{type:"button",className:"btn submit",onClick:ba,disabled:!Bt||!me||N||de,children:[a.jsx(Ya,{size:18})," Add Entity"]})]})]})}),de&&a.jsx("div",{className:"alert info",role:"status",children:"Entities listed here do not have a world assigned. Open an entity to update its world from the entity detail view."}),H&&a.jsx("div",{className:`toast-banner ${H.tone}`,role:"status",children:H.message}),C&&a.jsx("div",{className:"alert error",role:"alert",children:C}),N?a.jsx("div",{className:"empty-state",children:"Loading entities..."}):!me&&!de?a.jsx("div",{className:"empty-state",children:"Select a campaign to view its entities."}):ti?qn?a.jsx("div",{className:"entities-table-wrapper",children:a.jsxs("table",{className:"entities-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[ot.map(ce=>{const _e=ae.sortState.key===ce.key,Ht=ae.groupBy===ce.key;return a.jsx("th",{onClick:()=>gt(ce.key),onContextMenu:pn=>St(pn,ce),className:"sortable-header",children:a.jsxs("span",{className:"header-label",children:[ce.label,_e&&a.jsx("span",{className:"sort-indicator",children:ae.sortState.direction==="asc"?"":""}),Ht&&a.jsx("span",{className:"group-indicator",children:"Grouped"})]})},ce.key)}),Ge&&a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:ae.groupBy?ae.groups.map(ce=>a.jsxs(u.Fragment,{children:[a.jsx("tr",{className:"entities-group-row",children:a.jsxs("td",{colSpan:ot.length+(Ge?1:0),children:[a.jsx("button",{type:"button",className:"group-toggle",onClick:()=>ae.toggleGroupCollapse(ce.id),"aria-label":`Toggle group ${Ne(ce.value)}`,children:ae.isGroupCollapsed(ce.id)?a.jsx(Dy,{size:14}):a.jsx(Hr,{size:14})}),a.jsxs("span",{className:"entities-group-label",children:[Ne(ce.value)," ",a.jsxs("span",{className:"entities-group-count",children:["(",ce.items.length,")"]})]})]})}),!ae.isGroupCollapsed(ce.id)&&ce.items.map(_e=>a.jsxs("tr",{children:[ot.map(Ht=>a.jsx("td",{children:qt(Ht,_e)},Ht.key)),Ge&&a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>zs(_e),title:"Edit entity",disabled:N,children:a.jsx(ir,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>Zt(_e),title:"Delete entity",disabled:P===_e.id,children:a.jsx(ha,{size:16})})]})})]},_e.id))]},ce.id)):ae.data.map(ce=>a.jsxs("tr",{children:[ot.map(_e=>a.jsx("td",{children:qt(_e,ce)},_e.key)),Ge&&a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>zs(ce),title:"Edit entity",disabled:N,children:a.jsx(ir,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>Zt(ce),title:"Delete entity",disabled:P===ce.id,children:a.jsx(ha,{size:16})})]})})]},ce.id))})]})}):a.jsxs("div",{className:"empty-state",children:[a.jsx("p",{className:"empty-title",children:"No entities match your filters."}),a.jsx("div",{className:"empty-actions",children:(ae.filterActive||ae.searchTerm)&&a.jsxs("div",{className:"empty-action-buttons",children:[ae.filterActive&&a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>ae.clearFilters(),children:"Clear filters"}),ae.searchTerm&&a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>ae.setSearchTerm(""),children:"Reset search"})]})})]}):a.jsx("div",{className:"empty-state",children:We?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"empty-title",children:"No entities of this type yet."}),a.jsx("button",{type:"button",className:"btn secondary",onClick:ei,children:"View all entities"})]}):Bt?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"empty-title",children:"No entities yet."}),a.jsxs("p",{children:["Click ",a.jsx("strong",{children:"Add Entity"})," to create your first entity."]})]}):a.jsx("p",{children:"Nothing to show right now."})}),Ue.open&&a.jsxs("div",{className:"column-context-menu",style:{top:Ue.y,left:Ue.x},role:"menu",children:[a.jsx("button",{type:"button",onClick:()=>_t(Ue.columnKey),children:ae.groupBy===Ue.columnKey?"Remove grouping":`Group by ${Ue.columnLabel}`}),ae.groupBy&&ae.groupBy!==Ue.columnKey&&a.jsx("button",{type:"button",onClick:()=>_t(""),children:"Clear grouping"})]}),a.jsx(W1,{open:Ct,onClose:()=>At(!1),fields:qe,value:ae.filters,worldId:me,onApply:ce=>{ae.setFilters(ce),At(!1)}}),a.jsx(Xr,{isOpen:O,onClose:en,title:la,width:420,footerActions:a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:en,disabled:nt.cancelDisabled,children:"Cancel"}),nt.accessButtonVisible&&a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>Tt(ce=>ce==="access"?"details":"access"),disabled:nt.accessButtonDisabled,children:wt==="access"?"Details":"Access"}),a.jsx("button",{type:"submit",className:"btn submit",form:Xe.current,disabled:nt.submitDisabled,children:nt.submitLabel})]}),children:a.jsx(uN,{worldId:de?"":me,entityId:R,onCancel:en,onSaved:dn,formId:Xe.current,onStateChange:va,hideActions:!0,selectedEntityTypeId:We?Se:"",activeView:wt,onViewChange:Tt,defaultCampaignId:i?.id||""})})]})}function o4({tabs:e=[],activeTab:t,onChange:r}){if(!Array.isArray(e)||e.length===0)return null;const i=l=>{typeof r=="function"&&r(l)};return a.jsx("nav",{className:"tab-nav flex flex-wrap gap-2",role:"tablist",children:e.map(l=>{const{id:c,label:f}=l,m=c===t;return a.jsx("button",{type:"button",role:"tab","aria-selected":m,className:`tab-nav-button whitespace-nowrap px-3 py-2 ${m?"is-active":""}`,onClick:()=>i(c),children:f},c)})})}const c4=(e,t)=>{const r=new URLSearchParams;t&&r.set("campaignId",t);const i=r.toString(),l=i?`/entities/${e}/follow?${i}`:`/entities/${e}/follow`;return Rt.post(l)},fN=(e,t)=>{const r=new URLSearchParams;t&&r.set("campaignId",t);const i=r.toString(),l=i?`/entities/${e}/follow?${i}`:`/entities/${e}/follow`;return Rt.delete(l)},u4=e=>{const t=new URLSearchParams;e&&t.set("campaignId",e);const r=t.toString(),i=r?`/entities/followed?${r}`:"/entities/followed";return Rt.get(i)},d4=(e,t)=>{const r=new URLSearchParams;t&&r.set("campaignId",t);const i=r.toString(),l=i?`/entities/${e}/follow-status?${i}`:`/entities/${e}/follow-status`;return Rt.get(l)};function f4({entityId:e}){const{user:t}=En(),{selectedCampaignId:r}=Un(),[i,l]=u.useState(!1),[c,f]=u.useState(!1),[m,h]=u.useState(!0);u.useEffect(()=>{if(!e||!r||!t?.id){h(!1);return}(async()=>{try{h(!0);const g=await d4(e,r);l(g?.following??!1)}catch(g){console.error("Failed to check follow status",g),l(!1)}finally{h(!1)}})()},[e,r,t?.id]);const p=async()=>{if(!e||!r||c||m)return;const y=!i;f(!0);try{y?await c4(e,r):await fN(e,r),l(y)}catch(g){console.error("Failed to toggle follow",g),l(!y)}finally{f(!1)}};return r?m?a.jsx("button",{type:"button",className:"entity-follow-button",disabled:!0,title:"Checking follow status...",children:a.jsx(Td,{size:18})}):a.jsx("button",{type:"button",className:`entity-follow-button ${i?"following":""}`,onClick:p,disabled:c,title:i?"Unfollow entity":"Follow entity",children:i?a.jsx(Ry,{size:18}):a.jsx(Td,{size:18})}):null}function m4({entityId:e,name:t,canEdit:r,isEditing:i,onToggleEdit:l,onSave:c,isSaving:f=!1,isSaveDisabled:m=!1}){const h=t||"Untitled entity",p=()=>{typeof l=="function"&&l()},y=()=>{typeof c=="function"&&c()};return a.jsxs("div",{className:"entity-header flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 sm:gap-2",role:"banner",children:[a.jsx("div",{className:"entity-header-center",children:a.jsx("h1",{children:h})}),a.jsxs("div",{className:"entity-header-right",children:[e&&a.jsx(f4,{entityId:e}),r?a.jsxs("div",{className:"entity-header-actions",children:[i&&typeof c=="function"?a.jsx("button",{type:"button",className:"btn submit",onClick:y,disabled:m||f,children:f?"Saving":"Save"}):null,a.jsxs("button",{type:"button",className:`edit-mode-toggle ${i?"is-active":""}`,role:"switch","aria-checked":i,onClick:p,children:[a.jsx("span",{className:"edit-mode-toggle-track","aria-hidden":"true",children:a.jsx("span",{className:"edit-mode-toggle-thumb"})}),a.jsx("span",{className:"edit-mode-toggle-text",children:"Edit"})]})]}):null]})]})}const h4=[{value:"critical",label:"Critical",icon:Pa,color:"#dc2626"},{value:"important",label:"Important",icon:Ly,color:"#ea580c"},{value:"medium",label:"Medium",icon:w1,color:"#6b7280"},{value:null,label:"None",icon:Ia,color:"#9ca3af"}];function p4({entityId:e,importance:t,onUpdate:r}){const{selectedCampaignId:i}=Un(),[l,c]=u.useState(!1);if(!i)return null;const f=async m=>{if(!(l||m===t)){c(!0);try{await OR(e,m),r?.(m)}catch(h){console.error("Failed to update entity importance",h)}finally{c(!1)}}};return a.jsxs("div",{className:"entity-importance-selector",children:[a.jsx("span",{className:"entity-importance-label",children:"Importance:"}),a.jsx("div",{className:"entity-importance-buttons",children:h4.map(m=>{const h=m.icon,p=t===m.value;return a.jsxs("button",{type:"button",className:`entity-importance-button ${p?"selected":""}`,onClick:()=>f(m.value),disabled:l,title:m.label,style:p?{"--importance-color":m.color}:{},children:[a.jsx(h,{size:16}),a.jsx("span",{className:"entity-importance-button-label",children:m.label})]},m.value||"none")})})]})}var Kh={exports:{}},Wh,W0;function y4(){if(W0)return Wh;W0=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Wh=e,Wh}var Zh,Z0;function g4(){if(Z0)return Zh;Z0=1;var e=y4();function t(){}function r(){}return r.resetWarningCache=t,Zh=function(){function i(f,m,h,p,y,g){if(g!==e){var v=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw v.name="Invariant Violation",v}}i.isRequired=i;function l(){return i}var c={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:l,element:i,elementType:i,instanceOf:l,node:i,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:r,resetWarningCache:t};return c.PropTypes=c,c},Zh}var Q0;function b4(){return Q0||(Q0=1,Kh.exports=g4()()),Kh.exports}var v4=b4();const jt=Ri(v4);function mN({maxWidth:e=1280,className:t="",children:r}){const l={"--entity-page-max-width":typeof e=="number"?`${e}px`:e},c=["entity-page-layout",t].filter(Boolean).join(" ");return a.jsx("div",{className:c,style:l,children:a.jsx("div",{className:"entity-page-layout__inner",children:r})})}mN.propTypes={maxWidth:jt.oneOfType([jt.number,jt.string]),className:jt.string,children:jt.node};const x4=new Set(["image/png","image/jpeg","image/jpg"]),S4=2*1024*1024,w4=e=>Number.isFinite(e)?e>=1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:e>=1024?`${(e/1024).toFixed(1)} KB`:`${e} bytes`:"";function N4({entity:e,canEdit:t,isEditing:r,onEntityUpdate:i,variant:l="card"}){const[c,f]=u.useState(null),[m,h]=u.useState(""),[p,y]=u.useState(""),[g,v]=u.useState(!1),[S,w]=u.useState(!1),N=u.useRef(null),[E,C]=u.useState(null),A=!!e?.id,O=!!(e?.imageData&&e?.imageMimeType),_=u.useMemo(()=>$l(e),[e]),R=m||_,D=e?.name?`${e.name} artwork`:"Entity artwork",j=l==="compact",z=u.useCallback(()=>{f(null),h($=>($&&URL.revokeObjectURL($),"")),C(null),y(""),N.current&&(N.current.value="")},[]);u.useEffect(()=>()=>{m&&URL.revokeObjectURL(m)},[m]),u.useEffect(()=>{!r&&c&&z()},[r,c,z]);const P=()=>{!t||!r||g||S||N.current?.click()},X=$=>{const T=$.target.files?.[0];if(T){if(!x4.has(T.type)){y("Only PNG or JPG images are allowed."),$.target.value="";return}if(T.size>S4){y("Image must be smaller than 2 MB."),$.target.value="";return}y(""),f(T),C(null),h(U=>(U&&URL.revokeObjectURL(U),URL.createObjectURL(T)))}},H=u.useCallback($=>{$&&typeof i=="function"&&i($)},[i]),G=async()=>{if(!(!c||!A)){v(!0),y("");try{const $=E?await cN(c,E):c,T=await F1(e.id,$),U=Va(T);if(!U)throw new Error("Failed to upload image");H(U),z()}catch($){y($.message||"Failed to upload image")}finally{v(!1)}}},V=async()=>{if(A){w(!0),y("");try{const $=await B1(e.id),T=Va($);if(T)H(T);else{const U=K1({...e||{},imageData:null,imageMimeType:null,image_data:null,image_mime_type:null});H(U)}z()}catch($){y($.message||"Failed to delete image")}finally{w(!1)}}},k=u.useMemo(()=>{const $=["PNG or JPG up to 2 MB.","Uploads are resized to 256256 JPG (~70% quality, ~150 KB)."];return c&&$.push(`Selected: ${c.name} (${w4(c.size)})`),$.join(" ")},[c]),F=j?"div":"section",I=j?"entity-image-card entity-image-card--compact":"entity-card entity-image-card",L=u.useCallback($=>{C($)},[]);return u.useEffect(()=>{c||C(null)},[c]),a.jsxs(F,{className:I,children:[a.jsxs("div",{className:"entity-card-header",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"entity-card-title",children:"Image"}),a.jsx("p",{children:j?"Shown in the dossier summary.":"Displayed on the dossier tab."})]}),t&&r?a.jsxs("div",{className:"entity-card-actions",children:[O&&!c?a.jsx("button",{type:"button",className:"btn secondary",onClick:V,disabled:S,children:S?"Removing":a.jsxs("span",{className:"entity-image-action-label",children:[a.jsx(ha,{size:16,"aria-hidden":"true"})," Remove image"]})}):null,a.jsx("button",{type:"button",className:"btn secondary",onClick:P,disabled:g||S,children:a.jsxs("span",{className:"entity-image-action-label",children:[a.jsx(jM,{size:16,"aria-hidden":"true"})," Choose image"]})})]}):null]}),a.jsxs("div",{className:"entity-card-body",children:[a.jsxs("div",{className:`entity-image-preview ${R&&!c?"has-image":""}`.trim(),children:[c&&m?a.jsx(oN,{src:m,size:220,onCropChange:L}):R?a.jsx("img",{src:R,alt:D,loading:"lazy"}):a.jsxs("div",{className:"entity-image-placeholder",children:[a.jsx(TT,{size:32,"aria-hidden":"true"}),a.jsx("p",{children:"No image uploaded"})]}),c?a.jsx("button",{type:"button",className:"entity-image-preview-clear",onClick:z,disabled:g,"aria-label":"Clear selected image",children:a.jsx(Ia,{size:16,"aria-hidden":"true"})}):null]}),c&&t&&r?a.jsxs("div",{className:"entity-image-actions",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:G,disabled:g,children:g?"Uploading":"Save Image"}),a.jsx("button",{type:"button",className:"btn secondary",onClick:z,disabled:g,children:"Cancel"})]}):null,a.jsx("input",{type:"file",ref:N,accept:"image/png,image/jpeg",onChange:X,hidden:!0}),a.jsx("p",{className:"entity-image-helper",children:k}),p?a.jsx("p",{className:"entity-image-status entity-image-status--error",children:p}):null,!p&&g?a.jsx("p",{className:"entity-image-status",children:"Uploading image"}):null,!p&&S?a.jsx("p",{className:"entity-image-status",children:"Removing image"}):null]})]})}function hN({open:e,eyebrowLabel:t="Heads up",title:r="Unsaved changes",description:i="You have unsaved changes on this record.",destinationLabel:l="",saving:c=!1,onSaveAndContinue:f,onContinueWithoutSaving:m,onStay:h}){if(!e)return null;const p=l?` before continuing to ${l}`:"";return a.jsx("div",{className:"unsaved-dialog-backdrop",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"unsaved-dialog",role:"document",children:[a.jsxs("div",{className:"unsaved-dialog-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"unsaved-dialog-label",children:t}),a.jsx("h2",{children:r})]}),a.jsx("button",{type:"button",className:"icon-btn","aria-label":"Close dialog",onClick:h,children:a.jsx(Ia,{size:18})})]}),a.jsxs("div",{className:"unsaved-dialog-body",children:[a.jsxs("p",{children:[i,p,"."]}),a.jsx("p",{className:"unsaved-dialog-help",children:"Choose an option below to continue."})]}),a.jsxs("div",{className:"unsaved-dialog-actions",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:f,disabled:c,children:c?"Saving":"Save and continue"}),a.jsx("button",{type:"button",className:"btn ghost",onClick:m,disabled:c,children:"Continue without saving"}),a.jsx("button",{type:"button",className:"btn cancel",onClick:h,disabled:c,children:"Stay here"})]})]})})}const Qh=()=>({relationshipTypes:{mode:"all",values:[]},relatedEntityTypes:{mode:"all",values:[]}}),E4=e=>Rt.get(`/entity-relationships?worldId=${e}`),j4=e=>Rt.get(`/entity-relationships/${e}`),_4=e=>Rt.get(`/entity-relationships/entity/${e}`),pN=e=>Rt.post("/entity-relationships",e),C4=(e,t)=>Rt.patch(`/entity-relationships/${e}`,t),A4=e=>Rt.delete(`/entity-relationships/${e}`),T4=e=>e==null?"":String(e).trim(),pf=e=>{let t={};typeof e=="string"?t={worldId:e}:e&&typeof e=="object"&&!Array.isArray(e)&&(t={...e});const r=new URLSearchParams,i=T4(t.worldId??t.world_id);i&&r.set("worldId",i);const l=r.toString(),c=l?`?${l}`:"";return Rt.get(`/entity-relationship-types${c}`)},M4=e=>Rt.get(`/entity-relationship-types/${e}`),R4=e=>Rt.post("/entity-relationship-types",e),k4=(e,t)=>Rt.patch(`/entity-relationship-types/${e}`,t),D4=e=>Rt.delete(`/entity-relationship-types/${e}`);function I4({worldId:e,onCreated:t}){const[r,i]=u.useState(""),[l,c]=u.useState(""),[f,m]=u.useState(""),[h,p]=u.useState(!1),[y,g]=u.useState(""),[v,S]=u.useState([]);u.useEffect(()=>{let N=!1;return(async()=>{if(!e){S([]);return}try{const C=await Jr({worldId:e});if(!N){const A=Array.isArray(C?.data)?C.data:C;S(Array.isArray(A)?A:[])}}catch(C){N||(console.error(" Failed to load entity types",C),S([]))}})(),()=>{N=!0}},[e]);const w=async N=>{if(N.preventDefault(),!r||!l){g("Name and type are required.");return}try{p(!0),g("");const C=await Fy({world_id:e,name:r,description:f,entity_type_id:l,visibility:"visible"}),A=C?.data||C;t(A),i(""),c(""),m("")}catch(E){console.error(" Failed to create entity inline",E),g(E.message||"Failed to create entity")}finally{p(!1)}};return a.jsxs("form",{className:"inline-entity-creator",onSubmit:w,children:[a.jsx("h4",{children:"Create New Entity"}),y&&a.jsx("div",{className:"alert error",children:y}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Name"}),a.jsx("input",{type:"text",value:r,onChange:N=>i(N.target.value),placeholder:"Entity name..."})]}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Type"}),a.jsxs("select",{value:l,onChange:N=>c(N.target.value),children:[a.jsx("option",{value:"",children:"Select type..."}),v.map(N=>a.jsx("option",{value:N.id,children:N.name},N.id))]})]}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Description"}),a.jsx("textarea",{rows:"2",value:f,onChange:N=>m(N.target.value),placeholder:"Optional..."})]}),a.jsx("div",{className:"form-actions",children:a.jsx("button",{type:"submit",className:"btn primary",disabled:h||!e,children:h?"Creating":"Create Entity"})})]})}function yN({worldId:e,fromEntity:t=null,onCreated:r,onCancel:i,existingRelationships:l=[]}){const[c,f]=u.useState([]),[m,h]=u.useState(!0),[p,y]=u.useState(""),[g,v]=u.useState(null),[S,w]=u.useState(null),[N,E]=u.useState(""),[C,A]=u.useState(null),[O,_]=u.useState(!1);u.useEffect(()=>{e&&(h(!0),pf({worldId:e}).then(L=>{const $=Array.isArray(L?.data)?L.data:L?.data||[];f($||[])}).catch(L=>y(L.message||"Failed to load data")).finally(()=>h(!1)))},[e]),u.useEffect(()=>{if(!t||g||!t.id||!t.name)return;const L={id:t.id,name:t.name,entity_type_id:t.entity_type_id||t.entityType?.id||t.entity_type?.id,entityType:t.entityType||t.entity_type||null,typeName:t.typeName||t.entityType?.name||t.entity_type?.name};v(L)},[t]);const R=L=>{if(!L)return null;const $=L.entity_type_id||L.typeId||L.entityType?.id||L.entity_type?.id,T=L.typeName||L.entityType?.name||L.entity_type?.name;return{...L,entity_type_id:$,typeName:T}},D=L=>L?.name||L?.title||L?.displayName||"Unnamed entity",j=u.useMemo(()=>{const L=R(g),$=R(S);if(!L||!$)return[];const T=L.entity_type_id,U=$.entity_type_id;if(!T||!U)return[];const M=(q=[])=>q.map(Y=>Y.id||Y.entity_type_id||Y.entityTypeId||Y.type_id||Y.typeId||Y).map(String);return c.map(q=>{const Y=M(q.from_entity_types),J=M(q.to_entity_types),ie=Y.includes(String(T))&&J.includes(String(U)),Z=Y.includes(String(U))&&J.includes(String(T));return ie||Z?{...q,_supportsDirect:ie,_supportsReverse:Z}:null}).filter(Boolean)},[c,g,S]),z=u.useMemo(()=>j.find(L=>String(L.id)===String(N)),[N,j]),P=u.useMemo(()=>z?C==="reverse"&&z._supportsReverse?"reverse":C==="direct"&&z._supportsDirect||z._supportsDirect?"direct":z._supportsReverse?"reverse":null:null,[C,z]);u.useEffect(()=>{if(!z){C!==null&&A(null);return}if(P===null){C!==null&&A(null);return}if(C===null){A(P);return}C!==P&&A(P)},[z,P,C]),u.useEffect(()=>{if(!N)return;j.some($=>String($.id)===String(N))||(E(""),A(null))},[j,N]);const X=P==="direct"?g:S,H=P==="direct"?S:g,G=D(X),V=D(H),k=z?.from_name||z?.fromName||z?.name||"relates to",F=z?.to_name||z?.toName||z?.name||"relates to",I=async()=>{if(y(""),!g||!S||!N)return y("Please select both entities and a relationship type.");if(g.id===S.id)return y("Cannot create self-relationships.");if(l.find(M=>(M.from_entity_id===g.id&&M.to_entity_id===S.id||M.from_entity_id===S.id&&M.to_entity_id===g.id)&&M.relationship_type_id===N)){y("This relationship already exists.");return}const $=P;if(!z||!$){y("Please select a valid relationship type.");return}const T=$==="direct"?g.id:S.id,U=$==="direct"?S.id:g.id;try{await pN({from_entity_id:T,to_entity_id:U,relationship_type_id:N}),r?.({from_entity_id:T,to_entity_id:U,relationship_type_id:N,__direction:$})}catch(M){M.response?.status===409||M.response?.data?.message?.toLowerCase?.().includes("duplicate")||M.message?.toLowerCase?.().includes("duplicate")||M.message?.toLowerCase?.().includes("conflict")?y("This relationship already exists."):M.response?.data?.message?y(M.response.data.message):y("Failed to create relationship."),console.warn(" Relationship create error:",M)}};return m?a.jsx("p",{children:"Loading relationship data"}):a.jsxs("div",{className:"relationship-builder-v3",children:[a.jsx("h2",{children:"Add Relationship"}),p&&a.jsx("div",{className:"alert error",children:p}),a.jsx("div",{className:"form-row",children:a.jsx(oc,{worldId:e,label:"Entity 1",value:g?.id||"",onChange:L=>{t||(v(L),E(""),A(null))},disabled:!!t})}),a.jsxs("div",{className:"form-row entity2-section",children:[a.jsx(oc,{worldId:e,label:"Entity 2",value:S?.id||"",onChange:L=>w(L)}),!O&&a.jsx("button",{type:"button",className:"btn small tertiary",onClick:()=>_(!0),style:{alignSelf:"flex-start",marginTop:"0.4rem"},children:"+ Create new entity"}),O&&a.jsx(I4,{worldId:e,onCreated:async L=>{try{const $=await or(L.id),T=Va($)||L;w(T)}catch{w(L)}_(!1)}})]}),g&&S&&a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Relationship Type"}),a.jsxs("select",{value:N,onChange:L=>{const $=L.target.value;if(E($),!$){A(null);return}const T=j.find(U=>String(U.id)===String($));T?._supportsDirect?A("direct"):T?._supportsReverse?A("reverse"):A(null)},children:[a.jsx("option",{value:"",children:"Select relationship type"}),j.length>0?j.map(L=>a.jsxs("option",{value:L.id,children:[L.name," (",L.from_name,"  ",L.to_name,")"]},L.id)):a.jsx("option",{disabled:!0,children:"No valid relationship types"})]})]}),g&&S&&z&&P&&a.jsxs("div",{className:"relationship-preview",children:[a.jsxs("div",{className:"preview-header",children:[a.jsx("h3",{children:"Relationship preview"}),z._supportsDirect&&z._supportsReverse&&a.jsx("button",{type:"button",className:"btn small secondary",onClick:()=>A(L=>L==="reverse"?"direct":"reverse"),children:"Swap entities"})]}),a.jsxs("p",{children:[a.jsx("strong",{children:G})," ",k," ",a.jsx("strong",{children:V})]}),a.jsxs("p",{children:[a.jsx("strong",{children:V})," ",F," ",a.jsx("strong",{children:G})]})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{className:"btn primary",disabled:!g||!S||!N,onClick:I,children:"Create Relationship"}),a.jsx("button",{className:"btn secondary",onClick:i,children:"Cancel"})]})]})}const gN=["global","selective","hidden"],L4=[...gN,"owner_only"],J0=new Set(gN),eS=new Set(L4),Jh=(e,t)=>{if(typeof e!="string")return"global";const r=e.toLowerCase();return t.has(r)?r:"global"},Lo=e=>e?Array.isArray(e)?e.map(t=>t==null?"":String(t).trim()).filter(Boolean):typeof e=="string"?e.split(",").map(t=>t.trim()).filter(Boolean):[]:[],ep=()=>({campaigns:[],users:[],characters:[]});function O4(e,t,r){const i=e?.id,l=e?.world?.id||e?.world_id||"",c=u.useMemo(()=>e?{readMode:Jh(e.read_access||e.readAccess,J0),readCampaigns:Lo(e.read_campaign_ids||e.readCampaignIds),readUsers:Lo(e.read_user_ids||e.readUserIds),readCharacters:Lo(e.read_character_ids||e.readCharacterIds),writeMode:Jh(e.write_access||e.writeAccess,eS),writeCampaigns:Lo(e.write_campaign_ids||e.writeCampaignIds),writeUsers:Lo(e.write_user_ids||e.writeUserIds)}:{readMode:"global",readCampaigns:[],readUsers:[],readCharacters:[],writeMode:"global",writeCampaigns:[],writeUsers:[]},[e]),[f,m]=u.useState(c),[h,p]=u.useState(()=>ep()),[y,g]=u.useState(!1),[v,S]=u.useState(""),[w,N]=u.useState(!1),[E,C]=u.useState(""),[A,O]=u.useState("");u.useEffect(()=>{m(c)},[c]);const _=u.useCallback(async()=>{if(t){if(!l){p(ep()),S(""),g(!1);return}g(!0),S("");try{const P=await lN(l);p({campaigns:P.campaigns??[],users:P.users??[],characters:P.characters??[]})}catch(P){console.error(" Failed to load access options",P),p(ep()),S(P.message||"Failed to load access options")}finally{g(!1)}}},[t,l]);u.useEffect(()=>{_()},[_]);const R=u.useMemo(()=>{const P=["readMode","readCampaigns","readUsers","readCharacters","writeMode","writeCampaigns","writeUsers"],X=H=>Array.isArray(H)?H.map(G=>String(G).trim()).filter(Boolean).sort():[];return P.some(H=>{const G=f[H],V=c[H];if(Array.isArray(G)||Array.isArray(V)){const k=X(G),F=X(V);return k.length!==F.length?!0:k.some((I,L)=>I!==F[L])}return G!==V})},[f,c]),D=u.useCallback((P,X)=>{C(""),O(""),m(H=>{const G={...H};if(P==="readMode"||P==="writeMode"){const k=Jh(X,P==="readMode"?J0:eS);return G[P]=k,P==="readMode"&&k!=="selective"&&(G.readCampaigns=[],G.readUsers=[],G.readCharacters=[]),P==="writeMode"&&k!=="selective"&&(G.writeCampaigns=[],G.writeUsers=[]),G}return["readCampaigns","readUsers","readCharacters","writeCampaigns","writeUsers"].includes(P)?(G[P]=Array.isArray(X)?X.map(V=>String(V).trim()).filter(Boolean):[],G):(G[P]=X,G)})},[]),j=u.useCallback(()=>{m(c),C(""),O("")},[c]),z=u.useCallback(async()=>{if(!r||!i)return!1;if(!R)return!0;C(""),O(""),N(!0);try{const P={read_access:f.readMode,write_access:f.writeMode,read_campaign_ids:f.readMode==="selective"?f.readCampaigns:[],read_user_ids:f.readMode==="selective"?f.readUsers:[],read_character_ids:f.readMode==="selective"?f.readCharacters:[],write_campaign_ids:f.writeMode==="selective"?f.writeCampaigns:[],write_user_ids:f.writeMode==="selective"?f.writeUsers:[]},X=await By(i,P);if(!(X?.data||X))throw new Error("Failed to save access settings");return O("Access settings saved."),!0}catch(P){return console.error(" Failed to save access settings",P),C(P.message||"Failed to save access settings"),!1}finally{N(!1)}},[r,i,f,R]);return{accessSettings:f,accessOptions:h,accessOptionsError:v,accessOptionsLoading:y,accessSaving:w,accessSaveError:E,accessSaveSuccess:A,isAccessDirty:R,handleAccessSettingChange:D,resetAccessSettings:j,handleAccessSave:z}}function z4(e){const t=u.useMemo(()=>typeof e=="function"?e:()=>!1,[e]);return i1(t)||Si}function $4({isEditing:e,canEdit:t,formError:r,formRef:i,editSchema:l,editInitialData:c,handleUpdate:f,handleFormStateChange:m,dossierSchema:h,viewData:p,featuredImageSrc:y,renderSchemaSections:g,imageSection:v,fieldRules:S,viewRuleContext:w}){const N=Array.isArray(h?.sections)?h.sections:[],E=N[0]||null,C=N[1]||null,A=N.slice(2),O=w?.actionsByField??{},_=w?.showRuleTargets??new Set,R=(X,H)=>{if(!X)return null;const G=Number.isFinite(X.columns)?Math.max(1,Number(X.columns)):1,V=Array.isArray(X.fields)?X.fields:[];return V.length?a.jsx("div",{className:`entity-field-grid ${G>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":""}`,style:{"--entity-field-columns":G},children:V.map((k,F)=>{const I=k?.key||k?.name||k?.field||`${H}-${F}`,L=O[I],$=k.visibleByDefault!==void 0?!!k.visibleByDefault:k.visible_by_default!==void 0?!!k.visible_by_default:!0;return cc(I,L,_,$)?null:a.jsx(ff,{field:{...k},data:p,mode:"view"},`${H}-${I}`)})}):a.jsx("p",{className:"entity-empty-state",children:"No fields available."})},D=!!y&&!e,j=p?.name||"Entity",z=!!v&&e&&t,P=()=>{if(!D)return g(h,p,"dossier",w);const X={...h||{},sections:A};return a.jsxs(a.Fragment,{children:[a.jsx("section",{className:"entity-card entity-dossier-header-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:a.jsxs("div",{className:"entity-dossier-header",children:[a.jsxs("div",{className:"entity-dossier-header-content",children:[E?.title?a.jsx("h2",{className:"entity-card-title",children:E.title}):null,R(E,"dossier-summary"),C?a.jsx("div",{className:"entity-dossier-description",children:R(C,"dossier-description")}):null]}),a.jsx("div",{className:"entity-dossier-header-image sm:ml-6 sm:w-64 w-full mt-4 sm:mt-0",children:a.jsx("img",{src:y,alt:`${j} artwork`,loading:"lazy"})})]})}),g(X,p,"dossier",w)]})};return a.jsxs("div",{className:"entity-tab-content",children:[r&&a.jsx("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:a.jsx("div",{className:"alert error",role:"alert",children:r})}),e&&t?a.jsx("section",{className:"entity-card entity-card--form entity-edit-form-wrapper bg-white rounded-lg border p-4 sm:p-6 w-full",children:a.jsxs("div",{className:"entity-edit-form-container",children:[a.jsx("div",{className:"entity-edit-form-content",children:a.jsx(gs,{ref:i,schema:l,initialData:c||{},onSubmit:f,onStateChange:m,hideActions:!0,enableUnsavedPrompt:!1,fieldRules:S})}),z?a.jsx("div",{className:"entity-edit-form-image sm:ml-6 sm:w-64 w-full mt-4 sm:mt-0",children:v}):null]})}):P()]})}function F4({entity:e,toast:t,onExplore:r,canEdit:i,relationshipsLoading:l,relationshipsError:c,filteredRelationships:f,sortedRelationships:m,relationshipsEmptyMessage:h,relationshipFilters:p,relationshipFilterOptions:y,filterButtonDisabled:g,handleRelationshipFiltersChange:v,handleRelationshipFiltersReset:S,showRelationshipForm:w,setShowRelationshipForm:N,worldId:E,loadRelationships:C}){const[A,O]=u.useState(!1),_=w!==void 0?w:A,[R,D]=u.useState(!1),j=u.useRef(null);u.useEffect(()=>{if(!R)return;const L=T=>{j.current&&(j.current.contains(T.target)||D(!1))},$=T=>{T.key==="Escape"&&D(!1)};return document.addEventListener("mousedown",L),document.addEventListener("touchstart",L),document.addEventListener("keydown",$),()=>{document.removeEventListener("mousedown",L),document.removeEventListener("touchstart",L),document.removeEventListener("keydown",$)}},[R]);const z=Array.isArray(y?.relationshipTypes)?y.relationshipTypes:[],P=Array.isArray(y?.relatedEntityTypes)?y.relatedEntityTypes:[],X=p?.relationshipTypes?.values||[],H=p?.relatedEntityTypes?.values||[],G=L=>{const $=Array.from(L.target.selectedOptions,T=>T.value);v&&v({relationshipTypes:{mode:$.length>0?"include":"all",values:$},relatedEntityTypes:p?.relatedEntityTypes||{mode:"all",values:[]}})},V=L=>{const $=Array.from(L.target.selectedOptions,T=>T.value);v&&v({relationshipTypes:p?.relationshipTypes||{mode:"all",values:[]},relatedEntityTypes:{mode:$.length>0?"include":"all",values:$}})},k=()=>{S&&S(),D(!1)},F=()=>{D(!1)},I=X.length>0||H.length>0;return a.jsxs(a.Fragment,{children:[t&&a.jsxs("div",{className:`toast-banner ${t.tone}`,role:"status",children:[a.jsx("span",{children:t.message}),t.link?a.jsx(Qt,{to:t.link.to,className:"toast-banner-link",children:t.link.label}):null]}),a.jsxs("div",{className:"bg-white border border-neutral-200 rounded-xl shadow-sm p-6 mb-6 w-full",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Relationships"}),a.jsxs("div",{className:"flex items-center gap-2",children:[typeof r=="function"?a.jsx("button",{type:"button",className:"btn-secondary",onClick:r,children:"Explore"}):null,a.jsxs("div",{className:"relative",ref:j,children:[a.jsx("button",{id:"filterButton",type:"button",className:`btn-secondary${I?" is-active":""}`,onClick:()=>D(L=>!L),disabled:g,children:"Filter"}),R&&!g?a.jsxs("div",{className:"bg-white border border-neutral-200 rounded-lg shadow-lg p-4 w-[260px] absolute top-full mt-2 right-0 z-10",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"text-sm font-medium text-neutral-700 mb-1 block",children:"Relationship Types"}),a.jsx("select",{className:"w-full border border-neutral-300 rounded-md px-3 py-1 text-sm",multiple:!0,size:5,value:X,onChange:G,children:z.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"text-sm font-medium text-neutral-700 mb-1 block",children:"Related Entity Types"}),a.jsx("select",{className:"w-full border border-neutral-300 rounded-md px-3 py-1 text-sm",multiple:!0,size:5,value:H,onChange:V,children:P.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))})]}),a.jsxs("div",{className:"flex items-center justify-between mt-2",children:[a.jsx("button",{type:"button",className:"text-sm text-neutral-600 hover:text-neutral-900",onClick:k,children:"Clear filters"}),a.jsx("button",{type:"button",className:"btn-secondary text-sm",onClick:F,children:"Done"})]})]}):null]}),i&&a.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{N&&N(!0),w===void 0&&O(!0)},children:"Add relationship"})]})]}),l?a.jsx("p",{children:"Loading relationships..."}):c?a.jsx("div",{className:"alert error",role:"alert",children:c}):m.length===0?a.jsx("p",{className:"text-sm text-neutral-500",children:h}):f.length===0?a.jsx("p",{className:"text-sm text-neutral-500",children:"No relationships match your filters."}):a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-left text-neutral-600 border-b border-neutral-200",children:[a.jsx("th",{className:"py-2 font-medium",children:"Relationship"}),a.jsx("th",{className:"py-2 font-medium",children:"Type"}),a.jsx("th",{className:"py-2 font-medium",children:"Direction"})]})}),a.jsx("tbody",{children:f.map(L=>{const $=String(L.fromId)===String(e.id),T=$?L.toName:L.fromName,U=$?L.toId:L.fromId,M=L.sourceLabel||L.source_relationship_label||"",q=L.targetLabel||L.target_relationship_label||"";return a.jsxs("tr",{className:"border-b border-neutral-100 last:border-0",children:[a.jsxs("td",{className:"py-3",children:[a.jsx("strong",{children:e.name})," ",$?M:q," ",a.jsx(Qt,{to:`/entities/${U}`,className:"text-blue-600 hover:underline",children:T||""}),U?a.jsx(Ls,{entityId:U,entityName:T}):null]}),a.jsx("td",{className:"py-3",children:L.typeName||""}),a.jsx("td",{className:"py-3",children:$?"Outgoing":"Incoming"})]},L.id)})})]})]}),E&&e?a.jsx(Xr,{isOpen:_,onClose:()=>{N?N(!1):O(!1)},title:"Add relationship",description:"Link this entity to others without leaving the page.",size:"md",children:a.jsx(yN,{worldId:E,fromEntity:e,onCreated:()=>{N?N(!1):O(!1),C&&C()},onCancel:()=>{N?N(!1):O(!1)}})}):null]})}function B4({canEdit:e,worldId:t,accessSettings:r,accessOptions:i,accessOptionsError:l,accessOptionsLoading:c,accessSaving:f,accessSaveError:m,accessSaveSuccess:h,handleAccessSettingChange:p}){return a.jsx("div",{className:"entity-tab-content",children:a.jsxs("section",{className:"entity-card entity-access-card",children:[a.jsx("h2",{className:"entity-card-title",children:"Access controls"}),a.jsx("p",{className:"entity-access-note help-text",children:"Configure who can view and edit this entity. Users with write access will automatically receive read access. Changes are saved along with the rest of the record."}),l&&a.jsx("div",{className:"alert error",role:"alert",children:l}),t?a.jsxs(a.Fragment,{children:[a.jsx(iN,{canEdit:e,accessSettings:r,accessOptions:i,accessOptionsLoading:c,accessSaving:f,onSettingChange:p}),a.jsxs("div",{className:"entity-access-actions",children:[m&&a.jsx("div",{className:"alert error",role:"alert",children:m}),h&&a.jsx("div",{className:"alert success",role:"status",children:h})]})]}):a.jsx("p",{className:"entity-empty-state",children:"Assign this entity to a world to configure access settings."})]})})}function U4({renderSchemaSections:e,systemSchema:t,viewData:r}){return a.jsx("div",{className:"entity-tab-content",children:e(t,r,"system")})}const tS=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})},Vu=e=>{if(!e)return"";const t=e.username?.trim?.()||"",r=e.email?.trim?.()||"";return t&&r&&t!==r?`${t} (${r})`:t||r||"Unknown user"},q4=e=>Array.isArray(e)?e.filter(t=>t&&typeof t=="object").map(t=>({...t})):[],tp=(e,t)=>{const r=new Set,i=[];return e.forEach(l=>{if(!l)return;let c=l[t];if(c||(t==="user_id"?c=l.user?.id:t==="campaign_id"&&(c=l.campaign?.id)),!c)return;const f=String(c);r.has(f)||(r.add(f),i.push(l))}),i},nS=(e,t)=>{if(!e)return[];const r=Array.isArray(e.permissions)?e.permissions:[],i=new Set,l=[];return r.forEach(c=>{if(!c)return;let f=c[t];if(f||(t==="user_id"?f=c.user?.id:t==="campaign_id"&&(f=c.campaign?.id)),!f)return;const m=String(f);i.has(m)||(i.add(m),l.push(m))}),l};function H4({entity:e,secrets:t,worldId:r,canManageSecrets:i,onSecretCreated:l,onSecretUpdated:c}){const[f,m]=u.useState(""),[h,p]=u.useState(""),[y,g]=u.useState([]),[v,S]=u.useState([]),[w,N]=u.useState({campaigns:[],users:[]}),[E,C]=u.useState(!1),[A,O]=u.useState(""),[_,R]=u.useState(!1),[D,j]=u.useState(!1),[z,P]=u.useState(""),[X,H]=u.useState(""),[G,V]=u.useState(!1),[k,F]=u.useState(null),I=u.useMemo(()=>!!k?.id,[k?.id]),L=u.useMemo(()=>`entity-secret-create-${e?.id||"new"}`,[e?.id]),$=u.useMemo(()=>q4(t),[t]),T=u.useCallback(()=>{m(""),p(""),g([]),S([])},[]),U=u.useCallback(()=>{D||(F(null),T(),P(""),H(""),V(!0))},[T,D]),M=u.useCallback(ne=>{if(!i||D||!ne)return;const we=ne.title??"",Ie=ne.content??"";m(we?String(we):""),p(Ie?String(Ie):""),g(nS(ne,"campaign_id")),S(nS(ne,"user_id")),N(Me=>{const Ae=Array.isArray(Me?.campaigns)?[...Me.campaigns]:[],it=Array.isArray(Me?.users)?[...Me.users]:[],$e=(Le,wt,Tt)=>{if(!wt)return;const Ct=String(wt);Le.some(At=>At?.value===Ct)||Le.push({value:Ct,label:Tt})};return(Array.isArray(ne.permissions)?ne.permissions:[]).forEach(Le=>{if(!Le)return;const wt=Le.user_id??Le.user?.id;if(wt){const Ct=Le.user?Vu(Le.user):`User ${String(wt).slice(0,8)}`;$e(it,wt,Ct)}const Tt=Le.campaign_id??Le.campaign?.id;if(Tt){const Ct=Le.campaign?.name?Le.campaign.name:`Campaign ${String(Tt).slice(0,8)}`;$e(Ae,Tt,Ct)}}),{campaigns:Ae,users:it}}),F(ne),P(""),H(""),V(!0)},[i,D]),q=u.useCallback(()=>{D||(V(!1),P(""),F(null),T())},[T,D]),Y=u.useCallback(async()=>{if(!i||!r){N({campaigns:[],users:[]}),O(""),C(!1),R(!0);return}C(!0),O("");try{const[ne,we]=await Promise.all([jc({world_id:r}),Is({world_id:r})]),Me=(Array.isArray(ne?.data)?ne.data:Array.isArray(ne)?ne:[]).map(nt=>({value:String(nt.id),label:nt.name||"Untitled campaign"})),Ae=Array.isArray(we?.data)?we.data:Array.isArray(we)?we:[],it=[];Ae.forEach(nt=>{const Le=nt?.player||{},wt=Le.id||nt?.user_id;wt&&it.push({value:String(wt),label:Vu(Le)})});const $e=tp(it,"value");N({campaigns:Me,users:$e}),R(!0)}catch(ne){console.error(" Failed to load secret visibility options",ne),N({campaigns:[],users:[]}),O(ne.message||"Failed to load share options"),R(!0)}finally{C(!1)}},[i,r]);u.useEffect(()=>{R(!1),N({campaigns:[],users:[]}),O("")},[r,i]),u.useEffect(()=>{!G||_||Y()},[G,_,Y]);const J=async ne=>{if(ne.preventDefault(),!e?.id||D)return;const we=h.trim();if(!we){P("Description is required."),H("");return}j(!0),P(""),H("");try{const Ie={summary:f.trim()||void 0,description:we,campaign_ids:y,user_ids:v};let Me;I&&k?.id?Me=await FR(e.id,k.id,Ie):Me=await $R(e.id,Ie);const Ae=Me?.data||Me;I&&k?.id?(c?.(Ae),H("Secret updated successfully.")):(l?.(Ae),H("Secret created successfully.")),T(),F(null),V(!1)}catch(Ie){P(Ie.message||"Failed to save secret")}finally{j(!1)}},ie=ne=>{if(!i||!Array.isArray(ne?.permissions))return null;const we=ne.permissions.map(Ae=>({...Ae})).filter(Ae=>Ae);if(we.length===0)return a.jsx("p",{className:"entity-secret-shared",children:"Not shared with any campaigns or users."});const Ie=tp(we.filter(Ae=>Ae.user_id||Ae.user),"user_id"),Me=tp(we.filter(Ae=>Ae.campaign_id||Ae.campaign),"campaign_id");return a.jsxs("div",{className:"entity-secret-shared",children:[Ie.length>0&&a.jsxs("div",{children:[a.jsx("strong",{children:"Shared with players:"}),a.jsx("ul",{className:"entity-secret-share-list",children:Ie.map(Ae=>{const it=Ae.user?Vu(Ae.user):`User ${String(Ae.user_id).slice(0,8)}`,$e=Ae.user_id||it;return a.jsx("li",{className:"entity-secret-share-pill",children:it},$e)})})]}),Me.length>0&&a.jsxs("div",{children:[a.jsx("strong",{children:"Shared with campaigns:"}),a.jsx("ul",{className:"entity-secret-share-list",children:Me.map(Ae=>{const it=Ae.campaign?.name||`Campaign ${String(Ae.campaign_id).slice(0,8)}`,$e=Ae.campaign_id||it;return a.jsx("li",{className:"entity-secret-share-pill",children:it},$e)})})]})]})},Z=I?"Edit secret":"Create a secret",fe=I?"Update the secret content or who can access it.":"Secrets are hidden notes that are only visible to selected campaigns or players.",Q=I?"Update secret":"Save secret",se=I?"Updating secret...":"Creating secret...";return a.jsxs("div",{className:"entity-tab-content",children:[i&&a.jsx(Xr,{isOpen:G,onClose:q,title:Z,description:fe,size:"lg",footerActions:a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{type:"button",className:"border border-neutral-300 bg-white px-4 py-2 rounded-md text-sm hover:bg-neutral-100 text-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",onClick:q,disabled:D,children:"Cancel"}),a.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-md text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",form:L,disabled:D,children:D?se:Q})]}),children:a.jsxs("form",{id:L,className:"entity-secret-form-body",onSubmit:J,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-secret-summary",className:"text-sm font-medium text-neutral-700",children:"Summary"}),a.jsx("input",{id:"entity-secret-summary",type:"text",value:f,onChange:ne=>m(ne.target.value),placeholder:"Short label for this secret (optional)",disabled:D,"data-autofocus":"true",className:"w-full border rounded-md px-3 py-2 text-sm"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-secret-description",className:"text-sm font-medium text-neutral-700",children:"Description"}),a.jsx("textarea",{id:"entity-secret-description",value:h,onChange:ne=>p(ne.target.value),rows:4,placeholder:"Detail the secret information...",disabled:D,required:!0,className:"w-full border rounded-md px-3 py-2 text-sm min-h-[120px]"})]}),a.jsxs("div",{className:"entity-secret-share-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-secret-campaigns",className:"text-sm font-medium text-neutral-700",children:"Share with campaigns"}),a.jsx(Rs,{inputId:"entity-secret-campaigns",selected:y,options:w.campaigns,onChange:g,placeholder:"Select campaigns...",disabled:D||E,loading:E,noOptionsMessage:E?"Loading campaigns...":"No campaigns available in this world."}),a.jsx("p",{className:"help-text",children:"Dungeon Masters of selected campaigns will be able to read this secret."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-secret-users",className:"text-sm font-medium text-neutral-700",children:"Share with players"}),a.jsx(Rs,{inputId:"entity-secret-users",selected:v,options:w.users,onChange:S,placeholder:"Select users...",disabled:D||E,loading:E,noOptionsMessage:E?"Loading users...":"No eligible players found for this world."}),a.jsx("p",{className:"help-text",children:"Choose specific players who should see this information."})]})]}),A&&a.jsx("div",{className:"alert error",role:"alert",children:A}),z&&a.jsx("div",{className:"alert error",role:"alert",children:z})]})}),a.jsxs("section",{className:"entity-card entity-secret-list-card",children:[a.jsxs("div",{className:"entity-card-header entity-card-header--subtle",children:[a.jsxs("h2",{className:"entity-card-title",children:["Secrets for ",e?.name||"this entity"]}),i&&a.jsx("div",{className:"entity-card-actions",children:a.jsx("button",{type:"button",className:"btn submit",onClick:U,disabled:D,children:"New secret"})})]}),X&&a.jsx("div",{className:"alert success",role:"status",children:X}),$.length===0?a.jsx("p",{className:"entity-empty-state",children:"No secrets available for this entity yet."}):a.jsx("ul",{className:"entity-secret-list",children:$.map(ne=>{const we=ne.createdAt||ne.created_at,Ie=ne.updatedAt||ne.updated_at,Me=Vu(ne.creator);return a.jsxs("li",{className:"entity-secret-item",children:[a.jsxs("div",{className:"entity-secret-header",children:[a.jsx("h3",{children:ne.title||"Untitled secret"}),a.jsxs("div",{className:"entity-secret-meta",children:[Me&&a.jsxs("span",{children:["Created by ",Me]}),we&&a.jsxs("span",{children:["Created ",tS(we)]}),Ie&&Ie!==we&&a.jsxs("span",{children:["Updated ",tS(Ie)]})]})]}),i&&a.jsx("div",{className:"entity-secret-actions",children:a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>M(ne),disabled:D,children:"Edit secret"})}),ne.content?a.jsx("p",{className:"entity-secret-content",children:ne.content}):null,ie(ne)]},ne.id||ne.createdAt)})})]})]})}function P4(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function V4(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function Y4(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function kd(e){return P4(e)||V4(e)||Y4()}function os(){return os=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},os.apply(this,arguments)}function G4(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function X4(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function K4(e,t,r){return t&&X4(e.prototype,t),e}function un(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Kp(e,t){return Kp=Object.setPrototypeOf||function(i,l){return i.__proto__=l,i},Kp(e,t)}function W4(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kp(e,t)}function El(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?El=function(r){return typeof r}:El=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},El(e)}function gd(e){return typeof Symbol=="function"&&El(Symbol.iterator)==="symbol"?gd=function(r){return El(r)}:gd=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":El(r)},gd(e)}function Z4(e,t){return t&&(gd(t)==="object"||typeof t=="function")?t:un(e)}function Dd(e){return Dd=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},Dd(e)}function on(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var np,aS;function Q4(){if(aS)return np;aS=1;var e=function(t,r,i,l,c,f,m,h){if(!t){var p;if(r===void 0)p=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var y=[i,l,c,f,m,h],g=0;p=new Error(r.replace(/%s/g,function(){return y[g++]})),p.name="Invariant Violation"}throw p.framesToPop=1,p}};return np=e,np}var J4=Q4();const Al=Ri(J4);function eD(e){if(Array.isArray(e))return e}function tD(e,t){var r=[],i=!0,l=!1,c=void 0;try{for(var f=e[Symbol.iterator](),m;!(i=(m=f.next()).done)&&(r.push(m.value),!(t&&r.length===t));i=!0);}catch(h){l=!0,c=h}finally{try{!i&&f.return!=null&&f.return()}finally{if(l)throw c}}return r}function nD(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function Id(e,t){return eD(e)||tD(e,t)||nD()}function aD(e,t){if(e==null)return{};var r={},i=Object.keys(e),l,c;for(c=0;c<i.length;c++)l=i[c],!(t.indexOf(l)>=0)&&(r[l]=e[l]);return r}function sD(e,t){if(e==null)return{};var r=aD(e,t),i,l;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(l=0;l<c.length;l++)i=c[l],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}var ap,sS;function rD(){if(sS)return ap;sS=1;function e(t,r,i){return r in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}return ap=e,ap}var iD=rD();const dc=Ri(iD);var sp,rS;function lD(){if(rS)return sp;rS=1;function e(t){if(Array.isArray(t)){for(var r=0,i=new Array(t.length);r<t.length;r++)i[r]=t[r];return i}}return sp=e,sp}var rp,iS;function oD(){if(iS)return rp;iS=1;function e(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}return rp=e,rp}var ip,lS;function cD(){if(lS)return ip;lS=1;function e(){throw new TypeError("Invalid attempt to spread non-iterable instance")}return ip=e,ip}var lp,oS;function uD(){if(oS)return lp;oS=1;var e=lD(),t=oD(),r=cD();function i(l){return e(l)||t(l)||r()}return lp=i,lp}var dD=uD();const sr=Ri(dD);var Fl=function(t){return t===Object(t)?Object.keys(t):[]},bN=function(t){return t===Object(t)?Object.values(t):[]};function vN(e,t){var r=Object.assign({},e);return bd(e)&&bd(t)&&Fl(t).forEach(function(i){bd(t[i])?i in e?r[i]=vN(e[i],t[i]):Object.assign(r,dc({},i,t[i])):Object.assign(r,dc({},i,t[i]))}),r}var Wp=function(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),l=1;l<r;l++)i[l-1]=arguments[l];return i.reduce(function(c,f){return vN(c,f)},t)},fD=function(t,r){var i=Object.assign({},t);if(r)for(var l=0;l<r.length;l++)delete i[r[l]];return i},bd=function(t){return t===Object(t)&&!(t instanceof Date)&&!Array.isArray(t)},mD=function(t){return(t||[]).filter(Boolean)},Jy=function(t){return t[0]==="&"},hD=function(t){return!Jy(t)},cS=function(t){return t.replace(/-(\w)/g,function(r,i){return i.toUpperCase()})},pD=function(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=Fl(t),l={},c=0,f=i.length;c<f;c+=1){var m=i[c],h=Object.prototype.toString.call(t[m])!=="[object Object]"||m[0]===":"||m[0]==="@"||r.indexOf(m)>=0;h&&(l[m]=t[m])}return l},xN=function(t,r){for(var i=r.map(cS),l=Fl(t),c={},f=0,m=l.length;f<m;f+=1){var h=l[f];(r.indexOf(h)>=0||i.indexOf(cS(h))>=0)&&(c[h]=t[h])}return c},yD=function e(t,r){for(var i=Wp.apply(void 0,[{},fD(t,r)].concat(sr(bN(xN(t,r))))),l=Fl(i).filter(Jy),c=0,f=l.length;c<f;c+=1){var m=l[c],h=e(i[m],r);r.indexOf(m)>=0?(delete i[m],i=Wp({},i,h)):i[m]=h}return i};function uS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function dS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uS(Object(r),!0).forEach(function(i){dc(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var gD=["animationName"],SN=function(t){var r=t.style,i=t.className;return dS(dS({},r?{style:pD(r,gD)}:{}),i?{className:i}:{})},wN=u.createContext(SN);wN.Provider;var NN=function(t){if(t){if(typeof t=="string")return[t];if(!Array.isArray(t)){var r=t;return Fl(t).reduce(function(i,l){return i.concat(r[l]?[l]:[])},[])}}else return[];return t},bD={},vD=function(t){return function(r,i){var l=i||bD;t.memoize=t.memoize||new WeakMap;var c;t.memoize.has(l)?c=t.memoize.get(l):(c={},t.memoize.set(l,c));var f=NN(r).join(" ");return f in c?c[f]:c[f]=t(r||[],i)}};function fS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function pl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fS(Object(r),!0).forEach(function(i){dc(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var xD=function(t){var r=t&&Fl(t)[0];return r&&r.split("__")[0].split("--")[0]},SD=function(t,r,i){if(t){var l=t.split(" ")[0],c=[].concat(sr(r.length===0?i.map(function(f){return"".concat(l,"--").concat(f.substring(1))}):[]),sr(r.map(function(f){return"".concat(l,"__").concat(f)})));return r.length===0?[t].concat(sr(c)):c}};function EN(e){var t=e.style,r=e.className,i=e.classNames,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:SN,c=r||xD(i)||t?.className,f=typeof t=="function"?t:vD(function(g,v){var S=NN(g);Al(Array.isArray(S),"First parameter must be a string, an array of strings, a plain object with boolean values, or a falsy value."),Al(!v||bd(v),"Optional second parameter must be a plain object.");var w=S.filter(Jy),N=S.filter(hD),E=N.length>0?function(O){return bN(xN(O,N))}:function(O){return[O]},C=function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return E(yD(_,w))},A=SD(c,N,w);return EN(pl(pl(pl({},(t||v)&&{style:Wp.apply(void 0,[{}].concat(sr(C(v)),sr(C(t))))}),A&&{className:A.join(" ")}),i&&{classNames:i}),l)}),m=pl({},typeof t=="function"?t:{style:t}),h=sr(new Set([].concat(sr(m.className?m.className.split(" "):[]),sr(c?c.split(" "):[])))),p=i?mD(h.map(function(g){return i[g]})):h,y=l(pl(pl({},m),p.length>0?{className:p.join(" ")}:{}));return Object.assign(f,y),f}function mS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function Oo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mS(Object(r),!0).forEach(function(i){dc(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var wD=function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return r.reduce(function(l,c){return Oo(Oo(Oo({},l),typeof c=="function"?c:{}),{},{style:Oo(Oo({},l.style),typeof c=="function"?c.style:c)})},{})},eg=function(t,r,i){var l=r.style,c=r.className,f=r.classNames,m=u.useContext(wN),h=u.useMemo(function(){return EN({style:l,className:c,classNames:f},m)},[l,c,f,m]);return h(i,t)},vd=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},Ms={id:"__id__",display:"__display__"},hS=function(t,r){Al(r==="id"||r==="display",'Second arg must be either "id" or "display", got: "'.concat(r,'"'));var i=t.indexOf(Ms.display),l=t.indexOf(Ms.id);return i<0&&(i=null),l<0&&(l=null),Al(i!==null||l!==null,"The markup '".concat(t,"' does not contain either of the placeholders '__id__' or '__display__'")),i!==null&&l!==null?r==="id"&&l<=i||r==="display"&&i<=l?0:1:0},ND=function(t){var r=/^\/(.+)\/(\w+)?$/;return new RegExp(t.map(function(i){var l=r.exec(i.toString()),c=Id(l,3),f=c[1],m=c[2];return Al(!m,"RegExp flags are not supported. Change /".concat(f,"/").concat(m," into /").concat(f,"/")),"(".concat(f,")")}).join("|"),"g")},jN=function(t){var r=0;return t.indexOf("__id__")>=0&&r++,t.indexOf("__display__")>=0&&r++,r},ED=function(){},_c=function(t,r,i){for(var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:ED,c=ND(r.map(function(R){return R.regex})),f=2,m=r.map(function(R){var D=R.markup,j=f;return f+=jN(D)+1,j}),h,p=0,y=0;(h=c.exec(t))!==null;){var g=m.find(function(R){return!!h[R]}),v=m.indexOf(g),S=r[v],w=S.markup,N=S.displayTransform,E=g+hS(w,"id"),C=g+hS(w,"display"),A=h[E],O=N(A,h[C]),_=t.substring(p,h.index);l(_,p,y),y+=_.length,i(h[0],h.index,y,A,O,v,p),y+=O.length,p=c.lastIndex}p<t.length&&l(t.substring(p),p,y)},wi=function(t,r){var i="";return _c(t,r,function(l,c,f,m,h){i+=h},function(l){i+=l}),i},Na=function(t,r,i){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"START";if(typeof i!="number")return i;var c,f=function(p,y,g){c===void 0&&g+p.length>=i&&(c=y+i-g)},m=function(p,y,g,v,S,w,N){c===void 0&&g+S.length>i&&(l==="NULL"?c=null:c=y+(l==="END"?p.length:0))};return _c(t,r,m,f),c===void 0?t.length:c},tc=function(t,r,i,l){return t.substring(0,r)+l+t.substring(i)},jD=function(t,r,i,l){var c=i.selectionStartBefore,f=i.selectionEndBefore,m=i.selectionEndAfter,h=wi(t,l),p=h.length-r.length;c==="undefined"&&(c=m+p),f==="undefined"&&(f=c),c===f&&f===m&&h.length===r.length&&(c=c-1);var y=r.slice(c,m),g=Math.min(c,m),v=f;c===m&&(v=Math.max(f,c+p));var S=Na(t,l,g,"START"),w=Na(t,l,v,"END"),N=Na(t,l,g,"NULL"),E=Na(t,l,v,"NULL"),C=N===null||E===null,A=tc(t,S,w,y);if(!C){var O=wi(A,l);if(O!==r){for(g=0;r[g]===O[g];)g++;y=r.slice(g,m),v=h.lastIndexOf(r.substring(m)),S=Na(t,l,g,"START"),w=Na(t,l,v,"END"),A=tc(t,S,w,y)}}return A},pS=function(t,r,i){var l=i,c=!1,f=function(h,p,y,g,v,S,w){y<=i&&y+v.length>i&&(l=y,c=!0)};if(_c(t,r,f),c)return l},Ko=function(t,r){var i=[];return _c(t,r,function(l,c,f,m,h,p,y){i.push({id:m,display:h,childIndex:p,index:c,plainTextIndex:f})}),i},_N=function(t,r){return"".concat(t,"-").concat(r)},Yu=function(t){return Object.values(t).reduce(function(r,i){var l=i.results;return r+l.length},0)},_D=function(t,r){var i=Ko(t,r),l=i[i.length-1];return l?l.plainTextIndex+l.display.length:0},CD=function(t){var r=vd(t),i=t[t.indexOf(Ms.display)+Ms.display.length],l=t[t.indexOf(Ms.id)+Ms.id.length];return new RegExp(r.replace(Ms.display,"([^".concat(vd(i||""),"]+?)")).replace(Ms.id,"([^".concat(vd(l||""),"]+?)")))},$r=function(t){return u.Children.toArray(t).map(function(r){var i=r.props,l=i.markup,c=i.regex,f=i.displayTransform;return{markup:l,regex:c?AD(c,l):CD(l),displayTransform:f||function(m,h){return h||m}}})},AD=function(t,r){var i=new RegExp(t.toString()+"|").exec("").length-1,l=jN(r);return Al(i===l,"Number of capturing groups in RegExp ".concat(t.toString()," (").concat(i,") does not match the number of placeholders in the markup '").concat(r,"' (").concat(l,")")),t},TD=function(t,r,i){return t.replace(Ms.id,r).replace(Ms.display,i)},MD=[{base:"A",letters:/(&#65;|&#9398;|&#65313;|&#192;|&#193;|&#194;|&#7846;|&#7844;|&#7850;|&#7848;|&#195;|&#256;|&#258;|&#7856;|&#7854;|&#7860;|&#7858;|&#550;|&#480;|&#196;|&#478;|&#7842;|&#197;|&#506;|&#461;|&#512;|&#514;|&#7840;|&#7852;|&#7862;|&#7680;|&#260;|&#570;|&#11375;|[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F])/g},{base:"AA",letters:/(&#42802;|[\uA732])/g},{base:"AE",letters:/(&#198;|&#508;|&#482;|[\u00C6\u01FC\u01E2])/g},{base:"AO",letters:/(&#42804;|[\uA734])/g},{base:"AU",letters:/(&#42806;|[\uA736])/g},{base:"AV",letters:/(&#42808;|&#42810;|[\uA738\uA73A])/g},{base:"AY",letters:/(&#42812;|[\uA73C])/g},{base:"B",letters:/(&#66;|&#9399;|&#65314;|&#7682;|&#7684;|&#7686;|&#579;|&#386;|&#385;|[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181])/g},{base:"C",letters:/(&#67;|&#9400;|&#65315;|&#262;|&#264;|&#266;|&#268;|&#199;|&#7688;|&#391;|&#571;|&#42814;|[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E])/g},{base:"D",letters:/(&#68;|&#9401;|&#65316;|&#7690;|&#270;|&#7692;|&#7696;|&#7698;|&#7694;|&#272;|&#395;|&#394;|&#393;|&#42873;|&#208;|[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779\u00D0])/g},{base:"DZ",letters:/(&#497;|&#452;|[\u01F1\u01C4])/g},{base:"Dz",letters:/(&#498;|&#453;|[\u01F2\u01C5])/g},{base:"E",letters:/(&#69;|&#9402;|&#65317;|&#200;|&#201;|&#202;|&#7872;|&#7870;|&#7876;|&#7874;|&#7868;|&#274;|&#7700;|&#7702;|&#276;|&#278;|&#203;|&#7866;|&#282;|&#516;|&#518;|&#7864;|&#7878;|&#552;|&#7708;|&#280;|&#7704;|&#7706;|&#400;|&#398;|[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E])/g},{base:"F",letters:/(&#70;|&#9403;|&#65318;|&#7710;|&#401;|&#42875;|[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B])/g},{base:"G",letters:/(&#71;|&#9404;|&#65319;|&#500;|&#284;|&#7712;|&#286;|&#288;|&#486;|&#290;|&#484;|&#403;|&#42912;|&#42877;|&#42878;|[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E])/g},{base:"H",letters:/(&#72;|&#9405;|&#65320;|&#292;|&#7714;|&#7718;|&#542;|&#7716;|&#7720;|&#7722;|&#294;|&#11367;|&#11381;|&#42893;|[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D])/g},{base:"I",letters:/(&#73;|&#9406;|&#65321;|&#204;|&#205;|&#206;|&#296;|&#298;|&#300;|&#304;|&#207;|&#7726;|&#7880;|&#463;|&#520;|&#522;|&#7882;|&#302;|&#7724;|&#407;|[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197])/g},{base:"J",letters:/(&#74;|&#9407;|&#65322;|&#308;|&#584;|[\u004A\u24BF\uFF2A\u0134\u0248])/g},{base:"K",letters:/(&#75;|&#9408;|&#65323;|&#7728;|&#488;|&#7730;|&#310;|&#7732;|&#408;|&#11369;|&#42816;|&#42818;|&#42820;|&#42914;|[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2])/g},{base:"L",letters:/(&#76;|&#9409;|&#65324;|&#319;|&#313;|&#317;|&#7734;|&#7736;|&#315;|&#7740;|&#7738;|&#321;|&#573;|&#11362;|&#11360;|&#42824;|&#42822;|&#42880;|[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780])/g},{base:"LJ",letters:/(&#455;|[\u01C7])/g},{base:"Lj",letters:/(&#456;|[\u01C8])/g},{base:"M",letters:/(&#77;|&#9410;|&#65325;|&#7742;|&#7744;|&#7746;|&#11374;|&#412;|[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C])/g},{base:"N",letters:/(&#78;|&#9411;|&#65326;|&#504;|&#323;|&#209;|&#7748;|&#327;|&#7750;|&#325;|&#7754;|&#7752;|&#544;|&#413;|&#42896;|&#42916;|&#330;|[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4\u014A])/g},{base:"NJ",letters:/(&#458;|[\u01CA])/g},{base:"Nj",letters:/(&#459;|[\u01CB])/g},{base:"O",letters:/(&#79;|&#9412;|&#65327;|&#210;|&#211;|&#212;|&#7890;|&#7888;|&#7894;|&#7892;|&#213;|&#7756;|&#556;|&#7758;|&#332;|&#7760;|&#7762;|&#334;|&#558;|&#560;|&#214;|&#554;|&#7886;|&#336;|&#465;|&#524;|&#526;|&#416;|&#7900;|&#7898;|&#7904;|&#7902;|&#7906;|&#7884;|&#7896;|&#490;|&#492;|&#216;|&#510;|&#390;|&#415;|&#42826;|&#42828;|[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C])/g},{base:"OE",letters:/(&#338;|[\u0152])/g},{base:"OI",letters:/(&#418;|[\u01A2])/g},{base:"OO",letters:/(&#42830;|[\uA74E])/g},{base:"OU",letters:/(&#546;|[\u0222])/g},{base:"P",letters:/(&#80;|&#9413;|&#65328;|&#7764;|&#7766;|&#420;|&#11363;|&#42832;|&#42834;|&#42836;|[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754])/g},{base:"Q",letters:/(&#81;|&#9414;|&#65329;|&#42838;|&#42840;|&#586;|[\u0051\u24C6\uFF31\uA756\uA758\u024A])/g},{base:"R",letters:/(&#82;|&#9415;|&#65330;|&#340;|&#7768;|&#344;|&#528;|&#530;|&#7770;|&#7772;|&#342;|&#7774;|&#588;|&#11364;|&#42842;|&#42918;|&#42882;|[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782])/g},{base:"S",letters:/(&#83;|&#9416;|&#65331;|&#7838;|&#346;|&#7780;|&#348;|&#7776;|&#352;|&#7782;|&#7778;|&#7784;|&#536;|&#350;|&#11390;|&#42920;|&#42884;|[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784])/g},{base:"T",letters:/(&#84;|&#9417;|&#65332;|&#7786;|&#356;|&#7788;|&#538;|&#354;|&#7792;|&#7790;|&#358;|&#428;|&#430;|&#574;|&#42886;|[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786])/g},{base:"TH",letters:/(&#222;|[\u00DE])/g},{base:"TZ",letters:/(&#42792;|[\uA728])/g},{base:"U",letters:/(&#85;|&#9418;|&#65333;|&#217;|&#218;|&#219;|&#360;|&#7800;|&#362;|&#7802;|&#364;|&#220;|&#475;|&#471;|&#469;|&#473;|&#7910;|&#366;|&#368;|&#467;|&#532;|&#534;|&#431;|&#7914;|&#7912;|&#7918;|&#7916;|&#7920;|&#7908;|&#7794;|&#370;|&#7798;|&#7796;|&#580;|[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244])/g},{base:"V",letters:/(&#86;|&#9419;|&#65334;|&#7804;|&#7806;|&#434;|&#42846;|&#581;|[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245])/g},{base:"VY",letters:/(&#42848;|[\uA760])/g},{base:"W",letters:/(&#87;|&#9420;|&#65335;|&#7808;|&#7810;|&#372;|&#7814;|&#7812;|&#7816;|&#11378;|[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72])/g},{base:"X",letters:/(&#88;|&#9421;|&#65336;|&#7818;|&#7820;|[\u0058\u24CD\uFF38\u1E8A\u1E8C])/g},{base:"Y",letters:/(&#89;|&#9422;|&#65337;|&#7922;|&#221;|&#374;|&#7928;|&#562;|&#7822;|&#376;|&#7926;|&#7924;|&#435;|&#590;|&#7934;|[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE])/g},{base:"Z",letters:/(&#90;|&#9423;|&#65338;|&#377;|&#7824;|&#379;|&#381;|&#7826;|&#7828;|&#437;|&#548;|&#11391;|&#11371;|&#42850;|[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762])/g},{base:"a",letters:/(&#97;|&#9424;|&#65345;|&#7834;|&#224;|&#225;|&#226;|&#7847;|&#7845;|&#7851;|&#7849;|&#227;|&#257;|&#259;|&#7857;|&#7855;|&#7861;|&#7859;|&#551;|&#481;|&#228;|&#479;|&#7843;|&#229;|&#507;|&#462;|&#513;|&#515;|&#7841;|&#7853;|&#7863;|&#7681;|&#261;|&#11365;|&#592;|[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250])/g},{base:"aa",letters:/(&#42803;|[\uA733])/g},{base:"ae",letters:/(&#230;|&#509;|&#483;|[\u00E6\u01FD\u01E3])/g},{base:"ao",letters:/(&#42805;|[\uA735])/g},{base:"au",letters:/(&#42807;|[\uA737])/g},{base:"av",letters:/(&#42809;|&#42811;|[\uA739\uA73B])/g},{base:"ay",letters:/(&#42813;|[\uA73D])/g},{base:"b",letters:/(&#98;|&#9425;|&#65346;|&#7683;|&#7685;|&#7687;|&#384;|&#387;|&#595;|[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253])/g},{base:"c",letters:/(&#99;|&#9426;|&#65347;|&#263;|&#265;|&#267;|&#269;|&#231;|&#7689;|&#392;|&#572;|&#42815;|&#8580;|[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184])/g},{base:"d",letters:/(&#100;|&#9427;|&#65348;|&#7691;|&#271;|&#7693;|&#7697;|&#7699;|&#7695;|&#273;|&#396;|&#598;|&#599;|&#42874;|&#240;|[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A\u00F0])/g},{base:"dz",letters:/(&#499;|&#454;|[\u01F3\u01C6])/g},{base:"e",letters:/(&#101;|&#9428;|&#65349;|&#232;|&#233;|&#234;|&#7873;|&#7871;|&#7877;|&#7875;|&#7869;|&#275;|&#7701;|&#7703;|&#277;|&#279;|&#235;|&#7867;|&#283;|&#517;|&#519;|&#7865;|&#7879;|&#553;|&#7709;|&#281;|&#7705;|&#7707;|&#583;|&#603;|&#477;|[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD])/g},{base:"f",letters:/(&#102;|&#9429;|&#65350;|&#7711;|&#402;|&#42876;|[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C])/g},{base:"g",letters:/(&#103;|&#9430;|&#65351;|&#501;|&#285;|&#7713;|&#287;|&#289;|&#487;|&#291;|&#485;|&#608;|&#42913;|&#7545;|&#42879;|[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F])/g},{base:"h",letters:/(&#104;|&#9431;|&#65352;|&#293;|&#7715;|&#7719;|&#543;|&#7717;|&#7721;|&#7723;|&#7830;|&#295;|&#11368;|&#11382;|&#613;|[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265])/g},{base:"hv",letters:/(&#405;|[\u0195])/g},{base:"i",letters:/(&#105;|&#9432;|&#65353;|&#236;|&#237;|&#238;|&#297;|&#299;|&#301;|&#239;|&#7727;|&#7881;|&#464;|&#521;|&#523;|&#7883;|&#303;|&#7725;|&#616;|&#305;|[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131])/g},{base:"ij",letters:/(&#307;|[\u0133])/g},{base:"j",letters:/(&#106;|&#9433;|&#65354;|&#309;|&#496;|&#585;|[\u006A\u24D9\uFF4A\u0135\u01F0\u0249])/g},{base:"k",letters:/(&#107;|&#9434;|&#65355;|&#7729;|&#489;|&#7731;|&#311;|&#7733;|&#409;|&#11370;|&#42817;|&#42819;|&#42821;|&#42915;|[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3])/g},{base:"l",letters:/(&#108;|&#9435;|&#65356;|&#320;|&#314;|&#318;|&#7735;|&#7737;|&#316;|&#7741;|&#7739;|&#322;|&#410;|&#619;|&#11361;|&#42825;|&#42881;|&#42823;|[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u0142\u019A\u026B\u2C61\uA749\uA781\uA747])/g},{base:"lj",letters:/(&#457;|[\u01C9])/g},{base:"m",letters:/(&#109;|&#9436;|&#65357;|&#7743;|&#7745;|&#7747;|&#625;|&#623;|[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F])/g},{base:"n",letters:/(&#110;|&#9437;|&#65358;|&#505;|&#324;|&#241;|&#7749;|&#328;|&#7751;|&#326;|&#7755;|&#7753;|&#414;|&#626;|&#329;|&#42897;|&#42917;|&#331;|[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5\u014B])/g},{base:"nj",letters:/(&#460;|[\u01CC])/g},{base:"o",letters:/(&#111;|&#9438;|&#65359;|&#242;|&#243;|&#244;|&#7891;|&#7889;|&#7895;|&#7893;|&#245;|&#7757;|&#557;|&#7759;|&#333;|&#7761;|&#7763;|&#335;|&#559;|&#561;|&#246;|&#555;|&#7887;|&#337;|&#466;|&#525;|&#527;|&#417;|&#7901;|&#7899;|&#7905;|&#7903;|&#7907;|&#7885;|&#7897;|&#491;|&#493;|&#248;|&#511;|&#596;|&#42827;|&#42829;|&#629;|[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275])/g},{base:"oe",letters:/(&#339;|[\u0153])/g},{base:"oi",letters:/(&#419;|[\u01A3])/g},{base:"ou",letters:/(&#547;|[\u0223])/g},{base:"oo",letters:/(&#42831;|[\uA74F])/g},{base:"p",letters:/(&#112;|&#9439;|&#65360;|&#7765;|&#7767;|&#421;|&#7549;|&#42833;|&#42835;|&#42837;|[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755])/g},{base:"q",letters:/(&#113;|&#9440;|&#65361;|&#587;|&#42839;|&#42841;|[\u0071\u24E0\uFF51\u024B\uA757\uA759])/g},{base:"r",letters:/(&#114;|&#9441;|&#65362;|&#341;|&#7769;|&#345;|&#529;|&#531;|&#7771;|&#7773;|&#343;|&#7775;|&#589;|&#637;|&#42843;|&#42919;|&#42883;|[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783])/g},{base:"s",letters:/(&#115;|&#9442;|&#65363;|&#347;|&#7781;|&#349;|&#7777;|&#353;|&#7783;|&#7779;|&#7785;|&#537;|&#351;|&#575;|&#42921;|&#42885;|&#7835;|&#383;|[\u0073\u24E2\uFF53\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B\u017F])/g},{base:"ss",letters:/(&#223;|[\u00DF])/g},{base:"t",letters:/(&#116;|&#9443;|&#65364;|&#7787;|&#7831;|&#357;|&#7789;|&#539;|&#355;|&#7793;|&#7791;|&#359;|&#429;|&#648;|&#11366;|&#42887;|[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787])/g},{base:"th",letters:/(&#254;|[\u00FE])/g},{base:"tz",letters:/(&#42793;|[\uA729])/g},{base:"u",letters:/(&#117;|&#9444;|&#65365;|&#249;|&#250;|&#251;|&#361;|&#7801;|&#363;|&#7803;|&#365;|&#252;|&#476;|&#472;|&#470;|&#474;|&#7911;|&#367;|&#369;|&#468;|&#533;|&#535;|&#432;|&#7915;|&#7913;|&#7919;|&#7917;|&#7921;|&#7909;|&#7795;|&#371;|&#7799;|&#7797;|&#649;|[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289])/g},{base:"v",letters:/(&#118;|&#9445;|&#65366;|&#7805;|&#7807;|&#651;|&#42847;|&#652;|[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C])/g},{base:"vy",letters:/(&#42849;|[\uA761])/g},{base:"w",letters:/(&#119;|&#9446;|&#65367;|&#7809;|&#7811;|&#373;|&#7815;|&#7813;|&#7832;|&#7817;|&#11379;|[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73])/g},{base:"x",letters:/(&#120;|&#9447;|&#65368;|&#7819;|&#7821;|[\u0078\u24E7\uFF58\u1E8B\u1E8D])/g},{base:"y",letters:/(&#121;|&#9448;|&#65369;|&#7923;|&#253;|&#375;|&#7929;|&#563;|&#7823;|&#255;|&#7927;|&#7833;|&#7925;|&#436;|&#591;|&#7935;|[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF])/g},{base:"z",letters:/(&#122;|&#9449;|&#65370;|&#378;|&#7825;|&#380;|&#382;|&#7827;|&#7829;|&#438;|&#549;|&#576;|&#11372;|&#42851;|[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763])/g}],RD=function(t){var r=t;return MD.forEach(function(i){r=r.replace(i.letters,i.base)}),r},yS=function(t){return RD(t).toLowerCase()},CN=function(t,r,i){return i?yS(t).indexOf(yS(r)):t.toLowerCase().indexOf(r.toLowerCase())},kD=function(){return!!document.documentMode},Zp=function(t){return typeof t=="number"},DD=function(t){return t===Object(t)?Object.keys(t):[]},ID=function(t){for(var r,i=arguments.length,l=new Array(i>1?i-1:0),c=1;c<i;c++)l[c-1]=arguments[c];var f=(r=[]).concat.apply(r,l);return Object.keys(t).reduce(function(m,h){return t.hasOwnProperty(h)&&!f.includes(h)&&t[h]!==void 0&&(m[h]=t[h]),m},{})},LD=["style","className","classNames"];function gS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function bS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gS(Object(r),!0).forEach(function(i){on(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function yf(e,t){var r=function(l){var c=function(h){var p=h.style,y=h.className,g=h.classNames,v=sD(h,LD),S=t?t(v):void 0,w=eg(e,{style:p,className:y,classNames:g},S);return De.createElement(l,os({},v,{style:w}))},f=l.displayName||l.name||"Component";return c.displayName="defaultStyle(".concat(f,")"),De.forwardRef(function(m,h){return c(bS(bS({},m),{},{ref:h}))})};return r}var OD=function(t,r){return t.hasOwnProperty(r)?t[r]++:t[r]=0,r+"_"+t[r]};function AN(e){var t=e.selectionStart,r=e.selectionEnd,i=e.value,l=i===void 0?"":i,c=e.onCaretPositionChange,f=e.containerRef,m=e.children;e.singleLine;var h=e.style,p=u.useState({left:void 0,top:void 0}),y=Id(p,2),g=y[0],v=y[1],S=u.useState(),w=Id(S,2),N=w[0],E=w[1];u.useEffect(function(){C()});var C=function(){if(N){var k=N.offsetLeft,F=N.offsetTop;if(!(g.left===k&&g.top===F)){var I={left:k,top:F};v(I),c(I)}}},A=$r(m),O;r===t&&(O=Na(l,A,t,"START"));var _=[],R={},D=_,j=0,z=function(k,F,I){if(Zp(O)&&O>=F&&O<=F+k.length){var L=O-F;D.push(X(k.substring(0,L),j)),D=[X(k.substring(L),j)]}else D.push(X(k,j));j++},P=function(k,F,I,L,$,T,U){var M=OD(R,L);D.push(H(L,$,T,M))},X=function(k,F){return De.createElement("span",os({},h("substring"),{key:F}),k)},H=function(k,F,I,L){var $={id:k,display:F,key:L},T=u.Children.toArray(m)[I];return De.cloneElement(T,$)},G=function(k){return De.createElement("span",os({},h("caret"),{ref:E,key:"caret"}),k)};return _c(l,A,P,z),D.push(" "),D!==_&&_.push(G(D)),De.createElement("div",os({},h,{ref:f}),_)}AN.propTypes={selectionStart:jt.number,selectionEnd:jt.number,value:jt.string.isRequired,onCaretPositionChange:jt.func.isRequired,containerRef:jt.oneOfType([jt.func,jt.shape({current:typeof Element>"u"?jt.any:jt.instanceOf(Element)})]),children:jt.oneOfType([jt.element,jt.arrayOf(jt.element)]).isRequired};var zD=yf({position:"relative",boxSizing:"border-box",width:"100%",color:"transparent",overflow:"hidden",whiteSpace:"pre-wrap",wordWrap:"break-word",border:"1px solid transparent",textAlign:"start","&singleLine":{whiteSpace:"pre",wordWrap:null},substring:{visibility:"hidden"}},function(e){return{"&singleLine":e.singleLine}}),$D=zD(AN);function TN(e){var t=e.id,r=e.focused,i=e.ignoreAccents,l=e.index,c=e.onClick,f=e.onMouseEnter,m=e.query,h=e.renderSuggestion,p=e.suggestion,y=e.style;e.className,e.classNames;var g={onClick:c,onMouseEnter:f},v=function(){var E=S(),C=w(E);return h?h(p,m,C,l,r):C},S=function(){if(typeof p=="string")return p;var E=p.id,C=p.display;return E===void 0||!C?E:C},w=function(E){var C=CN(E,m,i);return C===-1?De.createElement("span",y("display"),E):De.createElement("span",y("display"),E.substring(0,C),De.createElement("b",y("highlight"),E.substring(C,C+m.length)),E.substring(C+m.length))};return De.createElement("li",os({id:t,role:"option","aria-selected":r},g,y),v())}TN.propTypes={id:jt.string.isRequired,query:jt.string.isRequired,index:jt.number.isRequired,ignoreAccents:jt.bool,suggestion:jt.oneOfType([jt.string,jt.shape({id:jt.oneOfType([jt.string,jt.number]).isRequired,display:jt.string})]).isRequired,renderSuggestion:jt.func,focused:jt.bool};var FD=yf({cursor:"pointer"},function(e){return{"&focused":e.focused}}),BD=FD(TN);function UD(e){var t=e.style,r=e.className,i=e.classNames,l=eg(qD,{style:t,className:r,classNames:i}),c=l("spinner");return De.createElement("div",l,De.createElement("div",c,De.createElement("div",c(["element","element1"])),De.createElement("div",c(["element","element2"])),De.createElement("div",c(["element","element3"])),De.createElement("div",c(["element","element4"])),De.createElement("div",c(["element","element5"]))))}var qD={};function MN(e){var t=e.id,r=e.suggestions,i=r===void 0?{}:r,l=e.a11ySuggestionsListLabel,c=e.focusIndex,f=e.position,m=e.left,h=e.right,p=e.top,y=e.scrollFocusedIntoView,g=e.isLoading,v=e.isOpened,S=e.onSelect,w=S===void 0?function(){return null}:S,N=e.ignoreAccents,E=e.containerRef,C=e.children,A=e.style,O=e.customSuggestionsContainer,_=e.onMouseDown,R=e.onMouseEnter,D=u.useState(void 0),j=Id(D,2),z=j[0],P=j[1];u.useEffect(function(){if(!(!z||z.offsetHeight>=z.scrollHeight||!y)){var I=z.scrollTop,L=z.children[c].getBoundingClientRect(),$=L.top,T=L.bottom,U=z.getBoundingClientRect(),M=U.top;$=$-M+I,T=T-M+I,$<I?z.scrollTop=$:T>z.offsetHeight&&(z.scrollTop=T-z.offsetHeight)}},[c,y,z]);var X=function(){var L=De.createElement("ul",os({ref:P,id:t,role:"listbox","aria-label":l},A("list")),Object.values(i).reduce(function($,T){var U=T.results,M=T.queryInfo;return[].concat(kd($),kd(U.map(function(q,Y){return H(q,M,$.length+Y)})))},[]));return O?O(L):L},H=function(L,$,T){var U=T===c,M=$.childIndex,q=$.query,Y=u.Children.toArray(C)[M].props.renderSuggestion;return De.createElement(BD,{style:A("item"),key:"".concat(M,"-").concat(F(L)),id:_N(t,T),query:q,index:T,ignoreAccents:N,renderSuggestion:Y,suggestion:L,focused:U,onClick:function(){return k(L,$)},onMouseEnter:function(){return V(T)}})},G=function(){if(g)return De.createElement(UD,{style:A("loadingIndicator")})},V=function(L,$){R&&R(L)},k=function(L,$){w(L,$)},F=function(L){return typeof L=="string"?L:L.id};return v?De.createElement("div",os({},wD({position:f||"absolute",left:m,right:h,top:p},A),{onMouseDown:_,ref:E}),X(),G()):null}MN.propTypes={id:jt.string.isRequired,suggestions:jt.object.isRequired,a11ySuggestionsListLabel:jt.string,focusIndex:jt.number,position:jt.string,left:jt.number,right:jt.number,top:jt.number,scrollFocusedIntoView:jt.bool,isLoading:jt.bool,isOpened:jt.bool.isRequired,onSelect:jt.func,ignoreAccents:jt.bool,customSuggestionsContainer:jt.func,containerRef:jt.oneOfType([jt.func,jt.shape({current:typeof Element>"u"?jt.any:jt.instanceOf(Element)})])};var HD=yf({zIndex:1,backgroundColor:"white",marginTop:14,minWidth:100,list:{margin:0,padding:0,listStyleType:"none"}}),PD=HD(MN);function vS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function ms(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?vS(Object(r),!0).forEach(function(i){on(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function VD(e){var t=YD();return function(){var i=Dd(e),l;if(t){var c=Dd(this).constructor;l=Reflect.construct(i,arguments,c)}else l=i.apply(this,arguments);return Z4(this,l)}}function YD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var GD=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t instanceof RegExp)return t;var i=r.allowSpaceInQuery,l=vd(t);return new RegExp("(?:^|\\s)(".concat(l,"([^").concat(i?"":"\\s").concat(l,"]*))$"))},XD=function(t,r){return t instanceof Array?function(i,l){for(var c=[],f=0,m=t.length;f<m;++f){var h=t[f].display||t[f].id;CN(h,i,r)>=0&&c.push(t[f])}return c}:t},yl={TAB:9,RETURN:13,ESC:27,UP:38,DOWN:40},Gu=!1,RN={singleLine:jt.bool,allowSpaceInQuery:jt.bool,allowSuggestionsAboveCursor:jt.bool,forceSuggestionsAboveCursor:jt.bool,ignoreAccents:jt.bool,a11ySuggestionsListLabel:jt.string,value:jt.string,onKeyDown:jt.func,customSuggestionsContainer:jt.func,onSelect:jt.func,onBlur:jt.func,onChange:jt.func,suggestionsPortalHost:typeof Element>"u"?jt.any:jt.PropTypes.instanceOf(Element),inputRef:jt.oneOfType([jt.func,jt.shape({current:typeof Element>"u"?jt.any:jt.instanceOf(Element)})]),children:jt.oneOfType([jt.element,jt.arrayOf(jt.element)]).isRequired},tg=(function(e){W4(r,e);var t=VD(r);function r(i){var l;return G4(this,r),l=t.call(this,i),on(un(l),"setContainerElement",function(c){l.containerElement=c}),on(un(l),"getInputProps",function(){var c=l.props,f=c.readOnly,m=c.disabled,h=c.style,p=ID(l.props,["style","classNames","className"],DD(RN));return ms(ms(ms(ms({},p),h("input")),{},{value:l.getPlainText(),onScroll:l.updateHighlighterScroll},!f&&!m&&{onChange:l.handleChange,onSelect:l.handleSelect,onKeyDown:l.handleKeyDown,onBlur:l.handleBlur,onCompositionStart:l.handleCompositionStart,onCompositionEnd:l.handleCompositionEnd}),l.isOpened()&&{role:"combobox","aria-controls":l.uuidSuggestionsOverlay,"aria-expanded":!0,"aria-autocomplete":"list","aria-haspopup":"listbox","aria-activedescendant":_N(l.uuidSuggestionsOverlay,l.state.focusIndex)})}),on(un(l),"renderControl",function(){var c=l.props,f=c.singleLine,m=c.style,h=l.getInputProps();return De.createElement("div",m("control"),l.renderHighlighter(),f?l.renderInput(h):l.renderTextarea(h))}),on(un(l),"renderInput",function(c){return De.createElement("input",os({type:"text",ref:l.setInputRef},c))}),on(un(l),"renderTextarea",function(c){return De.createElement("textarea",os({ref:l.setInputRef},c))}),on(un(l),"setInputRef",function(c){l.inputElement=c;var f=l.props.inputRef;typeof f=="function"?f(c):f&&(f.current=c)}),on(un(l),"setSuggestionsElement",function(c){l.suggestionsElement=c}),on(un(l),"renderSuggestionsOverlay",function(){if(!Zp(l.state.selectionStart))return null;var c=l.state.suggestionsPosition,f=c.position,m=c.left,h=c.top,p=c.right,y=De.createElement(PD,{id:l.uuidSuggestionsOverlay,style:l.props.style("suggestions"),position:f,left:m,top:h,right:p,focusIndex:l.state.focusIndex,scrollFocusedIntoView:l.state.scrollFocusedIntoView,containerRef:l.setSuggestionsElement,suggestions:l.state.suggestions,customSuggestionsContainer:l.props.customSuggestionsContainer,onSelect:l.addMention,onMouseDown:l.handleSuggestionsMouseDown,onMouseEnter:l.handleSuggestionsMouseEnter,isLoading:l.isLoading(),isOpened:l.isOpened(),ignoreAccents:l.props.ignoreAccents,a11ySuggestionsListLabel:l.props.a11ySuggestionsListLabel},l.props.children);return l.props.suggestionsPortalHost?h1.createPortal(y,l.props.suggestionsPortalHost):y}),on(un(l),"renderHighlighter",function(){var c=l.state,f=c.selectionStart,m=c.selectionEnd,h=l.props,p=h.singleLine,y=h.children,g=h.value,v=h.style;return De.createElement($D,{containerRef:l.setHighlighterElement,style:v("highlighter"),value:g,singleLine:p,selectionStart:f,selectionEnd:m,onCaretPositionChange:l.handleCaretPositionChange},y)}),on(un(l),"setHighlighterElement",function(c){l.highlighterElement=c}),on(un(l),"handleCaretPositionChange",function(c){l.setState({caretPosition:c})}),on(un(l),"getPlainText",function(){return wi(l.props.value||"",$r(l.props.children))}),on(un(l),"executeOnChange",function(c){for(var f=arguments.length,m=new Array(f>1?f-1:0),h=1;h<f;h++)m[h-1]=arguments[h];if(l.props.onChange){var p;return(p=l.props).onChange.apply(p,[c].concat(m))}if(l.props.valueLink){var y;return(y=l.props.valueLink).requestChange.apply(y,[c.target.value].concat(m))}}),on(un(l),"handleChange",function(c){if(Gu=!1,kD()){var f=document.activeElement&&document.activeElement.contentDocument||document;if(f.activeElement!==c.target)return}var m=l.props.value||"",h=$r(l.props.children),p=c.target.value,y=l.state.selectionStart;y==null&&(y=c.target.selectionStart);var g=l.state.selectionEnd;g==null&&(g=c.target.selectionEnd);var v=jD(m,p,{selectionStartBefore:y,selectionEndBefore:g,selectionEndAfter:c.target.selectionEnd},h);p=wi(v,h);var S=c.target.selectionStart,w=c.target.selectionEnd,N=!1,E=pS(m,h,S);E!==void 0&&l.state.selectionEnd>E&&(S=E+(c.nativeEvent.data?c.nativeEvent.data.length:0),w=S,N=!0),l.setState({selectionStart:S,selectionEnd:w,setSelectionAfterMentionChange:N});var C=Ko(v,h);c.nativeEvent.isComposing&&S===w&&l.updateMentionsQueries(l.inputElement.value,S);var A={target:{value:v}};l.executeOnChange(A,v,p,C)}),on(un(l),"handleSelect",function(c){if(l.setState({selectionStart:c.target.selectionStart,selectionEnd:c.target.selectionEnd}),!Gu){var f=l.inputElement;c.target.selectionStart===c.target.selectionEnd?l.updateMentionsQueries(f.value,c.target.selectionStart):l.clearSuggestions(),l.updateHighlighterScroll(),l.props.onSelect(c)}}),on(un(l),"handleKeyDown",function(c){var f=Yu(l.state.suggestions);if(f===0||!l.suggestionsElement){l.props.onKeyDown(c);return}switch(Object.values(yl).indexOf(c.keyCode)>=0&&(c.preventDefault(),c.stopPropagation()),c.keyCode){case yl.ESC:{l.clearSuggestions();return}case yl.DOWN:{l.shiftFocus(1);return}case yl.UP:{l.shiftFocus(-1);return}case yl.RETURN:{l.selectFocused();return}case yl.TAB:{l.selectFocused();return}default:return}}),on(un(l),"shiftFocus",function(c){var f=Yu(l.state.suggestions);l.setState({focusIndex:(f+l.state.focusIndex+c)%f,scrollFocusedIntoView:!0})}),on(un(l),"selectFocused",function(){var c=l.state,f=c.suggestions,m=c.focusIndex,h=Object.values(f).reduce(function(g,v){var S=v.results,w=v.queryInfo;return[].concat(kd(g),kd(S.map(function(N){return{result:N,queryInfo:w}})))},[])[m],p=h.result,y=h.queryInfo;l.addMention(p,y),l.setState({focusIndex:0})}),on(un(l),"handleBlur",function(c){var f=l._suggestionsMouseDown;l._suggestionsMouseDown=!1,f||l.setState({selectionStart:null,selectionEnd:null}),window.setTimeout(function(){l.updateHighlighterScroll()},1),l.props.onBlur(c,f)}),on(un(l),"handleSuggestionsMouseDown",function(c){l._suggestionsMouseDown=!0}),on(un(l),"handleSuggestionsMouseEnter",function(c){l.setState({focusIndex:c,scrollFocusedIntoView:!1})}),on(un(l),"updateSuggestionsPosition",function(){var c=l.state.caretPosition,f=l.props,m=f.suggestionsPortalHost,h=f.allowSuggestionsAboveCursor,p=f.forceSuggestionsAboveCursor;if(!(!c||!l.suggestionsElement)){var y=l.suggestionsElement,g=l.highlighterElement,v=g.getBoundingClientRect(),S=op(g,"font-size"),w={left:v.left+c.left,top:v.top+c.top+S},N=Math.max(document.documentElement.clientHeight,window.innerHeight||0);if(y){var E={};if(m){E.position="fixed";var C=w.left,A=w.top;C-=op(y,"margin-left"),A-=op(y,"margin-top"),C-=g.scrollLeft,A-=g.scrollTop;var O=Math.max(document.documentElement.clientWidth,window.innerWidth||0);C+y.offsetWidth>O?E.left=Math.max(0,O-y.offsetWidth):E.left=C,h&&A+y.offsetHeight>N&&y.offsetHeight<A-S||p?E.top=Math.max(0,A-y.offsetHeight-S):E.top=A}else{var _=c.left-g.scrollLeft,R=c.top-g.scrollTop;_+y.offsetWidth>l.containerElement.offsetWidth?E.right=0:E.left=_,h&&w.top-g.scrollTop+y.offsetHeight>N&&y.offsetHeight<v.top-S-g.scrollTop||p?E.top=R-y.offsetHeight-S:E.top=R}E.left===l.state.suggestionsPosition.left&&E.top===l.state.suggestionsPosition.top&&E.position===l.state.suggestionsPosition.position||l.setState({suggestionsPosition:E})}}}),on(un(l),"updateHighlighterScroll",function(){var c=l.inputElement,f=l.highlighterElement;!c||!f||(f.scrollLeft=c.scrollLeft,f.scrollTop=c.scrollTop,f.height=c.height)}),on(un(l),"handleCompositionStart",function(){Gu=!0}),on(un(l),"handleCompositionEnd",function(){Gu=!1}),on(un(l),"setSelection",function(c,f){if(!(c===null||f===null)){var m=l.inputElement;if(m.setSelectionRange)m.setSelectionRange(c,f);else if(m.createTextRange){var h=m.createTextRange();h.collapse(!0),h.moveEnd("character",f),h.moveStart("character",c),h.select()}}}),on(un(l),"updateMentionsQueries",function(c,f){l._queryId++,l.suggestions={},l.setState({suggestions:{}});var m=l.props.value||"",h=l.props.children,p=$r(h),y=Na(m,p,f,"NULL");if(y!==null){var g=_D(m.substring(0,y),p),v=c.substring(g,f);De.Children.forEach(h,function(S,w){if(S){var N=GD(S.props.trigger,l.props),E=v.match(N);if(E){var C=g+v.indexOf(E[1],E.index);l.queryData(E[2],w,C,C+E[1].length,c)}}})}}),on(un(l),"clearSuggestions",function(){l._queryId++,l.suggestions={},l.setState({suggestions:{},focusIndex:0})}),on(un(l),"queryData",function(c,f,m,h,p){var y=l.props,g=y.children,v=y.ignoreAccents,S=u.Children.toArray(g)[f],w=XD(S.props.data,v),N=w(c,l.updateSuggestions.bind(null,l._queryId,f,c,m,h,p));N instanceof Array&&l.updateSuggestions(l._queryId,f,c,m,h,p,N)}),on(un(l),"updateSuggestions",function(c,f,m,h,p,y,g){if(c===l._queryId){l.suggestions=ms(ms({},l.suggestions),{},on({},f,{queryInfo:{childIndex:f,query:m,querySequenceStart:h,querySequenceEnd:p,plainTextValue:y},results:g}));var v=l.state.focusIndex,S=Yu(l.suggestions);l.setState({suggestions:l.suggestions,focusIndex:v>=S?Math.max(S-1,0):v})}}),on(un(l),"addMention",function(c,f){var m=c.id,h=c.display,p=f.childIndex,y=f.querySequenceStart,g=f.querySequenceEnd,v=f.plainTextValue,S=l.props.value||"",w=$r(l.props.children),N=u.Children.toArray(l.props.children)[p],E=N.props,C=E.markup,A=E.displayTransform,O=E.appendSpaceOnAdd,_=E.onAdd,R=Na(S,w,y,"START"),D=R+g-y,j=TD(C,m,h);O&&(j+=" ");var z=tc(S,R,D,j);l.inputElement.focus();var P=A(m,h);O&&(P+=" ");var X=y+P.length;l.setState({selectionStart:X,selectionEnd:X,setSelectionAfterMentionChange:!0});var H={target:{value:z}},G=Ko(z,w),V=tc(v,y,g,P);l.executeOnChange(H,z,V,G),_&&_(m,h,R,D),l.clearSuggestions()}),on(un(l),"isLoading",function(){var c=!1;return De.Children.forEach(l.props.children,function(f){c=c||f&&f.props.isLoading}),c}),on(un(l),"isOpened",function(){return Zp(l.state.selectionStart)&&(Yu(l.state.suggestions)!==0||l.isLoading())}),on(un(l),"_queryId",0),l.suggestions={},l.uuidSuggestionsOverlay=Math.random().toString(16).substring(2),l.handleCopy=l.handleCopy.bind(un(l)),l.handleCut=l.handleCut.bind(un(l)),l.handlePaste=l.handlePaste.bind(un(l)),l.state={focusIndex:0,selectionStart:null,selectionEnd:null,suggestions:{},caretPosition:null,suggestionsPosition:{},setSelectionAfterHandlePaste:!1},l}return K4(r,[{key:"componentDidMount",value:function(){document.addEventListener("copy",this.handleCopy),document.addEventListener("cut",this.handleCut),document.addEventListener("paste",this.handlePaste),this.updateSuggestionsPosition()}},{key:"componentDidUpdate",value:function(l,c){c.suggestionsPosition===this.state.suggestionsPosition&&this.updateSuggestionsPosition(),this.state.setSelectionAfterMentionChange&&(this.setState({setSelectionAfterMentionChange:!1}),this.setSelection(this.state.selectionStart,this.state.selectionEnd)),this.state.setSelectionAfterHandlePaste&&(this.setState({setSelectionAfterHandlePaste:!1}),this.setSelection(this.state.selectionStart,this.state.selectionEnd))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("copy",this.handleCopy),document.removeEventListener("cut",this.handleCut),document.removeEventListener("paste",this.handlePaste)}},{key:"render",value:function(){return De.createElement("div",os({ref:this.setContainerElement},this.props.style),this.renderControl(),this.renderSuggestionsOverlay())}},{key:"handlePaste",value:function(l){if(l.target===this.inputElement&&this.supportsClipboardActions(l)){l.preventDefault();var c=this.state,f=c.selectionStart,m=c.selectionEnd,h=this.props,p=h.value,y=h.children,g=$r(y),v=Na(p,g,f,"START"),S=Na(p,g,m,"END"),w=l.clipboardData.getData("text/react-mentions"),N=l.clipboardData.getData("text/plain"),E=tc(p,v,S,w||N).replace(/\r/g,""),C=wi(E,g),A={target:ms(ms({},l.target),{},{value:E})};this.executeOnChange(A,E,C,Ko(E,g));var O=pS(p,g,f),_=(O||f)+wi(w||N,g).length;this.setState({selectionStart:_,selectionEnd:_,setSelectionAfterHandlePaste:!0})}}},{key:"saveSelectionToClipboard",value:function(l){var c=this.inputElement.selectionStart,f=this.inputElement.selectionEnd,m=this.props,h=m.children,p=m.value,y=$r(h),g=Na(p,y,c,"START"),v=Na(p,y,f,"END");l.clipboardData.setData("text/plain",l.target.value.slice(c,f)),l.clipboardData.setData("text/react-mentions",p.slice(g,v))}},{key:"supportsClipboardActions",value:function(l){return!!l.clipboardData}},{key:"handleCopy",value:function(l){l.target===this.inputElement&&this.supportsClipboardActions(l)&&(l.preventDefault(),this.saveSelectionToClipboard(l))}},{key:"handleCut",value:function(l){if(l.target===this.inputElement&&this.supportsClipboardActions(l)){l.preventDefault(),this.saveSelectionToClipboard(l);var c=this.state,f=c.selectionStart,m=c.selectionEnd,h=this.props,p=h.children,y=h.value,g=$r(p),v=Na(y,g,f,"START"),S=Na(y,g,m,"END"),w=[y.slice(0,v),y.slice(S)].join(""),N=wi(w,g),E={target:ms(ms({},l.target),{},{value:N})};this.executeOnChange(E,w,N,Ko(y,g))}}}]),r})(De.Component);on(tg,"propTypes",RN);on(tg,"defaultProps",{ignoreAccents:!1,singleLine:!1,allowSuggestionsAboveCursor:!1,onKeyDown:function(){return null},onSelect:function(){return null},onBlur:function(){return null}});var op=function(t,r){var i=parseFloat(window.getComputedStyle(t,null).getPropertyValue(r));return isFinite(i)?i:0},KD=typeof navigator<"u"&&/iPhone|iPad|iPod/i.test(navigator.userAgent),WD=yf({position:"relative",overflowY:"visible",input:{display:"block",width:"100%",position:"absolute",margin:0,top:0,left:0,boxSizing:"border-box",backgroundColor:"transparent",fontFamily:"inherit",fontSize:"inherit",letterSpacing:"inherit"},"&multiLine":{input:ms({height:"100%",bottom:0,overflow:"hidden",resize:"none"},KD?{marginTop:1,marginLeft:-3}:null)}},function(e){var t=e.singleLine;return{"&singleLine":t,"&multiLine":!t}}),ZD=WD(tg),QD={fontWeight:"inherit"},Tl=function(t){var r=t.display,i=t.style,l=t.className,c=t.classNames,f=eg(QD,{style:i,className:l,classNames:c});return De.createElement("strong",f,r)};Tl.propTypes={onAdd:jt.func,onRemove:jt.func,renderSuggestion:jt.func,trigger:jt.oneOfType([jt.string,jt.instanceOf(RegExp)]),markup:jt.string,displayTransform:jt.func,allowSpaceInQuery:jt.bool,isLoading:jt.bool};Tl.defaultProps={trigger:"@",markup:"@[__display__](__id__)",displayTransform:function(t,r){return r||t},onAdd:function(){return null},onRemove:function(){return null},renderSuggestion:null,isLoading:!1,appendSpaceOnAdd:!1};function Ld({inputProps:e,...t}){const r=u.useRef(null);return u.useEffect(()=>{if(!r.current||!e)return;const i=()=>{const l=r.current?.querySelector("textarea");return l?(Object.entries(e).forEach(([c,f])=>{if(f!=null)if(c==="className"){const m=l.className||"";l.className=m?`${m} ${f}`.trim():f}else if(c.startsWith("data-")||c.startsWith("aria-"))l.setAttribute(c,String(f));else if(c==="rows")l.setAttribute("rows",String(f));else if(c==="required")l.required=!!f;else if(c==="id")l.id=String(f);else try{typeof f=="boolean"?f?l.setAttribute(c,""):l.removeAttribute(c):l[c]=f}catch{try{l.setAttribute(c,String(f))}catch{}}}),!0):!1};if(!i()){const l=setTimeout(()=>{i()},10);return()=>clearTimeout(l)}},[e]),a.jsx("div",{ref:r,children:a.jsx(ZD,{...t})})}const JD=/\s*\(([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\)$/i,eI=/\(([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\)/gi,Ml=e=>{if(!e)return"";let t=String(e).trim();return t=t.replace(JD,"").trim(),t=t.replace(eI,"").trim(),t},fc=(e="",t=[])=>{const r=typeof e=="string"?e:"";if(!r)return[];const i=Array.isArray(t)?t:[],l=new Map;i.forEach(p=>{if(!p)return;const y=p.entityId??p.entity_id??p.id??p.entityID??null;if(!y)return;const g=String(y);if(l.has(g))return;const v=p.entityName??p.entity_name??p.label??p.name,S=v?Ml(v):"";l.set(g,{entityId:g,entityName:S})});const c=[],f=/@\[(.+?)]\(([^)]+)\)/g;let m=0,h;for(;(h=f.exec(r))!==null;){h.index>m&&c.push({type:"text",text:r.slice(m,h.index)});const p=String(h[2]),y=h[1],g=Ml(y)||String(y??""),v=l.get(p)||{entityId:p,entityName:g};c.push({type:"mention",...v}),m=f.lastIndex}return m<r.length&&c.push({type:"text",text:r.slice(m)}),c},tI={private:"Private",companions:"Shared with companions",dm:"Shared with DM",party:"Share with Party"},nI=[{value:"private",label:"Private"},{value:"companions",label:"My Companions"}],aI=[{value:"private",label:"Private"},{value:"party",label:"Share with Party"}],cp=e=>{if(!e)return"";if(e instanceof Date){if(Number.isNaN(e.getTime()))return"";try{return e.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.warn("Unable to format Date object",t,e),""}}if(typeof e=="string"||typeof e=="number")try{const t=new Date(e);return Number.isNaN(t.getTime())?(console.warn("Invalid date value:",e),""):t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.warn("Unable to parse date value",t,e),""}return console.warn("Unexpected date value type:",typeof e,e),""},up=e=>e?.author?.username||e?.author?.name||e?.author?.email||e?.author_name||e?.author_email||"Unknown adventurer",xS=e=>{const t=e?.author||{},r=t?.id??t?.authorId??e?.authorId??e?.author_id??e?.authorID;if(r!=null)return`id:${String(r)}`;const i=t?.email??e?.author_email;if(i)return`email:${String(i).toLowerCase()}`;const l=t?.username??t?.name??e?.author_username??e?.author_name;return l?`name:${String(l).toLowerCase()}`:"unknown"},Sa=Object.freeze([]),SS="What do you want to remember?";function kN({entity:e,worldId:t,selectedCampaign:r,selectedCampaignId:i,isCampaignDm:l,isCampaignPlayer:c,canCreateNote:f,notes:m=Sa,loading:h,error:p,onCreateNote:y,creating:g,campaignMatchesEntityWorld:v,onNoteUpdate:S,onNoteDelete:w}){const{user:N}=En(),[E,C]=u.useState(""),[A,O]=u.useState("private"),[_,R]=u.useState(""),[D,j]=u.useState(Sa),[z,P]=u.useState(!1),[X,H]=u.useState(""),[G,V]=u.useState(""),[k,F]=u.useState(""),[I,L]=u.useState(!1),[$,T]=u.useState("all"),[U,M]=u.useState("notes"),[q,Y]=u.useState("entity"),[J,ie]=u.useState(null),[Z,fe]=u.useState(""),[Q,se]=u.useState("private"),[ne,we]=u.useState(""),[Ie,Me]=u.useState(!1),[Ae,it]=u.useState(null),[$e,nt]=u.useState({items:Sa,loading:!1,error:"",loaded:!1}),[Le,wt]=u.useState({items:Sa,loading:!1,error:"",loaded:!1}),[Tt,Ct]=u.useState(()=>new Set),At=!!i&&!!f&&!!v,Ue=u.useMemo(()=>l?aI:nI,[l]),Je=u.useMemo(()=>t||e&&typeof e=="object"&&((e.world||{}).id||e.world_id)||"",[e,t]),de=u.useCallback(oe=>{if(!N||!oe)return!1;const Ze=oe?.author?.id??oe?.createdBy??oe?.created_by??oe?.authorId??oe?.author_id??null;return Ze?String(Ze)===String(N.id):!1},[N]),ue=u.useCallback((oe,Ze)=>{const Ke=typeof Ze=="string"?Ze:typeof oe?.target?.value=="string"?oe.target.value:"";C(Ke),V("")},[]),ye=u.useCallback(async(oe,Ze)=>{const Ke=oe?.trim()??"";if(typeof Ze=="function"){if(!Je||Ke.length===0){Ze([]);return}try{const ft=await rf({worldId:Je,query:Ke,limit:8}),Qe=Array.isArray(ft?.data)?ft.data:ft,pt=Array.isArray(Qe)?Qe.map(ke=>{const Pe=ke?.id??ke?.entity?.id;if(!Pe)return null;const ht=ke?.name||ke?.displayName||ke?.entity?.name||"Unnamed entity",K=Ml(ht)||"Unnamed entity";return{id:Pe,display:K}}).filter(Boolean):[];Ze(pt)}catch(ft){console.error("Failed to search entities for mentions",ft),Ze([])}}},[Je]),Ve=u.useCallback(()=>{L(!1),V(""),F("")},[]),ee=u.useCallback(()=>{At&&(V(""),F(""),L(!0))},[At]),me=u.useCallback(async oe=>{if(oe.preventDefault(),!At||!y)return;const Ze=E.trim();if(!Ze){V("Please enter a note before saving");return}if(c&&!_){V("Select which character this note is for");return}V(""),F("");try{const Ke={content:Ze,shareType:A,campaignId:i};c&&(Ke.characterId=_);const ft=await y(Ke);if(!ft||ft.success!==!0){V(ft?.message||"Failed to save note");return}C(""),c||R(""),Ve()}catch(Ke){console.error("Failed to submit note",Ke),V(Ke.message||"Failed to save note")}},[At,E,y,A,i,c,_,Ve]),he=u.useCallback(oe=>{if(!oe||!e?.id)return;const Ze=oe?.characterId??oe?.character_id??"";ie(oe.id),fe(oe?.content??""),se(oe?.shareType??oe?.share_type??"private"),we(Ze),V("")},[e?.id]),Se=u.useCallback(()=>{ie(null),fe(""),se("private"),we(""),V("")},[]),We=u.useCallback((oe,Ze)=>{const Ke=typeof Ze=="string"?Ze:typeof oe?.target?.value=="string"?oe.target.value:"";fe(Ke),V("")},[]),Xe=u.useCallback(async oe=>{if(!oe||!e?.id||!i)return;const Ze=Z.trim();if(!Ze){V("Please enter a note before saving");return}const Ke=oe?.characterId??oe?.character_id??"";if(c&&Ke&&!ne){V("Select which character this note is for");return}Me(!0),V("");try{const ft={content:Ze,shareType:Q,campaignId:i};c&&ne&&(ft.characterId=ne);const Qe=await U1(e.id,oe.id,ft),pt=Qe?.data||Qe;if(!pt)throw new Error("Note could not be updated");S&&await S(pt),Se()}catch(ft){console.error("Failed to update note",ft),V(ft.message||"Failed to update note")}finally{Me(!1)}},[e?.id,i,Z,Q,ne,c,S,Se]),et=u.useCallback(async oe=>{if(!(!oe?.id||!e?.id||!i||!window.confirm("Are you sure you want to delete this note? This action cannot be undone."))){it(oe.id),V("");try{await q1(e.id,oe.id,{campaignId:i}),w&&await w(oe.id)}catch(Ke){console.error("Failed to delete note",Ke),V(Ke.message||"Failed to delete note")}finally{it(null)}}},[e?.id,i,w]),Te=u.useMemo(()=>{const oe=Array.isArray(m)?m:Sa;return oe.length<=1?oe:[...oe].sort((Ze,Ke)=>{const ft=new Date(Ze?.createdAt??Ze?.created_at??0).getTime(),Qe=new Date(Ke?.createdAt??Ke?.created_at??0).getTime();return Number.isNaN(ft)||Number.isNaN(Qe)?0:Qe-ft})},[m]),mt=u.useMemo(()=>{const oe=[{value:"all",label:"All notes"}],Ze=new Set(["all"]);return Te.forEach(Ke=>{const ft=xS(Ke);!ft||Ze.has(ft)||(Ze.add(ft),oe.push({value:ft,label:up(Ke)}))}),oe},[Te]),Dt=u.useMemo(()=>$==="all"?Te:Te.filter(oe=>xS(oe)===$),[$,Te]),Nt=u.useMemo(()=>Array.isArray($e.items)?$e.items:Sa,[$e.items]),Ge=u.useMemo(()=>Array.isArray(Le.items)?Le.items:Sa,[Le.items]);u.useEffect(()=>{O("private")},[l,i]),u.useEffect(()=>{mt.some(oe=>oe.value===$)||T("all")},[mt,$]),u.useEffect(()=>{nt({items:Sa,loading:!1,error:"",loaded:!1}),wt({items:Sa,loading:!1,error:"",loaded:!1}),Ct(new Set),Y("entity")},[i,e?.id,v]),u.useEffect(()=>{let oe=!1;return!c||!i?(j(Sa),P(!1),H(""),R(""),()=>{oe=!0}):((async()=>{P(!0),H("");try{const Ke=await Is({scope:"my",campaign_id:i});if(oe)return;const Qe=(Array.isArray(Ke?.data)?Ke.data:Array.isArray(Ke)?Ke:[]).map(pt=>({id:pt?.id?String(pt.id):"",name:pt?.name||"Unnamed character"})).filter(pt=>pt.id);j(Qe),Qe.length===1?R(Qe[0].id):Qe.some(pt=>pt.id===_)||R("")}catch(Ke){if(oe)return;console.error("Failed to load characters for notes",Ke),j(Sa),R(""),H(Ke.message||"Failed to load characters")}finally{oe||P(!1)}})(),()=>{oe=!0})},[c,i,_]);const vt=u.useCallback(async()=>{if(!(!e?.id||!i||!v)){nt(oe=>({...oe,loading:!0,error:""}));try{const oe=await UR(e.id,{campaignId:i}),Ze=Array.isArray(oe?.data)?oe.data:Array.isArray(oe)?oe:Sa;nt({items:Ze,loading:!1,error:"",loaded:!0})}catch(oe){nt({items:Sa,loading:!1,error:oe?.message||"Failed to load mentions",loaded:!0})}}},[v,e?.id,i]),Mt=u.useCallback(async()=>{if(!(!e?.id||!i||!v)){wt(oe=>({...oe,loading:!0,error:""}));try{const oe=await qR(e.id,{campaignId:i}),Ze=Array.isArray(oe?.data)?oe.data:Array.isArray(oe)?oe:Sa;wt({items:Ze,loading:!1,error:"",loaded:!0})}catch(oe){wt({items:Sa,loading:!1,error:oe?.message||"Failed to load mentions",loaded:!0})}}},[v,e?.id,i]);u.useEffect(()=>{U==="mentions"&&(!$e.loading&&!$e.loaded&&vt(),!Le.loading&&!Le.loaded&&Mt())},[U,$e.loading,$e.loaded,Le.loading,Le.loaded,vt,Mt]);const Bt=u.useCallback(oe=>{const Ze=fc(oe?.content,oe?.mentions);if(!Ze.length)return"";const Ke=Ze.map(ft=>ft.type==="mention"?`@${ft.entityName||"entity"}`:ft.text||"").join("").replace(/\s+/g," ").trim();return Ke.length<=180?Ke:`${Ke.slice(0,177)}`},[]),Jt=u.useCallback(oe=>{const Ze=oe?.sessionDate??oe?.session_date;if(!Ze)return"";try{const Ke=new Date(Ze);if(!Number.isNaN(Ke.getTime()))return Ke.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch(Ke){return console.warn("Unable to format session date",Ke),Ze}return Ze},[]),Et=u.useCallback(oe=>{const Ze=String(oe);Ct(Ke=>{const ft=new Set(Ke);return ft.has(Ze)?ft.delete(Ze):ft.add(Ze),ft})},[]),zt=u.useCallback(oe=>Tt.has(String(oe)),[Tt]),$t=u.useCallback(()=>{!e?.id||!i||!v||(q==="entity"?vt():Mt())},[v,e?.id,vt,Mt,q,i]),kt=u.useCallback(oe=>{const Ze=fc(oe?.content,oe?.mentions);return Ze.length?Ze.map((Ke,ft)=>{if(Ke.type==="mention"&&Ke.entityId){const Qe=`${oe?.id||"note"}-mention-${ft}`,pt=Ke.entityName||"entity";return a.jsxs("span",{className:"entity-note-mention",children:["@",pt,a.jsx(Ls,{entityId:Ke.entityId,entityName:pt})]},Qe)}return a.jsx("span",{className:"entity-note-text",children:Ke.text},`${oe?.id||"note"}-text-${ft}`)}):null},[]);u.useCallback(oe=>`entity-note-share entity-note-share-${oe}`,[]);const te=Nt.length,be=Ge.length,ve=$e.loading,Be=Le.loading,ot=$e.error,xt=Le.error,re=$e.loaded,je=Le.loaded,He=!i||!v||(q==="entity"?ve:Be),ut=c&&At,dt=ut&&D.length===1,Ee=g,at=g||!E.trim()||c&&!_,le=Te.length===0||mt.length<=1;u.useEffect(()=>{(U!=="notes"||!At)&&I&&Ve()},[U,At,I,Ve]);const st=r?.name||"",ct=u.useCallback(oe=>{const Ze=up(oe),Ke=oe?.character?.name||"";return Ke?`${Ze} (as ${Ke})`:Ze},[]),yt=u.useCallback(oe=>{const Ze=String(oe?.shareType??oe?.share_type??"private");return tI[Ze]||"Private"},[]);return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"entity-notes-card-strict",children:[a.jsxs("div",{className:"entity-notes-header-row",children:[a.jsx("h2",{className:"entity-notes-title",children:"Notes"}),U==="notes"&&At?a.jsx("button",{type:"button",className:"btn-primary",onClick:ee,disabled:g,children:"+ Create note"}):null]}),r?.name?a.jsxs("p",{className:"entity-notes-campaign-line",children:["Campaign: ",st]}):null,a.jsxs("div",{className:"entity-notes-tabs-row",children:[a.jsx("button",{type:"button",className:`entity-notes-strict-tab-button${U==="notes"?" active":""}`,onClick:()=>M("notes"),children:"Notes"}),a.jsx("button",{type:"button",className:`entity-notes-strict-tab-button${U==="mentions"?" active":""}`,onClick:()=>M("mentions"),children:"@Mentions"})]}),U==="notes"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"entity-notes-strict-filter",children:[a.jsx("span",{className:"entity-notes-strict-filter-label",children:"Show notes from"}),a.jsx("select",{className:"entity-notes-strict-filter-select",value:$,onChange:oe=>T(oe.target.value),disabled:le,children:mt.map(oe=>a.jsx("option",{value:oe.value,children:oe.label},oe.value))})]}),p?a.jsxs("div",{className:"entity-notes-strict-alert error",children:[a.jsx(Pa,{size:16}),a.jsx("p",{children:p})]}):null,h?a.jsxs("div",{className:"entity-notes-strict-loading",children:[a.jsx(Nn,{className:"spin",size:20}),a.jsx("span",{children:"Loading notes"})]}):null,!h&&Dt.length===0?a.jsx("p",{className:"entity-notes-strict-empty",children:"No notes yet."}):null,!h&&Dt.length>0?a.jsx("div",{className:"entity-notes-strict-list",children:Dt.map(oe=>{const Ze=oe?.createdAt??oe?.created_at??oe?.timestamp??null,Ke=cp(Ze);String(oe?.shareType??oe?.share_type??"private");const ft=J===oe?.id,Qe=de(oe);return oe?.characterId??oe?.character_id,a.jsx("div",{className:"entity-notes-strict-note-item",children:ft?a.jsxs("div",{className:"entity-notes-strict-edit-panel",children:[a.jsx(Ld,{value:Z,onChange:We,markup:"@[__display__](__id__)",placeholder:SS,className:"entity-note-mentions",inputProps:{className:"entity-notes-strict-textarea","aria-label":"Edit note content",rows:5,required:!0},children:a.jsx(Tl,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(pt,ke)=>`@${ke}`,data:ye,appendSpaceOnAdd:!0})}),a.jsx("p",{className:"entity-notes-strict-share-label",children:"Share with"}),a.jsx("div",{className:"entity-notes-strict-share-options",children:Ue.map(pt=>a.jsxs("label",{className:"entity-notes-strict-share-option",children:[a.jsx("input",{type:"radio",name:`entity-note-share-edit-${oe.id}`,value:pt.value,checked:Q===pt.value,onChange:()=>se(pt.value),disabled:Ie}),pt.value==="private"?"Private":pt.value==="party"?"Share with Party":pt.label]},pt.value))}),G?a.jsxs("div",{className:"entity-notes-strict-alert error",children:[a.jsx(Pa,{size:16}),a.jsx("p",{children:G})]}):null,a.jsxs("div",{className:"entity-notes-strict-edit-actions",children:[a.jsx("button",{type:"button",className:"btn-primary",onClick:()=>Xe(oe),disabled:Ie||!Z.trim(),children:Ie?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:16})," Saving"]}):"Save"}),a.jsx("button",{type:"button",className:"btn-secondary",onClick:Se,disabled:Ie,children:"Cancel"})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"entity-notes-strict-note-header",children:[a.jsxs("div",{className:"entity-notes-strict-note-title-row",children:[a.jsx("span",{className:"entity-notes-strict-note-title",children:ct(oe)}),a.jsx("span",{className:"entity-notes-strict-note-visibility",children:yt(oe)})]}),a.jsx("span",{className:"entity-notes-strict-note-timestamp",children:Ke||""})]}),a.jsx("p",{className:"entity-notes-strict-note-body",children:kt(oe)}),Qe?a.jsxs("div",{className:"entity-notes-strict-note-actions",children:[a.jsx("button",{type:"button",className:"entity-notes-strict-edit-button",onClick:()=>he(oe),children:"Edit"}),a.jsx("button",{type:"button",className:"entity-notes-strict-delete-button",onClick:()=>et(oe),disabled:Ae===oe.id,children:Ae===oe.id?a.jsx(Nn,{className:"spin",size:14}):"Delete"})]}):null]})},oe?.id)})}):null]}):a.jsxs("div",{className:"entity-notes-strict-mentions",children:[a.jsxs("div",{className:"entity-notes-strict-mentions-header",children:[a.jsxs("div",{className:"entity-notes-strict-mention-toggle",children:[a.jsxs("button",{type:"button",className:`entity-notes-strict-mention-toggle-button${q==="entity"?" active":""}`,onClick:()=>Y("entity"),children:["Entity Notes",re?a.jsx("span",{className:"entity-notes-strict-mention-count",children:te}):null]}),a.jsxs("button",{type:"button",className:`entity-notes-strict-mention-toggle-button${q==="session"?" active":""}`,onClick:()=>Y("session"),children:["Session Notes",je?a.jsx("span",{className:"entity-notes-strict-mention-count",children:be}):null]})]}),a.jsx("button",{type:"button",className:"btn-secondary",onClick:$t,disabled:He,children:(q==="entity"?ve:Be)?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:16})," Refreshing"]}):"Refresh"})]}),q==="entity"?a.jsxs(a.Fragment,{children:[ot?a.jsxs("div",{className:"entity-notes-strict-alert error",children:[a.jsx(Pa,{size:16}),a.jsx("p",{children:ot})]}):null,ve?a.jsxs("div",{className:"entity-notes-strict-loading",children:[a.jsx(Nn,{className:"spin",size:20}),a.jsx("span",{children:"Loading mentions"})]}):null,!ve&&re&&te===0?a.jsx("p",{className:"entity-notes-strict-empty",children:"This entity hasn't been mentioned in other entity notes yet."}):null,!ve&&re&&te>0?a.jsx("div",{className:"entity-notes-strict-list",children:Nt.map((oe,Ze)=>{const Ke=oe?.id??oe?.entityNoteId??oe?.entity_note_id??`entity-mention-${Ze}`,ft=String(Ke),Qe=oe?.createdAt??oe?.created_at,pt=Qe?new Date(Qe):null,ke=cp(pt);return String(oe?.shareType??oe?.share_type??"private"),pt&&!Number.isNaN(pt.getTime())&&pt.toISOString(),oe?.entity?.name??oe?.entityName,oe?.entity?.id??oe?.entityId??oe?.entity_id,a.jsxs("div",{className:"entity-notes-strict-note-item",children:[a.jsxs("div",{className:"entity-notes-strict-note-header",children:[a.jsxs("div",{className:"entity-notes-strict-note-title-row",children:[a.jsx("span",{className:"entity-notes-strict-note-title",children:ct(oe)}),a.jsx("span",{className:"entity-notes-strict-note-visibility",children:yt(oe)})]}),a.jsx("span",{className:"entity-notes-strict-note-timestamp",children:ke||""})]}),a.jsx("p",{className:"entity-notes-strict-note-body",children:kt(oe)})]},`entity-mention-${ft}`)})}):null]}):a.jsxs(a.Fragment,{children:[xt?a.jsxs("div",{className:"entity-notes-strict-alert error",children:[a.jsx(Pa,{size:16}),a.jsx("p",{children:xt})]}):null,Be?a.jsxs("div",{className:"entity-notes-strict-loading",children:[a.jsx(Nn,{className:"spin",size:20}),a.jsx("span",{children:"Loading session mentions"})]}):null,!Be&&je&&be===0?a.jsx("p",{className:"entity-notes-strict-empty",children:"This entity hasn't been mentioned in session notes yet."}):null,!Be&&je&&be>0?a.jsx("div",{className:"entity-notes-strict-list",children:Ge.map((oe,Ze)=>{const Ke=oe?.id??oe?.noteId??oe?.note_id??`session-mention-${Ze}`,ft=String(Ke),Qe=zt(ft),pt=Bt(oe),ke=oe?.sessionTitle??oe?.session_title??"Session note";Jt(oe),up(oe);const Pe=oe?.updatedAt??oe?.updated_at??oe?.createdAt??oe?.created_at,ht=Pe?new Date(Pe):null,K=cp(ht),ae=pt||"This session note does not include any text.";return a.jsxs("div",{className:"entity-notes-strict-note-item",children:[a.jsxs("div",{className:"entity-notes-strict-note-header",children:[a.jsx("div",{className:"entity-notes-strict-note-title-row",children:a.jsx("span",{className:"entity-notes-strict-note-title",children:ke})}),a.jsx("span",{className:"entity-notes-strict-note-timestamp",children:K||""})]}),Qe?a.jsx("p",{className:"entity-notes-strict-note-body",children:kt(oe)}):a.jsx("p",{className:"entity-notes-strict-note-body",children:ae}),a.jsx("div",{className:"entity-notes-strict-note-actions",children:a.jsx("button",{type:"button",className:"entity-notes-strict-action-button",onClick:()=>Et(ft),children:Qe?"Hide note":"View note"})})]},`session-mention-${ft}`)})}):null]})]})]}),a.jsx(Xr,{isOpen:I&&At,onClose:Ve,title:"Create note",children:a.jsx("div",{className:"entity-notes-form",children:a.jsxs("form",{onSubmit:me,className:"entity-notes-form-body",children:[a.jsx("label",{className:"entity-notes-label",htmlFor:"entity-note-content",children:"Note"}),a.jsx("div",{className:"entity-note-editor-field",children:a.jsx(Ld,{value:E,onChange:ue,markup:"@[__display__](__id__)",placeholder:SS,className:"entity-note-mentions",inputProps:{id:"entity-note-content",className:"entity-note-textarea","aria-label":"Entity note content",rows:5,required:!0,"data-autofocus":!0},children:a.jsx(Tl,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(oe,Ze)=>`@${Ze}`,data:ye,appendSpaceOnAdd:!0})})}),a.jsxs("fieldset",{className:"entity-notes-share",children:[a.jsx("legend",{children:"Share with"}),Ue.map(oe=>a.jsxs("label",{className:"entity-notes-share-option",children:[a.jsx("input",{type:"radio",name:"entity-note-share",value:oe.value,checked:A===oe.value,onChange:()=>O(oe.value),disabled:Ee}),a.jsx("span",{children:oe.label})]},oe.value))]}),ut?a.jsxs("div",{className:"entity-notes-character",children:[a.jsx("label",{htmlFor:"entity-note-character",children:"Character"}),a.jsxs("select",{id:"entity-note-character",value:_,onChange:oe=>R(oe.target.value),disabled:z||dt,required:!0,children:[a.jsx("option",{value:"",disabled:!0,children:z?"Loading characters":"Select character"}),D.map(oe=>a.jsx("option",{value:oe.id,children:oe.name},oe.id))]}),dt?a.jsxs("p",{className:"entity-notes-hint",children:["Notes will be associated with your character ",D[0]?.name,"."]}):null,X?a.jsxs("div",{className:"entity-notes-alert error",children:[a.jsx(Pa,{size:16}),a.jsx("p",{children:X})]}):null,!z&&!X&&D.length===0?a.jsx("p",{className:"entity-notes-hint",children:"You need an active character in this campaign to attach notes."}):null]}):null,G?a.jsxs("div",{className:"entity-notes-alert error",children:[a.jsx(Pa,{size:16}),a.jsx("p",{children:G})]}):null,k?a.jsx("div",{className:"entity-notes-alert success",children:a.jsx("p",{children:k})}):null,a.jsx("div",{className:"entity-notes-actions",children:a.jsx("button",{type:"submit",className:"primary",disabled:at,children:g?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:16})," Saving"]}):"Save note"})})]})})})]})}kN.propTypes={entity:ln.object,worldId:ln.oneOfType([ln.string,ln.number]),selectedCampaign:ln.object,selectedCampaignId:ln.oneOfType([ln.string,ln.number]),isCampaignDm:ln.bool,isCampaignPlayer:ln.bool,canCreateNote:ln.bool,notes:ln.arrayOf(ln.object),loading:ln.bool,error:ln.string,onCreateNote:ln.func,creating:ln.bool,campaignMatchesEntityWorld:ln.bool,onNoteUpdate:ln.func,onNoteDelete:ln.func};const sI=e=>{const t=e?.options?.choices;return!Array.isArray(t)||t.length===0?[]:t.map((r,i)=>{if(r==null)return null;if(typeof r=="object"){const c=r.value??r.id??r.key??r.slug??`choice-${i}`,f=r.label??r.name??r.title??r.display??c;return c==null?null:{value:c,label:String(f??c)}}const l=String(r);return{value:l,label:l}}).filter(Boolean)},rI=e=>{if(!e?.name)return null;const t=`metadata.${e.name}`,r=e.visibleByDefault!==void 0?!!e.visibleByDefault:e.visible_by_default!==void 0?!!e.visible_by_default:!0,i={key:t,name:t,label:e.label||e.name,metadataField:e.name,dataType:e.dataType,visibleByDefault:r};switch(e.dataType){case"text":return{...i,type:"textarea",rows:3};case"boolean":return{...i,type:"boolean"};case"enum":return{...i,type:"select",options:sI(e)};case"number":return{...i,type:"text",inputType:"number"};case"date":return{...i,type:"text"};case"reference":{const l=e.referenceTypeId??e.reference_type_id??e.referenceType?.id??null,c=e.referenceTypeName??e.reference_type_name??e.referenceType?.name??"",f=e.referenceFilter??e.reference_filter??e.referenceFilterJson??{},m=(()=>{if(e.displayValue)return String(e.displayValue);if(e.display)return String(e.display);if(e.selectedLabel)return String(e.selectedLabel);const h=e.value;if(!h||typeof h!="object")return"";const p=h.label??h.name??h.title??h.display??h.displayName??h.text??h.value;return p!=null?String(p):""})();return{...i,type:"reference",referenceTypeId:l,referenceTypeName:c,referenceFilter:f,displayKey:`metadataDisplay.${e.name}`,selectedLabel:m}}default:return{...i,type:"text"}}},Xu=(e,t,r="")=>{if(e!=null){const i=String(e).trim();if(i)return i}if(t!=null){const i=String(t).trim();if(i)return`name:${i.toLowerCase()}`}if(r){const i=String(r).trim();if(i)return`label:${i.toLowerCase().normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"fallback"}`}return""};function iI(){const{id:e}=Ss(),t=$n(),r=Xa(),{user:i,token:l,sessionReady:c}=En(),{selectedCampaign:f,selectedCampaignId:m,setSelectedCampaignId:h}=Un(),p=zy(),[y,g]=u.useState(null),v=u.useCallback(ge=>{const Re=Va(ge);Re&&g(bt=>bt?!Re.permissions&&bt.permissions?{...Re,permissions:bt.permissions}:(Re.permissions,Re):Re)},[]),[S,w]=u.useState(!0),[N,E]=u.useState(""),[C,A]=u.useState(""),[O,_]=u.useState("dossier"),[R,D]=u.useState(!1),[j,z]=u.useState(!1),[P,X]=u.useState(null),[H,G]=u.useState({items:[],loading:!1,error:""}),[V,k]=u.useState(!1),F=u.useRef(null),[I,L]=u.useState({isDirty:!1,isSubmitting:!1}),[$,T]=u.useState(!1),[U,M]=u.useState(null),q=u.useRef(null),[Y,J]=u.useState(!1),[ie,Z]=u.useState([]),[fe,Q]=u.useState(""),[se,ne]=u.useState(!1),[we,Ie]=u.useState([]),[Me,Ae]=u.useState([]),[it,$e]=u.useState(()=>Qh()),nt=u.useRef(r),Le=u.useRef(null),Tt=u.useMemo(()=>!f||!i?.id?null:(Array.isArray(f.members)?f.members:[]).find(bt=>{if(!bt)return!1;const It=bt.user_id??bt.userId??bt.user?.id??bt.id??null;return It?String(It)===String(i.id):!1})||null,[f,i?.id])?.role??null,Ct=u.useMemo(()=>i?.role==="system_admin"?!0:Tt==="dm",[Tt,i?.role]),At=u.useMemo(()=>Tt==="player",[Tt]),Ue=u.useMemo(()=>!!(Ct||At),[Ct,At]),Je=u.useMemo(()=>y?y.world?.id?String(y.world.id):y.world_id?String(y.world_id):y.worldId?String(y.worldId):"":"",[y]),de=u.useMemo(()=>f?f.world?.id?String(f.world.id):f.world_id?String(f.world_id):"":"",[f]),ue=u.useMemo(()=>!m||!Je||!de?!0:String(Je)===String(de),[m,Je,de]),ye=r.state?.fromEntities?.search||"",Ve=u.useMemo(()=>ye?ye.startsWith("?")?`/entities${ye}`:`/entities?${ye}`:"/entities",[ye]),ee=u.useCallback(ge=>{if(!ge)return"the next page";const Re=ge.pathname||"",bt=ge.search||"",It=`${Re}${bt}`;return It?It===Ve?"the previous page":It:"the next page"},[Ve]),me=u.useCallback(ge=>{if(!ge)return"";const Re=ge.pathname||"",bt=ge.search||"",It=ge.hash||"";return`${Re}${bt}${It}`},[]),he=u.useCallback(ge=>{if(!ge||typeof ge!="string")return null;const Re=ge.indexOf("#"),bt=ge.indexOf("?");let It=ge.length;Re>=0&&(It=Re),bt>=0&&bt<It&&(It=bt);const Gt=ge.slice(0,It)||"",an=bt>=0?ge.slice(bt,Re>=0?Re:void 0):"",xn=Re>=0?ge.slice(Re):"";return{pathname:Gt,search:an,hash:xn}},[]),Se=u.useCallback(ge=>{if(ge){if(ge.externalUrl){typeof window<"u"&&window.location.assign(ge.externalUrl);return}if(ge.to!==void 0&&ge.to!==null){const Re=ge.to;if(typeof Re=="string"){Le.current=Re,t(Re,{replace:ge.replace,state:ge.state});return}const bt=me(Re);bt&&(Le.current=bt),t(Re,{replace:ge.replace,state:ge.state})}}},[me,t]),We=u.useCallback(ge=>{ge&&g(Re=>{if(!Re)return Re;const bt=Array.isArray(Re.secrets)?Re.secrets:[],It=bt.findIndex(Kt=>!Kt||!ge||!Kt.id||!ge.id?!1:String(Kt.id)===String(ge.id)),Gt=It>=0?bt.map((Kt,vn)=>vn===It?ge:Kt):[...bt,ge],an=Kt=>{if(!Kt)return 0;const vn=new Date(Kt).getTime();return Number.isNaN(vn)?0:vn},xn=Gt.slice().sort((Kt,vn)=>an(Kt?.created_at||Kt?.createdAt)-an(vn?.created_at||vn?.createdAt));return{...Re,secrets:xn}})},[]),Xe=u.useCallback(async()=>{const ge=await BR(e,{campaignId:m});return Array.isArray(ge?.data)?ge.data:Array.isArray(ge)?ge:[]},[e,m]);u.useEffect(()=>{let ge=!1;return!e||!m||!ue?(G({items:[],loading:!1,error:""}),()=>{ge=!0}):(G(bt=>({...bt,loading:!0,error:""})),(async()=>{try{const bt=await Xe();ge||G({items:bt,loading:!1,error:""})}catch(bt){if(!ge){const an=(bt.status===403||bt.status==="403"||bt.message==="Forbidden")&&!!m?"CAMPAIGN_CONTEXT_ACCESS_DENIED":bt.message||"Failed to load notes";G(xn=>({...xn,loading:!1,error:an}))}}})(),()=>{ge=!0})},[e,m,ue,Xe]);const et=u.useCallback(async()=>{if(!e||!m||!ue){G({items:[],loading:!1,error:""});return}G(ge=>({...ge,loading:!0,error:""}));try{const ge=await Xe();G({items:ge,loading:!1,error:""})}catch(ge){G(Re=>({...Re,loading:!1,error:ge.message||"Failed to load notes"}))}},[e,m,ue,Xe]),Te=u.useCallback(async ge=>{if(!e)return{success:!1,message:"Entity not found"};if(!m)return{success:!1,message:"Select a campaign first"};k(!0);try{const Re={...ge,campaignId:ge?.campaignId??m},bt=await HR(e,Re),It=bt?.data||bt;if(!It)throw new Error("Note could not be created");const Gt=It?.createdAt??It?.created_at??new Date().toISOString(),an=It?.createdAt&&It?.created_at?It:{...It,...It?.createdAt?{}:{createdAt:Gt},...It?.created_at?{}:{created_at:Gt}};return G(xn=>{const Kt=Array.isArray(xn?.items)?xn.items.slice():[],vn=It?.id,ca=vn?Kt.filter(Yt=>Yt?.id!==vn):Kt;return{items:[an,...ca],loading:!1,error:""}}),{success:!0,note:an}}catch(Re){return{success:!1,message:Re.message||"Failed to create note"}}finally{k(!1)}},[e,m]),mt=u.useCallback(async ge=>{if(!ge?.id)return;const Re=ge?.updatedAt??ge?.updated_at??ge?.createdAt??ge?.created_at??new Date().toISOString(),bt=ge?.updatedAt&&ge?.updated_at?ge:{...ge,...ge?.updatedAt?{}:{updatedAt:Re},...ge?.updated_at?{}:{updated_at:Re}};G(It=>{const Gt=Array.isArray(It?.items)?It.items.slice():[],an=bt?.id;if(!an)return It;const xn=Gt.findIndex(Kt=>Kt?.id===an);if(xn>=0){const Kt=[...Gt];return Kt[xn]=bt,{items:Kt,loading:!1,error:""}}return{items:[bt,...Gt],loading:!1,error:""}})},[]),Dt=u.useCallback(async ge=>{ge&&G(Re=>({items:(Array.isArray(Re?.items)?Re.items.slice():[]).filter(Gt=>Gt?.id!==ge),loading:!1,error:""}))},[]),Nt=u.useMemo(()=>y?.permissions&&typeof y.permissions.canEdit=="boolean"?y.permissions.canEdit:!y||!i?!1:!!(i.role==="system_admin"||y.world?.created_by&&y.world.created_by===i.id||y.created_by&&y.created_by===i.id),[y,i]),Ge=u.useMemo(()=>Array.isArray(y?.secrets)?y.secrets:[],[y?.secrets]),vt=u.useMemo(()=>!!y?.permissions?.canManageSecrets,[y?.permissions?.canManageSecrets]),Mt=vt||Ge.length>0,Bt=u.useMemo(()=>{const ge=[{id:"dossier",label:"Dossier"},{id:"notes",label:"Notes"},{id:"relationships",label:"Relationships"}];return Mt&&ge.push({id:"secrets",label:"Secrets"}),Nt&&R&&ge.push({id:"access",label:"Access"}),ge.push({id:"system",label:"System"}),ge},[Mt,Nt,R]);u.useEffect(()=>{new Set(Bt.map(Re=>Re.id)).has(O)||_("dossier")},[Bt,O]);const Jt=u.useCallback((ge,Re,bt,It=null)=>{if(!ge)return null;const Gt=Array.isArray(ge.sections)?ge.sections:[],an=It?.actionsByField??{},xn=It?.showRuleTargets??new Set;return Gt.map((Kt,vn)=>{const ca=`${bt||"section"}-${Kt.title||vn}`,Yt=Number.isFinite(Kt.columns)?Math.max(1,Number(Kt.columns)):1,Wn=Array.isArray(Kt.fields)?Kt.fields:[];return a.jsxs("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:[Kt.title?a.jsx("h2",{className:"entity-card-title",children:Kt.title}):null,a.jsx("div",{className:`entity-field-grid ${Yt>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":""}`,style:{"--entity-field-columns":Yt},children:Wn.length>0?Wn.map((Ka,Ii)=>{const Li=Ka?.key||Ka?.name||Ka?.field||`${ca}-field-${Ii}`,Oi=an[Li],zi=Ka.visibleByDefault!==void 0?!!Ka.visibleByDefault:Ka.visible_by_default!==void 0?!!Ka.visible_by_default:!0;return cc(Li,Oi,xn,zi)?null:a.jsx(ff,{field:{...Ka},data:Re,mode:"view"},Li)}):a.jsx("p",{className:"entity-empty-state",children:"No fields available."})})]},ca)})},[]);u.useEffect(()=>{if(!P)return;const ge=setTimeout(()=>X(null),4e3);return()=>clearTimeout(ge)},[P]);const Et=u.useCallback(async()=>{if(e){w(!0),E(""),A("");try{const ge=await or(e),Re=Va(ge);if(!Re){g(null),E("Entity not found");return}v(Re)}catch(ge){const Re=ge.status===403||ge.status==="403"||ge.message==="Forbidden";E(Re&&!!m?"CAMPAIGN_CONTEXT_ACCESS_DENIED":ge.message||"Failed to load entity"),g(null)}finally{w(!1)}}},[e,v,m]),zt=u.useCallback(async ge=>{if(!ge){Ie([]),Ae([]);return}try{const[Re,bt]=await Promise.all([of(ge).catch(()=>null),cf(ge).catch(()=>null)]);Ie(Kr(Re)),Ae(Kr(bt))}catch{Ie([]),Ae([])}},[]);u.useEffect(()=>{c&&l&&Et()},[c,l,Et]),u.useEffect(()=>{const ge=y?.entity_type_id||y?.entityType?.id||y?.entity_type?.id||null;if(!ge){Ie([]),Ae([]);return}zt(ge)},[y?.entity_type_id,y?.entityType?.id,y?.entity_type?.id,zt]);const $t=u.useMemo(()=>Array.isArray(y?.fields)?qy(y.fields,we).map(Re=>rI(Re)).filter(Boolean):[],[y?.fields,we]),kt=u.useMemo(()=>!y?.fields||y.fields.length===0?{__placeholder:"No metadata defined for this entity type."}:eN(y.fields),[y]),te=y?.fields,be=u.useMemo(()=>Py(Me,te),[Me,te]),ve=u.useMemo(()=>!y?.fields||y.fields.length===0?{}:qk(y.fields),[y]),Be=u.useMemo(()=>!y?.fields||y.fields.length===0?{}:Uk(y.fields),[y]),ot=u.useMemo(()=>{if(!y?.id)return null;const ge=y?.entityType?.name||y?.entity_type?.name||y?.entityTypeName||"entity";return{id:y.id,type:`entity:${ge}`,title:y.name||"Untitled entity",worldId:Je,worldName:y?.world?.name||y?.world_name||""}},[y?.id,y?.name,y?.entityType?.name,y?.entity_type?.name,y?.entityTypeName,Je,y?.world?.name,y?.world_name]);D1(ot);const xt=u.useRef(null),re=u.useRef(!1),je=u.useRef(!1);u.useEffect(()=>{const ge=y?.id,Re=xt.current;ge!==Re&&Re!==null&&!je.current&&(D(!1),re.current=!1),xt.current=ge},[y?.id,R]);const He=y?.createdAt||y?.created_at,ut=y?.updatedAt||y?.updated_at,dt=u.useMemo(()=>y?{name:y.name||"",description:y.description||"",typeName:y.entityType?.name||y.entity_type?.name||"",worldName:y.world?.name||y.world_name||"",worldId:Je,createdAt:Vr(He),updatedAt:Vr(ut),metadata:kt,metadataDisplay:ve,createdBy:y.creator?.username||y.creator?.email||y.created_by||"",updatedBy:y.updated_by||""}:null,[y,kt,ve,Je,He,ut]),Ee=u.useMemo(()=>Vy(be,dt||{}),[be,dt]),at=u.useMemo(()=>y?{name:y.name||"",description:y.description||"",visibility:y.visibility||"visible",entityTypeName:y.entityType?.name||y.entity_type?.name||"",worldName:y.world?.name||y.world_name||"",worldId:Je,createdAt:Vr(He),updatedAt:Vr(ut),metadata:Be}:null,[y,Je,He,ut,Be]);u.useEffect(()=>{if(!R||!y||!at||!F.current?.reset||!re.current)return;const ge=setTimeout(()=>{F.current?.reset&&at&&F.current.reset(at),re.current=!1},150);return()=>clearTimeout(ge)},[R,y,at]);const le=u.useMemo(()=>{if(!y)return"";const ge=y.imageMimeType||y.image_mime_type||"",Re=y.imageData||y.image_data||"";return!ge||!Re?"":`data:${ge};base64,${Re}`},[y]),st=u.useMemo(()=>!y||!Nt?null:a.jsx(N4,{entity:y,canEdit:Nt,isEditing:R,onEntityUpdate:v,variant:R?"compact":"card"}),[y,Nt,R,v]),ct="Information",yt=u.useMemo(()=>{const ge=$t.length>0;return{title:"Edit Entity",sections:[{title:"Edit Entity",columns:2,fields:[{key:"name",label:"Name",type:"text"},{key:"entityTypeName",label:"Type",type:"readonly"},{key:"description",label:"Description",type:"textarea",rows:4,span:2}]},{title:ct,columns:ge?2:1,fields:ge?$t:[{key:"metadata.__placeholder",name:"metadata.__placeholder",label:"Information",type:"readonly"}]}]}},[$t,ct]),oe=u.useMemo(()=>{const ge=$t.length>0?$t:[{key:"metadata.__placeholder",name:"metadata.__placeholder",label:"Information",type:"readonly"}];return{title:"Entity Overview",sections:[{title:"Summary",columns:2,fields:[{key:"name",label:"Name",type:"readonly"},{key:"typeName",label:"Type",type:"readonly"}]},{title:"Description",columns:1,fields:[{key:"description",label:"Description",type:"textarea",rows:4}]},{title:ct,columns:$t.length>0?2:1,fields:ge}]}},[$t,ct]),Ze=u.useMemo(()=>({sections:[{title:"System",columns:2,fields:[{key:"worldName",label:"World",type:"readonly"},{key:"createdAt",label:"Created",type:"readonly"},{key:"createdBy",label:"Created by",type:"readonly"},{key:"updatedAt",label:"Updated",type:"readonly"},{key:"updatedBy",label:"Updated by",type:"readonly"}]}]}),[]),{accessSettings:Ke,accessOptions:ft,accessOptionsError:Qe,accessOptionsLoading:pt,accessSaving:ke,accessSaveError:Pe,accessSaveSuccess:ht,isAccessDirty:K,handleAccessSettingChange:ae,resetAccessSettings:Ne,handleAccessSave:qe}=O4(y,l,Nt),gt=u.useMemo(()=>y?.world?.id||y?.world_id||"",[y]),St=y?.id?String(y.id):"",_t=u.useCallback(async()=>{if(!St||!l){Z([]),Q(""),ne(!1);return}ne(!0),Q("");try{const ge=await _4(St),Re=Array.isArray(ge)?ge:Array.isArray(ge?.data)?ge.data:[];Z(Re)}catch(ge){Z([]),Q(ge.message||"Failed to load relationships")}finally{ne(!1)}},[St,l]);u.useEffect(()=>{_t()},[_t]);const qt=u.useMemo(()=>{if(!Array.isArray(ie))return[];const ge=Re=>Re?typeof Re=="string"||typeof Re=="number"?String(Re).trim():typeof Re=="object"?String(Re.id||Re.entity_id||Re.entityId||"").trim():"":"";return ie.map(Re=>{const bt=Re.relationshipType||Re.relationship_type||Re.type||Re.relationshipTypeId||{},It=bt?.from_name||bt?.fromName||Re.source_relationship_label||Re.sourceLabel||"",Gt=bt?.to_name||bt?.toName||Re.target_relationship_label||Re.targetLabel||"";return{id:Re.id,typeId:ge(Re.relationship_type_id||Re.relationshipTypeId||Re.typeId||Re.type),typeName:Re.relationshipType?.name||Re.type?.name||"",fromId:ge(Re.from_entity_id||Re.fromEntityId||Re.from),toId:ge(Re.to_entity_id||Re.toEntityId||Re.to),fromName:Re.from_entity?.name||Re.from?.name||"",toName:Re.to_entity?.name||Re.to?.name||"",fromEntityTypeName:Re.from_entity_type?.name||Re.fromEntityTypeName||"",toEntityTypeName:Re.to_entity_type?.name||Re.toEntityTypeName||"",direction:Re.context?.__direction==="reverse"?"reverse":"forward",sourceLabel:It||"",targetLabel:Gt||""}})},[ie]),en=u.useMemo(()=>qt.filter(ge=>ge.fromId===St||ge.toId===St).sort((ge,Re)=>{const bt=ge.fromId===St?ge.toName:ge.fromName,It=Re.fromId===St?Re.toName:Re.fromName;return bt.localeCompare(It,void 0,{sensitivity:"base"})}),[qt,St]),dn=u.useMemo(()=>{const ge=new Map,Re=new Map;en.forEach(Gt=>{const an=Gt.typeName||"Unknown type",xn=Xu(Gt.typeId,Gt.typeName,an);xn&&!ge.has(xn)&&ge.set(xn,an);const vn=Gt.fromId===St?Gt.toEntityTypeName:Gt.fromEntityTypeName,ca=Xu(null,vn,vn);ca&&!Re.has(ca)&&Re.set(ca,vn)});const bt=Array.from(ge.entries()).map(([Gt,an])=>({value:Gt,label:an})),It=Array.from(Re.entries()).map(([Gt,an])=>({value:Gt,label:an}));return{relationshipTypes:bt,relatedEntityTypes:It}},[en,St]),Zt=u.useMemo(()=>{const ge=it.relationshipTypes||{mode:"all",values:[]},Re=it.relatedEntityTypes||{mode:"all",values:[]};return en.filter(bt=>{const It=Xu(bt.typeId,bt.typeName,bt.typeName);if(ge.mode!=="all"&&ge.values.length){const Gt=It&&ge.values.includes(It);if(ge.mode==="include"&&!Gt||ge.mode==="exclude"&&Gt)return!1}if(Re.mode!=="all"&&Re.values.length){const an=bt.fromId===St?bt.toEntityTypeName:bt.fromEntityTypeName,xn=Xu(null,an,an),Kt=xn&&Re.values.includes(xn);if(Re.mode==="include"&&!Kt||Re.mode==="exclude"&&Kt)return!1}return!0})},[en,it,St]),sa=u.useCallback(ge=>{$e(!ge||typeof ge!="object"?Qh():ge)},[]),ba=u.useCallback(()=>{$e(Qh())},[]),zs=se,va=u.useMemo(()=>`No relationships found for ${y?.name||"this entity"}.`,[y?.name]),$s=u.useCallback(async()=>{if(!Nt)return!1;je.current=!0;let ge=!0,Re=!1;try{if(I.isDirty&&F.current?.submit&&await F.current.submit()===!1&&(ge=!1),ge&&K&&(await qe()?Re=!0:ge=!1),ge&&Re&&y?.id)try{const bt=await or(y.id),It=Va(bt);It&&v(It)}catch{}return ge}finally{setTimeout(()=>{je.current=!1},200)}},[Nt,I.isDirty,K,qe,y?.id,v,R]),la=u.useCallback(()=>{const ge=q.current;M(null),ge?.proceed?.()},[]),ei=u.useCallback(async()=>{J(!0);try{if(await $s()){T(!1);const Re=q.current;Re?.type!=="exit-edit"?la():(M(null),Re?.proceed?.())}}finally{J(!1)}},[$s,la]),ti=u.useCallback(()=>{F.current?.reset?.(at||{}),Ne()},[at,Ne]),qn=u.useMemo(()=>R&&(I.isDirty||K),[R,I.isDirty,K]),La=u.useCallback(()=>{D(!1),_("dossier")},[_,y?.id,Nt,qn]),Ns=u.useCallback(ge=>{if(!ge)return;const Re=()=>{if(ge.label)return ge.label;if(ge.externalUrl)return ge.externalLabel||ge.externalUrl;if(typeof ge.to=="string"){const bt=ge.location||he(ge.to);return ee(bt)}return ee(ge.location||ge.to)};if(!qn){Se(ge);return}M({type:"navigation",label:Re(),proceed:()=>Se(ge),discard:()=>Se(ge),stay:()=>{}}),T(!0)},[ee,qn,he,Se,M,T]);u.useEffect(()=>{if(typeof document>"u"||!qn)return;const ge=Re=>{if(!qn||Re.defaultPrevented||Re.button!==0||Re.metaKey||Re.ctrlKey||Re.shiftKey||Re.altKey)return;const bt=Re.target,It=bt instanceof Element?bt:bt&&"parentElement"in bt?bt.parentElement:null;if(!It||typeof It.closest!="function")return;const Gt=It.closest("a[href]");if(!Gt||Gt.hasAttribute("data-ignore-unsaved-warning"))return;const an=Gt.getAttribute("href");if(!an||an.startsWith("#")||an.startsWith("javascript:"))return;const xn=Gt.getAttribute("target");if(xn&&xn.toLowerCase()!=="_self")return;let Kt;try{Kt=new URL(an,window.location.href)}catch{return}const vn=Gt.getAttribute("data-navigation-label")||Gt.getAttribute("aria-label")||Gt.title||Gt.textContent?.trim()||"",ca=Kt.origin!==window.location.origin;if(Re.preventDefault(),Re.stopPropagation(),ca){Ns({externalUrl:Kt.href,label:vn||Kt.href});return}const Yt=`${Kt.pathname}${Kt.search}${Kt.hash}`,Wn=`${window.location.pathname}${window.location.search}${window.location.hash}`;!Yt||Yt===Wn||Ns({to:Yt,location:he(Yt),label:vn||ee({pathname:Kt.pathname,search:Kt.search})})};return document.addEventListener("click",ge,!0),()=>{document.removeEventListener("click",ge,!0)}},[ee,qn,he,Ns]);const ce=u.useCallback(()=>{const ge=`/entities/${e}/relationship-viewer`;Ns({to:ge,location:he(ge)})},[e,he,Ns]),_e=u.useCallback(()=>{if(Nt){if(A(""),!R){D(!0);return}if(qn){M({type:"exit-edit",label:"view mode",proceed:async()=>{await $s()&&La()},discard:()=>{ti(),La()}}),T(!0);return}La()}},[Nt,La,qn,R,ti,$s]),Ht=u.useCallback(async ge=>{if(!y?.id)return!1;A("");try{const Re={name:ge?.name,description:ge?.description,metadata:ge?.metadata||{}};y?.visibility&&(Re.visibility=y.visibility);const bt=await By(y.id,Re),It=Va(bt);if(!It)throw new Error("Failed to update entity");return v(It),re.current=!0,{message:"Entity updated successfully."}}catch(Re){return A(Re.message||"Failed to update entity"),re.current=!1,!1}},[y?.id,y?.visibility,v,R]),pn=u.useCallback(ge=>{L(Re=>{const bt={isDirty:!!ge?.isDirty,isSubmitting:!!ge?.isSubmitting};return Re.isDirty===bt.isDirty&&Re.isSubmitting===bt.isSubmitting?Re:bt})},[y?.id,R]),fn=u.useCallback(ge=>{!ge||ge===O||_(ge)},[O,_]),Pt=u.useCallback(()=>{T(!1);const ge=q.current;M(null),ge?.discard?.()},[]),jn=u.useCallback(()=>{T(!1);const ge=q.current;M(null),ge?.stay?.()},[]);m1(u.useCallback(ge=>{qn&&(ge.preventDefault(),ge.returnValue="")},[qn]),{capture:!0});const Hn=u.useCallback(({currentLocation:ge,nextLocation:Re})=>!qn||!Re?!1:!(ge.pathname===Re.pathname&&ge.search===Re.search&&ge.hash===Re.hash),[qn]),Bn=z4(Hn);if(u.useEffect(()=>{q.current=U},[U]),u.useEffect(()=>{if(Bn.state==="blocked"){if(!qn){Bn.reset?.();return}if(U){if(U.type==="navigation")return;Bn.reset?.();return}M({type:"navigation",label:ee(Bn.location),proceed:()=>Bn.proceed?.(),discard:()=>Bn.proceed?.(),stay:()=>Bn.reset?.()}),T(!0)}},[Bn,qn,U,ee]),u.useEffect(()=>{const ge=nt.current,Re=me(ge),bt=me(r);if(Re===bt){nt.current=r;return}if(!qn){nt.current=r,Le.current=null;return}if(Le.current&&Le.current===bt){Le.current=null,nt.current=r;return}if(!ge||U){nt.current=ge||r;return}const It=bt||"/",Gt=Re||"/",an=()=>{Le.current=It,t(It)},xn=()=>{Le.current=Gt,t(Gt)};M({type:"navigation",label:ee(r),proceed:an,discard:an,stay:xn}),T(!0),Le.current=Gt,t(Gt,{replace:!0})},[me,ee,qn,r,t,U]),!c)return a.jsx("p",{children:"Restoring session..."});if(!l)return a.jsx("p",{children:"Authenticating..."});if(S)return a.jsx("p",{children:"Loading entity..."});if(N==="CAMPAIGN_CONTEXT_ACCESS_DENIED")return a.jsxs("div",{className:"alert error",style:{padding:"1.5rem",maxWidth:"600px",margin:"2rem auto"},children:[a.jsx("h2",{style:{marginTop:0,marginBottom:"1rem"},children:"Access Restricted by Campaign Context"}),a.jsx("p",{style:{marginBottom:"1rem"},children:"You don't have access to this entity with your current campaign context selected. This entity may belong to a different campaign or world, or your current campaign context doesn't have permission to view it."}),a.jsx("p",{style:{marginBottom:"1.5rem"},children:"To view this entity, please change your campaign context using the selector in the header to a campaign that has access to this entity."}),a.jsx("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap"},children:a.jsx("button",{type:"button",onClick:()=>t("/entities"),style:{padding:"0.5rem 1rem",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Go to Entities"})})]});if(N)return a.jsx("div",{className:"alert error",children:N});if(!y||!dt)return a.jsx("p",{children:"Entity not found"});const oa=`entity-detail-page${p?" entity-detail-page--mobile":""}`;return a.jsxs(a.Fragment,{children:[a.jsx(mN,{maxWidth:1280,className:oa,children:a.jsxs("div",{className:"w-full max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 overflow-x-hidden",children:[a.jsx("header",{className:"entity-page-header",children:a.jsxs("div",{className:"entity-page-header__inner",children:[a.jsx(m4,{entityId:e,name:y.name,canEdit:Nt,isEditing:R,onToggleEdit:_e,onSave:$s,isSaving:I.isSubmitting||ke,isSaveDisabled:!I.isDirty&&!K}),a.jsxs("div",{className:"entity-page-header__tabs flex flex-wrap items-center justify-between gap-4 mt-4",children:[a.jsx(o4,{tabs:Bt,activeTab:O,onChange:fn}),e&&a.jsx(p4,{entityId:e,importance:y.importance,onUpdate:ge=>{g(Re=>Re?{...Re,importance:ge}:null)}})]})]})}),a.jsx("div",{className:"entity-detail-shell",children:a.jsxs("div",{className:"entity-detail-body",children:[a.jsx("div",{className:"entity-tab-panel",role:"tabpanel",hidden:O!=="dossier",children:a.jsx($4,{isEditing:R,canEdit:Nt,formError:C,formRef:F,editSchema:yt,editInitialData:at,handleUpdate:Ht,handleFormStateChange:pn,dossierSchema:oe,viewData:dt,featuredImageSrc:le,renderSchemaSections:Jt,imageSection:st,fieldRules:be,viewRuleContext:Ee})}),O==="notes"&&a.jsx(kN,{entity:y,worldId:Je,selectedCampaign:f,selectedCampaignId:m,isCampaignDm:Ct,isCampaignPlayer:At,canCreateNote:Ue,notes:H.items,loading:H.loading,error:H.error,onReload:et,onCreateNote:Te,onNoteUpdate:mt,onNoteDelete:Dt,creating:V,campaignMatchesEntityWorld:ue}),O==="relationships"&&a.jsx(F4,{entity:y,toast:P,onExplore:ce,canEdit:Nt,relationshipsLoading:se,relationshipsError:fe,sortedRelationships:en,filteredRelationships:Zt,relationshipsEmptyMessage:va,relationshipFilters:it,relationshipFilterOptions:dn,filterButtonDisabled:zs,handleRelationshipFiltersChange:sa,handleRelationshipFiltersReset:ba,showRelationshipForm:j,setShowRelationshipForm:z,worldId:gt,loadRelationships:_t}),O==="secrets"&&Mt&&a.jsx(H4,{entity:y,secrets:Ge,worldId:gt,canManageSecrets:vt,onSecretCreated:We,onSecretUpdated:We}),O==="access"&&R&&Nt&&a.jsx(B4,{canEdit:Nt,worldId:gt,accessSettings:Ke,accessOptions:ft,accessOptionsError:Qe,accessOptionsLoading:pt,accessSaving:ke,accessSaveError:Pe,accessSaveSuccess:ht,handleAccessSettingChange:ae}),O==="system"&&a.jsx(U4,{renderSchemaSections:Jt,systemSchema:Ze,viewData:dt})]})})]})}),a.jsx(hN,{open:$,destinationLabel:U?.label||"",saving:Y,onSaveAndContinue:ei,onContinueWithoutSaving:Pt,onStay:jn})]})}function lI({initialData:e={},onSubmit:t,onCancel:r,submitting:i=!1,errorMessage:l,worlds:c=[]}){const[f,m]=u.useState({name:"",description:"",worldId:""}),[h,p]=u.useState("");u.useEffect(()=>{const S=e?.world_id||e?.worldId||e?.world?.id||"";m({name:e?.name||"",description:e?.description||"",worldId:S?String(S):""}),p("")},[e]);const y=u.useMemo(()=>f.name!==(e?.name||"")||f.description!==(e?.description||"")||f.worldId!==(e?.world_id||e?.worldId||e?.world?.id||""),[e,f.description,f.name,f.worldId]);u.useEffect(()=>{p(l||"")},[l]);const g=S=>w=>{const{value:N}=w.target;m(E=>({...E,[S]:N}))},v=async S=>{S.preventDefault();const w=f.name.trim();if(!w){p("Name is required.");return}const N=f.worldId.trim();if(!N){p("Select a world for this entity type.");return}p("");const E={name:w,description:f.description?.trim()||"",world_id:N};try{if(await t?.(E)===!1)return}catch(C){p(C.message||"Failed to save entity type")}};return a.jsxs("form",{className:"entity-type-form",onSubmit:v,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-type-name",children:"Name *"}),a.jsx("input",{id:"entity-type-name",type:"text",value:f.name,onChange:g("name"),placeholder:"e.g. Faction",disabled:i,autoFocus:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-type-world",children:"World *"}),a.jsxs("select",{id:"entity-type-world",value:f.worldId,onChange:g("worldId"),disabled:i,required:!0,children:[a.jsx("option",{value:"",children:"Select world..."}),c.map(S=>a.jsx("option",{value:S.id,children:S.name},S.id))]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-type-description",children:"Description"}),a.jsx("textarea",{id:"entity-type-description",value:f.description,onChange:g("description"),placeholder:"Optional description for this entity type",rows:5,disabled:i,className:"textarea-field"})]}),h&&a.jsx("div",{className:"form-error",role:"alert",children:h}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:r,disabled:i,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:i||!y,children:i?"Saving...":"Save"})]})]})}const oI=new Set(["system_admin"]);function cI(){const e=$n(),{user:t,token:r,sessionReady:i}=En(),{selectedCampaign:l,activeWorld:c,activeWorldId:f,contextKey:m}=Un(),[h,p]=u.useState([]),[y,g]=u.useState(!1),[v,S]=u.useState(""),[w,N]=u.useState(!1),[E,C]=u.useState(null),[A,O]=u.useState(!1),[_,R]=u.useState(""),[D,j]=u.useState(""),[z,P]=u.useState(null),X=f||l?.world?.id||"",H=u.useRef(`${X}:${m}`),G=!!X,V=u.useMemo(()=>X?[{id:X,name:c?.name||l?.world?.name||"Untitled world"}]:[],[X,c?.name,l?.world?.name]),k=u.useMemo(()=>{const Q=l?.world||c;return Q&&(Q.created_by||Q.creator?.id||Q.owner_id||Q.owner?.id)||""},[l,c]),F=!!(t?.id&&k===t.id),I=u.useMemo(()=>t?t.role&&oI.has(t.role)?!0:F:!1,[t,F]),L=u.useMemo(()=>{if(l){const Q=l.name||"Selected campaign",se=l.world?.name||c?.name;return se?`${Q}  ${se}`:Q}return c?c.name||"Selected world":""},[l,c]),$=u.useCallback((Q,se="info")=>{P({message:Q,tone:se})},[]);u.useEffect(()=>{if(!z)return;const Q=setTimeout(()=>P(null),3500);return()=>clearTimeout(Q)},[z]);const T=u.useCallback(async()=>{if(!r||!X)return g(!1),p([]),[];g(!0),S("");try{const Q=await Jr({worldId:X}),se=Array.isArray(Q)?Q:Array.isArray(Q?.data)?Q.data:[];return p(se),se}catch(Q){return console.error(" Failed to load entity types",Q),S(Q.message||"Failed to load entity types"),p([]),[]}finally{g(!1)}},[r,X]);u.useEffect(()=>{if(!(!i||!r)){if(!X){p([]),S(""),g(!1);return}T()}},[i,r,X,T,m]),u.useEffect(()=>{const Q=`${X}:${m}`;H.current!==Q&&(N(!1),C(null),j(""),P(null),p([]),S(""),O(!1),R(""),H.current=Q)},[X,m]);const U=()=>{!I||!G||e("/entity-types/new")},M=Q=>{I&&(C(Q),j(""),N(!0))},q=Q=>{Q?.id&&e(`/entity-types/${Q.id}/fields`)},Y=()=>{N(!1),C(null),j("")},J=async Q=>{if(!E?.id)return j("No entity type selected for editing."),!1;try{O(!0),j(""),await ZR(E.id,Q),$("Entity type updated","success"),Y(),await T()}catch(se){console.error(" Failed to save entity type",se);const ne=se.message||"Failed to save entity type";return j(ne),$(ne,"error"),!1}finally{O(!1)}return!0},ie=async Q=>{if(!(!I||!Q?.id||!window.confirm(`Delete entity type "${Q.name}"? This action cannot be undone.`)))try{R(Q.id),await QR(Q.id),$("Entity type deleted","success"),E?.id===Q.id&&Y(),await T()}catch(ne){console.error(" Failed to delete entity type",ne),$(ne.message||"Failed to delete entity type","error")}finally{R("")}},Z=Q=>{if(!Q)return"";const se=new Date(Q);return Number.isNaN(se.getTime())?"":se.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},fe=h.length;return i?r?a.jsxs("section",{className:"entity-types-page",children:[a.jsxs("div",{className:"entity-types-header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Entity Types"}),l?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"entity-types-subtitle",children:L}),a.jsxs("p",{className:"entity-types-subtitle",children:[fe," types defined"]})]}):a.jsx("p",{className:"entity-types-subtitle",children:"Select a campaign or world you own to choose a world context."})]}),a.jsxs("button",{type:"button",className:"btn submit",onClick:U,disabled:!I||A||_||!G,children:[a.jsx(Ya,{size:18})," Add Entity Type"]})]}),!I&&a.jsx("div",{className:"alert info",role:"status",children:"You can view the existing entity types, but only system administrators or the world owner can make changes."}),z&&a.jsx("div",{className:`toast-banner ${z.tone}`,role:"status",children:z.message}),v&&a.jsx("div",{className:"alert error",role:"alert",children:v}),a.jsx("div",{className:"entity-types-table-wrapper",children:G?y?a.jsx("div",{className:"empty-state",children:"Loading entity types..."}):h.length===0?a.jsx("div",{className:"empty-state",children:"No entity types defined yet."}):a.jsxs("table",{className:"entity-types-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Name"}),a.jsx("th",{children:"Description"}),a.jsx("th",{children:"World"}),a.jsx("th",{children:"Created"}),a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:h.map(Q=>{const se=Q.createdAt||Q.created_at,ne=Q?.world?.name||Q?.world_name||Q?.worldName||"";return a.jsxs("tr",{children:[a.jsx("td",{children:Q.name}),a.jsx("td",{className:"description-cell",children:Q.description?Q.description:""}),a.jsx("td",{children:ne}),a.jsx("td",{children:Z(se)}),a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-type-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Manage fields",onClick:()=>q(Q),children:a.jsx(D0,{size:16})}),I&&a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Edit entity type",onClick:()=>M(Q),disabled:A||_===Q.id,children:a.jsx(ir,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete entity type",onClick:()=>ie(Q),disabled:_===Q.id||A,children:a.jsx(ha,{size:16})})]})]})})]},Q.id)})})]}):a.jsx("div",{className:"empty-state",children:"Select a campaign or world you own to view entity types."})}),a.jsx("div",{className:"entity-type-cards",children:G?y?a.jsx("div",{className:"card-placeholder",children:"Loading entity types..."}):h.length===0?a.jsx("div",{className:"card-placeholder",children:"No entity types defined yet."}):h.map(Q=>{const se=Q.createdAt||Q.created_at;return a.jsxs("div",{className:"entity-type-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsx("h3",{children:Q.name}),a.jsxs("div",{className:"entity-type-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Manage fields",onClick:()=>q(Q),children:a.jsx(D0,{size:16})}),I&&a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Edit entity type",onClick:()=>M(Q),disabled:A||_===Q.id,children:a.jsx(ir,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete entity type",onClick:()=>ie(Q),disabled:_===Q.id||A,children:a.jsx(ha,{size:16})})]})]})]}),a.jsx("p",{className:"card-description",children:Q.description?Q.description:"No description"}),a.jsxs("p",{className:"card-meta",children:["World: ",Q?.world?.name||Q?.world_name||""]}),a.jsxs("p",{className:"card-meta",children:["Created ",Z(se)]})]},`card-${Q.id}`)}):a.jsx("div",{className:"card-placeholder",children:"Select a campaign or world you own to view entity types."})}),w&&a.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"side-panel",children:[a.jsxs("div",{className:"side-panel-header",children:[a.jsx("h2",{children:E?"Edit Entity Type":"Add Entity Type"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:Y,title:"Close form",disabled:A,children:a.jsx(Ia,{size:18})})]}),a.jsx("div",{className:"side-panel-content",children:a.jsx(lI,{initialData:E,onSubmit:J,onCancel:Y,submitting:A,errorMessage:D,worlds:V})})]})})]}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const uI=[{value:"text",label:"Text"},{value:"number",label:"Number"},{value:"boolean",label:"Boolean"},{value:"date",label:"Date"},{value:"enum",label:"Enum"},{value:"reference",label:"Reference"}];function dI({initialData:e={},referenceTypes:t=[],onSubmit:r,onCancel:i,submitting:l=!1,errorMessage:c}){const[f,m]=u.useState({name:"",label:"",data_type:"text",required:!1,visibleByDefault:!0,enumChoices:"",reference_type_id:"",reference_filter:""}),[h,p]=u.useState("");u.useEffect(()=>{if(!e){m({name:"",label:"",data_type:"text",required:!1,visibleByDefault:!0,enumChoices:"",reference_type_id:"",reference_filter:""}),p("");return}const N=Array.isArray(e.options?.choices)?e.options.choices.join(", "):typeof e.options=="string"?e.options:"",E=e.reference_filter?typeof e.reference_filter=="string"?e.reference_filter:JSON.stringify(e.reference_filter,null,2):"";m({name:e.name||"",label:e.label||"",data_type:e.data_type||"text",required:!!e.required,visibleByDefault:e.visibleByDefault!==void 0?!!e.visibleByDefault:e.visible_by_default!==void 0?!!e.visible_by_default:!0,enumChoices:N,reference_type_id:e.reference_type_id||"",reference_filter:E}),p("")},[e]),u.useEffect(()=>{p(c||"")},[c]);const y=f.data_type==="enum",g=f.data_type==="reference",v=u.useMemo(()=>t.map(N=>({value:N.id,label:N.name})),[t]),S=N=>E=>{const{value:C,type:A,checked:O}=E.target;m(_=>({..._,[N]:A==="checkbox"?O:C}))},w=async N=>{N.preventDefault();const E=f.name.trim(),C=f.label.trim();if(!E){p("Field name is required.");return}if(!C){p("Field label is required.");return}if(!f.data_type){p("Data type is required.");return}let A={};if(g){if(!f.reference_type_id){p("Reference type is required for reference fields.");return}const _=f.reference_filter.trim();if(_)try{if(A=JSON.parse(_),typeof A!="object"||Array.isArray(A))throw new Error("Reference filter must be a JSON object.")}catch(R){p(R.message||"Reference filter must be valid JSON.");return}}const O={name:E,label:C,data_type:f.data_type,required:!!f.required,visible_by_default:!!f.visibleByDefault};if(y){const _=f.enumChoices.split(",").map(R=>R.trim()).filter(Boolean);if(!_.length){p("Enum options are required for enum fields.");return}O.options={choices:_}}else O.options={};g?(O.reference_type_id=f.reference_type_id,O.reference_filter=A):(O.reference_type_id=null,O.reference_filter={});try{if(await r?.(O)===!1)return;p("")}catch(_){p(_.message||"Failed to save field")}};return a.jsxs("form",{className:"entity-type-field-form",onSubmit:w,children:[a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-field-name",children:"Field Name *"}),a.jsx("input",{id:"entity-field-name",type:"text",value:f.name,onChange:S("name"),placeholder:"e.g. alignment",disabled:l})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-field-label",children:"Label *"}),a.jsx("input",{id:"entity-field-label",type:"text",value:f.label,onChange:S("label"),placeholder:"e.g. Alignment",disabled:l})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-field-data-type",children:"Data Type *"}),a.jsx("select",{id:"entity-field-data-type",value:f.data_type,onChange:S("data_type"),disabled:l,children:uI.map(N=>a.jsx("option",{value:N.value,children:N.label},N.value))}),a.jsx("p",{className:"field-hint",children:"Determines how the value is stored and rendered in entity forms."})]}),a.jsxs("div",{className:"form-group checkbox-group",children:[a.jsxs("div",{className:"checkbox-control",children:[a.jsx("input",{id:"entity-field-required",type:"checkbox",checked:f.required,onChange:S("required"),disabled:l}),a.jsx("label",{htmlFor:"entity-field-required",children:"Required"})]}),a.jsx("span",{className:"field-hint",children:"Mark as required on entity forms."})]}),a.jsxs("div",{className:"form-group checkbox-group",children:[a.jsxs("div",{className:"checkbox-control",children:[a.jsx("input",{id:"entity-field-visible-default",type:"checkbox",checked:f.visibleByDefault,onChange:S("visibleByDefault"),disabled:l}),a.jsx("label",{htmlFor:"entity-field-visible-default",children:"Visible by default"})]}),a.jsx("span",{className:"field-hint",children:"Uncheck to hide this field unless a rule explicitly shows it."})]}),y&&a.jsxs("div",{className:"form-group form-group-full",children:[a.jsx("label",{htmlFor:"entity-field-options",children:"Enum Options *"}),a.jsx("textarea",{id:"entity-field-options",value:f.enumChoices,onChange:S("enumChoices"),placeholder:"Comma separated values, e.g. Lawful Good, Neutral, Chaotic Evil",rows:3,disabled:l}),a.jsx("p",{className:"field-hint",children:"Comma-separated list of allowed values."})]}),g&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group form-group-full",children:[a.jsx("label",{htmlFor:"entity-field-reference-type",children:"Reference Type *"}),a.jsxs("select",{id:"entity-field-reference-type",value:f.reference_type_id,onChange:S("reference_type_id"),disabled:l,children:[a.jsx("option",{value:"",children:"Select entity type"}),v.map(N=>a.jsx("option",{value:N.value,children:N.label},N.value))]}),a.jsx("p",{className:"field-hint",children:"Choose which entity type this field should reference."})]}),a.jsxs("div",{className:"form-group form-group-full",children:[a.jsx("label",{htmlFor:"entity-field-reference-filter",children:"Reference Filter"}),a.jsx("textarea",{id:"entity-field-reference-filter",value:f.reference_filter,onChange:S("reference_filter"),placeholder:'Optional JSON filter, e.g. {"metadata.subtype": "Town"}',rows:4,disabled:l}),a.jsx("p",{className:"field-hint",children:"Limit selectable entities by filter criteria."})]})]})]}),h&&a.jsx("div",{className:"form-error",role:"alert",children:h}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:i,disabled:l,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:l,children:l?"Saving...":"Save Field"})]})]})}const fI=[{value:"equals",label:"Equals"},{value:"not_equals",label:"Does not equal"},{value:"contains",label:"Contains"},{value:"not_contains",label:"Does not contain"},{value:"in",label:"Is one of"},{value:"not_in",label:"Is not one of"},{value:"gt",label:"Greater than"},{value:"gte",label:"Greater than or equal"},{value:"lt",label:"Less than"},{value:"lte",label:"Less than or equal"},{value:"is_set",label:"Has a value"},{value:"is_not_set",label:"Is empty"}],mI=[{value:"show",label:"Show field"},{value:"hide",label:"Hide field"}],hI=[{value:"all",label:"All conditions must match"},{value:"any",label:"Any condition can match"},{value:"none",label:"None of the conditions can match"}],pI=new Set(["is_set","is_not_set"]),Qp=()=>({field:"",operator:"equals",valuesText:""}),Jp=()=>({target:"",action:"show"}),yI=(e=[])=>Array.isArray(e)?e.map((t,r)=>{if(t==null)return null;if(typeof t=="object"){const l=t.value??t.id??t.key??t.slug??`choice-${r}`;if(l==null)return null;const c=t.label??t.name??t.title??t.display??l;return{value:String(l),label:String(c??l)}}const i=String(t);return{value:i,label:i}}).filter(Boolean):[],gI=(e=[])=>!Array.isArray(e)||!e.length?[Qp()]:e.map(t=>({field:t.field||t.fieldKey||"",operator:t.operator||"equals",valuesText:Array.isArray(t.values)?t.values.join(", "):""})),bI=(e=[])=>!Array.isArray(e)||!e.length?[Jp()]:e.map(t=>({target:t.target||t.field||"",action:t.action||"show"})),dp=e=>e.split(",").map(t=>t.trim()).filter(t=>t.length>0);function vI({fields:e=[],initialData:t=null,onSubmit:r,onCancel:i,submitting:l=!1,errorMessage:c=""}){const[f,m]=u.useState(""),[h,p]=u.useState("all"),[y,g]=u.useState([Qp()]),[v,S]=u.useState([Jp()]),[w,N]=u.useState("");u.useEffect(()=>{m(t?.name||""),p(t?.match_mode||t?.matchMode||"all"),g(gI(t?.conditions)),S(bI(t?.actions))},[t]),u.useEffect(()=>{N(c||"")},[c]);const E=u.useMemo(()=>e.map(H=>({value:H.id||H.name,label:H.label||H.name})),[e]),C=u.useMemo(()=>{const H=new Map;return e.forEach(G=>{if(!G)return;const V=k=>{if(k==null)return;const F=String(k);F&&(H.set(F,G),H.set(F.toLowerCase(),G))};V(G.id),V(G.field_id),V(G.fieldId),V(G.name),V(G.key)}),H},[e]),A=u.useCallback(H=>{if(H==null)return null;const G=String(H);return C.get(G)||C.get(G.toLowerCase())||null},[C]),O=(H,G,V)=>{g(k=>{const F=k.slice();return F[H]={...F[H],[G]:V},F})},_=(H,G,V)=>{S(k=>{const F=k.slice();return F[H]={...F[H],[G]:V},F})},R=()=>g(H=>[...H,Qp()]),D=H=>g(G=>G.length===1?G:G.filter((V,k)=>k!==H)),j=()=>S(H=>[...H,Jp()]),z=H=>S(G=>G.length===1?G:G.filter((V,k)=>k!==H)),P=u.useCallback((H,G)=>{g(V=>{if(!Array.isArray(V)||H<0||H>=V.length)return V;const k=V.slice(),F=k[H];if(!F)return V;const I=dp(F.valuesText||""),L=String(G);let $;return I.includes(L)?$=I.filter(T=>T!==L):$=[...I,L],k[H]={...F,valuesText:$.join(", ")},k})},[]),X=async H=>{if(H.preventDefault(),!y.length){N("Add at least one condition.");return}if(!v.length){N("Add at least one action.");return}const G=y.map(F=>({field:F.field,operator:F.operator,values:dp(F.valuesText||"")})).filter(F=>F.field&&F.operator);if(!G.length){N("Each condition needs a field and operator.");return}const V=v.map(F=>({target:F.target,action:F.action})).filter(F=>F.target&&F.action);if(!V.length){N("Each action needs a target and action type.");return}const k={name:f.trim(),match_mode:h,conditions:G,actions:V};try{if(await r?.(k)===!1)return;N("")}catch(F){N(F.message||"Failed to save rule")}};return a.jsxs("form",{className:"field-rule-form",onSubmit:X,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"field-rule-name",children:"Rule Name"}),a.jsx("input",{id:"field-rule-name",type:"text",value:f,onChange:H=>m(H.target.value),placeholder:"e.g. Show hometown when origin is set",disabled:l})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"field-rule-match-mode",children:"When should this rule run?"}),a.jsx("select",{id:"field-rule-match-mode",value:h,onChange:H=>p(H.target.value),disabled:l,children:hI.map(H=>a.jsx("option",{value:H.value,children:H.label},H.value))})]}),a.jsxs("div",{className:"field-rule-editor-section",children:[a.jsxs("div",{className:"field-rule-editor-heading",children:[a.jsx("h3",{children:"Conditions"}),a.jsx("button",{type:"button",className:"btn ghost",onClick:R,disabled:l,children:"Add condition"})]}),a.jsx("p",{className:"field-hint",children:"Fields to watch before applying the actions."}),a.jsx("div",{className:"field-rule-list",role:"list",children:y.map((H,G)=>a.jsxs("div",{className:"field-rule-row",role:"listitem",children:[a.jsxs("select",{value:H.field,onChange:V=>O(G,"field",V.target.value),disabled:l,children:[a.jsx("option",{value:"",children:"Choose field"}),E.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))]}),a.jsx("select",{value:H.operator,onChange:V=>O(G,"operator",V.target.value),disabled:l,children:fI.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))}),(()=>{const V=A(H.field),F=(V?.data_type||V?.dataType)==="enum"?yI(V?.options?.choices):[],I=pI.has(H.operator);if(!I&&F.length>0){const $=new Set(dp(H.valuesText||""));return a.jsx("div",{className:"field-rule-enum-values",role:"group","aria-label":"Enum choices",children:F.map(T=>a.jsxs("label",{className:"field-rule-enum-option",children:[a.jsx("input",{type:"checkbox",checked:$.has(T.value),onChange:()=>P(G,T.value),disabled:l}),a.jsx("span",{children:T.label})]},`${T.value}-${G}`))})}return a.jsx("input",{type:"text",value:H.valuesText,onChange:$=>O(G,"valuesText",$.target.value),placeholder:"Comma separated values",disabled:l||I})})(),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>D(G),disabled:y.length===1||l,title:"Remove condition",children:""})]},`condition-${G}`))})]}),a.jsxs("div",{className:"field-rule-editor-section",children:[a.jsxs("div",{className:"field-rule-editor-heading",children:[a.jsx("h3",{children:"Actions"}),a.jsx("button",{type:"button",className:"btn ghost",onClick:j,disabled:l,children:"Add action"})]}),a.jsx("p",{className:"field-hint",children:"Choose what should happen when the conditions above match."}),a.jsx("div",{className:"field-rule-list",role:"list",children:v.map((H,G)=>a.jsxs("div",{className:"field-rule-row",role:"listitem",children:[a.jsxs("select",{value:H.target,onChange:V=>_(G,"target",V.target.value),disabled:l,children:[a.jsx("option",{value:"",children:"Choose field"}),E.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))]}),a.jsx("select",{value:H.action,onChange:V=>_(G,"action",V.target.value),disabled:l,children:mI.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>z(G),disabled:v.length===1||l,title:"Remove action",children:""})]},`action-${G}`))})]}),w&&a.jsx("div",{className:"form-error",role:"alert",children:w}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:i,disabled:l,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:l,children:l?"Saving":"Save Rule"})]})]})}const xI=new Set(["system_admin"]),fp={text:"Text",number:"Number",boolean:"Boolean",date:"Date",enum:"Enum",reference:"Reference"},SI={equals:"equals",not_equals:"does not equal",contains:"contains",not_contains:"does not contain",in:"is one of",not_in:"is not one of",gt:"is greater than",gte:"is greater than or equal to",lt:"is less than",lte:"is less than or equal to",is_set:"is set",is_not_set:"is empty"},wI={show:"Show",hide:"Hide"},wS={all:"All conditions must match",any:"Any condition can match",none:"No conditions can match"};function NI(){const{id:e}=Ss(),t=$n(),{user:r,token:i,sessionReady:l}=En(),[c,f]=u.useState(null),[m,h]=u.useState([]),[p,y]=u.useState([]),[g,v]=u.useState(!1),[S,w]=u.useState(!1),[N,E]=u.useState(""),[C,A]=u.useState(""),[O,_]=u.useState(!1),[R,D]=u.useState(null),[j,z]=u.useState(!1),[P,X]=u.useState(""),[H,G]=u.useState(""),[V,k]=u.useState(null),[F,I]=u.useState([]),[L,$]=u.useState([]),[T,U]=u.useState([]),[M,q]=u.useState(!1),[Y,J]=u.useState(!1),[ie,Z]=u.useState(""),[fe,Q]=u.useState(!1),[se,ne]=u.useState(!1),[we,Ie]=u.useState(""),[Me,Ae]=u.useState(!1),[it,$e]=u.useState(null),[nt,Le]=u.useState(!1),[wt,Tt]=u.useState(""),[Ct,At]=u.useState(""),[Ue,Je]=u.useState(""),de=c?.name||"Entity Type",ue=u.useMemo(()=>!c||!r?!1:xI.has(r.role)||c.world_owner_id&&c.world_owner_id===r.id||c.created_by&&c.created_by===r.id?!0:Array.isArray(c.managers)?c.managers.some(re=>re===r.id):!1,[c,r]),ye=re=>{if(!re)return"";const{options:je}=re;return je?Array.isArray(je.choices)&&je.choices.length>0?je.choices.join(", "):typeof je=="string"&&je.trim()?je:"":""},Ve=u.useCallback((re,je="info")=>{k({message:re,tone:je})},[]);u.useEffect(()=>{if(!V)return;const re=setTimeout(()=>k(null),3500);return()=>clearTimeout(re)},[V]);const ee=re=>re?Array.isArray(re)?re:re?.data?re.data:re:null,me=u.useCallback(async()=>{if(e){v(!0),E("");try{const re=await WR(e),je=ee(re);f(je)}catch(re){console.error(" Failed to load entity type details",re),E(re.message||"Failed to load entity type")}finally{v(!1)}}},[e]),he=u.useCallback(async re=>{const je=typeof re=="string"?re.trim():re||"";if(!je){h([]);return}try{const He=await Jr({worldId:je}),ut=ee(He);Array.isArray(ut)?h(ut):h([])}catch(He){console.error(" Failed to load reference types",He),h([])}},[]),Se=u.useCallback(async()=>{if(e){w(!0),A("");try{const re=await rN(e),je=ee(re);y(Array.isArray(je)?je:[])}catch(re){console.error(" Failed to load fields",re),A(re.message||"Failed to load fields"),y([])}finally{w(!1)}}},[e]),We=u.useCallback(async()=>{if(e){Q(!0),ne(!0),Z(""),Ie("");try{const[re,je]=await Promise.all([of(e).catch(He=>(console.error(" Failed to load field order",He),Z(He.message||"Failed to load field order"),null)),cf(e).catch(He=>(console.error(" Failed to load field rules",He),Ie(He.message||"Failed to load conditional rules"),null))]);I(Kr(re)),$(Kr(je))}catch(re){Z(re.message||"Failed to load field order"),Ie(re.message||"Failed to load conditional rules"),I([]),$([])}finally{Q(!1),ne(!1)}}},[e]);u.useEffect(()=>{!l||!i||(me(),Se(),We())},[l,i,me,Se,We]),u.useEffect(()=>{if(!c){h([]);return}const re=c?.world_id||c?.worldId||c?.world?.id||"";he(re)},[c,c?.world_id,c?.worldId,c?.world?.id,he]),u.useEffect(()=>{l&&(i||t("/login"))},[l,i,t]);const Xe=u.useCallback(()=>!Array.isArray(p)||p.length===0?[]:qy(p,F).map((je,He)=>({id:je.id,name:je.name,label:je.label||je.name,data_type:je.data_type,required:je.required,order:He})),[p,F]);u.useEffect(()=>{M||U(Xe())},[Xe,M]);const et=u.useCallback(()=>{q(!1),U(Xe())},[Xe]),Te=u.useMemo(()=>{const re=new Map;return p.forEach(je=>{if(!je)return;const He=je.label||je.name||"Field";je.id&&(re.set(je.id,He),re.set(String(je.id).toLowerCase(),He)),je.name&&(re.set(je.name,He),re.set(je.name.toLowerCase(),He))}),re},[p]),mt=u.useCallback(re=>{if(!re)return"";const je=Te.get(re.field)||re.field,He=SI[re.operator]||re.operator,ut=Array.isArray(re.values)?re.values.filter(Boolean):[];return!ut.length||["is_set","is_not_set"].includes(re.operator)?`${je} ${He}`:`${je} ${He} ${ut.join(", ")}`},[Te]),Dt=u.useCallback(re=>{if(!re)return"";const je=Te.get(re.target)||re.target;return`${wI[re.action]||re.action} ${je}`},[Te]),Nt=()=>{ue&&(D(null),G(""),_(!0))},Ge=re=>{ue&&(D(re),G(""),_(!0))},vt=()=>{_(!1),D(null),G("")},Mt=async re=>{if(!ue)return!1;try{z(!0),G(""),R?.id?(await B3(R.id,re),Ve("Field updated","success")):(await F3(e,re),Ve("Field created","success")),vt(),await Se(),await We()}catch(je){console.error(" Failed to save field",je);const He=je.message||"Failed to save field";return G(He),Ve(He,"error"),!1}finally{z(!1)}return!0},Bt=async re=>{if(!(!ue||!re?.id||!window.confirm(`Delete field "${re.label||re.name}"? This action cannot be undone.`)))try{X(re.id),await U3(re.id),Ve("Field deleted","success"),await Se(),await We()}catch(He){console.error(" Failed to delete field",He),Ve(He.message||"Failed to delete field","error")}finally{X("")}},Jt=(re,je)=>{U(He=>{const ut=re+je;if(ut<0||ut>=He.length)return He;const dt=He.slice(),[Ee]=dt.splice(re,1);return dt.splice(ut,0,Ee),dt.map((at,le)=>({...at,order:le}))}),q(!0)},Et=async()=>{if(!(!ue||!M)){J(!0);try{const re=T.map((je,He)=>({field_id:je.id,section_order:0,column_order:0,field_order:He,priority:He}));await JR(e,{entries:re}),Ve("Field order updated","success"),q(!1),await We()}catch(re){const je=re.message||"Failed to update field order";Z(je),Ve(je,"error")}finally{J(!1)}}},zt=(re=null)=>{ue&&($e(re),Tt(""),Ae(!0))},$t=()=>{Ae(!1),$e(null),Tt("")},kt=async re=>{if(!ue)return!1;try{Le(!0),Tt(""),it?.id?(await $h(it.id,re),Ve("Rule updated","success")):(await ek(e,re),Ve("Rule created","success")),$t(),await We()}catch(je){const He=je.message||"Failed to save rule";return Tt(He),Ve(He,"error"),!1}finally{Le(!1)}return!0},te=async re=>{if(!(!ue||!re?.id||!window.confirm(`Delete the rule "${re.name||"Untitled rule"}"?`)))try{At(re.id),await tk(re.id),Ve("Rule deleted","success"),await We()}catch(He){Ve(He.message||"Failed to delete rule","error")}finally{At("")}},be=async(re,je)=>{if(!ue||!re?.id)return;const He=L.findIndex(Ee=>Ee.id===re.id),ut=He+je;if(He===-1||ut<0||ut>=L.length)return;const dt=L[ut];try{Je(re.id),await Promise.all([$h(re.id,{priority:ut}),$h(dt.id,{priority:He})]),Ve("Rule order updated","success"),await We()}catch(Ee){Ve(Ee.message||"Failed to reorder rule","error")}finally{Je("")}},ve=re=>{if(!re)return"";const je=new Date(re);return Number.isNaN(je.getTime())?"":je.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},Be=u.useMemo(()=>{const re=new Map;return m.forEach(je=>{je?.id&&re.set(je.id,je.name)}),re},[m]),ot=u.useMemo(()=>!Array.isArray(m)||!m.length?[]:c?.world_id?m.filter(re=>{if(!re)return!1;if(!c.world_id)return!0;const je=re.world_id??re.worldId??re.world?.id;return je?je===c.world_id:!0}):m,[c,m]),xt=N||C;return l?i?a.jsxs("section",{className:"entity-type-fields-page",children:[a.jsxs("div",{className:"entity-type-fields-header",children:[a.jsxs("div",{className:"entity-type-fields-heading",children:[a.jsxs("button",{type:"button",className:"link-button",onClick:()=>t("/entity-types"),children:[a.jsx(My,{size:16})," Back to Entity Types"]}),a.jsxs("h1",{children:["Fields for ",de]}),c?.world_name&&a.jsxs("p",{className:"entity-type-fields-subtitle",children:["World: ",c.world_name]})]}),ue&&a.jsxs("button",{type:"button",className:"btn submit",onClick:Nt,disabled:j||P,children:[a.jsx(Ya,{size:18})," Add Field"]})]}),!ue&&a.jsx("div",{className:"alert info",role:"status",children:"You can view these fields, but only the world owner or system administrators can make changes."}),V&&a.jsx("div",{className:`toast-banner ${V.tone}`,role:"status",children:V.message}),xt&&a.jsx("div",{className:"alert error",role:"alert",children:xt}),a.jsx("div",{className:"entity-types-table-wrapper",children:g||S?a.jsx("div",{className:"empty-state",children:"Loading fields..."}):p.length===0?a.jsx("div",{className:"empty-state",children:"No custom fields defined yet."}):a.jsxs("table",{className:"entity-types-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Field Name"}),a.jsx("th",{children:"Label"}),a.jsx("th",{children:"Data Type"}),a.jsx("th",{children:"Reference Type"}),a.jsx("th",{children:"Required"}),a.jsx("th",{children:"Created"}),ue&&a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:p.map(re=>{const je=re.createdAt||re.created_at,He=re.reference_type_name||Be.get(re.reference_type_id),ut=fp[re.data_type]||re.data_type;return a.jsxs("tr",{children:[a.jsx("td",{children:re.name}),a.jsx("td",{children:re.label||""}),a.jsx("td",{children:ut}),a.jsx("td",{children:He||(re.data_type==="reference"?"":"N/A")}),a.jsx("td",{children:re.required?"Yes":"No"}),a.jsx("td",{children:ve(je)}),ue&&a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-type-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Edit field",onClick:()=>Ge(re),disabled:j||P===re.id,children:a.jsx(ir,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete field",onClick:()=>Bt(re),disabled:P===re.id||j,children:a.jsx(ha,{size:16})})]})})]},re.id)})})]})}),a.jsxs("section",{className:"field-layout-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsxs("h2",{children:[a.jsx(S1,{size:18})," Field order"]}),ue&&a.jsxs("div",{className:"layout-card-actions",children:[a.jsx("button",{type:"button",className:"btn ghost",onClick:et,disabled:Y||!M,children:"Reset"}),a.jsx("button",{type:"button",className:"btn submit",onClick:Et,disabled:Y||!M||T.length===0,children:Y?"Saving":"Save order"})]})]}),a.jsx("p",{className:"card-description",children:"Use this list to control how the metadata fields appear on entity forms and detail pages."}),ie&&a.jsx("div",{className:"alert error",role:"alert",children:ie}),fe?a.jsx("div",{className:"card-placeholder",children:"Loading layout"}):T.length===0?a.jsx("div",{className:"card-placeholder",children:"No fields available to order yet."}):a.jsx("ol",{className:"field-layout-list",children:T.map((re,je)=>a.jsxs("li",{className:"field-layout-row",children:[a.jsxs("div",{className:"field-layout-info",children:[a.jsx("span",{className:"field-layout-index",children:je+1}),a.jsxs("div",{className:"field-layout-details",children:[a.jsx("span",{className:"field-layout-name",children:re.label||re.name}),a.jsx("span",{className:"field-layout-meta",children:fp[re.data_type]||re.data_type})]})]}),ue&&a.jsxs("div",{className:"layout-controls",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Jt(je,-1),disabled:je===0||Y,title:"Move up",children:a.jsx(A0,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Jt(je,1),disabled:je===T.length-1||Y,title:"Move down",children:a.jsx(C0,{size:16})})]})]},re.id||re.name||je))})]}),a.jsxs("section",{className:"field-rules-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsxs("h2",{children:[a.jsx(Di,{size:18})," Conditional rules"]}),ue&&a.jsxs("button",{type:"button",className:"btn submit",onClick:()=>zt(null),disabled:nt,children:[a.jsx(Ya,{size:16})," Add rule"]})]}),a.jsx("p",{className:"card-description",children:"Automatically show or hide fields when other metadata matches specific conditions."}),we&&a.jsx("div",{className:"alert error",role:"alert",children:we}),se?a.jsx("div",{className:"card-placeholder",children:"Loading rules"}):L.length===0?a.jsx("div",{className:"card-placeholder",children:"No conditional rules have been configured."}):a.jsx("div",{className:"field-rules-list",children:L.map((re,je)=>a.jsxs("article",{className:"field-rule-card",children:[a.jsxs("div",{className:"field-rule-content",children:[a.jsx("h3",{children:re.name||`Rule ${je+1}`}),a.jsx("p",{className:"field-rule-match",children:wS[re.match_mode]||wS.all}),a.jsx("ul",{className:"field-rule-condition-list",children:Array.isArray(re.conditions)&&re.conditions.map((He,ut)=>a.jsx("li",{children:mt(He)},`condition-${re.id}-${ut}`))}),a.jsx("div",{className:"field-rule-action-list",children:Array.isArray(re.actions)&&re.actions.map((He,ut)=>a.jsx("span",{children:Dt(He)},`action-${re.id}-${ut}`))})]}),ue&&a.jsxs("div",{className:"field-rule-controls",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>be(re,-1),disabled:je===0||Ue===re.id,title:"Move rule up",children:a.jsx(A0,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>be(re,1),disabled:je===L.length-1||Ue===re.id,title:"Move rule down",children:a.jsx(C0,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>zt(re),title:"Edit rule",disabled:nt||Ct===re.id,children:a.jsx(ir,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>te(re),title:"Delete rule",disabled:Ct===re.id||nt,children:a.jsx(ha,{size:16})})]})]},re.id))})]}),a.jsx("div",{className:"entity-type-cards",children:g||S?a.jsx("div",{className:"card-placeholder",children:"Loading fields..."}):p.length===0?a.jsx("div",{className:"card-placeholder",children:"No custom fields defined yet."}):p.map(re=>{const je=re.createdAt||re.created_at,He=re.reference_type_name||Be.get(re.reference_type_id),ut=fp[re.data_type]||re.data_type;return a.jsxs("div",{className:"entity-type-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsx("h3",{children:re.label||re.name}),ue&&a.jsxs("div",{className:"entity-type-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Edit field",onClick:()=>Ge(re),disabled:j||P===re.id,children:a.jsx(ir,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete field",onClick:()=>Bt(re),disabled:P===re.id||j,children:a.jsx(ha,{size:16})})]})]}),a.jsxs("dl",{className:"field-card-metadata",children:[a.jsxs("div",{children:[a.jsx("dt",{children:"Field Name"}),a.jsx("dd",{children:re.name})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Data Type"}),a.jsx("dd",{children:ut})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Required"}),a.jsx("dd",{children:re.required?"Yes":"No"})]}),re.data_type==="enum"&&a.jsxs("div",{children:[a.jsx("dt",{children:"Options"}),a.jsx("dd",{children:ye(re)})]}),re.data_type==="reference"&&a.jsxs("div",{children:[a.jsx("dt",{children:"Reference Type"}),a.jsx("dd",{children:He||""})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Created"}),a.jsx("dd",{children:ve(je)})]})]})]},`field-card-${re.id}`)})}),O&&a.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"side-panel",children:[a.jsxs("div",{className:"side-panel-header",children:[a.jsx("h2",{children:R?"Edit Field":"Add Field"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:vt,title:"Close form",disabled:j,children:a.jsx(Ia,{size:18})})]}),a.jsx("div",{className:"side-panel-content",children:a.jsx(dI,{initialData:R,referenceTypes:ot,onSubmit:Mt,onCancel:vt,submitting:j,errorMessage:H})})]})}),Me&&a.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"side-panel",children:[a.jsxs("div",{className:"side-panel-header",children:[a.jsx("h2",{children:it?"Edit conditional rule":"Add conditional rule"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:$t,title:"Close form",disabled:nt,children:a.jsx(Ia,{size:18})})]}),a.jsx("div",{className:"side-panel-content",children:a.jsx(vI,{fields:p,initialData:it,onSubmit:kt,onCancel:$t,submitting:nt,errorMessage:wt})})]})})]}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const EI="Create Entity Type",jI=[{title:"Details",columns:1,fields:[{key:"name",label:"Name",type:"text",placeholder:"e.g. Faction"},{key:"world_id",label:"World",type:"select",optionsSource:"worlds",placeholder:"Select the world this type belongs to",required:!0},{key:"description",label:"Description",type:"textarea",placeholder:"Optional description for this entity type"}]}],_I={title:EI,sections:jI};function CI(){const e=$n(),{user:t,token:r,sessionReady:i}=En(),{selectedCampaign:l}=Un(),[c,f]=u.useState(!1),m=u.useMemo(()=>{if(!l?.world)return"";const w=l.world;return w.created_by||w.creator?.id||w.owner_id||w.owner?.id||""},[l]),h=!!(t?.id&&m===t.id),p=u.useMemo(()=>t?t.role==="system_admin"?!0:h:!1,[t,h]),y=l?.world?.id??"",g=l?.world?.name??"";if(!i)return a.jsx("p",{children:"Restoring session..."});if(!r)return a.jsx("p",{children:"Authenticating..."});if(!p)return a.jsxs("section",{className:"page limited-access",children:[a.jsx("h1",{children:"Create Entity Type"}),a.jsx("p",{children:"Only system administrators or the world owner can create entity types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/entity-types"),children:"Back to Entity Types"})]});if(!y)return a.jsxs("section",{className:"page create-entity-type",children:[a.jsx("h1",{children:"Create Entity Type"}),a.jsx("p",{children:"Select a campaign from the header to choose a world context before creating entity types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/entity-types"),children:"Back to Entity Types"})]});const v=()=>{e("/entity-types")},S=async w=>{if(c)return!1;const N=typeof w?.name=="string"?w.name.trim():"",E=typeof w?.description=="string"?w.description.trim():"",A=(typeof w?.world_id=="string"&&w.world_id||typeof w?.worldId=="string"&&w.worldId||w?.world&&typeof w.world.id=="string"&&w.world.id||y||"").trim();if(!N)return alert("Name is required"),!1;if(!A)return alert("Select a world before creating the entity type"),!1;f(!0);try{const _=await KR({name:N,description:E,world_id:A}),R=_?.data??_;return!R||!R.id?(alert("Failed to create entity type"),!1):(e(`/entity-types/${R.id}/fields`),!0)}catch(O){return alert(`Failed to create entity type: ${O.message}`),!1}finally{f(!1)}};return a.jsxs("section",{className:"page create-entity-type",children:[c&&a.jsx("div",{className:"form-status",role:"status","aria-live":"polite",children:"Saving entity type..."}),a.jsx(gs,{schema:_I,initialData:{world_id:y,world:y?{id:y,name:g||"Selected world"}:void 0},onSubmit:S,onCancel:v,showUpdateAction:!1})]})}const DN=u.createContext({}),AI=new Set(["true","1","yes","on"]),NS=e=>{if(e==null)return;if(typeof e=="boolean")return e;const t=String(e).trim().toLowerCase();if(t!=="")return AI.has(t)},TI=e=>{const t=NS(e);if(t!==void 0)return t;const r=NS(void 0);return r!==void 0?r:!1};function MI({children:e,initialFeatures:t={}}){const r=TI(t.rel_builder_v2),i=u.useMemo(()=>({...t,rel_builder_v2:r}),[t,r]);return a.jsx(DN.Provider,{value:i,children:e})}const RI=()=>u.useContext(DN),kI=e=>!!RI()?.[e],DI="visible",II=e=>{if(!e)return null;const t=e.id??e.value??e.entity_type_id??e.entityTypeId??(typeof e=="string"||typeof e=="number"?e:null);if(t==null||t==="")return null;const r=e.name||e.label||e.title||e.display||e.slug||(typeof e=="string"||typeof e=="number"?String(e):"Untitled type");return{id:String(t),name:String(r)}};function ES({allowedTypeIds:e=[],defaultTypeId:t="",worldId:r,onCreated:i,onCancel:l,entityTypes:c=[],onToast:f}){const[m,h]=u.useState({name:"",entityTypeId:"",summary:""}),[p,y]=u.useState(!1),[g,v]=u.useState(""),[S,w]=u.useState(""),N=u.useRef(!1),E=u.useMemo(()=>new Set((e||[]).map(j=>String(j))),[e]),C=u.useMemo(()=>{const j=(Array.isArray(c)?c:[]).map(z=>II(z)).filter(Boolean);return E.size===0?j:j.filter(z=>E.has(z.id))},[c,E]),A=u.useMemo(()=>t&&E.size>0&&E.has(String(t))?String(t):C.length>0?C[0].id:t?String(t):"",[t,E,C]);u.useEffect(()=>{h(j=>({...j,entityTypeId:A}))},[A]);const O=u.useCallback(()=>{h({name:"",entityTypeId:A,summary:""}),v(""),w(""),N.current=!1},[A]),_=j=>z=>{const{value:P}=z.target;h(X=>({...X,[j]:P}))};u.useEffect(()=>{if(!m.entityTypeId){w("");return}E.size>0&&!E.has(String(m.entityTypeId))?(w("This type is not allowed for the selected relationship."),N.current||(f?.("This entity type is not allowed for this relationship.","warning"),N.current=!0)):(w(""),N.current=!1)},[m.entityTypeId,E,f]);const R=async j=>{if(j.preventDefault(),!r){v("Select a world before creating entities.");return}const z=m.name.trim();if(!z){v("Name is required.");return}const P=m.entityTypeId;if(!P){v("Entity type is required.");return}if(E.size>0&&!E.has(String(P))){w("This type is not allowed for the selected relationship."),N.current||(f?.("This entity type is not allowed for this relationship.","warning"),N.current=!0);return}try{y(!0),v("");const X={world_id:r,name:z,entity_type_id:P,visibility:DI},H=m.summary.trim();H&&(X.description=H);const G=await Fy(X),V=G?.data?.data??G?.data??G;if(!V||V.id===void 0||V.id===null)throw new Error("Failed to create entity");i?.(V),O()}catch(X){v(X.message||"Could not create entity. Please try again."),f?.("Could not create entity. Please try again.","error")}finally{y(!1)}},D=p||!m.name.trim()||!m.entityTypeId||E.size>0&&!E.has(String(m.entityTypeId))||C.length===0;return a.jsxs("div",{className:"entity-mini-create-inline",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-mini-name",children:"Name *"}),a.jsx("input",{id:"entity-mini-name",type:"text",value:m.name,onChange:_("name"),disabled:p,required:!0})]}),a.jsxs("div",{className:"form-two-column",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-mini-type",children:"Type *"}),a.jsxs("select",{id:"entity-mini-type",value:m.entityTypeId,onChange:_("entityTypeId"),disabled:p||C.length===0,required:!0,children:[a.jsx("option",{value:"",children:"Select type..."}),C.map(j=>a.jsx("option",{value:j.id,children:j.name},j.id))]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-mini-summary",children:"Summary"}),a.jsx("input",{id:"entity-mini-summary",type:"text",value:m.summary,onChange:_("summary"),placeholder:"Optional short summary",disabled:p})]})]}),(g||S)&&a.jsx("div",{className:`form-error${S?" warning":""}`,role:"alert",children:S||g}),a.jsxs("div",{className:"inline-actions",children:[a.jsx("button",{type:"button",className:"btn secondary",onClick:l,disabled:p,children:"Cancel"}),a.jsx("button",{type:"button",className:"btn",disabled:D,onClick:R,children:p?"Creating":"Save"})]})]})}const LI=[{value:"source",label:"This entity is the source"},{value:"target",label:"This entity is the target"}];function OI({value:e,onChange:t,disabled:r=!1}){const i=l=>{const c=l.target.value==="target"?"target":"source";c!==e&&t?.(c)};return a.jsxs("fieldset",{className:"perspective-toggle",disabled:r,children:[a.jsx("legend",{children:"Relationship Perspective"}),a.jsx("div",{role:"radiogroup","aria-label":"Relationship perspective",className:"perspective-toggle-options",children:LI.map(l=>{const c=["perspective-toggle-option"];return l.value===e&&c.push("active"),r&&c.push("disabled"),a.jsxs("label",{className:c.join(" "),children:[a.jsx("input",{type:"radio",name:"relationship-perspective",value:l.value,checked:e===l.value,onChange:i,disabled:r}),a.jsx("span",{children:l.label})]},l.value)})})]})}const Ku=e=>e==null?"":String(e).trim(),zI=e=>{if(e==null)return"";if(typeof e=="object")try{return JSON.stringify(e)}catch{return""}return String(e)},$I=e=>{const t=e.trim();if(!t)return"";if(t==="true")return!0;if(t==="false")return!1;const r=t[0],i=t[t.length-1];if(r==="{"&&i==="}"||r==="["&&i==="]")try{return JSON.parse(t)}catch{return e}const l=Number(t);return!Number.isNaN(l)&&t!==""?l:e},Wu=e=>{if(!Array.isArray(e)||e.length===0)return"";if(e.length===1)return e[0];if(e.length===2)return`${e[0]} or ${e[1]}`;const t=e.slice(0,-1),r=e[e.length-1];return`${t.join(", ")}, or ${r}`},FI=e=>{if(!e||e.id===void 0||e.id===null)return null;const t=e.entity_type_id??e.entityTypeId??e.entity_type?.id??e.entityType?.id??null,r=e.entityType||e.entity_type||(t&&e.entity_type_name?{id:t,name:e.entity_type_name}:null);return{...e,id:e.id,name:e.name||"Untitled entity",entity_type_id:t,entityType:r}},jS=e=>e?.name||e?.entityType?.name||e?.entity_type?.name||"",Wo=(e,t)=>{if(!e)return[];const r=t==="from"?e?.from_entity_types??e?.fromEntityTypes??e?.fromTypes??[]:e?.to_entity_types??e?.toEntityTypes??e?.toTypes??[];return Array.isArray(r)?r:[]},BI=e=>{if(!e)return"";if(typeof e=="string"||typeof e=="number")return String(e).trim();if(typeof e=="object"){if(e.id!==void 0&&e.id!==null)return String(e.id);if(e.entity_type_id!==void 0&&e.entity_type_id!==null)return String(e.entity_type_id);if(e.entityTypeId!==void 0&&e.entityTypeId!==null)return String(e.entityTypeId);if(e.entityType?.id!==void 0&&e.entityType?.id!==null)return String(e.entityType.id);if(e.entity_type?.id!==void 0&&e.entity_type?.id!==null)return String(e.entity_type.id)}return""},zo=(e,t)=>Wo(e,t).map(r=>BI(r)).filter(r=>r!=="");function UI({worldId:e,relationshipId:t,onCancel:r,onSaved:i,onToast:l,defaultFromEntityId:c,lockFromEntity:f=!1,defaultToEntityId:m,lockToEntity:h=!1,defaultPerspective:p="source",currentEntityId:y,currentEntityTypeId:g,formId:v="relationship-form",onStateChange:S,hideActions:w=!1}){const N=!!t,E=N,C=N,A=u.useRef(0),O=u.useCallback((K="",ae="")=>(A.current+=1,{id:A.current,key:K,value:ae}),[]),_=u.useCallback(K=>K.length>0?K:[O()],[O]),R=u.useCallback(K=>{if(!K||typeof K!="object"||Array.isArray(K))return"";const ae=K.__direction||K.direction;return ae?String(ae):""},[]),D=u.useCallback(K=>{if(A.current=0,!K||typeof K!="object"||Array.isArray(K))return[O()];const ae=Object.entries(K).filter(([Ne])=>typeof Ne!="string"?!0:!Ne.startsWith("__"));return ae.length===0?[O()]:ae.map(([Ne,qe])=>O(Ne,zI(qe)))},[O]),j=Ku(c),z=Ku(m),P=Ku(y),X=Ku(g),H=p==="target"?"reverse":"forward",G=H==="forward"?j:"",V=H==="reverse"?z:"",[k,F]=u.useState([]),[I,L]=u.useState([]),[$,T]=u.useState([]),[U,M]=u.useState({fromEntityId:G,toEntityId:V,relationshipTypeId:""}),[q,Y]=u.useState(()=>(A.current=0,[O()])),[J,ie]=u.useState(H),[Z,fe]=u.useState(!1),[Q,se]=u.useState(!1),[ne,we]=u.useState(!1),[Ie,Me]=u.useState(!1),[Ae,it]=u.useState(!1),[$e,nt]=u.useState(""),[Le,wt]=u.useState(""),[Tt,Ct]=u.useState(null),At=u.useRef({from:null,to:null}),[Ue,Je]=u.useState({from:"",to:""}),de=J==="reverse"?"target":"source",ue=de==="source",ye=u.useMemo(()=>de==="target"?h?"to":f?"from":"":f?"from":h?"to":"",[f,h,de]),Ve=ye==="from"?"to":ye==="to"?"from":"",ee=u.useMemo(()=>q.some(K=>K.key.trim()!==""||K.value.trim()!==""),[q]);u.useEffect(()=>{let K=!1;return e?((async()=>{fe(!0);try{const Ne=await lc(e),qe=Array.isArray(Ne)?Ne:Array.isArray(Ne?.data)?Ne.data:[];K||F(qe)}catch(Ne){K||(F([]),nt(Ne.message||"Failed to load entities"))}finally{K||fe(!1)}})(),()=>{K=!0}):(F([]),()=>{})},[e]),u.useEffect(()=>{let K=!1;return e?((async()=>{se(!0);try{const Ne=await pf({worldId:e}),qe=Array.isArray(Ne)?Ne:Array.isArray(Ne?.data)?Ne.data:[];K||L(qe)}catch(Ne){K||(L([]),nt(Ne.message||"Failed to load relationship types"))}finally{K||se(!1)}})(),()=>{K=!0}):(L([]),se(!1),()=>{})},[e]),u.useEffect(()=>{let K=!1;return(async()=>{if(!e){T([]),we(!1);return}we(!0);try{const Ne=await Jr({worldId:e}),qe=Array.isArray(Ne)?Ne:Array.isArray(Ne?.data)?Ne.data:[];K||T(qe)}catch(Ne){K||(T([]),nt(qe=>qe||Ne.message||"Failed to load entity types"))}finally{K||we(!1)}})(),()=>{K=!0}},[e]);const me=K=>{if(!K)return"";const ae=K.entity_type_id??K.entityTypeId??K.entityType?.id??K.entity_type?.id??"";return ae?String(ae):""},he=u.useMemo(()=>U.fromEntityId&&k.find(K=>String(K.id)===String(U.fromEntityId))||null,[k,U.fromEntityId]),Se=u.useMemo(()=>me(he),[he]),We=u.useMemo(()=>U.toEntityId&&k.find(K=>String(K.id)===String(U.toEntityId))||null,[k,U.toEntityId]),Xe=u.useMemo(()=>me(We),[We]),et=u.useMemo(()=>ye==="from"?Se||(P&&U.fromEntityId===P&&X||j&&U.fromEntityId===j&&X?X:""):ye==="to"?Xe||(P&&U.toEntityId===P&&X||z&&U.toEntityId===z&&X?X:""):"",[ye,Se,Xe,U.fromEntityId,U.toEntityId,P,X,j,z]),Te=u.useMemo(()=>J==="reverse"?ye==="to"?"from":"to":"from",[J,ye]),mt=u.useMemo(()=>J==="reverse"?ye==="to"?"to":"from":"to",[J,ye]),Dt=u.useMemo(()=>{const K=et?String(et):"";if(K){if(ye==="from")return{typeId:K,role:Te};if(ye==="to")return{typeId:K,role:mt}}return Se?{typeId:String(Se),role:Te}:Xe?{typeId:String(Xe),role:mt}:null},[et,ye,Se,Xe,Te,mt]),Nt=u.useMemo(()=>{if(!I?.length)return[];const K=(Ne,qe,gt)=>{if(!gt)return Ne;const St=String(gt);return Ne.filter(_t=>{const qt=zo(_t,qe);return qt.length===0?!0:qt.includes(St)})};let ae=I;if(Dt){const{typeId:Ne,role:qe}=Dt;ae=K(ae,qe,Ne)}return ae=K(ae,Te,Se),ae=K(ae,mt,Xe),ae},[I,Dt,Te,mt,Se,Xe]),Ge=u.useMemo(()=>U.relationshipTypeId?I.find(K=>String(K.id)===String(U.relationshipTypeId)):null,[I,U.relationshipTypeId]),vt=u.useMemo(()=>Ge?zo(Ge,Te):[],[Ge,Te]),Mt=u.useMemo(()=>Ge?zo(Ge,mt):[],[Ge,mt]),Bt=u.useMemo(()=>vt.length>0?String(vt[0]):"",[vt]),Jt=u.useMemo(()=>Mt.length>0?String(Mt[0]):"",[Mt]),Et=K=>{const ae=K==="target"?"reverse":"forward";wt(""),J!==ae&&M(Ne=>{const qe={...Ne,relationshipTypeId:""};if(!N){const gt=P||"";if(ae==="reverse"){const St=z||gt;St&&(qe.toEntityId=St,f&&Ne.fromEntityId===St&&(qe.fromEntityId=""))}else{const St=j||gt;St&&(qe.fromEntityId=St,h&&Ne.toEntityId===St&&(qe.toEntityId=""))}}return qe}),ie(Ne=>Ne===ae?Ne:ae)},zt=u.useCallback(K=>{if(K==="from"){if(ye==="from")return;if(!vt.length){l?.("This entity type is not allowed for this relationship.","warning");return}}else{if(ye==="to")return;if(!Mt.length){l?.("This entity type is not allowed for this relationship.","warning");return}}Ct(K)},[vt.length,Mt.length,ye,l]);u.useEffect(()=>{(Tt==="from"&&vt.length===0||Tt==="to"&&Mt.length===0)&&Ct(null)},[Tt,vt.length,Mt.length]);const $t=u.useMemo(()=>{if(!vt.length)return k;const K=new Set(vt);return k.filter(ae=>K.has(me(ae)))},[k,vt]),kt=u.useMemo(()=>{if(!Mt.length)return k;const K=new Set(Mt);return k.filter(ae=>K.has(me(ae)))},[k,Mt]);u.useEffect(()=>{if(!U.relationshipTypeId)return;Nt.some(ae=>String(ae.id)===String(U.relationshipTypeId))||M(ae=>({...ae,relationshipTypeId:""}))},[Nt,U.relationshipTypeId]),u.useEffect(()=>{if(!U.relationshipTypeId||!Se)return;if(f||h||P){wt("");return}const K=String(Se),ae=I.find(_t=>String(_t.id)===String(U.relationshipTypeId));if(!ae)return;const Ne=zo(ae,"from"),qe=zo(ae,"to"),gt=Ne.includes(K),St=qe.includes(K);if(gt&&St){wt("");return}if(gt&&J!=="forward"){ie("forward"),wt("");return}if(!gt&&St){const _t="Direction auto-corrected because this entity is only allowed as a target.";J!=="reverse"?(ie("reverse"),wt(_t)):wt(qt=>qt||_t);return}!gt&&!St&&(wt(""),M(_t=>({..._t,relationshipTypeId:""})))},[U.relationshipTypeId,Se,I,J,f,h,P]),u.useEffect(()=>{if(!U.fromEntityId||!vt.length)return;const K=new Set(vt),ae=k.find(qe=>String(qe.id)===String(U.fromEntityId));if(!ae)return;const Ne=me(ae);(!Ne||!K.has(Ne))&&M(qe=>({...qe,fromEntityId:""}))},[vt,k,U.fromEntityId]),u.useEffect(()=>{if(!U.toEntityId||!Mt.length)return;const K=new Set(Mt),ae=k.find(qe=>String(qe.id)===String(U.toEntityId));if(!ae)return;const Ne=me(ae);(!Ne||!K.has(Ne))&&M(qe=>({...qe,toEntityId:""}))},[Mt,k,U.toEntityId]);const te=u.useMemo(()=>{if(!Ge)return"";const K=Wo(Ge,Te);return K.length?K.map(ae=>ae?.name||ae?.entityType?.name||ae?.entity_type?.name||"Unknown type").join(", "):""},[Ge,Te]),be=u.useMemo(()=>{if(!Ge)return"";const K=Wo(Ge,mt);return K.length?K.map(ae=>ae?.name||ae?.entityType?.name||ae?.entity_type?.name||"Unknown type").join(", "):""},[Ge,mt]),ve=Te==="from"?"source":"target",Be=mt==="from"?"source":"target",ot=`Allowed ${ve}s`,xt=`Allowed ${Be}s`,re=u.useMemo(()=>Ge&&(J==="reverse"?Ge.to_name||Ge.toName:Ge.from_name||Ge.fromName)||"",[Ge,J]),je=u.useMemo(()=>Ge&&(J==="reverse"?Ge.from_name||Ge.fromName:Ge.to_name||Ge.toName)||"",[Ge,J]),He=u.useMemo(()=>Ge?Wo(Ge,Te).map(K=>jS(K)).filter(K=>K&&K.trim()):[],[Ge,Te]),ut=u.useMemo(()=>Ge?Wo(Ge,mt).map(K=>jS(K)).filter(K=>K&&K.trim()):[],[Ge,mt]),dt=u.useMemo(()=>!Ge||!He.length&&!ut.length?"":He.length&&ut.length?`This relationship can only be initiated from ${Wu(He)} and targets ${Wu(ut)}.`:He.length?`This relationship can only be initiated from ${Wu(He)}.`:`This relationship targets ${Wu(ut)}.`,[Ge,He,ut]),Ee=u.useMemo(()=>{if(!ye||!Ge)return"";const K=et?String(et):"";if(!K)return"";if(ye==="from"){if(vt.length>0&&!vt.includes(K))return ue?"This entity is not an allowed source for the selected relationship type. Try switching perspective.":"This entity is not an allowed target for the selected relationship type. Try switching perspective."}else if(ye==="to"&&Mt.length>0&&!Mt.includes(K))return ue?"This entity is not an allowed target for the selected relationship type. Try switching perspective.":"This entity is not an allowed source for the selected relationship type. Try switching perspective.";return""},[ye,Ge,et,vt,Mt,ue]),at=u.useMemo(()=>ye?ye==="from"?ue?"This entity is fixed as the source for this relationship.":"This field is locked to the current entity.":ye==="to"?ue?"This field is locked to the current entity.":"This entity is fixed as the target for this relationship.":"":"",[ye,ue]),le=!!Ee;u.useEffect(()=>{let K=!1;const ae=()=>{A.current=0,M({fromEntityId:H==="forward"?j:"",toEntityId:H==="reverse"?z:"",relationshipTypeId:""}),Y([O()]),ie(H),nt(""),Ct(null)};return!N||!t?(ae(),Me(!1),()=>{}):((async()=>{Me(!0),nt("");try{const qe=await j4(t),gt=qe?.data||qe;if(!gt)throw new Error("Relationship not found");if(!K){const St=gt.from_entity_id||gt.fromEntityId||gt.from_entity?.id||gt.fromEntity?.id||"",_t=gt.to_entity_id||gt.toEntityId||gt.to_entity?.id||gt.toEntity?.id||"",qt=gt.entity_relationship_type_id||gt.relationship_type_id||gt.relationshipType?.id||gt.relationship_type?.id||"";M({fromEntityId:St?String(St):"",toEntityId:_t?String(_t):"",relationshipTypeId:qt?String(qt):""}),ie(R(gt.context)||"forward"),Y(_(D(gt.context)))}}catch(qe){K||nt(qe.message||"Failed to load relationship")}finally{K||Me(!1)}})(),()=>{K=!0})},[t,N,_,D,O,R,H,j,z]),u.useEffect(()=>{if(N)return;const K=p==="target"?"reverse":"forward";ie(ae=>ae===K?ae:K)},[p,N]),u.useEffect(()=>{if(N||!ye)return;const K=P||"",ae=ye==="from"?j||K:z||K;ae&&M(Ne=>{const qe=ye==="from"?"fromEntityId":"toEntityId";if(Ne[qe]===ae)return Ne;const gt={...Ne,[qe]:ae};return ye==="from"&&h&&Ne.toEntityId===ae&&(gt.toEntityId=""),ye==="to"&&f&&Ne.fromEntityId===ae&&(gt.fromEntityId=""),gt})},[N,ye,f,h,j,z,P]);const st=K=>ae=>{const{value:Ne}=ae.target;M(qe=>{if(N)return{...qe,[K]:Ne};const gt={...qe,relationshipTypeId:Ne};return ye==="from"?gt.toEntityId="":ye==="to"&&(gt.fromEntityId=""),gt}),Ct(null)},ct=K=>{const{value:ae}=K.target;Ct(Ne=>Ne==="from"?null:Ne),M(Ne=>({...Ne,fromEntityId:ae}))},yt=K=>{const{value:ae}=K.target;Ct(Ne=>Ne==="to"?null:Ne),M(Ne=>({...Ne,toEntityId:ae}))},oe=u.useCallback(()=>{Ct(null)},[]),Ze=u.useCallback((K,ae)=>{const Ne=K==="to"?"to":"from",qe=ae?String(ae):"";Je(gt=>({...gt,[Ne]:qe})),At.current[Ne]&&clearTimeout(At.current[Ne]),At.current[Ne]=setTimeout(()=>{Je(gt=>({...gt,[Ne]:""})),At.current[Ne]=null},2e3)},[]),Ke=u.useCallback((K,ae)=>{const Ne=FI(ae);if(!Ne)return;const qe=String(Ne.id);F(qt=>{const en={...Ne,id:qe},dn=qt.findIndex(Zt=>String(Zt.id)===qe);if(dn>=0){const Zt=[...qt];return Zt[dn]={...Zt[dn],...en},Zt}return[en,...qt]}),K==="from"?M(qt=>({...qt,fromEntityId:qe})):K==="to"&&M(qt=>({...qt,toEntityId:qe})),Ze(K,qe),Ct(null);const gt=K==="from"?ve:Be,St=`${gt[0].toUpperCase()}${gt.slice(1)}`,_t=St?`New ${St} entity added and selected.`:"New entity added and selected.";l?.(_t,"success")},[Ze,ve,Be,l]);u.useEffect(()=>{const K=At.current;return()=>{Object.values(K).forEach(ae=>{ae&&clearTimeout(ae)})}},[]);const ft=(K,ae)=>Ne=>{const{value:qe}=Ne.target;Y(gt=>gt.map(St=>St.id===K?{...St,[ae]:qe}:St))},Qe=()=>{Y(K=>[...K,O()])},pt=K=>{Y(ae=>_(ae.filter(Ne=>Ne.id!==K)))},ke=async K=>{if(K.preventDefault(),!e){nt("Select a world before creating relationships.");return}const ae=U.fromEntityId.trim(),Ne=U.toEntityId.trim(),qe=U.relationshipTypeId.trim();if(!ae||!Ne){nt("Both entities are required.");return}if(!qe){nt("Relationship type is required.");return}const gt={};q.forEach(({key:Zt,value:sa})=>{const ba=Zt.trim();ba&&(ba.startsWith("__")||(gt[ba]=$I(sa)))});const St=J==="reverse"?"reverse":"forward";gt.__direction=St;let _t=ae,qt=Ne;St==="reverse"&&(!P||U.fromEntityId===P)&&(_t=Ne,qt=ae);const dn={world_id:e,from_entity_id:_t,to_entity_id:qt,relationship_type_id:qe,bidirectional:!0,context:gt};try{if(it(!0),nt(""),N)await C4(t,dn),i?.("edit");else{const Zt=await pN(dn),sa=Zt?.data??Zt,ba=sa?.data??sa;i?.("create",ba)}}catch(Zt){nt(Zt.message||"Failed to save relationship")}finally{it(!1)}},Pe=Z||Q||Ie||ne,ht=!!Dt?.typeId&&Nt.length===0;return u.useEffect(()=>{if(!S)return;S({mode:N?"edit":"create",saving:Ae,isBusy:Pe,submitLabel:Ae?"Saving...":N?"Save Changes":"Create Relationship",submitDisabled:Ae||Pe||le,cancelDisabled:Ae})},[S,N,Ae,Pe,le]),a.jsxs("form",{id:v,className:"entity-form relationship-form",onSubmit:ke,children:[a.jsx(OI,{value:de,onChange:Et,disabled:Ae||Pe}),Ee&&a.jsx("div",{className:"alert warning",role:"alert",children:Ee}),Le&&a.jsx("div",{className:"alert warning",role:"status",children:Le}),a.jsxs("div",{className:"form-two-column",children:[a.jsxs("div",{className:`form-group${Ue.from&&Ue.from===U.fromEntityId?" entity-select-highlight":""}`,children:[a.jsx("label",{htmlFor:"relationship-from-entity",children:"From Entity *"}),a.jsxs("select",{id:"relationship-from-entity",value:U.fromEntityId,onChange:ct,disabled:Ae||Pe||ye==="from",required:!0,"data-autofocus":Ve==="from"?!0:void 0,children:[a.jsx("option",{value:"",children:"Select entity..."}),$t.map(K=>a.jsx("option",{value:K.id,children:K.name},K.id))]}),ye==="from"&&at&&a.jsx("p",{className:"field-hint",children:at}),E&&re&&a.jsxs("p",{className:"field-hint",children:["Displayed label: ",re]}),E&&Ge&&te&&a.jsxs("p",{className:"field-hint",children:[ot,": ",te]}),ye!=="from"&&a.jsx("div",{className:"inline-create-trigger",children:vt.length>0?a.jsx("button",{type:"button",className:"link-button",onClick:()=>zt("from"),disabled:Tt==="from",children:"+ Create new"}):a.jsx("button",{type:"button",className:"link-button disabled",disabled:!0,children:"+ Create new"})}),ye!=="from"&&vt.length===0&&a.jsx("p",{className:"inline-create-hint disabled",children:"Inline creation isnt available for this relationship."}),Ge&&vt.length>0&&$t.length===0&&a.jsxs("p",{className:"field-hint",children:["No entities match the allowed ",ve," types yet. Use + Create new to add one without leaving this page."]}),ye!=="from"&&Tt==="from"&&a.jsx(ES,{allowedTypeIds:vt,defaultTypeId:Bt,worldId:e,entityTypes:$,onCreated:K=>Ke("from",K),onCancel:oe,onToast:l},`inline-from-${U.relationshipTypeId}`)]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type",children:"Relationship Type *"}),a.jsxs("select",{id:"relationship-type",value:U.relationshipTypeId,onChange:st("relationshipTypeId"),disabled:Ae||Pe||!Nt.length,required:!0,children:[a.jsx("option",{value:"",children:"Select type..."}),Nt.map(K=>{const ae=K.from_name||K.fromName||K.name,Ne=K.to_name||K.toName||K.name,qe=ae===Ne?ae:`${ae}  ${Ne}`;return a.jsxs("option",{value:K.id,children:[K.name,"  ",qe]},K.id)})]}),ht&&a.jsx("p",{className:"field-hint",children:"No relationship types include the selected entity type."}),dt&&a.jsx("p",{className:"helper-hint",children:dt})]})]}),a.jsx("div",{className:"form-two-column",children:a.jsxs("div",{className:`form-group${Ue.to&&Ue.to===U.toEntityId?" entity-select-highlight":""}`,children:[a.jsx("label",{htmlFor:"relationship-to-entity",children:"To Entity *"}),a.jsxs("select",{id:"relationship-to-entity",value:U.toEntityId,onChange:yt,disabled:Ae||Pe||ye==="to",required:!0,"data-autofocus":Ve==="to"?!0:void 0,children:[a.jsx("option",{value:"",children:"Select entity..."}),kt.map(K=>a.jsx("option",{value:K.id,children:K.name},K.id))]}),ye==="to"&&at&&a.jsx("p",{className:"field-hint",children:at}),E&&je&&a.jsxs("p",{className:"field-hint",children:["Displayed label: ",je]}),E&&Ge&&be&&a.jsxs("p",{className:"field-hint",children:[xt,": ",be]}),ye!=="to"&&a.jsx("div",{className:"inline-create-trigger",children:Mt.length>0?a.jsx("button",{type:"button",className:"link-button",onClick:()=>zt("to"),disabled:Tt==="to",children:"+ Create new"}):a.jsx("button",{type:"button",className:"link-button disabled",disabled:!0,children:"+ Create new"})}),ye!=="to"&&Mt.length===0&&a.jsx("p",{className:"inline-create-hint disabled",children:"Inline creation isnt available for this relationship."}),Ge&&Mt.length>0&&kt.length===0&&a.jsxs("p",{className:"field-hint",children:["No entities match the allowed ",Be," types yet. Use + Create new to add one without losing your place."]}),ye!=="to"&&Tt==="to"&&a.jsx(ES,{allowedTypeIds:Mt,defaultTypeId:Jt,worldId:e,entityTypes:$,onCreated:K=>Ke("to",K),onCancel:oe,onToast:l},`inline-to-${U.relationshipTypeId}`)]})}),C&&a.jsxs("div",{className:"metadata-editor",children:[a.jsxs("div",{className:"metadata-header",children:[a.jsxs("h3",{children:["Context ",ee?"":"(optional)"]}),a.jsx("button",{type:"button",className:"btn neutral",onClick:Qe,disabled:Ae||Pe,children:"Add field"})]}),a.jsx("div",{className:"metadata-list",children:q.map((K,ae)=>a.jsxs("div",{className:"metadata-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`context-key-${K.id}`,className:"sr-only",children:["Context key ",ae+1]}),a.jsx("input",{id:`context-key-${K.id}`,type:"text",placeholder:"Key",value:K.key,onChange:ft(K.id,"key"),disabled:Ae||Pe})]}),a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`context-value-${K.id}`,className:"sr-only",children:["Context value ",ae+1]}),a.jsx("input",{id:`context-value-${K.id}`,type:"text",placeholder:"Value",value:K.value,onChange:ft(K.id,"value"),disabled:Ae||Pe})]}),a.jsx("div",{className:"metadata-actions",children:a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>pt(K.id),disabled:Ae||Pe||q.length===1,title:"Remove field",children:""})})]},K.id))})]}),Pe&&a.jsx("div",{className:"form-loading",role:"status",children:"Loading data..."}),$e&&a.jsx("div",{className:"form-error",role:"alert",children:$e}),!w&&a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:r,disabled:Ae,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:Ae||Pe||le,children:Ae?"Saving...":N?"Save Changes":"Create Relationship"})]})]})}function qI(e){return a.jsx(UI,{...e})}const HI=new Set(["system_admin"]),_S=(e="create")=>({mode:e,submitLabel:e==="edit"?"Save Changes":"Create Relationship",submitDisabled:!1,cancelDisabled:!1,saving:!1,isBusy:!1});function PI(){const{user:e,token:t,sessionReady:r}=En(),{selectedCampaign:i,activeWorld:l,activeWorldId:c,selectedContextType:f,contextKey:m}=Un(),h=kI("rel_builder_v2"),[p,y]=u.useState(!1),[g,v]=u.useState(!1),[S,w]=u.useState([]),[N,E]=u.useState([]),[C,A]=u.useState({}),O=u.useRef({}),[_,R]=u.useState(!1),[D,j]=u.useState(!1),[z,P]=u.useState(""),[X,H]=u.useState(null),[G,V]=u.useState(""),[k,F]=u.useState(null),[I,L]=u.useState(()=>_S("create")),[$,T]=u.useState(""),[U,M]=u.useState(""),q=c||"",Y=!!q,J=u.useRef(`${q}:${m}`),ie=u.useRef(`relationship-form-${Math.random().toString(36).slice(2)}`),Z=(ee="create")=>{L(_S(ee))},fe=u.useCallback((ee,me="info")=>{F({message:ee,tone:me})},[]);u.useEffect(()=>{if(!k)return;const ee=setTimeout(()=>F(null),3500);return()=>clearTimeout(ee)},[k]);const Q=u.useMemo(()=>!i||!e?"":i.members?.find(me=>me.user_id===e.id)?.role||"",[i,e]),se=u.useMemo(()=>{const ee=i?.world||l;if(!ee||!e?.id)return!1;const me=ee.created_by||ee.creator?.id||ee.owner_id||ee.owner?.id||"";return me?String(me)===String(e.id):!1},[i,l,e?.id]),ne=u.useMemo(()=>!e||!q?!1:HI.has(e.role)?!0:f==="world"?se:!!(i&&(Q==="dm"||se)),[e,q,f,i,Q,se]),we=u.useCallback(async ee=>{const me=Array.from(new Set(ee.map(et=>et==null?"":String(et)).filter(Boolean)));if(me.length===0)return;const he=O.current,Se=me.filter(et=>!he[et]);if(Se.length===0)return;const We=await Promise.all(Se.map(async et=>{try{const Te=await or(et),mt=Va(Te);return{id:et,data:mt}}catch(Te){return console.error(" Failed to resolve entity",Te),{id:et,data:null}}})),Xe={};We.forEach(({id:et,data:Te})=>{Te?Xe[et]={id:Te.id||et,name:Te.name||`Entity ${et}`,typeName:Te.entityType?.name||Te.entity_type?.name||""}:Xe[et]={id:et,name:`Entity #${et}`,typeName:""}}),O.current={...O.current,...Xe},A(et=>({...et,...Xe}))},[]),Ie=u.useCallback(async ee=>{const me=ee?{worldId:ee}:{};j(!0);try{const he=await pf(me),Se=Array.isArray(he)?he:Array.isArray(he?.data)?he.data:[];E(Se)}catch(he){console.error(" Failed to load relationship types",he),fe(he.message||"Failed to load relationship types","error"),E([])}finally{j(!1)}},[fe]);u.useEffect(()=>{if(!q){E([]);return}Ie(q)},[Ie,q,m]);const Me=u.useCallback(async ee=>{const me=ee??q;if(!me||!t)return w([]),[];R(!0),P("");try{const he=await E4(me),Se=Array.isArray(he)?he:Array.isArray(he?.data)?he.data:[];w(Se);const We=[];return Se.forEach(Xe=>{const et=Xe.from_entity_id||Xe.fromEntityId||Xe.from_entity?.id||Xe.fromEntity?.id||"",Te=Xe.to_entity_id||Xe.toEntityId||Xe.to_entity?.id||Xe.toEntity?.id||"";et&&We.push(et),Te&&We.push(Te)}),await we(We),Se}catch(he){return console.error(" Failed to load relationships",he),w([]),P(he.message||"Failed to load relationships"),[]}finally{R(!1)}},[q,t,we,m]);u.useEffect(()=>{if(!q||!t){w([]),O.current={},A({});return}Me(q)},[q,t,Me,m]),u.useEffect(()=>{const ee=`${q}:${m}`;J.current!==ee&&(p&&y(!1),g&&v(!1),H(null),F(null),T(""),M(""),P(""),O.current={},A({}),J.current=ee)},[q,m,p,g]);const Ae=u.useMemo(()=>{const ee=new Map;return N.forEach(me=>{me?.id&&ee.set(String(me.id),me)}),ee},[N]),it=ee=>{if(!ee)return"";if(typeof ee=="object"&&ee!==null&&!Array.isArray(ee)){const me=ee.__direction||ee.direction;return me?String(me):""}return""},$e=u.useMemo(()=>S.map(ee=>{const me=ee.from_entity_id||ee.fromEntityId||ee.from_entity?.id||ee.fromEntity?.id||"",he=ee.to_entity_id||ee.toEntityId||ee.to_entity?.id||ee.toEntity?.id||"",Se=ee.entity_relationship_type_id||ee.relationship_type_id||ee.relationshipType?.id||ee.relationship_type?.id||"",We=ee.relationshipType||ee.relationship_type||Ae.get(String(Se))||{},Xe=We.name||ee.relationshipTypeName||Ae.get(String(Se))?.name||"",et=We.from_name||We.fromName||Ae.get(String(Se))?.from_name||Ae.get(String(Se))?.fromName||Xe,Te=We.to_name||We.toName||Ae.get(String(Se))?.to_name||Ae.get(String(Se))?.toName||Xe,mt=it(ee.context),Dt=mt==="reverse"?Te:et,Nt=!!(ee.bidirectional??ee.is_bidirectional??ee.two_way??!1);return{...ee,fromEntityId:me?String(me):"",toEntityId:he?String(he):"",relationshipTypeId:Se?String(Se):"",typeName:Dt,direction:mt,typeFromName:et,typeToName:Te,bidirectional:Nt,fromEntityName:ee.fromEntity?.name||ee.from_entity?.name||ee.fromEntityName||"",toEntityName:ee.toEntity?.name||ee.to_entity?.name||ee.toEntityName||"",fromEntityTypeName:ee.fromEntity?.entityType?.name||ee.from_entity?.entity_type?.name||"",toEntityTypeName:ee.toEntity?.entityType?.name||ee.to_entity?.entity_type?.name||""}}),[S,Ae]),nt=i?`${i.name}${l?.name?`  ${l.name}`:""}`:Y?`World  ${l?.name||"Untitled world"}`:"",Le=u.useCallback((ee,me="",he="")=>{if(!ee)return"";const Se=C[ee],We=Se?.name||me||`Entity #${ee}`,Xe=Se?.typeName||he;return Xe?`${We} (${Xe})`:We},[C]),wt=u.useMemo(()=>{const ee=U.trim().toLowerCase();return $e.filter(me=>{if($&&me.relationshipTypeId!==$)return!1;if(!ee)return!0;const he=Le(me.fromEntityId,me.fromEntityName,me.fromEntityTypeName).toLowerCase(),Se=Le(me.toEntityId,me.toEntityName,me.toEntityTypeName).toLowerCase();return he.includes(ee)||Se.includes(ee)})},[$e,$,U,Le]);if(!r)return a.jsx("p",{children:"Restoring session..."});if(!t)return a.jsx("p",{children:"Authenticating..."});const Tt=wt.length>0,Ct=X?"Edit Relationship":"Add Relationship",At=()=>{q&&Me(q)},Ue=()=>{if(!(!ne||!q)){if(h){y(!0);return}H(null),Z("create"),v(!0)}},Je=ee=>{!ne||!ee?.id||(H(ee.id),Z("edit"),v(!0))},de=()=>{v(!1),H(null),Z("create")},ue=(ee={})=>{L(me=>({...me,...ee}))},ye=async(ee,me)=>{if(de(),!!q){if(await Me(q),ee==="create"&&me){const he=Le(me.from_entity_id,me?.from_entity?.name,me?.from_entity?.entityType?.name||me?.from_entity?.entity_type?.name),Se=Le(me.to_entity_id,me?.to_entity?.name,me?.to_entity?.entityType?.name||me?.to_entity?.entity_type?.name),We=me?.relationshipType?.name||"relationship";fe(`Added ${he}  ${Se} (${We}).`,"success");return}fe(ee==="create"?"Relationship created":"Relationship updated","success")}},Ve=async ee=>{if(!ne||!ee?.id)return;const me=Le(ee.fromEntityId,ee.fromEntityName,ee.fromEntityTypeName),he=Le(ee.toEntityId,ee.toEntityName,ee.toEntityTypeName);if(window.confirm(`Delete relationship "${me}"  "${he}"? This action cannot be undone.`))try{V(ee.id),await A4(ee.id),fe("Relationship deleted","success"),q&&await Me(q)}catch(We){console.error(" Failed to delete relationship",We),fe(We.message||"Failed to delete relationship","error")}finally{V("")}};return a.jsxs("section",{className:"entities-page relationships-page",children:[a.jsxs("div",{className:"entities-header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Entity Relationships"}),Y?a.jsx("p",{className:"entities-subtitle",children:nt}):a.jsx("p",{className:"entities-subtitle",children:"Select a campaign or world you own to choose a world context."})]}),a.jsxs("div",{className:"entities-controls",children:[a.jsxs("select",{value:$,onChange:ee=>T(ee.target.value),disabled:D||N.length===0,title:"Filter by relationship type",children:[a.jsx("option",{value:"",children:"All types"}),N.map(ee=>a.jsx("option",{value:String(ee.id),children:ee.name},ee.id))]}),a.jsx(Uy,{value:U,onChange:M}),a.jsx("button",{type:"button",className:"icon-btn",title:"Refresh relationships",onClick:At,disabled:!q||_,children:a.jsx(Ll,{size:16})}),a.jsxs("button",{type:"button",className:"btn submit",onClick:Ue,disabled:!ne||!q||_,children:[a.jsx(Ya,{size:16})," Add Relationship"]})]})]}),i&&Y&&!ne&&a.jsx("div",{className:"alert info",role:"status",children:"You can view existing relationships, but only the world owner, a campaign DM, or a system administrator can create or edit them."}),k&&a.jsx("div",{className:`toast-banner ${k.tone}`,role:"status",children:k.message}),z&&a.jsx("div",{className:"alert error",role:"alert",children:z}),_?a.jsx("div",{className:"empty-state",children:"Loading relationships..."}):q?Tt?a.jsx("div",{className:"entities-table-wrapper",children:a.jsxs("table",{className:"entities-table relationships-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"From Entity"}),a.jsx("th",{children:"Relationship Type"}),a.jsx("th",{children:"To Entity"}),a.jsx("th",{children:"Bidirectional"}),ne&&a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:wt.map(ee=>{const me=Le(ee.fromEntityId,ee.fromEntityName,ee.fromEntityTypeName),he=Le(ee.toEntityId,ee.toEntityName,ee.toEntityTypeName);return a.jsxs("tr",{children:[a.jsx("td",{children:me}),a.jsx("td",{children:ee.typeName||""}),a.jsx("td",{children:he}),a.jsx("td",{children:a.jsx("span",{className:`visibility-badge ${ee.bidirectional?"badge-visible":"badge-hidden"}`,children:ee.bidirectional?"Yes":"No"})}),ne&&a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Je(ee),title:"Edit relationship",disabled:_,children:a.jsx(ir,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>Ve(ee),title:"Delete relationship",disabled:G===ee.id,children:a.jsx(ha,{size:16})})]})})]},ee.id)})})]})}):a.jsx("div",{className:"empty-state",children:$||U?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"empty-title",children:"No relationships match your filters."}),a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>{T(""),M("")},children:"Clear filters"})]}):ne?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"empty-title",children:"No relationships yet."}),a.jsxs("button",{type:"button",className:"btn submit",onClick:Ue,disabled:!q,children:[a.jsx(Ya,{size:16})," Add your first relationship"]})]}):a.jsx("p",{className:"empty-title",children:"No relationships to display."})}):a.jsx("div",{className:"empty-state",children:"Select a campaign or world you own to view its relationships."}),h&&a.jsx(Xr,{isOpen:p,onClose:()=>y(!1),title:"Add Relationship",description:"Link two entities in this world.",size:"lg",children:a.jsx(yN,{worldId:q,existingRelationships:S||[],onCreated:()=>{y(!1),Me(q),fe("Relationship created","success")},onCancel:()=>y(!1)})}),a.jsx(Xr,{isOpen:g,onClose:de,title:Ct,size:"lg",footerActions:a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:de,disabled:I.cancelDisabled,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",form:ie.current,disabled:I.submitDisabled,children:I.submitLabel})]}),children:a.jsx(qI,{worldId:q,relationshipId:X,onCancel:de,onSaved:ye,onStateChange:ue,formId:ie.current,hideActions:!0})})]})}const VI=new Set(["system_admin"]),YI=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},CS=(e=[])=>!Array.isArray(e)||e.length===0?"":e.map(t=>t?.name||t?.label||"Unknown").filter(Boolean).join(", "),GI=e=>{if(!e)return"";const t=e.from_name||e.fromName||e.name||"",r=e.to_name||e.toName||e.name||"";return`${t}  ${r}`};function XI(){const e=$n(),t=Xa(),{user:r,token:i,sessionReady:l}=En(),{selectedCampaign:c}=Un(),[f,m]=u.useState([]),[h,p]=u.useState(!1),[y,g]=u.useState(""),[v,S]=u.useState(null),[w,N]=u.useState(""),E=u.useMemo(()=>{if(!c?.world)return"";const k=c.world;return k.created_by||k.creator?.id||k.owner_id||k.owner?.id||""},[c]),C=!!(r?.id&&E===r.id),A=u.useMemo(()=>r?r.role&&VI.has(r.role)?!0:C:!1,[r,C]),O=c?.world?.id??"",_=!!O,R=u.useRef(O),D=u.useMemo(()=>{if(!c)return"";const k=c.name||"Selected campaign",F=c.world?.name;return F?`${k}  ${F}`:k},[c]);u.useEffect(()=>{if(!v)return;const k=setTimeout(()=>S(null),3500);return()=>clearTimeout(k)},[v]);const j=u.useCallback((k,F="info")=>{S({message:k,tone:F})},[]),z=u.useCallback(()=>{e(t.pathname,{replace:!0,state:{}})},[t.pathname,e]);u.useEffect(()=>{if(t.state?.toast){const{message:k,tone:F}=t.state.toast;j(k,F),z()}},[t.state,j,z]),u.useEffect(()=>{R.current!==O&&(R.current=O,m([]),g(""),p(!1),S(null),N(""))},[O]);const P=u.useCallback(async()=>{if(!(!i||!A)){if(!O){m([]),g("");return}p(!0),g("");try{const k=await pf({worldId:O}),F=Array.isArray(k)?k:Array.isArray(k?.data)?k.data:[];m(F)}catch(k){console.error(" Failed to load relationship types",k),m([]),g(k.message||"Failed to load relationship types")}finally{p(!1)}}},[i,A,O]);u.useEffect(()=>{if(!(!l||!i||!A)){if(!O){m([]),p(!1),g("");return}P()}},[l,i,A,O,P]);const X=()=>{!i||h||!_||!A||P()},H=()=>{!A||!_||e("/relationship-types/new")},G=k=>{!A||!k?.id||e(`/relationship-types/${k.id}/edit`)},V=async k=>{if(!(!A||!_||!k?.id||!window.confirm(`Delete relationship type "${k.name}"? This cannot be undone.`)))try{N(k.id),await D4(k.id),j("Relationship type deleted","success"),await P()}catch(I){console.error(" Failed to delete relationship type",I),j(I.message||"Failed to delete relationship type","error")}finally{N("")}};return l?i?A?a.jsxs("section",{className:"entity-types-page relationship-types-page",children:[a.jsxs("div",{className:"entity-types-header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Relationship Types"}),c?a.jsxs("p",{className:"entity-types-subtitle",children:[D,_?`  ${f.length} types defined`:""]}):a.jsx("p",{className:"entity-types-subtitle",children:"Select a campaign from the header to choose a world context."})]}),a.jsxs("div",{className:"entity-types-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Refresh",onClick:X,disabled:h||!_,children:a.jsx(Ll,{size:16})}),a.jsxs("button",{type:"button",className:"btn submit",onClick:H,disabled:h||!_,children:[a.jsx(Ya,{size:18})," Add Relationship Type"]})]})]}),v&&a.jsx("div",{className:`toast-banner ${v.tone}`,children:v.message}),y&&a.jsx("div",{className:"alert error",children:y}),a.jsx("div",{className:"entity-types-table-wrapper",children:_?h?a.jsx("div",{className:"empty-state",children:"Loading relationship types..."}):f.length===0?a.jsx("div",{className:"empty-state",children:"No relationship types defined yet."}):a.jsxs("table",{className:"entity-types-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Name"}),a.jsx("th",{children:"Directional Labels"}),a.jsx("th",{children:"World"}),a.jsx("th",{children:"Allowed Sources"}),a.jsx("th",{children:"Allowed Targets"}),a.jsx("th",{children:"Created"}),a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:f.map(k=>{const F=k.createdAt||k.created_at;return a.jsxs("tr",{children:[a.jsx("td",{children:k.name}),a.jsx("td",{children:GI(k)}),a.jsx("td",{children:k.world?.name||""}),a.jsx("td",{children:CS(k.from_entity_types)}),a.jsx("td",{children:CS(k.to_entity_types)}),a.jsx("td",{children:YI(F)}),a.jsxs("td",{className:"actions-column",children:[a.jsx("button",{className:"icon-btn",title:"Edit",onClick:()=>G(k),disabled:h||w===k.id,children:a.jsx(ir,{size:16})}),a.jsx("button",{className:"icon-btn danger",title:"Delete",onClick:()=>V(k),disabled:w===k.id,children:a.jsx(ha,{size:16})})]})]},k.id)})})]}):a.jsx("div",{className:"empty-state",children:"Select a campaign from the header to view relationship types."})})]}):a.jsxs("section",{className:"entity-types-page relationship-types-page",children:[a.jsx("div",{className:"entity-types-header",children:a.jsx("h1",{children:"Relationship Types"})}),a.jsx("div",{className:"alert info",children:"Only system administrators or the world owner can manage relationship types."})]}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const AS=e=>Array.isArray(e)?[...new Set(e.map(t=>t?String(t):"").filter(Boolean))]:[],TS=(e={})=>({name:e?.name||"",fromName:e?.from_name||e?.fromName||"",toName:e?.to_name||e?.toName||"",description:e?.description||"",worldId:e?.world?.id||e?.world_id||"",fromEntityTypeIds:AS((e?.from_entity_types||[]).map(t=>t?.id||t?.entity_type_id)),toEntityTypeIds:AS((e?.to_entity_types||[]).map(t=>t?.id||t?.entity_type_id))}),MS=(e=[],t=[])=>{if(e.length!==t.length)return!1;const r=[...e].sort(),i=[...t].sort();return r.every((l,c)=>l===i[c])};function IN({initialValues:e={},entityTypes:t=[],worlds:r=[],saving:i=!1,optionsLoading:l=!1,errorMessage:c="",onSubmit:f,onCancel:m}){const h=u.useMemo(()=>TS(e),[e]),[p,y]=u.useState(h),[g,v]=u.useState("");u.useEffect(()=>{y(TS(e)),v("")},[e]),u.useEffect(()=>{v(c||"")},[c]);const S=u.useMemo(()=>p.name!==h.name||p.fromName!==h.fromName||p.toName!==h.toName||p.description!==h.description||p.worldId!==h.worldId||!MS(p.fromEntityTypeIds,h.fromEntityTypeIds)||!MS(p.toEntityTypeIds,h.toEntityTypeIds),[h,p]),w=u.useMemo(()=>Array.isArray(t)?t.map(O=>{const _=O?.id||O?.entity_type_id||O?.entityTypeId||O?.value||"";if(!_)return null;const R=O?.world_id||O?.worldId||O?.world?.id||"";return{value:String(_),label:O?.name||O?.label||"Untitled type",worldId:R?String(R):""}}).filter(Boolean):[],[t]),N=u.useMemo(()=>{const O=p.worldId?String(p.worldId):"";return O?w.filter(_=>_.worldId===O):[]},[w,p.worldId]);u.useEffect(()=>{if(!(p.worldId?String(p.worldId):"")){y(R=>R.fromEntityTypeIds.length===0&&R.toEntityTypeIds.length===0?R:{...R,fromEntityTypeIds:[],toEntityTypeIds:[]});return}const _=new Set(N.map(R=>R.value));y(R=>{const D=R.fromEntityTypeIds.filter(z=>_.has(String(z))),j=R.toEntityTypeIds.filter(z=>_.has(String(z)));return D.length===R.fromEntityTypeIds.length&&j.length===R.toEntityTypeIds.length?R:{...R,fromEntityTypeIds:D,toEntityTypeIds:j}})},[N,p.worldId]);const E=O=>_=>{const{value:R}=_.target;y(D=>({...D,[O]:R}))},C=O=>(_=[])=>{const R=Array.isArray(_)?_:[];y(D=>({...D,[O]:R}))},A=async O=>{O.preventDefault();const _=p.name.trim(),R=p.fromName.trim(),D=p.toName.trim();if(!_)return v("Name is required.");if(!R)return v("Provide a label for the source direction.");if(!D)return v("Provide a label for the target direction.");if(!p.worldId)return v("Select a world for this relationship type.");if(!p.fromEntityTypeIds.length)return v("Select at least one allowed source entity type.");if(!p.toEntityTypeIds.length)return v("Select at least one allowed target entity type.");v("");const j={name:_,from_name:R,to_name:D,description:p.description?.trim()||"",world_id:p.worldId,from_entity_type_ids:p.fromEntityTypeIds,to_entity_type_ids:p.toEntityTypeIds};try{if(await f?.(j)===!1)return}catch(z){v(z.message||"Failed to save relationship type")}};return a.jsxs("form",{className:"relationship-type-form",onSubmit:A,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-name",children:"Name *"}),a.jsx("input",{id:"relationship-type-name",type:"text",value:p.name,onChange:E("name"),placeholder:"e.g. Enemy",disabled:i||l,autoFocus:!0})]}),a.jsxs("div",{className:"form-two-column",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-from-name",children:"Source relationship label *"}),a.jsx("input",{id:"relationship-type-from-name",type:"text",value:p.fromName,onChange:E("fromName"),placeholder:"e.g. Parent of",disabled:i||l})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-to-name",children:"Target relationship label *"}),a.jsx("input",{id:"relationship-type-to-name",type:"text",value:p.toName,onChange:E("toName"),placeholder:"e.g. Child of",disabled:i||l})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-description",children:"Description"}),a.jsx("textarea",{id:"relationship-type-description",value:p.description,onChange:E("description"),placeholder:"Optional description",rows:4,disabled:i||l,className:"textarea-field"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-world",children:"World *"}),a.jsxs("select",{id:"relationship-type-world",value:p.worldId,onChange:E("worldId"),disabled:i||l,required:!0,children:[a.jsx("option",{value:"",children:"Select world..."}),r.map(O=>a.jsx("option",{value:O.id,children:O.name},O.id))]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-from-entities",children:"Allowed source entity types *"}),a.jsx(Rs,{selected:p.fromEntityTypeIds,options:N,onChange:C("fromEntityTypeIds"),placeholder:"Search entity types...",disabled:i||l,loading:l,noOptionsMessage:p.worldId?"No entity types available for this world.":"Select a world to choose entity types."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-to-entities",children:"Allowed target entity types *"}),a.jsx(Rs,{selected:p.toEntityTypeIds,options:N,onChange:C("toEntityTypeIds"),placeholder:"Search entity types...",disabled:i||l,loading:l,noOptionsMessage:p.worldId?"No entity types available for this world.":"Select a world to choose entity types."})]}),g&&a.jsx("div",{className:"form-error",children:g}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:m,disabled:i,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:i||l||!S,children:i?"Saving...":"Save"})]})]})}function KI(){const e=$n(),{user:t,token:r,sessionReady:i}=En(),{selectedCampaign:l}=Un(),[c,f]=u.useState([]),[m,h]=u.useState(!1),[p,y]=u.useState(""),[g,v]=u.useState(""),[S,w]=u.useState(!1),N=u.useMemo(()=>{if(!l?.world)return"";const j=l.world;return j.created_by||j.creator?.id||j.owner_id||j.owner?.id||""},[l]),E=!!(t?.id&&N===t.id),C=u.useMemo(()=>t?t.role==="system_admin"?!0:E:!1,[t,E]),A=l?.world?.id??"",O=u.useMemo(()=>{if(!l?.world?.id)return[];const j=l.world;return[{id:j.id,name:j.name||"Untitled world"}]},[l]),_=u.useCallback(async()=>{if(!r||!A){f([]),y("Select a campaign to choose a world context before creating relationship types.");return}h(!0),y("");try{const j=await Jr({worldId:A}),z=Array.isArray(j?.data)?j.data:Array.isArray(j)?j:[];f(z)}catch(j){console.error(" Failed to load relationship type options",j),f([]),y(j.message||"Failed to load supporting data")}finally{h(!1)}},[r,A]);if(u.useEffect(()=>{!i||!r||_()},[i,r,_]),!i)return a.jsx("p",{children:"Restoring session..."});if(!r)return a.jsx("p",{children:"Authenticating..."});if(!C)return a.jsxs("section",{className:"page relationship-type-form-page limited-access",children:[a.jsx("h1",{children:"Create Relationship Type"}),a.jsx("p",{children:"Only system administrators or the world owner can create relationship types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]});if(!A)return a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Create Relationship Type"}),a.jsx("p",{children:"Select a campaign from the header to choose a world context before creating relationship types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]});const R=()=>e("/relationship-types"),D=async j=>{if(S)return!1;v(""),w(!0);try{const z={...j,world_id:j.world_id??j.worldId??j.world?.id??A};if(!z.world_id)throw new Error("A world must be selected before creating a relationship type");console.log(" Final payload being sent:",z);const P=await R4(z),X=P?.data??P;if(!X||!X.id)throw new Error("Failed to create relationship type");return e("/relationship-types",{state:{toast:{message:"Relationship type created",tone:"success"}}}),!0}catch(z){return console.error(" Failed to create relationship type",z),v(z.message||"Failed to create relationship type"),!1}finally{w(!1)}};return a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Create Relationship Type"}),a.jsx("p",{className:"page-subtitle",children:"Define the directional names and allowed entity types for this relationship."}),p&&a.jsx("div",{className:"alert error",children:p}),a.jsx(IN,{initialValues:{world_id:A},entityTypes:c,worlds:O,saving:S,optionsLoading:m,errorMessage:g,onSubmit:D,onCancel:R})]})}function WI(){const e=$n(),{id:t}=Ss(),{user:r,token:i,sessionReady:l}=En(),{selectedCampaign:c}=Un(),[f,m]=u.useState([]),[h,p]=u.useState(!1),[y,g]=u.useState(""),[v,S]=u.useState(""),[w,N]=u.useState(null),[E,C]=u.useState(!0),[A,O]=u.useState(""),[_,R]=u.useState(!1),D=r?.role==="system_admin",j=u.useMemo(()=>{if(!c||!r)return!1;const $=c.world?.created_by??c.world?.creator?.id??c.world?.owner_id??c.world?.owner?.id??"";return $?$===r.id:!1},[c,r]),z=u.useMemo(()=>!!(D||j),[D,j]),P=c?.world?.id??"",X=c?.world?.name??"",H=u.useMemo(()=>{if(!w)return null;const $=w?.world?.id||w?.world_id||w?.worldId||"";if(!$)return null;const T=w?.world?.name||w?.world_name||w?.worldName||"";return{id:$,name:T||"Untitled world"}},[w]),[G,V]=u.useState([]);u.useEffect(()=>{const $=[];P&&$.push({id:P,name:X||"Untitled world"}),H&&!$.some(T=>T.id===H.id)&&$.push(H),V($)},[P,X,H]);const k=u.useCallback(async()=>{if(i){p(!0),g("");try{const $=P||H?.id||w?.world?.id||w?.world_id||"";if(!$){m([]),g("Select a campaign to choose a world context before editing relationship types.");return}const T=await Jr({worldId:$}),U=Array.isArray(T?.data)?T.data:Array.isArray(T)?T:[];m(U)}catch($){console.error(" Failed to load relationship type options",$),m([]),g($.message||"Failed to load supporting data")}finally{p(!1)}}},[i,P,H,w]),F=u.useCallback(async()=>{if(!(!i||!t)){C(!0),O("");try{const $=await M4(t),T=$?.data??$;if(!T)throw new Error("Relationship type not found");N(T)}catch($){console.error(" Failed to load relationship type",$),O($.message||"Failed to load relationship type"),N(null)}finally{C(!1)}}},[t,i]);if(u.useEffect(()=>{!l||!i||F()},[l,i,F]),u.useEffect(()=>{!l||!i||E||k()},[l,i,E,k]),!l)return a.jsx("p",{children:"Restoring session..."});if(!i)return a.jsx("p",{children:"Authenticating..."});if(!z)return a.jsxs("section",{className:"page relationship-type-form-page limited-access",children:[a.jsx("h1",{children:"Edit Relationship Type"}),a.jsx("p",{children:"Only system administrators can edit relationship types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]});const I=()=>e("/relationship-types"),L=async $=>{if(_||!t)return!1;S(""),R(!0);try{const T={...$,world_id:$.world_id||$.worldId||$.selectedWorldId||$.world?.id||P||w?.world_id};if(!T.world_id)throw new Error("A world must be selected before saving changes");const U=await k4(t,T),M=U?.data??U;if(!M||!M.id)throw new Error("Failed to update relationship type");return e("/relationship-types",{state:{toast:{message:"Relationship type updated",tone:"success"}}}),!0}catch(T){return console.error(" Failed to update relationship type",T),S(T.message||"Failed to update relationship type"),!1}finally{R(!1)}};return E?a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Edit Relationship Type"}),a.jsx("div",{className:"form-status",children:"Loading relationship type..."})]}):A||!w?a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Edit Relationship Type"}),a.jsx("div",{className:"alert error",children:A||"Relationship type not found."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]}):a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Edit Relationship Type"}),a.jsx("p",{className:"page-subtitle",children:"Update the directional labels or allowed entity types for this relationship."}),y&&a.jsx("div",{className:"alert error",children:y}),a.jsx(IN,{initialValues:w,entityTypes:f,worlds:G,saving:_,optionsLoading:h,errorMessage:v,onSubmit:L,onCancel:I})]})}function ZI(){return a.jsx("section",{className:"page-placeholder",children:a.jsx("h1",{children:"Entity Secrets Page  Coming Soon"})})}function QI({children:e}){const{token:t,sessionReady:r}=En();return r?t?e:a.jsx(Xo,{to:"/login",replace:!0}):a.jsx("p",{children:"Restoring session..."})}function pa(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let r=0,i;r<e.length;r++)(i=pa(e[r]))!==""&&(t+=(t&&" ")+i);else for(let r in e)e[r]&&(t+=(t&&" ")+r);return t}var mp={exports:{}},hp={},pp={exports:{}},yp={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RS;function JI(){if(RS)return yp;RS=1;var e=Sc();function t(g,v){return g===v&&(g!==0||1/g===1/v)||g!==g&&v!==v}var r=typeof Object.is=="function"?Object.is:t,i=e.useState,l=e.useEffect,c=e.useLayoutEffect,f=e.useDebugValue;function m(g,v){var S=v(),w=i({inst:{value:S,getSnapshot:v}}),N=w[0].inst,E=w[1];return c(function(){N.value=S,N.getSnapshot=v,h(N)&&E({inst:N})},[g,S,v]),l(function(){return h(N)&&E({inst:N}),g(function(){h(N)&&E({inst:N})})},[g]),f(S),S}function h(g){var v=g.getSnapshot;g=g.value;try{var S=v();return!r(g,S)}catch{return!0}}function p(g,v){return v()}var y=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?p:m;return yp.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:y,yp}var kS;function eL(){return kS||(kS=1,pp.exports=JI()),pp.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DS;function tL(){if(DS)return hp;DS=1;var e=Sc(),t=eL();function r(p,y){return p===y&&(p!==0||1/p===1/y)||p!==p&&y!==y}var i=typeof Object.is=="function"?Object.is:r,l=t.useSyncExternalStore,c=e.useRef,f=e.useEffect,m=e.useMemo,h=e.useDebugValue;return hp.useSyncExternalStoreWithSelector=function(p,y,g,v,S){var w=c(null);if(w.current===null){var N={hasValue:!1,value:null};w.current=N}else N=w.current;w=m(function(){function C(D){if(!A){if(A=!0,O=D,D=v(D),S!==void 0&&N.hasValue){var j=N.value;if(S(j,D))return _=j}return _=D}if(j=_,i(O,D))return j;var z=v(D);return S!==void 0&&S(j,z)?(O=D,j):(O=D,_=z)}var A=!1,O,_,R=g===void 0?null:g;return[function(){return C(y())},R===null?void 0:function(){return C(R())}]},[y,g,v,S]);var E=l(p,w[0],w[1]);return f(function(){N.hasValue=!0,N.value=E},[E]),h(E),E},hp}var IS;function nL(){return IS||(IS=1,mp.exports=tL()),mp.exports}var aL=nL();const sL=Ri(aL),rL={},LS=e=>{let t;const r=new Set,i=(y,g)=>{const v=typeof y=="function"?y(t):y;if(!Object.is(v,t)){const S=t;t=g??(typeof v!="object"||v===null)?v:Object.assign({},t,v),r.forEach(w=>w(t,S))}},l=()=>t,h={setState:i,getState:l,getInitialState:()=>p,subscribe:y=>(r.add(y),()=>r.delete(y)),destroy:()=>{(rL?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},p=t=e(i,l,h);return h},iL=e=>e?LS(e):LS,{useDebugValue:lL}=De,{useSyncExternalStoreWithSelector:oL}=sL,cL=e=>e;function LN(e,t=cL,r){const i=oL(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return lL(i),i}const OS=(e,t)=>{const r=iL(e),i=(l,c=t)=>LN(r,l,c);return Object.assign(i,r),i},uL=(e,t)=>e?OS(e,t):OS;function ia(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[i,l]of e)if(!Object.is(l,t.get(i)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(const i of r)if(!Object.prototype.hasOwnProperty.call(t,i)||!Object.is(e[i],t[i]))return!1;return!0}var dL={value:()=>{}};function gf(){for(var e=0,t=arguments.length,r={},i;e<t;++e){if(!(i=arguments[e]+"")||i in r||/[\s.]/.test(i))throw new Error("illegal type: "+i);r[i]=[]}return new xd(r)}function xd(e){this._=e}function fL(e,t){return e.trim().split(/^|\s+/).map(function(r){var i="",l=r.indexOf(".");if(l>=0&&(i=r.slice(l+1),r=r.slice(0,l)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:i}})}xd.prototype=gf.prototype={constructor:xd,on:function(e,t){var r=this._,i=fL(e+"",r),l,c=-1,f=i.length;if(arguments.length<2){for(;++c<f;)if((l=(e=i[c]).type)&&(l=mL(r[l],e.name)))return l;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++c<f;)if(l=(e=i[c]).type)r[l]=zS(r[l],e.name,t);else if(t==null)for(l in r)r[l]=zS(r[l],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new xd(e)},call:function(e,t){if((l=arguments.length-2)>0)for(var r=new Array(l),i=0,l,c;i<l;++i)r[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(c=this._[e],i=0,l=c.length;i<l;++i)c[i].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],l=0,c=i.length;l<c;++l)i[l].value.apply(t,r)}};function mL(e,t){for(var r=0,i=e.length,l;r<i;++r)if((l=e[r]).name===t)return l.value}function zS(e,t,r){for(var i=0,l=e.length;i<l;++i)if(e[i].name===t){e[i]=dL,e=e.slice(0,i).concat(e.slice(i+1));break}return r!=null&&e.push({name:t,value:r}),e}var ey="http://www.w3.org/1999/xhtml";const $S={svg:"http://www.w3.org/2000/svg",xhtml:ey,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function bf(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),$S.hasOwnProperty(t)?{space:$S[t],local:e}:e}function hL(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===ey&&t.documentElement.namespaceURI===ey?t.createElement(e):t.createElementNS(r,e)}}function pL(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function ON(e){var t=bf(e);return(t.local?pL:hL)(t)}function yL(){}function ng(e){return e==null?yL:function(){return this.querySelector(e)}}function gL(e){typeof e!="function"&&(e=ng(e));for(var t=this._groups,r=t.length,i=new Array(r),l=0;l<r;++l)for(var c=t[l],f=c.length,m=i[l]=new Array(f),h,p,y=0;y<f;++y)(h=c[y])&&(p=e.call(h,h.__data__,y,c))&&("__data__"in h&&(p.__data__=h.__data__),m[y]=p);return new Ga(i,this._parents)}function bL(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function vL(){return[]}function zN(e){return e==null?vL:function(){return this.querySelectorAll(e)}}function xL(e){return function(){return bL(e.apply(this,arguments))}}function SL(e){typeof e=="function"?e=xL(e):e=zN(e);for(var t=this._groups,r=t.length,i=[],l=[],c=0;c<r;++c)for(var f=t[c],m=f.length,h,p=0;p<m;++p)(h=f[p])&&(i.push(e.call(h,h.__data__,p,f)),l.push(h));return new Ga(i,l)}function $N(e){return function(){return this.matches(e)}}function FN(e){return function(t){return t.matches(e)}}var wL=Array.prototype.find;function NL(e){return function(){return wL.call(this.children,e)}}function EL(){return this.firstElementChild}function jL(e){return this.select(e==null?EL:NL(typeof e=="function"?e:FN(e)))}var _L=Array.prototype.filter;function CL(){return Array.from(this.children)}function AL(e){return function(){return _L.call(this.children,e)}}function TL(e){return this.selectAll(e==null?CL:AL(typeof e=="function"?e:FN(e)))}function ML(e){typeof e!="function"&&(e=$N(e));for(var t=this._groups,r=t.length,i=new Array(r),l=0;l<r;++l)for(var c=t[l],f=c.length,m=i[l]=[],h,p=0;p<f;++p)(h=c[p])&&e.call(h,h.__data__,p,c)&&m.push(h);return new Ga(i,this._parents)}function BN(e){return new Array(e.length)}function RL(){return new Ga(this._enter||this._groups.map(BN),this._parents)}function Od(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Od.prototype={constructor:Od,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function kL(e){return function(){return e}}function DL(e,t,r,i,l,c){for(var f=0,m,h=t.length,p=c.length;f<p;++f)(m=t[f])?(m.__data__=c[f],i[f]=m):r[f]=new Od(e,c[f]);for(;f<h;++f)(m=t[f])&&(l[f]=m)}function IL(e,t,r,i,l,c,f){var m,h,p=new Map,y=t.length,g=c.length,v=new Array(y),S;for(m=0;m<y;++m)(h=t[m])&&(v[m]=S=f.call(h,h.__data__,m,t)+"",p.has(S)?l[m]=h:p.set(S,h));for(m=0;m<g;++m)S=f.call(e,c[m],m,c)+"",(h=p.get(S))?(i[m]=h,h.__data__=c[m],p.delete(S)):r[m]=new Od(e,c[m]);for(m=0;m<y;++m)(h=t[m])&&p.get(v[m])===h&&(l[m]=h)}function LL(e){return e.__data__}function OL(e,t){if(!arguments.length)return Array.from(this,LL);var r=t?IL:DL,i=this._parents,l=this._groups;typeof e!="function"&&(e=kL(e));for(var c=l.length,f=new Array(c),m=new Array(c),h=new Array(c),p=0;p<c;++p){var y=i[p],g=l[p],v=g.length,S=zL(e.call(y,y&&y.__data__,p,i)),w=S.length,N=m[p]=new Array(w),E=f[p]=new Array(w),C=h[p]=new Array(v);r(y,g,N,E,C,S,t);for(var A=0,O=0,_,R;A<w;++A)if(_=N[A]){for(A>=O&&(O=A+1);!(R=E[O])&&++O<w;);_._next=R||null}}return f=new Ga(f,i),f._enter=m,f._exit=h,f}function zL(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function $L(){return new Ga(this._exit||this._groups.map(BN),this._parents)}function FL(e,t,r){var i=this.enter(),l=this,c=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),t!=null&&(l=t(l),l&&(l=l.selection())),r==null?c.remove():r(c),i&&l?i.merge(l).order():l}function BL(e){for(var t=e.selection?e.selection():e,r=this._groups,i=t._groups,l=r.length,c=i.length,f=Math.min(l,c),m=new Array(l),h=0;h<f;++h)for(var p=r[h],y=i[h],g=p.length,v=m[h]=new Array(g),S,w=0;w<g;++w)(S=p[w]||y[w])&&(v[w]=S);for(;h<l;++h)m[h]=r[h];return new Ga(m,this._parents)}function UL(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var i=e[t],l=i.length-1,c=i[l],f;--l>=0;)(f=i[l])&&(c&&f.compareDocumentPosition(c)^4&&c.parentNode.insertBefore(f,c),c=f);return this}function qL(e){e||(e=HL);function t(g,v){return g&&v?e(g.__data__,v.__data__):!g-!v}for(var r=this._groups,i=r.length,l=new Array(i),c=0;c<i;++c){for(var f=r[c],m=f.length,h=l[c]=new Array(m),p,y=0;y<m;++y)(p=f[y])&&(h[y]=p);h.sort(t)}return new Ga(l,this._parents).order()}function HL(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function PL(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function VL(){return Array.from(this)}function YL(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],l=0,c=i.length;l<c;++l){var f=i[l];if(f)return f}return null}function GL(){let e=0;for(const t of this)++e;return e}function XL(){return!this.node()}function KL(e){for(var t=this._groups,r=0,i=t.length;r<i;++r)for(var l=t[r],c=0,f=l.length,m;c<f;++c)(m=l[c])&&e.call(m,m.__data__,c,l);return this}function WL(e){return function(){this.removeAttribute(e)}}function ZL(e){return function(){this.removeAttributeNS(e.space,e.local)}}function QL(e,t){return function(){this.setAttribute(e,t)}}function JL(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function e5(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function t5(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function n5(e,t){var r=bf(e);if(arguments.length<2){var i=this.node();return r.local?i.getAttributeNS(r.space,r.local):i.getAttribute(r)}return this.each((t==null?r.local?ZL:WL:typeof t=="function"?r.local?t5:e5:r.local?JL:QL)(r,t))}function UN(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function a5(e){return function(){this.style.removeProperty(e)}}function s5(e,t,r){return function(){this.style.setProperty(e,t,r)}}function r5(e,t,r){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,r)}}function i5(e,t,r){return arguments.length>1?this.each((t==null?a5:typeof t=="function"?r5:s5)(e,t,r??"")):Rl(this.node(),e)}function Rl(e,t){return e.style.getPropertyValue(t)||UN(e).getComputedStyle(e,null).getPropertyValue(t)}function l5(e){return function(){delete this[e]}}function o5(e,t){return function(){this[e]=t}}function c5(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function u5(e,t){return arguments.length>1?this.each((t==null?l5:typeof t=="function"?c5:o5)(e,t)):this.node()[e]}function qN(e){return e.trim().split(/^|\s+/)}function ag(e){return e.classList||new HN(e)}function HN(e){this._node=e,this._names=qN(e.getAttribute("class")||"")}HN.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function PN(e,t){for(var r=ag(e),i=-1,l=t.length;++i<l;)r.add(t[i])}function VN(e,t){for(var r=ag(e),i=-1,l=t.length;++i<l;)r.remove(t[i])}function d5(e){return function(){PN(this,e)}}function f5(e){return function(){VN(this,e)}}function m5(e,t){return function(){(t.apply(this,arguments)?PN:VN)(this,e)}}function h5(e,t){var r=qN(e+"");if(arguments.length<2){for(var i=ag(this.node()),l=-1,c=r.length;++l<c;)if(!i.contains(r[l]))return!1;return!0}return this.each((typeof t=="function"?m5:t?d5:f5)(r,t))}function p5(){this.textContent=""}function y5(e){return function(){this.textContent=e}}function g5(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function b5(e){return arguments.length?this.each(e==null?p5:(typeof e=="function"?g5:y5)(e)):this.node().textContent}function v5(){this.innerHTML=""}function x5(e){return function(){this.innerHTML=e}}function S5(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function w5(e){return arguments.length?this.each(e==null?v5:(typeof e=="function"?S5:x5)(e)):this.node().innerHTML}function N5(){this.nextSibling&&this.parentNode.appendChild(this)}function E5(){return this.each(N5)}function j5(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function _5(){return this.each(j5)}function C5(e){var t=typeof e=="function"?e:ON(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function A5(){return null}function T5(e,t){var r=typeof e=="function"?e:ON(e),i=t==null?A5:typeof t=="function"?t:ng(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),i.apply(this,arguments)||null)})}function M5(){var e=this.parentNode;e&&e.removeChild(this)}function R5(){return this.each(M5)}function k5(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function D5(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function I5(e){return this.select(e?D5:k5)}function L5(e){return arguments.length?this.property("__data__",e):this.node().__data__}function O5(e){return function(t){e.call(this,t,this.__data__)}}function z5(e){return e.trim().split(/^|\s+/).map(function(t){var r="",i=t.indexOf(".");return i>=0&&(r=t.slice(i+1),t=t.slice(0,i)),{type:t,name:r}})}function $5(e){return function(){var t=this.__on;if(t){for(var r=0,i=-1,l=t.length,c;r<l;++r)c=t[r],(!e.type||c.type===e.type)&&c.name===e.name?this.removeEventListener(c.type,c.listener,c.options):t[++i]=c;++i?t.length=i:delete this.__on}}}function F5(e,t,r){return function(){var i=this.__on,l,c=O5(t);if(i){for(var f=0,m=i.length;f<m;++f)if((l=i[f]).type===e.type&&l.name===e.name){this.removeEventListener(l.type,l.listener,l.options),this.addEventListener(l.type,l.listener=c,l.options=r),l.value=t;return}}this.addEventListener(e.type,c,r),l={type:e.type,name:e.name,value:t,listener:c,options:r},i?i.push(l):this.__on=[l]}}function B5(e,t,r){var i=z5(e+""),l,c=i.length,f;if(arguments.length<2){var m=this.node().__on;if(m){for(var h=0,p=m.length,y;h<p;++h)for(l=0,y=m[h];l<c;++l)if((f=i[l]).type===y.type&&f.name===y.name)return y.value}return}for(m=t?F5:$5,l=0;l<c;++l)this.each(m(i[l],t,r));return this}function YN(e,t,r){var i=UN(e),l=i.CustomEvent;typeof l=="function"?l=new l(t,r):(l=i.document.createEvent("Event"),r?(l.initEvent(t,r.bubbles,r.cancelable),l.detail=r.detail):l.initEvent(t,!1,!1)),e.dispatchEvent(l)}function U5(e,t){return function(){return YN(this,e,t)}}function q5(e,t){return function(){return YN(this,e,t.apply(this,arguments))}}function H5(e,t){return this.each((typeof t=="function"?q5:U5)(e,t))}function*P5(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],l=0,c=i.length,f;l<c;++l)(f=i[l])&&(yield f)}var GN=[null];function Ga(e,t){this._groups=e,this._parents=t}function Cc(){return new Ga([[document.documentElement]],GN)}function V5(){return this}Ga.prototype=Cc.prototype={constructor:Ga,select:gL,selectAll:SL,selectChild:jL,selectChildren:TL,filter:ML,data:OL,enter:RL,exit:$L,join:FL,merge:BL,selection:V5,order:UL,sort:qL,call:PL,nodes:VL,node:YL,size:GL,empty:XL,each:KL,attr:n5,style:i5,property:u5,classed:h5,text:b5,html:w5,raise:E5,lower:_5,append:C5,insert:T5,remove:R5,clone:I5,datum:L5,on:B5,dispatch:H5,[Symbol.iterator]:P5};function is(e){return typeof e=="string"?new Ga([[document.querySelector(e)]],[document.documentElement]):new Ga([[e]],GN)}function Y5(e){let t;for(;t=e.sourceEvent;)e=t;return e}function ps(e,t){if(e=Y5(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var i=r.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}if(t.getBoundingClientRect){var l=t.getBoundingClientRect();return[e.clientX-l.left-t.clientLeft,e.clientY-l.top-t.clientTop]}}return[e.pageX,e.pageY]}const G5={passive:!1},mc={capture:!0,passive:!1};function gp(e){e.stopImmediatePropagation()}function jl(e){e.preventDefault(),e.stopImmediatePropagation()}function XN(e){var t=e.document.documentElement,r=is(e).on("dragstart.drag",jl,mc);"onselectstart"in t?r.on("selectstart.drag",jl,mc):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function KN(e,t){var r=e.document.documentElement,i=is(e).on("dragstart.drag",null);t&&(i.on("click.drag",jl,mc),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in r?i.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}const Zu=e=>()=>e;function ty(e,{sourceEvent:t,subject:r,target:i,identifier:l,active:c,x:f,y:m,dx:h,dy:p,dispatch:y}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:l,enumerable:!0,configurable:!0},active:{value:c,enumerable:!0,configurable:!0},x:{value:f,enumerable:!0,configurable:!0},y:{value:m,enumerable:!0,configurable:!0},dx:{value:h,enumerable:!0,configurable:!0},dy:{value:p,enumerable:!0,configurable:!0},_:{value:y}})}ty.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function X5(e){return!e.ctrlKey&&!e.button}function K5(){return this.parentNode}function W5(e,t){return t??{x:e.x,y:e.y}}function Z5(){return navigator.maxTouchPoints||"ontouchstart"in this}function Q5(){var e=X5,t=K5,r=W5,i=Z5,l={},c=gf("start","drag","end"),f=0,m,h,p,y,g=0;function v(_){_.on("mousedown.drag",S).filter(i).on("touchstart.drag",E).on("touchmove.drag",C,G5).on("touchend.drag touchcancel.drag",A).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function S(_,R){if(!(y||!e.call(this,_,R))){var D=O(this,t.call(this,_,R),_,R,"mouse");D&&(is(_.view).on("mousemove.drag",w,mc).on("mouseup.drag",N,mc),XN(_.view),gp(_),p=!1,m=_.clientX,h=_.clientY,D("start",_))}}function w(_){if(jl(_),!p){var R=_.clientX-m,D=_.clientY-h;p=R*R+D*D>g}l.mouse("drag",_)}function N(_){is(_.view).on("mousemove.drag mouseup.drag",null),KN(_.view,p),jl(_),l.mouse("end",_)}function E(_,R){if(e.call(this,_,R)){var D=_.changedTouches,j=t.call(this,_,R),z=D.length,P,X;for(P=0;P<z;++P)(X=O(this,j,_,R,D[P].identifier,D[P]))&&(gp(_),X("start",_,D[P]))}}function C(_){var R=_.changedTouches,D=R.length,j,z;for(j=0;j<D;++j)(z=l[R[j].identifier])&&(jl(_),z("drag",_,R[j]))}function A(_){var R=_.changedTouches,D=R.length,j,z;for(y&&clearTimeout(y),y=setTimeout(function(){y=null},500),j=0;j<D;++j)(z=l[R[j].identifier])&&(gp(_),z("end",_,R[j]))}function O(_,R,D,j,z,P){var X=c.copy(),H=ps(P||D,R),G,V,k;if((k=r.call(_,new ty("beforestart",{sourceEvent:D,target:v,identifier:z,active:f,x:H[0],y:H[1],dx:0,dy:0,dispatch:X}),j))!=null)return G=k.x-H[0]||0,V=k.y-H[1]||0,function F(I,L,$){var T=H,U;switch(I){case"start":l[z]=F,U=f++;break;case"end":delete l[z],--f;case"drag":H=ps($||L,R),U=f;break}X.call(I,_,new ty(I,{sourceEvent:L,subject:k,target:v,identifier:z,active:U,x:H[0]+G,y:H[1]+V,dx:H[0]-T[0],dy:H[1]-T[1],dispatch:X}),j)}}return v.filter=function(_){return arguments.length?(e=typeof _=="function"?_:Zu(!!_),v):e},v.container=function(_){return arguments.length?(t=typeof _=="function"?_:Zu(_),v):t},v.subject=function(_){return arguments.length?(r=typeof _=="function"?_:Zu(_),v):r},v.touchable=function(_){return arguments.length?(i=typeof _=="function"?_:Zu(!!_),v):i},v.on=function(){var _=c.on.apply(c,arguments);return _===c?v:_},v.clickDistance=function(_){return arguments.length?(g=(_=+_)*_,v):Math.sqrt(g)},v}function sg(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function WN(e,t){var r=Object.create(e.prototype);for(var i in t)r[i]=t[i];return r}function Ac(){}var hc=.7,zd=1/hc,_l="\\s*([+-]?\\d+)\\s*",pc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ds="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",J5=/^#([0-9a-f]{3,8})$/,eO=new RegExp(`^rgb\\(${_l},${_l},${_l}\\)$`),tO=new RegExp(`^rgb\\(${Ds},${Ds},${Ds}\\)$`),nO=new RegExp(`^rgba\\(${_l},${_l},${_l},${pc}\\)$`),aO=new RegExp(`^rgba\\(${Ds},${Ds},${Ds},${pc}\\)$`),sO=new RegExp(`^hsl\\(${pc},${Ds},${Ds}\\)$`),rO=new RegExp(`^hsla\\(${pc},${Ds},${Ds},${pc}\\)$`),FS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};sg(Ac,yc,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:BS,formatHex:BS,formatHex8:iO,formatHsl:lO,formatRgb:US,toString:US});function BS(){return this.rgb().formatHex()}function iO(){return this.rgb().formatHex8()}function lO(){return ZN(this).formatHsl()}function US(){return this.rgb().formatRgb()}function yc(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=J5.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?qS(t):r===3?new ka(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?Qu(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?Qu(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=eO.exec(e))?new ka(t[1],t[2],t[3],1):(t=tO.exec(e))?new ka(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=nO.exec(e))?Qu(t[1],t[2],t[3],t[4]):(t=aO.exec(e))?Qu(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=sO.exec(e))?VS(t[1],t[2]/100,t[3]/100,1):(t=rO.exec(e))?VS(t[1],t[2]/100,t[3]/100,t[4]):FS.hasOwnProperty(e)?qS(FS[e]):e==="transparent"?new ka(NaN,NaN,NaN,0):null}function qS(e){return new ka(e>>16&255,e>>8&255,e&255,1)}function Qu(e,t,r,i){return i<=0&&(e=t=r=NaN),new ka(e,t,r,i)}function oO(e){return e instanceof Ac||(e=yc(e)),e?(e=e.rgb(),new ka(e.r,e.g,e.b,e.opacity)):new ka}function ny(e,t,r,i){return arguments.length===1?oO(e):new ka(e,t,r,i??1)}function ka(e,t,r,i){this.r=+e,this.g=+t,this.b=+r,this.opacity=+i}sg(ka,ny,WN(Ac,{brighter(e){return e=e==null?zd:Math.pow(zd,e),new ka(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?hc:Math.pow(hc,e),new ka(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ka(Ci(this.r),Ci(this.g),Ci(this.b),$d(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:HS,formatHex:HS,formatHex8:cO,formatRgb:PS,toString:PS}));function HS(){return`#${ji(this.r)}${ji(this.g)}${ji(this.b)}`}function cO(){return`#${ji(this.r)}${ji(this.g)}${ji(this.b)}${ji((isNaN(this.opacity)?1:this.opacity)*255)}`}function PS(){const e=$d(this.opacity);return`${e===1?"rgb(":"rgba("}${Ci(this.r)}, ${Ci(this.g)}, ${Ci(this.b)}${e===1?")":`, ${e})`}`}function $d(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ci(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ji(e){return e=Ci(e),(e<16?"0":"")+e.toString(16)}function VS(e,t,r,i){return i<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new ys(e,t,r,i)}function ZN(e){if(e instanceof ys)return new ys(e.h,e.s,e.l,e.opacity);if(e instanceof Ac||(e=yc(e)),!e)return new ys;if(e instanceof ys)return e;e=e.rgb();var t=e.r/255,r=e.g/255,i=e.b/255,l=Math.min(t,r,i),c=Math.max(t,r,i),f=NaN,m=c-l,h=(c+l)/2;return m?(t===c?f=(r-i)/m+(r<i)*6:r===c?f=(i-t)/m+2:f=(t-r)/m+4,m/=h<.5?c+l:2-c-l,f*=60):m=h>0&&h<1?0:f,new ys(f,m,h,e.opacity)}function uO(e,t,r,i){return arguments.length===1?ZN(e):new ys(e,t,r,i??1)}function ys(e,t,r,i){this.h=+e,this.s=+t,this.l=+r,this.opacity=+i}sg(ys,uO,WN(Ac,{brighter(e){return e=e==null?zd:Math.pow(zd,e),new ys(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?hc:Math.pow(hc,e),new ys(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*t,l=2*r-i;return new ka(bp(e>=240?e-240:e+120,l,i),bp(e,l,i),bp(e<120?e+240:e-120,l,i),this.opacity)},clamp(){return new ys(YS(this.h),Ju(this.s),Ju(this.l),$d(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=$d(this.opacity);return`${e===1?"hsl(":"hsla("}${YS(this.h)}, ${Ju(this.s)*100}%, ${Ju(this.l)*100}%${e===1?")":`, ${e})`}`}}));function YS(e){return e=(e||0)%360,e<0?e+360:e}function Ju(e){return Math.max(0,Math.min(1,e||0))}function bp(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const QN=e=>()=>e;function dO(e,t){return function(r){return e+r*t}}function fO(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(i){return Math.pow(e+i*t,r)}}function mO(e){return(e=+e)==1?JN:function(t,r){return r-t?fO(t,r,e):QN(isNaN(t)?r:t)}}function JN(e,t){var r=t-e;return r?dO(e,r):QN(isNaN(e)?t:e)}const GS=(function e(t){var r=mO(t);function i(l,c){var f=r((l=ny(l)).r,(c=ny(c)).r),m=r(l.g,c.g),h=r(l.b,c.b),p=JN(l.opacity,c.opacity);return function(y){return l.r=f(y),l.g=m(y),l.b=h(y),l.opacity=p(y),l+""}}return i.gamma=e,i})(1);function Fr(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}var ay=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,vp=new RegExp(ay.source,"g");function hO(e){return function(){return e}}function pO(e){return function(t){return e(t)+""}}function yO(e,t){var r=ay.lastIndex=vp.lastIndex=0,i,l,c,f=-1,m=[],h=[];for(e=e+"",t=t+"";(i=ay.exec(e))&&(l=vp.exec(t));)(c=l.index)>r&&(c=t.slice(r,c),m[f]?m[f]+=c:m[++f]=c),(i=i[0])===(l=l[0])?m[f]?m[f]+=l:m[++f]=l:(m[++f]=null,h.push({i:f,x:Fr(i,l)})),r=vp.lastIndex;return r<t.length&&(c=t.slice(r),m[f]?m[f]+=c:m[++f]=c),m.length<2?h[0]?pO(h[0].x):hO(t):(t=h.length,function(p){for(var y=0,g;y<t;++y)m[(g=h[y]).i]=g.x(p);return m.join("")})}var XS=180/Math.PI,sy={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function eE(e,t,r,i,l,c){var f,m,h;return(f=Math.sqrt(e*e+t*t))&&(e/=f,t/=f),(h=e*r+t*i)&&(r-=e*h,i-=t*h),(m=Math.sqrt(r*r+i*i))&&(r/=m,i/=m,h/=m),e*i<t*r&&(e=-e,t=-t,h=-h,f=-f),{translateX:l,translateY:c,rotate:Math.atan2(t,e)*XS,skewX:Math.atan(h)*XS,scaleX:f,scaleY:m}}var ed;function gO(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?sy:eE(t.a,t.b,t.c,t.d,t.e,t.f)}function bO(e){return e==null||(ed||(ed=document.createElementNS("http://www.w3.org/2000/svg","g")),ed.setAttribute("transform",e),!(e=ed.transform.baseVal.consolidate()))?sy:(e=e.matrix,eE(e.a,e.b,e.c,e.d,e.e,e.f))}function tE(e,t,r,i){function l(p){return p.length?p.pop()+" ":""}function c(p,y,g,v,S,w){if(p!==g||y!==v){var N=S.push("translate(",null,t,null,r);w.push({i:N-4,x:Fr(p,g)},{i:N-2,x:Fr(y,v)})}else(g||v)&&S.push("translate("+g+t+v+r)}function f(p,y,g,v){p!==y?(p-y>180?y+=360:y-p>180&&(p+=360),v.push({i:g.push(l(g)+"rotate(",null,i)-2,x:Fr(p,y)})):y&&g.push(l(g)+"rotate("+y+i)}function m(p,y,g,v){p!==y?v.push({i:g.push(l(g)+"skewX(",null,i)-2,x:Fr(p,y)}):y&&g.push(l(g)+"skewX("+y+i)}function h(p,y,g,v,S,w){if(p!==g||y!==v){var N=S.push(l(S)+"scale(",null,",",null,")");w.push({i:N-4,x:Fr(p,g)},{i:N-2,x:Fr(y,v)})}else(g!==1||v!==1)&&S.push(l(S)+"scale("+g+","+v+")")}return function(p,y){var g=[],v=[];return p=e(p),y=e(y),c(p.translateX,p.translateY,y.translateX,y.translateY,g,v),f(p.rotate,y.rotate,g,v),m(p.skewX,y.skewX,g,v),h(p.scaleX,p.scaleY,y.scaleX,y.scaleY,g,v),p=y=null,function(S){for(var w=-1,N=v.length,E;++w<N;)g[(E=v[w]).i]=E.x(S);return g.join("")}}}var vO=tE(gO,"px, ","px)","deg)"),xO=tE(bO,", ",")",")"),SO=1e-12;function KS(e){return((e=Math.exp(e))+1/e)/2}function wO(e){return((e=Math.exp(e))-1/e)/2}function NO(e){return((e=Math.exp(2*e))-1)/(e+1)}const EO=(function e(t,r,i){function l(c,f){var m=c[0],h=c[1],p=c[2],y=f[0],g=f[1],v=f[2],S=y-m,w=g-h,N=S*S+w*w,E,C;if(N<SO)C=Math.log(v/p)/t,E=function(j){return[m+j*S,h+j*w,p*Math.exp(t*j*C)]};else{var A=Math.sqrt(N),O=(v*v-p*p+i*N)/(2*p*r*A),_=(v*v-p*p-i*N)/(2*v*r*A),R=Math.log(Math.sqrt(O*O+1)-O),D=Math.log(Math.sqrt(_*_+1)-_);C=(D-R)/t,E=function(j){var z=j*C,P=KS(R),X=p/(r*A)*(P*NO(t*z+R)-wO(R));return[m+X*S,h+X*w,p*P/KS(t*z+R)]}}return E.duration=C*1e3*t/Math.SQRT2,E}return l.rho=function(c){var f=Math.max(.001,+c),m=f*f,h=m*m;return e(f,m,h)},l})(Math.SQRT2,2,4);var kl=0,Zo=0,$o=0,nE=1e3,Fd,Qo,Bd=0,Ti=0,vf=0,gc=typeof performance=="object"&&performance.now?performance:Date,aE=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function rg(){return Ti||(aE(jO),Ti=gc.now()+vf)}function jO(){Ti=0}function Ud(){this._call=this._time=this._next=null}Ud.prototype=sE.prototype={constructor:Ud,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?rg():+r)+(t==null?0:+t),!this._next&&Qo!==this&&(Qo?Qo._next=this:Fd=this,Qo=this),this._call=e,this._time=r,ry()},stop:function(){this._call&&(this._call=null,this._time=1/0,ry())}};function sE(e,t,r){var i=new Ud;return i.restart(e,t,r),i}function _O(){rg(),++kl;for(var e=Fd,t;e;)(t=Ti-e._time)>=0&&e._call.call(void 0,t),e=e._next;--kl}function WS(){Ti=(Bd=gc.now())+vf,kl=Zo=0;try{_O()}finally{kl=0,AO(),Ti=0}}function CO(){var e=gc.now(),t=e-Bd;t>nE&&(vf-=t,Bd=e)}function AO(){for(var e,t=Fd,r,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:Fd=r);Qo=e,ry(i)}function ry(e){if(!kl){Zo&&(Zo=clearTimeout(Zo));var t=e-Ti;t>24?(e<1/0&&(Zo=setTimeout(WS,e-gc.now()-vf)),$o&&($o=clearInterval($o))):($o||(Bd=gc.now(),$o=setInterval(CO,nE)),kl=1,aE(WS))}}function ZS(e,t,r){var i=new Ud;return t=t==null?0:+t,i.restart(l=>{i.stop(),e(l+t)},t,r),i}var TO=gf("start","end","cancel","interrupt"),MO=[],rE=0,QS=1,iy=2,Sd=3,JS=4,ly=5,wd=6;function xf(e,t,r,i,l,c){var f=e.__transition;if(!f)e.__transition={};else if(r in f)return;RO(e,r,{name:t,index:i,group:l,on:TO,tween:MO,time:c.time,delay:c.delay,duration:c.duration,ease:c.ease,timer:null,state:rE})}function ig(e,t){var r=ws(e,t);if(r.state>rE)throw new Error("too late; already scheduled");return r}function Os(e,t){var r=ws(e,t);if(r.state>Sd)throw new Error("too late; already running");return r}function ws(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function RO(e,t,r){var i=e.__transition,l;i[t]=r,r.timer=sE(c,0,r.time);function c(p){r.state=QS,r.timer.restart(f,r.delay,r.time),r.delay<=p&&f(p-r.delay)}function f(p){var y,g,v,S;if(r.state!==QS)return h();for(y in i)if(S=i[y],S.name===r.name){if(S.state===Sd)return ZS(f);S.state===JS?(S.state=wd,S.timer.stop(),S.on.call("interrupt",e,e.__data__,S.index,S.group),delete i[y]):+y<t&&(S.state=wd,S.timer.stop(),S.on.call("cancel",e,e.__data__,S.index,S.group),delete i[y])}if(ZS(function(){r.state===Sd&&(r.state=JS,r.timer.restart(m,r.delay,r.time),m(p))}),r.state=iy,r.on.call("start",e,e.__data__,r.index,r.group),r.state===iy){for(r.state=Sd,l=new Array(v=r.tween.length),y=0,g=-1;y<v;++y)(S=r.tween[y].value.call(e,e.__data__,r.index,r.group))&&(l[++g]=S);l.length=g+1}}function m(p){for(var y=p<r.duration?r.ease.call(null,p/r.duration):(r.timer.restart(h),r.state=ly,1),g=-1,v=l.length;++g<v;)l[g].call(e,y);r.state===ly&&(r.on.call("end",e,e.__data__,r.index,r.group),h())}function h(){r.state=wd,r.timer.stop(),delete i[t];for(var p in i)return;delete e.__transition}}function Nd(e,t){var r=e.__transition,i,l,c=!0,f;if(r){t=t==null?null:t+"";for(f in r){if((i=r[f]).name!==t){c=!1;continue}l=i.state>iy&&i.state<ly,i.state=wd,i.timer.stop(),i.on.call(l?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete r[f]}c&&delete e.__transition}}function kO(e){return this.each(function(){Nd(this,e)})}function DO(e,t){var r,i;return function(){var l=Os(this,e),c=l.tween;if(c!==r){i=r=c;for(var f=0,m=i.length;f<m;++f)if(i[f].name===t){i=i.slice(),i.splice(f,1);break}}l.tween=i}}function IO(e,t,r){var i,l;if(typeof r!="function")throw new Error;return function(){var c=Os(this,e),f=c.tween;if(f!==i){l=(i=f).slice();for(var m={name:t,value:r},h=0,p=l.length;h<p;++h)if(l[h].name===t){l[h]=m;break}h===p&&l.push(m)}c.tween=l}}function LO(e,t){var r=this._id;if(e+="",arguments.length<2){for(var i=ws(this.node(),r).tween,l=0,c=i.length,f;l<c;++l)if((f=i[l]).name===e)return f.value;return null}return this.each((t==null?DO:IO)(r,e,t))}function lg(e,t,r){var i=e._id;return e.each(function(){var l=Os(this,i);(l.value||(l.value={}))[t]=r.apply(this,arguments)}),function(l){return ws(l,i).value[t]}}function iE(e,t){var r;return(typeof t=="number"?Fr:t instanceof yc?GS:(r=yc(t))?(t=r,GS):yO)(e,t)}function OO(e){return function(){this.removeAttribute(e)}}function zO(e){return function(){this.removeAttributeNS(e.space,e.local)}}function $O(e,t,r){var i,l=r+"",c;return function(){var f=this.getAttribute(e);return f===l?null:f===i?c:c=t(i=f,r)}}function FO(e,t,r){var i,l=r+"",c;return function(){var f=this.getAttributeNS(e.space,e.local);return f===l?null:f===i?c:c=t(i=f,r)}}function BO(e,t,r){var i,l,c;return function(){var f,m=r(this),h;return m==null?void this.removeAttribute(e):(f=this.getAttribute(e),h=m+"",f===h?null:f===i&&h===l?c:(l=h,c=t(i=f,m)))}}function UO(e,t,r){var i,l,c;return function(){var f,m=r(this),h;return m==null?void this.removeAttributeNS(e.space,e.local):(f=this.getAttributeNS(e.space,e.local),h=m+"",f===h?null:f===i&&h===l?c:(l=h,c=t(i=f,m)))}}function qO(e,t){var r=bf(e),i=r==="transform"?xO:iE;return this.attrTween(e,typeof t=="function"?(r.local?UO:BO)(r,i,lg(this,"attr."+e,t)):t==null?(r.local?zO:OO)(r):(r.local?FO:$O)(r,i,t))}function HO(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function PO(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function VO(e,t){var r,i;function l(){var c=t.apply(this,arguments);return c!==i&&(r=(i=c)&&PO(e,c)),r}return l._value=t,l}function YO(e,t){var r,i;function l(){var c=t.apply(this,arguments);return c!==i&&(r=(i=c)&&HO(e,c)),r}return l._value=t,l}function GO(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var i=bf(e);return this.tween(r,(i.local?VO:YO)(i,t))}function XO(e,t){return function(){ig(this,e).delay=+t.apply(this,arguments)}}function KO(e,t){return t=+t,function(){ig(this,e).delay=t}}function WO(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?XO:KO)(t,e)):ws(this.node(),t).delay}function ZO(e,t){return function(){Os(this,e).duration=+t.apply(this,arguments)}}function QO(e,t){return t=+t,function(){Os(this,e).duration=t}}function JO(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?ZO:QO)(t,e)):ws(this.node(),t).duration}function e7(e,t){if(typeof t!="function")throw new Error;return function(){Os(this,e).ease=t}}function t7(e){var t=this._id;return arguments.length?this.each(e7(t,e)):ws(this.node(),t).ease}function n7(e,t){return function(){var r=t.apply(this,arguments);if(typeof r!="function")throw new Error;Os(this,e).ease=r}}function a7(e){if(typeof e!="function")throw new Error;return this.each(n7(this._id,e))}function s7(e){typeof e!="function"&&(e=$N(e));for(var t=this._groups,r=t.length,i=new Array(r),l=0;l<r;++l)for(var c=t[l],f=c.length,m=i[l]=[],h,p=0;p<f;++p)(h=c[p])&&e.call(h,h.__data__,p,c)&&m.push(h);return new cr(i,this._parents,this._name,this._id)}function r7(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,i=t.length,l=r.length,c=Math.min(i,l),f=new Array(i),m=0;m<c;++m)for(var h=t[m],p=r[m],y=h.length,g=f[m]=new Array(y),v,S=0;S<y;++S)(v=h[S]||p[S])&&(g[S]=v);for(;m<i;++m)f[m]=t[m];return new cr(f,this._parents,this._name,this._id)}function i7(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function l7(e,t,r){var i,l,c=i7(t)?ig:Os;return function(){var f=c(this,e),m=f.on;m!==i&&(l=(i=m).copy()).on(t,r),f.on=l}}function o7(e,t){var r=this._id;return arguments.length<2?ws(this.node(),r).on.on(e):this.each(l7(r,e,t))}function c7(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function u7(){return this.on("end.remove",c7(this._id))}function d7(e){var t=this._name,r=this._id;typeof e!="function"&&(e=ng(e));for(var i=this._groups,l=i.length,c=new Array(l),f=0;f<l;++f)for(var m=i[f],h=m.length,p=c[f]=new Array(h),y,g,v=0;v<h;++v)(y=m[v])&&(g=e.call(y,y.__data__,v,m))&&("__data__"in y&&(g.__data__=y.__data__),p[v]=g,xf(p[v],t,r,v,p,ws(y,r)));return new cr(c,this._parents,t,r)}function f7(e){var t=this._name,r=this._id;typeof e!="function"&&(e=zN(e));for(var i=this._groups,l=i.length,c=[],f=[],m=0;m<l;++m)for(var h=i[m],p=h.length,y,g=0;g<p;++g)if(y=h[g]){for(var v=e.call(y,y.__data__,g,h),S,w=ws(y,r),N=0,E=v.length;N<E;++N)(S=v[N])&&xf(S,t,r,N,v,w);c.push(v),f.push(y)}return new cr(c,f,t,r)}var m7=Cc.prototype.constructor;function h7(){return new m7(this._groups,this._parents)}function p7(e,t){var r,i,l;return function(){var c=Rl(this,e),f=(this.style.removeProperty(e),Rl(this,e));return c===f?null:c===r&&f===i?l:l=t(r=c,i=f)}}function lE(e){return function(){this.style.removeProperty(e)}}function y7(e,t,r){var i,l=r+"",c;return function(){var f=Rl(this,e);return f===l?null:f===i?c:c=t(i=f,r)}}function g7(e,t,r){var i,l,c;return function(){var f=Rl(this,e),m=r(this),h=m+"";return m==null&&(h=m=(this.style.removeProperty(e),Rl(this,e))),f===h?null:f===i&&h===l?c:(l=h,c=t(i=f,m))}}function b7(e,t){var r,i,l,c="style."+t,f="end."+c,m;return function(){var h=Os(this,e),p=h.on,y=h.value[c]==null?m||(m=lE(t)):void 0;(p!==r||l!==y)&&(i=(r=p).copy()).on(f,l=y),h.on=i}}function v7(e,t,r){var i=(e+="")=="transform"?vO:iE;return t==null?this.styleTween(e,p7(e,i)).on("end.style."+e,lE(e)):typeof t=="function"?this.styleTween(e,g7(e,i,lg(this,"style."+e,t))).each(b7(this._id,e)):this.styleTween(e,y7(e,i,t),r).on("end.style."+e,null)}function x7(e,t,r){return function(i){this.style.setProperty(e,t.call(this,i),r)}}function S7(e,t,r){var i,l;function c(){var f=t.apply(this,arguments);return f!==l&&(i=(l=f)&&x7(e,f,r)),i}return c._value=t,c}function w7(e,t,r){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,S7(e,t,r??""))}function N7(e){return function(){this.textContent=e}}function E7(e){return function(){var t=e(this);this.textContent=t??""}}function j7(e){return this.tween("text",typeof e=="function"?E7(lg(this,"text",e)):N7(e==null?"":e+""))}function _7(e){return function(t){this.textContent=e.call(this,t)}}function C7(e){var t,r;function i(){var l=e.apply(this,arguments);return l!==r&&(t=(r=l)&&_7(l)),t}return i._value=e,i}function A7(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,C7(e))}function T7(){for(var e=this._name,t=this._id,r=oE(),i=this._groups,l=i.length,c=0;c<l;++c)for(var f=i[c],m=f.length,h,p=0;p<m;++p)if(h=f[p]){var y=ws(h,t);xf(h,e,r,p,f,{time:y.time+y.delay+y.duration,delay:0,duration:y.duration,ease:y.ease})}return new cr(i,this._parents,e,r)}function M7(){var e,t,r=this,i=r._id,l=r.size();return new Promise(function(c,f){var m={value:f},h={value:function(){--l===0&&c()}};r.each(function(){var p=Os(this,i),y=p.on;y!==e&&(t=(e=y).copy(),t._.cancel.push(m),t._.interrupt.push(m),t._.end.push(h)),p.on=t}),l===0&&c()})}var R7=0;function cr(e,t,r,i){this._groups=e,this._parents=t,this._name=r,this._id=i}function oE(){return++R7}var er=Cc.prototype;cr.prototype={constructor:cr,select:d7,selectAll:f7,selectChild:er.selectChild,selectChildren:er.selectChildren,filter:s7,merge:r7,selection:h7,transition:T7,call:er.call,nodes:er.nodes,node:er.node,size:er.size,empty:er.empty,each:er.each,on:o7,attr:qO,attrTween:GO,style:v7,styleTween:w7,text:j7,textTween:A7,remove:u7,tween:LO,delay:WO,duration:JO,ease:t7,easeVarying:a7,end:M7,[Symbol.iterator]:er[Symbol.iterator]};function k7(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var D7={time:null,delay:0,duration:250,ease:k7};function I7(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}function L7(e){var t,r;e instanceof cr?(t=e._id,e=e._name):(t=oE(),(r=D7).time=rg(),e=e==null?null:e+"");for(var i=this._groups,l=i.length,c=0;c<l;++c)for(var f=i[c],m=f.length,h,p=0;p<m;++p)(h=f[p])&&xf(h,e,t,p,f,r||I7(h,t));return new cr(i,this._parents,e,t)}Cc.prototype.interrupt=kO;Cc.prototype.transition=L7;const td=e=>()=>e;function O7(e,{sourceEvent:t,target:r,transform:i,dispatch:l}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:l}})}function rr(e,t,r){this.k=e,this.x=t,this.y=r}rr.prototype={constructor:rr,scale:function(e){return e===1?this:new rr(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new rr(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var lr=new rr(1,0,0);rr.prototype;function xp(e){e.stopImmediatePropagation()}function Fo(e){e.preventDefault(),e.stopImmediatePropagation()}function z7(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function $7(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function ew(){return this.__zoom||lr}function F7(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function B7(){return navigator.maxTouchPoints||"ontouchstart"in this}function U7(e,t,r){var i=e.invertX(t[0][0])-r[0][0],l=e.invertX(t[1][0])-r[1][0],c=e.invertY(t[0][1])-r[0][1],f=e.invertY(t[1][1])-r[1][1];return e.translate(l>i?(i+l)/2:Math.min(0,i)||Math.max(0,l),f>c?(c+f)/2:Math.min(0,c)||Math.max(0,f))}function cE(){var e=z7,t=$7,r=U7,i=F7,l=B7,c=[0,1/0],f=[[-1/0,-1/0],[1/0,1/0]],m=250,h=EO,p=gf("start","zoom","end"),y,g,v,S=500,w=150,N=0,E=10;function C(k){k.property("__zoom",ew).on("wheel.zoom",z,{passive:!1}).on("mousedown.zoom",P).on("dblclick.zoom",X).filter(l).on("touchstart.zoom",H).on("touchmove.zoom",G).on("touchend.zoom touchcancel.zoom",V).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}C.transform=function(k,F,I,L){var $=k.selection?k.selection():k;$.property("__zoom",ew),k!==$?R(k,F,I,L):$.interrupt().each(function(){D(this,arguments).event(L).start().zoom(null,typeof F=="function"?F.apply(this,arguments):F).end()})},C.scaleBy=function(k,F,I,L){C.scaleTo(k,function(){var $=this.__zoom.k,T=typeof F=="function"?F.apply(this,arguments):F;return $*T},I,L)},C.scaleTo=function(k,F,I,L){C.transform(k,function(){var $=t.apply(this,arguments),T=this.__zoom,U=I==null?_($):typeof I=="function"?I.apply(this,arguments):I,M=T.invert(U),q=typeof F=="function"?F.apply(this,arguments):F;return r(O(A(T,q),U,M),$,f)},I,L)},C.translateBy=function(k,F,I,L){C.transform(k,function(){return r(this.__zoom.translate(typeof F=="function"?F.apply(this,arguments):F,typeof I=="function"?I.apply(this,arguments):I),t.apply(this,arguments),f)},null,L)},C.translateTo=function(k,F,I,L,$){C.transform(k,function(){var T=t.apply(this,arguments),U=this.__zoom,M=L==null?_(T):typeof L=="function"?L.apply(this,arguments):L;return r(lr.translate(M[0],M[1]).scale(U.k).translate(typeof F=="function"?-F.apply(this,arguments):-F,typeof I=="function"?-I.apply(this,arguments):-I),T,f)},L,$)};function A(k,F){return F=Math.max(c[0],Math.min(c[1],F)),F===k.k?k:new rr(F,k.x,k.y)}function O(k,F,I){var L=F[0]-I[0]*k.k,$=F[1]-I[1]*k.k;return L===k.x&&$===k.y?k:new rr(k.k,L,$)}function _(k){return[(+k[0][0]+ +k[1][0])/2,(+k[0][1]+ +k[1][1])/2]}function R(k,F,I,L){k.on("start.zoom",function(){D(this,arguments).event(L).start()}).on("interrupt.zoom end.zoom",function(){D(this,arguments).event(L).end()}).tween("zoom",function(){var $=this,T=arguments,U=D($,T).event(L),M=t.apply($,T),q=I==null?_(M):typeof I=="function"?I.apply($,T):I,Y=Math.max(M[1][0]-M[0][0],M[1][1]-M[0][1]),J=$.__zoom,ie=typeof F=="function"?F.apply($,T):F,Z=h(J.invert(q).concat(Y/J.k),ie.invert(q).concat(Y/ie.k));return function(fe){if(fe===1)fe=ie;else{var Q=Z(fe),se=Y/Q[2];fe=new rr(se,q[0]-Q[0]*se,q[1]-Q[1]*se)}U.zoom(null,fe)}})}function D(k,F,I){return!I&&k.__zooming||new j(k,F)}function j(k,F){this.that=k,this.args=F,this.active=0,this.sourceEvent=null,this.extent=t.apply(k,F),this.taps=0}j.prototype={event:function(k){return k&&(this.sourceEvent=k),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(k,F){return this.mouse&&k!=="mouse"&&(this.mouse[1]=F.invert(this.mouse[0])),this.touch0&&k!=="touch"&&(this.touch0[1]=F.invert(this.touch0[0])),this.touch1&&k!=="touch"&&(this.touch1[1]=F.invert(this.touch1[0])),this.that.__zoom=F,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(k){var F=is(this.that).datum();p.call(k,this.that,new O7(k,{sourceEvent:this.sourceEvent,target:C,transform:this.that.__zoom,dispatch:p}),F)}};function z(k,...F){if(!e.apply(this,arguments))return;var I=D(this,F).event(k),L=this.__zoom,$=Math.max(c[0],Math.min(c[1],L.k*Math.pow(2,i.apply(this,arguments)))),T=ps(k);if(I.wheel)(I.mouse[0][0]!==T[0]||I.mouse[0][1]!==T[1])&&(I.mouse[1]=L.invert(I.mouse[0]=T)),clearTimeout(I.wheel);else{if(L.k===$)return;I.mouse=[T,L.invert(T)],Nd(this),I.start()}Fo(k),I.wheel=setTimeout(U,w),I.zoom("mouse",r(O(A(L,$),I.mouse[0],I.mouse[1]),I.extent,f));function U(){I.wheel=null,I.end()}}function P(k,...F){if(v||!e.apply(this,arguments))return;var I=k.currentTarget,L=D(this,F,!0).event(k),$=is(k.view).on("mousemove.zoom",q,!0).on("mouseup.zoom",Y,!0),T=ps(k,I),U=k.clientX,M=k.clientY;XN(k.view),xp(k),L.mouse=[T,this.__zoom.invert(T)],Nd(this),L.start();function q(J){if(Fo(J),!L.moved){var ie=J.clientX-U,Z=J.clientY-M;L.moved=ie*ie+Z*Z>N}L.event(J).zoom("mouse",r(O(L.that.__zoom,L.mouse[0]=ps(J,I),L.mouse[1]),L.extent,f))}function Y(J){$.on("mousemove.zoom mouseup.zoom",null),KN(J.view,L.moved),Fo(J),L.event(J).end()}}function X(k,...F){if(e.apply(this,arguments)){var I=this.__zoom,L=ps(k.changedTouches?k.changedTouches[0]:k,this),$=I.invert(L),T=I.k*(k.shiftKey?.5:2),U=r(O(A(I,T),L,$),t.apply(this,F),f);Fo(k),m>0?is(this).transition().duration(m).call(R,U,L,k):is(this).call(C.transform,U,L,k)}}function H(k,...F){if(e.apply(this,arguments)){var I=k.touches,L=I.length,$=D(this,F,k.changedTouches.length===L).event(k),T,U,M,q;for(xp(k),U=0;U<L;++U)M=I[U],q=ps(M,this),q=[q,this.__zoom.invert(q),M.identifier],$.touch0?!$.touch1&&$.touch0[2]!==q[2]&&($.touch1=q,$.taps=0):($.touch0=q,T=!0,$.taps=1+!!y);y&&(y=clearTimeout(y)),T&&($.taps<2&&(g=q[0],y=setTimeout(function(){y=null},S)),Nd(this),$.start())}}function G(k,...F){if(this.__zooming){var I=D(this,F).event(k),L=k.changedTouches,$=L.length,T,U,M,q;for(Fo(k),T=0;T<$;++T)U=L[T],M=ps(U,this),I.touch0&&I.touch0[2]===U.identifier?I.touch0[0]=M:I.touch1&&I.touch1[2]===U.identifier&&(I.touch1[0]=M);if(U=I.that.__zoom,I.touch1){var Y=I.touch0[0],J=I.touch0[1],ie=I.touch1[0],Z=I.touch1[1],fe=(fe=ie[0]-Y[0])*fe+(fe=ie[1]-Y[1])*fe,Q=(Q=Z[0]-J[0])*Q+(Q=Z[1]-J[1])*Q;U=A(U,Math.sqrt(fe/Q)),M=[(Y[0]+ie[0])/2,(Y[1]+ie[1])/2],q=[(J[0]+Z[0])/2,(J[1]+Z[1])/2]}else if(I.touch0)M=I.touch0[0],q=I.touch0[1];else return;I.zoom("touch",r(O(U,M,q),I.extent,f))}}function V(k,...F){if(this.__zooming){var I=D(this,F).event(k),L=k.changedTouches,$=L.length,T,U;for(xp(k),v&&clearTimeout(v),v=setTimeout(function(){v=null},S),T=0;T<$;++T)U=L[T],I.touch0&&I.touch0[2]===U.identifier?delete I.touch0:I.touch1&&I.touch1[2]===U.identifier&&delete I.touch1;if(I.touch1&&!I.touch0&&(I.touch0=I.touch1,delete I.touch1),I.touch0)I.touch0[1]=this.__zoom.invert(I.touch0[0]);else if(I.end(),I.taps===2&&(U=ps(U,this),Math.hypot(g[0]-U[0],g[1]-U[1])<E)){var M=is(this).on("dblclick.zoom");M&&M.apply(this,arguments)}}}return C.wheelDelta=function(k){return arguments.length?(i=typeof k=="function"?k:td(+k),C):i},C.filter=function(k){return arguments.length?(e=typeof k=="function"?k:td(!!k),C):e},C.touchable=function(k){return arguments.length?(l=typeof k=="function"?k:td(!!k),C):l},C.extent=function(k){return arguments.length?(t=typeof k=="function"?k:td([[+k[0][0],+k[0][1]],[+k[1][0],+k[1][1]]]),C):t},C.scaleExtent=function(k){return arguments.length?(c[0]=+k[0],c[1]=+k[1],C):[c[0],c[1]]},C.translateExtent=function(k){return arguments.length?(f[0][0]=+k[0][0],f[1][0]=+k[1][0],f[0][1]=+k[0][1],f[1][1]=+k[1][1],C):[[f[0][0],f[0][1]],[f[1][0],f[1][1]]]},C.constrain=function(k){return arguments.length?(r=k,C):r},C.duration=function(k){return arguments.length?(m=+k,C):m},C.interpolate=function(k){return arguments.length?(h=k,C):h},C.on=function(){var k=p.on.apply(p,arguments);return k===p?C:k},C.clickDistance=function(k){return arguments.length?(N=(k=+k)*k,C):Math.sqrt(N)},C.tapDistance=function(k){return arguments.length?(E=+k,C):E},C}const Sf=u.createContext(null),q7=Sf.Provider,ur={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,t)=>`Couldn't create edge for ${e?"target":"source"} handle id: "${e?t.targetHandle:t.sourceHandle}", edge id: ${t.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},uE=ur.error001();function Ln(e,t){const r=u.useContext(Sf);if(r===null)throw new Error(uE);return LN(r,e,t)}const aa=()=>{const e=u.useContext(Sf);if(e===null)throw new Error(uE);return u.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy}),[e])},H7=e=>e.userSelectionActive?"none":"all";function og({position:e,children:t,className:r,style:i,...l}){const c=Ln(H7),f=`${e}`.split("-");return De.createElement("div",{className:pa(["react-flow__panel",r,...f]),style:{...i,pointerEvents:c},...l},t)}function P7({proOptions:e,position:t="bottom-right"}){return e?.hideAttribution?null:De.createElement(og,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},De.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}const V7=({x:e,y:t,label:r,labelStyle:i={},labelShowBg:l=!0,labelBgStyle:c={},labelBgPadding:f=[2,4],labelBgBorderRadius:m=2,children:h,className:p,...y})=>{const g=u.useRef(null),[v,S]=u.useState({x:0,y:0,width:0,height:0}),w=pa(["react-flow__edge-textwrapper",p]);return u.useEffect(()=>{if(g.current){const N=g.current.getBBox();S({x:N.x,y:N.y,width:N.width,height:N.height})}},[r]),typeof r>"u"||!r?null:De.createElement("g",{transform:`translate(${e-v.width/2} ${t-v.height/2})`,className:w,visibility:v.width?"visible":"hidden",...y},l&&De.createElement("rect",{width:v.width+2*f[0],x:-f[0],y:-f[1],height:v.height+2*f[1],className:"react-flow__edge-textbg",style:c,rx:m,ry:m}),De.createElement("text",{className:"react-flow__edge-text",y:v.height/2,dy:"0.3em",ref:g,style:i},r),h)};var Y7=u.memo(V7);const cg=e=>({width:e.offsetWidth,height:e.offsetHeight}),Dl=(e,t=0,r=1)=>Math.min(Math.max(e,t),r),ug=(e={x:0,y:0},t)=>({x:Dl(e.x,t[0][0],t[1][0]),y:Dl(e.y,t[0][1],t[1][1])}),tw=(e,t,r)=>e<t?Dl(Math.abs(e-t),1,50)/50:e>r?-Dl(Math.abs(e-r),1,50)/50:0,dE=(e,t)=>{const r=tw(e.x,35,t.width-35)*20,i=tw(e.y,35,t.height-35)*20;return[r,i]},fE=e=>e.getRootNode?.()||window?.document,mE=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),bc=({x:e,y:t,width:r,height:i})=>({x:e,y:t,x2:e+r,y2:t+i}),hE=({x:e,y:t,x2:r,y2:i})=>({x:e,y:t,width:r-e,height:i-t}),nw=e=>({...e.positionAbsolute||{x:0,y:0},width:e.width||0,height:e.height||0}),G7=(e,t)=>hE(mE(bc(e),bc(t))),oy=(e,t)=>{const r=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),i=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(r*i)},X7=e=>ls(e.width)&&ls(e.height)&&ls(e.x)&&ls(e.y),ls=e=>!isNaN(e)&&isFinite(e),Yn=Symbol.for("internals"),pE=["Enter"," ","Escape"],K7=(e,t)=>{},W7=e=>"nativeEvent"in e;function cy(e){const r=(W7(e)?e.nativeEvent:e).composedPath?.()?.[0]||e.target;return["INPUT","SELECT","TEXTAREA"].includes(r?.nodeName)||r?.hasAttribute("contenteditable")||!!r?.closest(".nokey")}const yE=e=>"clientX"in e,Yr=(e,t)=>{const r=yE(e),i=r?e.clientX:e.touches?.[0].clientX,l=r?e.clientY:e.touches?.[0].clientY;return{x:i-(t?.left??0),y:l-(t?.top??0)}},qd=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0,Bl=({id:e,path:t,labelX:r,labelY:i,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:g,markerStart:v,interactionWidth:S=20})=>De.createElement(De.Fragment,null,De.createElement("path",{id:e,style:y,d:t,fill:"none",className:"react-flow__edge-path",markerEnd:g,markerStart:v}),S&&De.createElement("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:S,className:"react-flow__edge-interaction"}),l&&ls(r)&&ls(i)?De.createElement(Y7,{x:r,y:i,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p}):null);Bl.displayName="BaseEdge";function Bo(e,t,r){return r===void 0?r:i=>{const l=t().edges.find(c=>c.id===e);l&&r(i,{...l})}}function gE({sourceX:e,sourceY:t,targetX:r,targetY:i}){const l=Math.abs(r-e)/2,c=r<e?r+l:r-l,f=Math.abs(i-t)/2,m=i<t?i+f:i-f;return[c,m,l,f]}function bE({sourceX:e,sourceY:t,targetX:r,targetY:i,sourceControlX:l,sourceControlY:c,targetControlX:f,targetControlY:m}){const h=e*.125+l*.375+f*.375+r*.125,p=t*.125+c*.375+m*.375+i*.125,y=Math.abs(h-e),g=Math.abs(p-t);return[h,p,y,g]}var Mi;(function(e){e.Strict="strict",e.Loose="loose"})(Mi||(Mi={}));var _i;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(_i||(_i={}));var vc;(function(e){e.Partial="partial",e.Full="full"})(vc||(vc={}));var Pr;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Pr||(Pr={}));var Hd;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Hd||(Hd={}));var Ut;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(Ut||(Ut={}));function aw({pos:e,x1:t,y1:r,x2:i,y2:l}){return e===Ut.Left||e===Ut.Right?[.5*(t+i),r]:[t,.5*(r+l)]}function vE({sourceX:e,sourceY:t,sourcePosition:r=Ut.Bottom,targetX:i,targetY:l,targetPosition:c=Ut.Top}){const[f,m]=aw({pos:r,x1:e,y1:t,x2:i,y2:l}),[h,p]=aw({pos:c,x1:i,y1:l,x2:e,y2:t}),[y,g,v,S]=bE({sourceX:e,sourceY:t,targetX:i,targetY:l,sourceControlX:f,sourceControlY:m,targetControlX:h,targetControlY:p});return[`M${e},${t} C${f},${m} ${h},${p} ${i},${l}`,y,g,v,S]}const dg=u.memo(({sourceX:e,sourceY:t,targetX:r,targetY:i,sourcePosition:l=Ut.Bottom,targetPosition:c=Ut.Top,label:f,labelStyle:m,labelShowBg:h,labelBgStyle:p,labelBgPadding:y,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:w,interactionWidth:N})=>{const[E,C,A]=vE({sourceX:e,sourceY:t,sourcePosition:l,targetX:r,targetY:i,targetPosition:c});return De.createElement(Bl,{path:E,labelX:C,labelY:A,label:f,labelStyle:m,labelShowBg:h,labelBgStyle:p,labelBgPadding:y,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:w,interactionWidth:N})});dg.displayName="SimpleBezierEdge";const sw={[Ut.Left]:{x:-1,y:0},[Ut.Right]:{x:1,y:0},[Ut.Top]:{x:0,y:-1},[Ut.Bottom]:{x:0,y:1}},Z7=({source:e,sourcePosition:t=Ut.Bottom,target:r})=>t===Ut.Left||t===Ut.Right?e.x<r.x?{x:1,y:0}:{x:-1,y:0}:e.y<r.y?{x:0,y:1}:{x:0,y:-1},rw=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Q7({source:e,sourcePosition:t=Ut.Bottom,target:r,targetPosition:i=Ut.Top,center:l,offset:c}){const f=sw[t],m=sw[i],h={x:e.x+f.x*c,y:e.y+f.y*c},p={x:r.x+m.x*c,y:r.y+m.y*c},y=Z7({source:h,sourcePosition:t,target:p}),g=y.x!==0?"x":"y",v=y[g];let S=[],w,N;const E={x:0,y:0},C={x:0,y:0},[A,O,_,R]=gE({sourceX:e.x,sourceY:e.y,targetX:r.x,targetY:r.y});if(f[g]*m[g]===-1){w=l.x??A,N=l.y??O;const j=[{x:w,y:h.y},{x:w,y:p.y}],z=[{x:h.x,y:N},{x:p.x,y:N}];f[g]===v?S=g==="x"?j:z:S=g==="x"?z:j}else{const j=[{x:h.x,y:p.y}],z=[{x:p.x,y:h.y}];if(g==="x"?S=f.x===v?z:j:S=f.y===v?j:z,t===i){const V=Math.abs(e[g]-r[g]);if(V<=c){const k=Math.min(c-1,c-V);f[g]===v?E[g]=(h[g]>e[g]?-1:1)*k:C[g]=(p[g]>r[g]?-1:1)*k}}if(t!==i){const V=g==="x"?"y":"x",k=f[g]===m[V],F=h[V]>p[V],I=h[V]<p[V];(f[g]===1&&(!k&&F||k&&I)||f[g]!==1&&(!k&&I||k&&F))&&(S=g==="x"?j:z)}const P={x:h.x+E.x,y:h.y+E.y},X={x:p.x+C.x,y:p.y+C.y},H=Math.max(Math.abs(P.x-S[0].x),Math.abs(X.x-S[0].x)),G=Math.max(Math.abs(P.y-S[0].y),Math.abs(X.y-S[0].y));H>=G?(w=(P.x+X.x)/2,N=S[0].y):(w=S[0].x,N=(P.y+X.y)/2)}return[[e,{x:h.x+E.x,y:h.y+E.y},...S,{x:p.x+C.x,y:p.y+C.y},r],w,N,_,R]}function J7(e,t,r,i){const l=Math.min(rw(e,t)/2,rw(t,r)/2,i),{x:c,y:f}=t;if(e.x===c&&c===r.x||e.y===f&&f===r.y)return`L${c} ${f}`;if(e.y===f){const p=e.x<r.x?-1:1,y=e.y<r.y?1:-1;return`L ${c+l*p},${f}Q ${c},${f} ${c},${f+l*y}`}const m=e.x<r.x?1:-1,h=e.y<r.y?-1:1;return`L ${c},${f+l*h}Q ${c},${f} ${c+l*m},${f}`}function Pd({sourceX:e,sourceY:t,sourcePosition:r=Ut.Bottom,targetX:i,targetY:l,targetPosition:c=Ut.Top,borderRadius:f=5,centerX:m,centerY:h,offset:p=20}){const[y,g,v,S,w]=Q7({source:{x:e,y:t},sourcePosition:r,target:{x:i,y:l},targetPosition:c,center:{x:m,y:h},offset:p});return[y.reduce((E,C,A)=>{let O="";return A>0&&A<y.length-1?O=J7(y[A-1],C,y[A+1],f):O=`${A===0?"M":"L"}${C.x} ${C.y}`,E+=O,E},""),g,v,S,w]}const wf=u.memo(({sourceX:e,sourceY:t,targetX:r,targetY:i,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,sourcePosition:g=Ut.Bottom,targetPosition:v=Ut.Top,markerEnd:S,markerStart:w,pathOptions:N,interactionWidth:E})=>{const[C,A,O]=Pd({sourceX:e,sourceY:t,sourcePosition:g,targetX:r,targetY:i,targetPosition:v,borderRadius:N?.borderRadius,offset:N?.offset});return De.createElement(Bl,{path:C,labelX:A,labelY:O,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:S,markerStart:w,interactionWidth:E})});wf.displayName="SmoothStepEdge";const fg=u.memo(e=>De.createElement(wf,{...e,pathOptions:u.useMemo(()=>({borderRadius:0,offset:e.pathOptions?.offset}),[e.pathOptions?.offset])}));fg.displayName="StepEdge";function e6({sourceX:e,sourceY:t,targetX:r,targetY:i}){const[l,c,f,m]=gE({sourceX:e,sourceY:t,targetX:r,targetY:i});return[`M ${e},${t}L ${r},${i}`,l,c,f,m]}const mg=u.memo(({sourceX:e,sourceY:t,targetX:r,targetY:i,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:g,markerStart:v,interactionWidth:S})=>{const[w,N,E]=e6({sourceX:e,sourceY:t,targetX:r,targetY:i});return De.createElement(Bl,{path:w,labelX:N,labelY:E,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:g,markerStart:v,interactionWidth:S})});mg.displayName="StraightEdge";function nd(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function iw({pos:e,x1:t,y1:r,x2:i,y2:l,c}){switch(e){case Ut.Left:return[t-nd(t-i,c),r];case Ut.Right:return[t+nd(i-t,c),r];case Ut.Top:return[t,r-nd(r-l,c)];case Ut.Bottom:return[t,r+nd(l-r,c)]}}function xE({sourceX:e,sourceY:t,sourcePosition:r=Ut.Bottom,targetX:i,targetY:l,targetPosition:c=Ut.Top,curvature:f=.25}){const[m,h]=iw({pos:r,x1:e,y1:t,x2:i,y2:l,c:f}),[p,y]=iw({pos:c,x1:i,y1:l,x2:e,y2:t,c:f}),[g,v,S,w]=bE({sourceX:e,sourceY:t,targetX:i,targetY:l,sourceControlX:m,sourceControlY:h,targetControlX:p,targetControlY:y});return[`M${e},${t} C${m},${h} ${p},${y} ${i},${l}`,g,v,S,w]}const Vd=u.memo(({sourceX:e,sourceY:t,targetX:r,targetY:i,sourcePosition:l=Ut.Bottom,targetPosition:c=Ut.Top,label:f,labelStyle:m,labelShowBg:h,labelBgStyle:p,labelBgPadding:y,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:w,pathOptions:N,interactionWidth:E})=>{const[C,A,O]=xE({sourceX:e,sourceY:t,sourcePosition:l,targetX:r,targetY:i,targetPosition:c,curvature:N?.curvature});return De.createElement(Bl,{path:C,labelX:A,labelY:O,label:f,labelStyle:m,labelShowBg:h,labelBgStyle:p,labelBgPadding:y,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:w,interactionWidth:E})});Vd.displayName="BezierEdge";const hg=u.createContext(null),t6=hg.Provider;hg.Consumer;const n6=()=>u.useContext(hg),a6=e=>"id"in e&&"source"in e&&"target"in e,s6=({source:e,sourceHandle:t,target:r,targetHandle:i})=>`reactflow__edge-${e}${t||""}-${r}${i||""}`,uy=(e,t)=>typeof e>"u"?"":typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(i=>`${i}=${e[i]}`).join("&")}`,r6=(e,t)=>t.some(r=>r.source===e.source&&r.target===e.target&&(r.sourceHandle===e.sourceHandle||!r.sourceHandle&&!e.sourceHandle)&&(r.targetHandle===e.targetHandle||!r.targetHandle&&!e.targetHandle)),i6=(e,t)=>{if(!e.source||!e.target)return t;let r;return a6(e)?r={...e}:r={...e,id:s6(e)},r6(r,t)?t:t.concat(r)},dy=({x:e,y:t},[r,i,l],c,[f,m])=>{const h={x:(e-r)/l,y:(t-i)/l};return c?{x:f*Math.round(h.x/f),y:m*Math.round(h.y/m)}:h},SE=({x:e,y:t},[r,i,l])=>({x:e*l+r,y:t*l+i}),Ai=(e,t=[0,0])=>{if(!e)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const r=(e.width??0)*t[0],i=(e.height??0)*t[1],l={x:e.position.x-r,y:e.position.y-i};return{...l,positionAbsolute:e.positionAbsolute?{x:e.positionAbsolute.x-r,y:e.positionAbsolute.y-i}:l}},Nf=(e,t=[0,0])=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const r=e.reduce((i,l)=>{const{x:c,y:f}=Ai(l,t).positionAbsolute;return mE(i,bc({x:c,y:f,width:l.width||0,height:l.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return hE(r)},wE=(e,t,[r,i,l]=[0,0,1],c=!1,f=!1,m=[0,0])=>{const h={x:(t.x-r)/l,y:(t.y-i)/l,width:t.width/l,height:t.height/l},p=[];return e.forEach(y=>{const{width:g,height:v,selectable:S=!0,hidden:w=!1}=y;if(f&&!S||w)return!1;const{positionAbsolute:N}=Ai(y,m),E={x:N.x,y:N.y,width:g||0,height:v||0},C=oy(h,E),A=typeof g>"u"||typeof v>"u"||g===null||v===null,O=c&&C>0,_=(g||0)*(v||0);(A||O||C>=_||y.dragging)&&p.push(y)}),p},NE=(e,t)=>{const r=e.map(i=>i.id);return t.filter(i=>r.includes(i.source)||r.includes(i.target))},EE=(e,t,r,i,l,c=.1)=>{const f=t/(e.width*(1+c)),m=r/(e.height*(1+c)),h=Math.min(f,m),p=Dl(h,i,l),y=e.x+e.width/2,g=e.y+e.height/2,v=t/2-y*p,S=r/2-g*p;return{x:v,y:S,zoom:p}},xi=(e,t=0)=>e.transition().duration(t);function lw(e,t,r,i){return(t[r]||[]).reduce((l,c)=>(`${e.id}-${c.id}-${r}`!==i&&l.push({id:c.id||null,type:r,nodeId:e.id,x:(e.positionAbsolute?.x??0)+c.x+c.width/2,y:(e.positionAbsolute?.y??0)+c.y+c.height/2}),l),[])}function l6(e,t,r,i,l,c){const{x:f,y:m}=Yr(e),p=t.elementsFromPoint(f,m).find(w=>w.classList.contains("react-flow__handle"));if(p){const w=p.getAttribute("data-nodeid");if(w){const N=pg(void 0,p),E=p.getAttribute("data-handleid"),C=c({nodeId:w,id:E,type:N});if(C){const A=l.find(O=>O.nodeId===w&&O.type===N&&O.id===E);return{handle:{id:E,type:N,nodeId:w,x:A?.x||r.x,y:A?.y||r.y},validHandleResult:C}}}}let y=[],g=1/0;if(l.forEach(w=>{const N=Math.sqrt((w.x-r.x)**2+(w.y-r.y)**2);if(N<=i){const E=c(w);N<=g&&(N<g?y=[{handle:w,validHandleResult:E}]:N===g&&y.push({handle:w,validHandleResult:E}),g=N)}}),!y.length)return{handle:null,validHandleResult:jE()};if(y.length===1)return y[0];const v=y.some(({validHandleResult:w})=>w.isValid),S=y.some(({handle:w})=>w.type==="target");return y.find(({handle:w,validHandleResult:N})=>S?w.type==="target":v?N.isValid:!0)||y[0]}const o6={source:null,target:null,sourceHandle:null,targetHandle:null},jE=()=>({handleDomNode:null,isValid:!1,connection:o6,endHandle:null});function _E(e,t,r,i,l,c,f){const m=l==="target",h=f.querySelector(`.react-flow__handle[data-id="${e?.nodeId}-${e?.id}-${e?.type}"]`),p={...jE(),handleDomNode:h};if(h){const y=pg(void 0,h),g=h.getAttribute("data-nodeid"),v=h.getAttribute("data-handleid"),S=h.classList.contains("connectable"),w=h.classList.contains("connectableend"),N={source:m?g:r,sourceHandle:m?v:i,target:m?r:g,targetHandle:m?i:v};p.connection=N,S&&w&&(t===Mi.Strict?m&&y==="source"||!m&&y==="target":g!==r||v!==i)&&(p.endHandle={nodeId:g,handleId:v,type:y},p.isValid=c(N))}return p}function c6({nodes:e,nodeId:t,handleId:r,handleType:i}){return e.reduce((l,c)=>{if(c[Yn]){const{handleBounds:f}=c[Yn];let m=[],h=[];f&&(m=lw(c,f,"source",`${t}-${r}-${i}`),h=lw(c,f,"target",`${t}-${r}-${i}`)),l.push(...m,...h)}return l},[])}function pg(e,t){return e||(t?.classList.contains("target")?"target":t?.classList.contains("source")?"source":null)}function Sp(e){e?.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function u6(e,t){let r=null;return t?r="valid":e&&!t&&(r="invalid"),r}function CE({event:e,handleId:t,nodeId:r,onConnect:i,isTarget:l,getState:c,setState:f,isValidConnection:m,edgeUpdaterType:h,onReconnectEnd:p}){const y=fE(e.target),{connectionMode:g,domNode:v,autoPanOnConnect:S,connectionRadius:w,onConnectStart:N,panBy:E,getNodes:C,cancelConnection:A}=c();let O=0,_;const{x:R,y:D}=Yr(e),j=y?.elementFromPoint(R,D),z=pg(h,j),P=v?.getBoundingClientRect();if(!P||!z)return;let X,H=Yr(e,P),G=!1,V=null,k=!1,F=null;const I=c6({nodes:C(),nodeId:r,handleId:t,handleType:z}),L=()=>{if(!S)return;const[U,M]=dE(H,P);E({x:U,y:M}),O=requestAnimationFrame(L)};f({connectionPosition:H,connectionStatus:null,connectionNodeId:r,connectionHandleId:t,connectionHandleType:z,connectionStartHandle:{nodeId:r,handleId:t,type:z},connectionEndHandle:null}),N?.(e,{nodeId:r,handleId:t,handleType:z});function $(U){const{transform:M}=c();H=Yr(U,P);const{handle:q,validHandleResult:Y}=l6(U,y,dy(H,M,!1,[1,1]),w,I,J=>_E(J,g,r,t,l?"target":"source",m,y));if(_=q,G||(L(),G=!0),F=Y.handleDomNode,V=Y.connection,k=Y.isValid,f({connectionPosition:_&&k?SE({x:_.x,y:_.y},M):H,connectionStatus:u6(!!_,k),connectionEndHandle:Y.endHandle}),!_&&!k&&!F)return Sp(X);V.source!==V.target&&F&&(Sp(X),X=F,F.classList.add("connecting","react-flow__handle-connecting"),F.classList.toggle("valid",k),F.classList.toggle("react-flow__handle-valid",k))}function T(U){(_||F)&&V&&k&&i?.(V),c().onConnectEnd?.(U),h&&p?.(U),Sp(X),A(),cancelAnimationFrame(O),G=!1,k=!1,V=null,F=null,y.removeEventListener("mousemove",$),y.removeEventListener("mouseup",T),y.removeEventListener("touchmove",$),y.removeEventListener("touchend",T)}y.addEventListener("mousemove",$),y.addEventListener("mouseup",T),y.addEventListener("touchmove",$),y.addEventListener("touchend",T)}const ow=()=>!0,d6=e=>({connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName}),f6=(e,t,r)=>i=>{const{connectionStartHandle:l,connectionEndHandle:c,connectionClickStartHandle:f}=i;return{connecting:l?.nodeId===e&&l?.handleId===t&&l?.type===r||c?.nodeId===e&&c?.handleId===t&&c?.type===r,clickConnecting:f?.nodeId===e&&f?.handleId===t&&f?.type===r}},AE=u.forwardRef(({type:e="source",position:t=Ut.Top,isValidConnection:r,isConnectable:i=!0,isConnectableStart:l=!0,isConnectableEnd:c=!0,id:f,onConnect:m,children:h,className:p,onMouseDown:y,onTouchStart:g,...v},S)=>{const w=f||null,N=e==="target",E=aa(),C=n6(),{connectOnClick:A,noPanClassName:O}=Ln(d6,ia),{connecting:_,clickConnecting:R}=Ln(f6(C,w,e),ia);C||E.getState().onError?.("010",ur.error010());const D=P=>{const{defaultEdgeOptions:X,onConnect:H,hasDefaultEdges:G}=E.getState(),V={...X,...P};if(G){const{edges:k,setEdges:F}=E.getState();F(i6(V,k))}H?.(V),m?.(V)},j=P=>{if(!C)return;const X=yE(P);l&&(X&&P.button===0||!X)&&CE({event:P,handleId:w,nodeId:C,onConnect:D,isTarget:N,getState:E.getState,setState:E.setState,isValidConnection:r||E.getState().isValidConnection||ow}),X?y?.(P):g?.(P)},z=P=>{const{onClickConnectStart:X,onClickConnectEnd:H,connectionClickStartHandle:G,connectionMode:V,isValidConnection:k}=E.getState();if(!C||!G&&!l)return;if(!G){X?.(P,{nodeId:C,handleId:w,handleType:e}),E.setState({connectionClickStartHandle:{nodeId:C,type:e,handleId:w}});return}const F=fE(P.target),I=r||k||ow,{connection:L,isValid:$}=_E({nodeId:C,id:w,type:e},V,G.nodeId,G.handleId||null,G.type,I,F);$&&D(L),H?.(P),E.setState({connectionClickStartHandle:null})};return De.createElement("div",{"data-handleid":w,"data-nodeid":C,"data-handlepos":t,"data-id":`${C}-${w}-${e}`,className:pa(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",O,p,{source:!N,target:N,connectable:i,connectablestart:l,connectableend:c,connecting:R,connectionindicator:i&&(l&&!_||c&&_)}]),onMouseDown:j,onTouchStart:j,onClick:A?z:void 0,ref:S,...v},h)});AE.displayName="Handle";var Wr=u.memo(AE);const TE=({data:e,isConnectable:t,targetPosition:r=Ut.Top,sourcePosition:i=Ut.Bottom})=>De.createElement(De.Fragment,null,De.createElement(Wr,{type:"target",position:r,isConnectable:t}),e?.label,De.createElement(Wr,{type:"source",position:i,isConnectable:t}));TE.displayName="DefaultNode";var fy=u.memo(TE);const ME=({data:e,isConnectable:t,sourcePosition:r=Ut.Bottom})=>De.createElement(De.Fragment,null,e?.label,De.createElement(Wr,{type:"source",position:r,isConnectable:t}));ME.displayName="InputNode";var RE=u.memo(ME);const kE=({data:e,isConnectable:t,targetPosition:r=Ut.Top})=>De.createElement(De.Fragment,null,De.createElement(Wr,{type:"target",position:r,isConnectable:t}),e?.label);kE.displayName="OutputNode";var DE=u.memo(kE);const yg=()=>null;yg.displayName="GroupNode";const m6=e=>({selectedNodes:e.getNodes().filter(t=>t.selected),selectedEdges:e.edges.filter(t=>t.selected).map(t=>({...t}))}),ad=e=>e.id;function h6(e,t){return ia(e.selectedNodes.map(ad),t.selectedNodes.map(ad))&&ia(e.selectedEdges.map(ad),t.selectedEdges.map(ad))}const IE=u.memo(({onSelectionChange:e})=>{const t=aa(),{selectedNodes:r,selectedEdges:i}=Ln(m6,h6);return u.useEffect(()=>{const l={nodes:r,edges:i};e?.(l),t.getState().onSelectionChange.forEach(c=>c(l))},[r,i,e]),null});IE.displayName="SelectionListener";const p6=e=>!!e.onSelectionChange;function y6({onSelectionChange:e}){const t=Ln(p6);return e||t?De.createElement(IE,{onSelectionChange:e}):null}const g6=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset});function gl(e,t){u.useEffect(()=>{typeof e<"u"&&t(e)},[e])}function cn(e,t,r){u.useEffect(()=>{typeof t<"u"&&r({[e]:t})},[t])}const b6=({nodes:e,edges:t,defaultNodes:r,defaultEdges:i,onConnect:l,onConnectStart:c,onConnectEnd:f,onClickConnectStart:m,onClickConnectEnd:h,nodesDraggable:p,nodesConnectable:y,nodesFocusable:g,edgesFocusable:v,edgesUpdatable:S,elevateNodesOnSelect:w,minZoom:N,maxZoom:E,nodeExtent:C,onNodesChange:A,onEdgesChange:O,elementsSelectable:_,connectionMode:R,snapGrid:D,snapToGrid:j,translateExtent:z,connectOnClick:P,defaultEdgeOptions:X,fitView:H,fitViewOptions:G,onNodesDelete:V,onEdgesDelete:k,onNodeDrag:F,onNodeDragStart:I,onNodeDragStop:L,onSelectionDrag:$,onSelectionDragStart:T,onSelectionDragStop:U,noPanClassName:M,nodeOrigin:q,rfId:Y,autoPanOnConnect:J,autoPanOnNodeDrag:ie,onError:Z,connectionRadius:fe,isValidConnection:Q,nodeDragThreshold:se})=>{const{setNodes:ne,setEdges:we,setDefaultNodesAndEdges:Ie,setMinZoom:Me,setMaxZoom:Ae,setTranslateExtent:it,setNodeExtent:$e,reset:nt}=Ln(g6,ia),Le=aa();return u.useEffect(()=>{const wt=i?.map(Tt=>({...Tt,...X}));return Ie(r,wt),()=>{nt()}},[]),cn("defaultEdgeOptions",X,Le.setState),cn("connectionMode",R,Le.setState),cn("onConnect",l,Le.setState),cn("onConnectStart",c,Le.setState),cn("onConnectEnd",f,Le.setState),cn("onClickConnectStart",m,Le.setState),cn("onClickConnectEnd",h,Le.setState),cn("nodesDraggable",p,Le.setState),cn("nodesConnectable",y,Le.setState),cn("nodesFocusable",g,Le.setState),cn("edgesFocusable",v,Le.setState),cn("edgesUpdatable",S,Le.setState),cn("elementsSelectable",_,Le.setState),cn("elevateNodesOnSelect",w,Le.setState),cn("snapToGrid",j,Le.setState),cn("snapGrid",D,Le.setState),cn("onNodesChange",A,Le.setState),cn("onEdgesChange",O,Le.setState),cn("connectOnClick",P,Le.setState),cn("fitViewOnInit",H,Le.setState),cn("fitViewOnInitOptions",G,Le.setState),cn("onNodesDelete",V,Le.setState),cn("onEdgesDelete",k,Le.setState),cn("onNodeDrag",F,Le.setState),cn("onNodeDragStart",I,Le.setState),cn("onNodeDragStop",L,Le.setState),cn("onSelectionDrag",$,Le.setState),cn("onSelectionDragStart",T,Le.setState),cn("onSelectionDragStop",U,Le.setState),cn("noPanClassName",M,Le.setState),cn("nodeOrigin",q,Le.setState),cn("rfId",Y,Le.setState),cn("autoPanOnConnect",J,Le.setState),cn("autoPanOnNodeDrag",ie,Le.setState),cn("onError",Z,Le.setState),cn("connectionRadius",fe,Le.setState),cn("isValidConnection",Q,Le.setState),cn("nodeDragThreshold",se,Le.setState),gl(e,ne),gl(t,we),gl(N,Me),gl(E,Ae),gl(z,it),gl(C,$e),null},cw={display:"none"},v6={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},LE="react-flow__node-desc",OE="react-flow__edge-desc",x6="react-flow__aria-live",S6=e=>e.ariaLiveMessage;function w6({rfId:e}){const t=Ln(S6);return De.createElement("div",{id:`${x6}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:v6},t)}function N6({rfId:e,disableKeyboardA11y:t}){return De.createElement(De.Fragment,null,De.createElement("div",{id:`${LE}-${e}`,style:cw},"Press enter or space to select a node.",!t&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),De.createElement("div",{id:`${OE}-${e}`,style:cw},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!t&&De.createElement(w6,{rfId:e}))}var xc=(e=null,t={actInsideInputWithModifier:!0})=>{const[r,i]=u.useState(!1),l=u.useRef(!1),c=u.useRef(new Set([])),[f,m]=u.useMemo(()=>{if(e!==null){const p=(Array.isArray(e)?e:[e]).filter(g=>typeof g=="string").map(g=>g.split("+")),y=p.reduce((g,v)=>g.concat(...v),[]);return[p,y]}return[[],[]]},[e]);return u.useEffect(()=>{const h=typeof document<"u"?document:null,p=t?.target||h;if(e!==null){const y=S=>{if(l.current=S.ctrlKey||S.metaKey||S.shiftKey,(!l.current||l.current&&!t.actInsideInputWithModifier)&&cy(S))return!1;const N=dw(S.code,m);c.current.add(S[N]),uw(f,c.current,!1)&&(S.preventDefault(),i(!0))},g=S=>{if((!l.current||l.current&&!t.actInsideInputWithModifier)&&cy(S))return!1;const N=dw(S.code,m);uw(f,c.current,!0)?(i(!1),c.current.clear()):c.current.delete(S[N]),S.key==="Meta"&&c.current.clear(),l.current=!1},v=()=>{c.current.clear(),i(!1)};return p?.addEventListener("keydown",y),p?.addEventListener("keyup",g),window.addEventListener("blur",v),()=>{p?.removeEventListener("keydown",y),p?.removeEventListener("keyup",g),window.removeEventListener("blur",v)}}},[e,i]),r};function uw(e,t,r){return e.filter(i=>r||i.length===t.size).some(i=>i.every(l=>t.has(l)))}function dw(e,t){return t.includes(e)?"code":"key"}function zE(e,t,r,i){const l=e.parentNode||e.parentId;if(!l)return r;const c=t.get(l),f=Ai(c,i);return zE(c,t,{x:(r.x??0)+f.x,y:(r.y??0)+f.y,z:(c[Yn]?.z??0)>(r.z??0)?c[Yn]?.z??0:r.z??0},i)}function $E(e,t,r){e.forEach(i=>{const l=i.parentNode||i.parentId;if(l&&!e.has(l))throw new Error(`Parent node ${l} not found`);if(l||r?.[i.id]){const{x:c,y:f,z:m}=zE(i,e,{...i.position,z:i[Yn]?.z??0},t);i.positionAbsolute={x:c,y:f},i[Yn].z=m,r?.[i.id]&&(i[Yn].isParent=!0)}})}function wp(e,t,r,i){const l=new Map,c={},f=i?1e3:0;return e.forEach(m=>{const h=(ls(m.zIndex)?m.zIndex:0)+(m.selected?f:0),p=t.get(m.id),y={...m,positionAbsolute:{x:m.position.x,y:m.position.y}},g=m.parentNode||m.parentId;g&&(c[g]=!0);const v=p?.type&&p?.type!==m.type;Object.defineProperty(y,Yn,{enumerable:!1,value:{handleBounds:v?void 0:p?.[Yn]?.handleBounds,z:h}}),l.set(m.id,y)}),$E(l,r,c),l}function FE(e,t={}){const{getNodes:r,width:i,height:l,minZoom:c,maxZoom:f,d3Zoom:m,d3Selection:h,fitViewOnInitDone:p,fitViewOnInit:y,nodeOrigin:g}=e(),v=t.initial&&!p&&y;if(m&&h&&(v||!t.initial)){const w=r().filter(E=>{const C=t.includeHiddenNodes?E.width&&E.height:!E.hidden;return t.nodes?.length?C&&t.nodes.some(A=>A.id===E.id):C}),N=w.every(E=>E.width&&E.height);if(w.length>0&&N){const E=Nf(w,g),{x:C,y:A,zoom:O}=EE(E,i,l,t.minZoom??c,t.maxZoom??f,t.padding??.1),_=lr.translate(C,A).scale(O);return typeof t.duration=="number"&&t.duration>0?m.transform(xi(h,t.duration),_):m.transform(h,_),!0}}return!1}function E6(e,t){return e.forEach(r=>{const i=t.get(r.id);i&&t.set(i.id,{...i,[Yn]:i[Yn],selected:r.selected})}),new Map(t)}function j6(e,t){return t.map(r=>{const i=e.find(l=>l.id===r.id);return i&&(r.selected=i.selected),r})}function sd({changedNodes:e,changedEdges:t,get:r,set:i}){const{nodeInternals:l,edges:c,onNodesChange:f,onEdgesChange:m,hasDefaultNodes:h,hasDefaultEdges:p}=r();e?.length&&(h&&i({nodeInternals:E6(e,l)}),f?.(e)),t?.length&&(p&&i({edges:j6(t,c)}),m?.(t))}const bl=()=>{},_6={zoomIn:bl,zoomOut:bl,zoomTo:bl,getZoom:()=>1,setViewport:bl,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:bl,fitBounds:bl,project:e=>e,screenToFlowPosition:e=>e,flowToScreenPosition:e=>e,viewportInitialized:!1},C6=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection}),A6=()=>{const e=aa(),{d3Zoom:t,d3Selection:r}=Ln(C6,ia);return u.useMemo(()=>r&&t?{zoomIn:l=>t.scaleBy(xi(r,l?.duration),1.2),zoomOut:l=>t.scaleBy(xi(r,l?.duration),1/1.2),zoomTo:(l,c)=>t.scaleTo(xi(r,c?.duration),l),getZoom:()=>e.getState().transform[2],setViewport:(l,c)=>{const[f,m,h]=e.getState().transform,p=lr.translate(l.x??f,l.y??m).scale(l.zoom??h);t.transform(xi(r,c?.duration),p)},getViewport:()=>{const[l,c,f]=e.getState().transform;return{x:l,y:c,zoom:f}},fitView:l=>FE(e.getState,l),setCenter:(l,c,f)=>{const{width:m,height:h,maxZoom:p}=e.getState(),y=typeof f?.zoom<"u"?f.zoom:p,g=m/2-l*y,v=h/2-c*y,S=lr.translate(g,v).scale(y);t.transform(xi(r,f?.duration),S)},fitBounds:(l,c)=>{const{width:f,height:m,minZoom:h,maxZoom:p}=e.getState(),{x:y,y:g,zoom:v}=EE(l,f,m,h,p,c?.padding??.1),S=lr.translate(y,g).scale(v);t.transform(xi(r,c?.duration),S)},project:l=>{const{transform:c,snapToGrid:f,snapGrid:m}=e.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),dy(l,c,f,m)},screenToFlowPosition:l=>{const{transform:c,snapToGrid:f,snapGrid:m,domNode:h}=e.getState();if(!h)return l;const{x:p,y}=h.getBoundingClientRect(),g={x:l.x-p,y:l.y-y};return dy(g,c,f,m)},flowToScreenPosition:l=>{const{transform:c,domNode:f}=e.getState();if(!f)return l;const{x:m,y:h}=f.getBoundingClientRect(),p=SE(l,c);return{x:p.x+m,y:p.y+h}},viewportInitialized:!0}:_6,[t,r])};function Ef(){const e=A6(),t=aa(),r=u.useCallback(()=>t.getState().getNodes().map(N=>({...N})),[]),i=u.useCallback(N=>t.getState().nodeInternals.get(N),[]),l=u.useCallback(()=>{const{edges:N=[]}=t.getState();return N.map(E=>({...E}))},[]),c=u.useCallback(N=>{const{edges:E=[]}=t.getState();return E.find(C=>C.id===N)},[]),f=u.useCallback(N=>{const{getNodes:E,setNodes:C,hasDefaultNodes:A,onNodesChange:O}=t.getState(),_=E(),R=typeof N=="function"?N(_):N;if(A)C(R);else if(O){const D=R.length===0?_.map(j=>({type:"remove",id:j.id})):R.map(j=>({item:j,type:"reset"}));O(D)}},[]),m=u.useCallback(N=>{const{edges:E=[],setEdges:C,hasDefaultEdges:A,onEdgesChange:O}=t.getState(),_=typeof N=="function"?N(E):N;if(A)C(_);else if(O){const R=_.length===0?E.map(D=>({type:"remove",id:D.id})):_.map(D=>({item:D,type:"reset"}));O(R)}},[]),h=u.useCallback(N=>{const E=Array.isArray(N)?N:[N],{getNodes:C,setNodes:A,hasDefaultNodes:O,onNodesChange:_}=t.getState();if(O){const D=[...C(),...E];A(D)}else if(_){const R=E.map(D=>({item:D,type:"add"}));_(R)}},[]),p=u.useCallback(N=>{const E=Array.isArray(N)?N:[N],{edges:C=[],setEdges:A,hasDefaultEdges:O,onEdgesChange:_}=t.getState();if(O)A([...C,...E]);else if(_){const R=E.map(D=>({item:D,type:"add"}));_(R)}},[]),y=u.useCallback(()=>{const{getNodes:N,edges:E=[],transform:C}=t.getState(),[A,O,_]=C;return{nodes:N().map(R=>({...R})),edges:E.map(R=>({...R})),viewport:{x:A,y:O,zoom:_}}},[]),g=u.useCallback(({nodes:N,edges:E})=>{const{nodeInternals:C,getNodes:A,edges:O,hasDefaultNodes:_,hasDefaultEdges:R,onNodesDelete:D,onEdgesDelete:j,onNodesChange:z,onEdgesChange:P}=t.getState(),X=(N||[]).map(F=>F.id),H=(E||[]).map(F=>F.id),G=A().reduce((F,I)=>{const L=I.parentNode||I.parentId,$=!X.includes(I.id)&&L&&F.find(U=>U.id===L);return(typeof I.deletable=="boolean"?I.deletable:!0)&&(X.includes(I.id)||$)&&F.push(I),F},[]),V=O.filter(F=>typeof F.deletable=="boolean"?F.deletable:!0),k=V.filter(F=>H.includes(F.id));if(G||k){const F=NE(G,V),I=[...k,...F],L=I.reduce(($,T)=>($.includes(T.id)||$.push(T.id),$),[]);if((R||_)&&(R&&t.setState({edges:O.filter($=>!L.includes($.id))}),_&&(G.forEach($=>{C.delete($.id)}),t.setState({nodeInternals:new Map(C)}))),L.length>0&&(j?.(I),P&&P(L.map($=>({id:$,type:"remove"})))),G.length>0&&(D?.(G),z)){const $=G.map(T=>({id:T.id,type:"remove"}));z($)}}},[]),v=u.useCallback(N=>{const E=X7(N),C=E?null:t.getState().nodeInternals.get(N.id);return!E&&!C?[null,null,E]:[E?N:nw(C),C,E]},[]),S=u.useCallback((N,E=!0,C)=>{const[A,O,_]=v(N);return A?(C||t.getState().getNodes()).filter(R=>{if(!_&&(R.id===O.id||!R.positionAbsolute))return!1;const D=nw(R),j=oy(D,A);return E&&j>0||j>=A.width*A.height}):[]},[]),w=u.useCallback((N,E,C=!0)=>{const[A]=v(N);if(!A)return!1;const O=oy(A,E);return C&&O>0||O>=A.width*A.height},[]);return u.useMemo(()=>({...e,getNodes:r,getNode:i,getEdges:l,getEdge:c,setNodes:f,setEdges:m,addNodes:h,addEdges:p,toObject:y,deleteElements:g,getIntersectingNodes:S,isNodeIntersecting:w}),[e,r,i,l,c,f,m,h,p,y,g,S,w])}const T6={actInsideInputWithModifier:!1};var M6=({deleteKeyCode:e,multiSelectionKeyCode:t})=>{const r=aa(),{deleteElements:i}=Ef(),l=xc(e,T6),c=xc(t);u.useEffect(()=>{if(l){const{edges:f,getNodes:m}=r.getState(),h=m().filter(y=>y.selected),p=f.filter(y=>y.selected);i({nodes:h,edges:p}),r.setState({nodesSelectionActive:!1})}},[l]),u.useEffect(()=>{r.setState({multiSelectionActive:c})},[c])};function R6(e){const t=aa();u.useEffect(()=>{let r;const i=()=>{if(!e.current)return;const l=cg(e.current);(l.height===0||l.width===0)&&t.getState().onError?.("004",ur.error004()),t.setState({width:l.width||500,height:l.height||500})};return i(),window.addEventListener("resize",i),e.current&&(r=new ResizeObserver(()=>i()),r.observe(e.current)),()=>{window.removeEventListener("resize",i),r&&e.current&&r.unobserve(e.current)}},[])}const gg={position:"absolute",width:"100%",height:"100%",top:0,left:0},k6=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,rd=e=>({x:e.x,y:e.y,zoom:e.k}),vl=(e,t)=>e.target.closest(`.${t}`),fw=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),mw=e=>{const t=e.ctrlKey&&qd()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t},D6=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler,userSelectionActive:e.userSelectionActive}),I6=({onMove:e,onMoveStart:t,onMoveEnd:r,onPaneContextMenu:i,zoomOnScroll:l=!0,zoomOnPinch:c=!0,panOnScroll:f=!1,panOnScrollSpeed:m=.5,panOnScrollMode:h=_i.Free,zoomOnDoubleClick:p=!0,elementsSelectable:y,panOnDrag:g=!0,defaultViewport:v,translateExtent:S,minZoom:w,maxZoom:N,zoomActivationKeyCode:E,preventScrolling:C=!0,children:A,noWheelClassName:O,noPanClassName:_})=>{const R=u.useRef(),D=aa(),j=u.useRef(!1),z=u.useRef(!1),P=u.useRef(null),X=u.useRef({x:0,y:0,zoom:0}),{d3Zoom:H,d3Selection:G,d3ZoomHandler:V,userSelectionActive:k}=Ln(D6,ia),F=xc(E),I=u.useRef(0),L=u.useRef(!1),$=u.useRef();return R6(P),u.useEffect(()=>{if(P.current){const T=P.current.getBoundingClientRect(),U=cE().scaleExtent([w,N]).translateExtent(S),M=is(P.current).call(U),q=lr.translate(v.x,v.y).scale(Dl(v.zoom,w,N)),Y=[[0,0],[T.width,T.height]],J=U.constrain()(q,Y,S);U.transform(M,J),U.wheelDelta(mw),D.setState({d3Zoom:U,d3Selection:M,d3ZoomHandler:M.on("wheel.zoom"),transform:[J.x,J.y,J.k],domNode:P.current.closest(".react-flow")})}},[]),u.useEffect(()=>{G&&H&&(f&&!F&&!k?G.on("wheel.zoom",T=>{if(vl(T,O))return!1;T.preventDefault(),T.stopImmediatePropagation();const U=G.property("__zoom").k||1;if(T.ctrlKey&&c){const Q=ps(T),se=mw(T),ne=U*Math.pow(2,se);H.scaleTo(G,ne,Q,T);return}const M=T.deltaMode===1?20:1;let q=h===_i.Vertical?0:T.deltaX*M,Y=h===_i.Horizontal?0:T.deltaY*M;!qd()&&T.shiftKey&&h!==_i.Vertical&&(q=T.deltaY*M,Y=0),H.translateBy(G,-(q/U)*m,-(Y/U)*m,{internal:!0});const J=rd(G.property("__zoom")),{onViewportChangeStart:ie,onViewportChange:Z,onViewportChangeEnd:fe}=D.getState();clearTimeout($.current),L.current||(L.current=!0,t?.(T,J),ie?.(J)),L.current&&(e?.(T,J),Z?.(J),$.current=setTimeout(()=>{r?.(T,J),fe?.(J),L.current=!1},150))},{passive:!1}):typeof V<"u"&&G.on("wheel.zoom",function(T,U){if(!C&&T.type==="wheel"&&!T.ctrlKey||vl(T,O))return null;T.preventDefault(),V.call(this,T,U)},{passive:!1}))},[k,f,h,G,H,V,F,c,C,O,t,e,r]),u.useEffect(()=>{H&&H.on("start",T=>{if(!T.sourceEvent||T.sourceEvent.internal)return null;I.current=T.sourceEvent?.button;const{onViewportChangeStart:U}=D.getState(),M=rd(T.transform);j.current=!0,X.current=M,T.sourceEvent?.type==="mousedown"&&D.setState({paneDragging:!0}),U?.(M),t?.(T.sourceEvent,M)})},[H,t]),u.useEffect(()=>{H&&(k&&!j.current?H.on("zoom",null):k||H.on("zoom",T=>{const{onViewportChange:U}=D.getState();if(D.setState({transform:[T.transform.x,T.transform.y,T.transform.k]}),z.current=!!(i&&fw(g,I.current??0)),(e||U)&&!T.sourceEvent?.internal){const M=rd(T.transform);U?.(M),e?.(T.sourceEvent,M)}}))},[k,H,e,g,i]),u.useEffect(()=>{H&&H.on("end",T=>{if(!T.sourceEvent||T.sourceEvent.internal)return null;const{onViewportChangeEnd:U}=D.getState();if(j.current=!1,D.setState({paneDragging:!1}),i&&fw(g,I.current??0)&&!z.current&&i(T.sourceEvent),z.current=!1,(r||U)&&k6(X.current,T.transform)){const M=rd(T.transform);X.current=M,clearTimeout(R.current),R.current=setTimeout(()=>{U?.(M),r?.(T.sourceEvent,M)},f?150:0)}})},[H,f,g,r,i]),u.useEffect(()=>{H&&H.filter(T=>{const U=F||l,M=c&&T.ctrlKey;if((g===!0||Array.isArray(g)&&g.includes(1))&&T.button===1&&T.type==="mousedown"&&(vl(T,"react-flow__node")||vl(T,"react-flow__edge")))return!0;if(!g&&!U&&!f&&!p&&!c||k||!p&&T.type==="dblclick"||vl(T,O)&&T.type==="wheel"||vl(T,_)&&(T.type!=="wheel"||f&&T.type==="wheel"&&!F)||!c&&T.ctrlKey&&T.type==="wheel"||!U&&!f&&!M&&T.type==="wheel"||!g&&(T.type==="mousedown"||T.type==="touchstart")||Array.isArray(g)&&!g.includes(T.button)&&T.type==="mousedown")return!1;const q=Array.isArray(g)&&g.includes(T.button)||!T.button||T.button<=1;return(!T.ctrlKey||T.type==="wheel")&&q})},[k,H,l,c,f,p,g,y,F]),De.createElement("div",{className:"react-flow__renderer",ref:P,style:gg},A)},L6=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function O6(){const{userSelectionActive:e,userSelectionRect:t}=Ln(L6,ia);return e&&t?De.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}function hw(e,t){const r=t.parentNode||t.parentId,i=e.find(l=>l.id===r);if(i){const l=t.position.x+t.width-i.width,c=t.position.y+t.height-i.height;if(l>0||c>0||t.position.x<0||t.position.y<0){if(i.style={...i.style},i.style.width=i.style.width??i.width,i.style.height=i.style.height??i.height,l>0&&(i.style.width+=l),c>0&&(i.style.height+=c),t.position.x<0){const f=Math.abs(t.position.x);i.position.x=i.position.x-f,i.style.width+=f,t.position.x=0}if(t.position.y<0){const f=Math.abs(t.position.y);i.position.y=i.position.y-f,i.style.height+=f,t.position.y=0}i.width=i.style.width,i.height=i.style.height}}}function BE(e,t){if(e.some(i=>i.type==="reset"))return e.filter(i=>i.type==="reset").map(i=>i.item);const r=e.filter(i=>i.type==="add").map(i=>i.item);return t.reduce((i,l)=>{const c=e.filter(m=>m.id===l.id);if(c.length===0)return i.push(l),i;const f={...l};for(const m of c)if(m)switch(m.type){case"select":{f.selected=m.selected;break}case"position":{typeof m.position<"u"&&(f.position=m.position),typeof m.positionAbsolute<"u"&&(f.positionAbsolute=m.positionAbsolute),typeof m.dragging<"u"&&(f.dragging=m.dragging),f.expandParent&&hw(i,f);break}case"dimensions":{typeof m.dimensions<"u"&&(f.width=m.dimensions.width,f.height=m.dimensions.height),typeof m.updateStyle<"u"&&(f.style={...f.style||{},...m.dimensions}),typeof m.resizing=="boolean"&&(f.resizing=m.resizing),f.expandParent&&hw(i,f);break}case"remove":return i}return i.push(f),i},r)}function UE(e,t){return BE(e,t)}function z6(e,t){return BE(e,t)}const Br=(e,t)=>({id:e,type:"select",selected:t});function wl(e,t){return e.reduce((r,i)=>{const l=t.includes(i.id);return!i.selected&&l?(i.selected=!0,r.push(Br(i.id,!0))):i.selected&&!l&&(i.selected=!1,r.push(Br(i.id,!1))),r},[])}const Np=(e,t)=>r=>{r.target===t.current&&e?.(r)},$6=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging}),qE=u.memo(({isSelecting:e,selectionMode:t=vc.Full,panOnDrag:r,onSelectionStart:i,onSelectionEnd:l,onPaneClick:c,onPaneContextMenu:f,onPaneScroll:m,onPaneMouseEnter:h,onPaneMouseMove:p,onPaneMouseLeave:y,children:g})=>{const v=u.useRef(null),S=aa(),w=u.useRef(0),N=u.useRef(0),E=u.useRef(),{userSelectionActive:C,elementsSelectable:A,dragging:O}=Ln($6,ia),_=()=>{S.setState({userSelectionActive:!1,userSelectionRect:null}),w.current=0,N.current=0},R=V=>{c?.(V),S.getState().resetSelectedElements(),S.setState({nodesSelectionActive:!1})},D=V=>{if(Array.isArray(r)&&r?.includes(2)){V.preventDefault();return}f?.(V)},j=m?V=>m(V):void 0,z=V=>{const{resetSelectedElements:k,domNode:F}=S.getState();if(E.current=F?.getBoundingClientRect(),!A||!e||V.button!==0||V.target!==v.current||!E.current)return;const{x:I,y:L}=Yr(V,E.current);k(),S.setState({userSelectionRect:{width:0,height:0,startX:I,startY:L,x:I,y:L}}),i?.(V)},P=V=>{const{userSelectionRect:k,nodeInternals:F,edges:I,transform:L,onNodesChange:$,onEdgesChange:T,nodeOrigin:U,getNodes:M}=S.getState();if(!e||!E.current||!k)return;S.setState({userSelectionActive:!0,nodesSelectionActive:!1});const q=Yr(V,E.current),Y=k.startX??0,J=k.startY??0,ie={...k,x:q.x<Y?q.x:Y,y:q.y<J?q.y:J,width:Math.abs(q.x-Y),height:Math.abs(q.y-J)},Z=M(),fe=wE(F,ie,L,t===vc.Partial,!0,U),Q=NE(fe,I).map(ne=>ne.id),se=fe.map(ne=>ne.id);if(w.current!==se.length){w.current=se.length;const ne=wl(Z,se);ne.length&&$?.(ne)}if(N.current!==Q.length){N.current=Q.length;const ne=wl(I,Q);ne.length&&T?.(ne)}S.setState({userSelectionRect:ie})},X=V=>{if(V.button!==0)return;const{userSelectionRect:k}=S.getState();!C&&k&&V.target===v.current&&R?.(V),S.setState({nodesSelectionActive:w.current>0}),_(),l?.(V)},H=V=>{C&&(S.setState({nodesSelectionActive:w.current>0}),l?.(V)),_()},G=A&&(e||C);return De.createElement("div",{className:pa(["react-flow__pane",{dragging:O,selection:e}]),onClick:G?void 0:Np(R,v),onContextMenu:Np(D,v),onWheel:Np(j,v),onMouseEnter:G?void 0:h,onMouseDown:G?z:void 0,onMouseMove:G?P:p,onMouseUp:G?X:void 0,onMouseLeave:G?H:y,ref:v,style:gg},g,De.createElement(O6,null))});qE.displayName="Pane";function HE(e,t){const r=e.parentNode||e.parentId;if(!r)return!1;const i=t.get(r);return i?i.selected?!0:HE(i,t):!1}function pw(e,t,r){let i=e;do{if(i?.matches(t))return!0;if(i===r.current)return!1;i=i.parentElement}while(i);return!1}function F6(e,t,r,i){return Array.from(e.values()).filter(l=>(l.selected||l.id===i)&&(!l.parentNode||l.parentId||!HE(l,e))&&(l.draggable||t&&typeof l.draggable>"u")).map(l=>({id:l.id,position:l.position||{x:0,y:0},positionAbsolute:l.positionAbsolute||{x:0,y:0},distance:{x:r.x-(l.positionAbsolute?.x??0),y:r.y-(l.positionAbsolute?.y??0)},delta:{x:0,y:0},extent:l.extent,parentNode:l.parentNode||l.parentId,parentId:l.parentNode||l.parentId,width:l.width,height:l.height,expandParent:l.expandParent}))}function B6(e,t){return!t||t==="parent"?t:[t[0],[t[1][0]-(e.width||0),t[1][1]-(e.height||0)]]}function PE(e,t,r,i,l=[0,0],c){const f=B6(e,e.extent||i);let m=f;const h=e.parentNode||e.parentId;if(e.extent==="parent"&&!e.expandParent)if(h&&e.width&&e.height){const g=r.get(h),{x:v,y:S}=Ai(g,l).positionAbsolute;m=g&&ls(v)&&ls(S)&&ls(g.width)&&ls(g.height)?[[v+e.width*l[0],S+e.height*l[1]],[v+g.width-e.width+e.width*l[0],S+g.height-e.height+e.height*l[1]]]:m}else c?.("005",ur.error005()),m=f;else if(e.extent&&h&&e.extent!=="parent"){const g=r.get(h),{x:v,y:S}=Ai(g,l).positionAbsolute;m=[[e.extent[0][0]+v,e.extent[0][1]+S],[e.extent[1][0]+v,e.extent[1][1]+S]]}let p={x:0,y:0};if(h){const g=r.get(h);p=Ai(g,l).positionAbsolute}const y=m&&m!=="parent"?ug(t,m):t;return{position:{x:y.x-p.x,y:y.y-p.y},positionAbsolute:y}}function Ep({nodeId:e,dragItems:t,nodeInternals:r}){const i=t.map(l=>({...r.get(l.id),position:l.position,positionAbsolute:l.positionAbsolute}));return[e?i.find(l=>l.id===e):i[0],i]}const yw=(e,t,r,i)=>{const l=t.querySelectorAll(e);if(!l||!l.length)return null;const c=Array.from(l),f=t.getBoundingClientRect(),m={x:f.width*i[0],y:f.height*i[1]};return c.map(h=>{const p=h.getBoundingClientRect();return{id:h.getAttribute("data-handleid"),position:h.getAttribute("data-handlepos"),x:(p.left-f.left-m.x)/r,y:(p.top-f.top-m.y)/r,...cg(h)}})};function Uo(e,t,r){return r===void 0?r:i=>{const l=t().nodeInternals.get(e);l&&r(i,{...l})}}function my({id:e,store:t,unselect:r=!1,nodeRef:i}){const{addSelectedNodes:l,unselectNodesAndEdges:c,multiSelectionActive:f,nodeInternals:m,onError:h}=t.getState(),p=m.get(e);if(!p){h?.("012",ur.error012(e));return}t.setState({nodesSelectionActive:!1}),p.selected?(r||p.selected&&f)&&(c({nodes:[p],edges:[]}),requestAnimationFrame(()=>i?.current?.blur())):l([e])}function U6(){const e=aa();return u.useCallback(({sourceEvent:r})=>{const{transform:i,snapGrid:l,snapToGrid:c}=e.getState(),f=r.touches?r.touches[0].clientX:r.clientX,m=r.touches?r.touches[0].clientY:r.clientY,h={x:(f-i[0])/i[2],y:(m-i[1])/i[2]};return{xSnapped:c?l[0]*Math.round(h.x/l[0]):h.x,ySnapped:c?l[1]*Math.round(h.y/l[1]):h.y,...h}},[])}function jp(e){return(t,r,i)=>e?.(t,i)}function VE({nodeRef:e,disabled:t=!1,noDragClassName:r,handleSelector:i,nodeId:l,isSelectable:c,selectNodesOnDrag:f}){const m=aa(),[h,p]=u.useState(!1),y=u.useRef([]),g=u.useRef({x:null,y:null}),v=u.useRef(0),S=u.useRef(null),w=u.useRef({x:0,y:0}),N=u.useRef(null),E=u.useRef(!1),C=u.useRef(!1),A=u.useRef(!1),O=U6();return u.useEffect(()=>{if(e?.current){const _=is(e.current),R=({x:z,y:P})=>{const{nodeInternals:X,onNodeDrag:H,onSelectionDrag:G,updateNodePositions:V,nodeExtent:k,snapGrid:F,snapToGrid:I,nodeOrigin:L,onError:$}=m.getState();g.current={x:z,y:P};let T=!1,U={x:0,y:0,x2:0,y2:0};if(y.current.length>1&&k){const q=Nf(y.current,L);U=bc(q)}if(y.current=y.current.map(q=>{const Y={x:z-q.distance.x,y:P-q.distance.y};I&&(Y.x=F[0]*Math.round(Y.x/F[0]),Y.y=F[1]*Math.round(Y.y/F[1]));const J=[[k[0][0],k[0][1]],[k[1][0],k[1][1]]];y.current.length>1&&k&&!q.extent&&(J[0][0]=q.positionAbsolute.x-U.x+k[0][0],J[1][0]=q.positionAbsolute.x+(q.width??0)-U.x2+k[1][0],J[0][1]=q.positionAbsolute.y-U.y+k[0][1],J[1][1]=q.positionAbsolute.y+(q.height??0)-U.y2+k[1][1]);const ie=PE(q,Y,X,J,L,$);return T=T||q.position.x!==ie.position.x||q.position.y!==ie.position.y,q.position=ie.position,q.positionAbsolute=ie.positionAbsolute,q}),!T)return;V(y.current,!0,!0),p(!0);const M=l?H:jp(G);if(M&&N.current){const[q,Y]=Ep({nodeId:l,dragItems:y.current,nodeInternals:X});M(N.current,q,Y)}},D=()=>{if(!S.current)return;const[z,P]=dE(w.current,S.current);if(z!==0||P!==0){const{transform:X,panBy:H}=m.getState();g.current.x=(g.current.x??0)-z/X[2],g.current.y=(g.current.y??0)-P/X[2],H({x:z,y:P})&&R(g.current)}v.current=requestAnimationFrame(D)},j=z=>{const{nodeInternals:P,multiSelectionActive:X,nodesDraggable:H,unselectNodesAndEdges:G,onNodeDragStart:V,onSelectionDragStart:k}=m.getState();C.current=!0;const F=l?V:jp(k);(!f||!c)&&!X&&l&&(P.get(l)?.selected||G()),l&&c&&f&&my({id:l,store:m,nodeRef:e});const I=O(z);if(g.current=I,y.current=F6(P,H,I,l),F&&y.current){const[L,$]=Ep({nodeId:l,dragItems:y.current,nodeInternals:P});F(z.sourceEvent,L,$)}};if(t)_.on(".drag",null);else{const z=Q5().on("start",P=>{const{domNode:X,nodeDragThreshold:H}=m.getState();H===0&&j(P),A.current=!1;const G=O(P);g.current=G,S.current=X?.getBoundingClientRect()||null,w.current=Yr(P.sourceEvent,S.current)}).on("drag",P=>{const X=O(P),{autoPanOnNodeDrag:H,nodeDragThreshold:G}=m.getState();if(P.sourceEvent.type==="touchmove"&&P.sourceEvent.touches.length>1&&(A.current=!0),!A.current){if(!E.current&&C.current&&H&&(E.current=!0,D()),!C.current){const V=X.xSnapped-(g?.current?.x??0),k=X.ySnapped-(g?.current?.y??0);Math.sqrt(V*V+k*k)>G&&j(P)}(g.current.x!==X.xSnapped||g.current.y!==X.ySnapped)&&y.current&&C.current&&(N.current=P.sourceEvent,w.current=Yr(P.sourceEvent,S.current),R(X))}}).on("end",P=>{if(!(!C.current||A.current)&&(p(!1),E.current=!1,C.current=!1,cancelAnimationFrame(v.current),y.current)){const{updateNodePositions:X,nodeInternals:H,onNodeDragStop:G,onSelectionDragStop:V}=m.getState(),k=l?G:jp(V);if(X(y.current,!1,!1),k){const[F,I]=Ep({nodeId:l,dragItems:y.current,nodeInternals:H});k(P.sourceEvent,F,I)}}}).filter(P=>{const X=P.target;return!P.button&&(!r||!pw(X,`.${r}`,e))&&(!i||pw(X,i,e))});return _.call(z),()=>{_.on(".drag",null)}}}},[e,t,r,i,c,m,l,f,O]),h}function YE(){const e=aa();return u.useCallback(r=>{const{nodeInternals:i,nodeExtent:l,updateNodePositions:c,getNodes:f,snapToGrid:m,snapGrid:h,onError:p,nodesDraggable:y}=e.getState(),g=f().filter(A=>A.selected&&(A.draggable||y&&typeof A.draggable>"u")),v=m?h[0]:5,S=m?h[1]:5,w=r.isShiftPressed?4:1,N=r.x*v*w,E=r.y*S*w,C=g.map(A=>{if(A.positionAbsolute){const O={x:A.positionAbsolute.x+N,y:A.positionAbsolute.y+E};m&&(O.x=h[0]*Math.round(O.x/h[0]),O.y=h[1]*Math.round(O.y/h[1]));const{positionAbsolute:_,position:R}=PE(A,O,i,l,void 0,p);A.position=R,A.positionAbsolute=_}return A});c(C,!0,!1)},[])}const Cl={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var qo=e=>{const t=({id:r,type:i,data:l,xPos:c,yPos:f,xPosOrigin:m,yPosOrigin:h,selected:p,onClick:y,onMouseEnter:g,onMouseMove:v,onMouseLeave:S,onContextMenu:w,onDoubleClick:N,style:E,className:C,isDraggable:A,isSelectable:O,isConnectable:_,isFocusable:R,selectNodesOnDrag:D,sourcePosition:j,targetPosition:z,hidden:P,resizeObserver:X,dragHandle:H,zIndex:G,isParent:V,noDragClassName:k,noPanClassName:F,initialized:I,disableKeyboardA11y:L,ariaLabel:$,rfId:T,hasHandleBounds:U})=>{const M=aa(),q=u.useRef(null),Y=u.useRef(null),J=u.useRef(j),ie=u.useRef(z),Z=u.useRef(i),fe=O||A||y||g||v||S,Q=YE(),se=Uo(r,M.getState,g),ne=Uo(r,M.getState,v),we=Uo(r,M.getState,S),Ie=Uo(r,M.getState,w),Me=Uo(r,M.getState,N),Ae=nt=>{const{nodeDragThreshold:Le}=M.getState();if(O&&(!D||!A||Le>0)&&my({id:r,store:M,nodeRef:q}),y){const wt=M.getState().nodeInternals.get(r);wt&&y(nt,{...wt})}},it=nt=>{if(!cy(nt)&&!L)if(pE.includes(nt.key)&&O){const Le=nt.key==="Escape";my({id:r,store:M,unselect:Le,nodeRef:q})}else A&&p&&Object.prototype.hasOwnProperty.call(Cl,nt.key)&&(M.setState({ariaLiveMessage:`Moved selected node ${nt.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~c}, y: ${~~f}`}),Q({x:Cl[nt.key].x,y:Cl[nt.key].y,isShiftPressed:nt.shiftKey}))};u.useEffect(()=>()=>{Y.current&&(X?.unobserve(Y.current),Y.current=null)},[]),u.useEffect(()=>{if(q.current&&!P){const nt=q.current;(!I||!U||Y.current!==nt)&&(Y.current&&X?.unobserve(Y.current),X?.observe(nt),Y.current=nt)}},[P,I,U]),u.useEffect(()=>{const nt=Z.current!==i,Le=J.current!==j,wt=ie.current!==z;q.current&&(nt||Le||wt)&&(nt&&(Z.current=i),Le&&(J.current=j),wt&&(ie.current=z),M.getState().updateNodeDimensions([{id:r,nodeElement:q.current,forceUpdate:!0}]))},[r,i,j,z]);const $e=VE({nodeRef:q,disabled:P||!A,noDragClassName:k,handleSelector:H,nodeId:r,isSelectable:O,selectNodesOnDrag:D});return P?null:De.createElement("div",{className:pa(["react-flow__node",`react-flow__node-${i}`,{[F]:A},C,{selected:p,selectable:O,parent:V,dragging:$e}]),ref:q,style:{zIndex:G,transform:`translate(${m}px,${h}px)`,pointerEvents:fe?"all":"none",visibility:I?"visible":"hidden",...E},"data-id":r,"data-testid":`rf__node-${r}`,onMouseEnter:se,onMouseMove:ne,onMouseLeave:we,onContextMenu:Ie,onClick:Ae,onDoubleClick:Me,onKeyDown:R?it:void 0,tabIndex:R?0:void 0,role:R?"button":void 0,"aria-describedby":L?void 0:`${LE}-${T}`,"aria-label":$},De.createElement(t6,{value:r},De.createElement(e,{id:r,data:l,type:i,xPos:c,yPos:f,selected:p,isConnectable:_,sourcePosition:j,targetPosition:z,dragging:$e,dragHandle:H,zIndex:G})))};return t.displayName="NodeWrapper",u.memo(t)};const q6=e=>{const t=e.getNodes().filter(r=>r.selected);return{...Nf(t,e.nodeOrigin),transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`,userSelectionActive:e.userSelectionActive}};function H6({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:r}){const i=aa(),{width:l,height:c,x:f,y:m,transformString:h,userSelectionActive:p}=Ln(q6,ia),y=YE(),g=u.useRef(null);if(u.useEffect(()=>{r||g.current?.focus({preventScroll:!0})},[r]),VE({nodeRef:g}),p||!l||!c)return null;const v=e?w=>{const N=i.getState().getNodes().filter(E=>E.selected);e(w,N)}:void 0,S=w=>{Object.prototype.hasOwnProperty.call(Cl,w.key)&&y({x:Cl[w.key].x,y:Cl[w.key].y,isShiftPressed:w.shiftKey})};return De.createElement("div",{className:pa(["react-flow__nodesselection","react-flow__container",t]),style:{transform:h}},De.createElement("div",{ref:g,className:"react-flow__nodesselection-rect",onContextMenu:v,tabIndex:r?void 0:-1,onKeyDown:r?void 0:S,style:{width:l,height:c,top:m,left:f}}))}var P6=u.memo(H6);const V6=e=>e.nodesSelectionActive,GE=({children:e,onPaneClick:t,onPaneMouseEnter:r,onPaneMouseMove:i,onPaneMouseLeave:l,onPaneContextMenu:c,onPaneScroll:f,deleteKeyCode:m,onMove:h,onMoveStart:p,onMoveEnd:y,selectionKeyCode:g,selectionOnDrag:v,selectionMode:S,onSelectionStart:w,onSelectionEnd:N,multiSelectionKeyCode:E,panActivationKeyCode:C,zoomActivationKeyCode:A,elementsSelectable:O,zoomOnScroll:_,zoomOnPinch:R,panOnScroll:D,panOnScrollSpeed:j,panOnScrollMode:z,zoomOnDoubleClick:P,panOnDrag:X,defaultViewport:H,translateExtent:G,minZoom:V,maxZoom:k,preventScrolling:F,onSelectionContextMenu:I,noWheelClassName:L,noPanClassName:$,disableKeyboardA11y:T})=>{const U=Ln(V6),M=xc(g),q=xc(C),Y=q||X,J=q||D,ie=M||v&&Y!==!0;return M6({deleteKeyCode:m,multiSelectionKeyCode:E}),De.createElement(I6,{onMove:h,onMoveStart:p,onMoveEnd:y,onPaneContextMenu:c,elementsSelectable:O,zoomOnScroll:_,zoomOnPinch:R,panOnScroll:J,panOnScrollSpeed:j,panOnScrollMode:z,zoomOnDoubleClick:P,panOnDrag:!M&&Y,defaultViewport:H,translateExtent:G,minZoom:V,maxZoom:k,zoomActivationKeyCode:A,preventScrolling:F,noWheelClassName:L,noPanClassName:$},De.createElement(qE,{onSelectionStart:w,onSelectionEnd:N,onPaneClick:t,onPaneMouseEnter:r,onPaneMouseMove:i,onPaneMouseLeave:l,onPaneContextMenu:c,onPaneScroll:f,panOnDrag:Y,isSelecting:!!ie,selectionMode:S},e,U&&De.createElement(P6,{onSelectionContextMenu:I,noPanClassName:$,disableKeyboardA11y:T})))};GE.displayName="FlowRenderer";var Y6=u.memo(GE);function G6(e){return Ln(u.useCallback(r=>e?wE(r.nodeInternals,{x:0,y:0,width:r.width,height:r.height},r.transform,!0):r.getNodes(),[e]))}function X6(e){const t={input:qo(e.input||RE),default:qo(e.default||fy),output:qo(e.output||DE),group:qo(e.group||yg)},r={},i=Object.keys(e).filter(l=>!["input","default","output","group"].includes(l)).reduce((l,c)=>(l[c]=qo(e[c]||fy),l),r);return{...t,...i}}const K6=({x:e,y:t,width:r,height:i,origin:l})=>!r||!i?{x:e,y:t}:l[0]<0||l[1]<0||l[0]>1||l[1]>1?{x:e,y:t}:{x:e-r*l[0],y:t-i*l[1]},W6=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions,onError:e.onError}),XE=e=>{const{nodesDraggable:t,nodesConnectable:r,nodesFocusable:i,elementsSelectable:l,updateNodeDimensions:c,onError:f}=Ln(W6,ia),m=G6(e.onlyRenderVisibleElements),h=u.useRef(),p=u.useMemo(()=>{if(typeof ResizeObserver>"u")return null;const y=new ResizeObserver(g=>{const v=g.map(S=>({id:S.target.getAttribute("data-id"),nodeElement:S.target,forceUpdate:!0}));c(v)});return h.current=y,y},[]);return u.useEffect(()=>()=>{h?.current?.disconnect()},[]),De.createElement("div",{className:"react-flow__nodes",style:gg},m.map(y=>{let g=y.type||"default";e.nodeTypes[g]||(f?.("003",ur.error003(g)),g="default");const v=e.nodeTypes[g]||e.nodeTypes.default,S=!!(y.draggable||t&&typeof y.draggable>"u"),w=!!(y.selectable||l&&typeof y.selectable>"u"),N=!!(y.connectable||r&&typeof y.connectable>"u"),E=!!(y.focusable||i&&typeof y.focusable>"u"),C=e.nodeExtent?ug(y.positionAbsolute,e.nodeExtent):y.positionAbsolute,A=C?.x??0,O=C?.y??0,_=K6({x:A,y:O,width:y.width??0,height:y.height??0,origin:e.nodeOrigin});return De.createElement(v,{key:y.id,id:y.id,className:y.className,style:y.style,type:g,data:y.data,sourcePosition:y.sourcePosition||Ut.Bottom,targetPosition:y.targetPosition||Ut.Top,hidden:y.hidden,xPos:A,yPos:O,xPosOrigin:_.x,yPosOrigin:_.y,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!y.selected,isDraggable:S,isSelectable:w,isConnectable:N,isFocusable:E,resizeObserver:p,dragHandle:y.dragHandle,zIndex:y[Yn]?.z??0,isParent:!!y[Yn]?.isParent,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!y.width&&!!y.height,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,ariaLabel:y.ariaLabel,hasHandleBounds:!!y[Yn]?.handleBounds})}))};XE.displayName="NodeRenderer";var Z6=u.memo(XE);const Q6=(e,t,r)=>r===Ut.Left?e-t:r===Ut.Right?e+t:e,J6=(e,t,r)=>r===Ut.Top?e-t:r===Ut.Bottom?e+t:e,gw="react-flow__edgeupdater",bw=({position:e,centerX:t,centerY:r,radius:i=10,onMouseDown:l,onMouseEnter:c,onMouseOut:f,type:m})=>De.createElement("circle",{onMouseDown:l,onMouseEnter:c,onMouseOut:f,className:pa([gw,`${gw}-${m}`]),cx:Q6(t,i,e),cy:J6(r,i,e),r:i,stroke:"transparent",fill:"transparent"}),e8=()=>!0;var xl=e=>{const t=({id:r,className:i,type:l,data:c,onClick:f,onEdgeDoubleClick:m,selected:h,animated:p,label:y,labelStyle:g,labelShowBg:v,labelBgStyle:S,labelBgPadding:w,labelBgBorderRadius:N,style:E,source:C,target:A,sourceX:O,sourceY:_,targetX:R,targetY:D,sourcePosition:j,targetPosition:z,elementsSelectable:P,hidden:X,sourceHandleId:H,targetHandleId:G,onContextMenu:V,onMouseEnter:k,onMouseMove:F,onMouseLeave:I,reconnectRadius:L,onReconnect:$,onReconnectStart:T,onReconnectEnd:U,markerEnd:M,markerStart:q,rfId:Y,ariaLabel:J,isFocusable:ie,isReconnectable:Z,pathOptions:fe,interactionWidth:Q,disableKeyboardA11y:se})=>{const ne=u.useRef(null),[we,Ie]=u.useState(!1),[Me,Ae]=u.useState(!1),it=aa(),$e=u.useMemo(()=>`url('#${uy(q,Y)}')`,[q,Y]),nt=u.useMemo(()=>`url('#${uy(M,Y)}')`,[M,Y]);if(X)return null;const Le=he=>{const{edges:Se,addSelectedEdges:We,unselectNodesAndEdges:Xe,multiSelectionActive:et}=it.getState(),Te=Se.find(mt=>mt.id===r);Te&&(P&&(it.setState({nodesSelectionActive:!1}),Te.selected&&et?(Xe({nodes:[],edges:[Te]}),ne.current?.blur()):We([r])),f&&f(he,Te))},wt=Bo(r,it.getState,m),Tt=Bo(r,it.getState,V),Ct=Bo(r,it.getState,k),At=Bo(r,it.getState,F),Ue=Bo(r,it.getState,I),Je=(he,Se)=>{if(he.button!==0)return;const{edges:We,isValidConnection:Xe}=it.getState(),et=Se?A:C,Te=(Se?G:H)||null,mt=Se?"target":"source",Dt=Xe||e8,Nt=Se,Ge=We.find(Bt=>Bt.id===r);Ae(!0),T?.(he,Ge,mt);const vt=Bt=>{Ae(!1),U?.(Bt,Ge,mt)};CE({event:he,handleId:Te,nodeId:et,onConnect:Bt=>$?.(Ge,Bt),isTarget:Nt,getState:it.getState,setState:it.setState,isValidConnection:Dt,edgeUpdaterType:mt,onReconnectEnd:vt})},de=he=>Je(he,!0),ue=he=>Je(he,!1),ye=()=>Ie(!0),Ve=()=>Ie(!1),ee=!P&&!f,me=he=>{if(!se&&pE.includes(he.key)&&P){const{unselectNodesAndEdges:Se,addSelectedEdges:We,edges:Xe}=it.getState();he.key==="Escape"?(ne.current?.blur(),Se({edges:[Xe.find(Te=>Te.id===r)]})):We([r])}};return De.createElement("g",{className:pa(["react-flow__edge",`react-flow__edge-${l}`,i,{selected:h,animated:p,inactive:ee,updating:we}]),onClick:Le,onDoubleClick:wt,onContextMenu:Tt,onMouseEnter:Ct,onMouseMove:At,onMouseLeave:Ue,onKeyDown:ie?me:void 0,tabIndex:ie?0:void 0,role:ie?"button":"img","data-testid":`rf__edge-${r}`,"aria-label":J===null?void 0:J||`Edge from ${C} to ${A}`,"aria-describedby":ie?`${OE}-${Y}`:void 0,ref:ne},!Me&&De.createElement(e,{id:r,source:C,target:A,selected:h,animated:p,label:y,labelStyle:g,labelShowBg:v,labelBgStyle:S,labelBgPadding:w,labelBgBorderRadius:N,data:c,style:E,sourceX:O,sourceY:_,targetX:R,targetY:D,sourcePosition:j,targetPosition:z,sourceHandleId:H,targetHandleId:G,markerStart:$e,markerEnd:nt,pathOptions:fe,interactionWidth:Q}),Z&&De.createElement(De.Fragment,null,(Z==="source"||Z===!0)&&De.createElement(bw,{position:j,centerX:O,centerY:_,radius:L,onMouseDown:de,onMouseEnter:ye,onMouseOut:Ve,type:"source"}),(Z==="target"||Z===!0)&&De.createElement(bw,{position:z,centerX:R,centerY:D,radius:L,onMouseDown:ue,onMouseEnter:ye,onMouseOut:Ve,type:"target"})))};return t.displayName="EdgeWrapper",u.memo(t)};function t8(e){const t={default:xl(e.default||Vd),straight:xl(e.bezier||mg),step:xl(e.step||fg),smoothstep:xl(e.step||wf),simplebezier:xl(e.simplebezier||dg)},r={},i=Object.keys(e).filter(l=>!["default","bezier"].includes(l)).reduce((l,c)=>(l[c]=xl(e[c]||Vd),l),r);return{...t,...i}}function vw(e,t,r=null){const i=(r?.x||0)+t.x,l=(r?.y||0)+t.y,c=r?.width||t.width,f=r?.height||t.height;switch(e){case Ut.Top:return{x:i+c/2,y:l};case Ut.Right:return{x:i+c,y:l+f/2};case Ut.Bottom:return{x:i+c/2,y:l+f};case Ut.Left:return{x:i,y:l+f/2}}}function xw(e,t){return e?e.length===1||!t?e[0]:t&&e.find(r=>r.id===t)||null:null}const n8=(e,t,r,i,l,c)=>{const f=vw(r,e,t),m=vw(c,i,l);return{sourceX:f.x,sourceY:f.y,targetX:m.x,targetY:m.y}};function a8({sourcePos:e,targetPos:t,sourceWidth:r,sourceHeight:i,targetWidth:l,targetHeight:c,width:f,height:m,transform:h}){const p={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x+r,t.x+l),y2:Math.max(e.y+i,t.y+c)};p.x===p.x2&&(p.x2+=1),p.y===p.y2&&(p.y2+=1);const y=bc({x:(0-h[0])/h[2],y:(0-h[1])/h[2],width:f/h[2],height:m/h[2]}),g=Math.max(0,Math.min(y.x2,p.x2)-Math.max(y.x,p.x)),v=Math.max(0,Math.min(y.y2,p.y2)-Math.max(y.y,p.y));return Math.ceil(g*v)>0}function Sw(e){const t=e?.[Yn]?.handleBounds||null,r=t&&e?.width&&e?.height&&typeof e?.positionAbsolute?.x<"u"&&typeof e?.positionAbsolute?.y<"u";return[{x:e?.positionAbsolute?.x||0,y:e?.positionAbsolute?.y||0,width:e?.width||0,height:e?.height||0},t,!!r]}const s8=[{level:0,isMaxLevel:!0,edges:[]}];function r8(e,t,r=!1){let i=-1;const l=e.reduce((f,m)=>{const h=ls(m.zIndex);let p=h?m.zIndex:0;if(r){const y=t.get(m.target),g=t.get(m.source),v=m.selected||y?.selected||g?.selected,S=Math.max(g?.[Yn]?.z||0,y?.[Yn]?.z||0,1e3);p=(h?m.zIndex:0)+(v?S:0)}return f[p]?f[p].push(m):f[p]=[m],i=p>i?p:i,f},{}),c=Object.entries(l).map(([f,m])=>{const h=+f;return{edges:m,level:h,isMaxLevel:h===i}});return c.length===0?s8:c}function i8(e,t,r){const i=Ln(u.useCallback(l=>e?l.edges.filter(c=>{const f=t.get(c.source),m=t.get(c.target);return f?.width&&f?.height&&m?.width&&m?.height&&a8({sourcePos:f.positionAbsolute||{x:0,y:0},targetPos:m.positionAbsolute||{x:0,y:0},sourceWidth:f.width,sourceHeight:f.height,targetWidth:m.width,targetHeight:m.height,width:l.width,height:l.height,transform:l.transform})}):l.edges,[e,t]));return r8(i,t,r)}const l8=({color:e="none",strokeWidth:t=1})=>De.createElement("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),o8=({color:e="none",strokeWidth:t=1})=>De.createElement("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),ww={[Hd.Arrow]:l8,[Hd.ArrowClosed]:o8};function c8(e){const t=aa();return u.useMemo(()=>Object.prototype.hasOwnProperty.call(ww,e)?ww[e]:(t.getState().onError?.("009",ur.error009(e)),null),[e])}const u8=({id:e,type:t,color:r,width:i=12.5,height:l=12.5,markerUnits:c="strokeWidth",strokeWidth:f,orient:m="auto-start-reverse"})=>{const h=c8(t);return h?De.createElement("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${i}`,markerHeight:`${l}`,viewBox:"-10 -10 20 20",markerUnits:c,orient:m,refX:"0",refY:"0"},De.createElement(h,{color:r,strokeWidth:f})):null},d8=({defaultColor:e,rfId:t})=>r=>{const i=[];return r.edges.reduce((l,c)=>([c.markerStart,c.markerEnd].forEach(f=>{if(f&&typeof f=="object"){const m=uy(f,t);i.includes(m)||(l.push({id:m,color:f.color||e,...f}),i.push(m))}}),l),[]).sort((l,c)=>l.id.localeCompare(c.id))},KE=({defaultColor:e,rfId:t})=>{const r=Ln(u.useCallback(d8({defaultColor:e,rfId:t}),[e,t]),(i,l)=>!(i.length!==l.length||i.some((c,f)=>c.id!==l[f].id)));return De.createElement("defs",null,r.map(i=>De.createElement(u8,{id:i.id,key:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient})))};KE.displayName="MarkerDefinitions";var f8=u.memo(KE);const m8=e=>({nodesConnectable:e.nodesConnectable,edgesFocusable:e.edgesFocusable,edgesUpdatable:e.edgesUpdatable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals,onError:e.onError}),WE=({defaultMarkerColor:e,onlyRenderVisibleElements:t,elevateEdgesOnSelect:r,rfId:i,edgeTypes:l,noPanClassName:c,onEdgeContextMenu:f,onEdgeMouseEnter:m,onEdgeMouseMove:h,onEdgeMouseLeave:p,onEdgeClick:y,onEdgeDoubleClick:g,onReconnect:v,onReconnectStart:S,onReconnectEnd:w,reconnectRadius:N,children:E,disableKeyboardA11y:C})=>{const{edgesFocusable:A,edgesUpdatable:O,elementsSelectable:_,width:R,height:D,connectionMode:j,nodeInternals:z,onError:P}=Ln(m8,ia),X=i8(t,z,r);return R?De.createElement(De.Fragment,null,X.map(({level:H,edges:G,isMaxLevel:V})=>De.createElement("svg",{key:H,style:{zIndex:H},width:R,height:D,className:"react-flow__edges react-flow__container"},V&&De.createElement(f8,{defaultColor:e,rfId:i}),De.createElement("g",null,G.map(k=>{const[F,I,L]=Sw(z.get(k.source)),[$,T,U]=Sw(z.get(k.target));if(!L||!U)return null;let M=k.type||"default";l[M]||(P?.("011",ur.error011(M)),M="default");const q=l[M]||l.default,Y=j===Mi.Strict?T.target:(T.target??[]).concat(T.source??[]),J=xw(I.source,k.sourceHandle),ie=xw(Y,k.targetHandle),Z=J?.position||Ut.Bottom,fe=ie?.position||Ut.Top,Q=!!(k.focusable||A&&typeof k.focusable>"u"),se=k.reconnectable||k.updatable,ne=typeof v<"u"&&(se||O&&typeof se>"u");if(!J||!ie)return P?.("008",ur.error008(J,k)),null;const{sourceX:we,sourceY:Ie,targetX:Me,targetY:Ae}=n8(F,J,Z,$,ie,fe);return De.createElement(q,{key:k.id,id:k.id,className:pa([k.className,c]),type:M,data:k.data,selected:!!k.selected,animated:!!k.animated,hidden:!!k.hidden,label:k.label,labelStyle:k.labelStyle,labelShowBg:k.labelShowBg,labelBgStyle:k.labelBgStyle,labelBgPadding:k.labelBgPadding,labelBgBorderRadius:k.labelBgBorderRadius,style:k.style,source:k.source,target:k.target,sourceHandleId:k.sourceHandle,targetHandleId:k.targetHandle,markerEnd:k.markerEnd,markerStart:k.markerStart,sourceX:we,sourceY:Ie,targetX:Me,targetY:Ae,sourcePosition:Z,targetPosition:fe,elementsSelectable:_,onContextMenu:f,onMouseEnter:m,onMouseMove:h,onMouseLeave:p,onClick:y,onEdgeDoubleClick:g,onReconnect:v,onReconnectStart:S,onReconnectEnd:w,reconnectRadius:N,rfId:i,ariaLabel:k.ariaLabel,isFocusable:Q,isReconnectable:ne,pathOptions:"pathOptions"in k?k.pathOptions:void 0,interactionWidth:k.interactionWidth,disableKeyboardA11y:C})})))),E):null};WE.displayName="EdgeRenderer";var h8=u.memo(WE);const p8=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function y8({children:e}){const t=Ln(p8);return De.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:t}},e)}function g8(e){const t=Ef(),r=u.useRef(!1);u.useEffect(()=>{!r.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),r.current=!0)},[e,t.viewportInitialized])}const b8={[Ut.Left]:Ut.Right,[Ut.Right]:Ut.Left,[Ut.Top]:Ut.Bottom,[Ut.Bottom]:Ut.Top},ZE=({nodeId:e,handleType:t,style:r,type:i=Pr.Bezier,CustomComponent:l,connectionStatus:c})=>{const{fromNode:f,handleId:m,toX:h,toY:p,connectionMode:y}=Ln(u.useCallback(D=>({fromNode:D.nodeInternals.get(e),handleId:D.connectionHandleId,toX:(D.connectionPosition.x-D.transform[0])/D.transform[2],toY:(D.connectionPosition.y-D.transform[1])/D.transform[2],connectionMode:D.connectionMode}),[e]),ia),g=f?.[Yn]?.handleBounds;let v=g?.[t];if(y===Mi.Loose&&(v=v||g?.[t==="source"?"target":"source"]),!f||!v)return null;const S=m?v.find(D=>D.id===m):v[0],w=S?S.x+S.width/2:(f.width??0)/2,N=S?S.y+S.height/2:f.height??0,E=(f.positionAbsolute?.x??0)+w,C=(f.positionAbsolute?.y??0)+N,A=S?.position,O=A?b8[A]:null;if(!A||!O)return null;if(l)return De.createElement(l,{connectionLineType:i,connectionLineStyle:r,fromNode:f,fromHandle:S,fromX:E,fromY:C,toX:h,toY:p,fromPosition:A,toPosition:O,connectionStatus:c});let _="";const R={sourceX:E,sourceY:C,sourcePosition:A,targetX:h,targetY:p,targetPosition:O};return i===Pr.Bezier?[_]=xE(R):i===Pr.Step?[_]=Pd({...R,borderRadius:0}):i===Pr.SmoothStep?[_]=Pd(R):i===Pr.SimpleBezier?[_]=vE(R):_=`M${E},${C} ${h},${p}`,De.createElement("path",{d:_,fill:"none",className:"react-flow__connection-path",style:r})};ZE.displayName="ConnectionLine";const v8=e=>({nodeId:e.connectionNodeId,handleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,connectionStatus:e.connectionStatus,width:e.width,height:e.height});function x8({containerStyle:e,style:t,type:r,component:i}){const{nodeId:l,handleType:c,nodesConnectable:f,width:m,height:h,connectionStatus:p}=Ln(v8,ia);return!(l&&c&&m&&f)?null:De.createElement("svg",{style:e,width:m,height:h,className:"react-flow__edges react-flow__connectionline react-flow__container"},De.createElement("g",{className:pa(["react-flow__connection",p])},De.createElement(ZE,{nodeId:l,handleType:c,style:t,type:r,CustomComponent:i,connectionStatus:p})))}function Nw(e,t){return u.useRef(null),aa(),u.useMemo(()=>t(e),[e])}const QE=({nodeTypes:e,edgeTypes:t,onMove:r,onMoveStart:i,onMoveEnd:l,onInit:c,onNodeClick:f,onEdgeClick:m,onNodeDoubleClick:h,onEdgeDoubleClick:p,onNodeMouseEnter:y,onNodeMouseMove:g,onNodeMouseLeave:v,onNodeContextMenu:S,onSelectionContextMenu:w,onSelectionStart:N,onSelectionEnd:E,connectionLineType:C,connectionLineStyle:A,connectionLineComponent:O,connectionLineContainerStyle:_,selectionKeyCode:R,selectionOnDrag:D,selectionMode:j,multiSelectionKeyCode:z,panActivationKeyCode:P,zoomActivationKeyCode:X,deleteKeyCode:H,onlyRenderVisibleElements:G,elementsSelectable:V,selectNodesOnDrag:k,defaultViewport:F,translateExtent:I,minZoom:L,maxZoom:$,preventScrolling:T,defaultMarkerColor:U,zoomOnScroll:M,zoomOnPinch:q,panOnScroll:Y,panOnScrollSpeed:J,panOnScrollMode:ie,zoomOnDoubleClick:Z,panOnDrag:fe,onPaneClick:Q,onPaneMouseEnter:se,onPaneMouseMove:ne,onPaneMouseLeave:we,onPaneScroll:Ie,onPaneContextMenu:Me,onEdgeContextMenu:Ae,onEdgeMouseEnter:it,onEdgeMouseMove:$e,onEdgeMouseLeave:nt,onReconnect:Le,onReconnectStart:wt,onReconnectEnd:Tt,reconnectRadius:Ct,noDragClassName:At,noWheelClassName:Ue,noPanClassName:Je,elevateEdgesOnSelect:de,disableKeyboardA11y:ue,nodeOrigin:ye,nodeExtent:Ve,rfId:ee})=>{const me=Nw(e,X6),he=Nw(t,t8);return g8(c),De.createElement(Y6,{onPaneClick:Q,onPaneMouseEnter:se,onPaneMouseMove:ne,onPaneMouseLeave:we,onPaneContextMenu:Me,onPaneScroll:Ie,deleteKeyCode:H,selectionKeyCode:R,selectionOnDrag:D,selectionMode:j,onSelectionStart:N,onSelectionEnd:E,multiSelectionKeyCode:z,panActivationKeyCode:P,zoomActivationKeyCode:X,elementsSelectable:V,onMove:r,onMoveStart:i,onMoveEnd:l,zoomOnScroll:M,zoomOnPinch:q,zoomOnDoubleClick:Z,panOnScroll:Y,panOnScrollSpeed:J,panOnScrollMode:ie,panOnDrag:fe,defaultViewport:F,translateExtent:I,minZoom:L,maxZoom:$,onSelectionContextMenu:w,preventScrolling:T,noDragClassName:At,noWheelClassName:Ue,noPanClassName:Je,disableKeyboardA11y:ue},De.createElement(y8,null,De.createElement(h8,{edgeTypes:he,onEdgeClick:m,onEdgeDoubleClick:p,onlyRenderVisibleElements:G,onEdgeContextMenu:Ae,onEdgeMouseEnter:it,onEdgeMouseMove:$e,onEdgeMouseLeave:nt,onReconnect:Le,onReconnectStart:wt,onReconnectEnd:Tt,reconnectRadius:Ct,defaultMarkerColor:U,noPanClassName:Je,elevateEdgesOnSelect:!!de,disableKeyboardA11y:ue,rfId:ee},De.createElement(x8,{style:A,type:C,component:O,containerStyle:_})),De.createElement("div",{className:"react-flow__edgelabel-renderer"}),De.createElement(Z6,{nodeTypes:me,onNodeClick:f,onNodeDoubleClick:h,onNodeMouseEnter:y,onNodeMouseMove:g,onNodeMouseLeave:v,onNodeContextMenu:S,selectNodesOnDrag:k,onlyRenderVisibleElements:G,noPanClassName:Je,noDragClassName:At,disableKeyboardA11y:ue,nodeOrigin:ye,nodeExtent:Ve,rfId:ee})))};QE.displayName="GraphView";var S8=u.memo(QE);const hy=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Or={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:hy,nodeExtent:hy,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:Mi.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:K7,isValidConnection:void 0},w8=()=>uL((e,t)=>({...Or,setNodes:r=>{const{nodeInternals:i,nodeOrigin:l,elevateNodesOnSelect:c}=t();e({nodeInternals:wp(r,i,l,c)})},getNodes:()=>Array.from(t().nodeInternals.values()),setEdges:r=>{const{defaultEdgeOptions:i={}}=t();e({edges:r.map(l=>({...i,...l}))})},setDefaultNodesAndEdges:(r,i)=>{const l=typeof r<"u",c=typeof i<"u",f=l?wp(r,new Map,t().nodeOrigin,t().elevateNodesOnSelect):new Map;e({nodeInternals:f,edges:c?i:[],hasDefaultNodes:l,hasDefaultEdges:c})},updateNodeDimensions:r=>{const{onNodesChange:i,nodeInternals:l,fitViewOnInit:c,fitViewOnInitDone:f,fitViewOnInitOptions:m,domNode:h,nodeOrigin:p}=t(),y=h?.querySelector(".react-flow__viewport");if(!y)return;const g=window.getComputedStyle(y),{m22:v}=new window.DOMMatrixReadOnly(g.transform),S=r.reduce((N,E)=>{const C=l.get(E.id);if(C?.hidden)l.set(C.id,{...C,[Yn]:{...C[Yn],handleBounds:void 0}});else if(C){const A=cg(E.nodeElement);!!(A.width&&A.height&&(C.width!==A.width||C.height!==A.height||E.forceUpdate))&&(l.set(C.id,{...C,[Yn]:{...C[Yn],handleBounds:{source:yw(".source",E.nodeElement,v,p),target:yw(".target",E.nodeElement,v,p)}},...A}),N.push({id:C.id,type:"dimensions",dimensions:A}))}return N},[]);$E(l,p);const w=f||c&&!f&&FE(t,{initial:!0,...m});e({nodeInternals:new Map(l),fitViewOnInitDone:w}),S?.length>0&&i?.(S)},updateNodePositions:(r,i=!0,l=!1)=>{const{triggerNodeChanges:c}=t(),f=r.map(m=>{const h={id:m.id,type:"position",dragging:l};return i&&(h.positionAbsolute=m.positionAbsolute,h.position=m.position),h});c(f)},triggerNodeChanges:r=>{const{onNodesChange:i,nodeInternals:l,hasDefaultNodes:c,nodeOrigin:f,getNodes:m,elevateNodesOnSelect:h}=t();if(r?.length){if(c){const p=UE(r,m()),y=wp(p,l,f,h);e({nodeInternals:y})}i?.(r)}},addSelectedNodes:r=>{const{multiSelectionActive:i,edges:l,getNodes:c}=t();let f,m=null;i?f=r.map(h=>Br(h,!0)):(f=wl(c(),r),m=wl(l,[])),sd({changedNodes:f,changedEdges:m,get:t,set:e})},addSelectedEdges:r=>{const{multiSelectionActive:i,edges:l,getNodes:c}=t();let f,m=null;i?f=r.map(h=>Br(h,!0)):(f=wl(l,r),m=wl(c(),[])),sd({changedNodes:m,changedEdges:f,get:t,set:e})},unselectNodesAndEdges:({nodes:r,edges:i}={})=>{const{edges:l,getNodes:c}=t(),f=r||c(),m=i||l,h=f.map(y=>(y.selected=!1,Br(y.id,!1))),p=m.map(y=>Br(y.id,!1));sd({changedNodes:h,changedEdges:p,get:t,set:e})},setMinZoom:r=>{const{d3Zoom:i,maxZoom:l}=t();i?.scaleExtent([r,l]),e({minZoom:r})},setMaxZoom:r=>{const{d3Zoom:i,minZoom:l}=t();i?.scaleExtent([l,r]),e({maxZoom:r})},setTranslateExtent:r=>{t().d3Zoom?.translateExtent(r),e({translateExtent:r})},resetSelectedElements:()=>{const{edges:r,getNodes:i}=t(),c=i().filter(m=>m.selected).map(m=>Br(m.id,!1)),f=r.filter(m=>m.selected).map(m=>Br(m.id,!1));sd({changedNodes:c,changedEdges:f,get:t,set:e})},setNodeExtent:r=>{const{nodeInternals:i}=t();i.forEach(l=>{l.positionAbsolute=ug(l.position,r)}),e({nodeExtent:r,nodeInternals:new Map(i)})},panBy:r=>{const{transform:i,width:l,height:c,d3Zoom:f,d3Selection:m,translateExtent:h}=t();if(!f||!m||!r.x&&!r.y)return!1;const p=lr.translate(i[0]+r.x,i[1]+r.y).scale(i[2]),y=[[0,0],[l,c]],g=f?.constrain()(p,y,h);return f.transform(m,g),i[0]!==g.x||i[1]!==g.y||i[2]!==g.k},cancelConnection:()=>e({connectionNodeId:Or.connectionNodeId,connectionHandleId:Or.connectionHandleId,connectionHandleType:Or.connectionHandleType,connectionStatus:Or.connectionStatus,connectionStartHandle:Or.connectionStartHandle,connectionEndHandle:Or.connectionEndHandle}),reset:()=>e({...Or})}),Object.is),JE=({children:e})=>{const t=u.useRef(null);return t.current||(t.current=w8()),De.createElement(q7,{value:t.current},e)};JE.displayName="ReactFlowProvider";const ej=({children:e})=>u.useContext(Sf)?De.createElement(De.Fragment,null,e):De.createElement(JE,null,e);ej.displayName="ReactFlowWrapper";const N8={input:RE,default:fy,output:DE,group:yg},E8={default:Vd,straight:mg,step:fg,smoothstep:wf,simplebezier:dg},j8=[0,0],_8=[15,15],C8={x:0,y:0,zoom:1},A8={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},tj=u.forwardRef(({nodes:e,edges:t,defaultNodes:r,defaultEdges:i,className:l,nodeTypes:c=N8,edgeTypes:f=E8,onNodeClick:m,onEdgeClick:h,onInit:p,onMove:y,onMoveStart:g,onMoveEnd:v,onConnect:S,onConnectStart:w,onConnectEnd:N,onClickConnectStart:E,onClickConnectEnd:C,onNodeMouseEnter:A,onNodeMouseMove:O,onNodeMouseLeave:_,onNodeContextMenu:R,onNodeDoubleClick:D,onNodeDragStart:j,onNodeDrag:z,onNodeDragStop:P,onNodesDelete:X,onEdgesDelete:H,onSelectionChange:G,onSelectionDragStart:V,onSelectionDrag:k,onSelectionDragStop:F,onSelectionContextMenu:I,onSelectionStart:L,onSelectionEnd:$,connectionMode:T=Mi.Strict,connectionLineType:U=Pr.Bezier,connectionLineStyle:M,connectionLineComponent:q,connectionLineContainerStyle:Y,deleteKeyCode:J="Backspace",selectionKeyCode:ie="Shift",selectionOnDrag:Z=!1,selectionMode:fe=vc.Full,panActivationKeyCode:Q="Space",multiSelectionKeyCode:se=qd()?"Meta":"Control",zoomActivationKeyCode:ne=qd()?"Meta":"Control",snapToGrid:we=!1,snapGrid:Ie=_8,onlyRenderVisibleElements:Me=!1,selectNodesOnDrag:Ae=!0,nodesDraggable:it,nodesConnectable:$e,nodesFocusable:nt,nodeOrigin:Le=j8,edgesFocusable:wt,edgesUpdatable:Tt,elementsSelectable:Ct,defaultViewport:At=C8,minZoom:Ue=.5,maxZoom:Je=2,translateExtent:de=hy,preventScrolling:ue=!0,nodeExtent:ye,defaultMarkerColor:Ve="#b1b1b7",zoomOnScroll:ee=!0,zoomOnPinch:me=!0,panOnScroll:he=!1,panOnScrollSpeed:Se=.5,panOnScrollMode:We=_i.Free,zoomOnDoubleClick:Xe=!0,panOnDrag:et=!0,onPaneClick:Te,onPaneMouseEnter:mt,onPaneMouseMove:Dt,onPaneMouseLeave:Nt,onPaneScroll:Ge,onPaneContextMenu:vt,children:Mt,onEdgeContextMenu:Bt,onEdgeDoubleClick:Jt,onEdgeMouseEnter:Et,onEdgeMouseMove:zt,onEdgeMouseLeave:$t,onEdgeUpdate:kt,onEdgeUpdateStart:te,onEdgeUpdateEnd:be,onReconnect:ve,onReconnectStart:Be,onReconnectEnd:ot,reconnectRadius:xt=10,edgeUpdaterRadius:re=10,onNodesChange:je,onEdgesChange:He,noDragClassName:ut="nodrag",noWheelClassName:dt="nowheel",noPanClassName:Ee="nopan",fitView:at=!1,fitViewOptions:le,connectOnClick:st=!0,attributionPosition:ct,proOptions:yt,defaultEdgeOptions:oe,elevateNodesOnSelect:Ze=!0,elevateEdgesOnSelect:Ke=!1,disableKeyboardA11y:ft=!1,autoPanOnConnect:Qe=!0,autoPanOnNodeDrag:pt=!0,connectionRadius:ke=20,isValidConnection:Pe,onError:ht,style:K,id:ae,nodeDragThreshold:Ne,...qe},gt)=>{const St=ae||"1";return De.createElement("div",{...qe,style:{...K,...A8},ref:gt,className:pa(["react-flow",l]),"data-testid":"rf__wrapper",id:ae},De.createElement(ej,null,De.createElement(S8,{onInit:p,onMove:y,onMoveStart:g,onMoveEnd:v,onNodeClick:m,onEdgeClick:h,onNodeMouseEnter:A,onNodeMouseMove:O,onNodeMouseLeave:_,onNodeContextMenu:R,onNodeDoubleClick:D,nodeTypes:c,edgeTypes:f,connectionLineType:U,connectionLineStyle:M,connectionLineComponent:q,connectionLineContainerStyle:Y,selectionKeyCode:ie,selectionOnDrag:Z,selectionMode:fe,deleteKeyCode:J,multiSelectionKeyCode:se,panActivationKeyCode:Q,zoomActivationKeyCode:ne,onlyRenderVisibleElements:Me,selectNodesOnDrag:Ae,defaultViewport:At,translateExtent:de,minZoom:Ue,maxZoom:Je,preventScrolling:ue,zoomOnScroll:ee,zoomOnPinch:me,zoomOnDoubleClick:Xe,panOnScroll:he,panOnScrollSpeed:Se,panOnScrollMode:We,panOnDrag:et,onPaneClick:Te,onPaneMouseEnter:mt,onPaneMouseMove:Dt,onPaneMouseLeave:Nt,onPaneScroll:Ge,onPaneContextMenu:vt,onSelectionContextMenu:I,onSelectionStart:L,onSelectionEnd:$,onEdgeContextMenu:Bt,onEdgeDoubleClick:Jt,onEdgeMouseEnter:Et,onEdgeMouseMove:zt,onEdgeMouseLeave:$t,onReconnect:ve??kt,onReconnectStart:Be??te,onReconnectEnd:ot??be,reconnectRadius:xt??re,defaultMarkerColor:Ve,noDragClassName:ut,noWheelClassName:dt,noPanClassName:Ee,elevateEdgesOnSelect:Ke,rfId:St,disableKeyboardA11y:ft,nodeOrigin:Le,nodeExtent:ye}),De.createElement(b6,{nodes:e,edges:t,defaultNodes:r,defaultEdges:i,onConnect:S,onConnectStart:w,onConnectEnd:N,onClickConnectStart:E,onClickConnectEnd:C,nodesDraggable:it,nodesConnectable:$e,nodesFocusable:nt,edgesFocusable:wt,edgesUpdatable:Tt,elementsSelectable:Ct,elevateNodesOnSelect:Ze,minZoom:Ue,maxZoom:Je,nodeExtent:ye,onNodesChange:je,onEdgesChange:He,snapToGrid:we,snapGrid:Ie,connectionMode:T,translateExtent:de,connectOnClick:st,defaultEdgeOptions:oe,fitView:at,fitViewOptions:le,onNodesDelete:X,onEdgesDelete:H,onNodeDragStart:j,onNodeDrag:z,onNodeDragStop:P,onSelectionDrag:k,onSelectionDragStart:V,onSelectionDragStop:F,noPanClassName:Ee,nodeOrigin:Le,rfId:St,autoPanOnConnect:Qe,autoPanOnNodeDrag:pt,onError:ht,connectionRadius:ke,isValidConnection:Pe,nodeDragThreshold:Ne}),De.createElement(y6,{onSelectionChange:G}),Mt,De.createElement(P7,{proOptions:yt,position:ct}),De.createElement(N6,{rfId:St,disableKeyboardA11y:ft})))});tj.displayName="ReactFlow";const T8=e=>e.domNode?.querySelector(".react-flow__edgelabel-renderer");function M8({children:e}){const t=Ln(T8);return t?Ec.createPortal(e,t):null}const nj=({id:e,x:t,y:r,width:i,height:l,style:c,color:f,strokeColor:m,strokeWidth:h,className:p,borderRadius:y,shapeRendering:g,onClick:v,selected:S})=>{const{background:w,backgroundColor:N}=c||{},E=f||w||N;return De.createElement("rect",{className:pa(["react-flow__minimap-node",{selected:S},p]),x:t,y:r,rx:y,ry:y,width:i,height:l,fill:E,stroke:m,strokeWidth:h,shapeRendering:g,onClick:v?C=>v(C,e):void 0})};nj.displayName="MiniMapNode";var R8=u.memo(nj);const k8=e=>e.nodeOrigin,D8=e=>e.getNodes().filter(t=>!t.hidden&&t.width&&t.height),_p=e=>e instanceof Function?e:()=>e;function I8({nodeStrokeColor:e="transparent",nodeColor:t="#e2e2e2",nodeClassName:r="",nodeBorderRadius:i=5,nodeStrokeWidth:l=2,nodeComponent:c=R8,onClick:f}){const m=Ln(D8,ia),h=Ln(k8),p=_p(t),y=_p(e),g=_p(r),v=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return De.createElement(De.Fragment,null,m.map(S=>{const{x:w,y:N}=Ai(S,h).positionAbsolute;return De.createElement(c,{key:S.id,x:w,y:N,width:S.width,height:S.height,style:S.style,selected:S.selected,className:g(S),color:p(S),borderRadius:i,strokeColor:y(S),strokeWidth:l,shapeRendering:v,onClick:f,id:S.id})}))}var L8=u.memo(I8);const O8=200,z8=150,$8=e=>{const t=e.getNodes(),r={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:r,boundingRect:t.length>0?G7(Nf(t,e.nodeOrigin),r):r,rfId:e.rfId}},F8="react-flow__minimap-desc";function aj({style:e,className:t,nodeStrokeColor:r="transparent",nodeColor:i="#e2e2e2",nodeClassName:l="",nodeBorderRadius:c=5,nodeStrokeWidth:f=2,nodeComponent:m,maskColor:h="rgb(240, 240, 240, 0.6)",maskStrokeColor:p="none",maskStrokeWidth:y=1,position:g="bottom-right",onClick:v,onNodeClick:S,pannable:w=!1,zoomable:N=!1,ariaLabel:E="React Flow mini map",inversePan:C=!1,zoomStep:A=10,offsetScale:O=5}){const _=aa(),R=u.useRef(null),{boundingRect:D,viewBB:j,rfId:z}=Ln($8,ia),P=e?.width??O8,X=e?.height??z8,H=D.width/P,G=D.height/X,V=Math.max(H,G),k=V*P,F=V*X,I=O*V,L=D.x-(k-D.width)/2-I,$=D.y-(F-D.height)/2-I,T=k+I*2,U=F+I*2,M=`${F8}-${z}`,q=u.useRef(0);q.current=V,u.useEffect(()=>{if(R.current){const ie=is(R.current),Z=se=>{const{transform:ne,d3Selection:we,d3Zoom:Ie}=_.getState();if(se.sourceEvent.type!=="wheel"||!we||!Ie)return;const Me=-se.sourceEvent.deltaY*(se.sourceEvent.deltaMode===1?.05:se.sourceEvent.deltaMode?1:.002)*A,Ae=ne[2]*Math.pow(2,Me);Ie.scaleTo(we,Ae)},fe=se=>{const{transform:ne,d3Selection:we,d3Zoom:Ie,translateExtent:Me,width:Ae,height:it}=_.getState();if(se.sourceEvent.type!=="mousemove"||!we||!Ie)return;const $e=q.current*Math.max(1,ne[2])*(C?-1:1),nt={x:ne[0]-se.sourceEvent.movementX*$e,y:ne[1]-se.sourceEvent.movementY*$e},Le=[[0,0],[Ae,it]],wt=lr.translate(nt.x,nt.y).scale(ne[2]),Tt=Ie.constrain()(wt,Le,Me);Ie.transform(we,Tt)},Q=cE().on("zoom",w?fe:null).on("zoom.wheel",N?Z:null);return ie.call(Q),()=>{ie.on("zoom",null)}}},[w,N,C,A]);const Y=v?ie=>{const Z=ps(ie);v(ie,{x:Z[0],y:Z[1]})}:void 0,J=S?(ie,Z)=>{const fe=_.getState().nodeInternals.get(Z);S(ie,fe)}:void 0;return De.createElement(og,{position:g,style:e,className:pa(["react-flow__minimap",t]),"data-testid":"rf__minimap"},De.createElement("svg",{width:P,height:X,viewBox:`${L} ${$} ${T} ${U}`,role:"img","aria-labelledby":M,ref:R,onClick:Y},E&&De.createElement("title",{id:M},E),De.createElement(L8,{onClick:J,nodeColor:i,nodeStrokeColor:r,nodeBorderRadius:c,nodeClassName:l,nodeStrokeWidth:f,nodeComponent:m}),De.createElement("path",{className:"react-flow__minimap-mask",d:`M${L-I},${$-I}h${T+I*2}v${U+I*2}h${-T-I*2}z
        M${j.x},${j.y}h${j.width}v${j.height}h${-j.width}z`,fill:h,fillRule:"evenodd",stroke:p,strokeWidth:y,pointerEvents:"none"})))}aj.displayName="MiniMap";var B8=u.memo(aj);function U8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},De.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function q8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},De.createElement("path",{d:"M0 0h32v4.2H0z"}))}function H8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},De.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function P8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},De.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function V8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},De.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const Jo=({children:e,className:t,...r})=>De.createElement("button",{type:"button",className:pa(["react-flow__controls-button",t]),...r},e);Jo.displayName="ControlButton";const Y8=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),sj=({style:e,showZoom:t=!0,showFitView:r=!0,showInteractive:i=!0,fitViewOptions:l,onZoomIn:c,onZoomOut:f,onFitView:m,onInteractiveChange:h,className:p,children:y,position:g="bottom-left"})=>{const v=aa(),[S,w]=u.useState(!1),{isInteractive:N,minZoomReached:E,maxZoomReached:C}=Ln(Y8,ia),{zoomIn:A,zoomOut:O,fitView:_}=Ef();if(u.useEffect(()=>{w(!0)},[]),!S)return null;const R=()=>{A(),c?.()},D=()=>{O(),f?.()},j=()=>{_(l),m?.()},z=()=>{v.setState({nodesDraggable:!N,nodesConnectable:!N,elementsSelectable:!N}),h?.(!N)};return De.createElement(og,{className:pa(["react-flow__controls",p]),position:g,style:e,"data-testid":"rf__controls"},t&&De.createElement(De.Fragment,null,De.createElement(Jo,{onClick:R,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:C},De.createElement(U8,null)),De.createElement(Jo,{onClick:D,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:E},De.createElement(q8,null))),r&&De.createElement(Jo,{className:"react-flow__controls-fitview",onClick:j,title:"fit view","aria-label":"fit view"},De.createElement(H8,null)),i&&De.createElement(Jo,{className:"react-flow__controls-interactive",onClick:z,title:"toggle interactivity","aria-label":"toggle interactivity"},N?De.createElement(V8,null):De.createElement(P8,null)),y)};sj.displayName="Controls";var G8=u.memo(sj),bs;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(bs||(bs={}));function X8({color:e,dimensions:t,lineWidth:r}){return De.createElement("path",{stroke:e,strokeWidth:r,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`})}function K8({color:e,radius:t}){return De.createElement("circle",{cx:t,cy:t,r:t,fill:e})}const W8={[bs.Dots]:"#91919a",[bs.Lines]:"#eee",[bs.Cross]:"#e2e2e2"},Z8={[bs.Dots]:1,[bs.Lines]:1,[bs.Cross]:6},Q8=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function rj({id:e,variant:t=bs.Dots,gap:r=20,size:i,lineWidth:l=1,offset:c=2,color:f,style:m,className:h}){const p=u.useRef(null),{transform:y,patternId:g}=Ln(Q8,ia),v=f||W8[t],S=i||Z8[t],w=t===bs.Dots,N=t===bs.Cross,E=Array.isArray(r)?r:[r,r],C=[E[0]*y[2]||1,E[1]*y[2]||1],A=S*y[2],O=N?[A,A]:C,_=w?[A/c,A/c]:[O[0]/c,O[1]/c];return De.createElement("svg",{className:pa(["react-flow__background",h]),style:{...m,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:p,"data-testid":"rf__background"},De.createElement("pattern",{id:g+e,x:y[0]%C[0],y:y[1]%C[1],width:C[0],height:C[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${_[0]},-${_[1]})`},w?De.createElement(K8,{color:v,radius:A/c}):De.createElement(X8,{dimensions:O,color:v,lineWidth:l})),De.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${g+e})`}))}rj.displayName="Background";var J8=u.memo(rj);const ez=420,tz=520,nz=16,id=(e,t,r)=>Math.min(Math.max(e,t),r),Ew=e=>e?.type?.name||e?.typeName||"Entity";function az({position:e,cluster:t,onClose:r,onAddToBoard:i,onReturnToGroup:l,onSetTargetEntity:c,onOpenEntityInfo:f,releasedEntityIds:m=[]}){const{label:h,relationshipType:p,entities:y=[],placedEntityIds:g=[],sourceId:v}=t||{},[S,w]=u.useState(null),[N,E]=u.useState(null),[C,A]=u.useState({x:e?.x??100,y:e?.y??100}),O=u.useRef(null),_=u.useRef(null),R=u.useCallback(()=>{const $=S?.parentElement;if($){const T=$.getBoundingClientRect();return{left:T.left,top:T.top,width:T.width,height:T.height}}return{left:0,top:0,width:window.innerWidth,height:window.innerHeight}},[S]),D=u.useMemo(()=>new Set((Array.isArray(g)?g:[]).map(String)),[g]),j=u.useMemo(()=>new Set((Array.isArray(m)?m:[]).map(String)),[m]),z=u.useMemo(()=>Array.isArray(y)?y.filter($=>!j.has(String($.id))):[],[y,j]),P=z.length,X=u.useMemo(()=>{const $=R(),T=O.current?.offsetWidth??ez,U=O.current?.offsetHeight??Math.min($.height*.7,tz),M=nz;return{minX:M,minY:M,maxX:Math.max(M,$.width-T-M),maxY:Math.max(M,$.height-U-M),containerRect:$,entityCount:P}},[P,R]);u.useEffect(()=>{const $=document.querySelector(".react-flow__renderer")||document.querySelector(".react-flow")||document.body,T=document.createElement("div");return T.style.position=$===document.body?"fixed":"absolute",T.style.top="0",T.style.left="0",T.style.right="0",T.style.bottom="0",T.style.zIndex="2500",T.style.pointerEvents="auto",$.appendChild(T),w(T),()=>$.removeChild(T)},[]),u.useEffect(()=>{A({x:id(e?.x??100,X.minX,X.maxX),y:id(e?.y??100,X.minY,X.maxY)})},[X,e?.x,e?.y]);const H=u.useCallback($=>{if(!_.current)return;const{offsetX:T,offsetY:U,bounds:M,containerRect:q}=_.current,Y=id($.clientX-q.left-T,M.minX,M.maxX),J=id($.clientY-q.top-U,M.minY,M.maxY);A({x:Y,y:J})},[]),G=u.useCallback(()=>{_.current=null,window.removeEventListener("pointermove",H),window.removeEventListener("pointerup",G),window.removeEventListener("pointercancel",G)},[H]),V=$=>{if($.button!==0||$.target.closest("button")||$.target.closest(".cluster-popup-entity"))return;$.preventDefault(),$.stopPropagation();const T=X,U=T.containerRect||R(),M=$.clientX-U.left-(C?.x??T.minX),q=$.clientY-U.top-(C?.y??T.minY);_.current={offsetX:M,offsetY:q,bounds:T,containerRect:U},window.addEventListener("pointermove",H),window.addEventListener("pointerup",G),window.addEventListener("pointercancel",G)};u.useEffect(()=>()=>G(),[G]);const k=u.useCallback(()=>{G(),r?.()},[G,r]);u.useEffect(()=>{const $=T=>T.key==="Escape"&&k();return document.addEventListener("keydown",$),()=>document.removeEventListener("keydown",$)},[k]),u.useEffect(()=>{E(null)},[t?.id]);const F=u.useCallback(($,T)=>{T||E(U=>U===$?null:$)},[]),I=u.useCallback($=>{$&&(j.has(String($))||(i?.(t,$),E(null)))},[t,i,j]),L=u.useCallback($=>{$&&(l?.(t,$),E(null))},[t,l]);return S?h1.createPortal(a.jsx("div",{className:"cluster-popup-overlay",children:a.jsxs("div",{ref:O,className:"cluster-popup-panel",style:{top:`${C?.y??100}px`,left:`${C?.x??100}px`},children:[a.jsxs("div",{className:"cluster-popup-header",onPointerDown:V,children:[a.jsxs("div",{className:"cluster-popup-title",children:[a.jsx("div",{className:"cluster-popup-relationship",children:p||"Cluster"}),a.jsx("div",{className:"cluster-popup-label",children:h||"Entities"})]}),a.jsx("button",{onClick:k,className:"cluster-popup-close","aria-label":"Close cluster",children:a.jsx("span",{"aria-hidden":"true",children:""})})]}),a.jsx("div",{className:"cluster-popup-instructions",children:"Use the action icons to set a relationship target, open entity details, or add and manage entities on the board."}),a.jsx("div",{className:"cluster-popup-entities",children:z.length?z.map($=>{const T=String($.id),U=D.has(T)||j.has(T),M=N===T,q=v!=null&&T===String(v);return a.jsxs("div",{className:`cluster-popup-entity ${U?"is-placed":""} ${M?"is-selected":""}`,title:$.name||`Entity ${$.id}`,onClick:()=>F(T,U),children:[a.jsx("div",{className:"cluster-popup-entity-header",children:a.jsx("div",{className:"cluster-popup-entity-name",children:$.name||`Entity ${$.id}`})}),a.jsx("div",{className:"cluster-popup-entity-meta",title:Ew($),children:Ew($)}),a.jsxs("div",{className:"cluster-popup-entity-actions",role:"group","aria-label":"Entity actions",children:[U?a.jsx("button",{type:"button",className:"cluster-popup-entity-action",onClick:Y=>{Y.stopPropagation(),L($)},onPointerDown:Y=>Y.stopPropagation(),"aria-label":"Recall entity to cluster",title:"Recall to cluster",disabled:!l,children:a.jsx(Ll,{size:16,"aria-hidden":"true"})}):a.jsx("button",{type:"button",className:"cluster-popup-entity-action is-primary",onClick:Y=>{Y.stopPropagation(),I(T)},onPointerDown:Y=>Y.stopPropagation(),"aria-label":"Add entity to board",title:"Add to board",disabled:!i,children:a.jsx(Ya,{size:16,"aria-hidden":"true"})}),a.jsx("button",{type:"button",className:"cluster-popup-entity-action",onClick:Y=>{Y.stopPropagation(),f?.(T)},onPointerDown:Y=>Y.stopPropagation(),"aria-label":"Open entity details",title:"Open details",disabled:!f,children:a.jsx(b1,{size:16,"aria-hidden":"true"})}),!q&&a.jsx("button",{type:"button",className:"cluster-popup-entity-action",onClick:Y=>{Y.stopPropagation(),c?.(T)},onPointerDown:Y=>Y.stopPropagation(),"aria-label":"Use as relationship source",title:"Set as source",disabled:!c,children:a.jsx(Oy,{size:16,"aria-hidden":"true"})})]})]},$.id)}):a.jsx("div",{className:"cluster-popup-empty",children:"No entities in this cluster."})})]})}),S):null}function sz({id:e,data:t}){const[r,i]=u.useState(!1),[l,c]=u.useState({x:0,y:0}),[f,m]=u.useState([]);u.useEffect(()=>{const E=t?.containedIds||t?.data?.containedIds||[],C=t?.allNodes||t?.data?.allNodes||[];if(E.length&&C.length){const A=C.filter(O=>E.includes(O.id));m(A)}else m([])},[t]);const h=E=>{E.stopPropagation();const A=(document.querySelector(".react-flow__renderer")||document.querySelector(".react-flow"))?.getBoundingClientRect(),O=A?.width??window.innerWidth,_=A?.height??window.innerHeight,R=420,D=Math.min(_*.7,520),j=16,z=E.clientX-(A?.left??0),P=E.clientY-(A?.top??0);let X=z+j,H=P-D/2;const G=O-R-j,V=j;X>G&&(X=Math.max(V,z-R-j)),X=Math.max(V,Math.min(X,G));const k=_-D-j,F=j;H<F?H=F:H>k&&(H=k),c({x:X,y:H}),i(!0)},p=()=>i(!1),y=u.useMemo(()=>new Set((t?.placedEntityIds||[]).map(E=>String(E))),[t?.placedEntityIds]),g=f.length,v=t?.count??g+y.size,S=g,w=v?`contains ${S} of ${v}`:"contains 0 of 0",N=t?.relationshipType||t?.label||"Cluster";return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"cluster-node",onClick:h,children:[a.jsx(Wr,{id:"top",type:"target",position:Ut.Top,style:{width:12,height:12,background:"#fcd34d",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(120, 53, 15, 0.2)"}}),a.jsx("div",{className:"cluster-node__header",children:a.jsx("div",{className:"cluster-node__badge",children:S})}),a.jsx("div",{className:"cluster-node__label",children:N}),a.jsx("div",{className:"cluster-node__count",children:w}),a.jsx(Wr,{id:"bottom",type:"source",position:Ut.Bottom,style:{width:12,height:12,background:"#fcd34d",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(120, 53, 15, 0.2)"}})]}),r&&a.jsx(az,{position:l,cluster:{id:e,label:t?.label,entities:f,relationshipType:t?.relationshipType,sourceId:t?.sourceId,placedEntityIds:t?.placedEntityIds||[]},onClose:p,onAddToBoard:t?.onAddToBoard,onReturnToGroup:t?.onReturnToGroup,onSetTargetEntity:t?.onSetTargetEntity,onOpenEntityInfo:t?.onOpenEntityInfo,releasedEntityIds:t?.manuallyReleasedIds||[]})]})}function rz({data:e}){const t=!!e?.isCenter,r=e?.label||"Entity",i=e?.typeName||"Entity",l=e?.style||{},c=e?.entityId||e?.id,f=e?.imageUrl||$l(e?.entity),m=p=>{p?.preventDefault(),p?.stopPropagation(),!(!e?.onSetTarget||!c||t)&&e.onSetTarget(String(c))},h=p=>{p?.preventDefault(),p?.stopPropagation(),!(!e?.onOpenInfo||!c)&&e.onOpenInfo(String(c))};return a.jsxs("div",{className:`entity-node ${t?"entity-node--center":"entity-node--standard"}`,style:{...l},children:[a.jsx(Wr,{id:"top",type:"target",position:Ut.Top,style:{width:12,height:12,background:"#cbd5f5",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(15, 23, 42, 0.25)"}}),t&&a.jsx("span",{className:"entity-node__center-indicator"}),a.jsxs("div",{className:"entity-node__content",children:[a.jsxs("div",{className:"entity-node__row entity-node__row--title",children:[f?a.jsx("div",{className:"entity-node__avatar","aria-hidden":"true",children:a.jsx("img",{src:f,alt:"",loading:"lazy"})}):null,a.jsx("div",{className:"entity-node__label",title:r,children:r})]}),a.jsxs("div",{className:"entity-node__row entity-node__row--meta",children:[a.jsx("div",{className:`entity-node__type-pill ${t?"is-center":""}`,children:i}),a.jsxs("div",{className:"entity-node__actions","aria-hidden":!e?.onSetTarget&&!e?.onOpenInfo,children:[a.jsx("button",{type:"button",className:"entity-node__action",onClick:m,onPointerDown:p=>p.stopPropagation(),"aria-label":"Use as relationship source",disabled:t||!e?.onSetTarget,children:a.jsx(Oy,{size:16,strokeWidth:2.25,absoluteStrokeWidth:!0,"aria-hidden":"true"})}),a.jsx("button",{type:"button",className:"entity-node__action",onClick:h,onPointerDown:p=>p.stopPropagation(),"aria-label":"Open entity in new window",disabled:!e?.onOpenInfo,children:a.jsx(Ly,{size:16,strokeWidth:2.25,absoluteStrokeWidth:!0,"aria-hidden":"true"})})]})]})]}),a.jsx(Wr,{id:"bottom",type:"source",position:Ut.Bottom,style:{width:12,height:12,background:"#cbd5f5",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(15, 23, 42, 0.25)"}})]})}const jf=220,bg=160,Tc=220,ij=120,vg=40,lj=5,na="Related",iz=40,lz=120,Ho=Math.max(Tc,jf)+iz,oj=ij+lz,Yd=Tc+vg,py=/(part of|owned by|managed by|works for|reports to|child of|belongs to|member of|subsidiary of|division of|child)/i,jw=/(owns|manages|contains|has member|employs|parent of|parent|oversees|supervises|leads)/i,cj=/(owns|contains|parent|manages|supervises|leads|employs|has member|has child)/i,oz=/(child of|belongs to|part of|owned by|managed by|reports to|works for)/i,cz=/\s*\(linked to source\)/gi;function wa(e,t){if(typeof e=="string"){const r=e.replace(cz,"").trim();if(r)return r}return t}function Ed(e){if(!e)return!1;const t=e?.type;return t==="cluster"||t==="clusterNode"}function uz(e,t,r){if(!e||!t||!(r instanceof Map))return!1;let i=String(t);const l=String(e),c=new Set;for(;i&&!c.has(i);){if(c.add(i),i===l)return!0;const f=r.get(i)?.parentId;i=f!=null?String(f):null}return!1}function _w(e){if(!e)return null;const t=String(e.id??"");if(!t)return null;const r=wa(e?.name,`Entity ${t}`),i=e?.type?.name||e?.typeName||"Entity";return{...e,id:t,name:r,typeName:i}}function dz(e,t){if(!e)return{parentId:null,childId:null};const r=e?.fromEntityId!=null?String(e.fromEntityId):null,i=e?.toEntityId!=null?String(e.toEntityId):null,l=e?.relationshipType;let c=r&&i?r:null,f=r&&i?i:null;const m=l&&typeof l=="object"?l:null,h=(...A)=>{for(const O of A)if(O!=null&&O!=="")return O;return null},p=h(m?.from_label,m?.fromLabel,m?.from_name,m?.fromName),y=h(m?.to_label,m?.toLabel,m?.to_name,m?.toName),g=A=>typeof A=="string"&&py.test(A),v=A=>typeof A=="string"&&jw.test(A),S=g(p),w=g(y),N=v(p),E=v(y);w&&!S?(c=i,f=r):S&&!w?(c=r,f=i):N&&!E?(c=i,f=r):E&&!N&&(c=r,f=i);const C=(()=>{if(!l)return"";if(typeof l=="string")return l.toLowerCase();const A=l?.label||l?.name||l?.from_label||l?.to_label||"";return String(A).toLowerCase()})();if(r&&i&&C){const A=/(parent|owns|contains)/.test(C);if(/(child|belongs to|part of)/.test(C)&&!A){const _=c;c=f,f=_}}return!c&&!f&&r&&i&&C&&(py.test(C)?(c=i,f=r):jw.test(C)&&(c=r,f=i)),{parentId:c,childId:f}}function uj(e,t){if(!e)return null;const r=e?.from_entity??e?.fromEntityId??e?.from??e?.source??e?.sourceId??null,i=e?.to_entity??e?.toEntityId??e?.to??e?.target??e?.targetId??null,l=r!=null?String(r):null,c=i!=null?String(i):null;if(!l||!c||l===c)return null;const f=e?.id!=null&&e.id!==""?String(e.id):`edge-${l}-${c}`,m=e?.relationshipType??e?.type??e?.data?.relationshipType??null,h={fromEntityId:l,toEntityId:c,relationshipType:m},{parentId:p,childId:y}=dz(h),g=m&&typeof m=="object"?{id:m?.id??null,name:m?.name||m?.label||m?.from_label||m?.to_label||null,label:m?.label??null,from_label:m?.from_label??null,to_label:m?.to_label??null}:m,v=(()=>{if(!g)return e?.label||e?.typeName||e?.data?.typeName||na;if(typeof g=="string")return g||na;const{from_label:E,to_label:C,label:A,name:O}=g;return t!=null&&String(t)===l?E||A||O||na:t!=null&&String(t)===c?C||A||O||na:A||O||E||C||na})(),S=String(v||na).trim()||na,w=!g||typeof g=="string"?(typeof g=="string"?g:null)||na:g?.name||g?.label||g?.from_label||g?.to_label||na,N=g&&typeof g=="object"?g?.id??null:null;return{id:f,source:p??l,target:y??c,parentId:p,childId:y,label:S,typeName:w??na,typeId:N??null,fromEntityId:l,toEntityId:c,relationshipType:g??null,relationshipLabel:S,raw:e}}function fz(e,t,r=lj,i=null,l=1){const c=[],f=new Map,m=[],h=new Set,p=i!=null?String(i):null;if(!Array.isArray(t)||!t.length)return{clusters:c,suppressedNodes:f,edges:t||[]};const y=new Map((Array.isArray(e)?e:[]).map(j=>[String(j?.id??""),j])),g=new Map;p&&g.set(p,0),y.forEach((j,z)=>{const P=typeof j?.data?.level=="number"?j.data.level:typeof j?.level=="number"?j.level:null;P!=null&&Number.isFinite(P)&&g.set(z,P)});const v=new Map,S=new Map;t.forEach(j=>{if(!j)return;const z=j.parentId||j.source||null,P=j.childId||j.target||null;if(!z||!P)return;const X=String(z),H=String(P),G=y.get(X)||e.find(k=>String(k?.id??"")===X);!G||G.inCluster||(y.get(H)||e.find(k=>String(k?.id??"")===H))?.inCluster||(v.has(X)||v.set(X,new Set),v.get(X).add(H),S.has(H)||S.set(H,new Set),S.get(H).add(X))});const w=new Map;if(p){w.set(p,{parentId:null});const j=new Set,z=[p];for(;z.length;){const P=z.pop();if(!P||j.has(P))continue;j.add(P),w.has(P)||w.set(P,{parentId:null});const X=S.get(P);if(X&&X.size){const[H]=Array.from(X),G=H!=null?String(H):null;if(G){const V=w.get(P)||{};V.parentId?w.set(P,{...V}):w.set(P,{...V,parentId:G}),X.forEach(k=>{const F=k!=null?String(k):null;F&&(w.has(F)||w.set(F,{parentId:null}),j.has(F)||z.push(F))})}}}}const N=new Set(g.keys());if(p){N.add(p);const j=S.get(p);j&&j.forEach(z=>{g.has(z)||g.set(z,0),N.add(z)})}const E=Array.from(N),C=new Set(Array.from(N)),A=1e4;let O=0;for(;E.length&&O<A;){O+=1;const j=E.shift();if(!j)continue;C.has(j)||C.add(j);const z=g.get(j);if(z==null||!Number.isFinite(z))continue;const P=v.get(j);P&&P.forEach(X=>{if(C.has(X))return;const H=z+1,G=g.get(X);(G==null||H<G)&&(g.set(X,H),C.add(X),E.push(X))})}O>=A&&console.warn(`groupChildrenByRelationship: Reached maximum iteration limit (${A}), possible circular relationship detected`);const _=new Map;if(t.forEach(j=>{if(!j)return;const z=j.parentId||j.source||null,P=j.childId||j.target||null;if(!z||!P)return;const X=String(z),H=String(P);if(!X||!H||X===H)return;const G=y.get(X),V=y.get(H);if(G?.inCluster||V?.inCluster)return;const k=g.get(X)??0,F=g.get(H)??k+1;if(k>=l||F>l)return;const I=String(j.relationshipLabel||j.label||na).trim()||na,L=j.typeName&&String(j.typeName).trim()||(typeof j.relationshipType=="object"?String(j.relationshipType?.name||j.relationshipType?.label||j.relationshipType?.from_label||j.relationshipType?.to_label||"").trim():null)||null,$=j.typeId!=null?String(j.typeId):j.relationshipType&&typeof j.relationshipType=="object"&&j.relationshipType?.id!=null?String(j.relationshipType.id):null,T=L||$||"unknown-type",U=`${X}-${T}`;_.has(U)||_.set(U,{parentId:X,typeName:L,typeId:$,typeKey:T,relationshipLabel:I,childMap:new Map});const M=_.get(U);M.childMap.has(H)||M.childMap.set(H,[]),M.childMap.get(H).push(j)}),_.forEach(j=>{if(y.get(j.parentId)?.inCluster||e.find($=>String($?.id??"")===j.parentId)?.inCluster)return;const P=Array.from(j.childMap.keys()).filter($=>!y.get($)?.inCluster);if(P.length<r)return;const X=Nz(j.typeName||j.typeKey),H=`cluster-${j.parentId}-${X}`,G=g.get(j.parentId)??0,V=j.typeName||j.relationshipLabel||na,k=P.filter($=>!y.get($)?.inCluster);if(!k.length)return;const F={id:H,parentId:j.parentId,relationshipType:V,typeName:j.typeName,typeId:j.typeId,containedIds:[...k],label:"",count:0,parentLevel:G},I=p&&F.containedIds.length?F.containedIds.filter($=>uz($,p,w)):[],L=new Set(I);I.length&&(F.containedIds=F.containedIds.filter($=>!L.has($)),I.forEach($=>{const T=y.get($)||null;T&&(T.isExpandedProtected=!0,T.inCluster&&(T.inCluster=!1));const U=e.find(M=>String(M?.id??"")===$);U&&U!==T&&(U.isExpandedProtected=!0,U.inCluster&&(U.inCluster=!1))})),F.containedIds.length&&(F.containedIds.forEach($=>{const T=e.find(U=>String(U?.id??"")===$)||y.get($);T&&(T.inCluster=!0)}),F.count=F.containedIds.length,F.label=`${V} (${F.count})`,c.push(F),k.forEach($=>{if(L.has($))return;const T=y.get($)||e.find(M=>String(M?.id??"")===$)||null;if(T?.isExpandedProtected){T.inCluster=!1;return}f.set($,{clusterId:F.id,parentId:j.parentId,relationshipType:V,typeName:j.typeName,typeId:j.typeId,entity:T}),T&&(T.inCluster=!0),(j.childMap.get($)||[]).forEach(M=>h.add(M.id))}),m.push({id:`edge-${j.parentId}-${F.id}`,source:j.parentId,target:F.id,label:F.label,parentId:j.parentId,childId:F.id,relationshipLabel:V,relationshipType:V,typeName:j.typeName,typeId:j.typeId,isClusterEdge:!0}))}),!c.length)return{clusters:c,suppressedNodes:f,edges:t};const D=[...t.filter(j=>{if(!j||h.has(j.id))return!1;const z=String(j.target??j.childId??"");if(z&&f.has(z))return!1;const P=String(j.source??j.parentId??"");return!(P&&f.has(P))}),...m];return{clusters:c,suppressedNodes:f,edges:D}}function mz(e,{isCenter:t=!1}={}){const r=String(e.id),i=wa(e?.name,`Entity ${r}`),l=e?.typeName||"Entity",c=!!e?.isExpandedProtected,f=$l(e);return{id:r,type:"entity",width:Tc,height:ij,isExpandedProtected:c,position:{x:0,y:0},data:{label:i,typeName:l,entityId:r,isCenter:t,isExpandedProtected:c,imageUrl:f}}}function hz(e,t){const r=e.relationshipType||na,i=e.label||r,l=e.count??(Array.isArray(e.containedIds)?e.containedIds.length:0),c=typeof e.parentLevel=="number"&&Number.isFinite(e.parentLevel)?e.parentLevel:null;return{id:e.id,type:"cluster",width:jf,height:bg,position:{x:0,y:0},data:{label:i,relationshipType:r,containedIds:e.containedIds,count:l,sourceId:e.parentId,placedEntityIds:[],allNodes:t,parentLevel:c}}}function pz(e,t,r){const i=r!=null?String(r):null;t.forEach(l=>{if(!l)return;const c=String(l.id);e.has(c)||e.set(c,c===i?0:1)}),i&&e.set(i,0),e.forEach((l,c)=>{(typeof l!="number"||!Number.isFinite(l))&&e.set(c,c===i?0:1)})}function yz(e,t){let r=1/0;t.forEach(m=>{if(!m)return;const h=e.get(m.id);typeof h=="number"&&Number.isFinite(h)&&h<r&&(r=h)}),Number.isFinite(r)||(r=0);const i=new Map,l=new Map;t.forEach(m=>{if(!m)return;const p=(e.get(m.id)??0)-r;l.set(m.id,p),i.has(p)||i.set(p,[]),i.get(p).push(m)});const c=Array.from(i.keys()).sort((m,h)=>m-h),f=new Map;return c.forEach(m=>{const h=i.get(m)||[];h.sort((p,y)=>{const g=p?.data?.label||p.id,v=y?.data?.label||y.id;return g.localeCompare(v)}),f.set(m,h)}),{groups:f,visualLevels:l}}function yy(e){if(!e)return"";const t=typeof e?.data?.label=="string"?e.data.label.trim():"";if(t)return t;const r=typeof e?.name=="string"?e.name.trim():"";return r||(e?.id!=null?String(e.id):"")}function dj(e,t){const r=yy(e),i=yy(t);return r.localeCompare(i)}function gz(e,t,r,i={}){const{centerId:l=null}=i,c=l!=null?String(l):null,f=new Map;e.forEach(h=>{if(!h)return;const p=h?.parentId??h?.data?.parentId??h?.source??h?.data?.source??null,y=h?.childId??h?.data?.childId??h?.target??h?.data?.target??null,g=p!=null?String(p):null,v=y!=null?String(y):null;if(!g||!v||g===v)return;const S=h?.label??h?.relationshipLabel??"",w=S||fj(h),N=S||Sz(h),E=ar(w)||ar(N)||ar(S),C=!!w&&(xz(w)||cj.test(w)),A={parentId:g,relationshipKey:E,relationshipName:N,indicatesParental:C};f.has(v)||f.set(v,[]),f.get(v).push(A)});const m=new Map;return f.forEach((h,p)=>{let y=null,g=1/0,v="",S=null,w="",N="";h.forEach(E=>{if(!E)return;const C=E.parentId,A=t.get(C);if(typeof A!="number"||!Number.isFinite(A))return;const O=r.get(C),_=yy(O);if(y==null||A<g){y=C,g=A,v=_,S=E,w=ar(E?.relationshipKey),N=E?.relationshipName??"";return}if(A===g){const R=!!S?.indicatesParental;if(!!E?.indicatesParental&&!R){y=C,v=_,S=E,w=ar(E?.relationshipKey),N=E?.relationshipName??"";return}_.localeCompare(v)<0&&(y=C,v=_,S=E,w=ar(E?.relationshipKey),N=E?.relationshipName??"")}}),y!=null&&m.set(p,{parentId:y,relationshipKey:w,relationshipName:N,indicatesParental:!!S?.indicatesParental})}),r.forEach((h,p)=>{if(!h)return;const y=String(p);if(!y||m.has(y)||!Ed(h))return;const g=[h.parentId,h.data?.parentId,h.data?.sourceId,h.data?.source].map(w=>w!=null?String(w):null).filter(Boolean);let v=g.find(w=>r.has(w));!v&&g.length&&(v=g[0]);const S=t.get(y)??1/0;if(!v){const w=Array.isArray(h?.data?.containedIds)?h.data.containedIds.map(N=>N!=null?String(N):null).filter(N=>{if(!N||!r.has(N))return!1;const E=t.get(N);return typeof E=="number"&&Number.isFinite(E)&&E<S}):[];w.length&&(w.sort((N,E)=>{const C=t.get(N)??1/0,A=t.get(E)??1/0;return C===A?N.localeCompare(E):C-A}),v=w[0])}if(!v&&c&&r.has(c)&&(v=c===y?null:c),v){const w=[typeof h?.data?.relationshipType=="string"?h.data.relationshipType:null,typeof h?.relationshipType=="string"?h.relationshipType:null].filter(C=>typeof C=="string"&&C.trim()),N=w.length?w[0].trim():"",E=ar(N);m.set(y,{parentId:v,relationshipKey:E,relationshipName:N})}}),m}function gy(e,t){if(!e||!t)return null;const r=e.get(t);return r?typeof r=="string"?{parentId:r,relationshipKey:"",relationshipName:""}:typeof r=="object"?{parentId:r?.parentId!=null?String(r.parentId):r?.sourceId!=null?String(r.sourceId):null,relationshipKey:ar(r?.relationshipKey),relationshipName:typeof r?.relationshipName=="string"?r.relationshipName:""}:null:null}function bz(e){return(t,r)=>{if(!t&&!r)return 0;if(!t)return 1;if(!r)return-1;const i=gy(e,t.id),l=gy(e,r.id),c=i?.relationshipKey||"",f=l?.relationshipKey||"";if(c&&f){const m=c.localeCompare(f);if(m!==0)return m}else{if(c)return-1;if(f)return 1}return dj(t,r)}}function vz(e,t=new Map){const r=new Map;let i=1/0;const l=0,c=Array.from(e.keys()).sort((p,y)=>p-y);let f=0;c.forEach(p=>{const y=e.get(p)||[];if(!y.length)return;const g=new Map,v=[];y.forEach(C=>{const A=gy(t,C.id),O=A?.parentId??null,_=O?r.get(O):null;if(O&&_){const R=A?.relationshipKey||ar(A?.relationshipName)||"no-relationship";g.has(O)||g.set(O,{anchorX:_.x,relationshipGroups:new Map});const D=g.get(O);D.relationshipGroups.has(R)||D.relationshipGroups.set(R,[]),D.relationshipGroups.get(R).push(C)}else v.push(C)});const S=bz(t);g.forEach(C=>{C.relationshipGroups.forEach((A,O)=>{A.sort(S)})});const w=l+p*oj;let N=-1/0;if(Array.from(g.keys()).sort((C,A)=>{const O=g.get(C),_=g.get(A);return(O?.anchorX??0)-(_?.anchorX??0)}).forEach(C=>{const A=g.get(C);if(!A)return;const O=Array.from(A.relationshipGroups.keys()).sort(),_=[];if(O.forEach(j=>{const z=A.relationshipGroups.get(j)||[];_.push(...z)}),_.length===0)return;const R=(_.length-1)*Ho,D=A.anchorX-R/2;_.forEach((j,z)=>{const P=D+z*Ho;r.set(j.id,{x:P,y:w,level:p,levelIndex:f}),f+=1,P<i&&(i=P),P>N&&(N=P)})}),v.length){v.sort(dj);const C=(v.length-1)*Ho,A=N!==-1/0?N+Ho:-C/2;v.forEach((O,_)=>{const R=A+_*Ho;r.set(O.id,{x:R,y:w,level:p,levelIndex:f}),f+=1,R<i&&(i=R),R>N&&(N=R)})}});const m=Number.isFinite(i)&&i<0?-i:0,h=new Map;return m>0?r.forEach((p,y)=>{h.set(y,{x:p.x+m,y:p.y,level:p.level,levelIndex:p.levelIndex})}):r.forEach((p,y)=>{h.set(y,p)}),h}function xz(e){return e?py.test(String(e)):!1}function fj(e){if(!e)return"";const t=e?.data?.relationshipType??e?.relationshipType??e?.data?.relationshipLabel??e?.relationshipLabel??e?.data?.label??e?.label??e?.data?.typeName??e?.typeName??"";if(typeof t=="string")return t.toLowerCase().trim();if(t&&typeof t=="object"){const r=t?.label??t?.name??t?.from_label??t?.to_label??"";if(typeof r=="string")return r.toLowerCase().trim()}return""}function Sz(e){if(!e)return"";const t=e?.data?.relationshipType??e?.relationshipType??e?.data?.relationshipLabel??e?.relationshipLabel??e?.data?.label??e?.label??e?.data?.typeName??e?.typeName??"";if(typeof t=="string")return t.trim();if(t&&typeof t=="object"){const r=t?.label??t?.name??t?.from_label??t?.to_label??"";if(typeof r=="string")return r.trim()}return""}function ar(e){if(typeof e=="string"){const t=e.trim();return t?t.toLowerCase():""}return""}function wz(e,t){const r=new Map;if(!e)return r;const i=String(e);r.set(i,0);const l=new Map,c=new Map;t.forEach(y=>{if(!y)return;const g=y?.parentId??y?.data?.parentId??y?.source??null,v=y?.childId??y?.data?.childId??y?.target??null,S=g!=null?String(g):null,w=v!=null?String(v):null;!S||!w||S===w||(l.has(S)||l.set(S,new Set),l.get(S).add(w),c.has(w)||c.set(w,new Set),c.get(w).add(S))});const f=[i],m=new Set([i]),h=1e4;let p=0;for(;f.length&&p<h;){p+=1;const y=f.shift();if(!y)continue;m.has(y)||m.add(y);const g=r.get(y)??0,v=c.get(y);v&&v.forEach(w=>{const N=w!=null?String(w):null;if(!N||m.has(N))return;const E=g-1,C=r.get(N);(C==null||E<C)&&(r.set(N,E),m.add(N),f.push(N))});const S=l.get(y);S&&S.forEach(w=>{const N=w!=null?String(w):null;if(!N||m.has(N))return;const E=g+1,C=r.get(N);(C==null||E<C)&&(r.set(N,E),m.add(N),f.push(N))})}return p>=h&&console.warn(`buildLevelsFromEdges: Reached maximum iteration limit (${h}), possible circular relationship detected`),r}function ec(e,t,r){const i=Array.isArray(e)?e.map(_=>({..._,id:String(_.id),data:{..._.data}})):[];if(!i.length)return e;const l=i.filter(_=>Ed(_)),c=i.filter(_=>!Ed(_)),f=c.filter(_=>!_.inCluster),m=f.length?f:c,h=new Map;m.forEach(_=>h.set(_.id,_)),l.forEach(_=>h.set(_.id,_));const p=Array.from(h.values());if(!p.length)return e;const y=r!=null?String(r):p[0]?.id??null;if(!y)return e;const g=new Set(p.map(_=>_.id)),S=(Array.isArray(t)?t.map((_,R)=>{if(!_)return null;const D=_?.source!=null?String(_.source):"",j=_?.target!=null?String(_.target):"";if(!D||!j||D===j)return null;const z=_?.data?.relationshipType||_?.data?.typeName||_?.label||"",P=_?.data?.parentId??_?.parentId??_?.data?.parent??null,X=_?.data?.childId??_?.childId??null,H=P!=null?String(P):null,G=X!=null?String(X):null;return{id:_?.id!=null?String(_.id):`edge-${R}`,source:D,target:j,label:_?.label||z||na,data:{relationshipType:z||na,parentId:H,childId:G},parentId:H,childId:G}}).filter(Boolean):[]).map(_=>{if(!_)return null;const R={..._,data:{..._.data||{}}},D=R.source||"",j=R.target||"";if(!D||!j||D===j)return null;let z=R.parentId!=null?String(R.parentId):null,P=R.childId!=null?String(R.childId):null;if(!z||!P){let X=D,H=j;const G=fj(R),V=G&&cj.test(G);if(G&&oz.test(G)&&!V){const F=X;X=H,H=F}z=z??X,P=P??H}return(!z||!P||z===P)&&(z=D,P=j),R.source=z,R.target=P,R.parentId=z,R.childId=P,R.data={...R.data,parentId:z,childId:P},R}).filter(Boolean).filter(_=>g.has(_.source)&&g.has(_.target)),w=wz(y,S);pz(w,p,y),p.forEach(_=>{if(!_||!Ed(_))return;const R=_.parentId??_.data?.parentId??_.data?.sourceId??_.data?.source??null;if(!R)return;const D=String(R),j=w.get(D)??0;w.set(_.id,j+1)});const{groups:N,visualLevels:E}=yz(w,p),C=new Map(p.map(_=>[_.id,_])),A=gz(S,w,C,{centerId:y}),O=vz(N,A);return i.map(_=>{const R=w.get(_.id)??0,D=E.get(_.id)??R,j={x:_?.position?.x??0,y:D*oj,level:D,levelIndex:_?.data?.levelIndex??0},z=O.get(_.id)||j;return{..._,position:{x:z.x,y:z.y},data:{..._.data,level:R,visualLevel:z.level??D,levelIndex:z.levelIndex}}})}function Nz(e){return String(e??"group").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function Ez(e){return Array.from(e.values()).map(t=>({id:t.id,name:t.name,typeName:t.typeName,isExpandedProtected:!!t.isExpandedProtected}))}function jz(e){const t=new Map;return Array.isArray(e)&&e.forEach(r=>{if(!r||r.isClusterEdge||r?.data?.isClusterEdge||r?.data?.isClusterChildEdge)return;const i=r?.parentId??r?.source??null,l=r?.childId??r?.target??null;if(i==null||l==null)return;const c=String(i),f=String(l);f&&(t.has(f)||t.set(f,new Set),t.get(f).add(c))}),t}function _z({centerId:e=null,parentLookup:t=new Map,suppressedIds:r=new Set,candidateIds:i=new Set,alwaysIncludeIds:l=new Set}){const c=new Map,f=e!=null?String(e):null,m=new Set(l instanceof Set?Array.from(l).map(String):Array.isArray(l)?l.map(p=>String(p)):[]);function h(p,y=new Set){const g=String(p);if(!g)return!1;if(c.has(g))return c.get(g);if(r.has(g)||!i.has(g)&&!m.has(g))return c.set(g,!1),!1;if(f&&g===f||m.has(g))return c.set(g,!0),!0;const v=t.get(g);if(!v||v.size===0)return c.set(g,!0),!0;if(y.has(g))return c.set(g,!1),!1;y.add(g);let S=!1;for(const w of v){const N=String(w);if(N&&!r.has(N)){if(!i.has(N)&&!m.has(N)){S=!0;continue}if(m.has(N)){S=!0;continue}h(N,y)&&(S=!0)}}return y.delete(g),S?(c.set(g,!0),!0):(c.set(g,!1),!1)}return h}function Cz(e,t,r=lj,i={}){const l=t!=null?String(t):null,c=Array.isArray(e?.nodes)?e.nodes:[],f=Array.isArray(e?.edges)?e.edges:[],m=new Map;if(c.forEach(Z=>{const fe=_w(Z);fe&&m.set(fe.id,fe)}),!l)return{nodes:[],edges:[],suppressedNodes:new Map,clusters:[]};if(!m.has(l)){const Z=_w(c[0]);Z?m.set(l,{...Z,id:l}):m.set(l,{id:l,name:`Entity ${l}`,typeName:"Entity"})}const h=f.map(Z=>uj(Z,l)).filter(Boolean),p=Array.from(m.values()),y=i?.alwaysIncludeIds,g=new Set(y instanceof Set?Array.from(y).map(String):Array.isArray(y)?y.map(Z=>String(Z)):y&&typeof y=="object"?Object.values(y).map(Z=>String(Z)):[]),{clusters:v,suppressedNodes:S,edges:w}=fz(p,h,r,l),N=Ez(m),E=S instanceof Map?S:new Map(Object.entries(S||{}).map(([Z,fe])=>[String(Z),fe])),C=new Map;E.forEach((Z,fe)=>{const Q=String(fe),se=Z?.clusterId!=null?String(Z.clusterId):null,ne=Z?.parentId!=null?String(Z.parentId):null,we=Z?.relationshipType||na,Ie=Z?.entity||m.get(Q)||null;C.set(Q,{clusterId:se,parentId:ne,relationshipType:we,entity:Ie?{...Ie,id:Q,name:wa(Ie?.name,`Entity ${Q}`),typeName:Ie?.typeName||Ie?.type?.name||"Entity",isExpandedProtected:!!Ie?.isExpandedProtected}:null})}),g.forEach(Z=>{C.delete(String(Z))});const A=new Set(Array.from(C.keys())),O=(Array.isArray(v)?v:[]).map(Z=>hz(Z,N)),R=p.map(Z=>mz(Z,{isCenter:Z.id===l})).filter(Z=>!A.has(String(Z.id))),D=new Set(R.map(Z=>String(Z.id)));l!=null&&D.add(String(l)),g.forEach(Z=>{D.add(String(Z))});const j=jz(h),z=_z({centerId:l,parentLookup:j,suppressedIds:A,candidateIds:D,alwaysIncludeIds:g}),P=R.filter(Z=>z(String(Z.id))),X=new Set(P.map(Z=>String(Z.id))),G=[...P.filter(Z=>{const fe=String(Z.id);if(!fe)return!1;const Q=j.get(fe);if(!Q||!Q.size)return!0;for(const se of Q){const ne=se!=null?String(se):"";if(ne&&X.has(ne))return!0}return!1}),...O],V=new Set(G.map(Z=>String(Z.id))),k=h.filter(Z=>{if(!Z)return!1;const fe=Z.parentId!=null?Z.parentId:Z.source!=null?Z.source:null;if(fe==null)return!0;const Q=String(fe);return!(!V.has(Q)||A.has(Q))}),I=(Array.isArray(w)&&w.length?w:k).filter(Z=>{if(!Z)return!1;if(Z.isClusterEdge)return!0;const fe=Z.parentId!=null?Z.parentId:Z.source!=null?Z.source:null;if(fe!=null){const Ie=String(fe);if(!V.has(Ie)||A.has(Ie))return!1}const Q=Z.source!=null?Z.source:Z.parentId!=null?Z.parentId:null,se=Z.target!=null?Z.target:Z.childId!=null?Z.childId:null,ne=Q!=null?String(Q):"",we=se!=null?String(se):"";return!(ne&&A.has(ne)||we&&A.has(we))}),L=new Set;I.forEach(Z=>{const fe=Z.source!=null?String(Z.source):Z.parentId!=null?String(Z.parentId):null,Q=Z.target!=null?String(Z.target):Z.childId!=null?String(Z.childId):null;fe&&L.add(fe),Q&&L.add(Q)}),l&&L.add(l);const $=G.filter(Z=>L.has(String(Z.id))),T=new Set(l!=null?[String(l)]:[]);let U=!0;for(;U;){U=!1;for(const Z of I){if(!Z)continue;const fe=Z.parentId!=null?Z.parentId:Z.source!=null?Z.source:null,Q=Z.childId!=null?Z.childId:Z.target!=null?Z.target:null,se=fe!=null?String(fe):"",ne=Q!=null?String(Q):"",we=!!se,Ie=!!ne;we&&T.has(se)&&Ie&&!T.has(ne)&&(T.add(ne),U=!0),Ie&&T.has(ne)&&we&&!T.has(se)&&(T.add(se),U=!0)}}const M=$.filter(Z=>T.has(String(Z.id))),Y=I.filter(Z=>{const fe=Z.parentId!=null?String(Z.parentId):String(Z.source??""),Q=Z.childId!=null?String(Z.childId):String(Z.target??"");return fe&&Q&&T.has(fe)&&T.has(Q)}).map(Z=>({id:Z.id,source:Z.source,target:Z.target,type:"smoothstep",animated:!Z.isClusterEdge,label:Z.label||Z.relationshipLabel||na,data:{relationshipType:Z.relationshipLabel||Z.label||na,parentId:Z.parentId??null,childId:Z.childId??null,isClusterEdge:!!Z.isClusterEdge},parentId:Z.parentId??null,childId:Z.childId??null,sourceHandle:"bottom",targetHandle:"top"})),J=ec(M,Y,l),ie=J.filter(Z=>Z.type==="cluster");return{nodes:J,edges:Y,suppressedNodes:C,clusters:ie}}function Az(e,t,r=[]){if(!e||!t)return null;const i=e?.position?.x??0,l=e?.position?.y??0,c=e?.width??jf,f=e?.height??bg,m=String(t.id),h=$l(t),p=Array.isArray(r)?r.map(C=>String(C)):[],y=p.indexOf(m),g=Math.max(p.length-1,0)*Yd,v=i+c/2,S=v-g/2,w=Tc,N=y>=0?S+y*Yd-w/2:v-w/2,E=l+f+vg;return{id:m,type:"entity",position:{x:N,y:E},data:{label:wa(t.name,`Entity ${m}`),typeName:t?.type?.name||t?.typeName||"Entity",isCenter:!1,isAdHoc:!0,entityId:m,imageUrl:h}}}function ld(e,t,r=[]){if(!t||!Array.isArray(r)||r.length===0)return e;const i=r.map(N=>String(N)),l=new Map(i.map((N,E)=>[N,E])),c=t?.position?.x??0,f=t?.position?.y??0,m=t?.width??jf,h=t?.height??bg,p=f+h+vg,y=(i.length-1)*Yd,v=c+m/2-y/2;let S=!1;const w=e.map(N=>{if(N.type!=="entity"||!N.data?.isAdHoc)return N;const E=l.get(String(N.id));if(E==null)return N;const C=N?.width??Tc,A=v+E*Yd-C/2,O=p;return N?.position?.x===A&&N?.position?.y===O?N:(S=!0,{...N,position:{x:A,y:O}})});return S?w:e}function Tz(e,t){return uj(e,t)}function mj({onRefocus:e,onZoomToFit:t,onAutoArrange:r,depth:i,onIncreaseDepth:l,onDecreaseDepth:c,style:f}){return a.jsxs("div",{className:`relationship-toolbar ${f?.compact?"relationship-toolbar--compact":""}`,role:"toolbar","aria-label":"Relationship viewer controls",style:f,children:[a.jsxs("div",{className:"relationship-toolbar__actions",children:[a.jsxs("button",{type:"button",className:"relationship-toolbar__button",onClick:e,children:[a.jsx(Oy,{"aria-hidden":"true"}),a.jsx("span",{children:"Refocus"})]}),a.jsxs("button",{type:"button",className:"relationship-toolbar__button",onClick:t,children:[a.jsx(UT,{"aria-hidden":"true"}),a.jsx("span",{children:"Zoom to fit"})]}),a.jsxs("button",{type:"button",className:"relationship-toolbar__button",onClick:r,children:[a.jsx(MM,{"aria-hidden":"true"}),a.jsx("span",{children:"Auto arrange"})]})]}),a.jsxs("div",{className:"relationship-toolbar__levels","aria-label":"Relationship depth controls",children:[a.jsx("span",{className:"relationship-toolbar__levels-label",children:"Levels"}),a.jsxs("div",{className:"relationship-toolbar__levels-controls",children:[a.jsx("button",{type:"button",className:"relationship-toolbar__levels-button",onClick:l,disabled:i>=3,"aria-label":"Increase relationship depth",children:a.jsx(Ya,{"aria-hidden":"true"})}),a.jsx("span",{className:"relationship-toolbar__levels-value","aria-live":"polite",children:i}),a.jsx("button",{type:"button",className:"relationship-toolbar__levels-button",onClick:c,disabled:i<=1,"aria-label":"Decrease relationship depth",children:a.jsx(w1,{"aria-hidden":"true"})})]})]})]})}mj.propTypes={onRefocus:ln.func.isRequired,onZoomToFit:ln.func.isRequired,onAutoArrange:ln.func.isRequired,depth:ln.number.isRequired,onIncreaseDepth:ln.func.isRequired,onDecreaseDepth:ln.func.isRequired};function Mz({id:e,source:t,target:r,data:i,markerEnd:l,style:c,selected:f}){const{getNode:m}=Ef(),h=m(t),p=m(r);if(!h||!p)return null;const y=h.width??200,g=h.height??80,v=p.width??200;p.height;const S=h.positionAbsolute?.x??h.position?.x??0,w=h.positionAbsolute?.y??h.position?.y??0,N=p.positionAbsolute?.x??p.position?.x??0,E=p.positionAbsolute?.y??p.position?.y??0,C=S+y/2,A=w+g,O=N+v/2,_=E,[R]=Pd({sourceX:C,sourceY:A,sourcePosition:"bottom",targetX:O,targetY:_,targetPosition:"top"}),D=-18,j=O,z=_+D,P=i?.relationshipType||i?.label||"Related";return a.jsxs(a.Fragment,{children:[a.jsx(Bl,{id:e,path:R,markerEnd:l,style:c,selected:f}),a.jsx(M8,{children:a.jsx("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${j}px,${z}px)`,fontSize:12,pointerEvents:"all",background:"rgba(255, 255, 255, 0.9)",padding:"2px 6px",borderRadius:"4px",border:"1px solid #e2e8f0",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.1)",whiteSpace:"nowrap",zIndex:10},className:"nodrag nopan",children:P})})]})}const Rz={cluster:sz,entity:rz},kz={smoothstep:Mz},Dz="Related";function Iz(e){const t=new Map;return Array.isArray(e)&&e.forEach(r=>{if(!r)return;const i=r?.parentId!=null?r.parentId:r?.source!=null?r.source:null,l=r?.childId!=null?r.childId:r?.target!=null?r.target:null;if(i==null||l==null)return;const c=String(i),f=String(l);!c||!f||c===f||(t.has(c)||t.set(c,[]),t.get(c).push(r))}),t}function Lz(e,t){const r=new Map;if(!e)return r;const i=String(e);if(!i)return r;r.set(i,0);const l=[i],c=new Set([i]),f=1e4;let m=0;for(;l.length&&m<f;){m+=1;const h=l.shift();if(!h)continue;const p=r.get(h)??0,y=t.get(h);!y||!y.length||y.forEach(g=>{if(!g)return;const v=g?.childId!=null?g.childId:g?.target!=null?g.target:null,S=v!=null?String(v):null;!S||c.has(S)||S===h||(r.set(S,p+1),c.add(S),l.push(S))})}return m>=f&&console.warn(`computeDepthLookup: Reached maximum iteration limit (${f}), possible circular relationship detected`),r}function Oz(e){const t=new Map;return Array.isArray(e)&&e.forEach(r=>{if(!r)return;const i=r?.parentId!=null?r.parentId:r?.source!=null?r.source:null,l=r?.childId!=null?r.childId:r?.target!=null?r.target:null;if(i==null||l==null)return;const c=String(i),f=String(l);!c||!f||c===f||(t.has(f)||t.set(f,new Set),t.get(f).add(c))}),t}function zz(e,t,r=null){const i=e!=null?String(e):null;if(!i)return new Set;const l=Oz(t);if(!l.size)return new Set;const c=new Set,f=[],m=new Map,h=l.get(i);for(h&&h.size&&h.forEach(p=>{const y=String(p);y&&(c.add(y),f.push(y),m.set(y,1))});f.length;){const p=f.shift();if(!p)continue;const y=m.get(p)??1;if(r!=null&&y>=r)continue;const g=l.get(p);!g||!g.size||g.forEach(v=>{const S=String(v);if(!S||S===p||c.has(S))return;const w=y+1;r!=null&&w>r||(c.add(S),m.set(S,w),f.push(S))})}return c}function Cw(e){if(!e)return null;const t=e?.parentId!=null?e.parentId:e?.source!=null?e.source:null,r=e?.childId!=null?e.childId:e?.target!=null?e.target:null,i=t!=null?String(t):null,l=r!=null?String(r):null;if(!i||!l||i===l)return null;const c=e?.relationshipLabel||e?.label||e?.typeName||Dz;return{id:e?.id!=null&&e.id!==""?String(e.id):`edge-${i}-${l}`,source:i,target:l,type:"smoothstep",animated:!e?.isClusterEdge,label:c,data:{relationshipType:c,parentId:i,childId:l,isClusterEdge:!!e?.isClusterEdge},parentId:i,childId:l,sourceHandle:"bottom",targetHandle:"top"}}function $z(){const{entityId:e}=Ss(),t=$n(),[r,i]=u.useState(!0),[l,c]=u.useState(null),[f,m]=u.useState([]),[h,p]=u.useState([]),[y,g]=u.useState({}),[v,S]=u.useState(null),[w,N]=u.useState(1),E=u.useRef(null),C=u.useRef(null),[A,O]=u.useState(null),[_,R]=u.useState(null),[D,j]=u.useState(null),[z,P]=u.useState(!1),[X,H]=u.useState([]),[G,V]=u.useState([]),k=u.useRef(new Map),F=u.useRef(new Map),I=u.useRef(new Map),L=u.useRef(new Set),$=u.useRef([]),T=u.useRef([]),U=u.useRef([]),M=u.useRef(new Map),q=u.useRef(new Set),Y=u.useRef(null),J=u.useRef(new Map),ie=u.useRef(new Map),Z=u.useRef(null),fe=u.useMemo(()=>Rz,[]),Q=u.useMemo(()=>kz,[]),se=u.useCallback(ee=>{if(!Array.isArray(ee)||!ee.length)return ee;const me=M.current;if(!(me instanceof Map)||!me.size)return ee;let he=!1;const Se=ee.map(We=>{if(!We||!(We.type==="entity"||We.type==="cluster"))return We;const et=me.get(String(We.id));return et?(he=!0,{...We,position:{x:et.x,y:et.y},positionAbsolute:{x:et.x,y:et.y}}):We});return he?Se:ee},[]);u.useEffect(()=>{$.current=f},[f]),u.useEffect(()=>{T.current=h},[h]),u.useEffect(()=>()=>{Z.current!=null&&(clearTimeout(Z.current),Z.current=null)},[]),u.useEffect(()=>{const ee=e!=null?String(e):null;if(ee&&Y.current!==ee){Y.current=ee,M.current=new Map,q.current=new Set,g({});return}ee||(Y.current=null,M.current=new Map,q.current=new Set,g({}))},[e]),u.useEffect(()=>{if(!A){R(null),j(null),P(!1),H([]),V([]);return}let ee=!1;return(async()=>{P(!0),j(null),R(null);try{const he=await or(A);if(ee)return;const Se=Va(he);R(Se||null)}catch(he){if(ee)return;console.error("Failed to load entity info:",he),R(null),j(he.message||"Failed to load entity info")}finally{ee||P(!1)}})(),()=>{ee=!0}},[A]);const ne=u.useMemo(()=>_&&(_.entity_type_id||_.entityType?.id||_.entity_type?.id)||null,[_]);u.useEffect(()=>{if(!ne){H([]),V([]);return}let ee=!1;return(async()=>{try{const[he,Se]=await Promise.all([of(ne).catch(We=>(console.error(" Failed to load drawer field order",We),null)),cf(ne).catch(We=>(console.error(" Failed to load drawer field rules",We),null))]);if(ee)return;H(Kr(he)),V(Kr(Se))}catch(he){if(ee)return;console.error(" Failed to load drawer field layout",he),H([]),V([])}})(),()=>{ee=!0}},[ne]);const we=u.useCallback(ee=>m(me=>UE(ee,me)),[]),Ie=u.useCallback(ee=>p(me=>z6(ee,me)),[]),Me=u.useCallback(ee=>{ee&&t(`/entities/${ee}/relationship-viewer`)},[t]),Ae=u.useCallback(ee=>{if(!ee)return;const me=String(ee);O(he=>he===me?he:me)},[]),it=u.useCallback(()=>{O(null),R(null),j(null),P(!1)},[]),$e=u.useCallback(ee=>{ee&&L.current.delete(String(ee))},[]),nt=u.useCallback(ee=>{ee&&L.current.add(String(ee))},[]),Le=u.useCallback(ee=>{if(!ee)return new Map;const me=String(ee),he=Array.isArray(T.current)?T.current:[],Se=new Map,We=[me],Xe=new Set;for(;We.length;){const et=We.pop();!et||Xe.has(et)||(Xe.add(et),he.forEach(Te=>{if(!Te||Te?.data?.isClusterEdge||Te?.data?.isClusterChildEdge)return;const mt=Te?.parentId??Te?.data?.parentId??Te?.source??null,Dt=Te?.childId??Te?.data?.childId??Te?.target??null;if(mt==null||Dt==null)return;const Nt=String(mt);if(Nt!==et)return;const Ge=String(Dt);if(!(!Ge||Ge===me)){if(!Se.has(Ge)){const vt=Te?.data?.relationshipType||Te?.relationshipLabel||Te?.label||"Related";Se.set(Ge,{parentId:Nt,relationshipType:vt})}Xe.has(Ge)||We.push(Ge)}}))}return Se},[]),wt=u.useCallback((ee,me)=>{if(ee==null||me==null)return;const he=String(ee);if(!he)return;const Se=ie.current instanceof Map?ie.current:null;!Se||q.current.has(he)&&Se.has(he)||Se.set(he,me)},[]),Tt=u.useCallback((ee,me)=>{if(!ee)return;const he=String(typeof ee=="string"?ee:ee?.id??ee?.data?.id??ee);if(!he)return;const Se=$.current.find(Ee=>String(Ee.id)===he&&Ee.type==="cluster");if(!Se)return;const We=q.current,et=U.current.find(Ee=>String(Ee.id)===he)||{id:he,relationshipType:Se?.data?.relationshipType||Se?.data?.label||"Related",label:Se?.data?.label||Se?.data?.relationshipType||"Related",containedIds:(Se?.data?.containedIds||[]).map(Ee=>String(Ee)).filter(Ee=>!We.has(Ee)),parentId:Se?.data?.sourceId!=null?String(Se.data.sourceId):null},Te=k.current,mt=I.current,Dt=F.current;if(!(Te instanceof Map)||!(mt instanceof Map))return;const Nt=me??(typeof ee=="object"&&ee?.entityId!=null?ee.entityId:null),Ge=Nt!=null?String(Nt):null;if(Ge&&We.has(Ge))return;const vt=new Map;Array.isArray($.current)&&$.current.forEach(Ee=>{if(!Ee||Ee.type&&Ee.type!=="entity")return;const at=String(Ee.id);at&&vt.set(at,Ee)}),mt instanceof Map&&mt.forEach((Ee,at)=>{if(!Ee)return;const le=String(at);le&&vt.set(le,Ee)}),(Array.isArray(Se?.data?.allNodes)?Se.data.allNodes:[]).forEach(Ee=>{if(!Ee||Ee?.type&&Ee.type!=="entity")return;const at=Ee?.id!=null?String(Ee.id):null;if(!at||vt.has(at))return;const le=Ee?.data||{},st=le?.label||Ee?.name||le?.name||`Entity ${at}`,ct={id:at,type:Ee?.type||"entity",position:Ee?.position||{x:0,y:0},data:{...le,label:wa(st,`Entity ${at}`),typeName:le?.typeName||le?.type?.name||Ee?.typeName||Ee?.type&&Ee?.type.name||"Entity",entityId:le?.entityId!=null?String(le.entityId):at,isAdHoc:le?.isAdHoc!=null?!!le.isAdHoc:!0,isExpandedProtected:!!le?.isExpandedProtected}};vt.set(at,ct)});let Bt=Ge?[Ge].filter(Ee=>Te.has(Ee)):[];if(Bt.length===0&&Ge&&(Bt=[String(Ge)]),!Bt.length)if(Ge){const Ee=String(Ge);Te.delete(Ee),mt.delete(Ee),Dt instanceof Map&&Dt.delete(Ee),q.current.add(Ee)}else{$e(he);return}const Jt=Bt.map(Ee=>{const at=String(Ee);return{id:at,definition:mt.get(at)||vt.get(at)||null,meta:Dt.get(at)||Te.get(at)||null}}).filter(Ee=>{if(!Ee?.definition)return!1;const at=Ee?.id!=null?String(Ee.id):null;return at?!We.has(at):!1});if(!Jt.length){Ge||$e(he);return}const Et=et.parentId!=null?String(et.parentId):null,zt=new Set($.current.map(Ee=>String(Ee.id))),$t=Jt.filter(({id:Ee,meta:at})=>{const le=Ee!=null?String(Ee):null;if(le&&We.has(le))return!1;const st=at?.parentId!=null?String(at.parentId):Et;return Et&&st!==Et?!1:st?Te.has(st)?!1:zt.has(st):!0});if(!$t.length)return;$t.forEach(({id:Ee})=>{const at=String(Ee);at&&We.add(at)});const kt=et.relationshipType||et.label||"Related",te=[...T.current];$t.forEach(({id:Ee})=>{Te.delete(String(Ee))});const be=[],ve=[],Be=J.current instanceof Map?J.current:new Map,ot=ie.current instanceof Map?ie.current:new Map,xt=Number.isFinite(Number(w))?Number(w):null;if(Be.size){const Ee=F.current instanceof Map?F.current:new Map,at=new Set(Array.isArray($.current)?$.current.map(Qe=>String(Qe.id)):[]),le=new Set,st=new Set;$t.forEach(({id:Qe})=>{if(!Qe)return;const pt=String(Qe);at.add(pt),le.add(pt)});const ct=$t.map(({id:Qe})=>String(Qe)),yt=new Set,oe=new Set,Ze=new Set,Ke=1e4;let ft=0;if(!(ot instanceof Map)){console.warn("Depth lookup not properly initialized, skipping relationship extension");return}try{for(;ct.length&&ft<Ke;){ft+=1;const Qe=ct.shift();if(!Qe||yt.has(Qe))continue;if(Ze.has(Qe)){console.warn(`Circular reference detected for entity ${Qe}, skipping`);continue}yt.add(Qe),Ze.add(Qe);const pt=typeof ot.get=="function"?ot.get(Qe)??0:0;if(xt!=null&&pt!=null&&Number.isFinite(pt)&&pt>=xt){Ze.delete(Qe);continue}if(!(Be instanceof Map)||typeof Be.get!="function"){Ze.delete(Qe);continue}const ke=Be.get(Qe);if(!Array.isArray(ke)||!ke.length){Ze.delete(Qe);continue}ke.forEach(Pe=>{if(Pe)try{const ht=Pe?.childId!=null?Pe.childId:Pe?.target!=null?Pe.target:null,K=ht!=null?String(ht):null;if(!K||K===Qe)return;const ae=Number.isFinite(pt)?pt+1:1;if(xt!=null&&Number.isFinite(xt)&&ae>xt)return;if(at.has(K))wt(K,ae),le.has(K)&&!yt.has(K)&&!Ze.has(K)&&ct.push(K);else if(!st.has(K)){let Ne=null;if(Te.has(K)){if(!(mt instanceof Map)||typeof mt.get!="function")return;const qe=mt.get(K);if(!qe)return;Te.delete(K),mt.delete(K),Ee instanceof Map&&Ee.delete(K),We.add(K),Ne=qe}else{if(!(vt instanceof Map)||typeof vt.get!="function")return;const qe=vt.get(K);if(!qe)return;const gt=qe?.data?.label||qe?.data?.name||`Entity ${K}`;Ne={...qe,id:String(K),type:qe.type||"entity",position:qe.position||{x:0,y:0},data:{...qe?.data||{},label:wa(gt,`Entity ${K}`),typeName:qe?.data?.typeName||qe?.data?.type?.name||"Entity",entityId:qe?.data?.entityId!=null?String(qe.data.entityId):String(K),isAdHoc:qe?.data?.isAdHoc!=null?!!qe.data.isAdHoc:!0,isExpandedProtected:!!qe?.data?.isExpandedProtected}}}Ne&&(be.push({id:K,definition:Ne}),st.add(K),at.add(K),le.add(K),!yt.has(K)&&!Ze.has(K)&&ct.push(K),wt(K,ae),vt.set(K,Ne))}wt(K,ae);try{const Ne=Cw(Pe);Ne&&!oe.has(Ne.id)&&(oe.add(Ne.id),ve.push(Ne))}catch(Ne){console.warn("Failed to convert edge to ReactFlow format:",Ne)}}catch(ht){console.warn(`Error processing edge for entity ${Qe}:`,ht)}}),Ze.delete(Qe)}ft>=Ke&&console.warn(`Relationship extension reached maximum iteration limit (${Ke}), stopping to prevent infinite loop`)}catch(Qe){console.error("Error during relationship extension traversal:",Qe)}if(ve.length){const Qe=new Set(te.map(pt=>pt.id));ve.forEach(pt=>{!pt||Qe.has(pt.id)||(Qe.add(pt.id),te.push(pt))})}}const re=et.containedIds.filter(Ee=>{const at=String(Ee);return We.has(at)?!1:Te.has(at)});g(Ee=>{const at={...Ee};let le=!1;return $t.forEach(({id:st})=>{at[st]||(at[st]={clusterId:et.id,relationshipType:et.relationshipType||null,sourceId:et.parentId||null},le=!0)}),le?at:Ee}),ve.length&&p(Ee=>{const at=new Set(Ee.map(st=>st.id)),le=ve.filter(st=>!at.has(st.id));return le.length?[...Ee,...le]:Ee}),m(Ee=>{const at=Ee.find(Qe=>String(Qe.id)===he&&Qe.type==="cluster");if(!at)return Ee;const le=new Set(Ee.map(Qe=>String(Qe.id)));let st=Ee,ct=!1;const yt=new Set((at.data?.placedEntityIds||[]).map(Qe=>String(Qe)));$t.forEach(({id:Qe,definition:pt,meta:ke})=>{const Pe=String(Qe);if(yt.add(Pe),le.has(Pe))return;const ht=ke?.entity||{id:Qe,name:pt?.data?.label||`Entity ${Qe}`,typeName:pt?.data?.typeName||pt?.data?.type?.name||"Entity",isExpandedProtected:!!pt?.data?.isExpandedProtected},K=Az(at,ht,Array.from(yt))||pt;if(!K)return;const ae=wa(K.data?.label,`Entity ${Qe}`),Ne=wa(ht?.name,ae),qe={...K,id:String(Qe),type:"entity",data:{...K.data,label:Ne,typeName:ht?.typeName||K.data?.typeName||"Entity",entityId:String(Qe),isAdHoc:!0,onSetTarget:Me,onOpenInfo:Ae,isExpandedProtected:!!ht?.isExpandedProtected}};le.add(Pe),ct=!0,st=[...st,qe];const gt=`cluster-context-${he}-${Pe}`;if(!T.current.find(_t=>_t.id===gt)){const _t={id:gt,source:he,target:Pe,type:"smoothstep",animated:!1,label:"",style:{stroke:"#bbb",strokeDasharray:"4 2"},data:{isClusterContext:!0,parentId:he,childId:Pe},sourceHandle:"bottom",targetHandle:"top"};T.current.push(_t),p(qt=>[...qt,_t])}}),be.forEach(({id:Qe,definition:pt})=>{if(!Qe||le.has(String(Qe)))return;const ke={...pt,id:String(Qe),type:"entity",data:{...pt?.data,label:pt?.data?.label||pt?.data?.name||`Entity ${Qe}`,typeName:pt?.data?.typeName||pt?.data?.type?.name||"Entity",entityId:String(Qe),isAdHoc:!0,onSetTarget:Me,onOpenInfo:Ae,isExpandedProtected:!!pt?.data?.isExpandedProtected}};le.add(String(Qe)),ct=!0,st=[...st,ke]});const oe=Array.from(yt),Ze=`${kt} (${re.length})`;let Ke=st.map(Qe=>String(Qe.id)!==he||Qe.type!=="cluster"?Qe:{...Qe,data:{...Qe.data,placedEntityIds:oe,manuallyReleasedIds:oe,label:Ze}});const ft=Ke.find(Qe=>String(Qe.id)===he&&Qe.type==="cluster")||at;return Ke=ld(Ke,ft,oe),!ct&&!Ee.some(pt=>String(pt.id)!==he||pt.type!=="cluster"?!1:pt.data?.label!==Ze)?Ee:se(ec(Ke,te))});const je=`${kt} (${re.length})`;et.label=je,U.current=U.current.map(Ee=>String(Ee.id)===he?{...Ee,label:je}:Ee);const He=Ee=>{if(!Array.isArray(Ee)||!Ee.length)return[];const at=J.current instanceof Map?J.current:new Map,le=ie.current instanceof Map?ie.current:new Map,st=q.current,ct=k.current instanceof Map?k.current:null,yt=I.current instanceof Map?I.current:null,oe=F.current instanceof Map?F.current:null;if(!yt)return[];const Ze=Number.isFinite(Number(w))?Number(w):null,Ke=new Set(T.current.map(Pe=>String(Pe.id))),ft=[],Qe=[],pt=new Map,ke=new Set;if(Ee.forEach(Pe=>{const ht=Pe!=null?String(Pe):null;if(!ht||!(at instanceof Map)||typeof at.get!="function"||!(le instanceof Map)||typeof le.get!="function")return;const K=at.get(ht)||[];if(!Array.isArray(K))return;const ae=le.get(ht),Ne=Number.isFinite(ae)?ae+1:null;K.forEach(qe=>{if(qe)try{const gt=qe?.childId!=null?qe.childId:qe?.target!=null?qe.target:null,St=gt!=null?String(gt):null;if(!St||St===ht||st.has(St))return;try{const va=Cw(qe);va&&!Ke.has(va.id)&&(Ke.add(va.id),ft.push(va))}catch(va){console.warn(`Failed to convert edge to ReactFlow format for parent ${ht}:`,va)}if(!(Ze==null||Ne!=null&&Ne<=Ze)||!(yt instanceof Map)||typeof yt.has!="function"||!yt.has(St))return;const qt=yt.get(St);if(!qt)return;const en=oe&&oe.get(St)||ct&&ct.get(St)||null;yt.delete(St),ct&&ct.delete(St),oe&&oe.delete(St);const dn=st.has(St);st.add(St),Ne!=null&&(!dn||!(le instanceof Map)||!le.has(St))&&wt(St,Ne);const Zt=en?.entity||null,sa=wa(qt?.data?.label,wa(qt?.data?.name,`Entity ${St}`)),ba=wa(Zt?.name,sa),zs={...qt,id:St,type:"entity",data:{...qt?.data,label:ba,typeName:Zt?.typeName||qt?.data?.typeName||qt?.data?.type?.name||"Entity",entityId:St,isAdHoc:!0,onSetTarget:Me,onOpenInfo:Ae,isExpandedProtected:!!(Zt?.isExpandedProtected??qt?.data?.isExpandedProtected)}};Qe.push(zs),ke.add(St),en?.clusterId&&pt.set(St,{clusterId:String(en.clusterId),relationshipType:en?.relationshipType||null,sourceId:en?.parentId!=null?String(en.parentId):null})}catch(gt){console.warn(`Error processing edge for parent ${ht} child ${childId}:`,gt)}})}),ft.length){const Pe=ft.filter(Boolean);Pe.length&&(T.current=[...T.current,...Pe],p(ht=>[...ht,...Pe]))}return Qe.length&&m(Pe=>{const ht=new Set(Pe.map(qe=>String(qe.id))),K=Qe.filter(qe=>{const gt=qe?.id!=null?String(qe.id):null;return!gt||ht.has(gt)?!1:(ht.add(gt),!0)});if(!K.length)return Pe;const ae=[...Pe,...K],Ne=ec(ae,T.current);return se(Ne)}),pt.size&&g(Pe=>{const ht={...Pe};let K=!1;return pt.forEach((ae,Ne)=>{const qe=ht[Ne];(!qe||qe.clusterId!==ae.clusterId||qe.relationshipType!==ae.relationshipType||qe.sourceId!==ae.sourceId)&&(ht[Ne]=ae,K=!0)}),K?ht:Pe}),Array.from(ke)},ut=new Set,dt=[...$t.map(({id:Ee})=>String(Ee)),...be.map(({id:Ee})=>String(Ee))].filter(Boolean);for(;dt.length;){const Ee=[];for(;dt.length;){const le=dt.shift();!le||ut.has(le)||Ee.push(le)}if(!Ee.length)break;const at=He(Ee);Ee.forEach(le=>ut.add(le)),at.forEach(le=>{ut.has(le)||dt.push(le)})}},[se,Ae,Me,wt,$e,w]),Ct=u.useCallback((ee,me)=>{if(!ee||!me)return;const he=String(me.id),Se=String(ee.id);if(me?.isExpandedProtected||$.current.some(Et=>String(Et?.id)===he&&Et?.data?.isExpandedProtected))return;const Xe=new Map($.current.map(Et=>[String(Et.id),Et])),et=Le(he),mt=Array.from(et.entries()).map(([Et])=>String(Et)).filter(Et=>{if(Et===he)return!1;const zt=Xe.get(Et);return!(!zt||zt?.data?.isExpandedProtected)}),Dt=new Set(mt);q.current.delete(he),M.current.delete(he),mt.forEach(Et=>{q.current.delete(String(Et)),M.current.delete(String(Et))}),g(Et=>{const zt={...Et};let $t=!1;return zt[he]&&(delete zt[he],$t=!0),mt.forEach(kt=>{zt[kt]&&(delete zt[kt],$t=!0)}),$t?zt:Et});let Nt=[];m(Et=>{const zt=Et.find(ve=>ve.id===ee.id);let kt=Et.filter(ve=>{const Be=String(ve.id);return Be===he&&ve.type==="entity"?!ve.data?.isAdHoc:Dt.has(Be)&&ve.type==="entity"?!!ve.data?.isExpandedProtected:!0}).map(ve=>{if(ve.id!==ee.id||ve.type!=="cluster")return ve;const Be=new Set((ve.data?.placedEntityIds||[]).map(String));return Be.has(he)?(Be.delete(he),{...ve,data:{...ve.data,placedEntityIds:Array.from(Be),manuallyReleasedIds:Array.from(Be)}}):ve});const te=kt.find(ve=>ve.id===ee.id&&ve.type==="cluster"),be=te?.data?.placedEntityIds?.map(ve=>String(ve))||[];return Nt=be,se(ld(kt,te||zt,be))}),p(Et=>{const zt=new Set([he,...mt]);return Et.filter($t=>{const kt=$t?.source!=null?String($t.source):$t?.parentId!=null?String($t.parentId):null,te=$t?.target!=null?String($t.target):$t?.childId!=null?String($t.childId):null;return!(kt&&zt.has(kt)||te&&zt.has(te))})});const Ge=ee.relationshipType||ee.label||"Related",vt=wa(me?.name,`Entity ${he}`),Mt={clusterId:Se,parentId:ee.sourceId?String(ee.sourceId):null,relationshipType:Ge,entity:{id:he,name:vt,typeName:me?.typeName||me?.type?.name||"Entity",type:me?.type}};k.current.set(he,Mt),F.current.set(he,Mt),I.current.set(he,{id:he,type:"entity",position:{x:0,y:0},data:{label:vt,typeName:me?.typeName||me?.type?.name||"Entity",entityId:he,isAdHoc:!0,isExpandedProtected:!!me?.isExpandedProtected}});const Bt=U.current.find(Et=>Et.id===Se);if(Bt){const Et=q.current,zt=ee.containedIds.filter(kt=>{const te=String(kt);return Et.has(te)?!1:k.current.has(te)}),$t=`${Bt.relationshipType||ee.relationshipType||"Related"} (${zt.length})`;Bt.label=$t,U.current=U.current.map(kt=>kt.id===Se?{...kt,label:$t}:kt),m(kt=>kt.map(te=>String(te.id)!==Se||te.type!=="cluster"?te:{...te,data:{...te.data,label:$t}}))}Nt.length?$e(Se):nt(Se);const Jt=Array.isArray(U.current)?U.current:[];mt.forEach(Et=>{const zt=Xe.get(Et);if(!zt)return;const $t=et.get(Et)||{},kt=$t?.parentId!=null?String($t.parentId):null,te=$t?.relationshipType||"Related",be=Jt.find(Be=>{if(!Be)return!1;const ot=Be?.parentId!=null?String(Be.parentId):null;return ot&&kt&&ot!==kt?!1:Array.isArray(Be?.containedIds)?Be.containedIds.some(xt=>String(xt)===String(Et)):!1}),ve={clusterId:be?String(be.id):null,parentId:kt,relationshipType:te,entity:{id:String(Et),name:zt?.data?.label||`Entity ${Et}`,typeName:zt?.data?.typeName||zt?.data?.type?.name||"Entity",type:zt?.data?.type||null,isExpandedProtected:!!zt?.data?.isExpandedProtected}};k.current.set(String(Et),ve),F.current.set(String(Et),ve),I.current.set(String(Et),{id:String(Et),type:"entity",position:{x:0,y:0},data:{label:zt?.data?.label||`Entity ${Et}`,typeName:zt?.data?.typeName||zt?.data?.type?.name||"Entity",entityId:String(Et),isAdHoc:!0,isExpandedProtected:!!zt?.data?.isExpandedProtected}})})},[se,Le,nt,$e]),At=u.useCallback(ee=>{if(!ee)return;const me=String(typeof ee=="string"?ee:ee?.id??ee?.data?.id??ee);if(!me)return;const he=U.current.find(Nt=>String(Nt.id)===me);if(!he)return;const Se=k.current,We=F.current,Xe=he.containedIds.filter(Nt=>$.current.some(Ge=>String(Ge.id)===String(Nt)));if(!Xe.length){nt(me);return}Xe.forEach(Nt=>{const Ge=String(Nt);q.current.delete(Ge),M.current.delete(Ge);const vt=$.current.find(Bt=>String(Bt.id)===Ge);vt?.type==="entity"&&I.current.set(Ge,{id:Ge,type:"entity",position:{x:0,y:0},data:{label:vt.data?.label||`Entity ${Ge}`,typeName:vt.data?.typeName||"Entity",entityId:Ge,isAdHoc:!0,isExpandedProtected:!!vt.data?.isExpandedProtected}});const Mt=We.get(Ge)||{clusterId:me,parentId:he.parentId||null,relationshipType:he.relationshipType||he.label||"Related",entity:vt?.data?{id:Ge,name:vt.data?.label||`Entity ${Ge}`,typeName:vt.data?.typeName||"Entity",isExpandedProtected:!!vt.data?.isExpandedProtected}:I.current.get(Ge)?.data?{id:Ge,name:I.current.get(Ge)?.data?.label||`Entity ${Ge}`,typeName:I.current.get(Ge)?.data?.typeName||"Entity",isExpandedProtected:!!I.current.get(Ge)?.data?.isExpandedProtected}:null};Se.set(Ge,Mt),We.set(Ge,Mt)});const et=T.current.filter(Nt=>{const Ge=String(Nt.source),vt=String(Nt.target);return!Xe.includes(Ge)&&!Xe.includes(vt)});p(et),g(Nt=>{const Ge={...Nt};let vt=!1;return Xe.forEach(Mt=>{Ge[Mt]&&(delete Ge[Mt],vt=!0)}),vt?Ge:Nt});const Te=q.current,mt=he.containedIds.filter(Nt=>{const Ge=String(Nt);return Te.has(Ge)?!1:Se.has(Ge)}),Dt=`${he.relationshipType||he.label||"Related"} (${mt.length})`;he.label=Dt,U.current=U.current.map(Nt=>String(Nt.id)===me?{...Nt,label:Dt}:Nt),m(Nt=>{const vt=Nt.filter(Mt=>!Xe.includes(String(Mt.id))).map(Mt=>String(Mt.id)!==me||Mt.type!=="cluster"?Mt:{...Mt,data:{...Mt.data,placedEntityIds:he.containedIds.filter(Bt=>{const Jt=String(Bt);return Te.has(Jt)?!1:!Se.has(Jt)}).map(Bt=>String(Bt)),manuallyReleasedIds:he.containedIds.filter(Bt=>{const Jt=String(Bt);return Te.has(Jt)?!1:!Se.has(Jt)}).map(Bt=>String(Bt)),label:Dt}});return se(ec(vt,et))}),nt(me)},[se,nt]),Ue=u.useCallback((ee,me)=>{if(!me||me.type!=="entity"&&me.type!=="cluster")return;const he=String(me.id);if(M.current.set(he,{x:me?.position?.x??0,y:me?.position?.y??0}),me.type!=="entity")return;const Se=he,We=y[Se];if(!We?.clusterId)return;const Xe=document.querySelector(`[data-id="${We.clusterId}"]`),et=document.querySelector(`[data-id="${Se}"]`);if(!Xe||!et)return;const Te=Xe.getBoundingClientRect(),mt=et.getBoundingClientRect(),Dt=mt.left+mt.width/2,Nt=mt.top+mt.height/2;if(!(Dt>=Te.left&&Dt<=Te.right&&Nt>=Te.top&&Nt<=Te.bottom))return;const vt=f.find(Mt=>Mt.id===We.clusterId);vt&&(me?.data?.isExpandedProtected||Ct({id:vt.id,relationshipType:vt.data?.relationshipType,sourceId:vt.data?.sourceId,placedEntityIds:vt.data?.placedEntityIds||[]},{id:Se,name:me?.data?.label,typeName:me?.data?.typeName,isExpandedProtected:!!me?.data?.isExpandedProtected}))},[y,Ct,f]);u.useEffect(()=>{m(ee=>{const me=Object.entries(y).reduce((Se,[We,Xe])=>{const et=Xe?.clusterId;if(!et)return Se;const Te=String(et);return Se[Te]||(Se[Te]=[]),Se[Te].push(String(We)),Se},{});let he=ee.map(Se=>{if(Se.type!=="cluster")return Se;const We=me[Se.id]||[],Xe=(Se.data?.placedEntityIds||[]).map(Te=>String(Te));return We.length!==Xe.length||We.some((Te,mt)=>Te!==Xe[mt])?{...Se,data:{...Se.data,placedEntityIds:We,manuallyReleasedIds:We}}:Se});for(const[Se,We]of Object.entries(me)){const Xe=he.find(et=>et.id===Se&&et.type==="cluster");Xe&&(he=ld(he,Xe,We))}return se(he)})},[se,y]),u.useEffect(()=>{if(!e)return;let ee=!0;const me=new AbortController,he=3e4;async function Se(){i(!0),c(null);const We=performance.now();console.log(`[RelationshipViewer] Starting graph fetch for entity ${e} at depth ${w}`);try{const Xe=k.current instanceof Map?Array.from(k.current.entries()):[],et=new Map(Xe.map(([kt,te])=>[String(kt),te])),Te=new Set(et.keys()),mt=new Promise((kt,te)=>{setTimeout(()=>{te(new Error(`Graph fetch timed out after ${he/1e3} seconds`))},he)}),Dt=PR(e,w),Nt=await Promise.race([Dt,mt]),Ge=performance.now()-We;console.log(`[RelationshipViewer] Graph fetch completed in ${Ge.toFixed(2)}ms`);const vt=Nt??{};let Mt=Array.isArray(vt.edges)?vt.edges:[];Te.size&&Array.isArray(vt.edges)&&(Mt=vt.edges.filter(kt=>{const te=kt?.from_entity??kt?.fromEntityId??kt?.from??kt?.source??kt?.sourceId??null,be=kt?.to_entity??kt?.toEntityId??kt?.to??kt?.target??kt?.targetId??null,ve=te!=null?String(te):null,Be=be!=null?String(be):null,ot=ve?Te.has(ve):!1,xt=Be?Te.has(Be):!1;return!ot&&!xt?!0:!(ot&&xt)}));const Bt=Mt.map(kt=>Tz(kt,e)).filter(Boolean),Jt=Iz(Bt);J.current=Jt,ie.current=Lz(e,Jt);const Et=Number.isFinite(Number(w))?Number(w):null,zt=zz(e,Bt,Et),$t=performance.now();console.log(`[RelationshipViewer] Starting graph processing: ${Mt.length} edges`),setTimeout(()=>{try{if(!ee)return;const kt=performance.now(),{nodes:te,edges:be,suppressedNodes:ve,clusters:Be}=Cz({...vt,edges:Mt},e,void 0,{alwaysIncludeIds:zt}),ot=performance.now()-kt;if(console.log(`[RelationshipViewer] buildReactFlowGraph completed in ${ot.toFixed(2)}ms: ${te.length} nodes, ${be.length} edges`),!ee)return;const xt=K=>K?K.type==="cluster"?{...K,data:{...K.data,onAddToBoard:(ae,Ne)=>Tt(ae,Ne),onReturnToGroup:Ct,onCollapseCluster:At,onSetTargetEntity:Me,onOpenEntityInfo:Ae,placedEntityIds:[]}}:K.type==="entity"?{...K,data:{...K.data,onSetTarget:Me,onOpenInfo:Ae}}:{...K}:null,re=q.current,je=te.map(xt),He=Object.entries(y).reduce((K,[ae,Ne])=>{const qe=Ne?.clusterId!=null?String(Ne.clusterId):null;return qe&&(K.has(qe)||K.set(qe,[]),K.get(qe).push(String(ae))),K},new Map),ut=K=>{const ae=Array.isArray(K)?K.map(Ne=>String(Ne)):[];return re.size?ae.filter(Ne=>!re.has(Ne)):ae},dt=K=>{if(!K)return K;const ae=K?.id!=null?String(K.id):null,Ne=ut(K?.data?.containedIds||[]),qe=ae&&He.has(ae)?He.get(ae):[],gt=Array.isArray(qe)?qe.map(St=>String(St)):[];return{...K,data:{...K?.data,containedIds:Ne,count:Ne.length+gt.length,placedEntityIds:gt,manuallyReleasedIds:gt}}},Ee=je.map(K=>K?.type==="cluster"?dt(K):K),at=new Map,le=ve,st=(K,ae)=>{if(re.has(K))return;const Ne=wa(ae?.entity?.name,`Entity ${K}`);at.set(K,{clusterId:ae?.clusterId!=null?String(ae.clusterId):null,parentId:ae?.parentId!=null?String(ae.parentId):null,relationshipType:ae?.relationshipType||"Related",entity:ae?.entity?{...ae.entity,id:String(ae.entity.id??K),name:Ne,typeName:ae.entity?.typeName||ae.entity?.type?.name||"Entity",isExpandedProtected:!!ae.entity?.isExpandedProtected}:null})};le instanceof Map?le.forEach((K,ae)=>{const Ne=String(ae);st(Ne,K)}):Object.entries(le||{}).forEach(([K,ae])=>{const Ne=String(K);st(Ne,ae)}),k.current=at,F.current=new Map(at);const ct=new Map;le instanceof Map?le.forEach((K,ae)=>{const Ne=String(ae),qe=K?.entity||null,gt=wa(qe?.name,`Entity ${Ne}`);ct.set(Ne,{id:Ne,type:"entity",position:{x:0,y:0},data:{label:gt,typeName:qe?.typeName||qe?.type?.name||"Entity",entityId:Ne,isAdHoc:!0,isExpandedProtected:!!qe?.isExpandedProtected}})}):Object.entries(le||{}).forEach(([K,ae])=>{const Ne=String(K),qe=ae?.entity||null,gt=wa(qe?.name,`Entity ${Ne}`);ct.set(Ne,{id:Ne,type:"entity",position:{x:0,y:0},data:{label:gt,typeName:qe?.typeName||qe?.type?.name||"Entity",entityId:Ne,isAdHoc:!0,isExpandedProtected:!!qe?.isExpandedProtected}})}),I.current=ct;const yt=new Set,Ze=(Array.isArray(Be)?Be:Ee.filter(K=>K.type==="cluster")).map(K=>dt(K));Ze.forEach(K=>{yt.add(String(K.id))}),L.current=yt;const Ke=Ze.map(K=>({id:String(K.id),relationshipType:K?.data?.relationshipType||K?.data?.label||"Related",label:K?.data?.label||K?.data?.relationshipType||"Related",containedIds:(K?.data?.containedIds||[]).map(ae=>String(ae)),parentId:K?.data?.sourceId!=null?String(K.data.sourceId):null}));U.current=Ke;const ft=new Map(Array.isArray($.current)?$.current.map(K=>[String(K.id),K]):[]),Qe=[...Ee];re.forEach(K=>{const ae=String(K);if(Qe.some(gt=>String(gt.id)===ae))return;const Ne=ft.get(ae);if(Ne){Qe.push(Ne);return}const qe=ct.get(ae);if(qe){const gt=xt(qe);gt&&Qe.push({...gt,id:ae,type:"entity"})}});const pt=new Set(Array.isArray(be)?be.map(K=>K.id):[]),ke=(Array.isArray(T.current)?T.current:[]).filter(K=>{if(!K||pt.has(K.id))return!1;const ae=K?.data?.childId??K?.target??K?.data?.targetId??null,Ne=K?.data?.parentId??K?.source??K?.data?.sourceId??null,qe=ae!=null?String(ae):null,gt=Ne!=null?String(Ne):null;return!!(qe&&re.has(qe)||gt&&re.has(gt))}),Pe=Array.isArray(be)?[...be,...ke]:ke,ht=performance.now()-$t;console.log(`[RelationshipViewer] Total processing completed in ${ht.toFixed(2)}ms`),m(se(Qe)),p(Pe),ee&&i(!1)}catch(kt){ee&&(console.error("[RelationshipViewer] Error processing graph data:",kt),c(kt.message||"Failed to process graph data"),i(!1))}},0)}catch(Xe){ee&&(console.error("[RelationshipViewer] Error fetching graph:",Xe),c(Xe.message||"Failed to load graph"),i(!1))}}return Se(),()=>{ee=!1,me.abort()}},[se,e,w,Tt,At,Ae,Ct,Me]);const Je=u.useCallback(()=>{if(!v||!e)return;const ee=String(e),me=v.getNode(ee);if(!me)return;const he=me.width??0,Se=me.height??0,We=me.position.x+he/2,Xe=me.position.y+Se/2;v.setCenter(We,Xe,{zoom:Math.max(1,v.getZoom()),duration:500})},[e,v]),de=u.useCallback(()=>{!v||!f.length||v.fitView({padding:.2,duration:500})},[f.length,v]),ue=u.useCallback(()=>{e&&(m(ee=>{if(!ee?.length)return ee;const me=ec(ee,h,e),he=new Map(me.map(Te=>[String(Te.id),{...Te.position}])),Se=ee.map(Te=>{const mt=he.get(String(Te.id));return!mt||Te?.position?.x===mt.x&&Te?.position?.y===mt.y?Te:{...Te,position:{...mt}}}),We=Object.entries(y).reduce((Te,[mt,Dt])=>{const Nt=Dt?.clusterId;if(!Nt)return Te;const Ge=String(Nt);return Te[Ge]||(Te[Ge]=[]),Te[Ge].push(String(mt)),Te},{});if(!Object.keys(We).length)return Se;let Xe=Se.map(Te=>{if(Te.type!=="cluster")return Te;const mt=We[Te.id]||[],Dt=(Te.data?.placedEntityIds||[]).map(String);return mt.length!==Dt.length||mt.some((Ge,vt)=>Ge!==Dt[vt])?{...Te,data:{...Te.data,placedEntityIds:mt,manuallyReleasedIds:mt}}:Te});for(const[Te,mt]of Object.entries(We)){const Dt=Xe.find(Nt=>Nt.id===Te&&Nt.type==="cluster");Dt&&(Xe=ld(Xe,Dt,mt))}const et=M.current;return et instanceof Map&&et.size&&Xe.forEach(Te=>{if(!Te||!(Te.type==="entity"||Te.type==="cluster"))return;const Dt=String(Te.id);et.has(Dt)&&et.set(Dt,{x:Te.position?.x??0,y:Te.position?.y??0})}),se(Xe)}),v&&requestAnimationFrame(()=>{v.fitView({padding:.2,duration:400})}))},[se,y,h,e,v]),ye=u.useCallback(()=>{r||N(ee=>Math.min(3,ee+1))},[r]),Ve=u.useCallback(()=>{r||N(ee=>Math.max(1,ee-1))},[r]);return u.useEffect(()=>{if(!E.current||!C.current)return;const ee=()=>{const Se=E.current,We=C.current;if(!Se||!We)return;const Xe=Se.getBoundingClientRect();Xe.width>0&&Xe.height>0&&(We.style.width=`${Xe.width}px`,We.style.height=`${Xe.height}px`)},me=setTimeout(ee,0),he=new ResizeObserver(ee);return he.observe(E.current),()=>{clearTimeout(me),he.disconnect()}},[]),r?a.jsx("p",{className:"p-4",children:"Loading graph..."}):l?a.jsxs("p",{className:"p-4 text-red-500",children:["Error: ",l]}):f.length?a.jsxs("div",{className:"relative h-full w-full",style:{width:"100%",height:"100%"},children:[a.jsx("div",{ref:E,className:"absolute inset-0 bg-slate-100",style:{width:"100%",height:"100%"},children:a.jsx("div",{ref:C,className:"absolute inset-0",style:{width:"100%",height:"100%"},children:a.jsxs(tj,{nodes:f,edges:h,onNodesChange:we,onEdgesChange:Ie,onNodeDragStop:Ue,nodeTypes:fe,edgeTypes:Q,fitView:!0,onInit:S,children:[a.jsx(B8,{}),a.jsx(G8,{}),a.jsx(J8,{gap:16})]})})}),a.jsxs("header",{className:"absolute top-0 z-20 bg-white border-b px-6 py-4 flex items-center justify-between relationship-viewer-header",style:{left:0,right:0,width:"100%",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1)"},children:[a.jsx("h1",{className:"text-xl font-bold text-gray-900 tracking-tight",children:"Relationship Explorer"}),a.jsx(mj,{style:{compact:!0},onRefocus:Je,onZoomToFit:de,onAutoArrange:ue,depth:w,onIncreaseDepth:ye,onDecreaseDepth:Ve})]}),a.jsx(Xy,{entityId:A,entity:_,isLoading:z,error:D,onClose:it,fieldOrder:X,fieldRules:G})]}):a.jsx("p",{className:"p-4",children:"No relationships found for this entity."})}function Po({step:e,title:t,subtitle:r,children:i,disabled:l=!1}){return a.jsxs("section",{className:`step-card${l?" step-card--disabled":""}`,"aria-disabled":l,children:[a.jsxs("header",{className:"step-card__header",children:[a.jsx("span",{className:"step-card__badge",children:e}),a.jsxs("div",{children:[a.jsx("h3",{className:"step-card__title",children:t}),r&&a.jsx("p",{className:"step-card__subtitle",children:r})]})]}),a.jsx("div",{className:"step-card__body",children:i})]})}const Aw=["B","KB","MB","GB"];function Fz(e){if(!Number.isFinite(e)||e<=0)return"0 B";const t=Math.min(Math.floor(Math.log(e)/Math.log(1024)),Aw.length-1),r=e/1024**t;return`${r.toFixed(r>=10||t===0?0:1)} ${Aw[t]}`}function Bz({files:e=[],selectedId:t,onSelect:r,onDelete:i}){return e.length?a.jsx("ul",{className:"uploaded-file-list",children:e.map(l=>{const c=l.id===t;return a.jsxs("li",{className:`uploaded-file-list__item${c?" is-selected":""}`,children:[a.jsxs("button",{type:"button",className:"uploaded-file-list__select",onClick:()=>r(c?null:l.id),children:[a.jsx(Fp,{size:16}),a.jsx("span",{className:"uploaded-file-list__name",children:l.file_name}),a.jsx("span",{className:"uploaded-file-list__meta",children:Fz(l.size_bytes)})]}),a.jsx("button",{type:"button",className:"uploaded-file-list__delete",onClick:()=>i(l.id),"aria-label":`Delete ${l.file_name}`,children:a.jsx(ha,{size:16})})]},l.id)})}):a.jsx("p",{className:"uploaded-file-list__empty",children:"No files uploaded yet."})}function Uz({isOpen:e,onClose:t,preview:r,previewing:i,importing:l,onImport:c,error:f}){if(!e)return null;const m=!!(r&&!i&&!l);return a.jsxs("div",{className:"preview-popout",role:"dialog","aria-modal":"true",children:[a.jsx("div",{className:"preview-popout__overlay",onClick:t}),a.jsxs("div",{className:"preview-popout__panel",children:[a.jsxs("header",{className:"preview-popout__header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"Import Preview"}),a.jsx("p",{children:"Review the summary before running the upload."})]}),a.jsx("button",{type:"button",onClick:t,"aria-label":"Close preview",className:"preview-popout__close",children:a.jsx(Ia,{size:20})})]}),a.jsxs("div",{className:"preview-popout__content",children:[i&&a.jsxs("div",{className:"preview-popout__state",children:[a.jsx(Nn,{className:"spin",size:28}),a.jsx("p",{children:"Generating preview"})]}),!i&&f&&a.jsxs("div",{className:"preview-popout__alert preview-popout__alert--error",children:[a.jsx(Ra,{size:18}),a.jsx("span",{children:f})]}),!i&&r&&a.jsxs("div",{className:"preview-popout__summary",children:[a.jsxs("div",{className:"preview-popout__summary-grid",children:[a.jsx(od,{label:"Total rows",value:r.total}),a.jsx(od,{label:"To create",value:r.createCount,tone:"success"}),a.jsx(od,{label:"Duplicates",value:r.duplicateCount,tone:"warn"}),a.jsx(od,{label:"Invalid",value:r.invalidCount,tone:"error"})]}),r.duplicateCount>0&&Array.isArray(r.duplicates)&&a.jsxs("div",{className:"preview-popout__list",children:[a.jsx("h3",{children:"Duplicate rows"}),a.jsx("ul",{children:r.duplicates.map(h=>a.jsxs("li",{children:[a.jsxs("span",{children:["Row ",h.row]}),a.jsx("span",{className:"preview-popout__list-name",children:h.name})]},h.row))})]}),r.invalidCount>0&&Array.isArray(r.invalidRows)&&a.jsxs("div",{className:"preview-popout__list",children:[a.jsx("h3",{children:"Invalid rows"}),a.jsx("ul",{children:r.invalidRows.map(h=>a.jsxs("li",{children:[a.jsxs("span",{children:["Row ",h.row]}),a.jsx("span",{className:"preview-popout__list-name",children:h.reason})]},h.row))})]})]})]}),a.jsxs("footer",{className:"preview-popout__footer",children:[a.jsx("button",{type:"button",className:"preview-popout__dismiss",onClick:t,children:"Cancel"}),a.jsxs("button",{type:"button",className:"preview-popout__confirm",disabled:!m,onClick:c,children:[l?a.jsx(Nn,{className:"spin",size:18}):a.jsx(fT,{size:18}),"Run upload"]})]})]})]})}function od({label:e,value:t,tone:r}){return a.jsxs("div",{className:`summary-metric${r?` summary-metric--${r}`:""}`,children:[a.jsx("span",{className:"summary-metric__label",children:e}),a.jsx("span",{className:"summary-metric__value",children:t}),r==="success"&&a.jsx("span",{className:"summary-metric__icon",children:a.jsx(Zd,{size:18})}),r==="warn"&&a.jsx("span",{className:"summary-metric__icon",children:a.jsx(Ra,{size:18})}),r==="error"&&a.jsx("span",{className:"summary-metric__icon",children:a.jsx(Ra,{size:18})})]})}function qz(){const{token:e}=En(),{activeWorldId:t,contextKey:r}=Un(),i=t||"",[l,c]=u.useState(null),[f,m]=u.useState(!1),[h,p]=u.useState(""),[y,g]=u.useState(""),[v,S]=u.useState([]),[w,N]=u.useState([]),[E,C]=u.useState(""),[A,O]=u.useState(null),[_,R]=u.useState(!1),[D,j]=u.useState(!1),[z,P]=u.useState(!1),[X,H]=u.useState(null),[G,V]=u.useState(!1),[k,F]=u.useState(""),I=u.useRef(null);u.useEffect(()=>{(async()=>{if(!i){N([]);return}R(!0);try{const Q=await P1(i),se=Array.isArray(Q?.data)?Q.data:Array.isArray(Q)?Q:[];N(se)}catch(Q){console.warn(" Failed to load entity types",Q),N([])}finally{R(!1)}})()},[i,r]);const L=async()=>{try{const fe=await fetch("/api/entities/upload",{headers:{Authorization:`Bearer ${e}`}});if(!fe.ok)throw new Error("Failed to fetch uploads");const Q=await fe.json();S(Q.files||[])}catch(fe){console.warn(" Could not fetch uploads",fe)}};u.useEffect(()=>{e&&L()},[e]);const $=fe=>{const Q=fe.target.files?.[0]??null;c(Q),p(""),g("")},T=async()=>{if(!l)return g("Please select a file to upload.");const fe=new FormData;fe.append("file",l),m(!0),p(""),g("");try{const Q=await fetch("/api/entities/upload",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:fe}),se=await Q.json();if(!Q.ok)throw new Error(se.message||"Upload failed");p("File uploaded successfully."),c(null),I.current&&(I.current.value=""),await L()}catch(Q){console.error("Upload error:",Q),g(Q.message)}finally{m(!1)}},U=async fe=>{if(window.confirm("Delete this upload?"))try{const Q=await fetch(`/api/entities/upload/${fe}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),se=await Q.json();if(!Q.ok)throw new Error(se.message||"Failed to delete file");p("File deleted."),A===fe&&(O(null),H(null)),await L()}catch(Q){console.error(" Delete error:",Q),g(Q.message)}},M=async()=>{if(E){g(""),p("");try{const fe=await fetch(`/api/entities/template/${E}`,{headers:{Authorization:`Bearer ${e}`}});if(!fe.ok)throw new Error("Failed to generate template");const Q=await fe.blob(),se=window.URL.createObjectURL(Q),ne=document.createElement("a");ne.href=se,ne.download="Entity_Template.xlsx",document.body.appendChild(ne),ne.click(),ne.remove(),window.URL.revokeObjectURL(se),p("Template generated successfully.")}catch(fe){console.error(" Template generation failed",fe),g("Failed to generate template")}}},q=async()=>{if(!E)return g("Select an Entity Type first.");if(!A)return g("Select an uploaded file to preview.");if(!i)return g("Select a world context before previewing.");P(!0),V(!0),H(null),F(""),p(""),g("");try{const fe=await fetch(`/api/entities/preview/${E}`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({fileId:A,worldId:i})}),Q=await fe.json();if(!fe.ok||!Q.success)throw new Error(Q.message||"Preview failed");H(Q.summary)}catch(fe){console.error(" Preview failed:",fe),F(fe.message)}finally{P(!1)}},Y=async()=>{if(!E)return g("Select an Entity Type first.");if(!A)return g("Select an uploaded file to import.");if(!i)return g("Select a world context before importing.");j(!0),p(""),g("");try{const fe=await fetch(`/api/entities/import/${E}`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({fileId:A,worldId:i})}),Q=await fe.json();if(!fe.ok)throw new Error(Q.message||"Import failed");p(Q.message||"Import completed successfully."),V(!1),H(null),await L()}catch(fe){console.error(" Import error:",fe),F(fe.message)}finally{j(!1)}},J=()=>{D||z||(V(!1),F(""))},ie=u.useMemo(()=>w.find(fe=>String(fe.id)===String(E))?.name??"",[w,E]),Z=u.useMemo(()=>v.find(fe=>fe.id===A)??null,[v,A]);return u.useEffect(()=>{O(null),H(null),V(!1),c(null),I.current&&(I.current.value=""),p(""),g(""),F("")},[E]),a.jsxs("div",{className:"bulk-upload-page",children:[a.jsxs("div",{className:"bulk-upload-page__header",children:[a.jsx("h1",{className:"bulk-upload-page__title",children:"Bulk Entity Upload"}),a.jsx("p",{className:"bulk-upload-page__subtitle",children:"Follow the guided steps to prepare your template, upload a data file, preview the import, and launch the upload from a dedicated review panel."})]}),h&&a.jsxs("div",{className:"bulk-upload-page__status",children:[a.jsx(Zd,{size:18}),a.jsx("span",{children:h})]}),y&&a.jsxs("div",{className:"bulk-upload-page__status bulk-upload-page__status--error",children:[a.jsx(Ra,{size:18}),a.jsx("span",{children:y})]}),a.jsxs("div",{className:"bulk-upload-page__grid",children:[a.jsx(Po,{step:"Select",title:"Choose an entity type",subtitle:_?"Loading entity types for this world...":"Pick which entity type you want to work with. Steps unlock after choosing.",children:a.jsxs("select",{value:E,onChange:fe=>C(fe.target.value),className:"entity-type-select",children:[a.jsx("option",{value:"",children:_?"Loading":"Select Entity Type"}),w.map(fe=>a.jsx("option",{value:fe.id,children:fe.name},fe.id))]})}),E&&a.jsxs(a.Fragment,{children:[a.jsx(Po,{step:1,title:"Generate a template",subtitle:"Download a spreadsheet tailored to the selected entity type.",children:a.jsxs("div",{className:"step-actions",children:[a.jsxs("button",{type:"button",className:"primary-action",onClick:M,children:[a.jsx(vT,{size:18}),"Download template"]}),ie&&a.jsxs("span",{className:"selected-file-banner",children:[a.jsx(Di,{size:16})," Template matches ",ie]})]})}),a.jsxs(Po,{step:2,title:"Upload your file",subtitle:"Upload the filled spreadsheet and pick which file to preview.",children:[a.jsxs("div",{className:"file-input",children:[a.jsxs("label",{htmlFor:"bulk-upload-file",children:[a.jsx(M0,{size:20}),a.jsxs("div",{children:[a.jsx("div",{className:"file-input__name",children:l?l.name:"Select a file to upload"}),a.jsx("small",{children:"Supported format: Excel (.xlsx)"})]})]}),a.jsx("input",{ref:I,id:"bulk-upload-file",type:"file",hidden:!0,onChange:$}),a.jsxs("button",{type:"button",className:"secondary-action",onClick:T,disabled:!l||f,children:[f?a.jsx(Nn,{className:"spin",size:18}):a.jsx(M0,{size:18}),"Upload file"]})]}),Z&&a.jsxs("div",{className:"selected-file-banner",children:[a.jsx(wT,{size:16})," Selected file: ",Z.file_name]}),a.jsx(Bz,{files:v,selectedId:A,onSelect:fe=>{O(fe),H(null)},onDelete:U})]}),a.jsx(Po,{step:3,title:"Run a preview",subtitle:"Review potential changes in the popout before committing to an upload.",children:a.jsxs("div",{className:"step-actions",children:[a.jsxs("button",{type:"button",className:"primary-action",onClick:q,disabled:!A||z,children:[z?a.jsx(Nn,{className:"spin",size:18}):a.jsx(S1,{size:18}),"Preview import"]}),a.jsx("span",{className:"bulk-upload-page__empty-state",children:"The upload can only be launched from the preview popout."})]})}),a.jsx(Po,{step:4,title:"Launch the upload",subtitle:"Confirm the summary inside the popout, then run the upload from there.",children:a.jsxs("div",{className:"step-actions",children:[a.jsxs("span",{className:"bulk-upload-page__empty-state",children:["After reviewing the preview, use the ",a.jsx("strong",{children:"Run upload"})," button in the panel to finish."]}),a.jsxs("span",{className:"selected-file-banner",children:[a.jsx(y1,{size:16})," Preview popout controls the final import."]})]})})]})]}),a.jsx(Uz,{isOpen:G,onClose:J,preview:X,previewing:z,importing:D,onImport:Y,error:k})]})}function by({content:e="",mentions:t=[],segments:r=null,noteId:i="note",textClassName:l="note-text",mentionClassName:c="note-mention",renderEmpty:f=null}){const m=u.useMemo(()=>Array.isArray(r)?r:fc(e,t),[e,t,r]);return!m||m.length===0?typeof f=="function"?f():null:m.map((h,p)=>{if(h.type==="mention"&&h.entityId){const y=h.entityName||"entity";return a.jsxs("span",{className:c,children:["@",y,a.jsx(Ls,{entityId:h.entityId,entityName:y})]},`${i}-mention-${p}`)}return a.jsx("span",{className:l,children:h.text},`${i}-text-${p}`)})}const Hz=2500,Ts=Object.freeze([]),Pz="Use @ to tag entities mentioned in this session.",Cp=(e="create")=>({mode:e,submitLabel:e==="edit"?"Save Changes":"Create Entity",submitDisabled:!1,cancelDisabled:!1,accessButtonVisible:!1,accessButtonDisabled:!1}),Ap=e=>{if(!e)return{id:"",sessionDate:"",sessionTitle:"Session note",content:"",mentions:Ts,createdAt:null,updatedAt:null,author:null,lastEditor:null};const t=e.sessionDate??e.session_date??"",r=e.sessionTitle??e.session_title??"Session note",i=typeof e.content=="string"?e.content:"",l=Array.isArray(e.mentions)?e.mentions.filter(Boolean).map(c=>{const f=c?.entityName??c?.entity_name??c?.label??c?.name??"",m=Ml(f);return{...c,entityName:m}}):Ts;return{id:e.id??"",sessionDate:t,sessionTitle:r,content:i,mentions:l,createdAt:e.createdAt??e.created_at??null,updatedAt:e.updatedAt??e.updated_at??null,author:e.author??null,lastEditor:e.lastEditor??null}},cd=()=>new Date().toISOString().slice(0,10),ud=e=>{if(!e)return"Undated session";const t=/^\d{4}-\d{2}-\d{2}$/.test(e)?`${e}T00:00:00Z`:e,r=new Date(t);return Number.isNaN(r.getTime())?e:r.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},Vz=e=>{if(!e)return"";const t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};function Yz(){const{user:e}=En(),{selectedCampaign:t,selectedCampaignId:r}=Un(),[i,l]=u.useState({items:Ts,loading:!1,error:""}),[c,f]=u.useState(""),[m,h]=u.useState(null),[p,y]=u.useState(!1),[g,v]=u.useState({status:"idle",lastSaved:"",error:""}),[S,w]=u.useState(""),[N,E]=u.useState(!1),[C,A]=u.useState(!1),[O,_]=u.useState(""),R=u.useRef(null),D=u.useRef(""),j=u.useRef(null),z=u.useRef(!1),P=u.useRef(""),[X,H]=u.useState(!1),[G,V]=u.useState(()=>Cp("create")),[k,F]=u.useState("details"),I=u.useRef(`entity-form-${Math.random().toString(36).slice(2)}`),L=u.useMemo(()=>t?.world?.id?t.world.id:t?.world_id?t.world_id:"",[t]),$=u.useMemo(()=>!t||!Array.isArray(t.members)||!e?null:t.members.find(Je=>Je?.user_id===e.id)?.role??null,[t,e]),T=u.useMemo(()=>e?.role==="system_admin"?!0:$==="dm",[$,e]),U=u.useMemo(()=>e?.role==="system_admin"||$==="dm"?!0:$==="player"?(t?.world?.entity_creation_scope??"")===uc.ALL_PLAYERS:!1,[$,e,t]),M=u.useCallback(async()=>{if(r){l(Ue=>({...Ue,loading:!0,error:""}));try{const Ue=await FM(r),Je=Array.isArray(Ue?.data)?Ue.data:Array.isArray(Ue)?Ue:[];l({items:Je,loading:!1,error:""})}catch(Ue){console.error(" Failed to load session notes",Ue),l({items:Ts,loading:!1,error:Ue?.message||"Failed to load session notes"})}}},[r]);u.useEffect(()=>{if(!r){l({items:Ts,loading:!1,error:""}),f(""),h(null),j.current=null;return}M()},[r,M]),u.useEffect(()=>{R.current=m},[m]),u.useEffect(()=>{D.current=c},[c]);const q=u.useMemo(()=>Array.isArray(i.items)?[...i.items].sort((Ue,Je)=>{const de=(Ue?.session_date??Ue?.sessionDate??"")||"",ue=(Je?.session_date??Je?.sessionDate??"")||"";if(de&&ue&&de!==ue)return ue.localeCompare(de);const ye=new Date(Ue?.updated_at??Ue?.updatedAt??Ue?.created_at??Ue?.createdAt??0).getTime();return new Date(Je?.updated_at??Je?.updatedAt??Je?.created_at??Je?.createdAt??0).getTime()-ye}):Ts,[i.items]),Y=u.useMemo(()=>{const Ue=S.trim().toLowerCase();return Ue?q.filter(Je=>{if(!Je)return!1;const de=String(Je?.session_title??Je?.sessionTitle??"Session note").toLowerCase(),ue=String(Je?.content??"").toLowerCase(),ye=ud(Je?.session_date??Je?.sessionDate??"").toString().toLowerCase();return de.includes(Ue)||ue.includes(Ue)||ye.includes(Ue)}):q},[S,q]),J=u.useMemo(()=>c&&q.find(Ue=>Ue?.id===c)||null,[q,c]),ie=u.useMemo(()=>m?.sessionDate?ud(m.sessionDate):"Undated session",[m?.sessionDate]),Z=u.useMemo(()=>m?.updatedAt?Vz(m.updatedAt):"",[m?.updatedAt]),fe=u.useMemo(()=>m?.content?fc(m.content,m.mentions):Ts,[m?.content,m?.mentions]);u.useEffect(()=>{const Ue=S.trim().length>0,Je=Y.length>0?Y:q;if(!c&&Je.length>0){f(Je[0].id);return}if(Ue&&Y.length===0){c&&f(""),h(null),j.current=null;return}if(c&&Y.length>0&&!Y.some(ye=>ye?.id===c)){f(Y[0].id);return}if(!c){h(null),j.current=null;return}if(!J){f(""),h(null),j.current=null;return}const de=Ap(J);h(de),j.current=de,v(ue=>({...ue,status:"idle",error:""}))},[Y,S,J,c,q]),u.useEffect(()=>{if(!c){E(!1);return}if(P.current&&P.current===c){E(!0),P.current="";return}E(!1)},[c]),u.useEffect(()=>{_("")},[c]),u.useEffect(()=>{w("")},[r]);const Q=u.useCallback((Ue,Je)=>{const de=typeof Je=="string"?Je:typeof Ue?.target?.value=="string"?Ue.target.value:"";h(ue=>ue&&{...ue,content:de})},[]),se=u.useCallback(async(Ue,Je)=>{const de=Ue?.trim()??"";if(typeof Je=="function"){if(!L||de.length===0){Je([]);return}try{const ue=await rf({worldId:L,query:de,limit:8}),ye=Array.isArray(ue?.data)?ue.data:ue,Ve=Array.isArray(ye)?ye.map(ee=>{const me=ee?.id??ee?.entity?.id;if(!me)return null;const he=ee?.name||ee?.displayName||ee?.entity?.name||"Unnamed entity",Se=Ml(he)||"Unnamed entity";return{id:me,display:Se}}).filter(Boolean):[];Je(Ve)}catch(ue){console.error(" Failed to search entities for mentions",ue),Je([])}}},[L]),ne=u.useCallback((Ue,Je)=>{h(de=>de&&{...de,[Ue]:Je})},[]),we=u.useMemo(()=>{if(!m?.id)return!1;const Ue={sessionTitle:(m.sessionTitle||"").trim(),sessionDate:m.sessionDate||"",content:m.content||""},Je=j.current||{},de={sessionTitle:(Je.sessionTitle||"").trim(),sessionDate:Je.sessionDate||"",content:Je.content||""};return JSON.stringify(Ue)!==JSON.stringify(de)},[m]),Ie=u.useCallback(async()=>{const Ue=r,Je=D.current,de=R.current;if(!Ue||!Je||!de||z.current)return;const ue={sessionTitle:de.sessionTitle?.trim()||"Session note",sessionDate:de.sessionDate||cd(),content:de.content||""},ye=j.current||{},Ve={sessionTitle:ye.sessionTitle?.trim()||"Session note",sessionDate:ye.sessionDate||cd(),content:ye.content||""};if(JSON.stringify(ue)!==JSON.stringify(Ve))try{z.current=!0,v(Se=>({...Se,status:"saving",error:""}));const ee=await UM(Ue,Je,ue),me=ee?.data??ee,he=Ap(me);j.current=he,h(he),l(Se=>{const We=Array.isArray(Se.items)?Se.items:Ts,Xe=We.some(et=>et?.id===me?.id)?We.map(et=>et?.id===me?.id?{...et,...me}:et):[me,...We];return{...Se,items:Xe}}),v({status:"saved",lastSaved:new Date().toISOString(),error:""})}catch(ee){console.error(" Failed to save session note",ee),v(me=>({...me,status:"error",error:ee?.message||"Failed to save session note"}))}finally{z.current=!1}},[r]);u.useEffect(()=>{if(!r||!m?.id||!we||z.current)return;const Ue=setTimeout(()=>{Ie()},Hz);return()=>clearTimeout(Ue)},[m,we,Ie,r]);const Me=u.useCallback(()=>{Ie()},[Ie]),Ae=u.useCallback(async()=>{const Ue=r,Je=D.current;if(!(!Ue||!Je)){A(!0),_("");try{await qM(Ue,Je),l(de=>{const ye=(Array.isArray(de.items)?de.items:Ts).filter(Ve=>String(Ve?.id)!==String(Je));return{...de,items:ye}}),D.current="",f(""),h(null),j.current=null,v({status:"idle",lastSaved:"",error:""})}catch(de){console.error(" Failed to delete session note",de),_(de?.message||"Failed to delete session note")}finally{A(!1)}}},[r]),it=u.useCallback(async()=>{if(r){y(!0),v(Ue=>({...Ue,error:""}));try{const Ue=await BM(r,{sessionTitle:`Session on ${ud(cd())}`,sessionDate:cd()}),Je=Ue?.data??Ue,de=Ap(Je);l(ue=>{const Ve=(Array.isArray(ue.items)?ue.items:Ts).filter(ee=>ee?.id!==Je?.id);return{...ue,items:[Je,...Ve],error:""}}),w(""),P.current=Je.id,f(Je.id),h(de),j.current=de,E(!0),v({status:"idle",lastSaved:"",error:""})}catch(Ue){console.error(" Failed to create session note",Ue),v(Je=>({...Je,status:"error",error:Ue?.message||"Failed to create session note"}))}finally{y(!1)}}},[r]),$e=u.useCallback(()=>{L&&(V(Cp("create")),F("details"),H(!0))},[L]),nt=u.useCallback(()=>{H(!1),V(Cp("create")),F("details")},[]),Le=u.useCallback(Ue=>{Ue&&V(Je=>({...Je,...Ue}))},[]),wt=u.useCallback(async Ue=>{nt()},[nt]),Tt=t?.name??"",Ct=q.length,At=u.useMemo(()=>{if(g.status==="saving")return"Saving";if(g.status==="error")return"Changes not saved";if(g.status==="saved"&&g.lastSaved){const Ue=new Date(g.lastSaved);return Number.isNaN(Ue.getTime())?"Saved":`Saved ${Ue.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})}`}return we?"Unsaved changes":""},[we,g]);return r?a.jsxs("div",{className:"notes-page",children:[a.jsx("div",{className:"notes-header",children:a.jsxs("div",{className:"notes-title",children:[a.jsx("h1",{children:"Session Notes"}),a.jsxs("p",{children:["Chronicle every game night for the ",a.jsx("strong",{children:Tt})," campaign, @mention key entities, and keep everyone aligned with auto-saving notes."]})]})}),a.jsxs("div",{className:"session-notes-meta",children:[a.jsxs("span",{children:[a.jsx(_1,{size:16})," Players and DMs can add or update notes."," ",a.jsx(T0,{size:16})," ",Ct," ",Ct===1?"session":"sessions"," tracked."]}),At?a.jsxs("span",{className:`session-notes-autosave status-${g.status}`,children:[g.status==="saving"?a.jsx(Nn,{size:14,className:"spinner"}):g.status==="saved"?a.jsx(g1,{size:14}):g.status==="error"?a.jsx(Pa,{size:14}):we?a.jsx(I0,{size:14}):null,a.jsx("span",{children:At})]}):null]}),i.error&&a.jsxs("div",{className:"notes-error",role:"alert",children:[a.jsxs("strong",{children:[a.jsx(Pa,{size:18})," Unable to load session notes"]}),a.jsx("span",{children:i.error})]}),a.jsxs("div",{className:"session-notes-layout",children:[a.jsxs("aside",{className:"session-notes-sidebar",children:[a.jsxs("label",{className:"session-notes-search",htmlFor:"session-notes-search-input",children:[a.jsx(ic,{size:16}),a.jsx("input",{id:"session-notes-search-input",type:"search",placeholder:"Search session notes",value:S,onChange:Ue=>w(Ue.target.value)})]}),a.jsxs("button",{type:"button",className:"session-notes-item-button session-notes-new-button",onClick:it,disabled:p||i.loading,children:[p?a.jsx(Nn,{size:16,className:"spinner"}):a.jsx(Ya,{size:16}),a.jsx("span",{children:p?"Creating":"New Session"})]}),a.jsx("div",{className:"session-notes-list-container",children:i.loading?a.jsxs("div",{className:"session-notes-loading",children:[a.jsx(Nn,{size:18,className:"spinner"}),a.jsx("span",{children:"Loading session notes"})]}):Y.length===0?q.length===0?a.jsxs("div",{className:"notes-empty",children:[a.jsx(Di,{size:20}),a.jsx("strong",{children:"No session notes yet"}),a.jsx("span",{children:"Create the first note to kick off your campaign journal."})]}):a.jsxs("div",{className:"notes-empty",children:[a.jsx(ic,{size:18}),a.jsx("strong",{children:"No matches"}),a.jsxs("span",{children:["No session notes include ",S.trim(),"."]})]}):a.jsx("ul",{className:"session-notes-list",role:"list",children:Y.map(Ue=>{const Je=Ue?.id,de=Je===c,ue=Ue?.session_title??Ue?.sessionTitle??"Session note",ye=ud(Ue?.session_date??Ue?.sessionDate);return a.jsx("li",{className:`session-notes-item ${de?"active":""}`,children:a.jsxs("button",{type:"button",className:"session-notes-item-button",onClick:()=>f(Je),children:[a.jsx("span",{className:"session-note-card-title",children:ue}),a.jsx("span",{className:"session-note-card-date",children:ye})]})},Je)})})})]}),a.jsx("section",{className:"session-notes-panel",children:m?.id?a.jsxs("div",{className:"session-note-shell",children:[a.jsxs("header",{className:"session-note-header",children:[a.jsx("div",{className:"session-note-heading",children:a.jsx("h2",{children:m.sessionTitle||"Session note"})}),a.jsxs("div",{className:"session-note-toolbar",children:[T?a.jsxs("button",{type:"button",className:"session-note-action danger",onClick:Ae,disabled:C,children:[C?a.jsx(Nn,{size:16,className:"spinner"}):a.jsx(ha,{size:16}),a.jsx("span",{children:C?"Deleting":"Delete"})]}):null,a.jsxs("button",{type:"button",className:"session-note-action",onClick:()=>E(Ue=>!Ue),children:[N?a.jsx(b1,{size:16}):a.jsx(ZT,{size:16}),a.jsx("span",{children:N?"View note":"Edit note"})]}),N&&U?a.jsxs("button",{type:"button",className:"session-note-action primary",onClick:$e,children:[a.jsx(Ya,{size:16}),a.jsx("span",{children:"Create Entity"})]}):null]})]}),O?a.jsxs("div",{className:"session-note-error",role:"alert",children:[a.jsx(Pa,{size:16}),a.jsx("span",{children:O})]}):null,N?a.jsxs("div",{className:"session-note-form",children:[a.jsxs("div",{className:"session-note-fields session-note-fields-row",children:[a.jsxs("div",{className:"session-note-field",children:[a.jsx("label",{htmlFor:"session-note-title",children:"Title"}),a.jsx("input",{id:"session-note-title",type:"text",value:m.sessionTitle||"",onChange:Ue=>ne("sessionTitle",Ue.target.value),placeholder:"The mystery of the Violet Spire"})]}),a.jsxs("div",{className:"session-note-field",children:[a.jsx("label",{htmlFor:"session-note-date",children:"Session date"}),a.jsx("input",{id:"session-note-date",type:"date",value:m.sessionDate||"",onChange:Ue=>ne("sessionDate",Ue.target.value),max:"9999-12-31"})]})]}),a.jsxs("div",{className:"session-note-fields",children:[a.jsx("label",{htmlFor:"session-note-content",children:"Notes"}),a.jsx("div",{className:"session-note-editor-field",children:a.jsx(Ld,{value:m.content||"",onChange:Q,markup:"@[__display__](__id__)",placeholder:Pz,className:"session-note-mentions",inputProps:{id:"session-note-content",className:"session-note-textarea","aria-label":"Session note content",rows:14},children:a.jsx(Tl,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(Ue,Je)=>`@${Je}`,data:se,appendSpaceOnAdd:!0})})}),a.jsx("div",{className:"session-note-save-button",children:a.jsxs("button",{type:"button",className:"session-note-action primary",onClick:Me,disabled:g.status==="saving"||!we,children:[g.status==="saving"?a.jsx(Nn,{size:16,className:"spinner"}):a.jsx(I0,{size:16}),a.jsx("span",{children:g.status==="saving"?"Saving":"Save now"})]})}),fe.length>0?a.jsxs("div",{className:"session-note-preview","aria-live":"polite",children:[a.jsx("h3",{children:"Preview"}),a.jsx("div",{className:"session-note-preview-content",children:a.jsx(by,{segments:fe,noteId:`${m?.id||"note"}-preview`,textClassName:"session-note-text",mentionClassName:"session-note-mention"})})]}):null]}),a.jsx("div",{className:"session-note-actions",children:m.author?.username?a.jsxs("span",{className:"session-note-meta",children:["Created by ",m.author.username,m.lastEditor?.username&&m.lastEditor.username!==m.author.username?`  Last updated by ${m.lastEditor.username}`:""]}):null})]}):a.jsxs("article",{className:"session-note-view","aria-live":"polite",children:[a.jsxs("div",{className:"session-note-view-meta",children:[a.jsxs("span",{children:[a.jsx(T0,{size:16})," ",ie]}),Z?a.jsxs("span",{children:["Updated ",Z]}):null]}),a.jsx("div",{className:"session-note-view-body",children:a.jsx(by,{segments:fe,noteId:`${m?.id||"note"}-view`,textClassName:"session-note-text",mentionClassName:"session-note-mention",renderEmpty:()=>a.jsx("p",{className:"session-note-view-empty",children:"No notes captured yet."})})}),m.author?.username?a.jsxs("div",{className:"session-note-view-meta session-note-view-authors",children:[a.jsxs("span",{children:["Created by ",m.author.username]}),m.lastEditor?.username&&m.lastEditor.username!==m.author.username?a.jsxs("span",{children:["Last updated by ",m.lastEditor.username]}):null]}):null]})]}):a.jsxs("div",{className:"notes-helper",children:[a.jsx(Bp,{size:28}),a.jsx("strong",{children:"Select a session to get started"}),a.jsx("span",{children:"Create a new note or choose one from the list to see its details."})]})})]}),a.jsx(Xr,{isOpen:X,onClose:nt,title:"Create Entity",width:420,footerActions:a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:nt,disabled:G.cancelDisabled,children:"Cancel"}),G.accessButtonVisible&&a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>F(Ue=>Ue==="access"?"details":"access"),disabled:G.accessButtonDisabled,children:k==="access"?"Details":"Access"}),a.jsx("button",{type:"submit",className:"btn submit",form:I.current,disabled:G.submitDisabled,children:G.submitLabel})]}),children:a.jsx(uN,{worldId:L,entityId:null,onCancel:nt,onSaved:wt,formId:I.current,onStateChange:Le,hideActions:!0,activeView:k,onViewChange:F,defaultCampaignId:r||""})})]}):a.jsxs("div",{className:"notes-page",children:[a.jsx("div",{className:"notes-header",children:a.jsxs("div",{className:"notes-title",children:[a.jsx("h1",{children:"Session Notes"}),a.jsx("p",{children:"Select a campaign from the header to start collecting your notes."})]})}),a.jsxs("div",{className:"notes-helper",children:[a.jsx(Bp,{size:28}),a.jsx("strong",{children:"No campaign selected"}),a.jsx("span",{children:"Pick a campaign to unlock collaborative session notes."})]})]})}const Gz={private:"Private",party:"Party",companions:"Companions",dm:"DM"},Xz=[{value:"private",label:"Private"},{value:"companions",label:"My Companions"}],Kz=[{value:"private",label:"Private"},{value:"party",label:"Share with Party"}],Wz="What do you want to remember?",Zz=e=>{if(!e)return"";const t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})},vi=e=>{const t=[e?.entityId,e?.entity_id,e?.entity?.id];for(const r of t)if(r)return String(r);return""},Tp=e=>{const t=[e?.author?.id,e?.createdBy,e?.created_by];for(const r of t)if(r)return String(r);return""},Tw=e=>{const t=e?.author;return t?.username?t.username:t?.email?t.email:e?.character?.name?`${e.character.name} (Character)`:(e?.created_by,"Unknown author")},Mw=e=>e?.entity?.name?e.entity.name:typeof e?.entityName=="string"&&e.entityName.trim()?e.entityName:"Unnamed entity",vy=e=>{const t=[e?.entity?.entityTypeId,e?.entity?.entity_type_id,e?.entity?.entityType?.id,e?.entity?.entityType?.entity_type_id];for(const r of t)if(r)return String(r);return""},Qz=(e,t=new Map)=>{if(e?.entity?.entityType?.name)return e.entity.entityType.name;const r=vy(e);return r&&t.has(r)?t.get(r):""};function Jz(){const{selectedCampaign:e,selectedCampaignId:t}=Un(),{user:r}=En(),[i,l]=u.useState({items:[],loading:!1,error:""}),[c,f]=u.useState(""),[m,h]=u.useState(""),[p,y]=u.useState(""),[g,v]=u.useState(null),[S,w]=u.useState(""),[N,E]=u.useState("private"),[C,A]=u.useState(""),[O,_]=u.useState(!1),[R,D]=u.useState(null),[j,z]=u.useState(""),[P,X]=u.useState([]),[H,G]=u.useState(!1),[V,k]=u.useState(""),[F,I]=u.useState([]),[L,$]=u.useState(!1),T=u.useCallback(async()=>{if(t){l(de=>({...de,loading:!0,error:""}));try{const de=await $M(t),ue=Array.isArray(de?.data)?de.data:Array.isArray(de)?de:[];l({items:ue,loading:!1,error:""})}catch(de){console.error(" Failed to load campaign entity notes",de),l({items:[],loading:!1,error:de?.message||"Failed to load entity notes"})}}},[t]);u.useEffect(()=>{if(!t){l({items:[],loading:!1,error:""});return}T()},[t,T]),u.useEffect(()=>{f(""),h(""),y(""),v(null),w(""),E("private"),A(""),z("")},[t]);const M=u.useMemo(()=>!e||!r?.id?null:(Array.isArray(e.members)?e.members:[]).find(ye=>{if(!ye)return!1;const Ve=ye.user_id??ye.userId??ye.user?.id??ye.id??null;return Ve?String(Ve)===String(r.id):!1})||null,[e,r?.id])?.role??null,q=u.useMemo(()=>r?.role==="system_admin"?!0:M==="dm",[M,r?.role]),Y=u.useMemo(()=>M==="player",[M]),J=u.useMemo(()=>e?.world?.id?e.world.id:e?.world_id?e.world_id:"",[e]);u.useEffect(()=>{let de=!1;return J?((async()=>{$(!0);try{const ye=await Jr({worldId:J});if(de)return;const ee=(Array.isArray(ye?.data)?ye.data:Array.isArray(ye)?ye:[]).map(me=>({id:me?.id?String(me.id):"",name:me?.name||"Unnamed type"})).filter(me=>me.id);I(ee)}catch(ye){if(de)return;console.error("Failed to load entity types",ye),I([])}finally{de||$(!1)}})(),()=>{de=!0}):(I([]),$(!1),()=>{de=!0})},[J]);const ie=u.useMemo(()=>q?Kz:Xz,[q]),Z=u.useCallback(de=>{if(!r||!de)return!1;const ue=de?.author?.id??de?.createdBy??de?.created_by??de?.authorId??de?.author_id??null;return ue?String(ue)===String(r.id):!1},[r]);u.useEffect(()=>{let de=!1;return!Y||!t?(X([]),G(!1),k(""),A(""),()=>{de=!0}):((async()=>{G(!0),k("");try{const ye=await Is({scope:"my",campaign_id:t});if(de)return;const ee=(Array.isArray(ye?.data)?ye.data:Array.isArray(ye)?ye:[]).map(me=>({id:me?.id?String(me.id):"",name:me?.name||"Unnamed character"})).filter(me=>me.id);X(ee),ee.length===1?A(ee[0].id):ee.some(me=>me.id===C)||A("")}catch(ye){if(de)return;console.error("Failed to load characters for notes",ye),X([]),A(""),k(ye.message||"Failed to load characters")}finally{de||G(!1)}})(),()=>{de=!0})},[Y,t,C]);const fe=u.useCallback(async(de,ue)=>{const ye=de?.trim()??"";if(typeof ue!="function")return;if(ye.length===0){ue([]);return}let Ve="";if(g){const he=i.items.find(Se=>Se?.id===g);he&&(Ve=vi(he))}if(Ve||(Ve=c||""),!Ve){ue([]);return}const ee=i.items.find(he=>vi(he)===Ve),me=ee?.entity?.world_id??ee?.entity?.world?.id??"";if(!me){ue([]);return}try{const he=await rf({worldId:me,query:ye,limit:8}),Se=Array.isArray(he?.data)?he.data:he,We=Array.isArray(Se)?Se.map(Xe=>{const et=Xe?.id??Xe?.entity?.id;if(!et)return null;const Te=Xe?.name||Xe?.displayName||Xe?.entity?.name||"Unnamed entity",mt=Ml(Te)||"Unnamed entity";return{id:et,display:mt}}).filter(Boolean):[];ue(We)}catch(he){console.error("Failed to search entities for mentions",he),ue([])}},[c,i.items,g]),Q=u.useCallback(de=>{if(!de)return;const ue=de?.characterId??de?.character_id??"";v(de.id),w(de?.content??""),E(de?.shareType??de?.share_type??"private"),A(ue),z("")},[]),se=u.useCallback(()=>{v(null),w(""),E("private"),A(""),z("")},[]),ne=u.useCallback((de,ue)=>{const ye=typeof ue=="string"?ue:typeof de?.target?.value=="string"?de.target.value:"";w(ye),z("")},[]),we=u.useCallback(async de=>{if(!de||!t)return;const ue=S.trim();if(!ue){z("Please enter a note before saving");return}const ye=vi(de);if(!ye){z("Unable to determine entity for this note");return}const Ve=de?.characterId??de?.character_id??"";if(Y&&Ve&&!C){z("Select which character this note is for");return}_(!0),z("");try{const ee={content:ue,shareType:N,campaignId:t};Y&&C&&(ee.characterId=C);const me=await U1(ye,de.id,ee),he=me?.data||me;if(!he)throw new Error("Note could not be updated");l(Se=>{const We=Array.isArray(Se?.items)?Se.items.slice():[],Xe=he?.id;if(!Xe)return Se;const et=We.findIndex(Te=>Te?.id===Xe);if(et>=0){const Te=[...We];return Te[et]=he,{items:Te,loading:!1,error:""}}return Se}),se()}catch(ee){console.error("Failed to update note",ee),z(ee.message||"Failed to update note")}finally{_(!1)}},[t,S,N,C,Y,se]),Ie=u.useCallback(async de=>{if(!de?.id||!t||!window.confirm("Are you sure you want to delete this note? This action cannot be undone."))return;const ye=vi(de);if(!ye){z("Unable to determine entity for this note");return}D(de.id),z("");try{await q1(ye,de.id,{campaignId:t}),l(Ve=>({items:(Array.isArray(Ve?.items)?Ve.items.slice():[]).filter(he=>he?.id!==de.id),loading:!1,error:""}))}catch(Ve){console.error("Failed to delete note",Ve),z(Ve.message||"Failed to delete note")}finally{D(null)}},[t]),Me=u.useCallback(de=>{const ue=fc(de?.content,de?.mentions);return ue.length?ue.map((ye,Ve)=>{if(ye.type==="mention"&&ye.entityId){const ee=`${de?.id||"note"}-mention-${Ve}`,me=ye.entityName||"entity";return a.jsxs("span",{className:"note-mention",children:["@",me]},ee)}return a.jsx("span",{className:"note-text",children:ye.text},`${de?.id||"note"}-text-${Ve}`)}):null},[]),Ae=u.useMemo(()=>Array.isArray(i.items)?[...i.items].sort((de,ue)=>{const ye=new Date(de?.created_at||de?.createdAt||0).getTime(),Ve=new Date(ue?.created_at||ue?.createdAt||0).getTime();return Number.isNaN(Ve)?-1:Number.isNaN(ye)?1:Ve-ye}):[],[i.items]),it=u.useMemo(()=>{const de=new Map;return Ae.forEach(ue=>{const ye=vi(ue);if(!ye)return;const Ve=Mw(ue);de.has(ye)||de.set(ye,Ve)}),Array.from(de.entries()).map(([ue,ye])=>({id:ue,name:ye})).sort((ue,ye)=>ue.name.localeCompare(ye.name,void 0,{sensitivity:"base"}))},[Ae]),$e=u.useMemo(()=>{const de=new Map;return Ae.forEach(ue=>{const ye=Tp(ue);if(!ye)return;const Ve=Tw(ue);de.has(ye)||de.set(ye,Ve)}),Array.from(de.entries()).map(([ue,ye])=>({id:ue,name:ye})).sort((ue,ye)=>ue.name.localeCompare(ye.name,void 0,{sensitivity:"base"}))},[Ae]),nt=u.useMemo(()=>{const de=new Map;return F.forEach(ue=>{ue.id&&de.set(ue.id,ue.name)}),de},[F]),Le=u.useMemo(()=>{const de=new Map;return Ae.forEach(ue=>{const ye=vy(ue);if(!ye)return;const Ve=Qz(ue,nt)||`Type ${ye.slice(0,8)}`;de.has(ye)||de.set(ye,Ve)}),Array.from(de.entries()).map(([ue,ye])=>({id:ue,name:ye})).sort((ue,ye)=>ue.name.localeCompare(ye.name,void 0,{sensitivity:"base"}))},[Ae,nt]),wt=u.useMemo(()=>Ae.filter(de=>{const ue=vi(de),ye=Tp(de),Ve=vy(de);return!(c&&ue!==c||m&&ye!==m||p&&Ve!==p)}),[Ae,c,m,p]),Tt=u.useCallback(()=>{if(!r?.id)return;const de=String(r.id),ue=$e.find(ye=>Ae.find(ee=>Tp(ee)===ye.id&&Z(ee))!==void 0);ue?(h(ue.id),f("")):$e.some(ye=>ye.id===de)&&(h(de),f(""))},[r?.id,$e,Ae,Z]),Ct=e?.name??"",At=wt.length,Ue=Ae.length,Je=!!(c||m||p);return t?a.jsxs("div",{className:"notes-page",children:[a.jsxs("div",{className:"notes-header",children:[a.jsxs("div",{className:"notes-title",children:[a.jsx("h1",{children:"Entity Notes"}),a.jsxs("p",{children:["Browse the notes created for entities in the"," ",a.jsx("strong",{children:Ct})," campaign, filter by entity or author, and jump back into the context of your adventures."]})]}),a.jsx("div",{className:"notes-actions",children:a.jsxs("button",{type:"button",className:"notes-action-button",onClick:T,disabled:i.loading,title:"Reload notes",children:[a.jsx(Ll,{size:16}),a.jsx("span",{children:i.loading?"Loading":"Reload"})]})})]}),a.jsxs("div",{className:"notes-filters",children:[a.jsxs("div",{className:"notes-filter-group",children:[a.jsx("label",{htmlFor:"entity-filter",children:"Entity"}),a.jsxs("select",{id:"entity-filter",value:c,onChange:de=>f(de.target.value),disabled:i.loading||it.length===0,children:[a.jsx("option",{value:"",children:"All entities"}),it.map(de=>a.jsx("option",{value:de.id,children:de.name},de.id))]})]}),a.jsxs("div",{className:"notes-filter-group",children:[a.jsx("label",{htmlFor:"author-filter",children:"Author"}),a.jsxs("select",{id:"author-filter",value:m,onChange:de=>h(de.target.value),disabled:i.loading||$e.length===0,children:[a.jsx("option",{value:"",children:"All authors"}),$e.map(de=>a.jsx("option",{value:de.id,children:de.name},de.id))]})]}),a.jsxs("div",{className:"notes-filter-group",children:[a.jsx("label",{htmlFor:"entity-type-filter",children:"Entity type"}),a.jsxs("select",{id:"entity-type-filter",value:p,onChange:de=>y(de.target.value),disabled:i.loading||Le.length===0,children:[a.jsx("option",{value:"",children:"All entity types"}),Le.map(de=>a.jsx("option",{value:de.id,children:de.name},de.id))]})]}),a.jsxs("button",{type:"button",className:"notes-action-button",onClick:()=>{f(""),h(""),y("")},disabled:!Je,children:[a.jsx(Qd,{size:16}),a.jsx("span",{children:"Reset filters"})]}),r?.id&&a.jsx("button",{type:"button",className:"notes-action-button",onClick:Tt,title:"Show only my notes",children:a.jsx("span",{children:"My notes"})})]}),a.jsxs("div",{className:"notes-meta",children:[a.jsxs("span",{children:["Showing ",a.jsx("strong",{children:At})," of ",a.jsx("strong",{children:Ue})," ",Ue===1?"note":"notes",Je?" (filtered)":""]}),i.loading&&a.jsx("span",{children:"Loading latest notes"})]}),i.error&&a.jsxs("div",{className:"notes-error",role:"alert",children:[a.jsxs("strong",{children:[a.jsx(Pa,{size:18})," Unable to load entity notes"]}),a.jsx("span",{children:i.error})]}),!i.loading&&!i.error&&wt.length===0&&a.jsxs("div",{className:"notes-empty",children:[a.jsx("strong",{children:"No notes to show"}),a.jsx("span",{children:Ue===0?"No entity notes have been shared in this campaign yet.":"Adjust your filters to see more notes."})]}),j&&a.jsxs("div",{className:"notes-error",role:"alert",children:[a.jsxs("strong",{children:[a.jsx(Pa,{size:18})," Error"]}),a.jsx("span",{children:j})]}),wt.length>0&&a.jsx("div",{className:"notes-list",children:wt.map(de=>{const ue=vi(de),ye=String(de?.shareType||de?.share_type||"private"),Ve=de?.created_at||de?.createdAt,ee=Ve?new Date(Ve):null,me=Zz(ee),he=ee&&!Number.isNaN(ee.getTime())?ee.toISOString():"",Se=Tw(de),We=de?.character?.name??"",Xe=Mw(de),et=g===de?.id,Te=Z(de);return a.jsx("article",{className:"note-card",children:et?a.jsxs("div",{className:"entity-notes-strict-edit-panel",style:{padding:"1rem"},children:[a.jsx(Ld,{value:S,onChange:ne,markup:"@[__display__](__id__)",placeholder:Wz,className:"entity-note-mentions",inputProps:{className:"entity-notes-strict-textarea","aria-label":"Edit note content",rows:5,required:!0},children:a.jsx(Tl,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(mt,Dt)=>`@${Dt}`,data:fe,appendSpaceOnAdd:!0})}),a.jsx("p",{style:{marginTop:"0.75rem",marginBottom:"0.5rem",fontWeight:600},children:"Share with"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"0.75rem"},children:ie.map(mt=>a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx("input",{type:"radio",name:`entity-note-share-edit-${de.id}`,value:mt.value,checked:N===mt.value,onChange:()=>E(mt.value),disabled:O}),mt.value==="private"?"Private":mt.value==="party"?"Share with Party":mt.label]},mt.value))}),Y&&P.length>0&&a.jsxs("div",{style:{marginBottom:"0.75rem"},children:[a.jsx("label",{htmlFor:`edit-character-${de.id}`,style:{display:"block",marginBottom:"0.25rem",fontWeight:600},children:"Character"}),a.jsx("select",{id:`edit-character-${de.id}`,value:C,onChange:mt=>A(mt.target.value),disabled:H||P.length===1,style:{width:"100%",padding:"0.5rem",borderRadius:"8px",border:"1px solid #cbd5f5"},children:P.map(mt=>a.jsx("option",{value:mt.id,children:mt.name},mt.id))})]}),j?a.jsxs("div",{className:"notes-error",style:{marginTop:"0.75rem",marginBottom:"0.75rem"},children:[a.jsx(Pa,{size:16}),a.jsx("span",{children:j})]}):null,a.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.75rem"},children:[a.jsx("button",{type:"button",className:"notes-action-button",onClick:()=>we(de),disabled:O||!S.trim(),children:O?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:16,style:{animation:"spinner-rotate 1s linear infinite"}}),"Saving"]}):"Save"}),a.jsx("button",{type:"button",className:"notes-action-button",onClick:se,disabled:O,style:{background:"#64748b"},children:"Cancel"})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("header",{className:"note-card-header",children:[a.jsx("div",{className:"note-entity-meta",children:a.jsx("h2",{children:ue?a.jsxs("span",{className:"entity-link-with-preview",children:[a.jsx(Qt,{to:`/entities/${ue}`,className:"entity-name-link",children:Xe}),a.jsx(Ls,{entityId:ue,entityName:Xe})]}):Xe})}),a.jsx("div",{className:"note-tags",children:a.jsx("span",{className:`note-tag share-${ye}`,children:Gz[ye]??ye})})]}),a.jsxs("div",{className:"note-details",children:[a.jsxs("span",{children:["Author: ",Se]}),We?a.jsxs("span",{children:["Character: ",We]}):null,me?a.jsxs("span",{children:["Created:"," ",a.jsx("time",{dateTime:he||void 0,children:me})]}):null]}),a.jsx("div",{className:"note-content",children:Me(de)||a.jsx(by,{content:de?.content,mentions:de?.mentions,noteId:de?.id||ue||"note",textClassName:"note-text",mentionClassName:"note-mention"})}),Te&&a.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",paddingTop:"0.75rem",borderTop:"1px solid rgba(15, 23, 42, 0.1)"},children:[a.jsxs("button",{type:"button",className:"notes-action-button",onClick:()=>Q(de),style:{background:"#1e40af",color:"#fff"},children:[a.jsx(N1,{size:14}),a.jsx("span",{children:"Edit"})]}),a.jsxs("button",{type:"button",className:"notes-action-button",onClick:()=>Ie(de),disabled:R===de.id,style:{background:"#dc2626",color:"#fff"},children:[R===de.id?a.jsx(Nn,{size:14,className:"spin",style:{animation:"spinner-rotate 1s linear infinite"}}):a.jsx(ha,{size:14}),a.jsx("span",{children:R===de.id?"Deleting":"Delete"})]})]})]})},de.id??`${ue}-${he||"unknown"}`)})})]}):a.jsxs("div",{className:"notes-page",children:[a.jsx("div",{className:"notes-header",children:a.jsxs("div",{className:"notes-title",children:[a.jsx("h1",{children:"Entity Notes"}),a.jsx("p",{children:"Select a campaign from the header to view entity notes."})]})}),a.jsxs("div",{className:"notes-empty",children:[a.jsx("strong",{children:"No campaign selected"}),a.jsx("span",{children:"Pick a campaign to explore its shared entity notes."})]})]})}const e$=(e,t)=>Rt.post("/access/bulk/apply",e,t),t$=({worldId:e})=>{if(!e)return Promise.reject(new Error("worldId is required"));const t=new URLSearchParams({worldId:e});return Rt.get(`/access/bulk/runs?${t.toString()}`)},n$=e=>e?Rt.get(`/access/bulk/runs/${e}`):Promise.reject(new Error("runId is required")),a$=e=>e?Rt.post(`/access/bulk/runs/${e}/revert`):Promise.reject(new Error("runId is required")),hj=e=>{if(!e)return Promise.reject(new Error("worldId is required"));const t=new URLSearchParams({worldId:e});return Rt.get(`/access/collections?${t.toString()}`)},s$=e=>Rt.post("/access/collections",e),r$=(e,t)=>e?Rt.put(`/access/collections/${e}`,t):Promise.reject(new Error("Collection id is required")),i$=e=>e?Rt.delete(`/access/collections/${e}`):Promise.reject(new Error("Collection id is required")),l$=e=>e?Rt.get(`/access/collections/${e}/entities`):Promise.reject(new Error("Collection id is required")),tr=1e3,ga={NAME:"name",NAME_DESCRIPTION:"nameDescription",ALL_DATA:"allData",ALL_DATA_RELATIONSHIPS:"allDataRelationships"},jd=[{value:ga.NAME,label:"Name only",description:"Matches entity names only."},{value:ga.NAME_DESCRIPTION,label:"Name & description",description:"Matches entity names and their descriptions."},{value:ga.ALL_DATA,label:"All data",description:"Matches names, descriptions, and visible data fields."},{value:ga.ALL_DATA_RELATIONSHIPS,label:"All data & relationships",description:"Matches every field plus reference values, ideal for relationship lookups."}],Rw={[ga.NAME]:"Filter entities by name",[ga.NAME_DESCRIPTION]:"Search names or descriptions",[ga.ALL_DATA]:"Search names, descriptions, and data fields",[ga.ALL_DATA_RELATIONSHIPS]:"Search across data and related entities"},kw=140,nc=(e,t)=>{if(t==null||typeof t=="number"&&!Number.isFinite(t))return;const i=(t instanceof Date?t.toISOString():String(t)).trim().toLowerCase();i&&e.add(i)},xy=(e,t,r)=>{if(e!=null){if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"){nc(r,e);return}if(e instanceof Date){nc(r,e);return}if(Array.isArray(e)){e.forEach(i=>xy(i,t,r));return}t&&typeof e=="object"&&Object.values(e).forEach(i=>xy(i,t,r))}},o$=(e,t)=>{if(!e)return[];const r=t&&jd.some(l=>l.value===t)?t:ga.NAME,i=new Set;return nc(i,e.name),r!==ga.NAME&&nc(i,e.description),(r===ga.ALL_DATA||r===ga.ALL_DATA_RELATIONSHIPS)&&(nc(i,e.entityType?.name),e.metadata&&typeof e.metadata=="object"&&xy(e.metadata,r===ga.ALL_DATA_RELATIONSHIPS,i)),Array.from(i)},Dw=(e,t="start")=>{if(!e)return null;const r=new Date(e);return Number.isNaN(r.getTime())?null:(t==="end"?r.setHours(23,59,59,999):r.setHours(0,0,0,0),r.getTime())},Iw=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})},c$=e=>{if(!e)return"";const t=Iw(e.updatedAt||e.updated_at);if(t)return`Updated ${t}`;const r=Iw(e.createdAt||e.created_at);return r?`Created ${r}`:""},u$=e=>{if(!e)return"";const t=e.summary||e.summary_text||e.description||e.system_prompt||e.notes||"",r=typeof t=="string"?t.replace(/\s+/g," ").trim():"";return r?r.length<=kw?r:`${r.slice(0,kw-1).trim()}`:""},Vo=({label:e,count:t,options:r=[],selectedValues:i=[],onToggle:l,disabled:c})=>{const f=m=>{c||l(String(m))};return a.jsxs("div",{className:"token-selector",children:[a.jsxs("div",{className:"token-selector__label-row",children:[a.jsx("span",{children:e}),a.jsxs("span",{className:"token-selector__count",children:["(",t,")"]})]}),a.jsx("div",{className:"token-selector__chips",role:"listbox","aria-multiselectable":!0,children:r.length===0?a.jsx("p",{className:"token-selector__empty",children:"No options available."}):r.map(m=>{const h=String(m.id),p=i.includes(h);return a.jsx("button",{type:"button",className:`token-selector__chip ${p?"selected":""}`,onClick:()=>f(h),"aria-pressed":p,disabled:c,children:m.label},h)})})]})},zr=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],Mp=(e,t="name")=>e.map(r=>({id:String(r.id??r.value??r),label:r[t]||r.name||r.email||r.id})),Lw=e=>{const t=e.filter(r=>r.count>0).map(r=>`${r.count} ${r.label}${r.count===1?"":"s"}`);return t.length===0?"":t.length===1?t[0]:t.length===2?`${t[0]} and ${t[1]}`:`${t.slice(0,-1).join(", ")}, and ${t[t.length-1]}`};function Ow(){const{worldId:e,campaignId:t}=Ss(),r=$n(),{user:i}=En(),{selectedCampaign:l,selectedCampaignId:c,setSelectedCampaignId:f,loading:m}=Un(),[h,p]=u.useState(null),[y,g]=u.useState(""),[v,S]=u.useState(!0),[w,N]=u.useState([]),[E,C]=u.useState([]),[A,O]=u.useState([]),[_,R]=u.useState([]),[D,j]=u.useState(!1),[z,P]=u.useState(""),[X,H]=u.useState(""),[G,V]=u.useState(ga.NAME),[k,F]=u.useState(""),[I,L]=u.useState(""),[$,T]=u.useState([]),[U,M]=u.useState(!1),[q,Y]=u.useState(""),[J,ie]=u.useState(null),[Z,fe]=u.useState({readCampaignIds:[],readUserIds:[],readCharacterIds:[],writeCampaignIds:[],writeUserIds:[],description:""}),[Q,se]=u.useState("unchanged"),[ne,we]=u.useState("unchanged"),[Ie,Me]=u.useState(!1),[Ae,it]=u.useState("manual"),[$e,nt]=u.useState([]),[Le,wt]=u.useState(!1),[Tt,Ct]=u.useState(""),[At,Ue]=u.useState(""),[Je,de]=u.useState(null),[ue,ye]=u.useState(!1),Ve=!!t,ee=t?String(t):"",me=u.useMemo(()=>!Ve||!ee||!c?!1:String(c)===ee,[Ve,ee,c]),he=Ve&&me?l:null,Se=e||he?.world?.id||"";u.useEffect(()=>{!Ve||!ee||String(c||"")!==ee&&f(ee)},[Ve,ee,c,f]);const We=u.useMemo(()=>Ve||!h||!i?!1:String(h.created_by)===String(i.id),[Ve,h,i]),Xe=u.useMemo(()=>!Ve||!he||!i?.id||!Array.isArray(he.members)?!1:he.members.some(ke=>ke?.user_id===i.id&&ke?.role==="dm"),[he,Ve,i]),et=!!(Ve&&he&&Xe),Te=We||et;u.useEffect(()=>{if(!Se||!Te){nt([]),Ct(""),Ue(""),de(null);return}let ke=!1;return(async()=>{wt(!0),Ct("");try{const ht=await hj(Se),K=zr(ht);ke||nt(K)}catch(ht){ke||(console.error("Failed to load collections",ht),nt([]),Ct(ht.message||"Failed to load collections"))}finally{ke||wt(!1)}})(),()=>{ke=!0}},[Se,Te]),u.useEffect(()=>{if(Ve){if(!ee){g("Campaign id is required to use this tool."),S(!1);return}if(!he){if(m){S(!0);return}g("Campaign not found or unavailable for your account."),S(!1);return}p(he.world||null),g(""),S(!1);return}if(!e){g("A world id is required to use the bulk access tool."),S(!1);return}(async()=>{S(!0),g("");try{const Pe=await Ol(),K=zr(Pe).find(ae=>String(ae.id)===String(e));if(!K){g("World not found or unavailable."),p(null);return}p(K)}catch(Pe){console.error("Failed to load worlds",Pe),g(Pe.message||"Failed to load world data"),p(null)}finally{S(!1)}})()},[he,m,Ve,ee,e]);const mt=u.useCallback(async()=>{if(!(!Se||!Te)){j(!0),P("");try{if(Ve&&he){const[ke,Pe]=await Promise.all([lc(Se),Is({campaign_id:he.id})]);N(zr(ke)),C([he]),O(zr(Pe));const ht=Array.isArray(he.members)?he.members.map(K=>({id:String(K.user_id),username:K.user?.username||K.user?.email||K.user_id})):[];R(ht)}else{const[ke,Pe,ht,K]=await Promise.all([lc(Se),jc({world_id:Se}),Is({world_id:Se}),Zy()]);N(zr(ke)),C(zr(Pe)),O(zr(ht)),R(zr(K))}}catch(ke){console.error("Failed to load bulk access data",ke),P(ke.message||"Unable to load world data")}finally{j(!1)}}},[he,Te,Ve,Se]);u.useEffect(()=>{mt()},[mt]);const Dt=u.useMemo(()=>Ve?new Set((A||[]).map(ke=>String(ke.id))):new Set,[A,Ve]),Nt=u.useMemo(()=>{if(!Ve)return w;if(!he)return[];const ke=String(he.id);return w.filter(Pe=>(Pe.read_access??"global")==="global"||(Array.isArray(Pe.read_campaign_ids)?Pe.read_campaign_ids.map(Ne=>String(Ne)):[]).includes(ke)?!0:(Array.isArray(Pe.read_character_ids)?Pe.read_character_ids.map(Ne=>String(Ne)):[]).some(Ne=>Dt.has(Ne)))},[he,Dt,w,Ve]);u.useEffect(()=>{const ke=new Set(Nt.map(Pe=>Pe.id));T(Pe=>{const ht=Pe.filter(K=>ke.has(K));return ht.length===Pe.length?Pe:ht})},[Nt]);const Ge=u.useMemo(()=>{const ke=X.trim().toLowerCase(),Pe=Dw(k,"start"),ht=Dw(I,"end");return Nt.filter(K=>{const ae=K.createdAt??K.created_at??null;if(Pe!==null||ht!==null){if(!ae)return!1;const qe=new Date(ae).getTime();if(Number.isNaN(qe)||Pe!==null&&qe<Pe||ht!==null&&qe>ht)return!1}if(!ke)return!0;const Ne=o$(K,G);return Ne.length?Ne.some(qe=>qe.includes(ke)):!1})},[Nt,X,G,k,I]),vt=u.useMemo(()=>jd.find(ke=>ke.value===G),[G]),Mt=Rw[G]||Rw[ga.NAME],Bt=ke=>{const Pe=ke.target.value,ht=jd.some(K=>K.value===Pe);V(ht?Pe:ga.NAME)},Jt=()=>{F(""),L("")};u.useEffect(()=>{if(!Ve||!he)return;const ke=String(he.id),Pe=new Set([ke]),ht=new Set((_||[]).map(ae=>String(ae.id))),K=new Set((A||[]).map(ae=>String(ae.id)));fe(ae=>{const Ne=(en,dn)=>en.filter(Zt=>dn.has(String(Zt))),qe=Ne(ae.readCampaignIds,Pe),gt=Ne(ae.writeCampaignIds,Pe),St=Ne(ae.readUserIds,ht),_t=Ne(ae.writeUserIds,ht),qt=Ne(ae.readCharacterIds,K);return qe.length===ae.readCampaignIds.length&&gt.length===ae.writeCampaignIds.length&&St.length===ae.readUserIds.length&&_t.length===ae.writeUserIds.length&&qt.length===ae.readCharacterIds.length?ae:{...ae,readCampaignIds:qe,writeCampaignIds:gt,readUserIds:St,writeUserIds:_t,readCharacterIds:qt}})},[he,A,Ve,_]);const Et=$.length,zt=Et>=tr,$t=Et>0;u.useEffect(()=>{Et===0&&Me(!1)},[Et]);const kt=ke=>{Y(""),T(Pe=>Pe.includes(ke)?Pe.filter(ht=>ht!==ke):Pe.length>=tr?(Y(`You can only select ${tr} entities at a time.`),Pe):[...Pe,ke])},te=()=>{Y(""),T(ke=>{const Pe=new Set(ke);for(const ht of Ge){if(Pe.size>=tr)break;Pe.add(ht.id)}return Pe.size>tr&&Y(`Selection capped at ${tr} entities.`),Array.from(Pe)})},be=()=>{T([]),Y(""),Ae==="collection"&&(Ue(""),de(null))},ve=ke=>{const Pe=ke.target.value;it(Pe),Y(""),Pe==="manual"?(Ue(""),de(null)):T([])},Be=async ke=>{const Pe=ke.target.value;if(Ue(Pe),de(null),Y(""),!Pe){T([]);return}ye(!0);try{const ht=await l$(Pe),K=ht?.data||ht,ae=Array.isArray(K?.entityIds)?K.entityIds:[];T(ae),de({entityIds:ae,entityCount:K?.entityCount??ae.length,totalCount:K?.totalCount??ae.length,truncated:!!K?.truncated}),K?.truncated&&Y(`Only the first ${tr} entities were loaded from this collection.`)}catch(ht){console.error("Failed to resolve collection entities",ht),Y(ht.message||"Failed to load collection entities"),T([]),de(null)}finally{ye(!1)}},ot=ke=>{const{value:Pe}=ke.target;fe(ht=>({...ht,description:Pe}))},xt=ke=>Pe=>{const ht=Pe.target.value;ke==="read"?(se(ht),ht==="unchanged"&&fe(K=>({...K,readCampaignIds:[],readUserIds:[],readCharacterIds:[]}))):(we(ht),ht==="unchanged"&&fe(K=>({...K,writeCampaignIds:[],writeUserIds:[]})))},re=ke=>Pe=>{const ht=String(Pe);fe(K=>{const ae=K[ke]||[],qe=ae.includes(ht)?ae.filter(gt=>gt!==ht):[...ae,ht];return{...K,[ke]:qe}})},je=Q==="activated",He=ne==="activated",ut=u.useMemo(()=>je?Z.readCampaignIds.length+Z.readUserIds.length+Z.readCharacterIds.length>0:!1,[Z,je]),dt=u.useMemo(()=>He?Z.writeCampaignIds.length+Z.writeUserIds.length>0:!1,[Z,He]),Ee=je||He,at=u.useMemo(()=>{if(!je)return"";const ke=Lw([{label:"campaign",count:Z.readCampaignIds.length},{label:"user",count:Z.readUserIds.length},{label:"character",count:Z.readCharacterIds.length}]);return ke?`You will add read access for ${ke}.`:""},[Z,je]),le=u.useMemo(()=>{if(!He)return"";const ke=Lw([{label:"campaign",count:Z.writeCampaignIds.length},{label:"user",count:Z.writeUserIds.length}]);return ke?`You will add write access for ${ke}.`:""},[Z,He]),st=Te&&$.length>0&&Ee&&!U,ct=async ke=>{if(ke.preventDefault(),!Te){Y("You do not have permission to apply bulk access updates.");return}if(!$.length){Y("Select at least one entity to continue.");return}if(!Ee){Y("Select at least one access type to update.");return}if(je&&!ut){Y("Add at least one read campaign, character, or user.");return}if(He&&!dt){Y("Add at least one campaign or user to grant write access.");return}const Pe={entityIds:$,readAccess:je?"selective":"unchanged",writeAccess:He?"selective":"unchanged",readCampaignIds:je?Z.readCampaignIds:[],readUserIds:je?Z.readUserIds:[],readCharacterIds:je?Z.readCharacterIds:[],writeCampaignIds:He?Z.writeCampaignIds:[],writeUserIds:He?Z.writeUserIds:[],description:Z.description};M(!0),Y(""),ie(null);try{const ht=await e$(Pe,{includeCampaignContext:!!(Ve&&he)}),K=ht?.data||ht;ie({runId:K.runId,count:K.count})}catch(ht){console.error("Failed to apply bulk access",ht),Y(ht.message||"Unable to apply bulk access update")}finally{M(!1)}},yt=u.useMemo(()=>Ve&&he?[{id:String(he.id),label:he.name}]:Mp(E),[he,E,Ve]),oe=u.useMemo(()=>Mp(_,"username"),[_]),Ze=u.useMemo(()=>Mp(A),[A]),Ke=u.useMemo(()=>{const ke=new Map;return w.forEach(Pe=>{ke.set(Pe.id,Pe)}),ke},[w]),ft=u.useMemo(()=>!Je||!Array.isArray(Je.entityIds)?[]:Je.entityIds.slice(0,10).map(ke=>Ke.get(ke)?.name||ke),[Je,Ke]);if(v)return a.jsx("div",{className:"bulk-access-page",children:a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading world context"]})});if(y)return a.jsxs("div",{className:"bulk-access-page",children:[a.jsxs("div",{className:"bulk-access-alert error",children:[a.jsx(Ra,{size:16})," ",y]}),a.jsx("button",{type:"button",className:"link-button",onClick:()=>r(-1),children:"Go back"})]});if(!Te){const ke=Ve?"Only a DM for this campaign can access this tool.":"Only the world owner can access this tool.";return a.jsx("div",{className:"bulk-access-page",children:a.jsxs("div",{className:"bulk-access-alert warning",children:[a.jsx(Ra,{size:16})," ",ke]})})}const Qe=Ve?"Campaign Admin  Access":"World Admin  Manual Access",pt=Ve?he?.name:h?.name;return a.jsxs("div",{className:"bulk-access-page",children:[a.jsxs("div",{className:"bulk-access-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"bulk-access-eyebrow",children:Qe}),a.jsxs("h1",{children:["Bulk Access Editor  ",pt||""]})]}),We&&a.jsx("div",{className:"bulk-access-header-actions",children:a.jsx(Qt,{to:`/worlds/${e}/access/audit`,className:"ghost-button",children:"View audit log"})})]}),a.jsx("p",{className:"bulk-access-helper bulk-access-topline",children:"This tool adds access to selected entities. It does not remove current access."}),et&&he&&a.jsxs("div",{className:"bulk-access-context-banner",children:["You are updating access in Campaign: ",a.jsx("strong",{children:he.name})]}),z&&a.jsxs("div",{className:"bulk-access-alert warning",children:[a.jsx(Ra,{size:16})," ",z]}),J&&a.jsxs("div",{className:"bulk-access-alert success",children:[a.jsx(Zd,{size:16})," Applied access updates to ",J.count," entities  Run ",J.runId,We&&a.jsx(Qt,{to:`/worlds/${e}/access/audit`,className:"inline-link",children:"Review run"})]}),q&&a.jsxs("div",{className:"bulk-access-alert error",children:[a.jsx(Ra,{size:16})," ",q]}),a.jsxs("div",{className:"bulk-access-grid",children:[a.jsxs("section",{className:"bulk-access-card",children:[a.jsxs("header",{children:[a.jsxs("h2",{children:[a.jsx(mM,{size:18})," Choose entities (",Et,"/",tr,")"]}),a.jsxs("div",{className:"bulk-access-entity-actions",children:[!Ie&&a.jsx("button",{type:"button",className:"ghost-button",onClick:te,disabled:zt||Ae!=="manual",children:"Select filtered"}),a.jsx("button",{type:"button",className:"ghost-button",onClick:be,children:"Clear selection"}),$t&&a.jsx("button",{type:"button",className:"ghost-button",onClick:()=>Me(ke=>!ke),children:Ie?"Expand":"Collapse"})]})]}),Ie?a.jsx("div",{className:"bulk-access-entity-collapsed-summary",children:a.jsxs("p",{children:[a.jsx("strong",{children:Et})," ",Et===1?"entity":"entities"," selected."]})}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"bulk-access-selection-mode",children:[a.jsxs("label",{children:[a.jsx("input",{type:"radio",value:"manual",checked:Ae==="manual",onChange:ve}),"Select manually"]}),a.jsxs("label",{children:[a.jsx("input",{type:"radio",value:"collection",checked:Ae==="collection",onChange:ve}),"Use collection"]})]}),Ae==="collection"?a.jsxs("div",{className:"bulk-access-collection-panel",children:[Le&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading collections"]}),!Le&&Tt&&a.jsx("p",{className:"bulk-access-helper warning",children:Tt}),!Le&&!Tt&&$e.length===0&&a.jsxs("p",{className:"bulk-access-helper",children:["No collections available.",We&&!Ve&&e&&a.jsxs(a.Fragment,{children:[" ",a.jsx(Qt,{to:`/worlds/${e}/collections`,className:"inline-link",children:"Create one in the collections manager"}),"."]})]}),$e.length>0&&a.jsxs("select",{value:At,onChange:Be,children:[a.jsx("option",{value:"",children:"Select a collection"}),$e.map(ke=>a.jsxs("option",{value:ke.id,children:[ke.name,"  ",ke.entityCount??ke.entity_ids?.length??0," entities"]},ke.id))]}),ue&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Resolving collection"]}),Je&&a.jsxs("div",{className:"bulk-access-collection-preview",children:[a.jsxs("p",{children:[a.jsx("strong",{children:Je.entityCount})," entities selected from this collection."]}),Je.truncated&&a.jsxs("p",{className:"bulk-access-helper warning",children:["Only the first ",tr," entities can be updated at a time."]}),ft.length>0&&a.jsx("ul",{children:ft.map((ke,Pe)=>a.jsx("li",{children:ke},`${ke}-${Pe}`))})]}),Ae==="collection"&&We&&!Ve&&e&&a.jsx(Qt,{to:`/worlds/${e}/collections`,className:"inline-link",children:"Manage collections"})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"entity-filter",children:[a.jsxs("div",{className:"entity-filter__row entity-filter__row--search",children:[a.jsxs("div",{className:"entity-filter__input",children:[a.jsx("label",{htmlFor:"bulk-access-entity-search",children:"Search"}),a.jsx("input",{id:"bulk-access-entity-search",type:"text",placeholder:Mt,value:X,onChange:ke=>H(ke.target.value)})]}),a.jsxs("div",{className:"entity-filter__scope",children:[a.jsx("label",{htmlFor:"bulk-access-entity-scope",children:"Search scope"}),a.jsx("select",{id:"bulk-access-entity-scope",value:G,onChange:Bt,children:jd.map(ke=>a.jsx("option",{value:ke.value,children:ke.label},ke.value))})]})]}),a.jsxs("div",{className:"entity-filter__row entity-filter__dates",children:[a.jsxs("div",{className:"entity-filter__date-field",children:[a.jsx("label",{htmlFor:"bulk-access-created-after",children:"Created after"}),a.jsx("input",{id:"bulk-access-created-after",type:"date",value:k,onChange:ke=>F(ke.target.value)})]}),a.jsxs("div",{className:"entity-filter__date-field",children:[a.jsx("label",{htmlFor:"bulk-access-created-before",children:"Created before"}),a.jsx("input",{id:"bulk-access-created-before",type:"date",value:I,onChange:ke=>L(ke.target.value)})]}),(k||I)&&a.jsx("button",{type:"button",className:"ghost-button entity-filter__clear-dates",onClick:Jt,children:"Clear dates"})]}),vt?.description&&a.jsx("p",{className:"bulk-access-helper",children:vt.description})]}),a.jsxs("div",{className:"entity-selector-list",children:[D&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading entities"]}),!D&&Ge.length===0&&a.jsx("p",{className:"bulk-access-helper",children:Ve?"No entities are visible within this campaign context.":"No entities match the current filter."}),!D&&Ge.map(ke=>{const Pe=c$(ke),ht=u$(ke);return a.jsxs("label",{className:"entity-row",children:[a.jsx("input",{type:"checkbox",checked:$.includes(ke.id),onChange:()=>kt(ke.id),disabled:zt&&!$.includes(ke.id)}),a.jsxs("div",{className:"entity-row__main",children:[a.jsx("span",{className:"entity-name",children:ke.name}),a.jsxs("div",{className:"entity-row__meta",children:[ke.entityType?.name&&a.jsx("span",{className:"entity-type",children:ke.entityType.name}),Pe&&a.jsx("span",{className:"entity-row__meta-text",children:Pe})]}),ht&&a.jsx("p",{className:"entity-row__summary",children:ht})]}),a.jsx(Ls,{entityId:ke.id,entityName:ke.name,className:"entity-row__preview"})]},ke.id)})]})]})]})]}),a.jsxs("section",{className:"bulk-access-card bulk-access-card--form",children:[a.jsx("header",{children:a.jsx("h2",{children:"Access configuration"})}),a.jsxs("form",{className:"bulk-access-form",onSubmit:ct,children:[a.jsxs("div",{className:"access-section",children:[a.jsxs("div",{className:"access-section__header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"access-section__eyebrow",children:"Step 1"}),a.jsx("h3",{children:"Read access"})]}),a.jsxs("label",{className:"access-mode-select",children:[a.jsx("span",{children:"Mode"}),a.jsxs("select",{value:Q,onChange:xt("read"),children:[a.jsx("option",{value:"unchanged",children:"Unchanged"}),a.jsx("option",{value:"activated",children:"Activated"})]})]})]}),a.jsx("p",{className:"bulk-access-helper access-helper-text",children:"This adds new access. It does not remove current access."}),je&&a.jsxs("div",{className:"access-section__content",children:[a.jsxs("div",{className:"access-section__grid",children:[a.jsx(Vo,{label:"Read campaigns",count:Z.readCampaignIds.length,options:yt,selectedValues:Z.readCampaignIds,onToggle:re("readCampaignIds")}),a.jsx(Vo,{label:"Read users",count:Z.readUserIds.length,options:oe,selectedValues:Z.readUserIds,onToggle:re("readUserIds")})]}),a.jsx(Vo,{label:"Read characters",count:Z.readCharacterIds.length,options:Ze,selectedValues:Z.readCharacterIds,onToggle:re("readCharacterIds")})]})]}),a.jsxs("div",{className:"access-section",children:[a.jsxs("div",{className:"access-section__header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"access-section__eyebrow",children:"Step 2"}),a.jsx("h3",{children:"Write access"})]}),a.jsxs("label",{className:"access-mode-select",children:[a.jsx("span",{children:"Mode"}),a.jsxs("select",{value:ne,onChange:xt("write"),children:[a.jsx("option",{value:"unchanged",children:"Unchanged"}),a.jsx("option",{value:"activated",children:"Activated"})]})]})]}),a.jsx("p",{className:"bulk-access-helper access-helper-text",children:"This adds new access. It does not remove current access."}),He&&a.jsx("div",{className:"access-section__content",children:a.jsxs("div",{className:"access-section__grid",children:[a.jsx(Vo,{label:"Write campaigns",count:Z.writeCampaignIds.length,options:yt,selectedValues:Z.writeCampaignIds,onToggle:re("writeCampaignIds")}),a.jsx(Vo,{label:"Write users",count:Z.writeUserIds.length,options:oe,selectedValues:Z.writeUserIds,onToggle:re("writeUserIds")})]})})]}),a.jsxs("label",{className:"bulk-access-description",children:["Description (optional)",a.jsx("textarea",{name:"description",value:Z.description,onChange:ot,rows:1,placeholder:"Explain why this access change was applied"})]}),a.jsxs("div",{className:"bulk-access-summary",children:[at&&a.jsx("p",{children:at}),le&&a.jsx("p",{children:le}),!at&&!le&&a.jsx("p",{className:"bulk-access-helper",children:"No access changes selected yet."}),!Ee&&a.jsx("p",{className:"bulk-access-helper warning",children:"Select at least one access type to update."}),je&&!ut&&a.jsx("p",{className:"bulk-access-helper warning",children:"Add at least one read audience."}),He&&!dt&&a.jsx("p",{className:"bulk-access-helper warning",children:"Add at least one write audience."})]}),a.jsxs("div",{className:"bulk-access-footer",children:[a.jsxs("div",{className:"bulk-access-footer__selection-info",children:[a.jsx("strong",{children:Et})," ",Et===1?"entity":"entities"," selected"]}),a.jsx("button",{type:"submit",className:"primary-button",disabled:!st||U,children:U?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:16})," Applying"]}):"Confirm and Apply"})]})]})]})]})]})}const zw=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],$w=e=>{if(!e)return"";try{return new Date(e).toLocaleString()}catch{return e}},As=(e=[])=>!Array.isArray(e)||e.length===0?"":e.join(", ");function d$(){const{worldId:e}=Ss(),t=$n(),{user:r}=En(),[i,l]=u.useState(null),[c,f]=u.useState(""),[m,h]=u.useState(!0),[p,y]=u.useState([]),[g,v]=u.useState(!1),[S,w]=u.useState(""),[N,E]=u.useState(null),[C,A]=u.useState(!1),[O,_]=u.useState(""),[R,D]=u.useState(!1),[j,z]=u.useState(""),P=u.useMemo(()=>!i||!r?!1:String(i.created_by)===String(r.id),[i,r]);u.useEffect(()=>{if(!e){f("Missing world id"),h(!1);return}(async()=>{h(!0),f("");try{const I=await Ol(),$=zw(I).find(T=>String(T.id)===String(e));if(!$){f("World not found or unavailable"),l(null);return}l($)}catch(I){console.error("Failed to load worlds",I),f(I.message||"Unable to load world data"),l(null)}finally{h(!1)}})()},[e]);const X=u.useCallback(async F=>{if(F){w(F),A(!0),_("");try{const I=await n$(F),L=I?.data||I;E(L)}catch(I){console.error("Failed to load run detail",I),_(I.message||"Unable to load run details"),E(null)}finally{A(!1)}}},[]),H=u.useCallback(async()=>{if(!(!e||!P)){v(!0),_("");try{const F=await t$({worldId:e}),I=zw(F);if(y(I),I.length===0){E(null),w("");return}(!S||!I.some(L=>L.id===S))&&await X(I[0].id)}catch(F){console.error("Failed to load bulk runs",F),_(F.message||"Unable to load audit runs"),y([])}finally{v(!1)}}},[X,P,S,e]);u.useEffect(()=>{H()},[H]);const G=async()=>{if(!(!S||!window.confirm("Revert this entire run? This cannot be undone."))){D(!0),_(""),z("");try{const F=await a$(S),I=F?.data||F;z(`Run ${I.runId} reverted successfully.`),await H(),await X(S)}catch(F){console.error("Failed to revert run",F),_(F.message||"Unable to revert run")}finally{D(!1)}}},V=F=>F?.reverted?"Reverted":"Active",k=(F,I,L)=>a.jsxs("div",{className:"audit-diff-row",children:[a.jsx("span",{className:"audit-diff-label",children:F}),a.jsxs("div",{className:"audit-diff-values",children:[a.jsx("span",{className:"old",children:I}),a.jsx(y1,{size:14}),a.jsx("span",{className:"new",children:L})]})]},F);return m?a.jsx("div",{className:"bulk-audit-page",children:a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading world context"]})}):c?a.jsxs("div",{className:"bulk-audit-page",children:[a.jsxs("div",{className:"bulk-access-alert error",children:[a.jsx(Ra,{size:16})," ",c]}),a.jsx("button",{type:"button",className:"link-button",onClick:()=>t(-1),children:"Go back"})]}):P?a.jsxs("div",{className:"bulk-audit-page",children:[a.jsxs("div",{className:"bulk-access-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"bulk-access-eyebrow",children:"World Admin  Access Audit"}),a.jsxs("h1",{children:["Bulk Access Runs  ",i?.name]})]}),a.jsx("div",{className:"bulk-access-header-actions",children:a.jsx(Qt,{to:`/worlds/${e}/access/bulk`,className:"ghost-button",children:"Back to editor"})})]}),O&&a.jsxs("div",{className:"bulk-access-alert error",children:[a.jsx(Ra,{size:16})," ",O]}),j&&a.jsxs("div",{className:"bulk-access-alert success",children:[a.jsx(j1,{size:16})," ",j]}),a.jsxs("div",{className:"bulk-audit-grid",children:[a.jsxs("section",{className:"bulk-access-card",children:[a.jsxs("header",{children:[a.jsxs("h2",{children:[a.jsx(v1,{size:18})," Audit runs (",p.length,")"]}),a.jsx("button",{type:"button",className:"ghost-button",onClick:H,disabled:g,children:g?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:14})," Refreshing"]}):"Refresh"})]}),a.jsxs("div",{className:"audit-run-list",children:[g&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading runs"]}),!g&&p.length===0&&a.jsx("p",{className:"bulk-access-helper",children:"No bulk access runs have been recorded for this world."}),!g&&p.map(F=>a.jsxs("button",{type:"button",className:`audit-run-row ${S===F.id?"active":""}`,onClick:()=>X(F.id),children:[a.jsxs("div",{children:[a.jsxs("p",{className:"audit-run-title",children:["Run ",F.id]}),a.jsxs("p",{className:"audit-run-meta",children:[$w(F.createdAt||F.created_at),"  ",F.change_count||F.entity_count||0," entities"]}),a.jsxs("p",{className:"audit-run-meta",children:[F.campaignContext?.name?`Campaign  ${F.campaignContext.name}`:"Scope  World"," ",F.role_used==="dm"?" DM run":" Owner run"]})]}),a.jsx("span",{className:`status-pill ${F.reverted?"reverted":"active"}`,children:V(F)})]},F.id))]})]}),a.jsxs("section",{className:"bulk-access-card",children:[a.jsxs("header",{children:[a.jsx("h2",{children:"Run details"}),N&&a.jsx("button",{type:"button",className:"ghost-button",onClick:G,disabled:N.reverted||R,children:R?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:14})," Reverting"]}):a.jsxs(a.Fragment,{children:[a.jsx(Ll,{size:14})," Revert run"]})})]}),!N&&a.jsx("p",{className:"bulk-access-helper",children:"Select a run to see the access changes."}),C&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading details"]}),N&&!C&&a.jsxs("div",{className:"audit-detail",children:[a.jsxs("div",{className:"audit-detail-meta",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Status:"})," ",N.reverted?"Reverted":"Active"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"User:"})," ",N.actor?.username||"Unknown user"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"User role:"})," ",N.role_used==="dm"?"Campaign DM":"World owner"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Scope:"})," ",N.campaignContext?.name||"World-wide"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Created:"})," ",$w(N.createdAt||N.created_at)]}),N.description&&a.jsxs("p",{children:[a.jsx("strong",{children:"Description:"})," ",N.description]})]}),a.jsx("div",{className:"audit-changes",children:N.changes?.map(F=>{const I=F.entity?.name||F.entity_id;return a.jsxs("div",{className:"audit-change-card",children:[a.jsxs("div",{className:"audit-change-header",children:[a.jsx("p",{className:"audit-change-title",children:I}),a.jsxs("span",{className:"audit-change-subtitle",children:["Entity ",F.entity_id]})]}),a.jsxs("div",{className:"audit-change-body",children:[k("Read access",F.old_read_access,F.entity?.read_access||""),k("Write access",F.old_write_access,F.entity?.write_access||""),k("Read campaigns",As(F.old_read_campaign_names!==void 0?F.old_read_campaign_names:F.old_read_campaign_ids),As(F.entity?.read_campaign_names!==void 0?F.entity.read_campaign_names:F.entity?.read_campaign_ids)),k("Read users",As(F.old_read_user_names!==void 0?F.old_read_user_names:F.old_read_user_ids),As(F.entity?.read_user_names!==void 0?F.entity.read_user_names:F.entity?.read_user_ids)),k("Read characters",As(F.old_read_character_ids),As(F.entity?.read_character_ids)),k("Write campaigns",As(F.old_write_campaign_names!==void 0?F.old_write_campaign_names:F.old_write_campaign_ids),As(F.entity?.write_campaign_names!==void 0?F.entity.write_campaign_names:F.entity?.write_campaign_ids)),k("Write users",As(F.old_write_user_names!==void 0?F.old_write_user_names:F.old_write_user_ids),As(F.entity?.write_user_names!==void 0?F.entity.write_user_names:F.entity?.write_user_ids))]})]},F.id)})})]})]})]})]}):a.jsx("div",{className:"bulk-audit-page",children:a.jsxs("div",{className:"bulk-access-alert warning",children:[a.jsx(Ra,{size:16})," Only the world owner can view audit runs."]})})}const Yo=1e3,Rp=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],kp={name:"",description:"",shared:!1,entityIds:[]};function f$(){const{worldId:e}=Ss(),t=$n(),{user:r,sessionReady:i}=En(),[l,c]=u.useState(null),[f,m]=u.useState(!0),[h,p]=u.useState(""),[y,g]=u.useState(!1),[v,S]=u.useState([]),[w,N]=u.useState([]),[E,C]=u.useState(""),[A,O]=u.useState("view"),[_,R]=u.useState(""),[D,j]=u.useState(kp),[z,P]=u.useState(!1),[X,H]=u.useState(""),[G,V]=u.useState(""),[k,F]=u.useState(!1),[I,L]=u.useState(!1),[$,T]=u.useState(!1),[U,M]=u.useState(null),[q,Y]=u.useState(!1),J=u.useMemo(()=>{if(!l||!r)return!1;const ue=l.created_by||l.creator?.id||l.owner?.id||l.owner_id||null;return ue&&r.id&&String(ue)===String(r.id)},[l,r]),ie=u.useCallback(async()=>{if(e)try{const ue=await hj(e),ye=Rp(ue);S(ye)}catch(ue){console.error("Failed to load collections",ue),p(ue.message||"Failed to load collections")}},[e]),Z=u.useCallback(async()=>{if(e)try{const ue=await lc(e),ye=Rp(ue);N(ye)}catch(ue){console.error("Failed to load entities for world",ue),p(ue.message||"Failed to load entities for this world")}},[e]);u.useEffect(()=>{if(!i||!e)return;(async()=>{m(!0),p(""),g(!1),c(null);try{const ye=await Ol(),ee=Rp(ye).find(he=>String(he.id)===String(e));if(!ee){p("World not found or unavailable");return}c(ee);const me=ee.created_by||ee.creator?.id||ee.owner?.id||ee.owner_id||null;if(!r||!me||String(me)!==String(r.id)){g(!0);return}await Promise.all([ie(),Z()])}catch(ye){console.error("Failed to load collections manager",ye),p(ye.message||"Failed to load collections manager")}finally{m(!1)}})()},[ie,Z,i,r,e]);const fe=ue=>ye=>{const Ve=ue==="shared"?ye.target.checked:ye.target.value;j(ee=>({...ee,[ue]:Ve})),P(!0),H(""),V("")},Q=ue=>{H(""),V(""),j(ye=>{const Ve=new Set(ye.entityIds||[]);if(Ve.has(ue))Ve.delete(ue);else{if(Ve.size>=Yo)return H(`Collections can include up to ${Yo} entities.`),ye;Ve.add(ue)}return P(!0),{...ye,entityIds:Array.from(Ve)}})},se=u.useMemo(()=>{if(!E)return w;const ue=E.toLowerCase();return w.filter(ye=>(ye.name||"").toLowerCase().includes(ue))},[w,E]),ne=u.useMemo(()=>[...v].sort((ue,ye)=>ue.shared&&!ye.shared?-1:ye.shared&&!ue.shared?1:(ue.name||"").localeCompare(ye.name||"",void 0,{sensitivity:"base"})),[v]),we=u.useCallback(()=>{R(""),j(kp),O("view"),P(!1),H(""),V("")},[]),Ie=u.useCallback(ue=>{ue&&(R(ue.id),j({name:ue.name||"",description:ue.description||"",shared:!!ue.shared,entityIds:Array.isArray(ue.entityIds)?ue.entityIds:[]}),O("edit"),P(!1),H(""),V(""))},[]),Me=ue=>{if(z){M(ue),T(!0);return}Ae(ue)},Ae=ue=>{T(!1),M(null),ue&&(ue.type==="select"?Ie(ue.payload):ue.type==="create"?(O("create"),R(""),j(kp),P(!1),H(""),V("")):ue.type==="close"&&we())},it=ue=>{Me({type:"select",payload:ue,label:ue.name})},$e=()=>{Me({type:"create",label:"start a new collection"})},nt=()=>{Me({type:"close",label:"leave this editor"})},Le=()=>{T(!1),M(null)},wt=()=>{Ae(U)},Tt=u.useCallback(async()=>{if(!e)return H("A world id is required to save this collection."),!1;if(!D.name.trim())return H("Name is required."),!1;if(D.entityIds.length>Yo)return H(`Collections can include up to ${Yo} entities.`),!1;const ue={worldId:e,name:D.name.trim(),description:D.description,shared:D.shared,entityIds:D.entityIds};F(!0),H(""),V("");try{let ye;A==="edit"&&_?ye=await r$(_,ue):ye=await s$(ue);const Ve=ye?.data||ye;return Ve?(S(ee=>{const me=ee.findIndex(he=>he.id===Ve.id);if(me>=0){const he=[...ee];return he[me]=Ve,he}return[...ee,Ve]}),Ie(Ve),O("edit"),V("Collection saved successfully."),P(!1)):await ie(),!0}catch(ye){return console.error("Failed to save collection",ye),H(ye.message||"Failed to save collection"),!1}finally{F(!1)}},[Ie,D,ie,A,_,e]),Ct=async ue=>{ue.preventDefault(),await Tt()},At=async()=>{if(_&&confirm("Delete this collection? This cannot be undone.")){L(!0),H(""),V("");try{await i$(_),S(ue=>ue.filter(ye=>ye.id!==_)),we(),V("Collection deleted.")}catch(ue){console.error("Failed to delete collection",ue),H(ue.message||"Failed to delete collection")}finally{L(!1)}}},Ue=async()=>{Y(!0);const ue=await Tt();Y(!1),ue&&Ae(U)};if(u.useEffect(()=>{const ue=ye=>{z&&(ye.preventDefault(),ye.returnValue="")};return window.addEventListener("beforeunload",ue),()=>window.removeEventListener("beforeunload",ue)},[z]),!i)return a.jsx("p",{className:"collections-helper",children:"Restoring session"});if(!e)return a.jsx("p",{className:"collections-helper",children:"World id is required."});if(f)return a.jsx("div",{className:"collections-page",children:a.jsxs("p",{className:"collections-helper",children:[a.jsx(Nn,{size:16,className:"spin"})," Loading collections"]})});if(h)return a.jsxs("div",{className:"collections-page",children:[a.jsxs("div",{className:"collections-alert error",children:[a.jsx(Ra,{size:16})," ",h]}),a.jsx("button",{type:"button",className:"link-button",onClick:()=>t(-1),children:"Go back"})]});if(y||!J)return a.jsx("div",{className:"collections-page",children:a.jsxs("div",{className:"collections-alert warning",children:[a.jsx(Ra,{size:16})," Only the world owner can manage collections."]})});const Je=l?.name||"",de=D.entityIds.length;return a.jsxs("div",{className:"collections-page",children:[a.jsxs("div",{className:"collections-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"collections-eyebrow",children:"World Admin  Collections"}),a.jsx("h1",{children:Je})]}),a.jsx("div",{className:"collections-header-actions",children:a.jsx("button",{type:"button",className:"primary-button",onClick:$e,children:"New collection"})})]}),G&&a.jsxs("div",{className:"collections-alert success",children:[a.jsx(Zd,{size:16})," ",G]}),X&&a.jsxs("div",{className:"collections-alert error",children:[a.jsx(Ra,{size:16})," ",X]}),a.jsxs("div",{className:"collections-grid",children:[a.jsxs("section",{className:"collections-card",children:[a.jsxs("header",{children:[a.jsx("h2",{children:"Collections"}),a.jsxs("p",{className:"collections-helper",children:[v.length," saved  Shared sets are available to campaign DMs"]})]}),a.jsx("div",{className:"collections-table-wrapper",children:ne.length===0?a.jsx("p",{className:"collections-helper",children:"No collections yet. Create one to get started."}):a.jsxs("table",{className:"collections-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Name"}),a.jsx("th",{children:"Shared"}),a.jsx("th",{children:"Entities"}),a.jsx("th",{children:"Updated"})]})}),a.jsx("tbody",{children:ne.map(ue=>{const ye=_===ue.id;return a.jsxs("tr",{className:ye?"active":"",onClick:()=>it(ue),children:[a.jsxs("td",{children:[a.jsx("span",{className:"collection-name",children:ue.name}),ue.description&&a.jsx("span",{className:"collection-description",children:ue.description})]}),a.jsx("td",{children:ue.shared?a.jsxs("span",{className:"shared-chip",children:[a.jsx(_1,{size:14})," Shared"]}):a.jsx("span",{className:"shared-chip private",children:"Owner only"})}),a.jsx("td",{children:ue.entityCount??ue.entity_ids?.length??0}),a.jsx("td",{children:ue.updatedAt?new Date(ue.updatedAt).toLocaleString():""})]},ue.id)})})]})})]}),a.jsx("section",{className:"collections-card",children:A==="view"&&!_?a.jsx("div",{className:"collections-placeholder",children:a.jsx("p",{children:"Select a collection to edit or create a new one."})}):a.jsxs("form",{className:"collections-form",onSubmit:Ct,children:[a.jsxs("header",{children:[a.jsx("h2",{children:A==="edit"?"Edit collection":"New collection"}),a.jsxs("p",{className:"collections-helper",children:[de,"/",Yo," entities selected"]})]}),a.jsxs("label",{children:["Name",a.jsx("input",{type:"text",value:D.name,onChange:fe("name"),required:!0})]}),a.jsxs("label",{children:["Description (optional)",a.jsx("textarea",{value:D.description,onChange:fe("description"),rows:3})]}),a.jsxs("label",{className:"checkbox-label",children:[a.jsx("input",{type:"checkbox",checked:D.shared,onChange:fe("shared")}),"Share with DMs in this world"]}),a.jsxs("div",{className:"collections-entity-picker",children:[a.jsxs("div",{className:"collections-entity-toolbar",children:[a.jsx("span",{children:"Entities"}),a.jsx("input",{type:"text",placeholder:"Filter by name",value:E,onChange:ue=>C(ue.target.value)})]}),a.jsx("div",{className:"collections-entity-list",children:se.length===0?a.jsx("p",{className:"collections-helper",children:"No entities match this filter."}):a.jsx("ul",{children:se.map(ue=>{const ye=D.entityIds.includes(ue.id);return a.jsx("li",{children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:ye,onChange:()=>Q(ue.id)}),a.jsx("span",{className:"entity-name",children:ue.name}),a.jsx("span",{className:"entity-type",children:ue.entityType?.name||""})]})},ue.id)})})})]}),a.jsxs("div",{className:"collections-form-actions",children:[a.jsx("button",{type:"submit",className:"primary-button",disabled:k,children:k?"Saving":"Save collection"}),A==="edit"&&a.jsx("button",{type:"button",className:"ghost-button",onClick:At,disabled:I,children:I?"Deleting":"Delete"}),a.jsx("button",{type:"button",className:"ghost-button",onClick:nt,children:"Close"})]})]})})]}),a.jsx(hN,{open:$,destinationLabel:U?.label||"",saving:q,onSaveAndContinue:Ue,onContinueWithoutSaving:wt,onStay:Le})]})}function m$(){const e=Qr();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function h$(e,t="request"){if(e.status===401)throw new Error("Unauthorized");if(!e.ok){const r=await e.json().catch(()=>({message:"Unknown error"}));throw new Error(r.message||`Failed to ${t}`)}return e.json()}async function p$(e,t){const r=await fetch(`${Cn}/auth/change-password`,{method:"POST",headers:m$(),body:JSON.stringify({currentPassword:e,newPassword:t})});return h$(r,"change password")}function y$(){const[e,t]=u.useState(""),[r,i]=u.useState(""),[l,c]=u.useState(""),[f,m]=u.useState(""),[h,p]=u.useState(""),[y,g]=u.useState(!1),v=async S=>{S.preventDefault(),m(""),p(""),g(!0);try{if(!e||!r||!l){m("All fields are required"),g(!1);return}if(r.length<6){m("New password must be at least 6 characters long"),g(!1);return}if(r!==l){m("New password and confirmation do not match"),g(!1);return}await p$(e,r),p("Password changed successfully"),t(""),i(""),c("")}catch(w){m(w.message||"Failed to change password. Please try again.")}finally{g(!1)}};return a.jsx("div",{className:"settings-page",children:a.jsxs("div",{className:"settings-container",children:[a.jsxs("div",{className:"settings-header",children:[a.jsx("h1",{className:"settings-title",children:"Security"}),a.jsx("p",{className:"settings-subtitle",children:"Manage your account security"})]}),a.jsxs("div",{className:"settings-section",children:[a.jsx("h2",{className:"settings-section-title",children:"Change Password"}),a.jsx("p",{className:"settings-section-description",children:"Enter your current password and choose a new password to update your account security."}),a.jsxs("form",{onSubmit:v,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"current-password",children:"Current Password"}),a.jsx("input",{id:"current-password",type:"password",value:e,onChange:S=>t(S.target.value),placeholder:"Enter current password",required:!0,disabled:y})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"new-password",children:"New Password"}),a.jsx("input",{id:"new-password",type:"password",value:r,onChange:S=>i(S.target.value),placeholder:"Enter new password (minimum 6 characters)",required:!0,minLength:6,disabled:y})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"confirm-password",children:"Confirm New Password"}),a.jsx("input",{id:"confirm-password",type:"password",value:l,onChange:S=>c(S.target.value),placeholder:"Confirm new password",required:!0,disabled:y})]}),f&&a.jsx("p",{className:"error-msg",children:f}),h&&a.jsx("p",{className:"success-msg",children:h}),a.jsx("button",{type:"submit",disabled:y,className:"settings-submit-btn",children:y?"Changing password...":"Change Password"})]})]})]})})}const g$=[{value:"",label:"All types"},{value:"entity_comment",label:"Entity comments"},{value:"entity_mention_entity_note",label:"Entity mentions (notes)"},{value:"entity_mention_session_note",label:"Entity mentions (sessions)"},{value:"session_note_added",label:"Session notes"},{value:"session_note_updated",label:"Session notes"},{value:"request_note_added",label:"Feature/Bug notes"},{value:"request_status_changed",label:"Feature/Bug status"},{value:"request_assigned",label:"Feature/Bug assignments"}],b$=e=>{const{type:t,metadata:r={}}=e;switch(t){case"entity_comment":return`${r.author_name||"Someone"} commented on ${r.entity_name||"an entity"}`;case"entity_mention_entity_note":return`${r.author_name||"Someone"} mentioned ${r.related_entity_name||"an entity"} in a note`;case"entity_mention_session_note":return`${r.author_name||"Someone"} mentioned ${r.related_entity_name||"an entity"} in a session note`;case"session_note_added":return`${r.author_name||"Someone"} created a session note${r.campaign_name?` for ${r.campaign_name}`:""}: ${r.session_title||"Untitled"}`;case"session_note_updated":return`${r.author_name||"Someone"} updated a session note${r.campaign_name?` for ${r.campaign_name}`:""}: ${r.session_title||"Untitled"}`;case"request_note_added":return`${r.author_name||"Someone"} added a note to "${r.request_title||"a feature/bug"}"`;case"request_status_changed":return`Status changed for "${r.request_title||"a feature/bug"}"`;case"request_assigned":return`You were assigned to "${r.request_title||"a feature/bug"}"`;default:return"New notification"}},v$=e=>{if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const i=new Date-t,l=Math.floor(i/6e4),c=Math.floor(i/36e5),f=Math.floor(i/864e5);return l<1?"Just now":l<60?`${l}m ago`:c<24?`${c}h ago`:f<7?`${f}d ago`:t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})};function x$(){const{notifications:e,markRead:t,markAllRead:r,refresh:i}=z1(),{selectedCampaignId:l,campaigns:c,setSelectedCampaignId:f}=Un(),m=$n(),[h,p]=u.useState(!1),[y,g]=u.useState([]),[v,S]=u.useState(1),[w,N]=u.useState(!0),[E,C]=u.useState(""),[A,O]=u.useState(""),[_,R]=u.useState(l||""),[D,j]=u.useState({open:!1,notification:null}),z=async(L=1,$=!1)=>{p(!0);try{const T={page:L,limit:50};E==="unread"?T.read="false":E==="read"&&(T.read="true"),A&&(T.type=A),_&&(T.campaignId=_);const U=await L1(T),M=Array.isArray(U?.data)?U.data:[],q=U?.pagination||{};g($?Y=>[...Y,...M]:M),N(q.page<q.pages)}catch(T){console.error("Failed to load notifications",T)}finally{p(!1)}};u.useEffect(()=>{z(1,!1)},[E,A,_]);const P=async L=>{try{await t(L.id),g($=>$.map(T=>T.id===L.id?{...T,read:!0,readAt:new Date().toISOString()}:T))}catch($){console.error("Failed to mark notification read",$)}},X=async()=>{try{const L={};_&&(L.campaignId=_),A&&(L.type=A),await r(L),i(),z(v,!1)}catch(L){console.error("Failed to mark all notifications read",L)}},H=L=>{if(L.actionUrl)m(L.actionUrl);else{const{type:$,metadata:T={}}=L;if($==="entity_comment"||$==="entity_mention_entity_note"){const U=T.entity_id||T.related_entity_id,M=L.campaignId||L.campaign?.id||_;U&&m(`/entities/${U}${M?`?campaignId=${M}`:""}#notes`)}else if($==="session_note_added"||$==="session_note_updated"||$==="entity_mention_session_note"){const U=L.campaignId||L.campaign?.id||T.target_id||_;m(`/notes/session${U?`?campaignId=${U}`:""}`)}else if($==="request_note_added"||$==="request_status_changed"||$==="request_assigned"){const U=T.request_id||T.requestId;m(U?`/requests/${U}`:"/requests")}}},G=async L=>{L.read||await P(L);const $=L.campaignId||L.campaign?.id||"";if($&&$!==(l||"")){j({open:!0,notification:L});return}H(L)},V=()=>{const{notification:L}=D;if(!L)return;const $=L.campaignId||L.campaign?.id||"";$&&f($),j({open:!1,notification:null}),setTimeout(()=>{H(L)},100)},k=()=>{j({open:!1,notification:null})},F=y.filter(L=>!L.read).length,I=u.useMemo(()=>[{value:"",label:"All campaigns"},...(c||[]).map(L=>({value:L.id,label:L.name}))],[c]);return a.jsxs("div",{className:"notification-list-page",children:[a.jsxs("div",{className:"notification-list-header",children:[a.jsx("h1",{children:"Notifications"}),a.jsx("div",{className:"notification-list-actions",children:F>0&&a.jsxs("button",{type:"button",className:"notification-list-mark-all-read",onClick:X,disabled:h,children:[a.jsx(rT,{size:18}),"Mark all read"]})})]}),a.jsxs("div",{className:"notification-list-filters",children:[a.jsxs("select",{className:"notification-list-filter",value:E,onChange:L=>{C(L.target.value),S(1)},children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"unread",children:"Unread"}),a.jsx("option",{value:"read",children:"Read"})]}),a.jsx("select",{className:"notification-list-filter",value:A,onChange:L=>{O(L.target.value),S(1)},children:g$.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))}),a.jsx("select",{className:"notification-list-filter",value:_,onChange:L=>{R(L.target.value),S(1)},children:I.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))})]}),a.jsxs("div",{className:"notification-list-content",children:[h&&y.length===0?a.jsx("div",{className:"notification-list-empty",children:"Loading..."}):y.length===0?a.jsxs("div",{className:"notification-list-empty",children:[a.jsx("p",{children:"No notifications found."}),a.jsx("p",{className:"notification-list-empty-hint",children:"You're all caught up!"})]}):a.jsx("div",{className:"notification-list-items",children:y.map(L=>a.jsxs("div",{className:`notification-list-item ${L.read?"read":"unread"}`,onClick:()=>G(L),children:[a.jsxs("div",{className:"notification-list-item-content",children:[a.jsxs("div",{className:"notification-list-item-header",children:[a.jsx("p",{className:"notification-list-item-message",children:b$(L)}),!L.read&&a.jsx("div",{className:"notification-list-item-dot"})]}),a.jsxs("div",{className:"notification-list-item-meta",children:[a.jsx("span",{className:"notification-list-item-time",children:v$(L.createdAt)}),L.campaign&&a.jsx("span",{className:"notification-list-item-campaign",children:L.campaign.name})]})]}),!L.read&&a.jsx("button",{type:"button",className:"notification-list-item-mark-read",onClick:$=>{$.stopPropagation(),P(L)},title:"Mark as read",children:a.jsx(g1,{size:16})})]},L.id))}),w&&a.jsx("div",{className:"notification-list-load-more",children:a.jsx("button",{type:"button",onClick:()=>{const L=v+1;S(L),z(L,!0)},disabled:h,children:h?"Loading...":"Load more"})})]}),a.jsx($1,{open:D.open,campaignName:D.notification?.campaign?.name||"",onSwitch:V,onCancel:k})]})}function S$(){const{selectedCampaignId:e,campaigns:t}=Un(),[r,i]=u.useState([]),[l,c]=u.useState(!1),[f,m]=u.useState(e||""),[h,p]=u.useState(null),y=async()=>{c(!0);try{const w=await u4(f||void 0),N=Array.isArray(w?.data)?w.data:[];i(N)}catch(w){console.error("Failed to load followed entities",w)}finally{c(!1)}};u.useEffect(()=>{y()},[f]);const g=async(w,N)=>{if(!(!w||!N||h===w)){p(w);try{await fN(w,N),i(E=>E.filter(C=>!(C.entityId===w&&C.campaignId===N)))}catch(E){console.error("Failed to unfollow entity",E)}finally{p(null)}}},v=u.useMemo(()=>[{value:"",label:"All campaigns"},...(t||[]).map(w=>({value:w.id,label:w.name}))],[t]),S=u.useMemo(()=>{const w={};return r.forEach(N=>{const E=N.campaignId||"no-campaign";w[E]||(w[E]={campaign:N.campaign,entities:[]}),w[E].entities.push(N)}),w},[r]);return a.jsxs("div",{className:"followed-entities-page",children:[a.jsxs("div",{className:"followed-entities-header",children:[a.jsx("h1",{children:"Followed Entities"}),a.jsx("div",{className:"followed-entities-actions",children:a.jsx("select",{className:"followed-entities-filter",value:f,onChange:w=>m(w.target.value),children:v.map(w=>a.jsx("option",{value:w.value,children:w.label},w.value))})})]}),a.jsx("div",{className:"followed-entities-content",children:l?a.jsx("div",{className:"followed-entities-empty",children:"Loading..."}):r.length===0?a.jsxs("div",{className:"followed-entities-empty",children:[a.jsx("p",{children:"No followed entities found."}),a.jsx("p",{className:"followed-entities-empty-hint",children:"Follow entities from their detail pages to receive notifications when they're commented on or mentioned."})]}):a.jsx("div",{className:"followed-entities-list",children:Object.entries(S).map(([w,N])=>a.jsxs("div",{className:"followed-entities-group",children:[a.jsx("h2",{className:"followed-entities-group-title",children:N.campaign?.name||"No campaign context"}),a.jsx("div",{className:"followed-entities-items",children:N.entities.map(E=>a.jsxs("div",{className:"followed-entities-item",children:[a.jsx(Qt,{to:`/entities/${E.entityId}${E.campaignId?`?campaignId=${E.campaignId}`:""}`,className:"followed-entities-item-link",children:a.jsxs("div",{className:"followed-entities-item-content",children:[a.jsx("h3",{className:"followed-entities-item-name",children:E.entity?.name||"Unnamed entity"}),E.entity?.entityType&&a.jsx("span",{className:"followed-entities-item-type",children:E.entity.entityType.name})]})}),a.jsx("button",{type:"button",className:"followed-entities-item-unfollow",onClick:()=>g(E.entityId,E.campaignId),disabled:h===E.entityId,title:"Unfollow",children:h===E.entityId?a.jsx(Td,{size:18}):a.jsx(Ry,{size:18})})]},`${E.entityId}-${E.campaignId}`))})]},w))})})]})}const w$=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([l,c])=>{c!=null&&c!==""&&t.set(l,c)});const r=t.toString(),i=r?`/requests?${r}`:"/requests";return Rt.get(i)},N$=e=>Rt.get(`/requests/${e}`),E$=e=>Rt.post("/requests",e),j$=(e,t)=>Rt.patch(`/requests/${e}`,t),_$=e=>Rt.delete(`/requests/${e}`),C$={open:"blue",in_progress:"orange",testing:"yellow",resolved:"green",closed:"gray",backlog:"purple"};function pj({status:e}){const t=C$[e]||"gray",r=e?e.split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" "):"Unknown";return a.jsx("span",{className:`request-status-badge request-status-badge--${t}`,children:r})}function A$({request:e}){const t=r=>{if(!r)return"";const i=new Date(r);if(Number.isNaN(i.getTime()))return"";const c=new Date-i,f=Math.floor(c/6e4),m=Math.floor(c/36e5),h=Math.floor(c/864e5);return f<1?"Just now":f<60?`${f}m ago`:m<24?`${m}h ago`:h<7?`${h}d ago`:i.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})};return a.jsxs(Qt,{to:`/requests/${e.id}`,className:"request-card",children:[a.jsxs("div",{className:"request-card__header",children:[a.jsxs("div",{className:"request-card__type",children:[e.type==="bug"?a.jsx(ky,{size:16,className:"request-card__type-icon"}):a.jsx(Di,{size:16,className:"request-card__type-icon"}),a.jsx("span",{className:"request-card__type-label",children:e.type==="bug"?"Bug":"Feature"})]}),a.jsx(pj,{status:e.status})]}),a.jsx("h3",{className:"request-card__title",children:e.title}),a.jsx("p",{className:"request-card__description",children:e.description.length>150?`${e.description.substring(0,150)}...`:e.description}),a.jsxs("div",{className:"request-card__footer",children:[a.jsxs("div",{className:"request-card__meta",children:[a.jsxs("span",{className:"request-card__creator",children:["by ",e.creator?.username||"Unknown"]}),e.assignee&&a.jsxs("span",{className:"request-card__assignee",children:[" ",e.assignee.username]})]}),a.jsxs("div",{className:"request-card__time",children:[a.jsx(Iy,{size:14}),a.jsx("span",{children:t(e.createdAt)})]})]})]})}function T$(){const{user:e}=En(),t=e?.role==="system_admin",[r,i]=u.useState([]),[l,c]=u.useState(!1),[f,m]=u.useState({type:"",status:"",isInBacklog:""}),[h,p]=u.useState({page:1,limit:20,total:0,pages:0}),y=async(w=1)=>{c(!0);try{const N={page:w,limit:h.limit,...f};Object.keys(N).forEach(C=>{(N[C]===""||N[C]===null||N[C]===void 0)&&delete N[C]});const E=await w$(N);i(Array.isArray(E?.data)?E.data:[]),p(E?.pagination||h)}catch(N){console.error("Failed to load requests",N),alert("Failed to load requests")}finally{c(!1)}};u.useEffect(()=>{y(1)},[f]);const g=(w,N)=>{m(E=>({...E,[w]:N}))},v=()=>{m({type:"",status:"",isInBacklog:""})},S=Object.values(f).some(w=>w!=="");return a.jsxs("div",{className:"request-list-page",children:[a.jsxs("div",{className:"request-list-page__header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Feature/Bugs"}),a.jsxs("div",{className:"request-list-page__subtitle-wrapper",children:[a.jsx("p",{className:"request-list-page__subtitle",children:t?"All bug reports and feature requests":"Your bug reports and feature requests"}),t&&a.jsx("span",{className:"request-list-page__admin-badge",children:"Admin View"})]})]}),a.jsxs(Qt,{to:"/requests/new",className:"request-list-page__create-button",children:[a.jsx(Ya,{size:20}),"New Request"]})]}),a.jsxs("div",{className:"request-list-page__filters",children:[a.jsxs("div",{className:"request-list-page__filter-group",children:[a.jsx(Qd,{size:16}),a.jsx("label",{htmlFor:"filter-type",children:"Type:"}),a.jsxs("select",{id:"filter-type",value:f.type,onChange:w=>g("type",w.target.value),className:"request-list-page__filter-select",children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"bug",children:"Bug"}),a.jsx("option",{value:"feature",children:"Feature"})]})]}),a.jsxs("div",{className:"request-list-page__filter-group",children:[a.jsx("label",{htmlFor:"filter-status",children:"Status:"}),a.jsxs("select",{id:"filter-status",value:f.status,onChange:w=>g("status",w.target.value),className:"request-list-page__filter-select",children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"open",children:"Open"}),a.jsx("option",{value:"in_progress",children:"In Progress"}),a.jsx("option",{value:"testing",children:"Testing"}),a.jsx("option",{value:"resolved",children:"Resolved"}),a.jsx("option",{value:"closed",children:"Closed"}),a.jsx("option",{value:"backlog",children:"Backlog"})]})]}),t&&a.jsxs("div",{className:"request-list-page__filter-group",children:[a.jsx("label",{htmlFor:"filter-backlog",children:"Backlog:"}),a.jsxs("select",{id:"filter-backlog",value:f.isInBacklog,onChange:w=>g("isInBacklog",w.target.value),className:"request-list-page__filter-select",children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"true",children:"In Backlog"}),a.jsx("option",{value:"false",children:"Not in Backlog"})]})]}),S&&a.jsx("button",{onClick:v,className:"request-list-page__clear-filters",children:"Clear Filters"})]}),l?a.jsx("div",{className:"request-list-page__loading",children:"Loading requests..."}):r.length===0?a.jsxs("div",{className:"request-list-page__empty",children:[a.jsx("p",{children:"No requests found"}),a.jsx(Qt,{to:"/requests/new",className:"request-list-page__empty-link",children:"Create your first request"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"request-list-page__grid",children:r.map(w=>a.jsx(A$,{request:w},w.id))}),h.pages>1&&a.jsxs("div",{className:"request-list-page__pagination",children:[a.jsx("button",{onClick:()=>y(h.page-1),disabled:h.page<=1,className:"request-list-page__pagination-button",children:"Previous"}),a.jsxs("span",{className:"request-list-page__pagination-info",children:["Page ",h.page," of ",h.pages," (",h.total," total)"]}),a.jsx("button",{onClick:()=>y(h.page+1),disabled:h.page>=h.pages,className:"request-list-page__pagination-button",children:"Next"})]})]})]})}const yj=e=>Rt.get(`/requests/${e}/notes`),gj=(e,t)=>Rt.post(`/requests/${e}/notes`,t),M$=(e,t,r)=>Rt.patch(`/requests/${e}/notes/${t}`,r),bj=(e,t)=>Rt.delete(`/requests/${e}/notes/${t}`),R$=Object.freeze(Object.defineProperty({__proto__:null,createRequestNote:gj,deleteRequestNote:bj,fetchRequestNotes:yj,updateRequestNote:M$},Symbol.toStringTag,{value:"Module"}));function k$({onSubmit:e,loading:t=!1}){const[r,i]=u.useState(""),l=c=>{c.preventDefault(),r.trim()&&(e(r.trim()),i(""))};return a.jsxs("form",{onSubmit:l,className:"request-note-form",children:[a.jsx("textarea",{value:r,onChange:c=>i(c.target.value),placeholder:"Add a note...",className:"request-note-form__textarea",rows:3,disabled:t}),a.jsx("div",{className:"request-note-form__actions",children:a.jsxs("button",{type:"submit",disabled:!r.trim()||t,className:"request-note-form__submit",children:[a.jsx(lM,{size:16}),t?"Adding...":"Add Note"]})})]})}function D$({requestId:e,canAddNote:t}){const{user:r}=En(),[i,l]=u.useState([]),[c,f]=u.useState(!1),[m,h]=u.useState(!1),[p,y]=u.useState(null),[g,v]=u.useState(""),S=async()=>{f(!0);try{const _=await yj(e);l(Array.isArray(_?.data)?_.data:[])}catch(_){console.error("Failed to load notes",_)}finally{f(!1)}};u.useEffect(()=>{e&&S()},[e]);const w=async _=>{h(!0);try{await gj(e,{content:_}),await S()}catch(R){console.error("Failed to add note",R),alert("Failed to add note")}finally{h(!1)}},N=async _=>{if(confirm("Are you sure you want to delete this note?"))try{await bj(e,_),await S()}catch(R){console.error("Failed to delete note",R),alert("Failed to delete note")}},E=_=>{y(_.id),v(_.content)},C=()=>{y(null),v("")},A=async _=>{try{const{updateRequestNote:R}=await Z1(async()=>{const{updateRequestNote:D}=await Promise.resolve().then(()=>R$);return{updateRequestNote:D}},void 0);await R(e,_,{content:g}),y(null),v(""),await S()}catch(R){console.error("Failed to update note",R),alert("Failed to update note")}},O=_=>{if(!_)return"";const R=new Date(_);if(Number.isNaN(R.getTime()))return"";const j=new Date-R,z=Math.floor(j/6e4),P=Math.floor(j/36e5),X=Math.floor(j/864e5);return z<1?"Just now":z<60?`${z}m ago`:P<24?`${P}h ago`:X<7?`${X}d ago`:R.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})};return c?a.jsx("div",{className:"request-notes__loading",children:"Loading notes..."}):a.jsxs("div",{className:"request-notes",children:[a.jsxs("div",{className:"request-notes__header",children:[a.jsx(VT,{size:20}),a.jsxs("h3",{children:["Notes (",i.length,")"]})]}),t&&a.jsx(k$,{onSubmit:w,loading:m}),a.jsx("div",{className:"request-notes__list",children:i.length===0?a.jsx("div",{className:"request-notes__empty",children:"No notes yet"}):i.map(_=>a.jsx("div",{className:"request-note",children:p===_.id?a.jsxs("div",{className:"request-note__edit",children:[a.jsx("textarea",{value:g,onChange:R=>v(R.target.value),className:"request-note__edit-textarea",rows:3}),a.jsxs("div",{className:"request-note__edit-actions",children:[a.jsx("button",{onClick:()=>A(_.id),className:"request-note__edit-save",children:"Save"}),a.jsx("button",{onClick:C,className:"request-note__edit-cancel",children:"Cancel"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"request-note__content",children:_.content}),a.jsxs("div",{className:"request-note__footer",children:[a.jsxs("div",{className:"request-note__meta",children:[a.jsx("span",{className:"request-note__author",children:_.author?.username||"Unknown"}),a.jsx("span",{className:"request-note__time",children:O(_.createdAt)})]}),r?.id===_.createdBy&&a.jsxs("div",{className:"request-note__actions",children:[a.jsx("button",{onClick:()=>E(_),className:"request-note__action",title:"Edit note",children:a.jsx(N1,{size:14})}),a.jsx("button",{onClick:()=>N(_.id),className:"request-note__action",title:"Delete note",children:a.jsx(ha,{size:14})})]})]})]})},_.id))})]})}function I$(){const{id:e}=Ss(),t=$n(),{user:r}=En(),i=r?.role==="system_admin",[l,c]=u.useState(null),[f,m]=u.useState(!1),[h,p]=u.useState(!1),[y,g]=u.useState([]),[v,S]=u.useState(!1),[w,N]=u.useState(!1),[E,C]=u.useState({status:"",assignedTo:"",testerId:"",priority:"",isInBacklog:!1}),A=async()=>{m(!0);try{const j=await N$(e);if(j?.success&&j?.data){const z=j.data;c(z),C({status:z.status||"",assignedTo:z.assignedTo||"",testerId:z.testerId||"",priority:z.priority||"",isInBacklog:z.isInBacklog||!1})}else throw new Error("Request not found")}catch(j){console.error("Failed to load request",j),alert(j.message||"Failed to load request"),t("/requests")}finally{m(!1)}};u.useEffect(()=>{e&&A()},[e]),u.useEffect(()=>{i&&w&&O()},[i,w]);const O=async()=>{S(!0);try{const j=await Zy();g(Array.isArray(j?.data)?j.data:[])}catch(j){console.error("Failed to load users",j)}finally{S(!1)}},_=async()=>{p(!0);try{const j={};if(E.status&&E.status!==l.status&&(j.status=E.status),E.assignedTo!==l.assignedTo&&(j.assignedTo=E.assignedTo||null),E.testerId!==l.testerId&&(j.testerId=E.testerId||null),E.priority!==l.priority&&(j.priority=E.priority||null),E.isInBacklog!==l.isInBacklog&&(j.isInBacklog=E.isInBacklog),Object.keys(j).length===0){N(!1);return}await j$(e,j),await A(),N(!1)}catch(j){console.error("Failed to update request",j),alert("Failed to update request")}finally{p(!1)}},R=async()=>{if(confirm("Are you sure you want to delete this request? This action cannot be undone."))try{await _$(e),t("/requests")}catch(j){console.error("Failed to delete request",j),alert("Failed to delete request")}},D=l&&(i||String(l.createdBy)===String(r?.id)||String(l.testerId)===String(r?.id));return f?a.jsx("div",{className:"request-detail-page__loading",children:"Loading request..."}):l?a.jsxs("div",{className:"request-detail-page",children:[a.jsxs("div",{className:"request-detail-page__header",children:[a.jsxs(Qt,{to:"/requests",className:"request-detail-page__back",children:[a.jsx(My,{size:20}),"Back to Feature/Bugs"]}),a.jsxs("div",{className:"request-detail-page__title-section",children:[a.jsxs("div",{className:"request-detail-page__type-badge",children:[l.type==="bug"?a.jsx(ky,{size:20,className:"request-detail-page__type-icon"}):a.jsx(Di,{size:20,className:"request-detail-page__type-icon"}),a.jsx("span",{children:l.type==="bug"?"Bug":"Feature"})]}),a.jsx("h1",{children:l.title}),a.jsxs("div",{className:"request-detail-page__meta",children:[a.jsx(pj,{status:l.status}),l.priority&&a.jsxs("span",{className:"request-detail-page__priority",children:["Priority: ",l.priority]}),l.isInBacklog&&a.jsx("span",{className:"request-detail-page__backlog-badge",children:"In Backlog"})]})]})]}),a.jsx("div",{className:"request-detail-page__content",children:a.jsxs("div",{className:"request-detail-page__main",children:[a.jsxs("div",{className:"request-detail-page__section",children:[a.jsx("h2",{children:"Description"}),a.jsx("div",{className:"request-detail-page__description",children:l.description.split(`
`).map((j,z)=>a.jsx("p",{children:j},z))})]}),a.jsxs("div",{className:"request-detail-page__section",children:[a.jsx("h2",{children:"Details"}),a.jsxs("dl",{className:"request-detail-page__details",children:[a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Created by:"}),a.jsx("dd",{children:l.creator?.username||"Unknown"})]}),a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Created:"}),a.jsx("dd",{children:new Date(l.createdAt).toLocaleString()})]}),l.assignee&&a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Assigned to:"}),a.jsx("dd",{children:l.assignee.username})]}),l.tester&&a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Tester:"}),a.jsx("dd",{children:l.tester.username})]}),l.updatedAt!==l.createdAt&&a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Last updated:"}),a.jsx("dd",{children:new Date(l.updatedAt).toLocaleString()})]})]})]}),i&&a.jsxs("div",{className:"request-detail-page__section",children:[a.jsxs("div",{className:"request-detail-page__admin-header",children:[a.jsx("h2",{children:"Admin Controls"}),a.jsxs("button",{onClick:()=>N(!w),className:`request-detail-page__admin-toggle ${w?"request-detail-page__admin-toggle--active":""}`,type:"button",children:[a.jsx(E1,{size:18}),a.jsx("span",{children:w?"Hide Controls":"Show Controls"}),a.jsx(Hr,{size:16,className:`request-detail-page__admin-toggle-icon ${w?"request-detail-page__admin-toggle-icon--rotated":""}`})]})]}),w&&a.jsxs("div",{className:"request-detail-page__admin-form",children:[a.jsxs("div",{className:"request-detail-page__admin-field",children:[a.jsx("label",{children:"Status:"}),a.jsxs("select",{value:E.status,onChange:j=>C(z=>({...z,status:j.target.value})),className:"request-detail-page__admin-select",children:[a.jsx("option",{value:"open",children:"Open"}),a.jsx("option",{value:"in_progress",children:"In Progress"}),a.jsx("option",{value:"testing",children:"Testing"}),a.jsx("option",{value:"resolved",children:"Resolved"}),a.jsx("option",{value:"closed",children:"Closed"}),a.jsx("option",{value:"backlog",children:"Backlog"})]})]}),a.jsxs("div",{className:"request-detail-page__admin-field",children:[a.jsx("label",{children:"Tester:"}),a.jsxs("select",{value:E.testerId,onChange:j=>C(z=>({...z,testerId:j.target.value})),className:"request-detail-page__admin-select",disabled:v,children:[a.jsx("option",{value:"",children:"None"}),y.map(j=>a.jsxs("option",{value:j.id,children:[j.username," ",j.email?`(${j.email})`:""]},j.id))]})]}),a.jsxs("div",{className:"request-detail-page__admin-field",children:[a.jsx("label",{children:"Priority:"}),a.jsxs("select",{value:E.priority,onChange:j=>C(z=>({...z,priority:j.target.value})),className:"request-detail-page__admin-select",children:[a.jsx("option",{value:"",children:"None"}),a.jsx("option",{value:"low",children:"Low"}),a.jsx("option",{value:"medium",children:"Medium"}),a.jsx("option",{value:"high",children:"High"})]})]}),a.jsx("div",{className:"request-detail-page__admin-field",children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:E.isInBacklog,onChange:j=>C(z=>({...z,isInBacklog:j.target.checked}))}),"In Backlog"]})}),a.jsxs("div",{className:"request-detail-page__admin-actions",children:[a.jsx("button",{onClick:_,disabled:h,className:"request-detail-page__admin-save",children:h?"Saving...":"Save Changes"}),a.jsxs("button",{onClick:R,className:"request-detail-page__admin-delete",children:[a.jsx(ha,{size:16}),"Delete Request"]})]})]})]}),a.jsx(D$,{requestId:e,canAddNote:D})]})})]}):null}function L$(){const e=$n(),[t,r]=u.useState(!1),[i,l]=u.useState({type:"bug",title:"",description:"",priority:""}),[c,f]=u.useState({}),m=y=>{const{name:g,value:v}=y.target;l(S=>({...S,[g]:v})),c[g]&&f(S=>({...S,[g]:""}))},h=()=>{const y={};return i.title.trim()||(y.title="Title is required"),i.description.trim()||(y.description="Description is required"),f(y),Object.keys(y).length===0},p=async y=>{if(y.preventDefault(),!!h()){r(!0);try{const g={type:i.type,title:i.title.trim(),description:i.description.trim(),priority:i.priority||null},v=await E$(g);if(v?.success&&v?.data?.id)e(`/requests/${v.data.id}`);else throw new Error("Failed to create request")}catch(g){console.error("Failed to create request",g),alert(g.message||"Failed to create request")}finally{r(!1)}}};return a.jsxs("div",{className:"create-request-page",children:[a.jsxs("div",{className:"create-request-page__header",children:[a.jsxs("button",{onClick:()=>e("/requests"),className:"create-request-page__back",children:[a.jsx(My,{size:20}),"Back to Feature/Bugs"]}),a.jsx("h1",{children:"Create Feature/Bug Request"})]}),a.jsxs("form",{onSubmit:p,className:"create-request-form",children:[a.jsxs("div",{className:"create-request-form__section",children:[a.jsx("label",{className:"create-request-form__label",children:"Type"}),a.jsxs("div",{className:"create-request-form__type-options",children:[a.jsxs("label",{className:"create-request-form__type-option",children:[a.jsx("input",{type:"radio",name:"type",value:"bug",checked:i.type==="bug",onChange:m}),a.jsx(ky,{size:20}),a.jsx("span",{children:"Bug"})]}),a.jsxs("label",{className:"create-request-form__type-option",children:[a.jsx("input",{type:"radio",name:"type",value:"feature",checked:i.type==="feature",onChange:m}),a.jsx(Di,{size:20}),a.jsx("span",{children:"Feature"})]})]})]}),a.jsxs("div",{className:"create-request-form__section",children:[a.jsxs("label",{htmlFor:"title",className:"create-request-form__label",children:["Title ",a.jsx("span",{className:"create-request-form__required",children:"*"})]}),a.jsx("input",{id:"title",name:"title",type:"text",value:i.title,onChange:m,className:`create-request-form__input ${c.title?"create-request-form__input--error":""}`,placeholder:"Brief description of the issue or feature",disabled:t}),c.title&&a.jsx("div",{className:"create-request-form__error",children:c.title})]}),a.jsxs("div",{className:"create-request-form__section",children:[a.jsxs("label",{htmlFor:"description",className:"create-request-form__label",children:["Description ",a.jsx("span",{className:"create-request-form__required",children:"*"})]}),a.jsx("textarea",{id:"description",name:"description",value:i.description,onChange:m,className:`create-request-form__textarea ${c.description?"create-request-form__textarea--error":""}`,placeholder:"Provide detailed information about the bug or feature request...",rows:8,disabled:t}),c.description&&a.jsx("div",{className:"create-request-form__error",children:c.description})]}),a.jsxs("div",{className:"create-request-form__section",children:[a.jsx("label",{htmlFor:"priority",className:"create-request-form__label",children:"Priority (optional)"}),a.jsxs("select",{id:"priority",name:"priority",value:i.priority,onChange:m,className:"create-request-form__select",disabled:t,children:[a.jsx("option",{value:"",children:"None"}),a.jsx("option",{value:"low",children:"Low"}),a.jsx("option",{value:"medium",children:"Medium"}),a.jsx("option",{value:"high",children:"High"})]})]}),a.jsxs("div",{className:"create-request-form__actions",children:[a.jsx("button",{type:"button",onClick:()=>e("/requests"),className:"create-request-form__cancel",disabled:t,children:"Cancel"}),a.jsx("button",{type:"submit",className:"create-request-form__submit",disabled:t,children:t?"Creating...":"Submit Request"})]})]})]})}const O$=M2(i2(a.jsxs(a.Fragment,{children:[a.jsx(Xt,{path:"/login",element:a.jsx($3,{})}),a.jsxs(Xt,{path:"/",element:a.jsx(QI,{children:a.jsx(rk,{})}),children:[a.jsx(Xt,{index:!0,element:a.jsx(lk,{})}),a.jsx(Xt,{path:"worlds",element:a.jsx(Zk,{})}),a.jsx(Xt,{path:"worlds/:id",element:a.jsx(s3,{})}),a.jsx(Xt,{path:"worlds/:worldId/access/bulk",element:a.jsx(Ow,{})}),a.jsx(Xt,{path:"worlds/:worldId/access/audit",element:a.jsx(d$,{})}),a.jsx(Xt,{path:"worlds/:worldId/collections",element:a.jsx(f$,{})}),a.jsx(Xt,{path:"campaigns/:campaignId/access/bulk",element:a.jsx(Ow,{})}),a.jsxs(Xt,{path:"campaigns",children:[a.jsx(Xt,{index:!0,element:a.jsx(Xo,{to:"/campaigns/my",replace:!0})}),a.jsx(Xt,{path:"my",element:a.jsx(Uu,{scope:"my"})}),a.jsx(Xt,{path:"my/:id",element:a.jsx(Uu,{scope:"my"})}),a.jsx(Xt,{path:"all",element:a.jsx(Uu,{scope:"all"})}),a.jsx(Xt,{path:"all/:id",element:a.jsx(Uu,{scope:"all"})})]}),a.jsx(Xt,{path:"entities",element:a.jsx(l4,{})}),a.jsx(Xt,{path:"entities/bulk-upload",element:a.jsx(qz,{})}),a.jsx(Xt,{path:"entities/followed",element:a.jsx(S$,{})}),a.jsx(Xt,{path:"entities/:entityId/relationship-viewer",element:a.jsx($z,{})}),a.jsx(Xt,{path:"entities/:id",element:a.jsx(iI,{})}),a.jsxs(Xt,{path:"entity-types",children:[a.jsx(Xt,{index:!0,element:a.jsx(cI,{})}),a.jsx(Xt,{path:"new",element:a.jsx(CI,{})}),a.jsx(Xt,{path:":id/fields",element:a.jsx(NI,{})})]}),a.jsxs(Xt,{path:"relationship-types",children:[a.jsx(Xt,{index:!0,element:a.jsx(XI,{})}),a.jsx(Xt,{path:"new",element:a.jsx(KI,{})}),a.jsx(Xt,{path:":id/edit",element:a.jsx(WI,{})})]}),a.jsx(Xt,{path:"entity-relationships",element:a.jsx(PI,{})}),a.jsx(Xt,{path:"entity-secrets",element:a.jsx(ZI,{})}),a.jsxs(Xt,{path:"notes",children:[a.jsx(Xt,{index:!0,element:a.jsx(Xo,{to:"/notes/session",replace:!0})}),a.jsx(Xt,{path:"session",element:a.jsx(Yz,{})}),a.jsx(Xt,{path:"entities",element:a.jsx(Jz,{})})]}),a.jsxs(Xt,{path:"characters",children:[a.jsx(Xt,{index:!0,element:a.jsx(Xo,{to:"/characters/my",replace:!0})}),a.jsx(Xt,{path:"my",element:a.jsx(Lr,{scope:"my"})}),a.jsx(Xt,{path:"my/:id",element:a.jsx(Lr,{scope:"my"})}),a.jsx(Xt,{path:"others",element:a.jsx(Lr,{scope:"others"})}),a.jsx(Xt,{path:"others/:id",element:a.jsx(Lr,{scope:"others"})}),a.jsx(Xt,{path:"companions",element:a.jsx(Lr,{scope:"companions"})}),a.jsx(Xt,{path:"companions/:id",element:a.jsx(Lr,{scope:"companions"})}),a.jsx(Xt,{path:"all",element:a.jsx(Lr,{scope:"all"})}),a.jsx(Xt,{path:"all/:id",element:a.jsx(Lr,{scope:"all"})})]}),a.jsx(Xt,{path:"users",element:a.jsx(z3,{})}),a.jsx(Xt,{path:"security",element:a.jsx(y$,{})}),a.jsx(Xt,{path:"notifications",element:a.jsx(x$,{})}),a.jsxs(Xt,{path:"requests",children:[a.jsx(Xt,{index:!0,element:a.jsx(T$,{})}),a.jsx(Xt,{path:"new",element:a.jsx(L$,{})}),a.jsx(Xt,{path:":id",element:a.jsx(I$,{})})]})]}),a.jsx(Xt,{path:"*",element:a.jsx(Xo,{to:"/",replace:!0})})]})));function z$(){return a.jsx(P2,{router:O$})}TC.createRoot(document.getElementById("root")).render(a.jsx(u.StrictMode,{children:a.jsx(QM,{children:a.jsx(MI,{children:a.jsx(DM,{children:a.jsx(WM,{children:a.jsx(AR,{children:a.jsx(z$,{})})})})})})}));

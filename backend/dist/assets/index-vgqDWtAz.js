(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function s(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerPolicy&&(o.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?o.credentials="include":l.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(l){if(l.ep)return;l.ep=!0;const o=s(l);fetch(l.href,o)}})();function zi(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Vh={exports:{}},Ho={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R0;function MA(){if(R0)return Ho;R0=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function s(i,l,o){var d=null;if(o!==void 0&&(d=""+o),l.key!==void 0&&(d=""+l.key),"key"in l){o={};for(var m in l)m!=="key"&&(o[m]=l[m])}else o=l;return l=o.ref,{$$typeof:e,type:i,key:d,ref:l!==void 0?l:null,props:o}}return Ho.Fragment=n,Ho.jsx=s,Ho.jsxs=s,Ho}var I0;function kA(){return I0||(I0=1,Vh.exports=MA()),Vh.exports}var t=kA(),Yh={exports:{}},an={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D0;function RA(){if(D0)return an;D0=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),d=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),x=Symbol.iterator;function v(I){return I===null||typeof I!="object"?null:(I=x&&I[x]||I["@@iterator"],typeof I=="function"?I:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N=Object.assign,E={};function j(I,Y,P){this.props=I,this.context=Y,this.refs=E,this.updater=P||S}j.prototype.isReactComponent={},j.prototype.setState=function(I,Y){if(typeof I!="object"&&typeof I!="function"&&I!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,I,Y,"setState")},j.prototype.forceUpdate=function(I){this.updater.enqueueForceUpdate(this,I,"forceUpdate")};function A(){}A.prototype=j.prototype;function T(I,Y,P){this.props=I,this.context=Y,this.refs=E,this.updater=P||S}var _=T.prototype=new A;_.constructor=T,N(_,j.prototype),_.isPureReactComponent=!0;var M=Array.isArray;function k(){}var C={H:null,A:null,T:null,S:null},D=Object.prototype.hasOwnProperty;function z(I,Y,P){var K=P.ref;return{$$typeof:e,type:I,key:Y,ref:K!==void 0?K:null,props:P}}function G(I,Y){return z(I.type,Y,I.props)}function U(I){return typeof I=="object"&&I!==null&&I.$$typeof===e}function X(I){var Y={"=":"=0",":":"=2"};return"$"+I.replace(/[=:]/g,function(P){return Y[P]})}var V=/\/+/g;function R(I,Y){return typeof I=="object"&&I!==null&&I.key!=null?X(""+I.key):Y.toString(36)}function B(I){switch(I.status){case"fulfilled":return I.value;case"rejected":throw I.reason;default:switch(typeof I.status=="string"?I.then(k,k):(I.status="pending",I.then(function(Y){I.status==="pending"&&(I.status="fulfilled",I.value=Y)},function(Y){I.status==="pending"&&(I.status="rejected",I.reason=Y)})),I.status){case"fulfilled":return I.value;case"rejected":throw I.reason}}throw I}function L(I,Y,P,K,re){var W=typeof I;(W==="undefined"||W==="boolean")&&(I=null);var ue=!1;if(I===null)ue=!0;else switch(W){case"bigint":case"string":case"number":ue=!0;break;case"object":switch(I.$$typeof){case e:case n:ue=!0;break;case y:return ue=I._init,L(ue(I._payload),Y,P,K,re)}}if(ue)return re=re(I),ue=K===""?"."+R(I,0):K,M(re)?(P="",ue!=null&&(P=ue.replace(V,"$&/")+"/"),L(re,Y,P,"",function(ae){return ae})):re!=null&&(U(re)&&(re=G(re,P+(re.key==null||I&&I.key===re.key?"":(""+re.key).replace(V,"$&/")+"/")+ue)),Y.push(re)),1;ue=0;var Q=K===""?".":K+":";if(M(I))for(var ye=0;ye<I.length;ye++)K=I[ye],W=Q+R(K,ye),ue+=L(K,Y,P,W,re);else if(ye=v(I),typeof ye=="function")for(I=ye.call(I),ye=0;!(K=I.next()).done;)K=K.value,W=Q+R(K,ye++),ue+=L(K,Y,P,W,re);else if(W==="object"){if(typeof I.then=="function")return L(B(I),Y,P,K,re);throw Y=String(I),Error("Objects are not valid as a React child (found: "+(Y==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":Y)+"). If you meant to render a collection of children, use an array instead.")}return ue}function O(I,Y,P){if(I==null)return I;var K=[],re=0;return L(I,K,"","",function(W){return Y.call(P,W,re++)}),K}function $(I){if(I._status===-1){var Y=I._result;Y=Y(),Y.then(function(P){(I._status===0||I._status===-1)&&(I._status=1,I._result=P)},function(P){(I._status===0||I._status===-1)&&(I._status=2,I._result=P)}),I._status===-1&&(I._status=0,I._result=Y)}if(I._status===1)return I._result.default;throw I._result}var F=typeof reportError=="function"?reportError:function(I){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Y=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof I=="object"&&I!==null&&typeof I.message=="string"?String(I.message):String(I),error:I});if(!window.dispatchEvent(Y))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",I);return}console.error(I)},H={map:O,forEach:function(I,Y,P){O(I,function(){Y.apply(this,arguments)},P)},count:function(I){var Y=0;return O(I,function(){Y++}),Y},toArray:function(I){return O(I,function(Y){return Y})||[]},only:function(I){if(!U(I))throw Error("React.Children.only expected to receive a single React element child.");return I}};return an.Activity=g,an.Children=H,an.Component=j,an.Fragment=s,an.Profiler=l,an.PureComponent=T,an.StrictMode=i,an.Suspense=p,an.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,an.__COMPILER_RUNTIME={__proto__:null,c:function(I){return C.H.useMemoCache(I)}},an.cache=function(I){return function(){return I.apply(null,arguments)}},an.cacheSignal=function(){return null},an.cloneElement=function(I,Y,P){if(I==null)throw Error("The argument must be a React element, but you passed "+I+".");var K=N({},I.props),re=I.key;if(Y!=null)for(W in Y.key!==void 0&&(re=""+Y.key),Y)!D.call(Y,W)||W==="key"||W==="__self"||W==="__source"||W==="ref"&&Y.ref===void 0||(K[W]=Y[W]);var W=arguments.length-2;if(W===1)K.children=P;else if(1<W){for(var ue=Array(W),Q=0;Q<W;Q++)ue[Q]=arguments[Q+2];K.children=ue}return z(I.type,re,K)},an.createContext=function(I){return I={$$typeof:d,_currentValue:I,_currentValue2:I,_threadCount:0,Provider:null,Consumer:null},I.Provider=I,I.Consumer={$$typeof:o,_context:I},I},an.createElement=function(I,Y,P){var K,re={},W=null;if(Y!=null)for(K in Y.key!==void 0&&(W=""+Y.key),Y)D.call(Y,K)&&K!=="key"&&K!=="__self"&&K!=="__source"&&(re[K]=Y[K]);var ue=arguments.length-2;if(ue===1)re.children=P;else if(1<ue){for(var Q=Array(ue),ye=0;ye<ue;ye++)Q[ye]=arguments[ye+2];re.children=Q}if(I&&I.defaultProps)for(K in ue=I.defaultProps,ue)re[K]===void 0&&(re[K]=ue[K]);return z(I,W,re)},an.createRef=function(){return{current:null}},an.forwardRef=function(I){return{$$typeof:m,render:I}},an.isValidElement=U,an.lazy=function(I){return{$$typeof:y,_payload:{_status:-1,_result:I},_init:$}},an.memo=function(I,Y){return{$$typeof:h,type:I,compare:Y===void 0?null:Y}},an.startTransition=function(I){var Y=C.T,P={};C.T=P;try{var K=I(),re=C.S;re!==null&&re(P,K),typeof K=="object"&&K!==null&&typeof K.then=="function"&&K.then(k,F)}catch(W){F(W)}finally{Y!==null&&P.types!==null&&(Y.types=P.types),C.T=Y}},an.unstable_useCacheRefresh=function(){return C.H.useCacheRefresh()},an.use=function(I){return C.H.use(I)},an.useActionState=function(I,Y,P){return C.H.useActionState(I,Y,P)},an.useCallback=function(I,Y){return C.H.useCallback(I,Y)},an.useContext=function(I){return C.H.useContext(I)},an.useDebugValue=function(){},an.useDeferredValue=function(I,Y){return C.H.useDeferredValue(I,Y)},an.useEffect=function(I,Y){return C.H.useEffect(I,Y)},an.useEffectEvent=function(I){return C.H.useEffectEvent(I)},an.useId=function(){return C.H.useId()},an.useImperativeHandle=function(I,Y,P){return C.H.useImperativeHandle(I,Y,P)},an.useInsertionEffect=function(I,Y){return C.H.useInsertionEffect(I,Y)},an.useLayoutEffect=function(I,Y){return C.H.useLayoutEffect(I,Y)},an.useMemo=function(I,Y){return C.H.useMemo(I,Y)},an.useOptimistic=function(I,Y){return C.H.useOptimistic(I,Y)},an.useReducer=function(I,Y,P){return C.H.useReducer(I,Y,P)},an.useRef=function(I){return C.H.useRef(I)},an.useState=function(I){return C.H.useState(I)},an.useSyncExternalStore=function(I,Y,P){return C.H.useSyncExternalStore(I,Y,P)},an.useTransition=function(){return C.H.useTransition()},an.version="19.2.0",an}var L0;function Fc(){return L0||(L0=1,Yh.exports=RA()),Yh.exports}var u=Fc();const Ve=zi(u);var Gh={exports:{}},Vo={},Kh={exports:{}},Xh={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O0;function IA(){return O0||(O0=1,(function(e){function n(L,O){var $=L.length;L.push(O);e:for(;0<$;){var F=$-1>>>1,H=L[F];if(0<l(H,O))L[F]=O,L[$]=H,$=F;else break e}}function s(L){return L.length===0?null:L[0]}function i(L){if(L.length===0)return null;var O=L[0],$=L.pop();if($!==O){L[0]=$;e:for(var F=0,H=L.length,I=H>>>1;F<I;){var Y=2*(F+1)-1,P=L[Y],K=Y+1,re=L[K];if(0>l(P,$))K<H&&0>l(re,P)?(L[F]=re,L[K]=$,F=K):(L[F]=P,L[Y]=$,F=Y);else if(K<H&&0>l(re,$))L[F]=re,L[K]=$,F=K;else break e}}return O}function l(L,O){var $=L.sortIndex-O.sortIndex;return $!==0?$:L.id-O.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var d=Date,m=d.now();e.unstable_now=function(){return d.now()-m}}var p=[],h=[],y=1,g=null,x=3,v=!1,S=!1,N=!1,E=!1,j=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;function _(L){for(var O=s(h);O!==null;){if(O.callback===null)i(h);else if(O.startTime<=L)i(h),O.sortIndex=O.expirationTime,n(p,O);else break;O=s(h)}}function M(L){if(N=!1,_(L),!S)if(s(p)!==null)S=!0,k||(k=!0,X());else{var O=s(h);O!==null&&B(M,O.startTime-L)}}var k=!1,C=-1,D=5,z=-1;function G(){return E?!0:!(e.unstable_now()-z<D)}function U(){if(E=!1,k){var L=e.unstable_now();z=L;var O=!0;try{e:{S=!1,N&&(N=!1,A(C),C=-1),v=!0;var $=x;try{t:{for(_(L),g=s(p);g!==null&&!(g.expirationTime>L&&G());){var F=g.callback;if(typeof F=="function"){g.callback=null,x=g.priorityLevel;var H=F(g.expirationTime<=L);if(L=e.unstable_now(),typeof H=="function"){g.callback=H,_(L),O=!0;break t}g===s(p)&&i(p),_(L)}else i(p);g=s(p)}if(g!==null)O=!0;else{var I=s(h);I!==null&&B(M,I.startTime-L),O=!1}}break e}finally{g=null,x=$,v=!1}O=void 0}}finally{O?X():k=!1}}}var X;if(typeof T=="function")X=function(){T(U)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,R=V.port2;V.port1.onmessage=U,X=function(){R.postMessage(null)}}else X=function(){j(U,0)};function B(L,O){C=j(function(){L(e.unstable_now())},O)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(L){L.callback=null},e.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<L?Math.floor(1e3/L):5},e.unstable_getCurrentPriorityLevel=function(){return x},e.unstable_next=function(L){switch(x){case 1:case 2:case 3:var O=3;break;default:O=x}var $=x;x=O;try{return L()}finally{x=$}},e.unstable_requestPaint=function(){E=!0},e.unstable_runWithPriority=function(L,O){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var $=x;x=L;try{return O()}finally{x=$}},e.unstable_scheduleCallback=function(L,O,$){var F=e.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?F+$:F):$=F,L){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=$+H,L={id:y++,callback:O,priorityLevel:L,startTime:$,expirationTime:H,sortIndex:-1},$>F?(L.sortIndex=$,n(h,L),s(p)===null&&L===s(h)&&(N?(A(C),C=-1):N=!0,B(M,$-F))):(L.sortIndex=H,n(p,L),S||v||(S=!0,k||(k=!0,X()))),L},e.unstable_shouldYield=G,e.unstable_wrapCallback=function(L){var O=x;return function(){var $=x;x=O;try{return L.apply(this,arguments)}finally{x=$}}}})(Xh)),Xh}var $0;function DA(){return $0||($0=1,Kh.exports=IA()),Kh.exports}var Wh={exports:{}},pa={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F0;function LA(){if(F0)return pa;F0=1;var e=Fc();function n(p){var h="https://react.dev/errors/"+p;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)h+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+p+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var i={d:{f:s,r:function(){throw Error(n(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},l=Symbol.for("react.portal");function o(p,h,y){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:g==null?null:""+g,children:p,containerInfo:h,implementation:y}}var d=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function m(p,h){if(p==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return pa.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,pa.createPortal=function(p,h){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(n(299));return o(p,h,null,y)},pa.flushSync=function(p){var h=d.T,y=i.p;try{if(d.T=null,i.p=2,p)return p()}finally{d.T=h,i.p=y,i.d.f()}},pa.preconnect=function(p,h){typeof p=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,i.d.C(p,h))},pa.prefetchDNS=function(p){typeof p=="string"&&i.d.D(p)},pa.preinit=function(p,h){if(typeof p=="string"&&h&&typeof h.as=="string"){var y=h.as,g=m(y,h.crossOrigin),x=typeof h.integrity=="string"?h.integrity:void 0,v=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;y==="style"?i.d.S(p,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:g,integrity:x,fetchPriority:v}):y==="script"&&i.d.X(p,{crossOrigin:g,integrity:x,fetchPriority:v,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},pa.preinitModule=function(p,h){if(typeof p=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var y=m(h.as,h.crossOrigin);i.d.M(p,{crossOrigin:y,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&i.d.M(p)},pa.preload=function(p,h){if(typeof p=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var y=h.as,g=m(y,h.crossOrigin);i.d.L(p,y,{crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},pa.preloadModule=function(p,h){if(typeof p=="string")if(h){var y=m(h.as,h.crossOrigin);i.d.m(p,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:y,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else i.d.m(p)},pa.requestFormReset=function(p){i.d.r(p)},pa.unstable_batchedUpdates=function(p,h){return p(h)},pa.useFormState=function(p,h,y){return d.H.useFormState(p,h,y)},pa.useFormStatus=function(){return d.H.useHostTransitionStatus()},pa.version="19.2.0",pa}var z0;function TN(){if(z0)return Wh.exports;z0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}return e(),Wh.exports=LA(),Wh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B0;function OA(){if(B0)return Vo;B0=1;var e=DA(),n=Fc(),s=TN();function i(a){var r="https://react.dev/errors/"+a;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)r+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+a+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function o(a){var r=a,c=a;if(a.alternate)for(;r.return;)r=r.return;else{a=r;do r=a,(r.flags&4098)!==0&&(c=r.return),a=r.return;while(a)}return r.tag===3?c:null}function d(a){if(a.tag===13){var r=a.memoizedState;if(r===null&&(a=a.alternate,a!==null&&(r=a.memoizedState)),r!==null)return r.dehydrated}return null}function m(a){if(a.tag===31){var r=a.memoizedState;if(r===null&&(a=a.alternate,a!==null&&(r=a.memoizedState)),r!==null)return r.dehydrated}return null}function p(a){if(o(a)!==a)throw Error(i(188))}function h(a){var r=a.alternate;if(!r){if(r=o(a),r===null)throw Error(i(188));return r!==a?null:a}for(var c=a,f=r;;){var b=c.return;if(b===null)break;var w=b.alternate;if(w===null){if(f=b.return,f!==null){c=f;continue}break}if(b.child===w.child){for(w=b.child;w;){if(w===c)return p(b),a;if(w===f)return p(b),r;w=w.sibling}throw Error(i(188))}if(c.return!==f.return)c=b,f=w;else{for(var q=!1,te=b.child;te;){if(te===c){q=!0,c=b,f=w;break}if(te===f){q=!0,f=b,c=w;break}te=te.sibling}if(!q){for(te=w.child;te;){if(te===c){q=!0,c=w,f=b;break}if(te===f){q=!0,f=w,c=b;break}te=te.sibling}if(!q)throw Error(i(189))}}if(c.alternate!==f)throw Error(i(190))}if(c.tag!==3)throw Error(i(188));return c.stateNode.current===c?a:r}function y(a){var r=a.tag;if(r===5||r===26||r===27||r===6)return a;for(a=a.child;a!==null;){if(r=y(a),r!==null)return r;a=a.sibling}return null}var g=Object.assign,x=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),A=Symbol.for("react.consumer"),T=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),k=Symbol.for("react.suspense_list"),C=Symbol.for("react.memo"),D=Symbol.for("react.lazy"),z=Symbol.for("react.activity"),G=Symbol.for("react.memo_cache_sentinel"),U=Symbol.iterator;function X(a){return a===null||typeof a!="object"?null:(a=U&&a[U]||a["@@iterator"],typeof a=="function"?a:null)}var V=Symbol.for("react.client.reference");function R(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===V?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case N:return"Fragment";case j:return"Profiler";case E:return"StrictMode";case M:return"Suspense";case k:return"SuspenseList";case z:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case S:return"Portal";case T:return a.displayName||"Context";case A:return(a._context.displayName||"Context")+".Consumer";case _:var r=a.render;return a=a.displayName,a||(a=r.displayName||r.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case C:return r=a.displayName||null,r!==null?r:R(a.type)||"Memo";case D:r=a._payload,a=a._init;try{return R(a(r))}catch{}}return null}var B=Array.isArray,L=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$={pending:!1,data:null,method:null,action:null},F=[],H=-1;function I(a){return{current:a}}function Y(a){0>H||(a.current=F[H],F[H]=null,H--)}function P(a,r){H++,F[H]=a.current,a.current=r}var K=I(null),re=I(null),W=I(null),ue=I(null);function Q(a,r){switch(P(W,r),P(re,a),P(K,null),r.nodeType){case 9:case 11:a=(a=r.documentElement)&&(a=a.namespaceURI)?t0(a):0;break;default:if(a=r.tagName,r=r.namespaceURI)r=t0(r),a=n0(r,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Y(K),P(K,a)}function ye(){Y(K),Y(re),Y(W)}function ae(a){a.memoizedState!==null&&P(ue,a);var r=K.current,c=n0(r,a.type);r!==c&&(P(re,a),P(K,c))}function ke(a){re.current===a&&(Y(K),Y(re)),ue.current===a&&(Y(ue),Bo._currentValue=$)}var pe,we;function ne(a){if(pe===void 0)try{throw Error()}catch(c){var r=c.stack.trim().match(/\n( *(at )?)/);pe=r&&r[1]||"",we=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+pe+a+we}var Le=!1;function be(a,r){if(!a||Le)return"";Le=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(r){var gt=function(){throw Error()};if(Object.defineProperty(gt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(gt,[])}catch(rt){var Qe=rt}Reflect.construct(a,[],gt)}else{try{gt.call()}catch(rt){Qe=rt}a.call(gt.prototype)}}else{try{throw Error()}catch(rt){Qe=rt}(gt=a())&&typeof gt.catch=="function"&&gt.catch(function(){})}}catch(rt){if(rt&&Qe&&typeof rt.stack=="string")return[rt.stack,Qe.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=f.DetermineComponentFrameRoot(),q=w[0],te=w[1];if(q&&te){var je=q.split(`
`),Xe=te.split(`
`);for(b=f=0;f<je.length&&!je[f].includes("DetermineComponentFrameRoot");)f++;for(;b<Xe.length&&!Xe[b].includes("DetermineComponentFrameRoot");)b++;if(f===je.length||b===Xe.length)for(f=je.length-1,b=Xe.length-1;1<=f&&0<=b&&je[f]!==Xe[b];)b--;for(;1<=f&&0<=b;f--,b--)if(je[f]!==Xe[b]){if(f!==1||b!==1)do if(f--,b--,0>b||je[f]!==Xe[b]){var ft=`
`+je[f].replace(" at new "," at ");return a.displayName&&ft.includes("<anonymous>")&&(ft=ft.replace("<anonymous>",a.displayName)),ft}while(1<=f&&0<=b);break}}}finally{Le=!1,Error.prepareStackTrace=c}return(c=a?a.displayName||a.name:"")?ne(c):""}function Oe(a,r){switch(a.tag){case 26:case 27:case 5:return ne(a.type);case 16:return ne("Lazy");case 13:return a.child!==r&&r!==null?ne("Suspense Fallback"):ne("Suspense");case 19:return ne("SuspenseList");case 0:case 15:return be(a.type,!1);case 11:return be(a.type.render,!1);case 1:return be(a.type,!0);case 31:return ne("Activity");default:return""}}function Me(a){try{var r="",c=null;do r+=Oe(a,c),c=a,a=a.return;while(a);return r}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var ut=Object.prototype.hasOwnProperty,ht=e.unstable_scheduleCallback,_t=e.unstable_cancelCallback,jt=e.unstable_shouldYield,ve=e.unstable_requestPaint,tt=e.unstable_now,st=e.unstable_getCurrentPriorityLevel,$e=e.unstable_ImmediatePriority,Ye=e.unstable_UserBlockingPriority,mt=e.unstable_NormalPriority,ie=e.unstable_LowPriority,J=e.unstable_IdlePriority,le=e.log,fe=e.unstable_setDisableYieldValue,Ue=null,qe=null;function ze(a){if(typeof le=="function"&&fe(a),qe&&typeof qe.setStrictMode=="function")try{qe.setStrictMode(Ue,a)}catch{}}var Ce=Math.clz32?Math.clz32:Ct,pt=Math.log,bt=Math.LN2;function Ct(a){return a>>>=0,a===0?32:31-(pt(a)/bt|0)|0}var Ze=256,ot=262144,Tt=4194304;function $t(a){var r=a&42;if(r!==0)return r;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Qt(a,r,c){var f=a.pendingLanes;if(f===0)return 0;var b=0,w=a.suspendedLanes,q=a.pingedLanes;a=a.warmLanes;var te=f&134217727;return te!==0?(f=te&~w,f!==0?b=$t(f):(q&=te,q!==0?b=$t(q):c||(c=te&~a,c!==0&&(b=$t(c))))):(te=f&~w,te!==0?b=$t(te):q!==0?b=$t(q):c||(c=f&~a,c!==0&&(b=$t(c)))),b===0?0:r!==0&&r!==b&&(r&w)===0&&(w=b&-b,c=r&-r,w>=c||w===32&&(c&4194048)!==0)?r:b}function At(a,r){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&r)===0}function kt(a,r){switch(a){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qt(){var a=Tt;return Tt<<=1,(Tt&62914560)===0&&(Tt=4194304),a}function Lt(a){for(var r=[],c=0;31>c;c++)r.push(a);return r}function ce(a,r){a.pendingLanes|=r,r!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Ae(a,r,c,f,b,w){var q=a.pendingLanes;a.pendingLanes=c,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=c,a.entangledLanes&=c,a.errorRecoveryDisabledLanes&=c,a.shellSuspendCounter=0;var te=a.entanglements,je=a.expirationTimes,Xe=a.hiddenUpdates;for(c=q&~c;0<c;){var ft=31-Ce(c),gt=1<<ft;te[ft]=0,je[ft]=-1;var Qe=Xe[ft];if(Qe!==null)for(Xe[ft]=null,ft=0;ft<Qe.length;ft++){var rt=Qe[ft];rt!==null&&(rt.lane&=-536870913)}c&=~gt}f!==0&&Te(a,f,0),w!==0&&b===0&&a.tag!==0&&(a.suspendedLanes|=w&~(q&~r))}function Te(a,r,c){a.pendingLanes|=r,a.suspendedLanes&=~r;var f=31-Ce(r);a.entangledLanes|=r,a.entanglements[f]=a.entanglements[f]|1073741824|c&261930}function Ke(a,r){var c=a.entangledLanes|=r;for(a=a.entanglements;c;){var f=31-Ce(c),b=1<<f;b&r|a[f]&r&&(a[f]|=r),c&=~b}}function Se(a,r){var c=r&-r;return c=(c&42)!==0?1:Be(c),(c&(a.suspendedLanes|r))!==0?0:c}function Be(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function We(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function se(){var a=O.p;return a!==0?a:(a=window.event,a===void 0?32:E0(a.type))}function Z(a,r){var c=O.p;try{return O.p=a,r()}finally{O.p=c}}var Ee=Math.random().toString(36).slice(2),_e="__reactFiber$"+Ee,ge="__reactProps$"+Ee,Pe="__reactContainer$"+Ee,oe="__reactEvents$"+Ee,at="__reactListeners$"+Ee,dt="__reactHandles$"+Ee,xt="__reactResources$"+Ee,de="__reactMarker$"+Ee;function it(a){delete a[_e],delete a[ge],delete a[oe],delete a[at],delete a[dt]}function nt(a){var r=a[_e];if(r)return r;for(var c=a.parentNode;c;){if(r=c[Pe]||c[_e]){if(c=r.alternate,r.child!==null||c!==null&&c.child!==null)for(a=c0(a);a!==null;){if(c=a[_e])return c;a=c0(a)}return r}a=c,c=a.parentNode}return null}function vt(a){if(a=a[_e]||a[Pe]){var r=a.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return a}return null}function lt(a){var r=a.tag;if(r===5||r===26||r===27||r===6)return a.stateNode;throw Error(i(33))}function wt(a){var r=a[xt];return r||(r=a[xt]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function He(a){a[de]=!0}var Je=new Set,St={};function ee(a,r){xe(a,r),xe(a+"Capture",r)}function xe(a,r){for(St[a]=r,a=0;a<r.length;a++)Je.add(r[a])}var Ie=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),et={},Nt={};function Rt(a){return ut.call(Nt,a)?!0:ut.call(et,a)?!1:Ie.test(a)?Nt[a]=!0:(et[a]=!0,!1)}function nn(a,r,c){if(Rt(r))if(c===null)a.removeAttribute(r);else{switch(typeof c){case"undefined":case"function":case"symbol":a.removeAttribute(r);return;case"boolean":var f=r.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){a.removeAttribute(r);return}}a.setAttribute(r,""+c)}}function Pt(a,r,c){if(c===null)a.removeAttribute(r);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(r);return}a.setAttribute(r,""+c)}}function Ft(a,r,c,f){if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttributeNS(r,c,""+f)}}function zt(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function dn(a){var r=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Bn(a,r,c){var f=Object.getOwnPropertyDescriptor(a.constructor.prototype,r);if(!a.hasOwnProperty(r)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var b=f.get,w=f.set;return Object.defineProperty(a,r,{configurable:!0,get:function(){return b.call(this)},set:function(q){c=""+q,w.call(this,q)}}),Object.defineProperty(a,r,{enumerable:f.enumerable}),{getValue:function(){return c},setValue:function(q){c=""+q},stopTracking:function(){a._valueTracker=null,delete a[r]}}}}function yn(a){if(!a._valueTracker){var r=dn(a)?"checked":"value";a._valueTracker=Bn(a,r,""+a[r])}}function ja(a){if(!a)return!1;var r=a._valueTracker;if(!r)return!0;var c=r.getValue(),f="";return a&&(f=dn(a)?a.checked?"true":"false":a.value),a=f,a!==c?(r.setValue(a),!0):!1}function ha(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Yi=/[\n"\\]/g;function ta(a){return a.replace(Yi,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function hs(a,r,c,f,b,w,q,te){a.name="",q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"?a.type=q:a.removeAttribute("type"),r!=null?q==="number"?(r===0&&a.value===""||a.value!=r)&&(a.value=""+zt(r)):a.value!==""+zt(r)&&(a.value=""+zt(r)):q!=="submit"&&q!=="reset"||a.removeAttribute("value"),r!=null?ri(a,q,zt(r)):c!=null?ri(a,q,zt(c)):f!=null&&a.removeAttribute("value"),b==null&&w!=null&&(a.defaultChecked=!!w),b!=null&&(a.checked=b&&typeof b!="function"&&typeof b!="symbol"),te!=null&&typeof te!="function"&&typeof te!="symbol"&&typeof te!="boolean"?a.name=""+zt(te):a.removeAttribute("name")}function xr(a,r,c,f,b,w,q,te){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(a.type=w),r!=null||c!=null){if(!(w!=="submit"&&w!=="reset"||r!=null)){yn(a);return}c=c!=null?""+zt(c):"",r=r!=null?""+zt(r):c,te||r===a.value||(a.value=r),a.defaultValue=r}f=f??b,f=typeof f!="function"&&typeof f!="symbol"&&!!f,a.checked=te?a.checked:!!f,a.defaultChecked=!!f,q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"&&(a.name=q),yn(a)}function ri(a,r,c){r==="number"&&ha(a.ownerDocument)===a||a.defaultValue===""+c||(a.defaultValue=""+c)}function ps(a,r,c,f){if(a=a.options,r){r={};for(var b=0;b<c.length;b++)r["$"+c[b]]=!0;for(c=0;c<a.length;c++)b=r.hasOwnProperty("$"+a[c].value),a[c].selected!==b&&(a[c].selected=b),b&&f&&(a[c].defaultSelected=!0)}else{for(c=""+zt(c),r=null,b=0;b<a.length;b++){if(a[b].value===c){a[b].selected=!0,f&&(a[b].defaultSelected=!0);return}r!==null||a[b].disabled||(r=a[b])}r!==null&&(r.selected=!0)}}function Un(a,r,c){if(r!=null&&(r=""+zt(r),r!==a.value&&(a.value=r),c==null)){a.defaultValue!==r&&(a.defaultValue=r);return}a.defaultValue=c!=null?""+zt(c):""}function Ys(a,r,c,f){if(r==null){if(f!=null){if(c!=null)throw Error(i(92));if(B(f)){if(1<f.length)throw Error(i(93));f=f[0]}c=f}c==null&&(c=""),r=c}c=zt(r),a.defaultValue=c,f=a.textContent,f===c&&f!==""&&f!==null&&(a.value=f),yn(a)}function Ea(a,r){if(r){var c=a.firstChild;if(c&&c===a.lastChild&&c.nodeType===3){c.nodeValue=r;return}}a.textContent=r}var to=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Gi(a,r,c){var f=r.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?f?a.setProperty(r,""):r==="float"?a.cssFloat="":a[r]="":f?a.setProperty(r,c):typeof c!="number"||c===0||to.has(r)?r==="float"?a.cssFloat=c:a[r]=(""+c).trim():a[r]=c+"px"}function Ki(a,r,c){if(r!=null&&typeof r!="object")throw Error(i(62));if(a=a.style,c!=null){for(var f in c)!c.hasOwnProperty(f)||r!=null&&r.hasOwnProperty(f)||(f.indexOf("--")===0?a.setProperty(f,""):f==="float"?a.cssFloat="":a[f]="");for(var b in r)f=r[b],r.hasOwnProperty(b)&&c[b]!==f&&Gi(a,b,f)}else for(var w in r)r.hasOwnProperty(w)&&Gi(a,w,r[w])}function ii(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var no=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ao=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function me(a){return ao.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function De(){}var Ot=null;function Zt(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var he=null,Ne=null;function ct(a){var r=vt(a);if(r&&(a=r.stateNode)){var c=a[ge]||null;e:switch(a=r.stateNode,r.type){case"input":if(hs(a,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),r=c.name,c.type==="radio"&&r!=null){for(c=a;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+ta(""+r)+'"][type="radio"]'),r=0;r<c.length;r++){var f=c[r];if(f!==a&&f.form===a.form){var b=f[ge]||null;if(!b)throw Error(i(90));hs(f,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(r=0;r<c.length;r++)f=c[r],f.form===a.form&&ja(f)}break e;case"textarea":Un(a,c.value,c.defaultValue);break e;case"select":r=c.value,r!=null&&ps(a,!!c.multiple,r,!1)}}}var It=!1;function Ht(a,r,c){if(It)return a(r,c);It=!0;try{var f=a(r);return f}finally{if(It=!1,(he!==null||Ne!==null)&&(Iu(),he&&(r=he,a=Ne,Ne=he=null,ct(r),a)))for(r=0;r<a.length;r++)ct(a[r])}}function tn(a,r){var c=a.stateNode;if(c===null)return null;var f=c[ge]||null;if(f===null)return null;c=f[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(a=a.type,f=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!f;break e;default:a=!1}if(a)return null;if(c&&typeof c!="function")throw Error(i(231,r,typeof c));return c}var rn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),en=!1;if(rn)try{var _n={};Object.defineProperty(_n,"passive",{get:function(){en=!0}}),window.addEventListener("test",_n,_n),window.removeEventListener("test",_n,_n)}catch{en=!1}var qn=null,oa=null,_a=null;function ga(){if(_a)return _a;var a,r=oa,c=r.length,f,b="value"in qn?qn.value:qn.textContent,w=b.length;for(a=0;a<c&&r[a]===b[a];a++);var q=c-a;for(f=1;f<=q&&r[c-f]===b[w-f];f++);return _a=b.slice(a,1<f?1-f:void 0)}function As(a){var r=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&r===13&&(a=13)):a=r,a===10&&(a=13),32<=a||a===13?a:0}function $a(){return!0}function li(){return!1}function Xt(a){function r(c,f,b,w,q){this._reactName=c,this._targetInst=b,this.type=f,this.nativeEvent=w,this.target=q,this.currentTarget=null;for(var te in a)a.hasOwnProperty(te)&&(c=a[te],this[te]=c?c(w):w[te]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?$a:li,this.isPropagationStopped=li,this}return g(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=$a)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=$a)},persist:function(){},isPersistent:$a}),r}var Ca={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Wc=Xt(Ca),so=g({},Ca,{view:0,detail:0}),A_=Xt(so),Gf,Kf,ro,Zc=g({},so,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Wf,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==ro&&(ro&&a.type==="mousemove"?(Gf=a.screenX-ro.screenX,Kf=a.screenY-ro.screenY):Kf=Gf=0,ro=a),Gf)},movementY:function(a){return"movementY"in a?a.movementY:Kf}}),sb=Xt(Zc),T_=g({},Zc,{dataTransfer:0}),M_=Xt(T_),k_=g({},so,{relatedTarget:0}),Xf=Xt(k_),R_=g({},Ca,{animationName:0,elapsedTime:0,pseudoElement:0}),I_=Xt(R_),D_=g({},Ca,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),L_=Xt(D_),O_=g({},Ca,{data:0}),rb=Xt(O_),$_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},F_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},z_={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function B_(a){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(a):(a=z_[a])?!!r[a]:!1}function Wf(){return B_}var U_=g({},so,{key:function(a){if(a.key){var r=$_[a.key]||a.key;if(r!=="Unidentified")return r}return a.type==="keypress"?(a=As(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?F_[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Wf,charCode:function(a){return a.type==="keypress"?As(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?As(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),q_=Xt(U_),P_=g({},Zc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ib=Xt(P_),H_=g({},so,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Wf}),V_=Xt(H_),Y_=g({},Ca,{propertyName:0,elapsedTime:0,pseudoElement:0}),G_=Xt(Y_),K_=g({},Zc,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),X_=Xt(K_),W_=g({},Ca,{newState:0,oldState:0}),Z_=Xt(W_),Q_=[9,13,27,32],Zf=rn&&"CompositionEvent"in window,io=null;rn&&"documentMode"in document&&(io=document.documentMode);var J_=rn&&"TextEvent"in window&&!io,lb=rn&&(!Zf||io&&8<io&&11>=io),ob=" ",cb=!1;function ub(a,r){switch(a){case"keyup":return Q_.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function db(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Xi=!1;function eC(a,r){switch(a){case"compositionend":return db(r);case"keypress":return r.which!==32?null:(cb=!0,ob);case"textInput":return a=r.data,a===ob&&cb?null:a;default:return null}}function tC(a,r){if(Xi)return a==="compositionend"||!Zf&&ub(a,r)?(a=ga(),_a=oa=qn=null,Xi=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return lb&&r.locale!=="ko"?null:r.data;default:return null}}var nC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fb(a){var r=a&&a.nodeName&&a.nodeName.toLowerCase();return r==="input"?!!nC[a.type]:r==="textarea"}function mb(a,r,c,f){he?Ne?Ne.push(f):Ne=[f]:he=f,r=Bu(r,"onChange"),0<r.length&&(c=new Wc("onChange","change",null,c,f),a.push({event:c,listeners:r}))}var lo=null,oo=null;function aC(a){Xv(a,0)}function Qc(a){var r=lt(a);if(ja(r))return a}function hb(a,r){if(a==="change")return r}var pb=!1;if(rn){var Qf;if(rn){var Jf="oninput"in document;if(!Jf){var yb=document.createElement("div");yb.setAttribute("oninput","return;"),Jf=typeof yb.oninput=="function"}Qf=Jf}else Qf=!1;pb=Qf&&(!document.documentMode||9<document.documentMode)}function gb(){lo&&(lo.detachEvent("onpropertychange",bb),oo=lo=null)}function bb(a){if(a.propertyName==="value"&&Qc(oo)){var r=[];mb(r,oo,a,Zt(a)),Ht(aC,r)}}function sC(a,r,c){a==="focusin"?(gb(),lo=r,oo=c,lo.attachEvent("onpropertychange",bb)):a==="focusout"&&gb()}function rC(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Qc(oo)}function iC(a,r){if(a==="click")return Qc(r)}function lC(a,r){if(a==="input"||a==="change")return Qc(r)}function oC(a,r){return a===r&&(a!==0||1/a===1/r)||a!==a&&r!==r}var Fa=typeof Object.is=="function"?Object.is:oC;function co(a,r){if(Fa(a,r))return!0;if(typeof a!="object"||a===null||typeof r!="object"||r===null)return!1;var c=Object.keys(a),f=Object.keys(r);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var b=c[f];if(!ut.call(r,b)||!Fa(a[b],r[b]))return!1}return!0}function xb(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function vb(a,r){var c=xb(a);a=0;for(var f;c;){if(c.nodeType===3){if(f=a+c.textContent.length,a<=r&&f>=r)return{node:c,offset:r-a};a=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=xb(c)}}function Sb(a,r){return a&&r?a===r?!0:a&&a.nodeType===3?!1:r&&r.nodeType===3?Sb(a,r.parentNode):"contains"in a?a.contains(r):a.compareDocumentPosition?!!(a.compareDocumentPosition(r)&16):!1:!1}function wb(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var r=ha(a.document);r instanceof a.HTMLIFrameElement;){try{var c=typeof r.contentWindow.location.href=="string"}catch{c=!1}if(c)a=r.contentWindow;else break;r=ha(a.document)}return r}function em(a){var r=a&&a.nodeName&&a.nodeName.toLowerCase();return r&&(r==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||r==="textarea"||a.contentEditable==="true")}var cC=rn&&"documentMode"in document&&11>=document.documentMode,Wi=null,tm=null,uo=null,nm=!1;function Nb(a,r,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;nm||Wi==null||Wi!==ha(f)||(f=Wi,"selectionStart"in f&&em(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),uo&&co(uo,f)||(uo=f,f=Bu(tm,"onSelect"),0<f.length&&(r=new Wc("onSelect","select",null,r,c),a.push({event:r,listeners:f}),r.target=Wi)))}function oi(a,r){var c={};return c[a.toLowerCase()]=r.toLowerCase(),c["Webkit"+a]="webkit"+r,c["Moz"+a]="moz"+r,c}var Zi={animationend:oi("Animation","AnimationEnd"),animationiteration:oi("Animation","AnimationIteration"),animationstart:oi("Animation","AnimationStart"),transitionrun:oi("Transition","TransitionRun"),transitionstart:oi("Transition","TransitionStart"),transitioncancel:oi("Transition","TransitionCancel"),transitionend:oi("Transition","TransitionEnd")},am={},jb={};rn&&(jb=document.createElement("div").style,"AnimationEvent"in window||(delete Zi.animationend.animation,delete Zi.animationiteration.animation,delete Zi.animationstart.animation),"TransitionEvent"in window||delete Zi.transitionend.transition);function ci(a){if(am[a])return am[a];if(!Zi[a])return a;var r=Zi[a],c;for(c in r)if(r.hasOwnProperty(c)&&c in jb)return am[a]=r[c];return a}var Eb=ci("animationend"),_b=ci("animationiteration"),Cb=ci("animationstart"),uC=ci("transitionrun"),dC=ci("transitionstart"),fC=ci("transitioncancel"),Ab=ci("transitionend"),Tb=new Map,sm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");sm.push("scrollEnd");function ys(a,r){Tb.set(a,r),ee(r,[a])}var Jc=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},Za=[],Qi=0,rm=0;function eu(){for(var a=Qi,r=rm=Qi=0;r<a;){var c=Za[r];Za[r++]=null;var f=Za[r];Za[r++]=null;var b=Za[r];Za[r++]=null;var w=Za[r];if(Za[r++]=null,f!==null&&b!==null){var q=f.pending;q===null?b.next=b:(b.next=q.next,q.next=b),f.pending=b}w!==0&&Mb(c,b,w)}}function tu(a,r,c,f){Za[Qi++]=a,Za[Qi++]=r,Za[Qi++]=c,Za[Qi++]=f,rm|=f,a.lanes|=f,a=a.alternate,a!==null&&(a.lanes|=f)}function im(a,r,c,f){return tu(a,r,c,f),nu(a)}function ui(a,r){return tu(a,null,null,r),nu(a)}function Mb(a,r,c){a.lanes|=c;var f=a.alternate;f!==null&&(f.lanes|=c);for(var b=!1,w=a.return;w!==null;)w.childLanes|=c,f=w.alternate,f!==null&&(f.childLanes|=c),w.tag===22&&(a=w.stateNode,a===null||a._visibility&1||(b=!0)),a=w,w=w.return;return a.tag===3?(w=a.stateNode,b&&r!==null&&(b=31-Ce(c),a=w.hiddenUpdates,f=a[b],f===null?a[b]=[r]:f.push(r),r.lane=c|536870912),w):null}function nu(a){if(50<Io)throw Io=0,ph=null,Error(i(185));for(var r=a.return;r!==null;)a=r,r=a.return;return a.tag===3?a.stateNode:null}var Ji={};function mC(a,r,c,f){this.tag=a,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function za(a,r,c,f){return new mC(a,r,c,f)}function lm(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Gs(a,r){var c=a.alternate;return c===null?(c=za(a.tag,r,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=r,c.type=a.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=a.flags&65011712,c.childLanes=a.childLanes,c.lanes=a.lanes,c.child=a.child,c.memoizedProps=a.memoizedProps,c.memoizedState=a.memoizedState,c.updateQueue=a.updateQueue,r=a.dependencies,c.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},c.sibling=a.sibling,c.index=a.index,c.ref=a.ref,c.refCleanup=a.refCleanup,c}function kb(a,r){a.flags&=65011714;var c=a.alternate;return c===null?(a.childLanes=0,a.lanes=r,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,r=c.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),a}function au(a,r,c,f,b,w){var q=0;if(f=a,typeof a=="function")lm(a)&&(q=1);else if(typeof a=="string")q=bA(a,c,K.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case z:return a=za(31,c,r,b),a.elementType=z,a.lanes=w,a;case N:return di(c.children,b,w,r);case E:q=8,b|=24;break;case j:return a=za(12,c,r,b|2),a.elementType=j,a.lanes=w,a;case M:return a=za(13,c,r,b),a.elementType=M,a.lanes=w,a;case k:return a=za(19,c,r,b),a.elementType=k,a.lanes=w,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case T:q=10;break e;case A:q=9;break e;case _:q=11;break e;case C:q=14;break e;case D:q=16,f=null;break e}q=29,c=Error(i(130,a===null?"null":typeof a,"")),f=null}return r=za(q,c,r,b),r.elementType=a,r.type=f,r.lanes=w,r}function di(a,r,c,f){return a=za(7,a,f,r),a.lanes=c,a}function om(a,r,c){return a=za(6,a,null,r),a.lanes=c,a}function Rb(a){var r=za(18,null,null,0);return r.stateNode=a,r}function cm(a,r,c){return r=za(4,a.children!==null?a.children:[],a.key,r),r.lanes=c,r.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},r}var Ib=new WeakMap;function Qa(a,r){if(typeof a=="object"&&a!==null){var c=Ib.get(a);return c!==void 0?c:(r={value:a,source:r,stack:Me(r)},Ib.set(a,r),r)}return{value:a,source:r,stack:Me(r)}}var el=[],tl=0,su=null,fo=0,Ja=[],es=0,vr=null,Ts=1,Ms="";function Ks(a,r){el[tl++]=fo,el[tl++]=su,su=a,fo=r}function Db(a,r,c){Ja[es++]=Ts,Ja[es++]=Ms,Ja[es++]=vr,vr=a;var f=Ts;a=Ms;var b=32-Ce(f)-1;f&=~(1<<b),c+=1;var w=32-Ce(r)+b;if(30<w){var q=b-b%5;w=(f&(1<<q)-1).toString(32),f>>=q,b-=q,Ts=1<<32-Ce(r)+b|c<<b|f,Ms=w+a}else Ts=1<<w|c<<b|f,Ms=a}function um(a){a.return!==null&&(Ks(a,1),Db(a,1,0))}function dm(a){for(;a===su;)su=el[--tl],el[tl]=null,fo=el[--tl],el[tl]=null;for(;a===vr;)vr=Ja[--es],Ja[es]=null,Ms=Ja[--es],Ja[es]=null,Ts=Ja[--es],Ja[es]=null}function Lb(a,r){Ja[es++]=Ts,Ja[es++]=Ms,Ja[es++]=vr,Ts=r.id,Ms=r.overflow,vr=a}var ca=null,On=null,Sn=!1,Sr=null,ts=!1,fm=Error(i(519));function wr(a){var r=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw mo(Qa(r,a)),fm}function Ob(a){var r=a.stateNode,c=a.type,f=a.memoizedProps;switch(r[_e]=a,r[ge]=f,c){case"dialog":bn("cancel",r),bn("close",r);break;case"iframe":case"object":case"embed":bn("load",r);break;case"video":case"audio":for(c=0;c<Lo.length;c++)bn(Lo[c],r);break;case"source":bn("error",r);break;case"img":case"image":case"link":bn("error",r),bn("load",r);break;case"details":bn("toggle",r);break;case"input":bn("invalid",r),xr(r,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":bn("invalid",r);break;case"textarea":bn("invalid",r),Ys(r,f.value,f.defaultValue,f.children)}c=f.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||r.textContent===""+c||f.suppressHydrationWarning===!0||Jv(r.textContent,c)?(f.popover!=null&&(bn("beforetoggle",r),bn("toggle",r)),f.onScroll!=null&&bn("scroll",r),f.onScrollEnd!=null&&bn("scrollend",r),f.onClick!=null&&(r.onclick=De),r=!0):r=!1,r||wr(a,!0)}function $b(a){for(ca=a.return;ca;)switch(ca.tag){case 5:case 31:case 13:ts=!1;return;case 27:case 3:ts=!0;return;default:ca=ca.return}}function nl(a){if(a!==ca)return!1;if(!Sn)return $b(a),Sn=!0,!1;var r=a.tag,c;if((c=r!==3&&r!==27)&&((c=r===5)&&(c=a.type,c=!(c!=="form"&&c!=="button")||Mh(a.type,a.memoizedProps)),c=!c),c&&On&&wr(a),$b(a),r===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(i(317));On=o0(a)}else if(r===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(i(317));On=o0(a)}else r===27?(r=On,Or(a.type)?(a=Lh,Lh=null,On=a):On=r):On=ca?as(a.stateNode.nextSibling):null;return!0}function fi(){On=ca=null,Sn=!1}function mm(){var a=Sr;return a!==null&&(ka===null?ka=a:ka.push.apply(ka,a),Sr=null),a}function mo(a){Sr===null?Sr=[a]:Sr.push(a)}var hm=I(null),mi=null,Xs=null;function Nr(a,r,c){P(hm,r._currentValue),r._currentValue=c}function Ws(a){a._currentValue=hm.current,Y(hm)}function pm(a,r,c){for(;a!==null;){var f=a.alternate;if((a.childLanes&r)!==r?(a.childLanes|=r,f!==null&&(f.childLanes|=r)):f!==null&&(f.childLanes&r)!==r&&(f.childLanes|=r),a===c)break;a=a.return}}function ym(a,r,c,f){var b=a.child;for(b!==null&&(b.return=a);b!==null;){var w=b.dependencies;if(w!==null){var q=b.child;w=w.firstContext;e:for(;w!==null;){var te=w;w=b;for(var je=0;je<r.length;je++)if(te.context===r[je]){w.lanes|=c,te=w.alternate,te!==null&&(te.lanes|=c),pm(w.return,c,a),f||(q=null);break e}w=te.next}}else if(b.tag===18){if(q=b.return,q===null)throw Error(i(341));q.lanes|=c,w=q.alternate,w!==null&&(w.lanes|=c),pm(q,c,a),q=null}else q=b.child;if(q!==null)q.return=b;else for(q=b;q!==null;){if(q===a){q=null;break}if(b=q.sibling,b!==null){b.return=q.return,q=b;break}q=q.return}b=q}}function al(a,r,c,f){a=null;for(var b=r,w=!1;b!==null;){if(!w){if((b.flags&524288)!==0)w=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var q=b.alternate;if(q===null)throw Error(i(387));if(q=q.memoizedProps,q!==null){var te=b.type;Fa(b.pendingProps.value,q.value)||(a!==null?a.push(te):a=[te])}}else if(b===ue.current){if(q=b.alternate,q===null)throw Error(i(387));q.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(a!==null?a.push(Bo):a=[Bo])}b=b.return}a!==null&&ym(r,a,c,f),r.flags|=262144}function ru(a){for(a=a.firstContext;a!==null;){if(!Fa(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function hi(a){mi=a,Xs=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function ua(a){return Fb(mi,a)}function iu(a,r){return mi===null&&hi(a),Fb(a,r)}function Fb(a,r){var c=r._currentValue;if(r={context:r,memoizedValue:c,next:null},Xs===null){if(a===null)throw Error(i(308));Xs=r,a.dependencies={lanes:0,firstContext:r},a.flags|=524288}else Xs=Xs.next=r;return c}var hC=typeof AbortController<"u"?AbortController:function(){var a=[],r=this.signal={aborted:!1,addEventListener:function(c,f){a.push(f)}};this.abort=function(){r.aborted=!0,a.forEach(function(c){return c()})}},pC=e.unstable_scheduleCallback,yC=e.unstable_NormalPriority,Xn={$$typeof:T,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function gm(){return{controller:new hC,data:new Map,refCount:0}}function ho(a){a.refCount--,a.refCount===0&&pC(yC,function(){a.controller.abort()})}var po=null,bm=0,sl=0,rl=null;function gC(a,r){if(po===null){var c=po=[];bm=0,sl=Sh(),rl={status:"pending",value:void 0,then:function(f){c.push(f)}}}return bm++,r.then(zb,zb),r}function zb(){if(--bm===0&&po!==null){rl!==null&&(rl.status="fulfilled");var a=po;po=null,sl=0,rl=null;for(var r=0;r<a.length;r++)(0,a[r])()}}function bC(a,r){var c=[],f={status:"pending",value:null,reason:null,then:function(b){c.push(b)}};return a.then(function(){f.status="fulfilled",f.value=r;for(var b=0;b<c.length;b++)(0,c[b])(r)},function(b){for(f.status="rejected",f.reason=b,b=0;b<c.length;b++)(0,c[b])(void 0)}),f}var Bb=L.S;L.S=function(a,r){Nv=tt(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&gC(a,r),Bb!==null&&Bb(a,r)};var pi=I(null);function xm(){var a=pi.current;return a!==null?a:Dn.pooledCache}function lu(a,r){r===null?P(pi,pi.current):P(pi,r.pool)}function Ub(){var a=xm();return a===null?null:{parent:Xn._currentValue,pool:a}}var il=Error(i(460)),vm=Error(i(474)),ou=Error(i(542)),cu={then:function(){}};function qb(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Pb(a,r,c){switch(c=a[c],c===void 0?a.push(r):c!==r&&(r.then(De,De),r=c),r.status){case"fulfilled":return r.value;case"rejected":throw a=r.reason,Vb(a),a;default:if(typeof r.status=="string")r.then(De,De);else{if(a=Dn,a!==null&&100<a.shellSuspendCounter)throw Error(i(482));a=r,a.status="pending",a.then(function(f){if(r.status==="pending"){var b=r;b.status="fulfilled",b.value=f}},function(f){if(r.status==="pending"){var b=r;b.status="rejected",b.reason=f}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw a=r.reason,Vb(a),a}throw gi=r,il}}function yi(a){try{var r=a._init;return r(a._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(gi=c,il):c}}var gi=null;function Hb(){if(gi===null)throw Error(i(459));var a=gi;return gi=null,a}function Vb(a){if(a===il||a===ou)throw Error(i(483))}var ll=null,yo=0;function uu(a){var r=yo;return yo+=1,ll===null&&(ll=[]),Pb(ll,a,r)}function go(a,r){r=r.props.ref,a.ref=r!==void 0?r:null}function du(a,r){throw r.$$typeof===x?Error(i(525)):(a=Object.prototype.toString.call(r),Error(i(31,a==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":a)))}function Yb(a){function r(Fe,Re){if(a){var Ge=Fe.deletions;Ge===null?(Fe.deletions=[Re],Fe.flags|=16):Ge.push(Re)}}function c(Fe,Re){if(!a)return null;for(;Re!==null;)r(Fe,Re),Re=Re.sibling;return null}function f(Fe){for(var Re=new Map;Fe!==null;)Fe.key!==null?Re.set(Fe.key,Fe):Re.set(Fe.index,Fe),Fe=Fe.sibling;return Re}function b(Fe,Re){return Fe=Gs(Fe,Re),Fe.index=0,Fe.sibling=null,Fe}function w(Fe,Re,Ge){return Fe.index=Ge,a?(Ge=Fe.alternate,Ge!==null?(Ge=Ge.index,Ge<Re?(Fe.flags|=67108866,Re):Ge):(Fe.flags|=67108866,Re)):(Fe.flags|=1048576,Re)}function q(Fe){return a&&Fe.alternate===null&&(Fe.flags|=67108866),Fe}function te(Fe,Re,Ge,yt){return Re===null||Re.tag!==6?(Re=om(Ge,Fe.mode,yt),Re.return=Fe,Re):(Re=b(Re,Ge),Re.return=Fe,Re)}function je(Fe,Re,Ge,yt){var Wt=Ge.type;return Wt===N?ft(Fe,Re,Ge.props.children,yt,Ge.key):Re!==null&&(Re.elementType===Wt||typeof Wt=="object"&&Wt!==null&&Wt.$$typeof===D&&yi(Wt)===Re.type)?(Re=b(Re,Ge.props),go(Re,Ge),Re.return=Fe,Re):(Re=au(Ge.type,Ge.key,Ge.props,null,Fe.mode,yt),go(Re,Ge),Re.return=Fe,Re)}function Xe(Fe,Re,Ge,yt){return Re===null||Re.tag!==4||Re.stateNode.containerInfo!==Ge.containerInfo||Re.stateNode.implementation!==Ge.implementation?(Re=cm(Ge,Fe.mode,yt),Re.return=Fe,Re):(Re=b(Re,Ge.children||[]),Re.return=Fe,Re)}function ft(Fe,Re,Ge,yt,Wt){return Re===null||Re.tag!==7?(Re=di(Ge,Fe.mode,yt,Wt),Re.return=Fe,Re):(Re=b(Re,Ge),Re.return=Fe,Re)}function gt(Fe,Re,Ge){if(typeof Re=="string"&&Re!==""||typeof Re=="number"||typeof Re=="bigint")return Re=om(""+Re,Fe.mode,Ge),Re.return=Fe,Re;if(typeof Re=="object"&&Re!==null){switch(Re.$$typeof){case v:return Ge=au(Re.type,Re.key,Re.props,null,Fe.mode,Ge),go(Ge,Re),Ge.return=Fe,Ge;case S:return Re=cm(Re,Fe.mode,Ge),Re.return=Fe,Re;case D:return Re=yi(Re),gt(Fe,Re,Ge)}if(B(Re)||X(Re))return Re=di(Re,Fe.mode,Ge,null),Re.return=Fe,Re;if(typeof Re.then=="function")return gt(Fe,uu(Re),Ge);if(Re.$$typeof===T)return gt(Fe,iu(Fe,Re),Ge);du(Fe,Re)}return null}function Qe(Fe,Re,Ge,yt){var Wt=Re!==null?Re.key:null;if(typeof Ge=="string"&&Ge!==""||typeof Ge=="number"||typeof Ge=="bigint")return Wt!==null?null:te(Fe,Re,""+Ge,yt);if(typeof Ge=="object"&&Ge!==null){switch(Ge.$$typeof){case v:return Ge.key===Wt?je(Fe,Re,Ge,yt):null;case S:return Ge.key===Wt?Xe(Fe,Re,Ge,yt):null;case D:return Ge=yi(Ge),Qe(Fe,Re,Ge,yt)}if(B(Ge)||X(Ge))return Wt!==null?null:ft(Fe,Re,Ge,yt,null);if(typeof Ge.then=="function")return Qe(Fe,Re,uu(Ge),yt);if(Ge.$$typeof===T)return Qe(Fe,Re,iu(Fe,Ge),yt);du(Fe,Ge)}return null}function rt(Fe,Re,Ge,yt,Wt){if(typeof yt=="string"&&yt!==""||typeof yt=="number"||typeof yt=="bigint")return Fe=Fe.get(Ge)||null,te(Re,Fe,""+yt,Wt);if(typeof yt=="object"&&yt!==null){switch(yt.$$typeof){case v:return Fe=Fe.get(yt.key===null?Ge:yt.key)||null,je(Re,Fe,yt,Wt);case S:return Fe=Fe.get(yt.key===null?Ge:yt.key)||null,Xe(Re,Fe,yt,Wt);case D:return yt=yi(yt),rt(Fe,Re,Ge,yt,Wt)}if(B(yt)||X(yt))return Fe=Fe.get(Ge)||null,ft(Re,Fe,yt,Wt,null);if(typeof yt.then=="function")return rt(Fe,Re,Ge,uu(yt),Wt);if(yt.$$typeof===T)return rt(Fe,Re,Ge,iu(Re,yt),Wt);du(Re,yt)}return null}function Ut(Fe,Re,Ge,yt){for(var Wt=null,wn=null,Vt=Re,on=Re=0,vn=null;Vt!==null&&on<Ge.length;on++){Vt.index>on?(vn=Vt,Vt=null):vn=Vt.sibling;var Nn=Qe(Fe,Vt,Ge[on],yt);if(Nn===null){Vt===null&&(Vt=vn);break}a&&Vt&&Nn.alternate===null&&r(Fe,Vt),Re=w(Nn,Re,on),wn===null?Wt=Nn:wn.sibling=Nn,wn=Nn,Vt=vn}if(on===Ge.length)return c(Fe,Vt),Sn&&Ks(Fe,on),Wt;if(Vt===null){for(;on<Ge.length;on++)Vt=gt(Fe,Ge[on],yt),Vt!==null&&(Re=w(Vt,Re,on),wn===null?Wt=Vt:wn.sibling=Vt,wn=Vt);return Sn&&Ks(Fe,on),Wt}for(Vt=f(Vt);on<Ge.length;on++)vn=rt(Vt,Fe,on,Ge[on],yt),vn!==null&&(a&&vn.alternate!==null&&Vt.delete(vn.key===null?on:vn.key),Re=w(vn,Re,on),wn===null?Wt=vn:wn.sibling=vn,wn=vn);return a&&Vt.forEach(function(Ur){return r(Fe,Ur)}),Sn&&Ks(Fe,on),Wt}function Jt(Fe,Re,Ge,yt){if(Ge==null)throw Error(i(151));for(var Wt=null,wn=null,Vt=Re,on=Re=0,vn=null,Nn=Ge.next();Vt!==null&&!Nn.done;on++,Nn=Ge.next()){Vt.index>on?(vn=Vt,Vt=null):vn=Vt.sibling;var Ur=Qe(Fe,Vt,Nn.value,yt);if(Ur===null){Vt===null&&(Vt=vn);break}a&&Vt&&Ur.alternate===null&&r(Fe,Vt),Re=w(Ur,Re,on),wn===null?Wt=Ur:wn.sibling=Ur,wn=Ur,Vt=vn}if(Nn.done)return c(Fe,Vt),Sn&&Ks(Fe,on),Wt;if(Vt===null){for(;!Nn.done;on++,Nn=Ge.next())Nn=gt(Fe,Nn.value,yt),Nn!==null&&(Re=w(Nn,Re,on),wn===null?Wt=Nn:wn.sibling=Nn,wn=Nn);return Sn&&Ks(Fe,on),Wt}for(Vt=f(Vt);!Nn.done;on++,Nn=Ge.next())Nn=rt(Vt,Fe,on,Nn.value,yt),Nn!==null&&(a&&Nn.alternate!==null&&Vt.delete(Nn.key===null?on:Nn.key),Re=w(Nn,Re,on),wn===null?Wt=Nn:wn.sibling=Nn,wn=Nn);return a&&Vt.forEach(function(TA){return r(Fe,TA)}),Sn&&Ks(Fe,on),Wt}function In(Fe,Re,Ge,yt){if(typeof Ge=="object"&&Ge!==null&&Ge.type===N&&Ge.key===null&&(Ge=Ge.props.children),typeof Ge=="object"&&Ge!==null){switch(Ge.$$typeof){case v:e:{for(var Wt=Ge.key;Re!==null;){if(Re.key===Wt){if(Wt=Ge.type,Wt===N){if(Re.tag===7){c(Fe,Re.sibling),yt=b(Re,Ge.props.children),yt.return=Fe,Fe=yt;break e}}else if(Re.elementType===Wt||typeof Wt=="object"&&Wt!==null&&Wt.$$typeof===D&&yi(Wt)===Re.type){c(Fe,Re.sibling),yt=b(Re,Ge.props),go(yt,Ge),yt.return=Fe,Fe=yt;break e}c(Fe,Re);break}else r(Fe,Re);Re=Re.sibling}Ge.type===N?(yt=di(Ge.props.children,Fe.mode,yt,Ge.key),yt.return=Fe,Fe=yt):(yt=au(Ge.type,Ge.key,Ge.props,null,Fe.mode,yt),go(yt,Ge),yt.return=Fe,Fe=yt)}return q(Fe);case S:e:{for(Wt=Ge.key;Re!==null;){if(Re.key===Wt)if(Re.tag===4&&Re.stateNode.containerInfo===Ge.containerInfo&&Re.stateNode.implementation===Ge.implementation){c(Fe,Re.sibling),yt=b(Re,Ge.children||[]),yt.return=Fe,Fe=yt;break e}else{c(Fe,Re);break}else r(Fe,Re);Re=Re.sibling}yt=cm(Ge,Fe.mode,yt),yt.return=Fe,Fe=yt}return q(Fe);case D:return Ge=yi(Ge),In(Fe,Re,Ge,yt)}if(B(Ge))return Ut(Fe,Re,Ge,yt);if(X(Ge)){if(Wt=X(Ge),typeof Wt!="function")throw Error(i(150));return Ge=Wt.call(Ge),Jt(Fe,Re,Ge,yt)}if(typeof Ge.then=="function")return In(Fe,Re,uu(Ge),yt);if(Ge.$$typeof===T)return In(Fe,Re,iu(Fe,Ge),yt);du(Fe,Ge)}return typeof Ge=="string"&&Ge!==""||typeof Ge=="number"||typeof Ge=="bigint"?(Ge=""+Ge,Re!==null&&Re.tag===6?(c(Fe,Re.sibling),yt=b(Re,Ge),yt.return=Fe,Fe=yt):(c(Fe,Re),yt=om(Ge,Fe.mode,yt),yt.return=Fe,Fe=yt),q(Fe)):c(Fe,Re)}return function(Fe,Re,Ge,yt){try{yo=0;var Wt=In(Fe,Re,Ge,yt);return ll=null,Wt}catch(Vt){if(Vt===il||Vt===ou)throw Vt;var wn=za(29,Vt,null,Fe.mode);return wn.lanes=yt,wn.return=Fe,wn}finally{}}}var bi=Yb(!0),Gb=Yb(!1),jr=!1;function Sm(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function wm(a,r){a=a.updateQueue,r.updateQueue===a&&(r.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Er(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function _r(a,r,c){var f=a.updateQueue;if(f===null)return null;if(f=f.shared,(En&2)!==0){var b=f.pending;return b===null?r.next=r:(r.next=b.next,b.next=r),f.pending=r,r=nu(a),Mb(a,null,c),r}return tu(a,f,r,c),nu(a)}function bo(a,r,c){if(r=r.updateQueue,r!==null&&(r=r.shared,(c&4194048)!==0)){var f=r.lanes;f&=a.pendingLanes,c|=f,r.lanes=c,Ke(a,c)}}function Nm(a,r){var c=a.updateQueue,f=a.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var b=null,w=null;if(c=c.firstBaseUpdate,c!==null){do{var q={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};w===null?b=w=q:w=w.next=q,c=c.next}while(c!==null);w===null?b=w=r:w=w.next=r}else b=w=r;c={baseState:f.baseState,firstBaseUpdate:b,lastBaseUpdate:w,shared:f.shared,callbacks:f.callbacks},a.updateQueue=c;return}a=c.lastBaseUpdate,a===null?c.firstBaseUpdate=r:a.next=r,c.lastBaseUpdate=r}var jm=!1;function xo(){if(jm){var a=rl;if(a!==null)throw a}}function vo(a,r,c,f){jm=!1;var b=a.updateQueue;jr=!1;var w=b.firstBaseUpdate,q=b.lastBaseUpdate,te=b.shared.pending;if(te!==null){b.shared.pending=null;var je=te,Xe=je.next;je.next=null,q===null?w=Xe:q.next=Xe,q=je;var ft=a.alternate;ft!==null&&(ft=ft.updateQueue,te=ft.lastBaseUpdate,te!==q&&(te===null?ft.firstBaseUpdate=Xe:te.next=Xe,ft.lastBaseUpdate=je))}if(w!==null){var gt=b.baseState;q=0,ft=Xe=je=null,te=w;do{var Qe=te.lane&-536870913,rt=Qe!==te.lane;if(rt?(xn&Qe)===Qe:(f&Qe)===Qe){Qe!==0&&Qe===sl&&(jm=!0),ft!==null&&(ft=ft.next={lane:0,tag:te.tag,payload:te.payload,callback:null,next:null});e:{var Ut=a,Jt=te;Qe=r;var In=c;switch(Jt.tag){case 1:if(Ut=Jt.payload,typeof Ut=="function"){gt=Ut.call(In,gt,Qe);break e}gt=Ut;break e;case 3:Ut.flags=Ut.flags&-65537|128;case 0:if(Ut=Jt.payload,Qe=typeof Ut=="function"?Ut.call(In,gt,Qe):Ut,Qe==null)break e;gt=g({},gt,Qe);break e;case 2:jr=!0}}Qe=te.callback,Qe!==null&&(a.flags|=64,rt&&(a.flags|=8192),rt=b.callbacks,rt===null?b.callbacks=[Qe]:rt.push(Qe))}else rt={lane:Qe,tag:te.tag,payload:te.payload,callback:te.callback,next:null},ft===null?(Xe=ft=rt,je=gt):ft=ft.next=rt,q|=Qe;if(te=te.next,te===null){if(te=b.shared.pending,te===null)break;rt=te,te=rt.next,rt.next=null,b.lastBaseUpdate=rt,b.shared.pending=null}}while(!0);ft===null&&(je=gt),b.baseState=je,b.firstBaseUpdate=Xe,b.lastBaseUpdate=ft,w===null&&(b.shared.lanes=0),kr|=q,a.lanes=q,a.memoizedState=gt}}function Kb(a,r){if(typeof a!="function")throw Error(i(191,a));a.call(r)}function Xb(a,r){var c=a.callbacks;if(c!==null)for(a.callbacks=null,a=0;a<c.length;a++)Kb(c[a],r)}var ol=I(null),fu=I(0);function Wb(a,r){a=rr,P(fu,a),P(ol,r),rr=a|r.baseLanes}function Em(){P(fu,rr),P(ol,ol.current)}function _m(){rr=fu.current,Y(ol),Y(fu)}var Ba=I(null),ns=null;function Cr(a){var r=a.alternate;P(Gn,Gn.current&1),P(Ba,a),ns===null&&(r===null||ol.current!==null||r.memoizedState!==null)&&(ns=a)}function Cm(a){P(Gn,Gn.current),P(Ba,a),ns===null&&(ns=a)}function Zb(a){a.tag===22?(P(Gn,Gn.current),P(Ba,a),ns===null&&(ns=a)):Ar()}function Ar(){P(Gn,Gn.current),P(Ba,Ba.current)}function Ua(a){Y(Ba),ns===a&&(ns=null),Y(Gn)}var Gn=I(0);function mu(a){for(var r=a;r!==null;){if(r.tag===13){var c=r.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Ih(c)||Dh(c)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break;for(;r.sibling===null;){if(r.return===null||r.return===a)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Zs=0,ln=null,kn=null,Wn=null,hu=!1,cl=!1,xi=!1,pu=0,So=0,ul=null,xC=0;function Pn(){throw Error(i(321))}function Am(a,r){if(r===null)return!1;for(var c=0;c<r.length&&c<a.length;c++)if(!Fa(a[c],r[c]))return!1;return!0}function Tm(a,r,c,f,b,w){return Zs=w,ln=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,L.H=a===null||a.memoizedState===null?Dx:Hm,xi=!1,w=c(f,b),xi=!1,cl&&(w=Jb(r,c,f,b)),Qb(a),w}function Qb(a){L.H=jo;var r=kn!==null&&kn.next!==null;if(Zs=0,Wn=kn=ln=null,hu=!1,So=0,ul=null,r)throw Error(i(300));a===null||Zn||(a=a.dependencies,a!==null&&ru(a)&&(Zn=!0))}function Jb(a,r,c,f){ln=a;var b=0;do{if(cl&&(ul=null),So=0,cl=!1,25<=b)throw Error(i(301));if(b+=1,Wn=kn=null,a.updateQueue!=null){var w=a.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}L.H=Lx,w=r(c,f)}while(cl);return w}function vC(){var a=L.H,r=a.useState()[0];return r=typeof r.then=="function"?wo(r):r,a=a.useState()[0],(kn!==null?kn.memoizedState:null)!==a&&(ln.flags|=1024),r}function Mm(){var a=pu!==0;return pu=0,a}function km(a,r,c){r.updateQueue=a.updateQueue,r.flags&=-2053,a.lanes&=~c}function Rm(a){if(hu){for(a=a.memoizedState;a!==null;){var r=a.queue;r!==null&&(r.pending=null),a=a.next}hu=!1}Zs=0,Wn=kn=ln=null,cl=!1,So=pu=0,ul=null}function ba(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Wn===null?ln.memoizedState=Wn=a:Wn=Wn.next=a,Wn}function Kn(){if(kn===null){var a=ln.alternate;a=a!==null?a.memoizedState:null}else a=kn.next;var r=Wn===null?ln.memoizedState:Wn.next;if(r!==null)Wn=r,kn=a;else{if(a===null)throw ln.alternate===null?Error(i(467)):Error(i(310));kn=a,a={memoizedState:kn.memoizedState,baseState:kn.baseState,baseQueue:kn.baseQueue,queue:kn.queue,next:null},Wn===null?ln.memoizedState=Wn=a:Wn=Wn.next=a}return Wn}function yu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function wo(a){var r=So;return So+=1,ul===null&&(ul=[]),a=Pb(ul,a,r),r=ln,(Wn===null?r.memoizedState:Wn.next)===null&&(r=r.alternate,L.H=r===null||r.memoizedState===null?Dx:Hm),a}function gu(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return wo(a);if(a.$$typeof===T)return ua(a)}throw Error(i(438,String(a)))}function Im(a){var r=null,c=ln.updateQueue;if(c!==null&&(r=c.memoCache),r==null){var f=ln.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(r={data:f.data.map(function(b){return b.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),c===null&&(c=yu(),ln.updateQueue=c),c.memoCache=r,c=r.data[r.index],c===void 0)for(c=r.data[r.index]=Array(a),f=0;f<a;f++)c[f]=G;return r.index++,c}function Qs(a,r){return typeof r=="function"?r(a):r}function bu(a){var r=Kn();return Dm(r,kn,a)}function Dm(a,r,c){var f=a.queue;if(f===null)throw Error(i(311));f.lastRenderedReducer=c;var b=a.baseQueue,w=f.pending;if(w!==null){if(b!==null){var q=b.next;b.next=w.next,w.next=q}r.baseQueue=b=w,f.pending=null}if(w=a.baseState,b===null)a.memoizedState=w;else{r=b.next;var te=q=null,je=null,Xe=r,ft=!1;do{var gt=Xe.lane&-536870913;if(gt!==Xe.lane?(xn&gt)===gt:(Zs&gt)===gt){var Qe=Xe.revertLane;if(Qe===0)je!==null&&(je=je.next={lane:0,revertLane:0,gesture:null,action:Xe.action,hasEagerState:Xe.hasEagerState,eagerState:Xe.eagerState,next:null}),gt===sl&&(ft=!0);else if((Zs&Qe)===Qe){Xe=Xe.next,Qe===sl&&(ft=!0);continue}else gt={lane:0,revertLane:Xe.revertLane,gesture:null,action:Xe.action,hasEagerState:Xe.hasEagerState,eagerState:Xe.eagerState,next:null},je===null?(te=je=gt,q=w):je=je.next=gt,ln.lanes|=Qe,kr|=Qe;gt=Xe.action,xi&&c(w,gt),w=Xe.hasEagerState?Xe.eagerState:c(w,gt)}else Qe={lane:gt,revertLane:Xe.revertLane,gesture:Xe.gesture,action:Xe.action,hasEagerState:Xe.hasEagerState,eagerState:Xe.eagerState,next:null},je===null?(te=je=Qe,q=w):je=je.next=Qe,ln.lanes|=gt,kr|=gt;Xe=Xe.next}while(Xe!==null&&Xe!==r);if(je===null?q=w:je.next=te,!Fa(w,a.memoizedState)&&(Zn=!0,ft&&(c=rl,c!==null)))throw c;a.memoizedState=w,a.baseState=q,a.baseQueue=je,f.lastRenderedState=w}return b===null&&(f.lanes=0),[a.memoizedState,f.dispatch]}function Lm(a){var r=Kn(),c=r.queue;if(c===null)throw Error(i(311));c.lastRenderedReducer=a;var f=c.dispatch,b=c.pending,w=r.memoizedState;if(b!==null){c.pending=null;var q=b=b.next;do w=a(w,q.action),q=q.next;while(q!==b);Fa(w,r.memoizedState)||(Zn=!0),r.memoizedState=w,r.baseQueue===null&&(r.baseState=w),c.lastRenderedState=w}return[w,f]}function ex(a,r,c){var f=ln,b=Kn(),w=Sn;if(w){if(c===void 0)throw Error(i(407));c=c()}else c=r();var q=!Fa((kn||b).memoizedState,c);if(q&&(b.memoizedState=c,Zn=!0),b=b.queue,Fm(ax.bind(null,f,b,a),[a]),b.getSnapshot!==r||q||Wn!==null&&Wn.memoizedState.tag&1){if(f.flags|=2048,dl(9,{destroy:void 0},nx.bind(null,f,b,c,r),null),Dn===null)throw Error(i(349));w||(Zs&127)!==0||tx(f,r,c)}return c}function tx(a,r,c){a.flags|=16384,a={getSnapshot:r,value:c},r=ln.updateQueue,r===null?(r=yu(),ln.updateQueue=r,r.stores=[a]):(c=r.stores,c===null?r.stores=[a]:c.push(a))}function nx(a,r,c,f){r.value=c,r.getSnapshot=f,sx(r)&&rx(a)}function ax(a,r,c){return c(function(){sx(r)&&rx(a)})}function sx(a){var r=a.getSnapshot;a=a.value;try{var c=r();return!Fa(a,c)}catch{return!0}}function rx(a){var r=ui(a,2);r!==null&&Ra(r,a,2)}function Om(a){var r=ba();if(typeof a=="function"){var c=a;if(a=c(),xi){ze(!0);try{c()}finally{ze(!1)}}}return r.memoizedState=r.baseState=a,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qs,lastRenderedState:a},r}function ix(a,r,c,f){return a.baseState=c,Dm(a,kn,typeof f=="function"?f:Qs)}function SC(a,r,c,f,b){if(Su(a))throw Error(i(485));if(a=r.action,a!==null){var w={payload:b,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(q){w.listeners.push(q)}};L.T!==null?c(!0):w.isTransition=!1,f(w),c=r.pending,c===null?(w.next=r.pending=w,lx(r,w)):(w.next=c.next,r.pending=c.next=w)}}function lx(a,r){var c=r.action,f=r.payload,b=a.state;if(r.isTransition){var w=L.T,q={};L.T=q;try{var te=c(b,f),je=L.S;je!==null&&je(q,te),ox(a,r,te)}catch(Xe){$m(a,r,Xe)}finally{w!==null&&q.types!==null&&(w.types=q.types),L.T=w}}else try{w=c(b,f),ox(a,r,w)}catch(Xe){$m(a,r,Xe)}}function ox(a,r,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(f){cx(a,r,f)},function(f){return $m(a,r,f)}):cx(a,r,c)}function cx(a,r,c){r.status="fulfilled",r.value=c,ux(r),a.state=c,r=a.pending,r!==null&&(c=r.next,c===r?a.pending=null:(c=c.next,r.next=c,lx(a,c)))}function $m(a,r,c){var f=a.pending;if(a.pending=null,f!==null){f=f.next;do r.status="rejected",r.reason=c,ux(r),r=r.next;while(r!==f)}a.action=null}function ux(a){a=a.listeners;for(var r=0;r<a.length;r++)(0,a[r])()}function dx(a,r){return r}function fx(a,r){if(Sn){var c=Dn.formState;if(c!==null){e:{var f=ln;if(Sn){if(On){t:{for(var b=On,w=ts;b.nodeType!==8;){if(!w){b=null;break t}if(b=as(b.nextSibling),b===null){b=null;break t}}w=b.data,b=w==="F!"||w==="F"?b:null}if(b){On=as(b.nextSibling),f=b.data==="F!";break e}}wr(f)}f=!1}f&&(r=c[0])}}return c=ba(),c.memoizedState=c.baseState=r,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:dx,lastRenderedState:r},c.queue=f,c=kx.bind(null,ln,f),f.dispatch=c,f=Om(!1),w=Pm.bind(null,ln,!1,f.queue),f=ba(),b={state:r,dispatch:null,action:a,pending:null},f.queue=b,c=SC.bind(null,ln,b,w,c),b.dispatch=c,f.memoizedState=a,[r,c,!1]}function mx(a){var r=Kn();return hx(r,kn,a)}function hx(a,r,c){if(r=Dm(a,r,dx)[0],a=bu(Qs)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var f=wo(r)}catch(q){throw q===il?ou:q}else f=r;r=Kn();var b=r.queue,w=b.dispatch;return c!==r.memoizedState&&(ln.flags|=2048,dl(9,{destroy:void 0},wC.bind(null,b,c),null)),[f,w,a]}function wC(a,r){a.action=r}function px(a){var r=Kn(),c=kn;if(c!==null)return hx(r,c,a);Kn(),r=r.memoizedState,c=Kn();var f=c.queue.dispatch;return c.memoizedState=a,[r,f,!1]}function dl(a,r,c,f){return a={tag:a,create:c,deps:f,inst:r,next:null},r=ln.updateQueue,r===null&&(r=yu(),ln.updateQueue=r),c=r.lastEffect,c===null?r.lastEffect=a.next=a:(f=c.next,c.next=a,a.next=f,r.lastEffect=a),a}function yx(){return Kn().memoizedState}function xu(a,r,c,f){var b=ba();ln.flags|=a,b.memoizedState=dl(1|r,{destroy:void 0},c,f===void 0?null:f)}function vu(a,r,c,f){var b=Kn();f=f===void 0?null:f;var w=b.memoizedState.inst;kn!==null&&f!==null&&Am(f,kn.memoizedState.deps)?b.memoizedState=dl(r,w,c,f):(ln.flags|=a,b.memoizedState=dl(1|r,w,c,f))}function gx(a,r){xu(8390656,8,a,r)}function Fm(a,r){vu(2048,8,a,r)}function NC(a){ln.flags|=4;var r=ln.updateQueue;if(r===null)r=yu(),ln.updateQueue=r,r.events=[a];else{var c=r.events;c===null?r.events=[a]:c.push(a)}}function bx(a){var r=Kn().memoizedState;return NC({ref:r,nextImpl:a}),function(){if((En&2)!==0)throw Error(i(440));return r.impl.apply(void 0,arguments)}}function xx(a,r){return vu(4,2,a,r)}function vx(a,r){return vu(4,4,a,r)}function Sx(a,r){if(typeof r=="function"){a=a();var c=r(a);return function(){typeof c=="function"?c():r(null)}}if(r!=null)return a=a(),r.current=a,function(){r.current=null}}function wx(a,r,c){c=c!=null?c.concat([a]):null,vu(4,4,Sx.bind(null,r,a),c)}function zm(){}function Nx(a,r){var c=Kn();r=r===void 0?null:r;var f=c.memoizedState;return r!==null&&Am(r,f[1])?f[0]:(c.memoizedState=[a,r],a)}function jx(a,r){var c=Kn();r=r===void 0?null:r;var f=c.memoizedState;if(r!==null&&Am(r,f[1]))return f[0];if(f=a(),xi){ze(!0);try{a()}finally{ze(!1)}}return c.memoizedState=[f,r],f}function Bm(a,r,c){return c===void 0||(Zs&1073741824)!==0&&(xn&261930)===0?a.memoizedState=r:(a.memoizedState=c,a=Ev(),ln.lanes|=a,kr|=a,c)}function Ex(a,r,c,f){return Fa(c,r)?c:ol.current!==null?(a=Bm(a,c,f),Fa(a,r)||(Zn=!0),a):(Zs&42)===0||(Zs&1073741824)!==0&&(xn&261930)===0?(Zn=!0,a.memoizedState=c):(a=Ev(),ln.lanes|=a,kr|=a,r)}function _x(a,r,c,f,b){var w=O.p;O.p=w!==0&&8>w?w:8;var q=L.T,te={};L.T=te,Pm(a,!1,r,c);try{var je=b(),Xe=L.S;if(Xe!==null&&Xe(te,je),je!==null&&typeof je=="object"&&typeof je.then=="function"){var ft=bC(je,f);No(a,r,ft,Ha(a))}else No(a,r,f,Ha(a))}catch(gt){No(a,r,{then:function(){},status:"rejected",reason:gt},Ha())}finally{O.p=w,q!==null&&te.types!==null&&(q.types=te.types),L.T=q}}function jC(){}function Um(a,r,c,f){if(a.tag!==5)throw Error(i(476));var b=Cx(a).queue;_x(a,b,r,$,c===null?jC:function(){return Ax(a),c(f)})}function Cx(a){var r=a.memoizedState;if(r!==null)return r;r={memoizedState:$,baseState:$,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qs,lastRenderedState:$},next:null};var c={};return r.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qs,lastRenderedState:c},next:null},a.memoizedState=r,a=a.alternate,a!==null&&(a.memoizedState=r),r}function Ax(a){var r=Cx(a);r.next===null&&(r=a.alternate.memoizedState),No(a,r.next.queue,{},Ha())}function qm(){return ua(Bo)}function Tx(){return Kn().memoizedState}function Mx(){return Kn().memoizedState}function EC(a){for(var r=a.return;r!==null;){switch(r.tag){case 24:case 3:var c=Ha();a=Er(c);var f=_r(r,a,c);f!==null&&(Ra(f,r,c),bo(f,r,c)),r={cache:gm()},a.payload=r;return}r=r.return}}function _C(a,r,c){var f=Ha();c={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Su(a)?Rx(r,c):(c=im(a,r,c,f),c!==null&&(Ra(c,a,f),Ix(c,r,f)))}function kx(a,r,c){var f=Ha();No(a,r,c,f)}function No(a,r,c,f){var b={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Su(a))Rx(r,b);else{var w=a.alternate;if(a.lanes===0&&(w===null||w.lanes===0)&&(w=r.lastRenderedReducer,w!==null))try{var q=r.lastRenderedState,te=w(q,c);if(b.hasEagerState=!0,b.eagerState=te,Fa(te,q))return tu(a,r,b,0),Dn===null&&eu(),!1}catch{}finally{}if(c=im(a,r,b,f),c!==null)return Ra(c,a,f),Ix(c,r,f),!0}return!1}function Pm(a,r,c,f){if(f={lane:2,revertLane:Sh(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},Su(a)){if(r)throw Error(i(479))}else r=im(a,c,f,2),r!==null&&Ra(r,a,2)}function Su(a){var r=a.alternate;return a===ln||r!==null&&r===ln}function Rx(a,r){cl=hu=!0;var c=a.pending;c===null?r.next=r:(r.next=c.next,c.next=r),a.pending=r}function Ix(a,r,c){if((c&4194048)!==0){var f=r.lanes;f&=a.pendingLanes,c|=f,r.lanes=c,Ke(a,c)}}var jo={readContext:ua,use:gu,useCallback:Pn,useContext:Pn,useEffect:Pn,useImperativeHandle:Pn,useLayoutEffect:Pn,useInsertionEffect:Pn,useMemo:Pn,useReducer:Pn,useRef:Pn,useState:Pn,useDebugValue:Pn,useDeferredValue:Pn,useTransition:Pn,useSyncExternalStore:Pn,useId:Pn,useHostTransitionStatus:Pn,useFormState:Pn,useActionState:Pn,useOptimistic:Pn,useMemoCache:Pn,useCacheRefresh:Pn};jo.useEffectEvent=Pn;var Dx={readContext:ua,use:gu,useCallback:function(a,r){return ba().memoizedState=[a,r===void 0?null:r],a},useContext:ua,useEffect:gx,useImperativeHandle:function(a,r,c){c=c!=null?c.concat([a]):null,xu(4194308,4,Sx.bind(null,r,a),c)},useLayoutEffect:function(a,r){return xu(4194308,4,a,r)},useInsertionEffect:function(a,r){xu(4,2,a,r)},useMemo:function(a,r){var c=ba();r=r===void 0?null:r;var f=a();if(xi){ze(!0);try{a()}finally{ze(!1)}}return c.memoizedState=[f,r],f},useReducer:function(a,r,c){var f=ba();if(c!==void 0){var b=c(r);if(xi){ze(!0);try{c(r)}finally{ze(!1)}}}else b=r;return f.memoizedState=f.baseState=b,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:b},f.queue=a,a=a.dispatch=_C.bind(null,ln,a),[f.memoizedState,a]},useRef:function(a){var r=ba();return a={current:a},r.memoizedState=a},useState:function(a){a=Om(a);var r=a.queue,c=kx.bind(null,ln,r);return r.dispatch=c,[a.memoizedState,c]},useDebugValue:zm,useDeferredValue:function(a,r){var c=ba();return Bm(c,a,r)},useTransition:function(){var a=Om(!1);return a=_x.bind(null,ln,a.queue,!0,!1),ba().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,r,c){var f=ln,b=ba();if(Sn){if(c===void 0)throw Error(i(407));c=c()}else{if(c=r(),Dn===null)throw Error(i(349));(xn&127)!==0||tx(f,r,c)}b.memoizedState=c;var w={value:c,getSnapshot:r};return b.queue=w,gx(ax.bind(null,f,w,a),[a]),f.flags|=2048,dl(9,{destroy:void 0},nx.bind(null,f,w,c,r),null),c},useId:function(){var a=ba(),r=Dn.identifierPrefix;if(Sn){var c=Ms,f=Ts;c=(f&~(1<<32-Ce(f)-1)).toString(32)+c,r="_"+r+"R_"+c,c=pu++,0<c&&(r+="H"+c.toString(32)),r+="_"}else c=xC++,r="_"+r+"r_"+c.toString(32)+"_";return a.memoizedState=r},useHostTransitionStatus:qm,useFormState:fx,useActionState:fx,useOptimistic:function(a){var r=ba();r.memoizedState=r.baseState=a;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=c,r=Pm.bind(null,ln,!0,c),c.dispatch=r,[a,r]},useMemoCache:Im,useCacheRefresh:function(){return ba().memoizedState=EC.bind(null,ln)},useEffectEvent:function(a){var r=ba(),c={impl:a};return r.memoizedState=c,function(){if((En&2)!==0)throw Error(i(440));return c.impl.apply(void 0,arguments)}}},Hm={readContext:ua,use:gu,useCallback:Nx,useContext:ua,useEffect:Fm,useImperativeHandle:wx,useInsertionEffect:xx,useLayoutEffect:vx,useMemo:jx,useReducer:bu,useRef:yx,useState:function(){return bu(Qs)},useDebugValue:zm,useDeferredValue:function(a,r){var c=Kn();return Ex(c,kn.memoizedState,a,r)},useTransition:function(){var a=bu(Qs)[0],r=Kn().memoizedState;return[typeof a=="boolean"?a:wo(a),r]},useSyncExternalStore:ex,useId:Tx,useHostTransitionStatus:qm,useFormState:mx,useActionState:mx,useOptimistic:function(a,r){var c=Kn();return ix(c,kn,a,r)},useMemoCache:Im,useCacheRefresh:Mx};Hm.useEffectEvent=bx;var Lx={readContext:ua,use:gu,useCallback:Nx,useContext:ua,useEffect:Fm,useImperativeHandle:wx,useInsertionEffect:xx,useLayoutEffect:vx,useMemo:jx,useReducer:Lm,useRef:yx,useState:function(){return Lm(Qs)},useDebugValue:zm,useDeferredValue:function(a,r){var c=Kn();return kn===null?Bm(c,a,r):Ex(c,kn.memoizedState,a,r)},useTransition:function(){var a=Lm(Qs)[0],r=Kn().memoizedState;return[typeof a=="boolean"?a:wo(a),r]},useSyncExternalStore:ex,useId:Tx,useHostTransitionStatus:qm,useFormState:px,useActionState:px,useOptimistic:function(a,r){var c=Kn();return kn!==null?ix(c,kn,a,r):(c.baseState=a,[a,c.queue.dispatch])},useMemoCache:Im,useCacheRefresh:Mx};Lx.useEffectEvent=bx;function Vm(a,r,c,f){r=a.memoizedState,c=c(f,r),c=c==null?r:g({},r,c),a.memoizedState=c,a.lanes===0&&(a.updateQueue.baseState=c)}var Ym={enqueueSetState:function(a,r,c){a=a._reactInternals;var f=Ha(),b=Er(f);b.payload=r,c!=null&&(b.callback=c),r=_r(a,b,f),r!==null&&(Ra(r,a,f),bo(r,a,f))},enqueueReplaceState:function(a,r,c){a=a._reactInternals;var f=Ha(),b=Er(f);b.tag=1,b.payload=r,c!=null&&(b.callback=c),r=_r(a,b,f),r!==null&&(Ra(r,a,f),bo(r,a,f))},enqueueForceUpdate:function(a,r){a=a._reactInternals;var c=Ha(),f=Er(c);f.tag=2,r!=null&&(f.callback=r),r=_r(a,f,c),r!==null&&(Ra(r,a,c),bo(r,a,c))}};function Ox(a,r,c,f,b,w,q){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(f,w,q):r.prototype&&r.prototype.isPureReactComponent?!co(c,f)||!co(b,w):!0}function $x(a,r,c,f){a=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(c,f),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(c,f),r.state!==a&&Ym.enqueueReplaceState(r,r.state,null)}function vi(a,r){var c=r;if("ref"in r){c={};for(var f in r)f!=="ref"&&(c[f]=r[f])}if(a=a.defaultProps){c===r&&(c=g({},c));for(var b in a)c[b]===void 0&&(c[b]=a[b])}return c}function Fx(a){Jc(a)}function zx(a){console.error(a)}function Bx(a){Jc(a)}function wu(a,r){try{var c=a.onUncaughtError;c(r.value,{componentStack:r.stack})}catch(f){setTimeout(function(){throw f})}}function Ux(a,r,c){try{var f=a.onCaughtError;f(c.value,{componentStack:c.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function Gm(a,r,c){return c=Er(c),c.tag=3,c.payload={element:null},c.callback=function(){wu(a,r)},c}function qx(a){return a=Er(a),a.tag=3,a}function Px(a,r,c,f){var b=c.type.getDerivedStateFromError;if(typeof b=="function"){var w=f.value;a.payload=function(){return b(w)},a.callback=function(){Ux(r,c,f)}}var q=c.stateNode;q!==null&&typeof q.componentDidCatch=="function"&&(a.callback=function(){Ux(r,c,f),typeof b!="function"&&(Rr===null?Rr=new Set([this]):Rr.add(this));var te=f.stack;this.componentDidCatch(f.value,{componentStack:te!==null?te:""})})}function CC(a,r,c,f,b){if(c.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(r=c.alternate,r!==null&&al(r,c,b,!0),c=Ba.current,c!==null){switch(c.tag){case 31:case 13:return ns===null?Du():c.alternate===null&&Hn===0&&(Hn=3),c.flags&=-257,c.flags|=65536,c.lanes=b,f===cu?c.flags|=16384:(r=c.updateQueue,r===null?c.updateQueue=new Set([f]):r.add(f),bh(a,f,b)),!1;case 22:return c.flags|=65536,f===cu?c.flags|=16384:(r=c.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([f])},c.updateQueue=r):(c=r.retryQueue,c===null?r.retryQueue=new Set([f]):c.add(f)),bh(a,f,b)),!1}throw Error(i(435,c.tag))}return bh(a,f,b),Du(),!1}if(Sn)return r=Ba.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=b,f!==fm&&(a=Error(i(422),{cause:f}),mo(Qa(a,c)))):(f!==fm&&(r=Error(i(423),{cause:f}),mo(Qa(r,c))),a=a.current.alternate,a.flags|=65536,b&=-b,a.lanes|=b,f=Qa(f,c),b=Gm(a.stateNode,f,b),Nm(a,b),Hn!==4&&(Hn=2)),!1;var w=Error(i(520),{cause:f});if(w=Qa(w,c),Ro===null?Ro=[w]:Ro.push(w),Hn!==4&&(Hn=2),r===null)return!0;f=Qa(f,c),c=r;do{switch(c.tag){case 3:return c.flags|=65536,a=b&-b,c.lanes|=a,a=Gm(c.stateNode,f,a),Nm(c,a),!1;case 1:if(r=c.type,w=c.stateNode,(c.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Rr===null||!Rr.has(w))))return c.flags|=65536,b&=-b,c.lanes|=b,b=qx(b),Px(b,a,c,f),Nm(c,b),!1}c=c.return}while(c!==null);return!1}var Km=Error(i(461)),Zn=!1;function da(a,r,c,f){r.child=a===null?Gb(r,null,c,f):bi(r,a.child,c,f)}function Hx(a,r,c,f,b){c=c.render;var w=r.ref;if("ref"in f){var q={};for(var te in f)te!=="ref"&&(q[te]=f[te])}else q=f;return hi(r),f=Tm(a,r,c,q,w,b),te=Mm(),a!==null&&!Zn?(km(a,r,b),Js(a,r,b)):(Sn&&te&&um(r),r.flags|=1,da(a,r,f,b),r.child)}function Vx(a,r,c,f,b){if(a===null){var w=c.type;return typeof w=="function"&&!lm(w)&&w.defaultProps===void 0&&c.compare===null?(r.tag=15,r.type=w,Yx(a,r,w,f,b)):(a=au(c.type,null,f,r,r.mode,b),a.ref=r.ref,a.return=r,r.child=a)}if(w=a.child,!nh(a,b)){var q=w.memoizedProps;if(c=c.compare,c=c!==null?c:co,c(q,f)&&a.ref===r.ref)return Js(a,r,b)}return r.flags|=1,a=Gs(w,f),a.ref=r.ref,a.return=r,r.child=a}function Yx(a,r,c,f,b){if(a!==null){var w=a.memoizedProps;if(co(w,f)&&a.ref===r.ref)if(Zn=!1,r.pendingProps=f=w,nh(a,b))(a.flags&131072)!==0&&(Zn=!0);else return r.lanes=a.lanes,Js(a,r,b)}return Xm(a,r,c,f,b)}function Gx(a,r,c,f){var b=f.children,w=a!==null?a.memoizedState:null;if(a===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((r.flags&128)!==0){if(w=w!==null?w.baseLanes|c:c,a!==null){for(f=r.child=a.child,b=0;f!==null;)b=b|f.lanes|f.childLanes,f=f.sibling;f=b&~w}else f=0,r.child=null;return Kx(a,r,w,c,f)}if((c&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},a!==null&&lu(r,w!==null?w.cachePool:null),w!==null?Wb(r,w):Em(),Zb(r);else return f=r.lanes=536870912,Kx(a,r,w!==null?w.baseLanes|c:c,c,f)}else w!==null?(lu(r,w.cachePool),Wb(r,w),Ar(),r.memoizedState=null):(a!==null&&lu(r,null),Em(),Ar());return da(a,r,b,c),r.child}function Eo(a,r){return a!==null&&a.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function Kx(a,r,c,f,b){var w=xm();return w=w===null?null:{parent:Xn._currentValue,pool:w},r.memoizedState={baseLanes:c,cachePool:w},a!==null&&lu(r,null),Em(),Zb(r),a!==null&&al(a,r,f,!0),r.childLanes=b,null}function Nu(a,r){return r=Eu({mode:r.mode,children:r.children},a.mode),r.ref=a.ref,a.child=r,r.return=a,r}function Xx(a,r,c){return bi(r,a.child,null,c),a=Nu(r,r.pendingProps),a.flags|=2,Ua(r),r.memoizedState=null,a}function AC(a,r,c){var f=r.pendingProps,b=(r.flags&128)!==0;if(r.flags&=-129,a===null){if(Sn){if(f.mode==="hidden")return a=Nu(r,f),r.lanes=536870912,Eo(null,a);if(Cm(r),(a=On)?(a=l0(a,ts),a=a!==null&&a.data==="&"?a:null,a!==null&&(r.memoizedState={dehydrated:a,treeContext:vr!==null?{id:Ts,overflow:Ms}:null,retryLane:536870912,hydrationErrors:null},c=Rb(a),c.return=r,r.child=c,ca=r,On=null)):a=null,a===null)throw wr(r);return r.lanes=536870912,null}return Nu(r,f)}var w=a.memoizedState;if(w!==null){var q=w.dehydrated;if(Cm(r),b)if(r.flags&256)r.flags&=-257,r=Xx(a,r,c);else if(r.memoizedState!==null)r.child=a.child,r.flags|=128,r=null;else throw Error(i(558));else if(Zn||al(a,r,c,!1),b=(c&a.childLanes)!==0,Zn||b){if(f=Dn,f!==null&&(q=Se(f,c),q!==0&&q!==w.retryLane))throw w.retryLane=q,ui(a,q),Ra(f,a,q),Km;Du(),r=Xx(a,r,c)}else a=w.treeContext,On=as(q.nextSibling),ca=r,Sn=!0,Sr=null,ts=!1,a!==null&&Lb(r,a),r=Nu(r,f),r.flags|=4096;return r}return a=Gs(a.child,{mode:f.mode,children:f.children}),a.ref=r.ref,r.child=a,a.return=r,a}function ju(a,r){var c=r.ref;if(c===null)a!==null&&a.ref!==null&&(r.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(i(284));(a===null||a.ref!==c)&&(r.flags|=4194816)}}function Xm(a,r,c,f,b){return hi(r),c=Tm(a,r,c,f,void 0,b),f=Mm(),a!==null&&!Zn?(km(a,r,b),Js(a,r,b)):(Sn&&f&&um(r),r.flags|=1,da(a,r,c,b),r.child)}function Wx(a,r,c,f,b,w){return hi(r),r.updateQueue=null,c=Jb(r,f,c,b),Qb(a),f=Mm(),a!==null&&!Zn?(km(a,r,w),Js(a,r,w)):(Sn&&f&&um(r),r.flags|=1,da(a,r,c,w),r.child)}function Zx(a,r,c,f,b){if(hi(r),r.stateNode===null){var w=Ji,q=c.contextType;typeof q=="object"&&q!==null&&(w=ua(q)),w=new c(f,w),r.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=Ym,r.stateNode=w,w._reactInternals=r,w=r.stateNode,w.props=f,w.state=r.memoizedState,w.refs={},Sm(r),q=c.contextType,w.context=typeof q=="object"&&q!==null?ua(q):Ji,w.state=r.memoizedState,q=c.getDerivedStateFromProps,typeof q=="function"&&(Vm(r,c,q,f),w.state=r.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(q=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),q!==w.state&&Ym.enqueueReplaceState(w,w.state,null),vo(r,f,w,b),xo(),w.state=r.memoizedState),typeof w.componentDidMount=="function"&&(r.flags|=4194308),f=!0}else if(a===null){w=r.stateNode;var te=r.memoizedProps,je=vi(c,te);w.props=je;var Xe=w.context,ft=c.contextType;q=Ji,typeof ft=="object"&&ft!==null&&(q=ua(ft));var gt=c.getDerivedStateFromProps;ft=typeof gt=="function"||typeof w.getSnapshotBeforeUpdate=="function",te=r.pendingProps!==te,ft||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(te||Xe!==q)&&$x(r,w,f,q),jr=!1;var Qe=r.memoizedState;w.state=Qe,vo(r,f,w,b),xo(),Xe=r.memoizedState,te||Qe!==Xe||jr?(typeof gt=="function"&&(Vm(r,c,gt,f),Xe=r.memoizedState),(je=jr||Ox(r,c,je,f,Qe,Xe,q))?(ft||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(r.flags|=4194308)):(typeof w.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=f,r.memoizedState=Xe),w.props=f,w.state=Xe,w.context=q,f=je):(typeof w.componentDidMount=="function"&&(r.flags|=4194308),f=!1)}else{w=r.stateNode,wm(a,r),q=r.memoizedProps,ft=vi(c,q),w.props=ft,gt=r.pendingProps,Qe=w.context,Xe=c.contextType,je=Ji,typeof Xe=="object"&&Xe!==null&&(je=ua(Xe)),te=c.getDerivedStateFromProps,(Xe=typeof te=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(q!==gt||Qe!==je)&&$x(r,w,f,je),jr=!1,Qe=r.memoizedState,w.state=Qe,vo(r,f,w,b),xo();var rt=r.memoizedState;q!==gt||Qe!==rt||jr||a!==null&&a.dependencies!==null&&ru(a.dependencies)?(typeof te=="function"&&(Vm(r,c,te,f),rt=r.memoizedState),(ft=jr||Ox(r,c,ft,f,Qe,rt,je)||a!==null&&a.dependencies!==null&&ru(a.dependencies))?(Xe||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(f,rt,je),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(f,rt,je)),typeof w.componentDidUpdate=="function"&&(r.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof w.componentDidUpdate!="function"||q===a.memoizedProps&&Qe===a.memoizedState||(r.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||q===a.memoizedProps&&Qe===a.memoizedState||(r.flags|=1024),r.memoizedProps=f,r.memoizedState=rt),w.props=f,w.state=rt,w.context=je,f=ft):(typeof w.componentDidUpdate!="function"||q===a.memoizedProps&&Qe===a.memoizedState||(r.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||q===a.memoizedProps&&Qe===a.memoizedState||(r.flags|=1024),f=!1)}return w=f,ju(a,r),f=(r.flags&128)!==0,w||f?(w=r.stateNode,c=f&&typeof c.getDerivedStateFromError!="function"?null:w.render(),r.flags|=1,a!==null&&f?(r.child=bi(r,a.child,null,b),r.child=bi(r,null,c,b)):da(a,r,c,b),r.memoizedState=w.state,a=r.child):a=Js(a,r,b),a}function Qx(a,r,c,f){return fi(),r.flags|=256,da(a,r,c,f),r.child}var Wm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Zm(a){return{baseLanes:a,cachePool:Ub()}}function Qm(a,r,c){return a=a!==null?a.childLanes&~c:0,r&&(a|=Pa),a}function Jx(a,r,c){var f=r.pendingProps,b=!1,w=(r.flags&128)!==0,q;if((q=w)||(q=a!==null&&a.memoizedState===null?!1:(Gn.current&2)!==0),q&&(b=!0,r.flags&=-129),q=(r.flags&32)!==0,r.flags&=-33,a===null){if(Sn){if(b?Cr(r):Ar(),(a=On)?(a=l0(a,ts),a=a!==null&&a.data!=="&"?a:null,a!==null&&(r.memoizedState={dehydrated:a,treeContext:vr!==null?{id:Ts,overflow:Ms}:null,retryLane:536870912,hydrationErrors:null},c=Rb(a),c.return=r,r.child=c,ca=r,On=null)):a=null,a===null)throw wr(r);return Dh(a)?r.lanes=32:r.lanes=536870912,null}var te=f.children;return f=f.fallback,b?(Ar(),b=r.mode,te=Eu({mode:"hidden",children:te},b),f=di(f,b,c,null),te.return=r,f.return=r,te.sibling=f,r.child=te,f=r.child,f.memoizedState=Zm(c),f.childLanes=Qm(a,q,c),r.memoizedState=Wm,Eo(null,f)):(Cr(r),Jm(r,te))}var je=a.memoizedState;if(je!==null&&(te=je.dehydrated,te!==null)){if(w)r.flags&256?(Cr(r),r.flags&=-257,r=eh(a,r,c)):r.memoizedState!==null?(Ar(),r.child=a.child,r.flags|=128,r=null):(Ar(),te=f.fallback,b=r.mode,f=Eu({mode:"visible",children:f.children},b),te=di(te,b,c,null),te.flags|=2,f.return=r,te.return=r,f.sibling=te,r.child=f,bi(r,a.child,null,c),f=r.child,f.memoizedState=Zm(c),f.childLanes=Qm(a,q,c),r.memoizedState=Wm,r=Eo(null,f));else if(Cr(r),Dh(te)){if(q=te.nextSibling&&te.nextSibling.dataset,q)var Xe=q.dgst;q=Xe,f=Error(i(419)),f.stack="",f.digest=q,mo({value:f,source:null,stack:null}),r=eh(a,r,c)}else if(Zn||al(a,r,c,!1),q=(c&a.childLanes)!==0,Zn||q){if(q=Dn,q!==null&&(f=Se(q,c),f!==0&&f!==je.retryLane))throw je.retryLane=f,ui(a,f),Ra(q,a,f),Km;Ih(te)||Du(),r=eh(a,r,c)}else Ih(te)?(r.flags|=192,r.child=a.child,r=null):(a=je.treeContext,On=as(te.nextSibling),ca=r,Sn=!0,Sr=null,ts=!1,a!==null&&Lb(r,a),r=Jm(r,f.children),r.flags|=4096);return r}return b?(Ar(),te=f.fallback,b=r.mode,je=a.child,Xe=je.sibling,f=Gs(je,{mode:"hidden",children:f.children}),f.subtreeFlags=je.subtreeFlags&65011712,Xe!==null?te=Gs(Xe,te):(te=di(te,b,c,null),te.flags|=2),te.return=r,f.return=r,f.sibling=te,r.child=f,Eo(null,f),f=r.child,te=a.child.memoizedState,te===null?te=Zm(c):(b=te.cachePool,b!==null?(je=Xn._currentValue,b=b.parent!==je?{parent:je,pool:je}:b):b=Ub(),te={baseLanes:te.baseLanes|c,cachePool:b}),f.memoizedState=te,f.childLanes=Qm(a,q,c),r.memoizedState=Wm,Eo(a.child,f)):(Cr(r),c=a.child,a=c.sibling,c=Gs(c,{mode:"visible",children:f.children}),c.return=r,c.sibling=null,a!==null&&(q=r.deletions,q===null?(r.deletions=[a],r.flags|=16):q.push(a)),r.child=c,r.memoizedState=null,c)}function Jm(a,r){return r=Eu({mode:"visible",children:r},a.mode),r.return=a,a.child=r}function Eu(a,r){return a=za(22,a,null,r),a.lanes=0,a}function eh(a,r,c){return bi(r,a.child,null,c),a=Jm(r,r.pendingProps.children),a.flags|=2,r.memoizedState=null,a}function ev(a,r,c){a.lanes|=r;var f=a.alternate;f!==null&&(f.lanes|=r),pm(a.return,r,c)}function th(a,r,c,f,b,w){var q=a.memoizedState;q===null?a.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:b,treeForkCount:w}:(q.isBackwards=r,q.rendering=null,q.renderingStartTime=0,q.last=f,q.tail=c,q.tailMode=b,q.treeForkCount=w)}function tv(a,r,c){var f=r.pendingProps,b=f.revealOrder,w=f.tail;f=f.children;var q=Gn.current,te=(q&2)!==0;if(te?(q=q&1|2,r.flags|=128):q&=1,P(Gn,q),da(a,r,f,c),f=Sn?fo:0,!te&&a!==null&&(a.flags&128)!==0)e:for(a=r.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&ev(a,c,r);else if(a.tag===19)ev(a,c,r);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break e;for(;a.sibling===null;){if(a.return===null||a.return===r)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(b){case"forwards":for(c=r.child,b=null;c!==null;)a=c.alternate,a!==null&&mu(a)===null&&(b=c),c=c.sibling;c=b,c===null?(b=r.child,r.child=null):(b=c.sibling,c.sibling=null),th(r,!1,b,c,w,f);break;case"backwards":case"unstable_legacy-backwards":for(c=null,b=r.child,r.child=null;b!==null;){if(a=b.alternate,a!==null&&mu(a)===null){r.child=b;break}a=b.sibling,b.sibling=c,c=b,b=a}th(r,!0,c,null,w,f);break;case"together":th(r,!1,null,null,void 0,f);break;default:r.memoizedState=null}return r.child}function Js(a,r,c){if(a!==null&&(r.dependencies=a.dependencies),kr|=r.lanes,(c&r.childLanes)===0)if(a!==null){if(al(a,r,c,!1),(c&r.childLanes)===0)return null}else return null;if(a!==null&&r.child!==a.child)throw Error(i(153));if(r.child!==null){for(a=r.child,c=Gs(a,a.pendingProps),r.child=c,c.return=r;a.sibling!==null;)a=a.sibling,c=c.sibling=Gs(a,a.pendingProps),c.return=r;c.sibling=null}return r.child}function nh(a,r){return(a.lanes&r)!==0?!0:(a=a.dependencies,!!(a!==null&&ru(a)))}function TC(a,r,c){switch(r.tag){case 3:Q(r,r.stateNode.containerInfo),Nr(r,Xn,a.memoizedState.cache),fi();break;case 27:case 5:ae(r);break;case 4:Q(r,r.stateNode.containerInfo);break;case 10:Nr(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,Cm(r),null;break;case 13:var f=r.memoizedState;if(f!==null)return f.dehydrated!==null?(Cr(r),r.flags|=128,null):(c&r.child.childLanes)!==0?Jx(a,r,c):(Cr(r),a=Js(a,r,c),a!==null?a.sibling:null);Cr(r);break;case 19:var b=(a.flags&128)!==0;if(f=(c&r.childLanes)!==0,f||(al(a,r,c,!1),f=(c&r.childLanes)!==0),b){if(f)return tv(a,r,c);r.flags|=128}if(b=r.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),P(Gn,Gn.current),f)break;return null;case 22:return r.lanes=0,Gx(a,r,c,r.pendingProps);case 24:Nr(r,Xn,a.memoizedState.cache)}return Js(a,r,c)}function nv(a,r,c){if(a!==null)if(a.memoizedProps!==r.pendingProps)Zn=!0;else{if(!nh(a,c)&&(r.flags&128)===0)return Zn=!1,TC(a,r,c);Zn=(a.flags&131072)!==0}else Zn=!1,Sn&&(r.flags&1048576)!==0&&Db(r,fo,r.index);switch(r.lanes=0,r.tag){case 16:e:{var f=r.pendingProps;if(a=yi(r.elementType),r.type=a,typeof a=="function")lm(a)?(f=vi(a,f),r.tag=1,r=Zx(null,r,a,f,c)):(r.tag=0,r=Xm(null,r,a,f,c));else{if(a!=null){var b=a.$$typeof;if(b===_){r.tag=11,r=Hx(null,r,a,f,c);break e}else if(b===C){r.tag=14,r=Vx(null,r,a,f,c);break e}}throw r=R(a)||a,Error(i(306,r,""))}}return r;case 0:return Xm(a,r,r.type,r.pendingProps,c);case 1:return f=r.type,b=vi(f,r.pendingProps),Zx(a,r,f,b,c);case 3:e:{if(Q(r,r.stateNode.containerInfo),a===null)throw Error(i(387));f=r.pendingProps;var w=r.memoizedState;b=w.element,wm(a,r),vo(r,f,null,c);var q=r.memoizedState;if(f=q.cache,Nr(r,Xn,f),f!==w.cache&&ym(r,[Xn],c,!0),xo(),f=q.element,w.isDehydrated)if(w={element:f,isDehydrated:!1,cache:q.cache},r.updateQueue.baseState=w,r.memoizedState=w,r.flags&256){r=Qx(a,r,f,c);break e}else if(f!==b){b=Qa(Error(i(424)),r),mo(b),r=Qx(a,r,f,c);break e}else{switch(a=r.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(On=as(a.firstChild),ca=r,Sn=!0,Sr=null,ts=!0,c=Gb(r,null,f,c),r.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(fi(),f===b){r=Js(a,r,c);break e}da(a,r,f,c)}r=r.child}return r;case 26:return ju(a,r),a===null?(c=m0(r.type,null,r.pendingProps,null))?r.memoizedState=c:Sn||(c=r.type,a=r.pendingProps,f=Uu(W.current).createElement(c),f[_e]=r,f[ge]=a,fa(f,c,a),He(f),r.stateNode=f):r.memoizedState=m0(r.type,a.memoizedProps,r.pendingProps,a.memoizedState),null;case 27:return ae(r),a===null&&Sn&&(f=r.stateNode=u0(r.type,r.pendingProps,W.current),ca=r,ts=!0,b=On,Or(r.type)?(Lh=b,On=as(f.firstChild)):On=b),da(a,r,r.pendingProps.children,c),ju(a,r),a===null&&(r.flags|=4194304),r.child;case 5:return a===null&&Sn&&((b=f=On)&&(f=rA(f,r.type,r.pendingProps,ts),f!==null?(r.stateNode=f,ca=r,On=as(f.firstChild),ts=!1,b=!0):b=!1),b||wr(r)),ae(r),b=r.type,w=r.pendingProps,q=a!==null?a.memoizedProps:null,f=w.children,Mh(b,w)?f=null:q!==null&&Mh(b,q)&&(r.flags|=32),r.memoizedState!==null&&(b=Tm(a,r,vC,null,null,c),Bo._currentValue=b),ju(a,r),da(a,r,f,c),r.child;case 6:return a===null&&Sn&&((a=c=On)&&(c=iA(c,r.pendingProps,ts),c!==null?(r.stateNode=c,ca=r,On=null,a=!0):a=!1),a||wr(r)),null;case 13:return Jx(a,r,c);case 4:return Q(r,r.stateNode.containerInfo),f=r.pendingProps,a===null?r.child=bi(r,null,f,c):da(a,r,f,c),r.child;case 11:return Hx(a,r,r.type,r.pendingProps,c);case 7:return da(a,r,r.pendingProps,c),r.child;case 8:return da(a,r,r.pendingProps.children,c),r.child;case 12:return da(a,r,r.pendingProps.children,c),r.child;case 10:return f=r.pendingProps,Nr(r,r.type,f.value),da(a,r,f.children,c),r.child;case 9:return b=r.type._context,f=r.pendingProps.children,hi(r),b=ua(b),f=f(b),r.flags|=1,da(a,r,f,c),r.child;case 14:return Vx(a,r,r.type,r.pendingProps,c);case 15:return Yx(a,r,r.type,r.pendingProps,c);case 19:return tv(a,r,c);case 31:return AC(a,r,c);case 22:return Gx(a,r,c,r.pendingProps);case 24:return hi(r),f=ua(Xn),a===null?(b=xm(),b===null&&(b=Dn,w=gm(),b.pooledCache=w,w.refCount++,w!==null&&(b.pooledCacheLanes|=c),b=w),r.memoizedState={parent:f,cache:b},Sm(r),Nr(r,Xn,b)):((a.lanes&c)!==0&&(wm(a,r),vo(r,null,null,c),xo()),b=a.memoizedState,w=r.memoizedState,b.parent!==f?(b={parent:f,cache:f},r.memoizedState=b,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=b),Nr(r,Xn,f)):(f=w.cache,Nr(r,Xn,f),f!==b.cache&&ym(r,[Xn],c,!0))),da(a,r,r.pendingProps.children,c),r.child;case 29:throw r.pendingProps}throw Error(i(156,r.tag))}function er(a){a.flags|=4}function ah(a,r,c,f,b){if((r=(a.mode&32)!==0)&&(r=!1),r){if(a.flags|=16777216,(b&335544128)===b)if(a.stateNode.complete)a.flags|=8192;else if(Tv())a.flags|=8192;else throw gi=cu,vm}else a.flags&=-16777217}function av(a,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!b0(r))if(Tv())a.flags|=8192;else throw gi=cu,vm}function _u(a,r){r!==null&&(a.flags|=4),a.flags&16384&&(r=a.tag!==22?qt():536870912,a.lanes|=r,pl|=r)}function _o(a,r){if(!Sn)switch(a.tailMode){case"hidden":r=a.tail;for(var c=null;r!==null;)r.alternate!==null&&(c=r),r=r.sibling;c===null?a.tail=null:c.sibling=null;break;case"collapsed":c=a.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?r||a.tail===null?a.tail=null:a.tail.sibling=null:f.sibling=null}}function $n(a){var r=a.alternate!==null&&a.alternate.child===a.child,c=0,f=0;if(r)for(var b=a.child;b!==null;)c|=b.lanes|b.childLanes,f|=b.subtreeFlags&65011712,f|=b.flags&65011712,b.return=a,b=b.sibling;else for(b=a.child;b!==null;)c|=b.lanes|b.childLanes,f|=b.subtreeFlags,f|=b.flags,b.return=a,b=b.sibling;return a.subtreeFlags|=f,a.childLanes=c,r}function MC(a,r,c){var f=r.pendingProps;switch(dm(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $n(r),null;case 1:return $n(r),null;case 3:return c=r.stateNode,f=null,a!==null&&(f=a.memoizedState.cache),r.memoizedState.cache!==f&&(r.flags|=2048),Ws(Xn),ye(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(a===null||a.child===null)&&(nl(r)?er(r):a===null||a.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,mm())),$n(r),null;case 26:var b=r.type,w=r.memoizedState;return a===null?(er(r),w!==null?($n(r),av(r,w)):($n(r),ah(r,b,null,f,c))):w?w!==a.memoizedState?(er(r),$n(r),av(r,w)):($n(r),r.flags&=-16777217):(a=a.memoizedProps,a!==f&&er(r),$n(r),ah(r,b,a,f,c)),null;case 27:if(ke(r),c=W.current,b=r.type,a!==null&&r.stateNode!=null)a.memoizedProps!==f&&er(r);else{if(!f){if(r.stateNode===null)throw Error(i(166));return $n(r),null}a=K.current,nl(r)?Ob(r):(a=u0(b,f,c),r.stateNode=a,er(r))}return $n(r),null;case 5:if(ke(r),b=r.type,a!==null&&r.stateNode!=null)a.memoizedProps!==f&&er(r);else{if(!f){if(r.stateNode===null)throw Error(i(166));return $n(r),null}if(w=K.current,nl(r))Ob(r);else{var q=Uu(W.current);switch(w){case 1:w=q.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:w=q.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":w=q.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":w=q.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":w=q.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof f.is=="string"?q.createElement("select",{is:f.is}):q.createElement("select"),f.multiple?w.multiple=!0:f.size&&(w.size=f.size);break;default:w=typeof f.is=="string"?q.createElement(b,{is:f.is}):q.createElement(b)}}w[_e]=r,w[ge]=f;e:for(q=r.child;q!==null;){if(q.tag===5||q.tag===6)w.appendChild(q.stateNode);else if(q.tag!==4&&q.tag!==27&&q.child!==null){q.child.return=q,q=q.child;continue}if(q===r)break e;for(;q.sibling===null;){if(q.return===null||q.return===r)break e;q=q.return}q.sibling.return=q.return,q=q.sibling}r.stateNode=w;e:switch(fa(w,b,f),b){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&er(r)}}return $n(r),ah(r,r.type,a===null?null:a.memoizedProps,r.pendingProps,c),null;case 6:if(a&&r.stateNode!=null)a.memoizedProps!==f&&er(r);else{if(typeof f!="string"&&r.stateNode===null)throw Error(i(166));if(a=W.current,nl(r)){if(a=r.stateNode,c=r.memoizedProps,f=null,b=ca,b!==null)switch(b.tag){case 27:case 5:f=b.memoizedProps}a[_e]=r,a=!!(a.nodeValue===c||f!==null&&f.suppressHydrationWarning===!0||Jv(a.nodeValue,c)),a||wr(r,!0)}else a=Uu(a).createTextNode(f),a[_e]=r,r.stateNode=a}return $n(r),null;case 31:if(c=r.memoizedState,a===null||a.memoizedState!==null){if(f=nl(r),c!==null){if(a===null){if(!f)throw Error(i(318));if(a=r.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(i(557));a[_e]=r}else fi(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;$n(r),a=!1}else c=mm(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=c),a=!0;if(!a)return r.flags&256?(Ua(r),r):(Ua(r),null);if((r.flags&128)!==0)throw Error(i(558))}return $n(r),null;case 13:if(f=r.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(b=nl(r),f!==null&&f.dehydrated!==null){if(a===null){if(!b)throw Error(i(318));if(b=r.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(i(317));b[_e]=r}else fi(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;$n(r),b=!1}else b=mm(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=b),b=!0;if(!b)return r.flags&256?(Ua(r),r):(Ua(r),null)}return Ua(r),(r.flags&128)!==0?(r.lanes=c,r):(c=f!==null,a=a!==null&&a.memoizedState!==null,c&&(f=r.child,b=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(b=f.alternate.memoizedState.cachePool.pool),w=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(w=f.memoizedState.cachePool.pool),w!==b&&(f.flags|=2048)),c!==a&&c&&(r.child.flags|=8192),_u(r,r.updateQueue),$n(r),null);case 4:return ye(),a===null&&Eh(r.stateNode.containerInfo),$n(r),null;case 10:return Ws(r.type),$n(r),null;case 19:if(Y(Gn),f=r.memoizedState,f===null)return $n(r),null;if(b=(r.flags&128)!==0,w=f.rendering,w===null)if(b)_o(f,!1);else{if(Hn!==0||a!==null&&(a.flags&128)!==0)for(a=r.child;a!==null;){if(w=mu(a),w!==null){for(r.flags|=128,_o(f,!1),a=w.updateQueue,r.updateQueue=a,_u(r,a),r.subtreeFlags=0,a=c,c=r.child;c!==null;)kb(c,a),c=c.sibling;return P(Gn,Gn.current&1|2),Sn&&Ks(r,f.treeForkCount),r.child}a=a.sibling}f.tail!==null&&tt()>ku&&(r.flags|=128,b=!0,_o(f,!1),r.lanes=4194304)}else{if(!b)if(a=mu(w),a!==null){if(r.flags|=128,b=!0,a=a.updateQueue,r.updateQueue=a,_u(r,a),_o(f,!0),f.tail===null&&f.tailMode==="hidden"&&!w.alternate&&!Sn)return $n(r),null}else 2*tt()-f.renderingStartTime>ku&&c!==536870912&&(r.flags|=128,b=!0,_o(f,!1),r.lanes=4194304);f.isBackwards?(w.sibling=r.child,r.child=w):(a=f.last,a!==null?a.sibling=w:r.child=w,f.last=w)}return f.tail!==null?(a=f.tail,f.rendering=a,f.tail=a.sibling,f.renderingStartTime=tt(),a.sibling=null,c=Gn.current,P(Gn,b?c&1|2:c&1),Sn&&Ks(r,f.treeForkCount),a):($n(r),null);case 22:case 23:return Ua(r),_m(),f=r.memoizedState!==null,a!==null?a.memoizedState!==null!==f&&(r.flags|=8192):f&&(r.flags|=8192),f?(c&536870912)!==0&&(r.flags&128)===0&&($n(r),r.subtreeFlags&6&&(r.flags|=8192)):$n(r),c=r.updateQueue,c!==null&&_u(r,c.retryQueue),c=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(c=a.memoizedState.cachePool.pool),f=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(f=r.memoizedState.cachePool.pool),f!==c&&(r.flags|=2048),a!==null&&Y(pi),null;case 24:return c=null,a!==null&&(c=a.memoizedState.cache),r.memoizedState.cache!==c&&(r.flags|=2048),Ws(Xn),$n(r),null;case 25:return null;case 30:return null}throw Error(i(156,r.tag))}function kC(a,r){switch(dm(r),r.tag){case 1:return a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 3:return Ws(Xn),ye(),a=r.flags,(a&65536)!==0&&(a&128)===0?(r.flags=a&-65537|128,r):null;case 26:case 27:case 5:return ke(r),null;case 31:if(r.memoizedState!==null){if(Ua(r),r.alternate===null)throw Error(i(340));fi()}return a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 13:if(Ua(r),a=r.memoizedState,a!==null&&a.dehydrated!==null){if(r.alternate===null)throw Error(i(340));fi()}return a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 19:return Y(Gn),null;case 4:return ye(),null;case 10:return Ws(r.type),null;case 22:case 23:return Ua(r),_m(),a!==null&&Y(pi),a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 24:return Ws(Xn),null;case 25:return null;default:return null}}function sv(a,r){switch(dm(r),r.tag){case 3:Ws(Xn),ye();break;case 26:case 27:case 5:ke(r);break;case 4:ye();break;case 31:r.memoizedState!==null&&Ua(r);break;case 13:Ua(r);break;case 19:Y(Gn);break;case 10:Ws(r.type);break;case 22:case 23:Ua(r),_m(),a!==null&&Y(pi);break;case 24:Ws(Xn)}}function Co(a,r){try{var c=r.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var b=f.next;c=b;do{if((c.tag&a)===a){f=void 0;var w=c.create,q=c.inst;f=w(),q.destroy=f}c=c.next}while(c!==b)}}catch(te){An(r,r.return,te)}}function Tr(a,r,c){try{var f=r.updateQueue,b=f!==null?f.lastEffect:null;if(b!==null){var w=b.next;f=w;do{if((f.tag&a)===a){var q=f.inst,te=q.destroy;if(te!==void 0){q.destroy=void 0,b=r;var je=c,Xe=te;try{Xe()}catch(ft){An(b,je,ft)}}}f=f.next}while(f!==w)}}catch(ft){An(r,r.return,ft)}}function rv(a){var r=a.updateQueue;if(r!==null){var c=a.stateNode;try{Xb(r,c)}catch(f){An(a,a.return,f)}}}function iv(a,r,c){c.props=vi(a.type,a.memoizedProps),c.state=a.memoizedState;try{c.componentWillUnmount()}catch(f){An(a,r,f)}}function Ao(a,r){try{var c=a.ref;if(c!==null){switch(a.tag){case 26:case 27:case 5:var f=a.stateNode;break;case 30:f=a.stateNode;break;default:f=a.stateNode}typeof c=="function"?a.refCleanup=c(f):c.current=f}}catch(b){An(a,r,b)}}function ks(a,r){var c=a.ref,f=a.refCleanup;if(c!==null)if(typeof f=="function")try{f()}catch(b){An(a,r,b)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(b){An(a,r,b)}else c.current=null}function lv(a){var r=a.type,c=a.memoizedProps,f=a.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":c.autoFocus&&f.focus();break e;case"img":c.src?f.src=c.src:c.srcSet&&(f.srcset=c.srcSet)}}catch(b){An(a,a.return,b)}}function sh(a,r,c){try{var f=a.stateNode;JC(f,a.type,c,r),f[ge]=r}catch(b){An(a,a.return,b)}}function ov(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Or(a.type)||a.tag===4}function rh(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||ov(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Or(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function ih(a,r,c){var f=a.tag;if(f===5||f===6)a=a.stateNode,r?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(a,r):(r=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,r.appendChild(a),c=c._reactRootContainer,c!=null||r.onclick!==null||(r.onclick=De));else if(f!==4&&(f===27&&Or(a.type)&&(c=a.stateNode,r=null),a=a.child,a!==null))for(ih(a,r,c),a=a.sibling;a!==null;)ih(a,r,c),a=a.sibling}function Cu(a,r,c){var f=a.tag;if(f===5||f===6)a=a.stateNode,r?c.insertBefore(a,r):c.appendChild(a);else if(f!==4&&(f===27&&Or(a.type)&&(c=a.stateNode),a=a.child,a!==null))for(Cu(a,r,c),a=a.sibling;a!==null;)Cu(a,r,c),a=a.sibling}function cv(a){var r=a.stateNode,c=a.memoizedProps;try{for(var f=a.type,b=r.attributes;b.length;)r.removeAttributeNode(b[0]);fa(r,f,c),r[_e]=a,r[ge]=c}catch(w){An(a,a.return,w)}}var tr=!1,Qn=!1,lh=!1,uv=typeof WeakSet=="function"?WeakSet:Set,ia=null;function RC(a,r){if(a=a.containerInfo,Ah=Ku,a=wb(a),em(a)){if("selectionStart"in a)var c={start:a.selectionStart,end:a.selectionEnd};else e:{c=(c=a.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var b=f.anchorOffset,w=f.focusNode;f=f.focusOffset;try{c.nodeType,w.nodeType}catch{c=null;break e}var q=0,te=-1,je=-1,Xe=0,ft=0,gt=a,Qe=null;t:for(;;){for(var rt;gt!==c||b!==0&&gt.nodeType!==3||(te=q+b),gt!==w||f!==0&&gt.nodeType!==3||(je=q+f),gt.nodeType===3&&(q+=gt.nodeValue.length),(rt=gt.firstChild)!==null;)Qe=gt,gt=rt;for(;;){if(gt===a)break t;if(Qe===c&&++Xe===b&&(te=q),Qe===w&&++ft===f&&(je=q),(rt=gt.nextSibling)!==null)break;gt=Qe,Qe=gt.parentNode}gt=rt}c=te===-1||je===-1?null:{start:te,end:je}}else c=null}c=c||{start:0,end:0}}else c=null;for(Th={focusedElem:a,selectionRange:c},Ku=!1,ia=r;ia!==null;)if(r=ia,a=r.child,(r.subtreeFlags&1028)!==0&&a!==null)a.return=r,ia=a;else for(;ia!==null;){switch(r=ia,w=r.alternate,a=r.flags,r.tag){case 0:if((a&4)!==0&&(a=r.updateQueue,a=a!==null?a.events:null,a!==null))for(c=0;c<a.length;c++)b=a[c],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&w!==null){a=void 0,c=r,b=w.memoizedProps,w=w.memoizedState,f=c.stateNode;try{var Ut=vi(c.type,b);a=f.getSnapshotBeforeUpdate(Ut,w),f.__reactInternalSnapshotBeforeUpdate=a}catch(Jt){An(c,c.return,Jt)}}break;case 3:if((a&1024)!==0){if(a=r.stateNode.containerInfo,c=a.nodeType,c===9)Rh(a);else if(c===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Rh(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(i(163))}if(a=r.sibling,a!==null){a.return=r.return,ia=a;break}ia=r.return}}function dv(a,r,c){var f=c.flags;switch(c.tag){case 0:case 11:case 15:ar(a,c),f&4&&Co(5,c);break;case 1:if(ar(a,c),f&4)if(a=c.stateNode,r===null)try{a.componentDidMount()}catch(q){An(c,c.return,q)}else{var b=vi(c.type,r.memoizedProps);r=r.memoizedState;try{a.componentDidUpdate(b,r,a.__reactInternalSnapshotBeforeUpdate)}catch(q){An(c,c.return,q)}}f&64&&rv(c),f&512&&Ao(c,c.return);break;case 3:if(ar(a,c),f&64&&(a=c.updateQueue,a!==null)){if(r=null,c.child!==null)switch(c.child.tag){case 27:case 5:r=c.child.stateNode;break;case 1:r=c.child.stateNode}try{Xb(a,r)}catch(q){An(c,c.return,q)}}break;case 27:r===null&&f&4&&cv(c);case 26:case 5:ar(a,c),r===null&&f&4&&lv(c),f&512&&Ao(c,c.return);break;case 12:ar(a,c);break;case 31:ar(a,c),f&4&&hv(a,c);break;case 13:ar(a,c),f&4&&pv(a,c),f&64&&(a=c.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(c=UC.bind(null,c),lA(a,c))));break;case 22:if(f=c.memoizedState!==null||tr,!f){r=r!==null&&r.memoizedState!==null||Qn,b=tr;var w=Qn;tr=f,(Qn=r)&&!w?sr(a,c,(c.subtreeFlags&8772)!==0):ar(a,c),tr=b,Qn=w}break;case 30:break;default:ar(a,c)}}function fv(a){var r=a.alternate;r!==null&&(a.alternate=null,fv(r)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(r=a.stateNode,r!==null&&it(r)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Fn=null,Aa=!1;function nr(a,r,c){for(c=c.child;c!==null;)mv(a,r,c),c=c.sibling}function mv(a,r,c){if(qe&&typeof qe.onCommitFiberUnmount=="function")try{qe.onCommitFiberUnmount(Ue,c)}catch{}switch(c.tag){case 26:Qn||ks(c,r),nr(a,r,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Qn||ks(c,r);var f=Fn,b=Aa;Or(c.type)&&(Fn=c.stateNode,Aa=!1),nr(a,r,c),$o(c.stateNode),Fn=f,Aa=b;break;case 5:Qn||ks(c,r);case 6:if(f=Fn,b=Aa,Fn=null,nr(a,r,c),Fn=f,Aa=b,Fn!==null)if(Aa)try{(Fn.nodeType===9?Fn.body:Fn.nodeName==="HTML"?Fn.ownerDocument.body:Fn).removeChild(c.stateNode)}catch(w){An(c,r,w)}else try{Fn.removeChild(c.stateNode)}catch(w){An(c,r,w)}break;case 18:Fn!==null&&(Aa?(a=Fn,r0(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,c.stateNode),Nl(a)):r0(Fn,c.stateNode));break;case 4:f=Fn,b=Aa,Fn=c.stateNode.containerInfo,Aa=!0,nr(a,r,c),Fn=f,Aa=b;break;case 0:case 11:case 14:case 15:Tr(2,c,r),Qn||Tr(4,c,r),nr(a,r,c);break;case 1:Qn||(ks(c,r),f=c.stateNode,typeof f.componentWillUnmount=="function"&&iv(c,r,f)),nr(a,r,c);break;case 21:nr(a,r,c);break;case 22:Qn=(f=Qn)||c.memoizedState!==null,nr(a,r,c),Qn=f;break;default:nr(a,r,c)}}function hv(a,r){if(r.memoizedState===null&&(a=r.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{Nl(a)}catch(c){An(r,r.return,c)}}}function pv(a,r){if(r.memoizedState===null&&(a=r.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Nl(a)}catch(c){An(r,r.return,c)}}function IC(a){switch(a.tag){case 31:case 13:case 19:var r=a.stateNode;return r===null&&(r=a.stateNode=new uv),r;case 22:return a=a.stateNode,r=a._retryCache,r===null&&(r=a._retryCache=new uv),r;default:throw Error(i(435,a.tag))}}function Au(a,r){var c=IC(a);r.forEach(function(f){if(!c.has(f)){c.add(f);var b=qC.bind(null,a,f);f.then(b,b)}})}function Ta(a,r){var c=r.deletions;if(c!==null)for(var f=0;f<c.length;f++){var b=c[f],w=a,q=r,te=q;e:for(;te!==null;){switch(te.tag){case 27:if(Or(te.type)){Fn=te.stateNode,Aa=!1;break e}break;case 5:Fn=te.stateNode,Aa=!1;break e;case 3:case 4:Fn=te.stateNode.containerInfo,Aa=!0;break e}te=te.return}if(Fn===null)throw Error(i(160));mv(w,q,b),Fn=null,Aa=!1,w=b.alternate,w!==null&&(w.return=null),b.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)yv(r,a),r=r.sibling}var gs=null;function yv(a,r){var c=a.alternate,f=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Ta(r,a),Ma(a),f&4&&(Tr(3,a,a.return),Co(3,a),Tr(5,a,a.return));break;case 1:Ta(r,a),Ma(a),f&512&&(Qn||c===null||ks(c,c.return)),f&64&&tr&&(a=a.updateQueue,a!==null&&(f=a.callbacks,f!==null&&(c=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=c===null?f:c.concat(f))));break;case 26:var b=gs;if(Ta(r,a),Ma(a),f&512&&(Qn||c===null||ks(c,c.return)),f&4){var w=c!==null?c.memoizedState:null;if(f=a.memoizedState,c===null)if(f===null)if(a.stateNode===null){e:{f=a.type,c=a.memoizedProps,b=b.ownerDocument||b;t:switch(f){case"title":w=b.getElementsByTagName("title")[0],(!w||w[de]||w[_e]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=b.createElement(f),b.head.insertBefore(w,b.querySelector("head > title"))),fa(w,f,c),w[_e]=a,He(w),f=w;break e;case"link":var q=y0("link","href",b).get(f+(c.href||""));if(q){for(var te=0;te<q.length;te++)if(w=q[te],w.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&w.getAttribute("rel")===(c.rel==null?null:c.rel)&&w.getAttribute("title")===(c.title==null?null:c.title)&&w.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){q.splice(te,1);break t}}w=b.createElement(f),fa(w,f,c),b.head.appendChild(w);break;case"meta":if(q=y0("meta","content",b).get(f+(c.content||""))){for(te=0;te<q.length;te++)if(w=q[te],w.getAttribute("content")===(c.content==null?null:""+c.content)&&w.getAttribute("name")===(c.name==null?null:c.name)&&w.getAttribute("property")===(c.property==null?null:c.property)&&w.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&w.getAttribute("charset")===(c.charSet==null?null:c.charSet)){q.splice(te,1);break t}}w=b.createElement(f),fa(w,f,c),b.head.appendChild(w);break;default:throw Error(i(468,f))}w[_e]=a,He(w),f=w}a.stateNode=f}else g0(b,a.type,a.stateNode);else a.stateNode=p0(b,f,a.memoizedProps);else w!==f?(w===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):w.count--,f===null?g0(b,a.type,a.stateNode):p0(b,f,a.memoizedProps)):f===null&&a.stateNode!==null&&sh(a,a.memoizedProps,c.memoizedProps)}break;case 27:Ta(r,a),Ma(a),f&512&&(Qn||c===null||ks(c,c.return)),c!==null&&f&4&&sh(a,a.memoizedProps,c.memoizedProps);break;case 5:if(Ta(r,a),Ma(a),f&512&&(Qn||c===null||ks(c,c.return)),a.flags&32){b=a.stateNode;try{Ea(b,"")}catch(Ut){An(a,a.return,Ut)}}f&4&&a.stateNode!=null&&(b=a.memoizedProps,sh(a,b,c!==null?c.memoizedProps:b)),f&1024&&(lh=!0);break;case 6:if(Ta(r,a),Ma(a),f&4){if(a.stateNode===null)throw Error(i(162));f=a.memoizedProps,c=a.stateNode;try{c.nodeValue=f}catch(Ut){An(a,a.return,Ut)}}break;case 3:if(Hu=null,b=gs,gs=qu(r.containerInfo),Ta(r,a),gs=b,Ma(a),f&4&&c!==null&&c.memoizedState.isDehydrated)try{Nl(r.containerInfo)}catch(Ut){An(a,a.return,Ut)}lh&&(lh=!1,gv(a));break;case 4:f=gs,gs=qu(a.stateNode.containerInfo),Ta(r,a),Ma(a),gs=f;break;case 12:Ta(r,a),Ma(a);break;case 31:Ta(r,a),Ma(a),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,Au(a,f)));break;case 13:Ta(r,a),Ma(a),a.child.flags&8192&&a.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Mu=tt()),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,Au(a,f)));break;case 22:b=a.memoizedState!==null;var je=c!==null&&c.memoizedState!==null,Xe=tr,ft=Qn;if(tr=Xe||b,Qn=ft||je,Ta(r,a),Qn=ft,tr=Xe,Ma(a),f&8192)e:for(r=a.stateNode,r._visibility=b?r._visibility&-2:r._visibility|1,b&&(c===null||je||tr||Qn||Si(a)),c=null,r=a;;){if(r.tag===5||r.tag===26){if(c===null){je=c=r;try{if(w=je.stateNode,b)q=w.style,typeof q.setProperty=="function"?q.setProperty("display","none","important"):q.display="none";else{te=je.stateNode;var gt=je.memoizedProps.style,Qe=gt!=null&&gt.hasOwnProperty("display")?gt.display:null;te.style.display=Qe==null||typeof Qe=="boolean"?"":(""+Qe).trim()}}catch(Ut){An(je,je.return,Ut)}}}else if(r.tag===6){if(c===null){je=r;try{je.stateNode.nodeValue=b?"":je.memoizedProps}catch(Ut){An(je,je.return,Ut)}}}else if(r.tag===18){if(c===null){je=r;try{var rt=je.stateNode;b?i0(rt,!0):i0(je.stateNode,!1)}catch(Ut){An(je,je.return,Ut)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===a)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;c===r&&(c=null),r=r.return}c===r&&(c=null),r.sibling.return=r.return,r=r.sibling}f&4&&(f=a.updateQueue,f!==null&&(c=f.retryQueue,c!==null&&(f.retryQueue=null,Au(a,c))));break;case 19:Ta(r,a),Ma(a),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,Au(a,f)));break;case 30:break;case 21:break;default:Ta(r,a),Ma(a)}}function Ma(a){var r=a.flags;if(r&2){try{for(var c,f=a.return;f!==null;){if(ov(f)){c=f;break}f=f.return}if(c==null)throw Error(i(160));switch(c.tag){case 27:var b=c.stateNode,w=rh(a);Cu(a,w,b);break;case 5:var q=c.stateNode;c.flags&32&&(Ea(q,""),c.flags&=-33);var te=rh(a);Cu(a,te,q);break;case 3:case 4:var je=c.stateNode.containerInfo,Xe=rh(a);ih(a,Xe,je);break;default:throw Error(i(161))}}catch(ft){An(a,a.return,ft)}a.flags&=-3}r&4096&&(a.flags&=-4097)}function gv(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var r=a;gv(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),a=a.sibling}}function ar(a,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)dv(a,r.alternate,r),r=r.sibling}function Si(a){for(a=a.child;a!==null;){var r=a;switch(r.tag){case 0:case 11:case 14:case 15:Tr(4,r,r.return),Si(r);break;case 1:ks(r,r.return);var c=r.stateNode;typeof c.componentWillUnmount=="function"&&iv(r,r.return,c),Si(r);break;case 27:$o(r.stateNode);case 26:case 5:ks(r,r.return),Si(r);break;case 22:r.memoizedState===null&&Si(r);break;case 30:Si(r);break;default:Si(r)}a=a.sibling}}function sr(a,r,c){for(c=c&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var f=r.alternate,b=a,w=r,q=w.flags;switch(w.tag){case 0:case 11:case 15:sr(b,w,c),Co(4,w);break;case 1:if(sr(b,w,c),f=w,b=f.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Xe){An(f,f.return,Xe)}if(f=w,b=f.updateQueue,b!==null){var te=f.stateNode;try{var je=b.shared.hiddenCallbacks;if(je!==null)for(b.shared.hiddenCallbacks=null,b=0;b<je.length;b++)Kb(je[b],te)}catch(Xe){An(f,f.return,Xe)}}c&&q&64&&rv(w),Ao(w,w.return);break;case 27:cv(w);case 26:case 5:sr(b,w,c),c&&f===null&&q&4&&lv(w),Ao(w,w.return);break;case 12:sr(b,w,c);break;case 31:sr(b,w,c),c&&q&4&&hv(b,w);break;case 13:sr(b,w,c),c&&q&4&&pv(b,w);break;case 22:w.memoizedState===null&&sr(b,w,c),Ao(w,w.return);break;case 30:break;default:sr(b,w,c)}r=r.sibling}}function oh(a,r){var c=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(c=a.memoizedState.cachePool.pool),a=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(a=r.memoizedState.cachePool.pool),a!==c&&(a!=null&&a.refCount++,c!=null&&ho(c))}function ch(a,r){a=null,r.alternate!==null&&(a=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==a&&(r.refCount++,a!=null&&ho(a))}function bs(a,r,c,f){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)bv(a,r,c,f),r=r.sibling}function bv(a,r,c,f){var b=r.flags;switch(r.tag){case 0:case 11:case 15:bs(a,r,c,f),b&2048&&Co(9,r);break;case 1:bs(a,r,c,f);break;case 3:bs(a,r,c,f),b&2048&&(a=null,r.alternate!==null&&(a=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==a&&(r.refCount++,a!=null&&ho(a)));break;case 12:if(b&2048){bs(a,r,c,f),a=r.stateNode;try{var w=r.memoizedProps,q=w.id,te=w.onPostCommit;typeof te=="function"&&te(q,r.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(je){An(r,r.return,je)}}else bs(a,r,c,f);break;case 31:bs(a,r,c,f);break;case 13:bs(a,r,c,f);break;case 23:break;case 22:w=r.stateNode,q=r.alternate,r.memoizedState!==null?w._visibility&2?bs(a,r,c,f):To(a,r):w._visibility&2?bs(a,r,c,f):(w._visibility|=2,fl(a,r,c,f,(r.subtreeFlags&10256)!==0||!1)),b&2048&&oh(q,r);break;case 24:bs(a,r,c,f),b&2048&&ch(r.alternate,r);break;default:bs(a,r,c,f)}}function fl(a,r,c,f,b){for(b=b&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var w=a,q=r,te=c,je=f,Xe=q.flags;switch(q.tag){case 0:case 11:case 15:fl(w,q,te,je,b),Co(8,q);break;case 23:break;case 22:var ft=q.stateNode;q.memoizedState!==null?ft._visibility&2?fl(w,q,te,je,b):To(w,q):(ft._visibility|=2,fl(w,q,te,je,b)),b&&Xe&2048&&oh(q.alternate,q);break;case 24:fl(w,q,te,je,b),b&&Xe&2048&&ch(q.alternate,q);break;default:fl(w,q,te,je,b)}r=r.sibling}}function To(a,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var c=a,f=r,b=f.flags;switch(f.tag){case 22:To(c,f),b&2048&&oh(f.alternate,f);break;case 24:To(c,f),b&2048&&ch(f.alternate,f);break;default:To(c,f)}r=r.sibling}}var Mo=8192;function ml(a,r,c){if(a.subtreeFlags&Mo)for(a=a.child;a!==null;)xv(a,r,c),a=a.sibling}function xv(a,r,c){switch(a.tag){case 26:ml(a,r,c),a.flags&Mo&&a.memoizedState!==null&&xA(c,gs,a.memoizedState,a.memoizedProps);break;case 5:ml(a,r,c);break;case 3:case 4:var f=gs;gs=qu(a.stateNode.containerInfo),ml(a,r,c),gs=f;break;case 22:a.memoizedState===null&&(f=a.alternate,f!==null&&f.memoizedState!==null?(f=Mo,Mo=16777216,ml(a,r,c),Mo=f):ml(a,r,c));break;default:ml(a,r,c)}}function vv(a){var r=a.alternate;if(r!==null&&(a=r.child,a!==null)){r.child=null;do r=a.sibling,a.sibling=null,a=r;while(a!==null)}}function ko(a){var r=a.deletions;if((a.flags&16)!==0){if(r!==null)for(var c=0;c<r.length;c++){var f=r[c];ia=f,wv(f,a)}vv(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Sv(a),a=a.sibling}function Sv(a){switch(a.tag){case 0:case 11:case 15:ko(a),a.flags&2048&&Tr(9,a,a.return);break;case 3:ko(a);break;case 12:ko(a);break;case 22:var r=a.stateNode;a.memoizedState!==null&&r._visibility&2&&(a.return===null||a.return.tag!==13)?(r._visibility&=-3,Tu(a)):ko(a);break;default:ko(a)}}function Tu(a){var r=a.deletions;if((a.flags&16)!==0){if(r!==null)for(var c=0;c<r.length;c++){var f=r[c];ia=f,wv(f,a)}vv(a)}for(a=a.child;a!==null;){switch(r=a,r.tag){case 0:case 11:case 15:Tr(8,r,r.return),Tu(r);break;case 22:c=r.stateNode,c._visibility&2&&(c._visibility&=-3,Tu(r));break;default:Tu(r)}a=a.sibling}}function wv(a,r){for(;ia!==null;){var c=ia;switch(c.tag){case 0:case 11:case 15:Tr(8,c,r);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var f=c.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:ho(c.memoizedState.cache)}if(f=c.child,f!==null)f.return=c,ia=f;else e:for(c=a;ia!==null;){f=ia;var b=f.sibling,w=f.return;if(fv(f),f===c){ia=null;break e}if(b!==null){b.return=w,ia=b;break e}ia=w}}}var DC={getCacheForType:function(a){var r=ua(Xn),c=r.data.get(a);return c===void 0&&(c=a(),r.data.set(a,c)),c},cacheSignal:function(){return ua(Xn).controller.signal}},LC=typeof WeakMap=="function"?WeakMap:Map,En=0,Dn=null,gn=null,xn=0,Cn=0,qa=null,Mr=!1,hl=!1,uh=!1,rr=0,Hn=0,kr=0,wi=0,dh=0,Pa=0,pl=0,Ro=null,ka=null,fh=!1,Mu=0,Nv=0,ku=1/0,Ru=null,Rr=null,na=0,Ir=null,yl=null,ir=0,mh=0,hh=null,jv=null,Io=0,ph=null;function Ha(){return(En&2)!==0&&xn!==0?xn&-xn:L.T!==null?Sh():se()}function Ev(){if(Pa===0)if((xn&536870912)===0||Sn){var a=ot;ot<<=1,(ot&3932160)===0&&(ot=262144),Pa=a}else Pa=536870912;return a=Ba.current,a!==null&&(a.flags|=32),Pa}function Ra(a,r,c){(a===Dn&&(Cn===2||Cn===9)||a.cancelPendingCommit!==null)&&(gl(a,0),Dr(a,xn,Pa,!1)),ce(a,c),((En&2)===0||a!==Dn)&&(a===Dn&&((En&2)===0&&(wi|=c),Hn===4&&Dr(a,xn,Pa,!1)),Rs(a))}function _v(a,r,c){if((En&6)!==0)throw Error(i(327));var f=!c&&(r&127)===0&&(r&a.expiredLanes)===0||At(a,r),b=f?FC(a,r):gh(a,r,!0),w=f;do{if(b===0){hl&&!f&&Dr(a,r,0,!1);break}else{if(c=a.current.alternate,w&&!OC(c)){b=gh(a,r,!1),w=!1;continue}if(b===2){if(w=r,a.errorRecoveryDisabledLanes&w)var q=0;else q=a.pendingLanes&-536870913,q=q!==0?q:q&536870912?536870912:0;if(q!==0){r=q;e:{var te=a;b=Ro;var je=te.current.memoizedState.isDehydrated;if(je&&(gl(te,q).flags|=256),q=gh(te,q,!1),q!==2){if(uh&&!je){te.errorRecoveryDisabledLanes|=w,wi|=w,b=4;break e}w=ka,ka=b,w!==null&&(ka===null?ka=w:ka.push.apply(ka,w))}b=q}if(w=!1,b!==2)continue}}if(b===1){gl(a,0),Dr(a,r,0,!0);break}e:{switch(f=a,w=b,w){case 0:case 1:throw Error(i(345));case 4:if((r&4194048)!==r)break;case 6:Dr(f,r,Pa,!Mr);break e;case 2:ka=null;break;case 3:case 5:break;default:throw Error(i(329))}if((r&62914560)===r&&(b=Mu+300-tt(),10<b)){if(Dr(f,r,Pa,!Mr),Qt(f,0,!0)!==0)break e;ir=r,f.timeoutHandle=a0(Cv.bind(null,f,c,ka,Ru,fh,r,Pa,wi,pl,Mr,w,"Throttled",-0,0),b);break e}Cv(f,c,ka,Ru,fh,r,Pa,wi,pl,Mr,w,null,-0,0)}}break}while(!0);Rs(a)}function Cv(a,r,c,f,b,w,q,te,je,Xe,ft,gt,Qe,rt){if(a.timeoutHandle=-1,gt=r.subtreeFlags,gt&8192||(gt&16785408)===16785408){gt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:De},xv(r,w,gt);var Ut=(w&62914560)===w?Mu-tt():(w&4194048)===w?Nv-tt():0;if(Ut=vA(gt,Ut),Ut!==null){ir=w,a.cancelPendingCommit=Ut(Lv.bind(null,a,r,w,c,f,b,q,te,je,ft,gt,null,Qe,rt)),Dr(a,w,q,!Xe);return}}Lv(a,r,w,c,f,b,q,te,je)}function OC(a){for(var r=a;;){var c=r.tag;if((c===0||c===11||c===15)&&r.flags&16384&&(c=r.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var f=0;f<c.length;f++){var b=c[f],w=b.getSnapshot;b=b.value;try{if(!Fa(w(),b))return!1}catch{return!1}}if(c=r.child,r.subtreeFlags&16384&&c!==null)c.return=r,r=c;else{if(r===a)break;for(;r.sibling===null;){if(r.return===null||r.return===a)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Dr(a,r,c,f){r&=~dh,r&=~wi,a.suspendedLanes|=r,a.pingedLanes&=~r,f&&(a.warmLanes|=r),f=a.expirationTimes;for(var b=r;0<b;){var w=31-Ce(b),q=1<<w;f[w]=-1,b&=~q}c!==0&&Te(a,c,r)}function Iu(){return(En&6)===0?(Do(0),!1):!0}function yh(){if(gn!==null){if(Cn===0)var a=gn.return;else a=gn,Xs=mi=null,Rm(a),ll=null,yo=0,a=gn;for(;a!==null;)sv(a.alternate,a),a=a.return;gn=null}}function gl(a,r){var c=a.timeoutHandle;c!==-1&&(a.timeoutHandle=-1,nA(c)),c=a.cancelPendingCommit,c!==null&&(a.cancelPendingCommit=null,c()),ir=0,yh(),Dn=a,gn=c=Gs(a.current,null),xn=r,Cn=0,qa=null,Mr=!1,hl=At(a,r),uh=!1,pl=Pa=dh=wi=kr=Hn=0,ka=Ro=null,fh=!1,(r&8)!==0&&(r|=r&32);var f=a.entangledLanes;if(f!==0)for(a=a.entanglements,f&=r;0<f;){var b=31-Ce(f),w=1<<b;r|=a[b],f&=~w}return rr=r,eu(),c}function Av(a,r){ln=null,L.H=jo,r===il||r===ou?(r=Hb(),Cn=3):r===vm?(r=Hb(),Cn=4):Cn=r===Km?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,qa=r,gn===null&&(Hn=1,wu(a,Qa(r,a.current)))}function Tv(){var a=Ba.current;return a===null?!0:(xn&4194048)===xn?ns===null:(xn&62914560)===xn||(xn&536870912)!==0?a===ns:!1}function Mv(){var a=L.H;return L.H=jo,a===null?jo:a}function kv(){var a=L.A;return L.A=DC,a}function Du(){Hn=4,Mr||(xn&4194048)!==xn&&Ba.current!==null||(hl=!0),(kr&134217727)===0&&(wi&134217727)===0||Dn===null||Dr(Dn,xn,Pa,!1)}function gh(a,r,c){var f=En;En|=2;var b=Mv(),w=kv();(Dn!==a||xn!==r)&&(Ru=null,gl(a,r)),r=!1;var q=Hn;e:do try{if(Cn!==0&&gn!==null){var te=gn,je=qa;switch(Cn){case 8:yh(),q=6;break e;case 3:case 2:case 9:case 6:Ba.current===null&&(r=!0);var Xe=Cn;if(Cn=0,qa=null,bl(a,te,je,Xe),c&&hl){q=0;break e}break;default:Xe=Cn,Cn=0,qa=null,bl(a,te,je,Xe)}}$C(),q=Hn;break}catch(ft){Av(a,ft)}while(!0);return r&&a.shellSuspendCounter++,Xs=mi=null,En=f,L.H=b,L.A=w,gn===null&&(Dn=null,xn=0,eu()),q}function $C(){for(;gn!==null;)Rv(gn)}function FC(a,r){var c=En;En|=2;var f=Mv(),b=kv();Dn!==a||xn!==r?(Ru=null,ku=tt()+500,gl(a,r)):hl=At(a,r);e:do try{if(Cn!==0&&gn!==null){r=gn;var w=qa;t:switch(Cn){case 1:Cn=0,qa=null,bl(a,r,w,1);break;case 2:case 9:if(qb(w)){Cn=0,qa=null,Iv(r);break}r=function(){Cn!==2&&Cn!==9||Dn!==a||(Cn=7),Rs(a)},w.then(r,r);break e;case 3:Cn=7;break e;case 4:Cn=5;break e;case 7:qb(w)?(Cn=0,qa=null,Iv(r)):(Cn=0,qa=null,bl(a,r,w,7));break;case 5:var q=null;switch(gn.tag){case 26:q=gn.memoizedState;case 5:case 27:var te=gn;if(q?b0(q):te.stateNode.complete){Cn=0,qa=null;var je=te.sibling;if(je!==null)gn=je;else{var Xe=te.return;Xe!==null?(gn=Xe,Lu(Xe)):gn=null}break t}}Cn=0,qa=null,bl(a,r,w,5);break;case 6:Cn=0,qa=null,bl(a,r,w,6);break;case 8:yh(),Hn=6;break e;default:throw Error(i(462))}}zC();break}catch(ft){Av(a,ft)}while(!0);return Xs=mi=null,L.H=f,L.A=b,En=c,gn!==null?0:(Dn=null,xn=0,eu(),Hn)}function zC(){for(;gn!==null&&!jt();)Rv(gn)}function Rv(a){var r=nv(a.alternate,a,rr);a.memoizedProps=a.pendingProps,r===null?Lu(a):gn=r}function Iv(a){var r=a,c=r.alternate;switch(r.tag){case 15:case 0:r=Wx(c,r,r.pendingProps,r.type,void 0,xn);break;case 11:r=Wx(c,r,r.pendingProps,r.type.render,r.ref,xn);break;case 5:Rm(r);default:sv(c,r),r=gn=kb(r,rr),r=nv(c,r,rr)}a.memoizedProps=a.pendingProps,r===null?Lu(a):gn=r}function bl(a,r,c,f){Xs=mi=null,Rm(r),ll=null,yo=0;var b=r.return;try{if(CC(a,b,r,c,xn)){Hn=1,wu(a,Qa(c,a.current)),gn=null;return}}catch(w){if(b!==null)throw gn=b,w;Hn=1,wu(a,Qa(c,a.current)),gn=null;return}r.flags&32768?(Sn||f===1?a=!0:hl||(xn&536870912)!==0?a=!1:(Mr=a=!0,(f===2||f===9||f===3||f===6)&&(f=Ba.current,f!==null&&f.tag===13&&(f.flags|=16384))),Dv(r,a)):Lu(r)}function Lu(a){var r=a;do{if((r.flags&32768)!==0){Dv(r,Mr);return}a=r.return;var c=MC(r.alternate,r,rr);if(c!==null){gn=c;return}if(r=r.sibling,r!==null){gn=r;return}gn=r=a}while(r!==null);Hn===0&&(Hn=5)}function Dv(a,r){do{var c=kC(a.alternate,a);if(c!==null){c.flags&=32767,gn=c;return}if(c=a.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!r&&(a=a.sibling,a!==null)){gn=a;return}gn=a=c}while(a!==null);Hn=6,gn=null}function Lv(a,r,c,f,b,w,q,te,je){a.cancelPendingCommit=null;do Ou();while(na!==0);if((En&6)!==0)throw Error(i(327));if(r!==null){if(r===a.current)throw Error(i(177));if(w=r.lanes|r.childLanes,w|=rm,Ae(a,c,w,q,te,je),a===Dn&&(gn=Dn=null,xn=0),yl=r,Ir=a,ir=c,mh=w,hh=b,jv=f,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,PC(mt,function(){return Bv(),null})):(a.callbackNode=null,a.callbackPriority=0),f=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||f){f=L.T,L.T=null,b=O.p,O.p=2,q=En,En|=4;try{RC(a,r,c)}finally{En=q,O.p=b,L.T=f}}na=1,Ov(),$v(),Fv()}}function Ov(){if(na===1){na=0;var a=Ir,r=yl,c=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||c){c=L.T,L.T=null;var f=O.p;O.p=2;var b=En;En|=4;try{yv(r,a);var w=Th,q=wb(a.containerInfo),te=w.focusedElem,je=w.selectionRange;if(q!==te&&te&&te.ownerDocument&&Sb(te.ownerDocument.documentElement,te)){if(je!==null&&em(te)){var Xe=je.start,ft=je.end;if(ft===void 0&&(ft=Xe),"selectionStart"in te)te.selectionStart=Xe,te.selectionEnd=Math.min(ft,te.value.length);else{var gt=te.ownerDocument||document,Qe=gt&&gt.defaultView||window;if(Qe.getSelection){var rt=Qe.getSelection(),Ut=te.textContent.length,Jt=Math.min(je.start,Ut),In=je.end===void 0?Jt:Math.min(je.end,Ut);!rt.extend&&Jt>In&&(q=In,In=Jt,Jt=q);var Fe=vb(te,Jt),Re=vb(te,In);if(Fe&&Re&&(rt.rangeCount!==1||rt.anchorNode!==Fe.node||rt.anchorOffset!==Fe.offset||rt.focusNode!==Re.node||rt.focusOffset!==Re.offset)){var Ge=gt.createRange();Ge.setStart(Fe.node,Fe.offset),rt.removeAllRanges(),Jt>In?(rt.addRange(Ge),rt.extend(Re.node,Re.offset)):(Ge.setEnd(Re.node,Re.offset),rt.addRange(Ge))}}}}for(gt=[],rt=te;rt=rt.parentNode;)rt.nodeType===1&&gt.push({element:rt,left:rt.scrollLeft,top:rt.scrollTop});for(typeof te.focus=="function"&&te.focus(),te=0;te<gt.length;te++){var yt=gt[te];yt.element.scrollLeft=yt.left,yt.element.scrollTop=yt.top}}Ku=!!Ah,Th=Ah=null}finally{En=b,O.p=f,L.T=c}}a.current=r,na=2}}function $v(){if(na===2){na=0;var a=Ir,r=yl,c=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||c){c=L.T,L.T=null;var f=O.p;O.p=2;var b=En;En|=4;try{dv(a,r.alternate,r)}finally{En=b,O.p=f,L.T=c}}na=3}}function Fv(){if(na===4||na===3){na=0,ve();var a=Ir,r=yl,c=ir,f=jv;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?na=5:(na=0,yl=Ir=null,zv(a,a.pendingLanes));var b=a.pendingLanes;if(b===0&&(Rr=null),We(c),r=r.stateNode,qe&&typeof qe.onCommitFiberRoot=="function")try{qe.onCommitFiberRoot(Ue,r,void 0,(r.current.flags&128)===128)}catch{}if(f!==null){r=L.T,b=O.p,O.p=2,L.T=null;try{for(var w=a.onRecoverableError,q=0;q<f.length;q++){var te=f[q];w(te.value,{componentStack:te.stack})}}finally{L.T=r,O.p=b}}(ir&3)!==0&&Ou(),Rs(a),b=a.pendingLanes,(c&261930)!==0&&(b&42)!==0?a===ph?Io++:(Io=0,ph=a):Io=0,Do(0)}}function zv(a,r){(a.pooledCacheLanes&=r)===0&&(r=a.pooledCache,r!=null&&(a.pooledCache=null,ho(r)))}function Ou(){return Ov(),$v(),Fv(),Bv()}function Bv(){if(na!==5)return!1;var a=Ir,r=mh;mh=0;var c=We(ir),f=L.T,b=O.p;try{O.p=32>c?32:c,L.T=null,c=hh,hh=null;var w=Ir,q=ir;if(na=0,yl=Ir=null,ir=0,(En&6)!==0)throw Error(i(331));var te=En;if(En|=4,Sv(w.current),bv(w,w.current,q,c),En=te,Do(0,!1),qe&&typeof qe.onPostCommitFiberRoot=="function")try{qe.onPostCommitFiberRoot(Ue,w)}catch{}return!0}finally{O.p=b,L.T=f,zv(a,r)}}function Uv(a,r,c){r=Qa(c,r),r=Gm(a.stateNode,r,2),a=_r(a,r,2),a!==null&&(ce(a,2),Rs(a))}function An(a,r,c){if(a.tag===3)Uv(a,a,c);else for(;r!==null;){if(r.tag===3){Uv(r,a,c);break}else if(r.tag===1){var f=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Rr===null||!Rr.has(f))){a=Qa(c,a),c=qx(2),f=_r(r,c,2),f!==null&&(Px(c,f,r,a),ce(f,2),Rs(f));break}}r=r.return}}function bh(a,r,c){var f=a.pingCache;if(f===null){f=a.pingCache=new LC;var b=new Set;f.set(r,b)}else b=f.get(r),b===void 0&&(b=new Set,f.set(r,b));b.has(c)||(uh=!0,b.add(c),a=BC.bind(null,a,r,c),r.then(a,a))}function BC(a,r,c){var f=a.pingCache;f!==null&&f.delete(r),a.pingedLanes|=a.suspendedLanes&c,a.warmLanes&=~c,Dn===a&&(xn&c)===c&&(Hn===4||Hn===3&&(xn&62914560)===xn&&300>tt()-Mu?(En&2)===0&&gl(a,0):dh|=c,pl===xn&&(pl=0)),Rs(a)}function qv(a,r){r===0&&(r=qt()),a=ui(a,r),a!==null&&(ce(a,r),Rs(a))}function UC(a){var r=a.memoizedState,c=0;r!==null&&(c=r.retryLane),qv(a,c)}function qC(a,r){var c=0;switch(a.tag){case 31:case 13:var f=a.stateNode,b=a.memoizedState;b!==null&&(c=b.retryLane);break;case 19:f=a.stateNode;break;case 22:f=a.stateNode._retryCache;break;default:throw Error(i(314))}f!==null&&f.delete(r),qv(a,c)}function PC(a,r){return ht(a,r)}var $u=null,xl=null,xh=!1,Fu=!1,vh=!1,Lr=0;function Rs(a){a!==xl&&a.next===null&&(xl===null?$u=xl=a:xl=xl.next=a),Fu=!0,xh||(xh=!0,VC())}function Do(a,r){if(!vh&&Fu){vh=!0;do for(var c=!1,f=$u;f!==null;){if(a!==0){var b=f.pendingLanes;if(b===0)var w=0;else{var q=f.suspendedLanes,te=f.pingedLanes;w=(1<<31-Ce(42|a)+1)-1,w&=b&~(q&~te),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(c=!0,Yv(f,w))}else w=xn,w=Qt(f,f===Dn?w:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(w&3)===0||At(f,w)||(c=!0,Yv(f,w));f=f.next}while(c);vh=!1}}function HC(){Pv()}function Pv(){Fu=xh=!1;var a=0;Lr!==0&&tA()&&(a=Lr);for(var r=tt(),c=null,f=$u;f!==null;){var b=f.next,w=Hv(f,r);w===0?(f.next=null,c===null?$u=b:c.next=b,b===null&&(xl=c)):(c=f,(a!==0||(w&3)!==0)&&(Fu=!0)),f=b}na!==0&&na!==5||Do(a),Lr!==0&&(Lr=0)}function Hv(a,r){for(var c=a.suspendedLanes,f=a.pingedLanes,b=a.expirationTimes,w=a.pendingLanes&-62914561;0<w;){var q=31-Ce(w),te=1<<q,je=b[q];je===-1?((te&c)===0||(te&f)!==0)&&(b[q]=kt(te,r)):je<=r&&(a.expiredLanes|=te),w&=~te}if(r=Dn,c=xn,c=Qt(a,a===r?c:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),f=a.callbackNode,c===0||a===r&&(Cn===2||Cn===9)||a.cancelPendingCommit!==null)return f!==null&&f!==null&&_t(f),a.callbackNode=null,a.callbackPriority=0;if((c&3)===0||At(a,c)){if(r=c&-c,r===a.callbackPriority)return r;switch(f!==null&&_t(f),We(c)){case 2:case 8:c=Ye;break;case 32:c=mt;break;case 268435456:c=J;break;default:c=mt}return f=Vv.bind(null,a),c=ht(c,f),a.callbackPriority=r,a.callbackNode=c,r}return f!==null&&f!==null&&_t(f),a.callbackPriority=2,a.callbackNode=null,2}function Vv(a,r){if(na!==0&&na!==5)return a.callbackNode=null,a.callbackPriority=0,null;var c=a.callbackNode;if(Ou()&&a.callbackNode!==c)return null;var f=xn;return f=Qt(a,a===Dn?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),f===0?null:(_v(a,f,r),Hv(a,tt()),a.callbackNode!=null&&a.callbackNode===c?Vv.bind(null,a):null)}function Yv(a,r){if(Ou())return null;_v(a,r,!0)}function VC(){aA(function(){(En&6)!==0?ht($e,HC):Pv()})}function Sh(){if(Lr===0){var a=sl;a===0&&(a=Ze,Ze<<=1,(Ze&261888)===0&&(Ze=256)),Lr=a}return Lr}function Gv(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:me(""+a)}function Kv(a,r){var c=r.ownerDocument.createElement("input");return c.name=r.name,c.value=r.value,a.id&&c.setAttribute("form",a.id),r.parentNode.insertBefore(c,r),a=new FormData(a),c.parentNode.removeChild(c),a}function YC(a,r,c,f,b){if(r==="submit"&&c&&c.stateNode===b){var w=Gv((b[ge]||null).action),q=f.submitter;q&&(r=(r=q[ge]||null)?Gv(r.formAction):q.getAttribute("formAction"),r!==null&&(w=r,q=null));var te=new Wc("action","action",null,f,b);a.push({event:te,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Lr!==0){var je=q?Kv(b,q):new FormData(b);Um(c,{pending:!0,data:je,method:b.method,action:w},null,je)}}else typeof w=="function"&&(te.preventDefault(),je=q?Kv(b,q):new FormData(b),Um(c,{pending:!0,data:je,method:b.method,action:w},w,je))},currentTarget:b}]})}}for(var wh=0;wh<sm.length;wh++){var Nh=sm[wh],GC=Nh.toLowerCase(),KC=Nh[0].toUpperCase()+Nh.slice(1);ys(GC,"on"+KC)}ys(Eb,"onAnimationEnd"),ys(_b,"onAnimationIteration"),ys(Cb,"onAnimationStart"),ys("dblclick","onDoubleClick"),ys("focusin","onFocus"),ys("focusout","onBlur"),ys(uC,"onTransitionRun"),ys(dC,"onTransitionStart"),ys(fC,"onTransitionCancel"),ys(Ab,"onTransitionEnd"),xe("onMouseEnter",["mouseout","mouseover"]),xe("onMouseLeave",["mouseout","mouseover"]),xe("onPointerEnter",["pointerout","pointerover"]),xe("onPointerLeave",["pointerout","pointerover"]),ee("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ee("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ee("onBeforeInput",["compositionend","keypress","textInput","paste"]),ee("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ee("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ee("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),XC=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Lo));function Xv(a,r){r=(r&4)!==0;for(var c=0;c<a.length;c++){var f=a[c],b=f.event;f=f.listeners;e:{var w=void 0;if(r)for(var q=f.length-1;0<=q;q--){var te=f[q],je=te.instance,Xe=te.currentTarget;if(te=te.listener,je!==w&&b.isPropagationStopped())break e;w=te,b.currentTarget=Xe;try{w(b)}catch(ft){Jc(ft)}b.currentTarget=null,w=je}else for(q=0;q<f.length;q++){if(te=f[q],je=te.instance,Xe=te.currentTarget,te=te.listener,je!==w&&b.isPropagationStopped())break e;w=te,b.currentTarget=Xe;try{w(b)}catch(ft){Jc(ft)}b.currentTarget=null,w=je}}}}function bn(a,r){var c=r[oe];c===void 0&&(c=r[oe]=new Set);var f=a+"__bubble";c.has(f)||(Wv(r,a,2,!1),c.add(f))}function jh(a,r,c){var f=0;r&&(f|=4),Wv(c,a,f,r)}var zu="_reactListening"+Math.random().toString(36).slice(2);function Eh(a){if(!a[zu]){a[zu]=!0,Je.forEach(function(c){c!=="selectionchange"&&(XC.has(c)||jh(c,!1,a),jh(c,!0,a))});var r=a.nodeType===9?a:a.ownerDocument;r===null||r[zu]||(r[zu]=!0,jh("selectionchange",!1,r))}}function Wv(a,r,c,f){switch(E0(r)){case 2:var b=NA;break;case 8:b=jA;break;default:b=Bh}c=b.bind(null,r,c,a),b=void 0,!en||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(b=!0),f?b!==void 0?a.addEventListener(r,c,{capture:!0,passive:b}):a.addEventListener(r,c,!0):b!==void 0?a.addEventListener(r,c,{passive:b}):a.addEventListener(r,c,!1)}function _h(a,r,c,f,b){var w=f;if((r&1)===0&&(r&2)===0&&f!==null)e:for(;;){if(f===null)return;var q=f.tag;if(q===3||q===4){var te=f.stateNode.containerInfo;if(te===b)break;if(q===4)for(q=f.return;q!==null;){var je=q.tag;if((je===3||je===4)&&q.stateNode.containerInfo===b)return;q=q.return}for(;te!==null;){if(q=nt(te),q===null)return;if(je=q.tag,je===5||je===6||je===26||je===27){f=w=q;continue e}te=te.parentNode}}f=f.return}Ht(function(){var Xe=w,ft=Zt(c),gt=[];e:{var Qe=Tb.get(a);if(Qe!==void 0){var rt=Wc,Ut=a;switch(a){case"keypress":if(As(c)===0)break e;case"keydown":case"keyup":rt=q_;break;case"focusin":Ut="focus",rt=Xf;break;case"focusout":Ut="blur",rt=Xf;break;case"beforeblur":case"afterblur":rt=Xf;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":rt=sb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":rt=M_;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":rt=V_;break;case Eb:case _b:case Cb:rt=I_;break;case Ab:rt=G_;break;case"scroll":case"scrollend":rt=A_;break;case"wheel":rt=X_;break;case"copy":case"cut":case"paste":rt=L_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":rt=ib;break;case"toggle":case"beforetoggle":rt=Z_}var Jt=(r&4)!==0,In=!Jt&&(a==="scroll"||a==="scrollend"),Fe=Jt?Qe!==null?Qe+"Capture":null:Qe;Jt=[];for(var Re=Xe,Ge;Re!==null;){var yt=Re;if(Ge=yt.stateNode,yt=yt.tag,yt!==5&&yt!==26&&yt!==27||Ge===null||Fe===null||(yt=tn(Re,Fe),yt!=null&&Jt.push(Oo(Re,yt,Ge))),In)break;Re=Re.return}0<Jt.length&&(Qe=new rt(Qe,Ut,null,c,ft),gt.push({event:Qe,listeners:Jt}))}}if((r&7)===0){e:{if(Qe=a==="mouseover"||a==="pointerover",rt=a==="mouseout"||a==="pointerout",Qe&&c!==Ot&&(Ut=c.relatedTarget||c.fromElement)&&(nt(Ut)||Ut[Pe]))break e;if((rt||Qe)&&(Qe=ft.window===ft?ft:(Qe=ft.ownerDocument)?Qe.defaultView||Qe.parentWindow:window,rt?(Ut=c.relatedTarget||c.toElement,rt=Xe,Ut=Ut?nt(Ut):null,Ut!==null&&(In=o(Ut),Jt=Ut.tag,Ut!==In||Jt!==5&&Jt!==27&&Jt!==6)&&(Ut=null)):(rt=null,Ut=Xe),rt!==Ut)){if(Jt=sb,yt="onMouseLeave",Fe="onMouseEnter",Re="mouse",(a==="pointerout"||a==="pointerover")&&(Jt=ib,yt="onPointerLeave",Fe="onPointerEnter",Re="pointer"),In=rt==null?Qe:lt(rt),Ge=Ut==null?Qe:lt(Ut),Qe=new Jt(yt,Re+"leave",rt,c,ft),Qe.target=In,Qe.relatedTarget=Ge,yt=null,nt(ft)===Xe&&(Jt=new Jt(Fe,Re+"enter",Ut,c,ft),Jt.target=Ge,Jt.relatedTarget=In,yt=Jt),In=yt,rt&&Ut)t:{for(Jt=WC,Fe=rt,Re=Ut,Ge=0,yt=Fe;yt;yt=Jt(yt))Ge++;yt=0;for(var Wt=Re;Wt;Wt=Jt(Wt))yt++;for(;0<Ge-yt;)Fe=Jt(Fe),Ge--;for(;0<yt-Ge;)Re=Jt(Re),yt--;for(;Ge--;){if(Fe===Re||Re!==null&&Fe===Re.alternate){Jt=Fe;break t}Fe=Jt(Fe),Re=Jt(Re)}Jt=null}else Jt=null;rt!==null&&Zv(gt,Qe,rt,Jt,!1),Ut!==null&&In!==null&&Zv(gt,In,Ut,Jt,!0)}}e:{if(Qe=Xe?lt(Xe):window,rt=Qe.nodeName&&Qe.nodeName.toLowerCase(),rt==="select"||rt==="input"&&Qe.type==="file")var wn=hb;else if(fb(Qe))if(pb)wn=lC;else{wn=rC;var Vt=sC}else rt=Qe.nodeName,!rt||rt.toLowerCase()!=="input"||Qe.type!=="checkbox"&&Qe.type!=="radio"?Xe&&ii(Xe.elementType)&&(wn=hb):wn=iC;if(wn&&(wn=wn(a,Xe))){mb(gt,wn,c,ft);break e}Vt&&Vt(a,Qe,Xe),a==="focusout"&&Xe&&Qe.type==="number"&&Xe.memoizedProps.value!=null&&ri(Qe,"number",Qe.value)}switch(Vt=Xe?lt(Xe):window,a){case"focusin":(fb(Vt)||Vt.contentEditable==="true")&&(Wi=Vt,tm=Xe,uo=null);break;case"focusout":uo=tm=Wi=null;break;case"mousedown":nm=!0;break;case"contextmenu":case"mouseup":case"dragend":nm=!1,Nb(gt,c,ft);break;case"selectionchange":if(cC)break;case"keydown":case"keyup":Nb(gt,c,ft)}var on;if(Zf)e:{switch(a){case"compositionstart":var vn="onCompositionStart";break e;case"compositionend":vn="onCompositionEnd";break e;case"compositionupdate":vn="onCompositionUpdate";break e}vn=void 0}else Xi?ub(a,c)&&(vn="onCompositionEnd"):a==="keydown"&&c.keyCode===229&&(vn="onCompositionStart");vn&&(lb&&c.locale!=="ko"&&(Xi||vn!=="onCompositionStart"?vn==="onCompositionEnd"&&Xi&&(on=ga()):(qn=ft,oa="value"in qn?qn.value:qn.textContent,Xi=!0)),Vt=Bu(Xe,vn),0<Vt.length&&(vn=new rb(vn,a,null,c,ft),gt.push({event:vn,listeners:Vt}),on?vn.data=on:(on=db(c),on!==null&&(vn.data=on)))),(on=J_?eC(a,c):tC(a,c))&&(vn=Bu(Xe,"onBeforeInput"),0<vn.length&&(Vt=new rb("onBeforeInput","beforeinput",null,c,ft),gt.push({event:Vt,listeners:vn}),Vt.data=on)),YC(gt,a,Xe,c,ft)}Xv(gt,r)})}function Oo(a,r,c){return{instance:a,listener:r,currentTarget:c}}function Bu(a,r){for(var c=r+"Capture",f=[];a!==null;){var b=a,w=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||w===null||(b=tn(a,c),b!=null&&f.unshift(Oo(a,b,w)),b=tn(a,r),b!=null&&f.push(Oo(a,b,w))),a.tag===3)return f;a=a.return}return[]}function WC(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function Zv(a,r,c,f,b){for(var w=r._reactName,q=[];c!==null&&c!==f;){var te=c,je=te.alternate,Xe=te.stateNode;if(te=te.tag,je!==null&&je===f)break;te!==5&&te!==26&&te!==27||Xe===null||(je=Xe,b?(Xe=tn(c,w),Xe!=null&&q.unshift(Oo(c,Xe,je))):b||(Xe=tn(c,w),Xe!=null&&q.push(Oo(c,Xe,je)))),c=c.return}q.length!==0&&a.push({event:r,listeners:q})}var ZC=/\r\n?/g,QC=/\u0000|\uFFFD/g;function Qv(a){return(typeof a=="string"?a:""+a).replace(ZC,`
`).replace(QC,"")}function Jv(a,r){return r=Qv(r),Qv(a)===r}function Rn(a,r,c,f,b,w){switch(c){case"children":typeof f=="string"?r==="body"||r==="textarea"&&f===""||Ea(a,f):(typeof f=="number"||typeof f=="bigint")&&r!=="body"&&Ea(a,""+f);break;case"className":Pt(a,"class",f);break;case"tabIndex":Pt(a,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Pt(a,c,f);break;case"style":Ki(a,f,w);break;case"data":if(r!=="object"){Pt(a,"data",f);break}case"src":case"href":if(f===""&&(r!=="a"||c!=="href")){a.removeAttribute(c);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){a.removeAttribute(c);break}f=me(""+f),a.setAttribute(c,f);break;case"action":case"formAction":if(typeof f=="function"){a.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(c==="formAction"?(r!=="input"&&Rn(a,r,"name",b.name,b,null),Rn(a,r,"formEncType",b.formEncType,b,null),Rn(a,r,"formMethod",b.formMethod,b,null),Rn(a,r,"formTarget",b.formTarget,b,null)):(Rn(a,r,"encType",b.encType,b,null),Rn(a,r,"method",b.method,b,null),Rn(a,r,"target",b.target,b,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){a.removeAttribute(c);break}f=me(""+f),a.setAttribute(c,f);break;case"onClick":f!=null&&(a.onclick=De);break;case"onScroll":f!=null&&bn("scroll",a);break;case"onScrollEnd":f!=null&&bn("scrollend",a);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(i(61));if(c=f.__html,c!=null){if(b.children!=null)throw Error(i(60));a.innerHTML=c}}break;case"multiple":a.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":a.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){a.removeAttribute("xlink:href");break}c=me(""+f),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(c,""+f):a.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(c,""):a.removeAttribute(c);break;case"capture":case"download":f===!0?a.setAttribute(c,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(c,f):a.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?a.setAttribute(c,f):a.removeAttribute(c);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?a.removeAttribute(c):a.setAttribute(c,f);break;case"popover":bn("beforetoggle",a),bn("toggle",a),nn(a,"popover",f);break;case"xlinkActuate":Ft(a,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Ft(a,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Ft(a,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Ft(a,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Ft(a,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Ft(a,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Ft(a,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Ft(a,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Ft(a,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":nn(a,"is",f);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=no.get(c)||c,nn(a,c,f))}}function Ch(a,r,c,f,b,w){switch(c){case"style":Ki(a,f,w);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(i(61));if(c=f.__html,c!=null){if(b.children!=null)throw Error(i(60));a.innerHTML=c}}break;case"children":typeof f=="string"?Ea(a,f):(typeof f=="number"||typeof f=="bigint")&&Ea(a,""+f);break;case"onScroll":f!=null&&bn("scroll",a);break;case"onScrollEnd":f!=null&&bn("scrollend",a);break;case"onClick":f!=null&&(a.onclick=De);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!St.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(b=c.endsWith("Capture"),r=c.slice(2,b?c.length-7:void 0),w=a[ge]||null,w=w!=null?w[c]:null,typeof w=="function"&&a.removeEventListener(r,w,b),typeof f=="function")){typeof w!="function"&&w!==null&&(c in a?a[c]=null:a.hasAttribute(c)&&a.removeAttribute(c)),a.addEventListener(r,f,b);break e}c in a?a[c]=f:f===!0?a.setAttribute(c,""):nn(a,c,f)}}}function fa(a,r,c){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":bn("error",a),bn("load",a);var f=!1,b=!1,w;for(w in c)if(c.hasOwnProperty(w)){var q=c[w];if(q!=null)switch(w){case"src":f=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:Rn(a,r,w,q,c,null)}}b&&Rn(a,r,"srcSet",c.srcSet,c,null),f&&Rn(a,r,"src",c.src,c,null);return;case"input":bn("invalid",a);var te=w=q=b=null,je=null,Xe=null;for(f in c)if(c.hasOwnProperty(f)){var ft=c[f];if(ft!=null)switch(f){case"name":b=ft;break;case"type":q=ft;break;case"checked":je=ft;break;case"defaultChecked":Xe=ft;break;case"value":w=ft;break;case"defaultValue":te=ft;break;case"children":case"dangerouslySetInnerHTML":if(ft!=null)throw Error(i(137,r));break;default:Rn(a,r,f,ft,c,null)}}xr(a,w,te,je,Xe,q,b,!1);return;case"select":bn("invalid",a),f=q=w=null;for(b in c)if(c.hasOwnProperty(b)&&(te=c[b],te!=null))switch(b){case"value":w=te;break;case"defaultValue":q=te;break;case"multiple":f=te;default:Rn(a,r,b,te,c,null)}r=w,c=q,a.multiple=!!f,r!=null?ps(a,!!f,r,!1):c!=null&&ps(a,!!f,c,!0);return;case"textarea":bn("invalid",a),w=b=f=null;for(q in c)if(c.hasOwnProperty(q)&&(te=c[q],te!=null))switch(q){case"value":f=te;break;case"defaultValue":b=te;break;case"children":w=te;break;case"dangerouslySetInnerHTML":if(te!=null)throw Error(i(91));break;default:Rn(a,r,q,te,c,null)}Ys(a,f,b,w);return;case"option":for(je in c)if(c.hasOwnProperty(je)&&(f=c[je],f!=null))switch(je){case"selected":a.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:Rn(a,r,je,f,c,null)}return;case"dialog":bn("beforetoggle",a),bn("toggle",a),bn("cancel",a),bn("close",a);break;case"iframe":case"object":bn("load",a);break;case"video":case"audio":for(f=0;f<Lo.length;f++)bn(Lo[f],a);break;case"image":bn("error",a),bn("load",a);break;case"details":bn("toggle",a);break;case"embed":case"source":case"link":bn("error",a),bn("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Xe in c)if(c.hasOwnProperty(Xe)&&(f=c[Xe],f!=null))switch(Xe){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:Rn(a,r,Xe,f,c,null)}return;default:if(ii(r)){for(ft in c)c.hasOwnProperty(ft)&&(f=c[ft],f!==void 0&&Ch(a,r,ft,f,c,void 0));return}}for(te in c)c.hasOwnProperty(te)&&(f=c[te],f!=null&&Rn(a,r,te,f,c,null))}function JC(a,r,c,f){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,w=null,q=null,te=null,je=null,Xe=null,ft=null;for(rt in c){var gt=c[rt];if(c.hasOwnProperty(rt)&&gt!=null)switch(rt){case"checked":break;case"value":break;case"defaultValue":je=gt;default:f.hasOwnProperty(rt)||Rn(a,r,rt,null,f,gt)}}for(var Qe in f){var rt=f[Qe];if(gt=c[Qe],f.hasOwnProperty(Qe)&&(rt!=null||gt!=null))switch(Qe){case"type":w=rt;break;case"name":b=rt;break;case"checked":Xe=rt;break;case"defaultChecked":ft=rt;break;case"value":q=rt;break;case"defaultValue":te=rt;break;case"children":case"dangerouslySetInnerHTML":if(rt!=null)throw Error(i(137,r));break;default:rt!==gt&&Rn(a,r,Qe,rt,f,gt)}}hs(a,q,te,je,Xe,ft,w,b);return;case"select":rt=q=te=Qe=null;for(w in c)if(je=c[w],c.hasOwnProperty(w)&&je!=null)switch(w){case"value":break;case"multiple":rt=je;default:f.hasOwnProperty(w)||Rn(a,r,w,null,f,je)}for(b in f)if(w=f[b],je=c[b],f.hasOwnProperty(b)&&(w!=null||je!=null))switch(b){case"value":Qe=w;break;case"defaultValue":te=w;break;case"multiple":q=w;default:w!==je&&Rn(a,r,b,w,f,je)}r=te,c=q,f=rt,Qe!=null?ps(a,!!c,Qe,!1):!!f!=!!c&&(r!=null?ps(a,!!c,r,!0):ps(a,!!c,c?[]:"",!1));return;case"textarea":rt=Qe=null;for(te in c)if(b=c[te],c.hasOwnProperty(te)&&b!=null&&!f.hasOwnProperty(te))switch(te){case"value":break;case"children":break;default:Rn(a,r,te,null,f,b)}for(q in f)if(b=f[q],w=c[q],f.hasOwnProperty(q)&&(b!=null||w!=null))switch(q){case"value":Qe=b;break;case"defaultValue":rt=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(i(91));break;default:b!==w&&Rn(a,r,q,b,f,w)}Un(a,Qe,rt);return;case"option":for(var Ut in c)if(Qe=c[Ut],c.hasOwnProperty(Ut)&&Qe!=null&&!f.hasOwnProperty(Ut))switch(Ut){case"selected":a.selected=!1;break;default:Rn(a,r,Ut,null,f,Qe)}for(je in f)if(Qe=f[je],rt=c[je],f.hasOwnProperty(je)&&Qe!==rt&&(Qe!=null||rt!=null))switch(je){case"selected":a.selected=Qe&&typeof Qe!="function"&&typeof Qe!="symbol";break;default:Rn(a,r,je,Qe,f,rt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Jt in c)Qe=c[Jt],c.hasOwnProperty(Jt)&&Qe!=null&&!f.hasOwnProperty(Jt)&&Rn(a,r,Jt,null,f,Qe);for(Xe in f)if(Qe=f[Xe],rt=c[Xe],f.hasOwnProperty(Xe)&&Qe!==rt&&(Qe!=null||rt!=null))switch(Xe){case"children":case"dangerouslySetInnerHTML":if(Qe!=null)throw Error(i(137,r));break;default:Rn(a,r,Xe,Qe,f,rt)}return;default:if(ii(r)){for(var In in c)Qe=c[In],c.hasOwnProperty(In)&&Qe!==void 0&&!f.hasOwnProperty(In)&&Ch(a,r,In,void 0,f,Qe);for(ft in f)Qe=f[ft],rt=c[ft],!f.hasOwnProperty(ft)||Qe===rt||Qe===void 0&&rt===void 0||Ch(a,r,ft,Qe,f,rt);return}}for(var Fe in c)Qe=c[Fe],c.hasOwnProperty(Fe)&&Qe!=null&&!f.hasOwnProperty(Fe)&&Rn(a,r,Fe,null,f,Qe);for(gt in f)Qe=f[gt],rt=c[gt],!f.hasOwnProperty(gt)||Qe===rt||Qe==null&&rt==null||Rn(a,r,gt,Qe,f,rt)}function e0(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function eA(){if(typeof performance.getEntriesByType=="function"){for(var a=0,r=0,c=performance.getEntriesByType("resource"),f=0;f<c.length;f++){var b=c[f],w=b.transferSize,q=b.initiatorType,te=b.duration;if(w&&te&&e0(q)){for(q=0,te=b.responseEnd,f+=1;f<c.length;f++){var je=c[f],Xe=je.startTime;if(Xe>te)break;var ft=je.transferSize,gt=je.initiatorType;ft&&e0(gt)&&(je=je.responseEnd,q+=ft*(je<te?1:(te-Xe)/(je-Xe)))}if(--f,r+=8*(w+q)/(b.duration/1e3),a++,10<a)break}}if(0<a)return r/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var Ah=null,Th=null;function Uu(a){return a.nodeType===9?a:a.ownerDocument}function t0(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function n0(a,r){if(a===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&r==="foreignObject"?0:a}function Mh(a,r){return a==="textarea"||a==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var kh=null;function tA(){var a=window.event;return a&&a.type==="popstate"?a===kh?!1:(kh=a,!0):(kh=null,!1)}var a0=typeof setTimeout=="function"?setTimeout:void 0,nA=typeof clearTimeout=="function"?clearTimeout:void 0,s0=typeof Promise=="function"?Promise:void 0,aA=typeof queueMicrotask=="function"?queueMicrotask:typeof s0<"u"?function(a){return s0.resolve(null).then(a).catch(sA)}:a0;function sA(a){setTimeout(function(){throw a})}function Or(a){return a==="head"}function r0(a,r){var c=r,f=0;do{var b=c.nextSibling;if(a.removeChild(c),b&&b.nodeType===8)if(c=b.data,c==="/$"||c==="/&"){if(f===0){a.removeChild(b),Nl(r);return}f--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")f++;else if(c==="html")$o(a.ownerDocument.documentElement);else if(c==="head"){c=a.ownerDocument.head,$o(c);for(var w=c.firstChild;w;){var q=w.nextSibling,te=w.nodeName;w[de]||te==="SCRIPT"||te==="STYLE"||te==="LINK"&&w.rel.toLowerCase()==="stylesheet"||c.removeChild(w),w=q}}else c==="body"&&$o(a.ownerDocument.body);c=b}while(c);Nl(r)}function i0(a,r){var c=a;a=0;do{var f=c.nextSibling;if(c.nodeType===1?r?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(r?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),f&&f.nodeType===8)if(c=f.data,c==="/$"){if(a===0)break;a--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||a++;c=f}while(c)}function Rh(a){var r=a.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var c=r;switch(r=r.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Rh(c),it(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}a.removeChild(c)}}function rA(a,r,c,f){for(;a.nodeType===1;){var b=c;if(a.nodeName.toLowerCase()!==r.toLowerCase()){if(!f&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(f){if(!a[de])switch(r){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(w=a.getAttribute("rel"),w==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(w!==b.rel||a.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||a.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||a.getAttribute("title")!==(b.title==null?null:b.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(w=a.getAttribute("src"),(w!==(b.src==null?null:b.src)||a.getAttribute("type")!==(b.type==null?null:b.type)||a.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&w&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(r==="input"&&a.type==="hidden"){var w=b.name==null?null:""+b.name;if(b.type==="hidden"&&a.getAttribute("name")===w)return a}else return a;if(a=as(a.nextSibling),a===null)break}return null}function iA(a,r,c){if(r==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!c||(a=as(a.nextSibling),a===null))return null;return a}function l0(a,r){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!r||(a=as(a.nextSibling),a===null))return null;return a}function Ih(a){return a.data==="$?"||a.data==="$~"}function Dh(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function lA(a,r){var c=a.ownerDocument;if(a.data==="$~")a._reactRetry=r;else if(a.data!=="$?"||c.readyState!=="loading")r();else{var f=function(){r(),c.removeEventListener("DOMContentLoaded",f)};c.addEventListener("DOMContentLoaded",f),a._reactRetry=f}}function as(a){for(;a!=null;a=a.nextSibling){var r=a.nodeType;if(r===1||r===3)break;if(r===8){if(r=a.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return a}var Lh=null;function o0(a){a=a.nextSibling;for(var r=0;a;){if(a.nodeType===8){var c=a.data;if(c==="/$"||c==="/&"){if(r===0)return as(a.nextSibling);r--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||r++}a=a.nextSibling}return null}function c0(a){a=a.previousSibling;for(var r=0;a;){if(a.nodeType===8){var c=a.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(r===0)return a;r--}else c!=="/$"&&c!=="/&"||r++}a=a.previousSibling}return null}function u0(a,r,c){switch(r=Uu(c),a){case"html":if(a=r.documentElement,!a)throw Error(i(452));return a;case"head":if(a=r.head,!a)throw Error(i(453));return a;case"body":if(a=r.body,!a)throw Error(i(454));return a;default:throw Error(i(451))}}function $o(a){for(var r=a.attributes;r.length;)a.removeAttributeNode(r[0]);it(a)}var ss=new Map,d0=new Set;function qu(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var lr=O.d;O.d={f:oA,r:cA,D:uA,C:dA,L:fA,m:mA,X:pA,S:hA,M:yA};function oA(){var a=lr.f(),r=Iu();return a||r}function cA(a){var r=vt(a);r!==null&&r.tag===5&&r.type==="form"?Ax(r):lr.r(a)}var vl=typeof document>"u"?null:document;function f0(a,r,c){var f=vl;if(f&&typeof r=="string"&&r){var b=ta(r);b='link[rel="'+a+'"][href="'+b+'"]',typeof c=="string"&&(b+='[crossorigin="'+c+'"]'),d0.has(b)||(d0.add(b),a={rel:a,crossOrigin:c,href:r},f.querySelector(b)===null&&(r=f.createElement("link"),fa(r,"link",a),He(r),f.head.appendChild(r)))}}function uA(a){lr.D(a),f0("dns-prefetch",a,null)}function dA(a,r){lr.C(a,r),f0("preconnect",a,r)}function fA(a,r,c){lr.L(a,r,c);var f=vl;if(f&&a&&r){var b='link[rel="preload"][as="'+ta(r)+'"]';r==="image"&&c&&c.imageSrcSet?(b+='[imagesrcset="'+ta(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(b+='[imagesizes="'+ta(c.imageSizes)+'"]')):b+='[href="'+ta(a)+'"]';var w=b;switch(r){case"style":w=Sl(a);break;case"script":w=wl(a)}ss.has(w)||(a=g({rel:"preload",href:r==="image"&&c&&c.imageSrcSet?void 0:a,as:r},c),ss.set(w,a),f.querySelector(b)!==null||r==="style"&&f.querySelector(Fo(w))||r==="script"&&f.querySelector(zo(w))||(r=f.createElement("link"),fa(r,"link",a),He(r),f.head.appendChild(r)))}}function mA(a,r){lr.m(a,r);var c=vl;if(c&&a){var f=r&&typeof r.as=="string"?r.as:"script",b='link[rel="modulepreload"][as="'+ta(f)+'"][href="'+ta(a)+'"]',w=b;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=wl(a)}if(!ss.has(w)&&(a=g({rel:"modulepreload",href:a},r),ss.set(w,a),c.querySelector(b)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(zo(w)))return}f=c.createElement("link"),fa(f,"link",a),He(f),c.head.appendChild(f)}}}function hA(a,r,c){lr.S(a,r,c);var f=vl;if(f&&a){var b=wt(f).hoistableStyles,w=Sl(a);r=r||"default";var q=b.get(w);if(!q){var te={loading:0,preload:null};if(q=f.querySelector(Fo(w)))te.loading=5;else{a=g({rel:"stylesheet",href:a,"data-precedence":r},c),(c=ss.get(w))&&Oh(a,c);var je=q=f.createElement("link");He(je),fa(je,"link",a),je._p=new Promise(function(Xe,ft){je.onload=Xe,je.onerror=ft}),je.addEventListener("load",function(){te.loading|=1}),je.addEventListener("error",function(){te.loading|=2}),te.loading|=4,Pu(q,r,f)}q={type:"stylesheet",instance:q,count:1,state:te},b.set(w,q)}}}function pA(a,r){lr.X(a,r);var c=vl;if(c&&a){var f=wt(c).hoistableScripts,b=wl(a),w=f.get(b);w||(w=c.querySelector(zo(b)),w||(a=g({src:a,async:!0},r),(r=ss.get(b))&&$h(a,r),w=c.createElement("script"),He(w),fa(w,"link",a),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(b,w))}}function yA(a,r){lr.M(a,r);var c=vl;if(c&&a){var f=wt(c).hoistableScripts,b=wl(a),w=f.get(b);w||(w=c.querySelector(zo(b)),w||(a=g({src:a,async:!0,type:"module"},r),(r=ss.get(b))&&$h(a,r),w=c.createElement("script"),He(w),fa(w,"link",a),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(b,w))}}function m0(a,r,c,f){var b=(b=W.current)?qu(b):null;if(!b)throw Error(i(446));switch(a){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(r=Sl(c.href),c=wt(b).hoistableStyles,f=c.get(r),f||(f={type:"style",instance:null,count:0,state:null},c.set(r,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){a=Sl(c.href);var w=wt(b).hoistableStyles,q=w.get(a);if(q||(b=b.ownerDocument||b,q={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(a,q),(w=b.querySelector(Fo(a)))&&!w._p&&(q.instance=w,q.state.loading=5),ss.has(a)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},ss.set(a,c),w||gA(b,a,c,q.state))),r&&f===null)throw Error(i(528,""));return q}if(r&&f!==null)throw Error(i(529,""));return null;case"script":return r=c.async,c=c.src,typeof c=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=wl(c),c=wt(b).hoistableScripts,f=c.get(r),f||(f={type:"script",instance:null,count:0,state:null},c.set(r,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,a))}}function Sl(a){return'href="'+ta(a)+'"'}function Fo(a){return'link[rel="stylesheet"]['+a+"]"}function h0(a){return g({},a,{"data-precedence":a.precedence,precedence:null})}function gA(a,r,c,f){a.querySelector('link[rel="preload"][as="style"]['+r+"]")?f.loading=1:(r=a.createElement("link"),f.preload=r,r.addEventListener("load",function(){return f.loading|=1}),r.addEventListener("error",function(){return f.loading|=2}),fa(r,"link",c),He(r),a.head.appendChild(r))}function wl(a){return'[src="'+ta(a)+'"]'}function zo(a){return"script[async]"+a}function p0(a,r,c){if(r.count++,r.instance===null)switch(r.type){case"style":var f=a.querySelector('style[data-href~="'+ta(c.href)+'"]');if(f)return r.instance=f,He(f),f;var b=g({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return f=(a.ownerDocument||a).createElement("style"),He(f),fa(f,"style",b),Pu(f,c.precedence,a),r.instance=f;case"stylesheet":b=Sl(c.href);var w=a.querySelector(Fo(b));if(w)return r.state.loading|=4,r.instance=w,He(w),w;f=h0(c),(b=ss.get(b))&&Oh(f,b),w=(a.ownerDocument||a).createElement("link"),He(w);var q=w;return q._p=new Promise(function(te,je){q.onload=te,q.onerror=je}),fa(w,"link",f),r.state.loading|=4,Pu(w,c.precedence,a),r.instance=w;case"script":return w=wl(c.src),(b=a.querySelector(zo(w)))?(r.instance=b,He(b),b):(f=c,(b=ss.get(w))&&(f=g({},c),$h(f,b)),a=a.ownerDocument||a,b=a.createElement("script"),He(b),fa(b,"link",f),a.head.appendChild(b),r.instance=b);case"void":return null;default:throw Error(i(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(f=r.instance,r.state.loading|=4,Pu(f,c.precedence,a));return r.instance}function Pu(a,r,c){for(var f=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=f.length?f[f.length-1]:null,w=b,q=0;q<f.length;q++){var te=f[q];if(te.dataset.precedence===r)w=te;else if(w!==b)break}w?w.parentNode.insertBefore(a,w.nextSibling):(r=c.nodeType===9?c.head:c,r.insertBefore(a,r.firstChild))}function Oh(a,r){a.crossOrigin==null&&(a.crossOrigin=r.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=r.referrerPolicy),a.title==null&&(a.title=r.title)}function $h(a,r){a.crossOrigin==null&&(a.crossOrigin=r.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=r.referrerPolicy),a.integrity==null&&(a.integrity=r.integrity)}var Hu=null;function y0(a,r,c){if(Hu===null){var f=new Map,b=Hu=new Map;b.set(c,f)}else b=Hu,f=b.get(c),f||(f=new Map,b.set(c,f));if(f.has(a))return f;for(f.set(a,null),c=c.getElementsByTagName(a),b=0;b<c.length;b++){var w=c[b];if(!(w[de]||w[_e]||a==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var q=w.getAttribute(r)||"";q=a+q;var te=f.get(q);te?te.push(w):f.set(q,[w])}}return f}function g0(a,r,c){a=a.ownerDocument||a,a.head.insertBefore(c,r==="title"?a.querySelector("head > title"):null)}function bA(a,r,c){if(c===1||r.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;switch(r.rel){case"stylesheet":return a=r.disabled,typeof r.precedence=="string"&&a==null;default:return!0}case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function b0(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function xA(a,r,c,f){if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var b=Sl(f.href),w=r.querySelector(Fo(b));if(w){r=w._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(a.count++,a=Vu.bind(a),r.then(a,a)),c.state.loading|=4,c.instance=w,He(w);return}w=r.ownerDocument||r,f=h0(f),(b=ss.get(b))&&Oh(f,b),w=w.createElement("link"),He(w);var q=w;q._p=new Promise(function(te,je){q.onload=te,q.onerror=je}),fa(w,"link",f),c.instance=w}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(c,r),(r=c.state.preload)&&(c.state.loading&3)===0&&(a.count++,c=Vu.bind(a),r.addEventListener("load",c),r.addEventListener("error",c))}}var Fh=0;function vA(a,r){return a.stylesheets&&a.count===0&&Gu(a,a.stylesheets),0<a.count||0<a.imgCount?function(c){var f=setTimeout(function(){if(a.stylesheets&&Gu(a,a.stylesheets),a.unsuspend){var w=a.unsuspend;a.unsuspend=null,w()}},6e4+r);0<a.imgBytes&&Fh===0&&(Fh=62500*eA());var b=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&Gu(a,a.stylesheets),a.unsuspend)){var w=a.unsuspend;a.unsuspend=null,w()}},(a.imgBytes>Fh?50:800)+r);return a.unsuspend=c,function(){a.unsuspend=null,clearTimeout(f),clearTimeout(b)}}:null}function Vu(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Gu(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Yu=null;function Gu(a,r){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Yu=new Map,r.forEach(SA,a),Yu=null,Vu.call(a))}function SA(a,r){if(!(r.state.loading&4)){var c=Yu.get(a);if(c)var f=c.get(null);else{c=new Map,Yu.set(a,c);for(var b=a.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<b.length;w++){var q=b[w];(q.nodeName==="LINK"||q.getAttribute("media")!=="not all")&&(c.set(q.dataset.precedence,q),f=q)}f&&c.set(null,f)}b=r.instance,q=b.getAttribute("data-precedence"),w=c.get(q)||f,w===f&&c.set(null,b),c.set(q,b),this.count++,f=Vu.bind(this),b.addEventListener("load",f),b.addEventListener("error",f),w?w.parentNode.insertBefore(b,w.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(b,a.firstChild)),r.state.loading|=4}}var Bo={$$typeof:T,Provider:null,Consumer:null,_currentValue:$,_currentValue2:$,_threadCount:0};function wA(a,r,c,f,b,w,q,te,je){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Lt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Lt(0),this.hiddenUpdates=Lt(null),this.identifierPrefix=f,this.onUncaughtError=b,this.onCaughtError=w,this.onRecoverableError=q,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=je,this.incompleteTransitions=new Map}function x0(a,r,c,f,b,w,q,te,je,Xe,ft,gt){return a=new wA(a,r,c,q,je,Xe,ft,gt,te),r=1,w===!0&&(r|=24),w=za(3,null,null,r),a.current=w,w.stateNode=a,r=gm(),r.refCount++,a.pooledCache=r,r.refCount++,w.memoizedState={element:f,isDehydrated:c,cache:r},Sm(w),a}function v0(a){return a?(a=Ji,a):Ji}function S0(a,r,c,f,b,w){b=v0(b),f.context===null?f.context=b:f.pendingContext=b,f=Er(r),f.payload={element:c},w=w===void 0?null:w,w!==null&&(f.callback=w),c=_r(a,f,r),c!==null&&(Ra(c,a,r),bo(c,a,r))}function w0(a,r){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var c=a.retryLane;a.retryLane=c!==0&&c<r?c:r}}function zh(a,r){w0(a,r),(a=a.alternate)&&w0(a,r)}function N0(a){if(a.tag===13||a.tag===31){var r=ui(a,67108864);r!==null&&Ra(r,a,67108864),zh(a,67108864)}}function j0(a){if(a.tag===13||a.tag===31){var r=Ha();r=Be(r);var c=ui(a,r);c!==null&&Ra(c,a,r),zh(a,r)}}var Ku=!0;function NA(a,r,c,f){var b=L.T;L.T=null;var w=O.p;try{O.p=2,Bh(a,r,c,f)}finally{O.p=w,L.T=b}}function jA(a,r,c,f){var b=L.T;L.T=null;var w=O.p;try{O.p=8,Bh(a,r,c,f)}finally{O.p=w,L.T=b}}function Bh(a,r,c,f){if(Ku){var b=Uh(f);if(b===null)_h(a,r,f,Xu,c),_0(a,f);else if(_A(b,a,r,c,f))f.stopPropagation();else if(_0(a,f),r&4&&-1<EA.indexOf(a)){for(;b!==null;){var w=vt(b);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var q=$t(w.pendingLanes);if(q!==0){var te=w;for(te.pendingLanes|=2,te.entangledLanes|=2;q;){var je=1<<31-Ce(q);te.entanglements[1]|=je,q&=~je}Rs(w),(En&6)===0&&(ku=tt()+500,Do(0))}}break;case 31:case 13:te=ui(w,2),te!==null&&Ra(te,w,2),Iu(),zh(w,2)}if(w=Uh(f),w===null&&_h(a,r,f,Xu,c),w===b)break;b=w}b!==null&&f.stopPropagation()}else _h(a,r,f,null,c)}}function Uh(a){return a=Zt(a),qh(a)}var Xu=null;function qh(a){if(Xu=null,a=nt(a),a!==null){var r=o(a);if(r===null)a=null;else{var c=r.tag;if(c===13){if(a=d(r),a!==null)return a;a=null}else if(c===31){if(a=m(r),a!==null)return a;a=null}else if(c===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;a=null}else r!==a&&(a=null)}}return Xu=a,null}function E0(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(st()){case $e:return 2;case Ye:return 8;case mt:case ie:return 32;case J:return 268435456;default:return 32}default:return 32}}var Ph=!1,$r=null,Fr=null,zr=null,Uo=new Map,qo=new Map,Br=[],EA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function _0(a,r){switch(a){case"focusin":case"focusout":$r=null;break;case"dragenter":case"dragleave":Fr=null;break;case"mouseover":case"mouseout":zr=null;break;case"pointerover":case"pointerout":Uo.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":qo.delete(r.pointerId)}}function Po(a,r,c,f,b,w){return a===null||a.nativeEvent!==w?(a={blockedOn:r,domEventName:c,eventSystemFlags:f,nativeEvent:w,targetContainers:[b]},r!==null&&(r=vt(r),r!==null&&N0(r)),a):(a.eventSystemFlags|=f,r=a.targetContainers,b!==null&&r.indexOf(b)===-1&&r.push(b),a)}function _A(a,r,c,f,b){switch(r){case"focusin":return $r=Po($r,a,r,c,f,b),!0;case"dragenter":return Fr=Po(Fr,a,r,c,f,b),!0;case"mouseover":return zr=Po(zr,a,r,c,f,b),!0;case"pointerover":var w=b.pointerId;return Uo.set(w,Po(Uo.get(w)||null,a,r,c,f,b)),!0;case"gotpointercapture":return w=b.pointerId,qo.set(w,Po(qo.get(w)||null,a,r,c,f,b)),!0}return!1}function C0(a){var r=nt(a.target);if(r!==null){var c=o(r);if(c!==null){if(r=c.tag,r===13){if(r=d(c),r!==null){a.blockedOn=r,Z(a.priority,function(){j0(c)});return}}else if(r===31){if(r=m(c),r!==null){a.blockedOn=r,Z(a.priority,function(){j0(c)});return}}else if(r===3&&c.stateNode.current.memoizedState.isDehydrated){a.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Wu(a){if(a.blockedOn!==null)return!1;for(var r=a.targetContainers;0<r.length;){var c=Uh(a.nativeEvent);if(c===null){c=a.nativeEvent;var f=new c.constructor(c.type,c);Ot=f,c.target.dispatchEvent(f),Ot=null}else return r=vt(c),r!==null&&N0(r),a.blockedOn=c,!1;r.shift()}return!0}function A0(a,r,c){Wu(a)&&c.delete(r)}function CA(){Ph=!1,$r!==null&&Wu($r)&&($r=null),Fr!==null&&Wu(Fr)&&(Fr=null),zr!==null&&Wu(zr)&&(zr=null),Uo.forEach(A0),qo.forEach(A0)}function Zu(a,r){a.blockedOn===r&&(a.blockedOn=null,Ph||(Ph=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,CA)))}var Qu=null;function T0(a){Qu!==a&&(Qu=a,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Qu===a&&(Qu=null);for(var r=0;r<a.length;r+=3){var c=a[r],f=a[r+1],b=a[r+2];if(typeof f!="function"){if(qh(f||c)===null)continue;break}var w=vt(c);w!==null&&(a.splice(r,3),r-=3,Um(w,{pending:!0,data:b,method:c.method,action:f},f,b))}}))}function Nl(a){function r(je){return Zu(je,a)}$r!==null&&Zu($r,a),Fr!==null&&Zu(Fr,a),zr!==null&&Zu(zr,a),Uo.forEach(r),qo.forEach(r);for(var c=0;c<Br.length;c++){var f=Br[c];f.blockedOn===a&&(f.blockedOn=null)}for(;0<Br.length&&(c=Br[0],c.blockedOn===null);)C0(c),c.blockedOn===null&&Br.shift();if(c=(a.ownerDocument||a).$$reactFormReplay,c!=null)for(f=0;f<c.length;f+=3){var b=c[f],w=c[f+1],q=b[ge]||null;if(typeof w=="function")q||T0(c);else if(q){var te=null;if(w&&w.hasAttribute("formAction")){if(b=w,q=w[ge]||null)te=q.formAction;else if(qh(b)!==null)continue}else te=q.action;typeof te=="function"?c[f+1]=te:(c.splice(f,3),f-=3),T0(c)}}}function M0(){function a(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(q){return b=q})},focusReset:"manual",scroll:"manual"})}function r(){b!==null&&(b(),b=null),f||setTimeout(c,20)}function c(){if(!f&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,b=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(c,100),function(){f=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),b!==null&&(b(),b=null)}}}function Hh(a){this._internalRoot=a}Ju.prototype.render=Hh.prototype.render=function(a){var r=this._internalRoot;if(r===null)throw Error(i(409));var c=r.current,f=Ha();S0(c,f,a,r,null,null)},Ju.prototype.unmount=Hh.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var r=a.containerInfo;S0(a.current,2,null,a,null,null),Iu(),r[Pe]=null}};function Ju(a){this._internalRoot=a}Ju.prototype.unstable_scheduleHydration=function(a){if(a){var r=se();a={blockedOn:null,target:a,priority:r};for(var c=0;c<Br.length&&r!==0&&r<Br[c].priority;c++);Br.splice(c,0,a),c===0&&C0(a)}};var k0=n.version;if(k0!=="19.2.0")throw Error(i(527,k0,"19.2.0"));O.findDOMNode=function(a){var r=a._reactInternals;if(r===void 0)throw typeof a.render=="function"?Error(i(188)):(a=Object.keys(a).join(","),Error(i(268,a)));return a=h(r),a=a!==null?y(a):null,a=a===null?null:a.stateNode,a};var AA={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:L,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ed=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ed.isDisabled&&ed.supportsFiber)try{Ue=ed.inject(AA),qe=ed}catch{}}return Vo.createRoot=function(a,r){if(!l(a))throw Error(i(299));var c=!1,f="",b=Fx,w=zx,q=Bx;return r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(f=r.identifierPrefix),r.onUncaughtError!==void 0&&(b=r.onUncaughtError),r.onCaughtError!==void 0&&(w=r.onCaughtError),r.onRecoverableError!==void 0&&(q=r.onRecoverableError)),r=x0(a,1,!1,null,null,c,f,null,b,w,q,M0),a[Pe]=r.current,Eh(a),new Hh(r)},Vo.hydrateRoot=function(a,r,c){if(!l(a))throw Error(i(299));var f=!1,b="",w=Fx,q=zx,te=Bx,je=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(b=c.identifierPrefix),c.onUncaughtError!==void 0&&(w=c.onUncaughtError),c.onCaughtError!==void 0&&(q=c.onCaughtError),c.onRecoverableError!==void 0&&(te=c.onRecoverableError),c.formState!==void 0&&(je=c.formState)),r=x0(a,1,!0,r,c??null,f,b,je,w,q,te,M0),r.context=v0(null),c=r.current,f=Ha(),f=Be(f),b=Er(f),b.callback=null,_r(c,b,f),c=f,r.current.lanes=c,ce(r,c),Rs(r),a[Pe]=r.current,Eh(a),new Ju(r)},Vo.version="19.2.0",Vo}var U0;function $A(){if(U0)return Gh.exports;U0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}return e(),Gh.exports=OA(),Gh.exports}var FA=$A();/**
 * react-router v7.9.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var MN=e=>{throw TypeError(e)},zA=(e,n,s)=>n.has(e)||MN("Cannot "+s),Zh=(e,n,s)=>(zA(e,n,"read from private field"),s?s.call(e):n.get(e)),BA=(e,n,s)=>n.has(e)?MN("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(e):n.set(e,s),q0="popstate";function UA(e={}){function n(i,l){let{pathname:o,search:d,hash:m}=i.location;return Sc("",{pathname:o,search:d,hash:m},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function s(i,l){return typeof l=="string"?l:Qr(l)}return PA(n,s,null,e)}function cn(e,n){if(e===!1||e===null||typeof e>"u")throw new Error(n)}function Yn(e,n){if(!e){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function qA(){return Math.random().toString(36).substring(2,10)}function P0(e,n){return{usr:e.state,key:e.key,idx:n}}function Sc(e,n,s=null,i){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof n=="string"?ai(n):n,state:s,key:n&&n.key||i||qA()}}function Qr({pathname:e="/",search:n="",hash:s=""}){return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function ai(e){let n={};if(e){let s=e.indexOf("#");s>=0&&(n.hash=e.substring(s),e=e.substring(0,s));let i=e.indexOf("?");i>=0&&(n.search=e.substring(i),e=e.substring(0,i)),e&&(n.pathname=e)}return n}function PA(e,n,s,i={}){let{window:l=document.defaultView,v5Compat:o=!1}=i,d=l.history,m="POP",p=null,h=y();h==null&&(h=0,d.replaceState({...d.state,idx:h},""));function y(){return(d.state||{idx:null}).idx}function g(){m="POP";let E=y(),j=E==null?null:E-h;h=E,p&&p({action:m,location:N.location,delta:j})}function x(E,j){m="PUSH";let A=Sc(N.location,E,j);h=y()+1;let T=P0(A,h),_=N.createHref(A);try{d.pushState(T,"",_)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;l.location.assign(_)}o&&p&&p({action:m,location:N.location,delta:1})}function v(E,j){m="REPLACE";let A=Sc(N.location,E,j);h=y();let T=P0(A,h),_=N.createHref(A);d.replaceState(T,"",_),o&&p&&p({action:m,location:N.location,delta:0})}function S(E){return kN(E)}let N={get action(){return m},get location(){return e(l,d)},listen(E){if(p)throw new Error("A history only accepts one active listener");return l.addEventListener(q0,g),p=E,()=>{l.removeEventListener(q0,g),p=null}},createHref(E){return n(l,E)},createURL:S,encodeLocation(E){let j=S(E);return{pathname:j.pathname,search:j.search,hash:j.hash}},push:x,replace:v,go(E){return d.go(E)}};return N}function kN(e,n=!1){let s="http://localhost";typeof window<"u"&&(s=window.location.origin!=="null"?window.location.origin:window.location.href),cn(s,"No window.location.(origin|href) available to create URL");let i=typeof e=="string"?e:Qr(e);return i=i.replace(/ $/,"%20"),!n&&i.startsWith("//")&&(i=s+i),new URL(i,s)}var dc,H0=class{constructor(e){if(BA(this,dc,new Map),e)for(let[n,s]of e)this.set(n,s)}get(e){if(Zh(this,dc).has(e))return Zh(this,dc).get(e);if(e.defaultValue!==void 0)return e.defaultValue;throw new Error("No value found for context")}set(e,n){Zh(this,dc).set(e,n)}};dc=new WeakMap;var HA=new Set(["lazy","caseSensitive","path","id","index","children"]);function VA(e){return HA.has(e)}var YA=new Set(["lazy","caseSensitive","path","id","index","middleware","children"]);function GA(e){return YA.has(e)}function KA(e){return e.index===!0}function wc(e,n,s=[],i={},l=!1){return e.map((o,d)=>{let m=[...s,String(d)],p=typeof o.id=="string"?o.id:m.join("-");if(cn(o.index!==!0||!o.children,"Cannot specify children on an index route"),cn(l||!i[p],`Found a route id collision on id "${p}".  Route id's must be globally unique within Data Router usages`),KA(o)){let h={...o,...n(o),id:p};return i[p]=h,h}else{let h={...o,...n(o),id:p,children:void 0};return i[p]=h,o.children&&(h.children=wc(o.children,n,m,i,l)),h}})}function Kr(e,n,s="/"){return kd(e,n,s,!1)}function kd(e,n,s,i){let l=typeof n=="string"?ai(n):n,o=Oa(l.pathname||"/",s);if(o==null)return null;let d=RN(e);WA(d);let m=null;for(let p=0;m==null&&p<d.length;++p){let h=l2(o);m=r2(d[p],h,i)}return m}function XA(e,n){let{route:s,pathname:i,params:l}=e;return{id:s.id,pathname:i,params:l,data:n[s.id],loaderData:n[s.id],handle:s.handle}}function RN(e,n=[],s=[],i="",l=!1){let o=(d,m,p=l,h)=>{let y={relativePath:h===void 0?d.path||"":h,caseSensitive:d.caseSensitive===!0,childrenIndex:m,route:d};if(y.relativePath.startsWith("/")){if(!y.relativePath.startsWith(i)&&p)return;cn(y.relativePath.startsWith(i),`Absolute route path "${y.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),y.relativePath=y.relativePath.slice(i.length)}let g=Fs([i,y.relativePath]),x=s.concat(y);d.children&&d.children.length>0&&(cn(d.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),RN(d.children,n,x,g,p)),!(d.path==null&&!d.index)&&n.push({path:g,score:a2(g,d.index),routesMeta:x})};return e.forEach((d,m)=>{if(d.path===""||!d.path?.includes("?"))o(d,m);else for(let p of IN(d.path))o(d,m,!0,p)}),n}function IN(e){let n=e.split("/");if(n.length===0)return[];let[s,...i]=n,l=s.endsWith("?"),o=s.replace(/\?$/,"");if(i.length===0)return l?[o,""]:[o];let d=IN(i.join("/")),m=[];return m.push(...d.map(p=>p===""?o:[o,p].join("/"))),l&&m.push(...d),m.map(p=>e.startsWith("/")&&p===""?"/":p)}function WA(e){e.sort((n,s)=>n.score!==s.score?s.score-n.score:s2(n.routesMeta.map(i=>i.childrenIndex),s.routesMeta.map(i=>i.childrenIndex)))}var ZA=/^:[\w-]+$/,QA=3,JA=2,e2=1,t2=10,n2=-2,V0=e=>e==="*";function a2(e,n){let s=e.split("/"),i=s.length;return s.some(V0)&&(i+=n2),n&&(i+=JA),s.filter(l=>!V0(l)).reduce((l,o)=>l+(ZA.test(o)?QA:o===""?e2:t2),i)}function s2(e,n){return e.length===n.length&&e.slice(0,-1).every((i,l)=>i===n[l])?e[e.length-1]-n[n.length-1]:0}function r2(e,n,s=!1){let{routesMeta:i}=e,l={},o="/",d=[];for(let m=0;m<i.length;++m){let p=i[m],h=m===i.length-1,y=o==="/"?n:n.slice(o.length)||"/",g=Yd({path:p.relativePath,caseSensitive:p.caseSensitive,end:h},y),x=p.route;if(!g&&h&&s&&!i[i.length-1].route.index&&(g=Yd({path:p.relativePath,caseSensitive:p.caseSensitive,end:!1},y)),!g)return null;Object.assign(l,g.params),d.push({params:l,pathname:Fs([o,g.pathname]),pathnameBase:d2(Fs([o,g.pathnameBase])),route:x}),g.pathnameBase!=="/"&&(o=Fs([o,g.pathnameBase]))}return d}function Yd(e,n){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[s,i]=i2(e.path,e.caseSensitive,e.end),l=n.match(s);if(!l)return null;let o=l[0],d=o.replace(/(.)\/+$/,"$1"),m=l.slice(1);return{params:i.reduce((h,{paramName:y,isOptional:g},x)=>{if(y==="*"){let S=m[x]||"";d=o.slice(0,o.length-S.length).replace(/(.)\/+$/,"$1")}const v=m[x];return g&&!v?h[y]=void 0:h[y]=(v||"").replace(/%2F/g,"/"),h},{}),pathname:o,pathnameBase:d,pattern:e}}function i2(e,n=!1,s=!0){Yn(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let i=[],l="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,m,p)=>(i.push({paramName:m,isOptional:p!=null}),p?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(i.push({paramName:"*"}),l+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?l+="\\/*$":e!==""&&e!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,n?void 0:"i"),i]}function l2(e){try{return e.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return Yn(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${n}).`),e}}function Oa(e,n){if(n==="/")return e;if(!e.toLowerCase().startsWith(n.toLowerCase()))return null;let s=n.endsWith("/")?n.length-1:n.length,i=e.charAt(s);return i&&i!=="/"?null:e.slice(s)||"/"}function o2({basename:e,pathname:n}){return n==="/"?e:Fs([e,n])}function c2(e,n="/"){let{pathname:s,search:i="",hash:l=""}=typeof e=="string"?ai(e):e;return{pathname:s?s.startsWith("/")?s:u2(s,n):n,search:f2(i),hash:m2(l)}}function u2(e,n){let s=n.replace(/\/+$/,"").split("/");return e.split("/").forEach(l=>{l===".."?s.length>1&&s.pop():l!=="."&&s.push(l)}),s.length>1?s.join("/"):"/"}function Qh(e,n,s,i){return`Cannot include a '${e}' character in a manually specified \`to.${n}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${s}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function DN(e){return e.filter((n,s)=>s===0||n.route.path&&n.route.path.length>0)}function pf(e){let n=DN(e);return n.map((s,i)=>i===n.length-1?s.pathname:s.pathnameBase)}function yf(e,n,s,i=!1){let l;typeof e=="string"?l=ai(e):(l={...e},cn(!l.pathname||!l.pathname.includes("?"),Qh("?","pathname","search",l)),cn(!l.pathname||!l.pathname.includes("#"),Qh("#","pathname","hash",l)),cn(!l.search||!l.search.includes("#"),Qh("#","search","hash",l)));let o=e===""||l.pathname==="",d=o?"/":l.pathname,m;if(d==null)m=s;else{let g=n.length-1;if(!i&&d.startsWith("..")){let x=d.split("/");for(;x[0]==="..";)x.shift(),g-=1;l.pathname=x.join("/")}m=g>=0?n[g]:"/"}let p=c2(l,m),h=d&&d!=="/"&&d.endsWith("/"),y=(o||d===".")&&s.endsWith("/");return!p.pathname.endsWith("/")&&(h||y)&&(p.pathname+="/"),p}var Fs=e=>e.join("/").replace(/\/\/+/g,"/"),d2=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),f2=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,m2=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e,Gd=class{constructor(e,n,s,i=!1){this.status=e,this.statusText=n||"",this.internal=i,s instanceof Error?(this.data=s.toString(),this.error=s):this.data=s}};function Nc(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}var LN=["POST","PUT","PATCH","DELETE"],h2=new Set(LN),p2=["GET",...LN],y2=new Set(p2),g2=new Set([301,302,303,307,308]),b2=new Set([307,308]),Jh={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},x2={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},_i={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},v2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Qy=e=>v2.test(e),S2=e=>({hasErrorBoundary:!!e.hasErrorBoundary}),ON="remix-router-transitions",$N=Symbol("ResetLoaderData");function w2(e){const n=e.window?e.window:typeof window<"u"?window:void 0,s=typeof n<"u"&&typeof n.document<"u"&&typeof n.document.createElement<"u";cn(e.routes.length>0,"You must provide a non-empty routes array to createRouter");let i=e.hydrationRouteProperties||[],l=e.mapRouteProperties||S2,o={},d=wc(e.routes,l,void 0,o),m,p=e.basename||"/";p.startsWith("/")||(p=`/${p}`);let h=e.dataStrategy||C2,y={...e.future},g=null,x=new Set,v=null,S=null,N=null,E=e.hydrationData!=null,j=Kr(d,e.history.location,p),A=!1,T=null,_;if(j==null&&!e.patchRoutesOnNavigation){let ce=is(404,{pathname:e.history.location.pathname}),{matches:Ae,route:Te}=td(d);_=!0,j=Ae,T={[Te.id]:ce}}else if(j&&!e.hydrationData&&At(j,d,e.history.location.pathname).active&&(j=null),j)if(j.some(ce=>ce.route.lazy))_=!1;else if(!j.some(ce=>Jy(ce.route)))_=!0;else{let ce=e.hydrationData?e.hydrationData.loaderData:null,Ae=e.hydrationData?e.hydrationData.errors:null;if(Ae){let Te=j.findIndex(Ke=>Ae[Ke.route.id]!==void 0);_=j.slice(0,Te+1).every(Ke=>!ly(Ke.route,ce,Ae))}else _=j.every(Te=>!ly(Te.route,ce,Ae))}else{_=!1,j=[];let ce=At(null,d,e.history.location.pathname);ce.active&&ce.matches&&(A=!0,j=ce.matches)}let M,k={historyAction:e.history.action,location:e.history.location,matches:j,initialized:_,navigation:Jh,restoreScrollPosition:e.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:e.hydrationData&&e.hydrationData.loaderData||{},actionData:e.hydrationData&&e.hydrationData.actionData||null,errors:e.hydrationData&&e.hydrationData.errors||T,fetchers:new Map,blockers:new Map},C="POP",D=!1,z,G=!1,U=new Map,X=null,V=!1,R=!1,B=new Set,L=new Map,O=0,$=-1,F=new Map,H=new Set,I=new Map,Y=new Map,P=new Set,K=new Map,re,W=null;function ue(){if(g=e.history.listen(({action:ce,location:Ae,delta:Te})=>{if(re){re(),re=void 0;return}Yn(K.size===0||Te!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let Ke=Ct({currentLocation:k.location,nextLocation:Ae,historyAction:ce});if(Ke&&Te!=null){let Se=new Promise(Be=>{re=Be});e.history.go(Te*-1),bt(Ke,{state:"blocked",location:Ae,proceed(){bt(Ke,{state:"proceeding",proceed:void 0,reset:void 0,location:Ae}),Se.then(()=>e.history.go(Te))},reset(){let Be=new Map(k.blockers);Be.set(Ke,_i),ae({blockers:Be})}});return}return ne(ce,Ae)}),s){q2(n,U);let ce=()=>P2(n,U);n.addEventListener("pagehide",ce),X=()=>n.removeEventListener("pagehide",ce)}return k.initialized||ne("POP",k.location,{initialHydration:!0}),M}function Q(){g&&g(),X&&X(),x.clear(),z&&z.abort(),k.fetchers.forEach((ce,Ae)=>J(Ae)),k.blockers.forEach((ce,Ae)=>pt(Ae))}function ye(ce){return x.add(ce),()=>x.delete(ce)}function ae(ce,Ae={}){ce.matches&&(ce.matches=ce.matches.map(Se=>{let Be=o[Se.route.id],We=Se.route;return We.element!==Be.element||We.errorElement!==Be.errorElement||We.hydrateFallbackElement!==Be.hydrateFallbackElement?{...Se,route:Be}:Se})),k={...k,...ce};let Te=[],Ke=[];k.fetchers.forEach((Se,Be)=>{Se.state==="idle"&&(P.has(Be)?Te.push(Be):Ke.push(Be))}),P.forEach(Se=>{!k.fetchers.has(Se)&&!L.has(Se)&&Te.push(Se)}),[...x].forEach(Se=>Se(k,{deletedFetchers:Te,viewTransitionOpts:Ae.viewTransitionOpts,flushSync:Ae.flushSync===!0})),Te.forEach(Se=>J(Se)),Ke.forEach(Se=>k.fetchers.delete(Se))}function ke(ce,Ae,{flushSync:Te}={}){let Ke=k.actionData!=null&&k.navigation.formMethod!=null&&Ia(k.navigation.formMethod)&&k.navigation.state==="loading"&&ce.state?._isRedirect!==!0,Se;Ae.actionData?Object.keys(Ae.actionData).length>0?Se=Ae.actionData:Se=null:Ke?Se=k.actionData:Se=null;let Be=Ae.loaderData?tS(k.loaderData,Ae.loaderData,Ae.matches||[],Ae.errors):k.loaderData,We=k.blockers;We.size>0&&(We=new Map(We),We.forEach((_e,ge)=>We.set(ge,_i)));let se=V?!1:Qt(ce,Ae.matches||k.matches),Z=D===!0||k.navigation.formMethod!=null&&Ia(k.navigation.formMethod)&&ce.state?._isRedirect!==!0;m&&(d=m,m=void 0),V||C==="POP"||(C==="PUSH"?e.history.push(ce,ce.state):C==="REPLACE"&&e.history.replace(ce,ce.state));let Ee;if(C==="POP"){let _e=U.get(k.location.pathname);_e&&_e.has(ce.pathname)?Ee={currentLocation:k.location,nextLocation:ce}:U.has(ce.pathname)&&(Ee={currentLocation:ce,nextLocation:k.location})}else if(G){let _e=U.get(k.location.pathname);_e?_e.add(ce.pathname):(_e=new Set([ce.pathname]),U.set(k.location.pathname,_e)),Ee={currentLocation:k.location,nextLocation:ce}}ae({...Ae,actionData:Se,loaderData:Be,historyAction:C,location:ce,initialized:!0,navigation:Jh,revalidation:"idle",restoreScrollPosition:se,preventScrollReset:Z,blockers:We},{viewTransitionOpts:Ee,flushSync:Te===!0}),C="POP",D=!1,G=!1,V=!1,R=!1,W?.resolve(),W=null}async function pe(ce,Ae){if(typeof ce=="number"){e.history.go(ce);return}let Te=iy(k.location,k.matches,p,ce,Ae?.fromRouteId,Ae?.relative),{path:Ke,submission:Se,error:Be}=Y0(!1,Te,Ae),We=k.location,se=Sc(k.location,Ke,Ae&&Ae.state);se={...se,...e.history.encodeLocation(se)};let Z=Ae&&Ae.replace!=null?Ae.replace:void 0,Ee="PUSH";Z===!0?Ee="REPLACE":Z===!1||Se!=null&&Ia(Se.formMethod)&&Se.formAction===k.location.pathname+k.location.search&&(Ee="REPLACE");let _e=Ae&&"preventScrollReset"in Ae?Ae.preventScrollReset===!0:void 0,ge=(Ae&&Ae.flushSync)===!0,Pe=Ct({currentLocation:We,nextLocation:se,historyAction:Ee});if(Pe){bt(Pe,{state:"blocked",location:se,proceed(){bt(Pe,{state:"proceeding",proceed:void 0,reset:void 0,location:se}),pe(ce,Ae)},reset(){let oe=new Map(k.blockers);oe.set(Pe,_i),ae({blockers:oe})}});return}await ne(Ee,se,{submission:Se,pendingError:Be,preventScrollReset:_e,replace:Ae&&Ae.replace,enableViewTransition:Ae&&Ae.viewTransition,flushSync:ge})}function we(){W||(W=H2()),st(),ae({revalidation:"loading"});let ce=W.promise;return k.navigation.state==="submitting"?ce:k.navigation.state==="idle"?(ne(k.historyAction,k.location,{startUninterruptedRevalidation:!0}),ce):(ne(C||k.historyAction,k.navigation.location,{overrideNavigation:k.navigation,enableViewTransition:G===!0}),ce)}async function ne(ce,Ae,Te){z&&z.abort(),z=null,C=ce,V=(Te&&Te.startUninterruptedRevalidation)===!0,$t(k.location,k.matches),D=(Te&&Te.preventScrollReset)===!0,G=(Te&&Te.enableViewTransition)===!0;let Ke=m||d,Se=Te&&Te.overrideNavigation,Be=Te?.initialHydration&&k.matches&&k.matches.length>0&&!A?k.matches:Kr(Ke,Ae,p),We=(Te&&Te.flushSync)===!0;if(Be&&k.initialized&&!R&&L2(k.location,Ae)&&!(Te&&Te.submission&&Ia(Te.submission.formMethod))){ke(Ae,{matches:Be},{flushSync:We});return}let se=At(Be,Ke,Ae.pathname);if(se.active&&se.matches&&(Be=se.matches),!Be){let{error:dt,notFoundMatches:xt,route:de}=Ze(Ae.pathname);ke(Ae,{matches:xt,loaderData:{},errors:{[de.id]:dt}},{flushSync:We});return}z=new AbortController;let Z=Rl(e.history,Ae,z.signal,Te&&Te.submission),Ee=e.getContext?await e.getContext():new H0,_e;if(Te&&Te.pendingError)_e=[Xr(Be).route.id,{type:"error",error:Te.pendingError}];else if(Te&&Te.submission&&Ia(Te.submission.formMethod)){let dt=await Le(Z,Ae,Te.submission,Be,Ee,se.active,Te&&Te.initialHydration===!0,{replace:Te.replace,flushSync:We});if(dt.shortCircuited)return;if(dt.pendingActionResult){let[xt,de]=dt.pendingActionResult;if(Va(de)&&Nc(de.error)&&de.error.status===404){z=null,ke(Ae,{matches:dt.matches,loaderData:{},errors:{[xt]:de.error}});return}}Be=dt.matches||Be,_e=dt.pendingActionResult,Se=ep(Ae,Te.submission),We=!1,se.active=!1,Z=Rl(e.history,Z.url,Z.signal)}let{shortCircuited:ge,matches:Pe,loaderData:oe,errors:at}=await be(Z,Ae,Be,Ee,se.active,Se,Te&&Te.submission,Te&&Te.fetcherSubmission,Te&&Te.replace,Te&&Te.initialHydration===!0,We,_e);ge||(z=null,ke(Ae,{matches:Pe||Be,...nS(_e),loaderData:oe,errors:at}))}async function Le(ce,Ae,Te,Ke,Se,Be,We,se={}){st();let Z=B2(Ae,Te);if(ae({navigation:Z},{flushSync:se.flushSync===!0}),Be){let ge=await kt(Ke,Ae.pathname,ce.signal);if(ge.type==="aborted")return{shortCircuited:!0};if(ge.type==="error"){if(ge.partialMatches.length===0){let{matches:oe,route:at}=td(d);return{matches:oe,pendingActionResult:[at.id,{type:"error",error:ge.error}]}}let Pe=Xr(ge.partialMatches).route.id;return{matches:ge.partialMatches,pendingActionResult:[Pe,{type:"error",error:ge.error}]}}else if(ge.matches)Ke=ge.matches;else{let{notFoundMatches:Pe,error:oe,route:at}=Ze(Ae.pathname);return{matches:Pe,pendingActionResult:[at.id,{type:"error",error:oe}]}}}let Ee,_e=Rd(Ke,Ae);if(!_e.route.action&&!_e.route.lazy)Ee={type:"error",error:is(405,{method:ce.method,pathname:Ae.pathname,routeId:_e.route.id})};else{let ge=Ll(l,o,ce,Ke,_e,We?[]:i,Se),Pe=await ve(ce,ge,Se,null);if(Ee=Pe[_e.route.id],!Ee){for(let oe of Ke)if(Pe[oe.route.id]){Ee=Pe[oe.route.id];break}}if(ce.signal.aborted)return{shortCircuited:!0}}if(Ai(Ee)){let ge;return se&&se.replace!=null?ge=se.replace:ge=Q0(Ee.response.headers.get("Location"),new URL(ce.url),p)===k.location.pathname+k.location.search,await jt(ce,Ee,!0,{submission:Te,replace:ge}),{shortCircuited:!0}}if(Va(Ee)){let ge=Xr(Ke,_e.route.id);return(se&&se.replace)!==!0&&(C="PUSH"),{matches:Ke,pendingActionResult:[ge.route.id,Ee,_e.route.id]}}return{matches:Ke,pendingActionResult:[_e.route.id,Ee]}}async function be(ce,Ae,Te,Ke,Se,Be,We,se,Z,Ee,_e,ge){let Pe=Be||ep(Ae,We),oe=We||se||sS(Pe),at=!V&&!Ee;if(Se){if(at){let Ie=Oe(ge);ae({navigation:Pe,...Ie!==void 0?{actionData:Ie}:{}},{flushSync:_e})}let xe=await kt(Te,Ae.pathname,ce.signal);if(xe.type==="aborted")return{shortCircuited:!0};if(xe.type==="error"){if(xe.partialMatches.length===0){let{matches:et,route:Nt}=td(d);return{matches:et,loaderData:{},errors:{[Nt.id]:xe.error}}}let Ie=Xr(xe.partialMatches).route.id;return{matches:xe.partialMatches,loaderData:{},errors:{[Ie]:xe.error}}}else if(xe.matches)Te=xe.matches;else{let{error:Ie,notFoundMatches:et,route:Nt}=Ze(Ae.pathname);return{matches:et,loaderData:{},errors:{[Nt.id]:Ie}}}}let dt=m||d,{dsMatches:xt,revalidatingFetchers:de}=G0(ce,Ke,l,o,e.history,k,Te,oe,Ae,Ee?[]:i,Ee===!0,R,B,P,I,H,dt,p,e.patchRoutesOnNavigation!=null,ge);if($=++O,!e.dataStrategy&&!xt.some(xe=>xe.shouldLoad)&&!xt.some(xe=>xe.route.middleware&&xe.route.middleware.length>0)&&de.length===0){let xe=qe();return ke(Ae,{matches:Te,loaderData:{},errors:ge&&Va(ge[1])?{[ge[0]]:ge[1].error}:null,...nS(ge),...xe?{fetchers:new Map(k.fetchers)}:{}},{flushSync:_e}),{shortCircuited:!0}}if(at){let xe={};if(!Se){xe.navigation=Pe;let Ie=Oe(ge);Ie!==void 0&&(xe.actionData=Ie)}de.length>0&&(xe.fetchers=Me(de)),ae(xe,{flushSync:_e})}de.forEach(xe=>{fe(xe.key),xe.controller&&L.set(xe.key,xe.controller)});let it=()=>de.forEach(xe=>fe(xe.key));z&&z.signal.addEventListener("abort",it);let{loaderResults:nt,fetcherResults:vt}=await tt(xt,de,ce,Ke);if(ce.signal.aborted)return{shortCircuited:!0};z&&z.signal.removeEventListener("abort",it),de.forEach(xe=>L.delete(xe.key));let lt=nd(nt);if(lt)return await jt(ce,lt.result,!0,{replace:Z}),{shortCircuited:!0};if(lt=nd(vt),lt)return H.add(lt.key),await jt(ce,lt.result,!0,{replace:Z}),{shortCircuited:!0};let{loaderData:wt,errors:He}=eS(k,Te,nt,ge,de,vt);Ee&&k.errors&&(He={...k.errors,...He});let Je=qe(),St=ze($),ee=Je||St||de.length>0;return{matches:Te,loaderData:wt,errors:He,...ee?{fetchers:new Map(k.fetchers)}:{}}}function Oe(ce){if(ce&&!Va(ce[1]))return{[ce[0]]:ce[1].data};if(k.actionData)return Object.keys(k.actionData).length===0?null:k.actionData}function Me(ce){return ce.forEach(Ae=>{let Te=k.fetchers.get(Ae.key),Ke=Yo(void 0,Te?Te.data:void 0);k.fetchers.set(Ae.key,Ke)}),new Map(k.fetchers)}async function ut(ce,Ae,Te,Ke){fe(ce);let Se=(Ke&&Ke.flushSync)===!0,Be=m||d,We=iy(k.location,k.matches,p,Te,Ae,Ke?.relative),se=Kr(Be,We,p),Z=At(se,Be,We);if(Z.active&&Z.matches&&(se=Z.matches),!se){Ye(ce,Ae,is(404,{pathname:We}),{flushSync:Se});return}let{path:Ee,submission:_e,error:ge}=Y0(!0,We,Ke);if(ge){Ye(ce,Ae,ge,{flushSync:Se});return}let Pe=e.getContext?await e.getContext():new H0,oe=(Ke&&Ke.preventScrollReset)===!0;if(_e&&Ia(_e.formMethod)){await ht(ce,Ae,Ee,se,Pe,Z.active,Se,oe,_e);return}I.set(ce,{routeId:Ae,path:Ee}),await _t(ce,Ae,Ee,se,Pe,Z.active,Se,oe,_e)}async function ht(ce,Ae,Te,Ke,Se,Be,We,se,Z){st(),I.delete(ce);let Ee=k.fetchers.get(ce);$e(ce,U2(Z,Ee),{flushSync:We});let _e=new AbortController,ge=Rl(e.history,Te,_e.signal,Z);if(Be){let Rt=await kt(Ke,new URL(ge.url).pathname,ge.signal,ce);if(Rt.type==="aborted")return;if(Rt.type==="error"){Ye(ce,Ae,Rt.error,{flushSync:We});return}else if(Rt.matches)Ke=Rt.matches;else{Ye(ce,Ae,is(404,{pathname:Te}),{flushSync:We});return}}let Pe=Rd(Ke,Te);if(!Pe.route.action&&!Pe.route.lazy){let Rt=is(405,{method:Z.formMethod,pathname:Te,routeId:Ae});Ye(ce,Ae,Rt,{flushSync:We});return}L.set(ce,_e);let oe=O,at=Ll(l,o,ge,Ke,Pe,i,Se),xt=(await ve(ge,at,Se,ce))[Pe.route.id];if(ge.signal.aborted){L.get(ce)===_e&&L.delete(ce);return}if(P.has(ce)){if(Ai(xt)||Va(xt)){$e(ce,dr(void 0));return}}else{if(Ai(xt))if(L.delete(ce),$>oe){$e(ce,dr(void 0));return}else return H.add(ce),$e(ce,Yo(Z)),jt(ge,xt,!1,{fetcherSubmission:Z,preventScrollReset:se});if(Va(xt)){Ye(ce,Ae,xt.error);return}}let de=k.navigation.location||k.location,it=Rl(e.history,de,_e.signal),nt=m||d,vt=k.navigation.state!=="idle"?Kr(nt,k.navigation.location,p):k.matches;cn(vt,"Didn't find any matches after fetcher action");let lt=++O;F.set(ce,lt);let wt=Yo(Z,xt.data);k.fetchers.set(ce,wt);let{dsMatches:He,revalidatingFetchers:Je}=G0(it,Se,l,o,e.history,k,vt,Z,de,i,!1,R,B,P,I,H,nt,p,e.patchRoutesOnNavigation!=null,[Pe.route.id,xt]);Je.filter(Rt=>Rt.key!==ce).forEach(Rt=>{let nn=Rt.key,Pt=k.fetchers.get(nn),Ft=Yo(void 0,Pt?Pt.data:void 0);k.fetchers.set(nn,Ft),fe(nn),Rt.controller&&L.set(nn,Rt.controller)}),ae({fetchers:new Map(k.fetchers)});let St=()=>Je.forEach(Rt=>fe(Rt.key));_e.signal.addEventListener("abort",St);let{loaderResults:ee,fetcherResults:xe}=await tt(He,Je,it,Se);if(_e.signal.aborted)return;if(_e.signal.removeEventListener("abort",St),F.delete(ce),L.delete(ce),Je.forEach(Rt=>L.delete(Rt.key)),k.fetchers.has(ce)){let Rt=dr(xt.data);k.fetchers.set(ce,Rt)}let Ie=nd(ee);if(Ie)return jt(it,Ie.result,!1,{preventScrollReset:se});if(Ie=nd(xe),Ie)return H.add(Ie.key),jt(it,Ie.result,!1,{preventScrollReset:se});let{loaderData:et,errors:Nt}=eS(k,vt,ee,void 0,Je,xe);ze(lt),k.navigation.state==="loading"&&lt>$?(cn(C,"Expected pending action"),z&&z.abort(),ke(k.navigation.location,{matches:vt,loaderData:et,errors:Nt,fetchers:new Map(k.fetchers)})):(ae({errors:Nt,loaderData:tS(k.loaderData,et,vt,Nt),fetchers:new Map(k.fetchers)}),R=!1)}async function _t(ce,Ae,Te,Ke,Se,Be,We,se,Z){let Ee=k.fetchers.get(ce);$e(ce,Yo(Z,Ee?Ee.data:void 0),{flushSync:We});let _e=new AbortController,ge=Rl(e.history,Te,_e.signal);if(Be){let de=await kt(Ke,new URL(ge.url).pathname,ge.signal,ce);if(de.type==="aborted")return;if(de.type==="error"){Ye(ce,Ae,de.error,{flushSync:We});return}else if(de.matches)Ke=de.matches;else{Ye(ce,Ae,is(404,{pathname:Te}),{flushSync:We});return}}let Pe=Rd(Ke,Te);L.set(ce,_e);let oe=O,at=Ll(l,o,ge,Ke,Pe,i,Se),xt=(await ve(ge,at,Se,ce))[Pe.route.id];if(L.get(ce)===_e&&L.delete(ce),!ge.signal.aborted){if(P.has(ce)){$e(ce,dr(void 0));return}if(Ai(xt))if($>oe){$e(ce,dr(void 0));return}else{H.add(ce),await jt(ge,xt,!1,{preventScrollReset:se});return}if(Va(xt)){Ye(ce,Ae,xt.error);return}$e(ce,dr(xt.data))}}async function jt(ce,Ae,Te,{submission:Ke,fetcherSubmission:Se,preventScrollReset:Be,replace:We}={}){Ae.response.headers.has("X-Remix-Revalidate")&&(R=!0);let se=Ae.response.headers.get("Location");cn(se,"Expected a Location header on the redirect Response"),se=Q0(se,new URL(ce.url),p);let Z=Sc(k.location,se,{_isRedirect:!0});if(s){let at=!1;if(Ae.response.headers.has("X-Remix-Reload-Document"))at=!0;else if(Qy(se)){const dt=kN(se,!0);at=dt.origin!==n.location.origin||Oa(dt.pathname,p)==null}if(at){We?n.location.replace(se):n.location.assign(se);return}}z=null;let Ee=We===!0||Ae.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:_e,formAction:ge,formEncType:Pe}=k.navigation;!Ke&&!Se&&_e&&ge&&Pe&&(Ke=sS(k.navigation));let oe=Ke||Se;if(b2.has(Ae.response.status)&&oe&&Ia(oe.formMethod))await ne(Ee,Z,{submission:{...oe,formAction:se},preventScrollReset:Be||D,enableViewTransition:Te?G:void 0});else{let at=ep(Z,Ke);await ne(Ee,Z,{overrideNavigation:at,fetcherSubmission:Se,preventScrollReset:Be||D,enableViewTransition:Te?G:void 0})}}async function ve(ce,Ae,Te,Ke){let Se,Be={};try{Se=await T2(h,ce,Ae,Ke,Te,!1)}catch(We){return Ae.filter(se=>se.shouldLoad).forEach(se=>{Be[se.route.id]={type:"error",error:We}}),Be}if(ce.signal.aborted)return Be;for(let[We,se]of Object.entries(Se))if(F2(se)){let Z=se.result;Be[We]={type:"redirect",response:I2(Z,ce,We,Ae,p)}}else Be[We]=await R2(se);return Be}async function tt(ce,Ae,Te,Ke){let Se=ve(Te,ce,Ke,null),Be=Promise.all(Ae.map(async Z=>{if(Z.matches&&Z.match&&Z.request&&Z.controller){let _e=(await ve(Z.request,Z.matches,Ke,Z.key))[Z.match.route.id];return{[Z.key]:_e}}else return Promise.resolve({[Z.key]:{type:"error",error:is(404,{pathname:Z.path})}})})),We=await Se,se=(await Be).reduce((Z,Ee)=>Object.assign(Z,Ee),{});return{loaderResults:We,fetcherResults:se}}function st(){R=!0,I.forEach((ce,Ae)=>{L.has(Ae)&&B.add(Ae),fe(Ae)})}function $e(ce,Ae,Te={}){k.fetchers.set(ce,Ae),ae({fetchers:new Map(k.fetchers)},{flushSync:(Te&&Te.flushSync)===!0})}function Ye(ce,Ae,Te,Ke={}){let Se=Xr(k.matches,Ae);J(ce),ae({errors:{[Se.route.id]:Te},fetchers:new Map(k.fetchers)},{flushSync:(Ke&&Ke.flushSync)===!0})}function mt(ce){return Y.set(ce,(Y.get(ce)||0)+1),P.has(ce)&&P.delete(ce),k.fetchers.get(ce)||x2}function ie(ce,Ae){fe(ce,Ae?.reason),$e(ce,dr(null))}function J(ce){let Ae=k.fetchers.get(ce);L.has(ce)&&!(Ae&&Ae.state==="loading"&&F.has(ce))&&fe(ce),I.delete(ce),F.delete(ce),H.delete(ce),P.delete(ce),B.delete(ce),k.fetchers.delete(ce)}function le(ce){let Ae=(Y.get(ce)||0)-1;Ae<=0?(Y.delete(ce),P.add(ce)):Y.set(ce,Ae),ae({fetchers:new Map(k.fetchers)})}function fe(ce,Ae){let Te=L.get(ce);Te&&(Te.abort(Ae),L.delete(ce))}function Ue(ce){for(let Ae of ce){let Te=mt(Ae),Ke=dr(Te.data);k.fetchers.set(Ae,Ke)}}function qe(){let ce=[],Ae=!1;for(let Te of H){let Ke=k.fetchers.get(Te);cn(Ke,`Expected fetcher: ${Te}`),Ke.state==="loading"&&(H.delete(Te),ce.push(Te),Ae=!0)}return Ue(ce),Ae}function ze(ce){let Ae=[];for(let[Te,Ke]of F)if(Ke<ce){let Se=k.fetchers.get(Te);cn(Se,`Expected fetcher: ${Te}`),Se.state==="loading"&&(fe(Te),F.delete(Te),Ae.push(Te))}return Ue(Ae),Ae.length>0}function Ce(ce,Ae){let Te=k.blockers.get(ce)||_i;return K.get(ce)!==Ae&&K.set(ce,Ae),Te}function pt(ce){k.blockers.delete(ce),K.delete(ce)}function bt(ce,Ae){let Te=k.blockers.get(ce)||_i;cn(Te.state==="unblocked"&&Ae.state==="blocked"||Te.state==="blocked"&&Ae.state==="blocked"||Te.state==="blocked"&&Ae.state==="proceeding"||Te.state==="blocked"&&Ae.state==="unblocked"||Te.state==="proceeding"&&Ae.state==="unblocked",`Invalid blocker state transition: ${Te.state} -> ${Ae.state}`);let Ke=new Map(k.blockers);Ke.set(ce,Ae),ae({blockers:Ke})}function Ct({currentLocation:ce,nextLocation:Ae,historyAction:Te}){if(K.size===0)return;K.size>1&&Yn(!1,"A router only supports one blocker at a time");let Ke=Array.from(K.entries()),[Se,Be]=Ke[Ke.length-1],We=k.blockers.get(Se);if(!(We&&We.state==="proceeding")&&Be({currentLocation:ce,nextLocation:Ae,historyAction:Te}))return Se}function Ze(ce){let Ae=is(404,{pathname:ce}),Te=m||d,{matches:Ke,route:Se}=td(Te);return{notFoundMatches:Ke,route:Se,error:Ae}}function ot(ce,Ae,Te){if(v=ce,N=Ae,S=Te||null,!E&&k.navigation===Jh){E=!0;let Ke=Qt(k.location,k.matches);Ke!=null&&ae({restoreScrollPosition:Ke})}return()=>{v=null,N=null,S=null}}function Tt(ce,Ae){return S&&S(ce,Ae.map(Ke=>XA(Ke,k.loaderData)))||ce.key}function $t(ce,Ae){if(v&&N){let Te=Tt(ce,Ae);v[Te]=N()}}function Qt(ce,Ae){if(v){let Te=Tt(ce,Ae),Ke=v[Te];if(typeof Ke=="number")return Ke}return null}function At(ce,Ae,Te){if(e.patchRoutesOnNavigation)if(ce){if(Object.keys(ce[0].params).length>0)return{active:!0,matches:kd(Ae,Te,p,!0)}}else return{active:!0,matches:kd(Ae,Te,p,!0)||[]};return{active:!1,matches:null}}async function kt(ce,Ae,Te,Ke){if(!e.patchRoutesOnNavigation)return{type:"success",matches:ce};let Se=ce;for(;;){let Be=m==null,We=m||d,se=o;try{await e.patchRoutesOnNavigation({signal:Te,path:Ae,matches:Se,fetcherKey:Ke,patch:(_e,ge)=>{Te.aborted||K0(_e,ge,We,se,l,!1)}})}catch(_e){return{type:"error",error:_e,partialMatches:Se}}finally{Be&&!Te.aborted&&(d=[...d])}if(Te.aborted)return{type:"aborted"};let Z=Kr(We,Ae,p);if(Z)return{type:"success",matches:Z};let Ee=kd(We,Ae,p,!0);if(!Ee||Se.length===Ee.length&&Se.every((_e,ge)=>_e.route.id===Ee[ge].route.id))return{type:"success",matches:null};Se=Ee}}function qt(ce){o={},m=wc(ce,l,void 0,o)}function Lt(ce,Ae,Te=!1){let Ke=m==null;K0(ce,Ae,m||d,o,l,Te),Ke&&(d=[...d],ae({}))}return M={get basename(){return p},get future(){return y},get state(){return k},get routes(){return d},get window(){return n},initialize:ue,subscribe:ye,enableScrollRestoration:ot,navigate:pe,fetch:ut,revalidate:we,createHref:ce=>e.history.createHref(ce),encodeLocation:ce=>e.history.encodeLocation(ce),getFetcher:mt,resetFetcher:ie,deleteFetcher:le,dispose:Q,getBlocker:Ce,deleteBlocker:pt,patchRoutes:Lt,_internalFetchControllers:L,_internalSetRoutes:qt,_internalSetStateDoNotUseOrYouWillBreakYourApp(ce){ae(ce)}},M}function N2(e){return e!=null&&("formData"in e&&e.formData!=null||"body"in e&&e.body!==void 0)}function iy(e,n,s,i,l,o){let d,m;if(l){d=[];for(let h of n)if(d.push(h),h.route.id===l){m=h;break}}else d=n,m=n[n.length-1];let p=yf(i||".",pf(d),Oa(e.pathname,s)||e.pathname,o==="path");if(i==null&&(p.search=e.search,p.hash=e.hash),(i==null||i===""||i===".")&&m){let h=eg(p.search);if(m.route.index&&!h)p.search=p.search?p.search.replace(/^\?/,"?index&"):"?index";else if(!m.route.index&&h){let y=new URLSearchParams(p.search),g=y.getAll("index");y.delete("index"),g.filter(v=>v).forEach(v=>y.append("index",v));let x=y.toString();p.search=x?`?${x}`:""}}return s!=="/"&&(p.pathname=o2({basename:s,pathname:p.pathname})),Qr(p)}function Y0(e,n,s){if(!s||!N2(s))return{path:n};if(s.formMethod&&!z2(s.formMethod))return{path:n,error:is(405,{method:s.formMethod})};let i=()=>({path:n,error:is(400,{type:"invalid-body"})}),o=(s.formMethod||"get").toUpperCase(),d=PN(n);if(s.body!==void 0){if(s.formEncType==="text/plain"){if(!Ia(o))return i();let g=typeof s.body=="string"?s.body:s.body instanceof FormData||s.body instanceof URLSearchParams?Array.from(s.body.entries()).reduce((x,[v,S])=>`${x}${v}=${S}
`,""):String(s.body);return{path:n,submission:{formMethod:o,formAction:d,formEncType:s.formEncType,formData:void 0,json:void 0,text:g}}}else if(s.formEncType==="application/json"){if(!Ia(o))return i();try{let g=typeof s.body=="string"?JSON.parse(s.body):s.body;return{path:n,submission:{formMethod:o,formAction:d,formEncType:s.formEncType,formData:void 0,json:g,text:void 0}}}catch{return i()}}}cn(typeof FormData=="function","FormData is not available in this environment");let m,p;if(s.formData)m=cy(s.formData),p=s.formData;else if(s.body instanceof FormData)m=cy(s.body),p=s.body;else if(s.body instanceof URLSearchParams)m=s.body,p=J0(m);else if(s.body==null)m=new URLSearchParams,p=new FormData;else try{m=new URLSearchParams(s.body),p=J0(m)}catch{return i()}let h={formMethod:o,formAction:d,formEncType:s&&s.formEncType||"application/x-www-form-urlencoded",formData:p,json:void 0,text:void 0};if(Ia(h.formMethod))return{path:n,submission:h};let y=ai(n);return e&&y.search&&eg(y.search)&&m.append("index",""),y.search=`?${m}`,{path:Qr(y),submission:h}}function G0(e,n,s,i,l,o,d,m,p,h,y,g,x,v,S,N,E,j,A,T){let _=T?Va(T[1])?T[1].error:T[1].data:void 0,M=l.createURL(o.location),k=l.createURL(p),C;if(y&&o.errors){let V=Object.keys(o.errors)[0];C=d.findIndex(R=>R.route.id===V)}else if(T&&Va(T[1])){let V=T[0];C=d.findIndex(R=>R.route.id===V)-1}let D=T?T[1].statusCode:void 0,z=D&&D>=400,G={currentUrl:M,currentParams:o.matches[0]?.params||{},nextUrl:k,nextParams:d[0].params,...m,actionResult:_,actionStatus:D},U=d.map((V,R)=>{let{route:B}=V,L=null;if(C!=null&&R>C?L=!1:B.lazy?L=!0:Jy(B)?y?L=ly(B,o.loaderData,o.errors):j2(o.loaderData,o.matches[R],V)&&(L=!0):L=!1,L!==null)return oy(s,i,e,V,h,n,L);let O=z?!1:g||M.pathname+M.search===k.pathname+k.search||M.search!==k.search||E2(o.matches[R],V),$={...G,defaultShouldRevalidate:O},F=Kd(V,$);return oy(s,i,e,V,h,n,F,$)}),X=[];return S.forEach((V,R)=>{if(y||!d.some(Y=>Y.route.id===V.routeId)||v.has(R))return;let B=o.fetchers.get(R),L=B&&B.state!=="idle"&&B.data===void 0,O=Kr(E,V.path,j);if(!O){if(A&&L)return;X.push({key:R,routeId:V.routeId,path:V.path,matches:null,match:null,request:null,controller:null});return}if(N.has(R))return;let $=Rd(O,V.path),F=new AbortController,H=Rl(l,V.path,F.signal),I=null;if(x.has(R))x.delete(R),I=Ll(s,i,H,O,$,h,n);else if(L)g&&(I=Ll(s,i,H,O,$,h,n));else{let Y={...G,defaultShouldRevalidate:z?!1:g};Kd($,Y)&&(I=Ll(s,i,H,O,$,h,n,Y))}I&&X.push({key:R,routeId:V.routeId,path:V.path,matches:I,match:$,request:H,controller:F})}),{dsMatches:U,revalidatingFetchers:X}}function Jy(e){return e.loader!=null||e.middleware!=null&&e.middleware.length>0}function ly(e,n,s){if(e.lazy)return!0;if(!Jy(e))return!1;let i=n!=null&&e.id in n,l=s!=null&&s[e.id]!==void 0;return!i&&l?!1:typeof e.loader=="function"&&e.loader.hydrate===!0?!0:!i&&!l}function j2(e,n,s){let i=!n||s.route.id!==n.route.id,l=!e.hasOwnProperty(s.route.id);return i||l}function E2(e,n){let s=e.route.path;return e.pathname!==n.pathname||s!=null&&s.endsWith("*")&&e.params["*"]!==n.params["*"]}function Kd(e,n){if(e.route.shouldRevalidate){let s=e.route.shouldRevalidate(n);if(typeof s=="boolean")return s}return n.defaultShouldRevalidate}function K0(e,n,s,i,l,o){let d;if(e){let h=i[e];cn(h,`No route found to patch children into: routeId = ${e}`),h.children||(h.children=[]),d=h.children}else d=s;let m=[],p=[];if(n.forEach(h=>{let y=d.find(g=>FN(h,g));y?p.push({existingRoute:y,newRoute:h}):m.push(h)}),m.length>0){let h=wc(m,l,[e||"_","patch",String(d?.length||"0")],i);d.push(...h)}if(o&&p.length>0)for(let h=0;h<p.length;h++){let{existingRoute:y,newRoute:g}=p[h],x=y,[v]=wc([g],l,[],{},!0);Object.assign(x,{element:v.element?v.element:x.element,errorElement:v.errorElement?v.errorElement:x.errorElement,hydrateFallbackElement:v.hydrateFallbackElement?v.hydrateFallbackElement:x.hydrateFallbackElement})}}function FN(e,n){return"id"in e&&"id"in n&&e.id===n.id?!0:e.index===n.index&&e.path===n.path&&e.caseSensitive===n.caseSensitive?(!e.children||e.children.length===0)&&(!n.children||n.children.length===0)?!0:e.children.every((s,i)=>n.children?.some(l=>FN(s,l))):!1}var X0=new WeakMap,zN=({key:e,route:n,manifest:s,mapRouteProperties:i})=>{let l=s[n.id];if(cn(l,"No route found in manifest"),!l.lazy||typeof l.lazy!="object")return;let o=l.lazy[e];if(!o)return;let d=X0.get(l);d||(d={},X0.set(l,d));let m=d[e];if(m)return m;let p=(async()=>{let h=VA(e),g=l[e]!==void 0&&e!=="hasErrorBoundary";if(h)Yn(!h,"Route property "+e+" is not a supported lazy route property. This property will be ignored."),d[e]=Promise.resolve();else if(g)Yn(!1,`Route "${l.id}" has a static property "${e}" defined. The lazy property will be ignored.`);else{let x=await o();x!=null&&(Object.assign(l,{[e]:x}),Object.assign(l,i(l)))}typeof l.lazy=="object"&&(l.lazy[e]=void 0,Object.values(l.lazy).every(x=>x===void 0)&&(l.lazy=void 0))})();return d[e]=p,p},W0=new WeakMap;function _2(e,n,s,i,l){let o=s[e.id];if(cn(o,"No route found in manifest"),!e.lazy)return{lazyRoutePromise:void 0,lazyHandlerPromise:void 0};if(typeof e.lazy=="function"){let y=W0.get(o);if(y)return{lazyRoutePromise:y,lazyHandlerPromise:y};let g=(async()=>{cn(typeof e.lazy=="function","No lazy route function found");let x=await e.lazy(),v={};for(let S in x){let N=x[S];if(N===void 0)continue;let E=GA(S),A=o[S]!==void 0&&S!=="hasErrorBoundary";E?Yn(!E,"Route property "+S+" is not a supported property to be returned from a lazy route function. This property will be ignored."):A?Yn(!A,`Route "${o.id}" has a static property "${S}" defined but its lazy function is also returning a value for this property. The lazy route property "${S}" will be ignored.`):v[S]=N}Object.assign(o,v),Object.assign(o,{...i(o),lazy:void 0})})();return W0.set(o,g),g.catch(()=>{}),{lazyRoutePromise:g,lazyHandlerPromise:g}}let d=Object.keys(e.lazy),m=[],p;for(let y of d){if(l&&l.includes(y))continue;let g=zN({key:y,route:e,manifest:s,mapRouteProperties:i});g&&(m.push(g),y===n&&(p=g))}let h=m.length>0?Promise.all(m).then(()=>{}):void 0;return h?.catch(()=>{}),p?.catch(()=>{}),{lazyRoutePromise:h,lazyHandlerPromise:p}}async function Z0(e){let n=e.matches.filter(l=>l.shouldLoad),s={};return(await Promise.all(n.map(l=>l.resolve()))).forEach((l,o)=>{s[n[o].route.id]=l}),s}async function C2(e){return e.matches.some(n=>n.route.middleware)?BN(e,()=>Z0(e)):Z0(e)}function BN(e,n){return A2(e,n,i=>i,O2,s);function s(i,l,o){if(o)return Promise.resolve(Object.assign(o.value,{[l]:{type:"error",result:i}}));{let{matches:d}=e,m=Math.min(Math.max(d.findIndex(h=>h.route.id===l),0),Math.max(d.findIndex(h=>h.unstable_shouldCallHandler()),0)),p=Xr(d,d[m].route.id).route.id;return Promise.resolve({[p]:{type:"error",result:i}})}}}async function A2(e,n,s,i,l){let{matches:o,request:d,params:m,context:p}=e,h=o.flatMap(g=>g.route.middleware?g.route.middleware.map(x=>[g.route.id,x]):[]);return await UN({request:d,params:m,context:p},h,n,s,i,l)}async function UN(e,n,s,i,l,o,d=0){let{request:m}=e;if(m.signal.aborted)throw m.signal.reason??new Error(`Request aborted: ${m.method} ${m.url}`);let p=n[d];if(!p)return await s();let[h,y]=p,g,x=async()=>{if(g)throw new Error("You may only call `next()` once per middleware");try{return g={value:await UN(e,n,s,i,l,o,d+1)},g.value}catch(v){return g={value:await o(v,h,g)},g.value}};try{let v=await y(e,x),S=v!=null?i(v):void 0;return l(S)?S:g?S??g.value:(g={value:await x()},g.value)}catch(v){return await o(v,h,g)}}function qN(e,n,s,i,l){let o=zN({key:"middleware",route:i.route,manifest:n,mapRouteProperties:e}),d=_2(i.route,Ia(s.method)?"action":"loader",n,e,l);return{middleware:o,route:d.lazyRoutePromise,handler:d.lazyHandlerPromise}}function oy(e,n,s,i,l,o,d,m=null){let p=!1,h=qN(e,n,s,i,l);return{...i,_lazyPromises:h,shouldLoad:d,unstable_shouldRevalidateArgs:m,unstable_shouldCallHandler(y){return p=!0,m?typeof y=="boolean"?Kd(i,{...m,defaultShouldRevalidate:y}):Kd(i,m):d},resolve(y){let{lazy:g,loader:x,middleware:v}=i.route,S=p||d||y&&!Ia(s.method)&&(g||x),N=v&&v.length>0&&!x&&!g;return S&&!N?M2({request:s,match:i,lazyHandlerPromise:h?.handler,lazyRoutePromise:h?.route,handlerOverride:y,scopedContext:o}):Promise.resolve({type:"data",result:void 0})}}}function Ll(e,n,s,i,l,o,d,m=null){return i.map(p=>p.route.id!==l.route.id?{...p,shouldLoad:!1,unstable_shouldRevalidateArgs:m,unstable_shouldCallHandler:()=>!1,_lazyPromises:qN(e,n,s,p,o),resolve:()=>Promise.resolve({type:"data",result:void 0})}:oy(e,n,s,p,o,d,!0,m))}async function T2(e,n,s,i,l,o){s.some(h=>h._lazyPromises?.middleware)&&await Promise.all(s.map(h=>h._lazyPromises?.middleware));let d={request:n,params:s[0].params,context:l,matches:s},p=await e({...d,fetcherKey:i,runClientMiddleware:h=>{let y=d;return BN(y,()=>h({...y,fetcherKey:i,runClientMiddleware:()=>{throw new Error("Cannot call `runClientMiddleware()` from within an `runClientMiddleware` handler")}}))}});try{await Promise.all(s.flatMap(h=>[h._lazyPromises?.handler,h._lazyPromises?.route]))}catch{}return p}async function M2({request:e,match:n,lazyHandlerPromise:s,lazyRoutePromise:i,handlerOverride:l,scopedContext:o}){let d,m,p=Ia(e.method),h=p?"action":"loader",y=g=>{let x,v=new Promise((E,j)=>x=j);m=()=>x(),e.signal.addEventListener("abort",m);let S=E=>typeof g!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${h}" [routeId: ${n.route.id}]`)):g({request:e,params:n.params,context:o},...E!==void 0?[E]:[]),N=(async()=>{try{return{type:"data",result:await(l?l(j=>S(j)):S())}}catch(E){return{type:"error",result:E}}})();return Promise.race([N,v])};try{let g=p?n.route.action:n.route.loader;if(s||i)if(g){let x,[v]=await Promise.all([y(g).catch(S=>{x=S}),s,i]);if(x!==void 0)throw x;d=v}else{await s;let x=p?n.route.action:n.route.loader;if(x)[d]=await Promise.all([y(x),i]);else if(h==="action"){let v=new URL(e.url),S=v.pathname+v.search;throw is(405,{method:e.method,pathname:S,routeId:n.route.id})}else return{type:"data",result:void 0}}else if(g)d=await y(g);else{let x=new URL(e.url),v=x.pathname+x.search;throw is(404,{pathname:v})}}catch(g){return{type:"error",result:g}}finally{m&&e.signal.removeEventListener("abort",m)}return d}async function k2(e){let n=e.headers.get("Content-Type");return n&&/\bapplication\/json\b/.test(n)?e.body==null?null:e.json():e.text()}async function R2(e){let{result:n,type:s}=e;if(HN(n)){let i;try{i=await k2(n)}catch(l){return{type:"error",error:l}}return s==="error"?{type:"error",error:new Gd(n.status,n.statusText,i),statusCode:n.status,headers:n.headers}:{type:"data",data:i,statusCode:n.status,headers:n.headers}}return s==="error"?aS(n)?n.data instanceof Error?{type:"error",error:n.data,statusCode:n.init?.status,headers:n.init?.headers?new Headers(n.init.headers):void 0}:{type:"error",error:new Gd(n.init?.status||500,void 0,n.data),statusCode:Nc(n)?n.status:void 0,headers:n.init?.headers?new Headers(n.init.headers):void 0}:{type:"error",error:n,statusCode:Nc(n)?n.status:void 0}:aS(n)?{type:"data",data:n.data,statusCode:n.init?.status,headers:n.init?.headers?new Headers(n.init.headers):void 0}:{type:"data",data:n}}function I2(e,n,s,i,l){let o=e.headers.get("Location");if(cn(o,"Redirects returned/thrown from loaders/actions must have a Location header"),!Qy(o)){let d=i.slice(0,i.findIndex(m=>m.route.id===s)+1);o=iy(new URL(n.url),d,l,o),e.headers.set("Location",o)}return e}function Q0(e,n,s){if(Qy(e)){let i=e,l=i.startsWith("//")?new URL(n.protocol+i):new URL(i),o=Oa(l.pathname,s)!=null;if(l.origin===n.origin&&o)return l.pathname+l.search+l.hash}return e}function Rl(e,n,s,i){let l=e.createURL(PN(n)).toString(),o={signal:s};if(i&&Ia(i.formMethod)){let{formMethod:d,formEncType:m}=i;o.method=d.toUpperCase(),m==="application/json"?(o.headers=new Headers({"Content-Type":m}),o.body=JSON.stringify(i.json)):m==="text/plain"?o.body=i.text:m==="application/x-www-form-urlencoded"&&i.formData?o.body=cy(i.formData):o.body=i.formData}return new Request(l,o)}function cy(e){let n=new URLSearchParams;for(let[s,i]of e.entries())n.append(s,typeof i=="string"?i:i.name);return n}function J0(e){let n=new FormData;for(let[s,i]of e.entries())n.append(s,i);return n}function D2(e,n,s,i=!1,l=!1){let o={},d=null,m,p=!1,h={},y=s&&Va(s[1])?s[1].error:void 0;return e.forEach(g=>{if(!(g.route.id in n))return;let x=g.route.id,v=n[x];if(cn(!Ai(v),"Cannot handle redirect results in processLoaderData"),Va(v)){let S=v.error;if(y!==void 0&&(S=y,y=void 0),d=d||{},l)d[x]=S;else{let N=Xr(e,x);d[N.route.id]==null&&(d[N.route.id]=S)}i||(o[x]=$N),p||(p=!0,m=Nc(v.error)?v.error.status:500),v.headers&&(h[x]=v.headers)}else o[x]=v.data,v.statusCode&&v.statusCode!==200&&!p&&(m=v.statusCode),v.headers&&(h[x]=v.headers)}),y!==void 0&&s&&(d={[s[0]]:y},s[2]&&(o[s[2]]=void 0)),{loaderData:o,errors:d,statusCode:m||200,loaderHeaders:h}}function eS(e,n,s,i,l,o){let{loaderData:d,errors:m}=D2(n,s,i);return l.filter(p=>!p.matches||p.matches.some(h=>h.shouldLoad)).forEach(p=>{let{key:h,match:y,controller:g}=p;if(g&&g.signal.aborted)return;let x=o[h];if(cn(x,"Did not find corresponding fetcher result"),Va(x)){let v=Xr(e.matches,y?.route.id);m&&m[v.route.id]||(m={...m,[v.route.id]:x.error}),e.fetchers.delete(h)}else if(Ai(x))cn(!1,"Unhandled fetcher revalidation redirect");else{let v=dr(x.data);e.fetchers.set(h,v)}}),{loaderData:d,errors:m}}function tS(e,n,s,i){let l=Object.entries(n).filter(([,o])=>o!==$N).reduce((o,[d,m])=>(o[d]=m,o),{});for(let o of s){let d=o.route.id;if(!n.hasOwnProperty(d)&&e.hasOwnProperty(d)&&o.route.loader&&(l[d]=e[d]),i&&i.hasOwnProperty(d))break}return l}function nS(e){return e?Va(e[1])?{actionData:{}}:{actionData:{[e[0]]:e[1].data}}:{}}function Xr(e,n){return(n?e.slice(0,e.findIndex(i=>i.route.id===n)+1):[...e]).reverse().find(i=>i.route.hasErrorBoundary===!0)||e[0]}function td(e){let n=e.length===1?e[0]:e.find(s=>s.index||!s.path||s.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:n}],route:n}}function is(e,{pathname:n,routeId:s,method:i,type:l,message:o}={}){let d="Unknown Server Error",m="Unknown @remix-run/router error";return e===400?(d="Bad Request",i&&n&&s?m=`You made a ${i} request to "${n}" but did not provide a \`loader\` for route "${s}", so there is no way to handle the request.`:l==="invalid-body"&&(m="Unable to encode submission body")):e===403?(d="Forbidden",m=`Route "${s}" does not match URL "${n}"`):e===404?(d="Not Found",m=`No route matches URL "${n}"`):e===405&&(d="Method Not Allowed",i&&n&&s?m=`You made a ${i.toUpperCase()} request to "${n}" but did not provide an \`action\` for route "${s}", so there is no way to handle the request.`:i&&(m=`Invalid request method "${i.toUpperCase()}"`)),new Gd(e||500,d,new Error(m),!0)}function nd(e){let n=Object.entries(e);for(let s=n.length-1;s>=0;s--){let[i,l]=n[s];if(Ai(l))return{key:i,result:l}}}function PN(e){let n=typeof e=="string"?ai(e):e;return Qr({...n,hash:""})}function L2(e,n){return e.pathname!==n.pathname||e.search!==n.search?!1:e.hash===""?n.hash!=="":e.hash===n.hash?!0:n.hash!==""}function O2(e){return e!=null&&typeof e=="object"&&Object.entries(e).every(([n,s])=>typeof n=="string"&&$2(s))}function $2(e){return e!=null&&typeof e=="object"&&"type"in e&&"result"in e&&(e.type==="data"||e.type==="error")}function F2(e){return HN(e.result)&&g2.has(e.result.status)}function Va(e){return e.type==="error"}function Ai(e){return(e&&e.type)==="redirect"}function aS(e){return typeof e=="object"&&e!=null&&"type"in e&&"data"in e&&"init"in e&&e.type==="DataWithResponseInit"}function HN(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.headers=="object"&&typeof e.body<"u"}function z2(e){return y2.has(e.toUpperCase())}function Ia(e){return h2.has(e.toUpperCase())}function eg(e){return new URLSearchParams(e).getAll("index").some(n=>n==="")}function Rd(e,n){let s=typeof n=="string"?ai(n).search:n.search;if(e[e.length-1].route.index&&eg(s||""))return e[e.length-1];let i=DN(e);return i[i.length-1]}function sS(e){let{formMethod:n,formAction:s,formEncType:i,text:l,formData:o,json:d}=e;if(!(!n||!s||!i)){if(l!=null)return{formMethod:n,formAction:s,formEncType:i,formData:void 0,json:void 0,text:l};if(o!=null)return{formMethod:n,formAction:s,formEncType:i,formData:o,json:void 0,text:void 0};if(d!==void 0)return{formMethod:n,formAction:s,formEncType:i,formData:void 0,json:d,text:void 0}}}function ep(e,n){return n?{state:"loading",location:e,formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text}:{state:"loading",location:e,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function B2(e,n){return{state:"submitting",location:e,formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text}}function Yo(e,n){return e?{state:"loading",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:n}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:n}}function U2(e,n){return{state:"submitting",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:n?n.data:void 0}}function dr(e){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function q2(e,n){try{let s=e.sessionStorage.getItem(ON);if(s){let i=JSON.parse(s);for(let[l,o]of Object.entries(i||{}))o&&Array.isArray(o)&&n.set(l,new Set(o||[]))}}catch{}}function P2(e,n){if(n.size>0){let s={};for(let[i,l]of n)s[i]=[...l];try{e.sessionStorage.setItem(ON,JSON.stringify(s))}catch(i){Yn(!1,`Failed to save applied view transitions in sessionStorage (${i}).`)}}}function H2(){let e,n,s=new Promise((i,l)=>{e=async o=>{i(o);try{await s}catch{}},n=async o=>{l(o);try{await s}catch{}}});return{promise:s,resolve:e,reject:n}}var Bi=u.createContext(null);Bi.displayName="DataRouter";var zc=u.createContext(null);zc.displayName="DataRouterState";u.createContext(!1);var tg=u.createContext({isTransitioning:!1});tg.displayName="ViewTransition";var VN=u.createContext(new Map);VN.displayName="Fetchers";var V2=u.createContext(null);V2.displayName="Await";var _s=u.createContext(null);_s.displayName="Navigation";var gf=u.createContext(null);gf.displayName="Location";var ms=u.createContext({outlet:null,matches:[],isDataRoute:!1});ms.displayName="Route";var ng=u.createContext(null);ng.displayName="RouteError";function Y2(e,{relative:n}={}){cn(Gl(),"useHref() may be used only in the context of a <Router> component.");let{basename:s,navigator:i}=u.useContext(_s),{hash:l,pathname:o,search:d}=Bc(e,{relative:n}),m=o;return s!=="/"&&(m=o==="/"?s:Fs([s,o])),i.createHref({pathname:m,search:d,hash:l})}function Gl(){return u.useContext(gf)!=null}function Xa(){return cn(Gl(),"useLocation() may be used only in the context of a <Router> component."),u.useContext(gf).location}var YN="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function GN(e){u.useContext(_s).static||u.useLayoutEffect(e)}function Mn(){let{isDataRoute:e}=u.useContext(ms);return e?iT():G2()}function G2(){cn(Gl(),"useNavigate() may be used only in the context of a <Router> component.");let e=u.useContext(Bi),{basename:n,navigator:s}=u.useContext(_s),{matches:i}=u.useContext(ms),{pathname:l}=Xa(),o=JSON.stringify(pf(i)),d=u.useRef(!1);return GN(()=>{d.current=!0}),u.useCallback((p,h={})=>{if(Yn(d.current,YN),!d.current)return;if(typeof p=="number"){s.go(p);return}let y=yf(p,JSON.parse(o),l,h.relative==="path");e==null&&n!=="/"&&(y.pathname=y.pathname==="/"?n:Fs([n,y.pathname])),(h.replace?s.replace:s.push)(y,h.state,h)},[n,s,o,l,e])}var K2=u.createContext(null);function X2(e){let n=u.useContext(ms).outlet;return u.useMemo(()=>n&&u.createElement(K2.Provider,{value:e},n),[n,e])}function Wa(){let{matches:e}=u.useContext(ms),n=e[e.length-1];return n?n.params:{}}function Bc(e,{relative:n}={}){let{matches:s}=u.useContext(ms),{pathname:i}=Xa(),l=JSON.stringify(pf(s));return u.useMemo(()=>yf(e,JSON.parse(l),i,n==="path"),[e,l,i,n])}function W2(e,n,s,i,l){cn(Gl(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=u.useContext(_s),{matches:d}=u.useContext(ms),m=d[d.length-1],p=m?m.params:{},h=m?m.pathname:"/",y=m?m.pathnameBase:"/",g=m&&m.route;{let A=g&&g.path||"";ZN(h,!g||A.endsWith("*")||A.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${A}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${A}"> to <Route path="${A==="/"?"*":`${A}/*`}">.`)}let x=Xa(),v;v=x;let S=v.pathname||"/",N=S;if(y!=="/"){let A=y.replace(/^\//,"").split("/");N="/"+S.replace(/^\//,"").split("/").slice(A.length).join("/")}let E=Kr(e,{pathname:N});return Yn(g||E!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),Yn(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),tT(E&&E.map(A=>Object.assign({},A,{params:Object.assign({},p,A.params),pathname:Fs([y,o.encodeLocation?o.encodeLocation(A.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:A.pathname]),pathnameBase:A.pathnameBase==="/"?y:Fs([y,o.encodeLocation?o.encodeLocation(A.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:A.pathnameBase])})),d,s,i,l)}function Z2(){let e=sT(),n=Nc(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),s=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",l={padding:"0.5rem",backgroundColor:i},o={padding:"2px 4px",backgroundColor:i},d=null;return console.error("Error handled by React Router default ErrorBoundary:",e),d=u.createElement(u.Fragment,null,u.createElement("p",null," Hey developer "),u.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",u.createElement("code",{style:o},"ErrorBoundary")," or"," ",u.createElement("code",{style:o},"errorElement")," prop on your route.")),u.createElement(u.Fragment,null,u.createElement("h2",null,"Unexpected Application Error!"),u.createElement("h3",{style:{fontStyle:"italic"}},n),s?u.createElement("pre",{style:l},s):null,d)}var Q2=u.createElement(Z2,null),J2=class extends u.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){this.props.unstable_onError?this.props.unstable_onError(e,n):console.error("React Router caught the following error during render",e)}render(){return this.state.error!==void 0?u.createElement(ms.Provider,{value:this.props.routeContext},u.createElement(ng.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function eT({routeContext:e,match:n,children:s}){let i=u.useContext(Bi);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),u.createElement(ms.Provider,{value:e},s)}function tT(e,n=[],s=null,i=null,l=null){if(e==null){if(!s)return null;if(s.errors)e=s.matches;else if(n.length===0&&!s.initialized&&s.matches.length>0)e=s.matches;else return null}let o=e,d=s?.errors;if(d!=null){let h=o.findIndex(y=>y.route.id&&d?.[y.route.id]!==void 0);cn(h>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(d).join(",")}`),o=o.slice(0,Math.min(o.length,h+1))}let m=!1,p=-1;if(s)for(let h=0;h<o.length;h++){let y=o[h];if((y.route.HydrateFallback||y.route.hydrateFallbackElement)&&(p=h),y.route.id){let{loaderData:g,errors:x}=s,v=y.route.loader&&!g.hasOwnProperty(y.route.id)&&(!x||x[y.route.id]===void 0);if(y.route.lazy||v){m=!0,p>=0?o=o.slice(0,p+1):o=[o[0]];break}}}return o.reduceRight((h,y,g)=>{let x,v=!1,S=null,N=null;s&&(x=d&&y.route.id?d[y.route.id]:void 0,S=y.route.errorElement||Q2,m&&(p<0&&g===0?(ZN("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,N=null):p===g&&(v=!0,N=y.route.hydrateFallbackElement||null)));let E=n.concat(o.slice(0,g+1)),j=()=>{let A;return x?A=S:v?A=N:y.route.Component?A=u.createElement(y.route.Component,null):y.route.element?A=y.route.element:A=h,u.createElement(eT,{match:y,routeContext:{outlet:h,matches:E,isDataRoute:s!=null},children:A})};return s&&(y.route.ErrorBoundary||y.route.errorElement||g===0)?u.createElement(J2,{location:s.location,revalidation:s.revalidation,component:S,error:x,children:j(),routeContext:{outlet:null,matches:E,isDataRoute:!0},unstable_onError:i}):j()},null)}function ag(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function KN(e){let n=u.useContext(Bi);return cn(n,ag(e)),n}function XN(e){let n=u.useContext(zc);return cn(n,ag(e)),n}function nT(e){let n=u.useContext(ms);return cn(n,ag(e)),n}function sg(e){let n=nT(e),s=n.matches[n.matches.length-1];return cn(s.route.id,`${e} can only be used on routes that contain a unique "id"`),s.route.id}function aT(){return sg("useRouteId")}function sT(){let e=u.useContext(ng),n=XN("useRouteError"),s=sg("useRouteError");return e!==void 0?e:n.errors?.[s]}var rT=0;function WN(e){let{router:n,basename:s}=KN("useBlocker"),i=XN("useBlocker"),[l,o]=u.useState(""),d=u.useCallback(m=>{if(typeof e!="function")return!!e;if(s==="/")return e(m);let{currentLocation:p,nextLocation:h,historyAction:y}=m;return e({currentLocation:{...p,pathname:Oa(p.pathname,s)||p.pathname},nextLocation:{...h,pathname:Oa(h.pathname,s)||h.pathname},historyAction:y})},[s,e]);return u.useEffect(()=>{let m=String(++rT);return o(m),()=>n.deleteBlocker(m)},[n]),u.useEffect(()=>{l!==""&&n.getBlocker(l,d)},[n,l,d]),l&&i.blockers.has(l)?i.blockers.get(l):_i}function iT(){let{router:e}=KN("useNavigate"),n=sg("useNavigate"),s=u.useRef(!1);return GN(()=>{s.current=!0}),u.useCallback(async(l,o={})=>{Yn(s.current,YN),s.current&&(typeof l=="number"?e.navigate(l):await e.navigate(l,{fromRouteId:n,...o}))},[e,n])}var rS={};function ZN(e,n,s){!n&&!rS[e]&&(rS[e]=!0,Yn(!1,s))}var iS={};function lS(e,n){!e&&!iS[n]&&(iS[n]=!0,console.warn(n))}function lT(e){let n={hasErrorBoundary:e.hasErrorBoundary||e.ErrorBoundary!=null||e.errorElement!=null};return e.Component&&(e.element&&Yn(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(n,{element:u.createElement(e.Component),Component:void 0})),e.HydrateFallback&&(e.hydrateFallbackElement&&Yn(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(n,{hydrateFallbackElement:u.createElement(e.HydrateFallback),HydrateFallback:void 0})),e.ErrorBoundary&&(e.errorElement&&Yn(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(n,{errorElement:u.createElement(e.ErrorBoundary),ErrorBoundary:void 0})),n}var oT=["HydrateFallback","hydrateFallbackElement"],cT=class{constructor(){this.status="pending",this.promise=new Promise((e,n)=>{this.resolve=s=>{this.status==="pending"&&(this.status="resolved",e(s))},this.reject=s=>{this.status==="pending"&&(this.status="rejected",n(s))}})}};function uT({router:e,flushSync:n,unstable_onError:s}){let[i,l]=u.useState(e.state),[o,d]=u.useState(),[m,p]=u.useState({isTransitioning:!1}),[h,y]=u.useState(),[g,x]=u.useState(),[v,S]=u.useState(),N=u.useRef(new Map),E=u.useCallback(M=>{l(k=>(M.errors&&s&&Object.entries(M.errors).forEach(([C,D])=>{k.errors?.[C]!==D&&s(D)}),M))},[s]),j=u.useCallback((M,{deletedFetchers:k,flushSync:C,viewTransitionOpts:D})=>{M.fetchers.forEach((G,U)=>{G.data!==void 0&&N.current.set(U,G.data)}),k.forEach(G=>N.current.delete(G)),lS(C===!1||n!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let z=e.window!=null&&e.window.document!=null&&typeof e.window.document.startViewTransition=="function";if(lS(D==null||z,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!D||!z){n&&C?n(()=>E(M)):u.startTransition(()=>E(M));return}if(n&&C){n(()=>{g&&(h&&h.resolve(),g.skipTransition()),p({isTransitioning:!0,flushSync:!0,currentLocation:D.currentLocation,nextLocation:D.nextLocation})});let G=e.window.document.startViewTransition(()=>{n(()=>E(M))});G.finished.finally(()=>{n(()=>{y(void 0),x(void 0),d(void 0),p({isTransitioning:!1})})}),n(()=>x(G));return}g?(h&&h.resolve(),g.skipTransition(),S({state:M,currentLocation:D.currentLocation,nextLocation:D.nextLocation})):(d(M),p({isTransitioning:!0,flushSync:!1,currentLocation:D.currentLocation,nextLocation:D.nextLocation}))},[e.window,n,g,h,E]);u.useLayoutEffect(()=>e.subscribe(j),[e,j]),u.useEffect(()=>{m.isTransitioning&&!m.flushSync&&y(new cT)},[m]),u.useEffect(()=>{if(h&&o&&e.window){let M=o,k=h.promise,C=e.window.document.startViewTransition(async()=>{u.startTransition(()=>E(M)),await k});C.finished.finally(()=>{y(void 0),x(void 0),d(void 0),p({isTransitioning:!1})}),x(C)}},[o,h,e.window,E]),u.useEffect(()=>{h&&o&&i.location.key===o.location.key&&h.resolve()},[h,g,i.location,o]),u.useEffect(()=>{!m.isTransitioning&&v&&(d(v.state),p({isTransitioning:!0,flushSync:!1,currentLocation:v.currentLocation,nextLocation:v.nextLocation}),S(void 0))},[m.isTransitioning,v]);let A=u.useMemo(()=>({createHref:e.createHref,encodeLocation:e.encodeLocation,go:M=>e.navigate(M),push:(M,k,C)=>e.navigate(M,{state:k,preventScrollReset:C?.preventScrollReset}),replace:(M,k,C)=>e.navigate(M,{replace:!0,state:k,preventScrollReset:C?.preventScrollReset})}),[e]),T=e.basename||"/",_=u.useMemo(()=>({router:e,navigator:A,static:!1,basename:T,unstable_onError:s}),[e,A,T,s]);return u.createElement(u.Fragment,null,u.createElement(Bi.Provider,{value:_},u.createElement(zc.Provider,{value:i},u.createElement(VN.Provider,{value:N.current},u.createElement(tg.Provider,{value:m},u.createElement(hT,{basename:T,location:i.location,navigationType:i.historyAction,navigator:A},u.createElement(dT,{routes:e.routes,future:e.future,state:i,unstable_onError:s})))))),null)}var dT=u.memo(fT);function fT({routes:e,future:n,state:s,unstable_onError:i}){return W2(e,void 0,s,i,n)}function fc({to:e,replace:n,state:s,relative:i}){cn(Gl(),"<Navigate> may be used only in the context of a <Router> component.");let{static:l}=u.useContext(_s);Yn(!l,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=u.useContext(ms),{pathname:d}=Xa(),m=Mn(),p=yf(e,pf(o),d,i==="path"),h=JSON.stringify(p);return u.useEffect(()=>{m(JSON.parse(h),{replace:n,state:s,relative:i})},[m,h,i,n,s]),null}function mT(e){return X2(e.context)}function Gt(e){cn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function hT({basename:e="/",children:n=null,location:s,navigationType:i="POP",navigator:l,static:o=!1}){cn(!Gl(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=e.replace(/^\/*/,"/"),m=u.useMemo(()=>({basename:d,navigator:l,static:o,future:{}}),[d,l,o]);typeof s=="string"&&(s=ai(s));let{pathname:p="/",search:h="",hash:y="",state:g=null,key:x="default"}=s,v=u.useMemo(()=>{let S=Oa(p,d);return S==null?null:{location:{pathname:S,search:h,hash:y,state:g,key:x},navigationType:i}},[d,p,h,y,g,x,i]);return Yn(v!=null,`<Router basename="${d}"> is not able to match the URL "${p}${h}${y}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:u.createElement(_s.Provider,{value:m},u.createElement(gf.Provider,{children:n,value:v}))}function uy(e,n=[]){let s=[];return u.Children.forEach(e,(i,l)=>{if(!u.isValidElement(i))return;let o=[...n,l];if(i.type===u.Fragment){s.push.apply(s,uy(i.props.children,o));return}cn(i.type===Gt,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),cn(!i.props.index||!i.props.children,"An index route cannot have child routes.");let d={id:i.props.id||o.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(d.children=uy(i.props.children,o)),s.push(d)}),s}var pT=uy,Id="get",Dd="application/x-www-form-urlencoded";function bf(e){return e!=null&&typeof e.tagName=="string"}function yT(e){return bf(e)&&e.tagName.toLowerCase()==="button"}function gT(e){return bf(e)&&e.tagName.toLowerCase()==="form"}function bT(e){return bf(e)&&e.tagName.toLowerCase()==="input"}function xT(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function vT(e,n){return e.button===0&&(!n||n==="_self")&&!xT(e)}function dy(e=""){return new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((n,s)=>{let i=e[s];return n.concat(Array.isArray(i)?i.map(l=>[s,l]):[[s,i]])},[]))}function ST(e,n){let s=dy(e);return n&&n.forEach((i,l)=>{s.has(l)||n.getAll(l).forEach(o=>{s.append(l,o)})}),s}var ad=null;function wT(){if(ad===null)try{new FormData(document.createElement("form"),0),ad=!1}catch{ad=!0}return ad}var NT=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function tp(e){return e!=null&&!NT.has(e)?(Yn(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Dd}"`),null):e}function jT(e,n){let s,i,l,o,d;if(gT(e)){let m=e.getAttribute("action");i=m?Oa(m,n):null,s=e.getAttribute("method")||Id,l=tp(e.getAttribute("enctype"))||Dd,o=new FormData(e)}else if(yT(e)||bT(e)&&(e.type==="submit"||e.type==="image")){let m=e.form;if(m==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let p=e.getAttribute("formaction")||m.getAttribute("action");if(i=p?Oa(p,n):null,s=e.getAttribute("formmethod")||m.getAttribute("method")||Id,l=tp(e.getAttribute("formenctype"))||tp(m.getAttribute("enctype"))||Dd,o=new FormData(m,e),!wT()){let{name:h,type:y,value:g}=e;if(y==="image"){let x=h?`${h}.`:"";o.append(`${x}x`,"0"),o.append(`${x}y`,"0")}else h&&o.append(h,g)}}else{if(bf(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');s=Id,i=null,l=Dd,d=e}return o&&l==="text/plain"&&(d=o,o=void 0),{action:i,method:s.toLowerCase(),encType:l,formData:o,body:d}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function rg(e,n){if(e===!1||e===null||typeof e>"u")throw new Error(n)}function ET(e,n,s){let i=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return i.pathname==="/"?i.pathname=`_root.${s}`:n&&Oa(i.pathname,n)==="/"?i.pathname=`${n.replace(/\/$/,"")}/_root.${s}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${s}`,i}async function _T(e,n){if(e.id in n)return n[e.id];try{let s=await import(e.module);return n[e.id]=s,s}catch(s){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(s),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function CT(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function AT(e,n,s){let i=await Promise.all(e.map(async l=>{let o=n.routes[l.route.id];if(o){let d=await _T(o,s);return d.links?d.links():[]}return[]}));return RT(i.flat(1).filter(CT).filter(l=>l.rel==="stylesheet"||l.rel==="preload").map(l=>l.rel==="stylesheet"?{...l,rel:"prefetch",as:"style"}:{...l,rel:"prefetch"}))}function oS(e,n,s,i,l,o){let d=(p,h)=>s[h]?p.route.id!==s[h].route.id:!0,m=(p,h)=>s[h].pathname!==p.pathname||s[h].route.path?.endsWith("*")&&s[h].params["*"]!==p.params["*"];return o==="assets"?n.filter((p,h)=>d(p,h)||m(p,h)):o==="data"?n.filter((p,h)=>{let y=i.routes[p.route.id];if(!y||!y.hasLoader)return!1;if(d(p,h)||m(p,h))return!0;if(p.route.shouldRevalidate){let g=p.route.shouldRevalidate({currentUrl:new URL(l.pathname+l.search+l.hash,window.origin),currentParams:s[0]?.params||{},nextUrl:new URL(e,window.origin),nextParams:p.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function TT(e,n,{includeHydrateFallback:s}={}){return MT(e.map(i=>{let l=n.routes[i.route.id];if(!l)return[];let o=[l.module];return l.clientActionModule&&(o=o.concat(l.clientActionModule)),l.clientLoaderModule&&(o=o.concat(l.clientLoaderModule)),s&&l.hydrateFallbackModule&&(o=o.concat(l.hydrateFallbackModule)),l.imports&&(o=o.concat(l.imports)),o}).flat(1))}function MT(e){return[...new Set(e)]}function kT(e){let n={},s=Object.keys(e).sort();for(let i of s)n[i]=e[i];return n}function RT(e,n){let s=new Set;return new Set(n),e.reduce((i,l)=>{let o=JSON.stringify(kT(l));return s.has(o)||(s.add(o),i.push({key:o,link:l})),i},[])}function QN(){let e=u.useContext(Bi);return rg(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function IT(){let e=u.useContext(zc);return rg(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var ig=u.createContext(void 0);ig.displayName="FrameworkContext";function JN(){let e=u.useContext(ig);return rg(e,"You must render this element inside a <HydratedRouter> element"),e}function DT(e,n){let s=u.useContext(ig),[i,l]=u.useState(!1),[o,d]=u.useState(!1),{onFocus:m,onBlur:p,onMouseEnter:h,onMouseLeave:y,onTouchStart:g}=n,x=u.useRef(null);u.useEffect(()=>{if(e==="render"&&d(!0),e==="viewport"){let N=j=>{j.forEach(A=>{d(A.isIntersecting)})},E=new IntersectionObserver(N,{threshold:.5});return x.current&&E.observe(x.current),()=>{E.disconnect()}}},[e]),u.useEffect(()=>{if(i){let N=setTimeout(()=>{d(!0)},100);return()=>{clearTimeout(N)}}},[i]);let v=()=>{l(!0)},S=()=>{l(!1),d(!1)};return s?e!=="intent"?[o,x,{}]:[o,x,{onFocus:Go(m,v),onBlur:Go(p,S),onMouseEnter:Go(h,v),onMouseLeave:Go(y,S),onTouchStart:Go(g,v)}]:[!1,x,{}]}function Go(e,n){return s=>{e&&e(s),s.defaultPrevented||n(s)}}function LT({page:e,...n}){let{router:s}=QN(),i=u.useMemo(()=>Kr(s.routes,e,s.basename),[s.routes,e,s.basename]);return i?u.createElement($T,{page:e,matches:i,...n}):null}function OT(e){let{manifest:n,routeModules:s}=JN(),[i,l]=u.useState([]);return u.useEffect(()=>{let o=!1;return AT(e,n,s).then(d=>{o||l(d)}),()=>{o=!0}},[e,n,s]),i}function $T({page:e,matches:n,...s}){let i=Xa(),{manifest:l,routeModules:o}=JN(),{basename:d}=QN(),{loaderData:m,matches:p}=IT(),h=u.useMemo(()=>oS(e,n,p,l,i,"data"),[e,n,p,l,i]),y=u.useMemo(()=>oS(e,n,p,l,i,"assets"),[e,n,p,l,i]),g=u.useMemo(()=>{if(e===i.pathname+i.search+i.hash)return[];let S=new Set,N=!1;if(n.forEach(j=>{let A=l.routes[j.route.id];!A||!A.hasLoader||(!h.some(T=>T.route.id===j.route.id)&&j.route.id in m&&o[j.route.id]?.shouldRevalidate||A.hasClientLoader?N=!0:S.add(j.route.id))}),S.size===0)return[];let E=ET(e,d,"data");return N&&S.size>0&&E.searchParams.set("_routes",n.filter(j=>S.has(j.route.id)).map(j=>j.route.id).join(",")),[E.pathname+E.search]},[d,m,i,l,h,n,e,o]),x=u.useMemo(()=>TT(y,l),[y,l]),v=OT(y);return u.createElement(u.Fragment,null,g.map(S=>u.createElement("link",{key:S,rel:"prefetch",as:"fetch",href:S,...s})),x.map(S=>u.createElement("link",{key:S,rel:"modulepreload",href:S,...s})),v.map(({key:S,link:N})=>u.createElement("link",{key:S,nonce:s.nonce,...N})))}function FT(...e){return n=>{e.forEach(s=>{typeof s=="function"?s(n):s!=null&&(s.current=n)})}}var ej=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{ej&&(window.__reactRouterVersion="7.9.3")}catch{}function zT(e,n){return w2({basename:n?.basename,getContext:n?.getContext,future:n?.future,history:UA({window:n?.window}),hydrationData:BT(),routes:e,mapRouteProperties:lT,hydrationRouteProperties:oT,dataStrategy:n?.dataStrategy,patchRoutesOnNavigation:n?.patchRoutesOnNavigation,window:n?.window}).initialize()}function BT(){let e=window?.__staticRouterHydrationData;return e&&e.errors&&(e={...e,errors:UT(e.errors)}),e}function UT(e){if(!e)return null;let n=Object.entries(e),s={};for(let[i,l]of n)if(l&&l.__type==="RouteErrorResponse")s[i]=new Gd(l.status,l.statusText,l.data,l.internal===!0);else if(l&&l.__type==="Error"){if(l.__subType){let o=window[l.__subType];if(typeof o=="function")try{let d=new o(l.message);d.stack="",s[i]=d}catch{}}if(s[i]==null){let o=new Error(l.message);o.stack="",s[i]=o}}else s[i]=l;return s}var tj=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Yt=u.forwardRef(function({onClick:n,discover:s="render",prefetch:i="none",relative:l,reloadDocument:o,replace:d,state:m,target:p,to:h,preventScrollReset:y,viewTransition:g,...x},v){let{basename:S}=u.useContext(_s),N=typeof h=="string"&&tj.test(h),E,j=!1;if(typeof h=="string"&&N&&(E=h,ej))try{let z=new URL(window.location.href),G=h.startsWith("//")?new URL(z.protocol+h):new URL(h),U=Oa(G.pathname,S);G.origin===z.origin&&U!=null?h=U+G.search+G.hash:j=!0}catch{Yn(!1,`<Link to="${h}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let A=Y2(h,{relative:l}),[T,_,M]=DT(i,x),k=VT(h,{replace:d,state:m,target:p,preventScrollReset:y,relative:l,viewTransition:g});function C(z){n&&n(z),z.defaultPrevented||k(z)}let D=u.createElement("a",{...x,...M,href:E||A,onClick:j||o?n:C,ref:FT(v,_),target:p,"data-discover":!N&&s==="render"?"true":void 0});return T&&!N?u.createElement(u.Fragment,null,D,u.createElement(LT,{page:A})):D});Yt.displayName="Link";var qT=u.forwardRef(function({"aria-current":n="page",caseSensitive:s=!1,className:i="",end:l=!1,style:o,to:d,viewTransition:m,children:p,...h},y){let g=Bc(d,{relative:h.relative}),x=Xa(),v=u.useContext(zc),{navigator:S,basename:N}=u.useContext(_s),E=v!=null&&ZT(g)&&m===!0,j=S.encodeLocation?S.encodeLocation(g).pathname:g.pathname,A=x.pathname,T=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;s||(A=A.toLowerCase(),T=T?T.toLowerCase():null,j=j.toLowerCase()),T&&N&&(T=Oa(T,N)||T);const _=j!=="/"&&j.endsWith("/")?j.length-1:j.length;let M=A===j||!l&&A.startsWith(j)&&A.charAt(_)==="/",k=T!=null&&(T===j||!l&&T.startsWith(j)&&T.charAt(j.length)==="/"),C={isActive:M,isPending:k,isTransitioning:E},D=M?n:void 0,z;typeof i=="function"?z=i(C):z=[i,M?"active":null,k?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let G=typeof o=="function"?o(C):o;return u.createElement(Yt,{...h,"aria-current":D,className:z,ref:y,style:G,to:d,viewTransition:m},typeof p=="function"?p(C):p)});qT.displayName="NavLink";var PT=u.forwardRef(({discover:e="render",fetcherKey:n,navigate:s,reloadDocument:i,replace:l,state:o,method:d=Id,action:m,onSubmit:p,relative:h,preventScrollReset:y,viewTransition:g,...x},v)=>{let S=KT(),N=XT(m,{relative:h}),E=d.toLowerCase()==="get"?"get":"post",j=typeof m=="string"&&tj.test(m),A=T=>{if(p&&p(T),T.defaultPrevented)return;T.preventDefault();let _=T.nativeEvent.submitter,M=_?.getAttribute("formmethod")||d;S(_||T.currentTarget,{fetcherKey:n,method:M,navigate:s,replace:l,state:o,relative:h,preventScrollReset:y,viewTransition:g})};return u.createElement("form",{ref:v,method:E,action:N,onSubmit:i?p:A,...x,"data-discover":!j&&e==="render"?"true":void 0})});PT.displayName="Form";function HT(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function nj(e){let n=u.useContext(Bi);return cn(n,HT(e)),n}function VT(e,{target:n,replace:s,state:i,preventScrollReset:l,relative:o,viewTransition:d}={}){let m=Mn(),p=Xa(),h=Bc(e,{relative:o});return u.useCallback(y=>{if(vT(y,n)){y.preventDefault();let g=s!==void 0?s:Qr(p)===Qr(h);m(e,{replace:g,state:i,preventScrollReset:l,relative:o,viewTransition:d})}},[p,m,h,s,i,n,e,l,o,d])}function aj(e){Yn(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let n=u.useRef(dy(e)),s=u.useRef(!1),i=Xa(),l=u.useMemo(()=>ST(i.search,s.current?null:n.current),[i.search]),o=Mn(),d=u.useCallback((m,p)=>{const h=dy(typeof m=="function"?m(new URLSearchParams(l)):m);s.current=!0,o("?"+h,p)},[o,l]);return[l,d]}var YT=0,GT=()=>`__${String(++YT)}__`;function KT(){let{router:e}=nj("useSubmit"),{basename:n}=u.useContext(_s),s=aT();return u.useCallback(async(i,l={})=>{let{action:o,method:d,encType:m,formData:p,body:h}=jT(i,n);if(l.navigate===!1){let y=l.fetcherKey||GT();await e.fetch(y,s,l.action||o,{preventScrollReset:l.preventScrollReset,formData:p,body:h,formMethod:l.method||d,formEncType:l.encType||m,flushSync:l.flushSync})}else await e.navigate(l.action||o,{preventScrollReset:l.preventScrollReset,formData:p,body:h,formMethod:l.method||d,formEncType:l.encType||m,replace:l.replace,state:l.state,fromRouteId:s,flushSync:l.flushSync,viewTransition:l.viewTransition})},[e,n,s])}function XT(e,{relative:n}={}){let{basename:s}=u.useContext(_s),i=u.useContext(ms);cn(i,"useFormAction must be used inside a RouteContext");let[l]=i.matches.slice(-1),o={...Bc(e||".",{relative:n})},d=Xa();if(e==null){o.search=d.search;let m=new URLSearchParams(o.search),p=m.getAll("index");if(p.some(y=>y==="")){m.delete("index"),p.filter(g=>g).forEach(g=>m.append("index",g));let y=m.toString();o.search=y?`?${y}`:""}}return(!e||e===".")&&l.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),s!=="/"&&(o.pathname=o.pathname==="/"?s:Fs([s,o.pathname])),Qr(o)}function sj(e,n){let{capture:s}=n||{};u.useEffect(()=>{let i=s!=null?{capture:s}:void 0;return window.addEventListener("beforeunload",e,i),()=>{window.removeEventListener("beforeunload",e,i)}},[e,s])}function WT({when:e,message:n}){let s=WN(e);u.useEffect(()=>{s.state==="blocked"&&(window.confirm(n)?setTimeout(s.proceed,0):s.reset())},[s,n]),u.useEffect(()=>{s.state==="blocked"&&!e&&s.reset()},[s,e])}function ZT(e,{relative:n}={}){let s=u.useContext(tg);cn(s!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=nj("useViewTransitionState"),l=Bc(e,{relative:n});if(!s.isTransitioning)return!1;let o=Oa(s.currentLocation.pathname,i)||s.currentLocation.pathname,d=Oa(s.nextLocation.pathname,i)||s.nextLocation.pathname;return Yd(l.pathname,d)!=null||Yd(l.pathname,o)!=null}var Kl=TN();const rj=zi(Kl);function QT(e){return u.createElement(uT,{flushSync:Kl.flushSync,...e})}/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JT=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),eM=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(n,s,i)=>i?i.toUpperCase():s.toLowerCase()),cS=e=>{const n=eM(e);return n.charAt(0).toUpperCase()+n.slice(1)},ij=(...e)=>e.filter((n,s,i)=>!!n&&n.trim()!==""&&i.indexOf(n)===s).join(" ").trim(),tM=e=>{for(const n in e)if(n.startsWith("aria-")||n==="role"||n==="title")return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var nM={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aM=u.forwardRef(({color:e="currentColor",size:n=24,strokeWidth:s=2,absoluteStrokeWidth:i,className:l="",children:o,iconNode:d,...m},p)=>u.createElement("svg",{ref:p,...nM,width:n,height:n,stroke:e,strokeWidth:i?Number(s)*24/Number(n):s,className:ij("lucide",l),...!o&&!tM(m)&&{"aria-hidden":"true"},...m},[...d.map(([h,y])=>u.createElement(h,y)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=(e,n)=>{const s=u.forwardRef(({className:i,...l},o)=>u.createElement(aM,{ref:o,iconNode:n,className:ij(`lucide-${JT(cS(e))}`,`lucide-${e}`,i),...l}));return s.displayName=cS(e),s};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sM=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],uS=Bt("arrow-down",sM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rM=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],jc=Bt("arrow-left",rM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iM=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],lj=Bt("arrow-right",iM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lM=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],fy=Bt("arrow-up",lM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oM=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}]],xf=Bt("bell-ring",oM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cM=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Bl=Bt("bell",cM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uM=[["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M14 7a4 4 0 0 1 4 4v3a6 6 0 0 1-12 0v-3a4 4 0 0 1 4-4z",key:"uouzyp"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M21 21a4 4 0 0 0-3.81-4",key:"1b0z45"}],["path",{d:"M21 5a4 4 0 0 1-3.55 3.97",key:"5cxbf6"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M3 21a4 4 0 0 1 3.81-4",key:"1fjd4g"}],["path",{d:"M3 5a4 4 0 0 0 3.55 3.97",key:"1d7oge"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M9 7.13V6a3 3 0 1 1 6 0v1.13",key:"1vgav8"}]],lg=Bt("bug",uM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dM=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],dS=Bt("calendar-days",dM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fM=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],mM=Bt("check-check",fM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hM=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],oj=Bt("check",hM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pM=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Ls=Bt("chevron-down",pM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yM=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Jr=Bt("chevron-right",yM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Jn=Bt("circle-alert",gM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],vf=Bt("circle-check",bM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xM=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],vM=Bt("circle-play",xM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SM=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],og=Bt("clock",SM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wM=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],fS=Bt("cloud-upload",wM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NM=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],jM=Bt("crown",NM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EM=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],mS=Bt("database",EM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _M=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],CM=Bt("download",_M);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AM=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],hS=Bt("external-link",AM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TM=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],cj=Bt("eye",TM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MM=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],kM=Bt("file-check",MM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RM=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],my=Bt("file-text",RM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IM=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Sf=Bt("funnel",IM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DM=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],LM=Bt("grip-vertical",DM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OM=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],uj=Bt("history",OM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $M=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],FM=Bt("image",$M);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Uc=Bt("info",zM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BM=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],dj=Bt("layers",BM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UM=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],pS=Bt("link-2",UM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qM=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],fj=Bt("list-checks",qM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PM=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],Xd=Bt("list",PM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HM=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],mn=Bt("loader-circle",HM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VM=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],YM=Bt("log-out",VM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GM=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],KM=Bt("lock",GM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XM=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Wd=Bt("map-pin",XM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WM=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],ZM=Bt("maximize-2",WM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QM=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],JM=Bt("menu",QM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ek=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],tk=Bt("message-square",ek);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nk=[["path",{d:"M5 12h14",key:"1ays0h"}]],cg=Bt("minus",nk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ak=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],sk=Bt("moon",ak);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rk=[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]],hy=Bt("notebook-pen",rk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ik=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],lk=Bt("pen-line",ik);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ok=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],mj=Bt("pen",ok);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ck=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Ga=Bt("pencil",ck);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uk=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],dk=Bt("pin",uk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fk=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],sa=Bt("plus",fk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mk=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Ui=Bt("rotate-ccw",mk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hk=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],yS=Bt("save",hk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pk=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Ec=Bt("search",pk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yk=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],gk=Bt("send",yk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bk=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],hj=Bt("settings",bk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xk=[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]],vk=Bt("shapes",xk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sk=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],pj=Bt("shield-check",Sk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wk=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M9 12h6",key:"1c52cq"}],["path",{d:"M12 9v6",key:"199k2o"}]],Nk=Bt("shield-plus",wk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jk=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],Ek=Bt("sliders-horizontal",jk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _k=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],qi=Bt("sparkles",_k);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ck=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Ak=Bt("sun",Ck);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tk=[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5",key:"hbey2j"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18",key:"1hf58s"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20",key:"pidxm4"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21",key:"1pehsh"}]],Mk=Bt("swords",Tk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kk=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],ug=Bt("target",kk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rk=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],zn=Bt("trash-2",Rk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ik=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Da=Bt("triangle-alert",Ik);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dk=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Lk=Bt("upload",Dk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ok=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],yj=Bt("users",Ok);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $k=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Fk=Bt("user",$k);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zk=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],Bk=Bt("workflow",zk);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uk=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ea=Bt("x",Uk),sn="http://ttrdb.eu-west-2.elasticbeanstalk.com/api".replace(/\/$/,"")||"http://localhost:3000/api",qk=Object.freeze(Object.defineProperty({__proto__:null,API_BASE:sn},Symbol.toStringTag,{value:"Module"})),gj=u.createContext(null);function Pk({children:e}){const[n,s]=u.useState(null),[i,l]=u.useState(null),[o,d]=u.useState(!1);u.useEffect(()=>{try{const h=localStorage.getItem("gamedb_session");if(h){const y=JSON.parse(h);y?.user&&y?.token?(s(y.user),l(y.token)):(console.warn(" Incomplete session found, clearing..."),localStorage.removeItem("gamedb_session"))}}catch(h){console.warn(" Invalid stored session, clearing...",h),localStorage.removeItem("gamedb_session")}finally{d(!0)}},[]),u.useEffect(()=>{o&&(i&&n?localStorage.setItem("gamedb_session",JSON.stringify({user:n,token:i})):localStorage.removeItem("gamedb_session"))},[i,n,o]);const m=async(h,y)=>{try{const x=await(await fetch(`${sn}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:h,password:y})})).json();if(console.log(" Raw login response:",x),!x.success||!x.token)throw new Error(x.message||"Invalid credentials");return s(x.user),l(x.token),localStorage.setItem("gamedb_session",JSON.stringify({user:x.user,token:x.token})),console.log(" Login successful:",x.user),!0}catch(g){return console.error(" Login error:",g.message),alert(`Login failed: ${g.message}`),!1}},p=()=>{s(null),l(null),localStorage.removeItem("gamedb_session")};return o?t.jsx(gj.Provider,{value:{user:n,token:i,sessionReady:o,login:m,logout:p},children:e}):t.jsx("div",{className:"loading-screen",children:"Loading session..."})}function un(){return u.useContext(gj)}function qs(){try{return JSON.parse(localStorage.getItem("gamedb_session"))?.token||null}catch{return null}}async function Hk(e=5,n=200){for(let s=0;s<e;s++){const i=qs();if(i)return i;await new Promise(l=>setTimeout(l,n))}return null}async function Ps(){const e=await Hk();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function Hs(e,n="request"){if(e.status===401)throw console.warn(` Unauthorized during ${n}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const s=await e.text();throw new Error(`Failed to ${n}: ${e.status} ${s}`)}return e.json()}async function qc(e={}){const n=await Ps(),s=new URLSearchParams;Object.entries(e).forEach(([d,m])=>{m!=null&&m!==""&&s.set(d,m)});const i=s.toString(),l=i?`${sn}/campaigns?${i}`:`${sn}/campaigns`,o=await fetch(l,{headers:n});return Hs(o,"fetch campaigns")}async function Vk(e){const n=await Ps(),s=await fetch(`${sn}/campaigns`,{method:"POST",headers:n,body:JSON.stringify(e)});return Hs(s,"create campaign")}async function Yk(e,n){const s=await Ps(),i=await fetch(`${sn}/campaigns/${e}`,{method:"PUT",headers:s,body:JSON.stringify(n)});return Hs(i,"update campaign")}async function Gk(e){const n=await Ps(),s=await fetch(`${sn}/campaigns/${e}`,{method:"DELETE",headers:n});return Hs(s,"delete campaign")}async function Kk(e,n={}){if(!e)throw new Error("campaignId is required to fetch notes");const s=await Ps(),i=new URLSearchParams;Object.entries(n).forEach(([m,p])=>{if(!(p==null||p==="")){if(Array.isArray(p)){p.map(h=>h==null?"":String(h)).filter(h=>h.trim()!=="").forEach(h=>{i.append(`${m}[]`,h)});return}i.set(m,p)}});const l=i.toString(),o=`${sn}/campaigns/${e}/entity-notes${l?`?${l}`:""}`,d=await fetch(o,{headers:s});return Hs(d,"fetch campaign entity notes")}async function Xk(e,n={}){if(!e)throw new Error("campaignId is required to fetch notes");const s=await Ps(),i=new URLSearchParams;Object.entries(n).forEach(([m,p])=>{if(!(p==null||p==="")){if(Array.isArray(p)){p.map(h=>h==null?"":String(h)).filter(h=>h.trim()!=="").forEach(h=>{i.append(`${m}[]`,h)});return}i.set(m,p)}});const l=i.toString(),o=`${sn}/campaigns/${e}/location-notes${l?`?${l}`:""}`,d=await fetch(o,{headers:s});return Hs(d,"fetch campaign location notes")}async function Wk(e){if(!e)throw new Error("campaignId is required to fetch session notes");const n=await Ps(),s=`${sn}/campaigns/${e}/session-notes`,i=await fetch(s,{headers:n});return Hs(i,"fetch campaign session notes")}async function Zk(e,n={}){if(!e)throw new Error("campaignId is required to create a session note");const s=await Ps(),i=await fetch(`${sn}/campaigns/${e}/session-notes`,{method:"POST",headers:s,body:JSON.stringify(n)});return Hs(i,"create session note")}async function Qk(e,n,s={}){if(!e)throw new Error("campaignId is required to update a session note");if(!n)throw new Error("noteId is required to update a session note");const i=await Ps(),l=await fetch(`${sn}/campaigns/${e}/session-notes/${n}`,{method:"PUT",headers:i,body:JSON.stringify(s)});return Hs(l,"update session note")}async function Jk(e,n){if(!e)throw new Error("campaignId is required to delete a session note");if(!n)throw new Error("noteId is required to delete a session note");const s=await Ps(),i=await fetch(`${sn}/campaigns/${e}/session-notes/${n}`,{method:"DELETE",headers:s});return Hs(i,"delete session note")}async function eR(e=5,n=200){for(let s=0;s<e;s++){const i=qs();if(i)return i;await new Promise(l=>setTimeout(l,n))}return null}async function wf(){const e=await eR();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function Nf(e,n="request"){if(e.status===401)throw console.warn(` Unauthorized during ${n}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const s=await e.text();throw new Error(`Failed to ${n}: ${e.status} ${s}`)}return e.json()}async function Xl(){const e=await wf(),n=await fetch(`${sn}/worlds`,{headers:e});return Nf(n,"fetch worlds")}async function tR(e){const n=await wf(),s=await fetch(`${sn}/worlds`,{method:"POST",headers:n,body:JSON.stringify(e)});return Nf(s,"create world")}async function nR(e,n){const s=await wf(),i=await fetch(`${sn}/worlds/${e}`,{method:"PUT",headers:s,body:JSON.stringify(n)});return Nf(i,"update world")}async function aR(e){const n=await wf(),s=await fetch(`${sn}/worlds/${e}`,{method:"DELETE",headers:n});return Nf(s,"delete world")}const bj=u.createContext(null),Ld="gamedb_campaign_context",sR=new Set(["dm","player"]),Ko=(e,n)=>{if(typeof window>"u")return;const s=e?String(e):"",i=s?"":n?String(n):"";try{s?localStorage.setItem(Ld,JSON.stringify({type:"campaign",id:s})):i?localStorage.setItem(Ld,JSON.stringify({type:"world",id:i})):localStorage.removeItem(Ld)}catch(l){console.warn(" Unable to persist campaign context",l)}},rR=e=>{if(!e||typeof e!="string")return{type:"",id:""};try{const n=JSON.parse(e);if(n&&typeof n=="object"){const s=n.type==="world"?"world":"campaign",i=n.id?String(n.id):"";if(i)return{type:s,id:i}}}catch{if(e.trim())return{type:"campaign",id:e.trim()}}return e.trim()?{type:"campaign",id:e.trim()}:{type:"",id:""}},iR=(e,n)=>Array.isArray(e)?n?n.role==="system_admin"?e:e.filter(s=>Array.isArray(s?.members)&&s.members.some(i=>i?.user_id===n.id&&sR.has(i?.role))):[]:[];function lR({children:e}){const{user:n,sessionReady:s}=un(),[i,l]=u.useState([]),[o,d]=u.useState(!1),[m,p]=u.useState(""),[h,y]=u.useState(""),[g,x]=u.useState([]),[v,S]=u.useState(!1),[N,E]=u.useState(""),[j,A]=u.useState(""),[T,_]=u.useState(""),[M,k]=u.useState(!1);u.useEffect(()=>{if(s)try{const F=localStorage.getItem(Ld);if(!F){y(""),A("");return}const{type:H,id:I}=rR(F);H==="world"?(A(I),y("")):H==="campaign"?(y(I),A("")):(y(""),A(""))}catch(F){console.warn(" Unable to restore campaign context",F),y(""),A("")}finally{k(!0)}},[s]),u.useEffect(()=>{!s||!M||Ko(h,j)},[h,j,s,M]);const C=u.useCallback(async()=>{if(!s||!n)return l([]),p(""),[];d(!0),p("");try{const F=await qc(),H=Array.isArray(F?.data)?F.data:Array.isArray(F)?F:[],I=iR(H,n);return l(I),y(Y=>Y&&I.some(K=>String(K.id)===String(Y))?Y:""),I}catch(F){return console.error(" Failed to load campaigns",F),p(F.message||"Failed to load campaigns"),l([]),[]}finally{d(!1)}},[s,n]),D=u.useCallback(async()=>{if(!s||!n)return x([]),E(""),[];S(!0),E("");try{const F=await Xl(),H=Array.isArray(F?.data)?F.data:Array.isArray(F)?F:[];return x(H),A(I=>I&&H.some(P=>String(P.id)===String(I))?I:""),H}catch(F){return console.error(" Failed to load worlds",F),E(F.message||"Failed to load worlds"),x([]),[]}finally{S(!1)}},[s,n]);u.useEffect(()=>{if(!(!s||!M)){if(!n){l([]),y(""),p(""),d(!1),x([]),A(""),E(""),S(!1);return}C(),D()}},[s,M,n,C,D]);const z=u.useCallback(F=>{const H=F==null?"":String(F);y(H),H?(A(""),_(""),Ko(H,"")):Ko("","")},[]),G=u.useCallback(F=>{const H=F==null?"":String(F);A(H),H?(y(""),_(""),Ko("",H)):Ko("","")},[]);u.useEffect(()=>{_("")},[h]);const U=u.useCallback(F=>{const H=F==null?"":String(F);_(H)},[]),X=u.useMemo(()=>h&&i.find(F=>String(F.id)===String(h))||null,[i,h]),V=u.useMemo(()=>j&&g.find(F=>String(F.id)===String(j))||null,[g,j]),R=u.useMemo(()=>h?"campaign":j?"world":"",[h,j]),B=u.useMemo(()=>R==="world"&&V?V:X?.world?X.world:V,[R,V,X]),L=u.useMemo(()=>B?.id?String(B.id):"",[B]),O=u.useMemo(()=>`${R||"none"}:${h||j||""||"none"}:${L||"none"}:${T||"none"}`,[h,j,R,L,T]),$=u.useMemo(()=>({campaigns:i,selectedCampaign:X,selectedCampaignId:h,setSelectedCampaignId:z,worlds:g,worldLoading:v,worldError:N,selectedWorld:V,selectedWorldId:j,setSelectedWorldId:G,viewAsCharacterId:T,setViewAsCharacterId:U,selectedContextType:R,activeWorld:B,activeWorldId:L,contextKey:O,loading:o,error:m,refreshCampaigns:C,refreshWorlds:D}),[i,X,h,z,g,v,N,V,j,G,T,U,R,B,L,O,o,m,C,D]);return t.jsx(bj.Provider,{value:$,children:e})}function jn(){const e=u.useContext(bj);if(!e)throw new Error("useCampaignContext must be used within a CampaignProvider");return e}const xj=u.createContext(null),oR=()=>{if(typeof window>"u")return"light";const e=window.localStorage.getItem("theme");return e==="light"||e==="dark"?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"};function cR({children:e}){const[n,s]=u.useState(oR);u.useEffect(()=>{typeof document>"u"||(document.body.classList.remove("theme-light","theme-dark"),document.body.classList.add(n==="dark"?"theme-dark":"theme-light"),document.documentElement.setAttribute("data-theme",n),window.localStorage.setItem("theme",n))},[n]),u.useEffect(()=>{if(typeof window>"u")return;const l=window.matchMedia("(prefers-color-scheme: dark)"),o=d=>{s(d.matches?"dark":"light")};if(!window.localStorage.getItem("theme"))return l.addEventListener("change",o),()=>l.removeEventListener("change",o)},[]);const i=u.useMemo(()=>({theme:n,setTheme:s,toggleTheme:()=>s(l=>l==="dark"?"light":"dark")}),[n]);return t.jsx(xj.Provider,{value:i,children:e})}function uR(){const e=u.useContext(xj);if(!e)throw new Error("useTheme must be used within a ThemeProvider");return e}const dR=768;function Wl(e=dR){const[n,s]=u.useState(()=>typeof window>"u"?!1:window.matchMedia(`(max-width: ${e}px)`).matches);return u.useEffect(()=>{if(typeof window>"u")return;const i=window.matchMedia(`(max-width: ${e}px)`),l=o=>{s(o.matches)};return s(i.matches),typeof i.addEventListener=="function"?(i.addEventListener("change",l),()=>i.removeEventListener("change",l)):(i.addListener(l),()=>i.removeListener(l))},[e]),n}async function fR(e=5,n=200){for(let s=0;s<e;s++){const i=qs();if(i)return i;await new Promise(l=>setTimeout(l,n))}return null}async function jf(){const e=await fR();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function Ef(e,n="request"){if(e.status===401)throw console.warn(` Unauthorized during ${n}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const s=await e.text();throw new Error(`Failed to ${n}: ${e.status} ${s}`)}return e.json()}async function js(e={}){const n=await jf(),s=new URLSearchParams;Object.entries(e).forEach(([d,m])=>{m!=null&&m!==""&&s.set(d,m)});const i=s.toString(),l=i?`${sn}/characters?${i}`:`${sn}/characters`,o=await fetch(l,{headers:n});return Ef(o,"fetch characters")}async function mR(e){const n=await jf(),s=await fetch(`${sn}/characters`,{method:"POST",headers:n,body:JSON.stringify(e)});return Ef(s,"create character")}async function hR(e,n){const s=await jf(),i=await fetch(`${sn}/characters/${e}`,{method:"PUT",headers:s,body:JSON.stringify(n)});return Ef(i,"update character")}async function pR(e){const n=await jf(),s=await fetch(`${sn}/characters/${e}`,{method:"DELETE",headers:n});return Ef(s,"delete character")}const gS="drawer-panel-open",yR=300,np={sm:"360px",md:"420px",lg:"560px"},gR=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])",'[tabindex]:not([tabindex="-1"])'],bR=()=>{const e=document.createElement("div");return e.className="drawer-portal-container",e},xR=(e,n)=>e?typeof e=="number"?`${e}px`:String(e):n&&np[n]?np[n]:np.md;function Bs({isOpen:e,onClose:n,title:s,description:i,children:l,footer:o,footerActions:d,width:m,size:p="md",labelledBy:h,closeLabel:y="Close panel",className:g="",mobileFull:x=!0}){const v=u.useRef(null),S=u.useRef(null),N=u.useRef(null),E=u.useRef(null),[j,A]=u.useState(e),[T,_]=u.useState(!1),M=u.useMemo(()=>h||`drawer-${Math.random().toString(36).slice(2)}`,[h]),k=i?`${M}-description`:void 0,C=xR(m,p);if(u.useEffect(()=>(v.current||(v.current=bR(),document.body.appendChild(v.current)),()=>{v.current&&v.current.parentNode&&v.current.parentNode.removeChild(v.current),v.current=null}),[]),u.useEffect(()=>e?(E.current&&(clearTimeout(E.current),E.current=null),A(!0),_(!1),()=>{}):j?(_(!0),E.current=setTimeout(()=>{A(!1),_(!1),E.current=null},yR),()=>{E.current&&(clearTimeout(E.current),E.current=null)}):()=>{},[e,j]),u.useEffect(()=>{if(!e)return;N.current=document.activeElement instanceof HTMLElement?document.activeElement:null,document.body.classList.add(gS);const U=()=>S.current?Array.from(S.current.querySelectorAll(gR.join(","))).filter(L=>L instanceof HTMLElement&&L.offsetParent!==null):[],X=()=>{const O=U()[0];O?O.focus({preventScroll:!0}):S.current&&S.current.focus({preventScroll:!0})},V=L=>{if(L.key==="Escape"){L.preventDefault(),n?.();return}if(L.key!=="Tab")return;const O=U();if(O.length===0){L.preventDefault(),S.current?.focus({preventScroll:!0});return}const $=O[0],F=O[O.length-1],H=document.activeElement;if(L.shiftKey){(H===$||!S.current?.contains(H))&&(L.preventDefault(),F.focus({preventScroll:!0}));return}H===F&&(L.preventDefault(),$.focus({preventScroll:!0}))},R=L=>{S.current?.contains(L.target)||X()},B=setTimeout(()=>{if(!S.current)return;const L=S.current.querySelector("[data-autofocus]");if(L instanceof HTMLElement){L.focus({preventScroll:!0});return}X()},20);return document.addEventListener("keydown",V),document.addEventListener("focusin",R),()=>{clearTimeout(B),document.removeEventListener("keydown",V),document.removeEventListener("focusin",R),document.body.classList.remove(gS),N.current instanceof HTMLElement&&N.current.focus({preventScroll:!0})}},[e,n]),!j||!v.current)return null;const D=["drawer-panel-wrapper",e?"drawer-panel-wrapper--open":"",T?"drawer-panel-wrapper--closing":""].filter(Boolean).join(" "),z=["drawer-panel",p?`drawer-panel--${p}`:"",x?"drawer-panel--mobile-full":"",g].filter(Boolean).join(" "),G=d??o;return Kl.createPortal(t.jsxs("div",{className:D,role:"presentation",children:[t.jsx("div",{className:"drawer-panel-overlay",onClick:n,role:"presentation"}),t.jsxs("aside",{ref:S,className:z,role:"dialog","aria-modal":"true","aria-labelledby":M,"aria-describedby":k,tabIndex:-1,style:{"--drawer-panel-width":C},children:[t.jsxs("div",{className:"drawer-panel-header",children:[t.jsxs("div",{className:"drawer-panel-heading",children:[t.jsx("h2",{id:M,children:s}),i?t.jsx("p",{id:k,className:"drawer-panel-description",children:i}):null]}),t.jsx("button",{type:"button",className:"icon-btn",onClick:n,"aria-label":y,children:""})]}),t.jsx("div",{className:"drawer-panel-body",children:l}),G?t.jsx("div",{className:"drawer-panel-footer",children:G}):null]})]}),v.current)}const _f="app_history",vj=100,py="history:updated",Sj=()=>typeof window<"u"?window:null,Cf=()=>!!Sj()?.localStorage,wj=e=>{const n=Sj();if(n)try{n.dispatchEvent(new CustomEvent(py,{detail:Array.isArray(e)?e:[]}))}catch(s){console.warn(" Failed to broadcast history change",s)}},yy=e=>{if(!e)return null;const n=new Date(e);return Number.isNaN(n.getTime())?null:n},dg=e=>{if(!e||e.id===void 0||e.id===null||!e.type)return null;const n=yy(e.viewedAt)||new Date,s=e.worldId??e.world_id??e.worldID??e.world?.id??e.world?.world_id??null,i=e.worldName??e.world_name??e.world?.name??null;return{id:String(e.id),type:String(e.type),title:e.title?String(e.title):"Untitled record",viewedAt:n.toISOString(),...s?{worldId:String(s)}:{},...i?{worldName:String(i)}:{}}},vR=e=>e.slice().sort((n,s)=>{const i=yy(n?.viewedAt),l=yy(s?.viewedAt),o=i?i.getTime():0;return(l?l.getTime():0)-o}),gy=()=>{if(!Cf())return[];try{const e=window.localStorage.getItem(_f);if(!e)return[];const n=JSON.parse(e);if(!Array.isArray(n))return[];const s=n.map(dg).filter(Boolean);return vR(s)}catch(e){return console.warn(" Failed to parse stored history",e),[]}},SR=e=>{if(!Cf())return[];if(!Array.isArray(e))return[];const n=e.map(dg).filter(Boolean).slice(0,vj);return window.localStorage.setItem(_f,JSON.stringify(n)),wj(n),n},wR=e=>{if(!Cf())return[];const n=dg(e);if(!n)return gy();const s=gy().filter(l=>!(l.id===n.id&&l.type===n.type)),i=[n,...s].slice(0,vj);return SR(i),i},NR=()=>{Cf()&&(window.localStorage.removeItem(_f),wj([]))},ap=()=>typeof window>"u"?[]:gy();function Nj(e=null){const[n,s]=u.useState(()=>ap()),i=u.useCallback(()=>{const m=ap();return s(m),m},[]),l=u.useCallback(m=>{if(!m)return ap();const p=wR(m);return s(p),p},[]),o=u.useCallback(()=>{NR(),s([])},[]);u.useEffect(()=>{i()},[i]);const d=u.useMemo(()=>{if(!e)return null;const{id:m,type:p,title:h,viewedAt:y}=e;if(m==null||!p)return null;const g={id:m,type:p,title:h,viewedAt:y},x=e.worldId??e.world_id??e.world?.id??e.world?.world_id??null,v=e.worldName??e.world_name??e.world?.name??null;return x!=null&&(g.worldId=x),v&&(g.worldName=v),g},[e]);return u.useEffect(()=>{d&&l(d)},[d,l]),u.useEffect(()=>{if(typeof window>"u")return;const m=h=>{h.key&&h.key!==_f||i()},p=()=>{i()};return window.addEventListener("storage",m),window.addEventListener(py,p),()=>{window.removeEventListener("storage",m),window.removeEventListener(py,p)}},[i]),{history:n,addEntry:l,refreshHistory:i,clearHistory:o}}const jj=3600*1e3,jR=24*jj,ER=e=>{if(!e)return null;const n=new Date(e);return Number.isNaN(n.getTime())?null:n},by=(e,n)=>e.getFullYear()===n.getFullYear()&&e.getMonth()===n.getMonth()&&e.getDate()===n.getDate(),_R=(e,n)=>{if(!e)return"older";const s=n.getTime()-e.getTime();if(s<jj)return"lastHour";if(by(e,n))return"today";const i=new Date(n);return i.setDate(n.getDate()-1),by(e,i)?"yesterday":s<7*jR?"lastSevenDays":"older"},CR=[{key:"lastHour",label:"Last hour"},{key:"today",label:"Today"},{key:"yesterday",label:"Yesterday"},{key:"lastSevenDays",label:"Last seven days"},{key:"older",label:"Older"}],AR=(e,n)=>{if(!e)return"";if(by(e,n)){const l=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${l}.${o}`}const s=String(e.getDate()).padStart(2,"0"),i=e.toLocaleString(void 0,{month:"short"});return`${s} ${i}`},TR=e=>{if(!e)return"record";const n=String(e);return n.includes(":")?n.split(":").pop().replace(/[-_]+/g," "):n.replace(/_/g," ")},MR=e=>!e?.type||!e?.id?null:String(e.type).toLowerCase().startsWith("entity")?`/entities/${e.id}`:null;function kR({isOpen:e,onClose:n}){const{history:s,clearHistory:i}=Nj(),{campaigns:l,worlds:o,loading:d,worldLoading:m,selectedContextType:p,activeWorldId:h}=jn(),y=new Date,g=u.useMemo(()=>!d&&!m,[d,m]),x=u.useMemo(()=>{const A=new Set,T=_=>{if(!_&&_!==0)return;const M=String(_);M&&A.add(M)};return Array.isArray(o)&&o.forEach(_=>{T(_?.id??_?.world_id)}),Array.isArray(l)&&l.forEach(_=>{T(_?.world?.id??_?.world_id)}),A},[l,o]),v=u.useMemo(()=>!p||!h?"":String(h),[p,h]),S=u.useMemo(()=>!Array.isArray(s)||s.length===0?[]:!g||!x.size?s:s.filter(A=>{if(!A)return!1;if(!String(A.type||"").toLowerCase().startsWith("entity"))return!0;const _=A.worldId??A.world_id??A.world?.id??A.world?.world_id??null;return v&&(!_||String(_)!==v)?!1:_?x.has(String(_)):!0}),[s,x,g,v]),N=g&&Array.isArray(s)&&s.length>0&&S.length<s.length,E=u.useMemo(()=>{if(!Array.isArray(S)||S.length===0)return[];const A=new Date,T=CR.map(M=>({...M,items:[]})),_=new Map(T.map(M=>[M.key,M]));return S.forEach(M=>{const k=ER(M?.viewedAt),C=_R(k,A),D=_.get(C);D&&D.items.push({...M,parsedDate:k})}),T.filter(M=>M.items.length>0)},[S]),j=()=>{i()};return t.jsx(Bs,{isOpen:e,onClose:n,title:"History",description:"Recently viewed records",size:"sm",children:t.jsxs("div",{className:"history-tab",children:[t.jsxs("div",{className:"history-tab-header",children:[t.jsxs("div",{className:"history-tab-title",children:[t.jsx(og,{size:18}),t.jsx("span",{children:"Recently viewed"})]}),t.jsxs("button",{type:"button",className:"history-clear-btn",onClick:j,disabled:!s.length,children:[t.jsx(zn,{size:14}),"Clear"]})]}),!S.length&&t.jsx("p",{className:"history-empty",children:N?"You do not currently have access to any records in your recent history.":"No records viewed yet. Start exploring to build a history."}),E.map(A=>t.jsxs("section",{className:"history-group",children:[t.jsx("h3",{className:"history-group-title",children:A.label}),t.jsx("ul",{className:"history-entry-list",children:A.items.map(T=>{const _=MR(T),M=t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"history-entry-title",children:T.title||"Untitled record"}),t.jsxs("div",{className:"history-entry-meta",children:[t.jsx("span",{className:"history-entry-type",children:TR(T.type)}),t.jsx("time",{className:"history-entry-time",children:AR(T.parsedDate,y)})]})]});return t.jsx("li",{children:_?t.jsx(Yt,{to:_,className:"history-entry history-entry-link",onClick:n,children:M}):t.jsx("div",{className:"history-entry",children:M})},`${T.type}-${T.id}`)})})]},A.key))]})})}const RR="gamedb_campaign_context",IR="X-Campaign-Context-Id",DR=e=>{if(!e||typeof e!="string")return null;try{const s=JSON.parse(e);if(s&&typeof s=="object"){const i=s.type==="world"?"world":"campaign",l=s.id?String(s.id):"";return l?{type:i,id:l}:null}}catch{const s=e.trim();if(s)return{type:"campaign",id:s}}const n=e.trim();return n?{type:"campaign",id:n}:null};async function Xo(e,n,s,i={}){const{headers:l,includeCampaignContext:o=!0,...d}=i||{},m=typeof FormData<"u"&&s instanceof FormData,p={...m?{}:{"Content-Type":"application/json"},...l},h=qs();if(h&&(p.Authorization=`Bearer ${h}`),o)try{const N=localStorage.getItem(RR);if(N){const E=DR(N);E?.type==="campaign"&&E.id&&(p[IR]=E.id)}}catch(N){console.warn(" Unable to include campaign context header",N)}const y=(()=>{if(s!==void 0)return m?s:JSON.stringify(s)})(),g=await fetch(`${sn}${n}`,{method:e,headers:p,body:y,...d}),v=(g.headers.get("content-type")||"").includes("application/json"),S=v?await g.json():await g.text();if(!g.ok){g.status===401&&(localStorage.removeItem("gamedb_session"),setTimeout(()=>{window.location.pathname!=="/login"&&(window.location.href="/login")},150));const N=v&&S?.message||(typeof S=="string"?S:"Request failed"),E=new Error(N);throw E.status=g.status,E}return S}const Et={get:(e,n)=>Xo("GET",e,void 0,n),post:(e,n,s)=>Xo("POST",e,n,s),put:(e,n,s)=>Xo("PUT",e,n,s),patch:(e,n,s)=>Xo("PATCH",e,n,s),delete:(e,n)=>Xo("DELETE",e,void 0,n)},Ej=(e={})=>{const n=new URLSearchParams;Object.entries(e).forEach(([l,o])=>{o!=null&&o!==""&&n.set(l,o)});const s=n.toString(),i=s?`/notifications?${s}`:"/notifications";return Et.get(i)},LR=e=>Et.patch(`/notifications/${e}/read`),OR=(e={})=>{const n=new URLSearchParams;Object.entries(e).forEach(([l,o])=>{o!=null&&o!==""&&n.set(l,o)});const s=n.toString(),i=s?`/notifications/read-all?${s}`:"/notifications/read-all";return Et.patch(i)},$R=(e={})=>{const n=new URLSearchParams;Object.entries(e).forEach(([l,o])=>{o!=null&&o!==""&&n.set(l,o)});const s=n.toString(),i=s?`/notifications/unread-count?${s}`:"/notifications/unread-count";return Et.get(i)},_j=u.createContext(null),sp=3e4,FR=12e4;function zR({children:e}){const{user:n,sessionReady:s}=un(),[i,l]=u.useState([]),[o,d]=u.useState(0),[m,p]=u.useState(!1),[h,y]=u.useState(""),g=u.useRef(null),x=u.useRef(null),v=u.useRef(!0);u.useEffect(()=>{const _=()=>{v.current=!document.hidden,!document.hidden&&x.current&&Date.now()-x.current>sp&&(S(),N())};return document.addEventListener("visibilitychange",_),()=>{document.removeEventListener("visibilitychange",_)}},[]);const S=u.useCallback(async()=>{if(!n?.id||!s){l([]),p(!1);return}p(!0),y("");try{const _=await Ej({limit:50}),M=Array.isArray(_?.data)?_.data:[];l(M),x.current=Date.now()}catch(_){console.error(" Failed to load notifications",_),y(_.message||"Failed to load notifications")}finally{p(!1)}},[n?.id,s]),N=u.useCallback(async()=>{if(!n?.id||!s){d(0);return}try{const M=(await $R())?.count??0;d(M)}catch(_){console.error(" Failed to load unread count",_)}},[n?.id,s]),E=u.useCallback(()=>{S(),N()},[S,N]),j=u.useCallback(async _=>{if(_)try{await LR(_),l(M=>M.map(k=>k.id===_?{...k,read:!0,readAt:new Date().toISOString()}:k)),d(M=>Math.max(0,M-1))}catch(M){throw console.error(" Failed to mark notification read",M),M}},[]),A=u.useCallback(async(_={})=>{try{await OR(_),l(M=>M.map(k=>({...k,read:!0,readAt:new Date().toISOString()}))),d(0)}catch(M){throw console.error(" Failed to mark all notifications read",M),M}},[]);u.useEffect(()=>{if(!n?.id||!s){g.current&&(clearInterval(g.current),g.current=null),l([]),d(0);return}S(),N();const _=()=>{g.current&&clearInterval(g.current);const k=v.current?sp:FR;g.current=setInterval(()=>{v.current?(N(),(!x.current||Date.now()-x.current>sp*2)&&S()):N()},k)};_();const M=()=>{v.current=!document.hidden,_()};return document.addEventListener("visibilitychange",M),()=>{g.current&&(clearInterval(g.current),g.current=null),document.removeEventListener("visibilitychange",M)}},[n?.id,s,S,N]);const T=u.useMemo(()=>({notifications:i,unreadCount:o,loading:m,error:h,refresh:E,markRead:j,markAllRead:A}),[i,o,m,h,E,j,A]);return t.jsx(_j.Provider,{value:T,children:e})}function BR(){const e=u.useContext(_j);if(!e)throw new Error("useNotifications must be used within NotificationProvider");return e}function Cj(){return BR()}function Aj({open:e,campaignName:n,onSwitch:s,onCancel:i}){return e?t.jsx("div",{className:"unsaved-dialog-backdrop",role:"dialog","aria-modal":"true",children:t.jsxs("div",{className:"unsaved-dialog",role:"document",children:[t.jsxs("div",{className:"unsaved-dialog-header",children:[t.jsxs("div",{children:[t.jsx("p",{className:"unsaved-dialog-label",children:"Campaign context"}),t.jsx("h2",{children:"Switch campaign context?"})]}),t.jsx("button",{type:"button",className:"icon-btn","aria-label":"Close dialog",onClick:i,children:t.jsx(ea,{size:18})})]}),t.jsxs("div",{className:"unsaved-dialog-body",children:[t.jsxs("p",{children:["This notification is for the campaign ",t.jsx("strong",{children:n||"another campaign"}),". You're currently viewing a different campaign context."]}),t.jsx("p",{className:"unsaved-dialog-help",children:"Would you like to switch to the correct campaign context to view this notification?"})]}),t.jsxs("div",{className:"unsaved-dialog-actions",children:[t.jsx("button",{type:"button",className:"btn submit",onClick:s,children:"Switch campaign context"}),t.jsx("button",{type:"button",className:"btn cancel",onClick:i,children:"Cancel"})]})]})}):null}const UR=e=>{if(!e)return"";const n=new Date(e);if(Number.isNaN(n.getTime()))return"";const i=new Date-n,l=Math.floor(i/6e4),o=Math.floor(i/36e5),d=Math.floor(i/864e5);return l<1?"Just now":l<60?`${l}m ago`:o<24?`${o}h ago`:d<7?`${d}d ago`:n.toLocaleDateString(void 0,{month:"short",day:"numeric"})},qR=e=>{const{type:n,metadata:s={}}=e;switch(n){case"entity_comment":return`${s.author_name||"Someone"} commented on ${s.entity_name||"an entity"}`;case"entity_mention_entity_note":return`${s.author_name||"Someone"} mentioned ${s.related_entity_name||"an entity"} in a note`;case"entity_mention_session_note":return`${s.author_name||"Someone"} mentioned ${s.related_entity_name||"an entity"} in a session note`;case"session_note_added":return`${s.author_name||"Someone"} created a session note${s.campaign_name?` for ${s.campaign_name}`:""}`;case"session_note_updated":return`${s.author_name||"Someone"} updated a session note${s.campaign_name?` for ${s.campaign_name}`:""}`;case"request_note_added":return`${s.author_name||"Someone"} added a note to "${s.request_title||"a feature/bug"}"`;case"request_status_changed":return`Status changed for "${s.request_title||"a feature/bug"}"`;case"request_assigned":return`You were assigned to "${s.request_title||"a feature/bug"}"`;default:return"New notification"}};function PR(){const{notifications:e,unreadCount:n,loading:s,markRead:i}=Cj(),{selectedCampaignId:l,setSelectedCampaignId:o}=jn(),d=Mn(),[m,p]=u.useState(!1),h=u.useRef(null),[y,g]=u.useState({open:!1,notification:null});u.useEffect(()=>{const A=T=>{h.current&&!h.current.contains(T.target)&&p(!1)};if(m)return document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)}},[m]);const x=e.filter(A=>!A.read).slice(0,5),v=A=>{if(p(!1),A.actionUrl)d(A.actionUrl);else{const{type:T,metadata:_={}}=A;if(T==="entity_comment"||T==="entity_mention_entity_note"){const M=_.entity_id||_.related_entity_id,k=A.campaignId||A.campaign?.id||l;M&&d(`/entities/${M}${k?`?campaignId=${k}`:""}#notes`)}else if(T==="session_note_added"||T==="session_note_updated"||T==="entity_mention_session_note"){const M=A.campaignId||A.campaign?.id||_.target_id||l;d(`/notes/session${M?`?campaignId=${M}`:""}`)}else if(T==="request_note_added"||T==="request_status_changed"||T==="request_assigned"){const M=_.request_id||_.requestId;d(M?`/requests/${M}`:"/requests")}else d("/notifications")}},S=async A=>{if(!A.read)try{await i(A.id)}catch(M){console.error("Failed to mark notification read",M)}const T=A.campaignId||A.campaign?.id||"";if(T&&T!==(l||"")){g({open:!0,notification:A});return}v(A)},N=()=>{const{notification:A}=y;if(!A)return;const T=A.campaignId||A.campaign?.id||"";T&&o(T),g({open:!1,notification:null}),setTimeout(()=>{v(A)},100)},E=()=>{g({open:!1,notification:null})},j=x.length>0;return t.jsxs("div",{className:"notification-widget",ref:h,children:[t.jsxs("button",{type:"button",className:"notification-widget-button",onClick:()=>p(!m),title:"Notifications",children:[n>0?t.jsx(xf,{size:20}):t.jsx(Bl,{size:20}),n>0&&t.jsx("span",{className:"notification-widget-badge",children:n>99?"99+":n})]}),m&&t.jsxs("div",{className:"notification-widget-dropdown",children:[t.jsxs("div",{className:"notification-widget-header",children:[t.jsx("h3",{children:"Notifications"}),n>0&&t.jsxs("span",{className:"notification-widget-count",children:[n," unread"]})]}),s?t.jsx("div",{className:"notification-widget-loading",children:"Loading..."}):j?t.jsx("div",{className:"notification-widget-list",children:x.map(A=>t.jsxs("div",{className:`notification-widget-item ${A.read?"read":"unread"}`,onClick:()=>S(A),children:[t.jsxs("div",{className:"notification-widget-item-content",children:[t.jsx("p",{className:"notification-widget-item-message",children:qR(A)}),t.jsx("span",{className:"notification-widget-item-time",children:UR(A.createdAt)})]}),!A.read&&t.jsx("div",{className:"notification-widget-item-dot"})]},A.id))}):t.jsx("div",{className:"notification-widget-empty",children:"No new notifications"}),t.jsx("div",{className:"notification-widget-footer",children:t.jsxs(Yt,{to:"/notifications",className:"notification-widget-view-all",onClick:()=>p(!1),children:["View all notifications ",t.jsx(Jr,{size:14})]})})]}),t.jsx(Aj,{open:y.open,campaignName:y.notification?.campaign?.name||"",onSwitch:N,onCancel:E})]})}const HR=(e={})=>{const n=new URLSearchParams,s=e.viewAsCharacterId??e.characterId??e.character_id??e.viewAs;if(s!=null){const i=String(s).trim();i&&n.set("viewAsCharacterId",i)}return n.toString()},_c=(e,n={})=>{if(!e)return Promise.reject(new Error("worldId is required to load entities"));const s=new URLSearchParams,i=HR(n);i&&s.set("viewAsCharacterId",new URLSearchParams(i).get("viewAsCharacterId")),n.importance!==void 0&&n.importance!==null&&(Array.isArray(n.importance)?n.importance:[n.importance]).forEach(m=>{m!=null&&s.append("importance[]",m)});const l=s.toString(),o=l?`?${l}`:"";return Et.get(`/worlds/${e}/entities${o}`)},VR=()=>Et.get("/entities/unassigned"),Us=e=>Et.get(`/entities/${e}`),Tj=({worldId:e,query:n,typeIds:s=[],limit:i=20,offset:l=0})=>{if(!e)return Promise.reject(new Error("worldId is required"));const o=new URLSearchParams;o.set("worldId",e),n&&o.set("q",n),(Array.isArray(s)?s:[s]).map(p=>p==null?"":String(p).trim()).filter(Boolean).forEach(p=>{o.append("typeIds[]",p)}),i!=null&&o.set("limit",i),l!=null&&o.set("offset",l);const m=o.toString();return Et.get(`/entities/search${m?`?${m}`:""}`)},YR=({query:e,campaignId:n,worldId:s,limit:i=20,offset:l=0})=>{const o=new URLSearchParams;e&&o.set("q",e),n&&o.set("campaignId",n),s&&o.set("worldId",s),i!=null&&o.set("limit",i),l!=null&&o.set("offset",l);const d=o.toString();return Et.get(`/entities/global-search${d?`?${d}`:""}`)},fg=e=>Et.post("/entities",e),mg=(e,n)=>Et.patch(`/entities/${e}`,n),GR=(e,n)=>Et.patch(`/entities/${e}/importance`,{importance:n}),KR=e=>Et.delete(`/entities/${e}`),Mj=(e,n)=>{if(!e)return Promise.reject(new Error("entityId is required"));if(!n)return Promise.reject(new Error("file is required"));const s=new FormData;return s.append("file",n),Et.post(`/entities/${e}/image`,s)},kj=e=>e?Et.delete(`/entities/${e}/image`):Promise.reject(new Error("entityId is required")),XR=(e,n)=>Et.post(`/entities/${e}/secrets`,n),WR=(e,n,s)=>Et.patch(`/entities/${e}/secrets/${n}`,s),ZR=(e,n={})=>{const s=new URLSearchParams,i=n.campaignId??n.campaign_id;i&&s.set("campaignId",i);const l=s.toString();return Et.get(`/entities/${e}/notes${l?`?${l}`:""}`)},QR=(e,n={})=>{const s=new URLSearchParams,i=n.campaignId??n.campaign_id;i&&s.set("campaignId",i);const l=s.toString();return Et.get(`/entities/${e}/mentions/entity-notes${l?`?${l}`:""}`)},JR=(e,n={})=>{const s=new URLSearchParams,i=n.campaignId??n.campaign_id;i&&s.set("campaignId",i);const l=s.toString();return Et.get(`/entities/${e}/mentions/session-notes${l?`?${l}`:""}`)},eI=(e,n)=>Et.post(`/entities/${e}/notes`,n),Rj=(e,n,s)=>Et.patch(`/entities/${e}/notes/${n}`,s),Ij=(e,n,s={})=>{const i=new URLSearchParams,l=s.campaignId??s.campaign_id;l&&i.set("campaignId",l);const o=i.toString();return Et.delete(`/entities/${e}/notes/${n}${o?`?${o}`:""}`)},tI=async(e,n=1)=>{const s=new URLSearchParams;if(n!=null){const o=Number(n);!Number.isNaN(o)&&o>0&&s.set("depth",String(o))}const i=s.toString(),l=await Et.get(`/entities/${e}/graph${i?`?${i}`:""}`,{credentials:"include"});if(!l?.success)throw new Error(l?.message||"Failed to load graph");return l.data},nI=300,aI=(e,n)=>{const[s,i]=u.useState(e);return u.useEffect(()=>{const l=setTimeout(()=>i(e),n);return()=>clearTimeout(l)},[e,n]),s},sd=e=>({name:"Name",description:"Description",notes:"Notes",mentions:"Mentions",relationships:"Relationships",title:"Title",content:"Content"})[e]||e;function bS({isMobile:e,onClose:n}){const s=Mn(),{selectedCampaignId:i,activeWorldId:l}=jn(),[o,d]=u.useState(""),m=!!(i||l),[p,h]=u.useState({entities:[],sessionNotes:[]}),[y,g]=u.useState(!1),[x,v]=u.useState(""),[S,N]=u.useState(-1),[E,j]=u.useState(!1),A=aI(o,nI),T=u.useRef(null),_=u.useRef(null),M=u.useRef(0),k=u.useMemo(()=>{const B=[];return p.entities.forEach(L=>{B.push({type:"entity",data:L})}),p.sessionNotes.forEach(L=>{B.push({type:"sessionNote",data:L})}),B},[p]),C=k.length>0,D=E&&(o.trim().length>0||C),z=u.useCallback(async B=>{if(!B.trim()){h({entities:[],sessionNotes:[]}),g(!1);return}if(!m){v("Please select a campaign or world context to search"),h({entities:[],sessionNotes:[]}),g(!1);return}const L=++M.current;g(!0),v("");try{const O=await YR({query:B,campaignId:i,worldId:l,limit:20,offset:0});if(L!==M.current)return;const $=O?.data||{entities:[],sessionNotes:[]};h({entities:Array.isArray($.entities)?$.entities:[],sessionNotes:Array.isArray($.sessionNotes)?$.sessionNotes:[]})}catch(O){if(L!==M.current)return;v(O.message||"Failed to search"),h({entities:[],sessionNotes:[]})}finally{L===M.current&&g(!1)}},[l,i,m]);u.useEffect(()=>{A.trim().length>0?z(A):(h({entities:[],sessionNotes:[]}),g(!1))},[A,z]),u.useEffect(()=>{E&&_.current&&!e&&_.current.focus()},[E,e]),u.useEffect(()=>{const B=L=>{T.current&&!T.current.contains(L.target)&&(e||j(!1))};if(E)return document.addEventListener("mousedown",B),()=>document.removeEventListener("mousedown",B)},[E,e]),u.useEffect(()=>{const B=L=>{if(D)if(L.key==="ArrowDown")L.preventDefault(),N(O=>O<k.length-1?O+1:O);else if(L.key==="ArrowUp")L.preventDefault(),N(O=>O>0?O-1:-1);else if(L.key==="Enter"&&S>=0){L.preventDefault();const O=k[S];O&&X(O)}else L.key==="Escape"&&(L.preventDefault(),j(!1),d(""),e&&n&&n())};if(D)return document.addEventListener("keydown",B),()=>document.removeEventListener("keydown",B)},[D,S,k,e,n]);const G=B=>{d(B.target.value),N(-1),E||j(!0)},U=()=>{j(!0)},X=B=>{B.type==="entity"?s(`/entities/${B.data.id}`):B.type==="sessionNote"&&s(`/campaigns/${i}/session-notes`),j(!1),d(""),e&&n&&n()},V=()=>{d(""),h({entities:[],sessionNotes:[]}),N(-1),e&&n&&n()},R=B=>{if(!B)return"";try{return new Date(B).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return B}};return e?t.jsxs("div",{className:"global-search-mobile",children:[t.jsx("div",{className:"global-search-mobile-overlay",onClick:n}),t.jsxs("div",{className:"global-search-mobile-content",children:[t.jsxs("div",{className:`global-search-input-wrapper ${m?"":"disabled"}`,children:[t.jsx(Ec,{size:20,className:"global-search-icon"}),t.jsx("input",{ref:_,type:"text",className:"global-search-input",placeholder:m?"Search entities and session notes...":"Select a campaign or world to search",value:o,onChange:G,onFocus:U,disabled:!m,autoFocus:!0}),o&&t.jsx("button",{type:"button",className:"global-search-clear",onClick:V,"aria-label":"Clear search",children:t.jsx(ea,{size:16})})]}),D&&t.jsxs("div",{className:"global-search-results",children:[y&&t.jsx("div",{className:"global-search-loading",children:t.jsx("span",{children:"Searching..."})}),!y&&x&&t.jsx("div",{className:"global-search-error",children:t.jsx("span",{children:x})}),!y&&!x&&!C&&o.trim().length>0&&t.jsx("div",{className:"global-search-empty",children:t.jsx("span",{children:"No results found"})}),!y&&!x&&C&&t.jsx("div",{className:"global-search-results-list",children:k.map((B,L)=>t.jsx("button",{type:"button",className:`global-search-result-item ${L===S?"selected":""}`,onClick:()=>X(B),children:B.type==="entity"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"global-search-result-header",children:[t.jsx("span",{className:"global-search-result-name",children:B.data.name}),B.data.typeName&&t.jsx("span",{className:"global-search-result-type",children:B.data.typeName})]}),t.jsx("div",{className:"global-search-result-meta",children:t.jsxs("span",{className:"global-search-match-type",children:["Matched in ",sd(B.data.matchType)]})})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"global-search-result-header",children:[t.jsx("span",{className:"global-search-result-name",children:B.data.session_title||"Session Note"}),t.jsx("span",{className:"global-search-result-type",children:"Session Note"})]}),t.jsx("div",{className:"global-search-result-meta",children:t.jsxs("span",{className:"global-search-match-type",children:[R(B.data.session_date),"  Matched in"," ",sd(B.data.matchType)]})})]})},`${B.type}-${B.data.id}`))})]})]})]}):t.jsxs("div",{className:"global-search",ref:T,children:[t.jsxs("div",{className:`global-search-input-wrapper ${m?"":"disabled"}`,children:[t.jsx(Ec,{size:18,className:"global-search-icon"}),t.jsx("input",{ref:_,type:"text",className:"global-search-input",placeholder:m?"Search entities and session notes...":"Select a campaign or world to search",value:o,onChange:G,onFocus:U,disabled:!m}),o&&t.jsx("button",{type:"button",className:"global-search-clear",onClick:V,"aria-label":"Clear search",children:t.jsx(ea,{size:16})})]}),D&&t.jsxs("div",{className:"global-search-dropdown",children:[y&&t.jsx("div",{className:"global-search-loading",children:t.jsx("span",{children:"Searching..."})}),!y&&x&&t.jsx("div",{className:"global-search-error",children:t.jsx("span",{children:x})}),!y&&!x&&!C&&o.trim().length>0&&t.jsx("div",{className:"global-search-empty",children:t.jsx("span",{children:"No results found"})}),!y&&!x&&C&&t.jsx("div",{className:"global-search-results-list",children:k.map((B,L)=>t.jsx("button",{type:"button",className:`global-search-result-item ${L===S?"selected":""}`,onClick:()=>X(B),children:B.type==="entity"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"global-search-result-header",children:[t.jsx("span",{className:"global-search-result-name",children:B.data.name}),B.data.typeName&&t.jsx("span",{className:"global-search-result-type",children:B.data.typeName})]}),t.jsx("div",{className:"global-search-result-meta",children:t.jsxs("span",{className:"global-search-match-type",children:["Matched in ",sd(B.data.matchType)]})})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"global-search-result-header",children:[t.jsx("span",{className:"global-search-result-name",children:B.data.session_title||"Session Note"}),t.jsx("span",{className:"global-search-result-type",children:"Session Note"})]}),t.jsx("div",{className:"global-search-result-meta",children:t.jsxs("span",{className:"global-search-match-type",children:[R(B.data.session_date),"  Matched in"," ",sd(B.data.matchType)]})})]})},`${B.type}-${B.data.id}`))})]})]})}function sI({onMenuToggle:e}){const[n,s]=u.useState(!1),i=u.useRef(null),{user:l,logout:o}=un(),{theme:d,toggleTheme:m}=uR(),{campaigns:p,selectedCampaignId:h,setSelectedCampaignId:y,selectedCampaign:g,loading:x,error:v,worlds:S,selectedWorld:N,selectedWorldId:E,setSelectedWorldId:j,worldLoading:A,worldError:T,viewAsCharacterId:_,setViewAsCharacterId:M}=jn();u.useEffect(()=>{const be=Oe=>{i.current&&!i.current.contains(Oe.target)&&s(!1)};return document.addEventListener("mousedown",be),()=>document.removeEventListener("mousedown",be)},[]);const k=be=>{y(be.target.value)},C=be=>{j(be.target.value)},D=Wl(),[z,G]=u.useState([]),[U,X]=u.useState(!1),[V,R]=u.useState(""),[B,L]=u.useState(!1),[O,$]=u.useState(!1),[F,H]=u.useState(!1),I=u.useMemo(()=>!g||!l?"":g.members?.find(Oe=>Oe?.user_id===l.id)?.role||"",[g,l]),Y=u.useMemo(()=>{if(!g?.world)return"";const be=g.world;return be.created_by||be.creator?.id||be.owner_id||be.owner?.id||""},[g]),P=u.useMemo(()=>!h||!l?!1:l.role==="system_admin"||I==="dm"?!0:Y?String(Y)===String(l.id):!1,[I,h,Y,l]);u.useEffect(()=>{P||M("")},[P,M]),u.useEffect(()=>{let be=!1;if(!P||!h){G([]),X(!1),R("");return}return(async()=>{X(!0),R("");try{const Me=await js({scope:"others",campaign_id:h}),ut=Array.isArray(Me?.data)?Me.data:Array.isArray(Me)?Me:[];if(be)return;const ht=ut.map(_t=>{if(!_t?.id)return null;const jt=_t.name||"Unnamed character",ve=_t.player?.username||_t.player?.email||_t.player?.name||"";return{id:String(_t.id),label:ve?`${jt} (${ve})`:jt}}).filter(Boolean).sort((_t,jt)=>_t.label.localeCompare(jt.label,void 0,{sensitivity:"base"}));G(ht)}catch(Me){be||(console.error(" Failed to load characters for view-as context",Me),G([]),R(Me.message||"Unable to load characters"),M(""))}finally{be||X(!1)}})(),()=>{be=!0}},[P,h,M]);const K=u.useMemo(()=>{if(U)return"Loading characters";if(V)return V;if(!_)return"Viewing entities as yourself (DM/owner)";const be=z.find(Oe=>Oe.id===_);return be?`Viewing as ${be.label}`:"Viewing as selected character"},[_,z,V,U]),re=u.useMemo(()=>x?"Loading campaigns":v?"Unable to load campaigns":p.length?g?`${g.name}${g.world?.name?`  ${g.world.name}`:""}`:"Select a campaign":"No eligible campaigns",[p,v,x,g]),W=u.useMemo(()=>g?.world?g.world.name?`Campaign world  ${g.world.name}`:"Campaign world selected":A?"Loading worlds":T?"Unable to load worlds":S.length?N?N.name?`World  ${N.name}`:"Selected world":"Select a world":"No accessible worlds",[g,N,A,T,S.length]),ue=u.useMemo(()=>{const be=new Set,Oe=[];if(S.forEach(Me=>{if(!Me?.id)return;const ut=String(Me.id);be.has(ut)||(Oe.push({id:ut,name:Me.name||`World #${ut}`}),be.add(ut))}),g?.world?.id){const Me=String(g.world.id);be.has(Me)||Oe.unshift({id:Me,name:g.world.name||"Campaign world"})}return Oe},[S,g]);u.useEffect(()=>{D||L(!1)},[D]);const Q=be=>{if(!l)return"";const Oe=be?.members?.find(Me=>Me.user_id===l.id);return Oe?Oe.role==="dm"?"DM":Oe.role==="player"?"Player":Oe.role||"":l.role==="system_admin"?"System Admin":""},ye=()=>L(!1),ae=t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"campaign-selector",title:re,children:[t.jsx("label",{htmlFor:"campaign-context-select",children:"Campaign"}),t.jsxs("select",{id:"campaign-context-select",value:h,onChange:k,disabled:x||!p.length&&!h,children:[t.jsx("option",{value:"",children:x?"Loading campaigns":v?"Unable to load campaigns":p.length?"Select a campaign":"No campaigns available"}),p.map(be=>{const Oe=Q(be),Me=[Oe?`as ${Oe}`:null,be.world?.name?`World: ${be.world.name}`:null].filter(Boolean).join("  "),ut=Me?`${be.name} (${Me})`:be.name;return t.jsx("option",{value:be.id,children:ut},be.id)})]})]}),t.jsxs("div",{className:"campaign-selector",title:W,children:[t.jsx("label",{htmlFor:"world-context-select",children:"World"}),t.jsxs("select",{id:"world-context-select",value:E,onChange:C,disabled:A,children:[t.jsx("option",{value:"",children:g?.world?g.world.name?`Using ${g.world.name}`:"Using campaign world":A?"Loading worlds":T?"Unable to load worlds":S.length?"Select a world":"No worlds available"}),ue.map(be=>t.jsx("option",{value:be.id,children:be.name},be.id))]})]}),P&&t.jsxs("div",{className:"campaign-selector",title:K,children:[t.jsx("label",{htmlFor:"character-context-select",children:"View as"}),t.jsxs("select",{id:"character-context-select",value:_,onChange:be=>M(be.target.value),disabled:U||!!V,children:[t.jsx("option",{value:"",children:U?"Loading characters":V||"Entire campaign context"}),z.map(be=>t.jsx("option",{value:be.id,children:be.label},be.id))]})]})]}),ke=t.jsx("button",{type:"button",className:`menu-btn ${D?"menu-btn-icon":"menu-btn-text"}`,onClick:e,"aria-label":D?"Toggle navigation menu":void 0,children:D?t.jsx(JM,{size:20}):"Menu"}),pe=t.jsx("button",{type:"button",className:`history-btn ${D?"history-btn-icon":"history-btn-text"}`,title:"View recently viewed records","aria-label":D?"Open history":void 0,onClick:()=>$(!0),children:D?t.jsx(og,{size:20}):"History"}),we=t.jsx("button",{type:"button",className:`context-btn ${D?"context-btn-icon":"context-btn-text"}`,onClick:()=>L(!0),"aria-label":D?"Change context":void 0,title:D?"Change context":void 0,disabled:!D,children:D?t.jsx(dj,{size:20}):"Context"}),ne=!!(h||E),Le=t.jsx("button",{type:"button",className:`search-btn ${D?"search-btn-icon":"search-btn-text"} ${ne?"":"disabled"}`,onClick:()=>ne&&H(!0),"aria-label":D?"Open search":void 0,title:D?ne?"Open search":"Select a campaign or world to search":void 0,disabled:!ne,children:D?t.jsx(Ec,{size:20}):"Search"});return t.jsxs("header",{className:"app-header",children:[t.jsx("div",{className:"header-start",children:D?t.jsxs(t.Fragment,{children:[t.jsx("h1",{className:"title",children:t.jsx(Yt,{to:"/",className:"title-link",children:"GameDB"})}),ke,we,Le,pe]}):t.jsxs(t.Fragment,{children:[t.jsx("h1",{className:"title",children:t.jsx(Yt,{to:"/",className:"title-link",children:"GameDB"})}),ke,pe]})}),!D&&t.jsxs("div",{className:"header-center",children:[ae,(h||E)&&t.jsx(bS,{isMobile:!1})]}),t.jsx("div",{className:"header-end",children:t.jsx(PR,{})}),t.jsxs("div",{className:"user-menu",ref:i,children:[t.jsx("button",{className:"user-icon",onClick:()=>s(!n),title:"User Menu",children:t.jsx(Fk,{size:20})}),n&&t.jsxs("div",{className:"user-dropdown",children:[t.jsxs("div",{className:"user-info",children:[t.jsx("strong",{children:l?.username||"User"}),t.jsx("br",{}),t.jsx("small",{children:l?.role||""})]}),t.jsxs("button",{className:"dropdown-action",onClick:m,children:[d==="dark"?t.jsx(Ak,{size:16}):t.jsx(sk,{size:16}),d==="dark"?"Light mode":"Dark mode"]}),t.jsxs(Yt,{to:"/security",className:"dropdown-action",onClick:()=>s(!1),children:[t.jsx(KM,{size:16}),"Security"]}),t.jsxs("button",{className:"dropdown-action logout",onClick:o,children:[t.jsx(YM,{size:16}),"Logout"]})]})]}),D&&B&&t.jsxs("div",{className:"mobile-context-overlay",role:"dialog","aria-modal":"true",children:[t.jsx("button",{className:"mobile-context-overlay-close",onClick:ye,"aria-label":"Close context picker"}),t.jsxs("div",{className:"mobile-context-panel",children:[t.jsxs("div",{className:"mobile-context-header",children:[t.jsx("h2",{children:"Choose context"}),t.jsx("button",{type:"button",onClick:ye,"aria-label":"Close context picker",children:t.jsx(ea,{size:20})})]}),t.jsx("div",{className:"mobile-context-body",children:ae})]})]}),t.jsx(kR,{isOpen:O,onClose:()=>$(!1)}),D&&F&&t.jsx(bS,{isMobile:!0,onClose:()=>H(!1)})]})}const rI=e=>e==null?"":String(e).trim(),br=e=>{let n={};typeof e=="string"?n={worldId:e}:e&&typeof e=="object"&&!Array.isArray(e)&&(n={...e});const s=new URLSearchParams,i=rI(n.worldId??n.world_id);if(!i)return Promise.reject(new Error("worldId is required to list entity types"));s.set("worldId",i);const l=s.toString(),o=l?`?${l}`:"";return Et.get(`/entity-types${o}`)},iI=e=>Et.post("/entity-types",e),lI=e=>Et.get(`/entity-types/${e}`),oI=(e,n)=>Et.patch(`/entity-types/${e}`,n),cI=e=>Et.delete(`/entity-types/${e}`),Af=(e,n="perform this action")=>e==null||e===""?Promise.reject(new Error(`Entity type id is required to ${n}`)):null,Tf=e=>{const n=Af(e,"load entity type field order");return n||Et.get(`/entity-types/${e}/field-order`)},uI=(e,n)=>{const s=Af(e,"update entity type field order");return s||Et.put(`/entity-types/${e}/field-order`,n)},Mf=e=>{const n=Af(e,"load entity type field rules");return n||Et.get(`/entity-types/${e}/field-rules`)},dI=(e,n)=>{const s=Af(e,"create entity type field rule");return s||Et.post(`/entity-types/${e}/field-rules`,n)},Dj=(e,n="perform this action")=>e==null||e===""?Promise.reject(new Error(`Field rule id is required to ${n}`)):null,rp=(e,n)=>{const s=Dj(e,"update this field rule");return s||Et.patch(`/entity-type-field-rules/${e}`,n)},fI=e=>{const n=Dj(e,"delete this field rule");return n||Et.delete(`/entity-type-field-rules/${e}`)},Lj=(e,n={})=>{if(!e)return Promise.reject(new Error("worldId is required to load entity type usage"));const s=new URLSearchParams,i=n.viewAsCharacterId??n.characterId??n.character_id??n.viewAs;if(i!=null){const d=String(i).trim();d&&s.set("viewAsCharacterId",d)}const l=s.toString(),o=l?`?${l}`:"";return Et.get(`/worlds/${e}/entity-types${o}`)},mI=e=>Et.get(`/entity-types/${e}/list-columns`),hI=(e,n)=>Et.patch(`/entity-types/${e}/list-columns`,n);async function pI(e=5,n=200){for(let s=0;s<e;s++){const i=qs();if(i)return i;await new Promise(l=>setTimeout(l,n))}return null}async function Pc(){const e=await pI();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function Hc(e,n="request"){if(e.status===401)throw console.warn(` Unauthorized during ${n}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const s=await e.text();throw new Error(`Failed to ${n}: ${e.status} ${s}`)}return e.json()}async function Pi(e={}){const n=await Pc(),s=new URLSearchParams;e.worldId&&s.append("worldId",e.worldId),e.includeFields&&s.append("includeFields",e.includeFields);const i=s.toString(),l=`${sn}/location-types${i?`?${i}`:""}`,o=await fetch(l,{headers:n});return Hc(o,"fetch location types")}async function yI(e){const n=await Pc(),s=await fetch(`${sn}/location-types/${e}`,{headers:n});return Hc(s,"fetch location type")}async function gI(e){const n=await Pc(),s=await fetch(`${sn}/location-types`,{method:"POST",headers:n,body:JSON.stringify(e)});return Hc(s,"create location type")}async function bI(e,n){const s=await Pc(),i=await fetch(`${sn}/location-types/${e}`,{method:"PATCH",headers:s,body:JSON.stringify(n)});return Hc(i,"update location type")}async function xI(e){const n=await Pc(),s=await fetch(`${sn}/location-types/${e}`,{method:"DELETE",headers:n});return Hc(s,"delete location type")}async function vI(e,n={}){if(!e)return Promise.reject(new Error("worldId is required to load location type usage"));const s=new URLSearchParams,i=n.viewAsCharacterId??n.characterId??n.character_id??n.viewAs;if(i!=null){const d=String(i).trim();d&&s.set("viewAsCharacterId",d)}const l=s.toString(),o=l?`?${l}`:"";return Et.get(`/worlds/${e}/location-types${o}`)}function SI({open:e,pinned:n,allowPinning:s=!0,onPinToggle:i,onClose:l}){const o=Xa(),{user:d}=un(),{selectedCampaign:m,selectedCampaignId:p,activeWorld:h,activeWorldId:y,viewAsCharacterId:g,contextKey:x}=jn(),[v,S]=u.useState(!1),[N,E]=u.useState(!1),[j,A]=u.useState(!1),[T,_]=u.useState(!1),[M,k]=u.useState(!1),[C,D]=u.useState(!1),[z,G]=u.useState([]),[U,X]=u.useState(!1),[V,R]=u.useState(""),[B,L]=u.useState([]),[O,$]=u.useState(!1),[F,H]=u.useState(""),[I,Y]=u.useState(!0);u.useEffect(()=>{G([]),R(""),L([]),H("")},[x]);const K=u.useMemo(()=>new URLSearchParams(o.search),[o.search]).get("entityType")??"",re=o.pathname==="/entities"||o.pathname.startsWith("/entities/"),W=y||"",ue=d?.role==="system_admin",Q=!!y,ye=u.useMemo(()=>!m||!d?"":m.members?.find(tt=>tt?.user_id===d.id)?.role??"",[m,d]),ae=u.useMemo(()=>{if(!h||!d?.id)return!1;const ve=h.created_by??h.creator?.id??h.owner_id??h.owner?.id??"";return ve?String(ve)===String(d.id):!1},[h,d?.id]),ke=!!(Q&&(ue||ye==="dm"||ae)),pe=!!(Q&&(ue||ae)),we=!!(Q&&(ue||ae)),ne=!!(Q&&(ue||ae)),Le=!!(Q&&ae),be=u.useMemo(()=>!m||!Array.isArray(m.members)||!d?.id?!1:m.members.some(ve=>ve?.user_id===d.id&&ve?.role==="player"),[m,d]),Oe=u.useMemo(()=>!m||!Array.isArray(m.members)||!d?.id?!1:m.members.some(ve=>ve?.user_id===d.id&&ve?.role==="dm"),[m,d]),Me=!!(Q&&(ke||pe||we||ne||Le)),ut=u.useMemo(()=>p?ue?!0:Oe||be:!1,[ue,Oe,be,p]);u.useEffect(()=>{let ve=!1;if(!W){G([]),R(""),X(!1);return}return(async()=>{X(!0),R("");try{const st=await Lj(W,{viewAsCharacterId:g}),$e=Array.isArray(st?.data)?st.data:Array.isArray(st)?st:[];ve||G($e)}catch(st){ve||(console.error(" Failed to load entity types for world",st),G([]),R("Unable to load entity types"))}finally{ve||X(!1)}})(),()=>{ve=!0}},[W,x,g]),u.useEffect(()=>{let ve=!1;if(!W){L([]),H(""),$(!1);return}return(async()=>{$(!0),H("");try{const st=await vI(W,{viewAsCharacterId:g}),$e=Array.isArray(st?.data)?st.data:Array.isArray(st)?st:[];ve||L($e)}catch(st){ve||(console.error(" Failed to load location types for world",st),L([]),H("Unable to load location types"))}finally{ve||$(!1)}})(),()=>{ve=!0}},[W,x,g]);const ht=u.useCallback(ve=>ve==="/"?o.pathname==="/":o.pathname===ve||o.pathname.startsWith(`${ve}/`),[o.pathname]),_t=u.useCallback(ve=>{Q||(ve.preventDefault(),alert("Please select a campaign or world context before viewing entities."))},[Q]),jt=u.useCallback(ve=>{if(n||ve.defaultPrevented)return;const tt=ve.target,st=tt instanceof Element?tt:tt?.parentElement;if(!st||typeof st.closest!="function")return;const $e=st.closest("a");$e&&ve.currentTarget.contains($e)&&l()},[n,l]);return t.jsxs("aside",{className:`sidebar ${e?"open":"closed"}`,children:[t.jsxs("div",{className:"sidebar-header",children:[t.jsx("span",{children:"Navigation"}),s&&t.jsx("button",{type:"button",className:`pin-btn ${n?"pinned":""}`,title:n?"Unpin menu":"Pin menu","aria-pressed":n,onClick:i,children:t.jsx(dk,{size:16,className:"pin-icon"})})]}),t.jsxs("nav",{className:"nav-links",onClick:n?void 0:jt,children:[t.jsx(Yt,{to:"/",className:ht("/")?"active":"",children:"Home"}),t.jsx(Yt,{to:"/worlds",className:ht("/worlds")?"active":"",children:"Worlds"}),Me&&t.jsxs("div",{className:`nav-group ${j?"collapsed":""}`,children:[t.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>A(ve=>!ve),"aria-expanded":!j,"aria-controls":"world-admin-nav",children:[t.jsx("span",{className:"nav-heading",children:"World Admin"}),t.jsx(Ls,{size:14,className:`nav-heading-icon ${j?"collapsed":""}`})]}),t.jsxs("div",{id:"world-admin-nav",className:"nav-sub-links",children:[ke&&t.jsxs(Yt,{to:"/entities",className:`nav-entity-link ${re&&!K?"active":""}`,onClick:_t,children:[t.jsx(mS,{size:16,className:"nav-icon"}),t.jsx("span",{children:"All Entities"})]}),pe&&t.jsxs(Yt,{to:"/location-types",className:`nav-entity-link ${ht("/location-types")?"active":""}`,children:[t.jsx(Wd,{size:16,className:"nav-icon"}),t.jsx("span",{children:"Location Admin"})]}),ke&&t.jsxs(Yt,{to:"/entity-relationships",className:`nav-entity-link ${ht("/entity-relationships")?"active":""}`,children:[t.jsx(pS,{size:16,className:"nav-icon"}),t.jsx("span",{children:"All Relationships"})]}),pe&&t.jsxs(Yt,{to:"/entity-types",className:`nav-entity-link ${ht("/entity-types")?"active":""}`,children:[t.jsx(vk,{size:16,className:"nav-icon"}),t.jsx("span",{children:"Entity Types"})]}),we&&t.jsxs(Yt,{to:"/entities/bulk-upload",className:`nav-entity-link ${ht("/entities/bulk-upload")?"active":""}`,children:[t.jsx(mS,{size:16,className:"nav-icon"}),t.jsx("span",{children:"Bulk Entity Upload"})]}),ne&&t.jsxs(Yt,{to:"/relationship-types",className:`nav-entity-link ${ht("/relationship-types")?"active":""}`,children:[t.jsx(pS,{size:16,className:"nav-icon"}),t.jsx("span",{children:"Relationship Types"})]}),Le&&W&&t.jsxs(Yt,{to:`/worlds/${W}/access/bulk`,className:`nav-entity-link ${ht(`/worlds/${W}/access/bulk`)?"active":""}`,children:[t.jsx(pj,{size:16,className:"nav-icon"}),t.jsx("span",{children:"Bulk Access Editor"})]}),Le&&W&&t.jsxs(Yt,{to:`/worlds/${W}/collections`,className:`nav-entity-link ${ht(`/worlds/${W}/collections`)?"active":""}`,children:[t.jsx(dj,{size:16,className:"nav-icon"}),t.jsx("span",{children:"Collections"})]}),Le&&W&&t.jsxs(Yt,{to:`/worlds/${W}/access/audit`,className:`nav-entity-link ${ht(`/worlds/${W}/access/audit`)?"active":""}`,children:[t.jsx(uj,{size:16,className:"nav-icon"}),t.jsx("span",{children:"Access Audit Log"})]}),ae&&!Q&&t.jsx("span",{className:"nav-helper",children:"Select a world you own to use the bulk access tools"})]})]}),t.jsxs("div",{className:`nav-group ${v?"collapsed":""}`,children:[t.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>S(ve=>!ve),"aria-expanded":!v,"aria-controls":"campaigns-nav",children:[t.jsx("span",{className:"nav-heading",children:"Campaigns"}),t.jsx(Ls,{size:14,className:`nav-heading-icon ${v?"collapsed":""}`})]}),t.jsxs("div",{id:"campaigns-nav",className:"nav-sub-links",children:[t.jsx(Yt,{to:"/campaigns/my",className:ht("/campaigns/my")?"active":"",children:"My Campaigns"}),t.jsx(Yt,{to:"/campaigns/all",className:ht("/campaigns/all")?"active":"",children:"All"})]})]}),t.jsxs("div",{className:`nav-group ${T?"collapsed":""}`,children:[t.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>_(ve=>!ve),"aria-expanded":!T,"aria-controls":"entities-nav",children:[t.jsx("span",{className:"nav-heading",children:"Entities"}),t.jsx(Ls,{size:14,className:`nav-heading-icon ${T?"collapsed":""}`})]}),t.jsxs("div",{id:"entities-nav",className:"nav-sub-links",children:[U&&t.jsx("span",{className:"nav-helper",children:"Loading entity types"}),!U&&V&&t.jsx("span",{className:"nav-helper error",children:V}),!U&&!V&&z.length===0&&t.jsx("span",{className:"nav-helper",children:Q?"No entities in this world yet":"Select a campaign or world context to see entity types"}),z.map(ve=>t.jsxs(Yt,{to:`/entities?entityType=${ve.id}`,className:`nav-entity-type ${re&&K===ve.id?"active":""}`,children:[t.jsx("span",{className:"nav-entity-label",children:ve.name}),t.jsx("span",{className:"nav-entity-count",children:ve.entityCount})]},ve.id))]})]}),Q&&t.jsxs("div",{className:`nav-group ${M?"collapsed":""}`,children:[t.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>k(ve=>!ve),"aria-expanded":!M,"aria-controls":"locations-nav",children:[t.jsx("span",{className:"nav-heading",children:"Locations"}),t.jsx(Ls,{size:14,className:`nav-heading-icon ${M?"collapsed":""}`})]}),t.jsxs("div",{id:"locations-nav",className:"nav-sub-links",children:[t.jsxs(Yt,{to:"/locations",className:`nav-entity-link ${ht("/locations")?"active":""}`,children:[t.jsx(Wd,{size:16,className:"nav-icon"}),t.jsx("span",{children:"All Locations"})]}),O&&t.jsx("span",{className:"nav-helper",children:"Loading location types"}),!O&&F&&t.jsx("span",{className:"nav-helper error",children:F}),!O&&!F&&B.filter(ve=>ve.focus===!0).map(ve=>t.jsxs(Yt,{to:`/locations?locationType=${ve.id}`,className:`nav-entity-type ${o.pathname==="/locations"&&new URLSearchParams(o.search).get("locationType")===ve.id?"active":""}`,children:[t.jsx("span",{className:"nav-entity-label",children:ve.name}),t.jsx("span",{className:"nav-entity-count",children:ve.locationCount||0})]},ve.id)),!O&&!F&&B.filter(ve=>ve.focus!==!0).length>0&&t.jsxs("div",{className:`nav-group ${I?"collapsed":""}`,children:[t.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>Y(ve=>!ve),"aria-expanded":!I,"aria-controls":"other-locations-nav",children:[t.jsx("span",{className:"nav-heading",children:"Other Types"}),t.jsx(Ls,{size:14,className:`nav-heading-icon ${I?"collapsed":""}`})]}),t.jsx("div",{id:"other-locations-nav",className:"nav-sub-links",children:B.filter(ve=>ve.focus!==!0).map(ve=>t.jsxs(Yt,{to:`/locations?locationType=${ve.id}`,className:`nav-entity-type ${o.pathname==="/locations"&&new URLSearchParams(o.search).get("locationType")===ve.id?"active":""}`,children:[t.jsx("span",{className:"nav-entity-label",children:ve.name}),t.jsx("span",{className:"nav-entity-count",children:ve.locationCount||0})]},ve.id))})]})]})]}),t.jsxs("div",{className:`nav-group ${C?"collapsed":""}`,children:[t.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>D(ve=>!ve),"aria-expanded":!C,"aria-controls":"notes-nav",children:[t.jsx("span",{className:"nav-heading",children:"Notes"}),t.jsx(Ls,{size:14,className:`nav-heading-icon ${C?"collapsed":""}`})]}),t.jsxs("div",{id:"notes-nav",className:"nav-sub-links",children:[!p&&t.jsx("span",{className:"nav-helper",children:"Select a campaign to view notes"}),p&&!ut&&t.jsx("span",{className:"nav-helper",children:"Notes are available to campaign members"}),ut&&t.jsxs(t.Fragment,{children:[t.jsxs(Yt,{to:"/notes/session",className:ht("/notes/session")?"active":"",children:[t.jsx(hy,{size:16,className:"nav-icon"}),t.jsx("span",{children:"Session Notes"})]}),t.jsxs(Yt,{to:"/notes/entities",className:ht("/notes/entities")?"active":"",children:[t.jsx(my,{size:16,className:"nav-icon"}),t.jsx("span",{children:"Entity Notes"})]})]})]})]}),t.jsxs("div",{className:`nav-group ${N?"collapsed":""}`,children:[t.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>E(ve=>!ve),"aria-expanded":!N,"aria-controls":"characters-nav",children:[t.jsx("span",{className:"nav-heading",children:"Characters"}),t.jsx(Ls,{size:14,className:`nav-heading-icon ${N?"collapsed":""}`})]}),t.jsxs("div",{id:"characters-nav",className:"nav-sub-links",children:[t.jsx(Yt,{to:"/characters/my",className:ht("/characters/my")?"active":"",children:"My Characters"}),p&&be&&t.jsx(Yt,{to:"/characters/companions",className:ht("/characters/companions")?"active":"",children:"My Companions"}),p&&Oe&&t.jsx(Yt,{to:"/characters/others",className:ht("/characters/others")?"active":"",children:"All Characters"}),d?.role==="system_admin"&&t.jsx(Yt,{to:"/characters/all",className:ht("/characters/all")?"active admin-link":"admin-link",children:"All Characters"})]})]}),t.jsxs(Yt,{to:"/requests",className:ht("/requests")?"active":"",children:[t.jsx(my,{size:16,className:"nav-icon"}),t.jsx("span",{children:"Feature/Bugs"})]}),d?.role==="system_admin"&&t.jsx(Yt,{to:"/users",className:o.pathname==="/users"?"active admin-link":"admin-link",title:"User Management (Admin Only)",children:"Users"})]})]})}function wI(){const e=()=>typeof window>"u"?!1:window.matchMedia("(max-width: 768px)").matches,[n,s]=u.useState(e),[i,l]=u.useState(()=>!e()),[o,d]=u.useState(!1),m=Xa(),p=u.useRef(i),h=u.useRef(!0);u.useEffect(()=>{if(typeof window>"u")return;const N=window.matchMedia("(max-width: 768px)"),E=j=>{s(j.matches)};return s(N.matches),typeof N.addEventListener=="function"?(N.addEventListener("change",E),()=>N.removeEventListener("change",E)):(N.addListener(E),()=>N.removeListener(E))},[]),u.useEffect(()=>{if(n)l(!1),d(!1);else{const N=h.current;l(N),d(E=>N?!1:E)}},[n]);const y=u.useCallback(()=>{d(N=>!N)},[]),g=u.useCallback(()=>{n||l(N=>{const E=!N;return h.current=E,d(!E),E})},[n]);u.useEffect(()=>{p.current=i},[i]),u.useEffect(()=>{if(i||!o)return;const N=E=>{const j=E.target;(j instanceof Element?j:j&&"parentElement"in j?j.parentElement:null)?.closest?.(".sidebar")||d(!1)};return document.addEventListener("mousedown",N),()=>{document.removeEventListener("mousedown",N)}},[i,o]),u.useEffect(()=>{p.current||d(!1)},[m.pathname,m.search]);const x=(m.pathname||"").match(/^\/entities\/([^/]+)\/?$/),v=!!(x&&x[1]!=="bulk-upload"),S=["content",i?"pinned":"",v?"content--entity-detail":""].filter(Boolean).join(" ");return t.jsxs("div",{className:"app-shell",children:[t.jsx(sI,{onMenuToggle:y}),t.jsxs("div",{className:"app-body",children:[t.jsx(SI,{open:o||i,pinned:i,allowPinning:!n,onPinToggle:g,onClose:()=>d(!1)}),!i&&o&&t.jsx("button",{type:"button",className:"sidebar-overlay","aria-label":"Close navigation menu",onClick:()=>d(!1)}),t.jsxs("main",{className:S,children:[t.jsx(mT,{})," "]})]})]})}const rd={dm:1,player:2,other:3},NI=(e,n)=>!e||!Array.isArray(e.members)||!n?null:e.members.find(s=>s?.user_id===n)??null;function jI(){const{user:e}=un(),{campaigns:n,loading:s,error:i,selectedCampaignId:l,setSelectedCampaignId:o,selectedCampaign:d,refreshCampaigns:m}=jn(),p=e?.username||"Adventurer",[h,y]=u.useState([]),[g,x]=u.useState([]),[v,S]=u.useState(!1),[N,E]=u.useState(!1),[j,A]=u.useState(""),[T,_]=u.useState(""),M=u.useMemo(()=>Array.isArray(n)?[...n].map(U=>({campaign:U,membership:NI(U,e?.id)})).sort((U,X)=>{const V=rd[U.membership?.role]??rd.other,R=rd[X.membership?.role]??rd.other;return V!==R?V-R:U.campaign.name.localeCompare(X.campaign.name)}):[],[n,e?.id]),k=U=>{U&&o(String(U))};u.useEffect(()=>{let U=!1;if(y([]),x([]),A(""),_(""),!l||!e?.id)return S(!1),E(!1),()=>{U=!0};const X=R=>(Array.isArray(R?.data)?R.data:Array.isArray(R)?R:[]).map(L=>{const O=Number(L?.level);return{id:L?.id,name:L?.name||"Unnamed character",className:L?.class||"",level:Number.isNaN(O)?null:O,isActive:L?.is_active??!0,playerName:L?.player?.username||""}});return(async()=>{S(!0),E(!1);try{const R=await js({scope:"my",campaign_id:l});if(U)return;const B=X(R);if(y(B),A(""),S(!1),B.length>0){E(!0);try{const L=await js({scope:"companions",campaign_id:l});if(U)return;const O=X(L);x(O),_("")}catch(L){if(U)return;console.error(" Failed to load companions for home widgets",L),x([]),_(L.message||"Failed to load companions")}finally{U||E(!1)}}else x([]),_(""),E(!1)}catch(R){if(U)return;console.error(" Failed to load characters for home widgets",R),y([]),x([]),A(R.message||"Failed to load characters"),_(""),S(!1),E(!1)}})(),()=>{U=!0}},[l,e?.id]);const C=()=>s?t.jsxs("div",{className:"home-empty-state",children:[t.jsx(mn,{className:"spin",size:24}),t.jsx("p",{children:"Loading your campaigns"})]}):i?t.jsxs("div",{className:"home-empty-state error",children:[t.jsx("p",{children:i}),t.jsx("button",{type:"button",className:"home-refresh",onClick:m,children:"Try again"})]}):M.length?t.jsx("div",{className:"campaign-grid",children:M.map(({campaign:U,membership:X})=>{const V=String(U.id),R=l===V,B=X?.role??"guest",L=B==="dm"?"Dungeon Master":B==="player"?"Player":"Observer";return t.jsxs("button",{type:"button",className:`campaign-card ${B} ${R?"active":""}`,onClick:()=>k(V),"aria-pressed":R,children:[t.jsxs("header",{children:[t.jsxs("span",{className:"campaign-role","aria-label":`Role: ${L}`,children:[B==="dm"?t.jsx(jM,{size:18}):t.jsx(Mk,{size:18}),L]}),R&&t.jsx("span",{className:"campaign-pill",children:"Active"})]}),t.jsxs("div",{className:"campaign-body",children:[t.jsx("h3",{children:U.name}),U.world?.name&&t.jsxs("p",{className:"campaign-world",children:["World  ",U.world.name]})]}),t.jsx("footer",{children:t.jsx("span",{children:"Set campaign context"})})]},V)})}):t.jsxs("div",{className:"home-empty-state",children:[t.jsx(qi,{size:24}),t.jsx("p",{children:"No campaigns yet. Join one to get started!"})]}),D=()=>v?t.jsxs("div",{className:"home-widget-empty",children:[t.jsx(mn,{className:"spin",size:20}),t.jsx("p",{children:"Loading your characters"})]}):j?t.jsx("div",{className:"home-widget-error",children:t.jsx("p",{children:j})}):h.length?t.jsx("div",{className:"home-card-grid",children:h.map(U=>t.jsxs("article",{className:"home-card",children:[t.jsxs("header",{children:[t.jsx("h3",{children:U.name}),t.jsx("span",{className:`home-card-status ${U.isActive?"active":"inactive"}`,children:U.isActive?"Active":"Inactive"})]}),t.jsxs("div",{className:"home-card-meta",children:[U.className&&t.jsx("span",{children:U.className}),U.level!==null&&t.jsxs("span",{children:["Level ",U.level]})]})]},U.id))}):t.jsx("div",{className:"home-widget-empty",children:t.jsx("p",{children:"No characters in this campaign yet."})}),z=()=>N?t.jsxs("div",{className:"home-widget-empty",children:[t.jsx(mn,{className:"spin",size:20}),t.jsx("p",{children:"Loading companions"})]}):T?t.jsx("div",{className:"home-widget-error",children:t.jsx("p",{children:T})}):g.length?t.jsx("div",{className:"home-card-grid",children:g.map(U=>t.jsxs("article",{className:"home-card",children:[t.jsxs("header",{children:[t.jsx("h3",{children:U.name}),t.jsx("span",{className:`home-card-status ${U.isActive?"active":"inactive"}`,children:U.isActive?"Active":"Inactive"})]}),t.jsxs("div",{className:"home-card-meta",children:[U.className&&t.jsx("span",{children:U.className}),U.level!==null&&t.jsxs("span",{children:["Level ",U.level]})]}),U.playerName&&t.jsxs("p",{className:"home-card-player",children:["Played by ",U.playerName]})]},U.id))}):t.jsx("div",{className:"home-widget-empty",children:t.jsx("p",{children:"No companions discovered in this campaign yet."})}),G=!!d&&h.length>0&&!j;return t.jsxs("div",{className:"home-page",children:[t.jsxs("section",{className:"home-hero",children:[t.jsxs("div",{className:"home-hero-text",children:[t.jsx("p",{className:"home-eyebrow",children:"Your Tabletop Worldbuilding Database"}),t.jsxs("h1",{children:["Welcome, ",p,"."]}),t.jsx("p",{className:"home-description",children:"Select a campaign to explore and build the world."})]}),d&&t.jsxs("div",{className:"home-active-campaign",children:[t.jsx("span",{className:"home-active-label",children:"Currently focused"}),t.jsx("h2",{children:d.name}),d.world?.name&&t.jsx("p",{children:d.world.name})]})]}),t.jsxs("section",{className:"home-section",children:[t.jsxs("div",{className:"home-section-header",children:[t.jsxs("div",{children:[t.jsx("h2",{children:"Your campaigns"}),t.jsx("p",{children:"Choose a tile below to update the active campaign context."})]}),t.jsx("button",{type:"button",className:"home-refresh",onClick:m,disabled:s,children:"Refresh"})]}),C()]}),G&&t.jsxs(t.Fragment,{children:[t.jsxs("section",{className:"home-section",children:[t.jsxs("div",{className:"home-section-header",children:[t.jsxs("div",{children:[t.jsx("h2",{children:"My Characters"}),t.jsxs("p",{children:["Quick access to your heroes in ",d.name,"."]})]}),t.jsx(Yt,{to:"/characters/my",className:"home-link",children:"Manage"})]}),D()]}),t.jsxs("section",{className:"home-section",children:[t.jsxs("div",{className:"home-section-header",children:[t.jsxs("div",{children:[t.jsx("h2",{children:"My Companions"}),t.jsxs("p",{children:["Meet the fellow adventurers journeying in ",d.name,"."]})]}),t.jsx(Yt,{to:"/characters/companions",className:"home-link",children:"View list"})]}),z()]})]})]})}function EI({columns:e,visibleCols:n,onChange:s,onClose:i}){const l=u.useRef(null);u.useEffect(()=>{const m=p=>{l.current&&!l.current.contains(p.target)&&i()};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[i]);const o=m=>{s(n.includes(m)?n.filter(p=>p!==m):[...n,m])},d=()=>{s(e.map(m=>m.key)),i()};return t.jsxs("div",{className:"column-picker",ref:l,children:[t.jsx("div",{className:"column-picker-list",children:e.map(m=>t.jsxs("label",{className:"column-option",children:[t.jsx("input",{type:"checkbox",checked:n.includes(m.key),onChange:()=>o(m.key)}),m.label]},m.key))}),t.jsx("button",{className:"reset-btn",onClick:d,children:"Reset Columns"})]})}function hg({value:e,onChange:n,placeholder:s="Search...",ariaLabel:i}){return t.jsx("input",{className:"search-input compact",type:"text",placeholder:s,"aria-label":i||s,value:e,onChange:l=>n(l.target.value)})}const _I={text:"string",string:"string",varchar:"string",number:"number",integer:"number",float:"number",decimal:"number",numeric:"number",boolean:"boolean",bool:"boolean",checkbox:"boolean",date:"date",datetime:"date",timestamp:"date"},xS={string:[{value:"contains",label:"contains"},{value:"not_contains",label:"doesn't contain"},{value:"equals",label:"is exactly"},{value:"not_equals",label:"is not"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"}],number:[{value:"equals",label:"is"},{value:"not_equals",label:"is not"},{value:"greater_than",label:"is greater than"},{value:"less_than",label:"is less than"},{value:"greater_or_equal",label:"is on or above"},{value:"less_or_equal",label:"is on or below"}],boolean:[{value:"is_true",label:"is true"},{value:"is_false",label:"is false"}],date:[{value:"on",label:"is on"},{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"on_or_before",label:"is on or before"},{value:"on_or_after",label:"is on or after"}]},Ti={logic:"AND",conditions:[]},Zl=e=>{if(!e)return"string";const n=String(e).toLowerCase();return _I[n]||"string"},xy=e=>{const n=Zl(e);return xS[n]||xS.string},Oj=(e,n="string")=>{if(e==null||e==="")return"Unassigned";const s=Zl(n);if(Array.isArray(e))return e.length?e.map(i=>Oj(i,n)).join(", "):"Unassigned";if(s==="date"){const i=e instanceof Date?e:new Date(e);return Number.isNaN(i.getTime())?String(e):i.toLocaleDateString()}return s==="boolean"?e?"True":"False":String(e)},Zd=e=>{if(e==null||e==="")return null;const n=Number(e);return Number.isNaN(n)?null:n},Qd=e=>{if(e==null||e==="")return null;const n=e instanceof Date?e:new Date(e);return Number.isNaN(n.getTime())?null:n},vy=e=>{if(e==null||e==="")return null;if(typeof e=="string"){const n=e.trim();return n.length>0?n:null}if(typeof e=="object"&&!Array.isArray(e)){const n=e.id??e.value??e.key??e.slug??e.uuid??null;return n!=null?String(n).trim():null}if(Array.isArray(e)){for(const n of e){const s=vy(n);if(s)return s}return null}return null},$j=e=>{if(e==null)return"";if(typeof e=="string")return e.toLowerCase();if(typeof e=="number")return String(e);if(typeof e=="boolean")return e?"true":"false";if(e instanceof Date)return e.toISOString().toLowerCase();if(Array.isArray(e))return e.map(n=>$j(n)).filter(Boolean).join(" ");if(typeof e=="object")try{return JSON.stringify(e).toLowerCase()}catch{return""}return String(e).toLowerCase()},CI=e=>{const n=e.trim().toLowerCase();return n?s=>$j(s).includes(n):()=>!0},AI=(e,n)=>e.localeCompare(n,void 0,{sensitivity:"base"}),TI=(e,n,s="string")=>{const i=Zl(s),l=e==null||e==="",o=n==null||n==="";if(l&&o)return 0;if(l)return 1;if(o)return-1;if(i==="number"){const d=Zd(e),m=Zd(n);return d===null&&m===null?0:d===null?1:m===null?-1:d-m}if(i==="date"){const d=Qd(e),m=Qd(n);return!d&&!m?0:d?m?d.getTime()-m.getTime():-1:1}if(i==="boolean"){const d=!!e;return d===!!n?0:d?-1:1}return AI(String(e),String(n))},MI=(e,n,s="string")=>{const{operator:i,value:l}=n,o=Zl(s),d=s&&String(s).toLowerCase()==="reference",m=p=>{if(d){const v=vy(p),S=vy(l)||String(l??"").trim(),N=v?String(v).toLowerCase():"",E=S?String(S).toLowerCase():"";switch(i){case"equals":return N===E&&N.length>0;case"not_equals":return N!==E||N.length===0;case"contains":return N.includes(E);case"not_contains":return!N.includes(E)}}if(o==="number"){const v=Zd(p),S=Zd(l);if(v===null&&S===null)return i==="equals";if(v===null||S===null)return!1;switch(i){case"equals":return v===S;case"not_equals":return v!==S;case"greater_than":return v>S;case"less_than":return v<S;case"greater_or_equal":return v>=S;case"less_or_equal":return v<=S;default:return!1}}if(o==="date"){const v=Qd(p),S=Qd(l);if(!v||!S)return!1;switch(i){case"on":return v.getFullYear()===S.getFullYear()&&v.getMonth()===S.getMonth()&&v.getDate()===S.getDate();case"before":return v.getTime()<S.getTime();case"after":return v.getTime()>S.getTime();case"on_or_before":return v.getTime()<=S.getTime();case"on_or_after":return v.getTime()>=S.getTime();default:return!1}}if(o==="boolean"){const v=!!p;return i==="is_true"?v===!0:i==="is_false"?v===!1:i==="equals"?v===(String(l).toLowerCase()==="true"):i==="not_equals"?v!==(String(l).toLowerCase()==="true"):!1}const h=String(p??""),y=String(l??""),g=h.toLowerCase(),x=y.toLowerCase();switch(i){case"contains":return g.includes(x);case"not_contains":return!g.includes(x);case"equals":return g===x;case"not_equals":return g!==x;case"starts_with":return g.startsWith(x);case"ends_with":return g.endsWith(x);default:return!1}};return Array.isArray(e)?e.length===0?m(""):i==="not_contains"?e.every(p=>!m(p)):e.some(p=>m(p)):m(e)},Fj=e=>{if(!e||typeof e!="object")return!1;const{conditions:n}=e;return Array.isArray(n)?n.some(s=>s.field&&s.operator):!1},Od=(e="",n="string")=>({id:`condition-${Math.random().toString(36).slice(2)}`,field:e,operator:xy(n)[0]?.value||"equals",value:""}),vS=(e,n)=>{if(!e||!n||typeof n!="string")return;const s=n.split(".");let i=e;for(const l of s){if(i==null)return;i=i[l]}return i},Wo=e=>Array.isArray(e)?e:[],kI=(e=[])=>e.map(n=>({...n,dataType:Zl(n.dataType||n.type)})),RI={};function zj(e,n=RI){const s=u.useMemo(()=>kI(n.columns||[]),[n.columns]),i=u.useMemo(()=>new Map(s.map(O=>[O.key,O])),[s]),l=u.useCallback((O,$)=>{const F=i.get($)||{};return typeof F.accessor=="function"?F.accessor(O):F.path?vS(O,F.path):vS(O,$)??O?.[$]},[i]),[o,d]=u.useState(""),[m,p]=u.useState({key:"",direction:"asc"}),[h,y]=u.useState(""),[g,x]=u.useState(Ti),[v,S]=u.useState(new Set),N=u.useCallback(()=>{S(new Set)},[]),E=u.useCallback(O=>{O&&p($=>{if($.key===O){const F=$.direction==="asc"?"desc":"asc";return{key:O,direction:F}}return{key:O,direction:"asc"}})},[]),j=u.useCallback(O=>{y($=>{const F=$===O?"":O;return F!==$&&N(),F})},[N]),A=u.useMemo(()=>CI(o),[o]),T=u.useMemo(()=>s.filter(O=>O.searchable!==!1),[s]),_=u.useMemo(()=>{if(!o)return Wo(e);const O=A;return Wo(e).filter($=>T.some(F=>{const H=l($,F.key);return O(H)}))},[e,A,l,T,o]),M=u.useMemo(()=>g||Ti,[g]),k=u.useMemo(()=>Wo(M.conditions),[M]),C=(M.logic||"AND").toUpperCase()==="OR"?"OR":"AND",D=Fj(M),z=u.useMemo(()=>D?_.filter(O=>{const $=k.map(F=>{const H=i.get(F.field);if(!H||!F.operator)return!1;const I=l(O,F.field);return MI(I,F,H.dataType)});return C==="OR"?$.some(Boolean):$.every(Boolean)}):_,[_,k,i,l,C,D]),G=u.useMemo(()=>{const O=Wo(z);if(!m.key)return O;const $=i.get(m.key);if(!$)return O;const F=[...O];return F.sort((H,I)=>{const Y=l(H,m.key),P=l(I,m.key),K=TI(Y,P,$.dataType);return m.direction==="asc"?K:-K}),F},[z,m,i,l]),U=u.useMemo(()=>{if(!h)return[];const O=i.get(h);if(!O)return[];const $=[],F=new Map;return G.forEach(H=>{const I=l(H,h),Y=Oj(I,O.dataType),P=`${h}:${Y}`;F.has(P)||(F.set(P,$.length),$.push({id:P,value:I,label:Y,items:[]}));const K=F.get(P);$[K].items.push(H)}),$},[G,h,i,l]),X=u.useCallback(O=>{O&&S($=>{const F=new Set($);return F.has(O)?F.delete(O):F.add(O),F})},[]),V=u.useCallback(O=>O?v.has(O):!1,[v]),R=u.useCallback(()=>{x(Ti)},[]),B=u.useCallback(O=>{if(!O||typeof O!="object"){x(Ti);return}const $=(O.logic||"AND").toUpperCase()==="OR"?"OR":"AND",F=Wo(O.conditions).map(H=>{const I=i.get(H.field);return I?{...H,field:I.key,operator:H.operator||Od(I.key,I.dataType).operator,value:H.value??""}:null});x({logic:$,conditions:F.filter(Boolean)})},[i]);return{searchTerm:o,setSearchTerm:d,sortState:m,toggleSort:E,groupBy:h,setGroupBy:j,filters:M,setFilters:B,clearFilters:R,filterActive:D,data:G,groups:U,visibleData:h?U:G,getValue:l,toggleGroupCollapse:X,isGroupCollapsed:V,columns:s}}const Bj=e=>{if(!e||typeof e!="object")return e;const n=e.imageData!==void 0?e.imageData:e.image_data!==void 0?e.image_data:null,s=e.imageMimeType!==void 0?e.imageMimeType:e.image_mime_type!==void 0?e.image_mime_type:null;return e.imageData===n&&e.imageMimeType===s?e:{...e,imageData:n,imageMimeType:s}},Ya=e=>{if(!e||typeof e!="object")return null;const n=e.data&&typeof e.data=="object"&&"id"in e.data?e.data:e.entity&&typeof e.entity=="object"&&"id"in e.entity?e.entity:"id"in e?e:null;return n?Bj(n):null},Ql=e=>{if(!e||typeof e!="object")return"";const n=e.imageData??e.image_data,s=e.imageMimeType??e.image_mime_type;return!n||!s?"":`data:${s};base64,${n}`},II=Object.freeze([]);function Cc({worldId:e,label:n,value:s,onChange:i,allowedTypeIds:l=[],disabled:o=!1,placeholder:d="Search entities",staticOptions:m,minSearchLength:p=2,onResolved:h,required:y=!1}){const[g,x]=u.useState(""),[v,S]=u.useState([]),[N,E]=u.useState(!1),[j,A]=u.useState(!1),[T,_]=u.useState(null),[M,k]=u.useState(""),C=u.useRef(null),D=u.useRef(null),z=u.useRef(h),G=u.useMemo(()=>[...l],[JSON.stringify(l)]),U=Array.isArray(m)?m:II,X=u.useMemo(()=>Array.isArray(U)?U.map((H,I)=>{if(H==null)return null;if(typeof H=="object"){const P=H.value??H.id??H.key??H.slug??`static-${I}`;if(P==null)return null;const K=H.label??H.name??H.title??H.display??H.displayName??P;return{id:String(P),name:String(K),entity_type:H.entity_type||H.entityType||null,typeName:H.typeName||null,_static:!0}}const Y=String(H);return{id:Y,name:Y,_static:!0}}).filter(Boolean):[],[U]),V=H=>{if(!H)return"";const I=H.entity_type?.name||H.entityType?.name||H.typeName||H.type?.name||"";return I?`${H.name} (${I})`:H.name};u.useEffect(()=>{o&&A(!1)},[o]),u.useEffect(()=>()=>{D.current&&clearTimeout(D.current)},[]),u.useEffect(()=>{if(!s){_(null),x("");return}if(typeof s=="object"&&s.id){const P=V(s);(!T||T.id!==s.id)&&(_(s),x(P));return}if(typeof s!="string")return;const H=s;if(T?.id===H)return;const I=X.find(P=>String(P.id)===String(H));if(I){_(I),x(V(I));return}let Y=!1;return(async()=>{try{const P=await Us(H);if(Y)return;const K=Ya(P);if(K?.id){_(K),x(V(K));return}}catch(P){Y||console.warn("Entity lookup failed",P)}Y||(_({id:H,name:H}),x(H))})(),()=>{Y=!0}},[s,X,T?.id]),u.useEffect(()=>{g.trim().length===0&&S([])},[G]),u.useEffect(()=>{if(!g.trim()||T||o)return;const H=g.trim();if(H.length<p){S([]);return}return D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{if(!e){S([]),E(!1);return}(async()=>{try{E(!0),k("");const I={worldId:e,query:H,limit:20};G&&G.length>0&&(I.typeIds=G);const Y=await Tj(I),P=Array.isArray(Y?.data)?Y.data:Y,K=Array.isArray(P)?G&&G.length>0?P.filter(re=>{const W=re.typeId||re.entity_type_id||re.entityType?.id||"";return W&&G.includes(String(W))}):P:[];S(K)}catch(I){console.error("Entity search failed",I),S([]),k(I.message||"Failed to search entities.")}finally{E(!1)}})()},400),()=>{D.current&&clearTimeout(D.current)}},[g,e,T,G,o,p]),u.useEffect(()=>{const H=I=>{C.current&&!C.current.contains(I.target)&&A(!1)};return document.addEventListener("mousedown",H),()=>document.removeEventListener("mousedown",H)},[]),u.useEffect(()=>{z.current=h},[h]),u.useEffect(()=>{z.current?.(T||null)},[T]);const R=u.useMemo(()=>{if(!X.length)return[];if(!g.trim())return X;const H=g.trim().toLowerCase();return X.filter(I=>V(I).toLowerCase().includes(H))},[X,g]),B=u.useMemo(()=>{const H=new Map,I=[];return R.forEach(Y=>{const P=Y?.id;if(P==null)return;const K=String(P);H.has(K)||(H.set(K,!0),I.push(Y))}),v.forEach(Y=>{const P=Y?.id;if(P==null)return;const K=String(P);H.has(K)||(H.set(K,!0),I.push(Y))}),I},[R,v]),L=H=>{H&&(_(H),x(V(H)),A(!1),S([]),k(""),i?.(H))},O=()=>{_(null),x(""),S([]),k(""),A(!1),i?.(null)},$=j&&B.length>0,F=j&&!N&&!B.length&&g.trim().length>=p&&!T;return t.jsxs("div",{className:"entity-search-select",ref:C,children:[n&&t.jsx("label",{children:n}),t.jsxs("div",{className:"entity-search-wrapper",children:[t.jsx("input",{type:"text",value:g,required:y,onChange:H=>{const I=H.target.value;x(I),_(null),o||A(!0)},onFocus:()=>{o||A(!0)},disabled:o,placeholder:d,className:"entity-search-input"}),T&&!o&&t.jsx("button",{type:"button",className:"clear-btn",onClick:O,title:"Clear selection","aria-label":"Clear selection",children:""})]}),N&&t.jsx("div",{className:"small text-muted",children:"Searching"}),M&&t.jsx("div",{className:"small text-warning",children:M}),$&&t.jsx("ul",{className:"entity-results",children:B.map(H=>t.jsx("li",{onMouseDown:I=>I.preventDefault(),onClick:()=>L(H),className:T?.id===H.id?"selected":"",children:V(H)},H.id))}),F&&t.jsx("div",{className:"small text-muted",style:{marginTop:"0.25rem"},children:"No matches found."})]})}const SS=e=>Array.isArray(e)?e:[],DI=e=>{const n=e?.options?.choices;return!Array.isArray(n)||n.length===0?[]:n.map((s,i)=>{if(s==null)return null;if(typeof s=="object"){const o=s.value??s.id??s.key??s.slug??`choice-${i}`,d=s.label??s.name??s.title??s.display??o;return o==null?null:{value:String(o),label:String(d??o)}}const l=String(s);return{value:l,label:l}}).filter(Boolean)};function Uj({open:e,onClose:n,fields:s=[],value:i=Ti,worldId:l,onApply:o}){const d=Array.isArray(s)?s:[],m=d[0]?.key||"",[p,h]=u.useState(i.logic||"AND"),[y,g]=u.useState(()=>{const k=SS(i.conditions);return k.length>0?k.map(C=>({...C})):[Od(m,d[0]?.dataType)]}),[x,v]=u.useState(new Map);u.useEffect(()=>{if(!e)return;h(i.logic||"AND");const k=SS(i.conditions);k.length>0?g(k.map(C=>({...C}))):g([Od(m,d[0]?.dataType)])},[e,i,m,d]);const S=()=>{const k=y[0]?.field||m,C=d.find(D=>D.key===k);g(D=>[...D,Od(k,C?.dataType)])},N=(k,C)=>{g(D=>{const z=[...D],G=d.find(U=>U.key===C);return z[k]={...z[k],field:C,operator:xy(G?.dataType)[0]?.value||"equals",value:""},z})},E=(k,C)=>{g(D=>{const z=[...D];return z[k]={...z[k],operator:C},z})},j=(k,C)=>{g(D=>{const z=[...D];return z[k]={...z[k],value:C},z})},A=k=>{g(C=>{if(C.length===1)return C;const D=[...C];return D.splice(k,1),D})},T=()=>{const k=y.map(C=>({...C})).filter(C=>C.field&&C.operator);if(k.length===0){o?.(Ti);return}o?.({logic:p,conditions:k})},_=u.useMemo(()=>(Array.isArray(s)?s:[]).map(C=>({...C,originalDataType:C.dataType||C.type||"string",dataType:Zl(C.dataType||C.type)})),[s]),M=u.useCallback((k,C)=>{if(!k){v(G=>{const U=new Map(G),X=y[C];return X?.value&&U.delete(String(X.value)),U});return}const D=String(k.id),z=k.name||`Entity ${D}`;v(G=>{const U=new Map(G);return U.set(D,z),U})},[y]);return e?t.jsx("div",{className:"condition-modal-backdrop",role:"dialog","aria-modal":"true",children:t.jsxs("div",{className:"condition-modal",children:[t.jsxs("div",{className:"condition-modal-header",children:[t.jsx("h2",{children:"Filters"}),t.jsx("button",{type:"button",className:"icon-btn",onClick:n,"aria-label":"Close filters",children:t.jsx(ea,{size:18})})]}),t.jsxs("div",{className:"condition-logic",children:[t.jsx("span",{children:"Match records where"}),t.jsxs("div",{className:"logic-toggle",role:"group","aria-label":"Filter logic",children:[t.jsx("button",{type:"button",className:`logic-btn${p==="AND"?" is-active":""}`,onClick:()=>h("AND"),children:"All conditions (AND)"}),t.jsx("button",{type:"button",className:`logic-btn${p==="OR"?" is-active":""}`,onClick:()=>h("OR"),children:"Any condition (OR)"})]})]}),t.jsx("div",{className:"condition-list",children:Array.isArray(y)&&y.map((k,C)=>{const D=_.find(V=>V.key===k.field)||_[0]||{dataType:"string",key:""},z=xy(D.dataType),G=Array.isArray(z)?z:[],U=k.operator||G[0]?.value||"equals",X=!["is_true","is_false"].includes(U);return t.jsxs("div",{className:"condition-row",children:[t.jsx("select",{className:"condition-field",value:k.field||D.key,onChange:V=>N(C,V.target.value),children:_.map(V=>t.jsx("option",{value:V.key,children:V.label},V.key))}),t.jsx("select",{className:"condition-operator",value:U,onChange:V=>E(C,V.target.value),children:G.map(V=>t.jsx("option",{value:V.value,children:V.label},V.value))}),X?(()=>{const V=D.originalDataType||D.dataType,R=V==="boolean"||V==="bool",B=V==="enum",L=D.referenceTypeId||D.reference_type_id||D.referenceType?.id||null,O=(V==="reference"||D.dataType==="reference")&&L,$=(U==="equals"||U==="not_equals")&&(R||B||O);if($&&R)return t.jsxs("select",{className:"condition-value",value:k.value??"",onChange:F=>j(C,F.target.value),children:[t.jsx("option",{value:"",children:"Select..."}),t.jsx("option",{value:"true",children:"True"}),t.jsx("option",{value:"false",children:"False"})]});if($&&B){const F=DI(D),H=Array.isArray(F)?F:[];return H.length===0?t.jsx("input",{className:"condition-value",type:"text",value:k.value??"",onChange:I=>j(C,I.target.value),placeholder:"Value"}):t.jsxs("select",{className:"condition-value",value:k.value??"",onChange:I=>j(C,I.target.value),children:[t.jsx("option",{value:"",children:"Select..."}),H.map(I=>t.jsx("option",{value:I.value,children:I.label},I.value))]})}if($&&O){const F=D.referenceTypeId||D.reference_type_id||D.referenceType?.id||null,H=F?String(F).trim():null,I=D.referenceTypeName||D.reference_type_name||D.referenceType?.name||"entities",Y=k.value,P=H&&H.length>0?[H]:[],K=Y||null;return t.jsx("div",{className:"condition-value-reference",children:t.jsx(Cc,{worldId:l,value:K,allowedTypeIds:P,placeholder:`Search ${I.toLowerCase()}...`,disabled:!l||!H,onChange:re=>{if(!re)j(C,""),M(null,C);else{const W=String(re.id);j(C,W),M(re,C)}},onResolved:re=>M(re,C),minSearchLength:2})})}return t.jsx("input",{className:"condition-value",type:D.dataType==="number"?"number":D.dataType==="date"?"date":"text",value:k.value??"",onChange:F=>j(C,F.target.value),placeholder:"Value"})})():t.jsx("span",{className:"condition-value placeholder",children:"No value"}),t.jsx("button",{type:"button",className:"icon-btn",onClick:()=>A(C),disabled:y.length===1,"aria-label":"Remove condition",children:t.jsx(zn,{size:16})})]},k.id||`${k.field}-${C}`)})}),t.jsxs("div",{className:"condition-actions",children:[t.jsxs("button",{type:"button",className:"btn secondary",onClick:S,children:[t.jsx(sa,{size:16})," Add condition"]}),t.jsxs("div",{className:"condition-action-right",children:[Fj(i)&&t.jsx("button",{type:"button",className:"btn ghost",onClick:()=>o?.(Ti),children:"Clear filters"}),t.jsx("button",{type:"button",className:"btn submit",onClick:T,children:"Apply filters"})]})]})]})}):null}function kf({data:e,columns:n,title:s,extraActions:i,onRowClick:l}){const[o,d]=u.useState(n.map(M=>M.key)),[m,p]=u.useState(!1),[h,y]=u.useState(!1),[g,x]=u.useState({open:!1,column:null,x:0,y:0}),v=u.useMemo(()=>n.map(M=>({...M,dataType:M.dataType||M.type||"string"})),[n]),S=zj(e,{columns:v}),N=v.filter(M=>o.includes(M.key));u.useEffect(()=>{d(M=>{const k=v.map(D=>D.key),C=M.filter(D=>k.includes(D));return k.forEach(D=>{C.includes(D)||C.push(D)}),C.length===M.length&&C.every((D,z)=>D===M[z])?M:C})},[v]);const E=M=>{S.toggleSort(M.key)},j=(M,k)=>{M.preventDefault(),x({open:!0,column:k,x:M.clientX,y:M.clientY})};u.useEffect(()=>{if(!g.open)return;const M=()=>x({open:!1,column:null,x:0,y:0});return window.addEventListener("click",M),window.addEventListener("contextmenu",M),()=>{window.removeEventListener("click",M),window.removeEventListener("contextmenu",M)}},[g.open]);const A=M=>{S.setGroupBy(M.key),x({open:!1,column:null,x:0,y:0})},T=(M,k)=>{if(typeof k.render=="function")return k.render(M,S.getValue(M,k.key));const C=M[k.key];return C!==void 0?C:S.getValue(M,k.key)},_=S.groupBy?S.groups.some(M=>M.items.length>0):S.data.length>0;return t.jsxs("div",{className:"list-viewer",children:[t.jsxs("div",{className:"list-viewer-header",children:[t.jsx("h2",{children:s}),t.jsxs("div",{className:"list-controls",children:[i&&t.jsx("div",{className:"extra-actions",children:i}),t.jsx(hg,{value:S.searchTerm,onChange:S.setSearchTerm,placeholder:`Search ${s.toLowerCase()}...`}),t.jsxs("button",{type:"button",className:`btn secondary compact${S.filterActive?" is-active":""}`,onClick:()=>y(!0),children:[t.jsx(Sf,{size:16})," Filters"]}),t.jsxs("div",{className:"column-picker-wrapper",children:[t.jsx("button",{className:"icon-btn",title:"Column settings",onClick:()=>p(M=>!M),children:t.jsx(hj,{size:18})}),m&&t.jsx("div",{className:"column-picker-popover",children:t.jsx(EI,{columns:v,visibleCols:o,onChange:d,onClose:()=>p(!1)})})]})]})]}),_?t.jsx("div",{className:"list-viewer-table-wrapper",children:t.jsxs("table",{children:[t.jsx("thead",{children:t.jsx("tr",{children:N.map(M=>{const k=S.sortState.key===M.key,C=S.sortState.direction,D=S.groupBy===M.key;return t.jsx("th",{onClick:()=>E(M),onContextMenu:z=>j(z,M),className:"sortable-header",role:"button",tabIndex:0,children:t.jsxs("span",{className:"header-label",children:[M.label,k&&t.jsx("span",{className:"sort-indicator",children:C==="asc"?"":""}),D&&t.jsx("span",{className:"group-indicator",children:"Grouped"})]})},M.key)})})}),t.jsx("tbody",{children:S.groupBy?S.groups.map(M=>t.jsxs(u.Fragment,{children:[t.jsx("tr",{className:"group-header-row",children:t.jsxs("td",{colSpan:N.length,children:[t.jsx("button",{type:"button",className:"group-toggle",onClick:()=>S.toggleGroupCollapse(M.id),children:S.isGroupCollapsed(M.id)?t.jsx(Jr,{size:14}):t.jsx(Ls,{size:14})}),t.jsxs("span",{className:"group-label",children:[M.label," ",t.jsxs("span",{className:"group-count",children:["(",M.items.length,")"]})]})]})}),!S.isGroupCollapsed(M.id)&&M.items.map(k=>t.jsx("tr",{onClick:()=>l&&l(k),className:l?"clickable-row":"",children:N.map(C=>t.jsx("td",{"data-column":C.label||C.key,children:T(k,C)},C.key))},k.id))]},M.id)):S.data.map(M=>t.jsx("tr",{onClick:()=>l&&l(M),className:l?"clickable-row":"",children:N.map(k=>t.jsx("td",{"data-column":k.label||k.key,children:T(M,k)},k.key))},M.id))})]})}):t.jsx("div",{className:"empty-state",children:t.jsx("p",{children:"No results found."})}),g.open&&g.column&&t.jsxs("div",{className:"column-context-menu",style:{top:g.y,left:g.x},role:"menu",children:[t.jsx("button",{type:"button",onClick:()=>A(g.column),children:S.groupBy===g.column.key?"Remove grouping":`Group by ${g.column.label}`}),S.groupBy&&S.groupBy!==g.column.key&&t.jsx("button",{type:"button",onClick:()=>A({key:""}),children:"Clear grouping"})]}),t.jsx(Uj,{open:h,onClose:()=>y(!1),fields:v.map(M=>({key:M.key,label:M.label,dataType:M.dataType})),value:S.filters,onApply:M=>{S.setFilters(M),y(!1)}})]})}const LI="modulepreload",OI=function(e){return"/"+e},wS={},si=function(n,s,i){let l=Promise.resolve();if(s&&s.length>0){let p=function(h){return Promise.all(h.map(y=>Promise.resolve(y).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),m=d?.nonce||d?.getAttribute("nonce");l=p(s.map(h=>{if(h=OI(h),h in wS)return;wS[h]=!0;const y=h.endsWith(".css"),g=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${g}`))return;const x=document.createElement("link");if(x.rel=y?"stylesheet":LI,y||(x.as="script"),x.crossOrigin="",x.href=h,m&&x.setAttribute("nonce",m),document.head.appendChild(x),y)return new Promise((v,S)=>{x.addEventListener("load",v),x.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(d){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=d,window.dispatchEvent(m),!m.defaultPrevented)throw d}return l.then(d=>{for(const m of d||[])m.status==="rejected"&&o(m.reason);return n().catch(o)})};function qj(e){if(!e&&e!==0)return null;if(typeof e=="object"&&e!==null){const s=e.value??e.id??e.key??e.slug??null;if(s==null)return null;const i=e.label??e.name??e.title??e.username??e.email??String(s);return{value:String(s),label:String(i),raw:e}}const n=String(e);return{value:n,label:n,raw:e}}function $s({selected:e=[],options:n=[],onChange:s,placeholder:i="Search and select...",disabled:l=!1,noOptionsMessage:o="No options available.",loading:d=!1,inputId:m}){const[p,h]=u.useState(""),[y,g]=u.useState(!1),x=u.useRef(null),v=u.useMemo(()=>{const C=n.map(z=>qj(z)).filter(Boolean),D=new Set;return C.filter(z=>{const G=z.value;return D.has(G)?!1:(D.add(G),!0)})},[n]),S=u.useMemo(()=>{const C=new Set;return e.forEach(D=>{D!=null&&C.add(String(D))}),C},[e]),N=u.useMemo(()=>{const C=new Map(v.map(D=>[D.value,D]));return Array.from(S).map(D=>{const z=C.get(D);return z||{value:D,label:D}})},[v,S]),E=u.useMemo(()=>v.filter(C=>!S.has(C.value)),[v,S]),j=u.useMemo(()=>{if(!p)return E;const C=p.toLowerCase();return E.filter(D=>D.label.toLowerCase().includes(C))},[E,p]);u.useEffect(()=>{if(!y)return;const C=D=>{x.current&&(x.current.contains(D.target)||g(!1))};return document.addEventListener("mousedown",C),()=>document.removeEventListener("mousedown",C)},[y]);const A=C=>{if(l)return;const D=[],z=new Set;C.forEach(G=>{if(G==null)return;const U=String(G);z.has(U)||(z.add(U),D.push(U))}),s?.(D)},T=C=>{if(!C)return;const D=[...S,C.value];A(D),h(""),g(!1)},_=C=>{const D=String(C),z=Array.from(S).filter(G=>G!==D);A(z)},M=y&&!l,k=()=>d?"Loading options...":E.length===0?S.size>0?"All options selected.":o:"No matches found.";return t.jsxs("div",{className:`list-collector ${l?"disabled":""}`,ref:x,children:[t.jsxs("div",{className:"list-collector-input-wrapper",children:[t.jsx("input",{id:m,type:"text",className:"list-collector-input",value:p,placeholder:i,disabled:l,onFocus:()=>!l&&g(!0),onChange:C=>{h(C.target.value),y||g(!0)},onKeyDown:C=>{C.key==="Enter"&&j.length>0&&(C.preventDefault(),T(j[0])),C.key==="Escape"&&(g(!1),C.currentTarget.blur())}}),t.jsx("span",{className:"list-collector-icon","aria-hidden":"true",children:""})]}),M&&t.jsx("div",{className:"list-collector-dropdown",children:j.length>0?t.jsx("ul",{children:j.map(C=>t.jsx("li",{children:t.jsx("button",{type:"button",onMouseDown:D=>D.preventDefault(),onClick:()=>T(C),className:"list-collector-option",children:C.label})},C.value))}):t.jsx("div",{className:"list-collector-empty",children:k()})}),N.length>0&&t.jsx("div",{className:"list-collector-pills",children:N.map(C=>t.jsxs("span",{className:"list-collector-pill",children:[t.jsx("span",{className:"pill-label",children:C.label}),!l&&t.jsx("button",{type:"button",className:"pill-remove",onClick:()=>_(C.value),"aria-label":`Remove ${C.label}`,children:""})]},C.value))})]})}async function $I(e=5,n=200){for(let s=0;s<e;s++){const i=qs();if(i)return i;await new Promise(l=>setTimeout(l,n))}return null}async function Hi(){const e=await $I();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function Vi(e,n="request"){if(e.status===401)throw console.warn(` Unauthorized during ${n}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const s=await e.text();throw new Error(`Failed to ${n}: ${e.status} ${s}`)}return e.json()}async function Li(e={}){const n=new URLSearchParams;e.worldId&&n.append("worldId",e.worldId),e.parentId!==void 0&&e.parentId!==null&&n.append("parentId",e.parentId),e.locationTypeId&&n.append("locationTypeId",e.locationTypeId),e.includeEntities&&n.append("includeEntities",e.includeEntities),e.all&&n.append("all",e.all);const s=n.toString(),i=`/locations${s?`?${s}`:""}`;return Et.get(i)}async function FI(e={}){const n=new URLSearchParams;if(e.worldId&&n.append("worldId",e.worldId),e.query&&n.append("q",e.query),e.limit&&n.append("limit",e.limit),e.offset&&n.append("offset",e.offset),e.locationTypeIds){const l=Array.isArray(e.locationTypeIds)?e.locationTypeIds.join(","):e.locationTypeIds;n.append("locationTypeIds",l)}const s=n.toString(),i=`/locations/search${s?`?${s}`:""}`;return Et.get(i)}async function Ri(e){return Et.get(`/locations/${e}`)}async function pg(e){const n=await Hi(),s=await fetch(`${sn}/locations/${e}/path`,{headers:n});return Vi(s,"fetch location path")}async function yg(e){const n=await Hi(),s=await fetch(`${sn}/locations/${e}/entities`,{headers:n});return Vi(s,"fetch location entities")}async function Pj(e){return Et.post("/locations",e)}async function Rf(e,n){return Et.patch(`/locations/${e}`,n)}async function gg(e){const n=await Hi(),s=await fetch(`${sn}/locations/${e}`,{method:"DELETE",headers:n});return Vi(s,"delete location")}async function Hj(e,n){const s=await Hi(),i=await fetch(`${sn}/locations/${e}/entities`,{method:"POST",headers:s,body:JSON.stringify({entity_id:n})});return Vi(i,"add entity to location")}async function Vj(e,n){const s=await Hi(),i=await fetch(`${sn}/locations/${e}/entities/${n}`,{method:"DELETE",headers:s});return Vi(i,"remove entity from location")}async function Yj(e,n){const s=await Hi(),i=await fetch(`${sn}/locations/${e}/children`,{method:"POST",headers:s,body:JSON.stringify({child_location_id:n})});return Vi(i,"add child location")}async function Gj(e,n){const s=await Hi(),i=await fetch(`${sn}/locations/${e}/children/${n}`,{method:"DELETE",headers:s});return Vi(i,"remove child location")}async function Kj(e,n){return Et.put(`/locations/${e}/importance`,{importance:n})}const Xj=(e,n={})=>{const s=new URLSearchParams,i=n.campaignId??n.campaign_id;i&&s.set("campaignId",i);const l=s.toString();return Et.get(`/locations/${e}/notes${l?`?${l}`:""}`)},Wj=(e,n={})=>{const s=new URLSearchParams,i=n.campaignId??n.campaign_id;i&&s.set("campaignId",i);const l=s.toString();return Et.get(`/locations/${e}/mention-notes${l?`?${l}`:""}`)},Zj=(e,n={})=>{const s=new URLSearchParams,i=n.campaignId??n.campaign_id;i&&s.set("campaignId",i);const l=s.toString();return Et.get(`/locations/${e}/mentions/session-notes${l?`?${l}`:""}`)},Qj=(e,n)=>Et.post(`/locations/${e}/notes`,n),bg=(e,n,s)=>Et.put(`/locations/${e}/notes/${n}`,s),xg=(e,n,s={})=>{const i=new URLSearchParams,l=s.campaignId??s.campaign_id;l&&i.set("campaignId",l);const o=i.toString();return Et.delete(`/locations/${e}/notes/${n}${o?`?${o}`:""}`)},Jj=Object.freeze(Object.defineProperty({__proto__:null,addChildLocation:Yj,addEntityToLocation:Hj,createLocation:Pj,createLocationNote:Qj,deleteLocation:gg,deleteLocationNote:xg,fetchLocationById:Ri,fetchLocationEntities:yg,fetchLocationMentionNotes:Wj,fetchLocationMentionSessionNotes:Zj,fetchLocationNotes:Xj,fetchLocationPath:pg,fetchLocations:Li,removeChildLocation:Gj,removeEntityFromLocation:Vj,searchLocations:FI,updateLocation:Rf,updateLocationImportance:Kj,updateLocationNote:bg},Symbol.toStringTag,{value:"Module"})),zI=Object.freeze([]),or=e=>e?e.name||e.label||e.title||e.display||e.displayName||e.text||String(e.id||""):"";function e1({worldId:e,label:n,value:s,onChange:i,allowedTypeIds:l,disabled:o=!1,placeholder:d="Search locations",staticOptions:m,minSearchLength:p=0,onResolved:h,required:y=!1}){const[g,x]=u.useState(""),[v,S]=u.useState([]),[N,E]=u.useState(!1),[j,A]=u.useState(!1),[T,_]=u.useState(null),[M,k]=u.useState(""),[C,D]=u.useState([]),z=u.useRef(null);u.useRef(null);const G=u.useRef(h),U=l!==void 0,X=u.useMemo(()=>Array.isArray(l)?[...l]:[],[JSON.stringify(l)]),V=Array.isArray(m)?m:zI,R=u.useMemo(()=>Array.isArray(V)?V.map(K=>{if(!K)return null;if(typeof K=="object"){const re=K.id??K.value??K.key??K.slug??null,W=or(K);return re==null?null:{id:String(re),name:W||String(re)}}return null}).filter(Boolean):[],[V]);u.useEffect(()=>{if(!e||o){D([]);return}let K=!1;return(async()=>{try{const re=await Li({worldId:e,all:"true"});if(K)return;const W=Array.isArray(re?.data)?re.data:re,ue=Array.isArray(W)?W:[];D(ue)}catch{K||D([])}})(),()=>{K=!0}},[e,o,JSON.stringify(X)]);const B=u.useMemo(()=>{if(U){if(X.length===0)return[];const K=new Set(X.map(W=>String(W)));return C.filter(W=>{const ue=W.location_type_id||W.locationTypeId||W.locationType?.id||"",Q=String(ue);return K.has(Q)})}return C},[C,X,U]),L=u.useMemo(()=>{if(!g.trim()||g.length<p)return B;const K=g.toLowerCase().trim();return B.filter(re=>or(re).toLowerCase().includes(K))},[B,g,p]);u.useEffect(()=>{if(!s){_(null),x(""),G.current?.(null);return}if(typeof s=="object"&&s.id){const Q=or(s);(!T||T.id!==s.id)&&(_(s),x(Q),G.current?.(s));return}if(typeof s!="string")return;const K=s;if(T?.id===K)return;const re=R.find(Q=>String(Q.id)===String(K));if(re){_(re),x(or(re)),G.current?.(re);return}const W=C.find(Q=>String(Q.id)===String(K));if(W){_(W),x(or(W)),G.current?.(W);return}let ue=!1;return(async()=>{try{const Q=await Ri(K);if(ue)return;const ye=Q?.data||Q;if(ye?.id){_(ye),x(or(ye)),G.current?.(ye);return}}catch{}ue||(_({id:K,name:K}),x(K))})(),()=>{ue=!0}},[s,R,T?.id,C]),u.useEffect(()=>{G.current=h},[h]),u.useEffect(()=>{j&&S(L)},[j,L]);const O=u.useMemo(()=>{if(!R.length)return[];if(!g.trim()||g.length<p)return R;const K=g.trim().toLowerCase();return R.filter(re=>or(re).toLowerCase().includes(K))},[R,g,p]),$=u.useMemo(()=>{const K=new Map,re=[];return O.forEach(W=>{const ue=W?.id;if(ue==null)return;const Q=String(ue);K.has(Q)||(K.set(Q,!0),re.push(W))}),v.forEach(W=>{const ue=W?.id;if(ue==null)return;const Q=String(ue);K.has(Q)||(K.set(Q,!0),re.push(W))}),re},[O,v]),F=K=>{K&&(_(K),x(or(K)),A(!1),S([]),k(""),i?.(K))},H=()=>{_(null),x(""),S([]),k(""),A(!1),i?.(null)},I=j&&$.length>0,Y=j&&!N&&!$.length&&g.trim().length>=p&&!T&&e,P=o||!e;return t.jsxs("div",{className:"entity-search-select",ref:z,children:[n&&t.jsx("label",{children:n}),t.jsxs("div",{className:"entity-search-wrapper",children:[t.jsx("input",{type:"text",value:g,required:y,onChange:K=>{const re=K.target.value;x(re),_(null),o||A(!0)},onFocus:()=>{o||A(!0)},disabled:P,placeholder:d,className:"entity-search-input"}),T&&!o&&t.jsx("button",{type:"button",className:"clear-btn",onClick:K=>{K.stopPropagation(),H()},title:"Clear selection","aria-label":"Clear selection",children:""})]}),M&&t.jsx("div",{className:"small text-warning",role:"alert",children:M}),I&&t.jsx("ul",{className:"entity-results",role:"listbox",children:$.map(K=>{const re=K?.id??K?.value??"",W=or(K),ue=T?.id===re;return t.jsxs("li",{role:"option","aria-selected":ue,className:ue?"selected":"",onMouseDown:Q=>{Q.preventDefault()},onClick:()=>F(K),children:[W,K.locationType&&t.jsxs("span",{className:"entity-search-result-meta",children:[" ","(",K.locationType.name,")"]})]},re)})}),Y&&t.jsx("div",{className:"small text-muted",style:{marginTop:"0.25rem"},children:"No locations found"}),N&&j&&t.jsx("div",{className:"small text-muted",children:"Loading locations"})]})}const BI=e=>e===null?"null":e===void 0?"undefined":Array.isArray(e)?"array":e instanceof Date?"date":typeof e,If=(e,n,s={})=>{const i=(o,d,m,p="<<anonymous>>")=>{const h=d[m];return h==null?(o&&console.warn(`[PropTypes] Prop "${m}" is marked as required in "${p}", but its value is ${String(h)}.`),null):e(h,d,m,p)?(s.afterValidate&&s.afterValidate(h,d,m,p),null):(console.warn(`[PropTypes] Invalid prop "${m}" supplied to "${p}". Expected ${n}, but received ${BI(h)}.`),null)},l=i.bind(null,!1);return l.isRequired=i.bind(null,!0),l._validate=o=>o==null||e(o),l._expectedDescription=n,l},id=e=>If(n=>typeof n===e,e),UI=()=>If(e=>e!==null&&typeof e=="object"&&!Array.isArray(e)&&!(e instanceof Date),"object"),qI=e=>{const n=o=>Array.isArray(o)?!e||typeof e!="function"?!0:o.every(d=>e._validate?e._validate(d):!0):!1,s=(o,d,m,p)=>{Array.isArray(o)&&(!e||typeof e!="function"||o.forEach((h,y)=>{try{e({[`${m}[${y}]`]:h},`${m}[${y}]`,p)}catch{}}))},i=`an array of ${e?._expectedDescription??"the specified type"}`,l=If(n,i,{afterValidate:s});return l._validate=o=>o==null?!0:Array.isArray(o)?o.every(d=>e&&e._validate?e._validate(d):!0):!1,l},PI=e=>{const n=Array.isArray(e)?e.filter(Boolean):[],s=o=>n.some(d=>d&&typeof d._validate=="function"?d._validate(o):!0),i=n.map(o=>o?._expectedDescription).filter(Boolean),l=i.length>0?i.join(", "):"one of the specified types";return If(s,l)},Mt={string:id("string"),number:id("number"),bool:id("boolean"),func:id("function"),object:UI(),arrayOf:e=>qI(e),oneOfType:e=>PI(e)},ei=e=>e?Array.isArray(e)?e:Array.isArray(e.data)?e.data:[]:[],Sy=e=>{if(e==null)return null;if(typeof e=="string"){const n=e.trim();return n?n.toLowerCase():null}if(typeof e=="number")return String(e);if(typeof e=="object"){if(Array.isArray(e)){for(const n of e){const s=Sy(n);if(s)return s}return null}return Sy(e.fieldKey??e.field_key??e.key??e.name??e.id)??null}return null},Tn=(e,n)=>{const s=Sy(n);s&&e.add(s)},HI=e=>{if(!e||typeof e!="object")return[];const n=new Set;return Tn(n,e.id),Tn(n,e.field_id),Tn(n,e.entity_type_field_id),Tn(n,e.fieldId),Tn(n,e.name),Tn(n,e.key),Tn(n,e.field),Tn(n,e.metadataField),Tn(n,e.metadata_field),e?.sourceField&&Tn(n,e.sourceField),e?.source_field&&Tn(n,e.source_field),Array.from(n)},VI=e=>Array.isArray(e)?e.map((n,s)=>{if(!n||typeof n!="object")return null;const i=new Set;if(Tn(i,n.fieldKey),Tn(i,n.field_key),Tn(i,n.field),Tn(i,n.fieldName),Tn(i,n.field_name),Tn(i,n.fieldId),Tn(i,n.field_id),Tn(i,n.target),Tn(i,n.targetField),Tn(i,n.target_field),Tn(i,n.metadataField),Tn(i,n.metadata_field),Tn(i,n.entity_type_field_id),Tn(i,n.name),Tn(i,n.key),n.field&&typeof n.field=="object"&&(Tn(i,n.field.id),Tn(i,n.field.name),Tn(i,n.field.key)),!i.size)return null;const l=(y,g=0)=>{if(y==null||y==="")return g;const x=Number(y);return Number.isFinite(x)?x:g},o=l(n.sectionOrder??n.section_order??n.sectionIndex??n.section_index,0),d=l(n.column??n.columnOrder??n.column_index??n.columnIndex,0),m=l(n.fieldOrder??n.field_order??n.order??n.order_index??n.position??n.sortOrder??n.sort_order,s),p=l(n.priority??n.weight??n.rank,s),h=o*1e6+d*1e4+m*100+p;return{identifiers:Array.from(i),rank:h,sectionOrder:o,columnOrder:d,fieldPosition:m,priority:p}}).filter(Boolean):[],vg=(e=[],n=[])=>{if(!Array.isArray(e)||e.length===0)return[];const s=VI(n),i=new Map;s.length>0&&s.forEach(d=>{d.identifiers.forEach(m=>{i.has(m)||i.set(m,d.rank)})});const l=(d,m)=>{if(d==null||d==="")return m;const p=Number(d);return Number.isFinite(p)?p:m},o=e.map((d,m)=>{const p=HI(d);let h=Number.POSITIVE_INFINITY;p.forEach(g=>{if(!g)return;const x=i.get(g);x!==void 0&&x<h&&(h=x)});const y=l(d?.sortOrder??d?.sort_order,m);return{field:d,rank:h,fallbackSort:y,index:m}});return o.sort((d,m)=>{const p=Number.isFinite(d.rank),h=Number.isFinite(m.rank);return p&&h&&d.rank!==m.rank?d.rank-m.rank:p&&!h?-1:!p&&h?1:d.fallbackSort!==m.fallbackSort?d.fallbackSort-m.fallbackSort:d.index-m.index}),o.map(d=>d.field)},Sg=e=>!!e&&typeof e=="object"&&!Array.isArray(e),YI=e=>Array.isArray(e)?e:e==null?[]:[e],Es=e=>e==null?null:typeof e=="string"?e.trim()||null:typeof e=="number"?String(e):Sg(e)?Es(e.field??e.fieldKey??e.field_name??e.source??e.sourceField??e.source_field??e.key??e.name??e.target??e.targetField??e.target_field??e.metadataField??e.metadata_field??e.id)??null:null,GI=e=>{if(!e||typeof e!="object")return null;const n=l=>l==null?null:String(l).trim()||null,s=n(e.key??e.name??e.field);if(s&&s.startsWith("metadata."))return s;const i=n(e.metadataField??e.metadata_field)||(s&&!s.includes(".")?s:null)||n(e.name);return i?i.startsWith("metadata.")?i:`metadata.${i}`:s},KI=(e=[])=>{const n=new Map,s=(i,l)=>{if(!i||!l)return;const o=Es(i),d=Es(l);!o||!d||(n.set(o,d),n.set(o.toLowerCase(),d))};return e.forEach(i=>{if(!i||typeof i!="object")return;const l=GI(i);if(!l)return;s(l,l),[i.id,i.field_id,i.fieldId,i.entity_type_field_id,i.field,i.name,i.key,i.metadataField,i.metadata_field,i.fieldKey,i.field_key,i.target,i.targetField,i.target_field,i.source,i.sourceField,i.source_field].forEach(d=>s(d,l))}),n},XI={eq:"equals","=":"equals","==":"equals","===":"equals",equals:"equals",equal:"equals",match:"equals",matches:"equals",ne:"not_equals","!=":"not_equals","!==":"not_equals",not:"not_equals",notequals:"not_equals",not_equals:"not_equals",different:"not_equals",contains:"contains",includes:"contains",has:"contains",not_contains:"not_contains",excludes:"not_contains",notincludes:"not_contains",in:"in",any:"in",within:"in",not_in:"not_in",none:"not_in",outside:"not_in",gt:"gt",greater:"gt",greater_than:"gt",gte:"gte",ge:"gte",greater_or_equal:"gte",lt:"lt",less:"lt",less_than:"lt",lte:"lte",le:"lte",less_or_equal:"lte",is_set:"is_set",isset:"is_set",set:"is_set",exists:"is_set",present:"is_set",is_not_set:"is_not_set",notset:"is_not_set",missing:"is_not_set",empty:"is_empty",is_empty:"is_empty",not_empty:"is_not_empty",filled:"is_not_empty",truthy:"truthy",falsy:"falsy"},WI=e=>{if(e==null)return"equals";const n=String(e).trim().toLowerCase();return XI[n]??"equals"},ZI={all:"all",every:"all",and:"all",any:"any",some:"any",or:"any",either:"any",none:"none",not:"none"},QI=e=>{if(e==null)return"all";const n=String(e).trim().toLowerCase();return ZI[n]??"all"},JI={show:"show",display:"show",reveal:"show",visible:"show",enable:"show",hide:"hide",remove:"hide",conceal:"hide",hidden:"hide",disable:"hide",require:"require",required:"require",mandatory:"require",optional:"optional",option:"optional",allow:"optional"},eD=e=>{if(e==null)return null;const n=String(e).trim().toLowerCase();return JI[n]??null},NS=(e,n=0)=>{if(!e)return null;if(!Sg(e)){if(typeof e=="string"){const[d,...m]=e.split("="),p=Es(d);if(!p)return null;const h=m.join("=").trim();return{field:p,operator:"equals",values:h?[h]:[]}}return null}const s=Es(e.field??e.fieldKey??e.field_name??e.source??e.sourceField??e.source_field??e.input??e.left??e.property??e.key??e.name);if(!s)return null;const i=WI(e.operator??e.comparator??e.condition??e.type),l=e.values??e.value??e.match??e.compareTo??e.matchValue??e.expected,o=YI(l).filter(d=>d!==void 0);return{field:s,operator:i,values:o,id:e.id??`condition-${n}`}},tD=e=>{const n=["conditions","criteria","when","rules","predicates","matchers"];for(const i of n)if(Array.isArray(e?.[i]))return e[i].map((l,o)=>NS(l,o)).filter(Boolean);const s=NS(e,0);return s?[s]:[]},ip=(e,n=0)=>{if(!e||!Sg(e)&&typeof e!="string")return null;if(typeof e=="string"){const l=Es(e);return l?{target:l,action:"show",id:`action-${n}`}:null}const s=Es(e.target??e.targetField??e.target_field??e.field??e.fieldKey??e.field_name??e.path??e.name??e.key??e.metadataField??e.metadata_field),i=eD(e.action??e.type??e.behavior??e.behaviour??e.effect??e.command);return!s||!i?null:{target:s,action:i,id:e.id??`action-${n}`}},nD=e=>{const n=["actions","effects","apply","then","responses"];for(const i of n)if(Array.isArray(e?.[i]))return e[i].map((l,o)=>ip(l,o)).filter(Boolean);if(Array.isArray(e?.targets)&&e.targets.length>0)return e.targets.map((i,l)=>ip({target:i,action:e.action??e.effect??e.behavior??e.behaviour},l)).filter(Boolean);const s=e.target??e.targetField??e.target_field??e.actionTarget??e.fieldTarget??e.metadataField??e.metadata_field;return s&&(e.action||e.effect||e.behavior||e.behaviour)?[ip({target:s,action:e.action??e.effect??e.behavior??e.behaviour})].filter(Boolean):[]},wy=e=>{if(e==null)return"";if(typeof e=="number"&&Number.isFinite(e))return String(e);if(typeof e=="boolean")return e?"true":"false";if(e instanceof Date)return String(e.getTime());if(typeof e=="string")return e.trim().toLowerCase();if(Array.isArray(e))return e.map(n=>wy(n));if(typeof e=="object")try{return JSON.stringify(e)}catch{return String(e)}return String(e)},vs=(e,n)=>{if(Array.isArray(e))return e.some(d=>vs(d,n));if(Array.isArray(n))return n.some(d=>vs(e,d));const s=Number(e),i=Number(n);if(!Number.isNaN(s)&&!Number.isNaN(i))return s===i;const l=wy(e),o=wy(n);return l===o},jl=e=>e==null?!1:typeof e=="string"?e.trim().length>0:Array.isArray(e)?e.length>0:e instanceof Date?!0:typeof e=="object"?Object.keys(e).length>0:!0,aD=(e,n)=>{if(n==null)return;let s=n;if(typeof s!="string"){const l=Es(s);if(!l)return;s=l}if(!s)return;const i=s.replace(/\[(.*?)\]/g,(l,o)=>`.${o.replace(/^['"]|['"]$/g,"")}`).split(".").map(l=>l.trim()).filter(l=>l.length>0);if(i.length)return i.reduce((l,o)=>{if(l!=null)return o==="*"?l:l[o]},e)},lp=(e,n)=>{if(!e)return!1;const{field:s,operator:i,values:l=[]}=e,o=aD(n,s);switch(i){case"equals":return l.length?l.some(d=>vs(o,d)):!1;case"not_equals":return l.length?l.every(d=>!vs(o,d)):jl(o);case"contains":return Array.isArray(o)?o.some(d=>l.some(m=>vs(d,m))):typeof o=="string"?l.some(d=>d==null?!1:o.toLowerCase().includes(String(d).toLowerCase())):!1;case"not_contains":return Array.isArray(o)?o.every(d=>l.every(m=>!vs(d,m))):typeof o=="string"?l.every(d=>d==null?!0:!o.toLowerCase().includes(String(d).toLowerCase())):!0;case"in":return l.length?Array.isArray(o)?o.some(d=>l.some(m=>vs(d,m))):l.some(d=>vs(o,d)):!1;case"not_in":return l.length?Array.isArray(o)?o.every(d=>l.every(m=>!vs(d,m))):l.every(d=>!vs(o,d)):!0;case"gt":case"gte":case"lt":case"lte":{const d=Number(o);if(Number.isNaN(d))return!1;const m=l.find(h=>h!=null),p=Number(m);return Number.isNaN(p)?!1:i==="gt"?d>p:i==="gte"?d>=p:i==="lt"?d<p:d<=p}case"is_set":return jl(o);case"is_not_set":return!jl(o);case"is_empty":return!jl(o);case"is_not_empty":return jl(o);case"truthy":return!!o;case"falsy":return!o;default:return l.length?l.some(d=>vs(o,d)):jl(o)}},sD=(e,n)=>{const s=Array.isArray(e?.conditions)?e.conditions:[];if(s.length===0)return!0;switch(e?.matchMode){case"any":return s.some(i=>lp(i,n));case"none":return!s.some(i=>lp(i,n));case"all":default:return s.every(i=>lp(i,n))}},wg=(e=[],n=[])=>{if(!Array.isArray(e))return[];const s=KI(n),i=o=>{const d=Es(o);if(!d)return typeof o=="string"?o:null;if(s.size>0){const m=s.get(d)||s.get(d.toLowerCase());if(m)return m}return d},l=e.map((o,d)=>{if(!o||typeof o!="object"||o.disabled||o.enabled===!1)return null;const m=Array.isArray(o.conditions)&&Array.isArray(o.actions)&&o.conditions.every(S=>S?.field&&S?.operator)&&o.actions.every(S=>S?.target&&S?.action),p=m?o.conditions.map(S=>({...S})):tD(o),h=m?o.actions.map(S=>({...S})):nD(o);if(!p.length||!h.length)return null;const y=p.map(S=>{const N=i(S?.field);return N?{...S,field:N}:null}).filter(Boolean),g=h.map(S=>{const N=i(S?.target);return N?{...S,target:N}:null}).filter(Boolean);if(!y.length||!g.length)return null;const x=o.priority??o.order??o.sort??o.rank??d,v=Number.isFinite(Number(x))?Number(x):d;return{id:o.id??`field-rule-${d}`,name:o.name??o.label??"",matchMode:QI(o.matchMode??o.match_mode??o.matchType??o.logic??o.condition),conditions:y,actions:g,priority:v}}).filter(Boolean);return l.sort((o,d)=>o.priority-d.priority),l},Ng=(e,n={})=>{const s=Array.isArray(e)?e:[],i=n&&typeof n=="object"?n:{},l={},o=new Set;return s.forEach(d=>{!d||!sD(d,i)||d.actions.forEach(p=>{if(!p?.target||!p?.action)return;const h=p.target,y=Es(h)?.toLowerCase()??null;l[h]=p.action,y&&l[y]===void 0&&(l[y]=p.action),p.action==="show"?(o.add(h),y&&o.add(y)):p.action==="hide"&&(o.delete(h),y&&o.delete(y))})}),{actionsByField:l,showRuleTargets:o}},Ac=(e,n,s=new Set,i=!0)=>{if(!e)return!1;const l=typeof n=="string"?n.toLowerCase():"",o=Es(e)?.toLowerCase()??null;return s instanceof Set&&(s.has(e)||(o?s.has(o):!1))||l==="show"?!1:l==="hide"||l==="hidden"||i===!1},jg=e=>{if(!e)return"";const n=new Date(e);return Number.isNaN(n.getTime())?typeof e=="string"?e:String(e):n.toLocaleString()},rD=e=>{const n=e?.value;if(n==null)return"";switch(e?.dataType){case"boolean":return!!n;case"number":{const s=Number(n);return Number.isNaN(s)?n:s}case"enum":return typeof n=="object"&&n!==null?n.value??n.id??n.key??n.slug??n.name??"":n;case"date":return jg(n);case"entity_reference":case"location_reference":case"reference":if(typeof n=="object"&&n!==null){const s=n.label??n.name??n.title??n.display??n.displayName??n.text??n.value??n.id;if(s==null)try{return JSON.stringify(n,null,2)}catch(i){return console.warn(" Failed to serialise reference metadata field",i),String(n)}return String(s)}return n;case"text":if(typeof n=="object")try{return JSON.stringify(n,null,2)}catch(s){return console.warn(" Failed to serialise text metadata field",s),String(n)}return n;default:if(typeof n=="object")try{return JSON.stringify(n,null,2)}catch(s){return console.warn(" Failed to serialise metadata field",s),String(n)}return n}},iD=e=>{const n=e?.value;return n==null?e?.dataType==="boolean"?!1:"":e?.dataType==="boolean"?!!n:(e?.dataType==="reference"||e?.dataType==="entity_reference"||e?.dataType==="location_reference")&&typeof n=="object"&&n!==null?n.value??n.id??n.key??n.slug??n.uuid??"":n},Eg=(e=[])=>!Array.isArray(e)||e.length===0?{}:e.reduce((n,s)=>(s?.name&&(n[s.name]=rD(s)),n),{}),t1=(e=[])=>!Array.isArray(e)||e.length===0?{}:e.reduce((n,s)=>(s?.name&&(n[s.name]=iD(s)),n),{}),n1=(e=[])=>!Array.isArray(e)||e.length===0?{}:e.reduce((n,s)=>{if(!s?.name)return n;const i=s.dataType||s.data_type;if(i!=="reference"&&i!=="entity_reference"&&i!=="location_reference")return n;const l=(()=>{if(s.displayValue)return s.displayValue;if(s.display)return s.display;if(s.selectedLabel)return s.selectedLabel;const o=s.value;return o&&typeof o=="object"?o.displayValue??o.label??o.name??o.title??o.display??o.displayName??o.text??o.value??o.id??null:null})();return l==null||(n[s.name]=String(l)),n},{}),_g=e=>{if(e==null||e==="")return null;if(typeof e=="string"){const n=e.trim();return n.length>0?n:null}if(typeof e=="number"||typeof e=="bigint")return String(e);if(typeof e=="object"&&!Array.isArray(e)){const n=e.id??e.value??e.entity_id??e.entityId??e.key??e.slug??e.uuid??null;if(n!=null){const s=String(n).trim();return s.length>0?s:null}return null}if(Array.isArray(e)){for(const n of e){const s=_g(n);if(s)return s}return null}return null},Cg=e=>{if(e==null)return null;if(typeof e=="object"&&!Array.isArray(e)){const n=e.displayValue??e.display??e.label??e.name??e.title??e.displayName??e.text??null;if(n!=null){const s=String(n).trim();return s.length>0?s:null}return null}if(Array.isArray(e)){for(const n of e){const s=Cg(n);if(s)return s}return null}return null},jS=450,op="preparing-open",a1=e=>{if(e==null)return"";if(Array.isArray(e)){const n=e.map(s=>s==null?null:typeof s=="object"?s.label||s.name||s.title||s.value||s.id||null:String(s)).filter(Boolean);return n.length>0?n.join(", "):""}if(typeof e=="object")try{return JSON.stringify(e,null,2)}catch(n){return console.warn(" Failed to serialise metadata value",n),String(e)}return typeof e=="boolean"?e?"Yes":"No":e===""?"":String(e)},ES=e=>{if(!e||typeof e!="object")return null;const n=e.displayValue??e.label??e.name??e.title??e.display??e.displayName??e.text??e.value??e.id;return n==null?null:String(n)},lD=e=>{if(!e)return"";const{dataType:n,value:s}=e;if(s==null)return n==="boolean"?"No":"";switch(n){case"boolean":return s?"Yes":"No";case"number":{const i=Number(s);return Number.isNaN(i)?String(s):String(i)}case"enum":return typeof s=="object"&&s!==null?s.label||s.name||s.title||s.value||s.id||"":String(s);case"entity_reference":case"location_reference":case"reference":{if(Array.isArray(s)){const i=s.map(o=>o==null?null:typeof o=="object"?ES(o)||null:String(o)).filter(Boolean);if(i.length>0)return i.join(", ");const l=e.displayValue||e.display||e.selectedLabel||e.referenceName||e.referenceLabel;return l?String(l):""}if(typeof s=="object"&&s!==null){const i=ES(s);if(i)return i;try{return JSON.stringify(s,null,2)}catch(l){return console.warn(" Failed to serialise reference metadata value",l),String(s)}}if(s==="")return"";if(e.displayValue||e.display||e.selectedLabel){const i=e.displayValue||e.display||e.selectedLabel;return i?String(i):""}return String(s)}case"date":return jg(s);case"text":default:return a1(s)}},oD=(e,n)=>{if(!e)return[];const s=Array.isArray(e.fields)?e.fields:[];if(s.length>0)return vg(s,n).filter(o=>o?.name||o?.label).map((o,d)=>{const m=o.name||o.label||`field-${d}`,p=o.label||o.name||`Field ${d+1}`,h=o?.name?`metadata.${o.name}`:o?.key||m,y=o.visibleByDefault!==void 0?!!o.visibleByDefault:o.visible_by_default!==void 0?!!o.visible_by_default:!0;return{key:m,label:p,value:lD(o),fieldKey:h,visibleByDefault:y}});const i=e.metadata&&typeof e.metadata=="object"&&e.metadata||e.meta&&typeof e.meta=="object"&&e.meta||null;return i?Object.entries(i).map(([l,o])=>({key:l,label:l,value:a1(o),fieldKey:l&&`metadata.${l}`,visibleByDefault:!0})):[]},cD=e=>{if(!e)return{};if(Array.isArray(e.fields)&&e.fields.length>0)return Eg(e.fields);const n=e.metadata&&typeof e.metadata=="object"&&e.metadata||e.meta&&typeof e.meta=="object"&&e.meta||null;return n?{...n}:{}};function Ag({entity:e,entityId:n,onClose:s,isLoading:i=!1,error:l="",fallbackName:o="",fieldOrder:d=[],fieldRules:m=[]}){const p=Mn(),[h,y]=u.useState(()=>n?{entity:e,entityId:n,isLoading:i,error:l,fallbackName:o}:null),[g,x]=u.useState(n?"open":"closed"),v=u.useRef(null),S=u.useRef(null);u.useEffect(()=>()=>{S.current&&(clearTimeout(S.current),S.current=null)},[]),u.useEffect(()=>{if(n&&v.current?.entityId===n&&(v.current={entity:e,entityId:n,isLoading:i,error:l,fallbackName:o}),n){if(!h){y({entity:e,entityId:n,isLoading:i,error:l,fallbackName:o}),x(op);return}if(h.entityId===n){y(I=>!I||I.entity===e&&I.isLoading===i&&I.error===l&&I.fallbackName===(o||I.fallbackName||"")?I:{...I,entity:e,isLoading:i,error:l,fallbackName:o||I.fallbackName||""}),g==="closing"&&S.current?(clearTimeout(S.current),S.current=null,v.current=null,x("opening")):g==="closed"&&x(op);return}v.current={entity:e,entityId:n,isLoading:i,error:l,fallbackName:o},g!=="closing"&&x("closing"),S.current||(S.current=setTimeout(()=>{y(v.current),v.current=null,x("opening"),S.current=null},jS));return}h&&(g!=="closing"&&x("closing"),S.current||(v.current=null,S.current=setTimeout(()=>{y(null),x("closed"),S.current=null},jS)))},[e,n,i,l,o,h,g]),u.useEffect(()=>{if(g!==op)return;const I=requestAnimationFrame(()=>{x("opening")});return()=>cancelAnimationFrame(I)},[g]),u.useEffect(()=>{if(g!=="opening")return;const I=requestAnimationFrame(()=>{x("open")});return()=>cancelAnimationFrame(I)},[g]);const N=!!h,E=g==="closing",j=h?.entity,A=h?.entityId,T=h?.isLoading??!1,_=h?.error??"",M=h?.fallbackName,k=j?.fields,C=u.useMemo(()=>wg(m,k),[m,k]),D=u.useMemo(()=>cD(j),[j]),z=u.useMemo(()=>({metadata:D}),[D]),G=u.useMemo(()=>Ng(C,z),[C,z]),U=u.useMemo(()=>oD(j,d),[j,d]),X=u.useMemo(()=>{if(!U.length)return[];const I=G?.actionsByField??{},Y=G?.showRuleTargets??new Set;return U.filter(P=>{if(!P?.fieldKey)return!0;const K=I[P.fieldKey],re=P.visibleByDefault!==void 0?!!P.visibleByDefault:P.visible_by_default!==void 0?!!P.visible_by_default:!0;return!Ac(P.fieldKey,K,Y,re)})},[U,G]),V=X.length>0,R=j?.name||M||(T?"Loading entity":"Unknown entity"),B=j?.type?.name||j?.typeName||"Entity",L=u.useMemo(()=>Ql(j),[j]);if(!N)return null;const $=["entity-info-drawer-wrapper",g==="open"?"entity-info-drawer-wrapper--open":"",g==="opening"?"entity-info-drawer-wrapper--opening":"",E?"entity-info-drawer-wrapper--closing":""].filter(Boolean).join(" "),F=()=>{A&&p(`/entities/${A}`)},H=!!A&&!T&&!_;return t.jsxs("div",{className:$,role:"presentation",children:[t.jsx("div",{className:"entity-info-drawer__overlay",onClick:s,role:"presentation"}),t.jsxs("aside",{className:"entity-info-drawer",role:"complementary","aria-label":"Entity details",children:[t.jsxs("header",{className:"entity-info-drawer__header",children:[t.jsxs("div",{className:"entity-info-drawer__header-top",children:[t.jsx("p",{className:"entity-info-drawer__type",title:B,children:B}),t.jsxs("div",{className:"entity-info-drawer__actions",children:[t.jsx("button",{type:"button",className:"entity-info-drawer__link",onClick:F,disabled:!H,children:"Go to Record"}),t.jsx("button",{type:"button",className:"entity-info-drawer__close",onClick:s,"aria-label":"Close entity details",children:""})]})]}),t.jsx("h2",{className:"entity-info-drawer__title",title:R,children:R})]}),L&&!T&&!_?t.jsx("div",{className:"entity-info-drawer__image",children:t.jsx("img",{src:L,alt:`Portrait of ${R}`,loading:"lazy"})}):null,j?.summary&&!T&&!_&&t.jsx("p",{className:"entity-info-drawer__summary",children:j.summary}),!j?.summary&&j?.description&&!T&&!_&&t.jsx("p",{className:"entity-info-drawer__summary",children:j.description}),T&&t.jsx("p",{className:"entity-info-drawer__status","aria-live":"polite",children:"Loading entity information"}),!!_&&!T&&t.jsx("p",{className:"entity-info-drawer__status entity-info-drawer__status--error","aria-live":"assertive",children:_}),!T&&!_&&V&&t.jsx("dl",{className:"entity-info-drawer__metadata",children:X.map(I=>t.jsxs("div",{className:"entity-info-drawer__metadata-item",children:[t.jsx("dt",{children:I.label}),t.jsx("dd",{children:I.value})]},I.key))}),!T&&!_&&!V&&t.jsx("p",{className:"entity-info-drawer__status",children:"No additional metadata available."})]})]})}Ag.propTypes={entityId:Mt.string,onClose:Mt.func.isRequired,isLoading:Mt.bool,error:Mt.string,fallbackName:Mt.string,fieldOrder:Mt.arrayOf(Mt.object),fieldRules:Mt.arrayOf(Mt.object)};function Na({entityId:e,entityName:n="entity",className:s=""}){const[i,l]=u.useState(!1),[o,d]=u.useState(!1),[m,p]=u.useState(null),[h,y]=u.useState(""),[g,x]=u.useState([]),[v,S]=u.useState([]),N=u.useRef(null),E=u.useMemo(()=>e==null?null:String(e),[e]);u.useEffect(()=>(N.current||(N.current=document.createElement("div"),document.body.appendChild(N.current)),()=>{N.current&&N.current.parentNode&&(N.current.parentNode.removeChild(N.current),N.current=null)}),[]);const j=u.useCallback(()=>{l(!1),y(""),p(null),d(!1)},[]),A=M=>{if(M.preventDefault(),M.stopPropagation(),e==null)return;const k=typeof n=="string"?n.trim():"";E&&k&&p(C=>C&&C.id===E?C.name||!k?C:{...C,name:k}:{id:E,name:k}),l(!0)};u.useEffect(()=>{if(!E)return;const M=typeof n=="string"?n.trim():"";M&&p(k=>!k||k.id!==E||k.name===M||k.name&&k.name!==M?k:{...k,name:M})},[E,n]),u.useEffect(()=>{if(!i||!E)return;let M=!1;return(async()=>{d(!0),y("");try{const C=await Us(E);if(M)return;const D=Ya(C);if(!D){p(null),y("Entity not found");return}p(D)}catch(C){if(M)return;console.error(" Failed to load entity preview",C),p(null),y(C.message||"Failed to load entity information")}finally{M||d(!1)}})(),()=>{M=!0}},[i,E]);const T=u.useMemo(()=>m&&(m.entity_type_id||m.entityType?.id||m.entity_type?.id)||null,[m]);u.useEffect(()=>{if(!T){x([]),S([]);return}if(!i)return;let M=!1;return(async()=>{try{const[C,D]=await Promise.all([Tf(T).catch(z=>(console.error(" Failed to load preview field order",z),null)),Mf(T).catch(z=>(console.error(" Failed to load preview field rules",z),null))]);if(M)return;x(ei(C)),S(ei(D))}catch(C){if(M)return;console.error(" Failed to load preview field layout",C),x([]),S([])}})(),()=>{M=!0}},[i,T]),u.useEffect(()=>{if(!i)return;const M=k=>{k.key==="Escape"&&(k.preventDefault(),j())};return window.addEventListener("keydown",M),()=>{window.removeEventListener("keydown",M)}},[i,j]);const _=i&&N.current?t.jsx(Ag,{entityId:E,entity:m,isLoading:o,error:h,fallbackName:n,onClose:j,fieldOrder:g,fieldRules:v}):null;return t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:`entity-info-trigger ${s}`.trim(),onClick:A,"aria-label":`View details for ${n}`,children:t.jsx(Uc,{size:16,"aria-hidden":"true"})}),N.current&&Kl.createPortal(_,N.current)]})}Na.propTypes={entityId:Mt.oneOfType([Mt.string,Mt.number]).isRequired,entityName:Mt.string,className:Mt.string};async function Tg(e){return Et.get(`/location-types/${e}/fields`)}async function uD(e,n){return Et.post(`/location-types/${e}/fields`,n)}async function dD(e,n){return Et.patch(`/location-type-fields/${e}`,n)}async function fD(e){return Et.delete(`/location-type-fields/${e}`)}const _S=450,cp="preparing-open",s1=e=>{if(e==null)return"";if(Array.isArray(e)){const n=e.map(s=>s==null?null:typeof s=="object"?s.label||s.name||s.title||s.value||s.id||null:String(s)).filter(Boolean);return n.length>0?n.join(", "):""}if(typeof e=="object")try{return JSON.stringify(e,null,2)}catch(n){return console.warn(" Failed to serialise metadata value",n),String(e)}return typeof e=="boolean"?e?"Yes":"No":e===""?"":String(e)},CS=e=>{if(!e||typeof e!="object")return null;const n=e.displayValue??e.label??e.name??e.title??e.display??e.displayName??e.text??e.value??e.id;return n==null?null:String(n)},mD=e=>{if(!e)return"";const{dataType:n,data_type:s,value:i}=e,l=n||s;if(i==null)return l==="boolean"?"No":"";switch(l){case"boolean":return i?"Yes":"No";case"number":{const o=Number(i);return Number.isNaN(o)?String(i):String(o)}case"enum":return typeof i=="object"&&i!==null?i.label||i.name||i.title||i.value||i.id||"":String(i);case"entity_reference":case"location_reference":case"reference":{if(Array.isArray(i)){const o=i.map(m=>m==null?null:typeof m=="object"?CS(m)||null:String(m)).filter(Boolean);if(o.length>0)return o.join(", ");const d=e.displayValue||e.display||e.selectedLabel||e.referenceName||e.referenceLabel;return d?String(d):""}if(typeof i=="object"&&i!==null){const o=CS(i);if(o)return o;try{return JSON.stringify(i,null,2)}catch(d){return console.warn(" Failed to serialise reference metadata value",d),String(i)}}if(i==="")return"";if(e.displayValue||e.display||e.selectedLabel){const o=e.displayValue||e.display||e.selectedLabel;return o?String(o):""}return String(i)}case"date":return jg(i);case"text":default:return s1(i)}},hD=(e,n=[])=>{if(!e)return[];if(Array.isArray(n)&&n.length>0)return n.filter(i=>i?.name||i?.label).map((i,l)=>{const o=i.name||i.label||`field-${l}`,d=i.label||i.name||`Field ${l+1}`,m=e.metadata?.[i.name],p={...i,value:m};return{key:o,label:d,value:mD(p),fieldKey:i?.name?`metadata.${i.name}`:o,visibleByDefault:i.visible_by_default!==void 0?!!i.visible_by_default:!0}});const s=e.metadata&&typeof e.metadata=="object"&&e.metadata||e.meta&&typeof e.meta=="object"&&e.meta||null;return s?Object.entries(s).map(([i,l])=>({key:i,label:i,value:s1(l),fieldKey:i&&`metadata.${i}`,visibleByDefault:!0})):[]};function r1({location:e,locationId:n,onClose:s,isLoading:i=!1,error:l="",fallbackName:o="",locationFields:d=[]}){const m=Mn(),[p,h]=u.useState(()=>n?{location:e,locationId:n,isLoading:i,error:l,fallbackName:o}:null),[y,g]=u.useState(n?"open":"closed"),x=u.useRef(null),v=u.useRef(null);u.useEffect(()=>()=>{v.current&&(clearTimeout(v.current),v.current=null)},[]),u.useEffect(()=>{if(n&&x.current?.locationId===n&&(x.current={location:e,locationId:n,isLoading:i,error:l,fallbackName:o}),n){if(!p){h({location:e,locationId:n,isLoading:i,error:l,fallbackName:o}),g(cp);return}if(p.locationId===n){h(V=>!V||V.location===e&&V.isLoading===i&&V.error===l&&V.fallbackName===(o||V.fallbackName||"")?V:{...V,location:e,isLoading:i,error:l,fallbackName:o||V.fallbackName||""}),y==="closing"&&v.current?(clearTimeout(v.current),v.current=null,x.current=null,g("opening")):y==="closed"&&g(cp);return}x.current={location:e,locationId:n,isLoading:i,error:l,fallbackName:o},y!=="closing"&&g("closing"),v.current||(v.current=setTimeout(()=>{h(x.current),x.current=null,g("opening"),v.current=null},_S));return}p&&(y!=="closing"&&g("closing"),v.current||(x.current=null,v.current=setTimeout(()=>{h(null),g("closed"),v.current=null},_S)))},[e,n,i,l,o,p,y]),u.useEffect(()=>{if(y!==cp)return;const V=requestAnimationFrame(()=>{g("opening")});return()=>cancelAnimationFrame(V)},[y]),u.useEffect(()=>{if(y!=="opening")return;const V=requestAnimationFrame(()=>{g("open")});return()=>cancelAnimationFrame(V)},[y]);const S=!!p,N=y==="closing",E=p?.location,j=p?.locationId,A=p?.isLoading??!1,T=p?.error??"",_=p?.fallbackName,M=u.useMemo(()=>hD(E,d),[E,d]),k=M.length>0,C=E?.name||_||(A?"Loading location":"Unknown location"),D=E?.locationType?.name||E?.locationTypeName||"Location";if(!S)return null;const G=["location-info-drawer-wrapper",y==="open"?"location-info-drawer-wrapper--open":"",y==="opening"?"location-info-drawer-wrapper--opening":"",N?"location-info-drawer-wrapper--closing":""].filter(Boolean).join(" "),U=()=>{j&&m(`/locations/${j}`)},X=!!j&&!A&&!T;return t.jsxs("div",{className:G,role:"presentation",children:[t.jsx("div",{className:"location-info-drawer__overlay",onClick:s,role:"presentation"}),t.jsxs("aside",{className:"location-info-drawer",role:"complementary","aria-label":"Location details",children:[t.jsxs("header",{className:"location-info-drawer__header",children:[t.jsxs("div",{className:"location-info-drawer__header-top",children:[t.jsx("p",{className:"location-info-drawer__type",title:D,children:D}),t.jsxs("div",{className:"location-info-drawer__actions",children:[t.jsx("button",{type:"button",className:"location-info-drawer__link",onClick:U,disabled:!X,children:"Go to Record"}),t.jsx("button",{type:"button",className:"location-info-drawer__close",onClick:s,"aria-label":"Close location details",children:""})]})]}),t.jsx("h2",{className:"location-info-drawer__title",title:C,children:C})]}),E?.description&&!A&&!T&&t.jsx("p",{className:"location-info-drawer__summary",children:E.description}),E?.parent&&!A&&!T&&t.jsxs("div",{className:"location-info-drawer__parent",children:[t.jsx("span",{className:"location-info-drawer__parent-label",children:"Parent:"}),t.jsx("span",{className:"location-info-drawer__parent-name",children:E.parent.name})]}),A&&t.jsx("p",{className:"location-info-drawer__status","aria-live":"polite",children:"Loading location information"}),!!T&&!A&&t.jsx("p",{className:"location-info-drawer__status location-info-drawer__status--error","aria-live":"assertive",children:T}),!A&&!T&&k&&t.jsx("dl",{className:"location-info-drawer__metadata",children:M.map(V=>t.jsxs("div",{className:"location-info-drawer__metadata-item",children:[t.jsx("dt",{children:V.label}),t.jsx("dd",{children:V.value})]},V.key))}),!A&&!T&&!k&&t.jsx("p",{className:"location-info-drawer__status",children:"No additional metadata available."})]})]})}r1.propTypes={locationId:Mt.string,onClose:Mt.func.isRequired,isLoading:Mt.bool,error:Mt.string,fallbackName:Mt.string,locationFields:Mt.arrayOf(Mt.object)};function fs({locationId:e,locationName:n="location",className:s=""}){const[i,l]=u.useState(!1),[o,d]=u.useState(!1),[m,p]=u.useState(null),[h,y]=u.useState(""),[g,x]=u.useState([]),v=u.useRef(null),S=u.useMemo(()=>e==null?null:String(e),[e]);u.useEffect(()=>(v.current||(v.current=document.createElement("div"),document.body.appendChild(v.current)),()=>{v.current&&v.current.parentNode&&(v.current.parentNode.removeChild(v.current),v.current=null)}),[]);const N=u.useCallback(()=>{l(!1),y(""),p(null),d(!1)},[]),E=T=>{if(T.preventDefault(),T.stopPropagation(),e==null)return;const _=typeof n=="string"?n.trim():"";S&&_&&p(M=>M&&M.id===S?M.name||!_?M:{...M,name:_}:{id:S,name:_}),l(!0)};u.useEffect(()=>{if(!S)return;const T=typeof n=="string"?n.trim():"";T&&p(_=>!_||_.id!==S||_.name===T||_.name&&_.name!==T?_:{..._,name:T})},[S,n]),u.useEffect(()=>{if(!i||!S)return;let T=!1;return(async()=>{d(!0),y("");try{const M=await Ri(S);if(T)return;const k=M?.data||M;if(!k){p(null),y("Location not found");return}p(k)}catch(M){if(T)return;console.error(" Failed to load location preview",M),p(null),y(M.message||"Failed to load location information")}finally{T||d(!1)}})(),()=>{T=!0}},[i,S]);const j=u.useMemo(()=>m&&(m.location_type_id||m.locationType?.id||m.location_type?.id)||null,[m]);u.useEffect(()=>{if(!j){x([]);return}if(!i)return;let T=!1;return(async()=>{try{const M=await Tg(j).catch(C=>(console.error(" Failed to load preview location fields",C),null));if(T)return;const k=Array.isArray(M?.data)?M.data:Array.isArray(M)?M:[];x(k)}catch(M){if(T)return;console.error(" Failed to load preview location fields",M),x([])}})(),()=>{T=!0}},[i,j]),u.useEffect(()=>{if(!i)return;const T=_=>{_.key==="Escape"&&(_.preventDefault(),N())};return window.addEventListener("keydown",T),()=>{window.removeEventListener("keydown",T)}},[i,N]);const A=i&&v.current?t.jsx(r1,{locationId:S,location:m,isLoading:o,error:h,fallbackName:n,locationFields:g,onClose:N}):null;return t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:`location-info-trigger ${s}`.trim(),onClick:E,"aria-label":`View details for ${n}`,children:t.jsx(Uc,{size:16,"aria-hidden":"true"})}),v.current&&Kl.createPortal(A,v.current)]})}fs.propTypes={locationId:Mt.oneOfType([Mt.string,Mt.number]).isRequired,locationName:Mt.string,className:Mt.string};function Vc({field:e,data:n,onChange:s,mode:i="edit"}){const l=e.key||e.name||e.field||"",[o,d]=u.useState([]),[m,p]=u.useState(!e.optionsSource),[h,y]=u.useState(()=>JSON.stringify(e.optionsCriteria??null)),[g,x]=u.useState(()=>({selectedLabel:e?.selectedLabel?String(e.selectedLabel):"",selectedValue:null})),v=i==="view";async function S(P=5,K=200){for(let re=0;re<P;re++){const W=qs();if(W)return W;await new Promise(ue=>setTimeout(ue,K))}return null}const N=u.useCallback(P=>{if(P==null)return"null";try{return JSON.stringify(P)}catch(K){return console.warn(" Unable to serialise options criteria",K),String(P)}},[]);u.useEffect(()=>{const P=N(e.optionsCriteria??null);y(K=>K===P?K:P)},[e.optionsCriteria,N]),u.useEffect(()=>{let P=!0;return(async()=>{if(!e.optionsSource){P&&(d([]),p(!0));return}const{API_BASE:re}=await si(async()=>{const{API_BASE:we}=await Promise.resolve().then(()=>qk);return{API_BASE:we}},[]);let W=null;const ue=new URLSearchParams;let Q=null;const ye=we=>{if(we==null)return null;if(typeof we=="string"){const ne=new URLSearchParams(we);return ne.get("world_id")||ne.get("worldId")}if(Array.isArray(we)){for(const ne of we)if(Array.isArray(ne)&&ne.length>=2){const[Le,be]=ne;if(Le==="world_id"||Le==="worldId")return be}else if(ne&&typeof ne=="object"){const Le=ye(ne);if(Le)return Le}return null}return typeof we=="object"&&(we.world_id||we.worldId)||null},ae=we=>{if(we==null)return null;if(typeof we=="string"){const ne=new URLSearchParams(we);ne.delete("world_id"),ne.delete("worldId");const Le=ne.toString();return Le||null}if(Array.isArray(we)){const ne=we.map(Le=>{if(Array.isArray(Le)&&Le.length>=2){const[be,Oe]=Le;return be==="world_id"||be==="worldId"?null:[be,Oe]}if(Le&&typeof Le=="object"){const be=ae(Le);return be||null}return Le}).filter(Le=>Le==null?!1:Array.isArray(Le)?!0:typeof Le=="object"?Object.keys(Le).length>0:!0);return ne.length>0?ne:null}if(typeof we=="object"){const ne={...we};return delete ne.world_id,delete ne.worldId,Object.keys(ne).length>0?ne:null}return we};switch(e.optionsSource){case"worlds":W="/worlds";break;case"campaigns":W="/campaigns";break;case"entities":{const we=ye(e.optionsCriteria),ne=e.worldId||e.world_id||n?.world_id||n?.worldId||null,Le=we||ne;if(!Le){console.warn(" Unable to resolve world id for entity options"),W=null;break}W=`/worlds/${Le}/entities`,Q=ae(e.optionsCriteria);break}case"users":W="/users";break;case"players":{W="/users";const we=e.roles||"player,user";ue.set("roles",we);break}default:W=null}if(!W){P&&(d([]),p(!0));return}const pe=(()=>{try{let we;if(W.startsWith("http"))we=new URL(W);else{const be=re.replace(/\/$/,""),Oe=W.startsWith("/")?W:`/${W}`;we=new URL(`${be}${Oe}`)}ue.forEach((be,Oe)=>{be!=null&&we.searchParams.append(Oe,be)});const ne=Q??e.optionsCriteria,Le=be=>{if(!(!be&&be!==0)){if(typeof be=="string"){new URLSearchParams(be).forEach((Me,ut)=>{we.searchParams.append(ut,Me)});return}if(Array.isArray(be)){be.forEach(Oe=>{if(Array.isArray(Oe)&&Oe.length>=2){const[Me,ut]=Oe;if(ut==null)return;Array.isArray(ut)?ut.forEach(ht=>{ht!=null&&we.searchParams.append(Me,ht)}):we.searchParams.append(Me,ut);return}typeof Oe=="object"&&Oe!==null&&Le(Oe)});return}typeof be=="object"&&Object.entries(be).forEach(([Oe,Me])=>{Me!=null&&(Array.isArray(Me)?Me.forEach(ut=>{ut!=null&&we.searchParams.append(Oe,ut)}):we.searchParams.append(Oe,Me))})}};return Le(ne),we}catch(we){return console.error(" Failed to construct options endpoint URL",we),null}})();if(!pe){P&&(d([]),p(!0));return}P&&p(!1);try{const we=await S();if(!we){console.warn(" No auth token available when loading options"),P&&p(!0);return}const ne=await fetch(pe,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${we}`}}),Le=ne.headers.get("content-type");if(!Le||!Le.includes("application/json")){const ht=await ne.text();console.error(` ${e.optionsSource} returned non-JSON response:`,{status:ne.status,statusText:ne.statusText,contentType:Le,url:pe.toString(),preview:ht.substring(0,200)}),P&&p(!0);return}const be=await ne.json();if(!ne.ok){console.warn(` ${e.optionsSource} fetch failed`,be),P&&p(!0);return}e.optionsSource==="worlds"&&console.log(" Worlds response:",be);const Oe=ht=>{if(!ht||typeof ht!="object")return null;const _t=e.optionValueKey||"id",jt=e.optionLabelKey||"name",ve=ht?.[_t]??ht?.id??null;if(!ve)return null;let tt=ht?.[jt];if(!tt){const st=["name","title","username"];for(const $e of st)if(ht?.[$e]){tt=ht[$e];break}}return tt||(tt=String(ve)),{value:ve,label:tt}},ut=(Array.isArray(be?.data)?be.data:Array.isArray(be)?be:[]).map(Oe).filter(Boolean);P&&(d(ut),p(!0),ut.length===0&&console.warn(` ${e.optionsSource} returned no data`,be))}catch(we){console.error(` Failed to load ${e.optionsSource}:`,we),P&&p(!0)}})(),()=>{P=!1}},[e.optionsSource,e.optionLabelKey,e.optionValueKey,h,e.roles,e.worldId,e.world_id,n?.world_id,n?.worldId]),u.useEffect(()=>{e?.selectedLabel&&x(P=>P.selectedLabel===String(e.selectedLabel)?P:{...P,selectedLabel:String(e.selectedLabel)})},[e?.selectedLabel]);const E=e.label||l,j=(e.type||"text").toLowerCase(),A=(e.dataType||e.data_type||j).toLowerCase(),T=e.referenceTypeId??e.reference_type_id??e.referenceType?.id??null,_=e.referenceTypeName??e.reference_type_name??e.referenceType?.name??"",M=l.includes(".")?l.split(".").reduce((P,K)=>P?P[K]:void 0,n):n?.[l],k=["checkbox","boolean"].includes(j)?!!M:j==="multiselect"?Array.isArray(M)?M.map(P=>{if(P==null)return null;if(typeof P=="object"){const K=e.optionValueKey||"id",re=P?.[K]??P?.id??P?.value??P?.key??null;return re==null?null:String(re)}return String(P)}).filter(P=>P!=null):typeof M=="string"&&M.length>0?M.split(",").map(P=>P.trim()).filter(Boolean):[]:M??"",C=e.readonly||e.disabled,D=v||C,z=P=>P==null||P===""?"":Array.isArray(P)?P.length>0?P.join(", "):"":typeof P=="boolean"?P?"Yes":"No":String(P),G=z(k),U=P=>s?.(l,P.target.value),X=P=>s?.(l,P.target.checked),V=u.useCallback((P,K)=>{if(!(!K||typeof K!="string")&&!(!P||typeof P!="object"))return K.includes(".")?K.split(".").filter(re=>re.length>0).reduce((re,W)=>{if(re!=null&&typeof re=="object")return re[W]},P):P?.[K]},[]),R=u.useCallback(()=>{const P=[e.worldId,e.world_id,n?.worldId,n?.world_id];e.world&&typeof e.world=="object"&&P.push(e.world.id,e.world.world_id),n?.world&&typeof n.world=="object"&&P.push(n.world.id,n.world.world_id),n?.metadata&&typeof n.metadata=="object"&&P.push(n.metadata.worldId,n.metadata.world_id);for(const K of P){if(K==null)continue;const re=String(K).trim();if(re)return re}return""},[e.worldId,e.world_id,e.world,n?.worldId,n?.world_id,n?.world,n?.metadata]),B=j==="reference"||j==="entity_reference"||j==="location_reference"||A==="entity_reference"||A==="location_reference"||A==="reference",L=A==="location_reference"||j==="location_reference",O=l==="location_id"||l==="location"?k!=null&&k!==""?k:n?.location_id||n?.location?.id||n?.location||"":null,$=B&&k!==void 0&&k!==null&&k!==""?String(k):L&&O&&O!==""?String(O):"",F=u.useMemo(()=>{if(!B)return[];const P=e.options?.choices;return Array.isArray(P)?P.map((K,re)=>{if(K==null)return null;if(typeof K=="object"){const ue=K.value??K.id??K.key??K.slug??`choice-${re}`;if(ue==null)return null;const Q=K.label??K.name??K.title??K.display??K.displayName??ue;return{value:String(ue),label:String(Q)}}const W=String(K);return{value:W,label:W}}).filter(Boolean):[]},[j,e.options?.choices]);if(u.useEffect(()=>{j==="reference"&&($||x(P=>!P.selectedLabel&&!P.selectedValue?P:{...P,selectedLabel:"",selectedValue:null}))},[j,$]),u.useEffect(()=>{if(j!=="reference"||!$)return;const P=F.find(re=>re.value===$),K=(()=>{if(typeof e.value=="object"&&e.value!==null){const re=e.value.label??e.value.name??e.value.title??e.value.display??e.value.displayName??e.value.text??e.value.value??e.value.id??null;if(re!=null){const W=String(re).trim();if(W)return W}}return P?.label?String(P.label):""})();if(!K){x(re=>re.selectedValue===$?re:{...re,selectedValue:$});return}x(re=>re.selectedValue===$&&re.selectedLabel===K?re:{...re,selectedLabel:K,selectedValue:$})},[j,$,e.value,F]),!l)return console.warn(" Field without key/name skipped:",e),null;const H=P=>{const K=[];return e.helpText&&K.push(t.jsx("p",{className:"help-text",children:e.helpText},"help")),P&&K.push(t.jsx("p",{className:"help-text warning",children:e.noOptionsMessage||"No options available."},"empty")),K};if(B){const P=R(),K=typeof _=="string"&&_.trim()?_.trim():L?"locations":"entities",re=F.length>0,W=!!(P&&(T||L)),ue=!W&&!re;if(D){const we=e.displayKey&&V(n,e.displayKey)?V(n,e.displayKey):null,ne=L?$||n?.location_id||n?.parent_id||n?.location?.id||n?.parent?.id||l==="location"&&n?.location||l==="parent"&&n?.parent||l==="parent_id"&&n?.parent_id||n?.location||n?.parent||"":null,Le=L&&(n?.locationName||n?.parentName||n?.location?.name||n?.parent?.name)||null;let be=we??(Le&&Le!==""?Le:null)??g.selectedLabel??F.find(ut=>ut.value===$)?.label??"";!be&&$&&!L&&(be=$);const Oe=L?ne&&ne!==""&&ne!==""?ne:null:_g(M||e.value||$),Me=L?Le&&Le!==""?Le:be&&be!==""?be:null:Cg(M||e.value)||be||$;return t.jsxs("div",{className:`form-group ${D?"readonly":""}`,children:[t.jsx("label",{children:E}),t.jsxs("div",{style:{position:"relative",display:"inline-block",width:"100%"},children:[t.jsx("input",{type:"text",value:z(be),disabled:!0,className:"readonly-control",style:{paddingRight:Oe?"2.5rem":"0.8rem",width:"100%"}}),Oe&&t.jsx("div",{style:{position:"absolute",right:"0.5rem",top:"50%",transform:"translateY(-50%)",zIndex:1},children:L?t.jsx(fs,{locationId:Oe,locationName:Me,className:"location-info-trigger--field-button"}):t.jsx(Na,{entityId:Oe,entityName:Me,className:"entity-info-trigger--field-button"})})]}),H(!1)]})}const Q=we=>{if(!we){s?.(l,""),x(Oe=>({...Oe,selectedLabel:"",selectedValue:null}));return}const ne=we.id??we.value??we.key??we.slug??we.uuid??null;if(ne==null){s?.(l,"");return}const Le=String(ne),be=we.name??we.label??we.title??we.display??we.displayName??"";s?.(l,Le),x(Oe=>({...Oe,selectedLabel:be||Oe.selectedLabel||Le,selectedValue:Le}))},ye=we=>{if(!we){x(Oe=>({...Oe,selectedLabel:"",selectedValue:null}));return}const ne=we.id??we.value??we.key??we.slug??we.uuid??null;if(ne==null)return;const Le=String(ne),be=we.name??we.label??we.title??we.display??we.displayName??"";x(Oe=>Oe.selectedValue===Le&&Oe.selectedLabel===be?Oe:{...Oe,selectedLabel:be||Oe.selectedLabel||Le,selectedValue:Le})},ae=$&&g.selectedLabel?{id:$,name:g.selectedLabel}:$,ke=L?e1:Cc,pe=e.allowedTypeIds&&Array.isArray(e.allowedTypeIds)&&e.allowedTypeIds.length>0?e.allowedTypeIds:T?[T]:[];return t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:E}),t.jsx(ke,{worldId:P,value:ae,allowedTypeIds:pe,disabled:ue,placeholder:`Search ${K.toLowerCase()}...`,staticOptions:F,onChange:Q,onResolved:ye,required:!!e.required,minSearchLength:L&&pe.length===0?0:void 0}),!T&&!L&&t.jsx("p",{className:"help-text warning",children:"Reference type configuration is missing."}),!P&&W&&t.jsxs("p",{className:"help-text warning",children:["Select a world to search for ",L?"locations":"entities","."]}),H(!1)]})}if(["select","dropdown"].includes(j)){const P=[...e.options||[],...o],K=k??"",re=m&&e.optionsSource&&P.length===0;if(D){const W=P.find(ye=>ye?typeof ye=="object"?String(ye.value)===String(K):String(ye)===String(K):!1),ue=e.displayKey&&V(n,e.displayKey)?V(n,e.displayKey):null,Q=z(ue||(W?typeof W=="object"?W.label??W.value:W:K));return t.jsxs("div",{className:`form-group ${D?"readonly":""}`,children:[t.jsx("label",{children:E}),t.jsx("input",{type:"text",value:Q,disabled:!0,className:"readonly-control"}),H(!1)]})}return t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:E}),t.jsx("div",{className:"select-wrapper",children:t.jsxs("select",{value:K,onChange:U,disabled:re,children:[t.jsx("option",{value:"",children:"Select..."}),P.map((W,ue)=>{const Q=typeof W=="object"?W.value:W,ye=typeof W=="object"?W.label:W;return t.jsx("option",{value:Q,children:ye},Q||ue)})]})}),H(re)]})}if(j==="multiselect"){const P=[...Array.isArray(e.selectedOptions)?e.selectedOptions:[],...Array.isArray(e.prefillOptions)?e.prefillOptions:[]],K=[...e.options||[],...o,...P].map((ye,ae)=>{const ke=qj(ye);if(ke)return ke;if(typeof ye=="object"&&ye!==null){const we=ye.value??ye.id??ye.key??ye.slug??`opt-${ae}`,ne=ye.label??ye.name??ye.title??ye.username??ye.email??we;return we==null?null:{value:String(we),label:String(ne)}}if(ye==null)return null;const pe=String(ye);return{value:pe,label:pe}}).filter(Boolean),re=new Map,W=K.filter(ye=>{const ae=String(ye.value);return re.has(ae)?!1:(re.set(ae,ye),!0)}),ue=Array.isArray(k)?k.map(ye=>String(ye)).filter(Boolean):[],Q=m&&e.optionsSource&&W.length===0;if(D){const ye=ue.map(ae=>{const ke=re.get(String(ae));return ke?ke.label??ke.value??String(ae):String(ae)}).filter(Boolean);return t.jsxs("div",{className:`form-group ${D?"readonly":""}`,children:[t.jsx("label",{children:E}),t.jsx("textarea",{className:"textarea-field",value:ye.length?ye.join(`
`):"",readOnly:!0}),H(!1)]})}return t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:E}),t.jsx($s,{selected:ue,options:W,onChange:ye=>s?.(l,ye),placeholder:e.placeholder||"Search and select...",noOptionsMessage:e.noOptionsMessage||"No options available.",loading:!m&&!!e.optionsSource}),H(Q)]})}if(["textarea","multiline"].includes(j))return t.jsxs("div",{className:`form-group ${D?"readonly":""}`,children:[t.jsx("label",{children:E}),t.jsx("textarea",{className:"textarea-field",rows:e.rows||4,value:D?G:k,onChange:U,disabled:D}),H(!1)]});if(["checkbox","boolean"].includes(j))return t.jsxs("div",{className:"form-group checkbox",children:[t.jsxs("label",{children:[t.jsx("input",{type:"checkbox",checked:!!k,onChange:X,disabled:D}),E]}),H(!1)]});if(j==="readonly"){const P=k?.username||k?.name||k||"-";return t.jsxs("div",{className:"form-group readonly",children:[t.jsx("label",{children:E}),t.jsx("div",{className:"readonly-value",children:P}),H(!1)]})}const I=(D?"text":e.inputType)||"text",Y=(()=>{if(k==null)return"";if(new Set(["number","date","datetime-local","month","time","week","range"]).has(I)&&typeof k=="string"){const K=k.trim();if(!K||K==="")return""}return k})();return D?t.jsxs("div",{className:"form-group readonly",children:[t.jsx("label",{children:E}),t.jsx("div",{className:"readonly-value",children:G}),H(!1)]}):t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:E}),t.jsx("input",{type:I,value:Y,onChange:U,placeholder:e.placeholder||"",className:D?"readonly-control":void 0}),H(!1)]})}const i1="You have unsaved changes. Select Cancel to stay here and save, or OK to leave without saving.";function pD(e,n=i1,s){const i=u.useCallback(({currentLocation:l,nextLocation:o})=>!e||s?.current?!1:!(l.pathname===o.pathname&&l.search===o.search&&l.hash===o.hash),[e,s]);WT({when:i,message:n}),sj(u.useCallback(l=>{!e||s?.current||(l.preventDefault(),l.returnValue="")},[e,s]),{capture:!0})}function yD({schema:e,initialData:n={},onSubmit:s,onCancel:i,onDelete:l,hideActions:o=!1,enableUnsavedPrompt:d=!0,onStateChange:m,fieldRules:p},h){const[y,g]=u.useState(()=>n?{...n}:{}),[x,v]=u.useState(()=>JSON.stringify(n??{})),[S,N]=u.useState(""),[E,j]=u.useState("success"),[A,T]=u.useState(!1),[_,M]=u.useState(()=>({actionsByField:{},showRuleTargets:new Set})),k=u.useMemo(()=>{if(!e)return[];const Y=Array.isArray(e.fields)?e.fields.filter(K=>K&&typeof K=="object"):[],P=Array.isArray(e.sections)?e.sections.flatMap(K=>Array.isArray(K?.fields)?K.fields:[]).filter(K=>K&&typeof K=="object"):[];return Y.length===0&&P.length===0?[]:[...P,...Y]},[e]),C=u.useMemo(()=>{const Y=Array.isArray(p)?p:[];return wg(Y,k)},[p,k]);u.useEffect(()=>{const Y=n?{...n}:{};g(Y),v(JSON.stringify(n??{})),N(""),j("success")},[n]),u.useEffect(()=>{if(!C.length){M({actionsByField:{},showRuleTargets:new Set});return}const Y=Ng(C,y);M(Y)},[C,y]);const D=u.useMemo(()=>Array.isArray(e?.sections)&&e.sections.length>0?e.sections:Array.isArray(e?.fields)?[{title:e.title,columns:e.columns||1,fields:e.fields}]:[],[e]),z=(Y,P,K)=>{if(!P||P.length===0)return Y;const re={...Y||{}};let W=re;for(let ue=0;ue<P.length;ue+=1){const Q=P[ue];if(ue===P.length-1)W[Q]=K;else{const ae=W[Q],ke=ae&&typeof ae=="object"&&!Array.isArray(ae)?{...ae}:{};W[Q]=ke,W=ke}}return re},G=(Y,P)=>{if(!(!P||typeof P!="string")&&!(!Y||typeof Y!="object"))return P.includes(".")?P.split(".").filter(K=>K.length>0).reduce((K,re)=>{if(K!=null&&typeof K=="object")return K[re]},Y):Y?.[P]},U=(Y,P)=>{!Y||typeof Y!="string"||g(K=>{if(!Y.includes("."))return{...K||{},[Y]:P};const re=Y.split(".").filter(W=>W.length>0);return re.length===0?{...K||{}}:z(K,re,P)})},X=u.useMemo(()=>JSON.stringify(y??{}),[y]),V=u.useMemo(()=>X!==x,[X,x]),R=u.useRef(!1);u.useEffect(()=>{V||(R.current=!1)},[V]),u.useEffect(()=>{V&&S&&(N(""),j("success"))},[V,S]),u.useEffect(()=>{typeof m=="function"&&m({isDirty:V,isSubmitting:A})},[V,A,m]),pD(d&&V,void 0,R);const L=u.useCallback(()=>{if(!D.length)return!0;const Y=[];return D.forEach(P=>{(Array.isArray(P.fields)?P.fields:[]).forEach(re=>{const W=re?.key||re?.name||re?.field;if(!W)return;const ue=_.actionsByField[W],Q=re?.visibleByDefault!==void 0?!!re.visibleByDefault:re?.visible_by_default!==void 0?!!re.visible_by_default:!0;if(Ac(W,ue,_.showRuleTargets,Q)||!(!!re?.required||ue==="require"))return;const ae=G(y,W);(Array.isArray(ae)?ae.length>0:ae!=null&&ae!=="")||Y.push(re.label||re.name||W)})}),Y.length>0?(j("error"),N(`Please complete required fields: ${Y.join(", ")}`),!1):!0},[D,y,_]),O=u.useCallback(async()=>{if(!s)return!0;if(!L())return!1;const Y=JSON.stringify(y??{});T(!0),j("success"),N(""),R.current=!0;try{const P=await s(y);if(P===!1)return R.current=!1,!1;const K=P&&typeof P=="object"&&!Array.isArray(P)?P:{};v(Y);const re=typeof P=="string"?P:K.message||e?.saveSuccessMessage||"";if(re){const W=K.status==="error"?"error":"success";j(W),N(re)}return R.current=!1,K}catch(P){return console.error("Failed to submit form:",P),j("error"),N(P.message||"Failed to save changes."),R.current=!1,!1}finally{T(!1)}},[y,s,e,L]),$=async Y=>{Y.preventDefault(),await O()},F=()=>{i&&(!V||window.confirm(i1))&&(v(X),R.current=!0,i())},H=async()=>{if(l)try{await l(y)&&(v(X),R.current=!0)}catch(Y){console.error("Failed to delete record:",Y)}},I=u.useCallback((Y=n)=>{const P=Y?{...Y}:{};g(P),v(JSON.stringify(Y??{})),N(""),j("success"),R.current=!1},[n]);return u.useImperativeHandle(h,()=>({submit:O,reset:I,isDirty:()=>V,isSubmitting:()=>A}),[O,I,V,A]),t.jsxs("form",{className:"record-form",onSubmit:$,children:[t.jsx("h2",{className:"form-title",children:e?.title||"Record"}),D.map((Y,P)=>t.jsxs("div",{className:"form-section",children:[Y.title?t.jsx("h3",{children:Y.title}):null,t.jsx("div",{className:`form-grid cols-${Y.columns||1} ${(Y.columns||1)>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":""}`,children:(Y.fields||[]).map((K,re)=>{if(!K||typeof K!="object")return console.warn(" Skipping invalid field in schema:",K),null;const W=K.key||K.name||K.field||`field-${re}`,ue=_.actionsByField[W],Q=K.visibleByDefault!==void 0?!!K.visibleByDefault:K.visible_by_default!==void 0?!!K.visible_by_default:!0;if(Ac(W,ue,_.showRuleTargets,Q))return null;const ye={...K};ue==="disable"&&(ye.disabled=!0),ue==="require"&&(ye.required=!0);const ae=K.span||K.colSpan||null,ke=t.jsx(Vc,{field:ye,data:y,onChange:U,mode:"edit"},`${W}-${re}`);return ae&&Number.isFinite(ae)&&ae>1?t.jsx("div",{style:{gridColumn:`span ${ae}`},children:ke},`${W}-${re}-wrapper`):ke})})]},P)),S?t.jsx("div",{className:`form-feedback ${E}`,role:E==="error"?"alert":"status",children:S}):null,o?null:t.jsxs("div",{className:"form-actions sticky-actions",role:"toolbar",children:[t.jsx("div",{className:"left-actions",children:l?t.jsx("button",{type:"button",className:"btn delete",onClick:H,disabled:A,children:e?.deleteLabel||"Delete"}):null}),t.jsxs("div",{className:"right-actions",children:[t.jsx("button",{type:"button",className:"btn cancel",onClick:F,disabled:A,children:e?.cancelLabel||"Cancel"}),t.jsx("button",{type:"submit",className:"btn submit",disabled:A,children:e?.saveLabel||"Save"})]})]})]})}const us=u.forwardRef(yD),gD="Create New World",bD=[{title:"General",columns:2,fields:[{key:"name",label:"Name",type:"text"},{key:"system",label:"System",type:"text"}]},{title:"Entity Creation",columns:1,fields:[{key:"entity_creation_scope",label:"Who can create entities?",type:"select",options:[{value:"owner_dm",label:"World Owner & DMs"},{value:"all_players",label:"All Players (campaign scoped)"}],helpText:"When set to All Players, campaign members can only create entities scoped to their campaign."}]},{title:"Description",columns:1,fields:[{key:"description",label:"Description",type:"textarea"}]}],xD={title:gD,sections:bD},Ul={OWNER_DMS:"owner_dm",ALL_PLAYERS:"all_players"},up=[{value:Ul.OWNER_DMS,label:"World Owner / DMs"},{value:Ul.ALL_PLAYERS,label:"All Players (campaign scoped)"}],l1=e=>{if(!e)return up[0].label;const n=String(e).trim().toLowerCase(),s=up.find(i=>i.value===n);return s?s.label:up[0].label};function vD(){const e=Mn(),{token:n,sessionReady:s}=un(),[i,l]=u.useState([]),[o,d]=u.useState(!1),[m,p]=u.useState(null),[h,y]=u.useState(!1),g=u.useCallback(async()=>{if(n){d(!0),p(null);try{const E=await Xl();l(E?.data||E||[])}catch(E){console.error(" Failed to load worlds:",E),p(E.message)}finally{d(!1)}}},[n]);u.useEffect(()=>{s&&n&&g()},[s,n,g]);const x=[{key:"name",label:"Name"},{key:"system",label:"System"},{key:"status",label:"Status"},{key:"entity_creation_scope",label:"Entity Creation",render:E=>l1(E.entity_creation_scope)},{key:"description",label:"Description"},{key:"createdAt",label:"Created"}],v=()=>y(!0),S=()=>y(!1),N=async E=>{try{return(await tR(E)).success?(await g(),y(!1),!0):!1}catch(j){return alert(`Failed to create world: ${j.message}`),!1}};return s?n?o?t.jsx("p",{children:"Loading worlds..."}):m?t.jsxs("p",{className:"error",children:["Error: ",m]}):h?t.jsx(us,{schema:xD,initialData:{entity_creation_scope:Ul.OWNER_DMS},onSubmit:N,onCancel:S,showUpdateAction:!1}):t.jsx(kf,{data:i,columns:x,title:"Worlds",extraActions:t.jsx("button",{type:"button",className:"btn submit",onClick:v,children:"+ New"}),onRowClick:E=>e(`/worlds/${E.id}`)}):t.jsx("p",{children:"Authenticating..."}):t.jsx("p",{children:"Restoring session..."})}function o1({schema:e,data:n={},onClose:s,closeLabel:i="Back",infoMessage:l}){const o=u.useMemo(()=>Array.isArray(e?.sections)&&e.sections.length>0?e.sections:Array.isArray(e?.fields)?[{title:e.title,columns:e.columns||1,fields:e.fields}]:[],[e]);return t.jsxs("div",{className:"record-form record-view",children:[t.jsx("h2",{className:"form-title",children:e?.title||"Details"}),o.map((d,m)=>t.jsxs("div",{className:"form-section",children:[d.title?t.jsx("h3",{children:d.title}):null,t.jsx("div",{className:`form-grid cols-${d.columns||1}`,children:(d.fields||[]).map((p,h)=>!p||typeof p!="object"?(console.warn(" Skipping invalid field in schema:",p),null):t.jsx(Vc,{field:p,data:n,mode:"view"},`${p.key||p.name||p.field||"field"}-${h}`))})]},m)),l?t.jsx("p",{className:"record-info",children:l}):null,s?t.jsxs("div",{className:"form-actions sticky-actions view-actions",role:"toolbar",children:[t.jsx("div",{className:"left-actions","aria-hidden":"true"}),t.jsx("div",{className:"right-actions",children:t.jsx("button",{type:"button",className:"btn cancel",onClick:s,children:i})})]}):null]})}const SD="Edit World",wD=[{title:"General",columns:2,fields:[{key:"name",label:"Name",type:"text"},{key:"system",label:"System",type:"text"},{key:"status",label:"Status",type:"select",options:[{value:"active",label:"Active"},{value:"archived",label:"Archived"}]}]},{title:"Entity Creation",columns:1,fields:[{key:"entity_creation_scope",label:"Who can create entities?",type:"select",options:[{value:"owner_dm",label:"World Owner & DMs"},{value:"all_players",label:"All Players (campaign scoped)"}],helpText:"When set to All Players, campaign members can only create entities scoped to their campaign."}]},{title:"Description",columns:1,fields:[{key:"description",label:"Description",type:"textarea"}]},{title:"Metadata",columns:2,fields:[{key:"created_by",label:"Created By",type:"readonly"},{key:"createdAt",label:"Created Date",type:"readonly"},{key:"updatedAt",label:"Updated Date",type:"readonly"}]}],ND={title:SD,sections:wD},jD="World Details",ED=[{title:"General",columns:2,fields:[{name:"name",label:"Name",type:"text"},{name:"system",label:"System",type:"text"},{name:"statusLabel",label:"Status",type:"text"},{name:"entityCreationScopeLabel",label:"Entity Creation",type:"text"}]},{title:"Description",columns:1,fields:[{name:"description",label:"Description",type:"textarea"}]},{title:"Metadata",columns:2,fields:[{name:"ownerName",label:"Created By",type:"text"},{name:"createdAt",label:"Created",type:"text"},{name:"updatedAt",label:"Updated",type:"text"}]}],_D={title:jD,sections:ED},os=e=>{if(!e)return"";const n=e instanceof Date?e:new Date(e);if(Number.isNaN(n.getTime()))return typeof e=="string"?e:"";const s=String(n.getDate()).padStart(2,"0"),i=String(n.getMonth()+1).padStart(2,"0"),l=n.getFullYear(),o=String(n.getHours()).padStart(2,"0"),d=String(n.getMinutes()).padStart(2,"0");return`${s}/${i}/${l} ${o}:${d}`};function CD(){const{id:e}=Wa(),n=Mn(),{user:s,token:i,sessionReady:l}=un(),[o,d]=u.useState(null),[m,p]=u.useState(!0),[h,y]=u.useState(null),g=u.useCallback(async()=>{try{const j=await Xl(),A=(j?.data||j||[]).find(T=>T.id===e);d(A),A||y("World not found")}catch(j){console.error(" Failed to load world:",j),y(j.message)}finally{p(!1)}},[e]);u.useEffect(()=>{l&&i&&g()},[l,i,g]);const x=async(j,A={})=>{const{stayOnPage:T=!1}=A;try{const _={name:j?.name,description:j?.description,system:j?.system,status:j?.status,entity_creation_scope:j?.entity_creation_scope},M=await nR(e,_);if(M.success){const k=M.data||{...o,..._};return d(k),T?{message:"World updated successfully."}:(n("/worlds"),!0)}return!1}catch(_){return alert(`Failed to update world: ${_.message}`),!1}},v=async()=>{if(!confirm("Delete this world?"))return!1;try{return(await aR(e)).success?(n("/worlds"),!0):!1}catch(j){return alert(`Failed to delete world: ${j.message}`),!1}},S=u.useMemo(()=>!o||!s?!1:s.role==="system_admin"?!0:o.created_by===s.id,[s,o]),N=u.useMemo(()=>o?{...o,created_by:o.creator||o.created_by}:null,[o]),E=u.useMemo(()=>{if(!o)return null;const j=o.status||"",A=j.length>0?j.charAt(0).toUpperCase()+j.slice(1):"",T=l1(o.entity_creation_scope),_=o.creator?.username||o.creator?.name||o.created_by||"";return{name:o.name||"",system:o.system||"",statusLabel:A,entityCreationScopeLabel:T,description:o.description||"",ownerName:_,createdAt:os(o.createdAt),updatedAt:os(o.updatedAt)}},[o]);return l?i?m?t.jsx("p",{children:"Loading world..."}):h?t.jsxs("p",{className:"error",children:["Error: ",h]}):o?S?t.jsx(us,{schema:ND,initialData:N||o,onSubmit:x,onDelete:v,onCancel:()=>n("/worlds")}):t.jsx(o1,{schema:_D,data:E||{},onClose:()=>n("/worlds"),closeLabel:"Back to worlds",infoMessage:"You can view this world but only the creator or a system admin can make changes."}):t.jsx("p",{children:"World not found"}):t.jsx("p",{children:"Authenticating..."}):t.jsx("p",{children:"Restoring session..."})}async function AD(e=5,n=200){for(let s=0;s<e;s++){const i=qs();if(i)return i;await new Promise(l=>setTimeout(l,n))}return null}async function Mg(){const e=await AD();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function kg(e,n="request"){if(e.status===401)throw new Error("Unauthorized");if(!e.ok){const s=await e.text();throw new Error(`Failed to ${n}: ${e.status} ${s}`)}return e.json()}async function TD(e){if(!e)throw new Error("campaignId is required");const n=await Mg(),s=new URL(`${sn}/user-campaign-roles`);s.searchParams.set("campaign_id",e);const i=await fetch(s.toString(),{headers:n});return kg(i,"load campaign members")}async function MD(e,n){const s=await Mg(),i=await fetch(`${sn}/user-campaign-roles/${e}`,{method:"PUT",headers:s,body:JSON.stringify(n)});return kg(i,"update campaign assignment")}async function kD(e){const n=await Mg(),s=await fetch(`${sn}/user-campaign-roles/${e}`,{method:"DELETE",headers:n});return kg(s,"remove user from campaign")}const RD=[{label:"Dungeon Master",value:"dm"},{label:"Player",value:"player"},{label:"Observer",value:"observer"}];function ID({campaignId:e,canManage:n,onMembersChanged:s}){const[i,l]=u.useState([]),[o,d]=u.useState(!0),[m,p]=u.useState(null),h=u.useCallback(async()=>{if(e){p(null),d(!0);try{const v=(await TD(e))?.data||[];l(v)}catch(x){p(x.message)}finally{d(!1)}}},[e]);u.useEffect(()=>{h()},[h]);const y=async(x,v)=>{p(null);try{const N=(await MD(x,{role:v}))?.data;N&&l(E=>{const j=E.map(A=>A.id===N.id?N:A);return typeof s=="function"&&s(j),j})}catch(S){p(S.message)}},g=async x=>{if(confirm("Remove this user from the campaign?")){p(null);try{await kD(x),l(v=>{const S=v.filter(N=>N.id!==x);return typeof s=="function"&&s(S),S})}catch(v){p(v.message)}}};return e?t.jsx(t.Fragment,{children:t.jsxs("div",{className:"panel",children:[t.jsx("div",{className:"panel-header",children:t.jsx("h3",{children:"Campaign Members"})}),m&&t.jsx("p",{className:"error",children:m}),o?t.jsx("p",{children:"Loading members"}):i.length===0?t.jsx("p",{children:"No users associated with this campaign yet."}):t.jsxs("table",{className:"compact-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"User"}),t.jsx("th",{children:"Role"}),t.jsx("th",{children:"Added"}),n?t.jsx("th",{children:"Actions"}):null]})}),t.jsx("tbody",{children:i.map(x=>t.jsxs("tr",{children:[t.jsx("td",{children:x.user?.username||x.user?.email||x.user_id}),t.jsx("td",{children:n?t.jsx("select",{value:x.role,onChange:v=>y(x.id,v.target.value),children:RD.map(v=>t.jsx("option",{value:v.value,children:v.label},v.value))}):x.role}),t.jsx("td",{children:x.createdAt?new Date(x.createdAt).toLocaleString():""}),n?t.jsx("td",{children:t.jsx("button",{type:"button",className:"btn danger",onClick:()=>g(x.id),children:"Remove"})}):null]},x.id))})]}),n?t.jsx("p",{className:"help-text",children:"Manage who can participate through the Players list. Update roles here to promote Dungeon Masters or set observers."}):null]})}):null}const DD="New Campaign",LD=[{name:"world_id",label:"World",type:"select",optionsSource:"worlds",optionsCriteria:{owned_only:!0},required:!0},{name:"name",label:"Name",type:"text",required:!0,placeholder:"Enter campaign name"},{name:"description",label:"Description",type:"textarea",placeholder:"Brief description of the campaign world"},{name:"status",label:"Status",type:"select",options:[{label:"Draft",value:"draft"},{label:"Active",value:"active"},{label:"Completed",value:"completed"},{label:"Archived",value:"archived"}],default:"draft"}],OD="Create Campaign",$D={title:DD,fields:LD,submitLabel:OD},FD="Edit Campaign",zD=[{name:"world_id",label:"World",type:"select",optionsSource:"worlds",required:!0,readonly:!0},{name:"name",label:"Name",type:"text",required:!0},{name:"description",label:"Description",type:"textarea"},{name:"status",label:"Status",type:"select",options:[{label:"Draft",value:"draft"},{label:"Active",value:"active"},{label:"Completed",value:"completed"},{label:"Archived",value:"archived"}]},{name:"player_ids",label:"Players",type:"multiselect",optionsSource:"players",optionLabelKey:"username",optionValueKey:"id",helpText:"Players selected here can create characters in this campaign.",noOptionsMessage:"No eligible players are currently available."}],BD="Save Changes",UD="Delete Campaign",AS={title:FD,fields:zD,submitLabel:BD,deleteLabel:UD},qD="Campaign Details",PD=[{title:"Overview",columns:2,fields:[{name:"name",label:"Name",type:"text"},{name:"statusLabel",label:"Status",type:"text"},{name:"worldName",label:"World",type:"text"},{name:"ownerName",label:"Owner",type:"text"}]},{title:"Description",columns:1,fields:[{name:"description",label:"Description",type:"textarea"}]},{title:"Metadata",columns:2,fields:[{name:"createdAt",label:"Created",type:"text"},{name:"updatedAt",label:"Updated",type:"text"}]}],HD={title:qD,sections:PD};function ld({scope:e="all"}){const n=Mn(),{id:s}=Wa(),{user:i,token:l,sessionReady:o}=un(),[d,m]=u.useState([]),[p,h]=u.useState(!1),[y,g]=u.useState("list"),[x,v]=u.useState(null),[S,N]=u.useState(null),[E,j]=u.useState("details"),A=u.useMemo(()=>`/campaigns/${e}`,[e]),T=u.useCallback(Q=>{if(!Q)return Q;const ye=Array.isArray(Q.members)?Q.members.filter(ae=>ae.role==="player"):[];return{...Q,ownerName:Q.owner?.username||"",worldName:Q.world?.name||"",player_ids:ye.map(ae=>ae.user_id)}},[]),_=u.useCallback(async()=>{if(l){h(!0),N(null);try{const Q=await qc(),ae=(Q?.data||Q||[]).map(ke=>T(ke));m(ae)}catch(Q){N(Q.message)}finally{h(!1)}}},[l,T]);u.useEffect(()=>{o&&l&&_()},[o,l,_]),u.useEffect(()=>{g("list"),v(null),j("details")},[e]),u.useEffect(()=>{if(!s){y!=="new"&&g("list"),v(null);return}const Q=d.find(ae=>String(ae.id)===s);if(!Q){p||n(A,{replace:!0});return}const ye=!!i&&(i.role==="system_admin"||Q.created_by===i.id);v(Q),g(ye?"edit":"view")},[s,d,n,A,p,y,i]),u.useEffect(()=>{j("details")},[x?.id]);const M=u.useMemo(()=>[{key:"name",label:"Name"},{key:"worldName",label:"World"},{key:"ownerName",label:"Owner"},{key:"status",label:"Status"},{key:"description",label:"Description"},{key:"createdAt",label:"Created"}],[]),k=Q=>!Q||!i?!1:i.role==="system_admin"||Q.created_by===i.id,C=u.useMemo(()=>{if(i?.role!=="system_admin")return AS;const Q=JSON.parse(JSON.stringify(AS)),ye={name:"created_by",label:"Owner",type:"select",optionsSource:"users",optionLabelKey:"username",optionValueKey:"id"};if(Array.isArray(Q.fields)){const ae=Q.fields.findIndex(ke=>ke?.name==="created_by");if(ae>=0)Q.fields[ae]={...Q.fields[ae],...ye};else{const ke=Math.min(2,Q.fields.length);Q.fields.splice(ke,0,ye)}}return Q},[i]),D=()=>{n(A),g("new"),v(null)},z=()=>{g("list"),v(null),n(A)},G=async Q=>{try{return(await Vk(Q)).success?(await _(),n(A),g("list"),v(null),!0):!1}catch(ye){return alert(`Failed to create campaign: ${ye.message}`),!1}},U=async(Q,ye={})=>{const{stayOnPage:ae=!1}=ye;if(!k(x))return alert("You do not have permission to update this campaign."),!1;const ke={...Q};Object.prototype.hasOwnProperty.call(Q,"player_ids")&&(Array.isArray(Q.player_ids)?ke.player_ids=Q.player_ids.filter(pe=>pe!=null&&pe!==""):typeof Q.player_ids=="string"&&Q.player_ids!==""?ke.player_ids=[Q.player_ids]:ke.player_ids=[]);try{const pe=await Yk(x.id,ke);if(pe.success){const we=T(pe.data);return m(ne=>ne.map(Le=>Le.id===we.id?we:Le)),v(ne=>!ne||ne.id!==we.id?ne:we),ae?{message:"Campaign updated successfully."}:(g("list"),v(null),n(A),!0)}return!1}catch(pe){return alert(`Failed to update campaign: ${pe.message}`),!1}},X=u.useCallback((Q,ye)=>{const ae=ke=>{if(!Array.isArray(ke))return{members:[],playerIds:[]};const pe=ke.filter(we=>we.role==="player");return{members:ke,playerIds:pe.map(we=>we.user_id)}};m(ke=>ke.map(pe=>{if(pe.id!==Q)return pe;const{members:we,playerIds:ne}=ae(ye);return{...pe,members:we,player_ids:ne}})),v(ke=>{if(!ke||ke.id!==Q)return ke;const{members:pe,playerIds:we}=ae(ye);return{...ke,members:pe,player_ids:we}})},[]),V=async Q=>{const ye=Q||x,ae=ye?.id;if(!ae)return!1;if(!k(ye))return alert("You do not have permission to delete this campaign."),!1;if(!confirm("Delete this campaign?"))return!1;try{return(await Gk(ae)).success?(await _(),g("list"),v(null),n(A),!0):!1}catch(ke){return alert(ke.message),!1}},R=()=>{g("list"),v(null),n(A)},B=u.useMemo(()=>{if(!x)return null;const Q=x.created_by??x.owner?.id??"",ye=Array.isArray(x.members)?x.members.filter(ae=>ae.role==="player"):[];return{...x,created_by:Q,player_ids:ye.map(ae=>ae.user_id)}},[x]),L=u.useMemo(()=>{const Q=JSON.parse(JSON.stringify(C));return Array.isArray(Q.fields)?Q.fields=Q.fields.filter(ye=>ye?.name!=="player_ids"):Array.isArray(Q.sections)&&(Q.sections=Q.sections.map(ye=>({...ye,fields:(ye.fields||[]).filter(ae=>ae?.name!=="player_ids")})).filter(ye=>ye.fields&&ye.fields.length>0)),Q.title="Campaign Details",Q},[C]),O=u.useMemo(()=>{if(!x||!Array.isArray(x.members))return[];const Q=new Set;return x.members.map(ye=>{const ae=ye?.user_id??ye?.user?.id;if(!ae)return null;const ke=String(ae);if(Q.has(ke))return null;Q.add(ke);const pe=ye?.user?.username||ye?.user?.displayName||ye?.user?.display_name||ye?.user?.name||ye?.user?.email||ye?.display_name||ke;return{value:ke,label:pe}}).filter(Boolean)},[x]),$=u.useMemo(()=>{const Q={title:"Campaign Membership",fields:[]},ye=ke=>{if(!ke)return null;if(Array.isArray(ke.fields)){for(const pe of ke.fields)if(pe?.name==="player_ids")return pe}return null};let ae=null;if(Array.isArray(C.fields))ae=ye(C);else if(Array.isArray(C.sections)){for(const ke of C.sections)if(ae=ye(ke),ae)break}if(ae){const ke=JSON.parse(JSON.stringify(ae));O.length>0&&(ke.selectedOptions=O),Q.fields=[ke]}return Q},[C,O]),F=u.useMemo(()=>B?{player_ids:B.player_ids??[]}:null,[B]),H=u.useMemo(()=>{if(!x)return null;const Q=x.status||"",ye=Q?Q.charAt(0).toUpperCase()+Q.slice(1):"";return{...x,statusLabel:ye,createdAt:os(x.createdAt),updatedAt:os(x.updatedAt)}},[x]),I=u.useMemo(()=>e==="my"?i?.id?d.filter(Q=>Q.created_by===i.id):[]:d,[d,e,i]),Y=e==="my"?"My Campaigns":"All Campaigns",P=e==="my"?"Back to my campaigns":"Back to all campaigns",K=u.useMemo(()=>!x||!Array.isArray(x.members)||!i?.id?!1:x.members.some(Q=>Q?.user_id===i.id&&Q?.role==="dm"),[x,i]),re=x?`/campaigns/${x.id}/access/bulk`:"",ue=e!=="my"&&!!(x&&K)&&re?t.jsxs("div",{className:"campaign-access-cta",children:[t.jsxs("div",{children:[t.jsx("p",{className:"campaign-access-eyebrow",children:"Campaign Tools"}),t.jsxs("h3",{children:["Manage entity access for ",x.name]}),t.jsx("p",{className:"campaign-access-copy",children:"The Campaign Access Editor keeps changes scoped to this campaigns members."})]}),t.jsx("div",{className:"campaign-access-actions",children:t.jsx(Yt,{to:re,className:"btn outline",children:"Open Access Editor"})})]}):null;return o?l?p?t.jsx("p",{children:"Loading campaigns..."}):S?t.jsxs("p",{className:"error",children:["Error: ",S]}):y==="new"?t.jsx(us,{schema:$D,initialData:{},onSubmit:G,onCancel:z,showUpdateAction:!1}):y==="edit"&&x&&B?t.jsxs("div",{className:"campaign-editor",children:[ue,t.jsxs("div",{className:"campaign-tabs",role:"tablist","aria-label":"Campaign editor tabs",children:[t.jsx("button",{type:"button",role:"tab","aria-selected":E==="details",className:`campaign-tab${E==="details"?" is-active":""}`,onClick:()=>j("details"),children:"Details"}),t.jsx("button",{type:"button",role:"tab","aria-selected":E==="membership",className:`campaign-tab${E==="membership"?" is-active":""}`,onClick:()=>j("membership"),children:"Membership"})]}),t.jsx("div",{className:"campaign-tab-panel",role:"tabpanel",children:E==="details"?t.jsx(us,{schema:L,initialData:B,onSubmit:U,onDelete:V,onCancel:z}):t.jsxs("div",{className:"campaign-membership",children:[t.jsx(us,{schema:$,initialData:F,onSubmit:U,onCancel:z}),t.jsx(ID,{campaignId:x.id,canManage:k(x),onMembersChanged:Q=>X(x.id,Q)})]})})]}):y==="view"&&x?t.jsxs("div",{className:"campaign-view-wrapper",children:[ue,t.jsx(o1,{schema:HD,data:H||{},onClose:R,closeLabel:P,infoMessage:"You can view this campaign but only the owner or a system admin can make changes."})]}):t.jsx(kf,{data:I,columns:M,title:Y,extraActions:t.jsx("button",{type:"button",className:"btn submit",onClick:D,children:"+ New"}),onRowClick:Q=>{v(Q),g(k(Q)?"edit":"view"),n(`${A}/${Q.id}`)}}):t.jsx("p",{children:"Authenticating..."}):t.jsx("p",{children:"Restoring session..."})}const VD="New Character",YD=[{title:"Associations",columns:2,fields:[{key:"campaign_id",label:"Campaign",type:"select",optionsSource:"campaigns",required:!0,noOptionsMessage:"You do not have any campaigns available for character creation.",helpText:"Only campaigns you own or have been added to as a player are listed here."},{key:"user_id",label:"Player",type:"select",optionsSource:"users",optionLabelKey:"username",required:!0}]},{title:"Character Details",columns:2,fields:[{key:"name",label:"Name",type:"text",placeholder:"Character name",required:!0},{key:"level",label:"Level",type:"text",inputType:"number",placeholder:"1"},{key:"class",label:"Class",type:"text",placeholder:"Fighter, Wizard..."},{key:"race",label:"Race",type:"text",placeholder:"Elf, Human..."},{key:"alignment",label:"Alignment",type:"text",placeholder:"Neutral Good"},{key:"is_active",label:"Active Character",type:"checkbox"}]},{title:"Notes",columns:1,fields:[{key:"notes",label:"Notes",type:"textarea",rows:6,placeholder:"Backstory, hooks, etc."}]}],GD={title:VD,sections:YD},KD="Edit Character",XD=[{title:"Associations",columns:2,fields:[{key:"campaign_id",label:"Campaign",type:"select",optionsSource:"campaigns",required:!0},{key:"user_id",label:"Player",type:"select",optionsSource:"users",optionLabelKey:"username",required:!0}]},{title:"Character Details",columns:2,fields:[{key:"name",label:"Name",type:"text",required:!0},{key:"level",label:"Level",type:"text",inputType:"number"},{key:"class",label:"Class",type:"text"},{key:"race",label:"Race",type:"text"},{key:"alignment",label:"Alignment",type:"text"},{key:"is_active",label:"Active Character",type:"checkbox"}]},{title:"Notes",columns:1,fields:[{key:"notes",label:"Notes",type:"textarea",rows:6}]}],WD={title:KD,sections:XD},Zo=(e={})=>({id:e.id,name:e.name||"",race:e.race||"",class:e.class||"",level:e.level??1,alignment:e.alignment||"",notes:e.notes||"",is_active:e.is_active??!0,campaign_id:e.campaign_id||"",user_id:e.user_id||""}),TS=(e={})=>{const n=Number(e.level);return{name:e.name,race:e.race||null,class:e.class||null,level:Number.isNaN(n)?1:n,alignment:e.alignment||null,notes:e.notes||null,is_active:!!e.is_active,campaign_id:e.campaign_id||null,user_id:e.user_id||null}};function qr({scope:e="my"}){const n=Mn(),{id:s}=Wa(),{token:i,sessionReady:l,user:o}=un(),{selectedCampaign:d,selectedCampaignId:m,setSelectedCampaignId:p}=jn(),[h,y]=u.useState([]),[g,x]=u.useState(!1),[v,S]=u.useState(null),[N,E]=u.useState("list"),[j,A]=u.useState(null),[T,_]=u.useState(null),[M,k]=u.useState(""),C=u.useMemo(()=>`/characters/${e}`,[e]),D=u.useMemo(()=>!d||!Array.isArray(d.members)||!o?.id?!1:d.members.some(I=>I?.user_id===o.id&&I?.role==="player"),[d,o]),z=u.useMemo(()=>!d||!Array.isArray(d.members)||!o?.id?!1:d.members.some(I=>I?.user_id===o.id&&I?.role==="dm"),[d,o]),G=u.useMemo(()=>{switch(e){case"my":return"My Characters";case"others":return d?.name?`All Characters  ${d.name}`:"All Characters";case"all":return"All Characters";case"companions":return d?.name?`My Companions  ${d.name}`:"My Companions";default:return"Characters"}},[e,d]),U=e==="my"||o?.role==="system_admin";u.useEffect(()=>{e==="all"&&o&&o.role!=="system_admin"&&n("/characters/my",{replace:!0})},[e,o,n]),u.useEffect(()=>{E("list"),A(null),_(null),k("")},[e]),u.useEffect(()=>{if(!s){N!=="new"&&E("list"),A(null),_(null);return}const I=h.find(P=>String(P.id)===s);if(!I){g||n(C,{replace:!0});return}if(!(I.isOwned||o?.role==="system_admin")){n(C,{replace:!0});return}A(I.formValues||Zo(I)),_(I.id),E("edit")},[s,h,o,n,C,g,N]);const X=u.useCallback(async()=>{if(i&&!(e==="all"&&o&&o.role!=="system_admin")){if(S(null),e==="companions"){if(!m){y([]),k("Select a campaign to view your companions. Use Go to Campaign from My Characters to set one."),x(!1);return}if(!D){y([]),k("You must be a player in the selected campaign to view companions."),x(!1);return}}if(e==="others"){if(!m){y([]),k("Select a campaign to view all characters. Use Go to Campaign from My Characters to set one."),x(!1);return}if(!z){y([]),k("You must be a DM in the selected campaign to view all characters."),x(!1);return}}k(""),x(!0);try{const I={scope:e};(e==="companions"||e==="others"||e==="my"&&m)&&(I.campaign_id=m);const Y=await js(I),P=(Y?.data||Y||[]).map(K=>({...K,playerName:K.player?.username||"",campaignName:K.campaign?.name||"",status:K.is_active?"Active":"Inactive",formValues:Zo(K),isOwned:K.user_id===o?.id}));y(P)}catch(I){console.error(" Failed to load characters:",I),S(I.message)}finally{x(!1)}}},[i,e,o,m,D,z]);u.useEffect(()=>{l&&i&&X()},[l,i,X]);const V=e==="my"&&!m,R=u.useMemo(()=>[{key:"name",label:"Name"},{key:"class",label:"Class"},{key:"level",label:"Level"},{key:"race",label:"Race"},{key:"alignment",label:"Alignment"},{key:"playerName",label:"Player"},{key:"campaignName",label:"Campaign"},{key:"status",label:"Status"}],[]),B=u.useMemo(()=>V?[...R,{key:"campaignAction",label:"Actions",render:I=>I.campaign_id?t.jsx("button",{type:"button",className:"btn secondary compact",onClick:Y=>{Y.stopPropagation(),p(String(I.campaign_id))},children:"Go to Campaign"}):"No campaign"}]:R,[R,V,p]),L=()=>{U&&(n(C),E("new"),A(null),_(null))},O=()=>{E("list"),A(null),_(null),n(C)},$=async I=>{try{return await mR(TS(I)),E("list"),A(null),n(C),await X(),!0}catch(Y){return alert(`Error creating character: ${Y.message}`),!1}},F=async(I,Y={})=>{const{stayOnPage:P=!1}=Y;if(!T)return!1;try{const K=await hR(T,TS(I)),re=K?.data||K||{id:T};if(await X(),P){const W=Zo(re&&typeof re=="object"?re:{...I,id:T});return A(W),{message:"Character updated successfully."}}return E("list"),A(null),_(null),n(C),!0}catch(K){return alert(`Error updating character: ${K.message}`),!1}},H=async()=>{if(!T||!confirm("Delete this character?"))return!1;try{return await pR(T),E("list"),A(null),_(null),n(C),await X(),!0}catch(I){return alert(`Error deleting character: ${I.message}`),!1}};return l?i?g?t.jsx("p",{children:"Loading characters..."}):v?t.jsx("p",{className:"error",children:v}):N==="new"?t.jsx(us,{schema:GD,initialData:{level:1,is_active:!0,user_id:o?.role==="system_admin"?"":o?.id||""},onSubmit:$,onCancel:O,showUpdateAction:!1}):N==="edit"?t.jsx(us,{schema:WD,initialData:j||{},onSubmit:F,onCancel:O,onDelete:H}):N==="list"&&M?t.jsx("div",{className:"empty-state",children:t.jsx("p",{children:M})}):t.jsx(kf,{data:h,columns:B,title:G,extraActions:U?t.jsx("button",{type:"button",className:"btn submit",onClick:L,children:"+ New"}):null,onRowClick:I=>{(I.isOwned||o?.role==="system_admin")&&(n(`${C}/${I.id}`),A(I.formValues||Zo(I)),_(I.id),E("edit"))}}):t.jsx("p",{children:"Authenticating..."}):t.jsx("p",{children:"Restoring session..."})}function Df(){const e=qs();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function Lf(e,n="request"){if(e.status===401)throw new Error("Unauthorized");if(!e.ok){const s=await e.text();throw new Error(`Failed to ${n}: ${s}`)}return e.json()}async function Rg(){const e=await fetch(`${sn}/users`,{headers:Df()});return Lf(e,"fetch users")}async function ZD(e){const n=await fetch(`${sn}/users`,{method:"POST",headers:Df(),body:JSON.stringify(e)});return Lf(n,"create user")}async function QD(e,n){const s=await fetch(`${sn}/users/${e}`,{method:"PUT",headers:Df(),body:JSON.stringify(n)});return Lf(s,"update user")}async function JD(e){const n=await fetch(`${sn}/users/${e}`,{method:"DELETE",headers:Df()});return Lf(n,"delete user")}const eL="Create New User",tL=[{title:"Account Details",columns:2,fields:[{key:"username",label:"Username",type:"text",placeholder:"Enter username"},{key:"email",label:"Email",type:"text",inputType:"email",placeholder:"user@example.com"},{key:"password",label:"Password",type:"text",inputType:"password",placeholder:"Choose a secure password"},{key:"role",label:"Role",type:"select",options:[{value:"user",label:"User"},{value:"system_admin",label:"System Admin"}],default:"user"}]}],nL={title:eL,sections:tL},aL="Edit User",sL=[{title:"Account Details",columns:2,fields:[{key:"username",label:"Username",type:"text"},{key:"email",label:"Email",type:"text",inputType:"email"},{key:"role",label:"Role",type:"select",options:[{value:"user",label:"User"},{value:"system_admin",label:"System Admin"}]},{key:"password",label:"New Password",type:"text",inputType:"password",placeholder:"Leave blank to keep current password"}]}],rL={title:aL,sections:sL};function iL(){const{user:e,token:n,sessionReady:s}=un(),[i,l]=u.useState([]),[o,d]=u.useState(!1),[m,p]=u.useState(null),[h,y]=u.useState("list"),[g,x]=u.useState(null),v=u.useCallback(async()=>{if(!(!n||e?.role!=="system_admin")){d(!0),p(null);try{const _=await Rg();l(_?.data||_||[])}catch(_){console.error(" Failed to load users:",_),p(_.message)}finally{d(!1)}}},[n,e?.role]);u.useEffect(()=>{s&&n&&e?.role==="system_admin"&&v()},[s,n,e?.role,v]);const S=[{key:"username",label:"Username"},{key:"email",label:"Email"},{key:"role",label:"Role"},{key:"createdAt",label:"Created"}],N=()=>{x(null),y("new")},E=()=>{y("list"),x(null)},j=async _=>{try{const M={username:_.username,email:_.email,password:_.password,role:_.role||"user"};return await ZD(M),y("list"),x(null),await v(),!0}catch(M){return alert(`Error creating user: ${M.message}`),!1}},A=async(_,M={})=>{const{stayOnPage:k=!1}=M;if(!g?.id)return!1;try{const C={username:_.username,email:_.email,role:_.role};_.password&&(C.password=_.password);const z=(await QD(g.id,C))?.data||{...g,...C};return await v(),k?(x(z),{message:"User updated successfully."}):(y("list"),x(null),!0)}catch(C){return alert(`Error updating user: ${C.message}`),!1}},T=async()=>{if(!g?.id||!confirm(`Delete user "${g.username}"?`))return!1;try{return await JD(g.id),y("list"),x(null),await v(),!0}catch(_){return alert(`Error deleting user: ${_.message}`),!1}};return s?n?!e||e.role!=="system_admin"?t.jsx("p",{className:"error",children:"Access denied. Admins only."}):o?t.jsx("p",{children:"Loading users..."}):m?t.jsxs("p",{className:"error",children:["Error: ",m]}):h==="new"?t.jsx(us,{schema:nL,initialData:{},onSubmit:j,onCancel:E,showUpdateAction:!1}):h==="edit"?t.jsx(us,{schema:rL,initialData:g||{},onSubmit:A,onCancel:E,onDelete:T}):t.jsx(kf,{data:i,columns:S,title:"Users",extraActions:t.jsx("button",{type:"button",className:"btn submit",onClick:N,children:"+ New"}),onRowClick:_=>{x(_),y("edit")}}):t.jsx("p",{children:"Authenticating..."}):t.jsx("p",{children:"Restoring session..."})}function lL(){const{login:e}=un(),n=Mn(),[s,i]=u.useState(""),[l,o]=u.useState(""),[d,m]=u.useState(""),[p,h]=u.useState(!1),y=async g=>{g.preventDefault(),m(""),h(!0);try{await e(s,l)?n("/"):m("Invalid username or password")}catch{m("Login failed. Please try again.")}finally{h(!1)}};return t.jsx("div",{className:"login-page",children:t.jsxs("div",{className:"login-card",children:[t.jsx("h1",{className:"login-title",children:"GameDB"}),t.jsx("p",{className:"login-subtitle",children:"Sign in to your account"}),t.jsxs("form",{onSubmit:y,children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Username"}),t.jsx("input",{type:"text",value:s,onChange:g=>i(g.target.value),placeholder:"Enter username",required:!0})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Password"}),t.jsx("input",{type:"password",value:l,onChange:g=>o(g.target.value),placeholder:"Enter password",required:!0})]}),d&&t.jsx("p",{className:"error-msg",children:d}),t.jsx("button",{type:"submit",disabled:p,children:p?"Signing in...":"Sign In"})]})]})})}const oL=e=>Et.get(`/entity-relationships?worldId=${e}`),cL=e=>Et.get(`/entity-relationships/${e}`),c1=e=>Et.get(`/entity-relationships/entity/${e}`),u1=e=>Et.post("/entity-relationships",e),uL=(e,n)=>Et.patch(`/entity-relationships/${e}`,n),dL=e=>Et.delete(`/entity-relationships/${e}`),d1=e=>Et.get(`/entity-types/${e}/fields`),fL=(e,n)=>Et.post(`/entity-types/${e}/fields`,n),mL=(e,n)=>Et.patch(`/entity-type-fields/${e}`,n),hL=e=>Et.delete(`/entity-type-fields/${e}`),pL=[{value:"global",label:"Global"},{value:"selective",label:"Selective"},{value:"hidden",label:"Hidden"}],yL=[{value:"global",label:"Global"},{value:"selective",label:"Selective"},{value:"hidden",label:"Hidden"},{value:"owner_only",label:"Owner only"}],Ni=(e,n)=>`${e}-${n}`;function Ig({canEdit:e,accessSettings:n,accessOptions:s,accessOptionsLoading:i,accessSaving:l,onSettingChange:o,idPrefix:d="entity-access"}){const m=!e||l,p=Ni(d,"read-mode"),h=Ni(d,"read-campaigns"),y=Ni(d,"read-users"),g=Ni(d,"read-characters"),x=Ni(d,"write-mode"),v=Ni(d,"write-campaigns"),S=Ni(d,"write-users");return t.jsxs("div",{className:"entity-access-columns",children:[t.jsxs("div",{className:"entity-access-column",children:[t.jsx("h3",{children:"Read access"}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:p,children:"Visibility"}),t.jsx("select",{id:p,value:n.readMode,onChange:N=>o("readMode",N.target.value),disabled:m,children:pL.map(N=>t.jsx("option",{value:N.value,children:N.label},N.value))})]}),n.readMode==="selective"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:h,children:"Campaigns"}),t.jsx($s,{inputId:h,selected:n.readCampaigns,options:s.campaigns||[],onChange:N=>o("readCampaigns",N),placeholder:"Select campaigns...",noOptionsMessage:i?"Loading campaigns...":"No campaigns available for this world.",loading:i,disabled:m}),t.jsx("p",{className:"help-text",children:"Members of selected campaigns can view this entity."})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:y,children:"Users"}),t.jsx($s,{inputId:y,selected:n.readUsers,options:s.users||[],onChange:N=>o("readUsers",N),placeholder:"Select users...",noOptionsMessage:i?"Loading users...":"No eligible users found for this world.",loading:i,disabled:m}),t.jsx("p",{className:"help-text",children:"Choose players who have characters in this world."})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:g,children:"Characters"}),t.jsx($s,{inputId:g,selected:n.readCharacters,options:s.characters||[],onChange:N=>o("readCharacters",N),placeholder:"Select characters...",noOptionsMessage:i?"Loading characters...":"No characters available for this world.",loading:i,disabled:m}),t.jsx("p",{className:"help-text",children:"Grant visibility to specific characters regardless of campaign."})]})]})]}),t.jsxs("div",{className:"entity-access-column",children:[t.jsx("h3",{children:"Write access"}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:x,children:"Write"}),t.jsx("select",{id:x,value:n.writeMode,onChange:N=>o("writeMode",N.target.value),disabled:m,children:yL.map(N=>t.jsx("option",{value:N.value,children:N.label},N.value))})]}),n.writeMode==="selective"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:v,children:"Campaigns"}),t.jsx($s,{inputId:v,selected:n.writeCampaigns,options:s.campaigns||[],onChange:N=>o("writeCampaigns",N),placeholder:"Select campaigns...",noOptionsMessage:i?"Loading campaigns...":"No campaigns available for this world.",loading:i,disabled:m}),t.jsx("p",{className:"help-text",children:"Dungeon Masters of these campaigns can edit this entity."})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:S,children:"Users"}),t.jsx($s,{inputId:S,selected:n.writeUsers,options:s.users||[],onChange:N=>o("writeUsers",N),placeholder:"Select users...",noOptionsMessage:i?"Loading users...":"No eligible users found for this world.",loading:i,disabled:m}),t.jsx("p",{className:"help-text",children:"Grant edit access to specific players with characters here."})]})]})]})]})}const od=e=>!e||typeof e!="string"?"":e.trim(),MS=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[];async function Dg(e){if(!e)return{campaigns:[],users:[],characters:[]};const[n,s]=await Promise.all([qc({world_id:e}),js({world_id:e})]),l=MS(n).map(p=>({value:String(p.id),label:p.name||"Untitled campaign"})),o=MS(s),d=new Map,m=new Map;return o.forEach(p=>{const h=p?.user_id||p?.player?.id;if(!h)return;const y=String(h);if(d.has(y))return;const g=p?.player||{},x=od(g.username),v=od(g.email);let S=x||v||`User ${y.slice(0,8)}`;x&&v&&x!==v&&(S=`${x} (${v})`),d.set(y,{value:y,label:S});const N=p?.id||p?.character_id;if(!N)return;const E=od(p.name)||"Unnamed character",j=od(p?.campaign?.name||p?.campaign_name||""),A=j?`${E}  ${j}`:E;m.set(String(N),{value:String(N),label:A})}),{campaigns:l,users:Array.from(d.values()),characters:Array.from(m.values())}}const dp=(e,n,s)=>Number.isNaN(e)?n:Math.min(Math.max(e,n),s),gL=220,bL=3;function f1({src:e,size:n=gL,onCropChange:s,className:i="",zoomLabel:l="Zoom"}){const[o,d]=u.useState({width:0,height:0}),[m,p]=u.useState(1),[h,y]=u.useState({x:0,y:0}),[g,x]=u.useState(!1),v=u.useRef({x:0,y:0}),S=u.useRef(null),N=u.useRef(null);u.useEffect(()=>{if(!e){d({width:0,height:0});return}let U=!1;const X=new Image;return X.onload=()=>{U||d({width:X.naturalWidth,height:X.naturalHeight})},X.onerror=()=>{U||d({width:0,height:0})},X.src=e,()=>{U=!0}},[e]);const E=u.useMemo(()=>{if(!o.width||!o.height)return 1;const U=n/o.width,X=n/o.height;return Math.max(U,X)},[o,n]);u.useEffect(()=>{if(!o.width||!o.height)return;p(E);const U=o.width*E,X=o.height*E;y({x:(n-U)/2,y:(n-X)/2})},[o,E,n]);const j=u.useCallback((U,X=m)=>{if(!o.width||!o.height)return U;const V=o.width*X,R=o.height*X,B=Math.min(0,n-V),L=Math.max(0,n-V),O=Math.min(0,n-R),$=Math.max(0,n-R);return{x:dp(U.x,B,L),y:dp(U.y,O,$)}},[o,m,n]),A=U=>{if(!e)return;U.preventDefault(),N.current?.setPointerCapture?.(U.pointerId),S.current=U.pointerId,v.current={x:U.clientX,y:U.clientY},x(!0)},T=U=>{if(!g)return;U.preventDefault();const X=U.clientX-v.current.x,V=U.clientY-v.current.y;v.current={x:U.clientX,y:U.clientY},y(R=>j({x:R.x+X,y:R.y+V}))},_=u.useCallback(()=>{const U=N.current;S.current!==null&&(U?.releasePointerCapture?.(S.current),S.current=null),x(!1)},[]),M=E*bL,k=Math.max(E/50,.01),C=M-E>.001,D=U=>{const X=dp(Number(U.target.value),E,M);p(X),y(V=>j(V,X))};u.useEffect(()=>{typeof s=="function"&&(!o.width||!o.height||!e||s({offset:h,scale:m,containerSize:n,naturalWidth:o.width,naturalHeight:o.height}))},[h,m,n,o,s,e]),u.useEffect(()=>{const U=N.current;if(!U)return;const X=()=>_(),V=()=>_();return U.addEventListener("pointerup",X),U.addEventListener("pointerleave",V),U.addEventListener("pointercancel",V),()=>{U.removeEventListener("pointerup",X),U.removeEventListener("pointerleave",V),U.removeEventListener("pointercancel",V)}},[_]);const z=o.width*m,G=o.height*m;return t.jsxs("div",{className:`image-cropper ${i}`.trim(),children:[t.jsxs("div",{className:`image-cropper__frame${g?" is-dragging":""}`,ref:N,style:{width:n,height:n},onPointerDown:A,onPointerMove:T,role:"presentation",children:[e?t.jsx("img",{src:e,alt:"Selected artwork preview",draggable:!1,style:{width:z,height:G,transform:`translate(${h.x}px, ${h.y}px)`}}):t.jsx("div",{className:"image-cropper__empty",children:"Unable to preview image"}),t.jsx("div",{className:"image-cropper__outline","aria-hidden":"true"}),t.jsx("div",{className:"image-cropper__instructions","aria-hidden":"true",children:"Drag to reposition"})]}),C?t.jsxs("label",{className:"image-cropper__zoom",children:[t.jsx("span",{children:l}),t.jsx("input",{type:"range",min:E,max:M,step:k,value:m,onChange:D})]}):t.jsx("p",{className:"image-cropper__zoom image-cropper__zoom--disabled",children:"Zoom unavailable for this image"})]})}const m1=async(e,n,s={})=>{if(!e||!n)return e;const{offset:i,scale:l,containerSize:o,naturalWidth:d,naturalHeight:m}=n;if(!i||!l||!o||!d||!m||typeof createImageBitmap!="function")return e;try{const p=await createImageBitmap(e),h=d?p.width/d:1,y=m?p.height/m:1,g=(h+y)/2||1,x=l*g,v=o/x,S=o/x,N=(0-i.x)/l*g,E=(0-i.y)/l*g,j=Math.min(Math.max(v,1),p.width),A=Math.min(Math.max(S,1),p.height),T=p.width-j,_=p.height-A,M=Math.min(Math.max(N,0),Math.max(T,0)),k=Math.min(Math.max(E,0),Math.max(_,0)),C=document.createElement("canvas");C.width=Math.round(j),C.height=Math.round(A),C.getContext("2d").drawImage(p,M,k,j,A,0,0,C.width,C.height),p.close?.();const z=s.mimeType||e.type||"image/jpeg",G=s.quality||(z==="image/png"?void 0:.92),U=await new Promise((V,R)=>{C.toBlob(B=>{B?V(B):R(new Error("Unable to crop image"))},z,G)}),X=(()=>{if(!e.name)return"cropped-image";const V=z==="image/png"?".png":".jpg";return e.name.toLowerCase().endsWith(V)?e.name:`${e.name.includes(".")?e.name.slice(0,e.name.lastIndexOf(".")):e.name}${V}`})();return new File([U],X,{type:z})}catch(p){return console.warn(" Unable to crop image, using original selection",p),e}},xL=[{value:"hidden",label:"Hidden"},{value:"partial",label:"Partial"},{value:"visible",label:"Visible"}],vL=new Set(["image/png","image/jpeg","image/jpg"]),SL=2*1024*1024,wL=new Set(["global","selective","hidden"]),NL=new Set(["global","selective","hidden","owner_only"]),cd=()=>({campaigns:[],users:[],characters:[]}),fp=(e="")=>{const n=String(e||"").trim();return n?{readMode:"selective",readCampaigns:[n],readUsers:[],readCharacters:[],writeMode:"selective",writeCampaigns:[n],writeUsers:[]}:{readMode:"global",readCampaigns:[],readUsers:[],readCharacters:[],writeMode:"global",writeCampaigns:[],writeUsers:[]}},jL=e=>Number.isFinite(e)?e>=1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:e>=1024?`${(e/1024).toFixed(1)} KB`:`${e} bytes`:"",EL=e=>{const n=e?.options?.choices;return!Array.isArray(n)||n.length===0?[]:n.map((s,i)=>{if(s==null)return null;if(typeof s=="object"){const o=s.value??s.id??s.key??s.slug??`choice-${i}`,d=s.label??s.name??s.title??s.display??o;return o==null?null:{value:o,label:String(d??o)}}const l=String(s);return{value:l,label:l}}).filter(Boolean)},_L=e=>{if(!e)return"";if(e instanceof Date)return e.toISOString().slice(0,10);if(typeof e=="string"){const s=e.trim();if(!s)return"";if(/^\d{4}-\d{2}-\d{2}/.test(s))return s.slice(0,10);const i=new Date(s);return Number.isNaN(i.getTime())?"":i.toISOString().slice(0,10)}const n=new Date(e);return Number.isNaN(n.getTime())?"":n.toISOString().slice(0,10)},CL=(e,n)=>{if(e==null)return"";switch(n?.dataType||n?.data_type){case"boolean":{if(typeof e=="boolean")return e?"true":"false";if(typeof e=="number")return e!==0?"true":"false";if(typeof e=="string"){const i=e.trim().toLowerCase();if(i==="true"||i==="false")return i}return""}case"number":return e===""?"":String(e);case"date":return _L(e);case"entity_reference":case"location_reference":case"reference":{if(typeof e=="object"&&e!==null){const i=e.id??e.value??e.entity_id??e.entityId??null;if(i!=null)return String(i)}return String(e)}default:return String(e)}},AL=(e,n)=>{const s=n?.dataType||n?.data_type;if(e!=null){if(typeof e=="string"){const i=e.trim();if(s!=="boolean"&&i==="")return"";e=i}switch(s){case"number":{if(e==="")return"";const i=Number(e);return Number.isNaN(i)?e:i}case"boolean":{if(typeof e=="boolean")return e;if(typeof e=="number")return e!==0;if(typeof e=="string"){const i=e.toLowerCase();if(i==="true")return!0;if(i==="false")return!1}return e}case"reference":return typeof e=="string"?e.trim():e;default:return e}}},kS="entity-form-advanced-open",TL=e=>{if(e==null)return"";if(typeof e=="object")try{return JSON.stringify(e)}catch{return""}return String(e)},ML=e=>{const n=e.trim();if(n.length===0)return"";if(n==="true")return!0;if(n==="false")return!1;const s=n[0],i=n[n.length-1];if(s==="{"&&i==="}"||s==="["&&i==="]")try{return JSON.parse(n)}catch{return e}return e};function h1({worldId:e,entityId:n,onCancel:s,onSaved:i,formId:l="entity-form",onStateChange:o,hideActions:d=!1,selectedEntityTypeId:m="",activeView:p="details",onViewChange:h,defaultCampaignId:y=""}){const g=!!n,x=u.useRef(0),v=u.useRef(null),S=u.useRef(null),N=u.useRef(null),E=u.useRef(String(y??"")),j=u.useCallback((oe="",at="")=>(x.current+=1,{id:x.current,key:oe,value:at}),[x]),[A,T]=u.useState([]),[_,M]=u.useState(!1),[k,C]=u.useState(!1),[D,z]=u.useState(!1),[G,U]=u.useState(!1),[X,V]=u.useState(""),[R,B]=u.useState({name:"",description:"",entityTypeId:m||"",visibility:"visible"}),[L,O]=u.useState(()=>(x.current=0,[j()])),[$,F]=u.useState([]),[H,I]=u.useState({}),[Y,P]=u.useState({}),[K,re]=u.useState(()=>fp(y)),[W,ue]=u.useState(()=>cd()),[Q,ye]=u.useState(!1),[ae,ke]=u.useState(""),pe=u.useRef(!1),[we,ne]=u.useState(null),[Le,be]=u.useState(null),[Oe,Me]=u.useState(null),[ut,ht]=u.useState(""),[_t,jt]=u.useState(""),[ve,tt]=u.useState(!1),[st,$e]=u.useState(!1),[Ye,mt]=u.useState(()=>{if(typeof window>"u")return!1;try{return window.sessionStorage?.getItem(kS)==="true"}catch(oe){return console.warn(" Unable to read advanced options preference",oe),!1}}),ie=u.useMemo(()=>L.some(oe=>oe.key.trim()!==""||oe.value.trim()!==""),[L]),J=u.useCallback(oe=>{if(oe&&typeof URL<"u")try{URL.revokeObjectURL(oe)}catch(at){console.warn("Unable to revoke preview URL",at)}},[]),le=u.useCallback(()=>{be(null),Me(null),jt(""),ht(oe=>(J(oe),"")),S.current&&(S.current.value=""),N.current&&(N.current.value="")},[J]);u.useEffect(()=>()=>{J(ut)},[J,ut]);const fe=u.useCallback(oe=>{const at=oe.target.files?.[0];if(at){if(!vL.has(at.type)){jt("Only PNG or JPG images are allowed."),oe.target.value="";return}if(at.size>SL){jt("Image must be smaller than 2 MB."),oe.target.value="";return}jt(""),be(at),Me(null),ht(dt=>(J(dt),URL.createObjectURL(at)))}},[J]),Ue=u.useCallback(()=>{!n||ve||st||k||S.current?.click()},[n,st,ve,k]),qe=u.useCallback(oe=>{if(!oe){ne(null);return}const at=oe.imageData??oe.image_data??null,dt=oe.imageMimeType??oe.image_mime_type??null;ne(at&&dt?{imageData:at,imageMimeType:dt}:null)},[]),ze=u.useCallback(async()=>{if(!n)return null;const oe=await Us(n),at=Ya(oe);return at&&qe(at),at},[qe,n]),Ce=u.useCallback(async()=>{if(!(!n||!Le)){tt(!0),jt("");try{const oe=Oe?await m1(Le,Oe):Le;await Mj(n,oe),await ze(),le()}catch(oe){jt(oe.message||"Failed to upload image")}finally{tt(!1)}}},[n,Le,Oe,ze,le]),pt=u.useCallback(async()=>{if(!(!n||ve||st)){jt(""),$e(!0);try{await kj(n),await ze(),le()}catch(oe){jt(oe.message||"Failed to remove image")}finally{$e(!1)}}},[n,st,ve,ze,le]),bt=u.useMemo(()=>{const oe="PNG or JPG up to 2 MB.";return Le?`${oe} Selected: ${Le.name} (${jL(Le.size)})`:oe},[Le]),Ct=Le?t.jsxs("div",{className:"entity-image-actions",children:[t.jsx("button",{type:"button",className:"btn submit",onClick:Ce,disabled:ve,children:ve?"Uploading":"Save Image"}),t.jsx("button",{type:"button",className:"btn secondary",onClick:le,disabled:ve,children:"Cancel"})]}):null,Ze=u.useCallback(oe=>oe.length>0?oe:[j()],[j]),ot=u.useCallback(oe=>{if(x.current=0,!oe||typeof oe!="object"||Array.isArray(oe))return[j()];const at=Object.entries(oe);return at.length===0?[j()]:at.map(([dt,xt])=>j(dt,TL(xt)))},[j]);u.useEffect(()=>{let oe=!1;return(async()=>{if(oe||V(""),!e){T([]),M(!1);return}M(!0);try{const dt=await br({worldId:e}),xt=Array.isArray(dt)?dt:Array.isArray(dt?.data)?dt.data:[];if(!oe){const de=xt.map(it=>{const nt=it?.id||it?.entity_type_id||it?.entityTypeId||"";return nt?{id:nt,name:it?.name||it?.label||it?.title||"Untitled"}:null}).filter(Boolean);T(de)}}catch(dt){oe||(V(dt.message||"Failed to load entity types"),T([]))}finally{oe||M(!1)}})(),()=>{oe=!0}},[e]),u.useEffect(()=>{if(!e){B(oe=>({...oe,entityTypeId:""}));return}B(oe=>!oe.entityTypeId||A.some(dt=>dt.id===oe.entityTypeId)?oe:{...oe,entityTypeId:""})},[e,A]),u.useEffect(()=>{let oe=!1;const at=()=>{x.current=0,B({name:"",description:"",entityTypeId:m||"",visibility:"visible"}),O([j()]),F([]),I({}),V(""),h?.("details");const xt=fp(E.current);re(xt),pe.current=!1,ue(cd()),ke(""),ne(null),le()};if(!g)return at(),C(!1),v.current=null,()=>{};const dt=async()=>{C(!0),V(""),jt("");try{const xt=await Us(n),de=Ya(xt);if(!de)throw new Error("Entity not found");if(!oe){const it=ot(de.metadata);B({name:de.name||"",description:de.description||"",entityTypeId:de.entity_type_id||de.entityType?.id||"",visibility:de.visibility||"visible"}),O(Ze(it)),qe(de),le()}}catch(xt){oe||V(xt.message||"Failed to load entity")}finally{oe||C(!1)}};return v.current!==n&&(ne(null),le(),v.current=n),dt(),()=>{oe=!0}},[n,g,Ze,j,ot,m,h,qe,le]);const Tt=oe=>at=>{const{value:dt}=at.target;B(xt=>({...xt,[oe]:dt}))},$t=(oe,at)=>dt=>{const{value:xt}=dt.target;O(de=>de.map(it=>it.id===oe?{...it,[at]:xt}:it))},Qt=()=>{O(oe=>[...oe,j()])},At=oe=>{O(at=>Ze(at.filter(dt=>dt.id!==oe)))},kt=oe=>at=>{const{value:dt}=at.target;I(xt=>({...xt,[oe]:dt}))},qt=u.useCallback((oe,at)=>{ke(""),re(dt=>{const xt={...dt};if(oe==="readMode"||oe==="writeMode"){const de=typeof at=="string"?at.trim().toLowerCase():"global";return oe==="readMode"?(xt.readMode=wL.has(de)?de:"global",xt.readMode!=="selective"&&(xt.readCampaigns=[],xt.readUsers=[],xt.readCharacters=[])):(xt.writeMode=NL.has(de)?de:"global",xt.writeMode!=="selective"&&(xt.writeCampaigns=[],xt.writeUsers=[])),xt}return["readCampaigns","readUsers","readCharacters","writeCampaigns","writeUsers"].includes(oe)?(xt[oe]=Array.isArray(at)?at.map(de=>String(de).trim()).filter(Boolean):[],xt):(xt[oe]=at,xt)})},[]);u.useEffect(()=>{pe.current=!1,ue(cd()),ke("")},[e]),u.useEffect(()=>{if(g)return;const oe=String(y??"");if(oe===E.current)return;const at=fp(oe);E.current=oe,re(at)},[y,g]),u.useEffect(()=>{if(p!=="access"||!e||pe.current)return;let oe=!1;return ye(!0),ke(""),(async()=>{try{const dt=await Dg(e);if(oe)return;ue({campaigns:dt.campaigns??[],users:dt.users??[],characters:dt.characters??[]}),pe.current=!0}catch(dt){if(oe)return;ue(cd()),ke(dt.message||"Failed to load access options"),pe.current=!1}finally{oe||ye(!1)}})(),()=>{oe=!0}},[p,e]);const Lt=u.useCallback(()=>{mt(oe=>{const at=!oe;try{typeof window<"u"&&window.sessionStorage?.setItem(kS,at?"true":"false")}catch(dt){console.warn(" Unable to persist advanced options preference",dt)}return at})},[]),ce=async oe=>{if(oe.preventDefault(),!e&&!g){V("A world must be selected before creating an entity.");return}const at=R.name.trim();if(!at){V("Name is required.");return}const dt=R.entityTypeId||m||"";if(!dt){V("Entity type is required.");return}const xt=g&&R.visibility||"visible";if(g&&!xL.some(vt=>vt.value===xt)){V("Invalid visibility selected.");return}let de={};if(g)L.forEach(({key:vt,value:lt})=>{const wt=vt.trim();wt&&(de[wt]=ML(lt))});else if($.length>0){const vt={};for(const lt of $){const wt=lt.name,He=H[wt],Je=He!=null&&(typeof He!="string"||He.trim()!=="");if(lt.required&&!Je){const St=lt.label||lt.name;V(`${St} is required.`);return}Je&&(vt[wt]=AL(He,lt))}de=vt}const it=R.description?R.description.trim():"",nt={name:at,description:it,visibility:xt,metadata:de,entity_type_id:dt};try{if(U(!0),V(""),g)await mg(n,nt);else{const vt={read_access:K.readMode,write_access:K.writeMode,read_campaign_ids:K.readMode==="selective"?K.readCampaigns:[],read_user_ids:K.readMode==="selective"?K.readUsers:[],read_character_ids:K.readMode==="selective"?K.readCharacters:[],write_campaign_ids:K.writeMode==="selective"?K.writeCampaigns:[],write_user_ids:K.writeMode==="selective"?K.writeUsers:[]};await fg({...nt,...vt,world_id:e})}i?.(g?"edit":"create")}catch(vt){V(vt.message||"Failed to save entity")}finally{U(!1)}},Ae=_||k||D,Te=!g,Ke=Te&&p==="access";u.useEffect(()=>{if(h){if(!Te&&p!=="details"){h("details");return}Ke&&!e&&h("details")}},[p,Te,Ke,h,e]),u.useEffect(()=>{if(!o)return;o({mode:g?"edit":"create",saving:G,isBusy:Ae,submitLabel:G?"Saving...":g?"Save Changes":"Create Entity",submitDisabled:G||Ae,cancelDisabled:G,accessButtonVisible:Te,accessButtonDisabled:G||Ae||!e&&!Ke})},[o,g,G,Ae,Te,Ke,e]),u.useEffect(()=>{g||B(oe=>({...oe,entityTypeId:m||""}))},[g,m]);const Se=u.useMemo(()=>g?"":R.entityTypeId?R.entityTypeId:m||"",[g,m,R.entityTypeId]);u.useEffect(()=>{if(g){F([]),I({}),P({});return}if(!Se){F([]),I({}),P({});return}let oe=!1;return(async()=>{z(!0);try{const dt=await d1(Se),xt=Array.isArray(dt)?dt:Array.isArray(dt?.data)?dt.data:[];if(oe)return;const de=xt.map(nt=>{if(!nt)return null;const vt=nt.name||nt.field_name;if(!vt)return null;const lt=nt.data_type||nt.dataType||"text",wt=nt.reference_type_id??nt.referenceTypeId??nt.referenceType?.id??null,He=nt.reference_type_name??nt.referenceTypeName??nt.referenceType?.name??"",Je=nt.reference_filter??nt.referenceFilter??nt.referenceFilterJson??{};return{id:nt.id||vt,name:vt,label:nt.label||nt.name||vt,dataType:lt,required:!!nt.required,options:nt.options||{},defaultValue:nt.default_value??nt.defaultValue??null,referenceTypeId:wt,referenceTypeName:He,referenceFilter:Je}}).filter(Boolean);F(de),P({});const it={};de.forEach(nt=>{const vt=nt.defaultValue;vt!=null&&vt!==""?it[nt.name]=CL(vt,nt):it[nt.name]=""}),I(it)}catch(dt){oe||(V(dt.message||"Failed to load metadata fields"),F([]),I({}),P({}))}finally{oe||z(!1)}})(),()=>{oe=!0}},[Se,g]);const Be=u.useMemo(()=>{const oe=R.entityTypeId||m||"";return oe&&A.find(at=>at.id===oe)||null},[A,R.entityTypeId,m]),We=oe=>{const at=`metadata-field-${oe.id}`,dt=H[oe.name]??"",xt=!!oe.required;switch(oe.dataType){case"boolean":return t.jsxs("select",{id:at,value:dt,onChange:kt(oe.name),disabled:G||D,required:xt,children:[t.jsx("option",{value:"",children:"Select..."}),t.jsx("option",{value:"true",children:"True"}),t.jsx("option",{value:"false",children:"False"})]});case"enum":{const de=EL(oe);return t.jsxs("select",{id:at,value:dt,onChange:kt(oe.name),disabled:G||D,required:xt,children:[t.jsx("option",{value:"",children:"Select..."}),de.map(it=>t.jsx("option",{value:it.value,children:it.label},it.value))]})}case"entity_reference":case"location_reference":case"reference":{const de=oe.referenceTypeId??oe.reference_type_id??null,it=de?String(de).trim():null,nt=oe.dataType==="location_reference";oe.dataType;const vt=oe.referenceTypeName||(nt?"locations":"entities"),lt=typeof vt=="string"&&vt.trim()?vt.trim():nt?"locations":"entities",wt=Array.isArray(oe.options?.choices)?oe.options.choices.map((Ft,zt)=>{if(Ft==null)return null;if(typeof Ft=="object"){const Bn=Ft.value??Ft.id??Ft.key??Ft.slug??`choice-${zt}`;if(Bn==null)return null;const yn=Ft.label??Ft.name??Ft.title??Ft.display??Ft.displayName??Bn;return{value:String(Bn),label:String(yn)}}const dn=String(Ft);return{value:dn,label:dn}}).filter(Boolean):[],He=wt.length>0,Je=!!(e&&(it||nt)),St=G||D||!He&&!Je,ee=Y[oe.name]||"",xe=!ee&&dt&&wt.find(Ft=>String(Ft.value)===String(dt))?.label||"",Ie=dt&&(ee||xe)?{id:dt,name:ee||xe}:dt,et=dt?String(dt):"",Nt=Y[oe.name]||xe||lt,Rt=Ft=>{if(!Ft){I(yn=>({...yn,[oe.name]:""})),P(yn=>{if(!yn[oe.name])return yn;const ja={...yn};return delete ja[oe.name],ja});return}const zt=Ft.id??Ft.value??Ft.key??Ft.slug??Ft.uuid??null;if(zt==null){I(yn=>({...yn,[oe.name]:""}));return}const dn=String(zt),Bn=Ft.name??Ft.label??Ft.title??Ft.display??Ft.displayName??"";I(yn=>({...yn,[oe.name]:dn})),P(yn=>({...yn,[oe.name]:Bn||dn}))},nn=Ft=>{if(!Ft){P(yn=>{if(!yn[oe.name])return yn;const ja={...yn};return delete ja[oe.name],ja});return}const zt=Ft.id??Ft.value??Ft.key??Ft.slug??Ft.uuid??null;if(zt==null)return;const dn=String(zt),Bn=Ft.name??Ft.label??Ft.title??Ft.display??Ft.displayName??"";P(yn=>yn[oe.name]===(Bn||dn)?yn:{...yn,[oe.name]:Bn||dn})},Pt=nt?e1:Cc;return t.jsxs("div",{className:"reference-field-control",children:[t.jsxs("div",{className:"reference-field-input-row",children:[t.jsx(Pt,{worldId:e,value:Ie,allowedTypeIds:it&&it.length>0?[it]:[],placeholder:`Search ${lt.toLowerCase()}...`,disabled:St,staticOptions:wt,onChange:Rt,onResolved:nn,required:xt,minSearchLength:nt&&!it?0:void 0}),et&&t.jsx(Na,{entityId:et,entityName:Nt,className:"reference-field-info-btn"})]}),!it&&!nt&&t.jsx("p",{className:"field-hint warning",children:"Reference type configuration is missing."}),!e&&Je&&t.jsxs("p",{className:"field-hint warning",children:["Select a world to search for ",nt?"locations":"entities","."]})]})}case"number":return t.jsx("input",{id:at,type:"number",value:dt,onChange:kt(oe.name),disabled:G||D,required:xt});case"text":return t.jsx("textarea",{id:at,value:dt,onChange:kt(oe.name),disabled:G||D,rows:4,required:xt});case"date":return t.jsx("input",{id:at,type:"date",value:dt,onChange:kt(oe.name),disabled:G||D,required:xt});default:return t.jsx("input",{id:at,type:"text",value:dt,onChange:kt(oe.name),disabled:G||D,required:xt})}},se=!g&&!!m,Z=!g&&$.length>0,Ee=()=>t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"entity-type",children:"Type *"}),se?t.jsx("input",{id:"entity-type",type:"text",value:Be?.name||"",readOnly:!0,disabled:!0}):t.jsxs("select",{id:"entity-type",value:R.entityTypeId,onChange:Tt("entityTypeId"),disabled:G||_,required:!0,children:[t.jsx("option",{value:"",children:"Select type..."}),A.map(oe=>t.jsx("option",{value:oe.id,children:oe.name},oe.id))]})]}),_e=ut||Ql(we),ge=R.name?`${R.name} artwork`:"Entity artwork",Pe=()=>t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"entity-name",children:"Name *"}),t.jsx("input",{id:"entity-name",type:"text",value:R.name,onChange:Tt("name"),placeholder:"e.g. Waterdeep",disabled:G,required:!0,"data-autofocus":!0})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"entity-description",children:"Description"}),t.jsx("textarea",{id:"entity-description",value:R.description,onChange:Tt("description"),placeholder:"Optional summary of the entity",rows:4,disabled:G})]})]});return t.jsxs("form",{id:l,className:"entity-form",onSubmit:ce,children:[Ae?t.jsx("div",{className:"form-loading",children:"Loading..."}):t.jsx(t.Fragment,{children:Ke?t.jsxs("section",{className:"entity-card entity-access-card drawer-access-card",children:[t.jsx("h3",{className:"entity-card-title",children:"Manage access"}),t.jsx("p",{className:"entity-access-note help-text",children:"Configure who can view and edit this entity. Users with write access will automatically receive read access."}),ae&&t.jsx("div",{className:"alert error",role:"alert",children:ae}),e?t.jsx(Ig,{canEdit:!G,accessSettings:K,accessOptions:W,accessOptionsLoading:Q,accessSaving:G,onSettingChange:qt,idPrefix:"entity-create-access"}):t.jsx("p",{className:"entity-empty-state",children:"Assign this entity to a world to configure access settings."})]}):t.jsxs(t.Fragment,{children:[g&&we?t.jsxs("div",{className:"entity-form-image-wrapper",children:[t.jsxs("div",{className:"entity-form-image-panel","aria-live":"polite",children:[t.jsx("div",{className:`entity-image-preview ${_e?"has-image":""}`.trim(),children:_e?t.jsx("img",{src:_e,alt:ge,loading:"lazy"}):t.jsx("div",{className:"entity-image-placeholder",children:t.jsx("p",{children:"No image"})})}),t.jsxs("div",{className:"entity-form-image-panel-actions",children:[t.jsx("button",{type:"button",className:"btn secondary",onClick:Ue,disabled:!n||ve||st||k,children:ve?"Uploading":"Replace Image"}),t.jsx("button",{type:"button",className:"btn secondary",onClick:pt,disabled:!n||st||ve,children:st?"Removing":"Remove Image"})]}),Ct,t.jsx("input",{type:"file",ref:S,accept:"image/png,image/jpeg",onChange:fe,hidden:!0,disabled:!n||ve||st}),t.jsx("p",{className:"entity-image-helper",children:bt}),_t?t.jsx("p",{className:"entity-image-status entity-image-status--error",children:_t}):null,!_t&&ve?t.jsx("p",{className:"entity-image-status",children:"Uploading image"}):null,!_t&&st?t.jsx("p",{className:"entity-image-status",children:"Removing image"}):null]}),t.jsx("div",{className:"entity-form-image-fields",children:Pe()})]}):Pe(),!g&&Ee(),g&&!we?t.jsxs("div",{className:"form-group entity-form-upload-section",children:[t.jsx("label",{htmlFor:"entity-image-upload",children:"Upload image"}),t.jsx("input",{id:"entity-image-upload",type:"file",accept:"image/png,image/jpeg",ref:N,onChange:fe,disabled:!n||ve||st}),Le&&ut?t.jsx("div",{className:"entity-form-upload-preview",children:t.jsx(f1,{src:ut,size:220,zoomLabel:"Zoom to crop",onCropChange:Me})}):null,Ct,t.jsx("p",{className:"entity-image-helper",children:bt}),_t?t.jsx("p",{className:"entity-image-status entity-image-status--error",children:_t}):null,!_t&&ve?t.jsx("p",{className:"entity-image-status",children:"Uploading image"}):null,!_t&&st?t.jsx("p",{className:"entity-image-status",children:"Removing image"}):null]}):null,Z&&t.jsxs("div",{className:"metadata-field-section",children:[t.jsx("h3",{children:"Information"}),$.map(oe=>t.jsxs("div",{className:"form-group",children:[t.jsxs("label",{htmlFor:`metadata-field-${oe.id}`,children:[oe.label,oe.required?" *":""]}),We(oe)]},oe.id))]}),Te&&!e&&t.jsx("p",{className:"help-text",children:"Assign a world to configure access controls."}),g&&t.jsx("div",{className:"form-two-column",children:Ee()}),g&&t.jsxs("div",{className:"advanced-options",children:[t.jsxs("button",{type:"button",className:"advanced-options-toggle",onClick:Lt,"aria-expanded":Ye,children:[t.jsx("span",{children:"Advanced options"}),ie?t.jsx("span",{className:"advanced-indicator",children:"Metadata added"}):null,t.jsx("span",{className:"advanced-chevron","aria-hidden":"true",children:Ye?"":""})]}),Ye&&t.jsx("div",{className:"advanced-options-body",children:t.jsxs("div",{className:"metadata-editor",children:[t.jsxs("div",{className:"metadata-header",children:[t.jsxs("h3",{children:["Metadata ",ie?"":"(optional)"]}),t.jsx("button",{type:"button",className:"btn neutral",onClick:Qt,disabled:G,children:"Add field"})]}),t.jsx("div",{className:"metadata-list",children:L.map((oe,at)=>t.jsxs("div",{className:"metadata-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsxs("label",{htmlFor:`metadata-key-${oe.id}`,className:"sr-only",children:["Metadata key ",at+1]}),t.jsx("input",{id:`metadata-key-${oe.id}`,type:"text",placeholder:"Key",value:oe.key,onChange:$t(oe.id,"key"),disabled:G})]}),t.jsxs("div",{className:"form-group",children:[t.jsxs("label",{htmlFor:`metadata-value-${oe.id}`,className:"sr-only",children:["Metadata value ",at+1]}),t.jsx("input",{id:`metadata-value-${oe.id}`,type:"text",placeholder:"Value",value:oe.value,onChange:$t(oe.id,"value"),disabled:G})]}),t.jsx("div",{className:"metadata-actions",children:t.jsx("button",{type:"button",className:"icon-btn",onClick:()=>At(oe.id),disabled:G||L.length===1,title:"Remove field",children:""})})]},oe.id))})]})})]})]})}),X&&t.jsx("div",{className:"form-error",role:"alert",children:X}),!d&&t.jsxs("div",{className:"form-actions",children:[t.jsx("button",{type:"button",className:"btn cancel",onClick:s,disabled:G,children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn submit",disabled:G||Ae,children:G?"Saving...":g?"Save Changes":"Create Entity"})]})]})}const kL={critical:"",important:"",medium:""};function Ny({importance:e,className:n="entity-importance-indicator"}){const{selectedCampaignId:s}=jn();if(!s||!e)return null;const i=kL[e]||"",l=e.charAt(0).toUpperCase()+e.slice(1);return t.jsx("span",{className:n,title:`Importance: ${l}`,children:i})}const RL={visible:"badge-visible",partial:"badge-partial",hidden:"badge-hidden"},IL=new Set(["system_admin"]),RS="entityType",rs=["name","type","visibility","createdAt"],ud=[{key:"name",label:"Name",type:"core"},{key:"type",label:"Type",type:"core"},{key:"importance",label:"Importance",type:"core"},{key:"visibility",label:"Visibility",type:"core"},{key:"createdAt",label:"Created",type:"core"},{key:"description",label:"Description",type:"core"}],mp="user",IS="system",El=(e="create")=>({mode:e,submitLabel:e==="edit"?"Save Changes":"Create Entity",submitDisabled:!1,cancelDisabled:!1,accessButtonVisible:!1,accessButtonDisabled:!1}),hp=(e=[],n=[])=>e.length!==n.length?!1:e.every((s,i)=>s===n[i]),pp=(e,n,s)=>{const i=new Set(s),l=[];if(Array.isArray(e)&&e.forEach(d=>{if(typeof d!="string")return;const m=d.trim();!m||!i.has(m)||l.includes(m)||l.push(m)}),l.length>0)return l;const o=Array.isArray(n)?n.filter(d=>typeof d=="string"&&i.has(d)):[];return o.length>0?[...o]:i.size>0?[i.values().next().value]:[]},DL=e=>{if(!e||typeof e!="object")return"";const n=e.displayValue??e.display??e.label??e.displayName??e.text??e.name??e.title??e.value??e.id??null;return n!=null?String(n).trim():""},Lg=e=>!e||typeof e!="object"?!1:Array.isArray(e)?e.some(n=>Lg(n)):Object.prototype.hasOwnProperty.call(e,"displayValue")||Object.prototype.hasOwnProperty.call(e,"display")||Object.prototype.hasOwnProperty.call(e,"label"),p1=e=>{if(e==null)return"";if(Array.isArray(e)){const n=e.map(s=>p1(s)).filter(s=>!!s);return n.length?n.join(", "):""}return typeof e=="object"?DL(e):String(e).trim()},yp=(e,n=null)=>{if(e==null)return"";const s=n?.dataType||n?.data_type||"";if(s==="reference"||Lg(e))return p1(e)||"";if(typeof e=="boolean")return e?"Yes":"No";if(typeof e=="number")return Number.isFinite(e)?String(e):"";if(s==="number"){const o=Number(e);return Number.isFinite(o)?String(o):""}if(e instanceof Date)return e.toLocaleDateString();if(s==="date"||typeof e=="string"&&s==="text"){const o=new Date(e);if(!Number.isNaN(o.getTime()))return o.toLocaleDateString()}if(Array.isArray(e))return e.length===0?"":e.filter(o=>o!=null&&String(o).trim()!=="").map(o=>typeof o=="string"?o.trim():String(o)).join(", ");if(typeof e=="object")try{return JSON.stringify(e)}catch(o){return console.warn(" Failed to stringify metadata value",o),""}return String(e).trim()||""};function LL(){const{user:e,token:n,sessionReady:s}=un(),{selectedCampaign:i,selectedCampaignId:l,activeWorld:o,activeWorldId:d,selectedContextType:m,viewAsCharacterId:p,contextKey:h}=jn(),[y,g]=aj(),x=Wl(),[v,S]=u.useState([]),[N,E]=u.useState(!1),[j,A]=u.useState(""),[T,_]=u.useState(!1),[M,k]=u.useState(null),[C,D]=u.useState(""),[z,G]=u.useState(""),[U,X]=u.useState(null),[V,R]=u.useState(null),[B,L]=u.useState(!1),[O,$]=u.useState(""),[F,H]=u.useState(null),[I,Y]=u.useState(null),[P,K]=u.useState(()=>[...rs]),[re,W]=u.useState(()=>[...rs]),[ue,Q]=u.useState(!1),[ye,ae]=u.useState(""),[ke,pe]=u.useState(""),[we,ne]=u.useState(""),[Le,be]=u.useState(""),[Oe,Me]=u.useState(()=>El("create")),[ut,ht]=u.useState("details"),[_t,jt]=u.useState(!1),[ve,tt]=u.useState({open:!1,columnKey:"",columnLabel:"",x:0,y:0}),[st,$e]=u.useState(!1),[Ye,mt]=u.useState([]),[ie,J]=u.useState([]),[le,fe]=u.useState(null),[Ue,qe]=u.useState(!1),ze=y.toString(),Ce=d||"",pt=!!Ce,bt=y.get(RS)??"",Ct=!!bt,Ze=y.get("parentEntity")??"",ot=!!Ze,Tt=u.useRef(`entity-form-${Math.random().toString(36).slice(2)}`),$t=u.useRef(`${Ce}:${h}`),Qt=u.useCallback((me,De="info")=>{X({message:me,tone:De})},[]);u.useEffect(()=>{!x||!ue||Q(!1)},[x,ue]),u.useEffect(()=>{Oe.accessButtonVisible||ut!=="details"&&ht("details")},[Oe.accessButtonVisible,ut]),u.useEffect(()=>{if(!ve.open)return;const me=()=>tt({open:!1,columnKey:"",columnLabel:"",x:0,y:0});return window.addEventListener("click",me),window.addEventListener("contextmenu",me),()=>{window.removeEventListener("click",me),window.removeEventListener("contextmenu",me)}},[ve.open]),u.useEffect(()=>{if(!U)return;const me=setTimeout(()=>X(null),3500);return()=>clearTimeout(me)},[U]);const At=u.useCallback(me=>{if(!me)return"";const De=new Date(me);return Number.isNaN(De.getTime())?"":De.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},[]),kt=u.useMemo(()=>!i||!e?"":i.members?.find(De=>De.user_id===e.id)?.role||"",[i,e]),qt=u.useMemo(()=>{if(!o||!e?.id)return!1;const me=o.created_by||o.creator?.id||o.owner_id||o.owner?.id||"";return me?String(me)===String(e.id):!1},[o,e?.id]),Lt=u.useMemo(()=>e?IL.has(e.role)?!0:Ce?m==="world"?qt:!!(i&&(kt==="dm"||qt)):!1:!1,[e,Ce,m,i,kt,qt]),ce=o?.entity_creation_scope??"",Ae=u.useMemo(()=>!l||!i||!e||ce!==Ul.ALL_PLAYERS?!1:kt==="player",[l,i,e,ce,kt]),Te=Lt||Ae,Ke=e?.role==="system_admin",Se=u.useCallback(async(me,De={})=>{if(!n)return S([]),[];const{useUnassigned:Ot=!1,viewAsCharacterId:Zt=""}=De;if(Ot){if(!Ke)return S([]),A("Only system administrators can view unassigned entities"),[];E(!0),A("");try{const Ne=await VR(),ct=Array.isArray(Ne)?Ne:Array.isArray(Ne?.data)?Ne.data:[];return S(ct),ct}catch(Ne){return console.error(" Failed to load unassigned entities",Ne),A(Ne.message||"Failed to load unassigned entities"),S([]),[]}finally{E(!1)}}const he=me??Ce;if(!he)return S([]),[];E(!0),A("");try{const Ne=await _c(he,{viewAsCharacterId:Zt,importance:Ye.length>0?Ye:void 0}),ct=Array.isArray(Ne)?Ne:Array.isArray(Ne?.data)?Ne.data:[];return S(ct),ct}catch(Ne){return console.error(" Failed to load entities",Ne),A(Ne.message||"Failed to load entities"),S([]),[]}finally{E(!1)}},[n,Ce,Ke,h]);u.useEffect(()=>{if(!n){S([]);return}if(st){Se(null,{useUnassigned:!0});return}if(!Ce){S([]);return}Se(Ce,{viewAsCharacterId:p})},[Ce,n,st,Se,h,p,Ye]),u.useEffect(()=>{if(st){$t.current=`${Ce}:${h}`;return}const me=`${Ce}:${h}`;$t.current!==me&&(T&&(_(!1),k(null)),D(""),Me(El("create")),A(""),X(null),$t.current=me)},[Ce,h,T,st]),u.useEffect(()=>{!Ke&&st&&$e(!1)},[Ke,st]),u.useEffect(()=>{st&&T&&(_(!1),k(null),D(""),Me(El("create")))},[st,T]),u.useEffect(()=>{if(Q(!1),ae(""),!bt||!n||!s){R(null),$(""),H(null),Y(null),K([...rs]),W([...rs]),L(!1);return}let me=!1;return(async()=>{L(!0),$("");try{const Ot=await mI(bt);if(me)return;const Zt=Ot?.data??Ot??{},he=Zt.data??Zt,Ne=Array.isArray(he.coreColumns)&&he.coreColumns.length?he.coreColumns:ud,ct=new Map(ud.map(Xt=>[Xt.key,Xt])),It=Ne.map(Xt=>{const Ca=ct.get(Xt.key)??{};return{...Ca,...Xt,type:"core",label:Xt.label||Ca.label||Xt.key}}),Ht=ud.filter(Xt=>!It.some(Ca=>Ca.key===Xt.key)),tn=[...It,...Ht],en=(Array.isArray(he.metadataColumns)?he.metadataColumns:[]).filter(Xt=>typeof Xt?.key=="string").map(Xt=>({key:Xt.key,name:Xt.name||Xt.key.replace(/^metadata\./,""),label:Xt.label||Xt.name||Xt.key.replace(/^metadata\./,""),dataType:Xt.dataType||Xt.data_type||"",required:!!Xt.required,options:Xt.options||Xt.choices||{},referenceTypeId:Xt.referenceTypeId||Xt.reference_type_id||null,referenceTypeName:Xt.referenceTypeName||Xt.reference_type_name||"",referenceFilter:Xt.referenceFilter||Xt.reference_filter||Xt.referenceFilterJson||{}})).sort((Xt,Ca)=>Xt.label.localeCompare(Ca.label,void 0,{sensitivity:"base"})),_n=new Set([...tn.map(Xt=>Xt.key),...en.map(Xt=>Xt.key)]);rs.forEach(Xt=>_n.add(Xt));const qn=pp(rs,rs,_n),oa=he.systemDefault?.columns,_a=Array.isArray(oa)&&oa.length?pp(oa,qn,_n):[...qn],ga=he.userPreference?.columns,As=Array.isArray(ga)&&ga.length>0,$a=As?pp(ga,_a,_n):[],li=As&&$a.length?$a:_a;R({coreColumns:tn,metadataColumns:en}),Y(_a.length?{columns:[..._a],updatedAt:he.systemDefault?.updatedAt??null}:null),H(As&&$a.length?{columns:[...$a],updatedAt:he.userPreference?.updatedAt??null}:null),K([...li]),W([...li])}catch(Ot){if(me)return;console.error(" Failed to load column configuration",Ot),$(Ot.message||"Failed to load column configuration"),R(null),H(null),Y(null),K([...rs]),W([...rs])}finally{me||L(!1)}})(),()=>{me=!0}},[bt,n,s]),u.useEffect(()=>{if(!Ze||!n){J([]),fe(null);return}let me=!1;return qe(!0),(async()=>{try{const Ot=v.find(Ne=>String(Ne.id)===String(Ze));Ot&&fe(Ot);const Zt=await c1(Ze),he=Array.isArray(Zt?.data)?Zt.data:Array.isArray(Zt)?Zt:[];me||J(he)}catch(Ot){console.error("Failed to load parent entity relationships:",Ot),me||J([])}finally{me||qe(!1)}})(),()=>{me=!0}},[Ze,n,v]);const Be=u.useMemo(()=>{let me=v;if(bt&&(me=me.filter(De=>(De.entity_type_id||De.entityType?.id||De.entity_type?.id||"")===bt)),Ye.length>0&&l&&(me=me.filter(De=>{const Ot=De.importance||null;return Ye.includes(Ot)})),Ze&&ie.length>0){const De=new Set,Ot=String(Ze);ie.forEach(Zt=>{const he=String(Zt.from_entity||Zt.fromEntity||Zt.from?.id||""),Ne=String(Zt.to_entity||Zt.toEntity||Zt.to?.id||""),ct=Zt.relationshipType||Zt.relationship_type,It=ct?.name||ct?.label||ct?.from_label||ct?.to_label||"",Ht=Zt.bidirectional===!0,tn=/(parent|owns|contains|has child|has member|supervises|manages)/i.test(It),rn=/(child|belongs to|part of|member of|reports to|works for)/i.test(It);he===Ot&&(tn||!rn&&!tn)?De.add(Ne):Ne===Ot&&(rn||Ht&&tn)?De.add(he):Ht&&(he===Ot?De.add(Ne):Ne===Ot&&De.add(he))}),me=me.filter(Zt=>{const he=String(Zt.id);return De.has(he)})}return me},[v,bt,Ye,l,Ze,ie]),We=u.useMemo(()=>{if(!bt)return"";const me=v.find(De=>(De.entity_type_id||De.entityType?.id||De.entity_type?.id||"")===bt);return me?.entityType?.name||me?.entity_type?.name||""},[v,bt]),se=u.useMemo(()=>{const me=[],De=new Set,Ot=(Ne,ct)=>{if(!Ne||typeof Ne!="object")return;const It=typeof Ne.key=="string"?Ne.key.trim():"";if(!It||De.has(It))return;const Ht=Ne.label||Ne.name||(typeof Ne.title=="string"?Ne.title:""),tn=typeof Ht=="string"&&Ht.trim()?Ht.trim():It;me.push({...Ne,key:It,label:tn,type:Ne.type||ct}),De.add(It)};return(V?.coreColumns??ud).forEach(Ne=>Ot(Ne,"core")),(V?.metadataColumns??[]).forEach(Ne=>Ot(Ne,"metadata")),me},[V]),Z=u.useMemo(()=>{const me=new Map;return se.forEach(De=>{me.set(De.key,{...De,type:De.type==="metadata"?"metadata":"core"})}),me},[se]),Ee=u.useMemo(()=>Array.from(Z.keys()),[Z]),_e=u.useMemo(()=>{const me=rs.filter(De=>Z.has(De));return me.length>0?me:Ee.length>0?[Ee[0]]:[...rs]},[Ee,Z]),ge=u.useMemo(()=>{if(x){const me=[];return Z.has("name")&&me.push("name"),Z.has("description")&&me.push("description"),me.length>0?me:_e.filter(De=>Z.has(De))}return bt?P:rs},[x,Z,_e,bt,P]);u.useEffect(()=>{bt&&K(me=>{const De=me.filter(Ot=>Z.has(Ot));return De.length>0?De:_e})},[bt,Z,_e]),u.useEffect(()=>{W([...P])},[P]);const Pe=u.useMemo(()=>{const me=ge.map(De=>Z.get(De)).filter(Boolean);return me.length>0?me:_e.map(De=>Z.get(De)).filter(Boolean)},[ge,Z,_e]),oe=I?.columns??_e,at=F?.columns??oe,dt=!!bt&&!hp(re,at),xt=!!bt&&!hp(re,oe),de=ke===mp,it=ke===IS,nt=hp(re,oe),vt=()=>{W([...oe]),ae(""),ne(""),be("")},lt=me=>{bt&&W(De=>De.includes(me)?De.length===1?(ae("You must keep at least one column selected."),De):(ae(""),we===me&&(ne(""),be("")),De.filter(Ot=>Ot!==me)):Z.has(me)?(ae(""),[...De,me]):De)},wt=(me,De)=>{bt&&re.includes(me)&&(ne(me),be(""),De?.dataTransfer&&(De.dataTransfer.effectAllowed="move",De.dataTransfer.setData("text/plain",me)))},He=(me,De)=>{!we||we===me||re.includes(me)&&(De&&(De.preventDefault(),De.dataTransfer&&(De.dataTransfer.dropEffect="move")),be(me))},Je=me=>{bt&&(W(De=>{if(!we||we===me)return De;const Ot=De.indexOf(we),Zt=De.indexOf(me);if(Ot===-1||Zt===-1)return De;const he=[...De],[Ne]=he.splice(Ot,1),ct=Ot<Zt?Math.max(Zt-1,0):Zt;return he.splice(ct,0,Ne),he}),be(""),ne(""))},St=()=>{bt&&(W(me=>{if(!we||!me.includes(we))return me;const De=me.filter(Ot=>Ot!==we);return De.push(we),De}),be(""),ne(""))},ee=()=>{be(""),ne("")},xe=()=>{bt&&(ae(""),Q(me=>{const De=!me;return!me&&De&&(W([...P]),ne(""),be("")),me&&!De&&(ne(""),be("")),De}))},Ie=()=>{Q(!1),be(""),ne("")},et=async me=>{if(bt){if(re.length===0){ae("Please select at least one column.");return}pe(me),ae("");try{await hI(bt,{scope:me,columns:re}),me===mp?(H({columns:[...re],updatedAt:new Date().toISOString()}),K([...re]),Ie(),Qt("Column preference saved","success")):(Y({columns:[...re],updatedAt:new Date().toISOString()}),K([...re]),Qt("System default updated","success"))}catch(De){console.error(" Failed to save column selection",De),ae(De.message||"Failed to save column settings")}finally{pe("")}}},Nt=u.useCallback(me=>me?.entityType?.name||me?.entity_type?.name||"",[]),Rt=u.useCallback((me,De)=>{if(!me)return"";switch(De){case"name":return me.name||"";case"type":return Nt(me);case"visibility":return me.visibility||"visible";case"createdAt":return me.createdAt||me.created_at||"";case"description":return me.description||"";default:{if(De.startsWith("metadata.")){const Ot=me.metadata&&typeof me.metadata=="object"?me.metadata:{},Zt=De.replace(/^metadata\./,"");return Ot?.[Zt]}return me[De]}}},[Nt]),nn=u.useCallback(me=>{if(me==null||me==="")return null;if(typeof me=="string"){const De=me.trim();return De.length>0?De:null}if(typeof me=="object"&&!Array.isArray(me)){const De=me.id??me.value??me.key??me.slug??me.uuid??null;return De!=null?String(De).trim():null}if(Array.isArray(me)){for(const De of me){const Ot=nn(De);if(Ot)return Ot}return null}return null},[]),Pt=u.useMemo(()=>{const me=[];return Z.forEach(De=>{const Zt=(De.type==="metadata"?De.dataType||De.data_type||"string":De.dataType)||(De.key==="createdAt"?"date":"string"),he=Zt==="reference"||De.dataType&&String(De.dataType).toLowerCase()==="reference"||De.data_type&&String(De.data_type).toLowerCase()==="reference",Ne=ct=>{const It=Rt(ct,De.key);if(he){const Ht=nn(It);return Ht!==null?Ht:It}return It};me.push({key:De.key,label:De.label||De.name||De.key,dataType:Zt,accessor:Ne})}),me},[Z,Rt,nn]),Ft=u.useMemo(()=>new Map(Pt.map(me=>[me.key,me])),[Pt]),zt=zj(Be,{columns:Pt}),dn=u.useCallback(me=>{const De=zt.groupBy?Z.get(zt.groupBy):null;if(!De)return yp(me);if(De.key==="visibility"){const Ot=typeof me=="string"?me:"";return Ot?Ot.charAt(0).toUpperCase()+Ot.slice(1):"Hidden"}return De.key==="createdAt"?At(me):De.key==="type"?me||"Unassigned":De.key.startsWith("metadata.")?yp(me,De):De.key==="name"||De.key==="description"?me?String(me):"":me?String(me):"Unassigned"},[Z,zt.groupBy,At]),Bn=u.useMemo(()=>Pt.map(me=>{const De=Z.get(me.key),Ot=De?.data_type||De?.dataType||me.dataType,Zt={key:me.key,label:Ft.get(me.key)?.label||me.label||me.key,dataType:me.dataType,originalDataType:Ot};De?.options&&(Zt.options=De.options);const he=De?.referenceTypeId||De?.reference_type_id;he&&(Zt.referenceTypeId=he);const Ne=De?.referenceTypeName||De?.referenceType?.name;Ne&&(Zt.referenceTypeName=Ne);const ct=De?.referenceFilter||De?.reference_filter;return ct&&(Zt.referenceFilter=ct),Zt}),[Pt,Ft,Z]),yn=me=>{me&&zt.toggleSort(me)},ja=(me,De)=>{me.preventDefault(),tt({open:!0,columnKey:De.key,columnLabel:De.label||De.name||De.key,x:me.clientX,y:me.clientY})},ha=me=>{zt.setGroupBy(me),tt({open:!1,columnKey:"",columnLabel:"",x:0,y:0})},Yi=(me,De)=>{const Ot=De.metadata&&typeof De.metadata=="object"?De.metadata:{};switch(me.key){case"name":const Zt=(De.childCount||0)>0,he=Ne=>{Ne.preventDefault(),Ne.stopPropagation();const ct=new URLSearchParams(y);ct.set("parentEntity",De.id),g(ct)};return t.jsxs(t.Fragment,{children:[t.jsx(Yt,{to:`/entities/${De.id}`,state:{fromEntities:{search:ze}},className:"entity-name-link",children:De.name}),Zt&&t.jsxs(t.Fragment,{children:["",t.jsx("button",{type:"button",onClick:he,style:{background:"none",border:"none",padding:0,cursor:"pointer",display:"inline-flex",alignItems:"center",verticalAlign:"middle"},title:"View children","aria-label":"View children",children:t.jsx(Jr,{size:14,style:{color:"#6b7280"}})})]}),De.id?t.jsxs(t.Fragment,{children:["",t.jsx(Na,{entityId:De.id,entityName:De.name||"entity"})]}):null,"",t.jsx(Ny,{importance:De.importance})]});case"type":return Nt(De);case"visibility":{const Ne=De.visibility||"visible",ct=RL[Ne]||"badge-hidden";return t.jsx("span",{className:`visibility-badge ${ct}`,children:Ne.charAt(0).toUpperCase()+Ne.slice(1)})}case"createdAt":return At(De.createdAt||De.created_at);case"description":return De.description?De.description:"";case"importance":{if(!l)return"";const Ne=De.importance;if(!Ne)return"";const ct={critical:"Critical",important:"Important",medium:"Medium"},It={critical:"#dc2626",important:"#ea580c",medium:"#6b7280"};return t.jsx("span",{className:"importance-badge",style:{"--importance-color":It[Ne]},children:ct[Ne]||Ne})}default:{if(me.key.startsWith("metadata.")){const Ne=me.key.replace(/^metadata\./,""),ct=Ot?.[Ne],It=yp(ct,me);if(((me?.dataType||me?.data_type||"")==="reference"||Lg(ct))&&ct!==null&&ct!==void 0){const rn=_g(ct),en=Cg(ct)||It||"entity";if(rn)return t.jsxs(t.Fragment,{children:[It,"",t.jsx(Na,{entityId:rn,entityName:en})]})}return It}return""}}},ta=()=>{_(!1),k(null),D(""),Me(El("create")),ht("details")},hs=async me=>{ta(),st?await Se(null,{useUnassigned:!0}):Ce&&await Se(Ce,{viewAsCharacterId:p}),Qt(me==="create"?"Entity created":"Entity updated","success")},xr=async me=>{if(!(!Lt||!me?.id||!window.confirm(`Delete entity "${me.name}"? This action cannot be undone.`)))try{G(me.id),await KR(me.id),Qt("Entity deleted","success"),st?await Se(null,{useUnassigned:!0}):Ce&&await Se(Ce,{viewAsCharacterId:p})}catch(Ot){console.error(" Failed to delete entity",Ot),Qt(Ot.message||"Failed to delete entity","error")}finally{G("")}},ri=()=>{if(st){Se(null,{useUnassigned:!0});return}Ce&&Se(Ce,{viewAsCharacterId:p})},ps=()=>{!Te||!Ce||st||(k(null),D(""),Me(El("create")),ht("details"),_(!0))},Un=me=>{if(!Lt||!me?.id)return;const De=typeof me.name=="string"?me.name.trim():"";k(me.id),D(De),Me(El("edit")),ht("details"),_(!0)},Ys=u.useCallback(me=>{me&&Me(De=>({...De,...me}))},[]),Ea=u.useMemo(()=>{if(!M)return"";const me=v.find(Ot=>Ot.id===M);return typeof me?.name=="string"&&me.name.trim()||typeof C=="string"&&C.trim()||""||"Untitled entity"},[v,M,C]),to=M?`Edit Entity: ${Ea}`:"Add Entity",Gi=u.useCallback(()=>{g(me=>{const De=new URLSearchParams(me);return De.delete(RS),De})},[g]);if(!s)return t.jsx("p",{children:"Restoring session..."});if(!n)return t.jsx("p",{children:"Authenticating..."});const Ki=Be.length>0,ii=zt.groupBy?zt.groups.some(me=>me.items.length>0):zt.data.length>0,no=`entities-page${x?" entities-page--mobile":""}`,ao=i?`${i.name}${o?.name?`  ${o.name}`:""}`:pt?`World  ${o?.name||"Untitled world"}`:"";return t.jsxs("section",{className:no,children:[t.jsx("div",{className:"entities-header",children:t.jsxs("div",{className:"entities-header-top",children:[t.jsxs("div",{className:"entities-header-left",children:[t.jsx("h1",{children:"Entities"}),ot&&le&&t.jsx("div",{style:{marginBottom:"0.75rem",padding:"0.75rem",backgroundColor:"#f8fafc",borderRadius:"0.5rem",border:"1px solid #e5e7eb"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[t.jsx("span",{style:{color:"#6b7280",fontSize:"0.875rem"},children:"Viewing children of:"}),t.jsx(Yt,{to:`/entities/${le.id}`,style:{color:"#1e293b",textDecoration:"none",fontWeight:500,fontSize:"0.875rem"},children:le.name}),t.jsx("button",{type:"button",onClick:()=>{const me=new URLSearchParams(y);me.delete("parentEntity"),g(me)},style:{background:"none",border:"none",color:"#6b7280",cursor:"pointer",fontSize:"0.875rem",padding:"0.25rem 0.5rem",borderRadius:"0.25rem"},onMouseEnter:me=>{me.target.style.backgroundColor="#e5e7eb"},onMouseLeave:me=>{me.target.style.backgroundColor="transparent"},children:"(View all entities)"})]})}),st?t.jsx("p",{className:"entities-subtitle",children:"Showing entities without a world assignment."}):pt?t.jsx("p",{className:"entities-subtitle",children:ao}):t.jsx("p",{className:"entities-subtitle",children:"Select a campaign or world you own to choose a world context."})]}),t.jsxs("div",{className:"entities-header-controls-row",children:[t.jsx(hg,{value:zt.searchTerm,onChange:zt.setSearchTerm,placeholder:"Search entities...",ariaLabel:"Search entities"}),t.jsxs("div",{className:"entities-controls",children:[Ke&&t.jsx("button",{type:"button",className:`btn secondary compact${st?" is-active":""}`,onClick:()=>$e(me=>!me),"aria-pressed":st,title:st?"Show entities for the selected world":"Show entities that do not have a world assigned",children:"No World"}),l&&t.jsxs("div",{className:"entities-importance-filters",children:[["critical","important","medium"].map(me=>{const De=Ye.includes(me);return t.jsx("button",{type:"button",className:`btn secondary compact importance-filter importance-${me}${De?" is-active":""}`,onClick:()=>{mt(Ot=>De?Ot.filter(Zt=>Zt!==me):[...Ot,me])},title:`Filter by ${me} importance`,children:me.charAt(0).toUpperCase()+me.slice(1)},me)}),Ye.length>0&&t.jsx("button",{type:"button",className:"btn secondary compact importance-filter-clear",onClick:()=>mt([]),title:"Clear importance filters",children:t.jsx(ea,{size:14})})]}),t.jsxs("div",{className:"entities-filters-refresh-group",children:[t.jsxs("button",{type:"button",className:`btn secondary compact${zt.filterActive?" is-active":""}`,onClick:()=>jt(!0),children:[t.jsx(Sf,{size:16})," Filters"]}),t.jsx("button",{type:"button",className:"icon-btn",title:"Refresh entities",onClick:ri,disabled:N||!st&&!Ce,children:t.jsx(Ui,{size:16})})]}),!x&&Ct&&t.jsxs("div",{className:"entities-column-menu-wrapper",children:[t.jsxs("button",{type:"button",className:"btn secondary compact","aria-haspopup":"dialog",onClick:xe,children:[t.jsx(Ek,{size:16})," Columns"]}),ue&&t.jsx("div",{className:"entities-column-drawer-overlay",role:"presentation",onClick:Ie,children:t.jsxs("div",{className:"entities-column-drawer",role:"dialog","aria-modal":"true","aria-labelledby":"column-drawer-title",onClick:me=>me.stopPropagation(),children:[t.jsxs("div",{className:"entities-column-drawer-header",children:[t.jsxs("div",{children:[t.jsxs("h3",{id:"column-drawer-title",children:["Columns for ",We||"selected type"]}),t.jsx("p",{className:"entities-column-info",children:"Choose which fields are visible in this list. Drag the handle to reorder selected columns and save to keep your personal preference."})]}),t.jsx("button",{type:"button",className:"icon-btn",onClick:Ie,title:"Close column settings",children:t.jsx(ea,{size:16})})]}),t.jsx("div",{className:"entities-column-drawer-body",children:B?t.jsx("p",{className:"entities-column-info",children:"Loading columns"}):O?t.jsx("div",{className:"alert error",role:"alert",children:O}):t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"entities-column-hint",children:"Checked columns appear in the table. Drag the grip icon to adjust their display order."}),t.jsxs("ul",{className:"entities-column-list",children:[re.map(me=>{const De=se.find(he=>he.key===me);if(!De)return null;const Ot=we===me,Zt=De.type==="metadata"?"Metadata":"Core";return t.jsxs(u.Fragment,{children:[Le===me&&t.jsx("div",{className:"drop-indicator"}),t.jsxs("li",{className:`entities-column-item${Ot?" is-dragging":""}`,draggable:!0,onDragStart:he=>wt(me,he),onDragOver:he=>He(me,he),onDrop:()=>Je(me),onDragEnd:ee,children:[t.jsxs("div",{className:"entities-column-item-main",children:[t.jsx("input",{type:"checkbox",checked:!0,onChange:()=>lt(me)}),t.jsx("label",{className:"entities-column-name",children:De.label}),t.jsx("span",{className:"entities-column-type-badge",children:Zt})]}),t.jsx("button",{type:"button",className:"entities-column-handle",draggable:!0,onDragStart:he=>wt(me,he),children:t.jsx(LM,{size:18})})]})]},me)}),we&&Le==="__end"&&t.jsx("div",{className:"drop-indicator end"}),se.filter(me=>!re.includes(me.key)).map(me=>{const De=me.type==="metadata"?"Metadata":"Core";return t.jsxs("li",{className:"entities-column-item inactive",children:[t.jsxs("div",{className:"entities-column-item-main",children:[t.jsx("input",{type:"checkbox",checked:!1,onChange:()=>lt(me.key)}),t.jsx("label",{className:"entities-column-name",children:me.label}),t.jsx("span",{className:"entities-column-type-badge",children:De})]}),t.jsx("div",{className:"entities-column-handle-placeholder"})]},me.key)})]}),we&&t.jsx("div",{className:`entities-column-dropzone${Le==="__end"?" is-active":""}`,onDragOver:me=>{we&&(me.preventDefault(),me.dataTransfer&&(me.dataTransfer.dropEffect="move"),be("__end"))},onDragLeave:()=>{Le==="__end"&&be("")},onDrop:me=>{me.preventDefault(),St()},children:"Drop here to move column to the end"}),se.every(me=>me.type!=="metadata")&&t.jsx("p",{className:"entities-column-empty",children:"This entity type does not have metadata fields yet."}),ye&&t.jsx("p",{className:"entities-column-error",children:ye})]})}),t.jsxs("div",{className:"entities-column-drawer-footer",children:[t.jsx("div",{className:"entities-column-footer-left",children:t.jsx("button",{type:"button",className:"btn secondary",onClick:vt,disabled:B||nt,children:"Use system default"})}),t.jsxs("div",{className:"entities-column-footer-right",children:[t.jsx("button",{type:"button",className:"btn submit",onClick:()=>et(mp),disabled:B||de||!dt,children:de?"Saving":"Save for me"}),Ke&&t.jsxs("div",{className:"entities-column-admin",children:[t.jsx("span",{className:"entities-column-admin-label",children:"System settings (admin only)"}),t.jsx("button",{type:"button",className:"btn secondary",onClick:()=>et(IS),disabled:B||it||!xt,title:"Set these columns as the default for all users",children:it?"Saving":"Set as system default"})]})]})]})]})})]})]}),t.jsxs("button",{type:"button",className:"btn submit",onClick:ps,disabled:!Te||!Ce||N||st,children:[t.jsx(sa,{size:18})," Add Entity"]})]})]})}),st&&t.jsx("div",{className:"alert info",role:"status",children:"Entities listed here do not have a world assigned. Open an entity to update its world from the entity detail view."}),U&&t.jsx("div",{className:`toast-banner ${U.tone}`,role:"status",children:U.message}),j&&t.jsx("div",{className:"alert error",role:"alert",children:j}),N?t.jsx("div",{className:"empty-state",children:"Loading entities..."}):!Ce&&!st?t.jsx("div",{className:"empty-state",children:"Select a campaign to view its entities."}):Ki?ii?t.jsx("div",{className:"entities-table-wrapper",children:t.jsxs("table",{className:"entities-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[Pe.map(me=>{const De=zt.sortState.key===me.key,Ot=zt.groupBy===me.key;return t.jsx("th",{onClick:()=>yn(me.key),onContextMenu:Zt=>ja(Zt,me),className:"sortable-header",children:t.jsxs("span",{className:"header-label",children:[me.label,De&&t.jsx("span",{className:"sort-indicator",children:zt.sortState.direction==="asc"?"":""}),Ot&&t.jsx("span",{className:"group-indicator",children:"Grouped"})]})},me.key)}),Lt&&t.jsx("th",{className:"actions-column",children:"Actions"})]})}),t.jsx("tbody",{children:zt.groupBy?zt.groups.map(me=>t.jsxs(u.Fragment,{children:[t.jsx("tr",{className:"entities-group-row",children:t.jsxs("td",{colSpan:Pe.length+(Lt?1:0),children:[t.jsx("button",{type:"button",className:"group-toggle",onClick:()=>zt.toggleGroupCollapse(me.id),"aria-label":`Toggle group ${dn(me.value)}`,children:zt.isGroupCollapsed(me.id)?t.jsx(Jr,{size:14}):t.jsx(Ls,{size:14})}),t.jsxs("span",{className:"entities-group-label",children:[dn(me.value)," ",t.jsxs("span",{className:"entities-group-count",children:["(",me.items.length,")"]})]})]})}),!zt.isGroupCollapsed(me.id)&&me.items.map(De=>t.jsxs("tr",{children:[Pe.map(Ot=>t.jsx("td",{children:Yi(Ot,De)},Ot.key)),Lt&&t.jsx("td",{className:"actions-column",children:t.jsxs("div",{className:"entity-actions",children:[t.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Un(De),title:"Edit entity",disabled:N,children:t.jsx(Ga,{size:16})}),t.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>xr(De),title:"Delete entity",disabled:z===De.id,children:t.jsx(zn,{size:16})})]})})]},De.id))]},me.id)):zt.data.map(me=>t.jsxs("tr",{children:[Pe.map(De=>t.jsx("td",{children:Yi(De,me)},De.key)),Lt&&t.jsx("td",{className:"actions-column",children:t.jsxs("div",{className:"entity-actions",children:[t.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Un(me),title:"Edit entity",disabled:N,children:t.jsx(Ga,{size:16})}),t.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>xr(me),title:"Delete entity",disabled:z===me.id,children:t.jsx(zn,{size:16})})]})})]},me.id))})]})}):t.jsxs("div",{className:"empty-state",children:[t.jsx("p",{className:"empty-title",children:"No entities match your filters."}),t.jsx("div",{className:"empty-actions",children:(zt.filterActive||zt.searchTerm)&&t.jsxs("div",{className:"empty-action-buttons",children:[zt.filterActive&&t.jsx("button",{type:"button",className:"btn secondary",onClick:()=>zt.clearFilters(),children:"Clear filters"}),zt.searchTerm&&t.jsx("button",{type:"button",className:"btn secondary",onClick:()=>zt.setSearchTerm(""),children:"Reset search"})]})})]}):t.jsx("div",{className:"empty-state",children:Ct?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"empty-title",children:"No entities of this type yet."}),t.jsx("button",{type:"button",className:"btn secondary",onClick:Gi,children:"View all entities"})]}):Te?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"empty-title",children:"No entities yet."}),t.jsxs("p",{children:["Click ",t.jsx("strong",{children:"Add Entity"})," to create your first entity."]})]}):t.jsx("p",{children:"Nothing to show right now."})}),ve.open&&t.jsxs("div",{className:"column-context-menu",style:{top:ve.y,left:ve.x},role:"menu",children:[t.jsx("button",{type:"button",onClick:()=>ha(ve.columnKey),children:zt.groupBy===ve.columnKey?"Remove grouping":`Group by ${ve.columnLabel}`}),zt.groupBy&&zt.groupBy!==ve.columnKey&&t.jsx("button",{type:"button",onClick:()=>ha(""),children:"Clear grouping"})]}),t.jsx(Uj,{open:_t,onClose:()=>jt(!1),fields:Bn,value:zt.filters,worldId:Ce,onApply:me=>{zt.setFilters(me),jt(!1)}}),t.jsx(Bs,{isOpen:T,onClose:ta,title:to,width:420,footerActions:t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:"btn cancel",onClick:ta,disabled:Oe.cancelDisabled,children:"Cancel"}),Oe.accessButtonVisible&&t.jsx("button",{type:"button",className:"btn secondary",onClick:()=>ht(me=>me==="access"?"details":"access"),disabled:Oe.accessButtonDisabled,children:ut==="access"?"Details":"Access"}),t.jsx("button",{type:"submit",className:"btn submit",form:Tt.current,disabled:Oe.submitDisabled,children:Oe.submitLabel})]}),children:t.jsx(h1,{worldId:st?"":Ce,entityId:M,onCancel:ta,onSaved:hs,formId:Tt.current,onStateChange:Ys,hideActions:!0,selectedEntityTypeId:Ct?bt:"",activeView:ut,onViewChange:ht,defaultCampaignId:i?.id||""})})]})}function y1({tabs:e=[],activeTab:n,onChange:s}){if(!Array.isArray(e)||e.length===0)return null;const i=l=>{typeof s=="function"&&s(l)};return t.jsx("nav",{className:"tab-nav flex flex-wrap gap-2",role:"tablist",children:e.map(l=>{const{id:o,label:d}=l,m=o===n;return t.jsx("button",{type:"button",role:"tab","aria-selected":m,className:`tab-nav-button whitespace-nowrap px-3 py-2 ${m?"is-active":""}`,onClick:()=>i(o),children:d},o)})})}const OL=(e,n)=>{const s=new URLSearchParams;n&&s.set("campaignId",n);const i=s.toString(),l=i?`/entities/${e}/follow?${i}`:`/entities/${e}/follow`;return Et.post(l)},g1=(e,n)=>{const s=new URLSearchParams;n&&s.set("campaignId",n);const i=s.toString(),l=i?`/entities/${e}/follow?${i}`:`/entities/${e}/follow`;return Et.delete(l)},$L=e=>{const n=new URLSearchParams;e&&n.set("campaignId",e);const s=n.toString(),i=s?`/entities/followed?${s}`:"/entities/followed";return Et.get(i)},FL=(e,n)=>{const s=new URLSearchParams;n&&s.set("campaignId",n);const i=s.toString(),l=i?`/entities/${e}/follow-status?${i}`:`/entities/${e}/follow-status`;return Et.get(l)};function zL({entityId:e}){const{user:n}=un(),{selectedCampaignId:s}=jn(),[i,l]=u.useState(!1),[o,d]=u.useState(!1),[m,p]=u.useState(!0);u.useEffect(()=>{if(!e||!s||!n?.id){p(!1);return}(async()=>{try{p(!0);const g=await FL(e,s);l(g?.following??!1)}catch(g){console.error("Failed to check follow status",g),l(!1)}finally{p(!1)}})()},[e,s,n?.id]);const h=async()=>{if(!e||!s||o||m)return;const y=!i;d(!0);try{y?await OL(e,s):await g1(e,s),l(y)}catch(g){console.error("Failed to toggle follow",g),l(!y)}finally{d(!1)}};return s?m?t.jsx("button",{type:"button",className:"entity-follow-button",disabled:!0,title:"Checking follow status...",children:t.jsx(Bl,{size:18})}):t.jsx("button",{type:"button",className:`entity-follow-button ${i?"following":""}`,onClick:h,disabled:o,title:i?"Unfollow entity":"Follow entity",children:i?t.jsx(xf,{size:18}):t.jsx(Bl,{size:18})}):null}function BL({entityId:e,name:n,canEdit:s,isEditing:i,onToggleEdit:l,onSave:o,isSaving:d=!1,isSaveDisabled:m=!1,isMobile:p=!1}){const h=n||"Untitled entity",y=()=>{typeof l=="function"&&l()},g=()=>{typeof o=="function"&&o()};return t.jsxs("div",{className:"entity-header flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 sm:gap-2",role:"banner",children:[t.jsx("div",{className:"entity-header-center",children:t.jsx("h1",{className:p?"entity-header-title-mobile":"",children:h})}),t.jsxs("div",{className:"entity-header-right",children:[e&&t.jsx(zL,{entityId:e}),s?t.jsxs("div",{className:"entity-header-actions",children:[i&&typeof o=="function"?t.jsx("button",{type:"button",className:"btn submit",onClick:g,disabled:m||d,children:d?"Saving":"Save"}):null,t.jsxs("button",{type:"button",className:`edit-mode-toggle ${i?"is-active":""}`,role:"switch","aria-checked":i,onClick:y,children:[t.jsx("span",{className:"edit-mode-toggle-track","aria-hidden":"true",children:t.jsx("span",{className:"edit-mode-toggle-thumb"})}),t.jsx("span",{className:"edit-mode-toggle-text",children:"Edit"})]})]}):null]})]})}const UL=[{value:"critical",label:"Critical",icon:Jn,color:"#dc2626"},{value:"important",label:"Important",icon:Uc,color:"#ea580c"},{value:"medium",label:"Medium",icon:cg,color:"#6b7280"},{value:null,label:"None",icon:ea,color:"#9ca3af"}];function qL({entityId:e,importance:n,onUpdate:s}){const{selectedCampaignId:i}=jn(),[l,o]=u.useState(!1);if(!i)return null;const d=async m=>{if(!(l||m===n)){o(!0);try{await GR(e,m),s?.(m)}catch(p){console.error("Failed to update entity importance",p)}finally{o(!1)}}};return t.jsxs("div",{className:"entity-importance-selector",children:[t.jsx("span",{className:"entity-importance-label",children:"Importance:"}),t.jsx("div",{className:"entity-importance-buttons",children:UL.map(m=>{const p=m.icon,h=n===m.value;return t.jsxs("button",{type:"button",className:`entity-importance-button ${h?"selected":""}`,onClick:()=>d(m.value),disabled:l,title:m.label,style:h?{"--importance-color":m.color}:{},children:[t.jsx(p,{size:16}),t.jsx("span",{className:"entity-importance-button-label",children:m.label})]},m.value||"none")})})]})}var gp={exports:{}},bp,DS;function PL(){if(DS)return bp;DS=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return bp=e,bp}var xp,LS;function HL(){if(LS)return xp;LS=1;var e=PL();function n(){}function s(){}return s.resetWarningCache=n,xp=function(){function i(d,m,p,h,y,g){if(g!==e){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}i.isRequired=i;function l(){return i}var o={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:l,element:i,elementType:i,instanceOf:l,node:i,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:s,resetWarningCache:n};return o.PropTypes=o,o},xp}var OS;function VL(){return OS||(OS=1,gp.exports=HL()()),gp.exports}var YL=VL();const Dt=zi(YL);function Og({maxWidth:e=1280,className:n="",children:s}){const l={"--entity-page-max-width":typeof e=="number"?`${e}px`:e},o=["entity-page-layout",n].filter(Boolean).join(" ");return t.jsx("div",{className:o,style:l,children:t.jsx("div",{className:"entity-page-layout__inner",children:s})})}Og.propTypes={maxWidth:Dt.oneOfType([Dt.number,Dt.string]),className:Dt.string,children:Dt.node};const GL=new Set(["image/png","image/jpeg","image/jpg"]),KL=2*1024*1024,XL=e=>Number.isFinite(e)?e>=1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:e>=1024?`${(e/1024).toFixed(1)} KB`:`${e} bytes`:"";function WL({entity:e,canEdit:n,isEditing:s,onEntityUpdate:i,variant:l="card"}){const[o,d]=u.useState(null),[m,p]=u.useState(""),[h,y]=u.useState(""),[g,x]=u.useState(!1),[v,S]=u.useState(!1),N=u.useRef(null),[E,j]=u.useState(null),A=!!e?.id,T=!!(e?.imageData&&e?.imageMimeType),_=u.useMemo(()=>Ql(e),[e]),M=m||_,k=e?.name?`${e.name} artwork`:"Entity artwork",C=l==="compact",D=u.useCallback(()=>{d(null),p($=>($&&URL.revokeObjectURL($),"")),j(null),y(""),N.current&&(N.current.value="")},[]);u.useEffect(()=>()=>{m&&URL.revokeObjectURL(m)},[m]),u.useEffect(()=>{!s&&o&&D()},[s,o,D]);const z=()=>{!n||!s||g||v||N.current?.click()},G=$=>{const F=$.target.files?.[0];if(F){if(!GL.has(F.type)){y("Only PNG or JPG images are allowed."),$.target.value="";return}if(F.size>KL){y("Image must be smaller than 2 MB."),$.target.value="";return}y(""),d(F),j(null),p(H=>(H&&URL.revokeObjectURL(H),URL.createObjectURL(F)))}},U=u.useCallback($=>{$&&typeof i=="function"&&i($)},[i]),X=async()=>{if(!(!o||!A)){x(!0),y("");try{const $=E?await m1(o,E):o,F=await Mj(e.id,$),H=Ya(F);if(!H)throw new Error("Failed to upload image");U(H),D()}catch($){y($.message||"Failed to upload image")}finally{x(!1)}}},V=async()=>{if(A){S(!0),y("");try{const $=await kj(e.id),F=Ya($);if(F)U(F);else{const H=Bj({...e||{},imageData:null,imageMimeType:null,image_data:null,image_mime_type:null});U(H)}D()}catch($){y($.message||"Failed to delete image")}finally{S(!1)}}},R=u.useMemo(()=>{const $=["PNG or JPG up to 2 MB.","Uploads are resized to 256256 JPG (~70% quality, ~150 KB)."];return o&&$.push(`Selected: ${o.name} (${XL(o.size)})`),$.join(" ")},[o]),B=C?"div":"section",L=C?"entity-image-card entity-image-card--compact":"entity-card entity-image-card",O=u.useCallback($=>{j($)},[]);return u.useEffect(()=>{o||j(null)},[o]),t.jsxs(B,{className:L,children:[t.jsxs("div",{className:"entity-card-header",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"entity-card-title",children:"Image"}),t.jsx("p",{children:C?"Shown in the dossier summary.":"Displayed on the dossier tab."})]}),n&&s?t.jsxs("div",{className:"entity-card-actions",children:[T&&!o?t.jsx("button",{type:"button",className:"btn secondary",onClick:V,disabled:v,children:v?"Removing":t.jsxs("span",{className:"entity-image-action-label",children:[t.jsx(zn,{size:16,"aria-hidden":"true"})," Remove image"]})}):null,t.jsx("button",{type:"button",className:"btn secondary",onClick:z,disabled:g||v,children:t.jsxs("span",{className:"entity-image-action-label",children:[t.jsx(Lk,{size:16,"aria-hidden":"true"})," Choose image"]})})]}):null]}),t.jsxs("div",{className:"entity-card-body",children:[t.jsxs("div",{className:`entity-image-preview ${M&&!o?"has-image":""}`.trim(),children:[o&&m?t.jsx(f1,{src:m,size:220,onCropChange:O}):M?t.jsx("img",{src:M,alt:k,loading:"lazy"}):t.jsxs("div",{className:"entity-image-placeholder",children:[t.jsx(FM,{size:32,"aria-hidden":"true"}),t.jsx("p",{children:"No image uploaded"})]}),o?t.jsx("button",{type:"button",className:"entity-image-preview-clear",onClick:D,disabled:g,"aria-label":"Clear selected image",children:t.jsx(ea,{size:16,"aria-hidden":"true"})}):null]}),o&&n&&s?t.jsxs("div",{className:"entity-image-actions",children:[t.jsx("button",{type:"button",className:"btn submit",onClick:X,disabled:g,children:g?"Uploading":"Save Image"}),t.jsx("button",{type:"button",className:"btn secondary",onClick:D,disabled:g,children:"Cancel"})]}):null,t.jsx("input",{type:"file",ref:N,accept:"image/png,image/jpeg",onChange:G,hidden:!0}),t.jsx("p",{className:"entity-image-helper",children:R}),h?t.jsx("p",{className:"entity-image-status entity-image-status--error",children:h}):null,!h&&g?t.jsx("p",{className:"entity-image-status",children:"Uploading image"}):null,!h&&v?t.jsx("p",{className:"entity-image-status",children:"Removing image"}):null]})]})}function b1({open:e,eyebrowLabel:n="Heads up",title:s="Unsaved changes",description:i="You have unsaved changes on this record.",destinationLabel:l="",saving:o=!1,onSaveAndContinue:d,onContinueWithoutSaving:m,onStay:p}){if(!e)return null;const h=l?` before continuing to ${l}`:"";return t.jsx("div",{className:"unsaved-dialog-backdrop",role:"dialog","aria-modal":"true",children:t.jsxs("div",{className:"unsaved-dialog",role:"document",children:[t.jsxs("div",{className:"unsaved-dialog-header",children:[t.jsxs("div",{children:[t.jsx("p",{className:"unsaved-dialog-label",children:n}),t.jsx("h2",{children:s})]}),t.jsx("button",{type:"button",className:"icon-btn","aria-label":"Close dialog",onClick:p,children:t.jsx(ea,{size:18})})]}),t.jsxs("div",{className:"unsaved-dialog-body",children:[t.jsxs("p",{children:[i,h,"."]}),t.jsx("p",{className:"unsaved-dialog-help",children:"Choose an option below to continue."})]}),t.jsxs("div",{className:"unsaved-dialog-actions",children:[t.jsx("button",{type:"button",className:"btn submit",onClick:d,disabled:o,children:o?"Saving":"Save and continue"}),t.jsx("button",{type:"button",className:"btn ghost",onClick:m,disabled:o,children:"Continue without saving"}),t.jsx("button",{type:"button",className:"btn cancel",onClick:p,disabled:o,children:"Stay here"})]})]})})}const vp=()=>({relationshipTypes:{mode:"all",values:[]},relatedEntityTypes:{mode:"all",values:[]}}),ZL=e=>e==null?"":String(e).trim(),Of=e=>{let n={};typeof e=="string"?n={worldId:e}:e&&typeof e=="object"&&!Array.isArray(e)&&(n={...e});const s=new URLSearchParams,i=ZL(n.worldId??n.world_id);i&&s.set("worldId",i);const l=s.toString(),o=l?`?${l}`:"";return Et.get(`/entity-relationship-types${o}`)},QL=e=>Et.get(`/entity-relationship-types/${e}`),JL=e=>Et.post("/entity-relationship-types",e),e4=(e,n)=>Et.patch(`/entity-relationship-types/${e}`,n),t4=e=>Et.delete(`/entity-relationship-types/${e}`);function n4({worldId:e,onCreated:n}){const[s,i]=u.useState(""),[l,o]=u.useState(""),[d,m]=u.useState(""),[p,h]=u.useState(!1),[y,g]=u.useState(""),[x,v]=u.useState([]);u.useEffect(()=>{let N=!1;return(async()=>{if(!e){v([]);return}try{const j=await br({worldId:e});if(!N){const A=Array.isArray(j?.data)?j.data:j;v(Array.isArray(A)?A:[])}}catch(j){N||(console.error(" Failed to load entity types",j),v([]))}})(),()=>{N=!0}},[e]);const S=async N=>{if(N.preventDefault(),!s||!l){g("Name and type are required.");return}try{h(!0),g("");const j=await fg({world_id:e,name:s,description:d,entity_type_id:l,visibility:"visible"}),A=j?.data||j;n(A),i(""),o(""),m("")}catch(E){console.error(" Failed to create entity inline",E),g(E.message||"Failed to create entity")}finally{h(!1)}};return t.jsxs("form",{className:"inline-entity-creator",onSubmit:S,children:[t.jsx("h4",{children:"Create New Entity"}),y&&t.jsx("div",{className:"alert error",children:y}),t.jsxs("div",{className:"form-row",children:[t.jsx("label",{children:"Name"}),t.jsx("input",{type:"text",value:s,onChange:N=>i(N.target.value),placeholder:"Entity name..."})]}),t.jsxs("div",{className:"form-row",children:[t.jsx("label",{children:"Type"}),t.jsxs("select",{value:l,onChange:N=>o(N.target.value),children:[t.jsx("option",{value:"",children:"Select type..."}),x.map(N=>t.jsx("option",{value:N.id,children:N.name},N.id))]})]}),t.jsxs("div",{className:"form-row",children:[t.jsx("label",{children:"Description"}),t.jsx("textarea",{rows:"2",value:d,onChange:N=>m(N.target.value),placeholder:"Optional..."})]}),t.jsx("div",{className:"form-actions",children:t.jsx("button",{type:"submit",className:"btn primary",disabled:p||!e,children:p?"Creating":"Create Entity"})})]})}function x1({worldId:e,fromEntity:n=null,onCreated:s,onCancel:i,existingRelationships:l=[]}){const[o,d]=u.useState([]),[m,p]=u.useState(!0),[h,y]=u.useState(""),[g,x]=u.useState(null),[v,S]=u.useState(null),[N,E]=u.useState(""),[j,A]=u.useState(null),[T,_]=u.useState(!1);u.useEffect(()=>{e&&(p(!0),Of({worldId:e}).then(O=>{const $=Array.isArray(O?.data)?O.data:O?.data||[];d($||[])}).catch(O=>y(O.message||"Failed to load data")).finally(()=>p(!1)))},[e]),u.useEffect(()=>{if(!n||g||!n.id||!n.name)return;const O={id:n.id,name:n.name,entity_type_id:n.entity_type_id||n.entityType?.id||n.entity_type?.id,entityType:n.entityType||n.entity_type||null,typeName:n.typeName||n.entityType?.name||n.entity_type?.name};x(O)},[n]);const M=O=>{if(!O)return null;const $=O.entity_type_id||O.typeId||O.entityType?.id||O.entity_type?.id,F=O.typeName||O.entityType?.name||O.entity_type?.name;return{...O,entity_type_id:$,typeName:F}},k=O=>O?.name||O?.title||O?.displayName||"Unnamed entity",C=u.useMemo(()=>{const O=M(g),$=M(v);if(!O||!$)return[];const F=O.entity_type_id,H=$.entity_type_id;if(!F||!H)return[];const I=(Y=[])=>Y.map(P=>P.id||P.entity_type_id||P.entityTypeId||P.type_id||P.typeId||P).map(String);return o.map(Y=>{const P=I(Y.from_entity_types),K=I(Y.to_entity_types),re=P.includes(String(F))&&K.includes(String(H)),W=P.includes(String(H))&&K.includes(String(F));return re||W?{...Y,_supportsDirect:re,_supportsReverse:W}:null}).filter(Boolean)},[o,g,v]),D=u.useMemo(()=>C.find(O=>String(O.id)===String(N)),[N,C]),z=u.useMemo(()=>D?j==="reverse"&&D._supportsReverse?"reverse":j==="direct"&&D._supportsDirect||D._supportsDirect?"direct":D._supportsReverse?"reverse":null:null,[j,D]);u.useEffect(()=>{if(!D){j!==null&&A(null);return}if(z===null){j!==null&&A(null);return}if(j===null){A(z);return}j!==z&&A(z)},[D,z,j]),u.useEffect(()=>{if(!N)return;C.some($=>String($.id)===String(N))||(E(""),A(null))},[C,N]);const G=z==="direct"?g:v,U=z==="direct"?v:g,X=k(G),V=k(U),R=D?.from_name||D?.fromName||D?.name||"relates to",B=D?.to_name||D?.toName||D?.name||"relates to",L=async()=>{if(y(""),!g||!v||!N)return y("Please select both entities and a relationship type.");if(g.id===v.id)return y("Cannot create self-relationships.");if(l.find(I=>(I.from_entity_id===g.id&&I.to_entity_id===v.id||I.from_entity_id===v.id&&I.to_entity_id===g.id)&&I.relationship_type_id===N)){y("This relationship already exists.");return}const $=z;if(!D||!$){y("Please select a valid relationship type.");return}const F=$==="direct"?g.id:v.id,H=$==="direct"?v.id:g.id;try{await u1({from_entity_id:F,to_entity_id:H,relationship_type_id:N}),s?.({from_entity_id:F,to_entity_id:H,relationship_type_id:N,__direction:$})}catch(I){I.response?.status===409||I.response?.data?.message?.toLowerCase?.().includes("duplicate")||I.message?.toLowerCase?.().includes("duplicate")||I.message?.toLowerCase?.().includes("conflict")?y("This relationship already exists."):I.response?.data?.message?y(I.response.data.message):y("Failed to create relationship."),console.warn(" Relationship create error:",I)}};return m?t.jsx("p",{children:"Loading relationship data"}):t.jsxs("div",{className:"relationship-builder-v3",children:[t.jsx("h2",{children:"Add Relationship"}),h&&t.jsx("div",{className:"alert error",children:h}),t.jsx("div",{className:"form-row",children:t.jsx(Cc,{worldId:e,label:"Entity 1",value:g?.id||"",onChange:O=>{n||(x(O),E(""),A(null))},disabled:!!n})}),t.jsxs("div",{className:"form-row entity2-section",children:[t.jsx(Cc,{worldId:e,label:"Entity 2",value:v?.id||"",onChange:O=>S(O)}),!T&&t.jsx("button",{type:"button",className:"btn small tertiary",onClick:()=>_(!0),style:{alignSelf:"flex-start",marginTop:"0.4rem"},children:"+ Create new entity"}),T&&t.jsx(n4,{worldId:e,onCreated:async O=>{try{const $=await Us(O.id),F=Ya($)||O;S(F)}catch{S(O)}_(!1)}})]}),g&&v&&t.jsxs("div",{className:"form-row",children:[t.jsx("label",{children:"Relationship Type"}),t.jsxs("select",{value:N,onChange:O=>{const $=O.target.value;if(E($),!$){A(null);return}const F=C.find(H=>String(H.id)===String($));F?._supportsDirect?A("direct"):F?._supportsReverse?A("reverse"):A(null)},children:[t.jsx("option",{value:"",children:"Select relationship type"}),C.length>0?C.map(O=>t.jsxs("option",{value:O.id,children:[O.name," (",O.from_name,"  ",O.to_name,")"]},O.id)):t.jsx("option",{disabled:!0,children:"No valid relationship types"})]})]}),g&&v&&D&&z&&t.jsxs("div",{className:"relationship-preview",children:[t.jsxs("div",{className:"preview-header",children:[t.jsx("h3",{children:"Relationship preview"}),D._supportsDirect&&D._supportsReverse&&t.jsx("button",{type:"button",className:"btn small secondary",onClick:()=>A(O=>O==="reverse"?"direct":"reverse"),children:"Swap entities"})]}),t.jsxs("p",{children:[t.jsx("strong",{children:X})," ",R," ",t.jsx("strong",{children:V})]}),t.jsxs("p",{children:[t.jsx("strong",{children:V})," ",B," ",t.jsx("strong",{children:X})]})]}),t.jsxs("div",{className:"form-actions",children:[t.jsx("button",{className:"btn primary",disabled:!g||!v||!N,onClick:L,children:"Create Relationship"}),t.jsx("button",{className:"btn secondary",onClick:i,children:"Cancel"})]})]})}const v1=["global","selective","hidden"],a4=[...v1,"owner_only"],$S=new Set(v1),FS=new Set(a4),Sp=(e,n)=>{if(typeof e!="string")return"global";const s=e.toLowerCase();return n.has(s)?s:"global"},Qo=e=>e?Array.isArray(e)?e.map(n=>n==null?"":String(n).trim()).filter(Boolean):typeof e=="string"?e.split(",").map(n=>n.trim()).filter(Boolean):[]:[],wp=()=>({campaigns:[],users:[],characters:[]});function s4(e,n,s){const i=e?.id,l=e?.world?.id||e?.world_id||"",o=u.useMemo(()=>e?{readMode:Sp(e.read_access||e.readAccess,$S),readCampaigns:Qo(e.read_campaign_ids||e.readCampaignIds),readUsers:Qo(e.read_user_ids||e.readUserIds),readCharacters:Qo(e.read_character_ids||e.readCharacterIds),writeMode:Sp(e.write_access||e.writeAccess,FS),writeCampaigns:Qo(e.write_campaign_ids||e.writeCampaignIds),writeUsers:Qo(e.write_user_ids||e.writeUserIds)}:{readMode:"global",readCampaigns:[],readUsers:[],readCharacters:[],writeMode:"global",writeCampaigns:[],writeUsers:[]},[e]),[d,m]=u.useState(o),[p,h]=u.useState(()=>wp()),[y,g]=u.useState(!1),[x,v]=u.useState(""),[S,N]=u.useState(!1),[E,j]=u.useState(""),[A,T]=u.useState("");u.useEffect(()=>{m(o)},[o]);const _=u.useCallback(async()=>{if(n){if(!l){h(wp()),v(""),g(!1);return}g(!0),v("");try{const z=await Dg(l);h({campaigns:z.campaigns??[],users:z.users??[],characters:z.characters??[]})}catch(z){console.error(" Failed to load access options",z),h(wp()),v(z.message||"Failed to load access options")}finally{g(!1)}}},[n,l]);u.useEffect(()=>{_()},[_]);const M=u.useMemo(()=>{const z=["readMode","readCampaigns","readUsers","readCharacters","writeMode","writeCampaigns","writeUsers"],G=U=>Array.isArray(U)?U.map(X=>String(X).trim()).filter(Boolean).sort():[];return z.some(U=>{const X=d[U],V=o[U];if(Array.isArray(X)||Array.isArray(V)){const R=G(X),B=G(V);return R.length!==B.length?!0:R.some((L,O)=>L!==B[O])}return X!==V})},[d,o]),k=u.useCallback((z,G)=>{j(""),T(""),m(U=>{const X={...U};if(z==="readMode"||z==="writeMode"){const R=Sp(G,z==="readMode"?$S:FS);return X[z]=R,z==="readMode"&&R!=="selective"&&(X.readCampaigns=[],X.readUsers=[],X.readCharacters=[]),z==="writeMode"&&R!=="selective"&&(X.writeCampaigns=[],X.writeUsers=[]),X}return["readCampaigns","readUsers","readCharacters","writeCampaigns","writeUsers"].includes(z)?(X[z]=Array.isArray(G)?G.map(V=>String(V).trim()).filter(Boolean):[],X):(X[z]=G,X)})},[]),C=u.useCallback(()=>{m(o),j(""),T("")},[o]),D=u.useCallback(async()=>{if(!s||!i)return!1;if(!M)return!0;j(""),T(""),N(!0);try{const z={read_access:d.readMode,write_access:d.writeMode,read_campaign_ids:d.readMode==="selective"?d.readCampaigns:[],read_user_ids:d.readMode==="selective"?d.readUsers:[],read_character_ids:d.readMode==="selective"?d.readCharacters:[],write_campaign_ids:d.writeMode==="selective"?d.writeCampaigns:[],write_user_ids:d.writeMode==="selective"?d.writeUsers:[]},G=await mg(i,z);if(!(G?.data||G))throw new Error("Failed to save access settings");return T("Access settings saved."),!0}catch(z){return console.error(" Failed to save access settings",z),j(z.message||"Failed to save access settings"),!1}finally{N(!1)}},[s,i,d,M]);return{accessSettings:d,accessOptions:p,accessOptionsError:x,accessOptionsLoading:y,accessSaving:S,accessSaveError:E,accessSaveSuccess:A,isAccessDirty:M,handleAccessSettingChange:k,resetAccessSettings:C,handleAccessSave:D}}function r4(e){const n=u.useMemo(()=>typeof e=="function"?e:()=>!1,[e]);return WN(n)||_i}function i4({isEditing:e,canEdit:n,formError:s,formRef:i,editSchema:l,editInitialData:o,handleUpdate:d,handleFormStateChange:m,dossierSchema:p,viewData:h,featuredImageSrc:y,renderSchemaSections:g,imageSection:x,fieldRules:v,viewRuleContext:S}){const N=Array.isArray(p?.sections)?p.sections:[],E=N[0]||null,j=N[1]||null,A=N.slice(2),T=S?.actionsByField??{},_=S?.showRuleTargets??new Set,M=(G,U)=>{if(!G)return null;const X=Number.isFinite(G.columns)?Math.max(1,Number(G.columns)):1,V=Array.isArray(G.fields)?G.fields:[];return V.length?t.jsx("div",{className:`entity-field-grid ${X>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":""}`,style:{"--entity-field-columns":X},children:V.map((R,B)=>{const L=R?.key||R?.name||R?.field||`${U}-${B}`,O=T[L],$=R.visibleByDefault!==void 0?!!R.visibleByDefault:R.visible_by_default!==void 0?!!R.visible_by_default:!0;return Ac(L,O,_,$)?null:t.jsx(Vc,{field:{...R},data:h,mode:"view"},`${U}-${L}`)})}):t.jsx("p",{className:"entity-empty-state",children:"No fields available."})},k=!!y&&!e,C=h?.name||"Entity",D=!!x&&e&&n,z=()=>{if(!k)return g(p,h,"dossier",S);const G={...p||{},sections:A};return t.jsxs(t.Fragment,{children:[t.jsx("section",{className:"entity-card entity-dossier-header-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:t.jsxs("div",{className:"entity-dossier-header",children:[t.jsxs("div",{className:"entity-dossier-header-content",children:[E?.title?t.jsx("h2",{className:"entity-card-title",children:E.title}):null,M(E,"dossier-summary"),j?t.jsx("div",{className:"entity-dossier-description",children:M(j,"dossier-description")}):null]}),t.jsx("div",{className:"entity-dossier-header-image sm:ml-6 sm:w-64 w-full mt-4 sm:mt-0",children:t.jsx("img",{src:y,alt:`${C} artwork`,loading:"lazy"})})]})}),g(G,h,"dossier",S)]})};return t.jsxs("div",{className:"entity-tab-content",children:[s&&t.jsx("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:t.jsx("div",{className:"alert error",role:"alert",children:s})}),e&&n?t.jsx("section",{className:"entity-card entity-card--form entity-edit-form-wrapper bg-white rounded-lg border p-4 sm:p-6 w-full",children:t.jsxs("div",{className:"entity-edit-form-container",children:[t.jsx("div",{className:"entity-edit-form-content",children:t.jsx(us,{ref:i,schema:l,initialData:o||{},onSubmit:d,onStateChange:m,hideActions:!0,enableUnsavedPrompt:!1,fieldRules:v})}),D?t.jsx("div",{className:"entity-edit-form-image sm:ml-6 sm:w-64 w-full mt-4 sm:mt-0",children:x}):null]})}):z()]})}function l4({entity:e,toast:n,onExplore:s,canEdit:i,relationshipsLoading:l,relationshipsError:o,filteredRelationships:d,sortedRelationships:m,relationshipsEmptyMessage:p,relationshipFilters:h,relationshipFilterOptions:y,filterButtonDisabled:g,handleRelationshipFiltersChange:x,handleRelationshipFiltersReset:v,showRelationshipForm:S,setShowRelationshipForm:N,worldId:E,loadRelationships:j}){const[A,T]=u.useState(!1),_=S!==void 0?S:A,[M,k]=u.useState(!1),C=u.useRef(null);u.useEffect(()=>{if(!M)return;const O=F=>{C.current&&(C.current.contains(F.target)||k(!1))},$=F=>{F.key==="Escape"&&k(!1)};return document.addEventListener("mousedown",O),document.addEventListener("touchstart",O),document.addEventListener("keydown",$),()=>{document.removeEventListener("mousedown",O),document.removeEventListener("touchstart",O),document.removeEventListener("keydown",$)}},[M]);const D=Array.isArray(y?.relationshipTypes)?y.relationshipTypes:[],z=Array.isArray(y?.relatedEntityTypes)?y.relatedEntityTypes:[],G=h?.relationshipTypes?.values||[],U=h?.relatedEntityTypes?.values||[],X=O=>{const $=Array.from(O.target.selectedOptions,F=>F.value);x&&x({relationshipTypes:{mode:$.length>0?"include":"all",values:$},relatedEntityTypes:h?.relatedEntityTypes||{mode:"all",values:[]}})},V=O=>{const $=Array.from(O.target.selectedOptions,F=>F.value);x&&x({relationshipTypes:h?.relationshipTypes||{mode:"all",values:[]},relatedEntityTypes:{mode:$.length>0?"include":"all",values:$}})},R=()=>{v&&v(),k(!1)},B=()=>{k(!1)},L=G.length>0||U.length>0;return t.jsxs(t.Fragment,{children:[n&&t.jsxs("div",{className:`toast-banner ${n.tone}`,role:"status",children:[t.jsx("span",{children:n.message}),n.link?t.jsx(Yt,{to:n.link.to,className:"toast-banner-link",children:n.link.label}):null]}),t.jsxs("div",{className:"bg-white border border-neutral-200 rounded-xl shadow-sm p-6 mb-6 w-full",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"Relationships"}),t.jsxs("div",{className:"flex items-center gap-2",children:[typeof s=="function"?t.jsx("button",{type:"button",className:"btn-secondary",onClick:s,children:"Explore"}):null,t.jsxs("div",{className:"relative",ref:C,children:[t.jsx("button",{id:"filterButton",type:"button",className:`btn-secondary${L?" is-active":""}`,onClick:()=>k(O=>!O),disabled:g,children:"Filter"}),M&&!g?t.jsxs("div",{className:"bg-white border border-neutral-200 rounded-lg shadow-lg p-4 w-[260px] absolute top-full mt-2 right-0 z-10",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"text-sm font-medium text-neutral-700 mb-1 block",children:"Relationship Types"}),t.jsx("select",{className:"w-full border border-neutral-300 rounded-md px-3 py-1 text-sm",multiple:!0,size:5,value:G,onChange:X,children:D.map(O=>t.jsx("option",{value:O.value,children:O.label},O.value))})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"text-sm font-medium text-neutral-700 mb-1 block",children:"Related Entity Types"}),t.jsx("select",{className:"w-full border border-neutral-300 rounded-md px-3 py-1 text-sm",multiple:!0,size:5,value:U,onChange:V,children:z.map(O=>t.jsx("option",{value:O.value,children:O.label},O.value))})]}),t.jsxs("div",{className:"flex items-center justify-between mt-2",children:[t.jsx("button",{type:"button",className:"text-sm text-neutral-600 hover:text-neutral-900",onClick:R,children:"Clear filters"}),t.jsx("button",{type:"button",className:"btn-secondary text-sm",onClick:B,children:"Done"})]})]}):null]}),i&&t.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{N&&N(!0),S===void 0&&T(!0)},children:"Add relationship"})]})]}),l?t.jsx("p",{children:"Loading relationships..."}):o?t.jsx("div",{className:"alert error",role:"alert",children:o}):m.length===0?t.jsx("p",{className:"text-sm text-neutral-500",children:p}):d.length===0?t.jsx("p",{className:"text-sm text-neutral-500",children:"No relationships match your filters."}):t.jsxs("table",{className:"w-full text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"text-left text-neutral-600 border-b border-neutral-200",children:[t.jsx("th",{className:"py-2 font-medium",children:"Relationship"}),t.jsx("th",{className:"py-2 font-medium",children:"Type"}),t.jsx("th",{className:"py-2 font-medium",children:"Direction"})]})}),t.jsx("tbody",{children:d.map(O=>{const $=String(O.fromId)===String(e.id),F=$?O.toName:O.fromName,H=$?O.toId:O.fromId,I=O.sourceLabel||O.source_relationship_label||"",Y=O.targetLabel||O.target_relationship_label||"";return t.jsxs("tr",{className:"border-b border-neutral-100 last:border-0",children:[t.jsxs("td",{className:"py-3",children:[t.jsx("strong",{children:e.name})," ",$?I:Y," ",t.jsx(Yt,{to:`/entities/${H}`,className:"text-blue-600 hover:underline",children:F||""}),H?t.jsx(Na,{entityId:H,entityName:F}):null]}),t.jsx("td",{className:"py-3",children:O.typeName||""}),t.jsx("td",{className:"py-3",children:$?"Outgoing":"Incoming"})]},O.id)})})]})]}),E&&e?t.jsx(Bs,{isOpen:_,onClose:()=>{N?N(!1):T(!1)},title:"Add relationship",description:"Link this entity to others without leaving the page.",size:"md",children:t.jsx(x1,{worldId:E,fromEntity:e,onCreated:()=>{N?N(!1):T(!1),j&&j()},onCancel:()=>{N?N(!1):T(!1)}})}):null]})}function o4({canEdit:e,worldId:n,accessSettings:s,accessOptions:i,accessOptionsError:l,accessOptionsLoading:o,accessSaving:d,accessSaveError:m,accessSaveSuccess:p,handleAccessSettingChange:h}){return t.jsx("div",{className:"entity-tab-content",children:t.jsxs("section",{className:"entity-card entity-access-card",children:[t.jsx("h2",{className:"entity-card-title",children:"Access controls"}),t.jsx("p",{className:"entity-access-note help-text",children:"Configure who can view and edit this entity. Users with write access will automatically receive read access. Changes are saved along with the rest of the record."}),l&&t.jsx("div",{className:"alert error",role:"alert",children:l}),n?t.jsxs(t.Fragment,{children:[t.jsx(Ig,{canEdit:e,accessSettings:s,accessOptions:i,accessOptionsLoading:o,accessSaving:d,onSettingChange:h}),t.jsxs("div",{className:"entity-access-actions",children:[m&&t.jsx("div",{className:"alert error",role:"alert",children:m}),p&&t.jsx("div",{className:"alert success",role:"status",children:p})]})]}):t.jsx("p",{className:"entity-empty-state",children:"Assign this entity to a world to configure access settings."})]})})}function c4({renderSchemaSections:e,systemSchema:n,viewData:s}){return t.jsx("div",{className:"entity-tab-content",children:e(n,s,"system")})}const zS=e=>{if(!e)return"";const n=new Date(e);return Number.isNaN(n.getTime())?"":n.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})},dd=e=>{if(!e)return"";const n=e.username?.trim?.()||"",s=e.email?.trim?.()||"";return n&&s&&n!==s?`${n} (${s})`:n||s||"Unknown user"},u4=e=>Array.isArray(e)?e.filter(n=>n&&typeof n=="object").map(n=>({...n})):[],Np=(e,n)=>{const s=new Set,i=[];return e.forEach(l=>{if(!l)return;let o=l[n];if(o||(n==="user_id"?o=l.user?.id:n==="campaign_id"&&(o=l.campaign?.id)),!o)return;const d=String(o);s.has(d)||(s.add(d),i.push(l))}),i},BS=(e,n)=>{if(!e)return[];const s=Array.isArray(e.permissions)?e.permissions:[],i=new Set,l=[];return s.forEach(o=>{if(!o)return;let d=o[n];if(d||(n==="user_id"?d=o.user?.id:n==="campaign_id"&&(d=o.campaign?.id)),!d)return;const m=String(d);i.has(m)||(i.add(m),l.push(m))}),l};function d4({entity:e,secrets:n,worldId:s,canManageSecrets:i,onSecretCreated:l,onSecretUpdated:o}){const[d,m]=u.useState(""),[p,h]=u.useState(""),[y,g]=u.useState([]),[x,v]=u.useState([]),[S,N]=u.useState({campaigns:[],users:[]}),[E,j]=u.useState(!1),[A,T]=u.useState(""),[_,M]=u.useState(!1),[k,C]=u.useState(!1),[D,z]=u.useState(""),[G,U]=u.useState(""),[X,V]=u.useState(!1),[R,B]=u.useState(null),L=u.useMemo(()=>!!R?.id,[R?.id]),O=u.useMemo(()=>`entity-secret-create-${e?.id||"new"}`,[e?.id]),$=u.useMemo(()=>u4(n),[n]),F=u.useCallback(()=>{m(""),h(""),g([]),v([])},[]),H=u.useCallback(()=>{k||(B(null),F(),z(""),U(""),V(!0))},[F,k]),I=u.useCallback(ae=>{if(!i||k||!ae)return;const ke=ae.title??"",pe=ae.content??"";m(ke?String(ke):""),h(pe?String(pe):""),g(BS(ae,"campaign_id")),v(BS(ae,"user_id")),N(we=>{const ne=Array.isArray(we?.campaigns)?[...we.campaigns]:[],Le=Array.isArray(we?.users)?[...we.users]:[],be=(Me,ut,ht)=>{if(!ut)return;const _t=String(ut);Me.some(jt=>jt?.value===_t)||Me.push({value:_t,label:ht})};return(Array.isArray(ae.permissions)?ae.permissions:[]).forEach(Me=>{if(!Me)return;const ut=Me.user_id??Me.user?.id;if(ut){const _t=Me.user?dd(Me.user):`User ${String(ut).slice(0,8)}`;be(Le,ut,_t)}const ht=Me.campaign_id??Me.campaign?.id;if(ht){const _t=Me.campaign?.name?Me.campaign.name:`Campaign ${String(ht).slice(0,8)}`;be(ne,ht,_t)}}),{campaigns:ne,users:Le}}),B(ae),z(""),U(""),V(!0)},[i,k]),Y=u.useCallback(()=>{k||(V(!1),z(""),B(null),F())},[F,k]),P=u.useCallback(async()=>{if(!i||!s){N({campaigns:[],users:[]}),T(""),j(!1),M(!0);return}j(!0),T("");try{const[ae,ke]=await Promise.all([qc({world_id:s}),js({world_id:s})]),we=(Array.isArray(ae?.data)?ae.data:Array.isArray(ae)?ae:[]).map(Oe=>({value:String(Oe.id),label:Oe.name||"Untitled campaign"})),ne=Array.isArray(ke?.data)?ke.data:Array.isArray(ke)?ke:[],Le=[];ne.forEach(Oe=>{const Me=Oe?.player||{},ut=Me.id||Oe?.user_id;ut&&Le.push({value:String(ut),label:dd(Me)})});const be=Np(Le,"value");N({campaigns:we,users:be}),M(!0)}catch(ae){console.error(" Failed to load secret visibility options",ae),N({campaigns:[],users:[]}),T(ae.message||"Failed to load share options"),M(!0)}finally{j(!1)}},[i,s]);u.useEffect(()=>{M(!1),N({campaigns:[],users:[]}),T("")},[s,i]),u.useEffect(()=>{!X||_||P()},[X,_,P]);const K=async ae=>{if(ae.preventDefault(),!e?.id||k)return;const ke=p.trim();if(!ke){z("Description is required."),U("");return}C(!0),z(""),U("");try{const pe={summary:d.trim()||void 0,description:ke,campaign_ids:y,user_ids:x};let we;L&&R?.id?we=await WR(e.id,R.id,pe):we=await XR(e.id,pe);const ne=we?.data||we;L&&R?.id?(o?.(ne),U("Secret updated successfully.")):(l?.(ne),U("Secret created successfully.")),F(),B(null),V(!1)}catch(pe){z(pe.message||"Failed to save secret")}finally{C(!1)}},re=ae=>{if(!i||!Array.isArray(ae?.permissions))return null;const ke=ae.permissions.map(ne=>({...ne})).filter(ne=>ne);if(ke.length===0)return t.jsx("p",{className:"entity-secret-shared",children:"Not shared with any campaigns or users."});const pe=Np(ke.filter(ne=>ne.user_id||ne.user),"user_id"),we=Np(ke.filter(ne=>ne.campaign_id||ne.campaign),"campaign_id");return t.jsxs("div",{className:"entity-secret-shared",children:[pe.length>0&&t.jsxs("div",{children:[t.jsx("strong",{children:"Shared with players:"}),t.jsx("ul",{className:"entity-secret-share-list",children:pe.map(ne=>{const Le=ne.user?dd(ne.user):`User ${String(ne.user_id).slice(0,8)}`,be=ne.user_id||Le;return t.jsx("li",{className:"entity-secret-share-pill",children:Le},be)})})]}),we.length>0&&t.jsxs("div",{children:[t.jsx("strong",{children:"Shared with campaigns:"}),t.jsx("ul",{className:"entity-secret-share-list",children:we.map(ne=>{const Le=ne.campaign?.name||`Campaign ${String(ne.campaign_id).slice(0,8)}`,be=ne.campaign_id||Le;return t.jsx("li",{className:"entity-secret-share-pill",children:Le},be)})})]})]})},W=L?"Edit secret":"Create a secret",ue=L?"Update the secret content or who can access it.":"Secrets are hidden notes that are only visible to selected campaigns or players.",Q=L?"Update secret":"Save secret",ye=L?"Updating secret...":"Creating secret...";return t.jsxs("div",{className:"entity-tab-content",children:[i&&t.jsx(Bs,{isOpen:X,onClose:Y,title:W,description:ue,size:"lg",footerActions:t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx("button",{type:"button",className:"border border-neutral-300 bg-white px-4 py-2 rounded-md text-sm hover:bg-neutral-100 text-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",onClick:Y,disabled:k,children:"Cancel"}),t.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-md text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",form:O,disabled:k,children:k?ye:Q})]}),children:t.jsxs("form",{id:O,className:"entity-secret-form-body",onSubmit:K,children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"entity-secret-summary",className:"text-sm font-medium text-neutral-700",children:"Summary"}),t.jsx("input",{id:"entity-secret-summary",type:"text",value:d,onChange:ae=>m(ae.target.value),placeholder:"Short label for this secret (optional)",disabled:k,"data-autofocus":"true",className:"w-full border rounded-md px-3 py-2 text-sm"})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"entity-secret-description",className:"text-sm font-medium text-neutral-700",children:"Description"}),t.jsx("textarea",{id:"entity-secret-description",value:p,onChange:ae=>h(ae.target.value),rows:4,placeholder:"Detail the secret information...",disabled:k,required:!0,className:"w-full border rounded-md px-3 py-2 text-sm min-h-[120px]"})]}),t.jsxs("div",{className:"entity-secret-share-grid",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"entity-secret-campaigns",className:"text-sm font-medium text-neutral-700",children:"Share with campaigns"}),t.jsx($s,{inputId:"entity-secret-campaigns",selected:y,options:S.campaigns,onChange:g,placeholder:"Select campaigns...",disabled:k||E,loading:E,noOptionsMessage:E?"Loading campaigns...":"No campaigns available in this world."}),t.jsx("p",{className:"help-text",children:"Dungeon Masters of selected campaigns will be able to read this secret."})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"entity-secret-users",className:"text-sm font-medium text-neutral-700",children:"Share with players"}),t.jsx($s,{inputId:"entity-secret-users",selected:x,options:S.users,onChange:v,placeholder:"Select users...",disabled:k||E,loading:E,noOptionsMessage:E?"Loading users...":"No eligible players found for this world."}),t.jsx("p",{className:"help-text",children:"Choose specific players who should see this information."})]})]}),A&&t.jsx("div",{className:"alert error",role:"alert",children:A}),D&&t.jsx("div",{className:"alert error",role:"alert",children:D})]})}),t.jsxs("section",{className:"entity-card entity-secret-list-card",children:[t.jsxs("div",{className:"entity-card-header entity-card-header--subtle",children:[t.jsxs("h2",{className:"entity-card-title",children:["Secrets for ",e?.name||"this entity"]}),i&&t.jsx("div",{className:"entity-card-actions",children:t.jsx("button",{type:"button",className:"btn submit",onClick:H,disabled:k,children:"New secret"})})]}),G&&t.jsx("div",{className:"alert success",role:"status",children:G}),$.length===0?t.jsx("p",{className:"entity-empty-state",children:"No secrets available for this entity yet."}):t.jsx("ul",{className:"entity-secret-list",children:$.map(ae=>{const ke=ae.createdAt||ae.created_at,pe=ae.updatedAt||ae.updated_at,we=dd(ae.creator);return t.jsxs("li",{className:"entity-secret-item",children:[t.jsxs("div",{className:"entity-secret-header",children:[t.jsx("h3",{children:ae.title||"Untitled secret"}),t.jsxs("div",{className:"entity-secret-meta",children:[we&&t.jsxs("span",{children:["Created by ",we]}),ke&&t.jsxs("span",{children:["Created ",zS(ke)]}),pe&&pe!==ke&&t.jsxs("span",{children:["Updated ",zS(pe)]})]})]}),i&&t.jsx("div",{className:"entity-secret-actions",children:t.jsx("button",{type:"button",className:"btn secondary",onClick:()=>I(ae),disabled:k,children:"Edit secret"})}),ae.content?t.jsx("p",{className:"entity-secret-content",children:ae.content}):null,re(ae)]},ae.id||ae.createdAt)})})]})]})}function f4(e){if(Array.isArray(e)){for(var n=0,s=new Array(e.length);n<e.length;n++)s[n]=e[n];return s}}function m4(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function h4(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function Jd(e){return f4(e)||m4(e)||h4()}function ds(){return ds=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},ds.apply(this,arguments)}function p4(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function y4(e,n){for(var s=0;s<n.length;s++){var i=n[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function g4(e,n,s){return n&&y4(e.prototype,n),e}function pn(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jy(e,n){return jy=Object.setPrototypeOf||function(i,l){return i.__proto__=l,i},jy(e,n)}function b4(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&jy(e,n)}function Ol(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ol=function(s){return typeof s}:Ol=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},Ol(e)}function $d(e){return typeof Symbol=="function"&&Ol(Symbol.iterator)==="symbol"?$d=function(s){return Ol(s)}:$d=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":Ol(s)},$d(e)}function x4(e,n){return n&&($d(n)==="object"||typeof n=="function")?n:pn(e)}function ef(e){return ef=Object.setPrototypeOf?Object.getPrototypeOf:function(s){return s.__proto__||Object.getPrototypeOf(s)},ef(e)}function fn(e,n,s){return n in e?Object.defineProperty(e,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[n]=s,e}var jp,US;function v4(){if(US)return jp;US=1;var e=function(n,s,i,l,o,d,m,p){if(!n){var h;if(s===void 0)h=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var y=[i,l,o,d,m,p],g=0;h=new Error(s.replace(/%s/g,function(){return y[g++]})),h.name="Invariant Violation"}throw h.framesToPop=1,h}};return jp=e,jp}var S4=v4();const ql=zi(S4);function w4(e){if(Array.isArray(e))return e}function N4(e,n){var s=[],i=!0,l=!1,o=void 0;try{for(var d=e[Symbol.iterator](),m;!(i=(m=d.next()).done)&&(s.push(m.value),!(n&&s.length===n));i=!0);}catch(p){l=!0,o=p}finally{try{!i&&d.return!=null&&d.return()}finally{if(l)throw o}}return s}function j4(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function tf(e,n){return w4(e)||N4(e,n)||j4()}function E4(e,n){if(e==null)return{};var s={},i=Object.keys(e),l,o;for(o=0;o<i.length;o++)l=i[o],!(n.indexOf(l)>=0)&&(s[l]=e[l]);return s}function _4(e,n){if(e==null)return{};var s=E4(e,n),i,l;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(l=0;l<o.length;l++)i=o[l],!(n.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(s[i]=e[i])}return s}var Ep,qS;function C4(){if(qS)return Ep;qS=1;function e(n,s,i){return s in n?Object.defineProperty(n,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[s]=i,n}return Ep=e,Ep}var A4=C4();const Tc=zi(A4);var _p,PS;function T4(){if(PS)return _p;PS=1;function e(n){if(Array.isArray(n)){for(var s=0,i=new Array(n.length);s<n.length;s++)i[s]=n[s];return i}}return _p=e,_p}var Cp,HS;function M4(){if(HS)return Cp;HS=1;function e(n){if(Symbol.iterator in Object(n)||Object.prototype.toString.call(n)==="[object Arguments]")return Array.from(n)}return Cp=e,Cp}var Ap,VS;function k4(){if(VS)return Ap;VS=1;function e(){throw new TypeError("Invalid attempt to spread non-iterable instance")}return Ap=e,Ap}var Tp,YS;function R4(){if(YS)return Tp;YS=1;var e=T4(),n=M4(),s=k4();function i(l){return e(l)||n(l)||s()}return Tp=i,Tp}var I4=R4();const mr=zi(I4);var Jl=function(n){return n===Object(n)?Object.keys(n):[]},S1=function(n){return n===Object(n)?Object.values(n):[]};function w1(e,n){var s=Object.assign({},e);return Fd(e)&&Fd(n)&&Jl(n).forEach(function(i){Fd(n[i])?i in e?s[i]=w1(e[i],n[i]):Object.assign(s,Tc({},i,n[i])):Object.assign(s,Tc({},i,n[i]))}),s}var Ey=function(n){for(var s=arguments.length,i=new Array(s>1?s-1:0),l=1;l<s;l++)i[l-1]=arguments[l];return i.reduce(function(o,d){return w1(o,d)},n)},D4=function(n,s){var i=Object.assign({},n);if(s)for(var l=0;l<s.length;l++)delete i[s[l]];return i},Fd=function(n){return n===Object(n)&&!(n instanceof Date)&&!Array.isArray(n)},L4=function(n){return(n||[]).filter(Boolean)},$g=function(n){return n[0]==="&"},O4=function(n){return!$g(n)},GS=function(n){return n.replace(/-(\w)/g,function(s,i){return i.toUpperCase()})},$4=function(n){for(var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=Jl(n),l={},o=0,d=i.length;o<d;o+=1){var m=i[o],p=Object.prototype.toString.call(n[m])!=="[object Object]"||m[0]===":"||m[0]==="@"||s.indexOf(m)>=0;p&&(l[m]=n[m])}return l},N1=function(n,s){for(var i=s.map(GS),l=Jl(n),o={},d=0,m=l.length;d<m;d+=1){var p=l[d];(s.indexOf(p)>=0||i.indexOf(GS(p))>=0)&&(o[p]=n[p])}return o},F4=function e(n,s){for(var i=Ey.apply(void 0,[{},D4(n,s)].concat(mr(S1(N1(n,s))))),l=Jl(i).filter($g),o=0,d=l.length;o<d;o+=1){var m=l[o],p=e(i[m],s);s.indexOf(m)>=0?(delete i[m],i=Ey({},i,p)):i[m]=p}return i};function KS(e,n){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),s.push.apply(s,i)}return s}function XS(e){for(var n=1;n<arguments.length;n++){var s=arguments[n]!=null?arguments[n]:{};n%2?KS(Object(s),!0).forEach(function(i){Tc(e,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):KS(Object(s)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(s,i))})}return e}var z4=["animationName"],j1=function(n){var s=n.style,i=n.className;return XS(XS({},s?{style:$4(s,z4)}:{}),i?{className:i}:{})},E1=u.createContext(j1);E1.Provider;var _1=function(n){if(n){if(typeof n=="string")return[n];if(!Array.isArray(n)){var s=n;return Jl(n).reduce(function(i,l){return i.concat(s[l]?[l]:[])},[])}}else return[];return n},B4={},U4=function(n){return function(s,i){var l=i||B4;n.memoize=n.memoize||new WeakMap;var o;n.memoize.has(l)?o=n.memoize.get(l):(o={},n.memoize.set(l,o));var d=_1(s).join(" ");return d in o?o[d]:o[d]=n(s||[],i)}};function WS(e,n){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),s.push.apply(s,i)}return s}function _l(e){for(var n=1;n<arguments.length;n++){var s=arguments[n]!=null?arguments[n]:{};n%2?WS(Object(s),!0).forEach(function(i){Tc(e,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):WS(Object(s)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(s,i))})}return e}var q4=function(n){var s=n&&Jl(n)[0];return s&&s.split("__")[0].split("--")[0]},P4=function(n,s,i){if(n){var l=n.split(" ")[0],o=[].concat(mr(s.length===0?i.map(function(d){return"".concat(l,"--").concat(d.substring(1))}):[]),mr(s.map(function(d){return"".concat(l,"__").concat(d)})));return s.length===0?[n].concat(mr(o)):o}};function C1(e){var n=e.style,s=e.className,i=e.classNames,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:j1,o=s||q4(i)||n?.className,d=typeof n=="function"?n:U4(function(g,x){var v=_1(g);ql(Array.isArray(v),"First parameter must be a string, an array of strings, a plain object with boolean values, or a falsy value."),ql(!x||Fd(x),"Optional second parameter must be a plain object.");var S=v.filter($g),N=v.filter(O4),E=N.length>0?function(T){return S1(N1(T,N))}:function(T){return[T]},j=function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return E(F4(_,S))},A=P4(o,N,S);return C1(_l(_l(_l({},(n||x)&&{style:Ey.apply(void 0,[{}].concat(mr(j(x)),mr(j(n))))}),A&&{className:A.join(" ")}),i&&{classNames:i}),l)}),m=_l({},typeof n=="function"?n:{style:n}),p=mr(new Set([].concat(mr(m.className?m.className.split(" "):[]),mr(o?o.split(" "):[])))),h=i?L4(p.map(function(g){return i[g]})):p,y=l(_l(_l({},m),h.length>0?{className:h.join(" ")}:{}));return Object.assign(d,y),d}function ZS(e,n){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),s.push.apply(s,i)}return s}function Jo(e){for(var n=1;n<arguments.length;n++){var s=arguments[n]!=null?arguments[n]:{};n%2?ZS(Object(s),!0).forEach(function(i){Tc(e,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ZS(Object(s)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(s,i))})}return e}var H4=function(){for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return s.reduce(function(l,o){return Jo(Jo(Jo({},l),typeof o=="function"?o:{}),{},{style:Jo(Jo({},l.style),typeof o=="function"?o.style:o)})},{})},Fg=function(n,s,i){var l=s.style,o=s.className,d=s.classNames,m=u.useContext(E1),p=u.useMemo(function(){return C1({style:l,className:o,classNames:d},m)},[l,o,d,m]);return p(i,n)},zd=function(n){return n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},Os={id:"__id__",display:"__display__"},QS=function(n,s){ql(s==="id"||s==="display",'Second arg must be either "id" or "display", got: "'.concat(s,'"'));var i=n.indexOf(Os.display),l=n.indexOf(Os.id);return i<0&&(i=null),l<0&&(l=null),ql(i!==null||l!==null,"The markup '".concat(n,"' does not contain either of the placeholders '__id__' or '__display__'")),i!==null&&l!==null?s==="id"&&l<=i||s==="display"&&i<=l?0:1:0},V4=function(n){var s=/^\/(.+)\/(\w+)?$/;return new RegExp(n.map(function(i){var l=s.exec(i.toString()),o=tf(l,3),d=o[1],m=o[2];return ql(!m,"RegExp flags are not supported. Change /".concat(d,"/").concat(m," into /").concat(d,"/")),"(".concat(d,")")}).join("|"),"g")},A1=function(n){var s=0;return n.indexOf("__id__")>=0&&s++,n.indexOf("__display__")>=0&&s++,s},Y4=function(){},Yc=function(n,s,i){for(var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Y4,o=V4(s.map(function(M){return M.regex})),d=2,m=s.map(function(M){var k=M.markup,C=d;return d+=A1(k)+1,C}),p,h=0,y=0;(p=o.exec(n))!==null;){var g=m.find(function(M){return!!p[M]}),x=m.indexOf(g),v=s[x],S=v.markup,N=v.displayTransform,E=g+QS(S,"id"),j=g+QS(S,"display"),A=p[E],T=N(A,p[j]),_=n.substring(h,p.index);l(_,h,y),y+=_.length,i(p[0],p.index,y,A,T,x,h),y+=T.length,h=o.lastIndex}h<n.length&&l(n.substring(h),h,y)},Ci=function(n,s){var i="";return Yc(n,s,function(l,o,d,m,p){i+=p},function(l){i+=l}),i},wa=function(n,s,i){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"START";if(typeof i!="number")return i;var o,d=function(h,y,g){o===void 0&&g+h.length>=i&&(o=y+i-g)},m=function(h,y,g,x,v,S,N){o===void 0&&g+v.length>i&&(l==="NULL"?o=null:o=y+(l==="END"?h.length:0))};return Yc(n,s,m,d),o===void 0?n.length:o},xc=function(n,s,i,l){return n.substring(0,s)+l+n.substring(i)},G4=function(n,s,i,l){var o=i.selectionStartBefore,d=i.selectionEndBefore,m=i.selectionEndAfter,p=Ci(n,l),h=p.length-s.length;o==="undefined"&&(o=m+h),d==="undefined"&&(d=o),o===d&&d===m&&p.length===s.length&&(o=o-1);var y=s.slice(o,m),g=Math.min(o,m),x=d;o===m&&(x=Math.max(d,o+h));var v=wa(n,l,g,"START"),S=wa(n,l,x,"END"),N=wa(n,l,g,"NULL"),E=wa(n,l,x,"NULL"),j=N===null||E===null,A=xc(n,v,S,y);if(!j){var T=Ci(A,l);if(T!==s){for(g=0;s[g]===T[g];)g++;y=s.slice(g,m),x=p.lastIndexOf(s.substring(m)),v=wa(n,l,g,"START"),S=wa(n,l,x,"END"),A=xc(n,v,S,y)}}return A},JS=function(n,s,i){var l=i,o=!1,d=function(p,h,y,g,x,v,S){y<=i&&y+x.length>i&&(l=y,o=!0)};if(Yc(n,s,d),o)return l},mc=function(n,s){var i=[];return Yc(n,s,function(l,o,d,m,p,h,y){i.push({id:m,display:p,childIndex:h,index:o,plainTextIndex:d})}),i},T1=function(n,s){return"".concat(n,"-").concat(s)},fd=function(n){return Object.values(n).reduce(function(s,i){var l=i.results;return s+l.length},0)},K4=function(n,s){var i=mc(n,s),l=i[i.length-1];return l?l.plainTextIndex+l.display.length:0},X4=function(n){var s=zd(n),i=n[n.indexOf(Os.display)+Os.display.length],l=n[n.indexOf(Os.id)+Os.id.length];return new RegExp(s.replace(Os.display,"([^".concat(zd(i||""),"]+?)")).replace(Os.id,"([^".concat(zd(l||""),"]+?)")))},Vr=function(n){return u.Children.toArray(n).map(function(s){var i=s.props,l=i.markup,o=i.regex,d=i.displayTransform;return{markup:l,regex:o?W4(o,l):X4(l),displayTransform:d||function(m,p){return p||m}}})},W4=function(n,s){var i=new RegExp(n.toString()+"|").exec("").length-1,l=A1(s);return ql(i===l,"Number of capturing groups in RegExp ".concat(n.toString()," (").concat(i,") does not match the number of placeholders in the markup '").concat(s,"' (").concat(l,")")),n},Z4=function(n,s,i){return n.replace(Os.id,s).replace(Os.display,i)},Q4=[{base:"A",letters:/(&#65;|&#9398;|&#65313;|&#192;|&#193;|&#194;|&#7846;|&#7844;|&#7850;|&#7848;|&#195;|&#256;|&#258;|&#7856;|&#7854;|&#7860;|&#7858;|&#550;|&#480;|&#196;|&#478;|&#7842;|&#197;|&#506;|&#461;|&#512;|&#514;|&#7840;|&#7852;|&#7862;|&#7680;|&#260;|&#570;|&#11375;|[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F])/g},{base:"AA",letters:/(&#42802;|[\uA732])/g},{base:"AE",letters:/(&#198;|&#508;|&#482;|[\u00C6\u01FC\u01E2])/g},{base:"AO",letters:/(&#42804;|[\uA734])/g},{base:"AU",letters:/(&#42806;|[\uA736])/g},{base:"AV",letters:/(&#42808;|&#42810;|[\uA738\uA73A])/g},{base:"AY",letters:/(&#42812;|[\uA73C])/g},{base:"B",letters:/(&#66;|&#9399;|&#65314;|&#7682;|&#7684;|&#7686;|&#579;|&#386;|&#385;|[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181])/g},{base:"C",letters:/(&#67;|&#9400;|&#65315;|&#262;|&#264;|&#266;|&#268;|&#199;|&#7688;|&#391;|&#571;|&#42814;|[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E])/g},{base:"D",letters:/(&#68;|&#9401;|&#65316;|&#7690;|&#270;|&#7692;|&#7696;|&#7698;|&#7694;|&#272;|&#395;|&#394;|&#393;|&#42873;|&#208;|[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779\u00D0])/g},{base:"DZ",letters:/(&#497;|&#452;|[\u01F1\u01C4])/g},{base:"Dz",letters:/(&#498;|&#453;|[\u01F2\u01C5])/g},{base:"E",letters:/(&#69;|&#9402;|&#65317;|&#200;|&#201;|&#202;|&#7872;|&#7870;|&#7876;|&#7874;|&#7868;|&#274;|&#7700;|&#7702;|&#276;|&#278;|&#203;|&#7866;|&#282;|&#516;|&#518;|&#7864;|&#7878;|&#552;|&#7708;|&#280;|&#7704;|&#7706;|&#400;|&#398;|[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E])/g},{base:"F",letters:/(&#70;|&#9403;|&#65318;|&#7710;|&#401;|&#42875;|[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B])/g},{base:"G",letters:/(&#71;|&#9404;|&#65319;|&#500;|&#284;|&#7712;|&#286;|&#288;|&#486;|&#290;|&#484;|&#403;|&#42912;|&#42877;|&#42878;|[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E])/g},{base:"H",letters:/(&#72;|&#9405;|&#65320;|&#292;|&#7714;|&#7718;|&#542;|&#7716;|&#7720;|&#7722;|&#294;|&#11367;|&#11381;|&#42893;|[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D])/g},{base:"I",letters:/(&#73;|&#9406;|&#65321;|&#204;|&#205;|&#206;|&#296;|&#298;|&#300;|&#304;|&#207;|&#7726;|&#7880;|&#463;|&#520;|&#522;|&#7882;|&#302;|&#7724;|&#407;|[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197])/g},{base:"J",letters:/(&#74;|&#9407;|&#65322;|&#308;|&#584;|[\u004A\u24BF\uFF2A\u0134\u0248])/g},{base:"K",letters:/(&#75;|&#9408;|&#65323;|&#7728;|&#488;|&#7730;|&#310;|&#7732;|&#408;|&#11369;|&#42816;|&#42818;|&#42820;|&#42914;|[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2])/g},{base:"L",letters:/(&#76;|&#9409;|&#65324;|&#319;|&#313;|&#317;|&#7734;|&#7736;|&#315;|&#7740;|&#7738;|&#321;|&#573;|&#11362;|&#11360;|&#42824;|&#42822;|&#42880;|[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780])/g},{base:"LJ",letters:/(&#455;|[\u01C7])/g},{base:"Lj",letters:/(&#456;|[\u01C8])/g},{base:"M",letters:/(&#77;|&#9410;|&#65325;|&#7742;|&#7744;|&#7746;|&#11374;|&#412;|[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C])/g},{base:"N",letters:/(&#78;|&#9411;|&#65326;|&#504;|&#323;|&#209;|&#7748;|&#327;|&#7750;|&#325;|&#7754;|&#7752;|&#544;|&#413;|&#42896;|&#42916;|&#330;|[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4\u014A])/g},{base:"NJ",letters:/(&#458;|[\u01CA])/g},{base:"Nj",letters:/(&#459;|[\u01CB])/g},{base:"O",letters:/(&#79;|&#9412;|&#65327;|&#210;|&#211;|&#212;|&#7890;|&#7888;|&#7894;|&#7892;|&#213;|&#7756;|&#556;|&#7758;|&#332;|&#7760;|&#7762;|&#334;|&#558;|&#560;|&#214;|&#554;|&#7886;|&#336;|&#465;|&#524;|&#526;|&#416;|&#7900;|&#7898;|&#7904;|&#7902;|&#7906;|&#7884;|&#7896;|&#490;|&#492;|&#216;|&#510;|&#390;|&#415;|&#42826;|&#42828;|[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C])/g},{base:"OE",letters:/(&#338;|[\u0152])/g},{base:"OI",letters:/(&#418;|[\u01A2])/g},{base:"OO",letters:/(&#42830;|[\uA74E])/g},{base:"OU",letters:/(&#546;|[\u0222])/g},{base:"P",letters:/(&#80;|&#9413;|&#65328;|&#7764;|&#7766;|&#420;|&#11363;|&#42832;|&#42834;|&#42836;|[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754])/g},{base:"Q",letters:/(&#81;|&#9414;|&#65329;|&#42838;|&#42840;|&#586;|[\u0051\u24C6\uFF31\uA756\uA758\u024A])/g},{base:"R",letters:/(&#82;|&#9415;|&#65330;|&#340;|&#7768;|&#344;|&#528;|&#530;|&#7770;|&#7772;|&#342;|&#7774;|&#588;|&#11364;|&#42842;|&#42918;|&#42882;|[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782])/g},{base:"S",letters:/(&#83;|&#9416;|&#65331;|&#7838;|&#346;|&#7780;|&#348;|&#7776;|&#352;|&#7782;|&#7778;|&#7784;|&#536;|&#350;|&#11390;|&#42920;|&#42884;|[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784])/g},{base:"T",letters:/(&#84;|&#9417;|&#65332;|&#7786;|&#356;|&#7788;|&#538;|&#354;|&#7792;|&#7790;|&#358;|&#428;|&#430;|&#574;|&#42886;|[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786])/g},{base:"TH",letters:/(&#222;|[\u00DE])/g},{base:"TZ",letters:/(&#42792;|[\uA728])/g},{base:"U",letters:/(&#85;|&#9418;|&#65333;|&#217;|&#218;|&#219;|&#360;|&#7800;|&#362;|&#7802;|&#364;|&#220;|&#475;|&#471;|&#469;|&#473;|&#7910;|&#366;|&#368;|&#467;|&#532;|&#534;|&#431;|&#7914;|&#7912;|&#7918;|&#7916;|&#7920;|&#7908;|&#7794;|&#370;|&#7798;|&#7796;|&#580;|[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244])/g},{base:"V",letters:/(&#86;|&#9419;|&#65334;|&#7804;|&#7806;|&#434;|&#42846;|&#581;|[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245])/g},{base:"VY",letters:/(&#42848;|[\uA760])/g},{base:"W",letters:/(&#87;|&#9420;|&#65335;|&#7808;|&#7810;|&#372;|&#7814;|&#7812;|&#7816;|&#11378;|[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72])/g},{base:"X",letters:/(&#88;|&#9421;|&#65336;|&#7818;|&#7820;|[\u0058\u24CD\uFF38\u1E8A\u1E8C])/g},{base:"Y",letters:/(&#89;|&#9422;|&#65337;|&#7922;|&#221;|&#374;|&#7928;|&#562;|&#7822;|&#376;|&#7926;|&#7924;|&#435;|&#590;|&#7934;|[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE])/g},{base:"Z",letters:/(&#90;|&#9423;|&#65338;|&#377;|&#7824;|&#379;|&#381;|&#7826;|&#7828;|&#437;|&#548;|&#11391;|&#11371;|&#42850;|[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762])/g},{base:"a",letters:/(&#97;|&#9424;|&#65345;|&#7834;|&#224;|&#225;|&#226;|&#7847;|&#7845;|&#7851;|&#7849;|&#227;|&#257;|&#259;|&#7857;|&#7855;|&#7861;|&#7859;|&#551;|&#481;|&#228;|&#479;|&#7843;|&#229;|&#507;|&#462;|&#513;|&#515;|&#7841;|&#7853;|&#7863;|&#7681;|&#261;|&#11365;|&#592;|[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250])/g},{base:"aa",letters:/(&#42803;|[\uA733])/g},{base:"ae",letters:/(&#230;|&#509;|&#483;|[\u00E6\u01FD\u01E3])/g},{base:"ao",letters:/(&#42805;|[\uA735])/g},{base:"au",letters:/(&#42807;|[\uA737])/g},{base:"av",letters:/(&#42809;|&#42811;|[\uA739\uA73B])/g},{base:"ay",letters:/(&#42813;|[\uA73D])/g},{base:"b",letters:/(&#98;|&#9425;|&#65346;|&#7683;|&#7685;|&#7687;|&#384;|&#387;|&#595;|[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253])/g},{base:"c",letters:/(&#99;|&#9426;|&#65347;|&#263;|&#265;|&#267;|&#269;|&#231;|&#7689;|&#392;|&#572;|&#42815;|&#8580;|[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184])/g},{base:"d",letters:/(&#100;|&#9427;|&#65348;|&#7691;|&#271;|&#7693;|&#7697;|&#7699;|&#7695;|&#273;|&#396;|&#598;|&#599;|&#42874;|&#240;|[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A\u00F0])/g},{base:"dz",letters:/(&#499;|&#454;|[\u01F3\u01C6])/g},{base:"e",letters:/(&#101;|&#9428;|&#65349;|&#232;|&#233;|&#234;|&#7873;|&#7871;|&#7877;|&#7875;|&#7869;|&#275;|&#7701;|&#7703;|&#277;|&#279;|&#235;|&#7867;|&#283;|&#517;|&#519;|&#7865;|&#7879;|&#553;|&#7709;|&#281;|&#7705;|&#7707;|&#583;|&#603;|&#477;|[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD])/g},{base:"f",letters:/(&#102;|&#9429;|&#65350;|&#7711;|&#402;|&#42876;|[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C])/g},{base:"g",letters:/(&#103;|&#9430;|&#65351;|&#501;|&#285;|&#7713;|&#287;|&#289;|&#487;|&#291;|&#485;|&#608;|&#42913;|&#7545;|&#42879;|[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F])/g},{base:"h",letters:/(&#104;|&#9431;|&#65352;|&#293;|&#7715;|&#7719;|&#543;|&#7717;|&#7721;|&#7723;|&#7830;|&#295;|&#11368;|&#11382;|&#613;|[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265])/g},{base:"hv",letters:/(&#405;|[\u0195])/g},{base:"i",letters:/(&#105;|&#9432;|&#65353;|&#236;|&#237;|&#238;|&#297;|&#299;|&#301;|&#239;|&#7727;|&#7881;|&#464;|&#521;|&#523;|&#7883;|&#303;|&#7725;|&#616;|&#305;|[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131])/g},{base:"ij",letters:/(&#307;|[\u0133])/g},{base:"j",letters:/(&#106;|&#9433;|&#65354;|&#309;|&#496;|&#585;|[\u006A\u24D9\uFF4A\u0135\u01F0\u0249])/g},{base:"k",letters:/(&#107;|&#9434;|&#65355;|&#7729;|&#489;|&#7731;|&#311;|&#7733;|&#409;|&#11370;|&#42817;|&#42819;|&#42821;|&#42915;|[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3])/g},{base:"l",letters:/(&#108;|&#9435;|&#65356;|&#320;|&#314;|&#318;|&#7735;|&#7737;|&#316;|&#7741;|&#7739;|&#322;|&#410;|&#619;|&#11361;|&#42825;|&#42881;|&#42823;|[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u0142\u019A\u026B\u2C61\uA749\uA781\uA747])/g},{base:"lj",letters:/(&#457;|[\u01C9])/g},{base:"m",letters:/(&#109;|&#9436;|&#65357;|&#7743;|&#7745;|&#7747;|&#625;|&#623;|[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F])/g},{base:"n",letters:/(&#110;|&#9437;|&#65358;|&#505;|&#324;|&#241;|&#7749;|&#328;|&#7751;|&#326;|&#7755;|&#7753;|&#414;|&#626;|&#329;|&#42897;|&#42917;|&#331;|[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5\u014B])/g},{base:"nj",letters:/(&#460;|[\u01CC])/g},{base:"o",letters:/(&#111;|&#9438;|&#65359;|&#242;|&#243;|&#244;|&#7891;|&#7889;|&#7895;|&#7893;|&#245;|&#7757;|&#557;|&#7759;|&#333;|&#7761;|&#7763;|&#335;|&#559;|&#561;|&#246;|&#555;|&#7887;|&#337;|&#466;|&#525;|&#527;|&#417;|&#7901;|&#7899;|&#7905;|&#7903;|&#7907;|&#7885;|&#7897;|&#491;|&#493;|&#248;|&#511;|&#596;|&#42827;|&#42829;|&#629;|[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275])/g},{base:"oe",letters:/(&#339;|[\u0153])/g},{base:"oi",letters:/(&#419;|[\u01A3])/g},{base:"ou",letters:/(&#547;|[\u0223])/g},{base:"oo",letters:/(&#42831;|[\uA74F])/g},{base:"p",letters:/(&#112;|&#9439;|&#65360;|&#7765;|&#7767;|&#421;|&#7549;|&#42833;|&#42835;|&#42837;|[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755])/g},{base:"q",letters:/(&#113;|&#9440;|&#65361;|&#587;|&#42839;|&#42841;|[\u0071\u24E0\uFF51\u024B\uA757\uA759])/g},{base:"r",letters:/(&#114;|&#9441;|&#65362;|&#341;|&#7769;|&#345;|&#529;|&#531;|&#7771;|&#7773;|&#343;|&#7775;|&#589;|&#637;|&#42843;|&#42919;|&#42883;|[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783])/g},{base:"s",letters:/(&#115;|&#9442;|&#65363;|&#347;|&#7781;|&#349;|&#7777;|&#353;|&#7783;|&#7779;|&#7785;|&#537;|&#351;|&#575;|&#42921;|&#42885;|&#7835;|&#383;|[\u0073\u24E2\uFF53\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B\u017F])/g},{base:"ss",letters:/(&#223;|[\u00DF])/g},{base:"t",letters:/(&#116;|&#9443;|&#65364;|&#7787;|&#7831;|&#357;|&#7789;|&#539;|&#355;|&#7793;|&#7791;|&#359;|&#429;|&#648;|&#11366;|&#42887;|[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787])/g},{base:"th",letters:/(&#254;|[\u00FE])/g},{base:"tz",letters:/(&#42793;|[\uA729])/g},{base:"u",letters:/(&#117;|&#9444;|&#65365;|&#249;|&#250;|&#251;|&#361;|&#7801;|&#363;|&#7803;|&#365;|&#252;|&#476;|&#472;|&#470;|&#474;|&#7911;|&#367;|&#369;|&#468;|&#533;|&#535;|&#432;|&#7915;|&#7913;|&#7919;|&#7917;|&#7921;|&#7909;|&#7795;|&#371;|&#7799;|&#7797;|&#649;|[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289])/g},{base:"v",letters:/(&#118;|&#9445;|&#65366;|&#7805;|&#7807;|&#651;|&#42847;|&#652;|[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C])/g},{base:"vy",letters:/(&#42849;|[\uA761])/g},{base:"w",letters:/(&#119;|&#9446;|&#65367;|&#7809;|&#7811;|&#373;|&#7815;|&#7813;|&#7832;|&#7817;|&#11379;|[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73])/g},{base:"x",letters:/(&#120;|&#9447;|&#65368;|&#7819;|&#7821;|[\u0078\u24E7\uFF58\u1E8B\u1E8D])/g},{base:"y",letters:/(&#121;|&#9448;|&#65369;|&#7923;|&#253;|&#375;|&#7929;|&#563;|&#7823;|&#255;|&#7927;|&#7833;|&#7925;|&#436;|&#591;|&#7935;|[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF])/g},{base:"z",letters:/(&#122;|&#9449;|&#65370;|&#378;|&#7825;|&#380;|&#382;|&#7827;|&#7829;|&#438;|&#549;|&#576;|&#11372;|&#42851;|[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763])/g}],J4=function(n){var s=n;return Q4.forEach(function(i){s=s.replace(i.letters,i.base)}),s},ew=function(n){return J4(n).toLowerCase()},M1=function(n,s,i){return i?ew(n).indexOf(ew(s)):n.toLowerCase().indexOf(s.toLowerCase())},e3=function(){return!!document.documentMode},_y=function(n){return typeof n=="number"},t3=function(n){return n===Object(n)?Object.keys(n):[]},n3=function(n){for(var s,i=arguments.length,l=new Array(i>1?i-1:0),o=1;o<i;o++)l[o-1]=arguments[o];var d=(s=[]).concat.apply(s,l);return Object.keys(n).reduce(function(m,p){return n.hasOwnProperty(p)&&!d.includes(p)&&n[p]!==void 0&&(m[p]=n[p]),m},{})},a3=["style","className","classNames"];function tw(e,n){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),s.push.apply(s,i)}return s}function nw(e){for(var n=1;n<arguments.length;n++){var s=arguments[n]!=null?arguments[n]:{};n%2?tw(Object(s),!0).forEach(function(i){fn(e,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):tw(Object(s)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(s,i))})}return e}function $f(e,n){var s=function(l){var o=function(p){var h=p.style,y=p.className,g=p.classNames,x=_4(p,a3),v=n?n(x):void 0,S=Fg(e,{style:h,className:y,classNames:g},v);return Ve.createElement(l,ds({},x,{style:S}))},d=l.displayName||l.name||"Component";return o.displayName="defaultStyle(".concat(d,")"),Ve.forwardRef(function(m,p){return o(nw(nw({},m),{},{ref:p}))})};return s}var s3=function(n,s){return n.hasOwnProperty(s)?n[s]++:n[s]=0,s+"_"+n[s]};function k1(e){var n=e.selectionStart,s=e.selectionEnd,i=e.value,l=i===void 0?"":i,o=e.onCaretPositionChange,d=e.containerRef,m=e.children;e.singleLine;var p=e.style,h=u.useState({left:void 0,top:void 0}),y=tf(h,2),g=y[0],x=y[1],v=u.useState(),S=tf(v,2),N=S[0],E=S[1];u.useEffect(function(){j()});var j=function(){if(N){var R=N.offsetLeft,B=N.offsetTop;if(!(g.left===R&&g.top===B)){var L={left:R,top:B};x(L),o(L)}}},A=Vr(m),T;s===n&&(T=wa(l,A,n,"START"));var _=[],M={},k=_,C=0,D=function(R,B,L){if(_y(T)&&T>=B&&T<=B+R.length){var O=T-B;k.push(G(R.substring(0,O),C)),k=[G(R.substring(O),C)]}else k.push(G(R,C));C++},z=function(R,B,L,O,$,F,H){var I=s3(M,O);k.push(U(O,$,F,I))},G=function(R,B){return Ve.createElement("span",ds({},p("substring"),{key:B}),R)},U=function(R,B,L,O){var $={id:R,display:B,key:O},F=u.Children.toArray(m)[L];return Ve.cloneElement(F,$)},X=function(R){return Ve.createElement("span",ds({},p("caret"),{ref:E,key:"caret"}),R)};return Yc(l,A,z,D),k.push(" "),k!==_&&_.push(X(k)),Ve.createElement("div",ds({},p,{ref:d}),_)}k1.propTypes={selectionStart:Dt.number,selectionEnd:Dt.number,value:Dt.string.isRequired,onCaretPositionChange:Dt.func.isRequired,containerRef:Dt.oneOfType([Dt.func,Dt.shape({current:typeof Element>"u"?Dt.any:Dt.instanceOf(Element)})]),children:Dt.oneOfType([Dt.element,Dt.arrayOf(Dt.element)]).isRequired};var r3=$f({position:"relative",boxSizing:"border-box",width:"100%",color:"transparent",overflow:"hidden",whiteSpace:"pre-wrap",wordWrap:"break-word",border:"1px solid transparent",textAlign:"start","&singleLine":{whiteSpace:"pre",wordWrap:null},substring:{visibility:"hidden"}},function(e){return{"&singleLine":e.singleLine}}),i3=r3(k1);function R1(e){var n=e.id,s=e.focused,i=e.ignoreAccents,l=e.index,o=e.onClick,d=e.onMouseEnter,m=e.query,p=e.renderSuggestion,h=e.suggestion,y=e.style;e.className,e.classNames;var g={onClick:o,onMouseEnter:d},x=function(){var E=v(),j=S(E);return p?p(h,m,j,l,s):j},v=function(){if(typeof h=="string")return h;var E=h.id,j=h.display;return E===void 0||!j?E:j},S=function(E){var j=M1(E,m,i);return j===-1?Ve.createElement("span",y("display"),E):Ve.createElement("span",y("display"),E.substring(0,j),Ve.createElement("b",y("highlight"),E.substring(j,j+m.length)),E.substring(j+m.length))};return Ve.createElement("li",ds({id:n,role:"option","aria-selected":s},g,y),x())}R1.propTypes={id:Dt.string.isRequired,query:Dt.string.isRequired,index:Dt.number.isRequired,ignoreAccents:Dt.bool,suggestion:Dt.oneOfType([Dt.string,Dt.shape({id:Dt.oneOfType([Dt.string,Dt.number]).isRequired,display:Dt.string})]).isRequired,renderSuggestion:Dt.func,focused:Dt.bool};var l3=$f({cursor:"pointer"},function(e){return{"&focused":e.focused}}),o3=l3(R1);function c3(e){var n=e.style,s=e.className,i=e.classNames,l=Fg(u3,{style:n,className:s,classNames:i}),o=l("spinner");return Ve.createElement("div",l,Ve.createElement("div",o,Ve.createElement("div",o(["element","element1"])),Ve.createElement("div",o(["element","element2"])),Ve.createElement("div",o(["element","element3"])),Ve.createElement("div",o(["element","element4"])),Ve.createElement("div",o(["element","element5"]))))}var u3={};function I1(e){var n=e.id,s=e.suggestions,i=s===void 0?{}:s,l=e.a11ySuggestionsListLabel,o=e.focusIndex,d=e.position,m=e.left,p=e.right,h=e.top,y=e.scrollFocusedIntoView,g=e.isLoading,x=e.isOpened,v=e.onSelect,S=v===void 0?function(){return null}:v,N=e.ignoreAccents,E=e.containerRef,j=e.children,A=e.style,T=e.customSuggestionsContainer,_=e.onMouseDown,M=e.onMouseEnter,k=u.useState(void 0),C=tf(k,2),D=C[0],z=C[1];u.useEffect(function(){if(!(!D||D.offsetHeight>=D.scrollHeight||!y)){var L=D.scrollTop,O=D.children[o].getBoundingClientRect(),$=O.top,F=O.bottom,H=D.getBoundingClientRect(),I=H.top;$=$-I+L,F=F-I+L,$<L?D.scrollTop=$:F>D.offsetHeight&&(D.scrollTop=F-D.offsetHeight)}},[o,y,D]);var G=function(){var O=Ve.createElement("ul",ds({ref:z,id:n,role:"listbox","aria-label":l},A("list")),Object.values(i).reduce(function($,F){var H=F.results,I=F.queryInfo;return[].concat(Jd($),Jd(H.map(function(Y,P){return U(Y,I,$.length+P)})))},[]));return T?T(O):O},U=function(O,$,F){var H=F===o,I=$.childIndex,Y=$.query,P=u.Children.toArray(j)[I].props.renderSuggestion;return Ve.createElement(o3,{style:A("item"),key:"".concat(I,"-").concat(B(O)),id:T1(n,F),query:Y,index:F,ignoreAccents:N,renderSuggestion:P,suggestion:O,focused:H,onClick:function(){return R(O,$)},onMouseEnter:function(){return V(F)}})},X=function(){if(g)return Ve.createElement(c3,{style:A("loadingIndicator")})},V=function(O,$){M&&M(O)},R=function(O,$){S(O,$)},B=function(O){return typeof O=="string"?O:O.id};return x?Ve.createElement("div",ds({},H4({position:d||"absolute",left:m,right:p,top:h},A),{onMouseDown:_,ref:E}),G(),X()):null}I1.propTypes={id:Dt.string.isRequired,suggestions:Dt.object.isRequired,a11ySuggestionsListLabel:Dt.string,focusIndex:Dt.number,position:Dt.string,left:Dt.number,right:Dt.number,top:Dt.number,scrollFocusedIntoView:Dt.bool,isLoading:Dt.bool,isOpened:Dt.bool.isRequired,onSelect:Dt.func,ignoreAccents:Dt.bool,customSuggestionsContainer:Dt.func,containerRef:Dt.oneOfType([Dt.func,Dt.shape({current:typeof Element>"u"?Dt.any:Dt.instanceOf(Element)})])};var d3=$f({zIndex:1,backgroundColor:"white",marginTop:14,minWidth:100,list:{margin:0,padding:0,listStyleType:"none"}}),f3=d3(I1);function aw(e,n){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),s.push.apply(s,i)}return s}function xs(e){for(var n=1;n<arguments.length;n++){var s=arguments[n]!=null?arguments[n]:{};n%2?aw(Object(s),!0).forEach(function(i){fn(e,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):aw(Object(s)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(s,i))})}return e}function m3(e){var n=h3();return function(){var i=ef(e),l;if(n){var o=ef(this).constructor;l=Reflect.construct(i,arguments,o)}else l=i.apply(this,arguments);return x4(this,l)}}function h3(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var p3=function(n){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n instanceof RegExp)return n;var i=s.allowSpaceInQuery,l=zd(n);return new RegExp("(?:^|\\s)(".concat(l,"([^").concat(i?"":"\\s").concat(l,"]*))$"))},y3=function(n,s){return n instanceof Array?function(i,l){for(var o=[],d=0,m=n.length;d<m;++d){var p=n[d].display||n[d].id;M1(p,i,s)>=0&&o.push(n[d])}return o}:n},Cl={TAB:9,RETURN:13,ESC:27,UP:38,DOWN:40},md=!1,D1={singleLine:Dt.bool,allowSpaceInQuery:Dt.bool,allowSuggestionsAboveCursor:Dt.bool,forceSuggestionsAboveCursor:Dt.bool,ignoreAccents:Dt.bool,a11ySuggestionsListLabel:Dt.string,value:Dt.string,onKeyDown:Dt.func,customSuggestionsContainer:Dt.func,onSelect:Dt.func,onBlur:Dt.func,onChange:Dt.func,suggestionsPortalHost:typeof Element>"u"?Dt.any:Dt.PropTypes.instanceOf(Element),inputRef:Dt.oneOfType([Dt.func,Dt.shape({current:typeof Element>"u"?Dt.any:Dt.instanceOf(Element)})]),children:Dt.oneOfType([Dt.element,Dt.arrayOf(Dt.element)]).isRequired},zg=(function(e){b4(s,e);var n=m3(s);function s(i){var l;return p4(this,s),l=n.call(this,i),fn(pn(l),"setContainerElement",function(o){l.containerElement=o}),fn(pn(l),"getInputProps",function(){var o=l.props,d=o.readOnly,m=o.disabled,p=o.style,h=n3(l.props,["style","classNames","className"],t3(D1));return xs(xs(xs(xs({},h),p("input")),{},{value:l.getPlainText(),onScroll:l.updateHighlighterScroll},!d&&!m&&{onChange:l.handleChange,onSelect:l.handleSelect,onKeyDown:l.handleKeyDown,onBlur:l.handleBlur,onCompositionStart:l.handleCompositionStart,onCompositionEnd:l.handleCompositionEnd}),l.isOpened()&&{role:"combobox","aria-controls":l.uuidSuggestionsOverlay,"aria-expanded":!0,"aria-autocomplete":"list","aria-haspopup":"listbox","aria-activedescendant":T1(l.uuidSuggestionsOverlay,l.state.focusIndex)})}),fn(pn(l),"renderControl",function(){var o=l.props,d=o.singleLine,m=o.style,p=l.getInputProps();return Ve.createElement("div",m("control"),l.renderHighlighter(),d?l.renderInput(p):l.renderTextarea(p))}),fn(pn(l),"renderInput",function(o){return Ve.createElement("input",ds({type:"text",ref:l.setInputRef},o))}),fn(pn(l),"renderTextarea",function(o){return Ve.createElement("textarea",ds({ref:l.setInputRef},o))}),fn(pn(l),"setInputRef",function(o){l.inputElement=o;var d=l.props.inputRef;typeof d=="function"?d(o):d&&(d.current=o)}),fn(pn(l),"setSuggestionsElement",function(o){l.suggestionsElement=o}),fn(pn(l),"renderSuggestionsOverlay",function(){if(!_y(l.state.selectionStart))return null;var o=l.state.suggestionsPosition,d=o.position,m=o.left,p=o.top,h=o.right,y=Ve.createElement(f3,{id:l.uuidSuggestionsOverlay,style:l.props.style("suggestions"),position:d,left:m,top:p,right:h,focusIndex:l.state.focusIndex,scrollFocusedIntoView:l.state.scrollFocusedIntoView,containerRef:l.setSuggestionsElement,suggestions:l.state.suggestions,customSuggestionsContainer:l.props.customSuggestionsContainer,onSelect:l.addMention,onMouseDown:l.handleSuggestionsMouseDown,onMouseEnter:l.handleSuggestionsMouseEnter,isLoading:l.isLoading(),isOpened:l.isOpened(),ignoreAccents:l.props.ignoreAccents,a11ySuggestionsListLabel:l.props.a11ySuggestionsListLabel},l.props.children);return l.props.suggestionsPortalHost?rj.createPortal(y,l.props.suggestionsPortalHost):y}),fn(pn(l),"renderHighlighter",function(){var o=l.state,d=o.selectionStart,m=o.selectionEnd,p=l.props,h=p.singleLine,y=p.children,g=p.value,x=p.style;return Ve.createElement(i3,{containerRef:l.setHighlighterElement,style:x("highlighter"),value:g,singleLine:h,selectionStart:d,selectionEnd:m,onCaretPositionChange:l.handleCaretPositionChange},y)}),fn(pn(l),"setHighlighterElement",function(o){l.highlighterElement=o}),fn(pn(l),"handleCaretPositionChange",function(o){l.setState({caretPosition:o})}),fn(pn(l),"getPlainText",function(){return Ci(l.props.value||"",Vr(l.props.children))}),fn(pn(l),"executeOnChange",function(o){for(var d=arguments.length,m=new Array(d>1?d-1:0),p=1;p<d;p++)m[p-1]=arguments[p];if(l.props.onChange){var h;return(h=l.props).onChange.apply(h,[o].concat(m))}if(l.props.valueLink){var y;return(y=l.props.valueLink).requestChange.apply(y,[o.target.value].concat(m))}}),fn(pn(l),"handleChange",function(o){if(md=!1,e3()){var d=document.activeElement&&document.activeElement.contentDocument||document;if(d.activeElement!==o.target)return}var m=l.props.value||"",p=Vr(l.props.children),h=o.target.value,y=l.state.selectionStart;y==null&&(y=o.target.selectionStart);var g=l.state.selectionEnd;g==null&&(g=o.target.selectionEnd);var x=G4(m,h,{selectionStartBefore:y,selectionEndBefore:g,selectionEndAfter:o.target.selectionEnd},p);h=Ci(x,p);var v=o.target.selectionStart,S=o.target.selectionEnd,N=!1,E=JS(m,p,v);E!==void 0&&l.state.selectionEnd>E&&(v=E+(o.nativeEvent.data?o.nativeEvent.data.length:0),S=v,N=!0),l.setState({selectionStart:v,selectionEnd:S,setSelectionAfterMentionChange:N});var j=mc(x,p);o.nativeEvent.isComposing&&v===S&&l.updateMentionsQueries(l.inputElement.value,v);var A={target:{value:x}};l.executeOnChange(A,x,h,j)}),fn(pn(l),"handleSelect",function(o){if(l.setState({selectionStart:o.target.selectionStart,selectionEnd:o.target.selectionEnd}),!md){var d=l.inputElement;o.target.selectionStart===o.target.selectionEnd?l.updateMentionsQueries(d.value,o.target.selectionStart):l.clearSuggestions(),l.updateHighlighterScroll(),l.props.onSelect(o)}}),fn(pn(l),"handleKeyDown",function(o){var d=fd(l.state.suggestions);if(d===0||!l.suggestionsElement){l.props.onKeyDown(o);return}switch(Object.values(Cl).indexOf(o.keyCode)>=0&&(o.preventDefault(),o.stopPropagation()),o.keyCode){case Cl.ESC:{l.clearSuggestions();return}case Cl.DOWN:{l.shiftFocus(1);return}case Cl.UP:{l.shiftFocus(-1);return}case Cl.RETURN:{l.selectFocused();return}case Cl.TAB:{l.selectFocused();return}default:return}}),fn(pn(l),"shiftFocus",function(o){var d=fd(l.state.suggestions);l.setState({focusIndex:(d+l.state.focusIndex+o)%d,scrollFocusedIntoView:!0})}),fn(pn(l),"selectFocused",function(){var o=l.state,d=o.suggestions,m=o.focusIndex,p=Object.values(d).reduce(function(g,x){var v=x.results,S=x.queryInfo;return[].concat(Jd(g),Jd(v.map(function(N){return{result:N,queryInfo:S}})))},[])[m],h=p.result,y=p.queryInfo;l.addMention(h,y),l.setState({focusIndex:0})}),fn(pn(l),"handleBlur",function(o){var d=l._suggestionsMouseDown;l._suggestionsMouseDown=!1,d||l.setState({selectionStart:null,selectionEnd:null}),window.setTimeout(function(){l.updateHighlighterScroll()},1),l.props.onBlur(o,d)}),fn(pn(l),"handleSuggestionsMouseDown",function(o){l._suggestionsMouseDown=!0}),fn(pn(l),"handleSuggestionsMouseEnter",function(o){l.setState({focusIndex:o,scrollFocusedIntoView:!1})}),fn(pn(l),"updateSuggestionsPosition",function(){var o=l.state.caretPosition,d=l.props,m=d.suggestionsPortalHost,p=d.allowSuggestionsAboveCursor,h=d.forceSuggestionsAboveCursor;if(!(!o||!l.suggestionsElement)){var y=l.suggestionsElement,g=l.highlighterElement,x=g.getBoundingClientRect(),v=Mp(g,"font-size"),S={left:x.left+o.left,top:x.top+o.top+v},N=Math.max(document.documentElement.clientHeight,window.innerHeight||0);if(y){var E={};if(m){E.position="fixed";var j=S.left,A=S.top;j-=Mp(y,"margin-left"),A-=Mp(y,"margin-top"),j-=g.scrollLeft,A-=g.scrollTop;var T=Math.max(document.documentElement.clientWidth,window.innerWidth||0);j+y.offsetWidth>T?E.left=Math.max(0,T-y.offsetWidth):E.left=j,p&&A+y.offsetHeight>N&&y.offsetHeight<A-v||h?E.top=Math.max(0,A-y.offsetHeight-v):E.top=A}else{var _=o.left-g.scrollLeft,M=o.top-g.scrollTop;_+y.offsetWidth>l.containerElement.offsetWidth?E.right=0:E.left=_,p&&S.top-g.scrollTop+y.offsetHeight>N&&y.offsetHeight<x.top-v-g.scrollTop||h?E.top=M-y.offsetHeight-v:E.top=M}E.left===l.state.suggestionsPosition.left&&E.top===l.state.suggestionsPosition.top&&E.position===l.state.suggestionsPosition.position||l.setState({suggestionsPosition:E})}}}),fn(pn(l),"updateHighlighterScroll",function(){var o=l.inputElement,d=l.highlighterElement;!o||!d||(d.scrollLeft=o.scrollLeft,d.scrollTop=o.scrollTop,d.height=o.height)}),fn(pn(l),"handleCompositionStart",function(){md=!0}),fn(pn(l),"handleCompositionEnd",function(){md=!1}),fn(pn(l),"setSelection",function(o,d){if(!(o===null||d===null)){var m=l.inputElement;if(m.setSelectionRange)m.setSelectionRange(o,d);else if(m.createTextRange){var p=m.createTextRange();p.collapse(!0),p.moveEnd("character",d),p.moveStart("character",o),p.select()}}}),fn(pn(l),"updateMentionsQueries",function(o,d){l._queryId++,l.suggestions={},l.setState({suggestions:{}});var m=l.props.value||"",p=l.props.children,h=Vr(p),y=wa(m,h,d,"NULL");if(y!==null){var g=K4(m.substring(0,y),h),x=o.substring(g,d);Ve.Children.forEach(p,function(v,S){if(v){var N=p3(v.props.trigger,l.props),E=x.match(N);if(E){var j=g+x.indexOf(E[1],E.index);l.queryData(E[2],S,j,j+E[1].length,o)}}})}}),fn(pn(l),"clearSuggestions",function(){l._queryId++,l.suggestions={},l.setState({suggestions:{},focusIndex:0})}),fn(pn(l),"queryData",function(o,d,m,p,h){var y=l.props,g=y.children,x=y.ignoreAccents,v=u.Children.toArray(g)[d],S=y3(v.props.data,x),N=S(o,l.updateSuggestions.bind(null,l._queryId,d,o,m,p,h));N instanceof Array&&l.updateSuggestions(l._queryId,d,o,m,p,h,N)}),fn(pn(l),"updateSuggestions",function(o,d,m,p,h,y,g){if(o===l._queryId){l.suggestions=xs(xs({},l.suggestions),{},fn({},d,{queryInfo:{childIndex:d,query:m,querySequenceStart:p,querySequenceEnd:h,plainTextValue:y},results:g}));var x=l.state.focusIndex,v=fd(l.suggestions);l.setState({suggestions:l.suggestions,focusIndex:x>=v?Math.max(v-1,0):x})}}),fn(pn(l),"addMention",function(o,d){var m=o.id,p=o.display,h=d.childIndex,y=d.querySequenceStart,g=d.querySequenceEnd,x=d.plainTextValue,v=l.props.value||"",S=Vr(l.props.children),N=u.Children.toArray(l.props.children)[h],E=N.props,j=E.markup,A=E.displayTransform,T=E.appendSpaceOnAdd,_=E.onAdd,M=wa(v,S,y,"START"),k=M+g-y,C=Z4(j,m,p);T&&(C+=" ");var D=xc(v,M,k,C);l.inputElement.focus();var z=A(m,p);T&&(z+=" ");var G=y+z.length;l.setState({selectionStart:G,selectionEnd:G,setSelectionAfterMentionChange:!0});var U={target:{value:D}},X=mc(D,S),V=xc(x,y,g,z);l.executeOnChange(U,D,V,X),_&&_(m,p,M,k),l.clearSuggestions()}),fn(pn(l),"isLoading",function(){var o=!1;return Ve.Children.forEach(l.props.children,function(d){o=o||d&&d.props.isLoading}),o}),fn(pn(l),"isOpened",function(){return _y(l.state.selectionStart)&&(fd(l.state.suggestions)!==0||l.isLoading())}),fn(pn(l),"_queryId",0),l.suggestions={},l.uuidSuggestionsOverlay=Math.random().toString(16).substring(2),l.handleCopy=l.handleCopy.bind(pn(l)),l.handleCut=l.handleCut.bind(pn(l)),l.handlePaste=l.handlePaste.bind(pn(l)),l.state={focusIndex:0,selectionStart:null,selectionEnd:null,suggestions:{},caretPosition:null,suggestionsPosition:{},setSelectionAfterHandlePaste:!1},l}return g4(s,[{key:"componentDidMount",value:function(){document.addEventListener("copy",this.handleCopy),document.addEventListener("cut",this.handleCut),document.addEventListener("paste",this.handlePaste),this.updateSuggestionsPosition()}},{key:"componentDidUpdate",value:function(l,o){o.suggestionsPosition===this.state.suggestionsPosition&&this.updateSuggestionsPosition(),this.state.setSelectionAfterMentionChange&&(this.setState({setSelectionAfterMentionChange:!1}),this.setSelection(this.state.selectionStart,this.state.selectionEnd)),this.state.setSelectionAfterHandlePaste&&(this.setState({setSelectionAfterHandlePaste:!1}),this.setSelection(this.state.selectionStart,this.state.selectionEnd))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("copy",this.handleCopy),document.removeEventListener("cut",this.handleCut),document.removeEventListener("paste",this.handlePaste)}},{key:"render",value:function(){return Ve.createElement("div",ds({ref:this.setContainerElement},this.props.style),this.renderControl(),this.renderSuggestionsOverlay())}},{key:"handlePaste",value:function(l){if(l.target===this.inputElement&&this.supportsClipboardActions(l)){l.preventDefault();var o=this.state,d=o.selectionStart,m=o.selectionEnd,p=this.props,h=p.value,y=p.children,g=Vr(y),x=wa(h,g,d,"START"),v=wa(h,g,m,"END"),S=l.clipboardData.getData("text/react-mentions"),N=l.clipboardData.getData("text/plain"),E=xc(h,x,v,S||N).replace(/\r/g,""),j=Ci(E,g),A={target:xs(xs({},l.target),{},{value:E})};this.executeOnChange(A,E,j,mc(E,g));var T=JS(h,g,d),_=(T||d)+Ci(S||N,g).length;this.setState({selectionStart:_,selectionEnd:_,setSelectionAfterHandlePaste:!0})}}},{key:"saveSelectionToClipboard",value:function(l){var o=this.inputElement.selectionStart,d=this.inputElement.selectionEnd,m=this.props,p=m.children,h=m.value,y=Vr(p),g=wa(h,y,o,"START"),x=wa(h,y,d,"END");l.clipboardData.setData("text/plain",l.target.value.slice(o,d)),l.clipboardData.setData("text/react-mentions",h.slice(g,x))}},{key:"supportsClipboardActions",value:function(l){return!!l.clipboardData}},{key:"handleCopy",value:function(l){l.target===this.inputElement&&this.supportsClipboardActions(l)&&(l.preventDefault(),this.saveSelectionToClipboard(l))}},{key:"handleCut",value:function(l){if(l.target===this.inputElement&&this.supportsClipboardActions(l)){l.preventDefault(),this.saveSelectionToClipboard(l);var o=this.state,d=o.selectionStart,m=o.selectionEnd,p=this.props,h=p.children,y=p.value,g=Vr(h),x=wa(y,g,d,"START"),v=wa(y,g,m,"END"),S=[y.slice(0,x),y.slice(v)].join(""),N=Ci(S,g),E={target:xs(xs({},l.target),{},{value:N})};this.executeOnChange(E,S,N,mc(y,g))}}}]),s})(Ve.Component);fn(zg,"propTypes",D1);fn(zg,"defaultProps",{ignoreAccents:!1,singleLine:!1,allowSuggestionsAboveCursor:!1,onKeyDown:function(){return null},onSelect:function(){return null},onBlur:function(){return null}});var Mp=function(n,s){var i=parseFloat(window.getComputedStyle(n,null).getPropertyValue(s));return isFinite(i)?i:0},g3=typeof navigator<"u"&&/iPhone|iPad|iPod/i.test(navigator.userAgent),b3=$f({position:"relative",overflowY:"visible",input:{display:"block",width:"100%",position:"absolute",margin:0,top:0,left:0,boxSizing:"border-box",backgroundColor:"transparent",fontFamily:"inherit",fontSize:"inherit",letterSpacing:"inherit"},"&multiLine":{input:xs({height:"100%",bottom:0,overflow:"hidden",resize:"none"},g3?{marginTop:1,marginLeft:-3}:null)}},function(e){var n=e.singleLine;return{"&singleLine":n,"&multiLine":!n}}),x3=b3(zg),v3={fontWeight:"inherit"},ti=function(n){var s=n.display,i=n.style,l=n.className,o=n.classNames,d=Fg(v3,{style:i,className:l,classNames:o});return Ve.createElement("strong",d,s)};ti.propTypes={onAdd:Dt.func,onRemove:Dt.func,renderSuggestion:Dt.func,trigger:Dt.oneOfType([Dt.string,Dt.instanceOf(RegExp)]),markup:Dt.string,displayTransform:Dt.func,allowSpaceInQuery:Dt.bool,isLoading:Dt.bool};ti.defaultProps={trigger:"@",markup:"@[__display__](__id__)",displayTransform:function(n,s){return s||n},onAdd:function(){return null},onRemove:function(){return null},renderSuggestion:null,isLoading:!1,appendSpaceOnAdd:!1};function Pl({inputProps:e,...n}){const s=u.useRef(null);return u.useEffect(()=>{if(!s.current||!e)return;const i=()=>{const l=s.current?.querySelector("textarea");return l?(Object.entries(e).forEach(([o,d])=>{if(d!=null)if(o==="className"){const m=l.className||"";l.className=m?`${m} ${d}`.trim():d}else if(o.startsWith("data-")||o.startsWith("aria-"))l.setAttribute(o,String(d));else if(o==="rows")l.setAttribute("rows",String(d));else if(o==="required")l.required=!!d;else if(o==="id")l.id=String(d);else try{typeof d=="boolean"?d?l.setAttribute(o,""):l.removeAttribute(o):l[o]=d}catch{try{l.setAttribute(o,String(d))}catch{}}}),!0):!1};if(!i()){const l=setTimeout(()=>{i()},10);return()=>clearTimeout(l)}},[e]),t.jsx("div",{ref:s,children:t.jsx(x3,{...n})})}const S3=/\s*\(([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\)$/i,w3=/\(([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\)/gi,Cy=e=>{if(!e)return"";let n=String(e).trim();return n=n.replace(S3,"").trim(),n=n.replace(w3,"").trim(),n},Oi=(e="",n=[])=>{const s=typeof e=="string"?e:"";if(!s)return[];const i=Array.isArray(n)?n:[],l=new Map;i.forEach(h=>{if(!h)return;const y=h.entityId??h.entity_id??h.id??h.entityID??null,g=h.locationId??h.location_id??null,x=h.type??h.mentionType??(g?"location":"entity"),v=y||g;if(!v)return;const S=String(v),N=`${x}:${S}`;if(l.has(N))return;const E=h.entityName??h.entity_name??h.locationName??h.location_name??h.label??h.name,j=E?Cy(E):"";x==="location"?(l.set(N,{locationId:S,locationName:j,type:"location"}),l.set(S,{locationId:S,locationName:j,type:"location"})):(l.set(N,{entityId:S,entityName:j,type:"entity"}),l.set(S,{entityId:S,entityName:j,type:"entity"}))});const o=[],d=/@\[(.+?)]\(([^)]+)\)/g;let m=0,p;for(;(p=d.exec(s))!==null;){if(p.index>m){const N=s.slice(m,p.index);N.trim().length>0&&o.push({type:"text",text:N})}const h=String(p[2]).trim(),y=p[1],g=Cy(y)||String(y??"").trim();let x=h.trim(),v=null;if(h.includes(":")){const N=h.split(":");N.length===2&&(v=N[0].trim(),x=N[1].trim())}if(x=x.trim(),!x){m=d.lastIndex;continue}let S=l.get(x);if(!S&&v){const N=`${v}:${x}`;S=l.get(N)}if(!S){const N=i.find(E=>{if(!E)return!1;const j=String(E.entityId??E.entity_id??E.id??E.entityID??"").trim(),A=String(E.locationId??E.location_id??"").trim();return j&&j===x||A&&A===x});if(N){const E=N.type??N.mentionType??(N.locationId||N.location_id?"location":"entity"),j=N.locationName??N.location_name??N.entityName??N.entity_name??N.label??N.name??g;E==="location"?S={locationId:x,locationName:j,type:"location"}:S={entityId:x,entityName:j,type:"entity"}}else v==="location"?S={locationId:x,locationName:g,type:"location"}:S={entityId:x,entityName:g,type:"entity"}}if(S||(v==="location"?S={locationId:x,locationName:g||"location",type:"location"}:S={entityId:x,entityName:g||"entity",type:"entity"}),S.entityId&&!S.entityName&&(S.entityName=g||"entity"),S.locationId&&!S.locationName&&(S.locationName=g||"location"),S&&(S.entityId||S.locationId)){const{type:N,...E}=S;o.push({type:"mention",...E})}else{const N={type:"mention",entityId:x||"unknown",entityName:g||"Unresolved",isPlaceholder:!0};o.push(N)}m=d.lastIndex}if(m<s.length){const h=s.slice(m);h.trim().length>0&&o.push({type:"text",text:h})}return o},N3={private:"Private",companions:"Shared with companions",dm:"Shared with DM",party:"Share with Party"},j3=[{value:"private",label:"Private"},{value:"companions",label:"My Companions"}],E3=[{value:"private",label:"Private"},{value:"party",label:"Share with Party"}],kp=e=>{if(!e)return"";if(e instanceof Date){if(Number.isNaN(e.getTime()))return"";try{return e.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(n){return console.warn("Unable to format Date object",n,e),""}}if(typeof e=="string"||typeof e=="number")try{const n=new Date(e);return Number.isNaN(n.getTime())?(console.warn("Invalid date value:",e),""):n.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(n){return console.warn("Unable to parse date value",n,e),""}return console.warn("Unexpected date value type:",typeof e,e),""},Rp=e=>e?.author?.username||e?.author?.name||e?.author?.email||e?.author_name||e?.author_email||"Unknown adventurer",sw=e=>{const n=e?.author||{},s=n?.id??n?.authorId??e?.authorId??e?.author_id??e?.authorID;if(s!=null)return`id:${String(s)}`;const i=n?.email??e?.author_email;if(i)return`email:${String(i).toLowerCase()}`;const l=n?.username??n?.name??e?.author_username??e?.author_name;return l?`name:${String(l).toLowerCase()}`:"unknown"},xa=Object.freeze([]),rw="What do you want to remember?";function L1({entity:e,worldId:n,selectedCampaign:s,selectedCampaignId:i,isCampaignDm:l,isCampaignPlayer:o,canCreateNote:d,notes:m=xa,loading:p,error:h,onCreateNote:y,creating:g,campaignMatchesEntityWorld:x,onNoteUpdate:v,onNoteDelete:S}){const{user:N}=un(),[E,j]=u.useState(""),[A,T]=u.useState("private"),[_,M]=u.useState(""),[k,C]=u.useState(xa),[D,z]=u.useState(!1),[G,U]=u.useState(""),[X,V]=u.useState(""),[R,B]=u.useState(""),[L,O]=u.useState(!1),[$,F]=u.useState("all"),[H,I]=u.useState("notes"),[Y,P]=u.useState("entity"),[K,re]=u.useState(null),[W,ue]=u.useState(""),[Q,ye]=u.useState("private"),[ae,ke]=u.useState(""),[pe,we]=u.useState(!1),[ne,Le]=u.useState(null),[be,Oe]=u.useState({items:xa,loading:!1,error:"",loaded:!1}),[Me,ut]=u.useState({items:xa,loading:!1,error:"",loaded:!1}),[ht,_t]=u.useState(()=>new Set),jt=!!i&&!!d&&!!x,ve=u.useMemo(()=>l?E3:j3,[l]),tt=u.useMemo(()=>n||e&&typeof e=="object"&&((e.world||{}).id||e.world_id)||"",[e,n]),st=u.useCallback(de=>{if(!N||!de)return!1;const it=de?.author?.id??de?.createdBy??de?.created_by??de?.authorId??de?.author_id??null;return it?String(it)===String(N.id):!1},[N]),$e=u.useCallback((de,it)=>{const nt=typeof it=="string"?it:typeof de?.target?.value=="string"?de.target.value:"";j(nt),V("")},[]),Ye=u.useCallback(async(de,it)=>{const nt=de?.trim()??"";if(typeof it!="function")return;if(!tt||nt.length===0){it([]);return}const{searchMentions:vt}=await si(async()=>{const{searchMentions:lt}=await import("./mentionSearch-D9Dt0xF8.js");return{searchMentions:lt}},[]);await vt({worldId:tt,query:nt,limit:8,callback:it})},[tt]),mt=u.useCallback(()=>{O(!1),V(""),B("")},[]),ie=u.useCallback(()=>{jt&&(V(""),B(""),O(!0))},[jt]),J=u.useCallback(async de=>{if(de.preventDefault(),!jt||!y)return;const it=E.trim();if(!it){V("Please enter a note before saving");return}if(o&&!_){V("Select which character this note is for");return}V(""),B("");try{const nt={content:it,shareType:A,campaignId:i};o&&(nt.characterId=_);const vt=await y(nt);if(!vt||vt.success!==!0){V(vt?.message||"Failed to save note");return}j(""),o||M(""),mt()}catch(nt){console.error("Failed to submit note",nt),V(nt.message||"Failed to save note")}},[jt,E,y,A,i,o,_,mt]),le=u.useCallback(de=>{if(!de||!e?.id)return;const it=de?.characterId??de?.character_id??"";re(de.id),ue(de?.content??""),ye(de?.shareType??de?.share_type??"private"),ke(it),V("")},[e?.id]),fe=u.useCallback(()=>{re(null),ue(""),ye("private"),ke(""),V("")},[]),Ue=u.useCallback((de,it)=>{const nt=typeof it=="string"?it:typeof de?.target?.value=="string"?de.target.value:"";ue(nt),V("")},[]),qe=u.useCallback(async de=>{if(!de||!e?.id||!i)return;const it=W.trim();if(!it){V("Please enter a note before saving");return}const nt=de?.characterId??de?.character_id??"";if(o&&nt&&!ae){V("Select which character this note is for");return}we(!0),V("");try{const vt={content:it,shareType:Q,campaignId:i};o&&ae&&(vt.characterId=ae);const lt=await Rj(e.id,de.id,vt),wt=lt?.data||lt;if(!wt)throw new Error("Note could not be updated");v&&await v(wt),fe()}catch(vt){console.error("Failed to update note",vt),V(vt.message||"Failed to update note")}finally{we(!1)}},[e?.id,i,W,Q,ae,o,v,fe]),ze=u.useCallback(async de=>{if(!(!de?.id||!e?.id||!i||!window.confirm("Are you sure you want to delete this note? This action cannot be undone."))){Le(de.id),V("");try{await Ij(e.id,de.id,{campaignId:i}),S&&await S(de.id)}catch(nt){console.error("Failed to delete note",nt),V(nt.message||"Failed to delete note")}finally{Le(null)}}},[e?.id,i,S]),Ce=u.useMemo(()=>{const de=Array.isArray(m)?m:xa;return de.length<=1?de:[...de].sort((it,nt)=>{const vt=new Date(it?.createdAt??it?.created_at??0).getTime(),lt=new Date(nt?.createdAt??nt?.created_at??0).getTime();return Number.isNaN(vt)||Number.isNaN(lt)?0:lt-vt})},[m]),pt=u.useMemo(()=>{const de=[{value:"all",label:"All notes"}],it=new Set(["all"]);return Ce.forEach(nt=>{const vt=sw(nt);!vt||it.has(vt)||(it.add(vt),de.push({value:vt,label:Rp(nt)}))}),de},[Ce]),bt=u.useMemo(()=>$==="all"?Ce:Ce.filter(de=>sw(de)===$),[$,Ce]),Ct=u.useMemo(()=>Array.isArray(be.items)?be.items:xa,[be.items]),Ze=u.useMemo(()=>Array.isArray(Me.items)?Me.items:xa,[Me.items]);u.useEffect(()=>{T("private")},[l,i]),u.useEffect(()=>{pt.some(de=>de.value===$)||F("all")},[pt,$]),u.useEffect(()=>{Oe({items:xa,loading:!1,error:"",loaded:!1}),ut({items:xa,loading:!1,error:"",loaded:!1}),_t(new Set),P("entity")},[i,e?.id,x]),u.useEffect(()=>{let de=!1;return!o||!i?(C(xa),z(!1),U(""),M(""),()=>{de=!0}):((async()=>{z(!0),U("");try{const nt=await js({scope:"my",campaign_id:i});if(de)return;const lt=(Array.isArray(nt?.data)?nt.data:Array.isArray(nt)?nt:[]).map(wt=>({id:wt?.id?String(wt.id):"",name:wt?.name||"Unnamed character"})).filter(wt=>wt.id);C(lt),lt.length===1?M(lt[0].id):lt.some(wt=>wt.id===_)||M("")}catch(nt){if(de)return;console.error("Failed to load characters for notes",nt),C(xa),M(""),U(nt.message||"Failed to load characters")}finally{de||z(!1)}})(),()=>{de=!0})},[o,i,_]);const ot=u.useCallback(async()=>{if(!(!e?.id||!i||!x)){Oe(de=>({...de,loading:!0,error:""}));try{const de=await QR(e.id,{campaignId:i}),it=Array.isArray(de?.data)?de.data:Array.isArray(de)?de:xa;Oe({items:it,loading:!1,error:"",loaded:!0})}catch(de){Oe({items:xa,loading:!1,error:de?.message||"Failed to load mentions",loaded:!0})}}},[x,e?.id,i]),Tt=u.useCallback(async()=>{if(!(!e?.id||!i||!x)){ut(de=>({...de,loading:!0,error:""}));try{const de=await JR(e.id,{campaignId:i}),it=Array.isArray(de?.data)?de.data:Array.isArray(de)?de:xa;ut({items:it,loading:!1,error:"",loaded:!0})}catch(de){ut({items:xa,loading:!1,error:de?.message||"Failed to load mentions",loaded:!0})}}},[x,e?.id,i]);u.useEffect(()=>{H==="mentions"&&(!be.loading&&!be.loaded&&ot(),!Me.loading&&!Me.loaded&&Tt())},[H,be.loading,be.loaded,Me.loading,Me.loaded,ot,Tt]);const $t=u.useCallback(de=>{const it=Oi(de?.content,de?.mentions);if(!it.length)return"";const nt=it.map(vt=>vt.type==="mention"?`@${vt.entityName||"entity"}`:vt.text||"").join("").replace(/\s+/g," ").trim();return nt.length<=180?nt:`${nt.slice(0,177)}`},[]),Qt=u.useCallback(de=>{const it=de?.sessionDate??de?.session_date;if(!it)return"";try{const nt=new Date(it);if(!Number.isNaN(nt.getTime()))return nt.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch(nt){return console.warn("Unable to format session date",nt),it}return it},[]),At=u.useCallback(de=>{const it=String(de);_t(nt=>{const vt=new Set(nt);return vt.has(it)?vt.delete(it):vt.add(it),vt})},[]),kt=u.useCallback(de=>ht.has(String(de)),[ht]),qt=u.useCallback(()=>{!e?.id||!i||!x||(Y==="entity"?ot():Tt())},[x,e?.id,ot,Tt,Y,i]),Lt=u.useCallback(de=>{const it=Oi(de?.content,de?.mentions);return it.length?it.map((nt,vt)=>{if(nt.type==="mention"){if(nt.locationId){const He=`${de?.id||"note"}-mention-${vt}`,Je=nt.locationName||"location";return t.jsxs("span",{className:"entity-note-mention",children:["@",Je,t.jsx(fs,{locationId:nt.locationId,locationName:Je})]},He)}if(nt.entityId){const He=`${de?.id||"note"}-mention-${vt}`,Je=nt.entityName||"entity";return t.jsxs("span",{className:"entity-note-mention",children:["@",Je,t.jsx(Na,{entityId:nt.entityId,entityName:Je})]},He)}const lt=nt.locationName||nt.entityName||"mention",wt=`${de?.id||"note"}-mention-${vt}`;return t.jsxs("span",{className:"entity-note-mention",children:["@",lt]},wt)}return t.jsx("span",{className:"entity-note-text",children:nt.text},`${de?.id||"note"}-text-${vt}`)}):null},[]);u.useCallback(de=>`entity-note-share entity-note-share-${de}`,[]);const ce=Ct.length,Ae=Ze.length,Te=be.loading,Ke=Me.loading,Se=be.error,Be=Me.error,We=be.loaded,se=Me.loaded,Z=!i||!x||(Y==="entity"?Te:Ke),Ee=o&&jt,_e=Ee&&k.length===1,ge=g,Pe=g||!E.trim()||o&&!_,oe=Ce.length===0||pt.length<=1;u.useEffect(()=>{(H!=="notes"||!jt)&&L&&mt()},[H,jt,L,mt]);const at=s?.name||"",dt=u.useCallback(de=>{const it=Rp(de),nt=de?.character?.name||"";return nt?`${it} (as ${nt})`:it},[]),xt=u.useCallback(de=>{const it=String(de?.shareType??de?.share_type??"private");return N3[it]||"Private"},[]);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"entity-notes-card-strict",children:[t.jsxs("div",{className:"entity-notes-header-row",children:[t.jsx("h2",{className:"entity-notes-title",children:"Notes"}),H==="notes"&&jt?t.jsx("button",{type:"button",className:"btn-primary",onClick:ie,disabled:g,children:"+ Create note"}):null]}),s?.name?t.jsxs("p",{className:"entity-notes-campaign-line",children:["Campaign: ",at]}):null,t.jsxs("div",{className:"entity-notes-tabs-row",children:[t.jsx("button",{type:"button",className:`entity-notes-strict-tab-button${H==="notes"?" active":""}`,onClick:()=>I("notes"),children:"Notes"}),t.jsx("button",{type:"button",className:`entity-notes-strict-tab-button${H==="mentions"?" active":""}`,onClick:()=>I("mentions"),children:"@Mentions"})]}),H==="notes"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"entity-notes-strict-filter",children:[t.jsx("span",{className:"entity-notes-strict-filter-label",children:"Show notes from"}),t.jsx("select",{className:"entity-notes-strict-filter-select",value:$,onChange:de=>F(de.target.value),disabled:oe,children:pt.map(de=>t.jsx("option",{value:de.value,children:de.label},de.value))})]}),h?t.jsxs("div",{className:"entity-notes-strict-alert error",children:[t.jsx(Jn,{size:16}),t.jsx("p",{children:h})]}):null,p?t.jsxs("div",{className:"entity-notes-strict-loading",children:[t.jsx(mn,{className:"spin",size:20}),t.jsx("span",{children:"Loading notes"})]}):null,!p&&bt.length===0?t.jsx("p",{className:"entity-notes-strict-empty",children:"No notes yet."}):null,!p&&bt.length>0?t.jsx("div",{className:"entity-notes-strict-list",children:bt.map(de=>{const it=de?.createdAt??de?.created_at??de?.timestamp??null,nt=kp(it);String(de?.shareType??de?.share_type??"private");const vt=K===de?.id,lt=st(de);return de?.characterId??de?.character_id,t.jsx("div",{className:"entity-notes-strict-note-item",children:vt?t.jsxs("div",{className:"entity-notes-strict-edit-panel",children:[t.jsx(Pl,{value:W,onChange:Ue,markup:"@[__display__](__id__)",placeholder:rw,className:"entity-note-mentions",inputProps:{className:"entity-notes-strict-textarea","aria-label":"Edit note content",rows:5,required:!0},children:t.jsx(ti,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(wt,He)=>`@${He||(wt.includes(":")?wt.split(":")[1]:wt)}`,data:Ye,appendSpaceOnAdd:!0})}),t.jsx("p",{className:"entity-notes-strict-share-label",children:"Share with"}),t.jsx("div",{className:"entity-notes-strict-share-options",children:ve.map(wt=>t.jsxs("label",{className:"entity-notes-strict-share-option",children:[t.jsx("input",{type:"radio",name:`entity-note-share-edit-${de.id}`,value:wt.value,checked:Q===wt.value,onChange:()=>ye(wt.value),disabled:pe}),wt.value==="private"?"Private":wt.value==="party"?"Share with Party":wt.label]},wt.value))}),X?t.jsxs("div",{className:"entity-notes-strict-alert error",children:[t.jsx(Jn,{size:16}),t.jsx("p",{children:X})]}):null,t.jsxs("div",{className:"entity-notes-strict-edit-actions",children:[t.jsx("button",{type:"button",className:"btn-primary",onClick:()=>qe(de),disabled:pe||!W.trim(),children:pe?t.jsxs(t.Fragment,{children:[t.jsx(mn,{className:"spin",size:16})," Saving"]}):"Save"}),t.jsx("button",{type:"button",className:"btn-secondary",onClick:fe,disabled:pe,children:"Cancel"})]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"entity-notes-strict-note-header",children:[t.jsxs("div",{className:"entity-notes-strict-note-title-row",children:[t.jsx("span",{className:"entity-notes-strict-note-title",children:dt(de)}),t.jsx("span",{className:"entity-notes-strict-note-visibility",children:xt(de)})]}),t.jsx("span",{className:"entity-notes-strict-note-timestamp",children:nt||""})]}),t.jsx("p",{className:"entity-notes-strict-note-body",children:Lt(de)}),lt?t.jsxs("div",{className:"entity-notes-strict-note-actions",children:[t.jsx("button",{type:"button",className:"entity-notes-strict-edit-button",onClick:()=>le(de),children:"Edit"}),t.jsx("button",{type:"button",className:"entity-notes-strict-delete-button",onClick:()=>ze(de),disabled:ne===de.id,children:ne===de.id?t.jsx(mn,{className:"spin",size:14}):"Delete"})]}):null]})},de?.id)})}):null]}):t.jsxs("div",{className:"entity-notes-strict-mentions",children:[t.jsxs("div",{className:"entity-notes-strict-mentions-header",children:[t.jsxs("div",{className:"entity-notes-strict-mention-toggle",children:[t.jsxs("button",{type:"button",className:`entity-notes-strict-mention-toggle-button${Y==="entity"?" active":""}`,onClick:()=>P("entity"),children:["Entity Notes",We?t.jsx("span",{className:"entity-notes-strict-mention-count",children:ce}):null]}),t.jsxs("button",{type:"button",className:`entity-notes-strict-mention-toggle-button${Y==="session"?" active":""}`,onClick:()=>P("session"),children:["Session Notes",se?t.jsx("span",{className:"entity-notes-strict-mention-count",children:Ae}):null]})]}),t.jsx("button",{type:"button",className:"btn-secondary",onClick:qt,disabled:Z,children:(Y==="entity"?Te:Ke)?t.jsxs(t.Fragment,{children:[t.jsx(mn,{className:"spin",size:16})," Refreshing"]}):"Refresh"})]}),Y==="entity"?t.jsxs(t.Fragment,{children:[Se?t.jsxs("div",{className:"entity-notes-strict-alert error",children:[t.jsx(Jn,{size:16}),t.jsx("p",{children:Se})]}):null,Te?t.jsxs("div",{className:"entity-notes-strict-loading",children:[t.jsx(mn,{className:"spin",size:20}),t.jsx("span",{children:"Loading mentions"})]}):null,!Te&&We&&ce===0?t.jsx("p",{className:"entity-notes-strict-empty",children:"This entity hasn't been mentioned in entity or location notes yet."}):null,!Te&&We&&ce>0?t.jsx("div",{className:"entity-notes-strict-list",children:Ct.map((de,it)=>{const nt=de?.id??de?.entityNoteId??de?.entity_note_id??`entity-mention-${it}`,vt=String(nt),lt=de?.createdAt??de?.created_at,wt=lt?new Date(lt):null,He=kp(wt);String(de?.shareType??de?.share_type??"private"),wt&&!Number.isNaN(wt.getTime())&&wt.toISOString();const Je=de?.entity?.name??de?.entityName??"Unnamed entity",St=de?.entity?.id??de?.entityId??de?.entity_id??null,ee=de?.location?.name??de?.locationName??"Unnamed location",xe=de?.location?.id??de?.locationId??de?.location_id??null;return t.jsxs("div",{className:"entity-notes-strict-note-item",children:[t.jsxs("div",{className:"entity-notes-strict-note-header",children:[t.jsxs("div",{className:"entity-notes-strict-note-title-row",children:[t.jsxs("span",{className:"entity-notes-strict-note-title",children:[dt(de),St?t.jsxs(t.Fragment,{children:[" ","on"," ",t.jsx("span",{style:{fontWeight:500},children:Je})," ",t.jsx(Na,{entityId:St,entityName:Je})]}):xe?t.jsxs(t.Fragment,{children:[" ","on"," ",t.jsx("span",{style:{fontWeight:500},children:ee})," ",t.jsx(fs,{locationId:xe,locationName:ee})]}):null]}),t.jsx("span",{className:"entity-notes-strict-note-visibility",children:xt(de)})]}),t.jsx("span",{className:"entity-notes-strict-note-timestamp",children:He||""})]}),t.jsx("p",{className:"entity-notes-strict-note-body",children:Lt(de)})]},`entity-mention-${vt}`)})}):null]}):t.jsxs(t.Fragment,{children:[Be?t.jsxs("div",{className:"entity-notes-strict-alert error",children:[t.jsx(Jn,{size:16}),t.jsx("p",{children:Be})]}):null,Ke?t.jsxs("div",{className:"entity-notes-strict-loading",children:[t.jsx(mn,{className:"spin",size:20}),t.jsx("span",{children:"Loading session mentions"})]}):null,!Ke&&se&&Ae===0?t.jsx("p",{className:"entity-notes-strict-empty",children:"This entity hasn't been mentioned in session notes yet."}):null,!Ke&&se&&Ae>0?t.jsx("div",{className:"entity-notes-strict-list",children:Ze.map((de,it)=>{const nt=de?.id??de?.noteId??de?.note_id??`session-mention-${it}`,vt=String(nt),lt=kt(vt),wt=$t(de),He=de?.sessionTitle??de?.session_title??"Session note";Qt(de),Rp(de);const Je=de?.updatedAt??de?.updated_at??de?.createdAt??de?.created_at,St=Je?new Date(Je):null,ee=kp(St),xe=wt||"This session note does not include any text.";return t.jsxs("div",{className:"entity-notes-strict-note-item",children:[t.jsxs("div",{className:"entity-notes-strict-note-header",children:[t.jsx("div",{className:"entity-notes-strict-note-title-row",children:t.jsx("span",{className:"entity-notes-strict-note-title",children:He})}),t.jsx("span",{className:"entity-notes-strict-note-timestamp",children:ee||""})]}),lt?t.jsx("p",{className:"entity-notes-strict-note-body",children:Lt(de)}):t.jsx("p",{className:"entity-notes-strict-note-body",children:xe}),t.jsx("div",{className:"entity-notes-strict-note-actions",children:t.jsx("button",{type:"button",className:"entity-notes-strict-action-button",onClick:()=>At(vt),children:lt?"Hide note":"View note"})})]},`session-mention-${vt}`)})}):null]})]})]}),t.jsx(Bs,{isOpen:L&&jt,onClose:mt,title:"Create note",children:t.jsx("div",{className:"entity-notes-form",children:t.jsxs("form",{onSubmit:J,className:"entity-notes-form-body",children:[t.jsx("label",{className:"entity-notes-label",htmlFor:"entity-note-content",children:"Note"}),t.jsx("div",{className:"entity-note-editor-field",children:t.jsx(Pl,{value:E,onChange:$e,markup:"@[__display__](__id__)",placeholder:rw,className:"entity-note-mentions",inputProps:{id:"entity-note-content",className:"entity-note-textarea","aria-label":"Entity note content",rows:5,required:!0,"data-autofocus":!0},children:t.jsx(ti,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(de,it)=>`@${it||(de.includes(":")?de.split(":")[1]:de)}`,data:Ye,appendSpaceOnAdd:!0})})}),t.jsxs("fieldset",{className:"entity-notes-share",children:[t.jsx("legend",{children:"Share with"}),ve.map(de=>t.jsxs("label",{className:"entity-notes-share-option",children:[t.jsx("input",{type:"radio",name:"entity-note-share",value:de.value,checked:A===de.value,onChange:()=>T(de.value),disabled:ge}),t.jsx("span",{children:de.label})]},de.value))]}),Ee?t.jsxs("div",{className:"entity-notes-character",children:[t.jsx("label",{htmlFor:"entity-note-character",children:"Character"}),t.jsxs("select",{id:"entity-note-character",value:_,onChange:de=>M(de.target.value),disabled:D||_e,required:!0,children:[t.jsx("option",{value:"",disabled:!0,children:D?"Loading characters":"Select character"}),k.map(de=>t.jsx("option",{value:de.id,children:de.name},de.id))]}),_e?t.jsxs("p",{className:"entity-notes-hint",children:["Notes will be associated with your character ",k[0]?.name,"."]}):null,G?t.jsxs("div",{className:"entity-notes-alert error",children:[t.jsx(Jn,{size:16}),t.jsx("p",{children:G})]}):null,!D&&!G&&k.length===0?t.jsx("p",{className:"entity-notes-hint",children:"You need an active character in this campaign to attach notes."}):null]}):null,X?t.jsxs("div",{className:"entity-notes-alert error",children:[t.jsx(Jn,{size:16}),t.jsx("p",{children:X})]}):null,R?t.jsx("div",{className:"entity-notes-alert success",children:t.jsx("p",{children:R})}):null,t.jsx("div",{className:"entity-notes-actions",children:t.jsx("button",{type:"submit",className:"primary",disabled:Pe,children:g?t.jsxs(t.Fragment,{children:[t.jsx(mn,{className:"spin",size:16})," Saving"]}):"Save note"})})]})})})]})}L1.propTypes={entity:Mt.object,worldId:Mt.oneOfType([Mt.string,Mt.number]),selectedCampaign:Mt.object,selectedCampaignId:Mt.oneOfType([Mt.string,Mt.number]),isCampaignDm:Mt.bool,isCampaignPlayer:Mt.bool,canCreateNote:Mt.bool,notes:Mt.arrayOf(Mt.object),loading:Mt.bool,error:Mt.string,onCreateNote:Mt.func,creating:Mt.bool,campaignMatchesEntityWorld:Mt.bool,onNoteUpdate:Mt.func,onNoteDelete:Mt.func};const _3=e=>{const n=e?.options?.choices;return!Array.isArray(n)||n.length===0?[]:n.map((s,i)=>{if(s==null)return null;if(typeof s=="object"){const o=s.value??s.id??s.key??s.slug??`choice-${i}`,d=s.label??s.name??s.title??s.display??o;return o==null?null:{value:o,label:String(d??o)}}const l=String(s);return{value:l,label:l}}).filter(Boolean)},C3=e=>{if(!e?.name)return null;const n=`metadata.${e.name}`,s=e.visibleByDefault!==void 0?!!e.visibleByDefault:e.visible_by_default!==void 0?!!e.visible_by_default:!0,i={key:n,name:n,label:e.label||e.name,metadataField:e.name,dataType:e.dataType,visibleByDefault:s};switch(e.dataType){case"text":return{...i,type:"textarea",rows:3};case"boolean":return{...i,type:"boolean"};case"enum":return{...i,type:"select",options:_3(e)};case"number":return{...i,type:"text",inputType:"number"};case"date":return{...i,type:"text"};case"entity_reference":case"location_reference":case"reference":{const l=e.referenceTypeId??e.reference_type_id??e.referenceType?.id??null,o=e.referenceTypeName??e.reference_type_name??e.referenceType?.name??"",d=e.referenceFilter??e.reference_filter??e.referenceFilterJson??{},m=(()=>{if(e.displayValue)return String(e.displayValue);if(e.display)return String(e.display);if(e.selectedLabel)return String(e.selectedLabel);const p=e.value;if(!p||typeof p!="object")return"";const h=p.label??p.name??p.title??p.display??p.displayName??p.text??p.value;return h!=null?String(h):""})();return{...i,type:"reference",referenceTypeId:l,referenceTypeName:o,referenceFilter:d,displayKey:`metadataDisplay.${e.name}`,selectedLabel:m}}default:return{...i,type:"text"}}},hd=(e,n,s="")=>{if(e!=null){const i=String(e).trim();if(i)return i}if(n!=null){const i=String(n).trim();if(i)return`name:${i.toLowerCase()}`}if(s){const i=String(s).trim();if(i)return`label:${i.toLowerCase().normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"fallback"}`}return""};function A3(){const{id:e}=Wa(),n=Mn(),s=Xa(),{user:i,token:l,sessionReady:o}=un(),{selectedCampaign:d,selectedCampaignId:m,setSelectedCampaignId:p}=jn(),h=Wl(),[y,g]=u.useState(null),x=u.useCallback(he=>{const Ne=Ya(he);Ne&&g(ct=>ct?!Ne.permissions&&ct.permissions?{...Ne,permissions:ct.permissions}:(Ne.permissions,Ne):Ne)},[]),[v,S]=u.useState(!0),[N,E]=u.useState(""),[j,A]=u.useState(""),[T,_]=u.useState("dossier"),[M,k]=u.useState(!1),[C,D]=u.useState(!1),[z,G]=u.useState(!1),[U,X]=u.useState(null),[V,R]=u.useState({items:[],loading:!1,error:""}),[B,L]=u.useState(!1),O=u.useRef(null),[$,F]=u.useState({isDirty:!1,isSubmitting:!1}),[H,I]=u.useState(!1),[Y,P]=u.useState(null),K=u.useRef(null),[re,W]=u.useState(!1),[ue,Q]=u.useState([]),[ye,ae]=u.useState(""),[ke,pe]=u.useState(!1),[we,ne]=u.useState([]),[Le,be]=u.useState([]),[Oe,Me]=u.useState(()=>vp()),ut=u.useRef(s),ht=u.useRef(null),jt=u.useMemo(()=>!d||!i?.id?null:(Array.isArray(d.members)?d.members:[]).find(ct=>{if(!ct)return!1;const It=ct.user_id??ct.userId??ct.user?.id??ct.id??null;return It?String(It)===String(i.id):!1})||null,[d,i?.id])?.role??null,ve=u.useMemo(()=>i?.role==="system_admin"?!0:jt==="dm",[jt,i?.role]),tt=u.useMemo(()=>jt==="player",[jt]),st=u.useMemo(()=>!!(ve||tt),[ve,tt]),$e=u.useMemo(()=>y?y.world?.id?String(y.world.id):y.world_id?String(y.world_id):y.worldId?String(y.worldId):"":"",[y]),Ye=u.useMemo(()=>d?d.world?.id?String(d.world.id):d.world_id?String(d.world_id):"":"",[d]),mt=u.useMemo(()=>!m||!$e||!Ye?!0:String($e)===String(Ye),[m,$e,Ye]),ie=s.state?.fromEntities?.search||"",J=u.useMemo(()=>ie?ie.startsWith("?")?`/entities${ie}`:`/entities?${ie}`:"/entities",[ie]),le=u.useCallback(he=>{if(!he)return"the next page";const Ne=he.pathname||"",ct=he.search||"",It=`${Ne}${ct}`;return It?It===J?"the previous page":It:"the next page"},[J]),fe=u.useCallback(he=>{if(!he)return"";const Ne=he.pathname||"",ct=he.search||"",It=he.hash||"";return`${Ne}${ct}${It}`},[]),Ue=u.useCallback(he=>{if(!he||typeof he!="string")return null;const Ne=he.indexOf("#"),ct=he.indexOf("?");let It=he.length;Ne>=0&&(It=Ne),ct>=0&&ct<It&&(It=ct);const Ht=he.slice(0,It)||"",tn=ct>=0?he.slice(ct,Ne>=0?Ne:void 0):"",rn=Ne>=0?he.slice(Ne):"";return{pathname:Ht,search:tn,hash:rn}},[]),qe=u.useCallback(he=>{if(he){if(he.externalUrl){typeof window<"u"&&window.location.assign(he.externalUrl);return}if(he.to!==void 0&&he.to!==null){const Ne=he.to;if(typeof Ne=="string"){ht.current=Ne,n(Ne,{replace:he.replace,state:he.state});return}const ct=fe(Ne);ct&&(ht.current=ct),n(Ne,{replace:he.replace,state:he.state})}}},[fe,n]),ze=u.useCallback(he=>{he&&g(Ne=>{if(!Ne)return Ne;const ct=Array.isArray(Ne.secrets)?Ne.secrets:[],It=ct.findIndex(en=>!en||!he||!en.id||!he.id?!1:String(en.id)===String(he.id)),Ht=It>=0?ct.map((en,_n)=>_n===It?he:en):[...ct,he],tn=en=>{if(!en)return 0;const _n=new Date(en).getTime();return Number.isNaN(_n)?0:_n},rn=Ht.slice().sort((en,_n)=>tn(en?.created_at||en?.createdAt)-tn(_n?.created_at||_n?.createdAt));return{...Ne,secrets:rn}})},[]),Ce=u.useCallback(async()=>{const he=await ZR(e,{campaignId:m});return Array.isArray(he?.data)?he.data:Array.isArray(he)?he:[]},[e,m]);u.useEffect(()=>{let he=!1;return!e||!m||!mt?(R({items:[],loading:!1,error:""}),()=>{he=!0}):(R(ct=>({...ct,loading:!0,error:""})),(async()=>{try{const ct=await Ce();he||R({items:ct,loading:!1,error:""})}catch(ct){if(!he){const tn=(ct.status===403||ct.status==="403"||ct.message==="Forbidden")&&!!m?"CAMPAIGN_CONTEXT_ACCESS_DENIED":ct.message||"Failed to load notes";R(rn=>({...rn,loading:!1,error:tn}))}}})(),()=>{he=!0})},[e,m,mt,Ce]);const pt=u.useCallback(async()=>{if(!e||!m||!mt){R({items:[],loading:!1,error:""});return}R(he=>({...he,loading:!0,error:""}));try{const he=await Ce();R({items:he,loading:!1,error:""})}catch(he){R(Ne=>({...Ne,loading:!1,error:he.message||"Failed to load notes"}))}},[e,m,mt,Ce]),bt=u.useCallback(async he=>{if(!e)return{success:!1,message:"Entity not found"};if(!m)return{success:!1,message:"Select a campaign first"};L(!0);try{const Ne={...he,campaignId:he?.campaignId??m},ct=await eI(e,Ne),It=ct?.data||ct;if(!It)throw new Error("Note could not be created");const Ht=It?.createdAt??It?.created_at??new Date().toISOString(),tn=It?.createdAt&&It?.created_at?It:{...It,...It?.createdAt?{}:{createdAt:Ht},...It?.created_at?{}:{created_at:Ht}};return R(rn=>{const en=Array.isArray(rn?.items)?rn.items.slice():[],_n=It?.id,qn=_n?en.filter(oa=>oa?.id!==_n):en;return{items:[tn,...qn],loading:!1,error:""}}),{success:!0,note:tn}}catch(Ne){return{success:!1,message:Ne.message||"Failed to create note"}}finally{L(!1)}},[e,m]),Ct=u.useCallback(async he=>{if(!he?.id)return;const Ne=he?.updatedAt??he?.updated_at??he?.createdAt??he?.created_at??new Date().toISOString(),ct=he?.updatedAt&&he?.updated_at?he:{...he,...he?.updatedAt?{}:{updatedAt:Ne},...he?.updated_at?{}:{updated_at:Ne}};R(It=>{const Ht=Array.isArray(It?.items)?It.items.slice():[],tn=ct?.id;if(!tn)return It;const rn=Ht.findIndex(en=>en?.id===tn);if(rn>=0){const en=[...Ht];return en[rn]=ct,{items:en,loading:!1,error:""}}return{items:[ct,...Ht],loading:!1,error:""}})},[]),Ze=u.useCallback(async he=>{he&&R(Ne=>({items:(Array.isArray(Ne?.items)?Ne.items.slice():[]).filter(Ht=>Ht?.id!==he),loading:!1,error:""}))},[]),ot=u.useMemo(()=>y?.permissions&&typeof y.permissions.canEdit=="boolean"?y.permissions.canEdit:!y||!i?!1:!!(i.role==="system_admin"||y.world?.created_by&&y.world.created_by===i.id||y.created_by&&y.created_by===i.id),[y,i]),Tt=u.useMemo(()=>Array.isArray(y?.secrets)?y.secrets:[],[y?.secrets]),$t=u.useMemo(()=>!!y?.permissions?.canManageSecrets,[y?.permissions?.canManageSecrets]),Qt=$t||Tt.length>0,At=u.useMemo(()=>{const he=[{id:"dossier",label:"Dossier"},{id:"notes",label:"Notes"},{id:"relationships",label:"Relationships"}];return Qt&&he.push({id:"secrets",label:"Secrets"}),ot&&M&&he.push({id:"access",label:"Access"}),he.push({id:"system",label:"System"}),he},[Qt,ot,M]);u.useEffect(()=>{new Set(At.map(Ne=>Ne.id)).has(T)||_("dossier")},[At,T]);const kt=u.useCallback((he,Ne,ct,It=null)=>{if(!he)return null;const Ht=Array.isArray(he.sections)?he.sections:[],tn=It?.actionsByField??{},rn=It?.showRuleTargets??new Set;return Ht.map((en,_n)=>{const qn=`${ct||"section"}-${en.title||_n}`,oa=Number.isFinite(en.columns)?Math.max(1,Number(en.columns)):1,_a=Array.isArray(en.fields)?en.fields:[];return t.jsxs("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:[en.title?t.jsx("h2",{className:"entity-card-title",children:en.title}):null,t.jsx("div",{className:`entity-field-grid ${oa>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":""}`,style:{"--entity-field-columns":oa},children:_a.length>0?_a.map((ga,As)=>{const $a=ga?.key||ga?.name||ga?.field||`${qn}-field-${As}`,li=tn[$a],Xt=ga.visibleByDefault!==void 0?!!ga.visibleByDefault:ga.visible_by_default!==void 0?!!ga.visible_by_default:!0;return Ac($a,li,rn,Xt)?null:t.jsx(Vc,{field:{...ga},data:Ne,mode:"view"},$a)}):t.jsx("p",{className:"entity-empty-state",children:"No fields available."})})]},qn)})},[]);u.useEffect(()=>{if(!U)return;const he=setTimeout(()=>X(null),4e3);return()=>clearTimeout(he)},[U]);const qt=u.useCallback(async()=>{if(e){S(!0),E(""),A("");try{const he=await Us(e),Ne=Ya(he);if(!Ne){g(null),E("Entity not found");return}x(Ne)}catch(he){const Ne=he.status===403||he.status==="403"||he.message==="Forbidden";E(Ne&&!!m?"CAMPAIGN_CONTEXT_ACCESS_DENIED":he.message||"Failed to load entity"),g(null)}finally{S(!1)}}},[e,x,m]),Lt=u.useCallback(async he=>{if(!he){ne([]),be([]);return}try{const[Ne,ct]=await Promise.all([Tf(he).catch(()=>null),Mf(he).catch(()=>null)]);ne(ei(Ne)),be(ei(ct))}catch{ne([]),be([])}},[]);u.useEffect(()=>{o&&l&&qt()},[o,l,qt]),u.useEffect(()=>{const he=y?.entity_type_id||y?.entityType?.id||y?.entity_type?.id||null;if(!he){ne([]),be([]);return}Lt(he)},[y?.entity_type_id,y?.entityType?.id,y?.entity_type?.id,Lt]);const ce=u.useMemo(()=>Array.isArray(y?.fields)?vg(y.fields,we).map(Ne=>C3(Ne)).filter(Boolean):[],[y?.fields,we]),Ae=u.useMemo(()=>!y?.fields||y.fields.length===0?{__placeholder:"No metadata defined for this entity type."}:Eg(y.fields),[y]),Te=y?.fields,Ke=u.useMemo(()=>wg(Le,Te),[Le,Te]),Se=u.useMemo(()=>!y?.fields||y.fields.length===0?{}:n1(y.fields),[y]),Be=u.useMemo(()=>!y?.fields||y.fields.length===0?{}:t1(y.fields),[y]),We=u.useMemo(()=>{if(!y?.id)return null;const he=y?.entityType?.name||y?.entity_type?.name||y?.entityTypeName||"entity";return{id:y.id,type:`entity:${he}`,title:y.name||"Untitled entity",worldId:$e,worldName:y?.world?.name||y?.world_name||""}},[y?.id,y?.name,y?.entityType?.name,y?.entity_type?.name,y?.entityTypeName,$e,y?.world?.name,y?.world_name]);Nj(We);const se=u.useRef(null),Z=u.useRef(!1),Ee=u.useRef(!1);u.useEffect(()=>{const he=y?.id,Ne=se.current;he!==Ne&&Ne!==null&&!Ee.current&&(k(!1),Z.current=!1),se.current=he},[y?.id,M]);const _e=y?.createdAt||y?.created_at,ge=y?.updatedAt||y?.updated_at,Pe=u.useMemo(()=>{if(!y)return null;const he=y.location?.id||y.location_id||null,Ne=y.location?.name||null;return{name:y.name||"",description:y.description||"",typeName:y.entityType?.name||y.entity_type?.name||"",location:he,locationName:Ne||"",worldName:y.world?.name||y.world_name||"",worldId:$e,createdAt:os(_e),updatedAt:os(ge),metadata:Ae,metadataDisplay:Se,createdBy:y.creator?.username||y.creator?.email||y.created_by||"",updatedBy:y.updated_by||""}},[y,Ae,Se,$e,_e,ge]),oe=u.useMemo(()=>Ng(Ke,Pe||{}),[Ke,Pe]),at=u.useMemo(()=>{if(!y)return null;const he=y.location?.id||y.location_id||null;return{name:y.name||"",description:y.description||"",visibility:y.visibility||"visible",entityTypeName:y.entityType?.name||y.entity_type?.name||"",location_id:he||null,worldName:y.world?.name||y.world_name||"",worldId:$e,createdAt:os(_e),updatedAt:os(ge),metadata:Be}},[y,$e,_e,ge,Be]);u.useEffect(()=>{if(!M||!y||!at||!O.current?.reset||!Z.current)return;const he=setTimeout(()=>{O.current?.reset&&at&&O.current.reset(at),Z.current=!1},150);return()=>clearTimeout(he)},[M,y,at]);const dt=u.useMemo(()=>{if(!y)return"";const he=y.imageMimeType||y.image_mime_type||"",Ne=y.imageData||y.image_data||"";return!he||!Ne?"":`data:${he};base64,${Ne}`},[y]),xt=u.useMemo(()=>!y||!ot?null:t.jsx(WL,{entity:y,canEdit:ot,isEditing:M,onEntityUpdate:x,variant:M?"compact":"card"}),[y,ot,M,x]),de="Information",it=u.useMemo(()=>{const he=ce.length>0;return{title:"Edit Entity",sections:[{title:"Edit Entity",columns:2,fields:[{key:"name",label:"Name",type:"text"},{key:"entityTypeName",label:"Type",type:"readonly"},{key:"location_id",label:"Location",type:"location_reference",dataType:"location_reference"},{key:"description",label:"Description",type:"textarea",rows:4,span:2}]},{title:de,columns:he?2:1,fields:he?ce:[{key:"metadata.__placeholder",name:"metadata.__placeholder",label:"Information",type:"readonly"}]}]}},[ce,de]),nt=u.useMemo(()=>{const he=ce.length>0?ce:[{key:"metadata.__placeholder",name:"metadata.__placeholder",label:"Information",type:"readonly"}];return{title:"Entity Overview",sections:[{title:"Summary",columns:2,fields:[{key:"name",label:"Name",type:"readonly"},{key:"typeName",label:"Type",type:"readonly"},{key:"location",label:"Location",type:"location_reference",dataType:"location_reference"}]},{title:"Description",columns:1,fields:[{key:"description",label:"Description",type:"textarea",rows:4}]},{title:de,columns:ce.length>0?2:1,fields:he}]}},[ce,de]),vt=u.useMemo(()=>({sections:[{title:"System",columns:2,fields:[{key:"worldName",label:"World",type:"readonly"},{key:"createdAt",label:"Created",type:"readonly"},{key:"createdBy",label:"Created by",type:"readonly"},{key:"updatedAt",label:"Updated",type:"readonly"},{key:"updatedBy",label:"Updated by",type:"readonly"}]}]}),[]),{accessSettings:lt,accessOptions:wt,accessOptionsError:He,accessOptionsLoading:Je,accessSaving:St,accessSaveError:ee,accessSaveSuccess:xe,isAccessDirty:Ie,handleAccessSettingChange:et,resetAccessSettings:Nt,handleAccessSave:Rt}=s4(y,l,ot),nn=u.useMemo(()=>y?.world?.id||y?.world_id||"",[y]),Pt=y?.id?String(y.id):"",Ft=u.useCallback(async()=>{if(!Pt||!l){Q([]),ae(""),pe(!1);return}pe(!0),ae("");try{const he=await c1(Pt),Ne=Array.isArray(he)?he:Array.isArray(he?.data)?he.data:[];Q(Ne)}catch(he){Q([]),ae(he.message||"Failed to load relationships")}finally{pe(!1)}},[Pt,l]);u.useEffect(()=>{Ft()},[Ft]);const zt=u.useMemo(()=>{if(!Array.isArray(ue))return[];const he=Ne=>Ne?typeof Ne=="string"||typeof Ne=="number"?String(Ne).trim():typeof Ne=="object"?String(Ne.id||Ne.entity_id||Ne.entityId||"").trim():"":"";return ue.map(Ne=>{const ct=Ne.relationshipType||Ne.relationship_type||Ne.type||Ne.relationshipTypeId||{},It=ct?.from_name||ct?.fromName||Ne.source_relationship_label||Ne.sourceLabel||"",Ht=ct?.to_name||ct?.toName||Ne.target_relationship_label||Ne.targetLabel||"";return{id:Ne.id,typeId:he(Ne.relationship_type_id||Ne.relationshipTypeId||Ne.typeId||Ne.type),typeName:Ne.relationshipType?.name||Ne.type?.name||"",fromId:he(Ne.from_entity_id||Ne.fromEntityId||Ne.from),toId:he(Ne.to_entity_id||Ne.toEntityId||Ne.to),fromName:Ne.from_entity?.name||Ne.from?.name||"",toName:Ne.to_entity?.name||Ne.to?.name||"",fromEntityTypeName:Ne.from_entity_type?.name||Ne.fromEntityTypeName||"",toEntityTypeName:Ne.to_entity_type?.name||Ne.toEntityTypeName||"",direction:Ne.context?.__direction==="reverse"?"reverse":"forward",sourceLabel:It||"",targetLabel:Ht||""}})},[ue]),dn=u.useMemo(()=>zt.filter(he=>he.fromId===Pt||he.toId===Pt).sort((he,Ne)=>{const ct=he.fromId===Pt?he.toName:he.fromName,It=Ne.fromId===Pt?Ne.toName:Ne.fromName;return ct.localeCompare(It,void 0,{sensitivity:"base"})}),[zt,Pt]),Bn=u.useMemo(()=>{const he=new Map,Ne=new Map;dn.forEach(Ht=>{const tn=Ht.typeName||"Unknown type",rn=hd(Ht.typeId,Ht.typeName,tn);rn&&!he.has(rn)&&he.set(rn,tn);const _n=Ht.fromId===Pt?Ht.toEntityTypeName:Ht.fromEntityTypeName,qn=hd(null,_n,_n);qn&&!Ne.has(qn)&&Ne.set(qn,_n)});const ct=Array.from(he.entries()).map(([Ht,tn])=>({value:Ht,label:tn})),It=Array.from(Ne.entries()).map(([Ht,tn])=>({value:Ht,label:tn}));return{relationshipTypes:ct,relatedEntityTypes:It}},[dn,Pt]),yn=u.useMemo(()=>{const he=Oe.relationshipTypes||{mode:"all",values:[]},Ne=Oe.relatedEntityTypes||{mode:"all",values:[]};return dn.filter(ct=>{const It=hd(ct.typeId,ct.typeName,ct.typeName);if(he.mode!=="all"&&he.values.length){const Ht=It&&he.values.includes(It);if(he.mode==="include"&&!Ht||he.mode==="exclude"&&Ht)return!1}if(Ne.mode!=="all"&&Ne.values.length){const tn=ct.fromId===Pt?ct.toEntityTypeName:ct.fromEntityTypeName,rn=hd(null,tn,tn),en=rn&&Ne.values.includes(rn);if(Ne.mode==="include"&&!en||Ne.mode==="exclude"&&en)return!1}return!0})},[dn,Oe,Pt]),ja=u.useCallback(he=>{Me(!he||typeof he!="object"?vp():he)},[]),ha=u.useCallback(()=>{Me(vp())},[]),Yi=ke,ta=u.useMemo(()=>`No relationships found for ${y?.name||"this entity"}.`,[y?.name]),hs=u.useCallback(async()=>{if(!ot)return!1;Ee.current=!0;let he=!0,Ne=!1;try{if($.isDirty&&O.current?.submit&&await O.current.submit()===!1&&(he=!1),he&&Ie&&(await Rt()?Ne=!0:he=!1),he&&Ne&&y?.id)try{const ct=await Us(y.id),It=Ya(ct);It&&x(It)}catch{}return he}finally{setTimeout(()=>{Ee.current=!1},200)}},[ot,$.isDirty,Ie,Rt,y?.id,x,M]),xr=u.useCallback(()=>{const he=K.current;P(null),he?.proceed?.()},[]),ri=u.useCallback(async()=>{W(!0);try{if(await hs()){I(!1);const Ne=K.current;Ne?.type!=="exit-edit"?xr():(P(null),Ne?.proceed?.())}}finally{W(!1)}},[hs,xr]),ps=u.useCallback(()=>{O.current?.reset?.(at||{}),Nt()},[at,Nt]),Un=u.useMemo(()=>M&&($.isDirty||Ie),[M,$.isDirty,Ie]),Ys=u.useCallback(()=>{k(!1),_("dossier")},[_,y?.id,ot,Un]),Ea=u.useCallback(he=>{if(!he)return;const Ne=()=>{if(he.label)return he.label;if(he.externalUrl)return he.externalLabel||he.externalUrl;if(typeof he.to=="string"){const ct=he.location||Ue(he.to);return le(ct)}return le(he.location||he.to)};if(!Un){qe(he);return}P({type:"navigation",label:Ne(),proceed:()=>qe(he),discard:()=>qe(he),stay:()=>{}}),I(!0)},[le,Un,Ue,qe,P,I]);u.useEffect(()=>{if(typeof document>"u"||!Un)return;const he=Ne=>{if(!Un||Ne.defaultPrevented||Ne.button!==0||Ne.metaKey||Ne.ctrlKey||Ne.shiftKey||Ne.altKey)return;const ct=Ne.target,It=ct instanceof Element?ct:ct&&"parentElement"in ct?ct.parentElement:null;if(!It||typeof It.closest!="function")return;const Ht=It.closest("a[href]");if(!Ht||Ht.hasAttribute("data-ignore-unsaved-warning"))return;const tn=Ht.getAttribute("href");if(!tn||tn.startsWith("#")||tn.startsWith("javascript:"))return;const rn=Ht.getAttribute("target");if(rn&&rn.toLowerCase()!=="_self")return;let en;try{en=new URL(tn,window.location.href)}catch{return}const _n=Ht.getAttribute("data-navigation-label")||Ht.getAttribute("aria-label")||Ht.title||Ht.textContent?.trim()||"",qn=en.origin!==window.location.origin;if(Ne.preventDefault(),Ne.stopPropagation(),qn){Ea({externalUrl:en.href,label:_n||en.href});return}const oa=`${en.pathname}${en.search}${en.hash}`,_a=`${window.location.pathname}${window.location.search}${window.location.hash}`;!oa||oa===_a||Ea({to:oa,location:Ue(oa),label:_n||le({pathname:en.pathname,search:en.search})})};return document.addEventListener("click",he,!0),()=>{document.removeEventListener("click",he,!0)}},[le,Un,Ue,Ea]);const to=u.useCallback(()=>{const he=`/entities/${e}/relationship-viewer`;Ea({to:he,location:Ue(he)})},[e,Ue,Ea]),Gi=u.useCallback(()=>{if(ot){if(A(""),!M){k(!0);return}if(Un){P({type:"exit-edit",label:"view mode",proceed:async()=>{await hs()&&Ys()},discard:()=>{ps(),Ys()}}),I(!0);return}Ys()}},[ot,Ys,Un,M,ps,hs]),Ki=u.useCallback(async he=>{if(!y?.id)return!1;A("");try{const Ne={name:he?.name,description:he?.description,metadata:he?.metadata||{}};y?.visibility&&(Ne.visibility=y.visibility),Ne.location_id=he?.location_id||null;const ct=await mg(y.id,Ne),It=Ya(ct);if(!It)throw new Error("Failed to update entity");return x(It),Z.current=!0,{message:"Entity updated successfully."}}catch(Ne){return A(Ne.message||"Failed to update entity"),Z.current=!1,!1}},[y?.id,y?.visibility,x,M]),ii=u.useCallback(he=>{F(Ne=>{const ct={isDirty:!!he?.isDirty,isSubmitting:!!he?.isSubmitting};return Ne.isDirty===ct.isDirty&&Ne.isSubmitting===ct.isSubmitting?Ne:ct})},[y?.id,M]),no=u.useCallback(he=>{!he||he===T||_(he)},[T,_]),ao=u.useCallback(()=>{I(!1);const he=K.current;P(null),he?.discard?.()},[]),me=u.useCallback(()=>{I(!1);const he=K.current;P(null),he?.stay?.()},[]);sj(u.useCallback(he=>{Un&&(he.preventDefault(),he.returnValue="")},[Un]),{capture:!0});const De=u.useCallback(({currentLocation:he,nextLocation:Ne})=>!Un||!Ne?!1:!(he.pathname===Ne.pathname&&he.search===Ne.search&&he.hash===Ne.hash),[Un]),Ot=r4(De);if(u.useEffect(()=>{K.current=Y},[Y]),u.useEffect(()=>{if(Ot.state==="blocked"){if(!Un){Ot.reset?.();return}if(Y){if(Y.type==="navigation")return;Ot.reset?.();return}P({type:"navigation",label:le(Ot.location),proceed:()=>Ot.proceed?.(),discard:()=>Ot.proceed?.(),stay:()=>Ot.reset?.()}),I(!0)}},[Ot,Un,Y,le]),u.useEffect(()=>{const he=ut.current,Ne=fe(he),ct=fe(s);if(Ne===ct){ut.current=s;return}if(!Un){ut.current=s,ht.current=null;return}if(ht.current&&ht.current===ct){ht.current=null,ut.current=s;return}if(!he||Y){ut.current=he||s;return}const It=ct||"/",Ht=Ne||"/",tn=()=>{ht.current=It,n(It)},rn=()=>{ht.current=Ht,n(Ht)};P({type:"navigation",label:le(s),proceed:tn,discard:tn,stay:rn}),I(!0),ht.current=Ht,n(Ht,{replace:!0})},[fe,le,Un,s,n,Y]),!o)return t.jsx("p",{children:"Restoring session..."});if(!l)return t.jsx("p",{children:"Authenticating..."});if(v)return t.jsx("p",{children:"Loading entity..."});if(N==="CAMPAIGN_CONTEXT_ACCESS_DENIED")return t.jsxs("div",{className:"alert error",style:{padding:"1.5rem",maxWidth:"600px",margin:"2rem auto"},children:[t.jsx("h2",{style:{marginTop:0,marginBottom:"1rem"},children:"Access Restricted by Campaign Context"}),t.jsx("p",{style:{marginBottom:"1rem"},children:"You don't have access to this entity with your current campaign context selected. This entity may belong to a different campaign or world, or your current campaign context doesn't have permission to view it."}),t.jsx("p",{style:{marginBottom:"1.5rem"},children:"To view this entity, please change your campaign context using the selector in the header to a campaign that has access to this entity."}),t.jsx("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap"},children:t.jsx("button",{type:"button",onClick:()=>n("/entities"),style:{padding:"0.5rem 1rem",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Go to Entities"})})]});if(N)return t.jsx("div",{className:"alert error",children:N});if(!y||!Pe)return t.jsx("p",{children:"Entity not found"});const Zt=`entity-detail-page${h?" entity-detail-page--mobile":""}${h&&C?" entity-detail-page--header-expanded":""}`;return t.jsxs(t.Fragment,{children:[t.jsx(Og,{maxWidth:1280,className:Zt,children:t.jsxs("div",{className:"w-full max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 overflow-x-hidden",children:[t.jsx("header",{className:`entity-page-header ${h&&!C?"entity-page-header--collapsed":""}`,children:t.jsxs("div",{className:"entity-page-header__inner",children:[h&&t.jsx("button",{type:"button",className:"entity-page-header__drag-handle",onClick:()=>D(!C),"aria-label":C?"Collapse header":"Expand header","aria-expanded":C,children:t.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:C?"rotated":"",children:t.jsx("polyline",{points:"6 9 12 15 18 9"})})}),t.jsx(BL,{entityId:e,name:y.name,canEdit:ot,isEditing:M,onToggleEdit:Gi,onSave:hs,isSaving:$.isSubmitting||St,isSaveDisabled:!$.isDirty&&!Ie,isMobile:h}),t.jsxs("div",{className:`entity-page-header__tabs flex flex-wrap items-center justify-between gap-4 mt-4 ${h&&!C?"entity-page-header__tabs--collapsed":""}`,children:[t.jsx(y1,{tabs:At,activeTab:T,onChange:no}),e&&t.jsx(qL,{entityId:e,importance:y.importance,onUpdate:he=>{g(Ne=>Ne?{...Ne,importance:he}:null)}})]})]})}),t.jsx("div",{className:"entity-detail-shell",children:t.jsxs("div",{className:"entity-detail-body",children:[t.jsx("div",{className:"entity-tab-panel",role:"tabpanel",hidden:T!=="dossier",children:t.jsx(i4,{isEditing:M,canEdit:ot,formError:j,formRef:O,editSchema:it,editInitialData:at,handleUpdate:Ki,handleFormStateChange:ii,dossierSchema:nt,viewData:Pe,featuredImageSrc:dt,renderSchemaSections:kt,imageSection:xt,fieldRules:Ke,viewRuleContext:oe})}),T==="notes"&&t.jsx(L1,{entity:y,worldId:$e,selectedCampaign:d,selectedCampaignId:m,isCampaignDm:ve,isCampaignPlayer:tt,canCreateNote:st,notes:V.items,loading:V.loading,error:V.error,onReload:pt,onCreateNote:bt,onNoteUpdate:Ct,onNoteDelete:Ze,creating:B,campaignMatchesEntityWorld:mt}),T==="relationships"&&t.jsx(l4,{entity:y,toast:U,onExplore:to,canEdit:ot,relationshipsLoading:ke,relationshipsError:ye,sortedRelationships:dn,filteredRelationships:yn,relationshipsEmptyMessage:ta,relationshipFilters:Oe,relationshipFilterOptions:Bn,filterButtonDisabled:Yi,handleRelationshipFiltersChange:ja,handleRelationshipFiltersReset:ha,showRelationshipForm:z,setShowRelationshipForm:G,worldId:nn,loadRelationships:Ft}),T==="secrets"&&Qt&&t.jsx(d4,{entity:y,secrets:Tt,worldId:nn,canManageSecrets:$t,onSecretCreated:ze,onSecretUpdated:ze}),T==="access"&&M&&ot&&t.jsx(o4,{canEdit:ot,worldId:nn,accessSettings:lt,accessOptions:wt,accessOptionsError:He,accessOptionsLoading:Je,accessSaving:St,accessSaveError:ee,accessSaveSuccess:xe,handleAccessSettingChange:et}),T==="system"&&t.jsx(c4,{renderSchemaSections:kt,systemSchema:vt,viewData:Pe})]})})]})}),t.jsx(b1,{open:H,destinationLabel:Y?.label||"",saving:re,onSaveAndContinue:ri,onContinueWithoutSaving:ao,onStay:me})]})}function T3({initialData:e={},onSubmit:n,onCancel:s,submitting:i=!1,errorMessage:l,worlds:o=[]}){const[d,m]=u.useState({name:"",description:"",worldId:""}),[p,h]=u.useState("");u.useEffect(()=>{const v=e?.world_id||e?.worldId||e?.world?.id||"";m({name:e?.name||"",description:e?.description||"",worldId:v?String(v):""}),h("")},[e]);const y=u.useMemo(()=>d.name!==(e?.name||"")||d.description!==(e?.description||"")||d.worldId!==(e?.world_id||e?.worldId||e?.world?.id||""),[e,d.description,d.name,d.worldId]);u.useEffect(()=>{h(l||"")},[l]);const g=v=>S=>{const{value:N}=S.target;m(E=>({...E,[v]:N}))},x=async v=>{v.preventDefault();const S=d.name.trim();if(!S){h("Name is required.");return}const N=d.worldId.trim();if(!N){h("Select a world for this entity type.");return}h("");const E={name:S,description:d.description?.trim()||"",world_id:N};try{if(await n?.(E)===!1)return}catch(j){h(j.message||"Failed to save entity type")}};return t.jsxs("form",{className:"entity-type-form",onSubmit:x,children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"entity-type-name",children:"Name *"}),t.jsx("input",{id:"entity-type-name",type:"text",value:d.name,onChange:g("name"),placeholder:"e.g. Faction",disabled:i,autoFocus:!0})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"entity-type-world",children:"World *"}),t.jsxs("select",{id:"entity-type-world",value:d.worldId,onChange:g("worldId"),disabled:i,required:!0,children:[t.jsx("option",{value:"",children:"Select world..."}),o.map(v=>t.jsx("option",{value:v.id,children:v.name},v.id))]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"entity-type-description",children:"Description"}),t.jsx("textarea",{id:"entity-type-description",value:d.description,onChange:g("description"),placeholder:"Optional description for this entity type",rows:5,disabled:i,className:"textarea-field"})]}),p&&t.jsx("div",{className:"form-error",role:"alert",children:p}),t.jsxs("div",{className:"form-actions",children:[t.jsx("button",{type:"button",className:"btn cancel",onClick:s,disabled:i,children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn submit",disabled:i||!y,children:i?"Saving...":"Save"})]})]})}const M3=new Set(["system_admin"]);function k3(){const e=Mn(),{user:n,token:s,sessionReady:i}=un(),{selectedCampaign:l,activeWorld:o,activeWorldId:d,contextKey:m}=jn(),[p,h]=u.useState([]),[y,g]=u.useState(!1),[x,v]=u.useState(""),[S,N]=u.useState(!1),[E,j]=u.useState(null),[A,T]=u.useState(!1),[_,M]=u.useState(""),[k,C]=u.useState(""),[D,z]=u.useState(null),G=d||l?.world?.id||"",U=u.useRef(`${G}:${m}`),X=!!G,V=u.useMemo(()=>G?[{id:G,name:o?.name||l?.world?.name||"Untitled world"}]:[],[G,o?.name,l?.world?.name]),R=u.useMemo(()=>{const Q=l?.world||o;return Q&&(Q.created_by||Q.creator?.id||Q.owner_id||Q.owner?.id)||""},[l,o]),B=!!(n?.id&&R===n.id),L=u.useMemo(()=>n?n.role&&M3.has(n.role)?!0:B:!1,[n,B]),O=u.useMemo(()=>{if(l){const Q=l.name||"Selected campaign",ye=l.world?.name||o?.name;return ye?`${Q}  ${ye}`:Q}return o?o.name||"Selected world":""},[l,o]),$=u.useCallback((Q,ye="info")=>{z({message:Q,tone:ye})},[]);u.useEffect(()=>{if(!D)return;const Q=setTimeout(()=>z(null),3500);return()=>clearTimeout(Q)},[D]);const F=u.useCallback(async()=>{if(!s||!G)return g(!1),h([]),[];g(!0),v("");try{const Q=await br({worldId:G}),ye=Array.isArray(Q)?Q:Array.isArray(Q?.data)?Q.data:[];return h(ye),ye}catch(Q){return console.error(" Failed to load entity types",Q),v(Q.message||"Failed to load entity types"),h([]),[]}finally{g(!1)}},[s,G]);u.useEffect(()=>{if(!(!i||!s)){if(!G){h([]),v(""),g(!1);return}F()}},[i,s,G,F,m]),u.useEffect(()=>{const Q=`${G}:${m}`;U.current!==Q&&(N(!1),j(null),C(""),z(null),h([]),v(""),T(!1),M(""),U.current=Q)},[G,m]);const H=()=>{!L||!X||e("/entity-types/new")},I=Q=>{L&&(j(Q),C(""),N(!0))},Y=Q=>{Q?.id&&e(`/entity-types/${Q.id}/fields`)},P=()=>{N(!1),j(null),C("")},K=async Q=>{if(!E?.id)return C("No entity type selected for editing."),!1;try{T(!0),C(""),await oI(E.id,Q),$("Entity type updated","success"),P(),await F()}catch(ye){console.error(" Failed to save entity type",ye);const ae=ye.message||"Failed to save entity type";return C(ae),$(ae,"error"),!1}finally{T(!1)}return!0},re=async Q=>{if(!(!L||!Q?.id||!window.confirm(`Delete entity type "${Q.name}"? This action cannot be undone.`)))try{M(Q.id),await cI(Q.id),$("Entity type deleted","success"),E?.id===Q.id&&P(),await F()}catch(ae){console.error(" Failed to delete entity type",ae),$(ae.message||"Failed to delete entity type","error")}finally{M("")}},W=Q=>{if(!Q)return"";const ye=new Date(Q);return Number.isNaN(ye.getTime())?"":ye.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},ue=p.length;return i?s?t.jsxs("section",{className:"entity-types-page",children:[t.jsxs("div",{className:"entity-types-header",children:[t.jsxs("div",{children:[t.jsx("h1",{children:"Entity Types"}),l?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"entity-types-subtitle",children:O}),t.jsxs("p",{className:"entity-types-subtitle",children:[ue," types defined"]})]}):t.jsx("p",{className:"entity-types-subtitle",children:"Select a campaign or world you own to choose a world context."})]}),t.jsxs("button",{type:"button",className:"btn submit",onClick:H,disabled:!L||A||_||!X,children:[t.jsx(sa,{size:18})," Add Entity Type"]})]}),!L&&t.jsx("div",{className:"alert info",role:"status",children:"You can view the existing entity types, but only system administrators or the world owner can make changes."}),D&&t.jsx("div",{className:`toast-banner ${D.tone}`,role:"status",children:D.message}),x&&t.jsx("div",{className:"alert error",role:"alert",children:x}),t.jsx("div",{className:"entity-types-table-wrapper",children:X?y?t.jsx("div",{className:"empty-state",children:"Loading entity types..."}):p.length===0?t.jsx("div",{className:"empty-state",children:"No entity types defined yet."}):t.jsxs("table",{className:"entity-types-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Name"}),t.jsx("th",{children:"Description"}),t.jsx("th",{children:"World"}),t.jsx("th",{children:"Created"}),t.jsx("th",{className:"actions-column",children:"Actions"})]})}),t.jsx("tbody",{children:p.map(Q=>{const ye=Q.createdAt||Q.created_at,ae=Q?.world?.name||Q?.world_name||Q?.worldName||"";return t.jsxs("tr",{children:[t.jsx("td",{children:Q.name}),t.jsx("td",{className:"description-cell",children:Q.description?Q.description:""}),t.jsx("td",{children:ae}),t.jsx("td",{children:W(ye)}),t.jsx("td",{className:"actions-column",children:t.jsxs("div",{className:"entity-type-actions",children:[t.jsx("button",{type:"button",className:"icon-btn",title:"Manage fields",onClick:()=>Y(Q),children:t.jsx(Xd,{size:16})}),L&&t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:"icon-btn",title:"Edit entity type",onClick:()=>I(Q),disabled:A||_===Q.id,children:t.jsx(Ga,{size:16})}),t.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete entity type",onClick:()=>re(Q),disabled:_===Q.id||A,children:t.jsx(zn,{size:16})})]})]})})]},Q.id)})})]}):t.jsx("div",{className:"empty-state",children:"Select a campaign or world you own to view entity types."})}),t.jsx("div",{className:"entity-type-cards",children:X?y?t.jsx("div",{className:"card-placeholder",children:"Loading entity types..."}):p.length===0?t.jsx("div",{className:"card-placeholder",children:"No entity types defined yet."}):p.map(Q=>{const ye=Q.createdAt||Q.created_at;return t.jsxs("div",{className:"entity-type-card",children:[t.jsxs("div",{className:"card-header",children:[t.jsx("h3",{children:Q.name}),t.jsxs("div",{className:"entity-type-actions",children:[t.jsx("button",{type:"button",className:"icon-btn",title:"Manage fields",onClick:()=>Y(Q),children:t.jsx(Xd,{size:16})}),L&&t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:"icon-btn",title:"Edit entity type",onClick:()=>I(Q),disabled:A||_===Q.id,children:t.jsx(Ga,{size:16})}),t.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete entity type",onClick:()=>re(Q),disabled:_===Q.id||A,children:t.jsx(zn,{size:16})})]})]})]}),t.jsx("p",{className:"card-description",children:Q.description?Q.description:"No description"}),t.jsxs("p",{className:"card-meta",children:["World: ",Q?.world?.name||Q?.world_name||""]}),t.jsxs("p",{className:"card-meta",children:["Created ",W(ye)]})]},`card-${Q.id}`)}):t.jsx("div",{className:"card-placeholder",children:"Select a campaign or world you own to view entity types."})}),S&&t.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:t.jsxs("div",{className:"side-panel",children:[t.jsxs("div",{className:"side-panel-header",children:[t.jsx("h2",{children:E?"Edit Entity Type":"Add Entity Type"}),t.jsx("button",{type:"button",className:"icon-btn",onClick:P,title:"Close form",disabled:A,children:t.jsx(ea,{size:18})})]}),t.jsx("div",{className:"side-panel-content",children:t.jsx(T3,{initialData:E,onSubmit:K,onCancel:P,submitting:A,errorMessage:k,worlds:V})})]})})]}):t.jsx("p",{children:"Authenticating..."}):t.jsx("p",{children:"Restoring session..."})}const R3=[{value:"text",label:"Text"},{value:"number",label:"Number"},{value:"boolean",label:"Boolean"},{value:"date",label:"Date"},{value:"enum",label:"Enum"},{value:"entity_reference",label:"Entity Reference"},{value:"location_reference",label:"Location Reference"}];function I3({initialData:e={},entityReferenceTypes:n=[],locationReferenceTypes:s=[],onSubmit:i,onCancel:l,submitting:o=!1,errorMessage:d}){const[m,p]=u.useState({name:"",label:"",data_type:"text",required:!1,visibleByDefault:!0,enumChoices:"",reference_type_id:"",reference_filter:""}),[h,y]=u.useState("");u.useEffect(()=>{if(!e){p({name:"",label:"",data_type:"text",required:!1,visibleByDefault:!0,enumChoices:"",reference_type_id:"",reference_filter:""}),y("");return}const T=Array.isArray(e.options?.choices)?e.options.choices.join(", "):typeof e.options=="string"?e.options:"",_=e.reference_filter?typeof e.reference_filter=="string"?e.reference_filter:JSON.stringify(e.reference_filter,null,2):"";let M=e.data_type||"text";M==="reference"&&(M="entity_reference"),p({name:e.name||"",label:e.label||"",data_type:M,required:!!e.required,visibleByDefault:e.visibleByDefault!==void 0?!!e.visibleByDefault:e.visible_by_default!==void 0?!!e.visible_by_default:!0,enumChoices:T,reference_type_id:e.reference_type_id||"",reference_filter:_}),y("")},[e]),u.useEffect(()=>{y(d||"")},[d]);const g=m.data_type==="enum",x=m.data_type==="entity_reference",v=m.data_type==="location_reference",S=x||v,N=u.useMemo(()=>n.map(T=>({value:T.id,label:T.name})),[n]),E=u.useMemo(()=>s.map(T=>({value:T.id,label:T.name})),[s]),j=T=>_=>{const{value:M,type:k,checked:C}=_.target;p(D=>({...D,[T]:k==="checkbox"?C:M}))},A=async T=>{T.preventDefault();const _=m.name.trim(),M=m.label.trim();if(!_){y("Field name is required.");return}if(!M){y("Field label is required.");return}if(!m.data_type){y("Data type is required.");return}let k={};if(S){if(x&&!m.reference_type_id){y("Reference type is required for entity reference fields.");return}const D=m.reference_filter.trim();if(D)try{if(k=JSON.parse(D),typeof k!="object"||Array.isArray(k))throw new Error("Reference filter must be a JSON object.")}catch(z){y(z.message||"Reference filter must be valid JSON.");return}}const C={name:_,label:M,data_type:m.data_type,required:!!m.required,visible_by_default:!!m.visibleByDefault};if(g){const D=m.enumChoices.split(",").map(z=>z.trim()).filter(Boolean);if(!D.length){y("Enum options are required for enum fields.");return}C.options={choices:D}}else C.options={};S?(C.reference_type_id=m.reference_type_id||null,C.reference_filter=k):(C.reference_type_id=null,C.reference_filter={});try{if(await i?.(C)===!1)return;y("")}catch(D){y(D.message||"Failed to save field")}};return t.jsxs("form",{className:"entity-type-field-form",onSubmit:A,children:[t.jsxs("div",{className:"form-grid",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"entity-field-name",children:"Field Name *"}),t.jsx("input",{id:"entity-field-name",type:"text",value:m.name,onChange:j("name"),placeholder:"e.g. alignment",disabled:o})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"entity-field-label",children:"Label *"}),t.jsx("input",{id:"entity-field-label",type:"text",value:m.label,onChange:j("label"),placeholder:"e.g. Alignment",disabled:o})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"entity-field-data-type",children:"Data Type *"}),t.jsx("select",{id:"entity-field-data-type",value:m.data_type,onChange:j("data_type"),disabled:o,children:R3.map(T=>t.jsx("option",{value:T.value,children:T.label},T.value))}),t.jsx("p",{className:"field-hint",children:"Determines how the value is stored and rendered in entity forms."})]}),t.jsxs("div",{className:"form-group checkbox-group",children:[t.jsxs("div",{className:"checkbox-control",children:[t.jsx("input",{id:"entity-field-required",type:"checkbox",checked:m.required,onChange:j("required"),disabled:o}),t.jsx("label",{htmlFor:"entity-field-required",children:"Required"})]}),t.jsx("span",{className:"field-hint",children:"Mark as required on entity forms."})]}),t.jsxs("div",{className:"form-group checkbox-group",children:[t.jsxs("div",{className:"checkbox-control",children:[t.jsx("input",{id:"entity-field-visible-default",type:"checkbox",checked:m.visibleByDefault,onChange:j("visibleByDefault"),disabled:o}),t.jsx("label",{htmlFor:"entity-field-visible-default",children:"Visible by default"})]}),t.jsx("span",{className:"field-hint",children:"Uncheck to hide this field unless a rule explicitly shows it."})]}),g&&t.jsxs("div",{className:"form-group form-group-full",children:[t.jsx("label",{htmlFor:"entity-field-options",children:"Enum Options *"}),t.jsx("textarea",{id:"entity-field-options",value:m.enumChoices,onChange:j("enumChoices"),placeholder:"Comma separated values, e.g. Lawful Good, Neutral, Chaotic Evil",rows:3,disabled:o}),t.jsx("p",{className:"field-hint",children:"Comma-separated list of allowed values."})]}),S&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"form-group form-group-full",children:[t.jsxs("label",{htmlFor:"entity-field-reference-type",children:[x?"Entity":"Location"," Reference Type",x?" *":""]}),t.jsxs("select",{id:"entity-field-reference-type",value:m.reference_type_id,onChange:j("reference_type_id"),disabled:o,children:[t.jsx("option",{value:"",children:x?"Select entity type":"All locations (no type restriction)"}),(x?N:E).map(T=>t.jsx("option",{value:T.value,children:T.label},T.value))]}),t.jsx("p",{className:"field-hint",children:x?"Choose which entity type this field should reference.":"Choose a specific location type to restrict selection, or leave blank to allow any location."})]}),t.jsxs("div",{className:"form-group form-group-full",children:[t.jsx("label",{htmlFor:"entity-field-reference-filter",children:"Reference Filter"}),t.jsx("textarea",{id:"entity-field-reference-filter",value:m.reference_filter,onChange:j("reference_filter"),placeholder:'Optional JSON filter, e.g. {"metadata.subtype": "Town"}',rows:4,disabled:o}),t.jsxs("p",{className:"field-hint",children:["Limit selectable ",x?"entities":"locations"," by filter criteria."]})]})]})]}),h&&t.jsx("div",{className:"form-error",role:"alert",children:h}),t.jsxs("div",{className:"form-actions",children:[t.jsx("button",{type:"button",className:"btn cancel",onClick:l,disabled:o,children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn submit",disabled:o,children:o?"Saving...":"Save Field"})]})]})}const D3=[{value:"equals",label:"Equals"},{value:"not_equals",label:"Does not equal"},{value:"contains",label:"Contains"},{value:"not_contains",label:"Does not contain"},{value:"in",label:"Is one of"},{value:"not_in",label:"Is not one of"},{value:"gt",label:"Greater than"},{value:"gte",label:"Greater than or equal"},{value:"lt",label:"Less than"},{value:"lte",label:"Less than or equal"},{value:"is_set",label:"Has a value"},{value:"is_not_set",label:"Is empty"}],L3=[{value:"show",label:"Show field"},{value:"hide",label:"Hide field"}],O3=[{value:"all",label:"All conditions must match"},{value:"any",label:"Any condition can match"},{value:"none",label:"None of the conditions can match"}],$3=new Set(["is_set","is_not_set"]),Ay=()=>({field:"",operator:"equals",valuesText:""}),Ty=()=>({target:"",action:"show"}),F3=(e=[])=>Array.isArray(e)?e.map((n,s)=>{if(n==null)return null;if(typeof n=="object"){const l=n.value??n.id??n.key??n.slug??`choice-${s}`;if(l==null)return null;const o=n.label??n.name??n.title??n.display??l;return{value:String(l),label:String(o??l)}}const i=String(n);return{value:i,label:i}}).filter(Boolean):[],z3=(e=[])=>!Array.isArray(e)||!e.length?[Ay()]:e.map(n=>({field:n.field||n.fieldKey||"",operator:n.operator||"equals",valuesText:Array.isArray(n.values)?n.values.join(", "):""})),B3=(e=[])=>!Array.isArray(e)||!e.length?[Ty()]:e.map(n=>({target:n.target||n.field||"",action:n.action||"show"})),Ip=e=>e.split(",").map(n=>n.trim()).filter(n=>n.length>0);function U3({fields:e=[],initialData:n=null,onSubmit:s,onCancel:i,submitting:l=!1,errorMessage:o=""}){const[d,m]=u.useState(""),[p,h]=u.useState("all"),[y,g]=u.useState([Ay()]),[x,v]=u.useState([Ty()]),[S,N]=u.useState("");u.useEffect(()=>{m(n?.name||""),h(n?.match_mode||n?.matchMode||"all"),g(z3(n?.conditions)),v(B3(n?.actions))},[n]),u.useEffect(()=>{N(o||"")},[o]);const E=u.useMemo(()=>e.map(U=>({value:U.id||U.name,label:U.label||U.name})),[e]),j=u.useMemo(()=>{const U=new Map;return e.forEach(X=>{if(!X)return;const V=R=>{if(R==null)return;const B=String(R);B&&(U.set(B,X),U.set(B.toLowerCase(),X))};V(X.id),V(X.field_id),V(X.fieldId),V(X.name),V(X.key)}),U},[e]),A=u.useCallback(U=>{if(U==null)return null;const X=String(U);return j.get(X)||j.get(X.toLowerCase())||null},[j]),T=(U,X,V)=>{g(R=>{const B=R.slice();return B[U]={...B[U],[X]:V},B})},_=(U,X,V)=>{v(R=>{const B=R.slice();return B[U]={...B[U],[X]:V},B})},M=()=>g(U=>[...U,Ay()]),k=U=>g(X=>X.length===1?X:X.filter((V,R)=>R!==U)),C=()=>v(U=>[...U,Ty()]),D=U=>v(X=>X.length===1?X:X.filter((V,R)=>R!==U)),z=u.useCallback((U,X)=>{g(V=>{if(!Array.isArray(V)||U<0||U>=V.length)return V;const R=V.slice(),B=R[U];if(!B)return V;const L=Ip(B.valuesText||""),O=String(X);let $;return L.includes(O)?$=L.filter(F=>F!==O):$=[...L,O],R[U]={...B,valuesText:$.join(", ")},R})},[]),G=async U=>{if(U.preventDefault(),!y.length){N("Add at least one condition.");return}if(!x.length){N("Add at least one action.");return}const X=y.map(B=>({field:B.field,operator:B.operator,values:Ip(B.valuesText||"")})).filter(B=>B.field&&B.operator);if(!X.length){N("Each condition needs a field and operator.");return}const V=x.map(B=>({target:B.target,action:B.action})).filter(B=>B.target&&B.action);if(!V.length){N("Each action needs a target and action type.");return}const R={name:d.trim(),match_mode:p,conditions:X,actions:V};try{if(await s?.(R)===!1)return;N("")}catch(B){N(B.message||"Failed to save rule")}};return t.jsxs("form",{className:"field-rule-form",onSubmit:G,children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"field-rule-name",children:"Rule Name"}),t.jsx("input",{id:"field-rule-name",type:"text",value:d,onChange:U=>m(U.target.value),placeholder:"e.g. Show hometown when origin is set",disabled:l})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"field-rule-match-mode",children:"When should this rule run?"}),t.jsx("select",{id:"field-rule-match-mode",value:p,onChange:U=>h(U.target.value),disabled:l,children:O3.map(U=>t.jsx("option",{value:U.value,children:U.label},U.value))})]}),t.jsxs("div",{className:"field-rule-editor-section",children:[t.jsxs("div",{className:"field-rule-editor-heading",children:[t.jsx("h3",{children:"Conditions"}),t.jsx("button",{type:"button",className:"btn ghost",onClick:M,disabled:l,children:"Add condition"})]}),t.jsx("p",{className:"field-hint",children:"Fields to watch before applying the actions."}),t.jsx("div",{className:"field-rule-list",role:"list",children:y.map((U,X)=>t.jsxs("div",{className:"field-rule-row",role:"listitem",children:[t.jsxs("select",{value:U.field,onChange:V=>T(X,"field",V.target.value),disabled:l,children:[t.jsx("option",{value:"",children:"Choose field"}),E.map(V=>t.jsx("option",{value:V.value,children:V.label},V.value))]}),t.jsx("select",{value:U.operator,onChange:V=>T(X,"operator",V.target.value),disabled:l,children:D3.map(V=>t.jsx("option",{value:V.value,children:V.label},V.value))}),(()=>{const V=A(U.field),B=(V?.data_type||V?.dataType)==="enum"?F3(V?.options?.choices):[],L=$3.has(U.operator);if(!L&&B.length>0){const $=new Set(Ip(U.valuesText||""));return t.jsx("div",{className:"field-rule-enum-values",role:"group","aria-label":"Enum choices",children:B.map(F=>t.jsxs("label",{className:"field-rule-enum-option",children:[t.jsx("input",{type:"checkbox",checked:$.has(F.value),onChange:()=>z(X,F.value),disabled:l}),t.jsx("span",{children:F.label})]},`${F.value}-${X}`))})}return t.jsx("input",{type:"text",value:U.valuesText,onChange:$=>T(X,"valuesText",$.target.value),placeholder:"Comma separated values",disabled:l||L})})(),t.jsx("button",{type:"button",className:"icon-btn",onClick:()=>k(X),disabled:y.length===1||l,title:"Remove condition",children:""})]},`condition-${X}`))})]}),t.jsxs("div",{className:"field-rule-editor-section",children:[t.jsxs("div",{className:"field-rule-editor-heading",children:[t.jsx("h3",{children:"Actions"}),t.jsx("button",{type:"button",className:"btn ghost",onClick:C,disabled:l,children:"Add action"})]}),t.jsx("p",{className:"field-hint",children:"Choose what should happen when the conditions above match."}),t.jsx("div",{className:"field-rule-list",role:"list",children:x.map((U,X)=>t.jsxs("div",{className:"field-rule-row",role:"listitem",children:[t.jsxs("select",{value:U.target,onChange:V=>_(X,"target",V.target.value),disabled:l,children:[t.jsx("option",{value:"",children:"Choose field"}),E.map(V=>t.jsx("option",{value:V.value,children:V.label},V.value))]}),t.jsx("select",{value:U.action,onChange:V=>_(X,"action",V.target.value),disabled:l,children:L3.map(V=>t.jsx("option",{value:V.value,children:V.label},V.value))}),t.jsx("button",{type:"button",className:"icon-btn",onClick:()=>D(X),disabled:x.length===1||l,title:"Remove action",children:""})]},`action-${X}`))})]}),S&&t.jsx("div",{className:"form-error",role:"alert",children:S}),t.jsxs("div",{className:"form-actions",children:[t.jsx("button",{type:"button",className:"btn cancel",onClick:i,disabled:l,children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn submit",disabled:l,children:l?"Saving":"Save Rule"})]})]})}const q3=new Set(["system_admin"]),Dp={text:"Text",number:"Number",boolean:"Boolean",date:"Date",enum:"Enum",entity_reference:"Entity Reference",location_reference:"Location Reference"},P3={equals:"equals",not_equals:"does not equal",contains:"contains",not_contains:"does not contain",in:"is one of",not_in:"is not one of",gt:"is greater than",gte:"is greater than or equal to",lt:"is less than",lte:"is less than or equal to",is_set:"is set",is_not_set:"is empty"},H3={show:"Show",hide:"Hide"},iw={all:"All conditions must match",any:"Any condition can match",none:"No conditions can match"};function V3(){const{id:e}=Wa(),n=Mn(),{user:s,token:i,sessionReady:l}=un(),[o,d]=u.useState(null),[m,p]=u.useState([]),[h,y]=u.useState([]),[g,x]=u.useState([]),[v,S]=u.useState(!1),[N,E]=u.useState(!1),[j,A]=u.useState(""),[T,_]=u.useState(""),[M,k]=u.useState(!1),[C,D]=u.useState(null),[z,G]=u.useState(!1),[U,X]=u.useState(""),[V,R]=u.useState(""),[B,L]=u.useState(null),[O,$]=u.useState([]),[F,H]=u.useState([]),[I,Y]=u.useState([]),[P,K]=u.useState(!1),[re,W]=u.useState(!1),[ue,Q]=u.useState(""),[ye,ae]=u.useState(!1),[ke,pe]=u.useState(!1),[we,ne]=u.useState(""),[Le,be]=u.useState(!1),[Oe,Me]=u.useState(null),[ut,ht]=u.useState(!1),[_t,jt]=u.useState(""),[ve,tt]=u.useState(""),[st,$e]=u.useState(""),Ye=o?.name||"Entity Type",mt=u.useMemo(()=>!o||!s?!1:q3.has(s.role)||o.world_owner_id&&o.world_owner_id===s.id||o.created_by&&o.created_by===s.id?!0:Array.isArray(o.managers)?o.managers.some(se=>se===s.id):!1,[o,s]),ie=se=>{if(!se)return"";const{options:Z}=se;return Z?Array.isArray(Z.choices)&&Z.choices.length>0?Z.choices.join(", "):typeof Z=="string"&&Z.trim()?Z:"":""},J=u.useCallback((se,Z="info")=>{L({message:se,tone:Z})},[]);u.useEffect(()=>{if(!B)return;const se=setTimeout(()=>L(null),3500);return()=>clearTimeout(se)},[B]);const le=se=>se?Array.isArray(se)?se:se?.data?se.data:se:null,fe=u.useCallback(async()=>{if(e){S(!0),A("");try{const se=await lI(e),Z=le(se);d(Z)}catch(se){console.error(" Failed to load entity type details",se),A(se.message||"Failed to load entity type")}finally{S(!1)}}},[e]),Ue=u.useCallback(async se=>{const Z=typeof se=="string"?se.trim():se||"";if(!Z){p([]),y([]);return}try{const[Ee,_e]=await Promise.all([br({worldId:Z}).catch(oe=>(console.error(" Failed to load entity types",oe),null)),Pi({worldId:Z}).catch(oe=>(console.error(" Failed to load location types",oe),null))]),ge=Ee?le(Ee):[],Pe=_e?le(_e):[];p(Array.isArray(ge)?ge:[]),y(Array.isArray(Pe)?Pe:[])}catch(Ee){console.error(" Failed to load reference types",Ee),p([]),y([])}},[]),qe=u.useCallback(async()=>{if(e){E(!0),_("");try{const se=await d1(e),Z=le(se);x(Array.isArray(Z)?Z:[])}catch(se){console.error(" Failed to load fields",se),_(se.message||"Failed to load fields"),x([])}finally{E(!1)}}},[e]),ze=u.useCallback(async()=>{if(e){ae(!0),pe(!0),Q(""),ne("");try{const[se,Z]=await Promise.all([Tf(e).catch(Ee=>(console.error(" Failed to load field order",Ee),Q(Ee.message||"Failed to load field order"),null)),Mf(e).catch(Ee=>(console.error(" Failed to load field rules",Ee),ne(Ee.message||"Failed to load conditional rules"),null))]);$(ei(se)),H(ei(Z))}catch(se){Q(se.message||"Failed to load field order"),ne(se.message||"Failed to load conditional rules"),$([]),H([])}finally{ae(!1),pe(!1)}}},[e]);u.useEffect(()=>{!l||!i||(fe(),qe(),ze())},[l,i,fe,qe,ze]),u.useEffect(()=>{if(!o){p([]),y([]);return}const se=o?.world_id||o?.worldId||o?.world?.id||"";Ue(se)},[o,o?.world_id,o?.worldId,o?.world?.id,Ue]),u.useEffect(()=>{l&&(i||n("/login"))},[l,i,n]);const Ce=u.useCallback(()=>!Array.isArray(g)||g.length===0?[]:vg(g,O).map((Z,Ee)=>({id:Z.id,name:Z.name,label:Z.label||Z.name,data_type:Z.data_type,required:Z.required,order:Ee})),[g,O]);u.useEffect(()=>{P||Y(Ce())},[Ce,P]);const pt=u.useCallback(()=>{K(!1),Y(Ce())},[Ce]),bt=u.useMemo(()=>{const se=new Map;return g.forEach(Z=>{if(!Z)return;const Ee=Z.label||Z.name||"Field";Z.id&&(se.set(Z.id,Ee),se.set(String(Z.id).toLowerCase(),Ee)),Z.name&&(se.set(Z.name,Ee),se.set(Z.name.toLowerCase(),Ee))}),se},[g]),Ct=u.useCallback(se=>{if(!se)return"";const Z=bt.get(se.field)||se.field,Ee=P3[se.operator]||se.operator,_e=Array.isArray(se.values)?se.values.filter(Boolean):[];return!_e.length||["is_set","is_not_set"].includes(se.operator)?`${Z} ${Ee}`:`${Z} ${Ee} ${_e.join(", ")}`},[bt]),Ze=u.useCallback(se=>{if(!se)return"";const Z=bt.get(se.target)||se.target;return`${H3[se.action]||se.action} ${Z}`},[bt]),ot=()=>{mt&&(D(null),R(""),k(!0))},Tt=se=>{mt&&(D(se),R(""),k(!0))},$t=()=>{k(!1),D(null),R("")},Qt=async se=>{if(!mt)return!1;try{G(!0),R(""),C?.id?(await mL(C.id,se),J("Field updated","success")):(await fL(e,se),J("Field created","success")),$t(),await qe(),await ze()}catch(Z){console.error(" Failed to save field",Z);const Ee=Z.message||"Failed to save field";return R(Ee),J(Ee,"error"),!1}finally{G(!1)}return!0},At=async se=>{if(!(!mt||!se?.id||!window.confirm(`Delete field "${se.label||se.name}"? This action cannot be undone.`)))try{X(se.id),await hL(se.id),J("Field deleted","success"),await qe(),await ze()}catch(Ee){console.error(" Failed to delete field",Ee),J(Ee.message||"Failed to delete field","error")}finally{X("")}},kt=(se,Z)=>{Y(Ee=>{const _e=se+Z;if(_e<0||_e>=Ee.length)return Ee;const ge=Ee.slice(),[Pe]=ge.splice(se,1);return ge.splice(_e,0,Pe),ge.map((oe,at)=>({...oe,order:at}))}),K(!0)},qt=async()=>{if(!(!mt||!P)){W(!0);try{const se=I.map((Z,Ee)=>({field_id:Z.id,section_order:0,column_order:0,field_order:Ee,priority:Ee}));await uI(e,{entries:se}),J("Field order updated","success"),K(!1),await ze()}catch(se){const Z=se.message||"Failed to update field order";Q(Z),J(Z,"error")}finally{W(!1)}}},Lt=(se=null)=>{mt&&(Me(se),jt(""),be(!0))},ce=()=>{be(!1),Me(null),jt("")},Ae=async se=>{if(!mt)return!1;try{ht(!0),jt(""),Oe?.id?(await rp(Oe.id,se),J("Rule updated","success")):(await dI(e,se),J("Rule created","success")),ce(),await ze()}catch(Z){const Ee=Z.message||"Failed to save rule";return jt(Ee),J(Ee,"error"),!1}finally{ht(!1)}return!0},Te=async se=>{if(!(!mt||!se?.id||!window.confirm(`Delete the rule "${se.name||"Untitled rule"}"?`)))try{tt(se.id),await fI(se.id),J("Rule deleted","success"),await ze()}catch(Ee){J(Ee.message||"Failed to delete rule","error")}finally{tt("")}},Ke=async(se,Z)=>{if(!mt||!se?.id)return;const Ee=F.findIndex(Pe=>Pe.id===se.id),_e=Ee+Z;if(Ee===-1||_e<0||_e>=F.length)return;const ge=F[_e];try{$e(se.id),await Promise.all([rp(se.id,{priority:_e}),rp(ge.id,{priority:Ee})]),J("Rule order updated","success"),await ze()}catch(Pe){J(Pe.message||"Failed to reorder rule","error")}finally{$e("")}},Se=se=>{if(!se)return"";const Z=new Date(se);return Number.isNaN(Z.getTime())?"":Z.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},Be=u.useMemo(()=>{const se=new Map;return m.forEach(Z=>{Z?.id&&se.set(Z.id,Z.name)}),h.forEach(Z=>{Z?.id&&se.set(Z.id,Z.name)}),se},[m,h]),We=j||T;return l?i?t.jsxs("section",{className:"entity-type-fields-page",children:[t.jsxs("div",{className:"entity-type-fields-header",children:[t.jsxs("div",{className:"entity-type-fields-heading",children:[t.jsxs("button",{type:"button",className:"link-button",onClick:()=>n("/entity-types"),children:[t.jsx(jc,{size:16})," Back to Entity Types"]}),t.jsxs("h1",{children:["Fields for ",Ye]}),o?.world_name&&t.jsxs("p",{className:"entity-type-fields-subtitle",children:["World: ",o.world_name]})]}),mt&&t.jsxs("button",{type:"button",className:"btn submit",onClick:ot,disabled:z||U,children:[t.jsx(sa,{size:18})," Add Field"]})]}),!mt&&t.jsx("div",{className:"alert info",role:"status",children:"You can view these fields, but only the world owner or system administrators can make changes."}),B&&t.jsx("div",{className:`toast-banner ${B.tone}`,role:"status",children:B.message}),We&&t.jsx("div",{className:"alert error",role:"alert",children:We}),t.jsx("div",{className:"entity-types-table-wrapper",children:v||N?t.jsx("div",{className:"empty-state",children:"Loading fields..."}):g.length===0?t.jsx("div",{className:"empty-state",children:"No custom fields defined yet."}):t.jsxs("table",{className:"entity-types-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Field Name"}),t.jsx("th",{children:"Label"}),t.jsx("th",{children:"Data Type"}),t.jsx("th",{children:"Reference Type"}),t.jsx("th",{children:"Required"}),t.jsx("th",{children:"Created"}),mt&&t.jsx("th",{className:"actions-column",children:"Actions"})]})}),t.jsx("tbody",{children:g.map(se=>{const Z=se.createdAt||se.created_at,Ee=se.reference_type_name||Be.get(se.reference_type_id),_e=Dp[se.data_type]||se.data_type;return t.jsxs("tr",{children:[t.jsx("td",{children:se.name}),t.jsx("td",{children:se.label||""}),t.jsx("td",{children:_e}),t.jsx("td",{children:Ee||(se.data_type==="entity_reference"||se.data_type==="location_reference"?"":"N/A")}),t.jsx("td",{children:se.required?"Yes":"No"}),t.jsx("td",{children:Se(Z)}),mt&&t.jsx("td",{className:"actions-column",children:t.jsxs("div",{className:"entity-type-actions",children:[t.jsx("button",{type:"button",className:"icon-btn",title:"Edit field",onClick:()=>Tt(se),disabled:z||U===se.id,children:t.jsx(Ga,{size:16})}),t.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete field",onClick:()=>At(se),disabled:U===se.id||z,children:t.jsx(zn,{size:16})})]})})]},se.id)})})]})}),t.jsxs("section",{className:"field-layout-card",children:[t.jsxs("div",{className:"card-header",children:[t.jsxs("h2",{children:[t.jsx(fj,{size:18})," Field order"]}),mt&&t.jsxs("div",{className:"layout-card-actions",children:[t.jsx("button",{type:"button",className:"btn ghost",onClick:pt,disabled:re||!P,children:"Reset"}),t.jsx("button",{type:"button",className:"btn submit",onClick:qt,disabled:re||!P||I.length===0,children:re?"Saving":"Save order"})]})]}),t.jsx("p",{className:"card-description",children:"Use this list to control how the metadata fields appear on entity forms and detail pages."}),ue&&t.jsx("div",{className:"alert error",role:"alert",children:ue}),ye?t.jsx("div",{className:"card-placeholder",children:"Loading layout"}):I.length===0?t.jsx("div",{className:"card-placeholder",children:"No fields available to order yet."}):t.jsx("ol",{className:"field-layout-list",children:I.map((se,Z)=>t.jsxs("li",{className:"field-layout-row",children:[t.jsxs("div",{className:"field-layout-info",children:[t.jsx("span",{className:"field-layout-index",children:Z+1}),t.jsxs("div",{className:"field-layout-details",children:[t.jsx("span",{className:"field-layout-name",children:se.label||se.name}),t.jsx("span",{className:"field-layout-meta",children:Dp[se.data_type]||se.data_type})]})]}),mt&&t.jsxs("div",{className:"layout-controls",children:[t.jsx("button",{type:"button",className:"icon-btn",onClick:()=>kt(Z,-1),disabled:Z===0||re,title:"Move up",children:t.jsx(fy,{size:16})}),t.jsx("button",{type:"button",className:"icon-btn",onClick:()=>kt(Z,1),disabled:Z===I.length-1||re,title:"Move down",children:t.jsx(uS,{size:16})})]})]},se.id||se.name||Z))})]}),t.jsxs("section",{className:"field-rules-card",children:[t.jsxs("div",{className:"card-header",children:[t.jsxs("h2",{children:[t.jsx(qi,{size:18})," Conditional rules"]}),mt&&t.jsxs("button",{type:"button",className:"btn submit",onClick:()=>Lt(null),disabled:ut,children:[t.jsx(sa,{size:16})," Add rule"]})]}),t.jsx("p",{className:"card-description",children:"Automatically show or hide fields when other metadata matches specific conditions."}),we&&t.jsx("div",{className:"alert error",role:"alert",children:we}),ke?t.jsx("div",{className:"card-placeholder",children:"Loading rules"}):F.length===0?t.jsx("div",{className:"card-placeholder",children:"No conditional rules have been configured."}):t.jsx("div",{className:"field-rules-list",children:F.map((se,Z)=>t.jsxs("article",{className:"field-rule-card",children:[t.jsxs("div",{className:"field-rule-content",children:[t.jsx("h3",{children:se.name||`Rule ${Z+1}`}),t.jsx("p",{className:"field-rule-match",children:iw[se.match_mode]||iw.all}),t.jsx("ul",{className:"field-rule-condition-list",children:Array.isArray(se.conditions)&&se.conditions.map((Ee,_e)=>t.jsx("li",{children:Ct(Ee)},`condition-${se.id}-${_e}`))}),t.jsx("div",{className:"field-rule-action-list",children:Array.isArray(se.actions)&&se.actions.map((Ee,_e)=>t.jsx("span",{children:Ze(Ee)},`action-${se.id}-${_e}`))})]}),mt&&t.jsxs("div",{className:"field-rule-controls",children:[t.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Ke(se,-1),disabled:Z===0||st===se.id,title:"Move rule up",children:t.jsx(fy,{size:16})}),t.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Ke(se,1),disabled:Z===F.length-1||st===se.id,title:"Move rule down",children:t.jsx(uS,{size:16})}),t.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Lt(se),title:"Edit rule",disabled:ut||ve===se.id,children:t.jsx(Ga,{size:16})}),t.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>Te(se),title:"Delete rule",disabled:ve===se.id||ut,children:t.jsx(zn,{size:16})})]})]},se.id))})]}),t.jsx("div",{className:"entity-type-cards",children:v||N?t.jsx("div",{className:"card-placeholder",children:"Loading fields..."}):g.length===0?t.jsx("div",{className:"card-placeholder",children:"No custom fields defined yet."}):g.map(se=>{const Z=se.createdAt||se.created_at,Ee=se.reference_type_name||Be.get(se.reference_type_id),_e=Dp[se.data_type]||se.data_type;return t.jsxs("div",{className:"entity-type-card",children:[t.jsxs("div",{className:"card-header",children:[t.jsx("h3",{children:se.label||se.name}),mt&&t.jsxs("div",{className:"entity-type-actions",children:[t.jsx("button",{type:"button",className:"icon-btn",title:"Edit field",onClick:()=>Tt(se),disabled:z||U===se.id,children:t.jsx(Ga,{size:16})}),t.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete field",onClick:()=>At(se),disabled:U===se.id||z,children:t.jsx(zn,{size:16})})]})]}),t.jsxs("dl",{className:"field-card-metadata",children:[t.jsxs("div",{children:[t.jsx("dt",{children:"Field Name"}),t.jsx("dd",{children:se.name})]}),t.jsxs("div",{children:[t.jsx("dt",{children:"Data Type"}),t.jsx("dd",{children:_e})]}),t.jsxs("div",{children:[t.jsx("dt",{children:"Required"}),t.jsx("dd",{children:se.required?"Yes":"No"})]}),se.data_type==="enum"&&t.jsxs("div",{children:[t.jsx("dt",{children:"Options"}),t.jsx("dd",{children:ie(se)})]}),se.data_type==="reference"&&t.jsxs("div",{children:[t.jsx("dt",{children:"Reference Type"}),t.jsx("dd",{children:Ee||""})]}),t.jsxs("div",{children:[t.jsx("dt",{children:"Created"}),t.jsx("dd",{children:Se(Z)})]})]})]},`field-card-${se.id}`)})}),M&&t.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:t.jsxs("div",{className:"side-panel",children:[t.jsxs("div",{className:"side-panel-header",children:[t.jsx("h2",{children:C?"Edit Field":"Add Field"}),t.jsx("button",{type:"button",className:"icon-btn",onClick:$t,title:"Close form",disabled:z,children:t.jsx(ea,{size:18})})]}),t.jsx("div",{className:"side-panel-content",children:t.jsx(I3,{initialData:C,entityReferenceTypes:m,locationReferenceTypes:h,onSubmit:Qt,onCancel:$t,submitting:z,errorMessage:V})})]})}),Le&&t.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:t.jsxs("div",{className:"side-panel",children:[t.jsxs("div",{className:"side-panel-header",children:[t.jsx("h2",{children:Oe?"Edit conditional rule":"Add conditional rule"}),t.jsx("button",{type:"button",className:"icon-btn",onClick:ce,title:"Close form",disabled:ut,children:t.jsx(ea,{size:18})})]}),t.jsx("div",{className:"side-panel-content",children:t.jsx(U3,{fields:g,initialData:Oe,onSubmit:Ae,onCancel:ce,submitting:ut,errorMessage:_t})})]})})]}):t.jsx("p",{children:"Authenticating..."}):t.jsx("p",{children:"Restoring session..."})}const Y3="Create Entity Type",G3=[{title:"Details",columns:1,fields:[{key:"name",label:"Name",type:"text",placeholder:"e.g. Faction"},{key:"world_id",label:"World",type:"select",optionsSource:"worlds",placeholder:"Select the world this type belongs to",required:!0},{key:"description",label:"Description",type:"textarea",placeholder:"Optional description for this entity type"}]}],K3={title:Y3,sections:G3};function X3(){const e=Mn(),{user:n,token:s,sessionReady:i}=un(),{selectedCampaign:l}=jn(),[o,d]=u.useState(!1),m=u.useMemo(()=>{if(!l?.world)return"";const S=l.world;return S.created_by||S.creator?.id||S.owner_id||S.owner?.id||""},[l]),p=!!(n?.id&&m===n.id),h=u.useMemo(()=>n?n.role==="system_admin"?!0:p:!1,[n,p]),y=l?.world?.id??"",g=l?.world?.name??"";if(!i)return t.jsx("p",{children:"Restoring session..."});if(!s)return t.jsx("p",{children:"Authenticating..."});if(!h)return t.jsxs("section",{className:"page limited-access",children:[t.jsx("h1",{children:"Create Entity Type"}),t.jsx("p",{children:"Only system administrators or the world owner can create entity types."}),t.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/entity-types"),children:"Back to Entity Types"})]});if(!y)return t.jsxs("section",{className:"page create-entity-type",children:[t.jsx("h1",{children:"Create Entity Type"}),t.jsx("p",{children:"Select a campaign from the header to choose a world context before creating entity types."}),t.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/entity-types"),children:"Back to Entity Types"})]});const x=()=>{e("/entity-types")},v=async S=>{if(o)return!1;const N=typeof S?.name=="string"?S.name.trim():"",E=typeof S?.description=="string"?S.description.trim():"",A=(typeof S?.world_id=="string"&&S.world_id||typeof S?.worldId=="string"&&S.worldId||S?.world&&typeof S.world.id=="string"&&S.world.id||y||"").trim();if(!N)return alert("Name is required"),!1;if(!A)return alert("Select a world before creating the entity type"),!1;d(!0);try{const _=await iI({name:N,description:E,world_id:A}),M=_?.data??_;return!M||!M.id?(alert("Failed to create entity type"),!1):(e(`/entity-types/${M.id}/fields`),!0)}catch(T){return alert(`Failed to create entity type: ${T.message}`),!1}finally{d(!1)}};return t.jsxs("section",{className:"page create-entity-type",children:[o&&t.jsx("div",{className:"form-status",role:"status","aria-live":"polite",children:"Saving entity type..."}),t.jsx(us,{schema:K3,initialData:{world_id:y,world:y?{id:y,name:g||"Selected world"}:void 0},onSubmit:v,onCancel:x,showUpdateAction:!1})]})}const O1=u.createContext({}),W3=new Set(["true","1","yes","on"]),lw=e=>{if(e==null)return;if(typeof e=="boolean")return e;const n=String(e).trim().toLowerCase();if(n!=="")return W3.has(n)},Z3=e=>{const n=lw(e);if(n!==void 0)return n;const s=lw(void 0);return s!==void 0?s:!1};function Q3({children:e,initialFeatures:n={}}){const s=Z3(n.rel_builder_v2),i=u.useMemo(()=>({...n,rel_builder_v2:s}),[n,s]);return t.jsx(O1.Provider,{value:i,children:e})}const J3=()=>u.useContext(O1),e5=e=>!!J3()?.[e],t5="visible",n5=e=>{if(!e)return null;const n=e.id??e.value??e.entity_type_id??e.entityTypeId??(typeof e=="string"||typeof e=="number"?e:null);if(n==null||n==="")return null;const s=e.name||e.label||e.title||e.display||e.slug||(typeof e=="string"||typeof e=="number"?String(e):"Untitled type");return{id:String(n),name:String(s)}};function ow({allowedTypeIds:e=[],defaultTypeId:n="",worldId:s,onCreated:i,onCancel:l,entityTypes:o=[],onToast:d}){const[m,p]=u.useState({name:"",entityTypeId:"",summary:""}),[h,y]=u.useState(!1),[g,x]=u.useState(""),[v,S]=u.useState(""),N=u.useRef(!1),E=u.useMemo(()=>new Set((e||[]).map(C=>String(C))),[e]),j=u.useMemo(()=>{const C=(Array.isArray(o)?o:[]).map(D=>n5(D)).filter(Boolean);return E.size===0?C:C.filter(D=>E.has(D.id))},[o,E]),A=u.useMemo(()=>n&&E.size>0&&E.has(String(n))?String(n):j.length>0?j[0].id:n?String(n):"",[n,E,j]);u.useEffect(()=>{p(C=>({...C,entityTypeId:A}))},[A]);const T=u.useCallback(()=>{p({name:"",entityTypeId:A,summary:""}),x(""),S(""),N.current=!1},[A]),_=C=>D=>{const{value:z}=D.target;p(G=>({...G,[C]:z}))};u.useEffect(()=>{if(!m.entityTypeId){S("");return}E.size>0&&!E.has(String(m.entityTypeId))?(S("This type is not allowed for the selected relationship."),N.current||(d?.("This entity type is not allowed for this relationship.","warning"),N.current=!0)):(S(""),N.current=!1)},[m.entityTypeId,E,d]);const M=async C=>{if(C.preventDefault(),!s){x("Select a world before creating entities.");return}const D=m.name.trim();if(!D){x("Name is required.");return}const z=m.entityTypeId;if(!z){x("Entity type is required.");return}if(E.size>0&&!E.has(String(z))){S("This type is not allowed for the selected relationship."),N.current||(d?.("This entity type is not allowed for this relationship.","warning"),N.current=!0);return}try{y(!0),x("");const G={world_id:s,name:D,entity_type_id:z,visibility:t5},U=m.summary.trim();U&&(G.description=U);const X=await fg(G),V=X?.data?.data??X?.data??X;if(!V||V.id===void 0||V.id===null)throw new Error("Failed to create entity");i?.(V),T()}catch(G){x(G.message||"Could not create entity. Please try again."),d?.("Could not create entity. Please try again.","error")}finally{y(!1)}},k=h||!m.name.trim()||!m.entityTypeId||E.size>0&&!E.has(String(m.entityTypeId))||j.length===0;return t.jsxs("div",{className:"entity-mini-create-inline",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"entity-mini-name",children:"Name *"}),t.jsx("input",{id:"entity-mini-name",type:"text",value:m.name,onChange:_("name"),disabled:h,required:!0})]}),t.jsxs("div",{className:"form-two-column",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"entity-mini-type",children:"Type *"}),t.jsxs("select",{id:"entity-mini-type",value:m.entityTypeId,onChange:_("entityTypeId"),disabled:h||j.length===0,required:!0,children:[t.jsx("option",{value:"",children:"Select type..."}),j.map(C=>t.jsx("option",{value:C.id,children:C.name},C.id))]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"entity-mini-summary",children:"Summary"}),t.jsx("input",{id:"entity-mini-summary",type:"text",value:m.summary,onChange:_("summary"),placeholder:"Optional short summary",disabled:h})]})]}),(g||v)&&t.jsx("div",{className:`form-error${v?" warning":""}`,role:"alert",children:v||g}),t.jsxs("div",{className:"inline-actions",children:[t.jsx("button",{type:"button",className:"btn secondary",onClick:l,disabled:h,children:"Cancel"}),t.jsx("button",{type:"button",className:"btn",disabled:k,onClick:M,children:h?"Creating":"Save"})]})]})}const a5=[{value:"source",label:"This entity is the source"},{value:"target",label:"This entity is the target"}];function s5({value:e,onChange:n,disabled:s=!1}){const i=l=>{const o=l.target.value==="target"?"target":"source";o!==e&&n?.(o)};return t.jsxs("fieldset",{className:"perspective-toggle",disabled:s,children:[t.jsx("legend",{children:"Relationship Perspective"}),t.jsx("div",{role:"radiogroup","aria-label":"Relationship perspective",className:"perspective-toggle-options",children:a5.map(l=>{const o=["perspective-toggle-option"];return l.value===e&&o.push("active"),s&&o.push("disabled"),t.jsxs("label",{className:o.join(" "),children:[t.jsx("input",{type:"radio",name:"relationship-perspective",value:l.value,checked:e===l.value,onChange:i,disabled:s}),t.jsx("span",{children:l.label})]},l.value)})})]})}const pd=e=>e==null?"":String(e).trim(),r5=e=>{if(e==null)return"";if(typeof e=="object")try{return JSON.stringify(e)}catch{return""}return String(e)},i5=e=>{const n=e.trim();if(!n)return"";if(n==="true")return!0;if(n==="false")return!1;const s=n[0],i=n[n.length-1];if(s==="{"&&i==="}"||s==="["&&i==="]")try{return JSON.parse(n)}catch{return e}const l=Number(n);return!Number.isNaN(l)&&n!==""?l:e},yd=e=>{if(!Array.isArray(e)||e.length===0)return"";if(e.length===1)return e[0];if(e.length===2)return`${e[0]} or ${e[1]}`;const n=e.slice(0,-1),s=e[e.length-1];return`${n.join(", ")}, or ${s}`},l5=e=>{if(!e||e.id===void 0||e.id===null)return null;const n=e.entity_type_id??e.entityTypeId??e.entity_type?.id??e.entityType?.id??null,s=e.entityType||e.entity_type||(n&&e.entity_type_name?{id:n,name:e.entity_type_name}:null);return{...e,id:e.id,name:e.name||"Untitled entity",entity_type_id:n,entityType:s}},cw=e=>e?.name||e?.entityType?.name||e?.entity_type?.name||"",hc=(e,n)=>{if(!e)return[];const s=n==="from"?e?.from_entity_types??e?.fromEntityTypes??e?.fromTypes??[]:e?.to_entity_types??e?.toEntityTypes??e?.toTypes??[];return Array.isArray(s)?s:[]},o5=e=>{if(!e)return"";if(typeof e=="string"||typeof e=="number")return String(e).trim();if(typeof e=="object"){if(e.id!==void 0&&e.id!==null)return String(e.id);if(e.entity_type_id!==void 0&&e.entity_type_id!==null)return String(e.entity_type_id);if(e.entityTypeId!==void 0&&e.entityTypeId!==null)return String(e.entityTypeId);if(e.entityType?.id!==void 0&&e.entityType?.id!==null)return String(e.entityType.id);if(e.entity_type?.id!==void 0&&e.entity_type?.id!==null)return String(e.entity_type.id)}return""},ec=(e,n)=>hc(e,n).map(s=>o5(s)).filter(s=>s!=="");function c5({worldId:e,relationshipId:n,onCancel:s,onSaved:i,onToast:l,defaultFromEntityId:o,lockFromEntity:d=!1,defaultToEntityId:m,lockToEntity:p=!1,defaultPerspective:h="source",currentEntityId:y,currentEntityTypeId:g,formId:x="relationship-form",onStateChange:v,hideActions:S=!1}){const N=!!n,E=N,j=N,A=u.useRef(0),T=u.useCallback((ee="",xe="")=>(A.current+=1,{id:A.current,key:ee,value:xe}),[]),_=u.useCallback(ee=>ee.length>0?ee:[T()],[T]),M=u.useCallback(ee=>{if(!ee||typeof ee!="object"||Array.isArray(ee))return"";const xe=ee.__direction||ee.direction;return xe?String(xe):""},[]),k=u.useCallback(ee=>{if(A.current=0,!ee||typeof ee!="object"||Array.isArray(ee))return[T()];const xe=Object.entries(ee).filter(([Ie])=>typeof Ie!="string"?!0:!Ie.startsWith("__"));return xe.length===0?[T()]:xe.map(([Ie,et])=>T(Ie,r5(et)))},[T]),C=pd(o),D=pd(m),z=pd(y),G=pd(g),U=h==="target"?"reverse":"forward",X=U==="forward"?C:"",V=U==="reverse"?D:"",[R,B]=u.useState([]),[L,O]=u.useState([]),[$,F]=u.useState([]),[H,I]=u.useState({fromEntityId:X,toEntityId:V,relationshipTypeId:""}),[Y,P]=u.useState(()=>(A.current=0,[T()])),[K,re]=u.useState(U),[W,ue]=u.useState(!1),[Q,ye]=u.useState(!1),[ae,ke]=u.useState(!1),[pe,we]=u.useState(!1),[ne,Le]=u.useState(!1),[be,Oe]=u.useState(""),[Me,ut]=u.useState(""),[ht,_t]=u.useState(null),jt=u.useRef({from:null,to:null}),[ve,tt]=u.useState({from:"",to:""}),st=K==="reverse"?"target":"source",$e=st==="source",Ye=u.useMemo(()=>st==="target"?p?"to":d?"from":"":d?"from":p?"to":"",[d,p,st]),mt=Ye==="from"?"to":Ye==="to"?"from":"",ie=u.useMemo(()=>Y.some(ee=>ee.key.trim()!==""||ee.value.trim()!==""),[Y]);u.useEffect(()=>{let ee=!1;return e?((async()=>{ue(!0);try{const Ie=await _c(e),et=Array.isArray(Ie)?Ie:Array.isArray(Ie?.data)?Ie.data:[];ee||B(et)}catch(Ie){ee||(B([]),Oe(Ie.message||"Failed to load entities"))}finally{ee||ue(!1)}})(),()=>{ee=!0}):(B([]),()=>{})},[e]),u.useEffect(()=>{let ee=!1;return e?((async()=>{ye(!0);try{const Ie=await Of({worldId:e}),et=Array.isArray(Ie)?Ie:Array.isArray(Ie?.data)?Ie.data:[];ee||O(et)}catch(Ie){ee||(O([]),Oe(Ie.message||"Failed to load relationship types"))}finally{ee||ye(!1)}})(),()=>{ee=!0}):(O([]),ye(!1),()=>{})},[e]),u.useEffect(()=>{let ee=!1;return(async()=>{if(!e){F([]),ke(!1);return}ke(!0);try{const Ie=await br({worldId:e}),et=Array.isArray(Ie)?Ie:Array.isArray(Ie?.data)?Ie.data:[];ee||F(et)}catch(Ie){ee||(F([]),Oe(et=>et||Ie.message||"Failed to load entity types"))}finally{ee||ke(!1)}})(),()=>{ee=!0}},[e]);const J=ee=>{if(!ee)return"";const xe=ee.entity_type_id??ee.entityTypeId??ee.entityType?.id??ee.entity_type?.id??"";return xe?String(xe):""},le=u.useMemo(()=>H.fromEntityId&&R.find(ee=>String(ee.id)===String(H.fromEntityId))||null,[R,H.fromEntityId]),fe=u.useMemo(()=>J(le),[le]),Ue=u.useMemo(()=>H.toEntityId&&R.find(ee=>String(ee.id)===String(H.toEntityId))||null,[R,H.toEntityId]),qe=u.useMemo(()=>J(Ue),[Ue]),ze=u.useMemo(()=>Ye==="from"?fe||(z&&H.fromEntityId===z&&G||C&&H.fromEntityId===C&&G?G:""):Ye==="to"?qe||(z&&H.toEntityId===z&&G||D&&H.toEntityId===D&&G?G:""):"",[Ye,fe,qe,H.fromEntityId,H.toEntityId,z,G,C,D]),Ce=u.useMemo(()=>K==="reverse"?Ye==="to"?"from":"to":"from",[K,Ye]),pt=u.useMemo(()=>K==="reverse"?Ye==="to"?"to":"from":"to",[K,Ye]),bt=u.useMemo(()=>{const ee=ze?String(ze):"";if(ee){if(Ye==="from")return{typeId:ee,role:Ce};if(Ye==="to")return{typeId:ee,role:pt}}return fe?{typeId:String(fe),role:Ce}:qe?{typeId:String(qe),role:pt}:null},[ze,Ye,fe,qe,Ce,pt]),Ct=u.useMemo(()=>{if(!L?.length)return[];const ee=(Ie,et,Nt)=>{if(!Nt)return Ie;const Rt=String(Nt);return Ie.filter(nn=>{const Pt=ec(nn,et);return Pt.length===0?!0:Pt.includes(Rt)})};let xe=L;if(bt){const{typeId:Ie,role:et}=bt;xe=ee(xe,et,Ie)}return xe=ee(xe,Ce,fe),xe=ee(xe,pt,qe),xe},[L,bt,Ce,pt,fe,qe]),Ze=u.useMemo(()=>H.relationshipTypeId?L.find(ee=>String(ee.id)===String(H.relationshipTypeId)):null,[L,H.relationshipTypeId]),ot=u.useMemo(()=>Ze?ec(Ze,Ce):[],[Ze,Ce]),Tt=u.useMemo(()=>Ze?ec(Ze,pt):[],[Ze,pt]),$t=u.useMemo(()=>ot.length>0?String(ot[0]):"",[ot]),Qt=u.useMemo(()=>Tt.length>0?String(Tt[0]):"",[Tt]),At=ee=>{const xe=ee==="target"?"reverse":"forward";ut(""),K!==xe&&I(Ie=>{const et={...Ie,relationshipTypeId:""};if(!N){const Nt=z||"";if(xe==="reverse"){const Rt=D||Nt;Rt&&(et.toEntityId=Rt,d&&Ie.fromEntityId===Rt&&(et.fromEntityId=""))}else{const Rt=C||Nt;Rt&&(et.fromEntityId=Rt,p&&Ie.toEntityId===Rt&&(et.toEntityId=""))}}return et}),re(Ie=>Ie===xe?Ie:xe)},kt=u.useCallback(ee=>{if(ee==="from"){if(Ye==="from")return;if(!ot.length){l?.("This entity type is not allowed for this relationship.","warning");return}}else{if(Ye==="to")return;if(!Tt.length){l?.("This entity type is not allowed for this relationship.","warning");return}}_t(ee)},[ot.length,Tt.length,Ye,l]);u.useEffect(()=>{(ht==="from"&&ot.length===0||ht==="to"&&Tt.length===0)&&_t(null)},[ht,ot.length,Tt.length]);const qt=u.useMemo(()=>{if(!ot.length)return R;const ee=new Set(ot);return R.filter(xe=>ee.has(J(xe)))},[R,ot]),Lt=u.useMemo(()=>{if(!Tt.length)return R;const ee=new Set(Tt);return R.filter(xe=>ee.has(J(xe)))},[R,Tt]);u.useEffect(()=>{if(!H.relationshipTypeId)return;Ct.some(xe=>String(xe.id)===String(H.relationshipTypeId))||I(xe=>({...xe,relationshipTypeId:""}))},[Ct,H.relationshipTypeId]),u.useEffect(()=>{if(!H.relationshipTypeId||!fe)return;if(d||p||z){ut("");return}const ee=String(fe),xe=L.find(nn=>String(nn.id)===String(H.relationshipTypeId));if(!xe)return;const Ie=ec(xe,"from"),et=ec(xe,"to"),Nt=Ie.includes(ee),Rt=et.includes(ee);if(Nt&&Rt){ut("");return}if(Nt&&K!=="forward"){re("forward"),ut("");return}if(!Nt&&Rt){const nn="Direction auto-corrected because this entity is only allowed as a target.";K!=="reverse"?(re("reverse"),ut(nn)):ut(Pt=>Pt||nn);return}!Nt&&!Rt&&(ut(""),I(nn=>({...nn,relationshipTypeId:""})))},[H.relationshipTypeId,fe,L,K,d,p,z]),u.useEffect(()=>{if(!H.fromEntityId||!ot.length)return;const ee=new Set(ot),xe=R.find(et=>String(et.id)===String(H.fromEntityId));if(!xe)return;const Ie=J(xe);(!Ie||!ee.has(Ie))&&I(et=>({...et,fromEntityId:""}))},[ot,R,H.fromEntityId]),u.useEffect(()=>{if(!H.toEntityId||!Tt.length)return;const ee=new Set(Tt),xe=R.find(et=>String(et.id)===String(H.toEntityId));if(!xe)return;const Ie=J(xe);(!Ie||!ee.has(Ie))&&I(et=>({...et,toEntityId:""}))},[Tt,R,H.toEntityId]);const ce=u.useMemo(()=>{if(!Ze)return"";const ee=hc(Ze,Ce);return ee.length?ee.map(xe=>xe?.name||xe?.entityType?.name||xe?.entity_type?.name||"Unknown type").join(", "):""},[Ze,Ce]),Ae=u.useMemo(()=>{if(!Ze)return"";const ee=hc(Ze,pt);return ee.length?ee.map(xe=>xe?.name||xe?.entityType?.name||xe?.entity_type?.name||"Unknown type").join(", "):""},[Ze,pt]),Te=Ce==="from"?"source":"target",Ke=pt==="from"?"source":"target",Se=`Allowed ${Te}s`,Be=`Allowed ${Ke}s`,We=u.useMemo(()=>Ze&&(K==="reverse"?Ze.to_name||Ze.toName:Ze.from_name||Ze.fromName)||"",[Ze,K]),se=u.useMemo(()=>Ze&&(K==="reverse"?Ze.from_name||Ze.fromName:Ze.to_name||Ze.toName)||"",[Ze,K]),Z=u.useMemo(()=>Ze?hc(Ze,Ce).map(ee=>cw(ee)).filter(ee=>ee&&ee.trim()):[],[Ze,Ce]),Ee=u.useMemo(()=>Ze?hc(Ze,pt).map(ee=>cw(ee)).filter(ee=>ee&&ee.trim()):[],[Ze,pt]),_e=u.useMemo(()=>!Ze||!Z.length&&!Ee.length?"":Z.length&&Ee.length?`This relationship can only be initiated from ${yd(Z)} and targets ${yd(Ee)}.`:Z.length?`This relationship can only be initiated from ${yd(Z)}.`:`This relationship targets ${yd(Ee)}.`,[Ze,Z,Ee]),ge=u.useMemo(()=>{if(!Ye||!Ze)return"";const ee=ze?String(ze):"";if(!ee)return"";if(Ye==="from"){if(ot.length>0&&!ot.includes(ee))return $e?"This entity is not an allowed source for the selected relationship type. Try switching perspective.":"This entity is not an allowed target for the selected relationship type. Try switching perspective."}else if(Ye==="to"&&Tt.length>0&&!Tt.includes(ee))return $e?"This entity is not an allowed target for the selected relationship type. Try switching perspective.":"This entity is not an allowed source for the selected relationship type. Try switching perspective.";return""},[Ye,Ze,ze,ot,Tt,$e]),Pe=u.useMemo(()=>Ye?Ye==="from"?$e?"This entity is fixed as the source for this relationship.":"This field is locked to the current entity.":Ye==="to"?$e?"This field is locked to the current entity.":"This entity is fixed as the target for this relationship.":"":"",[Ye,$e]),oe=!!ge;u.useEffect(()=>{let ee=!1;const xe=()=>{A.current=0,I({fromEntityId:U==="forward"?C:"",toEntityId:U==="reverse"?D:"",relationshipTypeId:""}),P([T()]),re(U),Oe(""),_t(null)};return!N||!n?(xe(),we(!1),()=>{}):((async()=>{we(!0),Oe("");try{const et=await cL(n),Nt=et?.data||et;if(!Nt)throw new Error("Relationship not found");if(!ee){const Rt=Nt.from_entity_id||Nt.fromEntityId||Nt.from_entity?.id||Nt.fromEntity?.id||"",nn=Nt.to_entity_id||Nt.toEntityId||Nt.to_entity?.id||Nt.toEntity?.id||"",Pt=Nt.entity_relationship_type_id||Nt.relationship_type_id||Nt.relationshipType?.id||Nt.relationship_type?.id||"";I({fromEntityId:Rt?String(Rt):"",toEntityId:nn?String(nn):"",relationshipTypeId:Pt?String(Pt):""}),re(M(Nt.context)||"forward"),P(_(k(Nt.context)))}}catch(et){ee||Oe(et.message||"Failed to load relationship")}finally{ee||we(!1)}})(),()=>{ee=!0})},[n,N,_,k,T,M,U,C,D]),u.useEffect(()=>{if(N)return;const ee=h==="target"?"reverse":"forward";re(xe=>xe===ee?xe:ee)},[h,N]),u.useEffect(()=>{if(N||!Ye)return;const ee=z||"",xe=Ye==="from"?C||ee:D||ee;xe&&I(Ie=>{const et=Ye==="from"?"fromEntityId":"toEntityId";if(Ie[et]===xe)return Ie;const Nt={...Ie,[et]:xe};return Ye==="from"&&p&&Ie.toEntityId===xe&&(Nt.toEntityId=""),Ye==="to"&&d&&Ie.fromEntityId===xe&&(Nt.fromEntityId=""),Nt})},[N,Ye,d,p,C,D,z]);const at=ee=>xe=>{const{value:Ie}=xe.target;I(et=>{if(N)return{...et,[ee]:Ie};const Nt={...et,relationshipTypeId:Ie};return Ye==="from"?Nt.toEntityId="":Ye==="to"&&(Nt.fromEntityId=""),Nt}),_t(null)},dt=ee=>{const{value:xe}=ee.target;_t(Ie=>Ie==="from"?null:Ie),I(Ie=>({...Ie,fromEntityId:xe}))},xt=ee=>{const{value:xe}=ee.target;_t(Ie=>Ie==="to"?null:Ie),I(Ie=>({...Ie,toEntityId:xe}))},de=u.useCallback(()=>{_t(null)},[]),it=u.useCallback((ee,xe)=>{const Ie=ee==="to"?"to":"from",et=xe?String(xe):"";tt(Nt=>({...Nt,[Ie]:et})),jt.current[Ie]&&clearTimeout(jt.current[Ie]),jt.current[Ie]=setTimeout(()=>{tt(Nt=>({...Nt,[Ie]:""})),jt.current[Ie]=null},2e3)},[]),nt=u.useCallback((ee,xe)=>{const Ie=l5(xe);if(!Ie)return;const et=String(Ie.id);B(Pt=>{const Ft={...Ie,id:et},zt=Pt.findIndex(dn=>String(dn.id)===et);if(zt>=0){const dn=[...Pt];return dn[zt]={...dn[zt],...Ft},dn}return[Ft,...Pt]}),ee==="from"?I(Pt=>({...Pt,fromEntityId:et})):ee==="to"&&I(Pt=>({...Pt,toEntityId:et})),it(ee,et),_t(null);const Nt=ee==="from"?Te:Ke,Rt=`${Nt[0].toUpperCase()}${Nt.slice(1)}`,nn=Rt?`New ${Rt} entity added and selected.`:"New entity added and selected.";l?.(nn,"success")},[it,Te,Ke,l]);u.useEffect(()=>{const ee=jt.current;return()=>{Object.values(ee).forEach(xe=>{xe&&clearTimeout(xe)})}},[]);const vt=(ee,xe)=>Ie=>{const{value:et}=Ie.target;P(Nt=>Nt.map(Rt=>Rt.id===ee?{...Rt,[xe]:et}:Rt))},lt=()=>{P(ee=>[...ee,T()])},wt=ee=>{P(xe=>_(xe.filter(Ie=>Ie.id!==ee)))},He=async ee=>{if(ee.preventDefault(),!e){Oe("Select a world before creating relationships.");return}const xe=H.fromEntityId.trim(),Ie=H.toEntityId.trim(),et=H.relationshipTypeId.trim();if(!xe||!Ie){Oe("Both entities are required.");return}if(!et){Oe("Relationship type is required.");return}const Nt={};Y.forEach(({key:dn,value:Bn})=>{const yn=dn.trim();yn&&(yn.startsWith("__")||(Nt[yn]=i5(Bn)))});const Rt=K==="reverse"?"reverse":"forward";Nt.__direction=Rt;let nn=xe,Pt=Ie;Rt==="reverse"&&(!z||H.fromEntityId===z)&&(nn=Ie,Pt=xe);const zt={world_id:e,from_entity_id:nn,to_entity_id:Pt,relationship_type_id:et,bidirectional:!0,context:Nt};try{if(Le(!0),Oe(""),N)await uL(n,zt),i?.("edit");else{const dn=await u1(zt),Bn=dn?.data??dn,yn=Bn?.data??Bn;i?.("create",yn)}}catch(dn){Oe(dn.message||"Failed to save relationship")}finally{Le(!1)}},Je=W||Q||pe||ae,St=!!bt?.typeId&&Ct.length===0;return u.useEffect(()=>{if(!v)return;v({mode:N?"edit":"create",saving:ne,isBusy:Je,submitLabel:ne?"Saving...":N?"Save Changes":"Create Relationship",submitDisabled:ne||Je||oe,cancelDisabled:ne})},[v,N,ne,Je,oe]),t.jsxs("form",{id:x,className:"entity-form relationship-form",onSubmit:He,children:[t.jsx(s5,{value:st,onChange:At,disabled:ne||Je}),ge&&t.jsx("div",{className:"alert warning",role:"alert",children:ge}),Me&&t.jsx("div",{className:"alert warning",role:"status",children:Me}),t.jsxs("div",{className:"form-two-column",children:[t.jsxs("div",{className:`form-group${ve.from&&ve.from===H.fromEntityId?" entity-select-highlight":""}`,children:[t.jsx("label",{htmlFor:"relationship-from-entity",children:"From Entity *"}),t.jsxs("select",{id:"relationship-from-entity",value:H.fromEntityId,onChange:dt,disabled:ne||Je||Ye==="from",required:!0,"data-autofocus":mt==="from"?!0:void 0,children:[t.jsx("option",{value:"",children:"Select entity..."}),qt.map(ee=>t.jsx("option",{value:ee.id,children:ee.name},ee.id))]}),Ye==="from"&&Pe&&t.jsx("p",{className:"field-hint",children:Pe}),E&&We&&t.jsxs("p",{className:"field-hint",children:["Displayed label: ",We]}),E&&Ze&&ce&&t.jsxs("p",{className:"field-hint",children:[Se,": ",ce]}),Ye!=="from"&&t.jsx("div",{className:"inline-create-trigger",children:ot.length>0?t.jsx("button",{type:"button",className:"link-button",onClick:()=>kt("from"),disabled:ht==="from",children:"+ Create new"}):t.jsx("button",{type:"button",className:"link-button disabled",disabled:!0,children:"+ Create new"})}),Ye!=="from"&&ot.length===0&&t.jsx("p",{className:"inline-create-hint disabled",children:"Inline creation isnt available for this relationship."}),Ze&&ot.length>0&&qt.length===0&&t.jsxs("p",{className:"field-hint",children:["No entities match the allowed ",Te," types yet. Use + Create new to add one without leaving this page."]}),Ye!=="from"&&ht==="from"&&t.jsx(ow,{allowedTypeIds:ot,defaultTypeId:$t,worldId:e,entityTypes:$,onCreated:ee=>nt("from",ee),onCancel:de,onToast:l},`inline-from-${H.relationshipTypeId}`)]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"relationship-type",children:"Relationship Type *"}),t.jsxs("select",{id:"relationship-type",value:H.relationshipTypeId,onChange:at("relationshipTypeId"),disabled:ne||Je||!Ct.length,required:!0,children:[t.jsx("option",{value:"",children:"Select type..."}),Ct.map(ee=>{const xe=ee.from_name||ee.fromName||ee.name,Ie=ee.to_name||ee.toName||ee.name,et=xe===Ie?xe:`${xe}  ${Ie}`;return t.jsxs("option",{value:ee.id,children:[ee.name,"  ",et]},ee.id)})]}),St&&t.jsx("p",{className:"field-hint",children:"No relationship types include the selected entity type."}),_e&&t.jsx("p",{className:"helper-hint",children:_e})]})]}),t.jsx("div",{className:"form-two-column",children:t.jsxs("div",{className:`form-group${ve.to&&ve.to===H.toEntityId?" entity-select-highlight":""}`,children:[t.jsx("label",{htmlFor:"relationship-to-entity",children:"To Entity *"}),t.jsxs("select",{id:"relationship-to-entity",value:H.toEntityId,onChange:xt,disabled:ne||Je||Ye==="to",required:!0,"data-autofocus":mt==="to"?!0:void 0,children:[t.jsx("option",{value:"",children:"Select entity..."}),Lt.map(ee=>t.jsx("option",{value:ee.id,children:ee.name},ee.id))]}),Ye==="to"&&Pe&&t.jsx("p",{className:"field-hint",children:Pe}),E&&se&&t.jsxs("p",{className:"field-hint",children:["Displayed label: ",se]}),E&&Ze&&Ae&&t.jsxs("p",{className:"field-hint",children:[Be,": ",Ae]}),Ye!=="to"&&t.jsx("div",{className:"inline-create-trigger",children:Tt.length>0?t.jsx("button",{type:"button",className:"link-button",onClick:()=>kt("to"),disabled:ht==="to",children:"+ Create new"}):t.jsx("button",{type:"button",className:"link-button disabled",disabled:!0,children:"+ Create new"})}),Ye!=="to"&&Tt.length===0&&t.jsx("p",{className:"inline-create-hint disabled",children:"Inline creation isnt available for this relationship."}),Ze&&Tt.length>0&&Lt.length===0&&t.jsxs("p",{className:"field-hint",children:["No entities match the allowed ",Ke," types yet. Use + Create new to add one without losing your place."]}),Ye!=="to"&&ht==="to"&&t.jsx(ow,{allowedTypeIds:Tt,defaultTypeId:Qt,worldId:e,entityTypes:$,onCreated:ee=>nt("to",ee),onCancel:de,onToast:l},`inline-to-${H.relationshipTypeId}`)]})}),j&&t.jsxs("div",{className:"metadata-editor",children:[t.jsxs("div",{className:"metadata-header",children:[t.jsxs("h3",{children:["Context ",ie?"":"(optional)"]}),t.jsx("button",{type:"button",className:"btn neutral",onClick:lt,disabled:ne||Je,children:"Add field"})]}),t.jsx("div",{className:"metadata-list",children:Y.map((ee,xe)=>t.jsxs("div",{className:"metadata-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsxs("label",{htmlFor:`context-key-${ee.id}`,className:"sr-only",children:["Context key ",xe+1]}),t.jsx("input",{id:`context-key-${ee.id}`,type:"text",placeholder:"Key",value:ee.key,onChange:vt(ee.id,"key"),disabled:ne||Je})]}),t.jsxs("div",{className:"form-group",children:[t.jsxs("label",{htmlFor:`context-value-${ee.id}`,className:"sr-only",children:["Context value ",xe+1]}),t.jsx("input",{id:`context-value-${ee.id}`,type:"text",placeholder:"Value",value:ee.value,onChange:vt(ee.id,"value"),disabled:ne||Je})]}),t.jsx("div",{className:"metadata-actions",children:t.jsx("button",{type:"button",className:"icon-btn",onClick:()=>wt(ee.id),disabled:ne||Je||Y.length===1,title:"Remove field",children:""})})]},ee.id))})]}),Je&&t.jsx("div",{className:"form-loading",role:"status",children:"Loading data..."}),be&&t.jsx("div",{className:"form-error",role:"alert",children:be}),!S&&t.jsxs("div",{className:"form-actions",children:[t.jsx("button",{type:"button",className:"btn cancel",onClick:s,disabled:ne,children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn submit",disabled:ne||Je||oe,children:ne?"Saving...":N?"Save Changes":"Create Relationship"})]})]})}function u5(e){return t.jsx(c5,{...e})}const d5=new Set(["system_admin"]),uw=(e="create")=>({mode:e,submitLabel:e==="edit"?"Save Changes":"Create Relationship",submitDisabled:!1,cancelDisabled:!1,saving:!1,isBusy:!1});function f5(){const{user:e,token:n,sessionReady:s}=un(),{selectedCampaign:i,activeWorld:l,activeWorldId:o,selectedContextType:d,contextKey:m}=jn(),p=e5("rel_builder_v2"),[h,y]=u.useState(!1),[g,x]=u.useState(!1),[v,S]=u.useState([]),[N,E]=u.useState([]),[j,A]=u.useState({}),T=u.useRef({}),[_,M]=u.useState(!1),[k,C]=u.useState(!1),[D,z]=u.useState(""),[G,U]=u.useState(null),[X,V]=u.useState(""),[R,B]=u.useState(null),[L,O]=u.useState(()=>uw("create")),[$,F]=u.useState(""),[H,I]=u.useState(""),Y=o||"",P=!!Y,K=u.useRef(`${Y}:${m}`),re=u.useRef(`relationship-form-${Math.random().toString(36).slice(2)}`),W=(ie="create")=>{O(uw(ie))},ue=u.useCallback((ie,J="info")=>{B({message:ie,tone:J})},[]);u.useEffect(()=>{if(!R)return;const ie=setTimeout(()=>B(null),3500);return()=>clearTimeout(ie)},[R]);const Q=u.useMemo(()=>!i||!e?"":i.members?.find(J=>J.user_id===e.id)?.role||"",[i,e]),ye=u.useMemo(()=>{const ie=i?.world||l;if(!ie||!e?.id)return!1;const J=ie.created_by||ie.creator?.id||ie.owner_id||ie.owner?.id||"";return J?String(J)===String(e.id):!1},[i,l,e?.id]),ae=u.useMemo(()=>!e||!Y?!1:d5.has(e.role)?!0:d==="world"?ye:!!(i&&(Q==="dm"||ye)),[e,Y,d,i,Q,ye]),ke=u.useCallback(async ie=>{const J=Array.from(new Set(ie.map(ze=>ze==null?"":String(ze)).filter(Boolean)));if(J.length===0)return;const le=T.current,fe=J.filter(ze=>!le[ze]);if(fe.length===0)return;const Ue=await Promise.all(fe.map(async ze=>{try{const Ce=await Us(ze),pt=Ya(Ce);return{id:ze,data:pt}}catch(Ce){return console.error(" Failed to resolve entity",Ce),{id:ze,data:null}}})),qe={};Ue.forEach(({id:ze,data:Ce})=>{Ce?qe[ze]={id:Ce.id||ze,name:Ce.name||`Entity ${ze}`,typeName:Ce.entityType?.name||Ce.entity_type?.name||""}:qe[ze]={id:ze,name:`Entity #${ze}`,typeName:""}}),T.current={...T.current,...qe},A(ze=>({...ze,...qe}))},[]),pe=u.useCallback(async ie=>{const J=ie?{worldId:ie}:{};C(!0);try{const le=await Of(J),fe=Array.isArray(le)?le:Array.isArray(le?.data)?le.data:[];E(fe)}catch(le){console.error(" Failed to load relationship types",le),ue(le.message||"Failed to load relationship types","error"),E([])}finally{C(!1)}},[ue]);u.useEffect(()=>{if(!Y){E([]);return}pe(Y)},[pe,Y,m]);const we=u.useCallback(async ie=>{const J=ie??Y;if(!J||!n)return S([]),[];M(!0),z("");try{const le=await oL(J),fe=Array.isArray(le)?le:Array.isArray(le?.data)?le.data:[];S(fe);const Ue=[];return fe.forEach(qe=>{const ze=qe.from_entity_id||qe.fromEntityId||qe.from_entity?.id||qe.fromEntity?.id||"",Ce=qe.to_entity_id||qe.toEntityId||qe.to_entity?.id||qe.toEntity?.id||"";ze&&Ue.push(ze),Ce&&Ue.push(Ce)}),await ke(Ue),fe}catch(le){return console.error(" Failed to load relationships",le),S([]),z(le.message||"Failed to load relationships"),[]}finally{M(!1)}},[Y,n,ke,m]);u.useEffect(()=>{if(!Y||!n){S([]),T.current={},A({});return}we(Y)},[Y,n,we,m]),u.useEffect(()=>{const ie=`${Y}:${m}`;K.current!==ie&&(h&&y(!1),g&&x(!1),U(null),B(null),F(""),I(""),z(""),T.current={},A({}),K.current=ie)},[Y,m,h,g]);const ne=u.useMemo(()=>{const ie=new Map;return N.forEach(J=>{J?.id&&ie.set(String(J.id),J)}),ie},[N]),Le=ie=>{if(!ie)return"";if(typeof ie=="object"&&ie!==null&&!Array.isArray(ie)){const J=ie.__direction||ie.direction;return J?String(J):""}return""},be=u.useMemo(()=>v.map(ie=>{const J=ie.from_entity_id||ie.fromEntityId||ie.from_entity?.id||ie.fromEntity?.id||"",le=ie.to_entity_id||ie.toEntityId||ie.to_entity?.id||ie.toEntity?.id||"",fe=ie.entity_relationship_type_id||ie.relationship_type_id||ie.relationshipType?.id||ie.relationship_type?.id||"",Ue=ie.relationshipType||ie.relationship_type||ne.get(String(fe))||{},qe=Ue.name||ie.relationshipTypeName||ne.get(String(fe))?.name||"",ze=Ue.from_name||Ue.fromName||ne.get(String(fe))?.from_name||ne.get(String(fe))?.fromName||qe,Ce=Ue.to_name||Ue.toName||ne.get(String(fe))?.to_name||ne.get(String(fe))?.toName||qe,pt=Le(ie.context),bt=pt==="reverse"?Ce:ze,Ct=!!(ie.bidirectional??ie.is_bidirectional??ie.two_way??!1);return{...ie,fromEntityId:J?String(J):"",toEntityId:le?String(le):"",relationshipTypeId:fe?String(fe):"",typeName:bt,direction:pt,typeFromName:ze,typeToName:Ce,bidirectional:Ct,fromEntityName:ie.fromEntity?.name||ie.from_entity?.name||ie.fromEntityName||"",toEntityName:ie.toEntity?.name||ie.to_entity?.name||ie.toEntityName||"",fromEntityTypeName:ie.fromEntity?.entityType?.name||ie.from_entity?.entity_type?.name||"",toEntityTypeName:ie.toEntity?.entityType?.name||ie.to_entity?.entity_type?.name||""}}),[v,ne]),Oe=i?`${i.name}${l?.name?`  ${l.name}`:""}`:P?`World  ${l?.name||"Untitled world"}`:"",Me=u.useCallback((ie,J="",le="")=>{if(!ie)return"";const fe=j[ie],Ue=fe?.name||J||`Entity #${ie}`,qe=fe?.typeName||le;return qe?`${Ue} (${qe})`:Ue},[j]),ut=u.useMemo(()=>{const ie=H.trim().toLowerCase();return be.filter(J=>{if($&&J.relationshipTypeId!==$)return!1;if(!ie)return!0;const le=Me(J.fromEntityId,J.fromEntityName,J.fromEntityTypeName).toLowerCase(),fe=Me(J.toEntityId,J.toEntityName,J.toEntityTypeName).toLowerCase();return le.includes(ie)||fe.includes(ie)})},[be,$,H,Me]);if(!s)return t.jsx("p",{children:"Restoring session..."});if(!n)return t.jsx("p",{children:"Authenticating..."});const ht=ut.length>0,_t=G?"Edit Relationship":"Add Relationship",jt=()=>{Y&&we(Y)},ve=()=>{if(!(!ae||!Y)){if(p){y(!0);return}U(null),W("create"),x(!0)}},tt=ie=>{!ae||!ie?.id||(U(ie.id),W("edit"),x(!0))},st=()=>{x(!1),U(null),W("create")},$e=(ie={})=>{O(J=>({...J,...ie}))},Ye=async(ie,J)=>{if(st(),!!Y){if(await we(Y),ie==="create"&&J){const le=Me(J.from_entity_id,J?.from_entity?.name,J?.from_entity?.entityType?.name||J?.from_entity?.entity_type?.name),fe=Me(J.to_entity_id,J?.to_entity?.name,J?.to_entity?.entityType?.name||J?.to_entity?.entity_type?.name),Ue=J?.relationshipType?.name||"relationship";ue(`Added ${le}  ${fe} (${Ue}).`,"success");return}ue(ie==="create"?"Relationship created":"Relationship updated","success")}},mt=async ie=>{if(!ae||!ie?.id)return;const J=Me(ie.fromEntityId,ie.fromEntityName,ie.fromEntityTypeName),le=Me(ie.toEntityId,ie.toEntityName,ie.toEntityTypeName);if(window.confirm(`Delete relationship "${J}"  "${le}"? This action cannot be undone.`))try{V(ie.id),await dL(ie.id),ue("Relationship deleted","success"),Y&&await we(Y)}catch(Ue){console.error(" Failed to delete relationship",Ue),ue(Ue.message||"Failed to delete relationship","error")}finally{V("")}};return t.jsxs("section",{className:"entities-page relationships-page",children:[t.jsxs("div",{className:"entities-header",children:[t.jsxs("div",{children:[t.jsx("h1",{children:"Entity Relationships"}),P?t.jsx("p",{className:"entities-subtitle",children:Oe}):t.jsx("p",{className:"entities-subtitle",children:"Select a campaign or world you own to choose a world context."})]}),t.jsxs("div",{className:"entities-controls",children:[t.jsxs("select",{value:$,onChange:ie=>F(ie.target.value),disabled:k||N.length===0,title:"Filter by relationship type",children:[t.jsx("option",{value:"",children:"All types"}),N.map(ie=>t.jsx("option",{value:String(ie.id),children:ie.name},ie.id))]}),t.jsx(hg,{value:H,onChange:I}),t.jsx("button",{type:"button",className:"icon-btn",title:"Refresh relationships",onClick:jt,disabled:!Y||_,children:t.jsx(Ui,{size:16})}),t.jsxs("button",{type:"button",className:"btn submit",onClick:ve,disabled:!ae||!Y||_,children:[t.jsx(sa,{size:16})," Add Relationship"]})]})]}),i&&P&&!ae&&t.jsx("div",{className:"alert info",role:"status",children:"You can view existing relationships, but only the world owner, a campaign DM, or a system administrator can create or edit them."}),R&&t.jsx("div",{className:`toast-banner ${R.tone}`,role:"status",children:R.message}),D&&t.jsx("div",{className:"alert error",role:"alert",children:D}),_?t.jsx("div",{className:"empty-state",children:"Loading relationships..."}):Y?ht?t.jsx("div",{className:"entities-table-wrapper",children:t.jsxs("table",{className:"entities-table relationships-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"From Entity"}),t.jsx("th",{children:"Relationship Type"}),t.jsx("th",{children:"To Entity"}),t.jsx("th",{children:"Bidirectional"}),ae&&t.jsx("th",{className:"actions-column",children:"Actions"})]})}),t.jsx("tbody",{children:ut.map(ie=>{const J=Me(ie.fromEntityId,ie.fromEntityName,ie.fromEntityTypeName),le=Me(ie.toEntityId,ie.toEntityName,ie.toEntityTypeName);return t.jsxs("tr",{children:[t.jsx("td",{children:J}),t.jsx("td",{children:ie.typeName||""}),t.jsx("td",{children:le}),t.jsx("td",{children:t.jsx("span",{className:`visibility-badge ${ie.bidirectional?"badge-visible":"badge-hidden"}`,children:ie.bidirectional?"Yes":"No"})}),ae&&t.jsx("td",{className:"actions-column",children:t.jsxs("div",{className:"entity-actions",children:[t.jsx("button",{type:"button",className:"icon-btn",onClick:()=>tt(ie),title:"Edit relationship",disabled:_,children:t.jsx(Ga,{size:16})}),t.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>mt(ie),title:"Delete relationship",disabled:X===ie.id,children:t.jsx(zn,{size:16})})]})})]},ie.id)})})]})}):t.jsx("div",{className:"empty-state",children:$||H?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"empty-title",children:"No relationships match your filters."}),t.jsx("button",{type:"button",className:"btn secondary",onClick:()=>{F(""),I("")},children:"Clear filters"})]}):ae?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"empty-title",children:"No relationships yet."}),t.jsxs("button",{type:"button",className:"btn submit",onClick:ve,disabled:!Y,children:[t.jsx(sa,{size:16})," Add your first relationship"]})]}):t.jsx("p",{className:"empty-title",children:"No relationships to display."})}):t.jsx("div",{className:"empty-state",children:"Select a campaign or world you own to view its relationships."}),p&&t.jsx(Bs,{isOpen:h,onClose:()=>y(!1),title:"Add Relationship",description:"Link two entities in this world.",size:"lg",children:t.jsx(x1,{worldId:Y,existingRelationships:v||[],onCreated:()=>{y(!1),we(Y),ue("Relationship created","success")},onCancel:()=>y(!1)})}),t.jsx(Bs,{isOpen:g,onClose:st,title:_t,size:"lg",footerActions:t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:"btn cancel",onClick:st,disabled:L.cancelDisabled,children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn submit",form:re.current,disabled:L.submitDisabled,children:L.submitLabel})]}),children:t.jsx(u5,{worldId:Y,relationshipId:G,onCancel:st,onSaved:Ye,onStateChange:$e,formId:re.current,hideActions:!0})})]})}const m5=new Set(["system_admin"]),h5=e=>{if(!e)return"";const n=new Date(e);return Number.isNaN(n.getTime())?"":n.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},dw=(e=[])=>!Array.isArray(e)||e.length===0?"":e.map(n=>n?.name||n?.label||"Unknown").filter(Boolean).join(", "),p5=e=>{if(!e)return"";const n=e.from_name||e.fromName||e.name||"",s=e.to_name||e.toName||e.name||"";return`${n}  ${s}`};function y5(){const e=Mn(),n=Xa(),{user:s,token:i,sessionReady:l}=un(),{selectedCampaign:o}=jn(),[d,m]=u.useState([]),[p,h]=u.useState(!1),[y,g]=u.useState(""),[x,v]=u.useState(null),[S,N]=u.useState(""),E=u.useMemo(()=>{if(!o?.world)return"";const R=o.world;return R.created_by||R.creator?.id||R.owner_id||R.owner?.id||""},[o]),j=!!(s?.id&&E===s.id),A=u.useMemo(()=>s?s.role&&m5.has(s.role)?!0:j:!1,[s,j]),T=o?.world?.id??"",_=!!T,M=u.useRef(T),k=u.useMemo(()=>{if(!o)return"";const R=o.name||"Selected campaign",B=o.world?.name;return B?`${R}  ${B}`:R},[o]);u.useEffect(()=>{if(!x)return;const R=setTimeout(()=>v(null),3500);return()=>clearTimeout(R)},[x]);const C=u.useCallback((R,B="info")=>{v({message:R,tone:B})},[]),D=u.useCallback(()=>{e(n.pathname,{replace:!0,state:{}})},[n.pathname,e]);u.useEffect(()=>{if(n.state?.toast){const{message:R,tone:B}=n.state.toast;C(R,B),D()}},[n.state,C,D]),u.useEffect(()=>{M.current!==T&&(M.current=T,m([]),g(""),h(!1),v(null),N(""))},[T]);const z=u.useCallback(async()=>{if(!(!i||!A)){if(!T){m([]),g("");return}h(!0),g("");try{const R=await Of({worldId:T}),B=Array.isArray(R)?R:Array.isArray(R?.data)?R.data:[];m(B)}catch(R){console.error(" Failed to load relationship types",R),m([]),g(R.message||"Failed to load relationship types")}finally{h(!1)}}},[i,A,T]);u.useEffect(()=>{if(!(!l||!i||!A)){if(!T){m([]),h(!1),g("");return}z()}},[l,i,A,T,z]);const G=()=>{!i||p||!_||!A||z()},U=()=>{!A||!_||e("/relationship-types/new")},X=R=>{!A||!R?.id||e(`/relationship-types/${R.id}/edit`)},V=async R=>{if(!(!A||!_||!R?.id||!window.confirm(`Delete relationship type "${R.name}"? This cannot be undone.`)))try{N(R.id),await t4(R.id),C("Relationship type deleted","success"),await z()}catch(L){console.error(" Failed to delete relationship type",L),C(L.message||"Failed to delete relationship type","error")}finally{N("")}};return l?i?A?t.jsxs("section",{className:"entity-types-page relationship-types-page",children:[t.jsxs("div",{className:"entity-types-header",children:[t.jsxs("div",{children:[t.jsx("h1",{children:"Relationship Types"}),o?t.jsxs("p",{className:"entity-types-subtitle",children:[k,_?`  ${d.length} types defined`:""]}):t.jsx("p",{className:"entity-types-subtitle",children:"Select a campaign from the header to choose a world context."})]}),t.jsxs("div",{className:"entity-types-actions",children:[t.jsx("button",{type:"button",className:"icon-btn",title:"Refresh",onClick:G,disabled:p||!_,children:t.jsx(Ui,{size:16})}),t.jsxs("button",{type:"button",className:"btn submit",onClick:U,disabled:p||!_,children:[t.jsx(sa,{size:18})," Add Relationship Type"]})]})]}),x&&t.jsx("div",{className:`toast-banner ${x.tone}`,children:x.message}),y&&t.jsx("div",{className:"alert error",children:y}),t.jsx("div",{className:"entity-types-table-wrapper",children:_?p?t.jsx("div",{className:"empty-state",children:"Loading relationship types..."}):d.length===0?t.jsx("div",{className:"empty-state",children:"No relationship types defined yet."}):t.jsxs("table",{className:"entity-types-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Name"}),t.jsx("th",{children:"Directional Labels"}),t.jsx("th",{children:"World"}),t.jsx("th",{children:"Allowed Sources"}),t.jsx("th",{children:"Allowed Targets"}),t.jsx("th",{children:"Created"}),t.jsx("th",{className:"actions-column",children:"Actions"})]})}),t.jsx("tbody",{children:d.map(R=>{const B=R.createdAt||R.created_at;return t.jsxs("tr",{children:[t.jsx("td",{children:R.name}),t.jsx("td",{children:p5(R)}),t.jsx("td",{children:R.world?.name||""}),t.jsx("td",{children:dw(R.from_entity_types)}),t.jsx("td",{children:dw(R.to_entity_types)}),t.jsx("td",{children:h5(B)}),t.jsxs("td",{className:"actions-column",children:[t.jsx("button",{className:"icon-btn",title:"Edit",onClick:()=>X(R),disabled:p||S===R.id,children:t.jsx(Ga,{size:16})}),t.jsx("button",{className:"icon-btn danger",title:"Delete",onClick:()=>V(R),disabled:S===R.id,children:t.jsx(zn,{size:16})})]})]},R.id)})})]}):t.jsx("div",{className:"empty-state",children:"Select a campaign from the header to view relationship types."})})]}):t.jsxs("section",{className:"entity-types-page relationship-types-page",children:[t.jsx("div",{className:"entity-types-header",children:t.jsx("h1",{children:"Relationship Types"})}),t.jsx("div",{className:"alert info",children:"Only system administrators or the world owner can manage relationship types."})]}):t.jsx("p",{children:"Authenticating..."}):t.jsx("p",{children:"Restoring session..."})}const fw=e=>Array.isArray(e)?[...new Set(e.map(n=>n?String(n):"").filter(Boolean))]:[],mw=(e={})=>({name:e?.name||"",fromName:e?.from_name||e?.fromName||"",toName:e?.to_name||e?.toName||"",description:e?.description||"",worldId:e?.world?.id||e?.world_id||"",fromEntityTypeIds:fw((e?.from_entity_types||[]).map(n=>n?.id||n?.entity_type_id)),toEntityTypeIds:fw((e?.to_entity_types||[]).map(n=>n?.id||n?.entity_type_id))}),hw=(e=[],n=[])=>{if(e.length!==n.length)return!1;const s=[...e].sort(),i=[...n].sort();return s.every((l,o)=>l===i[o])};function $1({initialValues:e={},entityTypes:n=[],worlds:s=[],saving:i=!1,optionsLoading:l=!1,errorMessage:o="",onSubmit:d,onCancel:m}){const p=u.useMemo(()=>mw(e),[e]),[h,y]=u.useState(p),[g,x]=u.useState("");u.useEffect(()=>{y(mw(e)),x("")},[e]),u.useEffect(()=>{x(o||"")},[o]);const v=u.useMemo(()=>h.name!==p.name||h.fromName!==p.fromName||h.toName!==p.toName||h.description!==p.description||h.worldId!==p.worldId||!hw(h.fromEntityTypeIds,p.fromEntityTypeIds)||!hw(h.toEntityTypeIds,p.toEntityTypeIds),[p,h]),S=u.useMemo(()=>Array.isArray(n)?n.map(T=>{const _=T?.id||T?.entity_type_id||T?.entityTypeId||T?.value||"";if(!_)return null;const M=T?.world_id||T?.worldId||T?.world?.id||"";return{value:String(_),label:T?.name||T?.label||"Untitled type",worldId:M?String(M):""}}).filter(Boolean):[],[n]),N=u.useMemo(()=>{const T=h.worldId?String(h.worldId):"";return T?S.filter(_=>_.worldId===T):[]},[S,h.worldId]);u.useEffect(()=>{if(!(h.worldId?String(h.worldId):"")){y(M=>M.fromEntityTypeIds.length===0&&M.toEntityTypeIds.length===0?M:{...M,fromEntityTypeIds:[],toEntityTypeIds:[]});return}const _=new Set(N.map(M=>M.value));y(M=>{const k=M.fromEntityTypeIds.filter(D=>_.has(String(D))),C=M.toEntityTypeIds.filter(D=>_.has(String(D)));return k.length===M.fromEntityTypeIds.length&&C.length===M.toEntityTypeIds.length?M:{...M,fromEntityTypeIds:k,toEntityTypeIds:C}})},[N,h.worldId]);const E=T=>_=>{const{value:M}=_.target;y(k=>({...k,[T]:M}))},j=T=>(_=[])=>{const M=Array.isArray(_)?_:[];y(k=>({...k,[T]:M}))},A=async T=>{T.preventDefault();const _=h.name.trim(),M=h.fromName.trim(),k=h.toName.trim();if(!_)return x("Name is required.");if(!M)return x("Provide a label for the source direction.");if(!k)return x("Provide a label for the target direction.");if(!h.worldId)return x("Select a world for this relationship type.");if(!h.fromEntityTypeIds.length)return x("Select at least one allowed source entity type.");if(!h.toEntityTypeIds.length)return x("Select at least one allowed target entity type.");x("");const C={name:_,from_name:M,to_name:k,description:h.description?.trim()||"",world_id:h.worldId,from_entity_type_ids:h.fromEntityTypeIds,to_entity_type_ids:h.toEntityTypeIds};try{if(await d?.(C)===!1)return}catch(D){x(D.message||"Failed to save relationship type")}};return t.jsxs("form",{className:"relationship-type-form",onSubmit:A,children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"relationship-type-name",children:"Name *"}),t.jsx("input",{id:"relationship-type-name",type:"text",value:h.name,onChange:E("name"),placeholder:"e.g. Enemy",disabled:i||l,autoFocus:!0})]}),t.jsxs("div",{className:"form-two-column",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"relationship-type-from-name",children:"Source relationship label *"}),t.jsx("input",{id:"relationship-type-from-name",type:"text",value:h.fromName,onChange:E("fromName"),placeholder:"e.g. Parent of",disabled:i||l})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"relationship-type-to-name",children:"Target relationship label *"}),t.jsx("input",{id:"relationship-type-to-name",type:"text",value:h.toName,onChange:E("toName"),placeholder:"e.g. Child of",disabled:i||l})]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"relationship-type-description",children:"Description"}),t.jsx("textarea",{id:"relationship-type-description",value:h.description,onChange:E("description"),placeholder:"Optional description",rows:4,disabled:i||l,className:"textarea-field"})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"relationship-type-world",children:"World *"}),t.jsxs("select",{id:"relationship-type-world",value:h.worldId,onChange:E("worldId"),disabled:i||l,required:!0,children:[t.jsx("option",{value:"",children:"Select world..."}),s.map(T=>t.jsx("option",{value:T.id,children:T.name},T.id))]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"relationship-type-from-entities",children:"Allowed source entity types *"}),t.jsx($s,{selected:h.fromEntityTypeIds,options:N,onChange:j("fromEntityTypeIds"),placeholder:"Search entity types...",disabled:i||l,loading:l,noOptionsMessage:h.worldId?"No entity types available for this world.":"Select a world to choose entity types."})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"relationship-type-to-entities",children:"Allowed target entity types *"}),t.jsx($s,{selected:h.toEntityTypeIds,options:N,onChange:j("toEntityTypeIds"),placeholder:"Search entity types...",disabled:i||l,loading:l,noOptionsMessage:h.worldId?"No entity types available for this world.":"Select a world to choose entity types."})]}),g&&t.jsx("div",{className:"form-error",children:g}),t.jsxs("div",{className:"form-actions",children:[t.jsx("button",{type:"button",className:"btn cancel",onClick:m,disabled:i,children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn submit",disabled:i||l||!v,children:i?"Saving...":"Save"})]})]})}function g5(){const e=Mn(),{user:n,token:s,sessionReady:i}=un(),{selectedCampaign:l}=jn(),[o,d]=u.useState([]),[m,p]=u.useState(!1),[h,y]=u.useState(""),[g,x]=u.useState(""),[v,S]=u.useState(!1),N=u.useMemo(()=>{if(!l?.world)return"";const C=l.world;return C.created_by||C.creator?.id||C.owner_id||C.owner?.id||""},[l]),E=!!(n?.id&&N===n.id),j=u.useMemo(()=>n?n.role==="system_admin"?!0:E:!1,[n,E]),A=l?.world?.id??"",T=u.useMemo(()=>{if(!l?.world?.id)return[];const C=l.world;return[{id:C.id,name:C.name||"Untitled world"}]},[l]),_=u.useCallback(async()=>{if(!s||!A){d([]),y("Select a campaign to choose a world context before creating relationship types.");return}p(!0),y("");try{const C=await br({worldId:A}),D=Array.isArray(C?.data)?C.data:Array.isArray(C)?C:[];d(D)}catch(C){console.error(" Failed to load relationship type options",C),d([]),y(C.message||"Failed to load supporting data")}finally{p(!1)}},[s,A]);if(u.useEffect(()=>{!i||!s||_()},[i,s,_]),!i)return t.jsx("p",{children:"Restoring session..."});if(!s)return t.jsx("p",{children:"Authenticating..."});if(!j)return t.jsxs("section",{className:"page relationship-type-form-page limited-access",children:[t.jsx("h1",{children:"Create Relationship Type"}),t.jsx("p",{children:"Only system administrators or the world owner can create relationship types."}),t.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]});if(!A)return t.jsxs("section",{className:"page relationship-type-form-page",children:[t.jsx("h1",{children:"Create Relationship Type"}),t.jsx("p",{children:"Select a campaign from the header to choose a world context before creating relationship types."}),t.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]});const M=()=>e("/relationship-types"),k=async C=>{if(v)return!1;x(""),S(!0);try{const D={...C,world_id:C.world_id??C.worldId??C.world?.id??A};if(!D.world_id)throw new Error("A world must be selected before creating a relationship type");console.log(" Final payload being sent:",D);const z=await JL(D),G=z?.data??z;if(!G||!G.id)throw new Error("Failed to create relationship type");return e("/relationship-types",{state:{toast:{message:"Relationship type created",tone:"success"}}}),!0}catch(D){return console.error(" Failed to create relationship type",D),x(D.message||"Failed to create relationship type"),!1}finally{S(!1)}};return t.jsxs("section",{className:"page relationship-type-form-page",children:[t.jsx("h1",{children:"Create Relationship Type"}),t.jsx("p",{className:"page-subtitle",children:"Define the directional names and allowed entity types for this relationship."}),h&&t.jsx("div",{className:"alert error",children:h}),t.jsx($1,{initialValues:{world_id:A},entityTypes:o,worlds:T,saving:v,optionsLoading:m,errorMessage:g,onSubmit:k,onCancel:M})]})}function b5(){const e=Mn(),{id:n}=Wa(),{user:s,token:i,sessionReady:l}=un(),{selectedCampaign:o}=jn(),[d,m]=u.useState([]),[p,h]=u.useState(!1),[y,g]=u.useState(""),[x,v]=u.useState(""),[S,N]=u.useState(null),[E,j]=u.useState(!0),[A,T]=u.useState(""),[_,M]=u.useState(!1),k=s?.role==="system_admin",C=u.useMemo(()=>{if(!o||!s)return!1;const $=o.world?.created_by??o.world?.creator?.id??o.world?.owner_id??o.world?.owner?.id??"";return $?$===s.id:!1},[o,s]),D=u.useMemo(()=>!!(k||C),[k,C]),z=o?.world?.id??"",G=o?.world?.name??"",U=u.useMemo(()=>{if(!S)return null;const $=S?.world?.id||S?.world_id||S?.worldId||"";if(!$)return null;const F=S?.world?.name||S?.world_name||S?.worldName||"";return{id:$,name:F||"Untitled world"}},[S]),[X,V]=u.useState([]);u.useEffect(()=>{const $=[];z&&$.push({id:z,name:G||"Untitled world"}),U&&!$.some(F=>F.id===U.id)&&$.push(U),V($)},[z,G,U]);const R=u.useCallback(async()=>{if(i){h(!0),g("");try{const $=z||U?.id||S?.world?.id||S?.world_id||"";if(!$){m([]),g("Select a campaign to choose a world context before editing relationship types.");return}const F=await br({worldId:$}),H=Array.isArray(F?.data)?F.data:Array.isArray(F)?F:[];m(H)}catch($){console.error(" Failed to load relationship type options",$),m([]),g($.message||"Failed to load supporting data")}finally{h(!1)}}},[i,z,U,S]),B=u.useCallback(async()=>{if(!(!i||!n)){j(!0),T("");try{const $=await QL(n),F=$?.data??$;if(!F)throw new Error("Relationship type not found");N(F)}catch($){console.error(" Failed to load relationship type",$),T($.message||"Failed to load relationship type"),N(null)}finally{j(!1)}}},[n,i]);if(u.useEffect(()=>{!l||!i||B()},[l,i,B]),u.useEffect(()=>{!l||!i||E||R()},[l,i,E,R]),!l)return t.jsx("p",{children:"Restoring session..."});if(!i)return t.jsx("p",{children:"Authenticating..."});if(!D)return t.jsxs("section",{className:"page relationship-type-form-page limited-access",children:[t.jsx("h1",{children:"Edit Relationship Type"}),t.jsx("p",{children:"Only system administrators can edit relationship types."}),t.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]});const L=()=>e("/relationship-types"),O=async $=>{if(_||!n)return!1;v(""),M(!0);try{const F={...$,world_id:$.world_id||$.worldId||$.selectedWorldId||$.world?.id||z||S?.world_id};if(!F.world_id)throw new Error("A world must be selected before saving changes");const H=await e4(n,F),I=H?.data??H;if(!I||!I.id)throw new Error("Failed to update relationship type");return e("/relationship-types",{state:{toast:{message:"Relationship type updated",tone:"success"}}}),!0}catch(F){return console.error(" Failed to update relationship type",F),v(F.message||"Failed to update relationship type"),!1}finally{M(!1)}};return E?t.jsxs("section",{className:"page relationship-type-form-page",children:[t.jsx("h1",{children:"Edit Relationship Type"}),t.jsx("div",{className:"form-status",children:"Loading relationship type..."})]}):A||!S?t.jsxs("section",{className:"page relationship-type-form-page",children:[t.jsx("h1",{children:"Edit Relationship Type"}),t.jsx("div",{className:"alert error",children:A||"Relationship type not found."}),t.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]}):t.jsxs("section",{className:"page relationship-type-form-page",children:[t.jsx("h1",{children:"Edit Relationship Type"}),t.jsx("p",{className:"page-subtitle",children:"Update the directional labels or allowed entity types for this relationship."}),y&&t.jsx("div",{className:"alert error",children:y}),t.jsx($1,{initialValues:S,entityTypes:d,worlds:X,saving:_,optionsLoading:p,errorMessage:x,onSubmit:O,onCancel:L})]})}function x5(){return t.jsx("section",{className:"page-placeholder",children:t.jsx("h1",{children:"Entity Secrets Page  Coming Soon"})})}function v5({children:e}){const{token:n,sessionReady:s}=un();return s?n?e:t.jsx(fc,{to:"/login",replace:!0}):t.jsx("p",{children:"Restoring session..."})}function ma(e){if(typeof e=="string"||typeof e=="number")return""+e;let n="";if(Array.isArray(e))for(let s=0,i;s<e.length;s++)(i=ma(e[s]))!==""&&(n+=(n&&" ")+i);else for(let s in e)e[s]&&(n+=(n&&" ")+s);return n}var Lp={exports:{}},Op={},$p={exports:{}},Fp={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pw;function S5(){if(pw)return Fp;pw=1;var e=Fc();function n(g,x){return g===x&&(g!==0||1/g===1/x)||g!==g&&x!==x}var s=typeof Object.is=="function"?Object.is:n,i=e.useState,l=e.useEffect,o=e.useLayoutEffect,d=e.useDebugValue;function m(g,x){var v=x(),S=i({inst:{value:v,getSnapshot:x}}),N=S[0].inst,E=S[1];return o(function(){N.value=v,N.getSnapshot=x,p(N)&&E({inst:N})},[g,v,x]),l(function(){return p(N)&&E({inst:N}),g(function(){p(N)&&E({inst:N})})},[g]),d(v),v}function p(g){var x=g.getSnapshot;g=g.value;try{var v=x();return!s(g,v)}catch{return!0}}function h(g,x){return x()}var y=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?h:m;return Fp.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:y,Fp}var yw;function w5(){return yw||(yw=1,$p.exports=S5()),$p.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gw;function N5(){if(gw)return Op;gw=1;var e=Fc(),n=w5();function s(h,y){return h===y&&(h!==0||1/h===1/y)||h!==h&&y!==y}var i=typeof Object.is=="function"?Object.is:s,l=n.useSyncExternalStore,o=e.useRef,d=e.useEffect,m=e.useMemo,p=e.useDebugValue;return Op.useSyncExternalStoreWithSelector=function(h,y,g,x,v){var S=o(null);if(S.current===null){var N={hasValue:!1,value:null};S.current=N}else N=S.current;S=m(function(){function j(k){if(!A){if(A=!0,T=k,k=x(k),v!==void 0&&N.hasValue){var C=N.value;if(v(C,k))return _=C}return _=k}if(C=_,i(T,k))return C;var D=x(k);return v!==void 0&&v(C,D)?(T=k,C):(T=k,_=D)}var A=!1,T,_,M=g===void 0?null:g;return[function(){return j(y())},M===null?void 0:function(){return j(M())}]},[y,g,x,v]);var E=l(h,S[0],S[1]);return d(function(){N.hasValue=!0,N.value=E},[E]),p(E),E},Op}var bw;function j5(){return bw||(bw=1,Lp.exports=N5()),Lp.exports}var E5=j5();const _5=zi(E5),C5={},xw=e=>{let n;const s=new Set,i=(y,g)=>{const x=typeof y=="function"?y(n):y;if(!Object.is(x,n)){const v=n;n=g??(typeof x!="object"||x===null)?x:Object.assign({},n,x),s.forEach(S=>S(n,v))}},l=()=>n,p={setState:i,getState:l,getInitialState:()=>h,subscribe:y=>(s.add(y),()=>s.delete(y)),destroy:()=>{(C5?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},h=n=e(i,l,p);return p},A5=e=>e?xw(e):xw,{useDebugValue:T5}=Ve,{useSyncExternalStoreWithSelector:M5}=_5,k5=e=>e;function F1(e,n=k5,s){const i=M5(e.subscribe,e.getState,e.getServerState||e.getInitialState,n,s);return T5(i),i}const vw=(e,n)=>{const s=A5(e),i=(l,o=n)=>F1(s,l,o);return Object.assign(i,s),i},R5=(e,n)=>e?vw(e,n):vw;function la(e,n){if(Object.is(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;if(e instanceof Map&&n instanceof Map){if(e.size!==n.size)return!1;for(const[i,l]of e)if(!Object.is(l,n.get(i)))return!1;return!0}if(e instanceof Set&&n instanceof Set){if(e.size!==n.size)return!1;for(const i of e)if(!n.has(i))return!1;return!0}const s=Object.keys(e);if(s.length!==Object.keys(n).length)return!1;for(const i of s)if(!Object.prototype.hasOwnProperty.call(n,i)||!Object.is(e[i],n[i]))return!1;return!0}var I5={value:()=>{}};function Ff(){for(var e=0,n=arguments.length,s={},i;e<n;++e){if(!(i=arguments[e]+"")||i in s||/[\s.]/.test(i))throw new Error("illegal type: "+i);s[i]=[]}return new Bd(s)}function Bd(e){this._=e}function D5(e,n){return e.trim().split(/^|\s+/).map(function(s){var i="",l=s.indexOf(".");if(l>=0&&(i=s.slice(l+1),s=s.slice(0,l)),s&&!n.hasOwnProperty(s))throw new Error("unknown type: "+s);return{type:s,name:i}})}Bd.prototype=Ff.prototype={constructor:Bd,on:function(e,n){var s=this._,i=D5(e+"",s),l,o=-1,d=i.length;if(arguments.length<2){for(;++o<d;)if((l=(e=i[o]).type)&&(l=L5(s[l],e.name)))return l;return}if(n!=null&&typeof n!="function")throw new Error("invalid callback: "+n);for(;++o<d;)if(l=(e=i[o]).type)s[l]=Sw(s[l],e.name,n);else if(n==null)for(l in s)s[l]=Sw(s[l],e.name,null);return this},copy:function(){var e={},n=this._;for(var s in n)e[s]=n[s].slice();return new Bd(e)},call:function(e,n){if((l=arguments.length-2)>0)for(var s=new Array(l),i=0,l,o;i<l;++i)s[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=this._[e],i=0,l=o.length;i<l;++i)o[i].value.apply(n,s)},apply:function(e,n,s){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],l=0,o=i.length;l<o;++l)i[l].value.apply(n,s)}};function L5(e,n){for(var s=0,i=e.length,l;s<i;++s)if((l=e[s]).name===n)return l.value}function Sw(e,n,s){for(var i=0,l=e.length;i<l;++i)if(e[i].name===n){e[i]=I5,e=e.slice(0,i).concat(e.slice(i+1));break}return s!=null&&e.push({name:n,value:s}),e}var My="http://www.w3.org/1999/xhtml";const ww={svg:"http://www.w3.org/2000/svg",xhtml:My,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function zf(e){var n=e+="",s=n.indexOf(":");return s>=0&&(n=e.slice(0,s))!=="xmlns"&&(e=e.slice(s+1)),ww.hasOwnProperty(n)?{space:ww[n],local:e}:e}function O5(e){return function(){var n=this.ownerDocument,s=this.namespaceURI;return s===My&&n.documentElement.namespaceURI===My?n.createElement(e):n.createElementNS(s,e)}}function $5(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function z1(e){var n=zf(e);return(n.local?$5:O5)(n)}function F5(){}function Bg(e){return e==null?F5:function(){return this.querySelector(e)}}function z5(e){typeof e!="function"&&(e=Bg(e));for(var n=this._groups,s=n.length,i=new Array(s),l=0;l<s;++l)for(var o=n[l],d=o.length,m=i[l]=new Array(d),p,h,y=0;y<d;++y)(p=o[y])&&(h=e.call(p,p.__data__,y,o))&&("__data__"in p&&(h.__data__=p.__data__),m[y]=h);return new Ka(i,this._parents)}function B5(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function U5(){return[]}function B1(e){return e==null?U5:function(){return this.querySelectorAll(e)}}function q5(e){return function(){return B5(e.apply(this,arguments))}}function P5(e){typeof e=="function"?e=q5(e):e=B1(e);for(var n=this._groups,s=n.length,i=[],l=[],o=0;o<s;++o)for(var d=n[o],m=d.length,p,h=0;h<m;++h)(p=d[h])&&(i.push(e.call(p,p.__data__,h,d)),l.push(p));return new Ka(i,l)}function U1(e){return function(){return this.matches(e)}}function q1(e){return function(n){return n.matches(e)}}var H5=Array.prototype.find;function V5(e){return function(){return H5.call(this.children,e)}}function Y5(){return this.firstElementChild}function G5(e){return this.select(e==null?Y5:V5(typeof e=="function"?e:q1(e)))}var K5=Array.prototype.filter;function X5(){return Array.from(this.children)}function W5(e){return function(){return K5.call(this.children,e)}}function Z5(e){return this.selectAll(e==null?X5:W5(typeof e=="function"?e:q1(e)))}function Q5(e){typeof e!="function"&&(e=U1(e));for(var n=this._groups,s=n.length,i=new Array(s),l=0;l<s;++l)for(var o=n[l],d=o.length,m=i[l]=[],p,h=0;h<d;++h)(p=o[h])&&e.call(p,p.__data__,h,o)&&m.push(p);return new Ka(i,this._parents)}function P1(e){return new Array(e.length)}function J5(){return new Ka(this._enter||this._groups.map(P1),this._parents)}function nf(e,n){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=n}nf.prototype={constructor:nf,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,n){return this._parent.insertBefore(e,n)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function eO(e){return function(){return e}}function tO(e,n,s,i,l,o){for(var d=0,m,p=n.length,h=o.length;d<h;++d)(m=n[d])?(m.__data__=o[d],i[d]=m):s[d]=new nf(e,o[d]);for(;d<p;++d)(m=n[d])&&(l[d]=m)}function nO(e,n,s,i,l,o,d){var m,p,h=new Map,y=n.length,g=o.length,x=new Array(y),v;for(m=0;m<y;++m)(p=n[m])&&(x[m]=v=d.call(p,p.__data__,m,n)+"",h.has(v)?l[m]=p:h.set(v,p));for(m=0;m<g;++m)v=d.call(e,o[m],m,o)+"",(p=h.get(v))?(i[m]=p,p.__data__=o[m],h.delete(v)):s[m]=new nf(e,o[m]);for(m=0;m<y;++m)(p=n[m])&&h.get(x[m])===p&&(l[m]=p)}function aO(e){return e.__data__}function sO(e,n){if(!arguments.length)return Array.from(this,aO);var s=n?nO:tO,i=this._parents,l=this._groups;typeof e!="function"&&(e=eO(e));for(var o=l.length,d=new Array(o),m=new Array(o),p=new Array(o),h=0;h<o;++h){var y=i[h],g=l[h],x=g.length,v=rO(e.call(y,y&&y.__data__,h,i)),S=v.length,N=m[h]=new Array(S),E=d[h]=new Array(S),j=p[h]=new Array(x);s(y,g,N,E,j,v,n);for(var A=0,T=0,_,M;A<S;++A)if(_=N[A]){for(A>=T&&(T=A+1);!(M=E[T])&&++T<S;);_._next=M||null}}return d=new Ka(d,i),d._enter=m,d._exit=p,d}function rO(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function iO(){return new Ka(this._exit||this._groups.map(P1),this._parents)}function lO(e,n,s){var i=this.enter(),l=this,o=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),n!=null&&(l=n(l),l&&(l=l.selection())),s==null?o.remove():s(o),i&&l?i.merge(l).order():l}function oO(e){for(var n=e.selection?e.selection():e,s=this._groups,i=n._groups,l=s.length,o=i.length,d=Math.min(l,o),m=new Array(l),p=0;p<d;++p)for(var h=s[p],y=i[p],g=h.length,x=m[p]=new Array(g),v,S=0;S<g;++S)(v=h[S]||y[S])&&(x[S]=v);for(;p<l;++p)m[p]=s[p];return new Ka(m,this._parents)}function cO(){for(var e=this._groups,n=-1,s=e.length;++n<s;)for(var i=e[n],l=i.length-1,o=i[l],d;--l>=0;)(d=i[l])&&(o&&d.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(d,o),o=d);return this}function uO(e){e||(e=dO);function n(g,x){return g&&x?e(g.__data__,x.__data__):!g-!x}for(var s=this._groups,i=s.length,l=new Array(i),o=0;o<i;++o){for(var d=s[o],m=d.length,p=l[o]=new Array(m),h,y=0;y<m;++y)(h=d[y])&&(p[y]=h);p.sort(n)}return new Ka(l,this._parents).order()}function dO(e,n){return e<n?-1:e>n?1:e>=n?0:NaN}function fO(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function mO(){return Array.from(this)}function hO(){for(var e=this._groups,n=0,s=e.length;n<s;++n)for(var i=e[n],l=0,o=i.length;l<o;++l){var d=i[l];if(d)return d}return null}function pO(){let e=0;for(const n of this)++e;return e}function yO(){return!this.node()}function gO(e){for(var n=this._groups,s=0,i=n.length;s<i;++s)for(var l=n[s],o=0,d=l.length,m;o<d;++o)(m=l[o])&&e.call(m,m.__data__,o,l);return this}function bO(e){return function(){this.removeAttribute(e)}}function xO(e){return function(){this.removeAttributeNS(e.space,e.local)}}function vO(e,n){return function(){this.setAttribute(e,n)}}function SO(e,n){return function(){this.setAttributeNS(e.space,e.local,n)}}function wO(e,n){return function(){var s=n.apply(this,arguments);s==null?this.removeAttribute(e):this.setAttribute(e,s)}}function NO(e,n){return function(){var s=n.apply(this,arguments);s==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,s)}}function jO(e,n){var s=zf(e);if(arguments.length<2){var i=this.node();return s.local?i.getAttributeNS(s.space,s.local):i.getAttribute(s)}return this.each((n==null?s.local?xO:bO:typeof n=="function"?s.local?NO:wO:s.local?SO:vO)(s,n))}function H1(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function EO(e){return function(){this.style.removeProperty(e)}}function _O(e,n,s){return function(){this.style.setProperty(e,n,s)}}function CO(e,n,s){return function(){var i=n.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,s)}}function AO(e,n,s){return arguments.length>1?this.each((n==null?EO:typeof n=="function"?CO:_O)(e,n,s??"")):Hl(this.node(),e)}function Hl(e,n){return e.style.getPropertyValue(n)||H1(e).getComputedStyle(e,null).getPropertyValue(n)}function TO(e){return function(){delete this[e]}}function MO(e,n){return function(){this[e]=n}}function kO(e,n){return function(){var s=n.apply(this,arguments);s==null?delete this[e]:this[e]=s}}function RO(e,n){return arguments.length>1?this.each((n==null?TO:typeof n=="function"?kO:MO)(e,n)):this.node()[e]}function V1(e){return e.trim().split(/^|\s+/)}function Ug(e){return e.classList||new Y1(e)}function Y1(e){this._node=e,this._names=V1(e.getAttribute("class")||"")}Y1.prototype={add:function(e){var n=this._names.indexOf(e);n<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var n=this._names.indexOf(e);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function G1(e,n){for(var s=Ug(e),i=-1,l=n.length;++i<l;)s.add(n[i])}function K1(e,n){for(var s=Ug(e),i=-1,l=n.length;++i<l;)s.remove(n[i])}function IO(e){return function(){G1(this,e)}}function DO(e){return function(){K1(this,e)}}function LO(e,n){return function(){(n.apply(this,arguments)?G1:K1)(this,e)}}function OO(e,n){var s=V1(e+"");if(arguments.length<2){for(var i=Ug(this.node()),l=-1,o=s.length;++l<o;)if(!i.contains(s[l]))return!1;return!0}return this.each((typeof n=="function"?LO:n?IO:DO)(s,n))}function $O(){this.textContent=""}function FO(e){return function(){this.textContent=e}}function zO(e){return function(){var n=e.apply(this,arguments);this.textContent=n??""}}function BO(e){return arguments.length?this.each(e==null?$O:(typeof e=="function"?zO:FO)(e)):this.node().textContent}function UO(){this.innerHTML=""}function qO(e){return function(){this.innerHTML=e}}function PO(e){return function(){var n=e.apply(this,arguments);this.innerHTML=n??""}}function HO(e){return arguments.length?this.each(e==null?UO:(typeof e=="function"?PO:qO)(e)):this.node().innerHTML}function VO(){this.nextSibling&&this.parentNode.appendChild(this)}function YO(){return this.each(VO)}function GO(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function KO(){return this.each(GO)}function XO(e){var n=typeof e=="function"?e:z1(e);return this.select(function(){return this.appendChild(n.apply(this,arguments))})}function WO(){return null}function ZO(e,n){var s=typeof e=="function"?e:z1(e),i=n==null?WO:typeof n=="function"?n:Bg(n);return this.select(function(){return this.insertBefore(s.apply(this,arguments),i.apply(this,arguments)||null)})}function QO(){var e=this.parentNode;e&&e.removeChild(this)}function JO(){return this.each(QO)}function e6(){var e=this.cloneNode(!1),n=this.parentNode;return n?n.insertBefore(e,this.nextSibling):e}function t6(){var e=this.cloneNode(!0),n=this.parentNode;return n?n.insertBefore(e,this.nextSibling):e}function n6(e){return this.select(e?t6:e6)}function a6(e){return arguments.length?this.property("__data__",e):this.node().__data__}function s6(e){return function(n){e.call(this,n,this.__data__)}}function r6(e){return e.trim().split(/^|\s+/).map(function(n){var s="",i=n.indexOf(".");return i>=0&&(s=n.slice(i+1),n=n.slice(0,i)),{type:n,name:s}})}function i6(e){return function(){var n=this.__on;if(n){for(var s=0,i=-1,l=n.length,o;s<l;++s)o=n[s],(!e.type||o.type===e.type)&&o.name===e.name?this.removeEventListener(o.type,o.listener,o.options):n[++i]=o;++i?n.length=i:delete this.__on}}}function l6(e,n,s){return function(){var i=this.__on,l,o=s6(n);if(i){for(var d=0,m=i.length;d<m;++d)if((l=i[d]).type===e.type&&l.name===e.name){this.removeEventListener(l.type,l.listener,l.options),this.addEventListener(l.type,l.listener=o,l.options=s),l.value=n;return}}this.addEventListener(e.type,o,s),l={type:e.type,name:e.name,value:n,listener:o,options:s},i?i.push(l):this.__on=[l]}}function o6(e,n,s){var i=r6(e+""),l,o=i.length,d;if(arguments.length<2){var m=this.node().__on;if(m){for(var p=0,h=m.length,y;p<h;++p)for(l=0,y=m[p];l<o;++l)if((d=i[l]).type===y.type&&d.name===y.name)return y.value}return}for(m=n?l6:i6,l=0;l<o;++l)this.each(m(i[l],n,s));return this}function X1(e,n,s){var i=H1(e),l=i.CustomEvent;typeof l=="function"?l=new l(n,s):(l=i.document.createEvent("Event"),s?(l.initEvent(n,s.bubbles,s.cancelable),l.detail=s.detail):l.initEvent(n,!1,!1)),e.dispatchEvent(l)}function c6(e,n){return function(){return X1(this,e,n)}}function u6(e,n){return function(){return X1(this,e,n.apply(this,arguments))}}function d6(e,n){return this.each((typeof n=="function"?u6:c6)(e,n))}function*f6(){for(var e=this._groups,n=0,s=e.length;n<s;++n)for(var i=e[n],l=0,o=i.length,d;l<o;++l)(d=i[l])&&(yield d)}var W1=[null];function Ka(e,n){this._groups=e,this._parents=n}function Gc(){return new Ka([[document.documentElement]],W1)}function m6(){return this}Ka.prototype=Gc.prototype={constructor:Ka,select:z5,selectAll:P5,selectChild:G5,selectChildren:Z5,filter:Q5,data:sO,enter:J5,exit:iO,join:lO,merge:oO,selection:m6,order:cO,sort:uO,call:fO,nodes:mO,node:hO,size:pO,empty:yO,each:gO,attr:jO,style:AO,property:RO,classed:OO,text:BO,html:HO,raise:YO,lower:KO,append:XO,insert:ZO,remove:JO,clone:n6,datum:a6,on:o6,dispatch:d6,[Symbol.iterator]:f6};function ls(e){return typeof e=="string"?new Ka([[document.querySelector(e)]],[document.documentElement]):new Ka([[e]],W1)}function h6(e){let n;for(;n=e.sourceEvent;)e=n;return e}function Ss(e,n){if(e=h6(e),n===void 0&&(n=e.currentTarget),n){var s=n.ownerSVGElement||n;if(s.createSVGPoint){var i=s.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,i=i.matrixTransform(n.getScreenCTM().inverse()),[i.x,i.y]}if(n.getBoundingClientRect){var l=n.getBoundingClientRect();return[e.clientX-l.left-n.clientLeft,e.clientY-l.top-n.clientTop]}}return[e.pageX,e.pageY]}const p6={passive:!1},Mc={capture:!0,passive:!1};function zp(e){e.stopImmediatePropagation()}function $l(e){e.preventDefault(),e.stopImmediatePropagation()}function Z1(e){var n=e.document.documentElement,s=ls(e).on("dragstart.drag",$l,Mc);"onselectstart"in n?s.on("selectstart.drag",$l,Mc):(n.__noselect=n.style.MozUserSelect,n.style.MozUserSelect="none")}function Q1(e,n){var s=e.document.documentElement,i=ls(e).on("dragstart.drag",null);n&&(i.on("click.drag",$l,Mc),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in s?i.on("selectstart.drag",null):(s.style.MozUserSelect=s.__noselect,delete s.__noselect)}const gd=e=>()=>e;function ky(e,{sourceEvent:n,subject:s,target:i,identifier:l,active:o,x:d,y:m,dx:p,dy:h,dispatch:y}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},subject:{value:s,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:l,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:d,enumerable:!0,configurable:!0},y:{value:m,enumerable:!0,configurable:!0},dx:{value:p,enumerable:!0,configurable:!0},dy:{value:h,enumerable:!0,configurable:!0},_:{value:y}})}ky.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function y6(e){return!e.ctrlKey&&!e.button}function g6(){return this.parentNode}function b6(e,n){return n??{x:e.x,y:e.y}}function x6(){return navigator.maxTouchPoints||"ontouchstart"in this}function v6(){var e=y6,n=g6,s=b6,i=x6,l={},o=Ff("start","drag","end"),d=0,m,p,h,y,g=0;function x(_){_.on("mousedown.drag",v).filter(i).on("touchstart.drag",E).on("touchmove.drag",j,p6).on("touchend.drag touchcancel.drag",A).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function v(_,M){if(!(y||!e.call(this,_,M))){var k=T(this,n.call(this,_,M),_,M,"mouse");k&&(ls(_.view).on("mousemove.drag",S,Mc).on("mouseup.drag",N,Mc),Z1(_.view),zp(_),h=!1,m=_.clientX,p=_.clientY,k("start",_))}}function S(_){if($l(_),!h){var M=_.clientX-m,k=_.clientY-p;h=M*M+k*k>g}l.mouse("drag",_)}function N(_){ls(_.view).on("mousemove.drag mouseup.drag",null),Q1(_.view,h),$l(_),l.mouse("end",_)}function E(_,M){if(e.call(this,_,M)){var k=_.changedTouches,C=n.call(this,_,M),D=k.length,z,G;for(z=0;z<D;++z)(G=T(this,C,_,M,k[z].identifier,k[z]))&&(zp(_),G("start",_,k[z]))}}function j(_){var M=_.changedTouches,k=M.length,C,D;for(C=0;C<k;++C)(D=l[M[C].identifier])&&($l(_),D("drag",_,M[C]))}function A(_){var M=_.changedTouches,k=M.length,C,D;for(y&&clearTimeout(y),y=setTimeout(function(){y=null},500),C=0;C<k;++C)(D=l[M[C].identifier])&&(zp(_),D("end",_,M[C]))}function T(_,M,k,C,D,z){var G=o.copy(),U=Ss(z||k,M),X,V,R;if((R=s.call(_,new ky("beforestart",{sourceEvent:k,target:x,identifier:D,active:d,x:U[0],y:U[1],dx:0,dy:0,dispatch:G}),C))!=null)return X=R.x-U[0]||0,V=R.y-U[1]||0,function B(L,O,$){var F=U,H;switch(L){case"start":l[D]=B,H=d++;break;case"end":delete l[D],--d;case"drag":U=Ss($||O,M),H=d;break}G.call(L,_,new ky(L,{sourceEvent:O,subject:R,target:x,identifier:D,active:H,x:U[0]+X,y:U[1]+V,dx:U[0]-F[0],dy:U[1]-F[1],dispatch:G}),C)}}return x.filter=function(_){return arguments.length?(e=typeof _=="function"?_:gd(!!_),x):e},x.container=function(_){return arguments.length?(n=typeof _=="function"?_:gd(_),x):n},x.subject=function(_){return arguments.length?(s=typeof _=="function"?_:gd(_),x):s},x.touchable=function(_){return arguments.length?(i=typeof _=="function"?_:gd(!!_),x):i},x.on=function(){var _=o.on.apply(o,arguments);return _===o?x:_},x.clickDistance=function(_){return arguments.length?(g=(_=+_)*_,x):Math.sqrt(g)},x}function qg(e,n,s){e.prototype=n.prototype=s,s.constructor=e}function J1(e,n){var s=Object.create(e.prototype);for(var i in n)s[i]=n[i];return s}function Kc(){}var kc=.7,af=1/kc,Fl="\\s*([+-]?\\d+)\\s*",Rc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",zs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",S6=/^#([0-9a-f]{3,8})$/,w6=new RegExp(`^rgb\\(${Fl},${Fl},${Fl}\\)$`),N6=new RegExp(`^rgb\\(${zs},${zs},${zs}\\)$`),j6=new RegExp(`^rgba\\(${Fl},${Fl},${Fl},${Rc}\\)$`),E6=new RegExp(`^rgba\\(${zs},${zs},${zs},${Rc}\\)$`),_6=new RegExp(`^hsl\\(${Rc},${zs},${zs}\\)$`),C6=new RegExp(`^hsla\\(${Rc},${zs},${zs},${Rc}\\)$`),Nw={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};qg(Kc,Ic,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:jw,formatHex:jw,formatHex8:A6,formatHsl:T6,formatRgb:Ew,toString:Ew});function jw(){return this.rgb().formatHex()}function A6(){return this.rgb().formatHex8()}function T6(){return eE(this).formatHsl()}function Ew(){return this.rgb().formatRgb()}function Ic(e){var n,s;return e=(e+"").trim().toLowerCase(),(n=S6.exec(e))?(s=n[1].length,n=parseInt(n[1],16),s===6?_w(n):s===3?new La(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):s===8?bd(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):s===4?bd(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=w6.exec(e))?new La(n[1],n[2],n[3],1):(n=N6.exec(e))?new La(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=j6.exec(e))?bd(n[1],n[2],n[3],n[4]):(n=E6.exec(e))?bd(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=_6.exec(e))?Tw(n[1],n[2]/100,n[3]/100,1):(n=C6.exec(e))?Tw(n[1],n[2]/100,n[3]/100,n[4]):Nw.hasOwnProperty(e)?_w(Nw[e]):e==="transparent"?new La(NaN,NaN,NaN,0):null}function _w(e){return new La(e>>16&255,e>>8&255,e&255,1)}function bd(e,n,s,i){return i<=0&&(e=n=s=NaN),new La(e,n,s,i)}function M6(e){return e instanceof Kc||(e=Ic(e)),e?(e=e.rgb(),new La(e.r,e.g,e.b,e.opacity)):new La}function Ry(e,n,s,i){return arguments.length===1?M6(e):new La(e,n,s,i??1)}function La(e,n,s,i){this.r=+e,this.g=+n,this.b=+s,this.opacity=+i}qg(La,Ry,J1(Kc,{brighter(e){return e=e==null?af:Math.pow(af,e),new La(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?kc:Math.pow(kc,e),new La(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new La(Ii(this.r),Ii(this.g),Ii(this.b),sf(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Cw,formatHex:Cw,formatHex8:k6,formatRgb:Aw,toString:Aw}));function Cw(){return`#${Mi(this.r)}${Mi(this.g)}${Mi(this.b)}`}function k6(){return`#${Mi(this.r)}${Mi(this.g)}${Mi(this.b)}${Mi((isNaN(this.opacity)?1:this.opacity)*255)}`}function Aw(){const e=sf(this.opacity);return`${e===1?"rgb(":"rgba("}${Ii(this.r)}, ${Ii(this.g)}, ${Ii(this.b)}${e===1?")":`, ${e})`}`}function sf(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ii(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Mi(e){return e=Ii(e),(e<16?"0":"")+e.toString(16)}function Tw(e,n,s,i){return i<=0?e=n=s=NaN:s<=0||s>=1?e=n=NaN:n<=0&&(e=NaN),new ws(e,n,s,i)}function eE(e){if(e instanceof ws)return new ws(e.h,e.s,e.l,e.opacity);if(e instanceof Kc||(e=Ic(e)),!e)return new ws;if(e instanceof ws)return e;e=e.rgb();var n=e.r/255,s=e.g/255,i=e.b/255,l=Math.min(n,s,i),o=Math.max(n,s,i),d=NaN,m=o-l,p=(o+l)/2;return m?(n===o?d=(s-i)/m+(s<i)*6:s===o?d=(i-n)/m+2:d=(n-s)/m+4,m/=p<.5?o+l:2-o-l,d*=60):m=p>0&&p<1?0:d,new ws(d,m,p,e.opacity)}function R6(e,n,s,i){return arguments.length===1?eE(e):new ws(e,n,s,i??1)}function ws(e,n,s,i){this.h=+e,this.s=+n,this.l=+s,this.opacity=+i}qg(ws,R6,J1(Kc,{brighter(e){return e=e==null?af:Math.pow(af,e),new ws(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?kc:Math.pow(kc,e),new ws(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,n=isNaN(e)||isNaN(this.s)?0:this.s,s=this.l,i=s+(s<.5?s:1-s)*n,l=2*s-i;return new La(Bp(e>=240?e-240:e+120,l,i),Bp(e,l,i),Bp(e<120?e+240:e-120,l,i),this.opacity)},clamp(){return new ws(Mw(this.h),xd(this.s),xd(this.l),sf(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=sf(this.opacity);return`${e===1?"hsl(":"hsla("}${Mw(this.h)}, ${xd(this.s)*100}%, ${xd(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Mw(e){return e=(e||0)%360,e<0?e+360:e}function xd(e){return Math.max(0,Math.min(1,e||0))}function Bp(e,n,s){return(e<60?n+(s-n)*e/60:e<180?s:e<240?n+(s-n)*(240-e)/60:n)*255}const tE=e=>()=>e;function I6(e,n){return function(s){return e+s*n}}function D6(e,n,s){return e=Math.pow(e,s),n=Math.pow(n,s)-e,s=1/s,function(i){return Math.pow(e+i*n,s)}}function L6(e){return(e=+e)==1?nE:function(n,s){return s-n?D6(n,s,e):tE(isNaN(n)?s:n)}}function nE(e,n){var s=n-e;return s?I6(e,s):tE(isNaN(e)?n:e)}const kw=(function e(n){var s=L6(n);function i(l,o){var d=s((l=Ry(l)).r,(o=Ry(o)).r),m=s(l.g,o.g),p=s(l.b,o.b),h=nE(l.opacity,o.opacity);return function(y){return l.r=d(y),l.g=m(y),l.b=p(y),l.opacity=h(y),l+""}}return i.gamma=e,i})(1);function Yr(e,n){return e=+e,n=+n,function(s){return e*(1-s)+n*s}}var Iy=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Up=new RegExp(Iy.source,"g");function O6(e){return function(){return e}}function $6(e){return function(n){return e(n)+""}}function F6(e,n){var s=Iy.lastIndex=Up.lastIndex=0,i,l,o,d=-1,m=[],p=[];for(e=e+"",n=n+"";(i=Iy.exec(e))&&(l=Up.exec(n));)(o=l.index)>s&&(o=n.slice(s,o),m[d]?m[d]+=o:m[++d]=o),(i=i[0])===(l=l[0])?m[d]?m[d]+=l:m[++d]=l:(m[++d]=null,p.push({i:d,x:Yr(i,l)})),s=Up.lastIndex;return s<n.length&&(o=n.slice(s),m[d]?m[d]+=o:m[++d]=o),m.length<2?p[0]?$6(p[0].x):O6(n):(n=p.length,function(h){for(var y=0,g;y<n;++y)m[(g=p[y]).i]=g.x(h);return m.join("")})}var Rw=180/Math.PI,Dy={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function aE(e,n,s,i,l,o){var d,m,p;return(d=Math.sqrt(e*e+n*n))&&(e/=d,n/=d),(p=e*s+n*i)&&(s-=e*p,i-=n*p),(m=Math.sqrt(s*s+i*i))&&(s/=m,i/=m,p/=m),e*i<n*s&&(e=-e,n=-n,p=-p,d=-d),{translateX:l,translateY:o,rotate:Math.atan2(n,e)*Rw,skewX:Math.atan(p)*Rw,scaleX:d,scaleY:m}}var vd;function z6(e){const n=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return n.isIdentity?Dy:aE(n.a,n.b,n.c,n.d,n.e,n.f)}function B6(e){return e==null||(vd||(vd=document.createElementNS("http://www.w3.org/2000/svg","g")),vd.setAttribute("transform",e),!(e=vd.transform.baseVal.consolidate()))?Dy:(e=e.matrix,aE(e.a,e.b,e.c,e.d,e.e,e.f))}function sE(e,n,s,i){function l(h){return h.length?h.pop()+" ":""}function o(h,y,g,x,v,S){if(h!==g||y!==x){var N=v.push("translate(",null,n,null,s);S.push({i:N-4,x:Yr(h,g)},{i:N-2,x:Yr(y,x)})}else(g||x)&&v.push("translate("+g+n+x+s)}function d(h,y,g,x){h!==y?(h-y>180?y+=360:y-h>180&&(h+=360),x.push({i:g.push(l(g)+"rotate(",null,i)-2,x:Yr(h,y)})):y&&g.push(l(g)+"rotate("+y+i)}function m(h,y,g,x){h!==y?x.push({i:g.push(l(g)+"skewX(",null,i)-2,x:Yr(h,y)}):y&&g.push(l(g)+"skewX("+y+i)}function p(h,y,g,x,v,S){if(h!==g||y!==x){var N=v.push(l(v)+"scale(",null,",",null,")");S.push({i:N-4,x:Yr(h,g)},{i:N-2,x:Yr(y,x)})}else(g!==1||x!==1)&&v.push(l(v)+"scale("+g+","+x+")")}return function(h,y){var g=[],x=[];return h=e(h),y=e(y),o(h.translateX,h.translateY,y.translateX,y.translateY,g,x),d(h.rotate,y.rotate,g,x),m(h.skewX,y.skewX,g,x),p(h.scaleX,h.scaleY,y.scaleX,y.scaleY,g,x),h=y=null,function(v){for(var S=-1,N=x.length,E;++S<N;)g[(E=x[S]).i]=E.x(v);return g.join("")}}}var U6=sE(z6,"px, ","px)","deg)"),q6=sE(B6,", ",")",")"),P6=1e-12;function Iw(e){return((e=Math.exp(e))+1/e)/2}function H6(e){return((e=Math.exp(e))-1/e)/2}function V6(e){return((e=Math.exp(2*e))-1)/(e+1)}const Y6=(function e(n,s,i){function l(o,d){var m=o[0],p=o[1],h=o[2],y=d[0],g=d[1],x=d[2],v=y-m,S=g-p,N=v*v+S*S,E,j;if(N<P6)j=Math.log(x/h)/n,E=function(C){return[m+C*v,p+C*S,h*Math.exp(n*C*j)]};else{var A=Math.sqrt(N),T=(x*x-h*h+i*N)/(2*h*s*A),_=(x*x-h*h-i*N)/(2*x*s*A),M=Math.log(Math.sqrt(T*T+1)-T),k=Math.log(Math.sqrt(_*_+1)-_);j=(k-M)/n,E=function(C){var D=C*j,z=Iw(M),G=h/(s*A)*(z*V6(n*D+M)-H6(M));return[m+G*v,p+G*S,h*z/Iw(n*D+M)]}}return E.duration=j*1e3*n/Math.SQRT2,E}return l.rho=function(o){var d=Math.max(.001,+o),m=d*d,p=m*m;return e(d,m,p)},l})(Math.SQRT2,2,4);var Vl=0,pc=0,tc=0,rE=1e3,rf,yc,lf=0,$i=0,Bf=0,Dc=typeof performance=="object"&&performance.now?performance:Date,iE=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Pg(){return $i||(iE(G6),$i=Dc.now()+Bf)}function G6(){$i=0}function of(){this._call=this._time=this._next=null}of.prototype=lE.prototype={constructor:of,restart:function(e,n,s){if(typeof e!="function")throw new TypeError("callback is not a function");s=(s==null?Pg():+s)+(n==null?0:+n),!this._next&&yc!==this&&(yc?yc._next=this:rf=this,yc=this),this._call=e,this._time=s,Ly()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ly())}};function lE(e,n,s){var i=new of;return i.restart(e,n,s),i}function K6(){Pg(),++Vl;for(var e=rf,n;e;)(n=$i-e._time)>=0&&e._call.call(void 0,n),e=e._next;--Vl}function Dw(){$i=(lf=Dc.now())+Bf,Vl=pc=0;try{K6()}finally{Vl=0,W6(),$i=0}}function X6(){var e=Dc.now(),n=e-lf;n>rE&&(Bf-=n,lf=e)}function W6(){for(var e,n=rf,s,i=1/0;n;)n._call?(i>n._time&&(i=n._time),e=n,n=n._next):(s=n._next,n._next=null,n=e?e._next=s:rf=s);yc=e,Ly(i)}function Ly(e){if(!Vl){pc&&(pc=clearTimeout(pc));var n=e-$i;n>24?(e<1/0&&(pc=setTimeout(Dw,e-Dc.now()-Bf)),tc&&(tc=clearInterval(tc))):(tc||(lf=Dc.now(),tc=setInterval(X6,rE)),Vl=1,iE(Dw))}}function Lw(e,n,s){var i=new of;return n=n==null?0:+n,i.restart(l=>{i.stop(),e(l+n)},n,s),i}var Z6=Ff("start","end","cancel","interrupt"),Q6=[],oE=0,Ow=1,Oy=2,Ud=3,$w=4,$y=5,qd=6;function Uf(e,n,s,i,l,o){var d=e.__transition;if(!d)e.__transition={};else if(s in d)return;J6(e,s,{name:n,index:i,group:l,on:Z6,tween:Q6,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:oE})}function Hg(e,n){var s=Cs(e,n);if(s.state>oE)throw new Error("too late; already scheduled");return s}function Vs(e,n){var s=Cs(e,n);if(s.state>Ud)throw new Error("too late; already running");return s}function Cs(e,n){var s=e.__transition;if(!s||!(s=s[n]))throw new Error("transition not found");return s}function J6(e,n,s){var i=e.__transition,l;i[n]=s,s.timer=lE(o,0,s.time);function o(h){s.state=Ow,s.timer.restart(d,s.delay,s.time),s.delay<=h&&d(h-s.delay)}function d(h){var y,g,x,v;if(s.state!==Ow)return p();for(y in i)if(v=i[y],v.name===s.name){if(v.state===Ud)return Lw(d);v.state===$w?(v.state=qd,v.timer.stop(),v.on.call("interrupt",e,e.__data__,v.index,v.group),delete i[y]):+y<n&&(v.state=qd,v.timer.stop(),v.on.call("cancel",e,e.__data__,v.index,v.group),delete i[y])}if(Lw(function(){s.state===Ud&&(s.state=$w,s.timer.restart(m,s.delay,s.time),m(h))}),s.state=Oy,s.on.call("start",e,e.__data__,s.index,s.group),s.state===Oy){for(s.state=Ud,l=new Array(x=s.tween.length),y=0,g=-1;y<x;++y)(v=s.tween[y].value.call(e,e.__data__,s.index,s.group))&&(l[++g]=v);l.length=g+1}}function m(h){for(var y=h<s.duration?s.ease.call(null,h/s.duration):(s.timer.restart(p),s.state=$y,1),g=-1,x=l.length;++g<x;)l[g].call(e,y);s.state===$y&&(s.on.call("end",e,e.__data__,s.index,s.group),p())}function p(){s.state=qd,s.timer.stop(),delete i[n];for(var h in i)return;delete e.__transition}}function Pd(e,n){var s=e.__transition,i,l,o=!0,d;if(s){n=n==null?null:n+"";for(d in s){if((i=s[d]).name!==n){o=!1;continue}l=i.state>Oy&&i.state<$y,i.state=qd,i.timer.stop(),i.on.call(l?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete s[d]}o&&delete e.__transition}}function e7(e){return this.each(function(){Pd(this,e)})}function t7(e,n){var s,i;return function(){var l=Vs(this,e),o=l.tween;if(o!==s){i=s=o;for(var d=0,m=i.length;d<m;++d)if(i[d].name===n){i=i.slice(),i.splice(d,1);break}}l.tween=i}}function n7(e,n,s){var i,l;if(typeof s!="function")throw new Error;return function(){var o=Vs(this,e),d=o.tween;if(d!==i){l=(i=d).slice();for(var m={name:n,value:s},p=0,h=l.length;p<h;++p)if(l[p].name===n){l[p]=m;break}p===h&&l.push(m)}o.tween=l}}function a7(e,n){var s=this._id;if(e+="",arguments.length<2){for(var i=Cs(this.node(),s).tween,l=0,o=i.length,d;l<o;++l)if((d=i[l]).name===e)return d.value;return null}return this.each((n==null?t7:n7)(s,e,n))}function Vg(e,n,s){var i=e._id;return e.each(function(){var l=Vs(this,i);(l.value||(l.value={}))[n]=s.apply(this,arguments)}),function(l){return Cs(l,i).value[n]}}function cE(e,n){var s;return(typeof n=="number"?Yr:n instanceof Ic?kw:(s=Ic(n))?(n=s,kw):F6)(e,n)}function s7(e){return function(){this.removeAttribute(e)}}function r7(e){return function(){this.removeAttributeNS(e.space,e.local)}}function i7(e,n,s){var i,l=s+"",o;return function(){var d=this.getAttribute(e);return d===l?null:d===i?o:o=n(i=d,s)}}function l7(e,n,s){var i,l=s+"",o;return function(){var d=this.getAttributeNS(e.space,e.local);return d===l?null:d===i?o:o=n(i=d,s)}}function o7(e,n,s){var i,l,o;return function(){var d,m=s(this),p;return m==null?void this.removeAttribute(e):(d=this.getAttribute(e),p=m+"",d===p?null:d===i&&p===l?o:(l=p,o=n(i=d,m)))}}function c7(e,n,s){var i,l,o;return function(){var d,m=s(this),p;return m==null?void this.removeAttributeNS(e.space,e.local):(d=this.getAttributeNS(e.space,e.local),p=m+"",d===p?null:d===i&&p===l?o:(l=p,o=n(i=d,m)))}}function u7(e,n){var s=zf(e),i=s==="transform"?q6:cE;return this.attrTween(e,typeof n=="function"?(s.local?c7:o7)(s,i,Vg(this,"attr."+e,n)):n==null?(s.local?r7:s7)(s):(s.local?l7:i7)(s,i,n))}function d7(e,n){return function(s){this.setAttribute(e,n.call(this,s))}}function f7(e,n){return function(s){this.setAttributeNS(e.space,e.local,n.call(this,s))}}function m7(e,n){var s,i;function l(){var o=n.apply(this,arguments);return o!==i&&(s=(i=o)&&f7(e,o)),s}return l._value=n,l}function h7(e,n){var s,i;function l(){var o=n.apply(this,arguments);return o!==i&&(s=(i=o)&&d7(e,o)),s}return l._value=n,l}function p7(e,n){var s="attr."+e;if(arguments.length<2)return(s=this.tween(s))&&s._value;if(n==null)return this.tween(s,null);if(typeof n!="function")throw new Error;var i=zf(e);return this.tween(s,(i.local?m7:h7)(i,n))}function y7(e,n){return function(){Hg(this,e).delay=+n.apply(this,arguments)}}function g7(e,n){return n=+n,function(){Hg(this,e).delay=n}}function b7(e){var n=this._id;return arguments.length?this.each((typeof e=="function"?y7:g7)(n,e)):Cs(this.node(),n).delay}function x7(e,n){return function(){Vs(this,e).duration=+n.apply(this,arguments)}}function v7(e,n){return n=+n,function(){Vs(this,e).duration=n}}function S7(e){var n=this._id;return arguments.length?this.each((typeof e=="function"?x7:v7)(n,e)):Cs(this.node(),n).duration}function w7(e,n){if(typeof n!="function")throw new Error;return function(){Vs(this,e).ease=n}}function N7(e){var n=this._id;return arguments.length?this.each(w7(n,e)):Cs(this.node(),n).ease}function j7(e,n){return function(){var s=n.apply(this,arguments);if(typeof s!="function")throw new Error;Vs(this,e).ease=s}}function E7(e){if(typeof e!="function")throw new Error;return this.each(j7(this._id,e))}function _7(e){typeof e!="function"&&(e=U1(e));for(var n=this._groups,s=n.length,i=new Array(s),l=0;l<s;++l)for(var o=n[l],d=o.length,m=i[l]=[],p,h=0;h<d;++h)(p=o[h])&&e.call(p,p.__data__,h,o)&&m.push(p);return new yr(i,this._parents,this._name,this._id)}function C7(e){if(e._id!==this._id)throw new Error;for(var n=this._groups,s=e._groups,i=n.length,l=s.length,o=Math.min(i,l),d=new Array(i),m=0;m<o;++m)for(var p=n[m],h=s[m],y=p.length,g=d[m]=new Array(y),x,v=0;v<y;++v)(x=p[v]||h[v])&&(g[v]=x);for(;m<i;++m)d[m]=n[m];return new yr(d,this._parents,this._name,this._id)}function A7(e){return(e+"").trim().split(/^|\s+/).every(function(n){var s=n.indexOf(".");return s>=0&&(n=n.slice(0,s)),!n||n==="start"})}function T7(e,n,s){var i,l,o=A7(n)?Hg:Vs;return function(){var d=o(this,e),m=d.on;m!==i&&(l=(i=m).copy()).on(n,s),d.on=l}}function M7(e,n){var s=this._id;return arguments.length<2?Cs(this.node(),s).on.on(e):this.each(T7(s,e,n))}function k7(e){return function(){var n=this.parentNode;for(var s in this.__transition)if(+s!==e)return;n&&n.removeChild(this)}}function R7(){return this.on("end.remove",k7(this._id))}function I7(e){var n=this._name,s=this._id;typeof e!="function"&&(e=Bg(e));for(var i=this._groups,l=i.length,o=new Array(l),d=0;d<l;++d)for(var m=i[d],p=m.length,h=o[d]=new Array(p),y,g,x=0;x<p;++x)(y=m[x])&&(g=e.call(y,y.__data__,x,m))&&("__data__"in y&&(g.__data__=y.__data__),h[x]=g,Uf(h[x],n,s,x,h,Cs(y,s)));return new yr(o,this._parents,n,s)}function D7(e){var n=this._name,s=this._id;typeof e!="function"&&(e=B1(e));for(var i=this._groups,l=i.length,o=[],d=[],m=0;m<l;++m)for(var p=i[m],h=p.length,y,g=0;g<h;++g)if(y=p[g]){for(var x=e.call(y,y.__data__,g,p),v,S=Cs(y,s),N=0,E=x.length;N<E;++N)(v=x[N])&&Uf(v,n,s,N,x,S);o.push(x),d.push(y)}return new yr(o,d,n,s)}var L7=Gc.prototype.constructor;function O7(){return new L7(this._groups,this._parents)}function $7(e,n){var s,i,l;return function(){var o=Hl(this,e),d=(this.style.removeProperty(e),Hl(this,e));return o===d?null:o===s&&d===i?l:l=n(s=o,i=d)}}function uE(e){return function(){this.style.removeProperty(e)}}function F7(e,n,s){var i,l=s+"",o;return function(){var d=Hl(this,e);return d===l?null:d===i?o:o=n(i=d,s)}}function z7(e,n,s){var i,l,o;return function(){var d=Hl(this,e),m=s(this),p=m+"";return m==null&&(p=m=(this.style.removeProperty(e),Hl(this,e))),d===p?null:d===i&&p===l?o:(l=p,o=n(i=d,m))}}function B7(e,n){var s,i,l,o="style."+n,d="end."+o,m;return function(){var p=Vs(this,e),h=p.on,y=p.value[o]==null?m||(m=uE(n)):void 0;(h!==s||l!==y)&&(i=(s=h).copy()).on(d,l=y),p.on=i}}function U7(e,n,s){var i=(e+="")=="transform"?U6:cE;return n==null?this.styleTween(e,$7(e,i)).on("end.style."+e,uE(e)):typeof n=="function"?this.styleTween(e,z7(e,i,Vg(this,"style."+e,n))).each(B7(this._id,e)):this.styleTween(e,F7(e,i,n),s).on("end.style."+e,null)}function q7(e,n,s){return function(i){this.style.setProperty(e,n.call(this,i),s)}}function P7(e,n,s){var i,l;function o(){var d=n.apply(this,arguments);return d!==l&&(i=(l=d)&&q7(e,d,s)),i}return o._value=n,o}function H7(e,n,s){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(n==null)return this.tween(i,null);if(typeof n!="function")throw new Error;return this.tween(i,P7(e,n,s??""))}function V7(e){return function(){this.textContent=e}}function Y7(e){return function(){var n=e(this);this.textContent=n??""}}function G7(e){return this.tween("text",typeof e=="function"?Y7(Vg(this,"text",e)):V7(e==null?"":e+""))}function K7(e){return function(n){this.textContent=e.call(this,n)}}function X7(e){var n,s;function i(){var l=e.apply(this,arguments);return l!==s&&(n=(s=l)&&K7(l)),n}return i._value=e,i}function W7(e){var n="text";if(arguments.length<1)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,X7(e))}function Z7(){for(var e=this._name,n=this._id,s=dE(),i=this._groups,l=i.length,o=0;o<l;++o)for(var d=i[o],m=d.length,p,h=0;h<m;++h)if(p=d[h]){var y=Cs(p,n);Uf(p,e,s,h,d,{time:y.time+y.delay+y.duration,delay:0,duration:y.duration,ease:y.ease})}return new yr(i,this._parents,e,s)}function Q7(){var e,n,s=this,i=s._id,l=s.size();return new Promise(function(o,d){var m={value:d},p={value:function(){--l===0&&o()}};s.each(function(){var h=Vs(this,i),y=h.on;y!==e&&(n=(e=y).copy(),n._.cancel.push(m),n._.interrupt.push(m),n._.end.push(p)),h.on=n}),l===0&&o()})}var J7=0;function yr(e,n,s,i){this._groups=e,this._parents=n,this._name=s,this._id=i}function dE(){return++J7}var cr=Gc.prototype;yr.prototype={constructor:yr,select:I7,selectAll:D7,selectChild:cr.selectChild,selectChildren:cr.selectChildren,filter:_7,merge:C7,selection:O7,transition:Z7,call:cr.call,nodes:cr.nodes,node:cr.node,size:cr.size,empty:cr.empty,each:cr.each,on:M7,attr:u7,attrTween:p7,style:U7,styleTween:H7,text:G7,textTween:W7,remove:R7,tween:a7,delay:b7,duration:S7,ease:N7,easeVarying:E7,end:Q7,[Symbol.iterator]:cr[Symbol.iterator]};function e$(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var t$={time:null,delay:0,duration:250,ease:e$};function n$(e,n){for(var s;!(s=e.__transition)||!(s=s[n]);)if(!(e=e.parentNode))throw new Error(`transition ${n} not found`);return s}function a$(e){var n,s;e instanceof yr?(n=e._id,e=e._name):(n=dE(),(s=t$).time=Pg(),e=e==null?null:e+"");for(var i=this._groups,l=i.length,o=0;o<l;++o)for(var d=i[o],m=d.length,p,h=0;h<m;++h)(p=d[h])&&Uf(p,e,n,h,d,s||n$(p,n));return new yr(i,this._parents,e,n)}Gc.prototype.interrupt=e7;Gc.prototype.transition=a$;const Sd=e=>()=>e;function s$(e,{sourceEvent:n,target:s,transform:i,dispatch:l}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:l}})}function hr(e,n,s){this.k=e,this.x=n,this.y=s}hr.prototype={constructor:hr,scale:function(e){return e===1?this:new hr(this.k*e,this.x,this.y)},translate:function(e,n){return e===0&n===0?this:new hr(this.k,this.x+this.k*e,this.y+this.k*n)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var pr=new hr(1,0,0);hr.prototype;function qp(e){e.stopImmediatePropagation()}function nc(e){e.preventDefault(),e.stopImmediatePropagation()}function r$(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function i$(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Fw(){return this.__zoom||pr}function l$(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function o$(){return navigator.maxTouchPoints||"ontouchstart"in this}function c$(e,n,s){var i=e.invertX(n[0][0])-s[0][0],l=e.invertX(n[1][0])-s[1][0],o=e.invertY(n[0][1])-s[0][1],d=e.invertY(n[1][1])-s[1][1];return e.translate(l>i?(i+l)/2:Math.min(0,i)||Math.max(0,l),d>o?(o+d)/2:Math.min(0,o)||Math.max(0,d))}function fE(){var e=r$,n=i$,s=c$,i=l$,l=o$,o=[0,1/0],d=[[-1/0,-1/0],[1/0,1/0]],m=250,p=Y6,h=Ff("start","zoom","end"),y,g,x,v=500,S=150,N=0,E=10;function j(R){R.property("__zoom",Fw).on("wheel.zoom",D,{passive:!1}).on("mousedown.zoom",z).on("dblclick.zoom",G).filter(l).on("touchstart.zoom",U).on("touchmove.zoom",X).on("touchend.zoom touchcancel.zoom",V).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}j.transform=function(R,B,L,O){var $=R.selection?R.selection():R;$.property("__zoom",Fw),R!==$?M(R,B,L,O):$.interrupt().each(function(){k(this,arguments).event(O).start().zoom(null,typeof B=="function"?B.apply(this,arguments):B).end()})},j.scaleBy=function(R,B,L,O){j.scaleTo(R,function(){var $=this.__zoom.k,F=typeof B=="function"?B.apply(this,arguments):B;return $*F},L,O)},j.scaleTo=function(R,B,L,O){j.transform(R,function(){var $=n.apply(this,arguments),F=this.__zoom,H=L==null?_($):typeof L=="function"?L.apply(this,arguments):L,I=F.invert(H),Y=typeof B=="function"?B.apply(this,arguments):B;return s(T(A(F,Y),H,I),$,d)},L,O)},j.translateBy=function(R,B,L,O){j.transform(R,function(){return s(this.__zoom.translate(typeof B=="function"?B.apply(this,arguments):B,typeof L=="function"?L.apply(this,arguments):L),n.apply(this,arguments),d)},null,O)},j.translateTo=function(R,B,L,O,$){j.transform(R,function(){var F=n.apply(this,arguments),H=this.__zoom,I=O==null?_(F):typeof O=="function"?O.apply(this,arguments):O;return s(pr.translate(I[0],I[1]).scale(H.k).translate(typeof B=="function"?-B.apply(this,arguments):-B,typeof L=="function"?-L.apply(this,arguments):-L),F,d)},O,$)};function A(R,B){return B=Math.max(o[0],Math.min(o[1],B)),B===R.k?R:new hr(B,R.x,R.y)}function T(R,B,L){var O=B[0]-L[0]*R.k,$=B[1]-L[1]*R.k;return O===R.x&&$===R.y?R:new hr(R.k,O,$)}function _(R){return[(+R[0][0]+ +R[1][0])/2,(+R[0][1]+ +R[1][1])/2]}function M(R,B,L,O){R.on("start.zoom",function(){k(this,arguments).event(O).start()}).on("interrupt.zoom end.zoom",function(){k(this,arguments).event(O).end()}).tween("zoom",function(){var $=this,F=arguments,H=k($,F).event(O),I=n.apply($,F),Y=L==null?_(I):typeof L=="function"?L.apply($,F):L,P=Math.max(I[1][0]-I[0][0],I[1][1]-I[0][1]),K=$.__zoom,re=typeof B=="function"?B.apply($,F):B,W=p(K.invert(Y).concat(P/K.k),re.invert(Y).concat(P/re.k));return function(ue){if(ue===1)ue=re;else{var Q=W(ue),ye=P/Q[2];ue=new hr(ye,Y[0]-Q[0]*ye,Y[1]-Q[1]*ye)}H.zoom(null,ue)}})}function k(R,B,L){return!L&&R.__zooming||new C(R,B)}function C(R,B){this.that=R,this.args=B,this.active=0,this.sourceEvent=null,this.extent=n.apply(R,B),this.taps=0}C.prototype={event:function(R){return R&&(this.sourceEvent=R),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(R,B){return this.mouse&&R!=="mouse"&&(this.mouse[1]=B.invert(this.mouse[0])),this.touch0&&R!=="touch"&&(this.touch0[1]=B.invert(this.touch0[0])),this.touch1&&R!=="touch"&&(this.touch1[1]=B.invert(this.touch1[0])),this.that.__zoom=B,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(R){var B=ls(this.that).datum();h.call(R,this.that,new s$(R,{sourceEvent:this.sourceEvent,target:j,transform:this.that.__zoom,dispatch:h}),B)}};function D(R,...B){if(!e.apply(this,arguments))return;var L=k(this,B).event(R),O=this.__zoom,$=Math.max(o[0],Math.min(o[1],O.k*Math.pow(2,i.apply(this,arguments)))),F=Ss(R);if(L.wheel)(L.mouse[0][0]!==F[0]||L.mouse[0][1]!==F[1])&&(L.mouse[1]=O.invert(L.mouse[0]=F)),clearTimeout(L.wheel);else{if(O.k===$)return;L.mouse=[F,O.invert(F)],Pd(this),L.start()}nc(R),L.wheel=setTimeout(H,S),L.zoom("mouse",s(T(A(O,$),L.mouse[0],L.mouse[1]),L.extent,d));function H(){L.wheel=null,L.end()}}function z(R,...B){if(x||!e.apply(this,arguments))return;var L=R.currentTarget,O=k(this,B,!0).event(R),$=ls(R.view).on("mousemove.zoom",Y,!0).on("mouseup.zoom",P,!0),F=Ss(R,L),H=R.clientX,I=R.clientY;Z1(R.view),qp(R),O.mouse=[F,this.__zoom.invert(F)],Pd(this),O.start();function Y(K){if(nc(K),!O.moved){var re=K.clientX-H,W=K.clientY-I;O.moved=re*re+W*W>N}O.event(K).zoom("mouse",s(T(O.that.__zoom,O.mouse[0]=Ss(K,L),O.mouse[1]),O.extent,d))}function P(K){$.on("mousemove.zoom mouseup.zoom",null),Q1(K.view,O.moved),nc(K),O.event(K).end()}}function G(R,...B){if(e.apply(this,arguments)){var L=this.__zoom,O=Ss(R.changedTouches?R.changedTouches[0]:R,this),$=L.invert(O),F=L.k*(R.shiftKey?.5:2),H=s(T(A(L,F),O,$),n.apply(this,B),d);nc(R),m>0?ls(this).transition().duration(m).call(M,H,O,R):ls(this).call(j.transform,H,O,R)}}function U(R,...B){if(e.apply(this,arguments)){var L=R.touches,O=L.length,$=k(this,B,R.changedTouches.length===O).event(R),F,H,I,Y;for(qp(R),H=0;H<O;++H)I=L[H],Y=Ss(I,this),Y=[Y,this.__zoom.invert(Y),I.identifier],$.touch0?!$.touch1&&$.touch0[2]!==Y[2]&&($.touch1=Y,$.taps=0):($.touch0=Y,F=!0,$.taps=1+!!y);y&&(y=clearTimeout(y)),F&&($.taps<2&&(g=Y[0],y=setTimeout(function(){y=null},v)),Pd(this),$.start())}}function X(R,...B){if(this.__zooming){var L=k(this,B).event(R),O=R.changedTouches,$=O.length,F,H,I,Y;for(nc(R),F=0;F<$;++F)H=O[F],I=Ss(H,this),L.touch0&&L.touch0[2]===H.identifier?L.touch0[0]=I:L.touch1&&L.touch1[2]===H.identifier&&(L.touch1[0]=I);if(H=L.that.__zoom,L.touch1){var P=L.touch0[0],K=L.touch0[1],re=L.touch1[0],W=L.touch1[1],ue=(ue=re[0]-P[0])*ue+(ue=re[1]-P[1])*ue,Q=(Q=W[0]-K[0])*Q+(Q=W[1]-K[1])*Q;H=A(H,Math.sqrt(ue/Q)),I=[(P[0]+re[0])/2,(P[1]+re[1])/2],Y=[(K[0]+W[0])/2,(K[1]+W[1])/2]}else if(L.touch0)I=L.touch0[0],Y=L.touch0[1];else return;L.zoom("touch",s(T(H,I,Y),L.extent,d))}}function V(R,...B){if(this.__zooming){var L=k(this,B).event(R),O=R.changedTouches,$=O.length,F,H;for(qp(R),x&&clearTimeout(x),x=setTimeout(function(){x=null},v),F=0;F<$;++F)H=O[F],L.touch0&&L.touch0[2]===H.identifier?delete L.touch0:L.touch1&&L.touch1[2]===H.identifier&&delete L.touch1;if(L.touch1&&!L.touch0&&(L.touch0=L.touch1,delete L.touch1),L.touch0)L.touch0[1]=this.__zoom.invert(L.touch0[0]);else if(L.end(),L.taps===2&&(H=Ss(H,this),Math.hypot(g[0]-H[0],g[1]-H[1])<E)){var I=ls(this).on("dblclick.zoom");I&&I.apply(this,arguments)}}}return j.wheelDelta=function(R){return arguments.length?(i=typeof R=="function"?R:Sd(+R),j):i},j.filter=function(R){return arguments.length?(e=typeof R=="function"?R:Sd(!!R),j):e},j.touchable=function(R){return arguments.length?(l=typeof R=="function"?R:Sd(!!R),j):l},j.extent=function(R){return arguments.length?(n=typeof R=="function"?R:Sd([[+R[0][0],+R[0][1]],[+R[1][0],+R[1][1]]]),j):n},j.scaleExtent=function(R){return arguments.length?(o[0]=+R[0],o[1]=+R[1],j):[o[0],o[1]]},j.translateExtent=function(R){return arguments.length?(d[0][0]=+R[0][0],d[1][0]=+R[1][0],d[0][1]=+R[0][1],d[1][1]=+R[1][1],j):[[d[0][0],d[0][1]],[d[1][0],d[1][1]]]},j.constrain=function(R){return arguments.length?(s=R,j):s},j.duration=function(R){return arguments.length?(m=+R,j):m},j.interpolate=function(R){return arguments.length?(p=R,j):p},j.on=function(){var R=h.on.apply(h,arguments);return R===h?j:R},j.clickDistance=function(R){return arguments.length?(N=(R=+R)*R,j):Math.sqrt(N)},j.tapDistance=function(R){return arguments.length?(E=+R,j):E},j}const qf=u.createContext(null),u$=qf.Provider,gr={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,n)=>`Couldn't create edge for ${e?"target":"source"} handle id: "${e?n.targetHandle:n.sourceHandle}", edge id: ${n.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},mE=gr.error001();function Ln(e,n){const s=u.useContext(qf);if(s===null)throw new Error(mE);return F1(s,e,n)}const ra=()=>{const e=u.useContext(qf);if(e===null)throw new Error(mE);return u.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy}),[e])},d$=e=>e.userSelectionActive?"none":"all";function Yg({position:e,children:n,className:s,style:i,...l}){const o=Ln(d$),d=`${e}`.split("-");return Ve.createElement("div",{className:ma(["react-flow__panel",s,...d]),style:{...i,pointerEvents:o},...l},n)}function f$({proOptions:e,position:n="bottom-right"}){return e?.hideAttribution?null:Ve.createElement(Yg,{position:n,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},Ve.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}const m$=({x:e,y:n,label:s,labelStyle:i={},labelShowBg:l=!0,labelBgStyle:o={},labelBgPadding:d=[2,4],labelBgBorderRadius:m=2,children:p,className:h,...y})=>{const g=u.useRef(null),[x,v]=u.useState({x:0,y:0,width:0,height:0}),S=ma(["react-flow__edge-textwrapper",h]);return u.useEffect(()=>{if(g.current){const N=g.current.getBBox();v({x:N.x,y:N.y,width:N.width,height:N.height})}},[s]),typeof s>"u"||!s?null:Ve.createElement("g",{transform:`translate(${e-x.width/2} ${n-x.height/2})`,className:S,visibility:x.width?"visible":"hidden",...y},l&&Ve.createElement("rect",{width:x.width+2*d[0],x:-d[0],y:-d[1],height:x.height+2*d[1],className:"react-flow__edge-textbg",style:o,rx:m,ry:m}),Ve.createElement("text",{className:"react-flow__edge-text",y:x.height/2,dy:"0.3em",ref:g,style:i},s),p)};var h$=u.memo(m$);const Gg=e=>({width:e.offsetWidth,height:e.offsetHeight}),Yl=(e,n=0,s=1)=>Math.min(Math.max(e,n),s),Kg=(e={x:0,y:0},n)=>({x:Yl(e.x,n[0][0],n[1][0]),y:Yl(e.y,n[0][1],n[1][1])}),zw=(e,n,s)=>e<n?Yl(Math.abs(e-n),1,50)/50:e>s?-Yl(Math.abs(e-s),1,50)/50:0,hE=(e,n)=>{const s=zw(e.x,35,n.width-35)*20,i=zw(e.y,35,n.height-35)*20;return[s,i]},pE=e=>e.getRootNode?.()||window?.document,yE=(e,n)=>({x:Math.min(e.x,n.x),y:Math.min(e.y,n.y),x2:Math.max(e.x2,n.x2),y2:Math.max(e.y2,n.y2)}),Lc=({x:e,y:n,width:s,height:i})=>({x:e,y:n,x2:e+s,y2:n+i}),gE=({x:e,y:n,x2:s,y2:i})=>({x:e,y:n,width:s-e,height:i-n}),Bw=e=>({...e.positionAbsolute||{x:0,y:0},width:e.width||0,height:e.height||0}),p$=(e,n)=>gE(yE(Lc(e),Lc(n))),Fy=(e,n)=>{const s=Math.max(0,Math.min(e.x+e.width,n.x+n.width)-Math.max(e.x,n.x)),i=Math.max(0,Math.min(e.y+e.height,n.y+n.height)-Math.max(e.y,n.y));return Math.ceil(s*i)},y$=e=>cs(e.width)&&cs(e.height)&&cs(e.x)&&cs(e.y),cs=e=>!isNaN(e)&&isFinite(e),Vn=Symbol.for("internals"),bE=["Enter"," ","Escape"],g$=(e,n)=>{},b$=e=>"nativeEvent"in e;function zy(e){const s=(b$(e)?e.nativeEvent:e).composedPath?.()?.[0]||e.target;return["INPUT","SELECT","TEXTAREA"].includes(s?.nodeName)||s?.hasAttribute("contenteditable")||!!s?.closest(".nokey")}const xE=e=>"clientX"in e,Zr=(e,n)=>{const s=xE(e),i=s?e.clientX:e.touches?.[0].clientX,l=s?e.clientY:e.touches?.[0].clientY;return{x:i-(n?.left??0),y:l-(n?.top??0)}},cf=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0,eo=({id:e,path:n,labelX:s,labelY:i,label:l,labelStyle:o,labelShowBg:d,labelBgStyle:m,labelBgPadding:p,labelBgBorderRadius:h,style:y,markerEnd:g,markerStart:x,interactionWidth:v=20})=>Ve.createElement(Ve.Fragment,null,Ve.createElement("path",{id:e,style:y,d:n,fill:"none",className:"react-flow__edge-path",markerEnd:g,markerStart:x}),v&&Ve.createElement("path",{d:n,fill:"none",strokeOpacity:0,strokeWidth:v,className:"react-flow__edge-interaction"}),l&&cs(s)&&cs(i)?Ve.createElement(h$,{x:s,y:i,label:l,labelStyle:o,labelShowBg:d,labelBgStyle:m,labelBgPadding:p,labelBgBorderRadius:h}):null);eo.displayName="BaseEdge";function ac(e,n,s){return s===void 0?s:i=>{const l=n().edges.find(o=>o.id===e);l&&s(i,{...l})}}function vE({sourceX:e,sourceY:n,targetX:s,targetY:i}){const l=Math.abs(s-e)/2,o=s<e?s+l:s-l,d=Math.abs(i-n)/2,m=i<n?i+d:i-d;return[o,m,l,d]}function SE({sourceX:e,sourceY:n,targetX:s,targetY:i,sourceControlX:l,sourceControlY:o,targetControlX:d,targetControlY:m}){const p=e*.125+l*.375+d*.375+s*.125,h=n*.125+o*.375+m*.375+i*.125,y=Math.abs(p-e),g=Math.abs(h-n);return[p,h,y,g]}var Fi;(function(e){e.Strict="strict",e.Loose="loose"})(Fi||(Fi={}));var ki;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(ki||(ki={}));var Oc;(function(e){e.Partial="partial",e.Full="full"})(Oc||(Oc={}));var Wr;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Wr||(Wr={}));var uf;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(uf||(uf={}));var Kt;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(Kt||(Kt={}));function Uw({pos:e,x1:n,y1:s,x2:i,y2:l}){return e===Kt.Left||e===Kt.Right?[.5*(n+i),s]:[n,.5*(s+l)]}function wE({sourceX:e,sourceY:n,sourcePosition:s=Kt.Bottom,targetX:i,targetY:l,targetPosition:o=Kt.Top}){const[d,m]=Uw({pos:s,x1:e,y1:n,x2:i,y2:l}),[p,h]=Uw({pos:o,x1:i,y1:l,x2:e,y2:n}),[y,g,x,v]=SE({sourceX:e,sourceY:n,targetX:i,targetY:l,sourceControlX:d,sourceControlY:m,targetControlX:p,targetControlY:h});return[`M${e},${n} C${d},${m} ${p},${h} ${i},${l}`,y,g,x,v]}const Xg=u.memo(({sourceX:e,sourceY:n,targetX:s,targetY:i,sourcePosition:l=Kt.Bottom,targetPosition:o=Kt.Top,label:d,labelStyle:m,labelShowBg:p,labelBgStyle:h,labelBgPadding:y,labelBgBorderRadius:g,style:x,markerEnd:v,markerStart:S,interactionWidth:N})=>{const[E,j,A]=wE({sourceX:e,sourceY:n,sourcePosition:l,targetX:s,targetY:i,targetPosition:o});return Ve.createElement(eo,{path:E,labelX:j,labelY:A,label:d,labelStyle:m,labelShowBg:p,labelBgStyle:h,labelBgPadding:y,labelBgBorderRadius:g,style:x,markerEnd:v,markerStart:S,interactionWidth:N})});Xg.displayName="SimpleBezierEdge";const qw={[Kt.Left]:{x:-1,y:0},[Kt.Right]:{x:1,y:0},[Kt.Top]:{x:0,y:-1},[Kt.Bottom]:{x:0,y:1}},x$=({source:e,sourcePosition:n=Kt.Bottom,target:s})=>n===Kt.Left||n===Kt.Right?e.x<s.x?{x:1,y:0}:{x:-1,y:0}:e.y<s.y?{x:0,y:1}:{x:0,y:-1},Pw=(e,n)=>Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2));function v$({source:e,sourcePosition:n=Kt.Bottom,target:s,targetPosition:i=Kt.Top,center:l,offset:o}){const d=qw[n],m=qw[i],p={x:e.x+d.x*o,y:e.y+d.y*o},h={x:s.x+m.x*o,y:s.y+m.y*o},y=x$({source:p,sourcePosition:n,target:h}),g=y.x!==0?"x":"y",x=y[g];let v=[],S,N;const E={x:0,y:0},j={x:0,y:0},[A,T,_,M]=vE({sourceX:e.x,sourceY:e.y,targetX:s.x,targetY:s.y});if(d[g]*m[g]===-1){S=l.x??A,N=l.y??T;const C=[{x:S,y:p.y},{x:S,y:h.y}],D=[{x:p.x,y:N},{x:h.x,y:N}];d[g]===x?v=g==="x"?C:D:v=g==="x"?D:C}else{const C=[{x:p.x,y:h.y}],D=[{x:h.x,y:p.y}];if(g==="x"?v=d.x===x?D:C:v=d.y===x?C:D,n===i){const V=Math.abs(e[g]-s[g]);if(V<=o){const R=Math.min(o-1,o-V);d[g]===x?E[g]=(p[g]>e[g]?-1:1)*R:j[g]=(h[g]>s[g]?-1:1)*R}}if(n!==i){const V=g==="x"?"y":"x",R=d[g]===m[V],B=p[V]>h[V],L=p[V]<h[V];(d[g]===1&&(!R&&B||R&&L)||d[g]!==1&&(!R&&L||R&&B))&&(v=g==="x"?C:D)}const z={x:p.x+E.x,y:p.y+E.y},G={x:h.x+j.x,y:h.y+j.y},U=Math.max(Math.abs(z.x-v[0].x),Math.abs(G.x-v[0].x)),X=Math.max(Math.abs(z.y-v[0].y),Math.abs(G.y-v[0].y));U>=X?(S=(z.x+G.x)/2,N=v[0].y):(S=v[0].x,N=(z.y+G.y)/2)}return[[e,{x:p.x+E.x,y:p.y+E.y},...v,{x:h.x+j.x,y:h.y+j.y},s],S,N,_,M]}function S$(e,n,s,i){const l=Math.min(Pw(e,n)/2,Pw(n,s)/2,i),{x:o,y:d}=n;if(e.x===o&&o===s.x||e.y===d&&d===s.y)return`L${o} ${d}`;if(e.y===d){const h=e.x<s.x?-1:1,y=e.y<s.y?1:-1;return`L ${o+l*h},${d}Q ${o},${d} ${o},${d+l*y}`}const m=e.x<s.x?1:-1,p=e.y<s.y?-1:1;return`L ${o},${d+l*p}Q ${o},${d} ${o+l*m},${d}`}function df({sourceX:e,sourceY:n,sourcePosition:s=Kt.Bottom,targetX:i,targetY:l,targetPosition:o=Kt.Top,borderRadius:d=5,centerX:m,centerY:p,offset:h=20}){const[y,g,x,v,S]=v$({source:{x:e,y:n},sourcePosition:s,target:{x:i,y:l},targetPosition:o,center:{x:m,y:p},offset:h});return[y.reduce((E,j,A)=>{let T="";return A>0&&A<y.length-1?T=S$(y[A-1],j,y[A+1],d):T=`${A===0?"M":"L"}${j.x} ${j.y}`,E+=T,E},""),g,x,v,S]}const Pf=u.memo(({sourceX:e,sourceY:n,targetX:s,targetY:i,label:l,labelStyle:o,labelShowBg:d,labelBgStyle:m,labelBgPadding:p,labelBgBorderRadius:h,style:y,sourcePosition:g=Kt.Bottom,targetPosition:x=Kt.Top,markerEnd:v,markerStart:S,pathOptions:N,interactionWidth:E})=>{const[j,A,T]=df({sourceX:e,sourceY:n,sourcePosition:g,targetX:s,targetY:i,targetPosition:x,borderRadius:N?.borderRadius,offset:N?.offset});return Ve.createElement(eo,{path:j,labelX:A,labelY:T,label:l,labelStyle:o,labelShowBg:d,labelBgStyle:m,labelBgPadding:p,labelBgBorderRadius:h,style:y,markerEnd:v,markerStart:S,interactionWidth:E})});Pf.displayName="SmoothStepEdge";const Wg=u.memo(e=>Ve.createElement(Pf,{...e,pathOptions:u.useMemo(()=>({borderRadius:0,offset:e.pathOptions?.offset}),[e.pathOptions?.offset])}));Wg.displayName="StepEdge";function w$({sourceX:e,sourceY:n,targetX:s,targetY:i}){const[l,o,d,m]=vE({sourceX:e,sourceY:n,targetX:s,targetY:i});return[`M ${e},${n}L ${s},${i}`,l,o,d,m]}const Zg=u.memo(({sourceX:e,sourceY:n,targetX:s,targetY:i,label:l,labelStyle:o,labelShowBg:d,labelBgStyle:m,labelBgPadding:p,labelBgBorderRadius:h,style:y,markerEnd:g,markerStart:x,interactionWidth:v})=>{const[S,N,E]=w$({sourceX:e,sourceY:n,targetX:s,targetY:i});return Ve.createElement(eo,{path:S,labelX:N,labelY:E,label:l,labelStyle:o,labelShowBg:d,labelBgStyle:m,labelBgPadding:p,labelBgBorderRadius:h,style:y,markerEnd:g,markerStart:x,interactionWidth:v})});Zg.displayName="StraightEdge";function wd(e,n){return e>=0?.5*e:n*25*Math.sqrt(-e)}function Hw({pos:e,x1:n,y1:s,x2:i,y2:l,c:o}){switch(e){case Kt.Left:return[n-wd(n-i,o),s];case Kt.Right:return[n+wd(i-n,o),s];case Kt.Top:return[n,s-wd(s-l,o)];case Kt.Bottom:return[n,s+wd(l-s,o)]}}function NE({sourceX:e,sourceY:n,sourcePosition:s=Kt.Bottom,targetX:i,targetY:l,targetPosition:o=Kt.Top,curvature:d=.25}){const[m,p]=Hw({pos:s,x1:e,y1:n,x2:i,y2:l,c:d}),[h,y]=Hw({pos:o,x1:i,y1:l,x2:e,y2:n,c:d}),[g,x,v,S]=SE({sourceX:e,sourceY:n,targetX:i,targetY:l,sourceControlX:m,sourceControlY:p,targetControlX:h,targetControlY:y});return[`M${e},${n} C${m},${p} ${h},${y} ${i},${l}`,g,x,v,S]}const ff=u.memo(({sourceX:e,sourceY:n,targetX:s,targetY:i,sourcePosition:l=Kt.Bottom,targetPosition:o=Kt.Top,label:d,labelStyle:m,labelShowBg:p,labelBgStyle:h,labelBgPadding:y,labelBgBorderRadius:g,style:x,markerEnd:v,markerStart:S,pathOptions:N,interactionWidth:E})=>{const[j,A,T]=NE({sourceX:e,sourceY:n,sourcePosition:l,targetX:s,targetY:i,targetPosition:o,curvature:N?.curvature});return Ve.createElement(eo,{path:j,labelX:A,labelY:T,label:d,labelStyle:m,labelShowBg:p,labelBgStyle:h,labelBgPadding:y,labelBgBorderRadius:g,style:x,markerEnd:v,markerStart:S,interactionWidth:E})});ff.displayName="BezierEdge";const Qg=u.createContext(null),N$=Qg.Provider;Qg.Consumer;const j$=()=>u.useContext(Qg),E$=e=>"id"in e&&"source"in e&&"target"in e,_$=({source:e,sourceHandle:n,target:s,targetHandle:i})=>`reactflow__edge-${e}${n||""}-${s}${i||""}`,By=(e,n)=>typeof e>"u"?"":typeof e=="string"?e:`${n?`${n}__`:""}${Object.keys(e).sort().map(i=>`${i}=${e[i]}`).join("&")}`,C$=(e,n)=>n.some(s=>s.source===e.source&&s.target===e.target&&(s.sourceHandle===e.sourceHandle||!s.sourceHandle&&!e.sourceHandle)&&(s.targetHandle===e.targetHandle||!s.targetHandle&&!e.targetHandle)),A$=(e,n)=>{if(!e.source||!e.target)return n;let s;return E$(e)?s={...e}:s={...e,id:_$(e)},C$(s,n)?n:n.concat(s)},Uy=({x:e,y:n},[s,i,l],o,[d,m])=>{const p={x:(e-s)/l,y:(n-i)/l};return o?{x:d*Math.round(p.x/d),y:m*Math.round(p.y/m)}:p},jE=({x:e,y:n},[s,i,l])=>({x:e*l+s,y:n*l+i}),Di=(e,n=[0,0])=>{if(!e)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const s=(e.width??0)*n[0],i=(e.height??0)*n[1],l={x:e.position.x-s,y:e.position.y-i};return{...l,positionAbsolute:e.positionAbsolute?{x:e.positionAbsolute.x-s,y:e.positionAbsolute.y-i}:l}},Hf=(e,n=[0,0])=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const s=e.reduce((i,l)=>{const{x:o,y:d}=Di(l,n).positionAbsolute;return yE(i,Lc({x:o,y:d,width:l.width||0,height:l.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return gE(s)},EE=(e,n,[s,i,l]=[0,0,1],o=!1,d=!1,m=[0,0])=>{const p={x:(n.x-s)/l,y:(n.y-i)/l,width:n.width/l,height:n.height/l},h=[];return e.forEach(y=>{const{width:g,height:x,selectable:v=!0,hidden:S=!1}=y;if(d&&!v||S)return!1;const{positionAbsolute:N}=Di(y,m),E={x:N.x,y:N.y,width:g||0,height:x||0},j=Fy(p,E),A=typeof g>"u"||typeof x>"u"||g===null||x===null,T=o&&j>0,_=(g||0)*(x||0);(A||T||j>=_||y.dragging)&&h.push(y)}),h},_E=(e,n)=>{const s=e.map(i=>i.id);return n.filter(i=>s.includes(i.source)||s.includes(i.target))},CE=(e,n,s,i,l,o=.1)=>{const d=n/(e.width*(1+o)),m=s/(e.height*(1+o)),p=Math.min(d,m),h=Yl(p,i,l),y=e.x+e.width/2,g=e.y+e.height/2,x=n/2-y*h,v=s/2-g*h;return{x,y:v,zoom:h}},Ei=(e,n=0)=>e.transition().duration(n);function Vw(e,n,s,i){return(n[s]||[]).reduce((l,o)=>(`${e.id}-${o.id}-${s}`!==i&&l.push({id:o.id||null,type:s,nodeId:e.id,x:(e.positionAbsolute?.x??0)+o.x+o.width/2,y:(e.positionAbsolute?.y??0)+o.y+o.height/2}),l),[])}function T$(e,n,s,i,l,o){const{x:d,y:m}=Zr(e),h=n.elementsFromPoint(d,m).find(S=>S.classList.contains("react-flow__handle"));if(h){const S=h.getAttribute("data-nodeid");if(S){const N=Jg(void 0,h),E=h.getAttribute("data-handleid"),j=o({nodeId:S,id:E,type:N});if(j){const A=l.find(T=>T.nodeId===S&&T.type===N&&T.id===E);return{handle:{id:E,type:N,nodeId:S,x:A?.x||s.x,y:A?.y||s.y},validHandleResult:j}}}}let y=[],g=1/0;if(l.forEach(S=>{const N=Math.sqrt((S.x-s.x)**2+(S.y-s.y)**2);if(N<=i){const E=o(S);N<=g&&(N<g?y=[{handle:S,validHandleResult:E}]:N===g&&y.push({handle:S,validHandleResult:E}),g=N)}}),!y.length)return{handle:null,validHandleResult:AE()};if(y.length===1)return y[0];const x=y.some(({validHandleResult:S})=>S.isValid),v=y.some(({handle:S})=>S.type==="target");return y.find(({handle:S,validHandleResult:N})=>v?S.type==="target":x?N.isValid:!0)||y[0]}const M$={source:null,target:null,sourceHandle:null,targetHandle:null},AE=()=>({handleDomNode:null,isValid:!1,connection:M$,endHandle:null});function TE(e,n,s,i,l,o,d){const m=l==="target",p=d.querySelector(`.react-flow__handle[data-id="${e?.nodeId}-${e?.id}-${e?.type}"]`),h={...AE(),handleDomNode:p};if(p){const y=Jg(void 0,p),g=p.getAttribute("data-nodeid"),x=p.getAttribute("data-handleid"),v=p.classList.contains("connectable"),S=p.classList.contains("connectableend"),N={source:m?g:s,sourceHandle:m?x:i,target:m?s:g,targetHandle:m?i:x};h.connection=N,v&&S&&(n===Fi.Strict?m&&y==="source"||!m&&y==="target":g!==s||x!==i)&&(h.endHandle={nodeId:g,handleId:x,type:y},h.isValid=o(N))}return h}function k$({nodes:e,nodeId:n,handleId:s,handleType:i}){return e.reduce((l,o)=>{if(o[Vn]){const{handleBounds:d}=o[Vn];let m=[],p=[];d&&(m=Vw(o,d,"source",`${n}-${s}-${i}`),p=Vw(o,d,"target",`${n}-${s}-${i}`)),l.push(...m,...p)}return l},[])}function Jg(e,n){return e||(n?.classList.contains("target")?"target":n?.classList.contains("source")?"source":null)}function Pp(e){e?.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function R$(e,n){let s=null;return n?s="valid":e&&!n&&(s="invalid"),s}function ME({event:e,handleId:n,nodeId:s,onConnect:i,isTarget:l,getState:o,setState:d,isValidConnection:m,edgeUpdaterType:p,onReconnectEnd:h}){const y=pE(e.target),{connectionMode:g,domNode:x,autoPanOnConnect:v,connectionRadius:S,onConnectStart:N,panBy:E,getNodes:j,cancelConnection:A}=o();let T=0,_;const{x:M,y:k}=Zr(e),C=y?.elementFromPoint(M,k),D=Jg(p,C),z=x?.getBoundingClientRect();if(!z||!D)return;let G,U=Zr(e,z),X=!1,V=null,R=!1,B=null;const L=k$({nodes:j(),nodeId:s,handleId:n,handleType:D}),O=()=>{if(!v)return;const[H,I]=hE(U,z);E({x:H,y:I}),T=requestAnimationFrame(O)};d({connectionPosition:U,connectionStatus:null,connectionNodeId:s,connectionHandleId:n,connectionHandleType:D,connectionStartHandle:{nodeId:s,handleId:n,type:D},connectionEndHandle:null}),N?.(e,{nodeId:s,handleId:n,handleType:D});function $(H){const{transform:I}=o();U=Zr(H,z);const{handle:Y,validHandleResult:P}=T$(H,y,Uy(U,I,!1,[1,1]),S,L,K=>TE(K,g,s,n,l?"target":"source",m,y));if(_=Y,X||(O(),X=!0),B=P.handleDomNode,V=P.connection,R=P.isValid,d({connectionPosition:_&&R?jE({x:_.x,y:_.y},I):U,connectionStatus:R$(!!_,R),connectionEndHandle:P.endHandle}),!_&&!R&&!B)return Pp(G);V.source!==V.target&&B&&(Pp(G),G=B,B.classList.add("connecting","react-flow__handle-connecting"),B.classList.toggle("valid",R),B.classList.toggle("react-flow__handle-valid",R))}function F(H){(_||B)&&V&&R&&i?.(V),o().onConnectEnd?.(H),p&&h?.(H),Pp(G),A(),cancelAnimationFrame(T),X=!1,R=!1,V=null,B=null,y.removeEventListener("mousemove",$),y.removeEventListener("mouseup",F),y.removeEventListener("touchmove",$),y.removeEventListener("touchend",F)}y.addEventListener("mousemove",$),y.addEventListener("mouseup",F),y.addEventListener("touchmove",$),y.addEventListener("touchend",F)}const Yw=()=>!0,I$=e=>({connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName}),D$=(e,n,s)=>i=>{const{connectionStartHandle:l,connectionEndHandle:o,connectionClickStartHandle:d}=i;return{connecting:l?.nodeId===e&&l?.handleId===n&&l?.type===s||o?.nodeId===e&&o?.handleId===n&&o?.type===s,clickConnecting:d?.nodeId===e&&d?.handleId===n&&d?.type===s}},kE=u.forwardRef(({type:e="source",position:n=Kt.Top,isValidConnection:s,isConnectable:i=!0,isConnectableStart:l=!0,isConnectableEnd:o=!0,id:d,onConnect:m,children:p,className:h,onMouseDown:y,onTouchStart:g,...x},v)=>{const S=d||null,N=e==="target",E=ra(),j=j$(),{connectOnClick:A,noPanClassName:T}=Ln(I$,la),{connecting:_,clickConnecting:M}=Ln(D$(j,S,e),la);j||E.getState().onError?.("010",gr.error010());const k=z=>{const{defaultEdgeOptions:G,onConnect:U,hasDefaultEdges:X}=E.getState(),V={...G,...z};if(X){const{edges:R,setEdges:B}=E.getState();B(A$(V,R))}U?.(V),m?.(V)},C=z=>{if(!j)return;const G=xE(z);l&&(G&&z.button===0||!G)&&ME({event:z,handleId:S,nodeId:j,onConnect:k,isTarget:N,getState:E.getState,setState:E.setState,isValidConnection:s||E.getState().isValidConnection||Yw}),G?y?.(z):g?.(z)},D=z=>{const{onClickConnectStart:G,onClickConnectEnd:U,connectionClickStartHandle:X,connectionMode:V,isValidConnection:R}=E.getState();if(!j||!X&&!l)return;if(!X){G?.(z,{nodeId:j,handleId:S,handleType:e}),E.setState({connectionClickStartHandle:{nodeId:j,type:e,handleId:S}});return}const B=pE(z.target),L=s||R||Yw,{connection:O,isValid:$}=TE({nodeId:j,id:S,type:e},V,X.nodeId,X.handleId||null,X.type,L,B);$&&k(O),U?.(z),E.setState({connectionClickStartHandle:null})};return Ve.createElement("div",{"data-handleid":S,"data-nodeid":j,"data-handlepos":n,"data-id":`${j}-${S}-${e}`,className:ma(["react-flow__handle",`react-flow__handle-${n}`,"nodrag",T,h,{source:!N,target:N,connectable:i,connectablestart:l,connectableend:o,connecting:M,connectionindicator:i&&(l&&!_||o&&_)}]),onMouseDown:C,onTouchStart:C,onClick:A?D:void 0,ref:v,...x},p)});kE.displayName="Handle";var ni=u.memo(kE);const RE=({data:e,isConnectable:n,targetPosition:s=Kt.Top,sourcePosition:i=Kt.Bottom})=>Ve.createElement(Ve.Fragment,null,Ve.createElement(ni,{type:"target",position:s,isConnectable:n}),e?.label,Ve.createElement(ni,{type:"source",position:i,isConnectable:n}));RE.displayName="DefaultNode";var qy=u.memo(RE);const IE=({data:e,isConnectable:n,sourcePosition:s=Kt.Bottom})=>Ve.createElement(Ve.Fragment,null,e?.label,Ve.createElement(ni,{type:"source",position:s,isConnectable:n}));IE.displayName="InputNode";var DE=u.memo(IE);const LE=({data:e,isConnectable:n,targetPosition:s=Kt.Top})=>Ve.createElement(Ve.Fragment,null,Ve.createElement(ni,{type:"target",position:s,isConnectable:n}),e?.label);LE.displayName="OutputNode";var OE=u.memo(LE);const eb=()=>null;eb.displayName="GroupNode";const L$=e=>({selectedNodes:e.getNodes().filter(n=>n.selected),selectedEdges:e.edges.filter(n=>n.selected).map(n=>({...n}))}),Nd=e=>e.id;function O$(e,n){return la(e.selectedNodes.map(Nd),n.selectedNodes.map(Nd))&&la(e.selectedEdges.map(Nd),n.selectedEdges.map(Nd))}const $E=u.memo(({onSelectionChange:e})=>{const n=ra(),{selectedNodes:s,selectedEdges:i}=Ln(L$,O$);return u.useEffect(()=>{const l={nodes:s,edges:i};e?.(l),n.getState().onSelectionChange.forEach(o=>o(l))},[s,i,e]),null});$E.displayName="SelectionListener";const $$=e=>!!e.onSelectionChange;function F$({onSelectionChange:e}){const n=Ln($$);return e||n?Ve.createElement($E,{onSelectionChange:e}):null}const z$=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset});function Al(e,n){u.useEffect(()=>{typeof e<"u"&&n(e)},[e])}function hn(e,n,s){u.useEffect(()=>{typeof n<"u"&&s({[e]:n})},[n])}const B$=({nodes:e,edges:n,defaultNodes:s,defaultEdges:i,onConnect:l,onConnectStart:o,onConnectEnd:d,onClickConnectStart:m,onClickConnectEnd:p,nodesDraggable:h,nodesConnectable:y,nodesFocusable:g,edgesFocusable:x,edgesUpdatable:v,elevateNodesOnSelect:S,minZoom:N,maxZoom:E,nodeExtent:j,onNodesChange:A,onEdgesChange:T,elementsSelectable:_,connectionMode:M,snapGrid:k,snapToGrid:C,translateExtent:D,connectOnClick:z,defaultEdgeOptions:G,fitView:U,fitViewOptions:X,onNodesDelete:V,onEdgesDelete:R,onNodeDrag:B,onNodeDragStart:L,onNodeDragStop:O,onSelectionDrag:$,onSelectionDragStart:F,onSelectionDragStop:H,noPanClassName:I,nodeOrigin:Y,rfId:P,autoPanOnConnect:K,autoPanOnNodeDrag:re,onError:W,connectionRadius:ue,isValidConnection:Q,nodeDragThreshold:ye})=>{const{setNodes:ae,setEdges:ke,setDefaultNodesAndEdges:pe,setMinZoom:we,setMaxZoom:ne,setTranslateExtent:Le,setNodeExtent:be,reset:Oe}=Ln(z$,la),Me=ra();return u.useEffect(()=>{const ut=i?.map(ht=>({...ht,...G}));return pe(s,ut),()=>{Oe()}},[]),hn("defaultEdgeOptions",G,Me.setState),hn("connectionMode",M,Me.setState),hn("onConnect",l,Me.setState),hn("onConnectStart",o,Me.setState),hn("onConnectEnd",d,Me.setState),hn("onClickConnectStart",m,Me.setState),hn("onClickConnectEnd",p,Me.setState),hn("nodesDraggable",h,Me.setState),hn("nodesConnectable",y,Me.setState),hn("nodesFocusable",g,Me.setState),hn("edgesFocusable",x,Me.setState),hn("edgesUpdatable",v,Me.setState),hn("elementsSelectable",_,Me.setState),hn("elevateNodesOnSelect",S,Me.setState),hn("snapToGrid",C,Me.setState),hn("snapGrid",k,Me.setState),hn("onNodesChange",A,Me.setState),hn("onEdgesChange",T,Me.setState),hn("connectOnClick",z,Me.setState),hn("fitViewOnInit",U,Me.setState),hn("fitViewOnInitOptions",X,Me.setState),hn("onNodesDelete",V,Me.setState),hn("onEdgesDelete",R,Me.setState),hn("onNodeDrag",B,Me.setState),hn("onNodeDragStart",L,Me.setState),hn("onNodeDragStop",O,Me.setState),hn("onSelectionDrag",$,Me.setState),hn("onSelectionDragStart",F,Me.setState),hn("onSelectionDragStop",H,Me.setState),hn("noPanClassName",I,Me.setState),hn("nodeOrigin",Y,Me.setState),hn("rfId",P,Me.setState),hn("autoPanOnConnect",K,Me.setState),hn("autoPanOnNodeDrag",re,Me.setState),hn("onError",W,Me.setState),hn("connectionRadius",ue,Me.setState),hn("isValidConnection",Q,Me.setState),hn("nodeDragThreshold",ye,Me.setState),Al(e,ae),Al(n,ke),Al(N,we),Al(E,ne),Al(D,Le),Al(j,be),null},Gw={display:"none"},U$={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},FE="react-flow__node-desc",zE="react-flow__edge-desc",q$="react-flow__aria-live",P$=e=>e.ariaLiveMessage;function H$({rfId:e}){const n=Ln(P$);return Ve.createElement("div",{id:`${q$}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:U$},n)}function V$({rfId:e,disableKeyboardA11y:n}){return Ve.createElement(Ve.Fragment,null,Ve.createElement("div",{id:`${FE}-${e}`,style:Gw},"Press enter or space to select a node.",!n&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),Ve.createElement("div",{id:`${zE}-${e}`,style:Gw},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!n&&Ve.createElement(H$,{rfId:e}))}var $c=(e=null,n={actInsideInputWithModifier:!0})=>{const[s,i]=u.useState(!1),l=u.useRef(!1),o=u.useRef(new Set([])),[d,m]=u.useMemo(()=>{if(e!==null){const h=(Array.isArray(e)?e:[e]).filter(g=>typeof g=="string").map(g=>g.split("+")),y=h.reduce((g,x)=>g.concat(...x),[]);return[h,y]}return[[],[]]},[e]);return u.useEffect(()=>{const p=typeof document<"u"?document:null,h=n?.target||p;if(e!==null){const y=v=>{if(l.current=v.ctrlKey||v.metaKey||v.shiftKey,(!l.current||l.current&&!n.actInsideInputWithModifier)&&zy(v))return!1;const N=Xw(v.code,m);o.current.add(v[N]),Kw(d,o.current,!1)&&(v.preventDefault(),i(!0))},g=v=>{if((!l.current||l.current&&!n.actInsideInputWithModifier)&&zy(v))return!1;const N=Xw(v.code,m);Kw(d,o.current,!0)?(i(!1),o.current.clear()):o.current.delete(v[N]),v.key==="Meta"&&o.current.clear(),l.current=!1},x=()=>{o.current.clear(),i(!1)};return h?.addEventListener("keydown",y),h?.addEventListener("keyup",g),window.addEventListener("blur",x),()=>{h?.removeEventListener("keydown",y),h?.removeEventListener("keyup",g),window.removeEventListener("blur",x)}}},[e,i]),s};function Kw(e,n,s){return e.filter(i=>s||i.length===n.size).some(i=>i.every(l=>n.has(l)))}function Xw(e,n){return n.includes(e)?"code":"key"}function BE(e,n,s,i){const l=e.parentNode||e.parentId;if(!l)return s;const o=n.get(l),d=Di(o,i);return BE(o,n,{x:(s.x??0)+d.x,y:(s.y??0)+d.y,z:(o[Vn]?.z??0)>(s.z??0)?o[Vn]?.z??0:s.z??0},i)}function UE(e,n,s){e.forEach(i=>{const l=i.parentNode||i.parentId;if(l&&!e.has(l))throw new Error(`Parent node ${l} not found`);if(l||s?.[i.id]){const{x:o,y:d,z:m}=BE(i,e,{...i.position,z:i[Vn]?.z??0},n);i.positionAbsolute={x:o,y:d},i[Vn].z=m,s?.[i.id]&&(i[Vn].isParent=!0)}})}function Hp(e,n,s,i){const l=new Map,o={},d=i?1e3:0;return e.forEach(m=>{const p=(cs(m.zIndex)?m.zIndex:0)+(m.selected?d:0),h=n.get(m.id),y={...m,positionAbsolute:{x:m.position.x,y:m.position.y}},g=m.parentNode||m.parentId;g&&(o[g]=!0);const x=h?.type&&h?.type!==m.type;Object.defineProperty(y,Vn,{enumerable:!1,value:{handleBounds:x?void 0:h?.[Vn]?.handleBounds,z:p}}),l.set(m.id,y)}),UE(l,s,o),l}function qE(e,n={}){const{getNodes:s,width:i,height:l,minZoom:o,maxZoom:d,d3Zoom:m,d3Selection:p,fitViewOnInitDone:h,fitViewOnInit:y,nodeOrigin:g}=e(),x=n.initial&&!h&&y;if(m&&p&&(x||!n.initial)){const S=s().filter(E=>{const j=n.includeHiddenNodes?E.width&&E.height:!E.hidden;return n.nodes?.length?j&&n.nodes.some(A=>A.id===E.id):j}),N=S.every(E=>E.width&&E.height);if(S.length>0&&N){const E=Hf(S,g),{x:j,y:A,zoom:T}=CE(E,i,l,n.minZoom??o,n.maxZoom??d,n.padding??.1),_=pr.translate(j,A).scale(T);return typeof n.duration=="number"&&n.duration>0?m.transform(Ei(p,n.duration),_):m.transform(p,_),!0}}return!1}function Y$(e,n){return e.forEach(s=>{const i=n.get(s.id);i&&n.set(i.id,{...i,[Vn]:i[Vn],selected:s.selected})}),new Map(n)}function G$(e,n){return n.map(s=>{const i=e.find(l=>l.id===s.id);return i&&(s.selected=i.selected),s})}function jd({changedNodes:e,changedEdges:n,get:s,set:i}){const{nodeInternals:l,edges:o,onNodesChange:d,onEdgesChange:m,hasDefaultNodes:p,hasDefaultEdges:h}=s();e?.length&&(p&&i({nodeInternals:Y$(e,l)}),d?.(e)),n?.length&&(h&&i({edges:G$(n,o)}),m?.(n))}const Tl=()=>{},K$={zoomIn:Tl,zoomOut:Tl,zoomTo:Tl,getZoom:()=>1,setViewport:Tl,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:Tl,fitBounds:Tl,project:e=>e,screenToFlowPosition:e=>e,flowToScreenPosition:e=>e,viewportInitialized:!1},X$=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection}),W$=()=>{const e=ra(),{d3Zoom:n,d3Selection:s}=Ln(X$,la);return u.useMemo(()=>s&&n?{zoomIn:l=>n.scaleBy(Ei(s,l?.duration),1.2),zoomOut:l=>n.scaleBy(Ei(s,l?.duration),1/1.2),zoomTo:(l,o)=>n.scaleTo(Ei(s,o?.duration),l),getZoom:()=>e.getState().transform[2],setViewport:(l,o)=>{const[d,m,p]=e.getState().transform,h=pr.translate(l.x??d,l.y??m).scale(l.zoom??p);n.transform(Ei(s,o?.duration),h)},getViewport:()=>{const[l,o,d]=e.getState().transform;return{x:l,y:o,zoom:d}},fitView:l=>qE(e.getState,l),setCenter:(l,o,d)=>{const{width:m,height:p,maxZoom:h}=e.getState(),y=typeof d?.zoom<"u"?d.zoom:h,g=m/2-l*y,x=p/2-o*y,v=pr.translate(g,x).scale(y);n.transform(Ei(s,d?.duration),v)},fitBounds:(l,o)=>{const{width:d,height:m,minZoom:p,maxZoom:h}=e.getState(),{x:y,y:g,zoom:x}=CE(l,d,m,p,h,o?.padding??.1),v=pr.translate(y,g).scale(x);n.transform(Ei(s,o?.duration),v)},project:l=>{const{transform:o,snapToGrid:d,snapGrid:m}=e.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),Uy(l,o,d,m)},screenToFlowPosition:l=>{const{transform:o,snapToGrid:d,snapGrid:m,domNode:p}=e.getState();if(!p)return l;const{x:h,y}=p.getBoundingClientRect(),g={x:l.x-h,y:l.y-y};return Uy(g,o,d,m)},flowToScreenPosition:l=>{const{transform:o,domNode:d}=e.getState();if(!d)return l;const{x:m,y:p}=d.getBoundingClientRect(),h=jE(l,o);return{x:h.x+m,y:h.y+p}},viewportInitialized:!0}:K$,[n,s])};function Vf(){const e=W$(),n=ra(),s=u.useCallback(()=>n.getState().getNodes().map(N=>({...N})),[]),i=u.useCallback(N=>n.getState().nodeInternals.get(N),[]),l=u.useCallback(()=>{const{edges:N=[]}=n.getState();return N.map(E=>({...E}))},[]),o=u.useCallback(N=>{const{edges:E=[]}=n.getState();return E.find(j=>j.id===N)},[]),d=u.useCallback(N=>{const{getNodes:E,setNodes:j,hasDefaultNodes:A,onNodesChange:T}=n.getState(),_=E(),M=typeof N=="function"?N(_):N;if(A)j(M);else if(T){const k=M.length===0?_.map(C=>({type:"remove",id:C.id})):M.map(C=>({item:C,type:"reset"}));T(k)}},[]),m=u.useCallback(N=>{const{edges:E=[],setEdges:j,hasDefaultEdges:A,onEdgesChange:T}=n.getState(),_=typeof N=="function"?N(E):N;if(A)j(_);else if(T){const M=_.length===0?E.map(k=>({type:"remove",id:k.id})):_.map(k=>({item:k,type:"reset"}));T(M)}},[]),p=u.useCallback(N=>{const E=Array.isArray(N)?N:[N],{getNodes:j,setNodes:A,hasDefaultNodes:T,onNodesChange:_}=n.getState();if(T){const k=[...j(),...E];A(k)}else if(_){const M=E.map(k=>({item:k,type:"add"}));_(M)}},[]),h=u.useCallback(N=>{const E=Array.isArray(N)?N:[N],{edges:j=[],setEdges:A,hasDefaultEdges:T,onEdgesChange:_}=n.getState();if(T)A([...j,...E]);else if(_){const M=E.map(k=>({item:k,type:"add"}));_(M)}},[]),y=u.useCallback(()=>{const{getNodes:N,edges:E=[],transform:j}=n.getState(),[A,T,_]=j;return{nodes:N().map(M=>({...M})),edges:E.map(M=>({...M})),viewport:{x:A,y:T,zoom:_}}},[]),g=u.useCallback(({nodes:N,edges:E})=>{const{nodeInternals:j,getNodes:A,edges:T,hasDefaultNodes:_,hasDefaultEdges:M,onNodesDelete:k,onEdgesDelete:C,onNodesChange:D,onEdgesChange:z}=n.getState(),G=(N||[]).map(B=>B.id),U=(E||[]).map(B=>B.id),X=A().reduce((B,L)=>{const O=L.parentNode||L.parentId,$=!G.includes(L.id)&&O&&B.find(H=>H.id===O);return(typeof L.deletable=="boolean"?L.deletable:!0)&&(G.includes(L.id)||$)&&B.push(L),B},[]),V=T.filter(B=>typeof B.deletable=="boolean"?B.deletable:!0),R=V.filter(B=>U.includes(B.id));if(X||R){const B=_E(X,V),L=[...R,...B],O=L.reduce(($,F)=>($.includes(F.id)||$.push(F.id),$),[]);if((M||_)&&(M&&n.setState({edges:T.filter($=>!O.includes($.id))}),_&&(X.forEach($=>{j.delete($.id)}),n.setState({nodeInternals:new Map(j)}))),O.length>0&&(C?.(L),z&&z(O.map($=>({id:$,type:"remove"})))),X.length>0&&(k?.(X),D)){const $=X.map(F=>({id:F.id,type:"remove"}));D($)}}},[]),x=u.useCallback(N=>{const E=y$(N),j=E?null:n.getState().nodeInternals.get(N.id);return!E&&!j?[null,null,E]:[E?N:Bw(j),j,E]},[]),v=u.useCallback((N,E=!0,j)=>{const[A,T,_]=x(N);return A?(j||n.getState().getNodes()).filter(M=>{if(!_&&(M.id===T.id||!M.positionAbsolute))return!1;const k=Bw(M),C=Fy(k,A);return E&&C>0||C>=A.width*A.height}):[]},[]),S=u.useCallback((N,E,j=!0)=>{const[A]=x(N);if(!A)return!1;const T=Fy(A,E);return j&&T>0||T>=A.width*A.height},[]);return u.useMemo(()=>({...e,getNodes:s,getNode:i,getEdges:l,getEdge:o,setNodes:d,setEdges:m,addNodes:p,addEdges:h,toObject:y,deleteElements:g,getIntersectingNodes:v,isNodeIntersecting:S}),[e,s,i,l,o,d,m,p,h,y,g,v,S])}const Z$={actInsideInputWithModifier:!1};var Q$=({deleteKeyCode:e,multiSelectionKeyCode:n})=>{const s=ra(),{deleteElements:i}=Vf(),l=$c(e,Z$),o=$c(n);u.useEffect(()=>{if(l){const{edges:d,getNodes:m}=s.getState(),p=m().filter(y=>y.selected),h=d.filter(y=>y.selected);i({nodes:p,edges:h}),s.setState({nodesSelectionActive:!1})}},[l]),u.useEffect(()=>{s.setState({multiSelectionActive:o})},[o])};function J$(e){const n=ra();u.useEffect(()=>{let s;const i=()=>{if(!e.current)return;const l=Gg(e.current);(l.height===0||l.width===0)&&n.getState().onError?.("004",gr.error004()),n.setState({width:l.width||500,height:l.height||500})};return i(),window.addEventListener("resize",i),e.current&&(s=new ResizeObserver(()=>i()),s.observe(e.current)),()=>{window.removeEventListener("resize",i),s&&e.current&&s.unobserve(e.current)}},[])}const tb={position:"absolute",width:"100%",height:"100%",top:0,left:0},eF=(e,n)=>e.x!==n.x||e.y!==n.y||e.zoom!==n.k,Ed=e=>({x:e.x,y:e.y,zoom:e.k}),Ml=(e,n)=>e.target.closest(`.${n}`),Ww=(e,n)=>n===2&&Array.isArray(e)&&e.includes(2),Zw=e=>{const n=e.ctrlKey&&cf()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*n},tF=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler,userSelectionActive:e.userSelectionActive}),nF=({onMove:e,onMoveStart:n,onMoveEnd:s,onPaneContextMenu:i,zoomOnScroll:l=!0,zoomOnPinch:o=!0,panOnScroll:d=!1,panOnScrollSpeed:m=.5,panOnScrollMode:p=ki.Free,zoomOnDoubleClick:h=!0,elementsSelectable:y,panOnDrag:g=!0,defaultViewport:x,translateExtent:v,minZoom:S,maxZoom:N,zoomActivationKeyCode:E,preventScrolling:j=!0,children:A,noWheelClassName:T,noPanClassName:_})=>{const M=u.useRef(),k=ra(),C=u.useRef(!1),D=u.useRef(!1),z=u.useRef(null),G=u.useRef({x:0,y:0,zoom:0}),{d3Zoom:U,d3Selection:X,d3ZoomHandler:V,userSelectionActive:R}=Ln(tF,la),B=$c(E),L=u.useRef(0),O=u.useRef(!1),$=u.useRef();return J$(z),u.useEffect(()=>{if(z.current){const F=z.current.getBoundingClientRect(),H=fE().scaleExtent([S,N]).translateExtent(v),I=ls(z.current).call(H),Y=pr.translate(x.x,x.y).scale(Yl(x.zoom,S,N)),P=[[0,0],[F.width,F.height]],K=H.constrain()(Y,P,v);H.transform(I,K),H.wheelDelta(Zw),k.setState({d3Zoom:H,d3Selection:I,d3ZoomHandler:I.on("wheel.zoom"),transform:[K.x,K.y,K.k],domNode:z.current.closest(".react-flow")})}},[]),u.useEffect(()=>{X&&U&&(d&&!B&&!R?X.on("wheel.zoom",F=>{if(Ml(F,T))return!1;F.preventDefault(),F.stopImmediatePropagation();const H=X.property("__zoom").k||1;if(F.ctrlKey&&o){const Q=Ss(F),ye=Zw(F),ae=H*Math.pow(2,ye);U.scaleTo(X,ae,Q,F);return}const I=F.deltaMode===1?20:1;let Y=p===ki.Vertical?0:F.deltaX*I,P=p===ki.Horizontal?0:F.deltaY*I;!cf()&&F.shiftKey&&p!==ki.Vertical&&(Y=F.deltaY*I,P=0),U.translateBy(X,-(Y/H)*m,-(P/H)*m,{internal:!0});const K=Ed(X.property("__zoom")),{onViewportChangeStart:re,onViewportChange:W,onViewportChangeEnd:ue}=k.getState();clearTimeout($.current),O.current||(O.current=!0,n?.(F,K),re?.(K)),O.current&&(e?.(F,K),W?.(K),$.current=setTimeout(()=>{s?.(F,K),ue?.(K),O.current=!1},150))},{passive:!1}):typeof V<"u"&&X.on("wheel.zoom",function(F,H){if(!j&&F.type==="wheel"&&!F.ctrlKey||Ml(F,T))return null;F.preventDefault(),V.call(this,F,H)},{passive:!1}))},[R,d,p,X,U,V,B,o,j,T,n,e,s]),u.useEffect(()=>{U&&U.on("start",F=>{if(!F.sourceEvent||F.sourceEvent.internal)return null;L.current=F.sourceEvent?.button;const{onViewportChangeStart:H}=k.getState(),I=Ed(F.transform);C.current=!0,G.current=I,F.sourceEvent?.type==="mousedown"&&k.setState({paneDragging:!0}),H?.(I),n?.(F.sourceEvent,I)})},[U,n]),u.useEffect(()=>{U&&(R&&!C.current?U.on("zoom",null):R||U.on("zoom",F=>{const{onViewportChange:H}=k.getState();if(k.setState({transform:[F.transform.x,F.transform.y,F.transform.k]}),D.current=!!(i&&Ww(g,L.current??0)),(e||H)&&!F.sourceEvent?.internal){const I=Ed(F.transform);H?.(I),e?.(F.sourceEvent,I)}}))},[R,U,e,g,i]),u.useEffect(()=>{U&&U.on("end",F=>{if(!F.sourceEvent||F.sourceEvent.internal)return null;const{onViewportChangeEnd:H}=k.getState();if(C.current=!1,k.setState({paneDragging:!1}),i&&Ww(g,L.current??0)&&!D.current&&i(F.sourceEvent),D.current=!1,(s||H)&&eF(G.current,F.transform)){const I=Ed(F.transform);G.current=I,clearTimeout(M.current),M.current=setTimeout(()=>{H?.(I),s?.(F.sourceEvent,I)},d?150:0)}})},[U,d,g,s,i]),u.useEffect(()=>{U&&U.filter(F=>{const H=B||l,I=o&&F.ctrlKey;if((g===!0||Array.isArray(g)&&g.includes(1))&&F.button===1&&F.type==="mousedown"&&(Ml(F,"react-flow__node")||Ml(F,"react-flow__edge")))return!0;if(!g&&!H&&!d&&!h&&!o||R||!h&&F.type==="dblclick"||Ml(F,T)&&F.type==="wheel"||Ml(F,_)&&(F.type!=="wheel"||d&&F.type==="wheel"&&!B)||!o&&F.ctrlKey&&F.type==="wheel"||!H&&!d&&!I&&F.type==="wheel"||!g&&(F.type==="mousedown"||F.type==="touchstart")||Array.isArray(g)&&!g.includes(F.button)&&F.type==="mousedown")return!1;const Y=Array.isArray(g)&&g.includes(F.button)||!F.button||F.button<=1;return(!F.ctrlKey||F.type==="wheel")&&Y})},[R,U,l,o,d,h,g,y,B]),Ve.createElement("div",{className:"react-flow__renderer",ref:z,style:tb},A)},aF=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function sF(){const{userSelectionActive:e,userSelectionRect:n}=Ln(aF,la);return e&&n?Ve.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:n.width,height:n.height,transform:`translate(${n.x}px, ${n.y}px)`}}):null}function Qw(e,n){const s=n.parentNode||n.parentId,i=e.find(l=>l.id===s);if(i){const l=n.position.x+n.width-i.width,o=n.position.y+n.height-i.height;if(l>0||o>0||n.position.x<0||n.position.y<0){if(i.style={...i.style},i.style.width=i.style.width??i.width,i.style.height=i.style.height??i.height,l>0&&(i.style.width+=l),o>0&&(i.style.height+=o),n.position.x<0){const d=Math.abs(n.position.x);i.position.x=i.position.x-d,i.style.width+=d,n.position.x=0}if(n.position.y<0){const d=Math.abs(n.position.y);i.position.y=i.position.y-d,i.style.height+=d,n.position.y=0}i.width=i.style.width,i.height=i.style.height}}}function PE(e,n){if(e.some(i=>i.type==="reset"))return e.filter(i=>i.type==="reset").map(i=>i.item);const s=e.filter(i=>i.type==="add").map(i=>i.item);return n.reduce((i,l)=>{const o=e.filter(m=>m.id===l.id);if(o.length===0)return i.push(l),i;const d={...l};for(const m of o)if(m)switch(m.type){case"select":{d.selected=m.selected;break}case"position":{typeof m.position<"u"&&(d.position=m.position),typeof m.positionAbsolute<"u"&&(d.positionAbsolute=m.positionAbsolute),typeof m.dragging<"u"&&(d.dragging=m.dragging),d.expandParent&&Qw(i,d);break}case"dimensions":{typeof m.dimensions<"u"&&(d.width=m.dimensions.width,d.height=m.dimensions.height),typeof m.updateStyle<"u"&&(d.style={...d.style||{},...m.dimensions}),typeof m.resizing=="boolean"&&(d.resizing=m.resizing),d.expandParent&&Qw(i,d);break}case"remove":return i}return i.push(d),i},s)}function HE(e,n){return PE(e,n)}function rF(e,n){return PE(e,n)}const Gr=(e,n)=>({id:e,type:"select",selected:n});function Dl(e,n){return e.reduce((s,i)=>{const l=n.includes(i.id);return!i.selected&&l?(i.selected=!0,s.push(Gr(i.id,!0))):i.selected&&!l&&(i.selected=!1,s.push(Gr(i.id,!1))),s},[])}const Vp=(e,n)=>s=>{s.target===n.current&&e?.(s)},iF=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging}),VE=u.memo(({isSelecting:e,selectionMode:n=Oc.Full,panOnDrag:s,onSelectionStart:i,onSelectionEnd:l,onPaneClick:o,onPaneContextMenu:d,onPaneScroll:m,onPaneMouseEnter:p,onPaneMouseMove:h,onPaneMouseLeave:y,children:g})=>{const x=u.useRef(null),v=ra(),S=u.useRef(0),N=u.useRef(0),E=u.useRef(),{userSelectionActive:j,elementsSelectable:A,dragging:T}=Ln(iF,la),_=()=>{v.setState({userSelectionActive:!1,userSelectionRect:null}),S.current=0,N.current=0},M=V=>{o?.(V),v.getState().resetSelectedElements(),v.setState({nodesSelectionActive:!1})},k=V=>{if(Array.isArray(s)&&s?.includes(2)){V.preventDefault();return}d?.(V)},C=m?V=>m(V):void 0,D=V=>{const{resetSelectedElements:R,domNode:B}=v.getState();if(E.current=B?.getBoundingClientRect(),!A||!e||V.button!==0||V.target!==x.current||!E.current)return;const{x:L,y:O}=Zr(V,E.current);R(),v.setState({userSelectionRect:{width:0,height:0,startX:L,startY:O,x:L,y:O}}),i?.(V)},z=V=>{const{userSelectionRect:R,nodeInternals:B,edges:L,transform:O,onNodesChange:$,onEdgesChange:F,nodeOrigin:H,getNodes:I}=v.getState();if(!e||!E.current||!R)return;v.setState({userSelectionActive:!0,nodesSelectionActive:!1});const Y=Zr(V,E.current),P=R.startX??0,K=R.startY??0,re={...R,x:Y.x<P?Y.x:P,y:Y.y<K?Y.y:K,width:Math.abs(Y.x-P),height:Math.abs(Y.y-K)},W=I(),ue=EE(B,re,O,n===Oc.Partial,!0,H),Q=_E(ue,L).map(ae=>ae.id),ye=ue.map(ae=>ae.id);if(S.current!==ye.length){S.current=ye.length;const ae=Dl(W,ye);ae.length&&$?.(ae)}if(N.current!==Q.length){N.current=Q.length;const ae=Dl(L,Q);ae.length&&F?.(ae)}v.setState({userSelectionRect:re})},G=V=>{if(V.button!==0)return;const{userSelectionRect:R}=v.getState();!j&&R&&V.target===x.current&&M?.(V),v.setState({nodesSelectionActive:S.current>0}),_(),l?.(V)},U=V=>{j&&(v.setState({nodesSelectionActive:S.current>0}),l?.(V)),_()},X=A&&(e||j);return Ve.createElement("div",{className:ma(["react-flow__pane",{dragging:T,selection:e}]),onClick:X?void 0:Vp(M,x),onContextMenu:Vp(k,x),onWheel:Vp(C,x),onMouseEnter:X?void 0:p,onMouseDown:X?D:void 0,onMouseMove:X?z:h,onMouseUp:X?G:void 0,onMouseLeave:X?U:y,ref:x,style:tb},g,Ve.createElement(sF,null))});VE.displayName="Pane";function YE(e,n){const s=e.parentNode||e.parentId;if(!s)return!1;const i=n.get(s);return i?i.selected?!0:YE(i,n):!1}function Jw(e,n,s){let i=e;do{if(i?.matches(n))return!0;if(i===s.current)return!1;i=i.parentElement}while(i);return!1}function lF(e,n,s,i){return Array.from(e.values()).filter(l=>(l.selected||l.id===i)&&(!l.parentNode||l.parentId||!YE(l,e))&&(l.draggable||n&&typeof l.draggable>"u")).map(l=>({id:l.id,position:l.position||{x:0,y:0},positionAbsolute:l.positionAbsolute||{x:0,y:0},distance:{x:s.x-(l.positionAbsolute?.x??0),y:s.y-(l.positionAbsolute?.y??0)},delta:{x:0,y:0},extent:l.extent,parentNode:l.parentNode||l.parentId,parentId:l.parentNode||l.parentId,width:l.width,height:l.height,expandParent:l.expandParent}))}function oF(e,n){return!n||n==="parent"?n:[n[0],[n[1][0]-(e.width||0),n[1][1]-(e.height||0)]]}function GE(e,n,s,i,l=[0,0],o){const d=oF(e,e.extent||i);let m=d;const p=e.parentNode||e.parentId;if(e.extent==="parent"&&!e.expandParent)if(p&&e.width&&e.height){const g=s.get(p),{x,y:v}=Di(g,l).positionAbsolute;m=g&&cs(x)&&cs(v)&&cs(g.width)&&cs(g.height)?[[x+e.width*l[0],v+e.height*l[1]],[x+g.width-e.width+e.width*l[0],v+g.height-e.height+e.height*l[1]]]:m}else o?.("005",gr.error005()),m=d;else if(e.extent&&p&&e.extent!=="parent"){const g=s.get(p),{x,y:v}=Di(g,l).positionAbsolute;m=[[e.extent[0][0]+x,e.extent[0][1]+v],[e.extent[1][0]+x,e.extent[1][1]+v]]}let h={x:0,y:0};if(p){const g=s.get(p);h=Di(g,l).positionAbsolute}const y=m&&m!=="parent"?Kg(n,m):n;return{position:{x:y.x-h.x,y:y.y-h.y},positionAbsolute:y}}function Yp({nodeId:e,dragItems:n,nodeInternals:s}){const i=n.map(l=>({...s.get(l.id),position:l.position,positionAbsolute:l.positionAbsolute}));return[e?i.find(l=>l.id===e):i[0],i]}const eN=(e,n,s,i)=>{const l=n.querySelectorAll(e);if(!l||!l.length)return null;const o=Array.from(l),d=n.getBoundingClientRect(),m={x:d.width*i[0],y:d.height*i[1]};return o.map(p=>{const h=p.getBoundingClientRect();return{id:p.getAttribute("data-handleid"),position:p.getAttribute("data-handlepos"),x:(h.left-d.left-m.x)/s,y:(h.top-d.top-m.y)/s,...Gg(p)}})};function sc(e,n,s){return s===void 0?s:i=>{const l=n().nodeInternals.get(e);l&&s(i,{...l})}}function Py({id:e,store:n,unselect:s=!1,nodeRef:i}){const{addSelectedNodes:l,unselectNodesAndEdges:o,multiSelectionActive:d,nodeInternals:m,onError:p}=n.getState(),h=m.get(e);if(!h){p?.("012",gr.error012(e));return}n.setState({nodesSelectionActive:!1}),h.selected?(s||h.selected&&d)&&(o({nodes:[h],edges:[]}),requestAnimationFrame(()=>i?.current?.blur())):l([e])}function cF(){const e=ra();return u.useCallback(({sourceEvent:s})=>{const{transform:i,snapGrid:l,snapToGrid:o}=e.getState(),d=s.touches?s.touches[0].clientX:s.clientX,m=s.touches?s.touches[0].clientY:s.clientY,p={x:(d-i[0])/i[2],y:(m-i[1])/i[2]};return{xSnapped:o?l[0]*Math.round(p.x/l[0]):p.x,ySnapped:o?l[1]*Math.round(p.y/l[1]):p.y,...p}},[])}function Gp(e){return(n,s,i)=>e?.(n,i)}function KE({nodeRef:e,disabled:n=!1,noDragClassName:s,handleSelector:i,nodeId:l,isSelectable:o,selectNodesOnDrag:d}){const m=ra(),[p,h]=u.useState(!1),y=u.useRef([]),g=u.useRef({x:null,y:null}),x=u.useRef(0),v=u.useRef(null),S=u.useRef({x:0,y:0}),N=u.useRef(null),E=u.useRef(!1),j=u.useRef(!1),A=u.useRef(!1),T=cF();return u.useEffect(()=>{if(e?.current){const _=ls(e.current),M=({x:D,y:z})=>{const{nodeInternals:G,onNodeDrag:U,onSelectionDrag:X,updateNodePositions:V,nodeExtent:R,snapGrid:B,snapToGrid:L,nodeOrigin:O,onError:$}=m.getState();g.current={x:D,y:z};let F=!1,H={x:0,y:0,x2:0,y2:0};if(y.current.length>1&&R){const Y=Hf(y.current,O);H=Lc(Y)}if(y.current=y.current.map(Y=>{const P={x:D-Y.distance.x,y:z-Y.distance.y};L&&(P.x=B[0]*Math.round(P.x/B[0]),P.y=B[1]*Math.round(P.y/B[1]));const K=[[R[0][0],R[0][1]],[R[1][0],R[1][1]]];y.current.length>1&&R&&!Y.extent&&(K[0][0]=Y.positionAbsolute.x-H.x+R[0][0],K[1][0]=Y.positionAbsolute.x+(Y.width??0)-H.x2+R[1][0],K[0][1]=Y.positionAbsolute.y-H.y+R[0][1],K[1][1]=Y.positionAbsolute.y+(Y.height??0)-H.y2+R[1][1]);const re=GE(Y,P,G,K,O,$);return F=F||Y.position.x!==re.position.x||Y.position.y!==re.position.y,Y.position=re.position,Y.positionAbsolute=re.positionAbsolute,Y}),!F)return;V(y.current,!0,!0),h(!0);const I=l?U:Gp(X);if(I&&N.current){const[Y,P]=Yp({nodeId:l,dragItems:y.current,nodeInternals:G});I(N.current,Y,P)}},k=()=>{if(!v.current)return;const[D,z]=hE(S.current,v.current);if(D!==0||z!==0){const{transform:G,panBy:U}=m.getState();g.current.x=(g.current.x??0)-D/G[2],g.current.y=(g.current.y??0)-z/G[2],U({x:D,y:z})&&M(g.current)}x.current=requestAnimationFrame(k)},C=D=>{const{nodeInternals:z,multiSelectionActive:G,nodesDraggable:U,unselectNodesAndEdges:X,onNodeDragStart:V,onSelectionDragStart:R}=m.getState();j.current=!0;const B=l?V:Gp(R);(!d||!o)&&!G&&l&&(z.get(l)?.selected||X()),l&&o&&d&&Py({id:l,store:m,nodeRef:e});const L=T(D);if(g.current=L,y.current=lF(z,U,L,l),B&&y.current){const[O,$]=Yp({nodeId:l,dragItems:y.current,nodeInternals:z});B(D.sourceEvent,O,$)}};if(n)_.on(".drag",null);else{const D=v6().on("start",z=>{const{domNode:G,nodeDragThreshold:U}=m.getState();U===0&&C(z),A.current=!1;const X=T(z);g.current=X,v.current=G?.getBoundingClientRect()||null,S.current=Zr(z.sourceEvent,v.current)}).on("drag",z=>{const G=T(z),{autoPanOnNodeDrag:U,nodeDragThreshold:X}=m.getState();if(z.sourceEvent.type==="touchmove"&&z.sourceEvent.touches.length>1&&(A.current=!0),!A.current){if(!E.current&&j.current&&U&&(E.current=!0,k()),!j.current){const V=G.xSnapped-(g?.current?.x??0),R=G.ySnapped-(g?.current?.y??0);Math.sqrt(V*V+R*R)>X&&C(z)}(g.current.x!==G.xSnapped||g.current.y!==G.ySnapped)&&y.current&&j.current&&(N.current=z.sourceEvent,S.current=Zr(z.sourceEvent,v.current),M(G))}}).on("end",z=>{if(!(!j.current||A.current)&&(h(!1),E.current=!1,j.current=!1,cancelAnimationFrame(x.current),y.current)){const{updateNodePositions:G,nodeInternals:U,onNodeDragStop:X,onSelectionDragStop:V}=m.getState(),R=l?X:Gp(V);if(G(y.current,!1,!1),R){const[B,L]=Yp({nodeId:l,dragItems:y.current,nodeInternals:U});R(z.sourceEvent,B,L)}}}).filter(z=>{const G=z.target;return!z.button&&(!s||!Jw(G,`.${s}`,e))&&(!i||Jw(G,i,e))});return _.call(D),()=>{_.on(".drag",null)}}}},[e,n,s,i,o,m,l,d,T]),p}function XE(){const e=ra();return u.useCallback(s=>{const{nodeInternals:i,nodeExtent:l,updateNodePositions:o,getNodes:d,snapToGrid:m,snapGrid:p,onError:h,nodesDraggable:y}=e.getState(),g=d().filter(A=>A.selected&&(A.draggable||y&&typeof A.draggable>"u")),x=m?p[0]:5,v=m?p[1]:5,S=s.isShiftPressed?4:1,N=s.x*x*S,E=s.y*v*S,j=g.map(A=>{if(A.positionAbsolute){const T={x:A.positionAbsolute.x+N,y:A.positionAbsolute.y+E};m&&(T.x=p[0]*Math.round(T.x/p[0]),T.y=p[1]*Math.round(T.y/p[1]));const{positionAbsolute:_,position:M}=GE(A,T,i,l,void 0,h);A.position=M,A.positionAbsolute=_}return A});o(j,!0,!1)},[])}const zl={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var rc=e=>{const n=({id:s,type:i,data:l,xPos:o,yPos:d,xPosOrigin:m,yPosOrigin:p,selected:h,onClick:y,onMouseEnter:g,onMouseMove:x,onMouseLeave:v,onContextMenu:S,onDoubleClick:N,style:E,className:j,isDraggable:A,isSelectable:T,isConnectable:_,isFocusable:M,selectNodesOnDrag:k,sourcePosition:C,targetPosition:D,hidden:z,resizeObserver:G,dragHandle:U,zIndex:X,isParent:V,noDragClassName:R,noPanClassName:B,initialized:L,disableKeyboardA11y:O,ariaLabel:$,rfId:F,hasHandleBounds:H})=>{const I=ra(),Y=u.useRef(null),P=u.useRef(null),K=u.useRef(C),re=u.useRef(D),W=u.useRef(i),ue=T||A||y||g||x||v,Q=XE(),ye=sc(s,I.getState,g),ae=sc(s,I.getState,x),ke=sc(s,I.getState,v),pe=sc(s,I.getState,S),we=sc(s,I.getState,N),ne=Oe=>{const{nodeDragThreshold:Me}=I.getState();if(T&&(!k||!A||Me>0)&&Py({id:s,store:I,nodeRef:Y}),y){const ut=I.getState().nodeInternals.get(s);ut&&y(Oe,{...ut})}},Le=Oe=>{if(!zy(Oe)&&!O)if(bE.includes(Oe.key)&&T){const Me=Oe.key==="Escape";Py({id:s,store:I,unselect:Me,nodeRef:Y})}else A&&h&&Object.prototype.hasOwnProperty.call(zl,Oe.key)&&(I.setState({ariaLiveMessage:`Moved selected node ${Oe.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~o}, y: ${~~d}`}),Q({x:zl[Oe.key].x,y:zl[Oe.key].y,isShiftPressed:Oe.shiftKey}))};u.useEffect(()=>()=>{P.current&&(G?.unobserve(P.current),P.current=null)},[]),u.useEffect(()=>{if(Y.current&&!z){const Oe=Y.current;(!L||!H||P.current!==Oe)&&(P.current&&G?.unobserve(P.current),G?.observe(Oe),P.current=Oe)}},[z,L,H]),u.useEffect(()=>{const Oe=W.current!==i,Me=K.current!==C,ut=re.current!==D;Y.current&&(Oe||Me||ut)&&(Oe&&(W.current=i),Me&&(K.current=C),ut&&(re.current=D),I.getState().updateNodeDimensions([{id:s,nodeElement:Y.current,forceUpdate:!0}]))},[s,i,C,D]);const be=KE({nodeRef:Y,disabled:z||!A,noDragClassName:R,handleSelector:U,nodeId:s,isSelectable:T,selectNodesOnDrag:k});return z?null:Ve.createElement("div",{className:ma(["react-flow__node",`react-flow__node-${i}`,{[B]:A},j,{selected:h,selectable:T,parent:V,dragging:be}]),ref:Y,style:{zIndex:X,transform:`translate(${m}px,${p}px)`,pointerEvents:ue?"all":"none",visibility:L?"visible":"hidden",...E},"data-id":s,"data-testid":`rf__node-${s}`,onMouseEnter:ye,onMouseMove:ae,onMouseLeave:ke,onContextMenu:pe,onClick:ne,onDoubleClick:we,onKeyDown:M?Le:void 0,tabIndex:M?0:void 0,role:M?"button":void 0,"aria-describedby":O?void 0:`${FE}-${F}`,"aria-label":$},Ve.createElement(N$,{value:s},Ve.createElement(e,{id:s,data:l,type:i,xPos:o,yPos:d,selected:h,isConnectable:_,sourcePosition:C,targetPosition:D,dragging:be,dragHandle:U,zIndex:X})))};return n.displayName="NodeWrapper",u.memo(n)};const uF=e=>{const n=e.getNodes().filter(s=>s.selected);return{...Hf(n,e.nodeOrigin),transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`,userSelectionActive:e.userSelectionActive}};function dF({onSelectionContextMenu:e,noPanClassName:n,disableKeyboardA11y:s}){const i=ra(),{width:l,height:o,x:d,y:m,transformString:p,userSelectionActive:h}=Ln(uF,la),y=XE(),g=u.useRef(null);if(u.useEffect(()=>{s||g.current?.focus({preventScroll:!0})},[s]),KE({nodeRef:g}),h||!l||!o)return null;const x=e?S=>{const N=i.getState().getNodes().filter(E=>E.selected);e(S,N)}:void 0,v=S=>{Object.prototype.hasOwnProperty.call(zl,S.key)&&y({x:zl[S.key].x,y:zl[S.key].y,isShiftPressed:S.shiftKey})};return Ve.createElement("div",{className:ma(["react-flow__nodesselection","react-flow__container",n]),style:{transform:p}},Ve.createElement("div",{ref:g,className:"react-flow__nodesselection-rect",onContextMenu:x,tabIndex:s?void 0:-1,onKeyDown:s?void 0:v,style:{width:l,height:o,top:m,left:d}}))}var fF=u.memo(dF);const mF=e=>e.nodesSelectionActive,WE=({children:e,onPaneClick:n,onPaneMouseEnter:s,onPaneMouseMove:i,onPaneMouseLeave:l,onPaneContextMenu:o,onPaneScroll:d,deleteKeyCode:m,onMove:p,onMoveStart:h,onMoveEnd:y,selectionKeyCode:g,selectionOnDrag:x,selectionMode:v,onSelectionStart:S,onSelectionEnd:N,multiSelectionKeyCode:E,panActivationKeyCode:j,zoomActivationKeyCode:A,elementsSelectable:T,zoomOnScroll:_,zoomOnPinch:M,panOnScroll:k,panOnScrollSpeed:C,panOnScrollMode:D,zoomOnDoubleClick:z,panOnDrag:G,defaultViewport:U,translateExtent:X,minZoom:V,maxZoom:R,preventScrolling:B,onSelectionContextMenu:L,noWheelClassName:O,noPanClassName:$,disableKeyboardA11y:F})=>{const H=Ln(mF),I=$c(g),Y=$c(j),P=Y||G,K=Y||k,re=I||x&&P!==!0;return Q$({deleteKeyCode:m,multiSelectionKeyCode:E}),Ve.createElement(nF,{onMove:p,onMoveStart:h,onMoveEnd:y,onPaneContextMenu:o,elementsSelectable:T,zoomOnScroll:_,zoomOnPinch:M,panOnScroll:K,panOnScrollSpeed:C,panOnScrollMode:D,zoomOnDoubleClick:z,panOnDrag:!I&&P,defaultViewport:U,translateExtent:X,minZoom:V,maxZoom:R,zoomActivationKeyCode:A,preventScrolling:B,noWheelClassName:O,noPanClassName:$},Ve.createElement(VE,{onSelectionStart:S,onSelectionEnd:N,onPaneClick:n,onPaneMouseEnter:s,onPaneMouseMove:i,onPaneMouseLeave:l,onPaneContextMenu:o,onPaneScroll:d,panOnDrag:P,isSelecting:!!re,selectionMode:v},e,H&&Ve.createElement(fF,{onSelectionContextMenu:L,noPanClassName:$,disableKeyboardA11y:F})))};WE.displayName="FlowRenderer";var hF=u.memo(WE);function pF(e){return Ln(u.useCallback(s=>e?EE(s.nodeInternals,{x:0,y:0,width:s.width,height:s.height},s.transform,!0):s.getNodes(),[e]))}function yF(e){const n={input:rc(e.input||DE),default:rc(e.default||qy),output:rc(e.output||OE),group:rc(e.group||eb)},s={},i=Object.keys(e).filter(l=>!["input","default","output","group"].includes(l)).reduce((l,o)=>(l[o]=rc(e[o]||qy),l),s);return{...n,...i}}const gF=({x:e,y:n,width:s,height:i,origin:l})=>!s||!i?{x:e,y:n}:l[0]<0||l[1]<0||l[0]>1||l[1]>1?{x:e,y:n}:{x:e-s*l[0],y:n-i*l[1]},bF=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions,onError:e.onError}),ZE=e=>{const{nodesDraggable:n,nodesConnectable:s,nodesFocusable:i,elementsSelectable:l,updateNodeDimensions:o,onError:d}=Ln(bF,la),m=pF(e.onlyRenderVisibleElements),p=u.useRef(),h=u.useMemo(()=>{if(typeof ResizeObserver>"u")return null;const y=new ResizeObserver(g=>{const x=g.map(v=>({id:v.target.getAttribute("data-id"),nodeElement:v.target,forceUpdate:!0}));o(x)});return p.current=y,y},[]);return u.useEffect(()=>()=>{p?.current?.disconnect()},[]),Ve.createElement("div",{className:"react-flow__nodes",style:tb},m.map(y=>{let g=y.type||"default";e.nodeTypes[g]||(d?.("003",gr.error003(g)),g="default");const x=e.nodeTypes[g]||e.nodeTypes.default,v=!!(y.draggable||n&&typeof y.draggable>"u"),S=!!(y.selectable||l&&typeof y.selectable>"u"),N=!!(y.connectable||s&&typeof y.connectable>"u"),E=!!(y.focusable||i&&typeof y.focusable>"u"),j=e.nodeExtent?Kg(y.positionAbsolute,e.nodeExtent):y.positionAbsolute,A=j?.x??0,T=j?.y??0,_=gF({x:A,y:T,width:y.width??0,height:y.height??0,origin:e.nodeOrigin});return Ve.createElement(x,{key:y.id,id:y.id,className:y.className,style:y.style,type:g,data:y.data,sourcePosition:y.sourcePosition||Kt.Bottom,targetPosition:y.targetPosition||Kt.Top,hidden:y.hidden,xPos:A,yPos:T,xPosOrigin:_.x,yPosOrigin:_.y,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!y.selected,isDraggable:v,isSelectable:S,isConnectable:N,isFocusable:E,resizeObserver:h,dragHandle:y.dragHandle,zIndex:y[Vn]?.z??0,isParent:!!y[Vn]?.isParent,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!y.width&&!!y.height,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,ariaLabel:y.ariaLabel,hasHandleBounds:!!y[Vn]?.handleBounds})}))};ZE.displayName="NodeRenderer";var xF=u.memo(ZE);const vF=(e,n,s)=>s===Kt.Left?e-n:s===Kt.Right?e+n:e,SF=(e,n,s)=>s===Kt.Top?e-n:s===Kt.Bottom?e+n:e,tN="react-flow__edgeupdater",nN=({position:e,centerX:n,centerY:s,radius:i=10,onMouseDown:l,onMouseEnter:o,onMouseOut:d,type:m})=>Ve.createElement("circle",{onMouseDown:l,onMouseEnter:o,onMouseOut:d,className:ma([tN,`${tN}-${m}`]),cx:vF(n,i,e),cy:SF(s,i,e),r:i,stroke:"transparent",fill:"transparent"}),wF=()=>!0;var kl=e=>{const n=({id:s,className:i,type:l,data:o,onClick:d,onEdgeDoubleClick:m,selected:p,animated:h,label:y,labelStyle:g,labelShowBg:x,labelBgStyle:v,labelBgPadding:S,labelBgBorderRadius:N,style:E,source:j,target:A,sourceX:T,sourceY:_,targetX:M,targetY:k,sourcePosition:C,targetPosition:D,elementsSelectable:z,hidden:G,sourceHandleId:U,targetHandleId:X,onContextMenu:V,onMouseEnter:R,onMouseMove:B,onMouseLeave:L,reconnectRadius:O,onReconnect:$,onReconnectStart:F,onReconnectEnd:H,markerEnd:I,markerStart:Y,rfId:P,ariaLabel:K,isFocusable:re,isReconnectable:W,pathOptions:ue,interactionWidth:Q,disableKeyboardA11y:ye})=>{const ae=u.useRef(null),[ke,pe]=u.useState(!1),[we,ne]=u.useState(!1),Le=ra(),be=u.useMemo(()=>`url('#${By(Y,P)}')`,[Y,P]),Oe=u.useMemo(()=>`url('#${By(I,P)}')`,[I,P]);if(G)return null;const Me=le=>{const{edges:fe,addSelectedEdges:Ue,unselectNodesAndEdges:qe,multiSelectionActive:ze}=Le.getState(),Ce=fe.find(pt=>pt.id===s);Ce&&(z&&(Le.setState({nodesSelectionActive:!1}),Ce.selected&&ze?(qe({nodes:[],edges:[Ce]}),ae.current?.blur()):Ue([s])),d&&d(le,Ce))},ut=ac(s,Le.getState,m),ht=ac(s,Le.getState,V),_t=ac(s,Le.getState,R),jt=ac(s,Le.getState,B),ve=ac(s,Le.getState,L),tt=(le,fe)=>{if(le.button!==0)return;const{edges:Ue,isValidConnection:qe}=Le.getState(),ze=fe?A:j,Ce=(fe?X:U)||null,pt=fe?"target":"source",bt=qe||wF,Ct=fe,Ze=Ue.find($t=>$t.id===s);ne(!0),F?.(le,Ze,pt);const ot=$t=>{ne(!1),H?.($t,Ze,pt)};ME({event:le,handleId:Ce,nodeId:ze,onConnect:$t=>$?.(Ze,$t),isTarget:Ct,getState:Le.getState,setState:Le.setState,isValidConnection:bt,edgeUpdaterType:pt,onReconnectEnd:ot})},st=le=>tt(le,!0),$e=le=>tt(le,!1),Ye=()=>pe(!0),mt=()=>pe(!1),ie=!z&&!d,J=le=>{if(!ye&&bE.includes(le.key)&&z){const{unselectNodesAndEdges:fe,addSelectedEdges:Ue,edges:qe}=Le.getState();le.key==="Escape"?(ae.current?.blur(),fe({edges:[qe.find(Ce=>Ce.id===s)]})):Ue([s])}};return Ve.createElement("g",{className:ma(["react-flow__edge",`react-flow__edge-${l}`,i,{selected:p,animated:h,inactive:ie,updating:ke}]),onClick:Me,onDoubleClick:ut,onContextMenu:ht,onMouseEnter:_t,onMouseMove:jt,onMouseLeave:ve,onKeyDown:re?J:void 0,tabIndex:re?0:void 0,role:re?"button":"img","data-testid":`rf__edge-${s}`,"aria-label":K===null?void 0:K||`Edge from ${j} to ${A}`,"aria-describedby":re?`${zE}-${P}`:void 0,ref:ae},!we&&Ve.createElement(e,{id:s,source:j,target:A,selected:p,animated:h,label:y,labelStyle:g,labelShowBg:x,labelBgStyle:v,labelBgPadding:S,labelBgBorderRadius:N,data:o,style:E,sourceX:T,sourceY:_,targetX:M,targetY:k,sourcePosition:C,targetPosition:D,sourceHandleId:U,targetHandleId:X,markerStart:be,markerEnd:Oe,pathOptions:ue,interactionWidth:Q}),W&&Ve.createElement(Ve.Fragment,null,(W==="source"||W===!0)&&Ve.createElement(nN,{position:C,centerX:T,centerY:_,radius:O,onMouseDown:st,onMouseEnter:Ye,onMouseOut:mt,type:"source"}),(W==="target"||W===!0)&&Ve.createElement(nN,{position:D,centerX:M,centerY:k,radius:O,onMouseDown:$e,onMouseEnter:Ye,onMouseOut:mt,type:"target"})))};return n.displayName="EdgeWrapper",u.memo(n)};function NF(e){const n={default:kl(e.default||ff),straight:kl(e.bezier||Zg),step:kl(e.step||Wg),smoothstep:kl(e.step||Pf),simplebezier:kl(e.simplebezier||Xg)},s={},i=Object.keys(e).filter(l=>!["default","bezier"].includes(l)).reduce((l,o)=>(l[o]=kl(e[o]||ff),l),s);return{...n,...i}}function aN(e,n,s=null){const i=(s?.x||0)+n.x,l=(s?.y||0)+n.y,o=s?.width||n.width,d=s?.height||n.height;switch(e){case Kt.Top:return{x:i+o/2,y:l};case Kt.Right:return{x:i+o,y:l+d/2};case Kt.Bottom:return{x:i+o/2,y:l+d};case Kt.Left:return{x:i,y:l+d/2}}}function sN(e,n){return e?e.length===1||!n?e[0]:n&&e.find(s=>s.id===n)||null:null}const jF=(e,n,s,i,l,o)=>{const d=aN(s,e,n),m=aN(o,i,l);return{sourceX:d.x,sourceY:d.y,targetX:m.x,targetY:m.y}};function EF({sourcePos:e,targetPos:n,sourceWidth:s,sourceHeight:i,targetWidth:l,targetHeight:o,width:d,height:m,transform:p}){const h={x:Math.min(e.x,n.x),y:Math.min(e.y,n.y),x2:Math.max(e.x+s,n.x+l),y2:Math.max(e.y+i,n.y+o)};h.x===h.x2&&(h.x2+=1),h.y===h.y2&&(h.y2+=1);const y=Lc({x:(0-p[0])/p[2],y:(0-p[1])/p[2],width:d/p[2],height:m/p[2]}),g=Math.max(0,Math.min(y.x2,h.x2)-Math.max(y.x,h.x)),x=Math.max(0,Math.min(y.y2,h.y2)-Math.max(y.y,h.y));return Math.ceil(g*x)>0}function rN(e){const n=e?.[Vn]?.handleBounds||null,s=n&&e?.width&&e?.height&&typeof e?.positionAbsolute?.x<"u"&&typeof e?.positionAbsolute?.y<"u";return[{x:e?.positionAbsolute?.x||0,y:e?.positionAbsolute?.y||0,width:e?.width||0,height:e?.height||0},n,!!s]}const _F=[{level:0,isMaxLevel:!0,edges:[]}];function CF(e,n,s=!1){let i=-1;const l=e.reduce((d,m)=>{const p=cs(m.zIndex);let h=p?m.zIndex:0;if(s){const y=n.get(m.target),g=n.get(m.source),x=m.selected||y?.selected||g?.selected,v=Math.max(g?.[Vn]?.z||0,y?.[Vn]?.z||0,1e3);h=(p?m.zIndex:0)+(x?v:0)}return d[h]?d[h].push(m):d[h]=[m],i=h>i?h:i,d},{}),o=Object.entries(l).map(([d,m])=>{const p=+d;return{edges:m,level:p,isMaxLevel:p===i}});return o.length===0?_F:o}function AF(e,n,s){const i=Ln(u.useCallback(l=>e?l.edges.filter(o=>{const d=n.get(o.source),m=n.get(o.target);return d?.width&&d?.height&&m?.width&&m?.height&&EF({sourcePos:d.positionAbsolute||{x:0,y:0},targetPos:m.positionAbsolute||{x:0,y:0},sourceWidth:d.width,sourceHeight:d.height,targetWidth:m.width,targetHeight:m.height,width:l.width,height:l.height,transform:l.transform})}):l.edges,[e,n]));return CF(i,n,s)}const TF=({color:e="none",strokeWidth:n=1})=>Ve.createElement("polyline",{style:{stroke:e,strokeWidth:n},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),MF=({color:e="none",strokeWidth:n=1})=>Ve.createElement("polyline",{style:{stroke:e,fill:e,strokeWidth:n},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),iN={[uf.Arrow]:TF,[uf.ArrowClosed]:MF};function kF(e){const n=ra();return u.useMemo(()=>Object.prototype.hasOwnProperty.call(iN,e)?iN[e]:(n.getState().onError?.("009",gr.error009(e)),null),[e])}const RF=({id:e,type:n,color:s,width:i=12.5,height:l=12.5,markerUnits:o="strokeWidth",strokeWidth:d,orient:m="auto-start-reverse"})=>{const p=kF(n);return p?Ve.createElement("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${i}`,markerHeight:`${l}`,viewBox:"-10 -10 20 20",markerUnits:o,orient:m,refX:"0",refY:"0"},Ve.createElement(p,{color:s,strokeWidth:d})):null},IF=({defaultColor:e,rfId:n})=>s=>{const i=[];return s.edges.reduce((l,o)=>([o.markerStart,o.markerEnd].forEach(d=>{if(d&&typeof d=="object"){const m=By(d,n);i.includes(m)||(l.push({id:m,color:d.color||e,...d}),i.push(m))}}),l),[]).sort((l,o)=>l.id.localeCompare(o.id))},QE=({defaultColor:e,rfId:n})=>{const s=Ln(u.useCallback(IF({defaultColor:e,rfId:n}),[e,n]),(i,l)=>!(i.length!==l.length||i.some((o,d)=>o.id!==l[d].id)));return Ve.createElement("defs",null,s.map(i=>Ve.createElement(RF,{id:i.id,key:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient})))};QE.displayName="MarkerDefinitions";var DF=u.memo(QE);const LF=e=>({nodesConnectable:e.nodesConnectable,edgesFocusable:e.edgesFocusable,edgesUpdatable:e.edgesUpdatable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals,onError:e.onError}),JE=({defaultMarkerColor:e,onlyRenderVisibleElements:n,elevateEdgesOnSelect:s,rfId:i,edgeTypes:l,noPanClassName:o,onEdgeContextMenu:d,onEdgeMouseEnter:m,onEdgeMouseMove:p,onEdgeMouseLeave:h,onEdgeClick:y,onEdgeDoubleClick:g,onReconnect:x,onReconnectStart:v,onReconnectEnd:S,reconnectRadius:N,children:E,disableKeyboardA11y:j})=>{const{edgesFocusable:A,edgesUpdatable:T,elementsSelectable:_,width:M,height:k,connectionMode:C,nodeInternals:D,onError:z}=Ln(LF,la),G=AF(n,D,s);return M?Ve.createElement(Ve.Fragment,null,G.map(({level:U,edges:X,isMaxLevel:V})=>Ve.createElement("svg",{key:U,style:{zIndex:U},width:M,height:k,className:"react-flow__edges react-flow__container"},V&&Ve.createElement(DF,{defaultColor:e,rfId:i}),Ve.createElement("g",null,X.map(R=>{const[B,L,O]=rN(D.get(R.source)),[$,F,H]=rN(D.get(R.target));if(!O||!H)return null;let I=R.type||"default";l[I]||(z?.("011",gr.error011(I)),I="default");const Y=l[I]||l.default,P=C===Fi.Strict?F.target:(F.target??[]).concat(F.source??[]),K=sN(L.source,R.sourceHandle),re=sN(P,R.targetHandle),W=K?.position||Kt.Bottom,ue=re?.position||Kt.Top,Q=!!(R.focusable||A&&typeof R.focusable>"u"),ye=R.reconnectable||R.updatable,ae=typeof x<"u"&&(ye||T&&typeof ye>"u");if(!K||!re)return z?.("008",gr.error008(K,R)),null;const{sourceX:ke,sourceY:pe,targetX:we,targetY:ne}=jF(B,K,W,$,re,ue);return Ve.createElement(Y,{key:R.id,id:R.id,className:ma([R.className,o]),type:I,data:R.data,selected:!!R.selected,animated:!!R.animated,hidden:!!R.hidden,label:R.label,labelStyle:R.labelStyle,labelShowBg:R.labelShowBg,labelBgStyle:R.labelBgStyle,labelBgPadding:R.labelBgPadding,labelBgBorderRadius:R.labelBgBorderRadius,style:R.style,source:R.source,target:R.target,sourceHandleId:R.sourceHandle,targetHandleId:R.targetHandle,markerEnd:R.markerEnd,markerStart:R.markerStart,sourceX:ke,sourceY:pe,targetX:we,targetY:ne,sourcePosition:W,targetPosition:ue,elementsSelectable:_,onContextMenu:d,onMouseEnter:m,onMouseMove:p,onMouseLeave:h,onClick:y,onEdgeDoubleClick:g,onReconnect:x,onReconnectStart:v,onReconnectEnd:S,reconnectRadius:N,rfId:i,ariaLabel:R.ariaLabel,isFocusable:Q,isReconnectable:ae,pathOptions:"pathOptions"in R?R.pathOptions:void 0,interactionWidth:R.interactionWidth,disableKeyboardA11y:j})})))),E):null};JE.displayName="EdgeRenderer";var OF=u.memo(JE);const $F=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function FF({children:e}){const n=Ln($F);return Ve.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:n}},e)}function zF(e){const n=Vf(),s=u.useRef(!1);u.useEffect(()=>{!s.current&&n.viewportInitialized&&e&&(setTimeout(()=>e(n),1),s.current=!0)},[e,n.viewportInitialized])}const BF={[Kt.Left]:Kt.Right,[Kt.Right]:Kt.Left,[Kt.Top]:Kt.Bottom,[Kt.Bottom]:Kt.Top},e_=({nodeId:e,handleType:n,style:s,type:i=Wr.Bezier,CustomComponent:l,connectionStatus:o})=>{const{fromNode:d,handleId:m,toX:p,toY:h,connectionMode:y}=Ln(u.useCallback(k=>({fromNode:k.nodeInternals.get(e),handleId:k.connectionHandleId,toX:(k.connectionPosition.x-k.transform[0])/k.transform[2],toY:(k.connectionPosition.y-k.transform[1])/k.transform[2],connectionMode:k.connectionMode}),[e]),la),g=d?.[Vn]?.handleBounds;let x=g?.[n];if(y===Fi.Loose&&(x=x||g?.[n==="source"?"target":"source"]),!d||!x)return null;const v=m?x.find(k=>k.id===m):x[0],S=v?v.x+v.width/2:(d.width??0)/2,N=v?v.y+v.height/2:d.height??0,E=(d.positionAbsolute?.x??0)+S,j=(d.positionAbsolute?.y??0)+N,A=v?.position,T=A?BF[A]:null;if(!A||!T)return null;if(l)return Ve.createElement(l,{connectionLineType:i,connectionLineStyle:s,fromNode:d,fromHandle:v,fromX:E,fromY:j,toX:p,toY:h,fromPosition:A,toPosition:T,connectionStatus:o});let _="";const M={sourceX:E,sourceY:j,sourcePosition:A,targetX:p,targetY:h,targetPosition:T};return i===Wr.Bezier?[_]=NE(M):i===Wr.Step?[_]=df({...M,borderRadius:0}):i===Wr.SmoothStep?[_]=df(M):i===Wr.SimpleBezier?[_]=wE(M):_=`M${E},${j} ${p},${h}`,Ve.createElement("path",{d:_,fill:"none",className:"react-flow__connection-path",style:s})};e_.displayName="ConnectionLine";const UF=e=>({nodeId:e.connectionNodeId,handleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,connectionStatus:e.connectionStatus,width:e.width,height:e.height});function qF({containerStyle:e,style:n,type:s,component:i}){const{nodeId:l,handleType:o,nodesConnectable:d,width:m,height:p,connectionStatus:h}=Ln(UF,la);return!(l&&o&&m&&d)?null:Ve.createElement("svg",{style:e,width:m,height:p,className:"react-flow__edges react-flow__connectionline react-flow__container"},Ve.createElement("g",{className:ma(["react-flow__connection",h])},Ve.createElement(e_,{nodeId:l,handleType:o,style:n,type:s,CustomComponent:i,connectionStatus:h})))}function lN(e,n){return u.useRef(null),ra(),u.useMemo(()=>n(e),[e])}const t_=({nodeTypes:e,edgeTypes:n,onMove:s,onMoveStart:i,onMoveEnd:l,onInit:o,onNodeClick:d,onEdgeClick:m,onNodeDoubleClick:p,onEdgeDoubleClick:h,onNodeMouseEnter:y,onNodeMouseMove:g,onNodeMouseLeave:x,onNodeContextMenu:v,onSelectionContextMenu:S,onSelectionStart:N,onSelectionEnd:E,connectionLineType:j,connectionLineStyle:A,connectionLineComponent:T,connectionLineContainerStyle:_,selectionKeyCode:M,selectionOnDrag:k,selectionMode:C,multiSelectionKeyCode:D,panActivationKeyCode:z,zoomActivationKeyCode:G,deleteKeyCode:U,onlyRenderVisibleElements:X,elementsSelectable:V,selectNodesOnDrag:R,defaultViewport:B,translateExtent:L,minZoom:O,maxZoom:$,preventScrolling:F,defaultMarkerColor:H,zoomOnScroll:I,zoomOnPinch:Y,panOnScroll:P,panOnScrollSpeed:K,panOnScrollMode:re,zoomOnDoubleClick:W,panOnDrag:ue,onPaneClick:Q,onPaneMouseEnter:ye,onPaneMouseMove:ae,onPaneMouseLeave:ke,onPaneScroll:pe,onPaneContextMenu:we,onEdgeContextMenu:ne,onEdgeMouseEnter:Le,onEdgeMouseMove:be,onEdgeMouseLeave:Oe,onReconnect:Me,onReconnectStart:ut,onReconnectEnd:ht,reconnectRadius:_t,noDragClassName:jt,noWheelClassName:ve,noPanClassName:tt,elevateEdgesOnSelect:st,disableKeyboardA11y:$e,nodeOrigin:Ye,nodeExtent:mt,rfId:ie})=>{const J=lN(e,yF),le=lN(n,NF);return zF(o),Ve.createElement(hF,{onPaneClick:Q,onPaneMouseEnter:ye,onPaneMouseMove:ae,onPaneMouseLeave:ke,onPaneContextMenu:we,onPaneScroll:pe,deleteKeyCode:U,selectionKeyCode:M,selectionOnDrag:k,selectionMode:C,onSelectionStart:N,onSelectionEnd:E,multiSelectionKeyCode:D,panActivationKeyCode:z,zoomActivationKeyCode:G,elementsSelectable:V,onMove:s,onMoveStart:i,onMoveEnd:l,zoomOnScroll:I,zoomOnPinch:Y,zoomOnDoubleClick:W,panOnScroll:P,panOnScrollSpeed:K,panOnScrollMode:re,panOnDrag:ue,defaultViewport:B,translateExtent:L,minZoom:O,maxZoom:$,onSelectionContextMenu:S,preventScrolling:F,noDragClassName:jt,noWheelClassName:ve,noPanClassName:tt,disableKeyboardA11y:$e},Ve.createElement(FF,null,Ve.createElement(OF,{edgeTypes:le,onEdgeClick:m,onEdgeDoubleClick:h,onlyRenderVisibleElements:X,onEdgeContextMenu:ne,onEdgeMouseEnter:Le,onEdgeMouseMove:be,onEdgeMouseLeave:Oe,onReconnect:Me,onReconnectStart:ut,onReconnectEnd:ht,reconnectRadius:_t,defaultMarkerColor:H,noPanClassName:tt,elevateEdgesOnSelect:!!st,disableKeyboardA11y:$e,rfId:ie},Ve.createElement(qF,{style:A,type:j,component:T,containerStyle:_})),Ve.createElement("div",{className:"react-flow__edgelabel-renderer"}),Ve.createElement(xF,{nodeTypes:J,onNodeClick:d,onNodeDoubleClick:p,onNodeMouseEnter:y,onNodeMouseMove:g,onNodeMouseLeave:x,onNodeContextMenu:v,selectNodesOnDrag:R,onlyRenderVisibleElements:X,noPanClassName:tt,noDragClassName:jt,disableKeyboardA11y:$e,nodeOrigin:Ye,nodeExtent:mt,rfId:ie})))};t_.displayName="GraphView";var PF=u.memo(t_);const Hy=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Pr={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:Hy,nodeExtent:Hy,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:Fi.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:g$,isValidConnection:void 0},HF=()=>R5((e,n)=>({...Pr,setNodes:s=>{const{nodeInternals:i,nodeOrigin:l,elevateNodesOnSelect:o}=n();e({nodeInternals:Hp(s,i,l,o)})},getNodes:()=>Array.from(n().nodeInternals.values()),setEdges:s=>{const{defaultEdgeOptions:i={}}=n();e({edges:s.map(l=>({...i,...l}))})},setDefaultNodesAndEdges:(s,i)=>{const l=typeof s<"u",o=typeof i<"u",d=l?Hp(s,new Map,n().nodeOrigin,n().elevateNodesOnSelect):new Map;e({nodeInternals:d,edges:o?i:[],hasDefaultNodes:l,hasDefaultEdges:o})},updateNodeDimensions:s=>{const{onNodesChange:i,nodeInternals:l,fitViewOnInit:o,fitViewOnInitDone:d,fitViewOnInitOptions:m,domNode:p,nodeOrigin:h}=n(),y=p?.querySelector(".react-flow__viewport");if(!y)return;const g=window.getComputedStyle(y),{m22:x}=new window.DOMMatrixReadOnly(g.transform),v=s.reduce((N,E)=>{const j=l.get(E.id);if(j?.hidden)l.set(j.id,{...j,[Vn]:{...j[Vn],handleBounds:void 0}});else if(j){const A=Gg(E.nodeElement);!!(A.width&&A.height&&(j.width!==A.width||j.height!==A.height||E.forceUpdate))&&(l.set(j.id,{...j,[Vn]:{...j[Vn],handleBounds:{source:eN(".source",E.nodeElement,x,h),target:eN(".target",E.nodeElement,x,h)}},...A}),N.push({id:j.id,type:"dimensions",dimensions:A}))}return N},[]);UE(l,h);const S=d||o&&!d&&qE(n,{initial:!0,...m});e({nodeInternals:new Map(l),fitViewOnInitDone:S}),v?.length>0&&i?.(v)},updateNodePositions:(s,i=!0,l=!1)=>{const{triggerNodeChanges:o}=n(),d=s.map(m=>{const p={id:m.id,type:"position",dragging:l};return i&&(p.positionAbsolute=m.positionAbsolute,p.position=m.position),p});o(d)},triggerNodeChanges:s=>{const{onNodesChange:i,nodeInternals:l,hasDefaultNodes:o,nodeOrigin:d,getNodes:m,elevateNodesOnSelect:p}=n();if(s?.length){if(o){const h=HE(s,m()),y=Hp(h,l,d,p);e({nodeInternals:y})}i?.(s)}},addSelectedNodes:s=>{const{multiSelectionActive:i,edges:l,getNodes:o}=n();let d,m=null;i?d=s.map(p=>Gr(p,!0)):(d=Dl(o(),s),m=Dl(l,[])),jd({changedNodes:d,changedEdges:m,get:n,set:e})},addSelectedEdges:s=>{const{multiSelectionActive:i,edges:l,getNodes:o}=n();let d,m=null;i?d=s.map(p=>Gr(p,!0)):(d=Dl(l,s),m=Dl(o(),[])),jd({changedNodes:m,changedEdges:d,get:n,set:e})},unselectNodesAndEdges:({nodes:s,edges:i}={})=>{const{edges:l,getNodes:o}=n(),d=s||o(),m=i||l,p=d.map(y=>(y.selected=!1,Gr(y.id,!1))),h=m.map(y=>Gr(y.id,!1));jd({changedNodes:p,changedEdges:h,get:n,set:e})},setMinZoom:s=>{const{d3Zoom:i,maxZoom:l}=n();i?.scaleExtent([s,l]),e({minZoom:s})},setMaxZoom:s=>{const{d3Zoom:i,minZoom:l}=n();i?.scaleExtent([l,s]),e({maxZoom:s})},setTranslateExtent:s=>{n().d3Zoom?.translateExtent(s),e({translateExtent:s})},resetSelectedElements:()=>{const{edges:s,getNodes:i}=n(),o=i().filter(m=>m.selected).map(m=>Gr(m.id,!1)),d=s.filter(m=>m.selected).map(m=>Gr(m.id,!1));jd({changedNodes:o,changedEdges:d,get:n,set:e})},setNodeExtent:s=>{const{nodeInternals:i}=n();i.forEach(l=>{l.positionAbsolute=Kg(l.position,s)}),e({nodeExtent:s,nodeInternals:new Map(i)})},panBy:s=>{const{transform:i,width:l,height:o,d3Zoom:d,d3Selection:m,translateExtent:p}=n();if(!d||!m||!s.x&&!s.y)return!1;const h=pr.translate(i[0]+s.x,i[1]+s.y).scale(i[2]),y=[[0,0],[l,o]],g=d?.constrain()(h,y,p);return d.transform(m,g),i[0]!==g.x||i[1]!==g.y||i[2]!==g.k},cancelConnection:()=>e({connectionNodeId:Pr.connectionNodeId,connectionHandleId:Pr.connectionHandleId,connectionHandleType:Pr.connectionHandleType,connectionStatus:Pr.connectionStatus,connectionStartHandle:Pr.connectionStartHandle,connectionEndHandle:Pr.connectionEndHandle}),reset:()=>e({...Pr})}),Object.is),n_=({children:e})=>{const n=u.useRef(null);return n.current||(n.current=HF()),Ve.createElement(u$,{value:n.current},e)};n_.displayName="ReactFlowProvider";const a_=({children:e})=>u.useContext(qf)?Ve.createElement(Ve.Fragment,null,e):Ve.createElement(n_,null,e);a_.displayName="ReactFlowWrapper";const VF={input:DE,default:qy,output:OE,group:eb},YF={default:ff,straight:Zg,step:Wg,smoothstep:Pf,simplebezier:Xg},GF=[0,0],KF=[15,15],XF={x:0,y:0,zoom:1},WF={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},s_=u.forwardRef(({nodes:e,edges:n,defaultNodes:s,defaultEdges:i,className:l,nodeTypes:o=VF,edgeTypes:d=YF,onNodeClick:m,onEdgeClick:p,onInit:h,onMove:y,onMoveStart:g,onMoveEnd:x,onConnect:v,onConnectStart:S,onConnectEnd:N,onClickConnectStart:E,onClickConnectEnd:j,onNodeMouseEnter:A,onNodeMouseMove:T,onNodeMouseLeave:_,onNodeContextMenu:M,onNodeDoubleClick:k,onNodeDragStart:C,onNodeDrag:D,onNodeDragStop:z,onNodesDelete:G,onEdgesDelete:U,onSelectionChange:X,onSelectionDragStart:V,onSelectionDrag:R,onSelectionDragStop:B,onSelectionContextMenu:L,onSelectionStart:O,onSelectionEnd:$,connectionMode:F=Fi.Strict,connectionLineType:H=Wr.Bezier,connectionLineStyle:I,connectionLineComponent:Y,connectionLineContainerStyle:P,deleteKeyCode:K="Backspace",selectionKeyCode:re="Shift",selectionOnDrag:W=!1,selectionMode:ue=Oc.Full,panActivationKeyCode:Q="Space",multiSelectionKeyCode:ye=cf()?"Meta":"Control",zoomActivationKeyCode:ae=cf()?"Meta":"Control",snapToGrid:ke=!1,snapGrid:pe=KF,onlyRenderVisibleElements:we=!1,selectNodesOnDrag:ne=!0,nodesDraggable:Le,nodesConnectable:be,nodesFocusable:Oe,nodeOrigin:Me=GF,edgesFocusable:ut,edgesUpdatable:ht,elementsSelectable:_t,defaultViewport:jt=XF,minZoom:ve=.5,maxZoom:tt=2,translateExtent:st=Hy,preventScrolling:$e=!0,nodeExtent:Ye,defaultMarkerColor:mt="#b1b1b7",zoomOnScroll:ie=!0,zoomOnPinch:J=!0,panOnScroll:le=!1,panOnScrollSpeed:fe=.5,panOnScrollMode:Ue=ki.Free,zoomOnDoubleClick:qe=!0,panOnDrag:ze=!0,onPaneClick:Ce,onPaneMouseEnter:pt,onPaneMouseMove:bt,onPaneMouseLeave:Ct,onPaneScroll:Ze,onPaneContextMenu:ot,children:Tt,onEdgeContextMenu:$t,onEdgeDoubleClick:Qt,onEdgeMouseEnter:At,onEdgeMouseMove:kt,onEdgeMouseLeave:qt,onEdgeUpdate:Lt,onEdgeUpdateStart:ce,onEdgeUpdateEnd:Ae,onReconnect:Te,onReconnectStart:Ke,onReconnectEnd:Se,reconnectRadius:Be=10,edgeUpdaterRadius:We=10,onNodesChange:se,onEdgesChange:Z,noDragClassName:Ee="nodrag",noWheelClassName:_e="nowheel",noPanClassName:ge="nopan",fitView:Pe=!1,fitViewOptions:oe,connectOnClick:at=!0,attributionPosition:dt,proOptions:xt,defaultEdgeOptions:de,elevateNodesOnSelect:it=!0,elevateEdgesOnSelect:nt=!1,disableKeyboardA11y:vt=!1,autoPanOnConnect:lt=!0,autoPanOnNodeDrag:wt=!0,connectionRadius:He=20,isValidConnection:Je,onError:St,style:ee,id:xe,nodeDragThreshold:Ie,...et},Nt)=>{const Rt=xe||"1";return Ve.createElement("div",{...et,style:{...ee,...WF},ref:Nt,className:ma(["react-flow",l]),"data-testid":"rf__wrapper",id:xe},Ve.createElement(a_,null,Ve.createElement(PF,{onInit:h,onMove:y,onMoveStart:g,onMoveEnd:x,onNodeClick:m,onEdgeClick:p,onNodeMouseEnter:A,onNodeMouseMove:T,onNodeMouseLeave:_,onNodeContextMenu:M,onNodeDoubleClick:k,nodeTypes:o,edgeTypes:d,connectionLineType:H,connectionLineStyle:I,connectionLineComponent:Y,connectionLineContainerStyle:P,selectionKeyCode:re,selectionOnDrag:W,selectionMode:ue,deleteKeyCode:K,multiSelectionKeyCode:ye,panActivationKeyCode:Q,zoomActivationKeyCode:ae,onlyRenderVisibleElements:we,selectNodesOnDrag:ne,defaultViewport:jt,translateExtent:st,minZoom:ve,maxZoom:tt,preventScrolling:$e,zoomOnScroll:ie,zoomOnPinch:J,zoomOnDoubleClick:qe,panOnScroll:le,panOnScrollSpeed:fe,panOnScrollMode:Ue,panOnDrag:ze,onPaneClick:Ce,onPaneMouseEnter:pt,onPaneMouseMove:bt,onPaneMouseLeave:Ct,onPaneScroll:Ze,onPaneContextMenu:ot,onSelectionContextMenu:L,onSelectionStart:O,onSelectionEnd:$,onEdgeContextMenu:$t,onEdgeDoubleClick:Qt,onEdgeMouseEnter:At,onEdgeMouseMove:kt,onEdgeMouseLeave:qt,onReconnect:Te??Lt,onReconnectStart:Ke??ce,onReconnectEnd:Se??Ae,reconnectRadius:Be??We,defaultMarkerColor:mt,noDragClassName:Ee,noWheelClassName:_e,noPanClassName:ge,elevateEdgesOnSelect:nt,rfId:Rt,disableKeyboardA11y:vt,nodeOrigin:Me,nodeExtent:Ye}),Ve.createElement(B$,{nodes:e,edges:n,defaultNodes:s,defaultEdges:i,onConnect:v,onConnectStart:S,onConnectEnd:N,onClickConnectStart:E,onClickConnectEnd:j,nodesDraggable:Le,nodesConnectable:be,nodesFocusable:Oe,edgesFocusable:ut,edgesUpdatable:ht,elementsSelectable:_t,elevateNodesOnSelect:it,minZoom:ve,maxZoom:tt,nodeExtent:Ye,onNodesChange:se,onEdgesChange:Z,snapToGrid:ke,snapGrid:pe,connectionMode:F,translateExtent:st,connectOnClick:at,defaultEdgeOptions:de,fitView:Pe,fitViewOptions:oe,onNodesDelete:G,onEdgesDelete:U,onNodeDragStart:C,onNodeDrag:D,onNodeDragStop:z,onSelectionDrag:R,onSelectionDragStart:V,onSelectionDragStop:B,noPanClassName:ge,nodeOrigin:Me,rfId:Rt,autoPanOnConnect:lt,autoPanOnNodeDrag:wt,onError:St,connectionRadius:He,isValidConnection:Je,nodeDragThreshold:Ie}),Ve.createElement(F$,{onSelectionChange:X}),Tt,Ve.createElement(f$,{proOptions:xt,position:dt}),Ve.createElement(V$,{rfId:Rt,disableKeyboardA11y:vt})))});s_.displayName="ReactFlow";const ZF=e=>e.domNode?.querySelector(".react-flow__edgelabel-renderer");function QF({children:e}){const n=Ln(ZF);return n?Kl.createPortal(e,n):null}const r_=({id:e,x:n,y:s,width:i,height:l,style:o,color:d,strokeColor:m,strokeWidth:p,className:h,borderRadius:y,shapeRendering:g,onClick:x,selected:v})=>{const{background:S,backgroundColor:N}=o||{},E=d||S||N;return Ve.createElement("rect",{className:ma(["react-flow__minimap-node",{selected:v},h]),x:n,y:s,rx:y,ry:y,width:i,height:l,fill:E,stroke:m,strokeWidth:p,shapeRendering:g,onClick:x?j=>x(j,e):void 0})};r_.displayName="MiniMapNode";var JF=u.memo(r_);const e8=e=>e.nodeOrigin,t8=e=>e.getNodes().filter(n=>!n.hidden&&n.width&&n.height),Kp=e=>e instanceof Function?e:()=>e;function n8({nodeStrokeColor:e="transparent",nodeColor:n="#e2e2e2",nodeClassName:s="",nodeBorderRadius:i=5,nodeStrokeWidth:l=2,nodeComponent:o=JF,onClick:d}){const m=Ln(t8,la),p=Ln(e8),h=Kp(n),y=Kp(e),g=Kp(s),x=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return Ve.createElement(Ve.Fragment,null,m.map(v=>{const{x:S,y:N}=Di(v,p).positionAbsolute;return Ve.createElement(o,{key:v.id,x:S,y:N,width:v.width,height:v.height,style:v.style,selected:v.selected,className:g(v),color:h(v),borderRadius:i,strokeColor:y(v),strokeWidth:l,shapeRendering:x,onClick:d,id:v.id})}))}var a8=u.memo(n8);const s8=200,r8=150,i8=e=>{const n=e.getNodes(),s={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:s,boundingRect:n.length>0?p$(Hf(n,e.nodeOrigin),s):s,rfId:e.rfId}},l8="react-flow__minimap-desc";function i_({style:e,className:n,nodeStrokeColor:s="transparent",nodeColor:i="#e2e2e2",nodeClassName:l="",nodeBorderRadius:o=5,nodeStrokeWidth:d=2,nodeComponent:m,maskColor:p="rgb(240, 240, 240, 0.6)",maskStrokeColor:h="none",maskStrokeWidth:y=1,position:g="bottom-right",onClick:x,onNodeClick:v,pannable:S=!1,zoomable:N=!1,ariaLabel:E="React Flow mini map",inversePan:j=!1,zoomStep:A=10,offsetScale:T=5}){const _=ra(),M=u.useRef(null),{boundingRect:k,viewBB:C,rfId:D}=Ln(i8,la),z=e?.width??s8,G=e?.height??r8,U=k.width/z,X=k.height/G,V=Math.max(U,X),R=V*z,B=V*G,L=T*V,O=k.x-(R-k.width)/2-L,$=k.y-(B-k.height)/2-L,F=R+L*2,H=B+L*2,I=`${l8}-${D}`,Y=u.useRef(0);Y.current=V,u.useEffect(()=>{if(M.current){const re=ls(M.current),W=ye=>{const{transform:ae,d3Selection:ke,d3Zoom:pe}=_.getState();if(ye.sourceEvent.type!=="wheel"||!ke||!pe)return;const we=-ye.sourceEvent.deltaY*(ye.sourceEvent.deltaMode===1?.05:ye.sourceEvent.deltaMode?1:.002)*A,ne=ae[2]*Math.pow(2,we);pe.scaleTo(ke,ne)},ue=ye=>{const{transform:ae,d3Selection:ke,d3Zoom:pe,translateExtent:we,width:ne,height:Le}=_.getState();if(ye.sourceEvent.type!=="mousemove"||!ke||!pe)return;const be=Y.current*Math.max(1,ae[2])*(j?-1:1),Oe={x:ae[0]-ye.sourceEvent.movementX*be,y:ae[1]-ye.sourceEvent.movementY*be},Me=[[0,0],[ne,Le]],ut=pr.translate(Oe.x,Oe.y).scale(ae[2]),ht=pe.constrain()(ut,Me,we);pe.transform(ke,ht)},Q=fE().on("zoom",S?ue:null).on("zoom.wheel",N?W:null);return re.call(Q),()=>{re.on("zoom",null)}}},[S,N,j,A]);const P=x?re=>{const W=Ss(re);x(re,{x:W[0],y:W[1]})}:void 0,K=v?(re,W)=>{const ue=_.getState().nodeInternals.get(W);v(re,ue)}:void 0;return Ve.createElement(Yg,{position:g,style:e,className:ma(["react-flow__minimap",n]),"data-testid":"rf__minimap"},Ve.createElement("svg",{width:z,height:G,viewBox:`${O} ${$} ${F} ${H}`,role:"img","aria-labelledby":I,ref:M,onClick:P},E&&Ve.createElement("title",{id:I},E),Ve.createElement(a8,{onClick:K,nodeColor:i,nodeStrokeColor:s,nodeBorderRadius:o,nodeClassName:l,nodeStrokeWidth:d,nodeComponent:m}),Ve.createElement("path",{className:"react-flow__minimap-mask",d:`M${O-L},${$-L}h${F+L*2}v${H+L*2}h${-F-L*2}z
        M${C.x},${C.y}h${C.width}v${C.height}h${-C.width}z`,fill:p,fillRule:"evenodd",stroke:h,strokeWidth:y,pointerEvents:"none"})))}i_.displayName="MiniMap";var o8=u.memo(i_);function c8(){return Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},Ve.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function u8(){return Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},Ve.createElement("path",{d:"M0 0h32v4.2H0z"}))}function d8(){return Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},Ve.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function f8(){return Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Ve.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function m8(){return Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Ve.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const gc=({children:e,className:n,...s})=>Ve.createElement("button",{type:"button",className:ma(["react-flow__controls-button",n]),...s},e);gc.displayName="ControlButton";const h8=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),l_=({style:e,showZoom:n=!0,showFitView:s=!0,showInteractive:i=!0,fitViewOptions:l,onZoomIn:o,onZoomOut:d,onFitView:m,onInteractiveChange:p,className:h,children:y,position:g="bottom-left"})=>{const x=ra(),[v,S]=u.useState(!1),{isInteractive:N,minZoomReached:E,maxZoomReached:j}=Ln(h8,la),{zoomIn:A,zoomOut:T,fitView:_}=Vf();if(u.useEffect(()=>{S(!0)},[]),!v)return null;const M=()=>{A(),o?.()},k=()=>{T(),d?.()},C=()=>{_(l),m?.()},D=()=>{x.setState({nodesDraggable:!N,nodesConnectable:!N,elementsSelectable:!N}),p?.(!N)};return Ve.createElement(Yg,{className:ma(["react-flow__controls",h]),position:g,style:e,"data-testid":"rf__controls"},n&&Ve.createElement(Ve.Fragment,null,Ve.createElement(gc,{onClick:M,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:j},Ve.createElement(c8,null)),Ve.createElement(gc,{onClick:k,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:E},Ve.createElement(u8,null))),s&&Ve.createElement(gc,{className:"react-flow__controls-fitview",onClick:C,title:"fit view","aria-label":"fit view"},Ve.createElement(d8,null)),i&&Ve.createElement(gc,{className:"react-flow__controls-interactive",onClick:D,title:"toggle interactivity","aria-label":"toggle interactivity"},N?Ve.createElement(m8,null):Ve.createElement(f8,null)),y)};l_.displayName="Controls";var p8=u.memo(l_),Ns;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(Ns||(Ns={}));function y8({color:e,dimensions:n,lineWidth:s}){return Ve.createElement("path",{stroke:e,strokeWidth:s,d:`M${n[0]/2} 0 V${n[1]} M0 ${n[1]/2} H${n[0]}`})}function g8({color:e,radius:n}){return Ve.createElement("circle",{cx:n,cy:n,r:n,fill:e})}const b8={[Ns.Dots]:"#91919a",[Ns.Lines]:"#eee",[Ns.Cross]:"#e2e2e2"},x8={[Ns.Dots]:1,[Ns.Lines]:1,[Ns.Cross]:6},v8=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function o_({id:e,variant:n=Ns.Dots,gap:s=20,size:i,lineWidth:l=1,offset:o=2,color:d,style:m,className:p}){const h=u.useRef(null),{transform:y,patternId:g}=Ln(v8,la),x=d||b8[n],v=i||x8[n],S=n===Ns.Dots,N=n===Ns.Cross,E=Array.isArray(s)?s:[s,s],j=[E[0]*y[2]||1,E[1]*y[2]||1],A=v*y[2],T=N?[A,A]:j,_=S?[A/o,A/o]:[T[0]/o,T[1]/o];return Ve.createElement("svg",{className:ma(["react-flow__background",p]),style:{...m,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:h,"data-testid":"rf__background"},Ve.createElement("pattern",{id:g+e,x:y[0]%j[0],y:y[1]%j[1],width:j[0],height:j[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${_[0]},-${_[1]})`},S?Ve.createElement(g8,{color:x,radius:A/o}):Ve.createElement(y8,{dimensions:T,color:x,lineWidth:l})),Ve.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${g+e})`}))}o_.displayName="Background";var S8=u.memo(o_);const w8=420,N8=520,j8=16,_d=(e,n,s)=>Math.min(Math.max(e,n),s),oN=e=>e?.type?.name||e?.typeName||"Entity";function E8({position:e,cluster:n,onClose:s,onAddToBoard:i,onReturnToGroup:l,onSetTargetEntity:o,onOpenEntityInfo:d,releasedEntityIds:m=[]}){const{label:p,relationshipType:h,entities:y=[],placedEntityIds:g=[],sourceId:x}=n||{},[v,S]=u.useState(null),[N,E]=u.useState(null),[j,A]=u.useState({x:e?.x??100,y:e?.y??100}),T=u.useRef(null),_=u.useRef(null),M=u.useCallback(()=>{const $=v?.parentElement;if($){const F=$.getBoundingClientRect();return{left:F.left,top:F.top,width:F.width,height:F.height}}return{left:0,top:0,width:window.innerWidth,height:window.innerHeight}},[v]),k=u.useMemo(()=>new Set((Array.isArray(g)?g:[]).map(String)),[g]),C=u.useMemo(()=>new Set((Array.isArray(m)?m:[]).map(String)),[m]),D=u.useMemo(()=>Array.isArray(y)?y.filter($=>!C.has(String($.id))):[],[y,C]),z=D.length,G=u.useMemo(()=>{const $=M(),F=T.current?.offsetWidth??w8,H=T.current?.offsetHeight??Math.min($.height*.7,N8),I=j8;return{minX:I,minY:I,maxX:Math.max(I,$.width-F-I),maxY:Math.max(I,$.height-H-I),containerRect:$,entityCount:z}},[z,M]);u.useEffect(()=>{const $=document.querySelector(".react-flow__renderer")||document.querySelector(".react-flow")||document.body,F=document.createElement("div");return F.style.position=$===document.body?"fixed":"absolute",F.style.top="0",F.style.left="0",F.style.right="0",F.style.bottom="0",F.style.zIndex="2500",F.style.pointerEvents="auto",$.appendChild(F),S(F),()=>$.removeChild(F)},[]),u.useEffect(()=>{A({x:_d(e?.x??100,G.minX,G.maxX),y:_d(e?.y??100,G.minY,G.maxY)})},[G,e?.x,e?.y]);const U=u.useCallback($=>{if(!_.current)return;const{offsetX:F,offsetY:H,bounds:I,containerRect:Y}=_.current,P=_d($.clientX-Y.left-F,I.minX,I.maxX),K=_d($.clientY-Y.top-H,I.minY,I.maxY);A({x:P,y:K})},[]),X=u.useCallback(()=>{_.current=null,window.removeEventListener("pointermove",U),window.removeEventListener("pointerup",X),window.removeEventListener("pointercancel",X)},[U]),V=$=>{if($.button!==0||$.target.closest("button")||$.target.closest(".cluster-popup-entity"))return;$.preventDefault(),$.stopPropagation();const F=G,H=F.containerRect||M(),I=$.clientX-H.left-(j?.x??F.minX),Y=$.clientY-H.top-(j?.y??F.minY);_.current={offsetX:I,offsetY:Y,bounds:F,containerRect:H},window.addEventListener("pointermove",U),window.addEventListener("pointerup",X),window.addEventListener("pointercancel",X)};u.useEffect(()=>()=>X(),[X]);const R=u.useCallback(()=>{X(),s?.()},[X,s]);u.useEffect(()=>{const $=F=>F.key==="Escape"&&R();return document.addEventListener("keydown",$),()=>document.removeEventListener("keydown",$)},[R]),u.useEffect(()=>{E(null)},[n?.id]);const B=u.useCallback(($,F)=>{F||E(H=>H===$?null:$)},[]),L=u.useCallback($=>{$&&(C.has(String($))||(i?.(n,$),E(null)))},[n,i,C]),O=u.useCallback($=>{$&&(l?.(n,$),E(null))},[n,l]);return v?rj.createPortal(t.jsx("div",{className:"cluster-popup-overlay",children:t.jsxs("div",{ref:T,className:"cluster-popup-panel",style:{top:`${j?.y??100}px`,left:`${j?.x??100}px`},children:[t.jsxs("div",{className:"cluster-popup-header",onPointerDown:V,children:[t.jsxs("div",{className:"cluster-popup-title",children:[t.jsx("div",{className:"cluster-popup-relationship",children:h||"Cluster"}),t.jsx("div",{className:"cluster-popup-label",children:p||"Entities"})]}),t.jsx("button",{onClick:R,className:"cluster-popup-close","aria-label":"Close cluster",children:t.jsx("span",{"aria-hidden":"true",children:""})})]}),t.jsx("div",{className:"cluster-popup-instructions",children:"Use the action icons to set a relationship target, open entity details, or add and manage entities on the board."}),t.jsx("div",{className:"cluster-popup-entities",children:D.length?D.map($=>{const F=String($.id),H=k.has(F)||C.has(F),I=N===F,Y=x!=null&&F===String(x);return t.jsxs("div",{className:`cluster-popup-entity ${H?"is-placed":""} ${I?"is-selected":""}`,title:$.name||`Entity ${$.id}`,onClick:()=>B(F,H),children:[t.jsx("div",{className:"cluster-popup-entity-header",children:t.jsx("div",{className:"cluster-popup-entity-name",children:$.name||`Entity ${$.id}`})}),t.jsx("div",{className:"cluster-popup-entity-meta",title:oN($),children:oN($)}),t.jsxs("div",{className:"cluster-popup-entity-actions",role:"group","aria-label":"Entity actions",children:[H?t.jsx("button",{type:"button",className:"cluster-popup-entity-action",onClick:P=>{P.stopPropagation(),O($)},onPointerDown:P=>P.stopPropagation(),"aria-label":"Recall entity to cluster",title:"Recall to cluster",disabled:!l,children:t.jsx(Ui,{size:16,"aria-hidden":"true"})}):t.jsx("button",{type:"button",className:"cluster-popup-entity-action is-primary",onClick:P=>{P.stopPropagation(),L(F)},onPointerDown:P=>P.stopPropagation(),"aria-label":"Add entity to board",title:"Add to board",disabled:!i,children:t.jsx(sa,{size:16,"aria-hidden":"true"})}),t.jsx("button",{type:"button",className:"cluster-popup-entity-action",onClick:P=>{P.stopPropagation(),d?.(F)},onPointerDown:P=>P.stopPropagation(),"aria-label":"Open entity details",title:"Open details",disabled:!d,children:t.jsx(cj,{size:16,"aria-hidden":"true"})}),!Y&&t.jsx("button",{type:"button",className:"cluster-popup-entity-action",onClick:P=>{P.stopPropagation(),o?.(F)},onPointerDown:P=>P.stopPropagation(),"aria-label":"Use as relationship source",title:"Set as source",disabled:!o,children:t.jsx(ug,{size:16,"aria-hidden":"true"})})]})]},$.id)}):t.jsx("div",{className:"cluster-popup-empty",children:"No entities in this cluster."})})]})}),v):null}function _8({id:e,data:n}){const[s,i]=u.useState(!1),[l,o]=u.useState({x:0,y:0}),[d,m]=u.useState([]);u.useEffect(()=>{const E=n?.containedIds||n?.data?.containedIds||[],j=n?.allNodes||n?.data?.allNodes||[];if(E.length&&j.length){const A=j.filter(T=>E.includes(T.id));m(A)}else m([])},[n]);const p=E=>{E.stopPropagation();const A=(document.querySelector(".react-flow__renderer")||document.querySelector(".react-flow"))?.getBoundingClientRect(),T=A?.width??window.innerWidth,_=A?.height??window.innerHeight,M=420,k=Math.min(_*.7,520),C=16,D=E.clientX-(A?.left??0),z=E.clientY-(A?.top??0);let G=D+C,U=z-k/2;const X=T-M-C,V=C;G>X&&(G=Math.max(V,D-M-C)),G=Math.max(V,Math.min(G,X));const R=_-k-C,B=C;U<B?U=B:U>R&&(U=R),o({x:G,y:U}),i(!0)},h=()=>i(!1),y=u.useMemo(()=>new Set((n?.placedEntityIds||[]).map(E=>String(E))),[n?.placedEntityIds]),g=d.length,x=n?.count??g+y.size,v=g,S=x?`contains ${v} of ${x}`:"contains 0 of 0",N=n?.relationshipType||n?.label||"Cluster";return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"cluster-node",onClick:p,children:[t.jsx(ni,{id:"top",type:"target",position:Kt.Top,style:{width:12,height:12,background:"#fcd34d",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(120, 53, 15, 0.2)"}}),t.jsx("div",{className:"cluster-node__header",children:t.jsx("div",{className:"cluster-node__badge",children:v})}),t.jsx("div",{className:"cluster-node__label",children:N}),t.jsx("div",{className:"cluster-node__count",children:S}),t.jsx(ni,{id:"bottom",type:"source",position:Kt.Bottom,style:{width:12,height:12,background:"#fcd34d",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(120, 53, 15, 0.2)"}})]}),s&&t.jsx(E8,{position:l,cluster:{id:e,label:n?.label,entities:d,relationshipType:n?.relationshipType,sourceId:n?.sourceId,placedEntityIds:n?.placedEntityIds||[]},onClose:h,onAddToBoard:n?.onAddToBoard,onReturnToGroup:n?.onReturnToGroup,onSetTargetEntity:n?.onSetTargetEntity,onOpenEntityInfo:n?.onOpenEntityInfo,releasedEntityIds:n?.manuallyReleasedIds||[]})]})}function C8({data:e}){const n=!!e?.isCenter,s=e?.label||"Entity",i=e?.typeName||"Entity",l=e?.style||{},o=e?.entityId||e?.id,d=e?.imageUrl||Ql(e?.entity),m=h=>{h?.preventDefault(),h?.stopPropagation(),!(!e?.onSetTarget||!o||n)&&e.onSetTarget(String(o))},p=h=>{h?.preventDefault(),h?.stopPropagation(),!(!e?.onOpenInfo||!o)&&e.onOpenInfo(String(o))};return t.jsxs("div",{className:`entity-node ${n?"entity-node--center":"entity-node--standard"}`,style:{...l},children:[t.jsx(ni,{id:"top",type:"target",position:Kt.Top,style:{width:12,height:12,background:"#cbd5f5",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(15, 23, 42, 0.25)"}}),n&&t.jsx("span",{className:"entity-node__center-indicator"}),t.jsxs("div",{className:"entity-node__content",children:[t.jsxs("div",{className:"entity-node__row entity-node__row--title",children:[d?t.jsx("div",{className:"entity-node__avatar","aria-hidden":"true",children:t.jsx("img",{src:d,alt:"",loading:"lazy"})}):null,t.jsx("div",{className:"entity-node__label",title:s,children:s})]}),t.jsxs("div",{className:"entity-node__row entity-node__row--meta",children:[t.jsx("div",{className:`entity-node__type-pill ${n?"is-center":""}`,children:i}),t.jsxs("div",{className:"entity-node__actions","aria-hidden":!e?.onSetTarget&&!e?.onOpenInfo,children:[t.jsx("button",{type:"button",className:"entity-node__action",onClick:m,onPointerDown:h=>h.stopPropagation(),"aria-label":"Use as relationship source",disabled:n||!e?.onSetTarget,children:t.jsx(ug,{size:16,strokeWidth:2.25,absoluteStrokeWidth:!0,"aria-hidden":"true"})}),t.jsx("button",{type:"button",className:"entity-node__action",onClick:p,onPointerDown:h=>h.stopPropagation(),"aria-label":"Open entity in new window",disabled:!e?.onOpenInfo,children:t.jsx(Uc,{size:16,strokeWidth:2.25,absoluteStrokeWidth:!0,"aria-hidden":"true"})})]})]})]}),t.jsx(ni,{id:"bottom",type:"source",position:Kt.Bottom,style:{width:12,height:12,background:"#cbd5f5",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(15, 23, 42, 0.25)"}})]})}const Yf=220,nb=160,Xc=220,c_=120,ab=40,u_=5,aa="Related",A8=40,T8=120,ic=Math.max(Xc,Yf)+A8,d_=c_+T8,mf=Xc+ab,Vy=/(part of|owned by|managed by|works for|reports to|child of|belongs to|member of|subsidiary of|division of|child)/i,cN=/(owns|manages|contains|has member|employs|parent of|parent|oversees|supervises|leads)/i,f_=/(owns|contains|parent|manages|supervises|leads|employs|has member|has child)/i,M8=/(child of|belongs to|part of|owned by|managed by|reports to|works for)/i,k8=/\s*\(linked to source\)/gi;function Sa(e,n){if(typeof e=="string"){const s=e.replace(k8,"").trim();if(s)return s}return n}function Hd(e){if(!e)return!1;const n=e?.type;return n==="cluster"||n==="clusterNode"}function R8(e,n,s){if(!e||!n||!(s instanceof Map))return!1;let i=String(n);const l=String(e),o=new Set;for(;i&&!o.has(i);){if(o.add(i),i===l)return!0;const d=s.get(i)?.parentId;i=d!=null?String(d):null}return!1}function uN(e){if(!e)return null;const n=String(e.id??"");if(!n)return null;const s=Sa(e?.name,`Entity ${n}`),i=e?.type?.name||e?.typeName||"Entity";return{...e,id:n,name:s,typeName:i}}function I8(e,n){if(!e)return{parentId:null,childId:null};const s=e?.fromEntityId!=null?String(e.fromEntityId):null,i=e?.toEntityId!=null?String(e.toEntityId):null,l=e?.relationshipType;let o=s&&i?s:null,d=s&&i?i:null;const m=l&&typeof l=="object"?l:null,p=(...A)=>{for(const T of A)if(T!=null&&T!=="")return T;return null},h=p(m?.from_label,m?.fromLabel,m?.from_name,m?.fromName),y=p(m?.to_label,m?.toLabel,m?.to_name,m?.toName),g=A=>typeof A=="string"&&Vy.test(A),x=A=>typeof A=="string"&&cN.test(A),v=g(h),S=g(y),N=x(h),E=x(y);S&&!v?(o=i,d=s):v&&!S?(o=s,d=i):N&&!E?(o=i,d=s):E&&!N&&(o=s,d=i);const j=(()=>{if(!l)return"";if(typeof l=="string")return l.toLowerCase();const A=l?.label||l?.name||l?.from_label||l?.to_label||"";return String(A).toLowerCase()})();if(s&&i&&j){const A=/(parent|owns|contains)/.test(j);if(/(child|belongs to|part of)/.test(j)&&!A){const _=o;o=d,d=_}}return!o&&!d&&s&&i&&j&&(Vy.test(j)?(o=i,d=s):cN.test(j)&&(o=s,d=i)),{parentId:o,childId:d}}function m_(e,n){if(!e)return null;const s=e?.from_entity??e?.fromEntityId??e?.from??e?.source??e?.sourceId??null,i=e?.to_entity??e?.toEntityId??e?.to??e?.target??e?.targetId??null,l=s!=null?String(s):null,o=i!=null?String(i):null;if(!l||!o||l===o)return null;const d=e?.id!=null&&e.id!==""?String(e.id):`edge-${l}-${o}`,m=e?.relationshipType??e?.type??e?.data?.relationshipType??null,p={fromEntityId:l,toEntityId:o,relationshipType:m},{parentId:h,childId:y}=I8(p),g=m&&typeof m=="object"?{id:m?.id??null,name:m?.name||m?.label||m?.from_label||m?.to_label||null,label:m?.label??null,from_label:m?.from_label??null,to_label:m?.to_label??null}:m,x=(()=>{if(!g)return e?.label||e?.typeName||e?.data?.typeName||aa;if(typeof g=="string")return g||aa;const{from_label:E,to_label:j,label:A,name:T}=g;return n!=null&&String(n)===l?E||A||T||aa:n!=null&&String(n)===o?j||A||T||aa:A||T||E||j||aa})(),v=String(x||aa).trim()||aa,S=!g||typeof g=="string"?(typeof g=="string"?g:null)||aa:g?.name||g?.label||g?.from_label||g?.to_label||aa,N=g&&typeof g=="object"?g?.id??null:null;return{id:d,source:h??l,target:y??o,parentId:h,childId:y,label:v,typeName:S??aa,typeId:N??null,fromEntityId:l,toEntityId:o,relationshipType:g??null,relationshipLabel:v,raw:e}}function D8(e,n,s=u_,i=null,l=1){const o=[],d=new Map,m=[],p=new Set,h=i!=null?String(i):null;if(!Array.isArray(n)||!n.length)return{clusters:o,suppressedNodes:d,edges:n||[]};const y=new Map((Array.isArray(e)?e:[]).map(C=>[String(C?.id??""),C])),g=new Map;h&&g.set(h,0),y.forEach((C,D)=>{const z=typeof C?.data?.level=="number"?C.data.level:typeof C?.level=="number"?C.level:null;z!=null&&Number.isFinite(z)&&g.set(D,z)});const x=new Map,v=new Map;n.forEach(C=>{if(!C)return;const D=C.parentId||C.source||null,z=C.childId||C.target||null;if(!D||!z)return;const G=String(D),U=String(z),X=y.get(G)||e.find(R=>String(R?.id??"")===G);!X||X.inCluster||(y.get(U)||e.find(R=>String(R?.id??"")===U))?.inCluster||(x.has(G)||x.set(G,new Set),x.get(G).add(U),v.has(U)||v.set(U,new Set),v.get(U).add(G))});const S=new Map;if(h){S.set(h,{parentId:null});const C=new Set,D=[h];for(;D.length;){const z=D.pop();if(!z||C.has(z))continue;C.add(z),S.has(z)||S.set(z,{parentId:null});const G=v.get(z);if(G&&G.size){const[U]=Array.from(G),X=U!=null?String(U):null;if(X){const V=S.get(z)||{};V.parentId?S.set(z,{...V}):S.set(z,{...V,parentId:X}),G.forEach(R=>{const B=R!=null?String(R):null;B&&(S.has(B)||S.set(B,{parentId:null}),C.has(B)||D.push(B))})}}}}const N=new Set(g.keys());if(h){N.add(h);const C=v.get(h);C&&C.forEach(D=>{g.has(D)||g.set(D,0),N.add(D)})}const E=Array.from(N),j=new Set(Array.from(N)),A=1e4;let T=0;for(;E.length&&T<A;){T+=1;const C=E.shift();if(!C)continue;j.has(C)||j.add(C);const D=g.get(C);if(D==null||!Number.isFinite(D))continue;const z=x.get(C);z&&z.forEach(G=>{if(j.has(G))return;const U=D+1,X=g.get(G);(X==null||U<X)&&(g.set(G,U),j.add(G),E.push(G))})}T>=A&&console.warn(`groupChildrenByRelationship: Reached maximum iteration limit (${A}), possible circular relationship detected`);const _=new Map;if(n.forEach(C=>{if(!C)return;const D=C.parentId||C.source||null,z=C.childId||C.target||null;if(!D||!z)return;const G=String(D),U=String(z);if(!G||!U||G===U)return;const X=y.get(G),V=y.get(U);if(X?.inCluster||V?.inCluster)return;const R=g.get(G)??0,B=g.get(U)??R+1;if(R>=l||B>l)return;const L=String(C.relationshipLabel||C.label||aa).trim()||aa,O=C.typeName&&String(C.typeName).trim()||(typeof C.relationshipType=="object"?String(C.relationshipType?.name||C.relationshipType?.label||C.relationshipType?.from_label||C.relationshipType?.to_label||"").trim():null)||null,$=C.typeId!=null?String(C.typeId):C.relationshipType&&typeof C.relationshipType=="object"&&C.relationshipType?.id!=null?String(C.relationshipType.id):null,F=O||$||"unknown-type",H=`${G}-${F}`;_.has(H)||_.set(H,{parentId:G,typeName:O,typeId:$,typeKey:F,relationshipLabel:L,childMap:new Map});const I=_.get(H);I.childMap.has(U)||I.childMap.set(U,[]),I.childMap.get(U).push(C)}),_.forEach(C=>{if(y.get(C.parentId)?.inCluster||e.find($=>String($?.id??"")===C.parentId)?.inCluster)return;const z=Array.from(C.childMap.keys()).filter($=>!y.get($)?.inCluster);if(z.length<s)return;const G=V8(C.typeName||C.typeKey),U=`cluster-${C.parentId}-${G}`,X=g.get(C.parentId)??0,V=C.typeName||C.relationshipLabel||aa,R=z.filter($=>!y.get($)?.inCluster);if(!R.length)return;const B={id:U,parentId:C.parentId,relationshipType:V,typeName:C.typeName,typeId:C.typeId,containedIds:[...R],label:"",count:0,parentLevel:X},L=h&&B.containedIds.length?B.containedIds.filter($=>R8($,h,S)):[],O=new Set(L);L.length&&(B.containedIds=B.containedIds.filter($=>!O.has($)),L.forEach($=>{const F=y.get($)||null;F&&(F.isExpandedProtected=!0,F.inCluster&&(F.inCluster=!1));const H=e.find(I=>String(I?.id??"")===$);H&&H!==F&&(H.isExpandedProtected=!0,H.inCluster&&(H.inCluster=!1))})),B.containedIds.length&&(B.containedIds.forEach($=>{const F=e.find(H=>String(H?.id??"")===$)||y.get($);F&&(F.inCluster=!0)}),B.count=B.containedIds.length,B.label=`${V} (${B.count})`,o.push(B),R.forEach($=>{if(O.has($))return;const F=y.get($)||e.find(I=>String(I?.id??"")===$)||null;if(F?.isExpandedProtected){F.inCluster=!1;return}d.set($,{clusterId:B.id,parentId:C.parentId,relationshipType:V,typeName:C.typeName,typeId:C.typeId,entity:F}),F&&(F.inCluster=!0),(C.childMap.get($)||[]).forEach(I=>p.add(I.id))}),m.push({id:`edge-${C.parentId}-${B.id}`,source:C.parentId,target:B.id,label:B.label,parentId:C.parentId,childId:B.id,relationshipLabel:V,relationshipType:V,typeName:C.typeName,typeId:C.typeId,isClusterEdge:!0}))}),!o.length)return{clusters:o,suppressedNodes:d,edges:n};const k=[...n.filter(C=>{if(!C||p.has(C.id))return!1;const D=String(C.target??C.childId??"");if(D&&d.has(D))return!1;const z=String(C.source??C.parentId??"");return!(z&&d.has(z))}),...m];return{clusters:o,suppressedNodes:d,edges:k}}function L8(e,{isCenter:n=!1}={}){const s=String(e.id),i=Sa(e?.name,`Entity ${s}`),l=e?.typeName||"Entity",o=!!e?.isExpandedProtected,d=Ql(e);return{id:s,type:"entity",width:Xc,height:c_,isExpandedProtected:o,position:{x:0,y:0},data:{label:i,typeName:l,entityId:s,isCenter:n,isExpandedProtected:o,imageUrl:d}}}function O8(e,n){const s=e.relationshipType||aa,i=e.label||s,l=e.count??(Array.isArray(e.containedIds)?e.containedIds.length:0),o=typeof e.parentLevel=="number"&&Number.isFinite(e.parentLevel)?e.parentLevel:null;return{id:e.id,type:"cluster",width:Yf,height:nb,position:{x:0,y:0},data:{label:i,relationshipType:s,containedIds:e.containedIds,count:l,sourceId:e.parentId,placedEntityIds:[],allNodes:n,parentLevel:o}}}function $8(e,n,s){const i=s!=null?String(s):null;n.forEach(l=>{if(!l)return;const o=String(l.id);e.has(o)||e.set(o,o===i?0:1)}),i&&e.set(i,0),e.forEach((l,o)=>{(typeof l!="number"||!Number.isFinite(l))&&e.set(o,o===i?0:1)})}function F8(e,n){let s=1/0;n.forEach(m=>{if(!m)return;const p=e.get(m.id);typeof p=="number"&&Number.isFinite(p)&&p<s&&(s=p)}),Number.isFinite(s)||(s=0);const i=new Map,l=new Map;n.forEach(m=>{if(!m)return;const h=(e.get(m.id)??0)-s;l.set(m.id,h),i.has(h)||i.set(h,[]),i.get(h).push(m)});const o=Array.from(i.keys()).sort((m,p)=>m-p),d=new Map;return o.forEach(m=>{const p=i.get(m)||[];p.sort((h,y)=>{const g=h?.data?.label||h.id,x=y?.data?.label||y.id;return g.localeCompare(x)}),d.set(m,p)}),{groups:d,visualLevels:l}}function Yy(e){if(!e)return"";const n=typeof e?.data?.label=="string"?e.data.label.trim():"";if(n)return n;const s=typeof e?.name=="string"?e.name.trim():"";return s||(e?.id!=null?String(e.id):"")}function h_(e,n){const s=Yy(e),i=Yy(n);return s.localeCompare(i)}function z8(e,n,s,i={}){const{centerId:l=null}=i,o=l!=null?String(l):null,d=new Map;e.forEach(p=>{if(!p)return;const h=p?.parentId??p?.data?.parentId??p?.source??p?.data?.source??null,y=p?.childId??p?.data?.childId??p?.target??p?.data?.target??null,g=h!=null?String(h):null,x=y!=null?String(y):null;if(!g||!x||g===x)return;const v=p?.label??p?.relationshipLabel??"",S=v||p_(p),N=v||P8(p),E=fr(S)||fr(N)||fr(v),j=!!S&&(q8(S)||f_.test(S)),A={parentId:g,relationshipKey:E,relationshipName:N,indicatesParental:j};d.has(x)||d.set(x,[]),d.get(x).push(A)});const m=new Map;return d.forEach((p,h)=>{let y=null,g=1/0,x="",v=null,S="",N="";p.forEach(E=>{if(!E)return;const j=E.parentId,A=n.get(j);if(typeof A!="number"||!Number.isFinite(A))return;const T=s.get(j),_=Yy(T);if(y==null||A<g){y=j,g=A,x=_,v=E,S=fr(E?.relationshipKey),N=E?.relationshipName??"";return}if(A===g){const M=!!v?.indicatesParental;if(!!E?.indicatesParental&&!M){y=j,x=_,v=E,S=fr(E?.relationshipKey),N=E?.relationshipName??"";return}_.localeCompare(x)<0&&(y=j,x=_,v=E,S=fr(E?.relationshipKey),N=E?.relationshipName??"")}}),y!=null&&m.set(h,{parentId:y,relationshipKey:S,relationshipName:N,indicatesParental:!!v?.indicatesParental})}),s.forEach((p,h)=>{if(!p)return;const y=String(h);if(!y||m.has(y)||!Hd(p))return;const g=[p.parentId,p.data?.parentId,p.data?.sourceId,p.data?.source].map(S=>S!=null?String(S):null).filter(Boolean);let x=g.find(S=>s.has(S));!x&&g.length&&(x=g[0]);const v=n.get(y)??1/0;if(!x){const S=Array.isArray(p?.data?.containedIds)?p.data.containedIds.map(N=>N!=null?String(N):null).filter(N=>{if(!N||!s.has(N))return!1;const E=n.get(N);return typeof E=="number"&&Number.isFinite(E)&&E<v}):[];S.length&&(S.sort((N,E)=>{const j=n.get(N)??1/0,A=n.get(E)??1/0;return j===A?N.localeCompare(E):j-A}),x=S[0])}if(!x&&o&&s.has(o)&&(x=o===y?null:o),x){const S=[typeof p?.data?.relationshipType=="string"?p.data.relationshipType:null,typeof p?.relationshipType=="string"?p.relationshipType:null].filter(j=>typeof j=="string"&&j.trim()),N=S.length?S[0].trim():"",E=fr(N);m.set(y,{parentId:x,relationshipKey:E,relationshipName:N})}}),m}function Gy(e,n){if(!e||!n)return null;const s=e.get(n);return s?typeof s=="string"?{parentId:s,relationshipKey:"",relationshipName:""}:typeof s=="object"?{parentId:s?.parentId!=null?String(s.parentId):s?.sourceId!=null?String(s.sourceId):null,relationshipKey:fr(s?.relationshipKey),relationshipName:typeof s?.relationshipName=="string"?s.relationshipName:""}:null:null}function B8(e){return(n,s)=>{if(!n&&!s)return 0;if(!n)return 1;if(!s)return-1;const i=Gy(e,n.id),l=Gy(e,s.id),o=i?.relationshipKey||"",d=l?.relationshipKey||"";if(o&&d){const m=o.localeCompare(d);if(m!==0)return m}else{if(o)return-1;if(d)return 1}return h_(n,s)}}function U8(e,n=new Map){const s=new Map;let i=1/0;const l=0,o=Array.from(e.keys()).sort((h,y)=>h-y);let d=0;o.forEach(h=>{const y=e.get(h)||[];if(!y.length)return;const g=new Map,x=[];y.forEach(j=>{const A=Gy(n,j.id),T=A?.parentId??null,_=T?s.get(T):null;if(T&&_){const M=A?.relationshipKey||fr(A?.relationshipName)||"no-relationship";g.has(T)||g.set(T,{anchorX:_.x,relationshipGroups:new Map});const k=g.get(T);k.relationshipGroups.has(M)||k.relationshipGroups.set(M,[]),k.relationshipGroups.get(M).push(j)}else x.push(j)});const v=B8(n);g.forEach(j=>{j.relationshipGroups.forEach((A,T)=>{A.sort(v)})});const S=l+h*d_;let N=-1/0;if(Array.from(g.keys()).sort((j,A)=>{const T=g.get(j),_=g.get(A);return(T?.anchorX??0)-(_?.anchorX??0)}).forEach(j=>{const A=g.get(j);if(!A)return;const T=Array.from(A.relationshipGroups.keys()).sort(),_=[];if(T.forEach(C=>{const D=A.relationshipGroups.get(C)||[];_.push(...D)}),_.length===0)return;const M=(_.length-1)*ic,k=A.anchorX-M/2;_.forEach((C,D)=>{const z=k+D*ic;s.set(C.id,{x:z,y:S,level:h,levelIndex:d}),d+=1,z<i&&(i=z),z>N&&(N=z)})}),x.length){x.sort(h_);const j=(x.length-1)*ic,A=N!==-1/0?N+ic:-j/2;x.forEach((T,_)=>{const M=A+_*ic;s.set(T.id,{x:M,y:S,level:h,levelIndex:d}),d+=1,M<i&&(i=M),M>N&&(N=M)})}});const m=Number.isFinite(i)&&i<0?-i:0,p=new Map;return m>0?s.forEach((h,y)=>{p.set(y,{x:h.x+m,y:h.y,level:h.level,levelIndex:h.levelIndex})}):s.forEach((h,y)=>{p.set(y,h)}),p}function q8(e){return e?Vy.test(String(e)):!1}function p_(e){if(!e)return"";const n=e?.data?.relationshipType??e?.relationshipType??e?.data?.relationshipLabel??e?.relationshipLabel??e?.data?.label??e?.label??e?.data?.typeName??e?.typeName??"";if(typeof n=="string")return n.toLowerCase().trim();if(n&&typeof n=="object"){const s=n?.label??n?.name??n?.from_label??n?.to_label??"";if(typeof s=="string")return s.toLowerCase().trim()}return""}function P8(e){if(!e)return"";const n=e?.data?.relationshipType??e?.relationshipType??e?.data?.relationshipLabel??e?.relationshipLabel??e?.data?.label??e?.label??e?.data?.typeName??e?.typeName??"";if(typeof n=="string")return n.trim();if(n&&typeof n=="object"){const s=n?.label??n?.name??n?.from_label??n?.to_label??"";if(typeof s=="string")return s.trim()}return""}function fr(e){if(typeof e=="string"){const n=e.trim();return n?n.toLowerCase():""}return""}function H8(e,n){const s=new Map;if(!e)return s;const i=String(e);s.set(i,0);const l=new Map,o=new Map;n.forEach(y=>{if(!y)return;const g=y?.parentId??y?.data?.parentId??y?.source??null,x=y?.childId??y?.data?.childId??y?.target??null,v=g!=null?String(g):null,S=x!=null?String(x):null;!v||!S||v===S||(l.has(v)||l.set(v,new Set),l.get(v).add(S),o.has(S)||o.set(S,new Set),o.get(S).add(v))});const d=[i],m=new Set([i]),p=1e4;let h=0;for(;d.length&&h<p;){h+=1;const y=d.shift();if(!y)continue;m.has(y)||m.add(y);const g=s.get(y)??0,x=o.get(y);x&&x.forEach(S=>{const N=S!=null?String(S):null;if(!N||m.has(N))return;const E=g-1,j=s.get(N);(j==null||E<j)&&(s.set(N,E),m.add(N),d.push(N))});const v=l.get(y);v&&v.forEach(S=>{const N=S!=null?String(S):null;if(!N||m.has(N))return;const E=g+1,j=s.get(N);(j==null||E<j)&&(s.set(N,E),m.add(N),d.push(N))})}return h>=p&&console.warn(`buildLevelsFromEdges: Reached maximum iteration limit (${p}), possible circular relationship detected`),s}function bc(e,n,s){const i=Array.isArray(e)?e.map(_=>({..._,id:String(_.id),data:{..._.data}})):[];if(!i.length)return e;const l=i.filter(_=>Hd(_)),o=i.filter(_=>!Hd(_)),d=o.filter(_=>!_.inCluster),m=d.length?d:o,p=new Map;m.forEach(_=>p.set(_.id,_)),l.forEach(_=>p.set(_.id,_));const h=Array.from(p.values());if(!h.length)return e;const y=s!=null?String(s):h[0]?.id??null;if(!y)return e;const g=new Set(h.map(_=>_.id)),v=(Array.isArray(n)?n.map((_,M)=>{if(!_)return null;const k=_?.source!=null?String(_.source):"",C=_?.target!=null?String(_.target):"";if(!k||!C||k===C)return null;const D=_?.data?.relationshipType||_?.data?.typeName||_?.label||"",z=_?.data?.parentId??_?.parentId??_?.data?.parent??null,G=_?.data?.childId??_?.childId??null,U=z!=null?String(z):null,X=G!=null?String(G):null;return{id:_?.id!=null?String(_.id):`edge-${M}`,source:k,target:C,label:_?.label||D||aa,data:{relationshipType:D||aa,parentId:U,childId:X},parentId:U,childId:X}}).filter(Boolean):[]).map(_=>{if(!_)return null;const M={..._,data:{..._.data||{}}},k=M.source||"",C=M.target||"";if(!k||!C||k===C)return null;let D=M.parentId!=null?String(M.parentId):null,z=M.childId!=null?String(M.childId):null;if(!D||!z){let G=k,U=C;const X=p_(M),V=X&&f_.test(X);if(X&&M8.test(X)&&!V){const B=G;G=U,U=B}D=D??G,z=z??U}return(!D||!z||D===z)&&(D=k,z=C),M.source=D,M.target=z,M.parentId=D,M.childId=z,M.data={...M.data,parentId:D,childId:z},M}).filter(Boolean).filter(_=>g.has(_.source)&&g.has(_.target)),S=H8(y,v);$8(S,h,y),h.forEach(_=>{if(!_||!Hd(_))return;const M=_.parentId??_.data?.parentId??_.data?.sourceId??_.data?.source??null;if(!M)return;const k=String(M),C=S.get(k)??0;S.set(_.id,C+1)});const{groups:N,visualLevels:E}=F8(S,h),j=new Map(h.map(_=>[_.id,_])),A=z8(v,S,j,{centerId:y}),T=U8(N,A);return i.map(_=>{const M=S.get(_.id)??0,k=E.get(_.id)??M,C={x:_?.position?.x??0,y:k*d_,level:k,levelIndex:_?.data?.levelIndex??0},D=T.get(_.id)||C;return{..._,position:{x:D.x,y:D.y},data:{..._.data,level:M,visualLevel:D.level??k,levelIndex:D.levelIndex}}})}function V8(e){return String(e??"group").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function Y8(e){return Array.from(e.values()).map(n=>({id:n.id,name:n.name,typeName:n.typeName,isExpandedProtected:!!n.isExpandedProtected}))}function G8(e){const n=new Map;return Array.isArray(e)&&e.forEach(s=>{if(!s||s.isClusterEdge||s?.data?.isClusterEdge||s?.data?.isClusterChildEdge)return;const i=s?.parentId??s?.source??null,l=s?.childId??s?.target??null;if(i==null||l==null)return;const o=String(i),d=String(l);d&&(n.has(d)||n.set(d,new Set),n.get(d).add(o))}),n}function K8({centerId:e=null,parentLookup:n=new Map,suppressedIds:s=new Set,candidateIds:i=new Set,alwaysIncludeIds:l=new Set}){const o=new Map,d=e!=null?String(e):null,m=new Set(l instanceof Set?Array.from(l).map(String):Array.isArray(l)?l.map(h=>String(h)):[]);function p(h,y=new Set){const g=String(h);if(!g)return!1;if(o.has(g))return o.get(g);if(s.has(g)||!i.has(g)&&!m.has(g))return o.set(g,!1),!1;if(d&&g===d||m.has(g))return o.set(g,!0),!0;const x=n.get(g);if(!x||x.size===0)return o.set(g,!0),!0;if(y.has(g))return o.set(g,!1),!1;y.add(g);let v=!1;for(const S of x){const N=String(S);if(N&&!s.has(N)){if(!i.has(N)&&!m.has(N)){v=!0;continue}if(m.has(N)){v=!0;continue}p(N,y)&&(v=!0)}}return y.delete(g),v?(o.set(g,!0),!0):(o.set(g,!1),!1)}return p}function X8(e,n,s=u_,i={}){const l=n!=null?String(n):null,o=Array.isArray(e?.nodes)?e.nodes:[],d=Array.isArray(e?.edges)?e.edges:[],m=new Map;if(o.forEach(W=>{const ue=uN(W);ue&&m.set(ue.id,ue)}),!l)return{nodes:[],edges:[],suppressedNodes:new Map,clusters:[]};if(!m.has(l)){const W=uN(o[0]);W?m.set(l,{...W,id:l}):m.set(l,{id:l,name:`Entity ${l}`,typeName:"Entity"})}const p=d.map(W=>m_(W,l)).filter(Boolean),h=Array.from(m.values()),y=i?.alwaysIncludeIds,g=new Set(y instanceof Set?Array.from(y).map(String):Array.isArray(y)?y.map(W=>String(W)):y&&typeof y=="object"?Object.values(y).map(W=>String(W)):[]),{clusters:x,suppressedNodes:v,edges:S}=D8(h,p,s,l),N=Y8(m),E=v instanceof Map?v:new Map(Object.entries(v||{}).map(([W,ue])=>[String(W),ue])),j=new Map;E.forEach((W,ue)=>{const Q=String(ue),ye=W?.clusterId!=null?String(W.clusterId):null,ae=W?.parentId!=null?String(W.parentId):null,ke=W?.relationshipType||aa,pe=W?.entity||m.get(Q)||null;j.set(Q,{clusterId:ye,parentId:ae,relationshipType:ke,entity:pe?{...pe,id:Q,name:Sa(pe?.name,`Entity ${Q}`),typeName:pe?.typeName||pe?.type?.name||"Entity",isExpandedProtected:!!pe?.isExpandedProtected}:null})}),g.forEach(W=>{j.delete(String(W))});const A=new Set(Array.from(j.keys())),T=(Array.isArray(x)?x:[]).map(W=>O8(W,N)),M=h.map(W=>L8(W,{isCenter:W.id===l})).filter(W=>!A.has(String(W.id))),k=new Set(M.map(W=>String(W.id)));l!=null&&k.add(String(l)),g.forEach(W=>{k.add(String(W))});const C=G8(p),D=K8({centerId:l,parentLookup:C,suppressedIds:A,candidateIds:k,alwaysIncludeIds:g}),z=M.filter(W=>D(String(W.id))),G=new Set(z.map(W=>String(W.id))),X=[...z.filter(W=>{const ue=String(W.id);if(!ue)return!1;const Q=C.get(ue);if(!Q||!Q.size)return!0;for(const ye of Q){const ae=ye!=null?String(ye):"";if(ae&&G.has(ae))return!0}return!1}),...T],V=new Set(X.map(W=>String(W.id))),R=p.filter(W=>{if(!W)return!1;const ue=W.parentId!=null?W.parentId:W.source!=null?W.source:null;if(ue==null)return!0;const Q=String(ue);return!(!V.has(Q)||A.has(Q))}),L=(Array.isArray(S)&&S.length?S:R).filter(W=>{if(!W)return!1;if(W.isClusterEdge)return!0;const ue=W.parentId!=null?W.parentId:W.source!=null?W.source:null;if(ue!=null){const pe=String(ue);if(!V.has(pe)||A.has(pe))return!1}const Q=W.source!=null?W.source:W.parentId!=null?W.parentId:null,ye=W.target!=null?W.target:W.childId!=null?W.childId:null,ae=Q!=null?String(Q):"",ke=ye!=null?String(ye):"";return!(ae&&A.has(ae)||ke&&A.has(ke))}),O=new Set;L.forEach(W=>{const ue=W.source!=null?String(W.source):W.parentId!=null?String(W.parentId):null,Q=W.target!=null?String(W.target):W.childId!=null?String(W.childId):null;ue&&O.add(ue),Q&&O.add(Q)}),l&&O.add(l);const $=X.filter(W=>O.has(String(W.id))),F=new Set(l!=null?[String(l)]:[]);let H=!0;for(;H;){H=!1;for(const W of L){if(!W)continue;const ue=W.parentId!=null?W.parentId:W.source!=null?W.source:null,Q=W.childId!=null?W.childId:W.target!=null?W.target:null,ye=ue!=null?String(ue):"",ae=Q!=null?String(Q):"",ke=!!ye,pe=!!ae;ke&&F.has(ye)&&pe&&!F.has(ae)&&(F.add(ae),H=!0),pe&&F.has(ae)&&ke&&!F.has(ye)&&(F.add(ye),H=!0)}}const I=$.filter(W=>F.has(String(W.id))),P=L.filter(W=>{const ue=W.parentId!=null?String(W.parentId):String(W.source??""),Q=W.childId!=null?String(W.childId):String(W.target??"");return ue&&Q&&F.has(ue)&&F.has(Q)}).map(W=>({id:W.id,source:W.source,target:W.target,type:"smoothstep",animated:!W.isClusterEdge,label:W.label||W.relationshipLabel||aa,data:{relationshipType:W.relationshipLabel||W.label||aa,parentId:W.parentId??null,childId:W.childId??null,isClusterEdge:!!W.isClusterEdge},parentId:W.parentId??null,childId:W.childId??null,sourceHandle:"bottom",targetHandle:"top"})),K=bc(I,P,l),re=K.filter(W=>W.type==="cluster");return{nodes:K,edges:P,suppressedNodes:j,clusters:re}}function W8(e,n,s=[]){if(!e||!n)return null;const i=e?.position?.x??0,l=e?.position?.y??0,o=e?.width??Yf,d=e?.height??nb,m=String(n.id),p=Ql(n),h=Array.isArray(s)?s.map(j=>String(j)):[],y=h.indexOf(m),g=Math.max(h.length-1,0)*mf,x=i+o/2,v=x-g/2,S=Xc,N=y>=0?v+y*mf-S/2:x-S/2,E=l+d+ab;return{id:m,type:"entity",position:{x:N,y:E},data:{label:Sa(n.name,`Entity ${m}`),typeName:n?.type?.name||n?.typeName||"Entity",isCenter:!1,isAdHoc:!0,entityId:m,imageUrl:p}}}function Cd(e,n,s=[]){if(!n||!Array.isArray(s)||s.length===0)return e;const i=s.map(N=>String(N)),l=new Map(i.map((N,E)=>[N,E])),o=n?.position?.x??0,d=n?.position?.y??0,m=n?.width??Yf,p=n?.height??nb,h=d+p+ab,y=(i.length-1)*mf,x=o+m/2-y/2;let v=!1;const S=e.map(N=>{if(N.type!=="entity"||!N.data?.isAdHoc)return N;const E=l.get(String(N.id));if(E==null)return N;const j=N?.width??Xc,A=x+E*mf-j/2,T=h;return N?.position?.x===A&&N?.position?.y===T?N:(v=!0,{...N,position:{x:A,y:T}})});return v?S:e}function Z8(e,n){return m_(e,n)}function y_({onRefocus:e,onZoomToFit:n,onAutoArrange:s,depth:i,onIncreaseDepth:l,onDecreaseDepth:o,style:d}){return t.jsxs("div",{className:`relationship-toolbar ${d?.compact?"relationship-toolbar--compact":""}`,role:"toolbar","aria-label":"Relationship viewer controls",style:d,children:[t.jsxs("div",{className:"relationship-toolbar__actions",children:[t.jsxs("button",{type:"button",className:"relationship-toolbar__button",onClick:e,children:[t.jsx(ug,{"aria-hidden":"true"}),t.jsx("span",{children:"Refocus"})]}),t.jsxs("button",{type:"button",className:"relationship-toolbar__button",onClick:n,children:[t.jsx(ZM,{"aria-hidden":"true"}),t.jsx("span",{children:"Zoom to fit"})]}),t.jsxs("button",{type:"button",className:"relationship-toolbar__button",onClick:s,children:[t.jsx(Bk,{"aria-hidden":"true"}),t.jsx("span",{children:"Auto arrange"})]})]}),t.jsxs("div",{className:"relationship-toolbar__levels","aria-label":"Relationship depth controls",children:[t.jsx("span",{className:"relationship-toolbar__levels-label",children:"Levels"}),t.jsxs("div",{className:"relationship-toolbar__levels-controls",children:[t.jsx("button",{type:"button",className:"relationship-toolbar__levels-button",onClick:l,disabled:i>=3,"aria-label":"Increase relationship depth",children:t.jsx(sa,{"aria-hidden":"true"})}),t.jsx("span",{className:"relationship-toolbar__levels-value","aria-live":"polite",children:i}),t.jsx("button",{type:"button",className:"relationship-toolbar__levels-button",onClick:o,disabled:i<=1,"aria-label":"Decrease relationship depth",children:t.jsx(cg,{"aria-hidden":"true"})})]})]})]})}y_.propTypes={onRefocus:Mt.func.isRequired,onZoomToFit:Mt.func.isRequired,onAutoArrange:Mt.func.isRequired,depth:Mt.number.isRequired,onIncreaseDepth:Mt.func.isRequired,onDecreaseDepth:Mt.func.isRequired};function Q8({id:e,source:n,target:s,data:i,markerEnd:l,style:o,selected:d}){const{getNode:m}=Vf(),p=m(n),h=m(s);if(!p||!h)return null;const y=p.width??200,g=p.height??80,x=h.width??200;h.height;const v=p.positionAbsolute?.x??p.position?.x??0,S=p.positionAbsolute?.y??p.position?.y??0,N=h.positionAbsolute?.x??h.position?.x??0,E=h.positionAbsolute?.y??h.position?.y??0,j=v+y/2,A=S+g,T=N+x/2,_=E,[M]=df({sourceX:j,sourceY:A,sourcePosition:"bottom",targetX:T,targetY:_,targetPosition:"top"}),k=-18,C=T,D=_+k,z=i?.relationshipType||i?.label||"Related";return t.jsxs(t.Fragment,{children:[t.jsx(eo,{id:e,path:M,markerEnd:l,style:o,selected:d}),t.jsx(QF,{children:t.jsx("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${C}px,${D}px)`,fontSize:12,pointerEvents:"all",background:"rgba(255, 255, 255, 0.9)",padding:"2px 6px",borderRadius:"4px",border:"1px solid #e2e8f0",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.1)",whiteSpace:"nowrap",zIndex:10},className:"nodrag nopan",children:z})})]})}const J8={cluster:_8,entity:C8},ez={smoothstep:Q8},tz="Related";function nz(e){const n=new Map;return Array.isArray(e)&&e.forEach(s=>{if(!s)return;const i=s?.parentId!=null?s.parentId:s?.source!=null?s.source:null,l=s?.childId!=null?s.childId:s?.target!=null?s.target:null;if(i==null||l==null)return;const o=String(i),d=String(l);!o||!d||o===d||(n.has(o)||n.set(o,[]),n.get(o).push(s))}),n}function az(e,n){const s=new Map;if(!e)return s;const i=String(e);if(!i)return s;s.set(i,0);const l=[i],o=new Set([i]),d=1e4;let m=0;for(;l.length&&m<d;){m+=1;const p=l.shift();if(!p)continue;const h=s.get(p)??0,y=n.get(p);!y||!y.length||y.forEach(g=>{if(!g)return;const x=g?.childId!=null?g.childId:g?.target!=null?g.target:null,v=x!=null?String(x):null;!v||o.has(v)||v===p||(s.set(v,h+1),o.add(v),l.push(v))})}return m>=d&&console.warn(`computeDepthLookup: Reached maximum iteration limit (${d}), possible circular relationship detected`),s}function sz(e){const n=new Map;return Array.isArray(e)&&e.forEach(s=>{if(!s)return;const i=s?.parentId!=null?s.parentId:s?.source!=null?s.source:null,l=s?.childId!=null?s.childId:s?.target!=null?s.target:null;if(i==null||l==null)return;const o=String(i),d=String(l);!o||!d||o===d||(n.has(d)||n.set(d,new Set),n.get(d).add(o))}),n}function rz(e,n,s=null){const i=e!=null?String(e):null;if(!i)return new Set;const l=sz(n);if(!l.size)return new Set;const o=new Set,d=[],m=new Map,p=l.get(i);for(p&&p.size&&p.forEach(h=>{const y=String(h);y&&(o.add(y),d.push(y),m.set(y,1))});d.length;){const h=d.shift();if(!h)continue;const y=m.get(h)??1;if(s!=null&&y>=s)continue;const g=l.get(h);!g||!g.size||g.forEach(x=>{const v=String(x);if(!v||v===h||o.has(v))return;const S=y+1;s!=null&&S>s||(o.add(v),m.set(v,S),d.push(v))})}return o}function dN(e){if(!e)return null;const n=e?.parentId!=null?e.parentId:e?.source!=null?e.source:null,s=e?.childId!=null?e.childId:e?.target!=null?e.target:null,i=n!=null?String(n):null,l=s!=null?String(s):null;if(!i||!l||i===l)return null;const o=e?.relationshipLabel||e?.label||e?.typeName||tz;return{id:e?.id!=null&&e.id!==""?String(e.id):`edge-${i}-${l}`,source:i,target:l,type:"smoothstep",animated:!e?.isClusterEdge,label:o,data:{relationshipType:o,parentId:i,childId:l,isClusterEdge:!!e?.isClusterEdge},parentId:i,childId:l,sourceHandle:"bottom",targetHandle:"top"}}function iz(){const{entityId:e}=Wa(),n=Mn(),[s,i]=u.useState(!0),[l,o]=u.useState(null),[d,m]=u.useState([]),[p,h]=u.useState([]),[y,g]=u.useState({}),[x,v]=u.useState(null),[S,N]=u.useState(1),E=u.useRef(null),j=u.useRef(null),[A,T]=u.useState(null),[_,M]=u.useState(null),[k,C]=u.useState(null),[D,z]=u.useState(!1),[G,U]=u.useState([]),[X,V]=u.useState([]),R=u.useRef(new Map),B=u.useRef(new Map),L=u.useRef(new Map),O=u.useRef(new Set),$=u.useRef([]),F=u.useRef([]),H=u.useRef([]),I=u.useRef(new Map),Y=u.useRef(new Set),P=u.useRef(null),K=u.useRef(new Map),re=u.useRef(new Map),W=u.useRef(null),ue=u.useMemo(()=>J8,[]),Q=u.useMemo(()=>ez,[]),ye=u.useCallback(ie=>{if(!Array.isArray(ie)||!ie.length)return ie;const J=I.current;if(!(J instanceof Map)||!J.size)return ie;let le=!1;const fe=ie.map(Ue=>{if(!Ue||!(Ue.type==="entity"||Ue.type==="cluster"))return Ue;const ze=J.get(String(Ue.id));return ze?(le=!0,{...Ue,position:{x:ze.x,y:ze.y},positionAbsolute:{x:ze.x,y:ze.y}}):Ue});return le?fe:ie},[]);u.useEffect(()=>{$.current=d},[d]),u.useEffect(()=>{F.current=p},[p]),u.useEffect(()=>()=>{W.current!=null&&(clearTimeout(W.current),W.current=null)},[]),u.useEffect(()=>{const ie=e!=null?String(e):null;if(ie&&P.current!==ie){P.current=ie,I.current=new Map,Y.current=new Set,g({});return}ie||(P.current=null,I.current=new Map,Y.current=new Set,g({}))},[e]),u.useEffect(()=>{if(!A){M(null),C(null),z(!1),U([]),V([]);return}let ie=!1;return(async()=>{z(!0),C(null),M(null);try{const le=await Us(A);if(ie)return;const fe=Ya(le);M(fe||null)}catch(le){if(ie)return;console.error("Failed to load entity info:",le),M(null),C(le.message||"Failed to load entity info")}finally{ie||z(!1)}})(),()=>{ie=!0}},[A]);const ae=u.useMemo(()=>_&&(_.entity_type_id||_.entityType?.id||_.entity_type?.id)||null,[_]);u.useEffect(()=>{if(!ae){U([]),V([]);return}let ie=!1;return(async()=>{try{const[le,fe]=await Promise.all([Tf(ae).catch(Ue=>(console.error(" Failed to load drawer field order",Ue),null)),Mf(ae).catch(Ue=>(console.error(" Failed to load drawer field rules",Ue),null))]);if(ie)return;U(ei(le)),V(ei(fe))}catch(le){if(ie)return;console.error(" Failed to load drawer field layout",le),U([]),V([])}})(),()=>{ie=!0}},[ae]);const ke=u.useCallback(ie=>m(J=>HE(ie,J)),[]),pe=u.useCallback(ie=>h(J=>rF(ie,J)),[]),we=u.useCallback(ie=>{ie&&n(`/entities/${ie}/relationship-viewer`)},[n]),ne=u.useCallback(ie=>{if(!ie)return;const J=String(ie);T(le=>le===J?le:J)},[]),Le=u.useCallback(()=>{T(null),M(null),C(null),z(!1)},[]),be=u.useCallback(ie=>{ie&&O.current.delete(String(ie))},[]),Oe=u.useCallback(ie=>{ie&&O.current.add(String(ie))},[]),Me=u.useCallback(ie=>{if(!ie)return new Map;const J=String(ie),le=Array.isArray(F.current)?F.current:[],fe=new Map,Ue=[J],qe=new Set;for(;Ue.length;){const ze=Ue.pop();!ze||qe.has(ze)||(qe.add(ze),le.forEach(Ce=>{if(!Ce||Ce?.data?.isClusterEdge||Ce?.data?.isClusterChildEdge)return;const pt=Ce?.parentId??Ce?.data?.parentId??Ce?.source??null,bt=Ce?.childId??Ce?.data?.childId??Ce?.target??null;if(pt==null||bt==null)return;const Ct=String(pt);if(Ct!==ze)return;const Ze=String(bt);if(!(!Ze||Ze===J)){if(!fe.has(Ze)){const ot=Ce?.data?.relationshipType||Ce?.relationshipLabel||Ce?.label||"Related";fe.set(Ze,{parentId:Ct,relationshipType:ot})}qe.has(Ze)||Ue.push(Ze)}}))}return fe},[]),ut=u.useCallback((ie,J)=>{if(ie==null||J==null)return;const le=String(ie);if(!le)return;const fe=re.current instanceof Map?re.current:null;!fe||Y.current.has(le)&&fe.has(le)||fe.set(le,J)},[]),ht=u.useCallback((ie,J)=>{if(!ie)return;const le=String(typeof ie=="string"?ie:ie?.id??ie?.data?.id??ie);if(!le)return;const fe=$.current.find(ge=>String(ge.id)===le&&ge.type==="cluster");if(!fe)return;const Ue=Y.current,ze=H.current.find(ge=>String(ge.id)===le)||{id:le,relationshipType:fe?.data?.relationshipType||fe?.data?.label||"Related",label:fe?.data?.label||fe?.data?.relationshipType||"Related",containedIds:(fe?.data?.containedIds||[]).map(ge=>String(ge)).filter(ge=>!Ue.has(ge)),parentId:fe?.data?.sourceId!=null?String(fe.data.sourceId):null},Ce=R.current,pt=L.current,bt=B.current;if(!(Ce instanceof Map)||!(pt instanceof Map))return;const Ct=J??(typeof ie=="object"&&ie?.entityId!=null?ie.entityId:null),Ze=Ct!=null?String(Ct):null;if(Ze&&Ue.has(Ze))return;const ot=new Map;Array.isArray($.current)&&$.current.forEach(ge=>{if(!ge||ge.type&&ge.type!=="entity")return;const Pe=String(ge.id);Pe&&ot.set(Pe,ge)}),pt instanceof Map&&pt.forEach((ge,Pe)=>{if(!ge)return;const oe=String(Pe);oe&&ot.set(oe,ge)}),(Array.isArray(fe?.data?.allNodes)?fe.data.allNodes:[]).forEach(ge=>{if(!ge||ge?.type&&ge.type!=="entity")return;const Pe=ge?.id!=null?String(ge.id):null;if(!Pe||ot.has(Pe))return;const oe=ge?.data||{},at=oe?.label||ge?.name||oe?.name||`Entity ${Pe}`,dt={id:Pe,type:ge?.type||"entity",position:ge?.position||{x:0,y:0},data:{...oe,label:Sa(at,`Entity ${Pe}`),typeName:oe?.typeName||oe?.type?.name||ge?.typeName||ge?.type&&ge?.type.name||"Entity",entityId:oe?.entityId!=null?String(oe.entityId):Pe,isAdHoc:oe?.isAdHoc!=null?!!oe.isAdHoc:!0,isExpandedProtected:!!oe?.isExpandedProtected}};ot.set(Pe,dt)});let $t=Ze?[Ze].filter(ge=>Ce.has(ge)):[];if($t.length===0&&Ze&&($t=[String(Ze)]),!$t.length)if(Ze){const ge=String(Ze);Ce.delete(ge),pt.delete(ge),bt instanceof Map&&bt.delete(ge),Y.current.add(ge)}else{be(le);return}const Qt=$t.map(ge=>{const Pe=String(ge);return{id:Pe,definition:pt.get(Pe)||ot.get(Pe)||null,meta:bt.get(Pe)||Ce.get(Pe)||null}}).filter(ge=>{if(!ge?.definition)return!1;const Pe=ge?.id!=null?String(ge.id):null;return Pe?!Ue.has(Pe):!1});if(!Qt.length){Ze||be(le);return}const At=ze.parentId!=null?String(ze.parentId):null,kt=new Set($.current.map(ge=>String(ge.id))),qt=Qt.filter(({id:ge,meta:Pe})=>{const oe=ge!=null?String(ge):null;if(oe&&Ue.has(oe))return!1;const at=Pe?.parentId!=null?String(Pe.parentId):At;return At&&at!==At?!1:at?Ce.has(at)?!1:kt.has(at):!0});if(!qt.length)return;qt.forEach(({id:ge})=>{const Pe=String(ge);Pe&&Ue.add(Pe)});const Lt=ze.relationshipType||ze.label||"Related",ce=[...F.current];qt.forEach(({id:ge})=>{Ce.delete(String(ge))});const Ae=[],Te=[],Ke=K.current instanceof Map?K.current:new Map,Se=re.current instanceof Map?re.current:new Map,Be=Number.isFinite(Number(S))?Number(S):null;if(Ke.size){const ge=B.current instanceof Map?B.current:new Map,Pe=new Set(Array.isArray($.current)?$.current.map(lt=>String(lt.id)):[]),oe=new Set,at=new Set;qt.forEach(({id:lt})=>{if(!lt)return;const wt=String(lt);Pe.add(wt),oe.add(wt)});const dt=qt.map(({id:lt})=>String(lt)),xt=new Set,de=new Set,it=new Set,nt=1e4;let vt=0;if(!(Se instanceof Map)){console.warn("Depth lookup not properly initialized, skipping relationship extension");return}try{for(;dt.length&&vt<nt;){vt+=1;const lt=dt.shift();if(!lt||xt.has(lt))continue;if(it.has(lt)){console.warn(`Circular reference detected for entity ${lt}, skipping`);continue}xt.add(lt),it.add(lt);const wt=typeof Se.get=="function"?Se.get(lt)??0:0;if(Be!=null&&wt!=null&&Number.isFinite(wt)&&wt>=Be){it.delete(lt);continue}if(!(Ke instanceof Map)||typeof Ke.get!="function"){it.delete(lt);continue}const He=Ke.get(lt);if(!Array.isArray(He)||!He.length){it.delete(lt);continue}He.forEach(Je=>{if(Je)try{const St=Je?.childId!=null?Je.childId:Je?.target!=null?Je.target:null,ee=St!=null?String(St):null;if(!ee||ee===lt)return;const xe=Number.isFinite(wt)?wt+1:1;if(Be!=null&&Number.isFinite(Be)&&xe>Be)return;if(Pe.has(ee))ut(ee,xe),oe.has(ee)&&!xt.has(ee)&&!it.has(ee)&&dt.push(ee);else if(!at.has(ee)){let Ie=null;if(Ce.has(ee)){if(!(pt instanceof Map)||typeof pt.get!="function")return;const et=pt.get(ee);if(!et)return;Ce.delete(ee),pt.delete(ee),ge instanceof Map&&ge.delete(ee),Ue.add(ee),Ie=et}else{if(!(ot instanceof Map)||typeof ot.get!="function")return;const et=ot.get(ee);if(!et)return;const Nt=et?.data?.label||et?.data?.name||`Entity ${ee}`;Ie={...et,id:String(ee),type:et.type||"entity",position:et.position||{x:0,y:0},data:{...et?.data||{},label:Sa(Nt,`Entity ${ee}`),typeName:et?.data?.typeName||et?.data?.type?.name||"Entity",entityId:et?.data?.entityId!=null?String(et.data.entityId):String(ee),isAdHoc:et?.data?.isAdHoc!=null?!!et.data.isAdHoc:!0,isExpandedProtected:!!et?.data?.isExpandedProtected}}}Ie&&(Ae.push({id:ee,definition:Ie}),at.add(ee),Pe.add(ee),oe.add(ee),!xt.has(ee)&&!it.has(ee)&&dt.push(ee),ut(ee,xe),ot.set(ee,Ie))}ut(ee,xe);try{const Ie=dN(Je);Ie&&!de.has(Ie.id)&&(de.add(Ie.id),Te.push(Ie))}catch(Ie){console.warn("Failed to convert edge to ReactFlow format:",Ie)}}catch(St){console.warn(`Error processing edge for entity ${lt}:`,St)}}),it.delete(lt)}vt>=nt&&console.warn(`Relationship extension reached maximum iteration limit (${nt}), stopping to prevent infinite loop`)}catch(lt){console.error("Error during relationship extension traversal:",lt)}if(Te.length){const lt=new Set(ce.map(wt=>wt.id));Te.forEach(wt=>{!wt||lt.has(wt.id)||(lt.add(wt.id),ce.push(wt))})}}const We=ze.containedIds.filter(ge=>{const Pe=String(ge);return Ue.has(Pe)?!1:Ce.has(Pe)});g(ge=>{const Pe={...ge};let oe=!1;return qt.forEach(({id:at})=>{Pe[at]||(Pe[at]={clusterId:ze.id,relationshipType:ze.relationshipType||null,sourceId:ze.parentId||null},oe=!0)}),oe?Pe:ge}),Te.length&&h(ge=>{const Pe=new Set(ge.map(at=>at.id)),oe=Te.filter(at=>!Pe.has(at.id));return oe.length?[...ge,...oe]:ge}),m(ge=>{const Pe=ge.find(lt=>String(lt.id)===le&&lt.type==="cluster");if(!Pe)return ge;const oe=new Set(ge.map(lt=>String(lt.id)));let at=ge,dt=!1;const xt=new Set((Pe.data?.placedEntityIds||[]).map(lt=>String(lt)));qt.forEach(({id:lt,definition:wt,meta:He})=>{const Je=String(lt);if(xt.add(Je),oe.has(Je))return;const St=He?.entity||{id:lt,name:wt?.data?.label||`Entity ${lt}`,typeName:wt?.data?.typeName||wt?.data?.type?.name||"Entity",isExpandedProtected:!!wt?.data?.isExpandedProtected},ee=W8(Pe,St,Array.from(xt))||wt;if(!ee)return;const xe=Sa(ee.data?.label,`Entity ${lt}`),Ie=Sa(St?.name,xe),et={...ee,id:String(lt),type:"entity",data:{...ee.data,label:Ie,typeName:St?.typeName||ee.data?.typeName||"Entity",entityId:String(lt),isAdHoc:!0,onSetTarget:we,onOpenInfo:ne,isExpandedProtected:!!St?.isExpandedProtected}};oe.add(Je),dt=!0,at=[...at,et];const Nt=`cluster-context-${le}-${Je}`;if(!F.current.find(nn=>nn.id===Nt)){const nn={id:Nt,source:le,target:Je,type:"smoothstep",animated:!1,label:"",style:{stroke:"#bbb",strokeDasharray:"4 2"},data:{isClusterContext:!0,parentId:le,childId:Je},sourceHandle:"bottom",targetHandle:"top"};F.current.push(nn),h(Pt=>[...Pt,nn])}}),Ae.forEach(({id:lt,definition:wt})=>{if(!lt||oe.has(String(lt)))return;const He={...wt,id:String(lt),type:"entity",data:{...wt?.data,label:wt?.data?.label||wt?.data?.name||`Entity ${lt}`,typeName:wt?.data?.typeName||wt?.data?.type?.name||"Entity",entityId:String(lt),isAdHoc:!0,onSetTarget:we,onOpenInfo:ne,isExpandedProtected:!!wt?.data?.isExpandedProtected}};oe.add(String(lt)),dt=!0,at=[...at,He]});const de=Array.from(xt),it=`${Lt} (${We.length})`;let nt=at.map(lt=>String(lt.id)!==le||lt.type!=="cluster"?lt:{...lt,data:{...lt.data,placedEntityIds:de,manuallyReleasedIds:de,label:it}});const vt=nt.find(lt=>String(lt.id)===le&&lt.type==="cluster")||Pe;return nt=Cd(nt,vt,de),!dt&&!ge.some(wt=>String(wt.id)!==le||wt.type!=="cluster"?!1:wt.data?.label!==it)?ge:ye(bc(nt,ce))});const se=`${Lt} (${We.length})`;ze.label=se,H.current=H.current.map(ge=>String(ge.id)===le?{...ge,label:se}:ge);const Z=ge=>{if(!Array.isArray(ge)||!ge.length)return[];const Pe=K.current instanceof Map?K.current:new Map,oe=re.current instanceof Map?re.current:new Map,at=Y.current,dt=R.current instanceof Map?R.current:null,xt=L.current instanceof Map?L.current:null,de=B.current instanceof Map?B.current:null;if(!xt)return[];const it=Number.isFinite(Number(S))?Number(S):null,nt=new Set(F.current.map(Je=>String(Je.id))),vt=[],lt=[],wt=new Map,He=new Set;if(ge.forEach(Je=>{const St=Je!=null?String(Je):null;if(!St||!(Pe instanceof Map)||typeof Pe.get!="function"||!(oe instanceof Map)||typeof oe.get!="function")return;const ee=Pe.get(St)||[];if(!Array.isArray(ee))return;const xe=oe.get(St),Ie=Number.isFinite(xe)?xe+1:null;ee.forEach(et=>{if(et)try{const Nt=et?.childId!=null?et.childId:et?.target!=null?et.target:null,Rt=Nt!=null?String(Nt):null;if(!Rt||Rt===St||at.has(Rt))return;try{const ha=dN(et);ha&&!nt.has(ha.id)&&(nt.add(ha.id),vt.push(ha))}catch(ha){console.warn(`Failed to convert edge to ReactFlow format for parent ${St}:`,ha)}if(!(it==null||Ie!=null&&Ie<=it)||!(xt instanceof Map)||typeof xt.has!="function"||!xt.has(Rt))return;const Pt=xt.get(Rt);if(!Pt)return;const Ft=de&&de.get(Rt)||dt&&dt.get(Rt)||null;xt.delete(Rt),dt&&dt.delete(Rt),de&&de.delete(Rt);const zt=at.has(Rt);at.add(Rt),Ie!=null&&(!zt||!(oe instanceof Map)||!oe.has(Rt))&&ut(Rt,Ie);const dn=Ft?.entity||null,Bn=Sa(Pt?.data?.label,Sa(Pt?.data?.name,`Entity ${Rt}`)),yn=Sa(dn?.name,Bn),ja={...Pt,id:Rt,type:"entity",data:{...Pt?.data,label:yn,typeName:dn?.typeName||Pt?.data?.typeName||Pt?.data?.type?.name||"Entity",entityId:Rt,isAdHoc:!0,onSetTarget:we,onOpenInfo:ne,isExpandedProtected:!!(dn?.isExpandedProtected??Pt?.data?.isExpandedProtected)}};lt.push(ja),He.add(Rt),Ft?.clusterId&&wt.set(Rt,{clusterId:String(Ft.clusterId),relationshipType:Ft?.relationshipType||null,sourceId:Ft?.parentId!=null?String(Ft.parentId):null})}catch(Nt){console.warn(`Error processing edge for parent ${St} child ${childId}:`,Nt)}})}),vt.length){const Je=vt.filter(Boolean);Je.length&&(F.current=[...F.current,...Je],h(St=>[...St,...Je]))}return lt.length&&m(Je=>{const St=new Set(Je.map(et=>String(et.id))),ee=lt.filter(et=>{const Nt=et?.id!=null?String(et.id):null;return!Nt||St.has(Nt)?!1:(St.add(Nt),!0)});if(!ee.length)return Je;const xe=[...Je,...ee],Ie=bc(xe,F.current);return ye(Ie)}),wt.size&&g(Je=>{const St={...Je};let ee=!1;return wt.forEach((xe,Ie)=>{const et=St[Ie];(!et||et.clusterId!==xe.clusterId||et.relationshipType!==xe.relationshipType||et.sourceId!==xe.sourceId)&&(St[Ie]=xe,ee=!0)}),ee?St:Je}),Array.from(He)},Ee=new Set,_e=[...qt.map(({id:ge})=>String(ge)),...Ae.map(({id:ge})=>String(ge))].filter(Boolean);for(;_e.length;){const ge=[];for(;_e.length;){const oe=_e.shift();!oe||Ee.has(oe)||ge.push(oe)}if(!ge.length)break;const Pe=Z(ge);ge.forEach(oe=>Ee.add(oe)),Pe.forEach(oe=>{Ee.has(oe)||_e.push(oe)})}},[ye,ne,we,ut,be,S]),_t=u.useCallback((ie,J)=>{if(!ie||!J)return;const le=String(J.id),fe=String(ie.id);if(J?.isExpandedProtected||$.current.some(At=>String(At?.id)===le&&At?.data?.isExpandedProtected))return;const qe=new Map($.current.map(At=>[String(At.id),At])),ze=Me(le),pt=Array.from(ze.entries()).map(([At])=>String(At)).filter(At=>{if(At===le)return!1;const kt=qe.get(At);return!(!kt||kt?.data?.isExpandedProtected)}),bt=new Set(pt);Y.current.delete(le),I.current.delete(le),pt.forEach(At=>{Y.current.delete(String(At)),I.current.delete(String(At))}),g(At=>{const kt={...At};let qt=!1;return kt[le]&&(delete kt[le],qt=!0),pt.forEach(Lt=>{kt[Lt]&&(delete kt[Lt],qt=!0)}),qt?kt:At});let Ct=[];m(At=>{const kt=At.find(Te=>Te.id===ie.id);let Lt=At.filter(Te=>{const Ke=String(Te.id);return Ke===le&&Te.type==="entity"?!Te.data?.isAdHoc:bt.has(Ke)&&Te.type==="entity"?!!Te.data?.isExpandedProtected:!0}).map(Te=>{if(Te.id!==ie.id||Te.type!=="cluster")return Te;const Ke=new Set((Te.data?.placedEntityIds||[]).map(String));return Ke.has(le)?(Ke.delete(le),{...Te,data:{...Te.data,placedEntityIds:Array.from(Ke),manuallyReleasedIds:Array.from(Ke)}}):Te});const ce=Lt.find(Te=>Te.id===ie.id&&Te.type==="cluster"),Ae=ce?.data?.placedEntityIds?.map(Te=>String(Te))||[];return Ct=Ae,ye(Cd(Lt,ce||kt,Ae))}),h(At=>{const kt=new Set([le,...pt]);return At.filter(qt=>{const Lt=qt?.source!=null?String(qt.source):qt?.parentId!=null?String(qt.parentId):null,ce=qt?.target!=null?String(qt.target):qt?.childId!=null?String(qt.childId):null;return!(Lt&&kt.has(Lt)||ce&&kt.has(ce))})});const Ze=ie.relationshipType||ie.label||"Related",ot=Sa(J?.name,`Entity ${le}`),Tt={clusterId:fe,parentId:ie.sourceId?String(ie.sourceId):null,relationshipType:Ze,entity:{id:le,name:ot,typeName:J?.typeName||J?.type?.name||"Entity",type:J?.type}};R.current.set(le,Tt),B.current.set(le,Tt),L.current.set(le,{id:le,type:"entity",position:{x:0,y:0},data:{label:ot,typeName:J?.typeName||J?.type?.name||"Entity",entityId:le,isAdHoc:!0,isExpandedProtected:!!J?.isExpandedProtected}});const $t=H.current.find(At=>At.id===fe);if($t){const At=Y.current,kt=ie.containedIds.filter(Lt=>{const ce=String(Lt);return At.has(ce)?!1:R.current.has(ce)}),qt=`${$t.relationshipType||ie.relationshipType||"Related"} (${kt.length})`;$t.label=qt,H.current=H.current.map(Lt=>Lt.id===fe?{...Lt,label:qt}:Lt),m(Lt=>Lt.map(ce=>String(ce.id)!==fe||ce.type!=="cluster"?ce:{...ce,data:{...ce.data,label:qt}}))}Ct.length?be(fe):Oe(fe);const Qt=Array.isArray(H.current)?H.current:[];pt.forEach(At=>{const kt=qe.get(At);if(!kt)return;const qt=ze.get(At)||{},Lt=qt?.parentId!=null?String(qt.parentId):null,ce=qt?.relationshipType||"Related",Ae=Qt.find(Ke=>{if(!Ke)return!1;const Se=Ke?.parentId!=null?String(Ke.parentId):null;return Se&&Lt&&Se!==Lt?!1:Array.isArray(Ke?.containedIds)?Ke.containedIds.some(Be=>String(Be)===String(At)):!1}),Te={clusterId:Ae?String(Ae.id):null,parentId:Lt,relationshipType:ce,entity:{id:String(At),name:kt?.data?.label||`Entity ${At}`,typeName:kt?.data?.typeName||kt?.data?.type?.name||"Entity",type:kt?.data?.type||null,isExpandedProtected:!!kt?.data?.isExpandedProtected}};R.current.set(String(At),Te),B.current.set(String(At),Te),L.current.set(String(At),{id:String(At),type:"entity",position:{x:0,y:0},data:{label:kt?.data?.label||`Entity ${At}`,typeName:kt?.data?.typeName||kt?.data?.type?.name||"Entity",entityId:String(At),isAdHoc:!0,isExpandedProtected:!!kt?.data?.isExpandedProtected}})})},[ye,Me,Oe,be]),jt=u.useCallback(ie=>{if(!ie)return;const J=String(typeof ie=="string"?ie:ie?.id??ie?.data?.id??ie);if(!J)return;const le=H.current.find(Ct=>String(Ct.id)===J);if(!le)return;const fe=R.current,Ue=B.current,qe=le.containedIds.filter(Ct=>$.current.some(Ze=>String(Ze.id)===String(Ct)));if(!qe.length){Oe(J);return}qe.forEach(Ct=>{const Ze=String(Ct);Y.current.delete(Ze),I.current.delete(Ze);const ot=$.current.find($t=>String($t.id)===Ze);ot?.type==="entity"&&L.current.set(Ze,{id:Ze,type:"entity",position:{x:0,y:0},data:{label:ot.data?.label||`Entity ${Ze}`,typeName:ot.data?.typeName||"Entity",entityId:Ze,isAdHoc:!0,isExpandedProtected:!!ot.data?.isExpandedProtected}});const Tt=Ue.get(Ze)||{clusterId:J,parentId:le.parentId||null,relationshipType:le.relationshipType||le.label||"Related",entity:ot?.data?{id:Ze,name:ot.data?.label||`Entity ${Ze}`,typeName:ot.data?.typeName||"Entity",isExpandedProtected:!!ot.data?.isExpandedProtected}:L.current.get(Ze)?.data?{id:Ze,name:L.current.get(Ze)?.data?.label||`Entity ${Ze}`,typeName:L.current.get(Ze)?.data?.typeName||"Entity",isExpandedProtected:!!L.current.get(Ze)?.data?.isExpandedProtected}:null};fe.set(Ze,Tt),Ue.set(Ze,Tt)});const ze=F.current.filter(Ct=>{const Ze=String(Ct.source),ot=String(Ct.target);return!qe.includes(Ze)&&!qe.includes(ot)});h(ze),g(Ct=>{const Ze={...Ct};let ot=!1;return qe.forEach(Tt=>{Ze[Tt]&&(delete Ze[Tt],ot=!0)}),ot?Ze:Ct});const Ce=Y.current,pt=le.containedIds.filter(Ct=>{const Ze=String(Ct);return Ce.has(Ze)?!1:fe.has(Ze)}),bt=`${le.relationshipType||le.label||"Related"} (${pt.length})`;le.label=bt,H.current=H.current.map(Ct=>String(Ct.id)===J?{...Ct,label:bt}:Ct),m(Ct=>{const ot=Ct.filter(Tt=>!qe.includes(String(Tt.id))).map(Tt=>String(Tt.id)!==J||Tt.type!=="cluster"?Tt:{...Tt,data:{...Tt.data,placedEntityIds:le.containedIds.filter($t=>{const Qt=String($t);return Ce.has(Qt)?!1:!fe.has(Qt)}).map($t=>String($t)),manuallyReleasedIds:le.containedIds.filter($t=>{const Qt=String($t);return Ce.has(Qt)?!1:!fe.has(Qt)}).map($t=>String($t)),label:bt}});return ye(bc(ot,ze))}),Oe(J)},[ye,Oe]),ve=u.useCallback((ie,J)=>{if(!J||J.type!=="entity"&&J.type!=="cluster")return;const le=String(J.id);if(I.current.set(le,{x:J?.position?.x??0,y:J?.position?.y??0}),J.type!=="entity")return;const fe=le,Ue=y[fe];if(!Ue?.clusterId)return;const qe=document.querySelector(`[data-id="${Ue.clusterId}"]`),ze=document.querySelector(`[data-id="${fe}"]`);if(!qe||!ze)return;const Ce=qe.getBoundingClientRect(),pt=ze.getBoundingClientRect(),bt=pt.left+pt.width/2,Ct=pt.top+pt.height/2;if(!(bt>=Ce.left&&bt<=Ce.right&&Ct>=Ce.top&&Ct<=Ce.bottom))return;const ot=d.find(Tt=>Tt.id===Ue.clusterId);ot&&(J?.data?.isExpandedProtected||_t({id:ot.id,relationshipType:ot.data?.relationshipType,sourceId:ot.data?.sourceId,placedEntityIds:ot.data?.placedEntityIds||[]},{id:fe,name:J?.data?.label,typeName:J?.data?.typeName,isExpandedProtected:!!J?.data?.isExpandedProtected}))},[y,_t,d]);u.useEffect(()=>{m(ie=>{const J=Object.entries(y).reduce((fe,[Ue,qe])=>{const ze=qe?.clusterId;if(!ze)return fe;const Ce=String(ze);return fe[Ce]||(fe[Ce]=[]),fe[Ce].push(String(Ue)),fe},{});let le=ie.map(fe=>{if(fe.type!=="cluster")return fe;const Ue=J[fe.id]||[],qe=(fe.data?.placedEntityIds||[]).map(Ce=>String(Ce));return Ue.length!==qe.length||Ue.some((Ce,pt)=>Ce!==qe[pt])?{...fe,data:{...fe.data,placedEntityIds:Ue,manuallyReleasedIds:Ue}}:fe});for(const[fe,Ue]of Object.entries(J)){const qe=le.find(ze=>ze.id===fe&&ze.type==="cluster");qe&&(le=Cd(le,qe,Ue))}return ye(le)})},[ye,y]),u.useEffect(()=>{if(!e)return;let ie=!0;const J=new AbortController,le=3e4;async function fe(){i(!0),o(null);const Ue=performance.now();console.log(`[RelationshipViewer] Starting graph fetch for entity ${e} at depth ${S}`);try{const qe=R.current instanceof Map?Array.from(R.current.entries()):[],ze=new Map(qe.map(([Lt,ce])=>[String(Lt),ce])),Ce=new Set(ze.keys()),pt=new Promise((Lt,ce)=>{setTimeout(()=>{ce(new Error(`Graph fetch timed out after ${le/1e3} seconds`))},le)}),bt=tI(e,S),Ct=await Promise.race([bt,pt]),Ze=performance.now()-Ue;console.log(`[RelationshipViewer] Graph fetch completed in ${Ze.toFixed(2)}ms`);const ot=Ct??{};let Tt=Array.isArray(ot.edges)?ot.edges:[];Ce.size&&Array.isArray(ot.edges)&&(Tt=ot.edges.filter(Lt=>{const ce=Lt?.from_entity??Lt?.fromEntityId??Lt?.from??Lt?.source??Lt?.sourceId??null,Ae=Lt?.to_entity??Lt?.toEntityId??Lt?.to??Lt?.target??Lt?.targetId??null,Te=ce!=null?String(ce):null,Ke=Ae!=null?String(Ae):null,Se=Te?Ce.has(Te):!1,Be=Ke?Ce.has(Ke):!1;return!Se&&!Be?!0:!(Se&&Be)}));const $t=Tt.map(Lt=>Z8(Lt,e)).filter(Boolean),Qt=nz($t);K.current=Qt,re.current=az(e,Qt);const At=Number.isFinite(Number(S))?Number(S):null,kt=rz(e,$t,At),qt=performance.now();console.log(`[RelationshipViewer] Starting graph processing: ${Tt.length} edges`),setTimeout(()=>{try{if(!ie)return;const Lt=performance.now(),{nodes:ce,edges:Ae,suppressedNodes:Te,clusters:Ke}=X8({...ot,edges:Tt},e,void 0,{alwaysIncludeIds:kt}),Se=performance.now()-Lt;if(console.log(`[RelationshipViewer] buildReactFlowGraph completed in ${Se.toFixed(2)}ms: ${ce.length} nodes, ${Ae.length} edges`),!ie)return;const Be=ee=>ee?ee.type==="cluster"?{...ee,data:{...ee.data,onAddToBoard:(xe,Ie)=>ht(xe,Ie),onReturnToGroup:_t,onCollapseCluster:jt,onSetTargetEntity:we,onOpenEntityInfo:ne,placedEntityIds:[]}}:ee.type==="entity"?{...ee,data:{...ee.data,onSetTarget:we,onOpenInfo:ne}}:{...ee}:null,We=Y.current,se=ce.map(Be),Z=Object.entries(y).reduce((ee,[xe,Ie])=>{const et=Ie?.clusterId!=null?String(Ie.clusterId):null;return et&&(ee.has(et)||ee.set(et,[]),ee.get(et).push(String(xe))),ee},new Map),Ee=ee=>{const xe=Array.isArray(ee)?ee.map(Ie=>String(Ie)):[];return We.size?xe.filter(Ie=>!We.has(Ie)):xe},_e=ee=>{if(!ee)return ee;const xe=ee?.id!=null?String(ee.id):null,Ie=Ee(ee?.data?.containedIds||[]),et=xe&&Z.has(xe)?Z.get(xe):[],Nt=Array.isArray(et)?et.map(Rt=>String(Rt)):[];return{...ee,data:{...ee?.data,containedIds:Ie,count:Ie.length+Nt.length,placedEntityIds:Nt,manuallyReleasedIds:Nt}}},ge=se.map(ee=>ee?.type==="cluster"?_e(ee):ee),Pe=new Map,oe=Te,at=(ee,xe)=>{if(We.has(ee))return;const Ie=Sa(xe?.entity?.name,`Entity ${ee}`);Pe.set(ee,{clusterId:xe?.clusterId!=null?String(xe.clusterId):null,parentId:xe?.parentId!=null?String(xe.parentId):null,relationshipType:xe?.relationshipType||"Related",entity:xe?.entity?{...xe.entity,id:String(xe.entity.id??ee),name:Ie,typeName:xe.entity?.typeName||xe.entity?.type?.name||"Entity",isExpandedProtected:!!xe.entity?.isExpandedProtected}:null})};oe instanceof Map?oe.forEach((ee,xe)=>{const Ie=String(xe);at(Ie,ee)}):Object.entries(oe||{}).forEach(([ee,xe])=>{const Ie=String(ee);at(Ie,xe)}),R.current=Pe,B.current=new Map(Pe);const dt=new Map;oe instanceof Map?oe.forEach((ee,xe)=>{const Ie=String(xe),et=ee?.entity||null,Nt=Sa(et?.name,`Entity ${Ie}`);dt.set(Ie,{id:Ie,type:"entity",position:{x:0,y:0},data:{label:Nt,typeName:et?.typeName||et?.type?.name||"Entity",entityId:Ie,isAdHoc:!0,isExpandedProtected:!!et?.isExpandedProtected}})}):Object.entries(oe||{}).forEach(([ee,xe])=>{const Ie=String(ee),et=xe?.entity||null,Nt=Sa(et?.name,`Entity ${Ie}`);dt.set(Ie,{id:Ie,type:"entity",position:{x:0,y:0},data:{label:Nt,typeName:et?.typeName||et?.type?.name||"Entity",entityId:Ie,isAdHoc:!0,isExpandedProtected:!!et?.isExpandedProtected}})}),L.current=dt;const xt=new Set,it=(Array.isArray(Ke)?Ke:ge.filter(ee=>ee.type==="cluster")).map(ee=>_e(ee));it.forEach(ee=>{xt.add(String(ee.id))}),O.current=xt;const nt=it.map(ee=>({id:String(ee.id),relationshipType:ee?.data?.relationshipType||ee?.data?.label||"Related",label:ee?.data?.label||ee?.data?.relationshipType||"Related",containedIds:(ee?.data?.containedIds||[]).map(xe=>String(xe)),parentId:ee?.data?.sourceId!=null?String(ee.data.sourceId):null}));H.current=nt;const vt=new Map(Array.isArray($.current)?$.current.map(ee=>[String(ee.id),ee]):[]),lt=[...ge];We.forEach(ee=>{const xe=String(ee);if(lt.some(Nt=>String(Nt.id)===xe))return;const Ie=vt.get(xe);if(Ie){lt.push(Ie);return}const et=dt.get(xe);if(et){const Nt=Be(et);Nt&&lt.push({...Nt,id:xe,type:"entity"})}});const wt=new Set(Array.isArray(Ae)?Ae.map(ee=>ee.id):[]),He=(Array.isArray(F.current)?F.current:[]).filter(ee=>{if(!ee||wt.has(ee.id))return!1;const xe=ee?.data?.childId??ee?.target??ee?.data?.targetId??null,Ie=ee?.data?.parentId??ee?.source??ee?.data?.sourceId??null,et=xe!=null?String(xe):null,Nt=Ie!=null?String(Ie):null;return!!(et&&We.has(et)||Nt&&We.has(Nt))}),Je=Array.isArray(Ae)?[...Ae,...He]:He,St=performance.now()-qt;console.log(`[RelationshipViewer] Total processing completed in ${St.toFixed(2)}ms`),m(ye(lt)),h(Je),ie&&i(!1)}catch(Lt){ie&&(console.error("[RelationshipViewer] Error processing graph data:",Lt),o(Lt.message||"Failed to process graph data"),i(!1))}},0)}catch(qe){ie&&(console.error("[RelationshipViewer] Error fetching graph:",qe),o(qe.message||"Failed to load graph"),i(!1))}}return fe(),()=>{ie=!1,J.abort()}},[ye,e,S,ht,jt,ne,_t,we]);const tt=u.useCallback(()=>{if(!x||!e)return;const ie=String(e),J=x.getNode(ie);if(!J)return;const le=J.width??0,fe=J.height??0,Ue=J.position.x+le/2,qe=J.position.y+fe/2;x.setCenter(Ue,qe,{zoom:Math.max(1,x.getZoom()),duration:500})},[e,x]),st=u.useCallback(()=>{!x||!d.length||x.fitView({padding:.2,duration:500})},[d.length,x]),$e=u.useCallback(()=>{e&&(m(ie=>{if(!ie?.length)return ie;const J=bc(ie,p,e),le=new Map(J.map(Ce=>[String(Ce.id),{...Ce.position}])),fe=ie.map(Ce=>{const pt=le.get(String(Ce.id));return!pt||Ce?.position?.x===pt.x&&Ce?.position?.y===pt.y?Ce:{...Ce,position:{...pt}}}),Ue=Object.entries(y).reduce((Ce,[pt,bt])=>{const Ct=bt?.clusterId;if(!Ct)return Ce;const Ze=String(Ct);return Ce[Ze]||(Ce[Ze]=[]),Ce[Ze].push(String(pt)),Ce},{});if(!Object.keys(Ue).length)return fe;let qe=fe.map(Ce=>{if(Ce.type!=="cluster")return Ce;const pt=Ue[Ce.id]||[],bt=(Ce.data?.placedEntityIds||[]).map(String);return pt.length!==bt.length||pt.some((Ze,ot)=>Ze!==bt[ot])?{...Ce,data:{...Ce.data,placedEntityIds:pt,manuallyReleasedIds:pt}}:Ce});for(const[Ce,pt]of Object.entries(Ue)){const bt=qe.find(Ct=>Ct.id===Ce&&Ct.type==="cluster");bt&&(qe=Cd(qe,bt,pt))}const ze=I.current;return ze instanceof Map&&ze.size&&qe.forEach(Ce=>{if(!Ce||!(Ce.type==="entity"||Ce.type==="cluster"))return;const bt=String(Ce.id);ze.has(bt)&&ze.set(bt,{x:Ce.position?.x??0,y:Ce.position?.y??0})}),ye(qe)}),x&&requestAnimationFrame(()=>{x.fitView({padding:.2,duration:400})}))},[ye,y,p,e,x]),Ye=u.useCallback(()=>{s||N(ie=>Math.min(3,ie+1))},[s]),mt=u.useCallback(()=>{s||N(ie=>Math.max(1,ie-1))},[s]);return u.useEffect(()=>{if(!E.current||!j.current)return;const ie=()=>{const fe=E.current,Ue=j.current;if(!fe||!Ue)return;const qe=fe.getBoundingClientRect();qe.width>0&&qe.height>0&&(Ue.style.width=`${qe.width}px`,Ue.style.height=`${qe.height}px`)},J=setTimeout(ie,0),le=new ResizeObserver(ie);return le.observe(E.current),()=>{clearTimeout(J),le.disconnect()}},[]),s?t.jsx("p",{className:"p-4",children:"Loading graph..."}):l?t.jsxs("p",{className:"p-4 text-red-500",children:["Error: ",l]}):d.length?t.jsxs("div",{className:"relative h-full w-full",style:{width:"100%",height:"100%"},children:[t.jsx("div",{ref:E,className:"absolute inset-0 bg-slate-100",style:{width:"100%",height:"100%"},children:t.jsx("div",{ref:j,className:"absolute inset-0",style:{width:"100%",height:"100%"},children:t.jsxs(s_,{nodes:d,edges:p,onNodesChange:ke,onEdgesChange:pe,onNodeDragStop:ve,nodeTypes:ue,edgeTypes:Q,fitView:!0,onInit:v,children:[t.jsx(o8,{}),t.jsx(p8,{}),t.jsx(S8,{gap:16})]})})}),t.jsxs("header",{className:"absolute top-0 z-20 bg-white border-b px-6 py-4 flex items-center justify-between relationship-viewer-header",style:{left:0,right:0,width:"100%",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1)"},children:[t.jsx("h1",{className:"text-xl font-bold text-gray-900 tracking-tight",children:"Relationship Explorer"}),t.jsx(y_,{style:{compact:!0},onRefocus:tt,onZoomToFit:st,onAutoArrange:$e,depth:S,onIncreaseDepth:Ye,onDecreaseDepth:mt})]}),t.jsx(Ag,{entityId:A,entity:_,isLoading:D,error:k,onClose:Le,fieldOrder:G,fieldRules:X})]}):t.jsx("p",{className:"p-4",children:"No relationships found for this entity."})}function lc({step:e,title:n,subtitle:s,children:i,disabled:l=!1}){return t.jsxs("section",{className:`step-card${l?" step-card--disabled":""}`,"aria-disabled":l,children:[t.jsxs("header",{className:"step-card__header",children:[t.jsx("span",{className:"step-card__badge",children:e}),t.jsxs("div",{children:[t.jsx("h3",{className:"step-card__title",children:n}),s&&t.jsx("p",{className:"step-card__subtitle",children:s})]})]}),t.jsx("div",{className:"step-card__body",children:i})]})}const fN=["B","KB","MB","GB"];function lz(e){if(!Number.isFinite(e)||e<=0)return"0 B";const n=Math.min(Math.floor(Math.log(e)/Math.log(1024)),fN.length-1),s=e/1024**n;return`${s.toFixed(s>=10||n===0?0:1)} ${fN[n]}`}function oz({files:e=[],selectedId:n,onSelect:s,onDelete:i}){return e.length?t.jsx("ul",{className:"uploaded-file-list",children:e.map(l=>{const o=l.id===n;return t.jsxs("li",{className:`uploaded-file-list__item${o?" is-selected":""}`,children:[t.jsxs("button",{type:"button",className:"uploaded-file-list__select",onClick:()=>s(o?null:l.id),children:[t.jsx(my,{size:16}),t.jsx("span",{className:"uploaded-file-list__name",children:l.file_name}),t.jsx("span",{className:"uploaded-file-list__meta",children:lz(l.size_bytes)})]}),t.jsx("button",{type:"button",className:"uploaded-file-list__delete",onClick:()=>i(l.id),"aria-label":`Delete ${l.file_name}`,children:t.jsx(zn,{size:16})})]},l.id)})}):t.jsx("p",{className:"uploaded-file-list__empty",children:"No files uploaded yet."})}function cz({isOpen:e,onClose:n,preview:s,previewing:i,importing:l,onImport:o,error:d}){if(!e)return null;const m=!!(s&&!i&&!l);return t.jsxs("div",{className:"preview-popout",role:"dialog","aria-modal":"true",children:[t.jsx("div",{className:"preview-popout__overlay",onClick:n}),t.jsxs("div",{className:"preview-popout__panel",children:[t.jsxs("header",{className:"preview-popout__header",children:[t.jsxs("div",{children:[t.jsx("h2",{children:"Import Preview"}),t.jsx("p",{children:"Review the summary before running the upload."})]}),t.jsx("button",{type:"button",onClick:n,"aria-label":"Close preview",className:"preview-popout__close",children:t.jsx(ea,{size:20})})]}),t.jsxs("div",{className:"preview-popout__content",children:[i&&t.jsxs("div",{className:"preview-popout__state",children:[t.jsx(mn,{className:"spin",size:28}),t.jsx("p",{children:"Generating preview"})]}),!i&&d&&t.jsxs("div",{className:"preview-popout__alert preview-popout__alert--error",children:[t.jsx(Da,{size:18}),t.jsx("span",{children:d})]}),!i&&s&&t.jsxs("div",{className:"preview-popout__summary",children:[t.jsxs("div",{className:"preview-popout__summary-grid",children:[t.jsx(Ad,{label:"Total rows",value:s.total}),t.jsx(Ad,{label:"To create",value:s.createCount,tone:"success"}),t.jsx(Ad,{label:"Duplicates",value:s.duplicateCount,tone:"warn"}),t.jsx(Ad,{label:"Invalid",value:s.invalidCount,tone:"error"})]}),s.duplicateCount>0&&Array.isArray(s.duplicates)&&t.jsxs("div",{className:"preview-popout__list",children:[t.jsx("h3",{children:"Duplicate rows"}),t.jsx("ul",{children:s.duplicates.map(p=>t.jsxs("li",{children:[t.jsxs("span",{children:["Row ",p.row]}),t.jsx("span",{className:"preview-popout__list-name",children:p.name})]},p.row))})]}),s.invalidCount>0&&Array.isArray(s.invalidRows)&&t.jsxs("div",{className:"preview-popout__list",children:[t.jsx("h3",{children:"Invalid rows"}),t.jsx("ul",{children:s.invalidRows.map(p=>t.jsxs("li",{children:[t.jsxs("span",{children:["Row ",p.row]}),t.jsx("span",{className:"preview-popout__list-name",children:p.reason})]},p.row))})]})]})]}),t.jsxs("footer",{className:"preview-popout__footer",children:[t.jsx("button",{type:"button",className:"preview-popout__dismiss",onClick:n,children:"Cancel"}),t.jsxs("button",{type:"button",className:"preview-popout__confirm",disabled:!m,onClick:o,children:[l?t.jsx(mn,{className:"spin",size:18}):t.jsx(vM,{size:18}),"Run upload"]})]})]})]})}function Ad({label:e,value:n,tone:s}){return t.jsxs("div",{className:`summary-metric${s?` summary-metric--${s}`:""}`,children:[t.jsx("span",{className:"summary-metric__label",children:e}),t.jsx("span",{className:"summary-metric__value",children:n}),s==="success"&&t.jsx("span",{className:"summary-metric__icon",children:t.jsx(vf,{size:18})}),s==="warn"&&t.jsx("span",{className:"summary-metric__icon",children:t.jsx(Da,{size:18})}),s==="error"&&t.jsx("span",{className:"summary-metric__icon",children:t.jsx(Da,{size:18})})]})}function uz(){const{token:e}=un(),{activeWorldId:n,contextKey:s}=jn(),i=n||"",[l,o]=u.useState(null),[d,m]=u.useState(!1),[p,h]=u.useState(""),[y,g]=u.useState(""),[x,v]=u.useState([]),[S,N]=u.useState([]),[E,j]=u.useState(""),[A,T]=u.useState(null),[_,M]=u.useState(!1),[k,C]=u.useState(!1),[D,z]=u.useState(!1),[G,U]=u.useState(null),[X,V]=u.useState(!1),[R,B]=u.useState(""),L=u.useRef(null);u.useEffect(()=>{(async()=>{if(!i){N([]);return}M(!0);try{const Q=await Lj(i),ye=Array.isArray(Q?.data)?Q.data:Array.isArray(Q)?Q:[];N(ye)}catch(Q){console.warn(" Failed to load entity types",Q),N([])}finally{M(!1)}})()},[i,s]);const O=async()=>{try{const ue=await fetch("/api/entities/upload",{headers:{Authorization:`Bearer ${e}`}});if(!ue.ok)throw new Error("Failed to fetch uploads");const Q=await ue.json();v(Q.files||[])}catch(ue){console.warn(" Could not fetch uploads",ue)}};u.useEffect(()=>{e&&O()},[e]);const $=ue=>{const Q=ue.target.files?.[0]??null;o(Q),h(""),g("")},F=async()=>{if(!l)return g("Please select a file to upload.");const ue=new FormData;ue.append("file",l),m(!0),h(""),g("");try{const Q=await fetch("/api/entities/upload",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:ue}),ye=await Q.json();if(!Q.ok)throw new Error(ye.message||"Upload failed");h("File uploaded successfully."),o(null),L.current&&(L.current.value=""),await O()}catch(Q){console.error("Upload error:",Q),g(Q.message)}finally{m(!1)}},H=async ue=>{if(window.confirm("Delete this upload?"))try{const Q=await fetch(`/api/entities/upload/${ue}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),ye=await Q.json();if(!Q.ok)throw new Error(ye.message||"Failed to delete file");h("File deleted."),A===ue&&(T(null),U(null)),await O()}catch(Q){console.error(" Delete error:",Q),g(Q.message)}},I=async()=>{if(E){g(""),h("");try{const ue=await fetch(`/api/entities/template/${E}`,{headers:{Authorization:`Bearer ${e}`}});if(!ue.ok)throw new Error("Failed to generate template");const Q=await ue.blob(),ye=window.URL.createObjectURL(Q),ae=document.createElement("a");ae.href=ye,ae.download="Entity_Template.xlsx",document.body.appendChild(ae),ae.click(),ae.remove(),window.URL.revokeObjectURL(ye),h("Template generated successfully.")}catch(ue){console.error(" Template generation failed",ue),g("Failed to generate template")}}},Y=async()=>{if(!E)return g("Select an Entity Type first.");if(!A)return g("Select an uploaded file to preview.");if(!i)return g("Select a world context before previewing.");z(!0),V(!0),U(null),B(""),h(""),g("");try{const ue=await fetch(`/api/entities/preview/${E}`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({fileId:A,worldId:i})}),Q=await ue.json();if(!ue.ok||!Q.success)throw new Error(Q.message||"Preview failed");U(Q.summary)}catch(ue){console.error(" Preview failed:",ue),B(ue.message)}finally{z(!1)}},P=async()=>{if(!E)return g("Select an Entity Type first.");if(!A)return g("Select an uploaded file to import.");if(!i)return g("Select a world context before importing.");C(!0),h(""),g("");try{const ue=await fetch(`/api/entities/import/${E}`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({fileId:A,worldId:i})}),Q=await ue.json();if(!ue.ok)throw new Error(Q.message||"Import failed");h(Q.message||"Import completed successfully."),V(!1),U(null),await O()}catch(ue){console.error(" Import error:",ue),B(ue.message)}finally{C(!1)}},K=()=>{k||D||(V(!1),B(""))},re=u.useMemo(()=>S.find(ue=>String(ue.id)===String(E))?.name??"",[S,E]),W=u.useMemo(()=>x.find(ue=>ue.id===A)??null,[x,A]);return u.useEffect(()=>{T(null),U(null),V(!1),o(null),L.current&&(L.current.value=""),h(""),g(""),B("")},[E]),t.jsxs("div",{className:"bulk-upload-page",children:[t.jsxs("div",{className:"bulk-upload-page__header",children:[t.jsx("h1",{className:"bulk-upload-page__title",children:"Bulk Entity Upload"}),t.jsx("p",{className:"bulk-upload-page__subtitle",children:"Follow the guided steps to prepare your template, upload a data file, preview the import, and launch the upload from a dedicated review panel."})]}),p&&t.jsxs("div",{className:"bulk-upload-page__status",children:[t.jsx(vf,{size:18}),t.jsx("span",{children:p})]}),y&&t.jsxs("div",{className:"bulk-upload-page__status bulk-upload-page__status--error",children:[t.jsx(Da,{size:18}),t.jsx("span",{children:y})]}),t.jsxs("div",{className:"bulk-upload-page__grid",children:[t.jsx(lc,{step:"Select",title:"Choose an entity type",subtitle:_?"Loading entity types for this world...":"Pick which entity type you want to work with. Steps unlock after choosing.",children:t.jsxs("select",{value:E,onChange:ue=>j(ue.target.value),className:"entity-type-select",children:[t.jsx("option",{value:"",children:_?"Loading":"Select Entity Type"}),S.map(ue=>t.jsx("option",{value:ue.id,children:ue.name},ue.id))]})}),E&&t.jsxs(t.Fragment,{children:[t.jsx(lc,{step:1,title:"Generate a template",subtitle:"Download a spreadsheet tailored to the selected entity type.",children:t.jsxs("div",{className:"step-actions",children:[t.jsxs("button",{type:"button",className:"primary-action",onClick:I,children:[t.jsx(CM,{size:18}),"Download template"]}),re&&t.jsxs("span",{className:"selected-file-banner",children:[t.jsx(qi,{size:16})," Template matches ",re]})]})}),t.jsxs(lc,{step:2,title:"Upload your file",subtitle:"Upload the filled spreadsheet and pick which file to preview.",children:[t.jsxs("div",{className:"file-input",children:[t.jsxs("label",{htmlFor:"bulk-upload-file",children:[t.jsx(fS,{size:20}),t.jsxs("div",{children:[t.jsx("div",{className:"file-input__name",children:l?l.name:"Select a file to upload"}),t.jsx("small",{children:"Supported format: Excel (.xlsx)"})]})]}),t.jsx("input",{ref:L,id:"bulk-upload-file",type:"file",hidden:!0,onChange:$}),t.jsxs("button",{type:"button",className:"secondary-action",onClick:F,disabled:!l||d,children:[d?t.jsx(mn,{className:"spin",size:18}):t.jsx(fS,{size:18}),"Upload file"]})]}),W&&t.jsxs("div",{className:"selected-file-banner",children:[t.jsx(kM,{size:16})," Selected file: ",W.file_name]}),t.jsx(oz,{files:x,selectedId:A,onSelect:ue=>{T(ue),U(null)},onDelete:H})]}),t.jsx(lc,{step:3,title:"Run a preview",subtitle:"Review potential changes in the popout before committing to an upload.",children:t.jsxs("div",{className:"step-actions",children:[t.jsxs("button",{type:"button",className:"primary-action",onClick:Y,disabled:!A||D,children:[D?t.jsx(mn,{className:"spin",size:18}):t.jsx(fj,{size:18}),"Preview import"]}),t.jsx("span",{className:"bulk-upload-page__empty-state",children:"The upload can only be launched from the preview popout."})]})}),t.jsx(lc,{step:4,title:"Launch the upload",subtitle:"Confirm the summary inside the popout, then run the upload from there.",children:t.jsxs("div",{className:"step-actions",children:[t.jsxs("span",{className:"bulk-upload-page__empty-state",children:["After reviewing the preview, use the ",t.jsx("strong",{children:"Run upload"})," button in the panel to finish."]}),t.jsxs("span",{className:"selected-file-banner",children:[t.jsx(lj,{size:16})," Preview popout controls the final import."]})]})})]})]}),t.jsx(cz,{isOpen:X,onClose:K,preview:G,previewing:D,importing:k,onImport:P,error:R})]})}function Ky({content:e="",mentions:n=[],segments:s=null,noteId:i="note",textClassName:l="note-text",mentionClassName:o="note-mention",renderEmpty:d=null}){const m=u.useMemo(()=>Array.isArray(s)?s:Oi(e,n),[e,n,s]);return!m||m.length===0?typeof d=="function"?d():null:m.map((p,h)=>{if(p.type==="mention"){if(p.isPlaceholder){const g=p.entityName||p.locationName||"Unresolved";return t.jsxs("span",{className:o,style:{display:"inline-block",backgroundColor:"#fef3c7",color:"#92400e",padding:"2px 6px",borderRadius:"4px",fontSize:"0.875em",fontWeight:500,border:"1px solid #fbbf24"},title:"Unresolved mention - check console for details",children:["@",g,"?"]},`${i}-mention-${h}`)}if(p.locationId){const g=p.locationName||"location";return t.jsxs("span",{className:o,children:["@",g,t.jsx(fs,{locationId:p.locationId,locationName:g})]},`${i}-mention-${h}`)}if(p.entityId){const g=p.entityName||"entity";return t.jsxs("span",{className:o,children:["@",g,t.jsx(Na,{entityId:p.entityId,entityName:g})]},`${i}-mention-${h}`)}const y=p.locationName||p.entityName||p.name||p.label||"mention";return t.jsxs("span",{className:o,style:{display:"inline-block",backgroundColor:"#fee2e2",color:"#991b1b",padding:"2px 6px",borderRadius:"4px",fontSize:"0.875em",fontWeight:500,border:"1px solid #f87171"},title:"Mention without ID - check console for details",children:["@",y,"?"]},`${i}-mention-${h}`)}return t.jsx("span",{className:l,children:p.text},`${i}-text-${h}`)})}const dz=2500,Ds=Object.freeze([]),fz="Use @ to tag entities mentioned in this session.",Xp=(e="create")=>({mode:e,submitLabel:e==="edit"?"Save Changes":"Create Entity",submitDisabled:!1,cancelDisabled:!1,accessButtonVisible:!1,accessButtonDisabled:!1}),Wp=e=>{if(!e)return{id:"",sessionDate:"",sessionTitle:"Session note",content:"",mentions:Ds,createdAt:null,updatedAt:null,author:null,lastEditor:null};const n=e.sessionDate??e.session_date??"",s=e.sessionTitle??e.session_title??"Session note",i=typeof e.content=="string"?e.content:"",l=Array.isArray(e.mentions)?e.mentions.filter(Boolean).map(o=>{const d=o?.entityName??o?.entity_name??o?.label??o?.name??"",m=Cy(d);return{...o,entityName:m}}):Ds;return{id:e.id??"",sessionDate:n,sessionTitle:s,content:i,mentions:l,createdAt:e.createdAt??e.created_at??null,updatedAt:e.updatedAt??e.updated_at??null,author:e.author??null,lastEditor:e.lastEditor??null}},Td=()=>new Date().toISOString().slice(0,10),Md=e=>{if(!e)return"Undated session";const n=/^\d{4}-\d{2}-\d{2}$/.test(e)?`${e}T00:00:00Z`:e,s=new Date(n);return Number.isNaN(s.getTime())?e:s.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},mz=e=>{if(!e)return"";const n=e instanceof Date?e:new Date(e);return Number.isNaN(n.getTime())?"":n.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};function hz(){const{user:e}=un(),{selectedCampaign:n,selectedCampaignId:s}=jn(),[i,l]=u.useState({items:Ds,loading:!1,error:""}),[o,d]=u.useState(""),[m,p]=u.useState(null),[h,y]=u.useState(!1),[g,x]=u.useState({status:"idle",lastSaved:"",error:""}),[v,S]=u.useState(""),[N,E]=u.useState(!1),[j,A]=u.useState(!1),[T,_]=u.useState(""),M=u.useRef(null),k=u.useRef(""),C=u.useRef(null),D=u.useRef(!1),z=u.useRef(""),[G,U]=u.useState(!1),[X,V]=u.useState(()=>Xp("create")),[R,B]=u.useState("details"),L=u.useRef(`entity-form-${Math.random().toString(36).slice(2)}`),O=u.useMemo(()=>n?.world?.id?n.world.id:n?.world_id?n.world_id:"",[n]),$=u.useMemo(()=>!n||!Array.isArray(n.members)||!e?null:n.members.find(tt=>tt?.user_id===e.id)?.role??null,[n,e]),F=u.useMemo(()=>e?.role==="system_admin"?!0:$==="dm",[$,e]),H=u.useMemo(()=>e?.role==="system_admin"||$==="dm"?!0:$==="player"?(n?.world?.entity_creation_scope??"")===Ul.ALL_PLAYERS:!1,[$,e,n]),I=u.useCallback(async()=>{if(s){l(ve=>({...ve,loading:!0,error:""}));try{const ve=await Wk(s),tt=Array.isArray(ve?.data)?ve.data:Array.isArray(ve)?ve:[];l({items:tt,loading:!1,error:""})}catch(ve){console.error(" Failed to load session notes",ve),l({items:Ds,loading:!1,error:ve?.message||"Failed to load session notes"})}}},[s]);u.useEffect(()=>{if(!s){l({items:Ds,loading:!1,error:""}),d(""),p(null),C.current=null;return}I()},[s,I]),u.useEffect(()=>{M.current=m},[m]),u.useEffect(()=>{k.current=o},[o]);const Y=u.useMemo(()=>Array.isArray(i.items)?[...i.items].sort((ve,tt)=>{const st=(ve?.session_date??ve?.sessionDate??"")||"",$e=(tt?.session_date??tt?.sessionDate??"")||"";if(st&&$e&&st!==$e)return $e.localeCompare(st);const Ye=new Date(ve?.updated_at??ve?.updatedAt??ve?.created_at??ve?.createdAt??0).getTime();return new Date(tt?.updated_at??tt?.updatedAt??tt?.created_at??tt?.createdAt??0).getTime()-Ye}):Ds,[i.items]),P=u.useMemo(()=>{const ve=v.trim().toLowerCase();return ve?Y.filter(tt=>{if(!tt)return!1;const st=String(tt?.session_title??tt?.sessionTitle??"Session note").toLowerCase(),$e=String(tt?.content??"").toLowerCase(),Ye=Md(tt?.session_date??tt?.sessionDate??"").toString().toLowerCase();return st.includes(ve)||$e.includes(ve)||Ye.includes(ve)}):Y},[v,Y]),K=u.useMemo(()=>o&&Y.find(ve=>ve?.id===o)||null,[Y,o]),re=u.useMemo(()=>m?.sessionDate?Md(m.sessionDate):"Undated session",[m?.sessionDate]),W=u.useMemo(()=>m?.updatedAt?mz(m.updatedAt):"",[m?.updatedAt]),ue=u.useMemo(()=>m?.content?Oi(m.content,m.mentions):Ds,[m?.content,m?.mentions]);u.useEffect(()=>{const ve=v.trim().length>0,tt=P.length>0?P:Y;if(!o&&tt.length>0){d(tt[0].id);return}if(ve&&P.length===0){o&&d(""),p(null),C.current=null;return}if(o&&P.length>0&&!P.some(Ye=>Ye?.id===o)){d(P[0].id);return}if(!o){p(null),C.current=null;return}if(!K){d(""),p(null),C.current=null;return}const st=Wp(K);p(st),C.current=st,x($e=>({...$e,status:"idle",error:""}))},[P,v,K,o,Y]),u.useEffect(()=>{if(!o){E(!1);return}if(z.current&&z.current===o){E(!0),z.current="";return}E(!1)},[o]),u.useEffect(()=>{_("")},[o]),u.useEffect(()=>{S("")},[s]);const Q=u.useCallback((ve,tt)=>{const st=typeof tt=="string"?tt:typeof ve?.target?.value=="string"?ve.target.value:"";p($e=>$e&&{...$e,content:st})},[]),ye=u.useCallback(async(ve,tt)=>{const st=ve?.trim()??"";if(typeof tt!="function")return;if(!O||st.length===0){tt([]);return}const{searchMentions:$e}=await si(async()=>{const{searchMentions:Ye}=await import("./mentionSearch-D9Dt0xF8.js");return{searchMentions:Ye}},[]);await $e({worldId:O,query:st,limit:8,callback:tt})},[O]),ae=u.useCallback((ve,tt)=>{p(st=>st&&{...st,[ve]:tt})},[]),ke=u.useMemo(()=>{if(!m?.id)return!1;const ve={sessionTitle:(m.sessionTitle||"").trim(),sessionDate:m.sessionDate||"",content:m.content||""},tt=C.current||{},st={sessionTitle:(tt.sessionTitle||"").trim(),sessionDate:tt.sessionDate||"",content:tt.content||""};return JSON.stringify(ve)!==JSON.stringify(st)},[m]),pe=u.useCallback(async()=>{const ve=s,tt=k.current,st=M.current;if(!ve||!tt||!st||D.current)return;const $e={sessionTitle:st.sessionTitle?.trim()||"Session note",sessionDate:st.sessionDate||Td(),content:st.content||""},Ye=C.current||{},mt={sessionTitle:Ye.sessionTitle?.trim()||"Session note",sessionDate:Ye.sessionDate||Td(),content:Ye.content||""};if(JSON.stringify($e)!==JSON.stringify(mt))try{D.current=!0,x(fe=>({...fe,status:"saving",error:""}));const ie=await Qk(ve,tt,$e),J=ie?.data??ie,le=Wp(J);C.current=le,p(le),l(fe=>{const Ue=Array.isArray(fe.items)?fe.items:Ds,qe=Ue.some(ze=>ze?.id===J?.id)?Ue.map(ze=>ze?.id===J?.id?{...ze,...J}:ze):[J,...Ue];return{...fe,items:qe}}),x({status:"saved",lastSaved:new Date().toISOString(),error:""})}catch(ie){console.error(" Failed to save session note",ie),x(J=>({...J,status:"error",error:ie?.message||"Failed to save session note"}))}finally{D.current=!1}},[s]);u.useEffect(()=>{if(!s||!m?.id||!ke||D.current)return;const ve=setTimeout(()=>{pe()},dz);return()=>clearTimeout(ve)},[m,ke,pe,s]);const we=u.useCallback(()=>{pe()},[pe]),ne=u.useCallback(async()=>{const ve=s,tt=k.current;if(!(!ve||!tt)){A(!0),_("");try{await Jk(ve,tt),l(st=>{const Ye=(Array.isArray(st.items)?st.items:Ds).filter(mt=>String(mt?.id)!==String(tt));return{...st,items:Ye}}),k.current="",d(""),p(null),C.current=null,x({status:"idle",lastSaved:"",error:""})}catch(st){console.error(" Failed to delete session note",st),_(st?.message||"Failed to delete session note")}finally{A(!1)}}},[s]),Le=u.useCallback(async()=>{if(s){y(!0),x(ve=>({...ve,error:""}));try{const ve=await Zk(s,{sessionTitle:`Session on ${Md(Td())}`,sessionDate:Td()}),tt=ve?.data??ve,st=Wp(tt);l($e=>{const mt=(Array.isArray($e.items)?$e.items:Ds).filter(ie=>ie?.id!==tt?.id);return{...$e,items:[tt,...mt],error:""}}),S(""),z.current=tt.id,d(tt.id),p(st),C.current=st,E(!0),x({status:"idle",lastSaved:"",error:""})}catch(ve){console.error(" Failed to create session note",ve),x(tt=>({...tt,status:"error",error:ve?.message||"Failed to create session note"}))}finally{y(!1)}}},[s]),be=u.useCallback(()=>{O&&(V(Xp("create")),B("details"),U(!0))},[O]),Oe=u.useCallback(()=>{U(!1),V(Xp("create")),B("details")},[]),Me=u.useCallback(ve=>{ve&&V(tt=>({...tt,...ve}))},[]),ut=u.useCallback(async ve=>{Oe()},[Oe]),ht=n?.name??"",_t=Y.length,jt=u.useMemo(()=>{if(g.status==="saving")return"Saving";if(g.status==="error")return"Changes not saved";if(g.status==="saved"&&g.lastSaved){const ve=new Date(g.lastSaved);return Number.isNaN(ve.getTime())?"Saved":`Saved ${ve.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})}`}return ke?"Unsaved changes":""},[ke,g]);return s?t.jsxs("div",{className:"notes-page",children:[t.jsx("div",{className:"notes-header",children:t.jsxs("div",{className:"notes-title",children:[t.jsx("h1",{children:"Session Notes"}),t.jsxs("p",{children:["Chronicle every game night for the ",t.jsx("strong",{children:ht})," campaign, @mention key entities, and keep everyone aligned with auto-saving notes."]})]})}),t.jsxs("div",{className:"session-notes-meta",children:[t.jsxs("span",{children:[t.jsx(yj,{size:16})," Players and DMs can add or update notes."," ",t.jsx(dS,{size:16})," ",_t," ",_t===1?"session":"sessions"," tracked."]}),jt?t.jsxs("span",{className:`session-notes-autosave status-${g.status}`,children:[g.status==="saving"?t.jsx(mn,{size:14,className:"spinner"}):g.status==="saved"?t.jsx(oj,{size:14}):g.status==="error"?t.jsx(Jn,{size:14}):ke?t.jsx(yS,{size:14}):null,t.jsx("span",{children:jt})]}):null]}),i.error&&t.jsxs("div",{className:"notes-error",role:"alert",children:[t.jsxs("strong",{children:[t.jsx(Jn,{size:18})," Unable to load session notes"]}),t.jsx("span",{children:i.error})]}),t.jsxs("div",{className:"session-notes-layout",children:[t.jsxs("aside",{className:"session-notes-sidebar",children:[t.jsxs("label",{className:"session-notes-search",htmlFor:"session-notes-search-input",children:[t.jsx(Ec,{size:16}),t.jsx("input",{id:"session-notes-search-input",type:"search",placeholder:"Search session notes",value:v,onChange:ve=>S(ve.target.value)})]}),t.jsxs("button",{type:"button",className:"session-notes-item-button session-notes-new-button",onClick:Le,disabled:h||i.loading,children:[h?t.jsx(mn,{size:16,className:"spinner"}):t.jsx(sa,{size:16}),t.jsx("span",{children:h?"Creating":"New Session"})]}),t.jsx("div",{className:"session-notes-list-container",children:i.loading?t.jsxs("div",{className:"session-notes-loading",children:[t.jsx(mn,{size:18,className:"spinner"}),t.jsx("span",{children:"Loading session notes"})]}):P.length===0?Y.length===0?t.jsxs("div",{className:"notes-empty",children:[t.jsx(qi,{size:20}),t.jsx("strong",{children:"No session notes yet"}),t.jsx("span",{children:"Create the first note to kick off your campaign journal."})]}):t.jsxs("div",{className:"notes-empty",children:[t.jsx(Ec,{size:18}),t.jsx("strong",{children:"No matches"}),t.jsxs("span",{children:["No session notes include ",v.trim(),"."]})]}):t.jsx("ul",{className:"session-notes-list",role:"list",children:P.map(ve=>{const tt=ve?.id,st=tt===o,$e=ve?.session_title??ve?.sessionTitle??"Session note",Ye=Md(ve?.session_date??ve?.sessionDate);return t.jsx("li",{className:`session-notes-item ${st?"active":""}`,children:t.jsxs("button",{type:"button",className:"session-notes-item-button",onClick:()=>d(tt),children:[t.jsx("span",{className:"session-note-card-title",children:$e}),t.jsx("span",{className:"session-note-card-date",children:Ye})]})},tt)})})})]}),t.jsx("section",{className:"session-notes-panel",children:m?.id?t.jsxs("div",{className:"session-note-shell",children:[t.jsxs("header",{className:"session-note-header",children:[t.jsx("div",{className:"session-note-heading",children:t.jsx("h2",{children:m.sessionTitle||"Session note"})}),t.jsxs("div",{className:"session-note-toolbar",children:[F?t.jsxs("button",{type:"button",className:"session-note-action danger",onClick:ne,disabled:j,children:[j?t.jsx(mn,{size:16,className:"spinner"}):t.jsx(zn,{size:16}),t.jsx("span",{children:j?"Deleting":"Delete"})]}):null,t.jsxs("button",{type:"button",className:"session-note-action",onClick:()=>E(ve=>!ve),children:[N?t.jsx(cj,{size:16}):t.jsx(lk,{size:16}),t.jsx("span",{children:N?"View note":"Edit note"})]}),N&&H?t.jsxs("button",{type:"button",className:"session-note-action primary",onClick:be,children:[t.jsx(sa,{size:16}),t.jsx("span",{children:"Create Entity"})]}):null]})]}),T?t.jsxs("div",{className:"session-note-error",role:"alert",children:[t.jsx(Jn,{size:16}),t.jsx("span",{children:T})]}):null,N?t.jsxs("div",{className:"session-note-form",children:[t.jsxs("div",{className:"session-note-fields session-note-fields-row",children:[t.jsxs("div",{className:"session-note-field",children:[t.jsx("label",{htmlFor:"session-note-title",children:"Title"}),t.jsx("input",{id:"session-note-title",type:"text",value:m.sessionTitle||"",onChange:ve=>ae("sessionTitle",ve.target.value),placeholder:"The mystery of the Violet Spire"})]}),t.jsxs("div",{className:"session-note-field",children:[t.jsx("label",{htmlFor:"session-note-date",children:"Session date"}),t.jsx("input",{id:"session-note-date",type:"date",value:m.sessionDate||"",onChange:ve=>ae("sessionDate",ve.target.value),max:"9999-12-31"})]})]}),t.jsxs("div",{className:"session-note-fields",children:[t.jsx("label",{htmlFor:"session-note-content",children:"Notes"}),t.jsx("div",{className:"session-note-editor-field",children:t.jsx(Pl,{value:m.content||"",onChange:Q,markup:"@[__display__](__id__)",placeholder:fz,className:"session-note-mentions",inputProps:{id:"session-note-content",className:"session-note-textarea","aria-label":"Session note content",rows:14},children:t.jsx(ti,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(ve,tt)=>`@${tt||(ve.includes(":")?ve.split(":")[1]:ve)}`,data:ye,appendSpaceOnAdd:!0})})}),t.jsx("div",{className:"session-note-save-button",children:t.jsxs("button",{type:"button",className:"session-note-action primary",onClick:we,disabled:g.status==="saving"||!ke,children:[g.status==="saving"?t.jsx(mn,{size:16,className:"spinner"}):t.jsx(yS,{size:16}),t.jsx("span",{children:g.status==="saving"?"Saving":"Save now"})]})}),ue.length>0?t.jsxs("div",{className:"session-note-preview","aria-live":"polite",children:[t.jsx("h3",{children:"Preview"}),t.jsx("div",{className:"session-note-preview-content",children:t.jsx(Ky,{segments:ue,noteId:`${m?.id||"note"}-preview`,textClassName:"session-note-text",mentionClassName:"session-note-mention"})})]}):null]}),t.jsx("div",{className:"session-note-actions",children:m.author?.username?t.jsxs("span",{className:"session-note-meta",children:["Created by ",m.author.username,m.lastEditor?.username&&m.lastEditor.username!==m.author.username?`  Last updated by ${m.lastEditor.username}`:""]}):null})]}):t.jsxs("article",{className:"session-note-view","aria-live":"polite",children:[t.jsxs("div",{className:"session-note-view-meta",children:[t.jsxs("span",{children:[t.jsx(dS,{size:16})," ",re]}),W?t.jsxs("span",{children:["Updated ",W]}):null]}),t.jsx("div",{className:"session-note-view-body",children:t.jsx(Ky,{segments:ue,noteId:`${m?.id||"note"}-view`,textClassName:"session-note-text",mentionClassName:"session-note-mention",renderEmpty:()=>t.jsx("p",{className:"session-note-view-empty",children:"No notes captured yet."})})}),m.author?.username?t.jsxs("div",{className:"session-note-view-meta session-note-view-authors",children:[t.jsxs("span",{children:["Created by ",m.author.username]}),m.lastEditor?.username&&m.lastEditor.username!==m.author.username?t.jsxs("span",{children:["Last updated by ",m.lastEditor.username]}):null]}):null]})]}):t.jsxs("div",{className:"notes-helper",children:[t.jsx(hy,{size:28}),t.jsx("strong",{children:"Select a session to get started"}),t.jsx("span",{children:"Create a new note or choose one from the list to see its details."})]})})]}),t.jsx(Bs,{isOpen:G,onClose:Oe,title:"Create Entity",width:420,footerActions:t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:"btn cancel",onClick:Oe,disabled:X.cancelDisabled,children:"Cancel"}),X.accessButtonVisible&&t.jsx("button",{type:"button",className:"btn secondary",onClick:()=>B(ve=>ve==="access"?"details":"access"),disabled:X.accessButtonDisabled,children:R==="access"?"Details":"Access"}),t.jsx("button",{type:"submit",className:"btn submit",form:L.current,disabled:X.submitDisabled,children:X.submitLabel})]}),children:t.jsx(h1,{worldId:O,entityId:null,onCancel:Oe,onSaved:ut,formId:L.current,onStateChange:Me,hideActions:!0,activeView:R,onViewChange:B,defaultCampaignId:s||""})})]}):t.jsxs("div",{className:"notes-page",children:[t.jsx("div",{className:"notes-header",children:t.jsxs("div",{className:"notes-title",children:[t.jsx("h1",{children:"Session Notes"}),t.jsx("p",{children:"Select a campaign from the header to start collecting your notes."})]})}),t.jsxs("div",{className:"notes-helper",children:[t.jsx(hy,{size:28}),t.jsx("strong",{children:"No campaign selected"}),t.jsx("span",{children:"Pick a campaign to unlock collaborative session notes."})]})]})}const pz={private:"Private",party:"Party",companions:"Companions",dm:"DM"},yz=[{value:"private",label:"Private"},{value:"companions",label:"My Companions"}],gz=[{value:"private",label:"Private"},{value:"party",label:"Share with Party"}],bz="What do you want to remember?",xz=e=>{if(!e)return"";const n=e instanceof Date?e:new Date(e);return Number.isNaN(n.getTime())?"":n.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})},ji=e=>{const n=[e?.entityId,e?.entity_id,e?.entity?.id];for(const s of n)if(s)return String(s);return""},Zp=e=>{const n=[e?.author?.id,e?.createdBy,e?.created_by];for(const s of n)if(s)return String(s);return""},mN=e=>{const n=e?.author;return n?.username?n.username:n?.email?n.email:e?.character?.name?`${e.character.name} (Character)`:(e?.created_by,"Unknown author")},hN=e=>e?.entity?.name?e.entity.name:typeof e?.entityName=="string"&&e.entityName.trim()?e.entityName:"Unnamed entity",Xy=e=>{const n=[e?.entity?.entityTypeId,e?.entity?.entity_type_id,e?.entity?.entityType?.id,e?.entity?.entityType?.entity_type_id];for(const s of n)if(s)return String(s);return""},vz=(e,n=new Map)=>{if(e?.entity?.entityType?.name)return e.entity.entityType.name;const s=Xy(e);return s&&n.has(s)?n.get(s):""},Il=e=>{const n=[e?.locationId,e?.location_id,e?.location?.id];for(const s of n)if(s)return String(s);return""},pN=e=>e?.location?.name?e.location.name:typeof e?.locationName=="string"&&e.locationName.trim()?e.locationName:"Unnamed location",Wy=e=>{const n=[e?.location?.locationTypeId,e?.location?.location_type_id,e?.location?.locationType?.id,e?.location?.locationType?.location_type_id];for(const s of n)if(s)return String(s);return""},Sz=(e,n=new Map)=>{if(e?.location?.locationType?.name)return e.location.locationType.name;const s=Wy(e);return s&&n.has(s)?n.get(s):""},Qp=e=>!!Il(e);function wz(){const{selectedCampaign:e,selectedCampaignId:n}=jn(),{user:s}=un(),[i,l]=u.useState({items:[],loading:!1,error:""}),[o,d]=u.useState(""),[m,p]=u.useState(""),[h,y]=u.useState(""),[g,x]=u.useState(null),[v,S]=u.useState(""),[N,E]=u.useState("private"),[j,A]=u.useState(""),[T,_]=u.useState(!1),[M,k]=u.useState(null),[C,D]=u.useState(""),[z,G]=u.useState([]),[U,X]=u.useState(!1),[V,R]=u.useState(""),[B,L]=u.useState([]),[O,$]=u.useState(!1),[F,H]=u.useState([]),[I,Y]=u.useState(!1),P=u.useCallback(async()=>{if(n){l(J=>({...J,loading:!0,error:""}));try{const[J,le]=await Promise.all([Kk(n).catch(ze=>(console.error("Failed to load entity notes",ze),{data:[]})),Xk(n).catch(ze=>(console.error("Failed to load location notes",ze),{data:[]}))]),fe=Array.isArray(J?.data)?J.data:Array.isArray(J)?J:[],Ue=Array.isArray(le?.data)?le.data:Array.isArray(le)?le:[],qe=[...fe,...Ue];l({items:qe,loading:!1,error:""})}catch(J){console.error(" Failed to load campaign notes",J),l({items:[],loading:!1,error:J?.message||"Failed to load notes"})}}},[n]);u.useEffect(()=>{if(!n){l({items:[],loading:!1,error:""});return}P()},[n,P]),u.useEffect(()=>{d(""),p(""),y(""),x(null),S(""),E("private"),A(""),D("")},[n]);const re=u.useMemo(()=>!e||!s?.id?null:(Array.isArray(e.members)?e.members:[]).find(fe=>{if(!fe)return!1;const Ue=fe.user_id??fe.userId??fe.user?.id??fe.id??null;return Ue?String(Ue)===String(s.id):!1})||null,[e,s?.id])?.role??null,W=u.useMemo(()=>s?.role==="system_admin"?!0:re==="dm",[re,s?.role]),ue=u.useMemo(()=>re==="player",[re]),Q=u.useMemo(()=>e?.world?.id?e.world.id:e?.world_id?e.world_id:"",[e]);u.useEffect(()=>{let J=!1;return Q?((async()=>{$(!0);try{const fe=await br({worldId:Q});if(J)return;const qe=(Array.isArray(fe?.data)?fe.data:Array.isArray(fe)?fe:[]).map(ze=>({id:ze?.id?String(ze.id):"",name:ze?.name||"Unnamed type"})).filter(ze=>ze.id);L(qe)}catch(fe){if(J)return;console.error("Failed to load entity types",fe),L([])}finally{J||$(!1)}})(),()=>{J=!0}):(L([]),$(!1),()=>{J=!0})},[Q]),u.useEffect(()=>{let J=!1;return Q?((async()=>{Y(!0);try{const fe=await Pi({worldId:Q});if(J)return;const qe=(Array.isArray(fe?.data)?fe.data:Array.isArray(fe)?fe:[]).map(ze=>({id:ze?.id?String(ze.id):"",name:ze?.name||"Unnamed type"})).filter(ze=>ze.id);H(qe)}catch(fe){if(J)return;console.error("Failed to load location types",fe),H([])}finally{J||Y(!1)}})(),()=>{J=!0}):(H([]),Y(!1),()=>{J=!0})},[Q]);const ye=u.useMemo(()=>W?gz:yz,[W]),ae=u.useCallback(J=>{if(!s||!J)return!1;const le=J?.author?.id??J?.createdBy??J?.created_by??J?.authorId??J?.author_id??null;return le?String(le)===String(s.id):!1},[s]);u.useEffect(()=>{let J=!1;return!ue||!n?(G([]),X(!1),R(""),A(""),()=>{J=!0}):((async()=>{X(!0),R("");try{const fe=await js({scope:"my",campaign_id:n});if(J)return;const qe=(Array.isArray(fe?.data)?fe.data:Array.isArray(fe)?fe:[]).map(ze=>({id:ze?.id?String(ze.id):"",name:ze?.name||"Unnamed character"})).filter(ze=>ze.id);G(qe),qe.length===1?A(qe[0].id):qe.some(ze=>ze.id===j)||A("")}catch(fe){if(J)return;console.error("Failed to load characters for notes",fe),G([]),A(""),R(fe.message||"Failed to load characters")}finally{J||X(!1)}})(),()=>{J=!0})},[ue,n,j]);const ke=u.useCallback(async(J,le)=>{const fe=J?.trim()??"";if(typeof le!="function")return;if(fe.length===0){le([]);return}let Ue="";if(g){const pt=i.items.find(bt=>bt?.id===g);pt&&(Ue=ji(pt))}if(Ue||(Ue=o||""),!Ue){le([]);return}const qe=i.items.find(pt=>ji(pt)===Ue),ze=qe?.entity?.world_id??qe?.entity?.world?.id??qe?.location?.world_id??qe?.location?.world?.id??"";if(!ze){le([]);return}const{searchMentions:Ce}=await si(async()=>{const{searchMentions:pt}=await import("./mentionSearch-D9Dt0xF8.js");return{searchMentions:pt}},[]);await Ce({worldId:ze,query:fe,limit:8,callback:le})},[o,i.items,g]),pe=u.useCallback(J=>{if(!J)return;const le=J?.characterId??J?.character_id??"";x(J.id),S(J?.content??""),E(J?.shareType??J?.share_type??"private"),A(le),D("")},[]),we=u.useCallback(()=>{x(null),S(""),E("private"),A(""),D("")},[]),ne=u.useCallback((J,le)=>{const fe=typeof le=="string"?le:typeof J?.target?.value=="string"?J.target.value:"";S(fe),D("")},[]),Le=u.useCallback(async J=>{if(!J||!n)return;const le=v.trim();if(!le){D("Please enter a note before saving");return}const fe=Qp(J),Ue=fe?null:ji(J),qe=fe?Il(J):null;if(!Ue&&!qe){D("Unable to determine entity or location for this note");return}const ze=J?.characterId??J?.character_id??"";if(ue&&ze&&!j){D("Select which character this note is for");return}_(!0),D("");try{const Ce={content:le,shareType:N,campaignId:n};ue&&j&&(Ce.characterId=j);const pt=fe?await bg(qe,J.id,Ce):await Rj(Ue,J.id,Ce),bt=pt?.data||pt;if(!bt)throw new Error("Note could not be updated");l(Ct=>{const Ze=Array.isArray(Ct?.items)?Ct.items.slice():[],ot=bt?.id;if(!ot)return Ct;const Tt=Ze.findIndex($t=>$t?.id===ot);if(Tt>=0){const $t=[...Ze];return $t[Tt]=bt,{items:$t,loading:!1,error:""}}return Ct}),we()}catch(Ce){console.error("Failed to update note",Ce),D(Ce.message||"Failed to update note")}finally{_(!1)}},[n,v,N,j,ue,we]),be=u.useCallback(async J=>{if(!J?.id||!n||!window.confirm("Are you sure you want to delete this note? This action cannot be undone."))return;const fe=Qp(J),Ue=fe?null:ji(J),qe=fe?Il(J):null;if(!Ue&&!qe){D("Unable to determine entity or location for this note");return}k(J.id),D("");try{fe?await xg(qe,J.id,{campaignId:n}):await Ij(Ue,J.id,{campaignId:n}),l(ze=>({items:(Array.isArray(ze?.items)?ze.items.slice():[]).filter(bt=>bt?.id!==J.id),loading:!1,error:""}))}catch(ze){console.error("Failed to delete note",ze),D(ze.message||"Failed to delete note")}finally{k(null)}},[n]),Oe=u.useCallback(J=>{const le=Oi(J?.content,J?.mentions);return le.length?le.map((fe,Ue)=>{if(fe.type==="mention"){if(fe.locationId){const Ce=`${J?.id||"note"}-mention-${Ue}`,pt=fe.locationName||"location";return t.jsxs("span",{className:"note-mention",children:["@",pt,t.jsx(fs,{locationId:fe.locationId,locationName:pt})]},Ce)}if(fe.entityId){const Ce=`${J?.id||"note"}-mention-${Ue}`,pt=fe.entityName||"entity";return t.jsxs("span",{className:"note-mention",children:["@",pt,t.jsx(Na,{entityId:fe.entityId,entityName:pt})]},Ce)}const qe=fe.locationName||fe.entityName||"mention",ze=`${J?.id||"note"}-mention-${Ue}`;return t.jsxs("span",{className:"note-mention",children:["@",qe]},ze)}return t.jsx("span",{className:"note-text",children:fe.text},`${J?.id||"note"}-text-${Ue}`)}):null},[]),Me=u.useMemo(()=>Array.isArray(i.items)?[...i.items].sort((J,le)=>{const fe=new Date(J?.created_at||J?.createdAt||0).getTime(),Ue=new Date(le?.created_at||le?.createdAt||0).getTime();return Number.isNaN(Ue)?-1:Number.isNaN(fe)?1:Ue-fe}):[],[i.items]),ut=u.useMemo(()=>{const J=new Map;return Me.forEach(le=>{const fe=ji(le),Ue=Il(le),qe=fe||Ue;if(!qe)return;const ze=fe?hN(le):pN(le),Ce=Ue?"[Location] ":"[Entity] ";J.has(qe)||J.set(qe,Ce+ze)}),Array.from(J.entries()).map(([le,fe])=>({id:le,name:fe})).sort((le,fe)=>le.name.localeCompare(fe.name,void 0,{sensitivity:"base"}))},[Me]),ht=u.useMemo(()=>{const J=new Map;return Me.forEach(le=>{const fe=Zp(le);if(!fe)return;const Ue=mN(le);J.has(fe)||J.set(fe,Ue)}),Array.from(J.entries()).map(([le,fe])=>({id:le,name:fe})).sort((le,fe)=>le.name.localeCompare(fe.name,void 0,{sensitivity:"base"}))},[Me]),_t=u.useMemo(()=>{const J=new Map;return B.forEach(le=>{le.id&&J.set(le.id,le.name)}),J},[B]),jt=u.useMemo(()=>{const J=new Map;return F.forEach(le=>{le.id&&J.set(le.id,le.name)}),J},[F]),ve=u.useMemo(()=>{const J=new Map;return Me.forEach(le=>{const fe=Xy(le),Ue=Wy(le),qe=fe||Ue;if(!qe)return;const ze=fe?vz(le,_t)||`Type ${fe.slice(0,8)}`:Sz(le,jt)||`Type ${Ue.slice(0,8)}`,Ce=Ue?"[Location] ":"[Entity] ";J.has(qe)||J.set(qe,Ce+ze)}),Array.from(J.entries()).map(([le,fe])=>({id:le,name:fe})).sort((le,fe)=>le.name.localeCompare(fe.name,void 0,{sensitivity:"base"}))},[Me,_t,jt]),tt=u.useMemo(()=>Me.filter(J=>{const le=ji(J),fe=Il(J),Ue=le||fe,qe=Zp(J),ze=Xy(J),Ce=Wy(J),pt=ze||Ce;return!(o&&Ue!==o||m&&qe!==m||h&&pt!==h)}),[Me,o,m,h]),st=u.useCallback(()=>{if(!s?.id)return;const J=String(s.id),le=ht.find(fe=>Me.find(qe=>Zp(qe)===fe.id&&ae(qe))!==void 0);le?(p(le.id),d("")):ht.some(fe=>fe.id===J)&&(p(J),d(""))},[s?.id,ht,Me,ae]),$e=e?.name??"",Ye=tt.length,mt=Me.length,ie=!!(o||m||h);return n?t.jsxs("div",{className:"notes-page",children:[t.jsxs("div",{className:"notes-header",children:[t.jsxs("div",{className:"notes-title",children:[t.jsx("h1",{children:"Entity & Location Notes"}),t.jsxs("p",{children:["Browse the notes created for entities and locations in the"," ",t.jsx("strong",{children:$e})," campaign, filter by entity/location or author, and jump back into the context of your adventures."]})]}),t.jsx("div",{className:"notes-actions",children:t.jsxs("button",{type:"button",className:"notes-action-button",onClick:P,disabled:i.loading,title:"Reload notes",children:[t.jsx(Ui,{size:16}),t.jsx("span",{children:i.loading?"Loading":"Reload"})]})})]}),t.jsxs("div",{className:"notes-filters",children:[t.jsxs("div",{className:"notes-filter-group",children:[t.jsx("label",{htmlFor:"entity-filter",children:"Entity / Location"}),t.jsxs("select",{id:"entity-filter",value:o,onChange:J=>d(J.target.value),disabled:i.loading||ut.length===0,children:[t.jsx("option",{value:"",children:"All entities & locations"}),ut.map(J=>t.jsx("option",{value:J.id,children:J.name},J.id))]})]}),t.jsxs("div",{className:"notes-filter-group",children:[t.jsx("label",{htmlFor:"author-filter",children:"Author"}),t.jsxs("select",{id:"author-filter",value:m,onChange:J=>p(J.target.value),disabled:i.loading||ht.length===0,children:[t.jsx("option",{value:"",children:"All authors"}),ht.map(J=>t.jsx("option",{value:J.id,children:J.name},J.id))]})]}),t.jsxs("div",{className:"notes-filter-group",children:[t.jsx("label",{htmlFor:"entity-type-filter",children:"Type"}),t.jsxs("select",{id:"entity-type-filter",value:h,onChange:J=>y(J.target.value),disabled:i.loading||ve.length===0,children:[t.jsx("option",{value:"",children:"All types"}),ve.map(J=>t.jsx("option",{value:J.id,children:J.name},J.id))]})]}),t.jsxs("button",{type:"button",className:"notes-action-button",onClick:()=>{d(""),p(""),y("")},disabled:!ie,children:[t.jsx(Sf,{size:16}),t.jsx("span",{children:"Reset filters"})]}),s?.id&&t.jsx("button",{type:"button",className:"notes-action-button",onClick:st,title:"Show only my notes",children:t.jsx("span",{children:"My notes"})})]}),t.jsxs("div",{className:"notes-meta",children:[t.jsxs("span",{children:["Showing ",t.jsx("strong",{children:Ye})," of ",t.jsx("strong",{children:mt})," ",mt===1?"note":"notes",ie?" (filtered)":""]}),i.loading&&t.jsx("span",{children:"Loading latest notes"})]}),i.error&&t.jsxs("div",{className:"notes-error",role:"alert",children:[t.jsxs("strong",{children:[t.jsx(Jn,{size:18})," Unable to load entity notes"]}),t.jsx("span",{children:i.error})]}),!i.loading&&!i.error&&tt.length===0&&t.jsxs("div",{className:"notes-empty",children:[t.jsx("strong",{children:"No notes to show"}),t.jsx("span",{children:mt===0?"No entity or location notes have been shared in this campaign yet.":"Adjust your filters to see more notes."})]}),C&&t.jsxs("div",{className:"notes-error",role:"alert",children:[t.jsxs("strong",{children:[t.jsx(Jn,{size:18})," Error"]}),t.jsx("span",{children:C})]}),tt.length>0&&t.jsx("div",{className:"notes-list",children:tt.map(J=>{const le=Qp(J),fe=le?null:ji(J),Ue=le?Il(J):null,qe=String(J?.shareType||J?.share_type||"private"),ze=J?.created_at||J?.createdAt,Ce=ze?new Date(ze):null,pt=xz(Ce),bt=Ce&&!Number.isNaN(Ce.getTime())?Ce.toISOString():"",Ct=mN(J),Ze=J?.character?.name??"",ot=le?null:hN(J),Tt=le?pN(J):null,$t=g===J?.id,Qt=ae(J),At=fe||Ue||"";return t.jsx("article",{className:"note-card",children:$t?t.jsxs("div",{className:"entity-notes-strict-edit-panel",style:{padding:"1rem"},children:[t.jsx(Pl,{value:v,onChange:ne,markup:"@[__display__](__id__)",placeholder:bz,className:"entity-note-mentions",inputProps:{className:"entity-notes-strict-textarea","aria-label":"Edit note content",rows:5,required:!0},children:t.jsx(ti,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(kt,qt)=>`@${qt}`,data:ke,appendSpaceOnAdd:!0})}),t.jsx("p",{style:{marginTop:"0.75rem",marginBottom:"0.5rem",fontWeight:600},children:"Share with"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"0.75rem"},children:ye.map(kt=>t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("input",{type:"radio",name:`entity-note-share-edit-${J.id}`,value:kt.value,checked:N===kt.value,onChange:()=>E(kt.value),disabled:T}),kt.value==="private"?"Private":kt.value==="party"?"Share with Party":kt.label]},kt.value))}),ue&&z.length>0&&t.jsxs("div",{style:{marginBottom:"0.75rem"},children:[t.jsx("label",{htmlFor:`edit-character-${J.id}`,style:{display:"block",marginBottom:"0.25rem",fontWeight:600},children:"Character"}),t.jsx("select",{id:`edit-character-${J.id}`,value:j,onChange:kt=>A(kt.target.value),disabled:U||z.length===1,style:{width:"100%",padding:"0.5rem",borderRadius:"8px",border:"1px solid #cbd5f5"},children:z.map(kt=>t.jsx("option",{value:kt.id,children:kt.name},kt.id))})]}),C?t.jsxs("div",{className:"notes-error",style:{marginTop:"0.75rem",marginBottom:"0.75rem"},children:[t.jsx(Jn,{size:16}),t.jsx("span",{children:C})]}):null,t.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.75rem"},children:[t.jsx("button",{type:"button",className:"notes-action-button",onClick:()=>Le(J),disabled:T||!v.trim(),children:T?t.jsxs(t.Fragment,{children:[t.jsx(mn,{className:"spin",size:16,style:{animation:"spinner-rotate 1s linear infinite"}}),"Saving"]}):"Save"}),t.jsx("button",{type:"button",className:"notes-action-button",onClick:we,disabled:T,style:{background:"#64748b"},children:"Cancel"})]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("header",{className:"note-card-header",children:[t.jsx("div",{className:"note-entity-meta",children:t.jsx("h2",{children:le?Ue?t.jsxs("span",{className:"entity-link-with-preview",children:[t.jsx(Yt,{to:`/locations/${Ue}`,className:"entity-name-link",children:Tt}),t.jsx(fs,{locationId:Ue,locationName:Tt})]}):Tt:fe?t.jsxs("span",{className:"entity-link-with-preview",children:[t.jsx(Yt,{to:`/entities/${fe}`,className:"entity-name-link",children:ot}),t.jsx(Na,{entityId:fe,entityName:ot})]}):ot})}),t.jsx("div",{className:"note-tags",children:t.jsx("span",{className:`note-tag share-${qe}`,children:pz[qe]??qe})})]}),t.jsxs("div",{className:"note-details",children:[t.jsxs("span",{children:["Author: ",Ct]}),Ze?t.jsxs("span",{children:["Character: ",Ze]}):null,pt?t.jsxs("span",{children:["Created:"," ",t.jsx("time",{dateTime:bt||void 0,children:pt})]}):null]}),t.jsx("div",{className:"note-content",children:Oe(J)||t.jsx(Ky,{content:J?.content,mentions:J?.mentions,noteId:J?.id||fe||"note",textClassName:"note-text",mentionClassName:"note-mention"})}),Qt&&t.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",paddingTop:"0.75rem",borderTop:"1px solid rgba(15, 23, 42, 0.1)"},children:[t.jsxs("button",{type:"button",className:"notes-action-button",onClick:()=>pe(J),style:{background:"#1e40af",color:"#fff"},children:[t.jsx(mj,{size:14}),t.jsx("span",{children:"Edit"})]}),t.jsxs("button",{type:"button",className:"notes-action-button",onClick:()=>be(J),disabled:M===J.id,style:{background:"#dc2626",color:"#fff"},children:[M===J.id?t.jsx(mn,{size:14,className:"spin",style:{animation:"spinner-rotate 1s linear infinite"}}):t.jsx(zn,{size:14}),t.jsx("span",{children:M===J.id?"Deleting":"Delete"})]})]})]})},J.id??`${At}-${bt||"unknown"}`)})})]}):t.jsxs("div",{className:"notes-page",children:[t.jsx("div",{className:"notes-header",children:t.jsxs("div",{className:"notes-title",children:[t.jsx("h1",{children:"Entity & Location Notes"}),t.jsx("p",{children:"Select a campaign from the header to view entity and location notes."})]})}),t.jsxs("div",{className:"notes-empty",children:[t.jsx("strong",{children:"No campaign selected"}),t.jsx("span",{children:"Pick a campaign to explore its shared entity notes."})]})]})}const Nz=(e,n)=>Et.post("/access/bulk/apply",e,n),jz=({worldId:e})=>{if(!e)return Promise.reject(new Error("worldId is required"));const n=new URLSearchParams({worldId:e});return Et.get(`/access/bulk/runs?${n.toString()}`)},Ez=e=>e?Et.get(`/access/bulk/runs/${e}`):Promise.reject(new Error("runId is required")),_z=e=>e?Et.post(`/access/bulk/runs/${e}/revert`):Promise.reject(new Error("runId is required")),g_=e=>{if(!e)return Promise.reject(new Error("worldId is required"));const n=new URLSearchParams({worldId:e});return Et.get(`/access/collections?${n.toString()}`)},Cz=e=>Et.post("/access/collections",e),Az=(e,n)=>e?Et.put(`/access/collections/${e}`,n):Promise.reject(new Error("Collection id is required")),Tz=e=>e?Et.delete(`/access/collections/${e}`):Promise.reject(new Error("Collection id is required")),Mz=e=>e?Et.get(`/access/collections/${e}/entities`):Promise.reject(new Error("Collection id is required")),ur=1e3,ya={NAME:"name",NAME_DESCRIPTION:"nameDescription",ALL_DATA:"allData",ALL_DATA_RELATIONSHIPS:"allDataRelationships"},Vd=[{value:ya.NAME,label:"Name only",description:"Matches entity names only."},{value:ya.NAME_DESCRIPTION,label:"Name & description",description:"Matches entity names and their descriptions."},{value:ya.ALL_DATA,label:"All data",description:"Matches names, descriptions, and visible data fields."},{value:ya.ALL_DATA_RELATIONSHIPS,label:"All data & relationships",description:"Matches every field plus reference values, ideal for relationship lookups."}],yN={[ya.NAME]:"Filter entities by name",[ya.NAME_DESCRIPTION]:"Search names or descriptions",[ya.ALL_DATA]:"Search names, descriptions, and data fields",[ya.ALL_DATA_RELATIONSHIPS]:"Search across data and related entities"},gN=140,vc=(e,n)=>{if(n==null||typeof n=="number"&&!Number.isFinite(n))return;const i=(n instanceof Date?n.toISOString():String(n)).trim().toLowerCase();i&&e.add(i)},Zy=(e,n,s)=>{if(e!=null){if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"){vc(s,e);return}if(e instanceof Date){vc(s,e);return}if(Array.isArray(e)){e.forEach(i=>Zy(i,n,s));return}n&&typeof e=="object"&&Object.values(e).forEach(i=>Zy(i,n,s))}},kz=(e,n)=>{if(!e)return[];const s=n&&Vd.some(l=>l.value===n)?n:ya.NAME,i=new Set;return vc(i,e.name),s!==ya.NAME&&vc(i,e.description),(s===ya.ALL_DATA||s===ya.ALL_DATA_RELATIONSHIPS)&&(vc(i,e.entityType?.name),e.metadata&&typeof e.metadata=="object"&&Zy(e.metadata,s===ya.ALL_DATA_RELATIONSHIPS,i)),Array.from(i)},bN=(e,n="start")=>{if(!e)return null;const s=new Date(e);return Number.isNaN(s.getTime())?null:(n==="end"?s.setHours(23,59,59,999):s.setHours(0,0,0,0),s.getTime())},xN=e=>{if(!e)return"";const n=new Date(e);return Number.isNaN(n.getTime())?"":n.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})},Rz=e=>{if(!e)return"";const n=xN(e.updatedAt||e.updated_at);if(n)return`Updated ${n}`;const s=xN(e.createdAt||e.created_at);return s?`Created ${s}`:""},Iz=e=>{if(!e)return"";const n=e.summary||e.summary_text||e.description||e.system_prompt||e.notes||"",s=typeof n=="string"?n.replace(/\s+/g," ").trim():"";return s?s.length<=gN?s:`${s.slice(0,gN-1).trim()}`:""},oc=({label:e,count:n,options:s=[],selectedValues:i=[],onToggle:l,disabled:o})=>{const d=m=>{o||l(String(m))};return t.jsxs("div",{className:"token-selector",children:[t.jsxs("div",{className:"token-selector__label-row",children:[t.jsx("span",{children:e}),t.jsxs("span",{className:"token-selector__count",children:["(",n,")"]})]}),t.jsx("div",{className:"token-selector__chips",role:"listbox","aria-multiselectable":!0,children:s.length===0?t.jsx("p",{className:"token-selector__empty",children:"No options available."}):s.map(m=>{const p=String(m.id),h=i.includes(p);return t.jsx("button",{type:"button",className:`token-selector__chip ${h?"selected":""}`,onClick:()=>d(p),"aria-pressed":h,disabled:o,children:m.label},p)})})]})},Hr=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],Jp=(e,n="name")=>e.map(s=>({id:String(s.id??s.value??s),label:s[n]||s.name||s.email||s.id})),vN=e=>{const n=e.filter(s=>s.count>0).map(s=>`${s.count} ${s.label}${s.count===1?"":"s"}`);return n.length===0?"":n.length===1?n[0]:n.length===2?`${n[0]} and ${n[1]}`:`${n.slice(0,-1).join(", ")}, and ${n[n.length-1]}`};function SN(){const{worldId:e,campaignId:n}=Wa(),s=Mn(),{user:i}=un(),{selectedCampaign:l,selectedCampaignId:o,setSelectedCampaignId:d,loading:m}=jn(),[p,h]=u.useState(null),[y,g]=u.useState(""),[x,v]=u.useState(!0),[S,N]=u.useState([]),[E,j]=u.useState([]),[A,T]=u.useState([]),[_,M]=u.useState([]),[k,C]=u.useState(!1),[D,z]=u.useState(""),[G,U]=u.useState(""),[X,V]=u.useState(ya.NAME),[R,B]=u.useState(""),[L,O]=u.useState(""),[$,F]=u.useState([]),[H,I]=u.useState(!1),[Y,P]=u.useState(""),[K,re]=u.useState(null),[W,ue]=u.useState({readCampaignIds:[],readUserIds:[],readCharacterIds:[],writeCampaignIds:[],writeUserIds:[],description:""}),[Q,ye]=u.useState("unchanged"),[ae,ke]=u.useState("unchanged"),[pe,we]=u.useState(!1),[ne,Le]=u.useState("manual"),[be,Oe]=u.useState([]),[Me,ut]=u.useState(!1),[ht,_t]=u.useState(""),[jt,ve]=u.useState(""),[tt,st]=u.useState(null),[$e,Ye]=u.useState(!1),mt=!!n,ie=n?String(n):"",J=u.useMemo(()=>!mt||!ie||!o?!1:String(o)===ie,[mt,ie,o]),le=mt&&J?l:null,fe=e||le?.world?.id||"";u.useEffect(()=>{!mt||!ie||String(o||"")!==ie&&d(ie)},[mt,ie,o,d]);const Ue=u.useMemo(()=>mt||!p||!i?!1:String(p.created_by)===String(i.id),[mt,p,i]),qe=u.useMemo(()=>!mt||!le||!i?.id||!Array.isArray(le.members)?!1:le.members.some(He=>He?.user_id===i.id&&He?.role==="dm"),[le,mt,i]),ze=!!(mt&&le&&qe),Ce=Ue||ze;u.useEffect(()=>{if(!fe||!Ce){Oe([]),_t(""),ve(""),st(null);return}let He=!1;return(async()=>{ut(!0),_t("");try{const St=await g_(fe),ee=Hr(St);He||Oe(ee)}catch(St){He||(console.error("Failed to load collections",St),Oe([]),_t(St.message||"Failed to load collections"))}finally{He||ut(!1)}})(),()=>{He=!0}},[fe,Ce]),u.useEffect(()=>{if(mt){if(!ie){g("Campaign id is required to use this tool."),v(!1);return}if(!le){if(m){v(!0);return}g("Campaign not found or unavailable for your account."),v(!1);return}h(le.world||null),g(""),v(!1);return}if(!e){g("A world id is required to use the bulk access tool."),v(!1);return}(async()=>{v(!0),g("");try{const Je=await Xl(),ee=Hr(Je).find(xe=>String(xe.id)===String(e));if(!ee){g("World not found or unavailable."),h(null);return}h(ee)}catch(Je){console.error("Failed to load worlds",Je),g(Je.message||"Failed to load world data"),h(null)}finally{v(!1)}})()},[le,m,mt,ie,e]);const pt=u.useCallback(async()=>{if(!(!fe||!Ce)){C(!0),z("");try{if(mt&&le){const[He,Je]=await Promise.all([_c(fe),js({campaign_id:le.id})]);N(Hr(He)),j([le]),T(Hr(Je));const St=Array.isArray(le.members)?le.members.map(ee=>({id:String(ee.user_id),username:ee.user?.username||ee.user?.email||ee.user_id})):[];M(St)}else{const[He,Je,St,ee]=await Promise.all([_c(fe),qc({world_id:fe}),js({world_id:fe}),Rg()]);N(Hr(He)),j(Hr(Je)),T(Hr(St)),M(Hr(ee))}}catch(He){console.error("Failed to load bulk access data",He),z(He.message||"Unable to load world data")}finally{C(!1)}}},[le,Ce,mt,fe]);u.useEffect(()=>{pt()},[pt]);const bt=u.useMemo(()=>mt?new Set((A||[]).map(He=>String(He.id))):new Set,[A,mt]),Ct=u.useMemo(()=>{if(!mt)return S;if(!le)return[];const He=String(le.id);return S.filter(Je=>(Je.read_access??"global")==="global"||(Array.isArray(Je.read_campaign_ids)?Je.read_campaign_ids.map(Ie=>String(Ie)):[]).includes(He)?!0:(Array.isArray(Je.read_character_ids)?Je.read_character_ids.map(Ie=>String(Ie)):[]).some(Ie=>bt.has(Ie)))},[le,bt,S,mt]);u.useEffect(()=>{const He=new Set(Ct.map(Je=>Je.id));F(Je=>{const St=Je.filter(ee=>He.has(ee));return St.length===Je.length?Je:St})},[Ct]);const Ze=u.useMemo(()=>{const He=G.trim().toLowerCase(),Je=bN(R,"start"),St=bN(L,"end");return Ct.filter(ee=>{const xe=ee.createdAt??ee.created_at??null;if(Je!==null||St!==null){if(!xe)return!1;const et=new Date(xe).getTime();if(Number.isNaN(et)||Je!==null&&et<Je||St!==null&&et>St)return!1}if(!He)return!0;const Ie=kz(ee,X);return Ie.length?Ie.some(et=>et.includes(He)):!1})},[Ct,G,X,R,L]),ot=u.useMemo(()=>Vd.find(He=>He.value===X),[X]),Tt=yN[X]||yN[ya.NAME],$t=He=>{const Je=He.target.value,St=Vd.some(ee=>ee.value===Je);V(St?Je:ya.NAME)},Qt=()=>{B(""),O("")};u.useEffect(()=>{if(!mt||!le)return;const He=String(le.id),Je=new Set([He]),St=new Set((_||[]).map(xe=>String(xe.id))),ee=new Set((A||[]).map(xe=>String(xe.id)));ue(xe=>{const Ie=(Ft,zt)=>Ft.filter(dn=>zt.has(String(dn))),et=Ie(xe.readCampaignIds,Je),Nt=Ie(xe.writeCampaignIds,Je),Rt=Ie(xe.readUserIds,St),nn=Ie(xe.writeUserIds,St),Pt=Ie(xe.readCharacterIds,ee);return et.length===xe.readCampaignIds.length&&Nt.length===xe.writeCampaignIds.length&&Rt.length===xe.readUserIds.length&&nn.length===xe.writeUserIds.length&&Pt.length===xe.readCharacterIds.length?xe:{...xe,readCampaignIds:et,writeCampaignIds:Nt,readUserIds:Rt,writeUserIds:nn,readCharacterIds:Pt}})},[le,A,mt,_]);const At=$.length,kt=At>=ur,qt=At>0;u.useEffect(()=>{At===0&&we(!1)},[At]);const Lt=He=>{P(""),F(Je=>Je.includes(He)?Je.filter(St=>St!==He):Je.length>=ur?(P(`You can only select ${ur} entities at a time.`),Je):[...Je,He])},ce=()=>{P(""),F(He=>{const Je=new Set(He);for(const St of Ze){if(Je.size>=ur)break;Je.add(St.id)}return Je.size>ur&&P(`Selection capped at ${ur} entities.`),Array.from(Je)})},Ae=()=>{F([]),P(""),ne==="collection"&&(ve(""),st(null))},Te=He=>{const Je=He.target.value;Le(Je),P(""),Je==="manual"?(ve(""),st(null)):F([])},Ke=async He=>{const Je=He.target.value;if(ve(Je),st(null),P(""),!Je){F([]);return}Ye(!0);try{const St=await Mz(Je),ee=St?.data||St,xe=Array.isArray(ee?.entityIds)?ee.entityIds:[];F(xe),st({entityIds:xe,entityCount:ee?.entityCount??xe.length,totalCount:ee?.totalCount??xe.length,truncated:!!ee?.truncated}),ee?.truncated&&P(`Only the first ${ur} entities were loaded from this collection.`)}catch(St){console.error("Failed to resolve collection entities",St),P(St.message||"Failed to load collection entities"),F([]),st(null)}finally{Ye(!1)}},Se=He=>{const{value:Je}=He.target;ue(St=>({...St,description:Je}))},Be=He=>Je=>{const St=Je.target.value;He==="read"?(ye(St),St==="unchanged"&&ue(ee=>({...ee,readCampaignIds:[],readUserIds:[],readCharacterIds:[]}))):(ke(St),St==="unchanged"&&ue(ee=>({...ee,writeCampaignIds:[],writeUserIds:[]})))},We=He=>Je=>{const St=String(Je);ue(ee=>{const xe=ee[He]||[],et=xe.includes(St)?xe.filter(Nt=>Nt!==St):[...xe,St];return{...ee,[He]:et}})},se=Q==="activated",Z=ae==="activated",Ee=u.useMemo(()=>se?W.readCampaignIds.length+W.readUserIds.length+W.readCharacterIds.length>0:!1,[W,se]),_e=u.useMemo(()=>Z?W.writeCampaignIds.length+W.writeUserIds.length>0:!1,[W,Z]),ge=se||Z,Pe=u.useMemo(()=>{if(!se)return"";const He=vN([{label:"campaign",count:W.readCampaignIds.length},{label:"user",count:W.readUserIds.length},{label:"character",count:W.readCharacterIds.length}]);return He?`You will add read access for ${He}.`:""},[W,se]),oe=u.useMemo(()=>{if(!Z)return"";const He=vN([{label:"campaign",count:W.writeCampaignIds.length},{label:"user",count:W.writeUserIds.length}]);return He?`You will add write access for ${He}.`:""},[W,Z]),at=Ce&&$.length>0&&ge&&!H,dt=async He=>{if(He.preventDefault(),!Ce){P("You do not have permission to apply bulk access updates.");return}if(!$.length){P("Select at least one entity to continue.");return}if(!ge){P("Select at least one access type to update.");return}if(se&&!Ee){P("Add at least one read campaign, character, or user.");return}if(Z&&!_e){P("Add at least one campaign or user to grant write access.");return}const Je={entityIds:$,readAccess:se?"selective":"unchanged",writeAccess:Z?"selective":"unchanged",readCampaignIds:se?W.readCampaignIds:[],readUserIds:se?W.readUserIds:[],readCharacterIds:se?W.readCharacterIds:[],writeCampaignIds:Z?W.writeCampaignIds:[],writeUserIds:Z?W.writeUserIds:[],description:W.description};I(!0),P(""),re(null);try{const St=await Nz(Je,{includeCampaignContext:!!(mt&&le)}),ee=St?.data||St;re({runId:ee.runId,count:ee.count})}catch(St){console.error("Failed to apply bulk access",St),P(St.message||"Unable to apply bulk access update")}finally{I(!1)}},xt=u.useMemo(()=>mt&&le?[{id:String(le.id),label:le.name}]:Jp(E),[le,E,mt]),de=u.useMemo(()=>Jp(_,"username"),[_]),it=u.useMemo(()=>Jp(A),[A]),nt=u.useMemo(()=>{const He=new Map;return S.forEach(Je=>{He.set(Je.id,Je)}),He},[S]),vt=u.useMemo(()=>!tt||!Array.isArray(tt.entityIds)?[]:tt.entityIds.slice(0,10).map(He=>nt.get(He)?.name||He),[tt,nt]);if(x)return t.jsx("div",{className:"bulk-access-page",children:t.jsxs("p",{className:"bulk-access-helper",children:[t.jsx(mn,{className:"spin",size:16})," Loading world context"]})});if(y)return t.jsxs("div",{className:"bulk-access-page",children:[t.jsxs("div",{className:"bulk-access-alert error",children:[t.jsx(Da,{size:16})," ",y]}),t.jsx("button",{type:"button",className:"link-button",onClick:()=>s(-1),children:"Go back"})]});if(!Ce){const He=mt?"Only a DM for this campaign can access this tool.":"Only the world owner can access this tool.";return t.jsx("div",{className:"bulk-access-page",children:t.jsxs("div",{className:"bulk-access-alert warning",children:[t.jsx(Da,{size:16})," ",He]})})}const lt=mt?"Campaign Admin  Access":"World Admin  Manual Access",wt=mt?le?.name:p?.name;return t.jsxs("div",{className:"bulk-access-page",children:[t.jsxs("div",{className:"bulk-access-header",children:[t.jsxs("div",{children:[t.jsx("p",{className:"bulk-access-eyebrow",children:lt}),t.jsxs("h1",{children:["Bulk Access Editor  ",wt||""]})]}),Ue&&t.jsx("div",{className:"bulk-access-header-actions",children:t.jsx(Yt,{to:`/worlds/${e}/access/audit`,className:"ghost-button",children:"View audit log"})})]}),t.jsx("p",{className:"bulk-access-helper bulk-access-topline",children:"This tool adds access to selected entities. It does not remove current access."}),ze&&le&&t.jsxs("div",{className:"bulk-access-context-banner",children:["You are updating access in Campaign: ",t.jsx("strong",{children:le.name})]}),D&&t.jsxs("div",{className:"bulk-access-alert warning",children:[t.jsx(Da,{size:16})," ",D]}),K&&t.jsxs("div",{className:"bulk-access-alert success",children:[t.jsx(vf,{size:16})," Applied access updates to ",K.count," entities  Run ",K.runId,Ue&&t.jsx(Yt,{to:`/worlds/${e}/access/audit`,className:"inline-link",children:"Review run"})]}),Y&&t.jsxs("div",{className:"bulk-access-alert error",children:[t.jsx(Da,{size:16})," ",Y]}),t.jsxs("div",{className:"bulk-access-grid",children:[t.jsxs("section",{className:"bulk-access-card",children:[t.jsxs("header",{children:[t.jsxs("h2",{children:[t.jsx(Nk,{size:18})," Choose entities (",At,"/",ur,")"]}),t.jsxs("div",{className:"bulk-access-entity-actions",children:[!pe&&t.jsx("button",{type:"button",className:"ghost-button",onClick:ce,disabled:kt||ne!=="manual",children:"Select filtered"}),t.jsx("button",{type:"button",className:"ghost-button",onClick:Ae,children:"Clear selection"}),qt&&t.jsx("button",{type:"button",className:"ghost-button",onClick:()=>we(He=>!He),children:pe?"Expand":"Collapse"})]})]}),pe?t.jsx("div",{className:"bulk-access-entity-collapsed-summary",children:t.jsxs("p",{children:[t.jsx("strong",{children:At})," ",At===1?"entity":"entities"," selected."]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"bulk-access-selection-mode",children:[t.jsxs("label",{children:[t.jsx("input",{type:"radio",value:"manual",checked:ne==="manual",onChange:Te}),"Select manually"]}),t.jsxs("label",{children:[t.jsx("input",{type:"radio",value:"collection",checked:ne==="collection",onChange:Te}),"Use collection"]})]}),ne==="collection"?t.jsxs("div",{className:"bulk-access-collection-panel",children:[Me&&t.jsxs("p",{className:"bulk-access-helper",children:[t.jsx(mn,{className:"spin",size:16})," Loading collections"]}),!Me&&ht&&t.jsx("p",{className:"bulk-access-helper warning",children:ht}),!Me&&!ht&&be.length===0&&t.jsxs("p",{className:"bulk-access-helper",children:["No collections available.",Ue&&!mt&&e&&t.jsxs(t.Fragment,{children:[" ",t.jsx(Yt,{to:`/worlds/${e}/collections`,className:"inline-link",children:"Create one in the collections manager"}),"."]})]}),be.length>0&&t.jsxs("select",{value:jt,onChange:Ke,children:[t.jsx("option",{value:"",children:"Select a collection"}),be.map(He=>t.jsxs("option",{value:He.id,children:[He.name,"  ",He.entityCount??He.entity_ids?.length??0," entities"]},He.id))]}),$e&&t.jsxs("p",{className:"bulk-access-helper",children:[t.jsx(mn,{className:"spin",size:16})," Resolving collection"]}),tt&&t.jsxs("div",{className:"bulk-access-collection-preview",children:[t.jsxs("p",{children:[t.jsx("strong",{children:tt.entityCount})," entities selected from this collection."]}),tt.truncated&&t.jsxs("p",{className:"bulk-access-helper warning",children:["Only the first ",ur," entities can be updated at a time."]}),vt.length>0&&t.jsx("ul",{children:vt.map((He,Je)=>t.jsx("li",{children:He},`${He}-${Je}`))})]}),ne==="collection"&&Ue&&!mt&&e&&t.jsx(Yt,{to:`/worlds/${e}/collections`,className:"inline-link",children:"Manage collections"})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"entity-filter",children:[t.jsxs("div",{className:"entity-filter__row entity-filter__row--search",children:[t.jsxs("div",{className:"entity-filter__input",children:[t.jsx("label",{htmlFor:"bulk-access-entity-search",children:"Search"}),t.jsx("input",{id:"bulk-access-entity-search",type:"text",placeholder:Tt,value:G,onChange:He=>U(He.target.value)})]}),t.jsxs("div",{className:"entity-filter__scope",children:[t.jsx("label",{htmlFor:"bulk-access-entity-scope",children:"Search scope"}),t.jsx("select",{id:"bulk-access-entity-scope",value:X,onChange:$t,children:Vd.map(He=>t.jsx("option",{value:He.value,children:He.label},He.value))})]})]}),t.jsxs("div",{className:"entity-filter__row entity-filter__dates",children:[t.jsxs("div",{className:"entity-filter__date-field",children:[t.jsx("label",{htmlFor:"bulk-access-created-after",children:"Created after"}),t.jsx("input",{id:"bulk-access-created-after",type:"date",value:R,onChange:He=>B(He.target.value)})]}),t.jsxs("div",{className:"entity-filter__date-field",children:[t.jsx("label",{htmlFor:"bulk-access-created-before",children:"Created before"}),t.jsx("input",{id:"bulk-access-created-before",type:"date",value:L,onChange:He=>O(He.target.value)})]}),(R||L)&&t.jsx("button",{type:"button",className:"ghost-button entity-filter__clear-dates",onClick:Qt,children:"Clear dates"})]}),ot?.description&&t.jsx("p",{className:"bulk-access-helper",children:ot.description})]}),t.jsxs("div",{className:"entity-selector-list",children:[k&&t.jsxs("p",{className:"bulk-access-helper",children:[t.jsx(mn,{className:"spin",size:16})," Loading entities"]}),!k&&Ze.length===0&&t.jsx("p",{className:"bulk-access-helper",children:mt?"No entities are visible within this campaign context.":"No entities match the current filter."}),!k&&Ze.map(He=>{const Je=Rz(He),St=Iz(He);return t.jsxs("label",{className:"entity-row",children:[t.jsx("input",{type:"checkbox",checked:$.includes(He.id),onChange:()=>Lt(He.id),disabled:kt&&!$.includes(He.id)}),t.jsxs("div",{className:"entity-row__main",children:[t.jsx("span",{className:"entity-name",children:He.name}),t.jsxs("div",{className:"entity-row__meta",children:[He.entityType?.name&&t.jsx("span",{className:"entity-type",children:He.entityType.name}),Je&&t.jsx("span",{className:"entity-row__meta-text",children:Je})]}),St&&t.jsx("p",{className:"entity-row__summary",children:St})]}),t.jsx(Na,{entityId:He.id,entityName:He.name,className:"entity-row__preview"})]},He.id)})]})]})]})]}),t.jsxs("section",{className:"bulk-access-card bulk-access-card--form",children:[t.jsx("header",{children:t.jsx("h2",{children:"Access configuration"})}),t.jsxs("form",{className:"bulk-access-form",onSubmit:dt,children:[t.jsxs("div",{className:"access-section",children:[t.jsxs("div",{className:"access-section__header",children:[t.jsxs("div",{children:[t.jsx("p",{className:"access-section__eyebrow",children:"Step 1"}),t.jsx("h3",{children:"Read access"})]}),t.jsxs("label",{className:"access-mode-select",children:[t.jsx("span",{children:"Mode"}),t.jsxs("select",{value:Q,onChange:Be("read"),children:[t.jsx("option",{value:"unchanged",children:"Unchanged"}),t.jsx("option",{value:"activated",children:"Activated"})]})]})]}),t.jsx("p",{className:"bulk-access-helper access-helper-text",children:"This adds new access. It does not remove current access."}),se&&t.jsxs("div",{className:"access-section__content",children:[t.jsxs("div",{className:"access-section__grid",children:[t.jsx(oc,{label:"Read campaigns",count:W.readCampaignIds.length,options:xt,selectedValues:W.readCampaignIds,onToggle:We("readCampaignIds")}),t.jsx(oc,{label:"Read users",count:W.readUserIds.length,options:de,selectedValues:W.readUserIds,onToggle:We("readUserIds")})]}),t.jsx(oc,{label:"Read characters",count:W.readCharacterIds.length,options:it,selectedValues:W.readCharacterIds,onToggle:We("readCharacterIds")})]})]}),t.jsxs("div",{className:"access-section",children:[t.jsxs("div",{className:"access-section__header",children:[t.jsxs("div",{children:[t.jsx("p",{className:"access-section__eyebrow",children:"Step 2"}),t.jsx("h3",{children:"Write access"})]}),t.jsxs("label",{className:"access-mode-select",children:[t.jsx("span",{children:"Mode"}),t.jsxs("select",{value:ae,onChange:Be("write"),children:[t.jsx("option",{value:"unchanged",children:"Unchanged"}),t.jsx("option",{value:"activated",children:"Activated"})]})]})]}),t.jsx("p",{className:"bulk-access-helper access-helper-text",children:"This adds new access. It does not remove current access."}),Z&&t.jsx("div",{className:"access-section__content",children:t.jsxs("div",{className:"access-section__grid",children:[t.jsx(oc,{label:"Write campaigns",count:W.writeCampaignIds.length,options:xt,selectedValues:W.writeCampaignIds,onToggle:We("writeCampaignIds")}),t.jsx(oc,{label:"Write users",count:W.writeUserIds.length,options:de,selectedValues:W.writeUserIds,onToggle:We("writeUserIds")})]})})]}),t.jsxs("label",{className:"bulk-access-description",children:["Description (optional)",t.jsx("textarea",{name:"description",value:W.description,onChange:Se,rows:1,placeholder:"Explain why this access change was applied"})]}),t.jsxs("div",{className:"bulk-access-summary",children:[Pe&&t.jsx("p",{children:Pe}),oe&&t.jsx("p",{children:oe}),!Pe&&!oe&&t.jsx("p",{className:"bulk-access-helper",children:"No access changes selected yet."}),!ge&&t.jsx("p",{className:"bulk-access-helper warning",children:"Select at least one access type to update."}),se&&!Ee&&t.jsx("p",{className:"bulk-access-helper warning",children:"Add at least one read audience."}),Z&&!_e&&t.jsx("p",{className:"bulk-access-helper warning",children:"Add at least one write audience."})]}),t.jsxs("div",{className:"bulk-access-footer",children:[t.jsxs("div",{className:"bulk-access-footer__selection-info",children:[t.jsx("strong",{children:At})," ",At===1?"entity":"entities"," selected"]}),t.jsx("button",{type:"submit",className:"primary-button",disabled:!at||H,children:H?t.jsxs(t.Fragment,{children:[t.jsx(mn,{className:"spin",size:16})," Applying"]}):"Confirm and Apply"})]})]})]})]})]})}const wN=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],NN=e=>{if(!e)return"";try{return new Date(e).toLocaleString()}catch{return e}},Is=(e=[])=>!Array.isArray(e)||e.length===0?"":e.join(", ");function Dz(){const{worldId:e}=Wa(),n=Mn(),{user:s}=un(),[i,l]=u.useState(null),[o,d]=u.useState(""),[m,p]=u.useState(!0),[h,y]=u.useState([]),[g,x]=u.useState(!1),[v,S]=u.useState(""),[N,E]=u.useState(null),[j,A]=u.useState(!1),[T,_]=u.useState(""),[M,k]=u.useState(!1),[C,D]=u.useState(""),z=u.useMemo(()=>!i||!s?!1:String(i.created_by)===String(s.id),[i,s]);u.useEffect(()=>{if(!e){d("Missing world id"),p(!1);return}(async()=>{p(!0),d("");try{const L=await Xl(),$=wN(L).find(F=>String(F.id)===String(e));if(!$){d("World not found or unavailable"),l(null);return}l($)}catch(L){console.error("Failed to load worlds",L),d(L.message||"Unable to load world data"),l(null)}finally{p(!1)}})()},[e]);const G=u.useCallback(async B=>{if(B){S(B),A(!0),_("");try{const L=await Ez(B),O=L?.data||L;E(O)}catch(L){console.error("Failed to load run detail",L),_(L.message||"Unable to load run details"),E(null)}finally{A(!1)}}},[]),U=u.useCallback(async()=>{if(!(!e||!z)){x(!0),_("");try{const B=await jz({worldId:e}),L=wN(B);if(y(L),L.length===0){E(null),S("");return}(!v||!L.some(O=>O.id===v))&&await G(L[0].id)}catch(B){console.error("Failed to load bulk runs",B),_(B.message||"Unable to load audit runs"),y([])}finally{x(!1)}}},[G,z,v,e]);u.useEffect(()=>{U()},[U]);const X=async()=>{if(!(!v||!window.confirm("Revert this entire run? This cannot be undone."))){k(!0),_(""),D("");try{const B=await _z(v),L=B?.data||B;D(`Run ${L.runId} reverted successfully.`),await U(),await G(v)}catch(B){console.error("Failed to revert run",B),_(B.message||"Unable to revert run")}finally{k(!1)}}},V=B=>B?.reverted?"Reverted":"Active",R=(B,L,O)=>t.jsxs("div",{className:"audit-diff-row",children:[t.jsx("span",{className:"audit-diff-label",children:B}),t.jsxs("div",{className:"audit-diff-values",children:[t.jsx("span",{className:"old",children:L}),t.jsx(lj,{size:14}),t.jsx("span",{className:"new",children:O})]})]},B);return m?t.jsx("div",{className:"bulk-audit-page",children:t.jsxs("p",{className:"bulk-access-helper",children:[t.jsx(mn,{className:"spin",size:16})," Loading world context"]})}):o?t.jsxs("div",{className:"bulk-audit-page",children:[t.jsxs("div",{className:"bulk-access-alert error",children:[t.jsx(Da,{size:16})," ",o]}),t.jsx("button",{type:"button",className:"link-button",onClick:()=>n(-1),children:"Go back"})]}):z?t.jsxs("div",{className:"bulk-audit-page",children:[t.jsxs("div",{className:"bulk-access-header",children:[t.jsxs("div",{children:[t.jsx("p",{className:"bulk-access-eyebrow",children:"World Admin  Access Audit"}),t.jsxs("h1",{children:["Bulk Access Runs  ",i?.name]})]}),t.jsx("div",{className:"bulk-access-header-actions",children:t.jsx(Yt,{to:`/worlds/${e}/access/bulk`,className:"ghost-button",children:"Back to editor"})})]}),T&&t.jsxs("div",{className:"bulk-access-alert error",children:[t.jsx(Da,{size:16})," ",T]}),C&&t.jsxs("div",{className:"bulk-access-alert success",children:[t.jsx(pj,{size:16})," ",C]}),t.jsxs("div",{className:"bulk-audit-grid",children:[t.jsxs("section",{className:"bulk-access-card",children:[t.jsxs("header",{children:[t.jsxs("h2",{children:[t.jsx(uj,{size:18})," Audit runs (",h.length,")"]}),t.jsx("button",{type:"button",className:"ghost-button",onClick:U,disabled:g,children:g?t.jsxs(t.Fragment,{children:[t.jsx(mn,{className:"spin",size:14})," Refreshing"]}):"Refresh"})]}),t.jsxs("div",{className:"audit-run-list",children:[g&&t.jsxs("p",{className:"bulk-access-helper",children:[t.jsx(mn,{className:"spin",size:16})," Loading runs"]}),!g&&h.length===0&&t.jsx("p",{className:"bulk-access-helper",children:"No bulk access runs have been recorded for this world."}),!g&&h.map(B=>t.jsxs("button",{type:"button",className:`audit-run-row ${v===B.id?"active":""}`,onClick:()=>G(B.id),children:[t.jsxs("div",{children:[t.jsxs("p",{className:"audit-run-title",children:["Run ",B.id]}),t.jsxs("p",{className:"audit-run-meta",children:[NN(B.createdAt||B.created_at),"  ",B.change_count||B.entity_count||0," entities"]}),t.jsxs("p",{className:"audit-run-meta",children:[B.campaignContext?.name?`Campaign  ${B.campaignContext.name}`:"Scope  World"," ",B.role_used==="dm"?" DM run":" Owner run"]})]}),t.jsx("span",{className:`status-pill ${B.reverted?"reverted":"active"}`,children:V(B)})]},B.id))]})]}),t.jsxs("section",{className:"bulk-access-card",children:[t.jsxs("header",{children:[t.jsx("h2",{children:"Run details"}),N&&t.jsx("button",{type:"button",className:"ghost-button",onClick:X,disabled:N.reverted||M,children:M?t.jsxs(t.Fragment,{children:[t.jsx(mn,{className:"spin",size:14})," Reverting"]}):t.jsxs(t.Fragment,{children:[t.jsx(Ui,{size:14})," Revert run"]})})]}),!N&&t.jsx("p",{className:"bulk-access-helper",children:"Select a run to see the access changes."}),j&&t.jsxs("p",{className:"bulk-access-helper",children:[t.jsx(mn,{className:"spin",size:16})," Loading details"]}),N&&!j&&t.jsxs("div",{className:"audit-detail",children:[t.jsxs("div",{className:"audit-detail-meta",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Status:"})," ",N.reverted?"Reverted":"Active"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"User:"})," ",N.actor?.username||"Unknown user"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"User role:"})," ",N.role_used==="dm"?"Campaign DM":"World owner"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Scope:"})," ",N.campaignContext?.name||"World-wide"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Created:"})," ",NN(N.createdAt||N.created_at)]}),N.description&&t.jsxs("p",{children:[t.jsx("strong",{children:"Description:"})," ",N.description]})]}),t.jsx("div",{className:"audit-changes",children:N.changes?.map(B=>{const L=B.entity?.name||B.entity_id;return t.jsxs("div",{className:"audit-change-card",children:[t.jsxs("div",{className:"audit-change-header",children:[t.jsx("p",{className:"audit-change-title",children:L}),t.jsxs("span",{className:"audit-change-subtitle",children:["Entity ",B.entity_id]})]}),t.jsxs("div",{className:"audit-change-body",children:[R("Read access",B.old_read_access,B.entity?.read_access||""),R("Write access",B.old_write_access,B.entity?.write_access||""),R("Read campaigns",Is(B.old_read_campaign_names!==void 0?B.old_read_campaign_names:B.old_read_campaign_ids),Is(B.entity?.read_campaign_names!==void 0?B.entity.read_campaign_names:B.entity?.read_campaign_ids)),R("Read users",Is(B.old_read_user_names!==void 0?B.old_read_user_names:B.old_read_user_ids),Is(B.entity?.read_user_names!==void 0?B.entity.read_user_names:B.entity?.read_user_ids)),R("Read characters",Is(B.old_read_character_ids),Is(B.entity?.read_character_ids)),R("Write campaigns",Is(B.old_write_campaign_names!==void 0?B.old_write_campaign_names:B.old_write_campaign_ids),Is(B.entity?.write_campaign_names!==void 0?B.entity.write_campaign_names:B.entity?.write_campaign_ids)),R("Write users",Is(B.old_write_user_names!==void 0?B.old_write_user_names:B.old_write_user_ids),Is(B.entity?.write_user_names!==void 0?B.entity.write_user_names:B.entity?.write_user_ids))]})]},B.id)})})]})]})]})]}):t.jsx("div",{className:"bulk-audit-page",children:t.jsxs("div",{className:"bulk-access-alert warning",children:[t.jsx(Da,{size:16})," Only the world owner can view audit runs."]})})}const cc=1e3,ey=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],ty={name:"",description:"",shared:!1,entityIds:[]};function Lz(){const{worldId:e}=Wa(),n=Mn(),{user:s,sessionReady:i}=un(),[l,o]=u.useState(null),[d,m]=u.useState(!0),[p,h]=u.useState(""),[y,g]=u.useState(!1),[x,v]=u.useState([]),[S,N]=u.useState([]),[E,j]=u.useState(""),[A,T]=u.useState("view"),[_,M]=u.useState(""),[k,C]=u.useState(ty),[D,z]=u.useState(!1),[G,U]=u.useState(""),[X,V]=u.useState(""),[R,B]=u.useState(!1),[L,O]=u.useState(!1),[$,F]=u.useState(!1),[H,I]=u.useState(null),[Y,P]=u.useState(!1),K=u.useMemo(()=>{if(!l||!s)return!1;const $e=l.created_by||l.creator?.id||l.owner?.id||l.owner_id||null;return $e&&s.id&&String($e)===String(s.id)},[l,s]),re=u.useCallback(async()=>{if(e)try{const $e=await g_(e),Ye=ey($e);v(Ye)}catch($e){console.error("Failed to load collections",$e),h($e.message||"Failed to load collections")}},[e]),W=u.useCallback(async()=>{if(e)try{const $e=await _c(e),Ye=ey($e);N(Ye)}catch($e){console.error("Failed to load entities for world",$e),h($e.message||"Failed to load entities for this world")}},[e]);u.useEffect(()=>{if(!i||!e)return;(async()=>{m(!0),h(""),g(!1),o(null);try{const Ye=await Xl(),ie=ey(Ye).find(le=>String(le.id)===String(e));if(!ie){h("World not found or unavailable");return}o(ie);const J=ie.created_by||ie.creator?.id||ie.owner?.id||ie.owner_id||null;if(!s||!J||String(J)!==String(s.id)){g(!0);return}await Promise.all([re(),W()])}catch(Ye){console.error("Failed to load collections manager",Ye),h(Ye.message||"Failed to load collections manager")}finally{m(!1)}})()},[re,W,i,s,e]);const ue=$e=>Ye=>{const mt=$e==="shared"?Ye.target.checked:Ye.target.value;C(ie=>({...ie,[$e]:mt})),z(!0),U(""),V("")},Q=$e=>{U(""),V(""),C(Ye=>{const mt=new Set(Ye.entityIds||[]);if(mt.has($e))mt.delete($e);else{if(mt.size>=cc)return U(`Collections can include up to ${cc} entities.`),Ye;mt.add($e)}return z(!0),{...Ye,entityIds:Array.from(mt)}})},ye=u.useMemo(()=>{if(!E)return S;const $e=E.toLowerCase();return S.filter(Ye=>(Ye.name||"").toLowerCase().includes($e))},[S,E]),ae=u.useMemo(()=>[...x].sort(($e,Ye)=>$e.shared&&!Ye.shared?-1:Ye.shared&&!$e.shared?1:($e.name||"").localeCompare(Ye.name||"",void 0,{sensitivity:"base"})),[x]),ke=u.useCallback(()=>{M(""),C(ty),T("view"),z(!1),U(""),V("")},[]),pe=u.useCallback($e=>{$e&&(M($e.id),C({name:$e.name||"",description:$e.description||"",shared:!!$e.shared,entityIds:Array.isArray($e.entityIds)?$e.entityIds:[]}),T("edit"),z(!1),U(""),V(""))},[]),we=$e=>{if(D){I($e),F(!0);return}ne($e)},ne=$e=>{F(!1),I(null),$e&&($e.type==="select"?pe($e.payload):$e.type==="create"?(T("create"),M(""),C(ty),z(!1),U(""),V("")):$e.type==="close"&&ke())},Le=$e=>{we({type:"select",payload:$e,label:$e.name})},be=()=>{we({type:"create",label:"start a new collection"})},Oe=()=>{we({type:"close",label:"leave this editor"})},Me=()=>{F(!1),I(null)},ut=()=>{ne(H)},ht=u.useCallback(async()=>{if(!e)return U("A world id is required to save this collection."),!1;if(!k.name.trim())return U("Name is required."),!1;if(k.entityIds.length>cc)return U(`Collections can include up to ${cc} entities.`),!1;const $e={worldId:e,name:k.name.trim(),description:k.description,shared:k.shared,entityIds:k.entityIds};B(!0),U(""),V("");try{let Ye;A==="edit"&&_?Ye=await Az(_,$e):Ye=await Cz($e);const mt=Ye?.data||Ye;return mt?(v(ie=>{const J=ie.findIndex(le=>le.id===mt.id);if(J>=0){const le=[...ie];return le[J]=mt,le}return[...ie,mt]}),pe(mt),T("edit"),V("Collection saved successfully."),z(!1)):await re(),!0}catch(Ye){return console.error("Failed to save collection",Ye),U(Ye.message||"Failed to save collection"),!1}finally{B(!1)}},[pe,k,re,A,_,e]),_t=async $e=>{$e.preventDefault(),await ht()},jt=async()=>{if(_&&confirm("Delete this collection? This cannot be undone.")){O(!0),U(""),V("");try{await Tz(_),v($e=>$e.filter(Ye=>Ye.id!==_)),ke(),V("Collection deleted.")}catch($e){console.error("Failed to delete collection",$e),U($e.message||"Failed to delete collection")}finally{O(!1)}}},ve=async()=>{P(!0);const $e=await ht();P(!1),$e&&ne(H)};if(u.useEffect(()=>{const $e=Ye=>{D&&(Ye.preventDefault(),Ye.returnValue="")};return window.addEventListener("beforeunload",$e),()=>window.removeEventListener("beforeunload",$e)},[D]),!i)return t.jsx("p",{className:"collections-helper",children:"Restoring session"});if(!e)return t.jsx("p",{className:"collections-helper",children:"World id is required."});if(d)return t.jsx("div",{className:"collections-page",children:t.jsxs("p",{className:"collections-helper",children:[t.jsx(mn,{size:16,className:"spin"})," Loading collections"]})});if(p)return t.jsxs("div",{className:"collections-page",children:[t.jsxs("div",{className:"collections-alert error",children:[t.jsx(Da,{size:16})," ",p]}),t.jsx("button",{type:"button",className:"link-button",onClick:()=>n(-1),children:"Go back"})]});if(y||!K)return t.jsx("div",{className:"collections-page",children:t.jsxs("div",{className:"collections-alert warning",children:[t.jsx(Da,{size:16})," Only the world owner can manage collections."]})});const tt=l?.name||"",st=k.entityIds.length;return t.jsxs("div",{className:"collections-page",children:[t.jsxs("div",{className:"collections-header",children:[t.jsxs("div",{children:[t.jsx("p",{className:"collections-eyebrow",children:"World Admin  Collections"}),t.jsx("h1",{children:tt})]}),t.jsx("div",{className:"collections-header-actions",children:t.jsx("button",{type:"button",className:"primary-button",onClick:be,children:"New collection"})})]}),X&&t.jsxs("div",{className:"collections-alert success",children:[t.jsx(vf,{size:16})," ",X]}),G&&t.jsxs("div",{className:"collections-alert error",children:[t.jsx(Da,{size:16})," ",G]}),t.jsxs("div",{className:"collections-grid",children:[t.jsxs("section",{className:"collections-card",children:[t.jsxs("header",{children:[t.jsx("h2",{children:"Collections"}),t.jsxs("p",{className:"collections-helper",children:[x.length," saved  Shared sets are available to campaign DMs"]})]}),t.jsx("div",{className:"collections-table-wrapper",children:ae.length===0?t.jsx("p",{className:"collections-helper",children:"No collections yet. Create one to get started."}):t.jsxs("table",{className:"collections-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Name"}),t.jsx("th",{children:"Shared"}),t.jsx("th",{children:"Entities"}),t.jsx("th",{children:"Updated"})]})}),t.jsx("tbody",{children:ae.map($e=>{const Ye=_===$e.id;return t.jsxs("tr",{className:Ye?"active":"",onClick:()=>Le($e),children:[t.jsxs("td",{children:[t.jsx("span",{className:"collection-name",children:$e.name}),$e.description&&t.jsx("span",{className:"collection-description",children:$e.description})]}),t.jsx("td",{children:$e.shared?t.jsxs("span",{className:"shared-chip",children:[t.jsx(yj,{size:14})," Shared"]}):t.jsx("span",{className:"shared-chip private",children:"Owner only"})}),t.jsx("td",{children:$e.entityCount??$e.entity_ids?.length??0}),t.jsx("td",{children:$e.updatedAt?new Date($e.updatedAt).toLocaleString():""})]},$e.id)})})]})})]}),t.jsx("section",{className:"collections-card",children:A==="view"&&!_?t.jsx("div",{className:"collections-placeholder",children:t.jsx("p",{children:"Select a collection to edit or create a new one."})}):t.jsxs("form",{className:"collections-form",onSubmit:_t,children:[t.jsxs("header",{children:[t.jsx("h2",{children:A==="edit"?"Edit collection":"New collection"}),t.jsxs("p",{className:"collections-helper",children:[st,"/",cc," entities selected"]})]}),t.jsxs("label",{children:["Name",t.jsx("input",{type:"text",value:k.name,onChange:ue("name"),required:!0})]}),t.jsxs("label",{children:["Description (optional)",t.jsx("textarea",{value:k.description,onChange:ue("description"),rows:3})]}),t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:k.shared,onChange:ue("shared")}),"Share with DMs in this world"]}),t.jsxs("div",{className:"collections-entity-picker",children:[t.jsxs("div",{className:"collections-entity-toolbar",children:[t.jsx("span",{children:"Entities"}),t.jsx("input",{type:"text",placeholder:"Filter by name",value:E,onChange:$e=>j($e.target.value)})]}),t.jsx("div",{className:"collections-entity-list",children:ye.length===0?t.jsx("p",{className:"collections-helper",children:"No entities match this filter."}):t.jsx("ul",{children:ye.map($e=>{const Ye=k.entityIds.includes($e.id);return t.jsx("li",{children:t.jsxs("label",{children:[t.jsx("input",{type:"checkbox",checked:Ye,onChange:()=>Q($e.id)}),t.jsx("span",{className:"entity-name",children:$e.name}),t.jsx("span",{className:"entity-type",children:$e.entityType?.name||""})]})},$e.id)})})})]}),t.jsxs("div",{className:"collections-form-actions",children:[t.jsx("button",{type:"submit",className:"primary-button",disabled:R,children:R?"Saving":"Save collection"}),A==="edit"&&t.jsx("button",{type:"button",className:"ghost-button",onClick:jt,disabled:L,children:L?"Deleting":"Delete"}),t.jsx("button",{type:"button",className:"ghost-button",onClick:Oe,children:"Close"})]})]})})]}),t.jsx(b1,{open:$,destinationLabel:H?.label||"",saving:Y,onSaveAndContinue:ve,onContinueWithoutSaving:ut,onStay:Me})]})}function Oz(){const e=qs();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function $z(e,n="request"){if(e.status===401)throw new Error("Unauthorized");if(!e.ok){const s=await e.json().catch(()=>({message:"Unknown error"}));throw new Error(s.message||`Failed to ${n}`)}return e.json()}async function Fz(e,n){const s=await fetch(`${sn}/auth/change-password`,{method:"POST",headers:Oz(),body:JSON.stringify({currentPassword:e,newPassword:n})});return $z(s,"change password")}function zz(){const[e,n]=u.useState(""),[s,i]=u.useState(""),[l,o]=u.useState(""),[d,m]=u.useState(""),[p,h]=u.useState(""),[y,g]=u.useState(!1),x=async v=>{v.preventDefault(),m(""),h(""),g(!0);try{if(!e||!s||!l){m("All fields are required"),g(!1);return}if(s.length<6){m("New password must be at least 6 characters long"),g(!1);return}if(s!==l){m("New password and confirmation do not match"),g(!1);return}await Fz(e,s),h("Password changed successfully"),n(""),i(""),o("")}catch(S){m(S.message||"Failed to change password. Please try again.")}finally{g(!1)}};return t.jsx("div",{className:"settings-page",children:t.jsxs("div",{className:"settings-container",children:[t.jsxs("div",{className:"settings-header",children:[t.jsx("h1",{className:"settings-title",children:"Security"}),t.jsx("p",{className:"settings-subtitle",children:"Manage your account security"})]}),t.jsxs("div",{className:"settings-section",children:[t.jsx("h2",{className:"settings-section-title",children:"Change Password"}),t.jsx("p",{className:"settings-section-description",children:"Enter your current password and choose a new password to update your account security."}),t.jsxs("form",{onSubmit:x,children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"current-password",children:"Current Password"}),t.jsx("input",{id:"current-password",type:"password",value:e,onChange:v=>n(v.target.value),placeholder:"Enter current password",required:!0,disabled:y})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"new-password",children:"New Password"}),t.jsx("input",{id:"new-password",type:"password",value:s,onChange:v=>i(v.target.value),placeholder:"Enter new password (minimum 6 characters)",required:!0,minLength:6,disabled:y})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"confirm-password",children:"Confirm New Password"}),t.jsx("input",{id:"confirm-password",type:"password",value:l,onChange:v=>o(v.target.value),placeholder:"Confirm new password",required:!0,disabled:y})]}),d&&t.jsx("p",{className:"error-msg",children:d}),p&&t.jsx("p",{className:"success-msg",children:p}),t.jsx("button",{type:"submit",disabled:y,className:"settings-submit-btn",children:y?"Changing password...":"Change Password"})]})]})]})})}const Bz=[{value:"",label:"All types"},{value:"entity_comment",label:"Entity comments"},{value:"entity_mention_entity_note",label:"Entity mentions (notes)"},{value:"entity_mention_session_note",label:"Entity mentions (sessions)"},{value:"session_note_added",label:"Session notes"},{value:"session_note_updated",label:"Session notes"},{value:"request_note_added",label:"Feature/Bug notes"},{value:"request_status_changed",label:"Feature/Bug status"},{value:"request_assigned",label:"Feature/Bug assignments"}],Uz=e=>{const{type:n,metadata:s={}}=e;switch(n){case"entity_comment":return`${s.author_name||"Someone"} commented on ${s.entity_name||"an entity"}`;case"entity_mention_entity_note":return`${s.author_name||"Someone"} mentioned ${s.related_entity_name||"an entity"} in a note`;case"entity_mention_session_note":return`${s.author_name||"Someone"} mentioned ${s.related_entity_name||"an entity"} in a session note`;case"session_note_added":return`${s.author_name||"Someone"} created a session note${s.campaign_name?` for ${s.campaign_name}`:""}: ${s.session_title||"Untitled"}`;case"session_note_updated":return`${s.author_name||"Someone"} updated a session note${s.campaign_name?` for ${s.campaign_name}`:""}: ${s.session_title||"Untitled"}`;case"request_note_added":return`${s.author_name||"Someone"} added a note to "${s.request_title||"a feature/bug"}"`;case"request_status_changed":return`Status changed for "${s.request_title||"a feature/bug"}"`;case"request_assigned":return`You were assigned to "${s.request_title||"a feature/bug"}"`;default:return"New notification"}},qz=e=>{if(!e)return"";const n=new Date(e);if(Number.isNaN(n.getTime()))return"";const i=new Date-n,l=Math.floor(i/6e4),o=Math.floor(i/36e5),d=Math.floor(i/864e5);return l<1?"Just now":l<60?`${l}m ago`:o<24?`${o}h ago`:d<7?`${d}d ago`:n.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})};function Pz(){const{notifications:e,markRead:n,markAllRead:s,refresh:i}=Cj(),{selectedCampaignId:l,campaigns:o,setSelectedCampaignId:d}=jn(),m=Mn(),[p,h]=u.useState(!1),[y,g]=u.useState([]),[x,v]=u.useState(1),[S,N]=u.useState(!0),[E,j]=u.useState(""),[A,T]=u.useState(""),[_,M]=u.useState(l||""),[k,C]=u.useState({open:!1,notification:null}),D=async(O=1,$=!1)=>{h(!0);try{const F={page:O,limit:50};E==="unread"?F.read="false":E==="read"&&(F.read="true"),A&&(F.type=A),_&&(F.campaignId=_);const H=await Ej(F),I=Array.isArray(H?.data)?H.data:[],Y=H?.pagination||{};g($?P=>[...P,...I]:I),N(Y.page<Y.pages)}catch(F){console.error("Failed to load notifications",F)}finally{h(!1)}};u.useEffect(()=>{D(1,!1)},[E,A,_]);const z=async O=>{try{await n(O.id),g($=>$.map(F=>F.id===O.id?{...F,read:!0,readAt:new Date().toISOString()}:F))}catch($){console.error("Failed to mark notification read",$)}},G=async()=>{try{const O={};_&&(O.campaignId=_),A&&(O.type=A),await s(O),i(),D(x,!1)}catch(O){console.error("Failed to mark all notifications read",O)}},U=O=>{if(O.actionUrl)m(O.actionUrl);else{const{type:$,metadata:F={}}=O;if($==="entity_comment"||$==="entity_mention_entity_note"){const H=F.entity_id||F.related_entity_id,I=O.campaignId||O.campaign?.id||_;H&&m(`/entities/${H}${I?`?campaignId=${I}`:""}#notes`)}else if($==="session_note_added"||$==="session_note_updated"||$==="entity_mention_session_note"){const H=O.campaignId||O.campaign?.id||F.target_id||_;m(`/notes/session${H?`?campaignId=${H}`:""}`)}else if($==="request_note_added"||$==="request_status_changed"||$==="request_assigned"){const H=F.request_id||F.requestId;m(H?`/requests/${H}`:"/requests")}}},X=async O=>{O.read||await z(O);const $=O.campaignId||O.campaign?.id||"";if($&&$!==(l||"")){C({open:!0,notification:O});return}U(O)},V=()=>{const{notification:O}=k;if(!O)return;const $=O.campaignId||O.campaign?.id||"";$&&d($),C({open:!1,notification:null}),setTimeout(()=>{U(O)},100)},R=()=>{C({open:!1,notification:null})},B=y.filter(O=>!O.read).length,L=u.useMemo(()=>[{value:"",label:"All campaigns"},...(o||[]).map(O=>({value:O.id,label:O.name}))],[o]);return t.jsxs("div",{className:"notification-list-page",children:[t.jsxs("div",{className:"notification-list-header",children:[t.jsx("h1",{children:"Notifications"}),t.jsx("div",{className:"notification-list-actions",children:B>0&&t.jsxs("button",{type:"button",className:"notification-list-mark-all-read",onClick:G,disabled:p,children:[t.jsx(mM,{size:18}),"Mark all read"]})})]}),t.jsxs("div",{className:"notification-list-filters",children:[t.jsxs("select",{className:"notification-list-filter",value:E,onChange:O=>{j(O.target.value),v(1)},children:[t.jsx("option",{value:"",children:"All"}),t.jsx("option",{value:"unread",children:"Unread"}),t.jsx("option",{value:"read",children:"Read"})]}),t.jsx("select",{className:"notification-list-filter",value:A,onChange:O=>{T(O.target.value),v(1)},children:Bz.map(O=>t.jsx("option",{value:O.value,children:O.label},O.value))}),t.jsx("select",{className:"notification-list-filter",value:_,onChange:O=>{M(O.target.value),v(1)},children:L.map(O=>t.jsx("option",{value:O.value,children:O.label},O.value))})]}),t.jsxs("div",{className:"notification-list-content",children:[p&&y.length===0?t.jsx("div",{className:"notification-list-empty",children:"Loading..."}):y.length===0?t.jsxs("div",{className:"notification-list-empty",children:[t.jsx("p",{children:"No notifications found."}),t.jsx("p",{className:"notification-list-empty-hint",children:"You're all caught up!"})]}):t.jsx("div",{className:"notification-list-items",children:y.map(O=>t.jsxs("div",{className:`notification-list-item ${O.read?"read":"unread"}`,onClick:()=>X(O),children:[t.jsxs("div",{className:"notification-list-item-content",children:[t.jsxs("div",{className:"notification-list-item-header",children:[t.jsx("p",{className:"notification-list-item-message",children:Uz(O)}),!O.read&&t.jsx("div",{className:"notification-list-item-dot"})]}),t.jsxs("div",{className:"notification-list-item-meta",children:[t.jsx("span",{className:"notification-list-item-time",children:qz(O.createdAt)}),O.campaign&&t.jsx("span",{className:"notification-list-item-campaign",children:O.campaign.name})]})]}),!O.read&&t.jsx("button",{type:"button",className:"notification-list-item-mark-read",onClick:$=>{$.stopPropagation(),z(O)},title:"Mark as read",children:t.jsx(oj,{size:16})})]},O.id))}),S&&t.jsx("div",{className:"notification-list-load-more",children:t.jsx("button",{type:"button",onClick:()=>{const O=x+1;v(O),D(O,!0)},disabled:p,children:p?"Loading...":"Load more"})})]}),t.jsx(Aj,{open:k.open,campaignName:k.notification?.campaign?.name||"",onSwitch:V,onCancel:R})]})}function Hz(){const{selectedCampaignId:e,campaigns:n}=jn(),[s,i]=u.useState([]),[l,o]=u.useState(!1),[d,m]=u.useState(e||""),[p,h]=u.useState(null),y=async()=>{o(!0);try{const S=await $L(d||void 0),N=Array.isArray(S?.data)?S.data:[];i(N)}catch(S){console.error("Failed to load followed entities",S)}finally{o(!1)}};u.useEffect(()=>{y()},[d]);const g=async(S,N)=>{if(!(!S||!N||p===S)){h(S);try{await g1(S,N),i(E=>E.filter(j=>!(j.entityId===S&&j.campaignId===N)))}catch(E){console.error("Failed to unfollow entity",E)}finally{h(null)}}},x=u.useMemo(()=>[{value:"",label:"All campaigns"},...(n||[]).map(S=>({value:S.id,label:S.name}))],[n]),v=u.useMemo(()=>{const S={};return s.forEach(N=>{const E=N.campaignId||"no-campaign";S[E]||(S[E]={campaign:N.campaign,entities:[]}),S[E].entities.push(N)}),S},[s]);return t.jsxs("div",{className:"followed-entities-page",children:[t.jsxs("div",{className:"followed-entities-header",children:[t.jsx("h1",{children:"Followed Entities"}),t.jsx("div",{className:"followed-entities-actions",children:t.jsx("select",{className:"followed-entities-filter",value:d,onChange:S=>m(S.target.value),children:x.map(S=>t.jsx("option",{value:S.value,children:S.label},S.value))})})]}),t.jsx("div",{className:"followed-entities-content",children:l?t.jsx("div",{className:"followed-entities-empty",children:"Loading..."}):s.length===0?t.jsxs("div",{className:"followed-entities-empty",children:[t.jsx("p",{children:"No followed entities found."}),t.jsx("p",{className:"followed-entities-empty-hint",children:"Follow entities from their detail pages to receive notifications when they're commented on or mentioned."})]}):t.jsx("div",{className:"followed-entities-list",children:Object.entries(v).map(([S,N])=>t.jsxs("div",{className:"followed-entities-group",children:[t.jsx("h2",{className:"followed-entities-group-title",children:N.campaign?.name||"No campaign context"}),t.jsx("div",{className:"followed-entities-items",children:N.entities.map(E=>t.jsxs("div",{className:"followed-entities-item",children:[t.jsx(Yt,{to:`/entities/${E.entityId}${E.campaignId?`?campaignId=${E.campaignId}`:""}`,className:"followed-entities-item-link",children:t.jsxs("div",{className:"followed-entities-item-content",children:[t.jsx("h3",{className:"followed-entities-item-name",children:E.entity?.name||"Unnamed entity"}),E.entity?.entityType&&t.jsx("span",{className:"followed-entities-item-type",children:E.entity.entityType.name})]})}),t.jsx("button",{type:"button",className:"followed-entities-item-unfollow",onClick:()=>g(E.entityId,E.campaignId),disabled:p===E.entityId,title:"Unfollow",children:p===E.entityId?t.jsx(Bl,{size:18}):t.jsx(xf,{size:18})})]},`${E.entityId}-${E.campaignId}`))})]},S))})})]})}const Vz=(e={})=>{const n=new URLSearchParams;Object.entries(e).forEach(([l,o])=>{o!=null&&o!==""&&n.set(l,o)});const s=n.toString(),i=s?`/requests?${s}`:"/requests";return Et.get(i)},Yz=e=>Et.get(`/requests/${e}`),Gz=e=>Et.post("/requests",e),Kz=(e,n)=>Et.patch(`/requests/${e}`,n),Xz=e=>Et.delete(`/requests/${e}`),Wz={open:"blue",in_progress:"orange",testing:"yellow",resolved:"green",closed:"gray",backlog:"purple"};function b_({status:e}){const n=Wz[e]||"gray",s=e?e.split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" "):"Unknown";return t.jsx("span",{className:`request-status-badge request-status-badge--${n}`,children:s})}function Zz({request:e}){const n=s=>{if(!s)return"";const i=new Date(s);if(Number.isNaN(i.getTime()))return"";const o=new Date-i,d=Math.floor(o/6e4),m=Math.floor(o/36e5),p=Math.floor(o/864e5);return d<1?"Just now":d<60?`${d}m ago`:m<24?`${m}h ago`:p<7?`${p}d ago`:i.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})};return t.jsxs(Yt,{to:`/requests/${e.id}`,className:"request-card",children:[t.jsxs("div",{className:"request-card__header",children:[t.jsxs("div",{className:"request-card__type",children:[e.type==="bug"?t.jsx(lg,{size:16,className:"request-card__type-icon"}):t.jsx(qi,{size:16,className:"request-card__type-icon"}),t.jsx("span",{className:"request-card__type-label",children:e.type==="bug"?"Bug":"Feature"})]}),t.jsx(b_,{status:e.status})]}),t.jsx("h3",{className:"request-card__title",children:e.title}),t.jsx("p",{className:"request-card__description",children:e.description.length>150?`${e.description.substring(0,150)}...`:e.description}),t.jsxs("div",{className:"request-card__footer",children:[t.jsxs("div",{className:"request-card__meta",children:[t.jsxs("span",{className:"request-card__creator",children:["by ",e.creator?.username||"Unknown"]}),e.assignee&&t.jsxs("span",{className:"request-card__assignee",children:[" ",e.assignee.username]})]}),t.jsxs("div",{className:"request-card__time",children:[t.jsx(og,{size:14}),t.jsx("span",{children:n(e.createdAt)})]})]})]})}function Qz(){const{user:e}=un(),n=e?.role==="system_admin",[s,i]=u.useState([]),[l,o]=u.useState(!1),[d,m]=u.useState({type:"",status:"",isInBacklog:""}),[p,h]=u.useState({page:1,limit:20,total:0,pages:0}),y=async(S=1)=>{o(!0);try{const N={page:S,limit:p.limit,...d};Object.keys(N).forEach(j=>{(N[j]===""||N[j]===null||N[j]===void 0)&&delete N[j]});const E=await Vz(N);i(Array.isArray(E?.data)?E.data:[]),h(E?.pagination||p)}catch(N){console.error("Failed to load requests",N),alert("Failed to load requests")}finally{o(!1)}};u.useEffect(()=>{y(1)},[d]);const g=(S,N)=>{m(E=>({...E,[S]:N}))},x=()=>{m({type:"",status:"",isInBacklog:""})},v=Object.values(d).some(S=>S!=="");return t.jsxs("div",{className:"request-list-page",children:[t.jsxs("div",{className:"request-list-page__header",children:[t.jsxs("div",{children:[t.jsx("h1",{children:"Feature/Bugs"}),t.jsxs("div",{className:"request-list-page__subtitle-wrapper",children:[t.jsx("p",{className:"request-list-page__subtitle",children:n?"All bug reports and feature requests":"Your bug reports and feature requests"}),n&&t.jsx("span",{className:"request-list-page__admin-badge",children:"Admin View"})]})]}),t.jsxs(Yt,{to:"/requests/new",className:"request-list-page__create-button",children:[t.jsx(sa,{size:20}),"New Request"]})]}),t.jsxs("div",{className:"request-list-page__filters",children:[t.jsxs("div",{className:"request-list-page__filter-group",children:[t.jsx(Sf,{size:16}),t.jsx("label",{htmlFor:"filter-type",children:"Type:"}),t.jsxs("select",{id:"filter-type",value:d.type,onChange:S=>g("type",S.target.value),className:"request-list-page__filter-select",children:[t.jsx("option",{value:"",children:"All"}),t.jsx("option",{value:"bug",children:"Bug"}),t.jsx("option",{value:"feature",children:"Feature"})]})]}),t.jsxs("div",{className:"request-list-page__filter-group",children:[t.jsx("label",{htmlFor:"filter-status",children:"Status:"}),t.jsxs("select",{id:"filter-status",value:d.status,onChange:S=>g("status",S.target.value),className:"request-list-page__filter-select",children:[t.jsx("option",{value:"",children:"All"}),t.jsx("option",{value:"open",children:"Open"}),t.jsx("option",{value:"in_progress",children:"In Progress"}),t.jsx("option",{value:"testing",children:"Testing"}),t.jsx("option",{value:"resolved",children:"Resolved"}),t.jsx("option",{value:"closed",children:"Closed"}),t.jsx("option",{value:"backlog",children:"Backlog"})]})]}),n&&t.jsxs("div",{className:"request-list-page__filter-group",children:[t.jsx("label",{htmlFor:"filter-backlog",children:"Backlog:"}),t.jsxs("select",{id:"filter-backlog",value:d.isInBacklog,onChange:S=>g("isInBacklog",S.target.value),className:"request-list-page__filter-select",children:[t.jsx("option",{value:"",children:"All"}),t.jsx("option",{value:"true",children:"In Backlog"}),t.jsx("option",{value:"false",children:"Not in Backlog"})]})]}),v&&t.jsx("button",{onClick:x,className:"request-list-page__clear-filters",children:"Clear Filters"})]}),l?t.jsx("div",{className:"request-list-page__loading",children:"Loading requests..."}):s.length===0?t.jsxs("div",{className:"request-list-page__empty",children:[t.jsx("p",{children:"No requests found"}),t.jsx(Yt,{to:"/requests/new",className:"request-list-page__empty-link",children:"Create your first request"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"request-list-page__grid",children:s.map(S=>t.jsx(Zz,{request:S},S.id))}),p.pages>1&&t.jsxs("div",{className:"request-list-page__pagination",children:[t.jsx("button",{onClick:()=>y(p.page-1),disabled:p.page<=1,className:"request-list-page__pagination-button",children:"Previous"}),t.jsxs("span",{className:"request-list-page__pagination-info",children:["Page ",p.page," of ",p.pages," (",p.total," total)"]}),t.jsx("button",{onClick:()=>y(p.page+1),disabled:p.page>=p.pages,className:"request-list-page__pagination-button",children:"Next"})]})]})]})}const x_=e=>Et.get(`/requests/${e}/notes`),v_=(e,n)=>Et.post(`/requests/${e}/notes`,n),Jz=(e,n,s)=>Et.patch(`/requests/${e}/notes/${n}`,s),S_=(e,n)=>Et.delete(`/requests/${e}/notes/${n}`),eB=Object.freeze(Object.defineProperty({__proto__:null,createRequestNote:v_,deleteRequestNote:S_,fetchRequestNotes:x_,updateRequestNote:Jz},Symbol.toStringTag,{value:"Module"}));function tB({onSubmit:e,loading:n=!1}){const[s,i]=u.useState(""),l=o=>{o.preventDefault(),s.trim()&&(e(s.trim()),i(""))};return t.jsxs("form",{onSubmit:l,className:"request-note-form",children:[t.jsx("textarea",{value:s,onChange:o=>i(o.target.value),placeholder:"Add a note...",className:"request-note-form__textarea",rows:3,disabled:n}),t.jsx("div",{className:"request-note-form__actions",children:t.jsxs("button",{type:"submit",disabled:!s.trim()||n,className:"request-note-form__submit",children:[t.jsx(gk,{size:16}),n?"Adding...":"Add Note"]})})]})}function nB({requestId:e,canAddNote:n}){const{user:s}=un(),[i,l]=u.useState([]),[o,d]=u.useState(!1),[m,p]=u.useState(!1),[h,y]=u.useState(null),[g,x]=u.useState(""),v=async()=>{d(!0);try{const _=await x_(e);l(Array.isArray(_?.data)?_.data:[])}catch(_){console.error("Failed to load notes",_)}finally{d(!1)}};u.useEffect(()=>{e&&v()},[e]);const S=async _=>{p(!0);try{await v_(e,{content:_}),await v()}catch(M){console.error("Failed to add note",M),alert("Failed to add note")}finally{p(!1)}},N=async _=>{if(confirm("Are you sure you want to delete this note?"))try{await S_(e,_),await v()}catch(M){console.error("Failed to delete note",M),alert("Failed to delete note")}},E=_=>{y(_.id),x(_.content)},j=()=>{y(null),x("")},A=async _=>{try{const{updateRequestNote:M}=await si(async()=>{const{updateRequestNote:k}=await Promise.resolve().then(()=>eB);return{updateRequestNote:k}},void 0);await M(e,_,{content:g}),y(null),x(""),await v()}catch(M){console.error("Failed to update note",M),alert("Failed to update note")}},T=_=>{if(!_)return"";const M=new Date(_);if(Number.isNaN(M.getTime()))return"";const C=new Date-M,D=Math.floor(C/6e4),z=Math.floor(C/36e5),G=Math.floor(C/864e5);return D<1?"Just now":D<60?`${D}m ago`:z<24?`${z}h ago`:G<7?`${G}d ago`:M.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})};return o?t.jsx("div",{className:"request-notes__loading",children:"Loading notes..."}):t.jsxs("div",{className:"request-notes",children:[t.jsxs("div",{className:"request-notes__header",children:[t.jsx(tk,{size:20}),t.jsxs("h3",{children:["Notes (",i.length,")"]})]}),n&&t.jsx(tB,{onSubmit:S,loading:m}),t.jsx("div",{className:"request-notes__list",children:i.length===0?t.jsx("div",{className:"request-notes__empty",children:"No notes yet"}):i.map(_=>t.jsx("div",{className:"request-note",children:h===_.id?t.jsxs("div",{className:"request-note__edit",children:[t.jsx("textarea",{value:g,onChange:M=>x(M.target.value),className:"request-note__edit-textarea",rows:3}),t.jsxs("div",{className:"request-note__edit-actions",children:[t.jsx("button",{onClick:()=>A(_.id),className:"request-note__edit-save",children:"Save"}),t.jsx("button",{onClick:j,className:"request-note__edit-cancel",children:"Cancel"})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"request-note__content",children:_.content}),t.jsxs("div",{className:"request-note__footer",children:[t.jsxs("div",{className:"request-note__meta",children:[t.jsx("span",{className:"request-note__author",children:_.author?.username||"Unknown"}),t.jsx("span",{className:"request-note__time",children:T(_.createdAt)})]}),s?.id===_.createdBy&&t.jsxs("div",{className:"request-note__actions",children:[t.jsx("button",{onClick:()=>E(_),className:"request-note__action",title:"Edit note",children:t.jsx(mj,{size:14})}),t.jsx("button",{onClick:()=>N(_.id),className:"request-note__action",title:"Delete note",children:t.jsx(zn,{size:14})})]})]})]})},_.id))})]})}function aB(){const{id:e}=Wa(),n=Mn(),{user:s}=un(),i=s?.role==="system_admin",[l,o]=u.useState(null),[d,m]=u.useState(!1),[p,h]=u.useState(!1),[y,g]=u.useState([]),[x,v]=u.useState(!1),[S,N]=u.useState(!1),[E,j]=u.useState({status:"",assignedTo:"",testerId:"",priority:"",isInBacklog:!1}),A=async()=>{m(!0);try{const C=await Yz(e);if(C?.success&&C?.data){const D=C.data;o(D),j({status:D.status||"",assignedTo:D.assignedTo||"",testerId:D.testerId||"",priority:D.priority||"",isInBacklog:D.isInBacklog||!1})}else throw new Error("Request not found")}catch(C){console.error("Failed to load request",C),alert(C.message||"Failed to load request"),n("/requests")}finally{m(!1)}};u.useEffect(()=>{e&&A()},[e]),u.useEffect(()=>{i&&S&&T()},[i,S]);const T=async()=>{v(!0);try{const C=await Rg();g(Array.isArray(C?.data)?C.data:[])}catch(C){console.error("Failed to load users",C)}finally{v(!1)}},_=async()=>{h(!0);try{const C={};if(E.status&&E.status!==l.status&&(C.status=E.status),E.assignedTo!==l.assignedTo&&(C.assignedTo=E.assignedTo||null),E.testerId!==l.testerId&&(C.testerId=E.testerId||null),E.priority!==l.priority&&(C.priority=E.priority||null),E.isInBacklog!==l.isInBacklog&&(C.isInBacklog=E.isInBacklog),Object.keys(C).length===0){N(!1);return}await Kz(e,C),await A(),N(!1)}catch(C){console.error("Failed to update request",C),alert("Failed to update request")}finally{h(!1)}},M=async()=>{if(confirm("Are you sure you want to delete this request? This action cannot be undone."))try{await Xz(e),n("/requests")}catch(C){console.error("Failed to delete request",C),alert("Failed to delete request")}},k=l&&(i||String(l.createdBy)===String(s?.id)||String(l.testerId)===String(s?.id));return d?t.jsx("div",{className:"request-detail-page__loading",children:"Loading request..."}):l?t.jsxs("div",{className:"request-detail-page",children:[t.jsxs("div",{className:"request-detail-page__header",children:[t.jsxs(Yt,{to:"/requests",className:"request-detail-page__back",children:[t.jsx(jc,{size:20}),"Back to Feature/Bugs"]}),t.jsxs("div",{className:"request-detail-page__title-section",children:[t.jsxs("div",{className:"request-detail-page__type-badge",children:[l.type==="bug"?t.jsx(lg,{size:20,className:"request-detail-page__type-icon"}):t.jsx(qi,{size:20,className:"request-detail-page__type-icon"}),t.jsx("span",{children:l.type==="bug"?"Bug":"Feature"})]}),t.jsx("h1",{children:l.title}),t.jsxs("div",{className:"request-detail-page__meta",children:[t.jsx(b_,{status:l.status}),l.priority&&t.jsxs("span",{className:"request-detail-page__priority",children:["Priority: ",l.priority]}),l.isInBacklog&&t.jsx("span",{className:"request-detail-page__backlog-badge",children:"In Backlog"})]})]})]}),t.jsx("div",{className:"request-detail-page__content",children:t.jsxs("div",{className:"request-detail-page__main",children:[t.jsxs("div",{className:"request-detail-page__section",children:[t.jsx("h2",{children:"Description"}),t.jsx("div",{className:"request-detail-page__description",children:l.description.split(`
`).map((C,D)=>t.jsx("p",{children:C},D))})]}),t.jsxs("div",{className:"request-detail-page__section",children:[t.jsx("h2",{children:"Details"}),t.jsxs("dl",{className:"request-detail-page__details",children:[t.jsxs("div",{className:"request-detail-page__detail-row",children:[t.jsx("dt",{children:"Created by:"}),t.jsx("dd",{children:l.creator?.username||"Unknown"})]}),t.jsxs("div",{className:"request-detail-page__detail-row",children:[t.jsx("dt",{children:"Created:"}),t.jsx("dd",{children:new Date(l.createdAt).toLocaleString()})]}),l.assignee&&t.jsxs("div",{className:"request-detail-page__detail-row",children:[t.jsx("dt",{children:"Assigned to:"}),t.jsx("dd",{children:l.assignee.username})]}),l.tester&&t.jsxs("div",{className:"request-detail-page__detail-row",children:[t.jsx("dt",{children:"Tester:"}),t.jsx("dd",{children:l.tester.username})]}),l.updatedAt!==l.createdAt&&t.jsxs("div",{className:"request-detail-page__detail-row",children:[t.jsx("dt",{children:"Last updated:"}),t.jsx("dd",{children:new Date(l.updatedAt).toLocaleString()})]})]})]}),i&&t.jsxs("div",{className:"request-detail-page__section",children:[t.jsxs("div",{className:"request-detail-page__admin-header",children:[t.jsx("h2",{children:"Admin Controls"}),t.jsxs("button",{onClick:()=>N(!S),className:`request-detail-page__admin-toggle ${S?"request-detail-page__admin-toggle--active":""}`,type:"button",children:[t.jsx(hj,{size:18}),t.jsx("span",{children:S?"Hide Controls":"Show Controls"}),t.jsx(Ls,{size:16,className:`request-detail-page__admin-toggle-icon ${S?"request-detail-page__admin-toggle-icon--rotated":""}`})]})]}),S&&t.jsxs("div",{className:"request-detail-page__admin-form",children:[t.jsxs("div",{className:"request-detail-page__admin-field",children:[t.jsx("label",{children:"Status:"}),t.jsxs("select",{value:E.status,onChange:C=>j(D=>({...D,status:C.target.value})),className:"request-detail-page__admin-select",children:[t.jsx("option",{value:"open",children:"Open"}),t.jsx("option",{value:"in_progress",children:"In Progress"}),t.jsx("option",{value:"testing",children:"Testing"}),t.jsx("option",{value:"resolved",children:"Resolved"}),t.jsx("option",{value:"closed",children:"Closed"}),t.jsx("option",{value:"backlog",children:"Backlog"})]})]}),t.jsxs("div",{className:"request-detail-page__admin-field",children:[t.jsx("label",{children:"Tester:"}),t.jsxs("select",{value:E.testerId,onChange:C=>j(D=>({...D,testerId:C.target.value})),className:"request-detail-page__admin-select",disabled:x,children:[t.jsx("option",{value:"",children:"None"}),y.map(C=>t.jsxs("option",{value:C.id,children:[C.username," ",C.email?`(${C.email})`:""]},C.id))]})]}),t.jsxs("div",{className:"request-detail-page__admin-field",children:[t.jsx("label",{children:"Priority:"}),t.jsxs("select",{value:E.priority,onChange:C=>j(D=>({...D,priority:C.target.value})),className:"request-detail-page__admin-select",children:[t.jsx("option",{value:"",children:"None"}),t.jsx("option",{value:"low",children:"Low"}),t.jsx("option",{value:"medium",children:"Medium"}),t.jsx("option",{value:"high",children:"High"})]})]}),t.jsx("div",{className:"request-detail-page__admin-field",children:t.jsxs("label",{children:[t.jsx("input",{type:"checkbox",checked:E.isInBacklog,onChange:C=>j(D=>({...D,isInBacklog:C.target.checked}))}),"In Backlog"]})}),t.jsxs("div",{className:"request-detail-page__admin-actions",children:[t.jsx("button",{onClick:_,disabled:p,className:"request-detail-page__admin-save",children:p?"Saving...":"Save Changes"}),t.jsxs("button",{onClick:M,className:"request-detail-page__admin-delete",children:[t.jsx(zn,{size:16}),"Delete Request"]})]})]})]}),t.jsx(nB,{requestId:e,canAddNote:k})]})})]}):null}function sB(){const e=Mn(),[n,s]=u.useState(!1),[i,l]=u.useState({type:"bug",title:"",description:"",priority:""}),[o,d]=u.useState({}),m=y=>{const{name:g,value:x}=y.target;l(v=>({...v,[g]:x})),o[g]&&d(v=>({...v,[g]:""}))},p=()=>{const y={};return i.title.trim()||(y.title="Title is required"),i.description.trim()||(y.description="Description is required"),d(y),Object.keys(y).length===0},h=async y=>{if(y.preventDefault(),!!p()){s(!0);try{const g={type:i.type,title:i.title.trim(),description:i.description.trim(),priority:i.priority||null},x=await Gz(g);if(x?.success&&x?.data?.id)e(`/requests/${x.data.id}`);else throw new Error("Failed to create request")}catch(g){console.error("Failed to create request",g),alert(g.message||"Failed to create request")}finally{s(!1)}}};return t.jsxs("div",{className:"create-request-page",children:[t.jsxs("div",{className:"create-request-page__header",children:[t.jsxs("button",{onClick:()=>e("/requests"),className:"create-request-page__back",children:[t.jsx(jc,{size:20}),"Back to Feature/Bugs"]}),t.jsx("h1",{children:"Create Feature/Bug Request"})]}),t.jsxs("form",{onSubmit:h,className:"create-request-form",children:[t.jsxs("div",{className:"create-request-form__section",children:[t.jsx("label",{className:"create-request-form__label",children:"Type"}),t.jsxs("div",{className:"create-request-form__type-options",children:[t.jsxs("label",{className:"create-request-form__type-option",children:[t.jsx("input",{type:"radio",name:"type",value:"bug",checked:i.type==="bug",onChange:m}),t.jsx(lg,{size:20}),t.jsx("span",{children:"Bug"})]}),t.jsxs("label",{className:"create-request-form__type-option",children:[t.jsx("input",{type:"radio",name:"type",value:"feature",checked:i.type==="feature",onChange:m}),t.jsx(qi,{size:20}),t.jsx("span",{children:"Feature"})]})]})]}),t.jsxs("div",{className:"create-request-form__section",children:[t.jsxs("label",{htmlFor:"title",className:"create-request-form__label",children:["Title ",t.jsx("span",{className:"create-request-form__required",children:"*"})]}),t.jsx("input",{id:"title",name:"title",type:"text",value:i.title,onChange:m,className:`create-request-form__input ${o.title?"create-request-form__input--error":""}`,placeholder:"Brief description of the issue or feature",disabled:n}),o.title&&t.jsx("div",{className:"create-request-form__error",children:o.title})]}),t.jsxs("div",{className:"create-request-form__section",children:[t.jsxs("label",{htmlFor:"description",className:"create-request-form__label",children:["Description ",t.jsx("span",{className:"create-request-form__required",children:"*"})]}),t.jsx("textarea",{id:"description",name:"description",value:i.description,onChange:m,className:`create-request-form__textarea ${o.description?"create-request-form__textarea--error":""}`,placeholder:"Provide detailed information about the bug or feature request...",rows:8,disabled:n}),o.description&&t.jsx("div",{className:"create-request-form__error",children:o.description})]}),t.jsxs("div",{className:"create-request-form__section",children:[t.jsx("label",{htmlFor:"priority",className:"create-request-form__label",children:"Priority (optional)"}),t.jsxs("select",{id:"priority",name:"priority",value:i.priority,onChange:m,className:"create-request-form__select",disabled:n,children:[t.jsx("option",{value:"",children:"None"}),t.jsx("option",{value:"low",children:"Low"}),t.jsx("option",{value:"medium",children:"Medium"}),t.jsx("option",{value:"high",children:"High"})]})]}),t.jsxs("div",{className:"create-request-form__actions",children:[t.jsx("button",{type:"button",onClick:()=>e("/requests"),className:"create-request-form__cancel",disabled:n,children:"Cancel"}),t.jsx("button",{type:"submit",className:"create-request-form__submit",disabled:n,children:n?"Creating...":"Submit Request"})]})]})]})}function w_(e,n,s=!1){if(!e||!Array.isArray(n)||n.length===0)return[];const i=new Map;n.forEach(m=>{const p=m.id||m.type_id||"";p&&(i.set(String(p),m),!m.parent_type_id&&m.parentType?.id&&(m.parent_type_id=m.parentType.id))});const l=new Set;s&&l.add(String(e));let o=String(e);const d=new Set;for(;o&&!d.has(o);){d.add(o);const m=i.get(o);if(!m)break;const p=m.parent_type_id||m.parentTypeId||m.parentType?.id||null;if(p){const h=String(p);l.add(h),o=h}else break}return Array.from(l)}function rB(e,n){if(!e||!Array.isArray(n)||n.length===0)return[];const s=String(e),i=[];return n.forEach(l=>{(l.id||l.type_id)&&!l.parent_type_id&&l.parentType?.id&&(l.parent_type_id=l.parentType.id)}),n.forEach(l=>{const o=l.id||l.type_id||"";if(!o)return;const d=l.parent_type_id||l.parentTypeId||l.parentType?.id||null;(d?String(d):"")===s&&i.push(String(o))}),i}function N_({location:e,parentId:n,locationTypes:s,onClose:i,onSuccess:l}){const{activeWorldId:o}=jn(),[d,m]=u.useState({name:"",description:"",location_type_id:"",parent_id:n||null,metadata:{}}),[p,h]=u.useState(!1),[y,g]=u.useState(null),[x,v]=u.useState([]),[S,N]=u.useState([]),[E,j]=u.useState([]),[A,T]=u.useState(!1),_=u.useCallback(async(D=null)=>{if(o)try{let U=(await Li({worldId:o,all:"true"}))?.data||[];if(e?.id){const V=String(e.id);U=U.filter(R=>String(R.id)!==V);try{const{fetchLocationPath:R}=await si(async()=>{const{fetchLocationPath:$}=await Promise.resolve().then(()=>Jj);return{fetchLocationPath:$}},void 0),L=(await R(e.id))?.data||[],O=new Set(L.map($=>String($.id)));U=U.filter($=>{const F=String($.id);return!O.has(F)})}catch(R){console.error(" [Parent Selection] Failed to load location path for ancestor exclusion:",R)}}const X=D||e?.location_type_id;if(X&&s&&s.length>0){const V=String(X),R=s.find(O=>String(O.id)===V),B=w_(V,s),L=String(V);if(B.length>0){const O=new Set(B.map($=>String($)));U=U.filter($=>{const F=$.location_type_id||$.locationType?.id,H=F?String(F):"",I=O.has(H);return H&&I&&H!==L})}else U=[]}else e&&(U=[]);v(U)}catch(z){console.error(" [Parent Selection] Failed to load available parents:",z),v([])}},[o,e,s]),M=u.useCallback(async()=>{if(!e?.id){N([]);return}T(!0);try{const D=await yg(e.id);N(D?.data||[])}catch(D){console.error(" Failed to load entities:",D),N([])}finally{T(!1)}},[e?.id]),k=u.useCallback(async()=>{if(!e?.id){j([]);return}T(!0);try{const D=await Li({worldId:o,parentId:e.id});j(D?.data||[])}catch(D){console.error(" Failed to load child locations:",D),j([])}finally{T(!1)}},[e?.id,o]);u.useEffect(()=>{e?(m({name:e.name||"",description:e.description||"",location_type_id:e.location_type_id||"",parent_id:e.parent_id||n||null,metadata:e.metadata||{}}),M(),k()):(m({name:"",description:"",location_type_id:"",parent_id:n||null,metadata:{}}),N([]),j([])),_(e?.location_type_id||null)},[e,n,M,k]),u.useEffect(()=>{d.location_type_id?_(d.location_type_id):e||_(null)},[d.location_type_id,_,e]);const C=async D=>{D.preventDefault(),h(!0),g(null);try{const z={world_id:o,name:d.name,description:d.description,location_type_id:d.location_type_id||null,parent_id:d.parent_id||null,metadata:d.metadata};let G;e?G=await Rf(e.id,z):G=await Pj(z);const U=G?.data||G;l.length>0?l(U):l()}catch(z){console.error(" Failed to save location:",z),g(z.message)}finally{h(!1)}};return t.jsxs("form",{onSubmit:C,className:"entity-type-form",children:[y&&t.jsx("div",{className:"alert alert-error",style:{marginBottom:"1rem"},children:y}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"name",children:"Name *"}),t.jsx("input",{type:"text",id:"name",value:d.name,onChange:D=>m({...d,name:D.target.value}),required:!0})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"parent_id",children:"Parent"}),t.jsxs("select",{id:"parent_id",value:d.parent_id||"",onChange:D=>m({...d,parent_id:D.target.value?D.target.value:null}),children:[t.jsx("option",{value:"",children:"None (Root Location)"}),x.map(D=>t.jsx("option",{value:D.id,children:D.name},D.id))]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"location_type_id",children:"Type *"}),t.jsxs("select",{id:"location_type_id",value:d.location_type_id,onChange:D=>m({...d,location_type_id:D.target.value}),required:!0,children:[t.jsx("option",{value:"",children:"Select a type..."}),s.map(D=>t.jsx("option",{value:D.id,children:D.name},D.id))]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"description",children:"Description"}),t.jsx("textarea",{id:"description",value:d.description,onChange:D=>m({...d,description:D.target.value}),rows:4})]}),e&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"form-group",style:{borderTop:"1px solid #e2e8f0",paddingTop:"1rem",marginTop:"1rem"},children:[t.jsxs("label",{style:{marginBottom:"0.5rem",display:"block",fontWeight:"600"},children:["Entities Located Here (",S.length,")"]}),A?t.jsx("p",{style:{color:"#64748b",fontSize:"0.9rem"},children:"Loading entities..."}):S.length===0?t.jsx("p",{style:{color:"#64748b",fontSize:"0.9rem"},children:"No entities in this location."}):t.jsx("ul",{style:{listStyle:"none",padding:0,margin:0,maxHeight:"200px",overflowY:"auto"},children:S.map(D=>t.jsx("li",{style:{padding:"0.5rem",marginBottom:"0.25rem",backgroundColor:"#f8fafc",borderRadius:"4px"},children:t.jsxs(Yt,{to:`/entities/${D.id}`,style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"#1e293b"},onClick:z=>z.stopPropagation(),children:[t.jsx(hS,{size:14}),t.jsxs("span",{children:[D.name,D.entityType&&t.jsxs("span",{style:{color:"#64748b",fontSize:"0.85rem",marginLeft:"0.5rem"},children:["(",D.entityType.name,")"]})]})]})},D.id))})]}),t.jsxs("div",{className:"form-group",style:{borderTop:"1px solid #e2e8f0",paddingTop:"1rem",marginTop:"1rem"},children:[t.jsxs("label",{style:{marginBottom:"0.5rem",display:"block",fontWeight:"600"},children:["Child Locations (",E.length,")"]}),A?t.jsx("p",{style:{color:"#64748b",fontSize:"0.9rem"},children:"Loading child locations..."}):E.length===0?t.jsx("p",{style:{color:"#64748b",fontSize:"0.9rem"},children:"No child locations."}):t.jsx("ul",{style:{listStyle:"none",padding:0,margin:0,maxHeight:"200px",overflowY:"auto"},children:E.map(D=>t.jsx("li",{style:{padding:"0.5rem",marginBottom:"0.25rem",backgroundColor:"#f8fafc",borderRadius:"4px"},children:t.jsxs(Yt,{to:`/locations/${D.id}`,style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"#1e293b"},onClick:z=>z.stopPropagation(),children:[t.jsx(hS,{size:14}),t.jsx("span",{children:D.name}),D.locationType&&t.jsxs("span",{style:{color:"#64748b",fontSize:"0.85rem",marginLeft:"0.5rem"},children:["(",D.locationType.name,")"]})]})},D.id))})]})]}),t.jsxs("div",{className:"form-actions",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:i,children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn btn-primary",disabled:p,children:p?"Saving...":e?"Update":"Create"})]})]})}const iB=new Set(["system_admin"]);function lB(){const{activeWorldId:e,selectedCampaignId:n,contextKey:s,activeWorld:i,selectedCampaign:l,selectedContextType:o}=jn(),{user:d}=un(),[m,p]=aj(),[h,y]=u.useState([]),[g,x]=u.useState([]),[v,S]=u.useState(!1),[N,E]=u.useState(null),[j,A]=u.useState(m.get("parentId")||null),T=m.get("locationType")||null,[_,M]=u.useState(T),[k,C]=u.useState([]),[D,z]=u.useState(!1),[G,U]=u.useState(null),[X,V]=u.useState(""),R=u.useMemo(()=>!l||!d?"":l.members?.find(we=>we.user_id===d.id)?.role||"",[l,d]),B=u.useMemo(()=>{if(!i||!d?.id)return!1;const pe=i.created_by||i.creator?.id||i.owner_id||i.owner?.id||"";return pe?String(pe)===String(d.id):!1},[i,d?.id]),L=u.useMemo(()=>d?iB.has(d.role)?!0:e?o==="world"?B:!!(l&&(R==="dm"||B)):!1:!1,[d,e,o,l,R,B]),O=i?.entity_creation_scope??"",$=u.useMemo(()=>!n||!l||!d||O!==Ul.ALL_PLAYERS?!1:R==="player",[n,l,d,O,R]),F=L||$,H=u.useCallback(async()=>{if(e){S(!0),E(null);try{const pe={worldId:e,includeEntities:"true"};j&&(pe.parentId=j),T&&!j&&(pe.locationTypeId=T);const we=await Li(pe);y(we?.data||[])}catch(pe){console.error(" Failed to load locations:",pe),E(pe.message)}finally{S(!1)}}},[e,j,T,n,s]),I=u.useCallback(async()=>{if(e)try{const pe=await Pi({worldId:e});x(pe?.data||[])}catch(pe){console.error(" Failed to load location types:",pe)}},[e]),Y=u.useCallback(async()=>{if(!j){C([]);return}try{const pe=await pg(j);C(pe?.data||[])}catch(pe){console.error(" Failed to load path:",pe),C([])}},[j]);u.useEffect(()=>{H()},[H]),u.useEffect(()=>{I()},[I]),u.useEffect(()=>{Y()},[Y]),u.useEffect(()=>{T&&T!==_?(A(null),M(T)):!T&&_&&M(null)},[T,_]),u.useEffect(()=>{const pe={};j&&(pe.parentId=j),T&&(pe.locationType=T),p(pe)},[j,T,p]);const P=async pe=>{if(!(!L||!pe?.id||!window.confirm(`Delete location "${pe.name}"? This action cannot be undone.`)))try{V(pe.id),await gg(pe.id),H()}catch(ne){console.error(" Failed to delete location",ne),E(ne.message||"Failed to delete location")}finally{V("")}},K=()=>{if(k.length>1){const pe=k[k.length-2].id;A(pe)}else A(null)},re=pe=>{A(pe)},W=()=>{U(null),z(!0)},ue=pe=>{U(pe),z(!0)},Q=()=>{z(!1),U(null)},ye=()=>{z(!1),U(null),H()},ae=T&&g.find(pe=>pe.id===T)?.name||"";if(!e)return t.jsx("section",{className:"entities-page",children:t.jsx("div",{className:"entities-header",children:t.jsx("div",{className:"entities-header-top",children:t.jsxs("div",{className:"entities-header-left",children:[t.jsx("h1",{children:"Locations"}),t.jsx("p",{className:"entities-subtitle",children:"Select a campaign or world you own to choose a world context."})]})})})});const ke=l?`${l.name}${i?.name?`  ${i.name}`:""}`:i?.name?`World  ${i.name}`:"";return t.jsxs("section",{className:"entities-page",children:[t.jsx("div",{className:"entities-header",children:t.jsxs("div",{className:"entities-header-top",children:[t.jsxs("div",{className:"entities-header-left",children:[t.jsx("h1",{children:T&&ae?ae:"Locations"}),ke&&t.jsx("p",{className:"entities-subtitle",children:ke}),T&&t.jsx("div",{style:{marginTop:"0.5rem"},children:t.jsxs("button",{className:"btn secondary compact",onClick:()=>{const pe=new URLSearchParams(m);pe.delete("locationType"),p(pe)},title:"Clear location type filter",children:[t.jsx(ea,{size:14})," Clear Filter"]})})]}),t.jsxs("div",{className:"entities-header-right",children:[t.jsx("button",{type:"button",className:"icon-btn",title:"Refresh locations",onClick:H,disabled:v||!e,children:t.jsx(Ui,{size:16})}),F&&t.jsxs("button",{className:"btn submit",onClick:W,disabled:!e||v,children:[t.jsx(sa,{size:18})," Add Location"]})]})]})}),k.length>0&&t.jsxs("div",{style:{marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[t.jsx("button",{className:"btn btn-sm btn-secondary",onClick:()=>A(null),children:"Root"}),k.map((pe,we)=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx(Jr,{size:16}),we===k.length-1?t.jsx("span",{style:{fontWeight:"bold"},children:pe.name}):t.jsx("button",{className:"btn btn-sm btn-link",onClick:()=>A(pe.id),children:pe.name})]},pe.id)),k.length>1&&t.jsxs("button",{className:"btn btn-sm btn-secondary",onClick:K,style:{marginLeft:"auto"},children:[t.jsx(fy,{size:16})," Up"]})]}),N&&t.jsx("div",{className:"alert error",role:"alert",style:{marginBottom:"1rem"},children:N}),v?t.jsx("p",{children:"Loading locations..."}):h.length===0?t.jsx("p",{children:"No locations found. Create your first location to get started."}):t.jsx("div",{className:"entities-table-wrapper",children:t.jsxs("table",{className:"entities-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Name"}),t.jsx("th",{children:"Type"}),t.jsx("th",{children:"Description"}),t.jsx("th",{children:"Children"}),t.jsx("th",{children:"Entities"}),L&&t.jsx("th",{className:"actions-column",children:"Actions"})]})}),t.jsx("tbody",{children:h.map(pe=>t.jsxs("tr",{children:[t.jsx("td",{children:pe.childCount>0?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>re(pe.id),style:{textAlign:"left",padding:0,background:"none",border:"none",cursor:"pointer",fontWeight:600,color:"#1d4ed8",textDecoration:"none",fontFamily:"inherit",fontSize:"inherit"},className:"entity-name-link",onMouseEnter:we=>{we.currentTarget.style.textDecoration="underline"},onMouseLeave:we=>{we.currentTarget.style.textDecoration="none"},children:pe.name}),"",t.jsx(Jr,{size:16,style:{marginLeft:"0.25rem",display:"inline-block",verticalAlign:"middle",color:"#6b7280"}}),pe.id?t.jsxs(t.Fragment,{children:["",t.jsx(fs,{locationId:pe.id,locationName:pe.name||"location"})]}):null,"",t.jsx(Ny,{importance:pe.importance})]}):t.jsxs(t.Fragment,{children:[t.jsx(Yt,{to:`/locations/${pe.id}`,className:"entity-name-link",children:pe.name}),pe.id?t.jsxs(t.Fragment,{children:["",t.jsx(fs,{locationId:pe.id,locationName:pe.name||"location"})]}):null,"",t.jsx(Ny,{importance:pe.importance})]})}),t.jsx("td",{children:pe.locationType?.name||""}),t.jsx("td",{children:pe.description||""}),t.jsx("td",{children:pe.childCount||0}),t.jsx("td",{children:pe.entities?.length||0}),L&&t.jsx("td",{className:"actions-column",children:t.jsxs("div",{className:"entity-actions",children:[t.jsx("button",{type:"button",className:"icon-btn",onClick:()=>ue(pe),title:"Edit location",disabled:v,children:t.jsx(Ga,{size:16})}),t.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>P(pe),title:"Delete location",disabled:X===pe.id,children:t.jsx(zn,{size:16})})]})})]},pe.id))})]})}),D&&t.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:t.jsxs("div",{className:"side-panel",children:[t.jsxs("div",{className:"side-panel-header",children:[t.jsx("h2",{children:G?"Edit Location":"New Location"}),t.jsx("button",{type:"button",className:"icon-btn",onClick:Q,title:"Close form",children:t.jsx(ea,{size:18})})]}),t.jsx("div",{className:"side-panel-content",children:t.jsx(N_,{location:G,parentId:j,locationTypes:g,onClose:Q,onSuccess:ye})})]})})]})}const oB=(e,n)=>{const s=new URLSearchParams;n&&s.set("campaignId",n);const i=s.toString(),l=i?`/locations/${e}/follow?${i}`:`/locations/${e}/follow`;return Et.post(l)},cB=(e,n)=>{const s=new URLSearchParams;n&&s.set("campaignId",n);const i=s.toString(),l=i?`/locations/${e}/follow?${i}`:`/locations/${e}/follow`;return Et.delete(l)},uB=(e,n)=>{const s=new URLSearchParams;n&&s.set("campaignId",n);const i=s.toString(),l=i?`/locations/${e}/follow-status?${i}`:`/locations/${e}/follow-status`;return Et.get(l)};function dB({locationId:e}){const{user:n}=un(),{selectedCampaignId:s}=jn(),[i,l]=u.useState(!1),[o,d]=u.useState(!1),[m,p]=u.useState(!0);u.useEffect(()=>{if(!e||!s||!n?.id){p(!1);return}(async()=>{try{p(!0);const g=await uB(e,s);l(g?.following??!1)}catch(g){console.error("Failed to check location follow status",g),l(!1)}finally{p(!1)}})()},[e,s,n?.id]);const h=async()=>{if(!e||!s||o||m)return;const y=!i;d(!0);try{y?await oB(e,s):await cB(e,s),l(y)}catch(g){console.error("Failed to toggle location follow",g),l(!y)}finally{d(!1)}};return s?m?t.jsx("button",{type:"button",className:"entity-follow-button",disabled:!0,title:"Checking follow status...",children:t.jsx(Bl,{size:18})}):t.jsx("button",{type:"button",className:`entity-follow-button ${i?"following":""}`,onClick:h,disabled:o,title:i?"Unfollow location":"Follow location",children:i?t.jsx(xf,{size:18}):t.jsx(Bl,{size:18})}):null}function fB({locationId:e,name:n,canEdit:s,isEditing:i,onToggleEdit:l,onSave:o,isSaving:d=!1,isSaveDisabled:m=!1,isMobile:p=!1}){const h=n||"Untitled location",y=()=>{typeof l=="function"&&l()},g=()=>{typeof o=="function"&&o()};return t.jsxs("div",{className:"entity-header flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 sm:gap-2",role:"banner",children:[t.jsx("div",{className:"entity-header-center",children:t.jsx("h1",{className:p?"entity-header-title-mobile":"",children:h})}),t.jsxs("div",{className:"entity-header-right",children:[e&&t.jsx(dB,{locationId:e}),s?t.jsxs("div",{className:"entity-header-actions",children:[i&&typeof o=="function"?t.jsx("button",{type:"button",className:"btn submit",onClick:g,disabled:m||d,children:d?"Saving":"Save"}):null,t.jsxs("button",{type:"button",className:`edit-mode-toggle ${i?"is-active":""}`,role:"switch","aria-checked":i,onClick:y,children:[t.jsx("span",{className:"edit-mode-toggle-track","aria-hidden":"true",children:t.jsx("span",{className:"edit-mode-toggle-thumb"})}),t.jsx("span",{className:"edit-mode-toggle-text",children:"Edit"})]})]}):null]})]})}const mB=[{value:"critical",label:"Critical",icon:Jn,color:"#dc2626"},{value:"important",label:"Important",icon:Uc,color:"#ea580c"},{value:"medium",label:"Medium",icon:cg,color:"#6b7280"},{value:null,label:"None",icon:ea,color:"#9ca3af"}];function hB({locationId:e,importance:n,onUpdate:s}){const{selectedCampaignId:i}=jn(),[l,o]=u.useState(!1);if(!i)return null;const d=async m=>{if(!(l||m===n)){o(!0);try{await Kj(e,m),s?.(m)}catch(p){console.error("Failed to update location importance",p)}finally{o(!1)}}};return t.jsxs("div",{className:"entity-importance-selector",children:[t.jsx("span",{className:"entity-importance-label",children:"Importance:"}),t.jsx("div",{className:"entity-importance-buttons",children:mB.map(m=>{const p=m.icon,h=n===m.value;return t.jsxs("button",{type:"button",className:`entity-importance-button ${h?"selected":""}`,onClick:()=>d(m.value),disabled:l,title:m.label,style:h?{"--importance-color":m.color}:{},children:[t.jsx(p,{size:16}),t.jsx("span",{className:"entity-importance-button-label",children:m.label})]},m.value||"none")})})]})}const j_=["global","selective","hidden"],pB=[...j_,"owner_only"],jN=new Set(j_),EN=new Set(pB),ny=(e,n)=>{if(typeof e!="string")return"global";const s=e.toLowerCase();return n.has(s)?s:"global"},uc=e=>e?Array.isArray(e)?e.map(n=>n==null?"":String(n).trim()).filter(Boolean):typeof e=="string"?e.split(",").map(n=>n.trim()).filter(Boolean):[]:[],ay=()=>({campaigns:[],users:[],characters:[]});function yB(e,n,s){const i=e?.id,l=e?.world?.id||e?.world_id||"",o=u.useMemo(()=>e?{readMode:ny(e.read_access||e.readAccess,jN),readCampaigns:uc(e.read_campaign_ids||e.readCampaignIds),readUsers:uc(e.read_user_ids||e.readUserIds),readCharacters:uc(e.read_character_ids||e.readCharacterIds),writeMode:ny(e.write_access||e.writeAccess,EN),writeCampaigns:uc(e.write_campaign_ids||e.writeCampaignIds),writeUsers:uc(e.write_user_ids||e.writeUserIds)}:{readMode:"global",readCampaigns:[],readUsers:[],readCharacters:[],writeMode:"global",writeCampaigns:[],writeUsers:[]},[e]),[d,m]=u.useState(o),[p,h]=u.useState(()=>ay()),[y,g]=u.useState(!1),[x,v]=u.useState(""),[S,N]=u.useState(!1),[E,j]=u.useState(""),[A,T]=u.useState("");u.useEffect(()=>{m(o)},[o]);const _=u.useCallback(async()=>{if(n){if(!l){h(ay()),v(""),g(!1);return}g(!0),v("");try{const z=await Dg(l);h({campaigns:z.campaigns??[],users:z.users??[],characters:z.characters??[]})}catch(z){console.error(" Failed to load access options",z),h(ay()),v(z.message||"Failed to load access options")}finally{g(!1)}}},[n,l]);u.useEffect(()=>{_()},[_]);const M=u.useMemo(()=>{const z=["readMode","readCampaigns","readUsers","readCharacters","writeMode","writeCampaigns","writeUsers"],G=U=>Array.isArray(U)?U.map(X=>String(X).trim()).filter(Boolean).sort():[];return z.some(U=>{const X=d[U],V=o[U];if(Array.isArray(X)||Array.isArray(V)){const R=G(X),B=G(V);return R.length!==B.length?!0:R.some((L,O)=>L!==B[O])}return X!==V})},[d,o]),k=u.useCallback((z,G)=>{j(""),T(""),m(U=>{const X={...U};if(z==="readMode"||z==="writeMode"){const R=ny(G,z==="readMode"?jN:EN);return X[z]=R,z==="readMode"&&R!=="selective"&&(X.readCampaigns=[],X.readUsers=[],X.readCharacters=[]),z==="writeMode"&&R!=="selective"&&(X.writeCampaigns=[],X.writeUsers=[]),X}return["readCampaigns","readUsers","readCharacters","writeCampaigns","writeUsers"].includes(z)?(X[z]=Array.isArray(G)?G.map(V=>String(V).trim()).filter(Boolean):[],X):(X[z]=G,X)})},[]),C=u.useCallback(()=>{m(o),j(""),T("")},[o]),D=u.useCallback(async()=>{if(!s||!i)return!1;if(!M)return!0;j(""),T(""),N(!0);try{const z={read_access:d.readMode,write_access:d.writeMode,read_campaign_ids:d.readMode==="selective"?d.readCampaigns:[],read_user_ids:d.readMode==="selective"?d.readUsers:[],read_character_ids:d.readMode==="selective"?d.readCharacters:[],write_campaign_ids:d.writeMode==="selective"?d.writeCampaigns:[],write_user_ids:d.writeMode==="selective"?d.writeUsers:[]},G=await Rf(i,z);if(!(G?.data||G))throw new Error("Failed to save access settings");return T("Access settings saved."),!0}catch(z){return console.error(" Failed to save access settings",z),j(z.message||"Failed to save access settings"),!1}finally{N(!1)}},[s,i,d,M]);return{accessSettings:d,accessOptions:p,accessOptionsError:x,accessOptionsLoading:y,accessSaving:S,accessSaveError:E,accessSaveSuccess:A,isAccessDirty:M,handleAccessSettingChange:k,resetAccessSettings:C,handleAccessSave:D}}function gB({canEdit:e,worldId:n,accessSettings:s,accessOptions:i,accessOptionsError:l,accessOptionsLoading:o,accessSaving:d,accessSaveError:m,accessSaveSuccess:p,handleAccessSettingChange:h}){return t.jsx("div",{className:"entity-tab-content",children:t.jsxs("section",{className:"entity-card entity-access-card",children:[t.jsx("h2",{className:"entity-card-title",children:"Access controls"}),t.jsx("p",{className:"entity-access-note help-text",children:"Configure who can view and edit this location. Users with write access will automatically receive read access. Changes are saved along with the rest of the record."}),l&&t.jsx("div",{className:"alert error",role:"alert",children:l}),n?t.jsxs(t.Fragment,{children:[t.jsx(Ig,{canEdit:e,accessSettings:s,accessOptions:i,accessOptionsLoading:o,accessSaving:d,onSettingChange:h,idPrefix:"location-access"}),t.jsxs("div",{className:"entity-access-actions",children:[m&&t.jsx("div",{className:"alert error",role:"alert",children:m}),p&&t.jsx("div",{className:"alert success",role:"status",children:p})]})]}):t.jsx("p",{className:"entity-empty-state",children:"Assign this location to a world to configure access settings."})]})})}function bB({renderSchemaSections:e,systemSchema:n,viewData:s}){return t.jsx("div",{className:"entity-tab-content",children:e(n,s,"system")})}function xB({entities:e=[],loading:n=!1,error:s="",locationId:i,worldId:l,onEntitiesChange:o}){const{user:d}=un(),{activeWorldId:m}=jn();Wl();const[p,h]=u.useState(!1),[y,g]=u.useState(""),[x,v]=u.useState([]),[S,N]=u.useState(!1),[E,j]=u.useState(""),[A,T]=u.useState(null),[_,M]=u.useState(null);d?.role;const k=u.useCallback(async z=>{if(!z||!z.trim()||!l){v([]);return}N(!0),j("");try{const G=await Tj({worldId:l,query:z.trim(),limit:20}),U=Array.isArray(G?.data)?G.data:[],X=new Set(e.map(R=>R.id)),V=U.filter(R=>!X.has(R.id));v(V)}catch(G){console.error("Failed to search entities:",G),j(G.message||"Failed to search entities"),v([])}finally{N(!1)}},[l,e]),C=u.useCallback(async z=>{if(!(!i||!z)){M(z);try{await Hj(i,z),o&&o(),h(!1),g(""),v([])}catch(G){console.error("Failed to add entity:",G),alert(G.message||"Failed to add entity to location")}finally{M(null)}}},[i,o]),D=u.useCallback(async z=>{if(!(!i||!z)&&confirm("Are you sure you want to remove this entity from this location?")){T(z);try{await Vj(i,z),o&&o()}catch(G){console.error("Failed to remove entity:",G),alert(G.message||"Failed to remove entity from location")}finally{T(null)}}},[i,o]);return n?t.jsx("div",{className:"entity-tab-content",children:t.jsxs("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:[t.jsx("h2",{className:"entity-card-title",children:"Entities"}),t.jsx("p",{children:"Loading entities..."})]})}):s?t.jsx("div",{className:"entity-tab-content",children:t.jsxs("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:[t.jsx("h2",{className:"entity-card-title",children:"Entities"}),t.jsx("div",{className:"alert error",children:s})]})}):t.jsxs("div",{className:"entity-tab-content",children:[t.jsxs("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[t.jsx("h2",{className:"entity-card-title",style:{margin:0},children:"Entities in this Location"}),t.jsxs("button",{type:"button",className:"btn btn-primary",onClick:()=>h(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx(sa,{size:16}),t.jsx("span",{children:"Add Entity"})]})]}),e.length===0?t.jsx("p",{className:"entity-empty-state",children:"No entities are located here."}):t.jsx("div",{className:"entity-list",children:e.map(z=>t.jsxs("div",{className:"entity-list-item",style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",marginBottom:"0.5rem",border:"1px solid #e5e7eb",borderRadius:"0.5rem",backgroundColor:"#f9fafb"},children:[t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[t.jsxs("span",{className:"entity-link-with-preview",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx(Yt,{to:`/entities/${z.id}`,style:{fontWeight:500,textDecoration:"none",color:"inherit"},children:z.name}),t.jsx(Na,{entityId:z.id,entityName:z.name})]}),z.entityType&&t.jsxs("span",{style:{color:"#6b7280",fontSize:"0.875rem"},children:["(",z.entityType.name,")"]})]}),z.description&&t.jsx("p",{style:{marginTop:"0.25rem",color:"#6b7280",fontSize:"0.875rem",margin:0},children:z.description})]}),t.jsx("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>D(z.id),disabled:A===z.id,style:{marginLeft:"1rem",display:"flex",alignItems:"center",gap:"0.25rem"},title:"Remove entity from location",children:A===z.id?t.jsx("span",{children:"Removing..."}):t.jsxs(t.Fragment,{children:[t.jsx(zn,{size:14}),t.jsx("span",{children:"Remove"})]})})]},z.id))})]}),p&&t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"1rem"},onClick:z=>{z.target===z.currentTarget&&(h(!1),g(""),v([]))},children:t.jsxs("div",{className:"entity-card bg-white rounded-lg border",style:{width:"100%",maxWidth:"600px",maxHeight:"80vh",overflow:"auto",padding:"1.5rem"},onClick:z=>z.stopPropagation(),children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[t.jsx("h3",{style:{margin:0},children:"Add Entity to Location"}),t.jsx("button",{type:"button",className:"btn btn-sm btn-secondary",onClick:()=>{h(!1),g(""),v([])},children:t.jsx(ea,{size:16})})]}),t.jsxs("div",{style:{marginBottom:"1rem"},children:[t.jsx("label",{htmlFor:"entity-search",style:{display:"block",marginBottom:"0.5rem",fontWeight:500},children:"Search for entity"}),t.jsx("input",{id:"entity-search",type:"text",value:y,onChange:z=>{const G=z.target.value;g(G),k(G)},placeholder:"Type to search...",style:{width:"100%",padding:"0.5rem",border:"1px solid #d1d5db",borderRadius:"0.375rem"}})]}),E&&t.jsx("div",{className:"alert error",style:{marginBottom:"1rem"},children:E}),S&&t.jsx("p",{style:{textAlign:"center",color:"#6b7280"},children:"Searching..."}),!S&&y&&x.length===0&&!E&&t.jsx("p",{style:{textAlign:"center",color:"#6b7280"},children:"No entities found"}),!S&&x.length>0&&t.jsx("div",{style:{maxHeight:"400px",overflowY:"auto"},children:x.map(z=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem",marginBottom:"0.5rem",border:"1px solid #e5e7eb",borderRadius:"0.375rem"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:500},children:z.name}),z.typeName&&t.jsx("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:z.typeName})]}),t.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>C(z.id),disabled:_===z.id,children:_===z.id?"Adding...":"Add"})]},z.id))})]})})]})}const E_=20,vB=250,_N=Object.freeze([]),hf=e=>{if(!e)return null;if(e.id===void 0){const s=e.data??e.location??e.result;return s?hf(s):null}const n=e.locationType||e.location_type||(e.location_type_id?{id:e.location_type_id,name:e.location_type_name}:null);return{id:e.id,name:e.name||"Untitled location",typeId:n?.id??e.location_type_id??null,typeName:n?.name??e.location_type_name??""}},SB=e=>{if(!e)return{data:[],pagination:{hasMore:!1,total:0,limit:E_,offset:0}};if(Array.isArray(e))return{data:e.map(i=>hf(i)).filter(Boolean),pagination:{hasMore:!1,limit:e.length,offset:0,total:e.length}};const n=Array.isArray(e.data)?e.data:[],s=e.pagination&&typeof e.pagination=="object"?e.pagination:{hasMore:!1,limit:n.length,offset:0,total:n.length};return{data:n.map(i=>hf(i)).filter(Boolean),pagination:s}},wB=(e,n)=>{const[s,i]=u.useState(e);return u.useEffect(()=>{const l=setTimeout(()=>i(e),n);return()=>clearTimeout(l)},[e,n]),s},__=({worldId:e,allowedTypeIds:n,value:s,onChange:i,placeholder:l="Search for location",disabled:o=!1,onLocationResolved:d,limit:m=E_,excludeIds:p})=>{const h=n!==void 0,y=u.useMemo(()=>n||_N,[n]),g=u.useMemo(()=>p||_N,[p]),[x,v]=u.useState(""),[S,N]=u.useState([]),[E,j]=u.useState(!1),[A,T]=u.useState(""),[_,M]=u.useState(!1),[k,C]=u.useState(!1),[D,z]=u.useState(0),[G,U]=u.useState(null),[X,V]=u.useState(!1),[R,B]=u.useState(""),L=wB(x,vB),O=u.useRef(null),$=u.useRef(null),F=u.useRef(0),H=o||!e,I=u.useCallback(()=>{N([]),C(!1),z(0),T("")},[]),Y=u.useCallback(()=>{M(!1)},[]),P=u.useCallback(pe=>{if(!pe){d?.(null);return}d?.(pe)},[d]);u.useEffect(()=>{if(!s){U(null),v(""),V(!0),P(null);return}const pe=String(s);if(G&&String(G.id)===pe){X||(v(G.name??""),V(!0));return}let we=!1;const ne=++F.current;return j(!0),T(""),Ri(pe).then(Le=>{if(we||ne!==F.current)return;const be=hf(Le?.data||Le);be?(U(be),v(be.name),P(be)):(U(null),P(null)),V(!0)}).catch(Le=>{we||ne!==F.current||(U(null),T(Le.message||"Failed to load location"),P(null))}).finally(()=>{we||ne!==F.current||j(!1)}),()=>{we=!0}},[s,G,X,P]),u.useEffect(()=>{if(!_)return;const pe=we=>{O.current&&(O.current.contains(we.target)||Y())};return document.addEventListener("mousedown",pe),()=>{document.removeEventListener("mousedown",pe)}},[_,Y]);const K=u.useCallback(async({append:pe=!1}={})=>{if(!e){I();return}const we=L.trim();if(we.length>0&&we.length<2){pe||(N([]),j(!1));return}const ne=pe?D:0,Le=++F.current;j(!0),T("");try{console.log(" [LocationSelect] Fetching locations...",{worldId:e,query:we,allowedTypeIds:y,excludeIds:g});const Oe=await Li({worldId:e,includeEntities:"false",all:"true"});if(Le!==F.current)return;const Me=Oe?.data||[];console.log(" [LocationSelect] Fetched all locations:",{totalCount:Me.length,sampleLocations:Me.slice(0,5).map(ie=>({id:ie.id,name:ie.name,typeId:ie.location_type_id||ie.locationType?.id,typeName:ie.locationType?.name,parentId:ie.parent_id||ie.parent?.id}))});const ut=we.toLowerCase(),ht=new Set(g.map(ie=>String(ie))),_t=y.length>0?new Set(y.map(ie=>String(ie))):null;console.log(" [LocationSelect] Filtering locations...",{allowedTypeIds:y,allowedTypeIdSet:_t?Array.from(_t):null,excludeIds:Array.from(ht),hasAllowedTypes:!!_t&&_t.size>0,hasAllowedTypeIdsRestriction:h,isExplicitlyEmpty:h&&y.length===0});const jt=Me.reduce((ie,J)=>{const le=String(J.location_type_id||J.locationType?.id||"unknown"),fe=J.locationType?.name||"unknown";return ie[fe]||(ie[fe]={typeId:le,locations:[]}),ie[fe].locations.push({id:J.id,name:J.name}),ie},{});console.log(" [LocationSelect] Locations by type before filter:",jt);let ve=Me.filter(ie=>{if(ht.has(String(ie.id))||we&&!ie.name?.toLowerCase().includes(ut))return!1;if(h){if(y.length===0)return console.log(" [LocationSelect]  No allowed types - filtering out all locations"),!1;if(_t&&_t.size>0){const J=ie.location_type_id||ie.locationType?.id,le=J?String(J):"";if(le&&_t.has(le))console.log(" [LocationSelect]  Included location (type matches):",{name:ie.name,typeId:le,typeName:ie.locationType?.name});else return console.log(" [LocationSelect]  Excluded location (type not in allowed list):",{name:ie.name,typeId:le,typeName:ie.locationType?.name,allowedTypeIds:Array.from(_t),allowedTypeNames:Array.from(_t).map(Ue=>Ue)}),!1}}return!0});console.log(" [LocationSelect] After filtering:",{before:Me.length,after:ve.length,filteredLocations:ve.map(ie=>({id:ie.id,name:ie.name,typeId:ie.location_type_id||ie.locationType?.id,typeName:ie.locationType?.name,parentId:ie.parent_id||ie.parent?.id}))});const tt=ne,st=tt+m,$e=ve.slice(tt,st),{data:Ye,pagination:mt}=SB($e);if(B(we),pe)N(ie=>{const le=ie.length+Ye.length<ve.length;return C(le),[...ie,...Ye]});else{N(Ye);const J=Ye.length<ve.length;C(J)}z(st)}catch(be){if(Le!==F.current)return;T(be.message||"Failed to search locations"),pe||N([])}finally{Le===F.current&&j(!1)}},[e,y,h,L,m,D,I,g]);u.useEffect(()=>{_&&K({append:!1})},[L,y,e,K,_]),u.useEffect(()=>{if(!_)return;const pe=G?String(G.id):"";if(!pe||!$.current)return;const we=$.current.querySelector(`[data-location-option="${pe}"]`);we&&we.scrollIntoView({block:"nearest"})},[S,G,_]),u.useEffect(()=>{_&&R!==L.trim()&&I()},[L,R,_,I]);const re=()=>{H||M(!0)},W=pe=>{v(pe.target.value),_||M(!0)},ue=pe=>{U(pe),v(pe.name??""),Y(),i?.(String(pe.id)),P(pe)},Q=()=>{E||!k||K({append:!0})},ye=()=>{U(null),v(""),i?.(""),P(null),M(!1)},ae=u.useMemo(()=>!H&&!!G?.id,[H,G]),ke=u.useMemo(()=>H&&!e?"No world selected":l,[H,e,l]);return t.jsxs("div",{className:`entity-select${H?" disabled":""}`,ref:O,children:[t.jsxs("div",{className:"entity-select-input-wrapper",children:[t.jsx("input",{type:"text",className:"entity-select-input",value:x,onChange:W,onFocus:re,placeholder:ke,disabled:H,"aria-autocomplete":"list","aria-expanded":_,"aria-haspopup":"listbox",role:"combobox"}),ae&&t.jsx("button",{type:"button",className:"entity-select-clear",onClick:ye,"aria-label":"Clear selection",children:""})]}),_&&t.jsxs("div",{className:"entity-select-dropdown",children:[t.jsx("ul",{className:"entity-select-results",role:"listbox",ref:$,children:S.map(pe=>{const we=G&&String(G.id)===String(pe.id);return t.jsxs("li",{className:`entity-select-option${we?" selected":""}`,onMouseDown:ne=>{ne.preventDefault(),ue(pe)},"data-location-option":pe.id,role:"option","aria-selected":we,children:[t.jsx("span",{className:"entity-select-option-name",children:pe.name}),pe.typeName&&t.jsx("span",{className:"entity-select-option-type",children:pe.typeName})]},pe.id)})}),E&&t.jsx("div",{className:"entity-select-status",role:"status",children:"Loading"}),!E&&S.length===0&&!A&&L.trim().length>=2&&t.jsx("div",{className:"entity-select-status",children:"No matching locations found."}),!E&&S.length===0&&!A&&L.trim().length>0&&L.trim().length<2&&t.jsx("div",{className:"entity-select-status",children:"Type at least 2 characters to search."}),!E&&S.length===0&&!A&&L.trim().length===0&&t.jsx("div",{className:"entity-select-status",children:"Start typing to search for locations."}),A&&t.jsx("div",{className:"entity-select-error",children:A}),k&&!E&&t.jsx("button",{type:"button",className:"entity-select-load-more",onClick:Q,children:"Load more"})]})]})};__.propTypes={worldId:Mt.oneOfType([Mt.string,Mt.number]),allowedTypeIds:Mt.arrayOf(Mt.oneOfType([Mt.string,Mt.number])),value:Mt.oneOfType([Mt.string,Mt.number]),onChange:Mt.func,placeholder:Mt.string,disabled:Mt.bool,onLocationResolved:Mt.func,limit:Mt.number,excludeIds:Mt.arrayOf(Mt.oneOfType([Mt.string,Mt.number]))};function NB({location:e,worldId:n,path:s=[],onLocationsChange:i}){const{user:l}=un(),{activeWorldId:o}=jn();Wl();const[d,m]=u.useState([]),[p,h]=u.useState(!1),[y,g]=u.useState(""),[x,v]=u.useState(!1),[S,N]=u.useState(""),[E,j]=u.useState(!1),[A,T]=u.useState([]),[_,M]=u.useState(null),[k,C]=u.useState(null);u.useRef(`location-form-${Math.random().toString(36).slice(2)}`),l?.role;const D=u.useCallback(async()=>{if(!e?.id||!n){m([]);return}h(!0),g("");try{const I=await Li({worldId:n,parentId:e.id,includeEntities:"false"});m(I?.data||[])}catch(I){console.error(" Failed to load child locations:",I),g(I.message||"Failed to load child locations")}finally{h(!1)}},[e?.id,n]);u.useEffect(()=>{D()},[D]);const z=u.useCallback(async()=>{if(o)try{const I=await Pi({worldId:o});T(I?.data||[])}catch(I){console.error(" Failed to load location types:",I)}},[o]);u.useEffect(()=>{z()},[z]);const G=u.useCallback(async I=>{if(!(!e?.id||!I)){C(I);try{await Yj(e.id,I),await D(),i&&i(),v(!1),N(""),j(!1)}catch(Y){console.error("Failed to add child location:",Y);const P=Y.message||"Failed to add child location";P.includes("ancestor")?alert("Cannot add this location as a child because it is an ancestor of the current location. This would create a circular reference."):alert(P)}finally{C(null)}}},[e?.id,D,i]),U=u.useCallback(I=>{I&&G(I)},[G]),X=u.useCallback(()=>{j(!0)},[]),V=u.useCallback(async I=>{I?.id?await G(I.id):(v(!1),j(!1))},[G]),R=u.useCallback(()=>{j(!1)},[]),B=u.useCallback(()=>{v(!1),N(""),j(!1)},[]),[L,O]=u.useState([]);u.useEffect(()=>{if(!e?.id){O([]);return}(async()=>{try{const{fetchLocationPath:Y}=await si(async()=>{const{fetchLocationPath:W}=await Promise.resolve().then(()=>Jj);return{fetchLocationPath:W}},void 0),re=((await Y(e.id))?.data||[]).filter(W=>W.id!==e.id).map(W=>W.id);O(re)}catch(Y){console.error("Failed to load location path:",Y),O([])}})()},[e?.id]);const $=u.useMemo(()=>[e?.id,...d.map(I=>I.id),...L].filter(Boolean),[e?.id,d,L]),F=u.useMemo(()=>{if(!e?.location_type_id||!A||A.length===0)return[];const I=String(e.location_type_id);return A.find(P=>String(P.id)===I),rB(I,A)},[e?.location_type_id,A]),H=u.useCallback(async I=>{if(!(!e?.id||!I)&&confirm("Are you sure you want to remove this location as a child?")){M(I);try{await Gj(e.id,I),await D(),i&&i()}catch(Y){console.error("Failed to remove child location:",Y),alert(Y.message||"Failed to remove child location")}finally{M(null)}}},[e?.id,D,i]);return p?t.jsx("div",{className:"entity-tab-content",children:t.jsxs("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:[t.jsx("h2",{className:"entity-card-title",children:"Locations"}),t.jsx("p",{children:"Loading locations..."})]})}):y?t.jsx("div",{className:"entity-tab-content",children:t.jsxs("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:[t.jsx("h2",{className:"entity-card-title",children:"Locations"}),t.jsx("div",{className:"alert error",children:y})]})}):t.jsxs("div",{className:"entity-tab-content",children:[e?.parent&&t.jsxs("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",style:{marginBottom:"1rem"},children:[t.jsx("h2",{className:"entity-card-title",children:"Parent Location"}),t.jsx("div",{style:{marginTop:"0.5rem"},children:t.jsxs(Yt,{to:`/locations/${e.parent.id}`,style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},children:[t.jsx(Wd,{size:16}),t.jsx("span",{style:{fontWeight:500},children:e.parent.name})]})})]}),t.jsxs("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[t.jsx("h2",{className:"entity-card-title",style:{margin:0},children:"Child Locations"}),t.jsxs("button",{type:"button",className:"btn btn-primary",onClick:()=>v(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx(sa,{size:16}),t.jsx("span",{children:"Add Location"})]})]}),d.length===0?t.jsx("p",{className:"entity-empty-state",children:"This location has no child locations."}):t.jsx("div",{className:"entity-list",children:d.map(I=>t.jsxs("div",{className:"entity-list-item",style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem",marginBottom:"0.5rem",border:"1px solid #e5e7eb",borderRadius:"0.5rem",backgroundColor:"#f9fafb"},children:[t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsxs("span",{className:"location-link-with-preview",style:{display:"flex",alignItems:"center",gap:"0.5rem",flex:1},children:[t.jsxs(Yt,{to:`/locations/${I.id}`,style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit",flex:1},children:[t.jsx(Wd,{size:16}),t.jsx("span",{style:{fontWeight:500},children:I.name})]}),t.jsx(fs,{locationId:I.id,locationName:I.name})]}),I.locationType&&t.jsxs("span",{style:{color:"#6b7280",fontSize:"0.875rem"},children:["(",I.locationType.name,")"]}),I.childCount>0&&t.jsx(Jr,{size:16,style:{marginLeft:"auto",color:"#6b7280"}}),I.description&&t.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1.5rem",color:"#6b7280",fontSize:"0.875rem",margin:"0.25rem 0 0 1.5rem"},children:I.description})]}),t.jsx("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>H(I.id),disabled:_===I.id,style:{marginLeft:"1rem",display:"flex",alignItems:"center",gap:"0.25rem"},title:"Remove child location",children:_===I.id?t.jsx("span",{children:"Removing..."}):t.jsxs(t.Fragment,{children:[t.jsx(zn,{size:14}),t.jsx("span",{children:"Remove"})]})})]},I.id))})]}),t.jsx(Bs,{isOpen:x,onClose:B,title:E?"Create Location":"Add Child Location",size:"md",children:E?t.jsx(N_,{location:null,parentId:e?.id,locationTypes:A,onClose:R,onSuccess:V}):t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"1.5rem"},children:[t.jsx("label",{htmlFor:"location-select",style:{display:"block",marginBottom:"0.5rem",fontWeight:500},children:"Search and select a location"}),t.jsx(__,{worldId:o,value:S,onChange:U,placeholder:"Type to search locations...",excludeIds:$,allowedTypeIds:F,onLocationResolved:I=>{I&&N(I.id)}})]}),t.jsxs("div",{style:{marginTop:"1.5rem",paddingTop:"1.5rem",borderTop:"1px solid #e5e7eb"},children:[t.jsx("p",{style:{marginBottom:"0.75rem",color:"#6b7280",fontSize:"0.875rem"},children:"Can't find the location you're looking for?"}),t.jsxs("button",{type:"button",className:"btn secondary",onClick:X,style:{width:"100%"},children:[t.jsx(sa,{size:16,style:{marginRight:"0.5rem"}}),"Create New Location"]})]})]})})]})}const jB={private:"Private",companions:"Shared with companions",dm:"Shared with DM",party:"Share with Party"},EB=[{value:"private",label:"Private"},{value:"companions",label:"My Companions"}],_B=[{value:"private",label:"Private"},{value:"party",label:"Share with Party"}],sy=e=>{if(!e)return"";if(e instanceof Date){if(Number.isNaN(e.getTime()))return"";try{return e.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(n){return console.warn("Unable to format Date object",n,e),""}}if(typeof e=="string"||typeof e=="number")try{const n=new Date(e);return Number.isNaN(n.getTime())?(console.warn("Invalid date value:",e),""):n.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(n){return console.warn("Unable to parse date value",n,e),""}return console.warn("Unexpected date value type:",typeof e,e),""},ry=e=>e?.author?.username||e?.author?.name||e?.author?.email||e?.author_name||e?.author_email||"Unknown adventurer",CN=e=>{const n=e?.author||{},s=n?.id??n?.authorId??e?.authorId??e?.author_id??e?.authorID;if(s!=null)return`id:${String(s)}`;const i=n?.email??e?.author_email;if(i)return`email:${String(i).toLowerCase()}`;const l=n?.username??n?.name??e?.author_username??e?.author_name;return l?`name:${String(l).toLowerCase()}`:"unknown"},va=Object.freeze([]),AN="What do you want to remember?";function C_({location:e,worldId:n,selectedCampaign:s,selectedCampaignId:i,isCampaignDm:l,isCampaignPlayer:o,canCreateNote:d,notes:m=va,loading:p,error:h,onCreateNote:y,creating:g,campaignMatchesLocationWorld:x,onNoteUpdate:v,onNoteDelete:S}){const{user:N}=un(),[E,j]=u.useState(""),[A,T]=u.useState("private"),[_,M]=u.useState(""),[k,C]=u.useState(va),[D,z]=u.useState(!1),[G,U]=u.useState(""),[X,V]=u.useState(""),[R,B]=u.useState(""),[L,O]=u.useState(!1),[$,F]=u.useState("all"),[H,I]=u.useState("notes"),[Y,P]=u.useState("location"),[K,re]=u.useState(null),[W,ue]=u.useState(""),[Q,ye]=u.useState("private"),[ae,ke]=u.useState(""),[pe,we]=u.useState(!1),[ne,Le]=u.useState(null),[be,Oe]=u.useState({items:va,loading:!1,error:"",loaded:!1}),[Me,ut]=u.useState({items:va,loading:!1,error:"",loaded:!1}),[ht,_t]=u.useState(()=>new Set),jt=!!i&&!!d&&!!x,ve=u.useMemo(()=>l?_B:EB,[l]),tt=u.useMemo(()=>n||e&&typeof e=="object"&&((e.world||{}).id||e.world_id)||"",[e,n]),st=u.useCallback(Z=>{if(!N||!Z)return!1;const Ee=Z?.author?.id??Z?.createdBy??Z?.created_by??Z?.authorId??Z?.author_id??null;return Ee?String(Ee)===String(N.id):!1},[N]),$e=u.useCallback((Z,Ee)=>{const _e=typeof Ee=="string"?Ee:typeof Z?.target?.value=="string"?Z.target.value:"";j(_e),V("")},[]),Ye=u.useCallback(async(Z,Ee)=>{const _e=Z?.trim()??"";if(typeof Ee!="function")return;if(!tt||_e.length===0){Ee([]);return}const{searchMentions:ge}=await si(async()=>{const{searchMentions:Pe}=await import("./mentionSearch-D9Dt0xF8.js");return{searchMentions:Pe}},[]);await ge({worldId:tt,query:_e,limit:8,callback:Ee})},[tt]),mt=u.useCallback(()=>{O(!1),V(""),B("")},[]),ie=u.useCallback(()=>{jt&&(V(""),B(""),O(!0))},[jt]),J=u.useCallback(async Z=>{if(Z.preventDefault(),!jt||!y)return;const Ee=E.trim();if(!Ee){V("Please enter a note before saving");return}if(o&&!_){V("Select which character this note is for");return}V(""),B("");try{const _e={content:Ee,shareType:A,campaignId:i};o&&(_e.characterId=_);const ge=await y(_e);if(!ge||ge.success!==!0){V(ge?.message||"Failed to save note");return}j(""),o||M(""),mt()}catch(_e){console.error("Failed to submit note",_e),V(_e.message||"Failed to save note")}},[jt,E,y,A,i,o,_,mt]),le=u.useCallback(()=>{re(null),ue(""),ye("private"),ke(""),V("")},[]),fe=u.useCallback(Z=>{if(!Z||!e?.id)return;const Ee=Z?.characterId??Z?.character_id??"";re(Z.id),ue(Z?.content??""),ye(Z?.shareType??Z?.share_type??"private"),ke(Ee),V("")},[e?.id]),Ue=u.useCallback((Z,Ee)=>{const _e=typeof Ee=="string"?Ee:typeof Z?.target?.value=="string"?Z.target.value:"";ue(_e),V("")},[]),qe=u.useCallback(async Z=>{if(!Z||!e?.id||!i)return;const Ee=W.trim();if(!Ee){V("Please enter a note before saving");return}const _e=Z?.characterId??Z?.character_id??"";if(o&&_e&&!ae){V("Select which character this note is for");return}we(!0),V("");try{const ge={content:Ee,shareType:Q,campaignId:i};o&&ae&&(ge.characterId=ae);const Pe=await bg(e.id,Z.id,ge),oe=Pe?.data||Pe;if(!oe)throw new Error("Note could not be updated");v&&await v(oe),le()}catch(ge){console.error("Failed to update note",ge),V(ge.message||"Failed to update note")}finally{we(!1)}},[e?.id,i,W,Q,ae,o,v,le]),ze=u.useCallback(async Z=>{if(!(!Z?.id||!e?.id||!i||!window.confirm("Are you sure you want to delete this note? This action cannot be undone."))){Le(Z.id),V("");try{await xg(e.id,Z.id,{campaignId:i}),S&&await S(Z.id)}catch(_e){console.error("Failed to delete note",_e),V(_e.message||"Failed to delete note")}finally{Le(null)}}},[e?.id,i,S]),Ce=u.useMemo(()=>{const Z=Array.isArray(m)?m:va;return Z.length<=1?Z:[...Z].sort((Ee,_e)=>{const ge=new Date(Ee?.createdAt??Ee?.created_at??0).getTime(),Pe=new Date(_e?.createdAt??_e?.created_at??0).getTime();return Number.isNaN(ge)||Number.isNaN(Pe)?0:Pe-ge})},[m]),pt=u.useMemo(()=>{const Z=[{value:"all",label:"All notes"}],Ee=new Set(["all"]);return Ce.forEach(_e=>{const ge=CN(_e);!ge||Ee.has(ge)||(Ee.add(ge),Z.push({value:ge,label:ry(_e)}))}),Z},[Ce]),bt=u.useMemo(()=>$==="all"?Ce:Ce.filter(Z=>CN(Z)===$),[$,Ce]),Ct=u.useMemo(()=>Array.isArray(be.items)?be.items:va,[be.items]),Ze=u.useMemo(()=>Array.isArray(Me.items)?Me.items:va,[Me.items]);u.useEffect(()=>{T("private")},[l,i]),u.useEffect(()=>{pt.some(Z=>Z.value===$)||F("all")},[pt,$]),u.useEffect(()=>{Oe({items:va,loading:!1,error:"",loaded:!1}),ut({items:va,loading:!1,error:"",loaded:!1}),_t(new Set),P("location")},[i,e?.id,x]),u.useEffect(()=>{let Z=!1;return!o||!i?(C(va),z(!1),U(""),M(""),()=>{Z=!0}):((async()=>{z(!0),U("");try{const _e=await js({scope:"my",campaign_id:i});if(Z)return;const Pe=(Array.isArray(_e?.data)?_e.data:Array.isArray(_e)?_e:[]).map(oe=>({id:oe?.id?String(oe.id):"",name:oe?.name||"Unnamed character"})).filter(oe=>oe.id);C(Pe),Pe.length===1?M(Pe[0].id):Pe.some(oe=>oe.id===_)||M("")}catch(_e){if(Z)return;console.error("Failed to load characters for notes",_e),C(va),M(""),U(_e.message||"Failed to load characters")}finally{Z||z(!1)}})(),()=>{Z=!0})},[o,i,_]);const ot=u.useCallback(async()=>{if(!(!e?.id||!i||!x)){Oe(Z=>({...Z,loading:!0,error:""}));try{const Z=await Wj(e.id,{campaignId:i}),Ee=Array.isArray(Z?.data)?Z.data:Array.isArray(Z)?Z:va;Oe({items:Ee,loading:!1,error:"",loaded:!0})}catch(Z){Oe({items:va,loading:!1,error:Z?.message||"Failed to load mentions",loaded:!0})}}},[x,e?.id,i]),Tt=u.useCallback(async()=>{if(!(!e?.id||!i||!x)){ut(Z=>({...Z,loading:!0,error:""}));try{const Z=await Zj(e.id,{campaignId:i}),Ee=Array.isArray(Z?.data)?Z.data:Array.isArray(Z)?Z:va;ut({items:Ee,loading:!1,error:"",loaded:!0})}catch(Z){ut({items:va,loading:!1,error:Z?.message||"Failed to load mentions",loaded:!0})}}},[x,e?.id,i]);u.useEffect(()=>{H==="mentions"&&(!be.loading&&!be.loaded&&ot(),!Me.loading&&!Me.loaded&&Tt())},[H,be.loading,be.loaded,Me.loading,Me.loaded,ot,Tt]);const $t=s?.name||"",Qt=u.useCallback(Z=>{const Ee=ry(Z),_e=Z?.character?.name||"";return _e?`${Ee} (as ${_e})`:Ee},[]),At=u.useCallback(Z=>{const Ee=String(Z?.shareType??Z?.share_type??"private");return jB[Ee]||"Private"},[]),kt=u.useCallback(Z=>{const Ee=Oi(Z?.content||"",Z?.mentions);return Ee.length?Ee.map((_e,ge)=>{if(_e.type==="mention"){if(_e.locationId){const at=`${Z?.id||"note"}-mention-${ge}`,dt=_e.locationName||"location";return t.jsxs("span",{className:"entity-note-mention",children:["@",dt,t.jsx(fs,{locationId:_e.locationId,locationName:dt})]},at)}if(_e.entityId){const at=`${Z?.id||"note"}-mention-${ge}`,dt=_e.entityName||"entity";return t.jsxs("span",{className:"entity-note-mention",children:["@",dt,t.jsx(Na,{entityId:_e.entityId,entityName:dt})]},at)}const Pe=_e.locationName||_e.entityName||"mention",oe=`${Z?.id||"note"}-mention-${ge}`;return t.jsxs("span",{className:"entity-note-mention",children:["@",Pe]},oe)}return t.jsx("span",{className:"entity-note-text",children:_e.text},`${Z?.id||"note"}-text-${ge}`)}):null},[]),qt=u.useCallback(Z=>{const Ee=Oi(Z?.content,Z?.mentions);if(!Ee.length)return"";const _e=Ee.map(ge=>ge.type==="mention"?`@${ge.locationName||ge.entityName||"mention"}`:ge.text||"").join("").replace(/\s+/g," ").trim();return _e.length<=180?_e:`${_e.slice(0,177)}`},[]),Lt=u.useCallback(Z=>{const Ee=Z?.sessionDate??Z?.session_date;if(!Ee)return"";try{const _e=new Date(Ee);if(!Number.isNaN(_e.getTime()))return _e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch(_e){return console.warn("Unable to format session date",_e),Ee}return Ee},[]),ce=u.useCallback(Z=>{const Ee=String(Z);_t(_e=>{const ge=new Set(_e);return ge.has(Ee)?ge.delete(Ee):ge.add(Ee),ge})},[]),Ae=u.useCallback(Z=>ht.has(String(Z)),[ht]),Te=u.useCallback(()=>{!e?.id||!i||!x||(Y==="location"?ot():Tt())},[x,e?.id,ot,Tt,Y,i]),Ke=g,Se=g||!E.trim()||o&&!_,Be=Ce.length===0||pt.length<=1,We=o&&jt,se=We&&k.length===1;return u.useEffect(()=>{(H!=="notes"||!jt)&&L&&mt()},[H,jt,L,mt]),h==="CAMPAIGN_CONTEXT_ACCESS_DENIED"?t.jsx("div",{className:"entity-notes-container",children:t.jsxs("div",{className:"alert error",style:{padding:"1.5rem",maxWidth:"600px",margin:"2rem auto"},children:[t.jsx("h2",{style:{marginTop:0,marginBottom:"1rem"},children:"Access Restricted by Campaign Context"}),t.jsx("p",{style:{marginBottom:"1rem"},children:"You don't have access to notes for this location with your current campaign context selected."}),t.jsx("p",{children:"To view notes, please change your campaign context using the selector in the header to a campaign that has access to this location."})]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"entity-notes-card-strict",children:[t.jsxs("div",{className:"entity-notes-header-row",children:[t.jsx("h2",{className:"entity-notes-title",children:"Notes"}),H==="notes"&&jt?t.jsx("button",{type:"button",className:"btn-primary",onClick:ie,disabled:g,children:"+ Create note"}):null]}),s?.name?t.jsxs("p",{className:"entity-notes-campaign-line",children:["Campaign: ",$t]}):null,t.jsxs("div",{className:"entity-notes-tabs-row",children:[t.jsx("button",{type:"button",className:`entity-notes-strict-tab-button${H==="notes"?" active":""}`,onClick:()=>I("notes"),children:"Notes"}),t.jsx("button",{type:"button",className:`entity-notes-strict-tab-button${H==="mentions"?" active":""}`,onClick:()=>I("mentions"),children:"@Mentions"})]}),H==="notes"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"entity-notes-strict-filter",children:[t.jsx("span",{className:"entity-notes-strict-filter-label",children:"Show notes from"}),t.jsx("select",{className:"entity-notes-strict-filter-select",value:$,onChange:Z=>F(Z.target.value),disabled:Be,children:pt.map(Z=>t.jsx("option",{value:Z.value,children:Z.label},Z.value))})]}),h?t.jsxs("div",{className:"entity-notes-strict-alert error",children:[t.jsx(Jn,{size:16}),t.jsx("p",{children:h})]}):null,p?t.jsxs("div",{className:"entity-notes-strict-loading",children:[t.jsx(mn,{className:"spin",size:20}),t.jsx("span",{children:"Loading notes"})]}):null,!p&&bt.length===0?t.jsx("p",{className:"entity-notes-strict-empty",children:"No notes yet."}):null,!p&&bt.length>0?t.jsx("div",{className:"entity-notes-strict-list",children:bt.map(Z=>{const Ee=Z?.createdAt??Z?.created_at??Z?.timestamp??null,_e=sy(Ee);String(Z?.shareType??Z?.share_type??"private");const ge=K===Z?.id,Pe=st(Z);return Z?.characterId??Z?.character_id,t.jsx("div",{className:"entity-notes-strict-note-item",children:ge?t.jsxs("div",{className:"entity-notes-strict-edit-panel",children:[t.jsx(Pl,{value:W,onChange:Ue,markup:"@[__display__](__id__)",placeholder:AN,className:"entity-note-mentions",inputProps:{className:"entity-notes-strict-textarea","aria-label":"Edit note content",rows:5,required:!0},children:t.jsx(ti,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(oe,at)=>`@${at||(oe.includes(":")?oe.split(":")[1]:oe)}`,data:Ye,appendSpaceOnAdd:!0})}),t.jsx("p",{className:"entity-notes-strict-share-label",children:"Share with"}),t.jsx("div",{className:"entity-notes-strict-share-options",children:ve.map(oe=>t.jsxs("label",{className:"entity-notes-strict-share-option",children:[t.jsx("input",{type:"radio",name:`location-note-share-edit-${Z.id}`,value:oe.value,checked:Q===oe.value,onChange:()=>ye(oe.value),disabled:pe}),oe.value==="private"?"Private":oe.value==="party"?"Share with Party":oe.label]},oe.value))}),X?t.jsxs("div",{className:"entity-notes-strict-alert error",children:[t.jsx(Jn,{size:16}),t.jsx("p",{children:X})]}):null,t.jsxs("div",{className:"entity-notes-strict-edit-actions",children:[t.jsx("button",{type:"button",className:"btn-primary",onClick:()=>qe(Z),disabled:pe||!W.trim(),children:pe?t.jsxs(t.Fragment,{children:[t.jsx(mn,{className:"spin",size:16})," Saving"]}):"Save"}),t.jsx("button",{type:"button",className:"btn-secondary",onClick:le,disabled:pe,children:"Cancel"})]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"entity-notes-strict-note-header",children:[t.jsxs("div",{className:"entity-notes-strict-note-title-row",children:[t.jsx("span",{className:"entity-notes-strict-note-title",children:Qt(Z)}),t.jsx("span",{className:"entity-notes-strict-note-visibility",children:At(Z)})]}),t.jsx("span",{className:"entity-notes-strict-note-timestamp",children:_e||""})]}),t.jsx("p",{className:"entity-notes-strict-note-body",children:kt(Z)}),Pe?t.jsxs("div",{className:"entity-notes-strict-note-actions",children:[t.jsx("button",{type:"button",className:"entity-notes-strict-edit-button",onClick:()=>fe(Z),children:"Edit"}),t.jsx("button",{type:"button",className:"entity-notes-strict-delete-button",onClick:()=>ze(Z),disabled:ne===Z.id,children:ne===Z.id?t.jsx(mn,{className:"spin",size:14}):"Delete"})]}):null]})},Z?.id)})}):null]}):t.jsxs("div",{className:"entity-notes-strict-mentions",children:[t.jsxs("div",{className:"entity-notes-strict-mentions-header",children:[t.jsxs("div",{className:"entity-notes-strict-mention-toggle",children:[t.jsxs("button",{type:"button",className:`entity-notes-strict-mention-toggle-button${Y==="location"?" active":""}`,onClick:()=>P("location"),children:["Location Notes",be.loaded?t.jsx("span",{className:"entity-notes-strict-mention-count",children:Ct.length}):null]}),t.jsxs("button",{type:"button",className:`entity-notes-strict-mention-toggle-button${Y==="session"?" active":""}`,onClick:()=>P("session"),children:["Session Notes",Me.loaded?t.jsx("span",{className:"entity-notes-strict-mention-count",children:Ze.length}):null]})]}),t.jsx("button",{type:"button",className:"btn-secondary",onClick:Te,disabled:!i||!x||(Y==="location"?be.loading:Me.loading),children:(Y==="location"?be.loading:Me.loading)?t.jsxs(t.Fragment,{children:[t.jsx(mn,{className:"spin",size:16})," Refreshing"]}):"Refresh"})]}),Y==="location"?t.jsxs(t.Fragment,{children:[be.error?t.jsxs("div",{className:"entity-notes-strict-alert error",children:[t.jsx(Jn,{size:16}),t.jsx("p",{children:be.error})]}):null,be.loading?t.jsxs("div",{className:"entity-notes-strict-loading",children:[t.jsx(mn,{className:"spin",size:20}),t.jsx("span",{children:"Loading mentions"})]}):null,!be.loading&&be.loaded&&Ct.length===0?t.jsx("p",{className:"entity-notes-strict-empty",children:"This location hasn't been mentioned in location or entity notes yet."}):null,!be.loading&&be.loaded&&Ct.length>0?t.jsx("div",{className:"entity-notes-strict-list",children:Ct.map((Z,Ee)=>{const _e=Z?.id??Z?.locationNoteId??Z?.location_note_id??`location-mention-${Ee}`,ge=String(_e),Pe=Z?.createdAt??Z?.created_at,oe=Pe?new Date(Pe):null,at=sy(oe),dt=Z?.location?.name??Z?.locationName??"Unnamed location",xt=Z?.location?.id??Z?.locationId??Z?.location_id??null,de=Z?.entity?.name??Z?.entityName??"Unnamed entity",it=Z?.entity?.id??Z?.entityId??Z?.entity_id??null;return t.jsxs("div",{className:"entity-notes-strict-note-item",children:[t.jsxs("div",{className:"entity-notes-strict-note-header",children:[t.jsxs("div",{className:"entity-notes-strict-note-title-row",children:[t.jsxs("span",{className:"entity-notes-strict-note-title",children:[Qt(Z),xt?t.jsxs(t.Fragment,{children:[" ","on"," ",t.jsx("span",{style:{fontWeight:500},children:dt})," ",t.jsx(fs,{locationId:xt,locationName:dt})]}):it?t.jsxs(t.Fragment,{children:[" ","on"," ",t.jsx("span",{style:{fontWeight:500},children:de})," ",t.jsx(Na,{entityId:it,entityName:de})]}):null]}),t.jsx("span",{className:"entity-notes-strict-note-visibility",children:At(Z)})]}),t.jsx("span",{className:"entity-notes-strict-note-timestamp",children:at||""})]}),t.jsx("p",{className:"entity-notes-strict-note-body",children:kt(Z)})]},`location-mention-${ge}`)})}):null]}):t.jsxs(t.Fragment,{children:[Me.error?t.jsxs("div",{className:"entity-notes-strict-alert error",children:[t.jsx(Jn,{size:16}),t.jsx("p",{children:Me.error})]}):null,Me.loading?t.jsxs("div",{className:"entity-notes-strict-loading",children:[t.jsx(mn,{className:"spin",size:20}),t.jsx("span",{children:"Loading session mentions"})]}):null,!Me.loading&&Me.loaded&&Ze.length===0?t.jsx("p",{className:"entity-notes-strict-empty",children:"This location hasn't been mentioned in session notes yet."}):null,!Me.loading&&Me.loaded&&Ze.length>0?t.jsx("div",{className:"entity-notes-strict-list",children:Ze.map((Z,Ee)=>{const _e=Z?.id??Z?.noteId??Z?.note_id??`session-mention-${Ee}`,ge=String(_e),Pe=Ae(ge),oe=qt(Z),at=Z?.sessionTitle??Z?.session_title??"Session note";Lt(Z),ry(Z);const dt=Z?.updatedAt??Z?.updated_at??Z?.createdAt??Z?.created_at,xt=dt?new Date(dt):null,de=sy(xt),it=oe||"This session note does not include any text.";return t.jsxs("div",{className:"entity-notes-strict-note-item",children:[t.jsxs("div",{className:"entity-notes-strict-note-header",children:[t.jsx("div",{className:"entity-notes-strict-note-title-row",children:t.jsx("span",{className:"entity-notes-strict-note-title",children:at})}),t.jsx("span",{className:"entity-notes-strict-note-timestamp",children:de||""})]}),Pe?t.jsx("p",{className:"entity-notes-strict-note-body",children:kt(Z)}):t.jsx("p",{className:"entity-notes-strict-note-body",children:it}),t.jsx("div",{className:"entity-notes-strict-note-actions",children:t.jsx("button",{type:"button",className:"entity-notes-strict-action-button",onClick:()=>ce(ge),children:Pe?"Hide note":"View note"})})]},`session-mention-${ge}`)})}):null]})]})]}),t.jsx(Bs,{isOpen:L&&jt,onClose:mt,title:"Create note",children:t.jsx("div",{className:"entity-notes-form",children:t.jsxs("form",{onSubmit:J,className:"entity-notes-form-body",children:[t.jsx("label",{className:"entity-notes-label",htmlFor:"location-note-content",children:"Note"}),t.jsx("div",{className:"entity-note-editor-field",children:t.jsx(Pl,{value:E,onChange:$e,markup:"@[__display__](__id__)",placeholder:AN,className:"entity-note-mentions",inputProps:{id:"location-note-content",className:"entity-note-textarea","aria-label":"Location note content",rows:5,required:!0,"data-autofocus":!0},children:t.jsx(ti,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(Z,Ee)=>`@${Ee}`,data:Ye,appendSpaceOnAdd:!0})})}),t.jsxs("fieldset",{className:"entity-notes-share",children:[t.jsx("legend",{children:"Share with"}),ve.map(Z=>t.jsxs("label",{className:"entity-notes-share-option",children:[t.jsx("input",{type:"radio",name:"location-note-share",value:Z.value,checked:A===Z.value,onChange:()=>T(Z.value),disabled:Ke}),t.jsx("span",{children:Z.label})]},Z.value))]}),We?t.jsxs("div",{className:"entity-notes-character",children:[t.jsx("label",{htmlFor:"location-note-character",children:"Character"}),t.jsxs("select",{id:"location-note-character",value:_,onChange:Z=>M(Z.target.value),disabled:D||se,required:!0,children:[t.jsx("option",{value:"",disabled:!0,children:D?"Loading characters":"Select character"}),k.map(Z=>t.jsx("option",{value:Z.id,children:Z.name},Z.id))]}),se?t.jsxs("p",{className:"entity-notes-hint",children:["Notes will be associated with your character ",k[0]?.name,"."]}):null,G?t.jsxs("div",{className:"entity-notes-alert error",children:[t.jsx(Jn,{size:16}),t.jsx("p",{children:G})]}):null,!D&&!G&&k.length===0?t.jsx("p",{className:"entity-notes-hint",children:"You need an active character in this campaign to attach notes."}):null]}):null,X?t.jsxs("div",{className:"entity-notes-alert error",children:[t.jsx(Jn,{size:16}),t.jsx("p",{children:X})]}):null,R?t.jsx("div",{className:"entity-notes-alert success",children:t.jsx("p",{children:R})}):null,t.jsx("div",{className:"entity-notes-actions",children:t.jsx("button",{type:"submit",className:"primary",disabled:Se,children:g?t.jsxs(t.Fragment,{children:[t.jsx(mn,{className:"spin",size:16})," Saving"]}):"Save note"})})]})})})]})}C_.propTypes={location:Mt.object,worldId:Mt.oneOfType([Mt.string,Mt.number]),selectedCampaign:Mt.object,selectedCampaignId:Mt.oneOfType([Mt.string,Mt.number]),isCampaignDm:Mt.bool,isCampaignPlayer:Mt.bool,canCreateNote:Mt.bool,notes:Mt.arrayOf(Mt.object),loading:Mt.bool,error:Mt.string,onCreateNote:Mt.func,creating:Mt.bool,campaignMatchesLocationWorld:Mt.bool,onNoteUpdate:Mt.func,onNoteDelete:Mt.func};const CB=e=>{const n=e?.options?.choices;return!Array.isArray(n)||n.length===0?[]:n.map((s,i)=>{if(s==null)return null;if(typeof s=="object"){const o=s.value??s.id??s.key??s.slug??`choice-${i}`,d=s.label??s.name??s.title??s.display??o;return o==null?null:{value:o,label:String(d??o)}}const l=String(s);return{value:l,label:l}}).filter(Boolean)},AB=e=>{if(!e?.name)return null;const n=`metadata.${e.name}`,s=e.visibleByDefault!==void 0?!!e.visibleByDefault:e.visible_by_default!==void 0?!!e.visible_by_default:!0,i={key:n,name:n,label:e.label||e.name,metadataField:e.name,dataType:e.dataType||e.data_type,visibleByDefault:s};switch(e.dataType||e.data_type){case"text":return{...i,type:"textarea",rows:3};case"boolean":return{...i,type:"boolean"};case"enum":return{...i,type:"select",options:CB(e)};case"number":return{...i,type:"text",inputType:"number"};case"date":return{...i,type:"text"};case"entity_reference":case"location_reference":case"reference":{const l=e.referenceTypeId??e.reference_type_id??e.referenceType?.id??null,o=e.referenceTypeName??e.reference_type_name??e.referenceType?.name??"",d=e.referenceFilter??e.reference_filter??e.referenceFilterJson??{},m=(()=>{if(e.displayValue)return String(e.displayValue);if(e.display)return String(e.display);if(e.selectedLabel)return String(e.selectedLabel);const p=e.value;if(!p||typeof p!="object")return"";const h=p.label??p.name??p.title??p.display??p.displayName??p.text??p.value;return h!=null?String(h):""})();return{...i,type:"reference",referenceTypeId:l,referenceTypeName:o,referenceFilter:d,displayKey:`metadataDisplay.${e.name}`,selectedLabel:m}}default:return{...i,type:"text"}}};function TB(){const{id:e}=Wa(),n=Mn(),{user:s,token:i,sessionReady:l}=un(),{activeWorldId:o,selectedCampaignId:d,selectedCampaign:m}=jn(),p=Wl(),[h,y]=u.useState(null),[g,x]=u.useState([]),[v,S]=u.useState([]),[N,E]=u.useState([]),[j,A]=u.useState([]),[T,_]=u.useState({}),[M,k]=u.useState(!0),[C,D]=u.useState(""),[z,G]=u.useState(""),[U,X]=u.useState("dossier"),[V,R]=u.useState(!1),[B,L]=u.useState(!1),[O,$]=u.useState({items:[],loading:!1,error:""}),[F,H]=u.useState(!1),I=u.useRef(null),[Y,P]=u.useState({isDirty:!1,isSubmitting:!1}),K=u.useMemo(()=>h?.permissions&&typeof h.permissions.canEdit=="boolean"?h.permissions.canEdit:!h||!s?!1:!!(s.role==="system_admin"||h.world?.created_by&&h.world.created_by===s.id||h.created_by&&h.created_by===s.id),[h,s]),{accessSettings:re,accessOptions:W,accessOptionsError:ue,accessOptionsLoading:Q,accessSaving:ye,accessSaveError:ae,accessSaveSuccess:ke,isAccessDirty:pe,handleAccessSettingChange:we,resetAccessSettings:ne,handleAccessSave:Le}=yB(h,i,K),be=u.useMemo(()=>h?.world?.id||h?.world_id||o||"",[h,o]),Oe=u.useCallback(async()=>{if(e){k(!0),D("");try{const Se=await Ri(e);y(Se?.data||Se)}catch(Se){console.error(" Failed to load location:",Se);const Be=Se.status===403||Se.status==="403"||Se.message==="Forbidden";D(Be&&!!d?"CAMPAIGN_CONTEXT_ACCESS_DENIED":Se.message||"Failed to load location"),y(null)}finally{k(!1)}}},[e,d]),Me=u.useCallback(async()=>{if(e)try{const Se=await yg(e);x(Se?.data||[])}catch(Se){console.error(" Failed to load entities:",Se)}},[e]),ut=u.useCallback(async()=>{if(e)try{const Se=await pg(e);S(Se?.data||[])}catch(Se){console.error(" Failed to load path:",Se)}},[e]),ht=u.useCallback(async()=>{if(o)try{const Se=await Pi({worldId:o});E(Se?.data||[])}catch(Se){console.error(" Failed to load location types:",Se)}},[o]),_t=u.useCallback(async()=>{if(!h?.location_type_id){A([]);return}try{const Se=await Tg(h.location_type_id),Be=Array.isArray(Se?.data)?Se.data:Array.isArray(Se)?Se:[];A(Be)}catch(Se){console.error(" Failed to load location type fields:",Se),A([])}},[h?.location_type_id]);u.useEffect(()=>{l&&i&&(Oe(),Me(),ut(),ht())},[l,i,Oe,Me,ut,ht]),u.useEffect(()=>{h?.location_type_id&&_t()},[h?.location_type_id,_t]),u.useEffect(()=>{if(!h?.metadata||!j||j.length===0){_({});return}let Se=!1;const Be=j.filter(se=>(se.data_type==="entity_reference"||se.data_type==="location_reference")&&h.metadata?.[se.name]);if(Be.length===0){_({});return}return(async()=>{const se={...T};for(const Z of Be){const Ee=Z.name,_e=h.metadata[Ee];let ge=null;if(typeof _e=="string"&&_e.trim())ge=_e.trim();else if(typeof _e=="object"&&_e!==null&&(ge=_e.id||_e.value||_e.entity_id||null,_e.displayValue||_e.name||_e.label)){se[Ee]=_e.displayValue||_e.name||_e.label;continue}if(!(!ge||se[Ee]))try{if(Z.data_type==="entity_reference"){const Pe=await Us(ge),oe=Pe?.data||Pe;oe?.name&&(se[Ee]=oe.name)}else if(Z.data_type==="location_reference"){const Pe=await Ri(ge),oe=Pe?.data||Pe;oe?.name&&(se[Ee]=oe.name)}}catch(Pe){console.warn(`Failed to resolve reference for field ${Ee}:`,Pe)}}Se||_(se)})(),()=>{Se=!0}},[h?.metadata,j]);const jt=async()=>{if(confirm("Are you sure you want to delete this location?"))try{await gg(e),n("/locations")}catch(Se){console.error(" Failed to delete location:",Se),alert(Se.message)}},ve=u.useCallback(()=>{V&&pe&&ne(),R(!V),G("")},[V,pe,ne]),tt=u.useCallback(async Se=>{if(!h?.id||!K)return!1;G(""),P(Be=>({...Be,isSubmitting:!0}));try{const Be={name:Se.name||h.name,description:Se.description||h.description,location_type_id:h.location_type_id,parent_id:Se.parent_id!==void 0?Se.parent_id||null:h.parent_id,metadata:Se.metadata||h.metadata||{}},We=await Rf(h.id,Be),se=We?.data||We;return se?(y(Z=>Z?{...Z,...se}:se),!0):!1}catch(Be){return console.error(" Failed to update location:",Be),G(Be.message||"Failed to update location"),!1}finally{P(Be=>({...Be,isSubmitting:!1}))}},[h,K]),st=u.useCallback(Se=>{P(Se)},[]),$e=u.useCallback(async()=>{if(!K||!h?.id)return!1;let Se=!0;if(Y.isDirty&&I.current&&(await I.current.submit()||(Se=!1)),Se&&pe)if(!await Le())Se=!1;else try{const We=await Ri(h.id);y(We?.data||We)}catch{}return Se&&R(!1),Se},[K,h?.id,Y.isDirty,pe,Le]),Ye=u.useCallback(Se=>{X(Se)},[]),mt=u.useMemo(()=>{if(!m||!h)return!1;const Se=m.world?.id||m.world_id,Be=h.world?.id||h.world_id;return!Se||!Be?!1:String(Se)===String(Be)},[m,h]),J=u.useMemo(()=>!m||!s?.id?null:(Array.isArray(m.members)?m.members:[]).find(We=>{if(!We)return!1;const se=We.user_id??We.userId??We.user?.id??We.id??null;return se?String(se)===String(s.id):!1})||null,[m,s?.id])?.role??null,le=u.useMemo(()=>s?.role==="system_admin"?!0:J==="dm",[J,s?.role]),fe=u.useMemo(()=>J==="player",[J]),Ue=u.useMemo(()=>!!(le||fe),[le,fe]),qe=u.useCallback(async()=>{const Se=await Xj(e,{campaignId:d});return Array.isArray(Se?.data)?Se.data:Array.isArray(Se)?Se:[]},[e,d]);u.useEffect(()=>{let Se=!1;return!e||!d||!mt?($({items:[],loading:!1,error:""}),()=>{Se=!0}):($(We=>({...We,loading:!0,error:""})),(async()=>{try{const We=await qe();Se||$({items:We,loading:!1,error:""})}catch(We){if(!Se){const Ee=(We.status===403||We.status==="403"||We.message==="Forbidden")&&!!d?"CAMPAIGN_CONTEXT_ACCESS_DENIED":We.message||"Failed to load notes";$(_e=>({..._e,loading:!1,error:Ee}))}}})(),()=>{Se=!0})},[e,d,mt,qe]);const ze=u.useCallback(async Se=>{if(!e)return{success:!1,message:"Location not found"};if(!d)return{success:!1,message:"Select a campaign first"};H(!0);try{const Be={...Se,campaignId:Se?.campaignId??d},We=await Qj(e,Be),se=We?.data||We;if(!se)throw new Error("Note could not be created");const Z=se?.createdAt??se?.created_at??new Date().toISOString(),Ee=se?.createdAt&&se?.created_at?se:{...se,...se?.createdAt?{}:{createdAt:Z},...se?.created_at?{}:{created_at:Z}};return $(_e=>{const ge=Array.isArray(_e.items)?_e.items:[];return{..._e,items:[Ee,...ge]}}),{success:!0,note:Ee}}catch(Be){return console.error("Failed to create location note",Be),{success:!1,message:Be.message||"Failed to create note"}}finally{H(!1)}},[e,d]),Ce=u.useCallback(async Se=>{Se?.id&&$(Be=>{const We=Array.isArray(Be.items)?Be.items:[],se=We.findIndex(Ee=>Ee?.id&&String(Ee.id)===String(Se.id));if(se<0)return Be;const Z=[...We];return Z[se]=Se,{...Be,items:Z}})},[]),pt=u.useCallback(async Se=>{Se&&$(Be=>{const se=(Array.isArray(Be.items)?Be.items:[]).filter(Z=>!Z?.id||String(Z.id)!==String(Se));return{...Be,items:se}})},[]),bt=u.useMemo(()=>{const Se=[{id:"dossier",label:"Dossier"}];return Se.push({id:"notes",label:"Notes"}),Se.push({id:"entities",label:"Entities"}),Se.push({id:"locations",label:"Locations"}),K&&V&&Se.push({id:"access",label:"Access"}),Se.push({id:"system",label:"System"}),Se},[K,V]);u.useEffect(()=>{new Set(bt.map(Be=>Be.id)).has(U)||X("dossier")},[bt,U]);const Ct=h?.createdAt||h?.created_at,Ze=h?.updatedAt||h?.updated_at,ot=u.useMemo(()=>!Array.isArray(j)||j.length===0?[]:j.map(Be=>{const We=h?.metadata?.[Be.name],se=T[Be.name];let Z=We,Ee=se,_e=se;return(Be.data_type==="entity_reference"||Be.data_type==="location_reference")&&We&&(typeof We=="object"&&We!==null?(Z=se?{...We,displayValue:se}:We,Ee=We.displayValue||We.name||We.label||se||null,_e=Ee||se):typeof We=="string"&&se&&(Z={id:We,displayValue:se},Ee=se,_e=se)),{...Be,value:Z,displayValue:Ee,selectedLabel:_e,dataType:Be.data_type||Be.dataType,visibleByDefault:Be.visible_by_default!==void 0?Be.visible_by_default:Be.visibleByDefault!==void 0?Be.visibleByDefault:!0}}).map(Be=>AB(Be)).filter(Boolean),[j,h?.metadata,T]),Tt=u.useMemo(()=>{if(!j||j.length===0)return{__placeholder:"No custom fields defined for this location type."};const Se=j.map(Be=>({...Be,value:h?.metadata?.[Be.name]}));return Eg(Se)},[j,h?.metadata]),$t=u.useMemo(()=>{if(!j||j.length===0)return{};const Se=j.map(We=>{const se=h?.metadata?.[We.name],Z=T[We.name];return(We.data_type==="entity_reference"||We.data_type==="location_reference")&&se?Z?{...We,value:typeof se=="object"&&se!==null?{...se,displayValue:Z}:{id:se,displayValue:Z}}:typeof se=="object"&&se!==null?{...We,value:se}:{...We,value:{id:se}}:{...We,value:se}}),Be=n1(Se);return Object.keys(T).forEach(We=>{T[We]&&(Be[We]=T[We])}),Be},[j,h?.metadata,T]),Qt=u.useMemo(()=>{if(!j||j.length===0)return{};const Se=j.map(Be=>({...Be,value:h?.metadata?.[Be.name]}));return t1(Se)},[j,h?.metadata]),At="Information",kt=u.useMemo(()=>{if(!h)return null;const Se=h.parent?.id||h.parent_id||null,Be=h.parent?.name||null;return{name:h.name||"",description:h.description||"",typeName:h.locationType?.name||"",parent_id:Se,parentName:Be||"",worldName:h.world?.name||"",worldId:be,createdAt:os(Ct),updatedAt:os(Ze),metadata:Tt,metadataDisplay:$t,createdBy:h.creator?.username||h.creator?.email||h.created_by||"",updatedBy:h.updated_by||""}},[h,be,Ct,Ze,Tt,$t]),qt=u.useMemo(()=>{if(!h)return null;const Se=h.parent?.id||h.parent_id||null;return{name:h.name||"",description:h.description||"",typeName:h.locationType?.name||"",parent_id:Se||null,worldName:h.world?.name||"",worldId:be,createdAt:os(Ct),updatedAt:os(Ze),metadata:Qt}},[h,be,Ct,Ze,Qt]),Lt=u.useMemo(()=>{const Se=ot.length>0?ot:[{key:"metadata.__placeholder",name:"metadata.__placeholder",label:"Information",type:"readonly"}];let Be=[];if(h?.location_type_id&&N&&N.length>0){const We=String(h.location_type_id);Be=w_(We,N)}return{title:"Edit Location",sections:[{title:"Edit Location",columns:2,fields:[{key:"name",label:"Name",type:"text"},{key:"typeName",label:"Type",type:"readonly"},{key:"parent_id",label:"Parent Location",type:"location_reference",dataType:"location_reference",allowedTypeIds:Be},{key:"description",label:"Description",type:"textarea",rows:4,span:2}]},{title:At,columns:ot.length>0?2:1,fields:Se}]}},[ot,At,h?.location_type_id,N]),ce=u.useMemo(()=>{const Se=ot.length>0?ot:[{key:"metadata.__placeholder",name:"metadata.__placeholder",label:"Information",type:"readonly"}];return{title:"Location Overview",sections:[{title:"Summary",columns:2,fields:[{key:"name",label:"Name",type:"readonly"},{key:"typeName",label:"Type",type:"readonly"},{key:"parent_id",label:"Parent Location",type:"location_reference",dataType:"location_reference"}]},{title:"Description",columns:1,fields:[{key:"description",label:"Description",type:"textarea",rows:4}]},{title:At,columns:ot.length>0?2:1,fields:Se}]}},[ot,At]),Ae=u.useMemo(()=>({sections:[{title:"System",columns:2,fields:[{key:"worldName",label:"World",type:"readonly"},{key:"createdAt",label:"Created",type:"readonly"},{key:"updatedAt",label:"Updated",type:"readonly"},{key:"createdBy",label:"Created By",type:"readonly"}]}]}),[]),Te=u.useCallback((Se,Be,We)=>Se?(Array.isArray(Se.sections)?Se.sections:[]).map((Z,Ee)=>{const _e=`${We||"section"}-${Z.title||Ee}`,ge=Number.isFinite(Z.columns)?Math.max(1,Number(Z.columns)):1,Pe=Array.isArray(Z.fields)?Z.fields:[];return t.jsxs("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:[Z.title?t.jsx("h2",{className:"entity-card-title",children:Z.title}):null,t.jsx("div",{className:`entity-field-grid ${ge>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":""}`,style:{"--entity-field-columns":ge},children:Pe.length>0?Pe.map((oe,at)=>{const dt=oe?.key||oe?.name||oe?.field||`${_e}-field-${at}`;return t.jsx(Vc,{field:{...oe},data:Be,mode:V?"edit":"view"},dt)}):t.jsx("p",{className:"entity-empty-state",children:"No fields available."})})]},_e)}):null,[V]);if(M)return t.jsx("div",{className:"page-container",children:t.jsx("p",{children:"Loading location..."})});if(C==="CAMPAIGN_CONTEXT_ACCESS_DENIED")return t.jsxs("div",{className:"alert error",style:{padding:"1.5rem",maxWidth:"600px",margin:"2rem auto"},children:[t.jsx("h2",{style:{marginTop:0,marginBottom:"1rem"},children:"Access Restricted by Campaign Context"}),t.jsx("p",{style:{marginBottom:"1rem"},children:"You don't have access to this location with your current campaign context selected. This location may belong to a different campaign or world, or your current campaign context doesn't have permission to view it."}),t.jsx("p",{style:{marginBottom:"1.5rem"},children:"To view this location, please change your campaign context using the selector in the header to a campaign that has access to this location."}),t.jsx("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap"},children:t.jsx("button",{type:"button",onClick:()=>n("/locations"),style:{padding:"0.5rem 1rem",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Go to Locations"})})]});if(C||!h)return t.jsxs("div",{className:"page-container",children:[t.jsx("div",{className:"alert error",children:C||"Location not found"}),t.jsx(Yt,{to:"/locations",className:"btn btn-secondary",children:" Back to Locations"})]});const Ke=`entity-detail-page${p?" entity-detail-page--mobile":""}${p&&B?" entity-detail-page--header-expanded":""}`;return t.jsx(Og,{maxWidth:1280,className:Ke,children:t.jsxs("div",{className:"w-full max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 overflow-x-hidden",children:[t.jsx("header",{className:`entity-page-header ${p&&!B?"entity-page-header--collapsed":""}`,children:t.jsxs("div",{className:"entity-page-header__inner",children:[p&&t.jsx("button",{type:"button",className:"entity-page-header__drag-handle",onClick:()=>L(!B),"aria-label":B?"Collapse header":"Expand header","aria-expanded":B,children:t.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:B?"rotated":"",children:t.jsx("polyline",{points:"6 9 12 15 18 9"})})}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[t.jsx(Yt,{to:"/locations",className:"btn btn-secondary",children:""}),K&&t.jsx("button",{className:"btn btn-danger",onClick:jt,title:"Delete location",children:t.jsx(zn,{size:16})})]}),t.jsx(fB,{locationId:e,name:h.name,canEdit:K,isEditing:V,onToggleEdit:ve,onSave:$e,isSaving:Y.isSubmitting||ye,isSaveDisabled:!Y.isDirty&&!pe,isMobile:p}),t.jsxs("div",{className:`entity-page-header__tabs flex flex-wrap items-center justify-between gap-4 mt-4 ${p&&!B?"entity-page-header__tabs--collapsed":""}`,children:[t.jsx(y1,{tabs:bt,activeTab:U,onChange:Ye}),e&&t.jsx(hB,{locationId:e,importance:h.importance,onUpdate:Se=>{y(Be=>Be?{...Be,importance:Se}:null)}})]})]})}),v.length>0&&t.jsxs("div",{style:{marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[t.jsx(Yt,{to:"/locations",className:"btn btn-sm btn-secondary",children:"Root"}),v.map((Se,Be)=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx(Jr,{size:16}),Be===v.length-1?t.jsx("span",{style:{fontWeight:"bold"},children:Se.name}):t.jsx(Yt,{to:`/locations/${Se.id}`,className:"btn btn-sm btn-link",children:Se.name})]},Se.id))]}),t.jsx("div",{className:"entity-detail-shell",children:t.jsxs("div",{className:"entity-detail-body",children:[t.jsx("div",{className:"entity-tab-panel",role:"tabpanel",hidden:U!=="dossier",children:t.jsxs("div",{className:"entity-tab-content",children:[z&&t.jsx("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:t.jsx("div",{className:"alert error",role:"alert",children:z})}),V&&K?t.jsx("section",{className:"entity-card entity-card--form entity-edit-form-wrapper bg-white rounded-lg border p-4 sm:p-6 w-full",children:t.jsx("div",{className:"entity-edit-form-container",children:t.jsx("div",{className:"entity-edit-form-content",children:t.jsx(us,{ref:I,schema:Lt,initialData:qt||{},onSubmit:tt,onStateChange:st,hideActions:!0,enableUnsavedPrompt:!1})})})}):Te(ce,kt,"dossier")]})}),U==="notes"&&t.jsx(C_,{location:h,worldId:be,selectedCampaign:m,selectedCampaignId:d,isCampaignDm:le,isCampaignPlayer:fe,canCreateNote:Ue,notes:O.items,loading:O.loading,error:O.error,onCreateNote:ze,onNoteUpdate:Ce,onNoteDelete:pt,creating:F,campaignMatchesLocationWorld:mt}),U==="entities"&&t.jsx(xB,{entities:g,loading:M,error:C,locationId:e,worldId:be,onEntitiesChange:Me}),U==="locations"&&t.jsx(NB,{location:h,worldId:be,path:v,onLocationsChange:()=>{ut(),Oe()}}),U==="access"&&V&&K&&t.jsx(gB,{canEdit:K,worldId:be,accessSettings:re,accessOptions:W,accessOptionsError:ue,accessOptionsLoading:Q,accessSaving:ye,accessSaveError:ae,accessSaveSuccess:ke,handleAccessSettingChange:we}),U==="system"&&t.jsx(bB,{renderSchemaSections:Te,systemSchema:Ae,viewData:kt})]})})]})})}function MB({initialData:e={},onSubmit:n,onCancel:s,submitting:i=!1,errorMessage:l,worlds:o=[],locationTypes:d=[]}){const[m,p]=u.useState({name:"",description:"",worldId:"",parent_type_id:"",sort_order:0,focus:!1}),[h,y]=u.useState("");u.useEffect(()=>{const j=e?.world_id||e?.worldId||e?.world?.id||"";p({name:e?.name||"",description:e?.description||"",worldId:j?String(j):"",parent_type_id:e?.parent_type_id||e?.parentType?.id||"",sort_order:e?.sort_order||0,focus:e?.focus||!1}),y("")},[e]);const g=u.useMemo(()=>m.name!==(e?.name||"")||m.description!==(e?.description||"")||m.worldId!==(e?.world_id||e?.worldId||e?.world?.id||"")||m.parent_type_id!==(e?.parent_type_id||e?.parentType?.id||"")||m.sort_order!==(e?.sort_order||0)||m.focus!==(e?.focus||!1),[e,m.description,m.name,m.worldId,m.parent_type_id,m.sort_order,m.focus]);u.useEffect(()=>{y(l||"")},[l]);const x=j=>A=>{const{value:T}=A.target;p(_=>({..._,[j]:T}))},v=j=>A=>{const{value:T}=A.target,_=T===""?0:parseInt(T,10);Number.isNaN(_)||p(M=>({...M,[j]:_}))},S=j=>A=>{const{checked:T}=A.target;p(_=>({..._,[j]:T}))},N=u.useMemo(()=>{if(!e?.id)return d;const j=new Set([e.id]);return d.filter(A=>!j.has(A.id))},[d,e?.id]),E=async j=>{j.preventDefault();const A=m.name.trim();if(!A){y("Name is required.");return}const T=m.worldId.trim();if(!T){y("Select a world for this location type.");return}y("");const _={name:A,description:m.description?.trim()||"",world_id:T,parent_type_id:m.parent_type_id||null,sort_order:m.sort_order||0,focus:m.focus||!1};try{if(await n?.(_)===!1)return}catch(M){y(M.message||"Failed to save location type")}};return t.jsxs("form",{className:"entity-type-form",onSubmit:E,children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"location-type-name",children:"Name *"}),t.jsx("input",{id:"location-type-name",type:"text",value:m.name,onChange:x("name"),placeholder:"e.g. City, Region, Building",disabled:i,autoFocus:!0})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"location-type-world",children:"World *"}),t.jsxs("select",{id:"location-type-world",value:m.worldId,onChange:x("worldId"),disabled:i,required:!0,children:[t.jsx("option",{value:"",children:"Select world..."}),o.map(j=>t.jsx("option",{value:j.id,children:j.name},j.id))]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"location-type-parent",children:"Parent Type"}),t.jsxs("select",{id:"location-type-parent",value:m.parent_type_id,onChange:x("parent_type_id"),disabled:i,children:[t.jsx("option",{value:"",children:"None (top-level)"}),N.map(j=>t.jsx("option",{value:j.id,children:j.name},j.id))]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"location-type-sort-order",children:"Sort Order"}),t.jsx("input",{id:"location-type-sort-order",type:"number",value:m.sort_order,onChange:v("sort_order"),placeholder:"0",disabled:i,min:"0"})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"location-type-description",children:"Description"}),t.jsx("textarea",{id:"location-type-description",value:m.description,onChange:x("description"),placeholder:"Optional description for this location type",rows:5,disabled:i,className:"textarea-field"})]}),t.jsxs("div",{className:"form-group",children:[t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:m.focus,onChange:S("focus"),disabled:i}),t.jsx("span",{children:"Focus (show in sidebar navigation)"})]}),t.jsx("p",{className:"help-text",children:"When enabled, this location type will appear as a menu item in the Locations section of the sidebar with a count of locations."})]}),h&&t.jsx("div",{className:"form-error",role:"alert",children:h}),t.jsxs("div",{className:"form-actions",children:[t.jsx("button",{type:"button",className:"btn cancel",onClick:s,disabled:i,children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn submit",disabled:i||!g,children:i?"Saving...":"Save"})]})]})}const kB=new Set(["system_admin"]);function RB(){const e=Mn(),{user:n,token:s,sessionReady:i}=un(),{selectedCampaign:l,activeWorld:o,activeWorldId:d,contextKey:m}=jn(),[p,h]=u.useState([]),[y,g]=u.useState(!1),[x,v]=u.useState(""),[S,N]=u.useState(!1),[E,j]=u.useState(null),[A,T]=u.useState(!1),[_,M]=u.useState(""),[k,C]=u.useState(""),[D,z]=u.useState(null),[G,U]=u.useState("name"),[X,V]=u.useState("asc"),R=d||l?.world?.id||"",B=u.useRef(`${R}:${m}`),L=!!R,O=u.useMemo(()=>R?[{id:R,name:o?.name||l?.world?.name||"Untitled world"}]:[],[R,o?.name,l?.world?.name]),$=u.useMemo(()=>{const ne=l?.world||o;return ne&&(ne.created_by||ne.creator?.id||ne.owner_id||ne.owner?.id)||""},[l,o]),F=!!(n?.id&&$===n.id),H=u.useMemo(()=>n?n.role&&kB.has(n.role)?!0:F:!1,[n,F]),I=u.useMemo(()=>{if(l){const ne=l.name||"Selected campaign",Le=l.world?.name||o?.name;return Le?`${ne}  ${Le}`:ne}return o?o.name||"Selected world":""},[l,o]),Y=u.useCallback((ne,Le="info")=>{z({message:ne,tone:Le})},[]);u.useEffect(()=>{if(!D)return;const ne=setTimeout(()=>z(null),3500);return()=>clearTimeout(ne)},[D]);const P=u.useCallback(async()=>{if(!s||!R)return g(!1),h([]),[];g(!0),v("");try{const ne=await Pi({worldId:R}),Le=Array.isArray(ne)?ne:Array.isArray(ne?.data)?ne.data:[];return h(Le),Le}catch(ne){return console.error(" Failed to load location types",ne),v(ne.message||"Failed to load location types"),h([]),[]}finally{g(!1)}},[s,R]);u.useEffect(()=>{if(!(!i||!s)){if(!R){h([]),v(""),g(!1);return}P()}},[i,s,R,P,m]),u.useEffect(()=>{const ne=`${R}:${m}`;B.current!==ne&&(N(!1),j(null),C(""),z(null),h([]),v(""),T(!1),M(""),B.current=ne)},[R,m]);const K=()=>{!H||!L||(j(null),C(""),N(!0))},re=ne=>{H&&(j(ne),C(""),N(!0))},W=ne=>{ne?.id&&e(`/location-types/${ne.id}/fields`)},ue=()=>{N(!1),j(null),C("")},Q=async ne=>{if(E?.id)try{T(!0),C(""),await bI(E.id,ne),Y("Location type updated","success"),ue(),await P()}catch(Le){console.error(" Failed to save location type",Le);const be=Le.message||"Failed to save location type";return C(be),Y(be,"error"),!1}finally{T(!1)}else try{T(!0),C(""),await gI(ne),Y("Location type created","success"),ue(),await P()}catch(Le){console.error(" Failed to create location type",Le);const be=Le.message||"Failed to create location type";return C(be),Y(be,"error"),!1}finally{T(!1)}return!0},ye=async ne=>{if(!(!H||!ne?.id||!window.confirm(`Delete location type "${ne.name}"? This action cannot be undone.`)))try{M(ne.id),await xI(ne.id),Y("Location type deleted","success"),E?.id===ne.id&&ue(),await P()}catch(be){console.error(" Failed to delete location type",be),Y(be.message||"Failed to delete location type","error")}finally{M("")}},ae=ne=>{if(!ne)return"";const Le=new Date(ne);return Number.isNaN(Le.getTime())?"":Le.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},ke=ne=>{G===ne?V(X==="asc"?"desc":"asc"):(U(ne),V("asc"))},pe=u.useMemo(()=>G?[...p].sort((ne,Le)=>{let be,Oe;switch(G){case"name":be=(ne.name||"").toLowerCase(),Oe=(Le.name||"").toLowerCase();break;case"description":be=(ne.description||"").toLowerCase(),Oe=(Le.description||"").toLowerCase();break;case"parentType":be=(ne.parentType?.name||"").toLowerCase(),Oe=(Le.parentType?.name||"").toLowerCase();break;case"childTypeCount":be=ne.childTypeCount||0,Oe=Le.childTypeCount||0;break;case"world":be=(ne?.world?.name||ne?.world_name||ne?.worldName||"").toLowerCase(),Oe=(Le?.world?.name||Le?.world_name||Le?.worldName||"").toLowerCase();break;case"created":be=new Date(ne.createdAt||ne.created_at||0).getTime(),Oe=new Date(Le.createdAt||Le.created_at||0).getTime();break;default:return 0}return be<Oe?X==="asc"?-1:1:be>Oe?X==="asc"?1:-1:0}):p,[p,G,X]),we=p.length;return i?s?t.jsxs("section",{className:"entity-types-page",children:[t.jsxs("div",{className:"entity-types-header",children:[t.jsxs("div",{children:[t.jsx("h1",{children:"Location Types"}),l?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"entity-types-subtitle",children:I}),t.jsxs("p",{className:"entity-types-subtitle",children:[we," types defined"]})]}):t.jsx("p",{className:"entity-types-subtitle",children:"Select a campaign or world you own to choose a world context."})]}),t.jsxs("button",{type:"button",className:"btn submit",onClick:K,disabled:!H||A||_||!L,children:[t.jsx(sa,{size:18})," Add Location Type"]})]}),!H&&t.jsx("div",{className:"alert info",role:"status",children:"You can view the existing location types, but only system administrators or the world owner can make changes."}),D&&t.jsx("div",{className:`toast-banner ${D.tone}`,role:"status",children:D.message}),x&&t.jsx("div",{className:"alert error",role:"alert",children:x}),t.jsx("div",{className:"entity-types-table-wrapper",children:L?y?t.jsx("div",{className:"empty-state",children:"Loading location types..."}):p.length===0?t.jsx("div",{className:"empty-state",children:"No location types defined yet."}):t.jsxs("table",{className:"entity-types-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"sortable-header",onClick:()=>ke("name"),role:"button",tabIndex:0,onKeyDown:ne=>{(ne.key==="Enter"||ne.key===" ")&&(ne.preventDefault(),ke("name"))},children:t.jsxs("span",{className:"header-label",children:["Name",G==="name"&&t.jsx("span",{className:"sort-indicator",children:X==="asc"?"":""})]})}),t.jsx("th",{className:"sortable-header",onClick:()=>ke("description"),role:"button",tabIndex:0,onKeyDown:ne=>{(ne.key==="Enter"||ne.key===" ")&&(ne.preventDefault(),ke("description"))},children:t.jsxs("span",{className:"header-label",children:["Description",G==="description"&&t.jsx("span",{className:"sort-indicator",children:X==="asc"?"":""})]})}),t.jsx("th",{className:"sortable-header",onClick:()=>ke("parentType"),role:"button",tabIndex:0,onKeyDown:ne=>{(ne.key==="Enter"||ne.key===" ")&&(ne.preventDefault(),ke("parentType"))},children:t.jsxs("span",{className:"header-label",children:["Parent Type",G==="parentType"&&t.jsx("span",{className:"sort-indicator",children:X==="asc"?"":""})]})}),t.jsx("th",{className:"sortable-header",onClick:()=>ke("childTypeCount"),role:"button",tabIndex:0,onKeyDown:ne=>{(ne.key==="Enter"||ne.key===" ")&&(ne.preventDefault(),ke("childTypeCount"))},children:t.jsxs("span",{className:"header-label",children:["Child Types",G==="childTypeCount"&&t.jsx("span",{className:"sort-indicator",children:X==="asc"?"":""})]})}),t.jsx("th",{className:"sortable-header",onClick:()=>ke("world"),role:"button",tabIndex:0,onKeyDown:ne=>{(ne.key==="Enter"||ne.key===" ")&&(ne.preventDefault(),ke("world"))},children:t.jsxs("span",{className:"header-label",children:["World",G==="world"&&t.jsx("span",{className:"sort-indicator",children:X==="asc"?"":""})]})}),t.jsx("th",{className:"sortable-header",onClick:()=>ke("created"),role:"button",tabIndex:0,onKeyDown:ne=>{(ne.key==="Enter"||ne.key===" ")&&(ne.preventDefault(),ke("created"))},children:t.jsxs("span",{className:"header-label",children:["Created",G==="created"&&t.jsx("span",{className:"sort-indicator",children:X==="asc"?"":""})]})}),t.jsx("th",{className:"actions-column",children:"Actions"})]})}),t.jsx("tbody",{children:pe.map(ne=>{const Le=ne.createdAt||ne.created_at,be=ne?.world?.name||ne?.world_name||ne?.worldName||"";return t.jsxs("tr",{children:[t.jsx("td",{children:ne.name}),t.jsx("td",{className:"description-cell",children:ne.description?ne.description:""}),t.jsx("td",{children:ne.parentType?.name||""}),t.jsx("td",{children:ne.childTypeCount||0}),t.jsx("td",{children:be}),t.jsx("td",{children:ae(Le)}),t.jsx("td",{className:"actions-column",children:t.jsxs("div",{className:"entity-type-actions",children:[t.jsx("button",{type:"button",className:"icon-btn",title:"Manage fields",onClick:()=>W(ne),children:t.jsx(Xd,{size:16})}),H&&t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:"icon-btn",title:"Edit location type",onClick:()=>re(ne),disabled:A||_===ne.id,children:t.jsx(Ga,{size:16})}),t.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete location type",onClick:()=>ye(ne),disabled:_===ne.id||A,children:t.jsx(zn,{size:16})})]})]})})]},ne.id)})})]}):t.jsx("div",{className:"empty-state",children:"Select a campaign or world you own to view location types."})}),t.jsx("div",{className:"entity-type-cards",children:L?y?t.jsx("div",{className:"card-placeholder",children:"Loading location types..."}):p.length===0?t.jsx("div",{className:"card-placeholder",children:"No location types defined yet."}):pe.map(ne=>{const Le=ne.createdAt||ne.created_at;return t.jsxs("div",{className:"entity-type-card",children:[t.jsxs("div",{className:"card-header",children:[t.jsx("h3",{children:ne.name}),t.jsxs("div",{className:"entity-type-actions",children:[t.jsx("button",{type:"button",className:"icon-btn",title:"Manage fields",onClick:()=>W(ne),children:t.jsx(Xd,{size:16})}),H&&t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:"icon-btn",title:"Edit location type",onClick:()=>re(ne),disabled:A||_===ne.id,children:t.jsx(Ga,{size:16})}),t.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete location type",onClick:()=>ye(ne),disabled:_===ne.id||A,children:t.jsx(zn,{size:16})})]})]})]}),t.jsx("p",{className:"card-description",children:ne.description?ne.description:"No description"}),t.jsxs("p",{className:"card-meta",children:["Parent: ",ne.parentType?.name||"None"]}),t.jsxs("p",{className:"card-meta",children:["Child Types: ",ne.childTypeCount||0]}),t.jsxs("p",{className:"card-meta",children:["World: ",ne?.world?.name||ne?.world_name||""]}),t.jsxs("p",{className:"card-meta",children:["Created ",ae(Le)]})]},`card-${ne.id}`)}):t.jsx("div",{className:"card-placeholder",children:"Select a campaign or world you own to view location types."})}),S&&t.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:t.jsxs("div",{className:"side-panel",children:[t.jsxs("div",{className:"side-panel-header",children:[t.jsx("h2",{children:E?"Edit Location Type":"Add Location Type"}),t.jsx("button",{type:"button",className:"icon-btn",onClick:ue,title:"Close form",disabled:A,children:t.jsx(ea,{size:18})})]}),t.jsx("div",{className:"side-panel-content",children:t.jsx(MB,{initialData:E,onSubmit:Q,onCancel:ue,submitting:A,errorMessage:k,worlds:O,locationTypes:p})})]})})]}):t.jsx("p",{children:"Authenticating..."}):t.jsx("p",{children:"Restoring session..."})}const IB=[{value:"text",label:"Text"},{value:"number",label:"Number"},{value:"boolean",label:"Boolean"},{value:"date",label:"Date"},{value:"enum",label:"Enum"},{value:"entity_reference",label:"Entity Reference"},{value:"location_reference",label:"Location Reference"}];function DB({initialData:e={},entityReferenceTypes:n=[],locationReferenceTypes:s=[],onSubmit:i,onCancel:l,submitting:o=!1,errorMessage:d}){const[m,p]=u.useState({name:"",label:"",data_type:"text",required:!1,visibleByDefault:!0,enumChoices:"",reference_type_id:"",reference_filter:""}),[h,y]=u.useState("");u.useEffect(()=>{if(!e){p({name:"",label:"",data_type:"text",required:!1,visibleByDefault:!0,enumChoices:"",reference_type_id:"",reference_filter:""}),y("");return}const T=Array.isArray(e.options?.choices)?e.options.choices.join(", "):typeof e.options=="string"?e.options:"",_=e.reference_filter?typeof e.reference_filter=="string"?e.reference_filter:JSON.stringify(e.reference_filter,null,2):"";let M=e.data_type||"text";M==="reference"&&(M="location_reference"),p({name:e.name||"",label:e.label||"",data_type:M,required:!!e.required,visibleByDefault:e.visibleByDefault!==void 0?!!e.visibleByDefault:e.visible_by_default!==void 0?!!e.visible_by_default:!0,enumChoices:T,reference_type_id:e.reference_type_id||"",reference_filter:_}),y("")},[e]),u.useEffect(()=>{y(d||"")},[d]);const g=m.data_type==="enum",x=m.data_type==="entity_reference",v=m.data_type==="location_reference",S=x||v,N=u.useMemo(()=>n.map(T=>({value:T.id,label:T.name})),[n]),E=u.useMemo(()=>s.map(T=>({value:T.id,label:T.name})),[s]),j=T=>_=>{const{value:M,type:k,checked:C}=_.target;p(D=>({...D,[T]:k==="checkbox"?C:M}))},A=async T=>{T.preventDefault();const _=m.name.trim(),M=m.label.trim();if(!_){y("Field name is required.");return}if(!M){y("Field label is required.");return}if(!m.data_type){y("Data type is required.");return}let k={};if(S){if(!m.reference_type_id){y("Reference type is required for reference fields.");return}const D=m.reference_filter.trim();if(D)try{if(k=JSON.parse(D),typeof k!="object"||Array.isArray(k))throw new Error("Reference filter must be a JSON object.")}catch(z){y(z.message||"Reference filter must be valid JSON.");return}}const C={name:_,label:M,data_type:m.data_type,required:!!m.required,visible_by_default:!!m.visibleByDefault};if(g){const D=m.enumChoices.split(",").map(z=>z.trim()).filter(Boolean);if(!D.length){y("Enum options are required for enum fields.");return}C.options={choices:D}}else C.options={};S?(C.reference_type_id=m.reference_type_id,C.reference_filter=k):(C.reference_type_id=null,C.reference_filter={});try{if(await i?.(C)===!1)return;y("")}catch(D){y(D.message||"Failed to save field")}};return t.jsxs("form",{className:"entity-type-field-form",onSubmit:A,children:[t.jsxs("div",{className:"form-grid",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"location-field-name",children:"Field Name *"}),t.jsx("input",{id:"location-field-name",type:"text",value:m.name,onChange:j("name"),placeholder:"e.g. population",disabled:o})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"location-field-label",children:"Label *"}),t.jsx("input",{id:"location-field-label",type:"text",value:m.label,onChange:j("label"),placeholder:"e.g. Population",disabled:o})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"location-field-data-type",children:"Data Type *"}),t.jsx("select",{id:"location-field-data-type",value:m.data_type,onChange:j("data_type"),disabled:o,children:IB.map(T=>t.jsx("option",{value:T.value,children:T.label},T.value))}),t.jsx("p",{className:"field-hint",children:"Determines how the value is stored and rendered in location forms."})]}),t.jsxs("div",{className:"form-group checkbox-group",children:[t.jsxs("div",{className:"checkbox-control",children:[t.jsx("input",{id:"location-field-required",type:"checkbox",checked:m.required,onChange:j("required"),disabled:o}),t.jsx("label",{htmlFor:"location-field-required",children:"Required"})]}),t.jsx("span",{className:"field-hint",children:"Mark as required on location forms."})]}),t.jsxs("div",{className:"form-group checkbox-group",children:[t.jsxs("div",{className:"checkbox-control",children:[t.jsx("input",{id:"location-field-visible-default",type:"checkbox",checked:m.visibleByDefault,onChange:j("visibleByDefault"),disabled:o}),t.jsx("label",{htmlFor:"location-field-visible-default",children:"Visible by default"})]}),t.jsx("span",{className:"field-hint",children:"Uncheck to hide this field unless a rule explicitly shows it."})]}),g&&t.jsxs("div",{className:"form-group form-group-full",children:[t.jsx("label",{htmlFor:"location-field-options",children:"Enum Options *"}),t.jsx("textarea",{id:"location-field-options",value:m.enumChoices,onChange:j("enumChoices"),placeholder:"Comma separated values, e.g. Small, Medium, Large",rows:3,disabled:o}),t.jsx("p",{className:"field-hint",children:"Comma-separated list of allowed values."})]}),S&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"form-group form-group-full",children:[t.jsxs("label",{htmlFor:"location-field-reference-type",children:[x?"Entity":"Location"," Reference Type *"]}),t.jsxs("select",{id:"location-field-reference-type",value:m.reference_type_id,onChange:j("reference_type_id"),disabled:o,children:[t.jsxs("option",{value:"",children:["Select ",x?"entity":"location"," type"]}),(x?N:E).map(T=>t.jsx("option",{value:T.value,children:T.label},T.value))]}),t.jsxs("p",{className:"field-hint",children:["Choose which ",x?"entity":"location"," type this field should reference."]})]}),t.jsxs("div",{className:"form-group form-group-full",children:[t.jsx("label",{htmlFor:"location-field-reference-filter",children:"Reference Filter"}),t.jsx("textarea",{id:"location-field-reference-filter",value:m.reference_filter,onChange:j("reference_filter"),placeholder:'Optional JSON filter, e.g. {"metadata.size": "Large"}',rows:4,disabled:o}),t.jsxs("p",{className:"field-hint",children:["Limit selectable ",x?"entities":"locations"," by filter criteria."]})]})]})]}),h&&t.jsx("div",{className:"form-error",role:"alert",children:h}),t.jsxs("div",{className:"form-actions",children:[t.jsx("button",{type:"button",className:"btn cancel",onClick:l,disabled:o,children:"Cancel"}),t.jsx("button",{type:"submit",className:"btn submit",disabled:o,children:o?"Saving...":"Save Field"})]})]})}const LB=new Set(["system_admin"]),OB={text:"Text",number:"Number",boolean:"Boolean",date:"Date",enum:"Enum",entity_reference:"Entity Reference",location_reference:"Location Reference"};function $B(){const{id:e}=Wa(),n=Mn(),{user:s,token:i,sessionReady:l}=un(),[o,d]=u.useState(null),[m,p]=u.useState([]),[h,y]=u.useState([]),[g,x]=u.useState([]),[v,S]=u.useState(!1),[N,E]=u.useState(!1),[j,A]=u.useState(""),[T,_]=u.useState(""),[M,k]=u.useState(!1),[C,D]=u.useState(null),[z,G]=u.useState(!1),[U,X]=u.useState(""),[V,R]=u.useState(""),[B,L]=u.useState(null),O=o?.name||"Location Type",$=u.useMemo(()=>{if(!o||!s)return!1;if(LB.has(s.role))return!0;const ae=o.world_owner_id||o.world?.created_by||"";return ae&&String(ae)===String(s.id)},[o,s]),F=u.useCallback((ae,ke="info")=>{L({message:ae,tone:ke})},[]);u.useEffect(()=>{if(!B)return;const ae=setTimeout(()=>L(null),3500);return()=>clearTimeout(ae)},[B]);const H=ae=>ae?Array.isArray(ae)?ae:ae?.data?ae.data:ae:null,I=u.useCallback(async()=>{if(e){S(!0),A("");try{const ae=await yI(e),ke=H(ae);d(ke)}catch(ae){console.error(" Failed to load location type details",ae),A(ae.message||"Failed to load location type")}finally{S(!1)}}},[e]),Y=u.useCallback(async ae=>{const ke=typeof ae=="string"?ae.trim():ae||"";if(!ke){p([]),y([]);return}try{const[pe,we]=await Promise.all([br({worldId:ke}).catch(be=>(console.error(" Failed to load entity types",be),null)),Pi({worldId:ke}).catch(be=>(console.error(" Failed to load location types",be),null))]),ne=pe?H(pe):[],Le=we?H(we):[];p(Array.isArray(ne)?ne:[]),y(Array.isArray(Le)?Le:[])}catch(pe){console.error(" Failed to load reference types",pe),p([]),y([])}},[]),P=u.useCallback(async()=>{if(e){E(!0),_("");try{const ae=await Tg(e),ke=H(ae);x(Array.isArray(ke)?ke:[])}catch(ae){console.error(" Failed to load fields",ae),_(ae.message||"Failed to load fields"),x([])}finally{E(!1)}}},[e]);u.useEffect(()=>{!l||!i||(I(),P())},[l,i,I,P]),u.useEffect(()=>{if(!o){p([]),y([]);return}const ae=o?.world_id||o?.worldId||o?.world?.id||"";Y(ae)},[o,o?.world_id,o?.worldId,o?.world?.id,Y]);const K=()=>{$&&(D(null),R(""),k(!0))},re=ae=>{$&&(D(ae),R(""),k(!0))},W=()=>{k(!1),D(null),R("")},ue=async ae=>{if(!$)return!1;try{G(!0),R(""),C?.id?(await dD(C.id,ae),F("Field updated","success")):(await uD(e,ae),F("Field created","success")),W(),await P()}catch(ke){console.error(" Failed to save field",ke);const pe=ke.message||"Failed to save field";return R(pe),F(pe,"error"),!1}finally{G(!1)}return!0},Q=async ae=>{if(!(!$||!ae?.id||!window.confirm(`Delete field "${ae.label||ae.name}"? This action cannot be undone.`)))try{X(ae.id),await fD(ae.id),F("Field deleted","success"),await P()}catch(pe){console.error(" Failed to delete field",pe),F(pe.message||"Failed to delete field","error")}finally{X("")}},ye=ae=>{if(!ae)return"";const{options:ke}=ae;return ke&&Array.isArray(ke.choices)&&ke.choices.length>0?ke.choices.join(", "):""};return l?i?v?t.jsx("p",{children:"Loading location type..."}):j||!o?t.jsxs("div",{className:"page-container",children:[t.jsx("div",{className:"alert error",children:j||"Location type not found"}),t.jsxs("button",{className:"btn btn-secondary",onClick:()=>n("/location-types"),children:[t.jsx(jc,{size:16})," Back to Location Types"]})]}):t.jsxs("section",{className:"entity-types-page",children:[t.jsxs("div",{className:"entity-types-header",children:[t.jsxs("div",{children:[t.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:()=>n("/location-types"),style:{marginBottom:"1rem"},children:[t.jsx(jc,{size:16})," Back to Location Types"]}),t.jsxs("h1",{children:["Fields: ",O]}),t.jsx("p",{className:"entity-types-subtitle",children:"Define custom metadata fields for locations of this type"})]}),t.jsxs("button",{type:"button",className:"btn submit",onClick:K,disabled:!$||z||U,children:[t.jsx(sa,{size:18})," Add Field"]})]}),!$&&t.jsx("div",{className:"alert info",role:"status",children:"You can view the existing fields, but only system administrators or the world owner can make changes."}),B&&t.jsx("div",{className:`toast-banner ${B.tone}`,role:"status",children:B.message}),T&&t.jsx("div",{className:"alert error",role:"alert",children:T}),t.jsx("div",{className:"entity-types-table-wrapper",children:N?t.jsx("div",{className:"empty-state",children:"Loading fields..."}):g.length===0?t.jsx("div",{className:"empty-state",children:"No fields defined yet. Add your first field to get started."}):t.jsxs("table",{className:"entity-types-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Name"}),t.jsx("th",{children:"Label"}),t.jsx("th",{children:"Data Type"}),t.jsx("th",{children:"Required"}),t.jsx("th",{children:"Visible by Default"}),t.jsx("th",{children:"Options"}),t.jsx("th",{children:"Reference Type"}),t.jsx("th",{className:"actions-column",children:"Actions"})]})}),t.jsx("tbody",{children:g.map(ae=>t.jsxs("tr",{children:[t.jsx("td",{children:ae.name}),t.jsx("td",{children:ae.label||ae.name}),t.jsx("td",{children:OB[ae.data_type]||ae.data_type}),t.jsx("td",{children:ae.required?"Yes":"No"}),t.jsx("td",{children:ae.visible_by_default!==!1?"Yes":"No"}),t.jsx("td",{children:ye(ae)}),t.jsx("td",{children:ae.referenceType?.name||""}),t.jsx("td",{className:"actions-column",children:t.jsx("div",{className:"entity-type-actions",children:$&&t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:"icon-btn",title:"Edit field",onClick:()=>re(ae),disabled:z||U===ae.id,children:t.jsx(Ga,{size:16})}),t.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete field",onClick:()=>Q(ae),disabled:U===ae.id||z,children:t.jsx(zn,{size:16})})]})})})]},ae.id))})]})}),M&&t.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:t.jsxs("div",{className:"side-panel",children:[t.jsxs("div",{className:"side-panel-header",children:[t.jsx("h2",{children:C?"Edit Field":"Add Field"}),t.jsx("button",{type:"button",className:"icon-btn",onClick:W,title:"Close form",disabled:z,children:t.jsx(ea,{size:18})})]}),t.jsx("div",{className:"side-panel-content",children:t.jsx(DB,{initialData:C,onSubmit:ue,onCancel:W,submitting:z,errorMessage:V,entityReferenceTypes:m,locationReferenceTypes:h})})]})})]}):t.jsx("p",{children:"Authenticating..."}):t.jsx("p",{children:"Restoring session..."})}const FB=zT(pT(t.jsxs(t.Fragment,{children:[t.jsx(Gt,{path:"/login",element:t.jsx(lL,{})}),t.jsxs(Gt,{path:"/",element:t.jsx(v5,{children:t.jsx(wI,{})}),children:[t.jsx(Gt,{index:!0,element:t.jsx(jI,{})}),t.jsx(Gt,{path:"worlds",element:t.jsx(vD,{})}),t.jsx(Gt,{path:"worlds/:id",element:t.jsx(CD,{})}),t.jsx(Gt,{path:"worlds/:worldId/access/bulk",element:t.jsx(SN,{})}),t.jsx(Gt,{path:"worlds/:worldId/access/audit",element:t.jsx(Dz,{})}),t.jsx(Gt,{path:"worlds/:worldId/collections",element:t.jsx(Lz,{})}),t.jsx(Gt,{path:"campaigns/:campaignId/access/bulk",element:t.jsx(SN,{})}),t.jsxs(Gt,{path:"campaigns",children:[t.jsx(Gt,{index:!0,element:t.jsx(fc,{to:"/campaigns/my",replace:!0})}),t.jsx(Gt,{path:"my",element:t.jsx(ld,{scope:"my"})}),t.jsx(Gt,{path:"my/:id",element:t.jsx(ld,{scope:"my"})}),t.jsx(Gt,{path:"all",element:t.jsx(ld,{scope:"all"})}),t.jsx(Gt,{path:"all/:id",element:t.jsx(ld,{scope:"all"})})]}),t.jsx(Gt,{path:"entities",element:t.jsx(LL,{})}),t.jsx(Gt,{path:"entities/bulk-upload",element:t.jsx(uz,{})}),t.jsx(Gt,{path:"entities/followed",element:t.jsx(Hz,{})}),t.jsx(Gt,{path:"entities/:entityId/relationship-viewer",element:t.jsx(iz,{})}),t.jsx(Gt,{path:"entities/:id",element:t.jsx(A3,{})}),t.jsxs(Gt,{path:"entity-types",children:[t.jsx(Gt,{index:!0,element:t.jsx(k3,{})}),t.jsx(Gt,{path:"new",element:t.jsx(X3,{})}),t.jsx(Gt,{path:":id/fields",element:t.jsx(V3,{})})]}),t.jsxs(Gt,{path:"relationship-types",children:[t.jsx(Gt,{index:!0,element:t.jsx(y5,{})}),t.jsx(Gt,{path:"new",element:t.jsx(g5,{})}),t.jsx(Gt,{path:":id/edit",element:t.jsx(b5,{})})]}),t.jsx(Gt,{path:"entity-relationships",element:t.jsx(f5,{})}),t.jsx(Gt,{path:"entity-secrets",element:t.jsx(x5,{})}),t.jsxs(Gt,{path:"locations",children:[t.jsx(Gt,{index:!0,element:t.jsx(lB,{})}),t.jsx(Gt,{path:":id",element:t.jsx(TB,{})})]}),t.jsxs(Gt,{path:"location-types",children:[t.jsx(Gt,{index:!0,element:t.jsx(RB,{})}),t.jsx(Gt,{path:":id/fields",element:t.jsx($B,{})})]}),t.jsxs(Gt,{path:"notes",children:[t.jsx(Gt,{index:!0,element:t.jsx(fc,{to:"/notes/session",replace:!0})}),t.jsx(Gt,{path:"session",element:t.jsx(hz,{})}),t.jsx(Gt,{path:"entities",element:t.jsx(wz,{})})]}),t.jsxs(Gt,{path:"characters",children:[t.jsx(Gt,{index:!0,element:t.jsx(fc,{to:"/characters/my",replace:!0})}),t.jsx(Gt,{path:"my",element:t.jsx(qr,{scope:"my"})}),t.jsx(Gt,{path:"my/:id",element:t.jsx(qr,{scope:"my"})}),t.jsx(Gt,{path:"others",element:t.jsx(qr,{scope:"others"})}),t.jsx(Gt,{path:"others/:id",element:t.jsx(qr,{scope:"others"})}),t.jsx(Gt,{path:"companions",element:t.jsx(qr,{scope:"companions"})}),t.jsx(Gt,{path:"companions/:id",element:t.jsx(qr,{scope:"companions"})}),t.jsx(Gt,{path:"all",element:t.jsx(qr,{scope:"all"})}),t.jsx(Gt,{path:"all/:id",element:t.jsx(qr,{scope:"all"})})]}),t.jsx(Gt,{path:"users",element:t.jsx(iL,{})}),t.jsx(Gt,{path:"security",element:t.jsx(zz,{})}),t.jsx(Gt,{path:"notifications",element:t.jsx(Pz,{})}),t.jsxs(Gt,{path:"requests",children:[t.jsx(Gt,{index:!0,element:t.jsx(Qz,{})}),t.jsx(Gt,{path:"new",element:t.jsx(sB,{})}),t.jsx(Gt,{path:":id",element:t.jsx(aB,{})})]})]}),t.jsx(Gt,{path:"*",element:t.jsx(fc,{to:"/",replace:!0})})]})));function zB(){return t.jsx(QT,{router:FB})}FA.createRoot(document.getElementById("root")).render(t.jsx(u.StrictMode,{children:t.jsx(cR,{children:t.jsx(Q3,{children:t.jsx(Pk,{children:t.jsx(lR,{children:t.jsx(zR,{children:t.jsx(zB,{})})})})})})}));export{FI as a,Cy as c,Tj as s};

(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function r(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(l){if(l.ep)return;l.ep=!0;const c=r(l);fetch(l.href,c)}})();function Di(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var jh={exports:{}},Co={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kx;function SC(){if(Kx)return Co;Kx=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function r(i,l,c){var f=null;if(c!==void 0&&(f=""+c),l.key!==void 0&&(f=""+l.key),"key"in l){c={};for(var m in l)m!=="key"&&(c[m]=l[m])}else c=l;return l=c.ref,{$$typeof:e,type:i,key:f,ref:l!==void 0?l:null,props:c}}return Co.Fragment=t,Co.jsx=r,Co.jsxs=r,Co}var Wx;function wC(){return Wx||(Wx=1,jh.exports=SC()),jh.exports}var a=wC(),_h={exports:{}},en={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zx;function NC(){if(Zx)return en;Zx=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),f=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),v=Symbol.iterator;function S(T){return T===null||typeof T!="object"?null:(T=v&&T[v]||T["@@iterator"],typeof T=="function"?T:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N=Object.assign,E={};function C(T,q,Y){this.props=T,this.context=q,this.refs=E,this.updater=Y||w}C.prototype.isReactComponent={},C.prototype.setState=function(T,q){if(typeof T!="object"&&typeof T!="function"&&T!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,T,q,"setState")},C.prototype.forceUpdate=function(T){this.updater.enqueueForceUpdate(this,T,"forceUpdate")};function A(){}A.prototype=C.prototype;function O(T,q,Y){this.props=T,this.context=q,this.refs=E,this.updater=Y||w}var _=O.prototype=new A;_.constructor=O,N(_,C.prototype),_.isPureReactComponent=!0;var k=Array.isArray;function D(){}var j={H:null,A:null,T:null,S:null},z=Object.prototype.hasOwnProperty;function P(T,q,Y){var Q=Y.ref;return{$$typeof:e,type:T,key:q,ref:Q!==void 0?Q:null,props:Y}}function G(T,q){return P(T.type,q,T.props)}function H(T){return typeof T=="object"&&T!==null&&T.$$typeof===e}function X(T){var q={"=":"=0",":":"=2"};return"$"+T.replace(/[=:]/g,function(Y){return q[Y]})}var V=/\/+/g;function R(T,q){return typeof T=="object"&&T!==null&&T.key!=null?X(""+T.key):q.toString(36)}function B(T){switch(T.status){case"fulfilled":return T.value;case"rejected":throw T.reason;default:switch(typeof T.status=="string"?T.then(D,D):(T.status="pending",T.then(function(q){T.status==="pending"&&(T.status="fulfilled",T.value=q)},function(q){T.status==="pending"&&(T.status="rejected",T.reason=q)})),T.status){case"fulfilled":return T.value;case"rejected":throw T.reason}}throw T}function I(T,q,Y,Q,oe){var Z=typeof T;(Z==="undefined"||Z==="boolean")&&(T=null);var de=!1;if(T===null)de=!0;else switch(Z){case"bigint":case"string":case"number":de=!0;break;case"object":switch(T.$$typeof){case e:case t:de=!0;break;case y:return de=T._init,I(de(T._payload),q,Y,Q,oe)}}if(de)return oe=oe(T),de=Q===""?"."+R(T,0):Q,k(oe)?(Y="",de!=null&&(Y=de.replace(V,"$&/")+"/"),I(oe,q,Y,"",function(ne){return ne})):oe!=null&&(H(oe)&&(oe=G(oe,Y+(oe.key==null||T&&T.key===oe.key?"":(""+oe.key).replace(V,"$&/")+"/")+de)),q.push(oe)),1;de=0;var J=Q===""?".":Q+":";if(k(T))for(var se=0;se<T.length;se++)Q=T[se],Z=J+R(Q,se),de+=I(Q,q,Y,Z,oe);else if(se=S(T),typeof se=="function")for(T=se.call(T),se=0;!(Q=T.next()).done;)Q=Q.value,Z=J+R(Q,se++),de+=I(Q,q,Y,Z,oe);else if(Z==="object"){if(typeof T.then=="function")return I(B(T),q,Y,Q,oe);throw q=String(T),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(T).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return de}function L(T,q,Y){if(T==null)return T;var Q=[],oe=0;return I(T,Q,"","",function(Z){return q.call(Y,Z,oe++)}),Q}function $(T){if(T._status===-1){var q=T._result;q=q(),q.then(function(Y){(T._status===0||T._status===-1)&&(T._status=1,T._result=Y)},function(Y){(T._status===0||T._status===-1)&&(T._status=2,T._result=Y)}),T._status===-1&&(T._status=0,T._result=q)}if(T._status===1)return T._result.default;throw T._result}var M=typeof reportError=="function"?reportError:function(T){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof T=="object"&&T!==null&&typeof T.message=="string"?String(T.message):String(T),error:T});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",T);return}console.error(T)},U={map:L,forEach:function(T,q,Y){L(T,function(){q.apply(this,arguments)},Y)},count:function(T){var q=0;return L(T,function(){q++}),q},toArray:function(T){return L(T,function(q){return q})||[]},only:function(T){if(!H(T))throw Error("React.Children.only expected to receive a single React element child.");return T}};return en.Activity=g,en.Children=U,en.Component=C,en.Fragment=r,en.Profiler=l,en.PureComponent=O,en.StrictMode=i,en.Suspense=h,en.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=j,en.__COMPILER_RUNTIME={__proto__:null,c:function(T){return j.H.useMemoCache(T)}},en.cache=function(T){return function(){return T.apply(null,arguments)}},en.cacheSignal=function(){return null},en.cloneElement=function(T,q,Y){if(T==null)throw Error("The argument must be a React element, but you passed "+T+".");var Q=N({},T.props),oe=T.key;if(q!=null)for(Z in q.key!==void 0&&(oe=""+q.key),q)!z.call(q,Z)||Z==="key"||Z==="__self"||Z==="__source"||Z==="ref"&&q.ref===void 0||(Q[Z]=q[Z]);var Z=arguments.length-2;if(Z===1)Q.children=Y;else if(1<Z){for(var de=Array(Z),J=0;J<Z;J++)de[J]=arguments[J+2];Q.children=de}return P(T.type,oe,Q)},en.createContext=function(T){return T={$$typeof:f,_currentValue:T,_currentValue2:T,_threadCount:0,Provider:null,Consumer:null},T.Provider=T,T.Consumer={$$typeof:c,_context:T},T},en.createElement=function(T,q,Y){var Q,oe={},Z=null;if(q!=null)for(Q in q.key!==void 0&&(Z=""+q.key),q)z.call(q,Q)&&Q!=="key"&&Q!=="__self"&&Q!=="__source"&&(oe[Q]=q[Q]);var de=arguments.length-2;if(de===1)oe.children=Y;else if(1<de){for(var J=Array(de),se=0;se<de;se++)J[se]=arguments[se+2];oe.children=J}if(T&&T.defaultProps)for(Q in de=T.defaultProps,de)oe[Q]===void 0&&(oe[Q]=de[Q]);return P(T,Z,oe)},en.createRef=function(){return{current:null}},en.forwardRef=function(T){return{$$typeof:m,render:T}},en.isValidElement=H,en.lazy=function(T){return{$$typeof:y,_payload:{_status:-1,_result:T},_init:$}},en.memo=function(T,q){return{$$typeof:p,type:T,compare:q===void 0?null:q}},en.startTransition=function(T){var q=j.T,Y={};j.T=Y;try{var Q=T(),oe=j.S;oe!==null&&oe(Y,Q),typeof Q=="object"&&Q!==null&&typeof Q.then=="function"&&Q.then(D,M)}catch(Z){M(Z)}finally{q!==null&&Y.types!==null&&(q.types=Y.types),j.T=q}},en.unstable_useCacheRefresh=function(){return j.H.useCacheRefresh()},en.use=function(T){return j.H.use(T)},en.useActionState=function(T,q,Y){return j.H.useActionState(T,q,Y)},en.useCallback=function(T,q){return j.H.useCallback(T,q)},en.useContext=function(T){return j.H.useContext(T)},en.useDebugValue=function(){},en.useDeferredValue=function(T,q){return j.H.useDeferredValue(T,q)},en.useEffect=function(T,q){return j.H.useEffect(T,q)},en.useEffectEvent=function(T){return j.H.useEffectEvent(T)},en.useId=function(){return j.H.useId()},en.useImperativeHandle=function(T,q,Y){return j.H.useImperativeHandle(T,q,Y)},en.useInsertionEffect=function(T,q){return j.H.useInsertionEffect(T,q)},en.useLayoutEffect=function(T,q){return j.H.useLayoutEffect(T,q)},en.useMemo=function(T,q){return j.H.useMemo(T,q)},en.useOptimistic=function(T,q){return j.H.useOptimistic(T,q)},en.useReducer=function(T,q,Y){return j.H.useReducer(T,q,Y)},en.useRef=function(T){return j.H.useRef(T)},en.useState=function(T){return j.H.useState(T)},en.useSyncExternalStore=function(T,q,Y){return j.H.useSyncExternalStore(T,q,Y)},en.useTransition=function(){return j.H.useTransition()},en.version="19.2.0",en}var Qx;function Sc(){return Qx||(Qx=1,_h.exports=NC()),_h.exports}var u=Sc();const De=Di(u);var Ch={exports:{}},Ao={},Ah={exports:{}},Th={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jx;function EC(){return Jx||(Jx=1,(function(e){function t(I,L){var $=I.length;I.push(L);e:for(;0<$;){var M=$-1>>>1,U=I[M];if(0<l(U,L))I[M]=L,I[$]=U,$=M;else break e}}function r(I){return I.length===0?null:I[0]}function i(I){if(I.length===0)return null;var L=I[0],$=I.pop();if($!==L){I[0]=$;e:for(var M=0,U=I.length,T=U>>>1;M<T;){var q=2*(M+1)-1,Y=I[q],Q=q+1,oe=I[Q];if(0>l(Y,$))Q<U&&0>l(oe,Y)?(I[M]=oe,I[Q]=$,M=Q):(I[M]=Y,I[q]=$,M=q);else if(Q<U&&0>l(oe,$))I[M]=oe,I[Q]=$,M=Q;else break e}}return L}function l(I,L){var $=I.sortIndex-L.sortIndex;return $!==0?$:I.id-L.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;e.unstable_now=function(){return c.now()}}else{var f=Date,m=f.now();e.unstable_now=function(){return f.now()-m}}var h=[],p=[],y=1,g=null,v=3,S=!1,w=!1,N=!1,E=!1,C=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;function _(I){for(var L=r(p);L!==null;){if(L.callback===null)i(p);else if(L.startTime<=I)i(p),L.sortIndex=L.expirationTime,t(h,L);else break;L=r(p)}}function k(I){if(N=!1,_(I),!w)if(r(h)!==null)w=!0,D||(D=!0,X());else{var L=r(p);L!==null&&B(k,L.startTime-I)}}var D=!1,j=-1,z=5,P=-1;function G(){return E?!0:!(e.unstable_now()-P<z)}function H(){if(E=!1,D){var I=e.unstable_now();P=I;var L=!0;try{e:{w=!1,N&&(N=!1,A(j),j=-1),S=!0;var $=v;try{t:{for(_(I),g=r(h);g!==null&&!(g.expirationTime>I&&G());){var M=g.callback;if(typeof M=="function"){g.callback=null,v=g.priorityLevel;var U=M(g.expirationTime<=I);if(I=e.unstable_now(),typeof U=="function"){g.callback=U,_(I),L=!0;break t}g===r(h)&&i(h),_(I)}else i(h);g=r(h)}if(g!==null)L=!0;else{var T=r(p);T!==null&&B(k,T.startTime-I),L=!1}}break e}finally{g=null,v=$,S=!1}L=void 0}}finally{L?X():D=!1}}}var X;if(typeof O=="function")X=function(){O(H)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,R=V.port2;V.port1.onmessage=H,X=function(){R.postMessage(null)}}else X=function(){C(H,0)};function B(I,L){j=C(function(){I(e.unstable_now())},L)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(I){I.callback=null},e.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):z=0<I?Math.floor(1e3/I):5},e.unstable_getCurrentPriorityLevel=function(){return v},e.unstable_next=function(I){switch(v){case 1:case 2:case 3:var L=3;break;default:L=v}var $=v;v=L;try{return I()}finally{v=$}},e.unstable_requestPaint=function(){E=!0},e.unstable_runWithPriority=function(I,L){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var $=v;v=I;try{return L()}finally{v=$}},e.unstable_scheduleCallback=function(I,L,$){var M=e.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?M+$:M):$=M,I){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=$+U,I={id:y++,callback:L,priorityLevel:I,startTime:$,expirationTime:U,sortIndex:-1},$>M?(I.sortIndex=$,t(p,I),r(h)===null&&I===r(p)&&(N?(A(j),j=-1):N=!0,B(k,$-M))):(I.sortIndex=U,t(h,I),w||S||(w=!0,D||(D=!0,X()))),I},e.unstable_shouldYield=G,e.unstable_wrapCallback=function(I){var L=v;return function(){var $=v;v=L;try{return I.apply(this,arguments)}finally{v=$}}}})(Th)),Th}var e0;function jC(){return e0||(e0=1,Ah.exports=EC()),Ah.exports}var Mh={exports:{}},ya={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t0;function _C(){if(t0)return ya;t0=1;var e=Sc();function t(h){var p="https://react.dev/errors/"+h;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)p+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+h+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var i={d:{f:r,r:function(){throw Error(t(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},l=Symbol.for("react.portal");function c(h,p,y){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:g==null?null:""+g,children:h,containerInfo:p,implementation:y}}var f=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function m(h,p){if(h==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return ya.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,ya.createPortal=function(h,p){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(t(299));return c(h,p,null,y)},ya.flushSync=function(h){var p=f.T,y=i.p;try{if(f.T=null,i.p=2,h)return h()}finally{f.T=p,i.p=y,i.d.f()}},ya.preconnect=function(h,p){typeof h=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,i.d.C(h,p))},ya.prefetchDNS=function(h){typeof h=="string"&&i.d.D(h)},ya.preinit=function(h,p){if(typeof h=="string"&&p&&typeof p.as=="string"){var y=p.as,g=m(y,p.crossOrigin),v=typeof p.integrity=="string"?p.integrity:void 0,S=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;y==="style"?i.d.S(h,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:g,integrity:v,fetchPriority:S}):y==="script"&&i.d.X(h,{crossOrigin:g,integrity:v,fetchPriority:S,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},ya.preinitModule=function(h,p){if(typeof h=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var y=m(p.as,p.crossOrigin);i.d.M(h,{crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&i.d.M(h)},ya.preload=function(h,p){if(typeof h=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var y=p.as,g=m(y,p.crossOrigin);i.d.L(h,y,{crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},ya.preloadModule=function(h,p){if(typeof h=="string")if(p){var y=m(p.as,p.crossOrigin);i.d.m(h,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else i.d.m(h)},ya.requestFormReset=function(h){i.d.r(h)},ya.unstable_batchedUpdates=function(h,p){return h(p)},ya.useFormState=function(h,p,y){return f.H.useFormState(h,p,y)},ya.useFormStatus=function(){return f.H.useHostTransitionStatus()},ya.version="19.2.0",ya}var n0;function Fw(){if(n0)return Mh.exports;n0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Mh.exports=_C(),Mh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a0;function CC(){if(a0)return Ao;a0=1;var e=jC(),t=Sc(),r=Fw();function i(n){var s="https://react.dev/errors/"+n;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)s+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+n+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function c(n){var s=n,o=n;if(n.alternate)for(;s.return;)s=s.return;else{n=s;do s=n,(s.flags&4098)!==0&&(o=s.return),n=s.return;while(n)}return s.tag===3?o:null}function f(n){if(n.tag===13){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function m(n){if(n.tag===31){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function h(n){if(c(n)!==n)throw Error(i(188))}function p(n){var s=n.alternate;if(!s){if(s=c(n),s===null)throw Error(i(188));return s!==n?null:n}for(var o=n,d=s;;){var b=o.return;if(b===null)break;var x=b.alternate;if(x===null){if(d=b.return,d!==null){o=d;continue}break}if(b.child===x.child){for(x=b.child;x;){if(x===o)return h(b),n;if(x===d)return h(b),s;x=x.sibling}throw Error(i(188))}if(o.return!==d.return)o=b,d=x;else{for(var F=!1,W=b.child;W;){if(W===o){F=!0,o=b,d=x;break}if(W===d){F=!0,d=b,o=x;break}W=W.sibling}if(!F){for(W=x.child;W;){if(W===o){F=!0,o=x,d=b;break}if(W===d){F=!0,d=x,o=b;break}W=W.sibling}if(!F)throw Error(i(189))}}if(o.alternate!==d)throw Error(i(190))}if(o.tag!==3)throw Error(i(188));return o.stateNode.current===o?n:s}function y(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n;for(n=n.child;n!==null;){if(s=y(n),s!==null)return s;n=n.sibling}return null}var g=Object.assign,v=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),A=Symbol.for("react.consumer"),O=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),D=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),z=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),G=Symbol.for("react.memo_cache_sentinel"),H=Symbol.iterator;function X(n){return n===null||typeof n!="object"?null:(n=H&&n[H]||n["@@iterator"],typeof n=="function"?n:null)}var V=Symbol.for("react.client.reference");function R(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===V?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case N:return"Fragment";case C:return"Profiler";case E:return"StrictMode";case k:return"Suspense";case D:return"SuspenseList";case P:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case w:return"Portal";case O:return n.displayName||"Context";case A:return(n._context.displayName||"Context")+".Consumer";case _:var s=n.render;return n=n.displayName,n||(n=s.displayName||s.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case j:return s=n.displayName||null,s!==null?s:R(n.type)||"Memo";case z:s=n._payload,n=n._init;try{return R(n(s))}catch{}}return null}var B=Array.isArray,I=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$={pending:!1,data:null,method:null,action:null},M=[],U=-1;function T(n){return{current:n}}function q(n){0>U||(n.current=M[U],M[U]=null,U--)}function Y(n,s){U++,M[U]=n.current,n.current=s}var Q=T(null),oe=T(null),Z=T(null),de=T(null);function J(n,s){switch(Y(Z,s),Y(oe,n),Y(Q,null),s.nodeType){case 9:case 11:n=(n=s.documentElement)&&(n=n.namespaceURI)?bx(n):0;break;default:if(n=s.tagName,s=s.namespaceURI)s=bx(s),n=vx(s,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}q(Q),Y(Q,n)}function se(){q(Q),q(oe),q(Z)}function ne(n){n.memoizedState!==null&&Y(de,n);var s=Q.current,o=vx(s,n.type);s!==o&&(Y(oe,n),Y(Q,o))}function we(n){oe.current===n&&(q(Q),q(oe)),de.current===n&&(q(de),No._currentValue=$)}var Le,Me;function Ae(n){if(Le===void 0)try{throw Error()}catch(o){var s=o.stack.trim().match(/\n( *(at )?)/);Le=s&&s[1]||"",Me=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Le+n+Me}var ot=!1;function ze(n,s){if(!n||ot)return"";ot=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(s){var lt=function(){throw Error()};if(Object.defineProperty(lt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(lt,[])}catch(Ye){var Fe=Ye}Reflect.construct(n,[],lt)}else{try{lt.call()}catch(Ye){Fe=Ye}n.call(lt.prototype)}}else{try{throw Error()}catch(Ye){Fe=Ye}(lt=n())&&typeof lt.catch=="function"&&lt.catch(function(){})}}catch(Ye){if(Ye&&Fe&&typeof Ye.stack=="string")return[Ye.stack,Fe.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=d.DetermineComponentFrameRoot(),F=x[0],W=x[1];if(F&&W){var he=F.split(`
`),Oe=W.split(`
`);for(b=d=0;d<he.length&&!he[d].includes("DetermineComponentFrameRoot");)d++;for(;b<Oe.length&&!Oe[b].includes("DetermineComponentFrameRoot");)b++;if(d===he.length||b===Oe.length)for(d=he.length-1,b=Oe.length-1;1<=d&&0<=b&&he[d]!==Oe[b];)b--;for(;1<=d&&0<=b;d--,b--)if(he[d]!==Oe[b]){if(d!==1||b!==1)do if(d--,b--,0>b||he[d]!==Oe[b]){var tt=`
`+he[d].replace(" at new "," at ");return n.displayName&&tt.includes("<anonymous>")&&(tt=tt.replace("<anonymous>",n.displayName)),tt}while(1<=d&&0<=b);break}}}finally{ot=!1,Error.prepareStackTrace=o}return(o=n?n.displayName||n.name:"")?Ae(o):""}function nt(n,s){switch(n.tag){case 26:case 27:case 5:return Ae(n.type);case 16:return Ae("Lazy");case 13:return n.child!==s&&s!==null?Ae("Suspense Fallback"):Ae("Suspense");case 19:return Ae("SuspenseList");case 0:case 15:return ze(n.type,!1);case 11:return ze(n.type.render,!1);case 1:return ze(n.type,!0);case 31:return Ae("Activity");default:return""}}function $e(n){try{var s="",o=null;do s+=nt(n,o),o=n,n=n.return;while(n);return s}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var vt=Object.prototype.hasOwnProperty,_t=e.unstable_scheduleCallback,Tt=e.unstable_cancelCallback,Ct=e.unstable_shouldYield,Be=e.unstable_requestPaint,at=e.unstable_now,fe=e.unstable_getCurrentPriorityLevel,ce=e.unstable_ImmediatePriority,ye=e.unstable_UserBlockingPriority,Pe=e.unstable_NormalPriority,ee=e.unstable_LowPriority,pe=e.unstable_IdlePriority,me=e.log,Se=e.unstable_setDisableYieldValue,Ge=null,Xe=null;function et(n){if(typeof me=="function"&&Se(n),Xe&&typeof Xe.setStrictMode=="function")try{Xe.setStrictMode(Ge,n)}catch{}}var Te=Math.clz32?Math.clz32:At,mt=Math.log,Dt=Math.LN2;function At(n){return n>>>=0,n===0?32:31-(mt(n)/Dt|0)|0}var Ke=256,ct=262144,Rt=4194304;function Ut(n){var s=n&42;if(s!==0)return s;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return n&261888;case 262144:case 524288:case 1048576:case 2097152:return n&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function Qt(n,s,o){var d=n.pendingLanes;if(d===0)return 0;var b=0,x=n.suspendedLanes,F=n.pingedLanes;n=n.warmLanes;var W=d&134217727;return W!==0?(d=W&~x,d!==0?b=Ut(d):(F&=W,F!==0?b=Ut(F):o||(o=W&~n,o!==0&&(b=Ut(o))))):(W=d&~x,W!==0?b=Ut(W):F!==0?b=Ut(F):o||(o=d&~n,o!==0&&(b=Ut(o)))),b===0?0:s!==0&&s!==b&&(s&x)===0&&(x=b&-b,o=s&-s,x>=o||x===32&&(o&4194048)!==0)?s:b}function wt(n,s){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&s)===0}function Ft(n,s){switch(n){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ht(){var n=Rt;return Rt<<=1,(Rt&62914560)===0&&(Rt=4194304),n}function kt(n){for(var s=[],o=0;31>o;o++)s.push(n);return s}function te(n,s){n.pendingLanes|=s,s!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function be(n,s,o,d,b,x){var F=n.pendingLanes;n.pendingLanes=o,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=o,n.entangledLanes&=o,n.errorRecoveryDisabledLanes&=o,n.shellSuspendCounter=0;var W=n.entanglements,he=n.expirationTimes,Oe=n.hiddenUpdates;for(o=F&~o;0<o;){var tt=31-Te(o),lt=1<<tt;W[tt]=0,he[tt]=-1;var Fe=Oe[tt];if(Fe!==null)for(Oe[tt]=null,tt=0;tt<Fe.length;tt++){var Ye=Fe[tt];Ye!==null&&(Ye.lane&=-536870913)}o&=~lt}d!==0&&ve(n,d,0),x!==0&&b===0&&n.tag!==0&&(n.suspendedLanes|=x&~(F&~s))}function ve(n,s,o){n.pendingLanes|=s,n.suspendedLanes&=~s;var d=31-Te(s);n.entangledLanes|=s,n.entanglements[d]=n.entanglements[d]|1073741824|o&261930}function Ue(n,s){var o=n.entangledLanes|=s;for(n=n.entanglements;o;){var d=31-Te(o),b=1<<d;b&s|n[d]&s&&(n[d]|=s),o&=~b}}function it(n,s){var o=s&-s;return o=(o&42)!==0?1:xt(o),(o&(n.suspendedLanes|s))!==0?0:o}function xt(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function ie(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function _e(){var n=L.p;return n!==0?n:(n=window.event,n===void 0?32:qx(n.type))}function qe(n,s){var o=L.p;try{return L.p=n,s()}finally{L.p=o}}var ht=Math.random().toString(36).slice(2),pt="__reactFiber$"+ht,Ee="__reactProps$"+ht,st="__reactContainer$"+ht,le="__reactEvents$"+ht,Je="__reactListeners$"+ht,ut="__reactHandles$"+ht,gt="__reactResources$"+ht,re="__reactMarker$"+ht;function Ze(n){delete n[pt],delete n[Ee],delete n[le],delete n[Je],delete n[ut]}function We(n){var s=n[pt];if(s)return s;for(var o=n.parentNode;o;){if(s=o[st]||o[pt]){if(o=s.alternate,s.child!==null||o!==null&&o.child!==null)for(n=_x(n);n!==null;){if(o=n[pt])return o;n=_x(n)}return s}n=o,o=n.parentNode}return null}function dt(n){if(n=n[pt]||n[st]){var s=n.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return n}return null}function Qe(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n.stateNode;throw Error(i(33))}function yt(n){var s=n[gt];return s||(s=n[gt]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function ke(n){n[re]=!0}var Ve=new Set,ft={};function K(n,s){ae(n,s),ae(n+"Capture",s)}function ae(n,s){for(ft[n]=s,n=0;n<s.length;n++)Ve.add(s[n])}var Ne=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),He={},bt={};function Nt(n){return vt.call(bt,n)?!0:vt.call(He,n)?!1:Ne.test(n)?bt[n]=!0:(He[n]=!0,!1)}function jt(n,s,o){if(Nt(s))if(o===null)n.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":n.removeAttribute(s);return;case"boolean":var d=s.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){n.removeAttribute(s);return}}n.setAttribute(s,""+o)}}function It(n,s,o){if(o===null)n.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(s);return}n.setAttribute(s,""+o)}}function tn(n,s,o,d){if(d===null)n.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(o);return}n.setAttributeNS(s,o,""+d)}}function un(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Kt(n){var s=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function na(n,s,o){var d=Object.getOwnPropertyDescriptor(n.constructor.prototype,s);if(!n.hasOwnProperty(s)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var b=d.get,x=d.set;return Object.defineProperty(n,s,{configurable:!0,get:function(){return b.call(this)},set:function(F){o=""+F,x.call(this,F)}}),Object.defineProperty(n,s,{enumerable:d.enumerable}),{getValue:function(){return o},setValue:function(F){o=""+F},stopTracking:function(){n._valueTracker=null,delete n[s]}}}}function ba(n){if(!n._valueTracker){var s=Kt(n)?"checked":"value";n._valueTracker=na(n,s,""+n[s])}}function $s(n){if(!n)return!1;var s=n._valueTracker;if(!s)return!0;var o=s.getValue(),d="";return n&&(d=Kt(n)?n.checked?"true":"false":n.value),n=d,n!==o?(s.setValue(n),!0):!1}function va(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var Bl=/[\n"\\]/g;function fa(n){return n.replace(Bl,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function os(n,s,o,d,b,x,F,W){n.name="",F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"?n.type=F:n.removeAttribute("type"),s!=null?F==="number"?(s===0&&n.value===""||n.value!=s)&&(n.value=""+un(s)):n.value!==""+un(s)&&(n.value=""+un(s)):F!=="submit"&&F!=="reset"||n.removeAttribute("value"),s!=null?ai(n,F,un(s)):o!=null?ai(n,F,un(o)):d!=null&&n.removeAttribute("value"),b==null&&x!=null&&(n.defaultChecked=!!x),b!=null&&(n.checked=b&&typeof b!="function"&&typeof b!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?n.name=""+un(W):n.removeAttribute("name")}function ni(n,s,o,d,b,x,F,W){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(n.type=x),s!=null||o!=null){if(!(x!=="submit"&&x!=="reset"||s!=null)){ba(n);return}o=o!=null?""+un(o):"",s=s!=null?""+un(s):o,W||s===n.value||(n.value=s),n.defaultValue=s}d=d??b,d=typeof d!="function"&&typeof d!="symbol"&&!!d,n.checked=W?n.checked:!!d,n.defaultChecked=!!d,F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"&&(n.name=F),ba(n)}function ai(n,s,o){s==="number"&&va(n.ownerDocument)===n||n.defaultValue===""+o||(n.defaultValue=""+o)}function cs(n,s,o,d){if(n=n.options,s){s={};for(var b=0;b<o.length;b++)s["$"+o[b]]=!0;for(o=0;o<n.length;o++)b=s.hasOwnProperty("$"+n[o].value),n[o].selected!==b&&(n[o].selected=b),b&&d&&(n[o].defaultSelected=!0)}else{for(o=""+un(o),s=null,b=0;b<n.length;b++){if(n[b].value===o){n[b].selected=!0,d&&(n[b].defaultSelected=!0);return}s!==null||n[b].disabled||(s=n[b])}s!==null&&(s.selected=!0)}}function Yn(n,s,o){if(s!=null&&(s=""+un(s),s!==n.value&&(n.value=s),o==null)){n.defaultValue!==s&&(n.defaultValue=s);return}n.defaultValue=o!=null?""+un(o):""}function ue(n,s,o,d){if(s==null){if(d!=null){if(o!=null)throw Error(i(92));if(B(d)){if(1<d.length)throw Error(i(93));d=d[0]}o=d}o==null&&(o=""),s=o}o=un(s),n.defaultValue=o,d=n.textContent,d===o&&d!==""&&d!==null&&(n.value=d),ba(n)}function je(n,s){if(s){var o=n.firstChild;if(o&&o===n.lastChild&&o.nodeType===3){o.nodeValue=s;return}}n.textContent=s}var Pt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function yn(n,s,o){var d=s.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?d?n.setProperty(s,""):s==="float"?n.cssFloat="":n[s]="":d?n.setProperty(s,o):typeof o!="number"||o===0||Pt.has(s)?s==="float"?n.cssFloat=o:n[s]=(""+o).trim():n[s]=o+"px"}function mn(n,s,o){if(s!=null&&typeof s!="object")throw Error(i(62));if(n=n.style,o!=null){for(var d in o)!o.hasOwnProperty(d)||s!=null&&s.hasOwnProperty(d)||(d.indexOf("--")===0?n.setProperty(d,""):d==="float"?n.cssFloat="":n[d]="");for(var b in s)d=s[b],s.hasOwnProperty(b)&&o[b]!==d&&yn(n,b,d)}else for(var x in s)s.hasOwnProperty(x)&&yn(n,x,s[x])}function Vt(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var En=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Un=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ma(n){return Un.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}function ra(){}var ha=null;function Es(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var ge=null,Re=null;function St(n){var s=dt(n);if(s&&(n=s.stateNode)){var o=n[Ee]||null;e:switch(n=s.stateNode,s.type){case"input":if(os(n,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),s=o.name,o.type==="radio"&&s!=null){for(o=n;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+fa(""+s)+'"][type="radio"]'),s=0;s<o.length;s++){var d=o[s];if(d!==n&&d.form===n.form){var b=d[Ee]||null;if(!b)throw Error(i(90));os(d,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(s=0;s<o.length;s++)d=o[s],d.form===n.form&&$s(d)}break e;case"textarea":Yn(n,o.value,o.defaultValue);break e;case"select":s=o.value,s!=null&&cs(n,!!o.multiple,s,!1)}}}var Lt=!1;function Gt(n,s,o){if(Lt)return n(s,o);Lt=!0;try{var d=n(s);return d}finally{if(Lt=!1,(ge!==null||Re!==null)&&(hu(),ge&&(s=ge,n=Re,Re=ge=null,St(s),n)))for(s=0;s<n.length;s++)St(n[s])}}function nn(n,s){var o=n.stateNode;if(o===null)return null;var d=o[Ee]||null;if(d===null)return null;o=d[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(n=n.type,d=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!d;break e;default:n=!1}if(n)return null;if(o&&typeof o!="function")throw Error(i(231,s,typeof o));return o}var ln=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Zt=!1;if(ln)try{var $t={};Object.defineProperty($t,"passive",{get:function(){Zt=!0}}),window.addEventListener("test",$t,$t),window.removeEventListener("test",$t,$t)}catch{Zt=!1}var Ln=null,Ia=null,Fs=null;function us(){if(Fs)return Fs;var n,s=Ia,o=s.length,d,b="value"in Ln?Ln.value:Ln.textContent,x=b.length;for(n=0;n<o&&s[n]===b[n];n++);var F=o-n;for(d=1;d<=F&&s[o-d]===b[x-d];d++);return Fs=b.slice(n,1<d?1-d:void 0)}function Oi(n){var s=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&s===13&&(n=13)):n=s,n===10&&(n=13),32<=n||n===13?n:0}function hr(){return!0}function Mc(){return!1}function pa(n){function s(o,d,b,x,F){this._reactName=o,this._targetInst=b,this.type=d,this.nativeEvent=x,this.target=F,this.currentTarget=null;for(var W in n)n.hasOwnProperty(W)&&(o=n[W],this[W]=o?o(x):x[W]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?hr:Mc,this.isPropagationStopped=Mc,this}return g(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=hr)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=hr)},persist:function(){},isPersistent:hr}),s}var si={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Rc=pa(si),Ul=g({},si,{view:0,detail:0}),vj=pa(Ul),Cf,Af,ql,kc=g({},Ul,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mf,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==ql&&(ql&&n.type==="mousemove"?(Cf=n.screenX-ql.screenX,Af=n.screenY-ql.screenY):Af=Cf=0,ql=n),Cf)},movementY:function(n){return"movementY"in n?n.movementY:Af}}),Sg=pa(kc),xj=g({},kc,{dataTransfer:0}),Sj=pa(xj),wj=g({},Ul,{relatedTarget:0}),Tf=pa(wj),Nj=g({},si,{animationName:0,elapsedTime:0,pseudoElement:0}),Ej=pa(Nj),jj=g({},si,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),_j=pa(jj),Cj=g({},si,{data:0}),wg=pa(Cj),Aj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Mj={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rj(n){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(n):(n=Mj[n])?!!s[n]:!1}function Mf(){return Rj}var kj=g({},Ul,{key:function(n){if(n.key){var s=Aj[n.key]||n.key;if(s!=="Unidentified")return s}return n.type==="keypress"?(n=Oi(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Tj[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mf,charCode:function(n){return n.type==="keypress"?Oi(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Oi(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Dj=pa(kj),Ij=g({},kc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ng=pa(Ij),Lj=g({},Ul,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mf}),Oj=pa(Lj),zj=g({},si,{propertyName:0,elapsedTime:0,pseudoElement:0}),$j=pa(zj),Fj=g({},kc,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Bj=pa(Fj),Uj=g({},si,{newState:0,oldState:0}),qj=pa(Uj),Hj=[9,13,27,32],Rf=ln&&"CompositionEvent"in window,Hl=null;ln&&"documentMode"in document&&(Hl=document.documentMode);var Pj=ln&&"TextEvent"in window&&!Hl,Eg=ln&&(!Rf||Hl&&8<Hl&&11>=Hl),jg=" ",_g=!1;function Cg(n,s){switch(n){case"keyup":return Hj.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ag(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var zi=!1;function Vj(n,s){switch(n){case"compositionend":return Ag(s);case"keypress":return s.which!==32?null:(_g=!0,jg);case"textInput":return n=s.data,n===jg&&_g?null:n;default:return null}}function Yj(n,s){if(zi)return n==="compositionend"||!Rf&&Cg(n,s)?(n=us(),Fs=Ia=Ln=null,zi=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Eg&&s.locale!=="ko"?null:s.data;default:return null}}var Gj={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Tg(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s==="input"?!!Gj[n.type]:s==="textarea"}function Mg(n,s,o,d){ge?Re?Re.push(d):Re=[d]:ge=d,s=Su(s,"onChange"),0<s.length&&(o=new Rc("onChange","change",null,o,d),n.push({event:o,listeners:s}))}var Pl=null,Vl=null;function Xj(n){fx(n,0)}function Dc(n){var s=Qe(n);if($s(s))return n}function Rg(n,s){if(n==="change")return s}var kg=!1;if(ln){var kf;if(ln){var Df="oninput"in document;if(!Df){var Dg=document.createElement("div");Dg.setAttribute("oninput","return;"),Df=typeof Dg.oninput=="function"}kf=Df}else kf=!1;kg=kf&&(!document.documentMode||9<document.documentMode)}function Ig(){Pl&&(Pl.detachEvent("onpropertychange",Lg),Vl=Pl=null)}function Lg(n){if(n.propertyName==="value"&&Dc(Vl)){var s=[];Mg(s,Vl,n,Es(n)),Gt(Xj,s)}}function Kj(n,s,o){n==="focusin"?(Ig(),Pl=s,Vl=o,Pl.attachEvent("onpropertychange",Lg)):n==="focusout"&&Ig()}function Wj(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Dc(Vl)}function Zj(n,s){if(n==="click")return Dc(s)}function Qj(n,s){if(n==="input"||n==="change")return Dc(s)}function Jj(n,s){return n===s&&(n!==0||1/n===1/s)||n!==n&&s!==s}var La=typeof Object.is=="function"?Object.is:Jj;function Yl(n,s){if(La(n,s))return!0;if(typeof n!="object"||n===null||typeof s!="object"||s===null)return!1;var o=Object.keys(n),d=Object.keys(s);if(o.length!==d.length)return!1;for(d=0;d<o.length;d++){var b=o[d];if(!vt.call(s,b)||!La(n[b],s[b]))return!1}return!0}function Og(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function zg(n,s){var o=Og(n);n=0;for(var d;o;){if(o.nodeType===3){if(d=n+o.textContent.length,n<=s&&d>=s)return{node:o,offset:s-n};n=d}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Og(o)}}function $g(n,s){return n&&s?n===s?!0:n&&n.nodeType===3?!1:s&&s.nodeType===3?$g(n,s.parentNode):"contains"in n?n.contains(s):n.compareDocumentPosition?!!(n.compareDocumentPosition(s)&16):!1:!1}function Fg(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var s=va(n.document);s instanceof n.HTMLIFrameElement;){try{var o=typeof s.contentWindow.location.href=="string"}catch{o=!1}if(o)n=s.contentWindow;else break;s=va(n.document)}return s}function If(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s&&(s==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||s==="textarea"||n.contentEditable==="true")}var e_=ln&&"documentMode"in document&&11>=document.documentMode,$i=null,Lf=null,Gl=null,Of=!1;function Bg(n,s,o){var d=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Of||$i==null||$i!==va(d)||(d=$i,"selectionStart"in d&&If(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Gl&&Yl(Gl,d)||(Gl=d,d=Su(Lf,"onSelect"),0<d.length&&(s=new Rc("onSelect","select",null,s,o),n.push({event:s,listeners:d}),s.target=$i)))}function ri(n,s){var o={};return o[n.toLowerCase()]=s.toLowerCase(),o["Webkit"+n]="webkit"+s,o["Moz"+n]="moz"+s,o}var Fi={animationend:ri("Animation","AnimationEnd"),animationiteration:ri("Animation","AnimationIteration"),animationstart:ri("Animation","AnimationStart"),transitionrun:ri("Transition","TransitionRun"),transitionstart:ri("Transition","TransitionStart"),transitioncancel:ri("Transition","TransitionCancel"),transitionend:ri("Transition","TransitionEnd")},zf={},Ug={};ln&&(Ug=document.createElement("div").style,"AnimationEvent"in window||(delete Fi.animationend.animation,delete Fi.animationiteration.animation,delete Fi.animationstart.animation),"TransitionEvent"in window||delete Fi.transitionend.transition);function ii(n){if(zf[n])return zf[n];if(!Fi[n])return n;var s=Fi[n],o;for(o in s)if(s.hasOwnProperty(o)&&o in Ug)return zf[n]=s[o];return n}var qg=ii("animationend"),Hg=ii("animationiteration"),Pg=ii("animationstart"),t_=ii("transitionrun"),n_=ii("transitionstart"),a_=ii("transitioncancel"),Vg=ii("transitionend"),Yg=new Map,$f="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");$f.push("scrollEnd");function ds(n,s){Yg.set(n,s),K(s,[n])}var Ic=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)},Xa=[],Bi=0,Ff=0;function Lc(){for(var n=Bi,s=Ff=Bi=0;s<n;){var o=Xa[s];Xa[s++]=null;var d=Xa[s];Xa[s++]=null;var b=Xa[s];Xa[s++]=null;var x=Xa[s];if(Xa[s++]=null,d!==null&&b!==null){var F=d.pending;F===null?b.next=b:(b.next=F.next,F.next=b),d.pending=b}x!==0&&Gg(o,b,x)}}function Oc(n,s,o,d){Xa[Bi++]=n,Xa[Bi++]=s,Xa[Bi++]=o,Xa[Bi++]=d,Ff|=d,n.lanes|=d,n=n.alternate,n!==null&&(n.lanes|=d)}function Bf(n,s,o,d){return Oc(n,s,o,d),zc(n)}function li(n,s){return Oc(n,null,null,s),zc(n)}function Gg(n,s,o){n.lanes|=o;var d=n.alternate;d!==null&&(d.lanes|=o);for(var b=!1,x=n.return;x!==null;)x.childLanes|=o,d=x.alternate,d!==null&&(d.childLanes|=o),x.tag===22&&(n=x.stateNode,n===null||n._visibility&1||(b=!0)),n=x,x=x.return;return n.tag===3?(x=n.stateNode,b&&s!==null&&(b=31-Te(o),n=x.hiddenUpdates,d=n[b],d===null?n[b]=[s]:d.push(s),s.lane=o|536870912),x):null}function zc(n){if(50<yo)throw yo=0,Km=null,Error(i(185));for(var s=n.return;s!==null;)n=s,s=n.return;return n.tag===3?n.stateNode:null}var Ui={};function s_(n,s,o,d){this.tag=n,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oa(n,s,o,d){return new s_(n,s,o,d)}function Uf(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Bs(n,s){var o=n.alternate;return o===null?(o=Oa(n.tag,s,n.key,n.mode),o.elementType=n.elementType,o.type=n.type,o.stateNode=n.stateNode,o.alternate=n,n.alternate=o):(o.pendingProps=s,o.type=n.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=n.flags&65011712,o.childLanes=n.childLanes,o.lanes=n.lanes,o.child=n.child,o.memoizedProps=n.memoizedProps,o.memoizedState=n.memoizedState,o.updateQueue=n.updateQueue,s=n.dependencies,o.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},o.sibling=n.sibling,o.index=n.index,o.ref=n.ref,o.refCleanup=n.refCleanup,o}function Xg(n,s){n.flags&=65011714;var o=n.alternate;return o===null?(n.childLanes=0,n.lanes=s,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=o.childLanes,n.lanes=o.lanes,n.child=o.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=o.memoizedProps,n.memoizedState=o.memoizedState,n.updateQueue=o.updateQueue,n.type=o.type,s=o.dependencies,n.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),n}function $c(n,s,o,d,b,x){var F=0;if(d=n,typeof n=="function")Uf(n)&&(F=1);else if(typeof n=="string")F=cC(n,o,Q.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case P:return n=Oa(31,o,s,b),n.elementType=P,n.lanes=x,n;case N:return oi(o.children,b,x,s);case E:F=8,b|=24;break;case C:return n=Oa(12,o,s,b|2),n.elementType=C,n.lanes=x,n;case k:return n=Oa(13,o,s,b),n.elementType=k,n.lanes=x,n;case D:return n=Oa(19,o,s,b),n.elementType=D,n.lanes=x,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case O:F=10;break e;case A:F=9;break e;case _:F=11;break e;case j:F=14;break e;case z:F=16,d=null;break e}F=29,o=Error(i(130,n===null?"null":typeof n,"")),d=null}return s=Oa(F,o,s,b),s.elementType=n,s.type=d,s.lanes=x,s}function oi(n,s,o,d){return n=Oa(7,n,d,s),n.lanes=o,n}function qf(n,s,o){return n=Oa(6,n,null,s),n.lanes=o,n}function Kg(n){var s=Oa(18,null,null,0);return s.stateNode=n,s}function Hf(n,s,o){return s=Oa(4,n.children!==null?n.children:[],n.key,s),s.lanes=o,s.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},s}var Wg=new WeakMap;function Ka(n,s){if(typeof n=="object"&&n!==null){var o=Wg.get(n);return o!==void 0?o:(s={value:n,source:s,stack:$e(s)},Wg.set(n,s),s)}return{value:n,source:s,stack:$e(s)}}var qi=[],Hi=0,Fc=null,Xl=0,Wa=[],Za=0,pr=null,js=1,_s="";function Us(n,s){qi[Hi++]=Xl,qi[Hi++]=Fc,Fc=n,Xl=s}function Zg(n,s,o){Wa[Za++]=js,Wa[Za++]=_s,Wa[Za++]=pr,pr=n;var d=js;n=_s;var b=32-Te(d)-1;d&=~(1<<b),o+=1;var x=32-Te(s)+b;if(30<x){var F=b-b%5;x=(d&(1<<F)-1).toString(32),d>>=F,b-=F,js=1<<32-Te(s)+b|o<<b|d,_s=x+n}else js=1<<x|o<<b|d,_s=n}function Pf(n){n.return!==null&&(Us(n,1),Zg(n,1,0))}function Vf(n){for(;n===Fc;)Fc=qi[--Hi],qi[Hi]=null,Xl=qi[--Hi],qi[Hi]=null;for(;n===pr;)pr=Wa[--Za],Wa[Za]=null,_s=Wa[--Za],Wa[Za]=null,js=Wa[--Za],Wa[Za]=null}function Qg(n,s){Wa[Za++]=js,Wa[Za++]=_s,Wa[Za++]=pr,js=s.id,_s=s.overflow,pr=n}var ia=null,On=null,vn=!1,yr=null,Qa=!1,Yf=Error(i(519));function gr(n){var s=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Kl(Ka(s,n)),Yf}function Jg(n){var s=n.stateNode,o=n.type,d=n.memoizedProps;switch(s[pt]=n,s[Ee]=d,o){case"dialog":pn("cancel",s),pn("close",s);break;case"iframe":case"object":case"embed":pn("load",s);break;case"video":case"audio":for(o=0;o<bo.length;o++)pn(bo[o],s);break;case"source":pn("error",s);break;case"img":case"image":case"link":pn("error",s),pn("load",s);break;case"details":pn("toggle",s);break;case"input":pn("invalid",s),ni(s,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":pn("invalid",s);break;case"textarea":pn("invalid",s),ue(s,d.value,d.defaultValue,d.children)}o=d.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||s.textContent===""+o||d.suppressHydrationWarning===!0||yx(s.textContent,o)?(d.popover!=null&&(pn("beforetoggle",s),pn("toggle",s)),d.onScroll!=null&&pn("scroll",s),d.onScrollEnd!=null&&pn("scrollend",s),d.onClick!=null&&(s.onclick=ra),s=!0):s=!1,s||gr(n,!0)}function eb(n){for(ia=n.return;ia;)switch(ia.tag){case 5:case 31:case 13:Qa=!1;return;case 27:case 3:Qa=!0;return;default:ia=ia.return}}function Pi(n){if(n!==ia)return!1;if(!vn)return eb(n),vn=!0,!1;var s=n.tag,o;if((o=s!==3&&s!==27)&&((o=s===5)&&(o=n.type,o=!(o!=="form"&&o!=="button")||uh(n.type,n.memoizedProps)),o=!o),o&&On&&gr(n),eb(n),s===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));On=jx(n)}else if(s===31){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));On=jx(n)}else s===27?(s=On,Rr(n.type)?(n=ph,ph=null,On=n):On=s):On=ia?es(n.stateNode.nextSibling):null;return!0}function ci(){On=ia=null,vn=!1}function Gf(){var n=yr;return n!==null&&(Ca===null?Ca=n:Ca.push.apply(Ca,n),yr=null),n}function Kl(n){yr===null?yr=[n]:yr.push(n)}var Xf=T(null),ui=null,qs=null;function br(n,s,o){Y(Xf,s._currentValue),s._currentValue=o}function Hs(n){n._currentValue=Xf.current,q(Xf)}function Kf(n,s,o){for(;n!==null;){var d=n.alternate;if((n.childLanes&s)!==s?(n.childLanes|=s,d!==null&&(d.childLanes|=s)):d!==null&&(d.childLanes&s)!==s&&(d.childLanes|=s),n===o)break;n=n.return}}function Wf(n,s,o,d){var b=n.child;for(b!==null&&(b.return=n);b!==null;){var x=b.dependencies;if(x!==null){var F=b.child;x=x.firstContext;e:for(;x!==null;){var W=x;x=b;for(var he=0;he<s.length;he++)if(W.context===s[he]){x.lanes|=o,W=x.alternate,W!==null&&(W.lanes|=o),Kf(x.return,o,n),d||(F=null);break e}x=W.next}}else if(b.tag===18){if(F=b.return,F===null)throw Error(i(341));F.lanes|=o,x=F.alternate,x!==null&&(x.lanes|=o),Kf(F,o,n),F=null}else F=b.child;if(F!==null)F.return=b;else for(F=b;F!==null;){if(F===n){F=null;break}if(b=F.sibling,b!==null){b.return=F.return,F=b;break}F=F.return}b=F}}function Vi(n,s,o,d){n=null;for(var b=s,x=!1;b!==null;){if(!x){if((b.flags&524288)!==0)x=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var F=b.alternate;if(F===null)throw Error(i(387));if(F=F.memoizedProps,F!==null){var W=b.type;La(b.pendingProps.value,F.value)||(n!==null?n.push(W):n=[W])}}else if(b===de.current){if(F=b.alternate,F===null)throw Error(i(387));F.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(n!==null?n.push(No):n=[No])}b=b.return}n!==null&&Wf(s,n,o,d),s.flags|=262144}function Bc(n){for(n=n.firstContext;n!==null;){if(!La(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function di(n){ui=n,qs=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function la(n){return tb(ui,n)}function Uc(n,s){return ui===null&&di(n),tb(n,s)}function tb(n,s){var o=s._currentValue;if(s={context:s,memoizedValue:o,next:null},qs===null){if(n===null)throw Error(i(308));qs=s,n.dependencies={lanes:0,firstContext:s},n.flags|=524288}else qs=qs.next=s;return o}var r_=typeof AbortController<"u"?AbortController:function(){var n=[],s=this.signal={aborted:!1,addEventListener:function(o,d){n.push(d)}};this.abort=function(){s.aborted=!0,n.forEach(function(o){return o()})}},i_=e.unstable_scheduleCallback,l_=e.unstable_NormalPriority,Kn={$$typeof:O,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Zf(){return{controller:new r_,data:new Map,refCount:0}}function Wl(n){n.refCount--,n.refCount===0&&i_(l_,function(){n.controller.abort()})}var Zl=null,Qf=0,Yi=0,Gi=null;function o_(n,s){if(Zl===null){var o=Zl=[];Qf=0,Yi=th(),Gi={status:"pending",value:void 0,then:function(d){o.push(d)}}}return Qf++,s.then(nb,nb),s}function nb(){if(--Qf===0&&Zl!==null){Gi!==null&&(Gi.status="fulfilled");var n=Zl;Zl=null,Yi=0,Gi=null;for(var s=0;s<n.length;s++)(0,n[s])()}}function c_(n,s){var o=[],d={status:"pending",value:null,reason:null,then:function(b){o.push(b)}};return n.then(function(){d.status="fulfilled",d.value=s;for(var b=0;b<o.length;b++)(0,o[b])(s)},function(b){for(d.status="rejected",d.reason=b,b=0;b<o.length;b++)(0,o[b])(void 0)}),d}var ab=I.S;I.S=function(n,s){Bv=at(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&o_(n,s),ab!==null&&ab(n,s)};var fi=T(null);function Jf(){var n=fi.current;return n!==null?n:Dn.pooledCache}function qc(n,s){s===null?Y(fi,fi.current):Y(fi,s.pool)}function sb(){var n=Jf();return n===null?null:{parent:Kn._currentValue,pool:n}}var Xi=Error(i(460)),em=Error(i(474)),Hc=Error(i(542)),Pc={then:function(){}};function rb(n){return n=n.status,n==="fulfilled"||n==="rejected"}function ib(n,s,o){switch(o=n[o],o===void 0?n.push(s):o!==s&&(s.then(ra,ra),s=o),s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,ob(n),n;default:if(typeof s.status=="string")s.then(ra,ra);else{if(n=Dn,n!==null&&100<n.shellSuspendCounter)throw Error(i(482));n=s,n.status="pending",n.then(function(d){if(s.status==="pending"){var b=s;b.status="fulfilled",b.value=d}},function(d){if(s.status==="pending"){var b=s;b.status="rejected",b.reason=d}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,ob(n),n}throw hi=s,Xi}}function mi(n){try{var s=n._init;return s(n._payload)}catch(o){throw o!==null&&typeof o=="object"&&typeof o.then=="function"?(hi=o,Xi):o}}var hi=null;function lb(){if(hi===null)throw Error(i(459));var n=hi;return hi=null,n}function ob(n){if(n===Xi||n===Hc)throw Error(i(483))}var Ki=null,Ql=0;function Vc(n){var s=Ql;return Ql+=1,Ki===null&&(Ki=[]),ib(Ki,n,s)}function Jl(n,s){s=s.props.ref,n.ref=s!==void 0?s:null}function Yc(n,s){throw s.$$typeof===v?Error(i(525)):(n=Object.prototype.toString.call(s),Error(i(31,n==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":n)))}function cb(n){function s(Ce,xe){if(n){var Ie=Ce.deletions;Ie===null?(Ce.deletions=[xe],Ce.flags|=16):Ie.push(xe)}}function o(Ce,xe){if(!n)return null;for(;xe!==null;)s(Ce,xe),xe=xe.sibling;return null}function d(Ce){for(var xe=new Map;Ce!==null;)Ce.key!==null?xe.set(Ce.key,Ce):xe.set(Ce.index,Ce),Ce=Ce.sibling;return xe}function b(Ce,xe){return Ce=Bs(Ce,xe),Ce.index=0,Ce.sibling=null,Ce}function x(Ce,xe,Ie){return Ce.index=Ie,n?(Ie=Ce.alternate,Ie!==null?(Ie=Ie.index,Ie<xe?(Ce.flags|=67108866,xe):Ie):(Ce.flags|=67108866,xe)):(Ce.flags|=1048576,xe)}function F(Ce){return n&&Ce.alternate===null&&(Ce.flags|=67108866),Ce}function W(Ce,xe,Ie,rt){return xe===null||xe.tag!==6?(xe=qf(Ie,Ce.mode,rt),xe.return=Ce,xe):(xe=b(xe,Ie),xe.return=Ce,xe)}function he(Ce,xe,Ie,rt){var Yt=Ie.type;return Yt===N?tt(Ce,xe,Ie.props.children,rt,Ie.key):xe!==null&&(xe.elementType===Yt||typeof Yt=="object"&&Yt!==null&&Yt.$$typeof===z&&mi(Yt)===xe.type)?(xe=b(xe,Ie.props),Jl(xe,Ie),xe.return=Ce,xe):(xe=$c(Ie.type,Ie.key,Ie.props,null,Ce.mode,rt),Jl(xe,Ie),xe.return=Ce,xe)}function Oe(Ce,xe,Ie,rt){return xe===null||xe.tag!==4||xe.stateNode.containerInfo!==Ie.containerInfo||xe.stateNode.implementation!==Ie.implementation?(xe=Hf(Ie,Ce.mode,rt),xe.return=Ce,xe):(xe=b(xe,Ie.children||[]),xe.return=Ce,xe)}function tt(Ce,xe,Ie,rt,Yt){return xe===null||xe.tag!==7?(xe=oi(Ie,Ce.mode,rt,Yt),xe.return=Ce,xe):(xe=b(xe,Ie),xe.return=Ce,xe)}function lt(Ce,xe,Ie){if(typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint")return xe=qf(""+xe,Ce.mode,Ie),xe.return=Ce,xe;if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case S:return Ie=$c(xe.type,xe.key,xe.props,null,Ce.mode,Ie),Jl(Ie,xe),Ie.return=Ce,Ie;case w:return xe=Hf(xe,Ce.mode,Ie),xe.return=Ce,xe;case z:return xe=mi(xe),lt(Ce,xe,Ie)}if(B(xe)||X(xe))return xe=oi(xe,Ce.mode,Ie,null),xe.return=Ce,xe;if(typeof xe.then=="function")return lt(Ce,Vc(xe),Ie);if(xe.$$typeof===O)return lt(Ce,Uc(Ce,xe),Ie);Yc(Ce,xe)}return null}function Fe(Ce,xe,Ie,rt){var Yt=xe!==null?xe.key:null;if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint")return Yt!==null?null:W(Ce,xe,""+Ie,rt);if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case S:return Ie.key===Yt?he(Ce,xe,Ie,rt):null;case w:return Ie.key===Yt?Oe(Ce,xe,Ie,rt):null;case z:return Ie=mi(Ie),Fe(Ce,xe,Ie,rt)}if(B(Ie)||X(Ie))return Yt!==null?null:tt(Ce,xe,Ie,rt,null);if(typeof Ie.then=="function")return Fe(Ce,xe,Vc(Ie),rt);if(Ie.$$typeof===O)return Fe(Ce,xe,Uc(Ce,Ie),rt);Yc(Ce,Ie)}return null}function Ye(Ce,xe,Ie,rt,Yt){if(typeof rt=="string"&&rt!==""||typeof rt=="number"||typeof rt=="bigint")return Ce=Ce.get(Ie)||null,W(xe,Ce,""+rt,Yt);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case S:return Ce=Ce.get(rt.key===null?Ie:rt.key)||null,he(xe,Ce,rt,Yt);case w:return Ce=Ce.get(rt.key===null?Ie:rt.key)||null,Oe(xe,Ce,rt,Yt);case z:return rt=mi(rt),Ye(Ce,xe,Ie,rt,Yt)}if(B(rt)||X(rt))return Ce=Ce.get(Ie)||null,tt(xe,Ce,rt,Yt,null);if(typeof rt.then=="function")return Ye(Ce,xe,Ie,Vc(rt),Yt);if(rt.$$typeof===O)return Ye(Ce,xe,Ie,Uc(xe,rt),Yt);Yc(xe,rt)}return null}function zt(Ce,xe,Ie,rt){for(var Yt=null,xn=null,Bt=xe,sn=xe=0,bn=null;Bt!==null&&sn<Ie.length;sn++){Bt.index>sn?(bn=Bt,Bt=null):bn=Bt.sibling;var Sn=Fe(Ce,Bt,Ie[sn],rt);if(Sn===null){Bt===null&&(Bt=bn);break}n&&Bt&&Sn.alternate===null&&s(Ce,Bt),xe=x(Sn,xe,sn),xn===null?Yt=Sn:xn.sibling=Sn,xn=Sn,Bt=bn}if(sn===Ie.length)return o(Ce,Bt),vn&&Us(Ce,sn),Yt;if(Bt===null){for(;sn<Ie.length;sn++)Bt=lt(Ce,Ie[sn],rt),Bt!==null&&(xe=x(Bt,xe,sn),xn===null?Yt=Bt:xn.sibling=Bt,xn=Bt);return vn&&Us(Ce,sn),Yt}for(Bt=d(Bt);sn<Ie.length;sn++)bn=Ye(Bt,Ce,sn,Ie[sn],rt),bn!==null&&(n&&bn.alternate!==null&&Bt.delete(bn.key===null?sn:bn.key),xe=x(bn,xe,sn),xn===null?Yt=bn:xn.sibling=bn,xn=bn);return n&&Bt.forEach(function(Or){return s(Ce,Or)}),vn&&Us(Ce,sn),Yt}function Wt(Ce,xe,Ie,rt){if(Ie==null)throw Error(i(151));for(var Yt=null,xn=null,Bt=xe,sn=xe=0,bn=null,Sn=Ie.next();Bt!==null&&!Sn.done;sn++,Sn=Ie.next()){Bt.index>sn?(bn=Bt,Bt=null):bn=Bt.sibling;var Or=Fe(Ce,Bt,Sn.value,rt);if(Or===null){Bt===null&&(Bt=bn);break}n&&Bt&&Or.alternate===null&&s(Ce,Bt),xe=x(Or,xe,sn),xn===null?Yt=Or:xn.sibling=Or,xn=Or,Bt=bn}if(Sn.done)return o(Ce,Bt),vn&&Us(Ce,sn),Yt;if(Bt===null){for(;!Sn.done;sn++,Sn=Ie.next())Sn=lt(Ce,Sn.value,rt),Sn!==null&&(xe=x(Sn,xe,sn),xn===null?Yt=Sn:xn.sibling=Sn,xn=Sn);return vn&&Us(Ce,sn),Yt}for(Bt=d(Bt);!Sn.done;sn++,Sn=Ie.next())Sn=Ye(Bt,Ce,sn,Sn.value,rt),Sn!==null&&(n&&Sn.alternate!==null&&Bt.delete(Sn.key===null?sn:Sn.key),xe=x(Sn,xe,sn),xn===null?Yt=Sn:xn.sibling=Sn,xn=Sn);return n&&Bt.forEach(function(xC){return s(Ce,xC)}),vn&&Us(Ce,sn),Yt}function kn(Ce,xe,Ie,rt){if(typeof Ie=="object"&&Ie!==null&&Ie.type===N&&Ie.key===null&&(Ie=Ie.props.children),typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case S:e:{for(var Yt=Ie.key;xe!==null;){if(xe.key===Yt){if(Yt=Ie.type,Yt===N){if(xe.tag===7){o(Ce,xe.sibling),rt=b(xe,Ie.props.children),rt.return=Ce,Ce=rt;break e}}else if(xe.elementType===Yt||typeof Yt=="object"&&Yt!==null&&Yt.$$typeof===z&&mi(Yt)===xe.type){o(Ce,xe.sibling),rt=b(xe,Ie.props),Jl(rt,Ie),rt.return=Ce,Ce=rt;break e}o(Ce,xe);break}else s(Ce,xe);xe=xe.sibling}Ie.type===N?(rt=oi(Ie.props.children,Ce.mode,rt,Ie.key),rt.return=Ce,Ce=rt):(rt=$c(Ie.type,Ie.key,Ie.props,null,Ce.mode,rt),Jl(rt,Ie),rt.return=Ce,Ce=rt)}return F(Ce);case w:e:{for(Yt=Ie.key;xe!==null;){if(xe.key===Yt)if(xe.tag===4&&xe.stateNode.containerInfo===Ie.containerInfo&&xe.stateNode.implementation===Ie.implementation){o(Ce,xe.sibling),rt=b(xe,Ie.children||[]),rt.return=Ce,Ce=rt;break e}else{o(Ce,xe);break}else s(Ce,xe);xe=xe.sibling}rt=Hf(Ie,Ce.mode,rt),rt.return=Ce,Ce=rt}return F(Ce);case z:return Ie=mi(Ie),kn(Ce,xe,Ie,rt)}if(B(Ie))return zt(Ce,xe,Ie,rt);if(X(Ie)){if(Yt=X(Ie),typeof Yt!="function")throw Error(i(150));return Ie=Yt.call(Ie),Wt(Ce,xe,Ie,rt)}if(typeof Ie.then=="function")return kn(Ce,xe,Vc(Ie),rt);if(Ie.$$typeof===O)return kn(Ce,xe,Uc(Ce,Ie),rt);Yc(Ce,Ie)}return typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint"?(Ie=""+Ie,xe!==null&&xe.tag===6?(o(Ce,xe.sibling),rt=b(xe,Ie),rt.return=Ce,Ce=rt):(o(Ce,xe),rt=qf(Ie,Ce.mode,rt),rt.return=Ce,Ce=rt),F(Ce)):o(Ce,xe)}return function(Ce,xe,Ie,rt){try{Ql=0;var Yt=kn(Ce,xe,Ie,rt);return Ki=null,Yt}catch(Bt){if(Bt===Xi||Bt===Hc)throw Bt;var xn=Oa(29,Bt,null,Ce.mode);return xn.lanes=rt,xn.return=Ce,xn}finally{}}}var pi=cb(!0),ub=cb(!1),vr=!1;function tm(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function nm(n,s){n=n.updateQueue,s.updateQueue===n&&(s.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function xr(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function Sr(n,s,o){var d=n.updateQueue;if(d===null)return null;if(d=d.shared,(jn&2)!==0){var b=d.pending;return b===null?s.next=s:(s.next=b.next,b.next=s),d.pending=s,s=zc(n),Gg(n,null,o),s}return Oc(n,d,s,o),zc(n)}function eo(n,s,o){if(s=s.updateQueue,s!==null&&(s=s.shared,(o&4194048)!==0)){var d=s.lanes;d&=n.pendingLanes,o|=d,s.lanes=o,Ue(n,o)}}function am(n,s){var o=n.updateQueue,d=n.alternate;if(d!==null&&(d=d.updateQueue,o===d)){var b=null,x=null;if(o=o.firstBaseUpdate,o!==null){do{var F={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};x===null?b=x=F:x=x.next=F,o=o.next}while(o!==null);x===null?b=x=s:x=x.next=s}else b=x=s;o={baseState:d.baseState,firstBaseUpdate:b,lastBaseUpdate:x,shared:d.shared,callbacks:d.callbacks},n.updateQueue=o;return}n=o.lastBaseUpdate,n===null?o.firstBaseUpdate=s:n.next=s,o.lastBaseUpdate=s}var sm=!1;function to(){if(sm){var n=Gi;if(n!==null)throw n}}function no(n,s,o,d){sm=!1;var b=n.updateQueue;vr=!1;var x=b.firstBaseUpdate,F=b.lastBaseUpdate,W=b.shared.pending;if(W!==null){b.shared.pending=null;var he=W,Oe=he.next;he.next=null,F===null?x=Oe:F.next=Oe,F=he;var tt=n.alternate;tt!==null&&(tt=tt.updateQueue,W=tt.lastBaseUpdate,W!==F&&(W===null?tt.firstBaseUpdate=Oe:W.next=Oe,tt.lastBaseUpdate=he))}if(x!==null){var lt=b.baseState;F=0,tt=Oe=he=null,W=x;do{var Fe=W.lane&-536870913,Ye=Fe!==W.lane;if(Ye?(gn&Fe)===Fe:(d&Fe)===Fe){Fe!==0&&Fe===Yi&&(sm=!0),tt!==null&&(tt=tt.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var zt=n,Wt=W;Fe=s;var kn=o;switch(Wt.tag){case 1:if(zt=Wt.payload,typeof zt=="function"){lt=zt.call(kn,lt,Fe);break e}lt=zt;break e;case 3:zt.flags=zt.flags&-65537|128;case 0:if(zt=Wt.payload,Fe=typeof zt=="function"?zt.call(kn,lt,Fe):zt,Fe==null)break e;lt=g({},lt,Fe);break e;case 2:vr=!0}}Fe=W.callback,Fe!==null&&(n.flags|=64,Ye&&(n.flags|=8192),Ye=b.callbacks,Ye===null?b.callbacks=[Fe]:Ye.push(Fe))}else Ye={lane:Fe,tag:W.tag,payload:W.payload,callback:W.callback,next:null},tt===null?(Oe=tt=Ye,he=lt):tt=tt.next=Ye,F|=Fe;if(W=W.next,W===null){if(W=b.shared.pending,W===null)break;Ye=W,W=Ye.next,Ye.next=null,b.lastBaseUpdate=Ye,b.shared.pending=null}}while(!0);tt===null&&(he=lt),b.baseState=he,b.firstBaseUpdate=Oe,b.lastBaseUpdate=tt,x===null&&(b.shared.lanes=0),_r|=F,n.lanes=F,n.memoizedState=lt}}function db(n,s){if(typeof n!="function")throw Error(i(191,n));n.call(s)}function fb(n,s){var o=n.callbacks;if(o!==null)for(n.callbacks=null,n=0;n<o.length;n++)db(o[n],s)}var Wi=T(null),Gc=T(0);function mb(n,s){n=Qs,Y(Gc,n),Y(Wi,s),Qs=n|s.baseLanes}function rm(){Y(Gc,Qs),Y(Wi,Wi.current)}function im(){Qs=Gc.current,q(Wi),q(Gc)}var za=T(null),Ja=null;function wr(n){var s=n.alternate;Y(Gn,Gn.current&1),Y(za,n),Ja===null&&(s===null||Wi.current!==null||s.memoizedState!==null)&&(Ja=n)}function lm(n){Y(Gn,Gn.current),Y(za,n),Ja===null&&(Ja=n)}function hb(n){n.tag===22?(Y(Gn,Gn.current),Y(za,n),Ja===null&&(Ja=n)):Nr()}function Nr(){Y(Gn,Gn.current),Y(za,za.current)}function $a(n){q(za),Ja===n&&(Ja=null),q(Gn)}var Gn=T(0);function Xc(n){for(var s=n;s!==null;){if(s.tag===13){var o=s.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||mh(o)||hh(o)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Ps=0,an=null,Mn=null,Wn=null,Kc=!1,Zi=!1,yi=!1,Wc=0,ao=0,Qi=null,u_=0;function qn(){throw Error(i(321))}function om(n,s){if(s===null)return!1;for(var o=0;o<s.length&&o<n.length;o++)if(!La(n[o],s[o]))return!1;return!0}function cm(n,s,o,d,b,x){return Ps=x,an=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,I.H=n===null||n.memoizedState===null?Zb:Em,yi=!1,x=o(d,b),yi=!1,Zi&&(x=yb(s,o,d,b)),pb(n),x}function pb(n){I.H=io;var s=Mn!==null&&Mn.next!==null;if(Ps=0,Wn=Mn=an=null,Kc=!1,ao=0,Qi=null,s)throw Error(i(300));n===null||Zn||(n=n.dependencies,n!==null&&Bc(n)&&(Zn=!0))}function yb(n,s,o,d){an=n;var b=0;do{if(Zi&&(Qi=null),ao=0,Zi=!1,25<=b)throw Error(i(301));if(b+=1,Wn=Mn=null,n.updateQueue!=null){var x=n.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}I.H=Qb,x=s(o,d)}while(Zi);return x}function d_(){var n=I.H,s=n.useState()[0];return s=typeof s.then=="function"?so(s):s,n=n.useState()[0],(Mn!==null?Mn.memoizedState:null)!==n&&(an.flags|=1024),s}function um(){var n=Wc!==0;return Wc=0,n}function dm(n,s,o){s.updateQueue=n.updateQueue,s.flags&=-2053,n.lanes&=~o}function fm(n){if(Kc){for(n=n.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}Kc=!1}Ps=0,Wn=Mn=an=null,Zi=!1,ao=Wc=0,Qi=null}function xa(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Wn===null?an.memoizedState=Wn=n:Wn=Wn.next=n,Wn}function Xn(){if(Mn===null){var n=an.alternate;n=n!==null?n.memoizedState:null}else n=Mn.next;var s=Wn===null?an.memoizedState:Wn.next;if(s!==null)Wn=s,Mn=n;else{if(n===null)throw an.alternate===null?Error(i(467)):Error(i(310));Mn=n,n={memoizedState:Mn.memoizedState,baseState:Mn.baseState,baseQueue:Mn.baseQueue,queue:Mn.queue,next:null},Wn===null?an.memoizedState=Wn=n:Wn=Wn.next=n}return Wn}function Zc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function so(n){var s=ao;return ao+=1,Qi===null&&(Qi=[]),n=ib(Qi,n,s),s=an,(Wn===null?s.memoizedState:Wn.next)===null&&(s=s.alternate,I.H=s===null||s.memoizedState===null?Zb:Em),n}function Qc(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return so(n);if(n.$$typeof===O)return la(n)}throw Error(i(438,String(n)))}function mm(n){var s=null,o=an.updateQueue;if(o!==null&&(s=o.memoCache),s==null){var d=an.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(s={data:d.data.map(function(b){return b.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),o===null&&(o=Zc(),an.updateQueue=o),o.memoCache=s,o=s.data[s.index],o===void 0)for(o=s.data[s.index]=Array(n),d=0;d<n;d++)o[d]=G;return s.index++,o}function Vs(n,s){return typeof s=="function"?s(n):s}function Jc(n){var s=Xn();return hm(s,Mn,n)}function hm(n,s,o){var d=n.queue;if(d===null)throw Error(i(311));d.lastRenderedReducer=o;var b=n.baseQueue,x=d.pending;if(x!==null){if(b!==null){var F=b.next;b.next=x.next,x.next=F}s.baseQueue=b=x,d.pending=null}if(x=n.baseState,b===null)n.memoizedState=x;else{s=b.next;var W=F=null,he=null,Oe=s,tt=!1;do{var lt=Oe.lane&-536870913;if(lt!==Oe.lane?(gn&lt)===lt:(Ps&lt)===lt){var Fe=Oe.revertLane;if(Fe===0)he!==null&&(he=he.next={lane:0,revertLane:0,gesture:null,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null}),lt===Yi&&(tt=!0);else if((Ps&Fe)===Fe){Oe=Oe.next,Fe===Yi&&(tt=!0);continue}else lt={lane:0,revertLane:Oe.revertLane,gesture:null,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null},he===null?(W=he=lt,F=x):he=he.next=lt,an.lanes|=Fe,_r|=Fe;lt=Oe.action,yi&&o(x,lt),x=Oe.hasEagerState?Oe.eagerState:o(x,lt)}else Fe={lane:lt,revertLane:Oe.revertLane,gesture:Oe.gesture,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null},he===null?(W=he=Fe,F=x):he=he.next=Fe,an.lanes|=lt,_r|=lt;Oe=Oe.next}while(Oe!==null&&Oe!==s);if(he===null?F=x:he.next=W,!La(x,n.memoizedState)&&(Zn=!0,tt&&(o=Gi,o!==null)))throw o;n.memoizedState=x,n.baseState=F,n.baseQueue=he,d.lastRenderedState=x}return b===null&&(d.lanes=0),[n.memoizedState,d.dispatch]}function pm(n){var s=Xn(),o=s.queue;if(o===null)throw Error(i(311));o.lastRenderedReducer=n;var d=o.dispatch,b=o.pending,x=s.memoizedState;if(b!==null){o.pending=null;var F=b=b.next;do x=n(x,F.action),F=F.next;while(F!==b);La(x,s.memoizedState)||(Zn=!0),s.memoizedState=x,s.baseQueue===null&&(s.baseState=x),o.lastRenderedState=x}return[x,d]}function gb(n,s,o){var d=an,b=Xn(),x=vn;if(x){if(o===void 0)throw Error(i(407));o=o()}else o=s();var F=!La((Mn||b).memoizedState,o);if(F&&(b.memoizedState=o,Zn=!0),b=b.queue,bm(xb.bind(null,d,b,n),[n]),b.getSnapshot!==s||F||Wn!==null&&Wn.memoizedState.tag&1){if(d.flags|=2048,Ji(9,{destroy:void 0},vb.bind(null,d,b,o,s),null),Dn===null)throw Error(i(349));x||(Ps&127)!==0||bb(d,s,o)}return o}function bb(n,s,o){n.flags|=16384,n={getSnapshot:s,value:o},s=an.updateQueue,s===null?(s=Zc(),an.updateQueue=s,s.stores=[n]):(o=s.stores,o===null?s.stores=[n]:o.push(n))}function vb(n,s,o,d){s.value=o,s.getSnapshot=d,Sb(s)&&wb(n)}function xb(n,s,o){return o(function(){Sb(s)&&wb(n)})}function Sb(n){var s=n.getSnapshot;n=n.value;try{var o=s();return!La(n,o)}catch{return!0}}function wb(n){var s=li(n,2);s!==null&&Aa(s,n,2)}function ym(n){var s=xa();if(typeof n=="function"){var o=n;if(n=o(),yi){et(!0);try{o()}finally{et(!1)}}}return s.memoizedState=s.baseState=n,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vs,lastRenderedState:n},s}function Nb(n,s,o,d){return n.baseState=o,hm(n,Mn,typeof d=="function"?d:Vs)}function f_(n,s,o,d,b){if(nu(n))throw Error(i(485));if(n=s.action,n!==null){var x={payload:b,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(F){x.listeners.push(F)}};I.T!==null?o(!0):x.isTransition=!1,d(x),o=s.pending,o===null?(x.next=s.pending=x,Eb(s,x)):(x.next=o.next,s.pending=o.next=x)}}function Eb(n,s){var o=s.action,d=s.payload,b=n.state;if(s.isTransition){var x=I.T,F={};I.T=F;try{var W=o(b,d),he=I.S;he!==null&&he(F,W),jb(n,s,W)}catch(Oe){gm(n,s,Oe)}finally{x!==null&&F.types!==null&&(x.types=F.types),I.T=x}}else try{x=o(b,d),jb(n,s,x)}catch(Oe){gm(n,s,Oe)}}function jb(n,s,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(d){_b(n,s,d)},function(d){return gm(n,s,d)}):_b(n,s,o)}function _b(n,s,o){s.status="fulfilled",s.value=o,Cb(s),n.state=o,s=n.pending,s!==null&&(o=s.next,o===s?n.pending=null:(o=o.next,s.next=o,Eb(n,o)))}function gm(n,s,o){var d=n.pending;if(n.pending=null,d!==null){d=d.next;do s.status="rejected",s.reason=o,Cb(s),s=s.next;while(s!==d)}n.action=null}function Cb(n){n=n.listeners;for(var s=0;s<n.length;s++)(0,n[s])()}function Ab(n,s){return s}function Tb(n,s){if(vn){var o=Dn.formState;if(o!==null){e:{var d=an;if(vn){if(On){t:{for(var b=On,x=Qa;b.nodeType!==8;){if(!x){b=null;break t}if(b=es(b.nextSibling),b===null){b=null;break t}}x=b.data,b=x==="F!"||x==="F"?b:null}if(b){On=es(b.nextSibling),d=b.data==="F!";break e}}gr(d)}d=!1}d&&(s=o[0])}}return o=xa(),o.memoizedState=o.baseState=s,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ab,lastRenderedState:s},o.queue=d,o=Xb.bind(null,an,d),d.dispatch=o,d=ym(!1),x=Nm.bind(null,an,!1,d.queue),d=xa(),b={state:s,dispatch:null,action:n,pending:null},d.queue=b,o=f_.bind(null,an,b,x,o),b.dispatch=o,d.memoizedState=n,[s,o,!1]}function Mb(n){var s=Xn();return Rb(s,Mn,n)}function Rb(n,s,o){if(s=hm(n,s,Ab)[0],n=Jc(Vs)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var d=so(s)}catch(F){throw F===Xi?Hc:F}else d=s;s=Xn();var b=s.queue,x=b.dispatch;return o!==s.memoizedState&&(an.flags|=2048,Ji(9,{destroy:void 0},m_.bind(null,b,o),null)),[d,x,n]}function m_(n,s){n.action=s}function kb(n){var s=Xn(),o=Mn;if(o!==null)return Rb(s,o,n);Xn(),s=s.memoizedState,o=Xn();var d=o.queue.dispatch;return o.memoizedState=n,[s,d,!1]}function Ji(n,s,o,d){return n={tag:n,create:o,deps:d,inst:s,next:null},s=an.updateQueue,s===null&&(s=Zc(),an.updateQueue=s),o=s.lastEffect,o===null?s.lastEffect=n.next=n:(d=o.next,o.next=n,n.next=d,s.lastEffect=n),n}function Db(){return Xn().memoizedState}function eu(n,s,o,d){var b=xa();an.flags|=n,b.memoizedState=Ji(1|s,{destroy:void 0},o,d===void 0?null:d)}function tu(n,s,o,d){var b=Xn();d=d===void 0?null:d;var x=b.memoizedState.inst;Mn!==null&&d!==null&&om(d,Mn.memoizedState.deps)?b.memoizedState=Ji(s,x,o,d):(an.flags|=n,b.memoizedState=Ji(1|s,x,o,d))}function Ib(n,s){eu(8390656,8,n,s)}function bm(n,s){tu(2048,8,n,s)}function h_(n){an.flags|=4;var s=an.updateQueue;if(s===null)s=Zc(),an.updateQueue=s,s.events=[n];else{var o=s.events;o===null?s.events=[n]:o.push(n)}}function Lb(n){var s=Xn().memoizedState;return h_({ref:s,nextImpl:n}),function(){if((jn&2)!==0)throw Error(i(440));return s.impl.apply(void 0,arguments)}}function Ob(n,s){return tu(4,2,n,s)}function zb(n,s){return tu(4,4,n,s)}function $b(n,s){if(typeof s=="function"){n=n();var o=s(n);return function(){typeof o=="function"?o():s(null)}}if(s!=null)return n=n(),s.current=n,function(){s.current=null}}function Fb(n,s,o){o=o!=null?o.concat([n]):null,tu(4,4,$b.bind(null,s,n),o)}function vm(){}function Bb(n,s){var o=Xn();s=s===void 0?null:s;var d=o.memoizedState;return s!==null&&om(s,d[1])?d[0]:(o.memoizedState=[n,s],n)}function Ub(n,s){var o=Xn();s=s===void 0?null:s;var d=o.memoizedState;if(s!==null&&om(s,d[1]))return d[0];if(d=n(),yi){et(!0);try{n()}finally{et(!1)}}return o.memoizedState=[d,s],d}function xm(n,s,o){return o===void 0||(Ps&1073741824)!==0&&(gn&261930)===0?n.memoizedState=s:(n.memoizedState=o,n=qv(),an.lanes|=n,_r|=n,o)}function qb(n,s,o,d){return La(o,s)?o:Wi.current!==null?(n=xm(n,o,d),La(n,s)||(Zn=!0),n):(Ps&42)===0||(Ps&1073741824)!==0&&(gn&261930)===0?(Zn=!0,n.memoizedState=o):(n=qv(),an.lanes|=n,_r|=n,s)}function Hb(n,s,o,d,b){var x=L.p;L.p=x!==0&&8>x?x:8;var F=I.T,W={};I.T=W,Nm(n,!1,s,o);try{var he=b(),Oe=I.S;if(Oe!==null&&Oe(W,he),he!==null&&typeof he=="object"&&typeof he.then=="function"){var tt=c_(he,d);ro(n,s,tt,Ua(n))}else ro(n,s,d,Ua(n))}catch(lt){ro(n,s,{then:function(){},status:"rejected",reason:lt},Ua())}finally{L.p=x,F!==null&&W.types!==null&&(F.types=W.types),I.T=F}}function p_(){}function Sm(n,s,o,d){if(n.tag!==5)throw Error(i(476));var b=Pb(n).queue;Hb(n,b,s,$,o===null?p_:function(){return Vb(n),o(d)})}function Pb(n){var s=n.memoizedState;if(s!==null)return s;s={memoizedState:$,baseState:$,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vs,lastRenderedState:$},next:null};var o={};return s.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vs,lastRenderedState:o},next:null},n.memoizedState=s,n=n.alternate,n!==null&&(n.memoizedState=s),s}function Vb(n){var s=Pb(n);s.next===null&&(s=n.alternate.memoizedState),ro(n,s.next.queue,{},Ua())}function wm(){return la(No)}function Yb(){return Xn().memoizedState}function Gb(){return Xn().memoizedState}function y_(n){for(var s=n.return;s!==null;){switch(s.tag){case 24:case 3:var o=Ua();n=xr(o);var d=Sr(s,n,o);d!==null&&(Aa(d,s,o),eo(d,s,o)),s={cache:Zf()},n.payload=s;return}s=s.return}}function g_(n,s,o){var d=Ua();o={lane:d,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},nu(n)?Kb(s,o):(o=Bf(n,s,o,d),o!==null&&(Aa(o,n,d),Wb(o,s,d)))}function Xb(n,s,o){var d=Ua();ro(n,s,o,d)}function ro(n,s,o,d){var b={lane:d,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null};if(nu(n))Kb(s,b);else{var x=n.alternate;if(n.lanes===0&&(x===null||x.lanes===0)&&(x=s.lastRenderedReducer,x!==null))try{var F=s.lastRenderedState,W=x(F,o);if(b.hasEagerState=!0,b.eagerState=W,La(W,F))return Oc(n,s,b,0),Dn===null&&Lc(),!1}catch{}finally{}if(o=Bf(n,s,b,d),o!==null)return Aa(o,n,d),Wb(o,s,d),!0}return!1}function Nm(n,s,o,d){if(d={lane:2,revertLane:th(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},nu(n)){if(s)throw Error(i(479))}else s=Bf(n,o,d,2),s!==null&&Aa(s,n,2)}function nu(n){var s=n.alternate;return n===an||s!==null&&s===an}function Kb(n,s){Zi=Kc=!0;var o=n.pending;o===null?s.next=s:(s.next=o.next,o.next=s),n.pending=s}function Wb(n,s,o){if((o&4194048)!==0){var d=s.lanes;d&=n.pendingLanes,o|=d,s.lanes=o,Ue(n,o)}}var io={readContext:la,use:Qc,useCallback:qn,useContext:qn,useEffect:qn,useImperativeHandle:qn,useLayoutEffect:qn,useInsertionEffect:qn,useMemo:qn,useReducer:qn,useRef:qn,useState:qn,useDebugValue:qn,useDeferredValue:qn,useTransition:qn,useSyncExternalStore:qn,useId:qn,useHostTransitionStatus:qn,useFormState:qn,useActionState:qn,useOptimistic:qn,useMemoCache:qn,useCacheRefresh:qn};io.useEffectEvent=qn;var Zb={readContext:la,use:Qc,useCallback:function(n,s){return xa().memoizedState=[n,s===void 0?null:s],n},useContext:la,useEffect:Ib,useImperativeHandle:function(n,s,o){o=o!=null?o.concat([n]):null,eu(4194308,4,$b.bind(null,s,n),o)},useLayoutEffect:function(n,s){return eu(4194308,4,n,s)},useInsertionEffect:function(n,s){eu(4,2,n,s)},useMemo:function(n,s){var o=xa();s=s===void 0?null:s;var d=n();if(yi){et(!0);try{n()}finally{et(!1)}}return o.memoizedState=[d,s],d},useReducer:function(n,s,o){var d=xa();if(o!==void 0){var b=o(s);if(yi){et(!0);try{o(s)}finally{et(!1)}}}else b=s;return d.memoizedState=d.baseState=b,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:b},d.queue=n,n=n.dispatch=g_.bind(null,an,n),[d.memoizedState,n]},useRef:function(n){var s=xa();return n={current:n},s.memoizedState=n},useState:function(n){n=ym(n);var s=n.queue,o=Xb.bind(null,an,s);return s.dispatch=o,[n.memoizedState,o]},useDebugValue:vm,useDeferredValue:function(n,s){var o=xa();return xm(o,n,s)},useTransition:function(){var n=ym(!1);return n=Hb.bind(null,an,n.queue,!0,!1),xa().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,s,o){var d=an,b=xa();if(vn){if(o===void 0)throw Error(i(407));o=o()}else{if(o=s(),Dn===null)throw Error(i(349));(gn&127)!==0||bb(d,s,o)}b.memoizedState=o;var x={value:o,getSnapshot:s};return b.queue=x,Ib(xb.bind(null,d,x,n),[n]),d.flags|=2048,Ji(9,{destroy:void 0},vb.bind(null,d,x,o,s),null),o},useId:function(){var n=xa(),s=Dn.identifierPrefix;if(vn){var o=_s,d=js;o=(d&~(1<<32-Te(d)-1)).toString(32)+o,s="_"+s+"R_"+o,o=Wc++,0<o&&(s+="H"+o.toString(32)),s+="_"}else o=u_++,s="_"+s+"r_"+o.toString(32)+"_";return n.memoizedState=s},useHostTransitionStatus:wm,useFormState:Tb,useActionState:Tb,useOptimistic:function(n){var s=xa();s.memoizedState=s.baseState=n;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=o,s=Nm.bind(null,an,!0,o),o.dispatch=s,[n,s]},useMemoCache:mm,useCacheRefresh:function(){return xa().memoizedState=y_.bind(null,an)},useEffectEvent:function(n){var s=xa(),o={impl:n};return s.memoizedState=o,function(){if((jn&2)!==0)throw Error(i(440));return o.impl.apply(void 0,arguments)}}},Em={readContext:la,use:Qc,useCallback:Bb,useContext:la,useEffect:bm,useImperativeHandle:Fb,useInsertionEffect:Ob,useLayoutEffect:zb,useMemo:Ub,useReducer:Jc,useRef:Db,useState:function(){return Jc(Vs)},useDebugValue:vm,useDeferredValue:function(n,s){var o=Xn();return qb(o,Mn.memoizedState,n,s)},useTransition:function(){var n=Jc(Vs)[0],s=Xn().memoizedState;return[typeof n=="boolean"?n:so(n),s]},useSyncExternalStore:gb,useId:Yb,useHostTransitionStatus:wm,useFormState:Mb,useActionState:Mb,useOptimistic:function(n,s){var o=Xn();return Nb(o,Mn,n,s)},useMemoCache:mm,useCacheRefresh:Gb};Em.useEffectEvent=Lb;var Qb={readContext:la,use:Qc,useCallback:Bb,useContext:la,useEffect:bm,useImperativeHandle:Fb,useInsertionEffect:Ob,useLayoutEffect:zb,useMemo:Ub,useReducer:pm,useRef:Db,useState:function(){return pm(Vs)},useDebugValue:vm,useDeferredValue:function(n,s){var o=Xn();return Mn===null?xm(o,n,s):qb(o,Mn.memoizedState,n,s)},useTransition:function(){var n=pm(Vs)[0],s=Xn().memoizedState;return[typeof n=="boolean"?n:so(n),s]},useSyncExternalStore:gb,useId:Yb,useHostTransitionStatus:wm,useFormState:kb,useActionState:kb,useOptimistic:function(n,s){var o=Xn();return Mn!==null?Nb(o,Mn,n,s):(o.baseState=n,[n,o.queue.dispatch])},useMemoCache:mm,useCacheRefresh:Gb};Qb.useEffectEvent=Lb;function jm(n,s,o,d){s=n.memoizedState,o=o(d,s),o=o==null?s:g({},s,o),n.memoizedState=o,n.lanes===0&&(n.updateQueue.baseState=o)}var _m={enqueueSetState:function(n,s,o){n=n._reactInternals;var d=Ua(),b=xr(d);b.payload=s,o!=null&&(b.callback=o),s=Sr(n,b,d),s!==null&&(Aa(s,n,d),eo(s,n,d))},enqueueReplaceState:function(n,s,o){n=n._reactInternals;var d=Ua(),b=xr(d);b.tag=1,b.payload=s,o!=null&&(b.callback=o),s=Sr(n,b,d),s!==null&&(Aa(s,n,d),eo(s,n,d))},enqueueForceUpdate:function(n,s){n=n._reactInternals;var o=Ua(),d=xr(o);d.tag=2,s!=null&&(d.callback=s),s=Sr(n,d,o),s!==null&&(Aa(s,n,o),eo(s,n,o))}};function Jb(n,s,o,d,b,x,F){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(d,x,F):s.prototype&&s.prototype.isPureReactComponent?!Yl(o,d)||!Yl(b,x):!0}function ev(n,s,o,d){n=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(o,d),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(o,d),s.state!==n&&_m.enqueueReplaceState(s,s.state,null)}function gi(n,s){var o=s;if("ref"in s){o={};for(var d in s)d!=="ref"&&(o[d]=s[d])}if(n=n.defaultProps){o===s&&(o=g({},o));for(var b in n)o[b]===void 0&&(o[b]=n[b])}return o}function tv(n){Ic(n)}function nv(n){console.error(n)}function av(n){Ic(n)}function au(n,s){try{var o=n.onUncaughtError;o(s.value,{componentStack:s.stack})}catch(d){setTimeout(function(){throw d})}}function sv(n,s,o){try{var d=n.onCaughtError;d(o.value,{componentStack:o.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function Cm(n,s,o){return o=xr(o),o.tag=3,o.payload={element:null},o.callback=function(){au(n,s)},o}function rv(n){return n=xr(n),n.tag=3,n}function iv(n,s,o,d){var b=o.type.getDerivedStateFromError;if(typeof b=="function"){var x=d.value;n.payload=function(){return b(x)},n.callback=function(){sv(s,o,d)}}var F=o.stateNode;F!==null&&typeof F.componentDidCatch=="function"&&(n.callback=function(){sv(s,o,d),typeof b!="function"&&(Cr===null?Cr=new Set([this]):Cr.add(this));var W=d.stack;this.componentDidCatch(d.value,{componentStack:W!==null?W:""})})}function b_(n,s,o,d,b){if(o.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(s=o.alternate,s!==null&&Vi(s,o,b,!0),o=za.current,o!==null){switch(o.tag){case 31:case 13:return Ja===null?pu():o.alternate===null&&Hn===0&&(Hn=3),o.flags&=-257,o.flags|=65536,o.lanes=b,d===Pc?o.flags|=16384:(s=o.updateQueue,s===null?o.updateQueue=new Set([d]):s.add(d),Qm(n,d,b)),!1;case 22:return o.flags|=65536,d===Pc?o.flags|=16384:(s=o.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([d])},o.updateQueue=s):(o=s.retryQueue,o===null?s.retryQueue=new Set([d]):o.add(d)),Qm(n,d,b)),!1}throw Error(i(435,o.tag))}return Qm(n,d,b),pu(),!1}if(vn)return s=za.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=b,d!==Yf&&(n=Error(i(422),{cause:d}),Kl(Ka(n,o)))):(d!==Yf&&(s=Error(i(423),{cause:d}),Kl(Ka(s,o))),n=n.current.alternate,n.flags|=65536,b&=-b,n.lanes|=b,d=Ka(d,o),b=Cm(n.stateNode,d,b),am(n,b),Hn!==4&&(Hn=2)),!1;var x=Error(i(520),{cause:d});if(x=Ka(x,o),po===null?po=[x]:po.push(x),Hn!==4&&(Hn=2),s===null)return!0;d=Ka(d,o),o=s;do{switch(o.tag){case 3:return o.flags|=65536,n=b&-b,o.lanes|=n,n=Cm(o.stateNode,d,n),am(o,n),!1;case 1:if(s=o.type,x=o.stateNode,(o.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Cr===null||!Cr.has(x))))return o.flags|=65536,b&=-b,o.lanes|=b,b=rv(b),iv(b,n,o,d),am(o,b),!1}o=o.return}while(o!==null);return!1}var Am=Error(i(461)),Zn=!1;function oa(n,s,o,d){s.child=n===null?ub(s,null,o,d):pi(s,n.child,o,d)}function lv(n,s,o,d,b){o=o.render;var x=s.ref;if("ref"in d){var F={};for(var W in d)W!=="ref"&&(F[W]=d[W])}else F=d;return di(s),d=cm(n,s,o,F,x,b),W=um(),n!==null&&!Zn?(dm(n,s,b),Ys(n,s,b)):(vn&&W&&Pf(s),s.flags|=1,oa(n,s,d,b),s.child)}function ov(n,s,o,d,b){if(n===null){var x=o.type;return typeof x=="function"&&!Uf(x)&&x.defaultProps===void 0&&o.compare===null?(s.tag=15,s.type=x,cv(n,s,x,d,b)):(n=$c(o.type,null,d,s,s.mode,b),n.ref=s.ref,n.return=s,s.child=n)}if(x=n.child,!Om(n,b)){var F=x.memoizedProps;if(o=o.compare,o=o!==null?o:Yl,o(F,d)&&n.ref===s.ref)return Ys(n,s,b)}return s.flags|=1,n=Bs(x,d),n.ref=s.ref,n.return=s,s.child=n}function cv(n,s,o,d,b){if(n!==null){var x=n.memoizedProps;if(Yl(x,d)&&n.ref===s.ref)if(Zn=!1,s.pendingProps=d=x,Om(n,b))(n.flags&131072)!==0&&(Zn=!0);else return s.lanes=n.lanes,Ys(n,s,b)}return Tm(n,s,o,d,b)}function uv(n,s,o,d){var b=d.children,x=n!==null?n.memoizedState:null;if(n===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((s.flags&128)!==0){if(x=x!==null?x.baseLanes|o:o,n!==null){for(d=s.child=n.child,b=0;d!==null;)b=b|d.lanes|d.childLanes,d=d.sibling;d=b&~x}else d=0,s.child=null;return dv(n,s,x,o,d)}if((o&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},n!==null&&qc(s,x!==null?x.cachePool:null),x!==null?mb(s,x):rm(),hb(s);else return d=s.lanes=536870912,dv(n,s,x!==null?x.baseLanes|o:o,o,d)}else x!==null?(qc(s,x.cachePool),mb(s,x),Nr(),s.memoizedState=null):(n!==null&&qc(s,null),rm(),Nr());return oa(n,s,b,o),s.child}function lo(n,s){return n!==null&&n.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function dv(n,s,o,d,b){var x=Jf();return x=x===null?null:{parent:Kn._currentValue,pool:x},s.memoizedState={baseLanes:o,cachePool:x},n!==null&&qc(s,null),rm(),hb(s),n!==null&&Vi(n,s,d,!0),s.childLanes=b,null}function su(n,s){return s=iu({mode:s.mode,children:s.children},n.mode),s.ref=n.ref,n.child=s,s.return=n,s}function fv(n,s,o){return pi(s,n.child,null,o),n=su(s,s.pendingProps),n.flags|=2,$a(s),s.memoizedState=null,n}function v_(n,s,o){var d=s.pendingProps,b=(s.flags&128)!==0;if(s.flags&=-129,n===null){if(vn){if(d.mode==="hidden")return n=su(s,d),s.lanes=536870912,lo(null,n);if(lm(s),(n=On)?(n=Ex(n,Qa),n=n!==null&&n.data==="&"?n:null,n!==null&&(s.memoizedState={dehydrated:n,treeContext:pr!==null?{id:js,overflow:_s}:null,retryLane:536870912,hydrationErrors:null},o=Kg(n),o.return=s,s.child=o,ia=s,On=null)):n=null,n===null)throw gr(s);return s.lanes=536870912,null}return su(s,d)}var x=n.memoizedState;if(x!==null){var F=x.dehydrated;if(lm(s),b)if(s.flags&256)s.flags&=-257,s=fv(n,s,o);else if(s.memoizedState!==null)s.child=n.child,s.flags|=128,s=null;else throw Error(i(558));else if(Zn||Vi(n,s,o,!1),b=(o&n.childLanes)!==0,Zn||b){if(d=Dn,d!==null&&(F=it(d,o),F!==0&&F!==x.retryLane))throw x.retryLane=F,li(n,F),Aa(d,n,F),Am;pu(),s=fv(n,s,o)}else n=x.treeContext,On=es(F.nextSibling),ia=s,vn=!0,yr=null,Qa=!1,n!==null&&Qg(s,n),s=su(s,d),s.flags|=4096;return s}return n=Bs(n.child,{mode:d.mode,children:d.children}),n.ref=s.ref,s.child=n,n.return=s,n}function ru(n,s){var o=s.ref;if(o===null)n!==null&&n.ref!==null&&(s.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(i(284));(n===null||n.ref!==o)&&(s.flags|=4194816)}}function Tm(n,s,o,d,b){return di(s),o=cm(n,s,o,d,void 0,b),d=um(),n!==null&&!Zn?(dm(n,s,b),Ys(n,s,b)):(vn&&d&&Pf(s),s.flags|=1,oa(n,s,o,b),s.child)}function mv(n,s,o,d,b,x){return di(s),s.updateQueue=null,o=yb(s,d,o,b),pb(n),d=um(),n!==null&&!Zn?(dm(n,s,x),Ys(n,s,x)):(vn&&d&&Pf(s),s.flags|=1,oa(n,s,o,x),s.child)}function hv(n,s,o,d,b){if(di(s),s.stateNode===null){var x=Ui,F=o.contextType;typeof F=="object"&&F!==null&&(x=la(F)),x=new o(d,x),s.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=_m,s.stateNode=x,x._reactInternals=s,x=s.stateNode,x.props=d,x.state=s.memoizedState,x.refs={},tm(s),F=o.contextType,x.context=typeof F=="object"&&F!==null?la(F):Ui,x.state=s.memoizedState,F=o.getDerivedStateFromProps,typeof F=="function"&&(jm(s,o,F,d),x.state=s.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(F=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),F!==x.state&&_m.enqueueReplaceState(x,x.state,null),no(s,d,x,b),to(),x.state=s.memoizedState),typeof x.componentDidMount=="function"&&(s.flags|=4194308),d=!0}else if(n===null){x=s.stateNode;var W=s.memoizedProps,he=gi(o,W);x.props=he;var Oe=x.context,tt=o.contextType;F=Ui,typeof tt=="object"&&tt!==null&&(F=la(tt));var lt=o.getDerivedStateFromProps;tt=typeof lt=="function"||typeof x.getSnapshotBeforeUpdate=="function",W=s.pendingProps!==W,tt||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(W||Oe!==F)&&ev(s,x,d,F),vr=!1;var Fe=s.memoizedState;x.state=Fe,no(s,d,x,b),to(),Oe=s.memoizedState,W||Fe!==Oe||vr?(typeof lt=="function"&&(jm(s,o,lt,d),Oe=s.memoizedState),(he=vr||Jb(s,o,he,d,Fe,Oe,F))?(tt||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(s.flags|=4194308)):(typeof x.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=d,s.memoizedState=Oe),x.props=d,x.state=Oe,x.context=F,d=he):(typeof x.componentDidMount=="function"&&(s.flags|=4194308),d=!1)}else{x=s.stateNode,nm(n,s),F=s.memoizedProps,tt=gi(o,F),x.props=tt,lt=s.pendingProps,Fe=x.context,Oe=o.contextType,he=Ui,typeof Oe=="object"&&Oe!==null&&(he=la(Oe)),W=o.getDerivedStateFromProps,(Oe=typeof W=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(F!==lt||Fe!==he)&&ev(s,x,d,he),vr=!1,Fe=s.memoizedState,x.state=Fe,no(s,d,x,b),to();var Ye=s.memoizedState;F!==lt||Fe!==Ye||vr||n!==null&&n.dependencies!==null&&Bc(n.dependencies)?(typeof W=="function"&&(jm(s,o,W,d),Ye=s.memoizedState),(tt=vr||Jb(s,o,tt,d,Fe,Ye,he)||n!==null&&n.dependencies!==null&&Bc(n.dependencies))?(Oe||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(d,Ye,he),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(d,Ye,he)),typeof x.componentDidUpdate=="function"&&(s.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof x.componentDidUpdate!="function"||F===n.memoizedProps&&Fe===n.memoizedState||(s.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||F===n.memoizedProps&&Fe===n.memoizedState||(s.flags|=1024),s.memoizedProps=d,s.memoizedState=Ye),x.props=d,x.state=Ye,x.context=he,d=tt):(typeof x.componentDidUpdate!="function"||F===n.memoizedProps&&Fe===n.memoizedState||(s.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||F===n.memoizedProps&&Fe===n.memoizedState||(s.flags|=1024),d=!1)}return x=d,ru(n,s),d=(s.flags&128)!==0,x||d?(x=s.stateNode,o=d&&typeof o.getDerivedStateFromError!="function"?null:x.render(),s.flags|=1,n!==null&&d?(s.child=pi(s,n.child,null,b),s.child=pi(s,null,o,b)):oa(n,s,o,b),s.memoizedState=x.state,n=s.child):n=Ys(n,s,b),n}function pv(n,s,o,d){return ci(),s.flags|=256,oa(n,s,o,d),s.child}var Mm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Rm(n){return{baseLanes:n,cachePool:sb()}}function km(n,s,o){return n=n!==null?n.childLanes&~o:0,s&&(n|=Ba),n}function yv(n,s,o){var d=s.pendingProps,b=!1,x=(s.flags&128)!==0,F;if((F=x)||(F=n!==null&&n.memoizedState===null?!1:(Gn.current&2)!==0),F&&(b=!0,s.flags&=-129),F=(s.flags&32)!==0,s.flags&=-33,n===null){if(vn){if(b?wr(s):Nr(),(n=On)?(n=Ex(n,Qa),n=n!==null&&n.data!=="&"?n:null,n!==null&&(s.memoizedState={dehydrated:n,treeContext:pr!==null?{id:js,overflow:_s}:null,retryLane:536870912,hydrationErrors:null},o=Kg(n),o.return=s,s.child=o,ia=s,On=null)):n=null,n===null)throw gr(s);return hh(n)?s.lanes=32:s.lanes=536870912,null}var W=d.children;return d=d.fallback,b?(Nr(),b=s.mode,W=iu({mode:"hidden",children:W},b),d=oi(d,b,o,null),W.return=s,d.return=s,W.sibling=d,s.child=W,d=s.child,d.memoizedState=Rm(o),d.childLanes=km(n,F,o),s.memoizedState=Mm,lo(null,d)):(wr(s),Dm(s,W))}var he=n.memoizedState;if(he!==null&&(W=he.dehydrated,W!==null)){if(x)s.flags&256?(wr(s),s.flags&=-257,s=Im(n,s,o)):s.memoizedState!==null?(Nr(),s.child=n.child,s.flags|=128,s=null):(Nr(),W=d.fallback,b=s.mode,d=iu({mode:"visible",children:d.children},b),W=oi(W,b,o,null),W.flags|=2,d.return=s,W.return=s,d.sibling=W,s.child=d,pi(s,n.child,null,o),d=s.child,d.memoizedState=Rm(o),d.childLanes=km(n,F,o),s.memoizedState=Mm,s=lo(null,d));else if(wr(s),hh(W)){if(F=W.nextSibling&&W.nextSibling.dataset,F)var Oe=F.dgst;F=Oe,d=Error(i(419)),d.stack="",d.digest=F,Kl({value:d,source:null,stack:null}),s=Im(n,s,o)}else if(Zn||Vi(n,s,o,!1),F=(o&n.childLanes)!==0,Zn||F){if(F=Dn,F!==null&&(d=it(F,o),d!==0&&d!==he.retryLane))throw he.retryLane=d,li(n,d),Aa(F,n,d),Am;mh(W)||pu(),s=Im(n,s,o)}else mh(W)?(s.flags|=192,s.child=n.child,s=null):(n=he.treeContext,On=es(W.nextSibling),ia=s,vn=!0,yr=null,Qa=!1,n!==null&&Qg(s,n),s=Dm(s,d.children),s.flags|=4096);return s}return b?(Nr(),W=d.fallback,b=s.mode,he=n.child,Oe=he.sibling,d=Bs(he,{mode:"hidden",children:d.children}),d.subtreeFlags=he.subtreeFlags&65011712,Oe!==null?W=Bs(Oe,W):(W=oi(W,b,o,null),W.flags|=2),W.return=s,d.return=s,d.sibling=W,s.child=d,lo(null,d),d=s.child,W=n.child.memoizedState,W===null?W=Rm(o):(b=W.cachePool,b!==null?(he=Kn._currentValue,b=b.parent!==he?{parent:he,pool:he}:b):b=sb(),W={baseLanes:W.baseLanes|o,cachePool:b}),d.memoizedState=W,d.childLanes=km(n,F,o),s.memoizedState=Mm,lo(n.child,d)):(wr(s),o=n.child,n=o.sibling,o=Bs(o,{mode:"visible",children:d.children}),o.return=s,o.sibling=null,n!==null&&(F=s.deletions,F===null?(s.deletions=[n],s.flags|=16):F.push(n)),s.child=o,s.memoizedState=null,o)}function Dm(n,s){return s=iu({mode:"visible",children:s},n.mode),s.return=n,n.child=s}function iu(n,s){return n=Oa(22,n,null,s),n.lanes=0,n}function Im(n,s,o){return pi(s,n.child,null,o),n=Dm(s,s.pendingProps.children),n.flags|=2,s.memoizedState=null,n}function gv(n,s,o){n.lanes|=s;var d=n.alternate;d!==null&&(d.lanes|=s),Kf(n.return,s,o)}function Lm(n,s,o,d,b,x){var F=n.memoizedState;F===null?n.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:d,tail:o,tailMode:b,treeForkCount:x}:(F.isBackwards=s,F.rendering=null,F.renderingStartTime=0,F.last=d,F.tail=o,F.tailMode=b,F.treeForkCount=x)}function bv(n,s,o){var d=s.pendingProps,b=d.revealOrder,x=d.tail;d=d.children;var F=Gn.current,W=(F&2)!==0;if(W?(F=F&1|2,s.flags|=128):F&=1,Y(Gn,F),oa(n,s,d,o),d=vn?Xl:0,!W&&n!==null&&(n.flags&128)!==0)e:for(n=s.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&gv(n,o,s);else if(n.tag===19)gv(n,o,s);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break e;for(;n.sibling===null;){if(n.return===null||n.return===s)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}switch(b){case"forwards":for(o=s.child,b=null;o!==null;)n=o.alternate,n!==null&&Xc(n)===null&&(b=o),o=o.sibling;o=b,o===null?(b=s.child,s.child=null):(b=o.sibling,o.sibling=null),Lm(s,!1,b,o,x,d);break;case"backwards":case"unstable_legacy-backwards":for(o=null,b=s.child,s.child=null;b!==null;){if(n=b.alternate,n!==null&&Xc(n)===null){s.child=b;break}n=b.sibling,b.sibling=o,o=b,b=n}Lm(s,!0,o,null,x,d);break;case"together":Lm(s,!1,null,null,void 0,d);break;default:s.memoizedState=null}return s.child}function Ys(n,s,o){if(n!==null&&(s.dependencies=n.dependencies),_r|=s.lanes,(o&s.childLanes)===0)if(n!==null){if(Vi(n,s,o,!1),(o&s.childLanes)===0)return null}else return null;if(n!==null&&s.child!==n.child)throw Error(i(153));if(s.child!==null){for(n=s.child,o=Bs(n,n.pendingProps),s.child=o,o.return=s;n.sibling!==null;)n=n.sibling,o=o.sibling=Bs(n,n.pendingProps),o.return=s;o.sibling=null}return s.child}function Om(n,s){return(n.lanes&s)!==0?!0:(n=n.dependencies,!!(n!==null&&Bc(n)))}function x_(n,s,o){switch(s.tag){case 3:J(s,s.stateNode.containerInfo),br(s,Kn,n.memoizedState.cache),ci();break;case 27:case 5:ne(s);break;case 4:J(s,s.stateNode.containerInfo);break;case 10:br(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,lm(s),null;break;case 13:var d=s.memoizedState;if(d!==null)return d.dehydrated!==null?(wr(s),s.flags|=128,null):(o&s.child.childLanes)!==0?yv(n,s,o):(wr(s),n=Ys(n,s,o),n!==null?n.sibling:null);wr(s);break;case 19:var b=(n.flags&128)!==0;if(d=(o&s.childLanes)!==0,d||(Vi(n,s,o,!1),d=(o&s.childLanes)!==0),b){if(d)return bv(n,s,o);s.flags|=128}if(b=s.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),Y(Gn,Gn.current),d)break;return null;case 22:return s.lanes=0,uv(n,s,o,s.pendingProps);case 24:br(s,Kn,n.memoizedState.cache)}return Ys(n,s,o)}function vv(n,s,o){if(n!==null)if(n.memoizedProps!==s.pendingProps)Zn=!0;else{if(!Om(n,o)&&(s.flags&128)===0)return Zn=!1,x_(n,s,o);Zn=(n.flags&131072)!==0}else Zn=!1,vn&&(s.flags&1048576)!==0&&Zg(s,Xl,s.index);switch(s.lanes=0,s.tag){case 16:e:{var d=s.pendingProps;if(n=mi(s.elementType),s.type=n,typeof n=="function")Uf(n)?(d=gi(n,d),s.tag=1,s=hv(null,s,n,d,o)):(s.tag=0,s=Tm(null,s,n,d,o));else{if(n!=null){var b=n.$$typeof;if(b===_){s.tag=11,s=lv(null,s,n,d,o);break e}else if(b===j){s.tag=14,s=ov(null,s,n,d,o);break e}}throw s=R(n)||n,Error(i(306,s,""))}}return s;case 0:return Tm(n,s,s.type,s.pendingProps,o);case 1:return d=s.type,b=gi(d,s.pendingProps),hv(n,s,d,b,o);case 3:e:{if(J(s,s.stateNode.containerInfo),n===null)throw Error(i(387));d=s.pendingProps;var x=s.memoizedState;b=x.element,nm(n,s),no(s,d,null,o);var F=s.memoizedState;if(d=F.cache,br(s,Kn,d),d!==x.cache&&Wf(s,[Kn],o,!0),to(),d=F.element,x.isDehydrated)if(x={element:d,isDehydrated:!1,cache:F.cache},s.updateQueue.baseState=x,s.memoizedState=x,s.flags&256){s=pv(n,s,d,o);break e}else if(d!==b){b=Ka(Error(i(424)),s),Kl(b),s=pv(n,s,d,o);break e}else{switch(n=s.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(On=es(n.firstChild),ia=s,vn=!0,yr=null,Qa=!0,o=ub(s,null,d,o),s.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling}else{if(ci(),d===b){s=Ys(n,s,o);break e}oa(n,s,d,o)}s=s.child}return s;case 26:return ru(n,s),n===null?(o=Mx(s.type,null,s.pendingProps,null))?s.memoizedState=o:vn||(o=s.type,n=s.pendingProps,d=wu(Z.current).createElement(o),d[pt]=s,d[Ee]=n,ca(d,o,n),ke(d),s.stateNode=d):s.memoizedState=Mx(s.type,n.memoizedProps,s.pendingProps,n.memoizedState),null;case 27:return ne(s),n===null&&vn&&(d=s.stateNode=Cx(s.type,s.pendingProps,Z.current),ia=s,Qa=!0,b=On,Rr(s.type)?(ph=b,On=es(d.firstChild)):On=b),oa(n,s,s.pendingProps.children,o),ru(n,s),n===null&&(s.flags|=4194304),s.child;case 5:return n===null&&vn&&((b=d=On)&&(d=W_(d,s.type,s.pendingProps,Qa),d!==null?(s.stateNode=d,ia=s,On=es(d.firstChild),Qa=!1,b=!0):b=!1),b||gr(s)),ne(s),b=s.type,x=s.pendingProps,F=n!==null?n.memoizedProps:null,d=x.children,uh(b,x)?d=null:F!==null&&uh(b,F)&&(s.flags|=32),s.memoizedState!==null&&(b=cm(n,s,d_,null,null,o),No._currentValue=b),ru(n,s),oa(n,s,d,o),s.child;case 6:return n===null&&vn&&((n=o=On)&&(o=Z_(o,s.pendingProps,Qa),o!==null?(s.stateNode=o,ia=s,On=null,n=!0):n=!1),n||gr(s)),null;case 13:return yv(n,s,o);case 4:return J(s,s.stateNode.containerInfo),d=s.pendingProps,n===null?s.child=pi(s,null,d,o):oa(n,s,d,o),s.child;case 11:return lv(n,s,s.type,s.pendingProps,o);case 7:return oa(n,s,s.pendingProps,o),s.child;case 8:return oa(n,s,s.pendingProps.children,o),s.child;case 12:return oa(n,s,s.pendingProps.children,o),s.child;case 10:return d=s.pendingProps,br(s,s.type,d.value),oa(n,s,d.children,o),s.child;case 9:return b=s.type._context,d=s.pendingProps.children,di(s),b=la(b),d=d(b),s.flags|=1,oa(n,s,d,o),s.child;case 14:return ov(n,s,s.type,s.pendingProps,o);case 15:return cv(n,s,s.type,s.pendingProps,o);case 19:return bv(n,s,o);case 31:return v_(n,s,o);case 22:return uv(n,s,o,s.pendingProps);case 24:return di(s),d=la(Kn),n===null?(b=Jf(),b===null&&(b=Dn,x=Zf(),b.pooledCache=x,x.refCount++,x!==null&&(b.pooledCacheLanes|=o),b=x),s.memoizedState={parent:d,cache:b},tm(s),br(s,Kn,b)):((n.lanes&o)!==0&&(nm(n,s),no(s,null,null,o),to()),b=n.memoizedState,x=s.memoizedState,b.parent!==d?(b={parent:d,cache:d},s.memoizedState=b,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=b),br(s,Kn,d)):(d=x.cache,br(s,Kn,d),d!==b.cache&&Wf(s,[Kn],o,!0))),oa(n,s,s.pendingProps.children,o),s.child;case 29:throw s.pendingProps}throw Error(i(156,s.tag))}function Gs(n){n.flags|=4}function zm(n,s,o,d,b){if((s=(n.mode&32)!==0)&&(s=!1),s){if(n.flags|=16777216,(b&335544128)===b)if(n.stateNode.complete)n.flags|=8192;else if(Yv())n.flags|=8192;else throw hi=Pc,em}else n.flags&=-16777217}function xv(n,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!Lx(s))if(Yv())n.flags|=8192;else throw hi=Pc,em}function lu(n,s){s!==null&&(n.flags|=4),n.flags&16384&&(s=n.tag!==22?Ht():536870912,n.lanes|=s,al|=s)}function oo(n,s){if(!vn)switch(n.tailMode){case"hidden":s=n.tail;for(var o=null;s!==null;)s.alternate!==null&&(o=s),s=s.sibling;o===null?n.tail=null:o.sibling=null;break;case"collapsed":o=n.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?s||n.tail===null?n.tail=null:n.tail.sibling=null:d.sibling=null}}function zn(n){var s=n.alternate!==null&&n.alternate.child===n.child,o=0,d=0;if(s)for(var b=n.child;b!==null;)o|=b.lanes|b.childLanes,d|=b.subtreeFlags&65011712,d|=b.flags&65011712,b.return=n,b=b.sibling;else for(b=n.child;b!==null;)o|=b.lanes|b.childLanes,d|=b.subtreeFlags,d|=b.flags,b.return=n,b=b.sibling;return n.subtreeFlags|=d,n.childLanes=o,s}function S_(n,s,o){var d=s.pendingProps;switch(Vf(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zn(s),null;case 1:return zn(s),null;case 3:return o=s.stateNode,d=null,n!==null&&(d=n.memoizedState.cache),s.memoizedState.cache!==d&&(s.flags|=2048),Hs(Kn),se(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(n===null||n.child===null)&&(Pi(s)?Gs(s):n===null||n.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Gf())),zn(s),null;case 26:var b=s.type,x=s.memoizedState;return n===null?(Gs(s),x!==null?(zn(s),xv(s,x)):(zn(s),zm(s,b,null,d,o))):x?x!==n.memoizedState?(Gs(s),zn(s),xv(s,x)):(zn(s),s.flags&=-16777217):(n=n.memoizedProps,n!==d&&Gs(s),zn(s),zm(s,b,n,d,o)),null;case 27:if(we(s),o=Z.current,b=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==d&&Gs(s);else{if(!d){if(s.stateNode===null)throw Error(i(166));return zn(s),null}n=Q.current,Pi(s)?Jg(s):(n=Cx(b,d,o),s.stateNode=n,Gs(s))}return zn(s),null;case 5:if(we(s),b=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==d&&Gs(s);else{if(!d){if(s.stateNode===null)throw Error(i(166));return zn(s),null}if(x=Q.current,Pi(s))Jg(s);else{var F=wu(Z.current);switch(x){case 1:x=F.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:x=F.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":x=F.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":x=F.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":x=F.createElement("div"),x.innerHTML="<script><\/script>",x=x.removeChild(x.firstChild);break;case"select":x=typeof d.is=="string"?F.createElement("select",{is:d.is}):F.createElement("select"),d.multiple?x.multiple=!0:d.size&&(x.size=d.size);break;default:x=typeof d.is=="string"?F.createElement(b,{is:d.is}):F.createElement(b)}}x[pt]=s,x[Ee]=d;e:for(F=s.child;F!==null;){if(F.tag===5||F.tag===6)x.appendChild(F.stateNode);else if(F.tag!==4&&F.tag!==27&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===s)break e;for(;F.sibling===null;){if(F.return===null||F.return===s)break e;F=F.return}F.sibling.return=F.return,F=F.sibling}s.stateNode=x;e:switch(ca(x,b,d),b){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&Gs(s)}}return zn(s),zm(s,s.type,n===null?null:n.memoizedProps,s.pendingProps,o),null;case 6:if(n&&s.stateNode!=null)n.memoizedProps!==d&&Gs(s);else{if(typeof d!="string"&&s.stateNode===null)throw Error(i(166));if(n=Z.current,Pi(s)){if(n=s.stateNode,o=s.memoizedProps,d=null,b=ia,b!==null)switch(b.tag){case 27:case 5:d=b.memoizedProps}n[pt]=s,n=!!(n.nodeValue===o||d!==null&&d.suppressHydrationWarning===!0||yx(n.nodeValue,o)),n||gr(s,!0)}else n=wu(n).createTextNode(d),n[pt]=s,s.stateNode=n}return zn(s),null;case 31:if(o=s.memoizedState,n===null||n.memoizedState!==null){if(d=Pi(s),o!==null){if(n===null){if(!d)throw Error(i(318));if(n=s.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(557));n[pt]=s}else ci(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;zn(s),n=!1}else o=Gf(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=o),n=!0;if(!n)return s.flags&256?($a(s),s):($a(s),null);if((s.flags&128)!==0)throw Error(i(558))}return zn(s),null;case 13:if(d=s.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(b=Pi(s),d!==null&&d.dehydrated!==null){if(n===null){if(!b)throw Error(i(318));if(b=s.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(i(317));b[pt]=s}else ci(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;zn(s),b=!1}else b=Gf(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=b),b=!0;if(!b)return s.flags&256?($a(s),s):($a(s),null)}return $a(s),(s.flags&128)!==0?(s.lanes=o,s):(o=d!==null,n=n!==null&&n.memoizedState!==null,o&&(d=s.child,b=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(b=d.alternate.memoizedState.cachePool.pool),x=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(x=d.memoizedState.cachePool.pool),x!==b&&(d.flags|=2048)),o!==n&&o&&(s.child.flags|=8192),lu(s,s.updateQueue),zn(s),null);case 4:return se(),n===null&&rh(s.stateNode.containerInfo),zn(s),null;case 10:return Hs(s.type),zn(s),null;case 19:if(q(Gn),d=s.memoizedState,d===null)return zn(s),null;if(b=(s.flags&128)!==0,x=d.rendering,x===null)if(b)oo(d,!1);else{if(Hn!==0||n!==null&&(n.flags&128)!==0)for(n=s.child;n!==null;){if(x=Xc(n),x!==null){for(s.flags|=128,oo(d,!1),n=x.updateQueue,s.updateQueue=n,lu(s,n),s.subtreeFlags=0,n=o,o=s.child;o!==null;)Xg(o,n),o=o.sibling;return Y(Gn,Gn.current&1|2),vn&&Us(s,d.treeForkCount),s.child}n=n.sibling}d.tail!==null&&at()>fu&&(s.flags|=128,b=!0,oo(d,!1),s.lanes=4194304)}else{if(!b)if(n=Xc(x),n!==null){if(s.flags|=128,b=!0,n=n.updateQueue,s.updateQueue=n,lu(s,n),oo(d,!0),d.tail===null&&d.tailMode==="hidden"&&!x.alternate&&!vn)return zn(s),null}else 2*at()-d.renderingStartTime>fu&&o!==536870912&&(s.flags|=128,b=!0,oo(d,!1),s.lanes=4194304);d.isBackwards?(x.sibling=s.child,s.child=x):(n=d.last,n!==null?n.sibling=x:s.child=x,d.last=x)}return d.tail!==null?(n=d.tail,d.rendering=n,d.tail=n.sibling,d.renderingStartTime=at(),n.sibling=null,o=Gn.current,Y(Gn,b?o&1|2:o&1),vn&&Us(s,d.treeForkCount),n):(zn(s),null);case 22:case 23:return $a(s),im(),d=s.memoizedState!==null,n!==null?n.memoizedState!==null!==d&&(s.flags|=8192):d&&(s.flags|=8192),d?(o&536870912)!==0&&(s.flags&128)===0&&(zn(s),s.subtreeFlags&6&&(s.flags|=8192)):zn(s),o=s.updateQueue,o!==null&&lu(s,o.retryQueue),o=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),d=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(d=s.memoizedState.cachePool.pool),d!==o&&(s.flags|=2048),n!==null&&q(fi),null;case 24:return o=null,n!==null&&(o=n.memoizedState.cache),s.memoizedState.cache!==o&&(s.flags|=2048),Hs(Kn),zn(s),null;case 25:return null;case 30:return null}throw Error(i(156,s.tag))}function w_(n,s){switch(Vf(s),s.tag){case 1:return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 3:return Hs(Kn),se(),n=s.flags,(n&65536)!==0&&(n&128)===0?(s.flags=n&-65537|128,s):null;case 26:case 27:case 5:return we(s),null;case 31:if(s.memoizedState!==null){if($a(s),s.alternate===null)throw Error(i(340));ci()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 13:if($a(s),n=s.memoizedState,n!==null&&n.dehydrated!==null){if(s.alternate===null)throw Error(i(340));ci()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 19:return q(Gn),null;case 4:return se(),null;case 10:return Hs(s.type),null;case 22:case 23:return $a(s),im(),n!==null&&q(fi),n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 24:return Hs(Kn),null;case 25:return null;default:return null}}function Sv(n,s){switch(Vf(s),s.tag){case 3:Hs(Kn),se();break;case 26:case 27:case 5:we(s);break;case 4:se();break;case 31:s.memoizedState!==null&&$a(s);break;case 13:$a(s);break;case 19:q(Gn);break;case 10:Hs(s.type);break;case 22:case 23:$a(s),im(),n!==null&&q(fi);break;case 24:Hs(Kn)}}function co(n,s){try{var o=s.updateQueue,d=o!==null?o.lastEffect:null;if(d!==null){var b=d.next;o=b;do{if((o.tag&n)===n){d=void 0;var x=o.create,F=o.inst;d=x(),F.destroy=d}o=o.next}while(o!==b)}}catch(W){An(s,s.return,W)}}function Er(n,s,o){try{var d=s.updateQueue,b=d!==null?d.lastEffect:null;if(b!==null){var x=b.next;d=x;do{if((d.tag&n)===n){var F=d.inst,W=F.destroy;if(W!==void 0){F.destroy=void 0,b=s;var he=o,Oe=W;try{Oe()}catch(tt){An(b,he,tt)}}}d=d.next}while(d!==x)}}catch(tt){An(s,s.return,tt)}}function wv(n){var s=n.updateQueue;if(s!==null){var o=n.stateNode;try{fb(s,o)}catch(d){An(n,n.return,d)}}}function Nv(n,s,o){o.props=gi(n.type,n.memoizedProps),o.state=n.memoizedState;try{o.componentWillUnmount()}catch(d){An(n,s,d)}}function uo(n,s){try{var o=n.ref;if(o!==null){switch(n.tag){case 26:case 27:case 5:var d=n.stateNode;break;case 30:d=n.stateNode;break;default:d=n.stateNode}typeof o=="function"?n.refCleanup=o(d):o.current=d}}catch(b){An(n,s,b)}}function Cs(n,s){var o=n.ref,d=n.refCleanup;if(o!==null)if(typeof d=="function")try{d()}catch(b){An(n,s,b)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(b){An(n,s,b)}else o.current=null}function Ev(n){var s=n.type,o=n.memoizedProps,d=n.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":o.autoFocus&&d.focus();break e;case"img":o.src?d.src=o.src:o.srcSet&&(d.srcset=o.srcSet)}}catch(b){An(n,n.return,b)}}function $m(n,s,o){try{var d=n.stateNode;P_(d,n.type,o,s),d[Ee]=s}catch(b){An(n,n.return,b)}}function jv(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&Rr(n.type)||n.tag===4}function Fm(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||jv(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&Rr(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Bm(n,s,o){var d=n.tag;if(d===5||d===6)n=n.stateNode,s?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(n,s):(s=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,s.appendChild(n),o=o._reactRootContainer,o!=null||s.onclick!==null||(s.onclick=ra));else if(d!==4&&(d===27&&Rr(n.type)&&(o=n.stateNode,s=null),n=n.child,n!==null))for(Bm(n,s,o),n=n.sibling;n!==null;)Bm(n,s,o),n=n.sibling}function ou(n,s,o){var d=n.tag;if(d===5||d===6)n=n.stateNode,s?o.insertBefore(n,s):o.appendChild(n);else if(d!==4&&(d===27&&Rr(n.type)&&(o=n.stateNode),n=n.child,n!==null))for(ou(n,s,o),n=n.sibling;n!==null;)ou(n,s,o),n=n.sibling}function _v(n){var s=n.stateNode,o=n.memoizedProps;try{for(var d=n.type,b=s.attributes;b.length;)s.removeAttributeNode(b[0]);ca(s,d,o),s[pt]=n,s[Ee]=o}catch(x){An(n,n.return,x)}}var Xs=!1,Qn=!1,Um=!1,Cv=typeof WeakSet=="function"?WeakSet:Set,aa=null;function N_(n,s){if(n=n.containerInfo,oh=Tu,n=Fg(n),If(n)){if("selectionStart"in n)var o={start:n.selectionStart,end:n.selectionEnd};else e:{o=(o=n.ownerDocument)&&o.defaultView||window;var d=o.getSelection&&o.getSelection();if(d&&d.rangeCount!==0){o=d.anchorNode;var b=d.anchorOffset,x=d.focusNode;d=d.focusOffset;try{o.nodeType,x.nodeType}catch{o=null;break e}var F=0,W=-1,he=-1,Oe=0,tt=0,lt=n,Fe=null;t:for(;;){for(var Ye;lt!==o||b!==0&&lt.nodeType!==3||(W=F+b),lt!==x||d!==0&&lt.nodeType!==3||(he=F+d),lt.nodeType===3&&(F+=lt.nodeValue.length),(Ye=lt.firstChild)!==null;)Fe=lt,lt=Ye;for(;;){if(lt===n)break t;if(Fe===o&&++Oe===b&&(W=F),Fe===x&&++tt===d&&(he=F),(Ye=lt.nextSibling)!==null)break;lt=Fe,Fe=lt.parentNode}lt=Ye}o=W===-1||he===-1?null:{start:W,end:he}}else o=null}o=o||{start:0,end:0}}else o=null;for(ch={focusedElem:n,selectionRange:o},Tu=!1,aa=s;aa!==null;)if(s=aa,n=s.child,(s.subtreeFlags&1028)!==0&&n!==null)n.return=s,aa=n;else for(;aa!==null;){switch(s=aa,x=s.alternate,n=s.flags,s.tag){case 0:if((n&4)!==0&&(n=s.updateQueue,n=n!==null?n.events:null,n!==null))for(o=0;o<n.length;o++)b=n[o],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((n&1024)!==0&&x!==null){n=void 0,o=s,b=x.memoizedProps,x=x.memoizedState,d=o.stateNode;try{var zt=gi(o.type,b);n=d.getSnapshotBeforeUpdate(zt,x),d.__reactInternalSnapshotBeforeUpdate=n}catch(Wt){An(o,o.return,Wt)}}break;case 3:if((n&1024)!==0){if(n=s.stateNode.containerInfo,o=n.nodeType,o===9)fh(n);else if(o===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":fh(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(i(163))}if(n=s.sibling,n!==null){n.return=s.return,aa=n;break}aa=s.return}}function Av(n,s,o){var d=o.flags;switch(o.tag){case 0:case 11:case 15:Ws(n,o),d&4&&co(5,o);break;case 1:if(Ws(n,o),d&4)if(n=o.stateNode,s===null)try{n.componentDidMount()}catch(F){An(o,o.return,F)}else{var b=gi(o.type,s.memoizedProps);s=s.memoizedState;try{n.componentDidUpdate(b,s,n.__reactInternalSnapshotBeforeUpdate)}catch(F){An(o,o.return,F)}}d&64&&wv(o),d&512&&uo(o,o.return);break;case 3:if(Ws(n,o),d&64&&(n=o.updateQueue,n!==null)){if(s=null,o.child!==null)switch(o.child.tag){case 27:case 5:s=o.child.stateNode;break;case 1:s=o.child.stateNode}try{fb(n,s)}catch(F){An(o,o.return,F)}}break;case 27:s===null&&d&4&&_v(o);case 26:case 5:Ws(n,o),s===null&&d&4&&Ev(o),d&512&&uo(o,o.return);break;case 12:Ws(n,o);break;case 31:Ws(n,o),d&4&&Rv(n,o);break;case 13:Ws(n,o),d&4&&kv(n,o),d&64&&(n=o.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(o=k_.bind(null,o),Q_(n,o))));break;case 22:if(d=o.memoizedState!==null||Xs,!d){s=s!==null&&s.memoizedState!==null||Qn,b=Xs;var x=Qn;Xs=d,(Qn=s)&&!x?Zs(n,o,(o.subtreeFlags&8772)!==0):Ws(n,o),Xs=b,Qn=x}break;case 30:break;default:Ws(n,o)}}function Tv(n){var s=n.alternate;s!==null&&(n.alternate=null,Tv(s)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(s=n.stateNode,s!==null&&Ze(s)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var Fn=null,Ea=!1;function Ks(n,s,o){for(o=o.child;o!==null;)Mv(n,s,o),o=o.sibling}function Mv(n,s,o){if(Xe&&typeof Xe.onCommitFiberUnmount=="function")try{Xe.onCommitFiberUnmount(Ge,o)}catch{}switch(o.tag){case 26:Qn||Cs(o,s),Ks(n,s,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:Qn||Cs(o,s);var d=Fn,b=Ea;Rr(o.type)&&(Fn=o.stateNode,Ea=!1),Ks(n,s,o),xo(o.stateNode),Fn=d,Ea=b;break;case 5:Qn||Cs(o,s);case 6:if(d=Fn,b=Ea,Fn=null,Ks(n,s,o),Fn=d,Ea=b,Fn!==null)if(Ea)try{(Fn.nodeType===9?Fn.body:Fn.nodeName==="HTML"?Fn.ownerDocument.body:Fn).removeChild(o.stateNode)}catch(x){An(o,s,x)}else try{Fn.removeChild(o.stateNode)}catch(x){An(o,s,x)}break;case 18:Fn!==null&&(Ea?(n=Fn,wx(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,o.stateNode),dl(n)):wx(Fn,o.stateNode));break;case 4:d=Fn,b=Ea,Fn=o.stateNode.containerInfo,Ea=!0,Ks(n,s,o),Fn=d,Ea=b;break;case 0:case 11:case 14:case 15:Er(2,o,s),Qn||Er(4,o,s),Ks(n,s,o);break;case 1:Qn||(Cs(o,s),d=o.stateNode,typeof d.componentWillUnmount=="function"&&Nv(o,s,d)),Ks(n,s,o);break;case 21:Ks(n,s,o);break;case 22:Qn=(d=Qn)||o.memoizedState!==null,Ks(n,s,o),Qn=d;break;default:Ks(n,s,o)}}function Rv(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null))){n=n.dehydrated;try{dl(n)}catch(o){An(s,s.return,o)}}}function kv(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{dl(n)}catch(o){An(s,s.return,o)}}function E_(n){switch(n.tag){case 31:case 13:case 19:var s=n.stateNode;return s===null&&(s=n.stateNode=new Cv),s;case 22:return n=n.stateNode,s=n._retryCache,s===null&&(s=n._retryCache=new Cv),s;default:throw Error(i(435,n.tag))}}function cu(n,s){var o=E_(n);s.forEach(function(d){if(!o.has(d)){o.add(d);var b=D_.bind(null,n,d);d.then(b,b)}})}function ja(n,s){var o=s.deletions;if(o!==null)for(var d=0;d<o.length;d++){var b=o[d],x=n,F=s,W=F;e:for(;W!==null;){switch(W.tag){case 27:if(Rr(W.type)){Fn=W.stateNode,Ea=!1;break e}break;case 5:Fn=W.stateNode,Ea=!1;break e;case 3:case 4:Fn=W.stateNode.containerInfo,Ea=!0;break e}W=W.return}if(Fn===null)throw Error(i(160));Mv(x,F,b),Fn=null,Ea=!1,x=b.alternate,x!==null&&(x.return=null),b.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Dv(s,n),s=s.sibling}var fs=null;function Dv(n,s){var o=n.alternate,d=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:ja(s,n),_a(n),d&4&&(Er(3,n,n.return),co(3,n),Er(5,n,n.return));break;case 1:ja(s,n),_a(n),d&512&&(Qn||o===null||Cs(o,o.return)),d&64&&Xs&&(n=n.updateQueue,n!==null&&(d=n.callbacks,d!==null&&(o=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=o===null?d:o.concat(d))));break;case 26:var b=fs;if(ja(s,n),_a(n),d&512&&(Qn||o===null||Cs(o,o.return)),d&4){var x=o!==null?o.memoizedState:null;if(d=n.memoizedState,o===null)if(d===null)if(n.stateNode===null){e:{d=n.type,o=n.memoizedProps,b=b.ownerDocument||b;t:switch(d){case"title":x=b.getElementsByTagName("title")[0],(!x||x[re]||x[pt]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=b.createElement(d),b.head.insertBefore(x,b.querySelector("head > title"))),ca(x,d,o),x[pt]=n,ke(x),d=x;break e;case"link":var F=Dx("link","href",b).get(d+(o.href||""));if(F){for(var W=0;W<F.length;W++)if(x=F[W],x.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&x.getAttribute("rel")===(o.rel==null?null:o.rel)&&x.getAttribute("title")===(o.title==null?null:o.title)&&x.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){F.splice(W,1);break t}}x=b.createElement(d),ca(x,d,o),b.head.appendChild(x);break;case"meta":if(F=Dx("meta","content",b).get(d+(o.content||""))){for(W=0;W<F.length;W++)if(x=F[W],x.getAttribute("content")===(o.content==null?null:""+o.content)&&x.getAttribute("name")===(o.name==null?null:o.name)&&x.getAttribute("property")===(o.property==null?null:o.property)&&x.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&x.getAttribute("charset")===(o.charSet==null?null:o.charSet)){F.splice(W,1);break t}}x=b.createElement(d),ca(x,d,o),b.head.appendChild(x);break;default:throw Error(i(468,d))}x[pt]=n,ke(x),d=x}n.stateNode=d}else Ix(b,n.type,n.stateNode);else n.stateNode=kx(b,d,n.memoizedProps);else x!==d?(x===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):x.count--,d===null?Ix(b,n.type,n.stateNode):kx(b,d,n.memoizedProps)):d===null&&n.stateNode!==null&&$m(n,n.memoizedProps,o.memoizedProps)}break;case 27:ja(s,n),_a(n),d&512&&(Qn||o===null||Cs(o,o.return)),o!==null&&d&4&&$m(n,n.memoizedProps,o.memoizedProps);break;case 5:if(ja(s,n),_a(n),d&512&&(Qn||o===null||Cs(o,o.return)),n.flags&32){b=n.stateNode;try{je(b,"")}catch(zt){An(n,n.return,zt)}}d&4&&n.stateNode!=null&&(b=n.memoizedProps,$m(n,b,o!==null?o.memoizedProps:b)),d&1024&&(Um=!0);break;case 6:if(ja(s,n),_a(n),d&4){if(n.stateNode===null)throw Error(i(162));d=n.memoizedProps,o=n.stateNode;try{o.nodeValue=d}catch(zt){An(n,n.return,zt)}}break;case 3:if(ju=null,b=fs,fs=Nu(s.containerInfo),ja(s,n),fs=b,_a(n),d&4&&o!==null&&o.memoizedState.isDehydrated)try{dl(s.containerInfo)}catch(zt){An(n,n.return,zt)}Um&&(Um=!1,Iv(n));break;case 4:d=fs,fs=Nu(n.stateNode.containerInfo),ja(s,n),_a(n),fs=d;break;case 12:ja(s,n),_a(n);break;case 31:ja(s,n),_a(n),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,cu(n,d)));break;case 13:ja(s,n),_a(n),n.child.flags&8192&&n.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(du=at()),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,cu(n,d)));break;case 22:b=n.memoizedState!==null;var he=o!==null&&o.memoizedState!==null,Oe=Xs,tt=Qn;if(Xs=Oe||b,Qn=tt||he,ja(s,n),Qn=tt,Xs=Oe,_a(n),d&8192)e:for(s=n.stateNode,s._visibility=b?s._visibility&-2:s._visibility|1,b&&(o===null||he||Xs||Qn||bi(n)),o=null,s=n;;){if(s.tag===5||s.tag===26){if(o===null){he=o=s;try{if(x=he.stateNode,b)F=x.style,typeof F.setProperty=="function"?F.setProperty("display","none","important"):F.display="none";else{W=he.stateNode;var lt=he.memoizedProps.style,Fe=lt!=null&&lt.hasOwnProperty("display")?lt.display:null;W.style.display=Fe==null||typeof Fe=="boolean"?"":(""+Fe).trim()}}catch(zt){An(he,he.return,zt)}}}else if(s.tag===6){if(o===null){he=s;try{he.stateNode.nodeValue=b?"":he.memoizedProps}catch(zt){An(he,he.return,zt)}}}else if(s.tag===18){if(o===null){he=s;try{var Ye=he.stateNode;b?Nx(Ye,!0):Nx(he.stateNode,!1)}catch(zt){An(he,he.return,zt)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===n)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break e;for(;s.sibling===null;){if(s.return===null||s.return===n)break e;o===s&&(o=null),s=s.return}o===s&&(o=null),s.sibling.return=s.return,s=s.sibling}d&4&&(d=n.updateQueue,d!==null&&(o=d.retryQueue,o!==null&&(d.retryQueue=null,cu(n,o))));break;case 19:ja(s,n),_a(n),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,cu(n,d)));break;case 30:break;case 21:break;default:ja(s,n),_a(n)}}function _a(n){var s=n.flags;if(s&2){try{for(var o,d=n.return;d!==null;){if(jv(d)){o=d;break}d=d.return}if(o==null)throw Error(i(160));switch(o.tag){case 27:var b=o.stateNode,x=Fm(n);ou(n,x,b);break;case 5:var F=o.stateNode;o.flags&32&&(je(F,""),o.flags&=-33);var W=Fm(n);ou(n,W,F);break;case 3:case 4:var he=o.stateNode.containerInfo,Oe=Fm(n);Bm(n,Oe,he);break;default:throw Error(i(161))}}catch(tt){An(n,n.return,tt)}n.flags&=-3}s&4096&&(n.flags&=-4097)}function Iv(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var s=n;Iv(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),n=n.sibling}}function Ws(n,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)Av(n,s.alternate,s),s=s.sibling}function bi(n){for(n=n.child;n!==null;){var s=n;switch(s.tag){case 0:case 11:case 14:case 15:Er(4,s,s.return),bi(s);break;case 1:Cs(s,s.return);var o=s.stateNode;typeof o.componentWillUnmount=="function"&&Nv(s,s.return,o),bi(s);break;case 27:xo(s.stateNode);case 26:case 5:Cs(s,s.return),bi(s);break;case 22:s.memoizedState===null&&bi(s);break;case 30:bi(s);break;default:bi(s)}n=n.sibling}}function Zs(n,s,o){for(o=o&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var d=s.alternate,b=n,x=s,F=x.flags;switch(x.tag){case 0:case 11:case 15:Zs(b,x,o),co(4,x);break;case 1:if(Zs(b,x,o),d=x,b=d.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Oe){An(d,d.return,Oe)}if(d=x,b=d.updateQueue,b!==null){var W=d.stateNode;try{var he=b.shared.hiddenCallbacks;if(he!==null)for(b.shared.hiddenCallbacks=null,b=0;b<he.length;b++)db(he[b],W)}catch(Oe){An(d,d.return,Oe)}}o&&F&64&&wv(x),uo(x,x.return);break;case 27:_v(x);case 26:case 5:Zs(b,x,o),o&&d===null&&F&4&&Ev(x),uo(x,x.return);break;case 12:Zs(b,x,o);break;case 31:Zs(b,x,o),o&&F&4&&Rv(b,x);break;case 13:Zs(b,x,o),o&&F&4&&kv(b,x);break;case 22:x.memoizedState===null&&Zs(b,x,o),uo(x,x.return);break;case 30:break;default:Zs(b,x,o)}s=s.sibling}}function qm(n,s){var o=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),n=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(n=s.memoizedState.cachePool.pool),n!==o&&(n!=null&&n.refCount++,o!=null&&Wl(o))}function Hm(n,s){n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&Wl(n))}function ms(n,s,o,d){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Lv(n,s,o,d),s=s.sibling}function Lv(n,s,o,d){var b=s.flags;switch(s.tag){case 0:case 11:case 15:ms(n,s,o,d),b&2048&&co(9,s);break;case 1:ms(n,s,o,d);break;case 3:ms(n,s,o,d),b&2048&&(n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&Wl(n)));break;case 12:if(b&2048){ms(n,s,o,d),n=s.stateNode;try{var x=s.memoizedProps,F=x.id,W=x.onPostCommit;typeof W=="function"&&W(F,s.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(he){An(s,s.return,he)}}else ms(n,s,o,d);break;case 31:ms(n,s,o,d);break;case 13:ms(n,s,o,d);break;case 23:break;case 22:x=s.stateNode,F=s.alternate,s.memoizedState!==null?x._visibility&2?ms(n,s,o,d):fo(n,s):x._visibility&2?ms(n,s,o,d):(x._visibility|=2,el(n,s,o,d,(s.subtreeFlags&10256)!==0||!1)),b&2048&&qm(F,s);break;case 24:ms(n,s,o,d),b&2048&&Hm(s.alternate,s);break;default:ms(n,s,o,d)}}function el(n,s,o,d,b){for(b=b&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var x=n,F=s,W=o,he=d,Oe=F.flags;switch(F.tag){case 0:case 11:case 15:el(x,F,W,he,b),co(8,F);break;case 23:break;case 22:var tt=F.stateNode;F.memoizedState!==null?tt._visibility&2?el(x,F,W,he,b):fo(x,F):(tt._visibility|=2,el(x,F,W,he,b)),b&&Oe&2048&&qm(F.alternate,F);break;case 24:el(x,F,W,he,b),b&&Oe&2048&&Hm(F.alternate,F);break;default:el(x,F,W,he,b)}s=s.sibling}}function fo(n,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var o=n,d=s,b=d.flags;switch(d.tag){case 22:fo(o,d),b&2048&&qm(d.alternate,d);break;case 24:fo(o,d),b&2048&&Hm(d.alternate,d);break;default:fo(o,d)}s=s.sibling}}var mo=8192;function tl(n,s,o){if(n.subtreeFlags&mo)for(n=n.child;n!==null;)Ov(n,s,o),n=n.sibling}function Ov(n,s,o){switch(n.tag){case 26:tl(n,s,o),n.flags&mo&&n.memoizedState!==null&&uC(o,fs,n.memoizedState,n.memoizedProps);break;case 5:tl(n,s,o);break;case 3:case 4:var d=fs;fs=Nu(n.stateNode.containerInfo),tl(n,s,o),fs=d;break;case 22:n.memoizedState===null&&(d=n.alternate,d!==null&&d.memoizedState!==null?(d=mo,mo=16777216,tl(n,s,o),mo=d):tl(n,s,o));break;default:tl(n,s,o)}}function zv(n){var s=n.alternate;if(s!==null&&(n=s.child,n!==null)){s.child=null;do s=n.sibling,n.sibling=null,n=s;while(n!==null)}}function ho(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var d=s[o];aa=d,Fv(d,n)}zv(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)$v(n),n=n.sibling}function $v(n){switch(n.tag){case 0:case 11:case 15:ho(n),n.flags&2048&&Er(9,n,n.return);break;case 3:ho(n);break;case 12:ho(n);break;case 22:var s=n.stateNode;n.memoizedState!==null&&s._visibility&2&&(n.return===null||n.return.tag!==13)?(s._visibility&=-3,uu(n)):ho(n);break;default:ho(n)}}function uu(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var d=s[o];aa=d,Fv(d,n)}zv(n)}for(n=n.child;n!==null;){switch(s=n,s.tag){case 0:case 11:case 15:Er(8,s,s.return),uu(s);break;case 22:o=s.stateNode,o._visibility&2&&(o._visibility&=-3,uu(s));break;default:uu(s)}n=n.sibling}}function Fv(n,s){for(;aa!==null;){var o=aa;switch(o.tag){case 0:case 11:case 15:Er(8,o,s);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var d=o.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Wl(o.memoizedState.cache)}if(d=o.child,d!==null)d.return=o,aa=d;else e:for(o=n;aa!==null;){d=aa;var b=d.sibling,x=d.return;if(Tv(d),d===o){aa=null;break e}if(b!==null){b.return=x,aa=b;break e}aa=x}}}var j_={getCacheForType:function(n){var s=la(Kn),o=s.data.get(n);return o===void 0&&(o=n(),s.data.set(n,o)),o},cacheSignal:function(){return la(Kn).controller.signal}},__=typeof WeakMap=="function"?WeakMap:Map,jn=0,Dn=null,hn=null,gn=0,Cn=0,Fa=null,jr=!1,nl=!1,Pm=!1,Qs=0,Hn=0,_r=0,vi=0,Vm=0,Ba=0,al=0,po=null,Ca=null,Ym=!1,du=0,Bv=0,fu=1/0,mu=null,Cr=null,Jn=0,Ar=null,sl=null,Js=0,Gm=0,Xm=null,Uv=null,yo=0,Km=null;function Ua(){return(jn&2)!==0&&gn!==0?gn&-gn:I.T!==null?th():_e()}function qv(){if(Ba===0)if((gn&536870912)===0||vn){var n=ct;ct<<=1,(ct&3932160)===0&&(ct=262144),Ba=n}else Ba=536870912;return n=za.current,n!==null&&(n.flags|=32),Ba}function Aa(n,s,o){(n===Dn&&(Cn===2||Cn===9)||n.cancelPendingCommit!==null)&&(rl(n,0),Tr(n,gn,Ba,!1)),te(n,o),((jn&2)===0||n!==Dn)&&(n===Dn&&((jn&2)===0&&(vi|=o),Hn===4&&Tr(n,gn,Ba,!1)),As(n))}function Hv(n,s,o){if((jn&6)!==0)throw Error(i(327));var d=!o&&(s&127)===0&&(s&n.expiredLanes)===0||wt(n,s),b=d?T_(n,s):Zm(n,s,!0),x=d;do{if(b===0){nl&&!d&&Tr(n,s,0,!1);break}else{if(o=n.current.alternate,x&&!C_(o)){b=Zm(n,s,!1),x=!1;continue}if(b===2){if(x=s,n.errorRecoveryDisabledLanes&x)var F=0;else F=n.pendingLanes&-536870913,F=F!==0?F:F&536870912?536870912:0;if(F!==0){s=F;e:{var W=n;b=po;var he=W.current.memoizedState.isDehydrated;if(he&&(rl(W,F).flags|=256),F=Zm(W,F,!1),F!==2){if(Pm&&!he){W.errorRecoveryDisabledLanes|=x,vi|=x,b=4;break e}x=Ca,Ca=b,x!==null&&(Ca===null?Ca=x:Ca.push.apply(Ca,x))}b=F}if(x=!1,b!==2)continue}}if(b===1){rl(n,0),Tr(n,s,0,!0);break}e:{switch(d=n,x=b,x){case 0:case 1:throw Error(i(345));case 4:if((s&4194048)!==s)break;case 6:Tr(d,s,Ba,!jr);break e;case 2:Ca=null;break;case 3:case 5:break;default:throw Error(i(329))}if((s&62914560)===s&&(b=du+300-at(),10<b)){if(Tr(d,s,Ba,!jr),Qt(d,0,!0)!==0)break e;Js=s,d.timeoutHandle=xx(Pv.bind(null,d,o,Ca,mu,Ym,s,Ba,vi,al,jr,x,"Throttled",-0,0),b);break e}Pv(d,o,Ca,mu,Ym,s,Ba,vi,al,jr,x,null,-0,0)}}break}while(!0);As(n)}function Pv(n,s,o,d,b,x,F,W,he,Oe,tt,lt,Fe,Ye){if(n.timeoutHandle=-1,lt=s.subtreeFlags,lt&8192||(lt&16785408)===16785408){lt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ra},Ov(s,x,lt);var zt=(x&62914560)===x?du-at():(x&4194048)===x?Bv-at():0;if(zt=dC(lt,zt),zt!==null){Js=x,n.cancelPendingCommit=zt(Qv.bind(null,n,s,x,o,d,b,F,W,he,tt,lt,null,Fe,Ye)),Tr(n,x,F,!Oe);return}}Qv(n,s,x,o,d,b,F,W,he)}function C_(n){for(var s=n;;){var o=s.tag;if((o===0||o===11||o===15)&&s.flags&16384&&(o=s.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var d=0;d<o.length;d++){var b=o[d],x=b.getSnapshot;b=b.value;try{if(!La(x(),b))return!1}catch{return!1}}if(o=s.child,s.subtreeFlags&16384&&o!==null)o.return=s,s=o;else{if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Tr(n,s,o,d){s&=~Vm,s&=~vi,n.suspendedLanes|=s,n.pingedLanes&=~s,d&&(n.warmLanes|=s),d=n.expirationTimes;for(var b=s;0<b;){var x=31-Te(b),F=1<<x;d[x]=-1,b&=~F}o!==0&&ve(n,o,s)}function hu(){return(jn&6)===0?(go(0),!1):!0}function Wm(){if(hn!==null){if(Cn===0)var n=hn.return;else n=hn,qs=ui=null,fm(n),Ki=null,Ql=0,n=hn;for(;n!==null;)Sv(n.alternate,n),n=n.return;hn=null}}function rl(n,s){var o=n.timeoutHandle;o!==-1&&(n.timeoutHandle=-1,G_(o)),o=n.cancelPendingCommit,o!==null&&(n.cancelPendingCommit=null,o()),Js=0,Wm(),Dn=n,hn=o=Bs(n.current,null),gn=s,Cn=0,Fa=null,jr=!1,nl=wt(n,s),Pm=!1,al=Ba=Vm=vi=_r=Hn=0,Ca=po=null,Ym=!1,(s&8)!==0&&(s|=s&32);var d=n.entangledLanes;if(d!==0)for(n=n.entanglements,d&=s;0<d;){var b=31-Te(d),x=1<<b;s|=n[b],d&=~x}return Qs=s,Lc(),o}function Vv(n,s){an=null,I.H=io,s===Xi||s===Hc?(s=lb(),Cn=3):s===em?(s=lb(),Cn=4):Cn=s===Am?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Fa=s,hn===null&&(Hn=1,au(n,Ka(s,n.current)))}function Yv(){var n=za.current;return n===null?!0:(gn&4194048)===gn?Ja===null:(gn&62914560)===gn||(gn&536870912)!==0?n===Ja:!1}function Gv(){var n=I.H;return I.H=io,n===null?io:n}function Xv(){var n=I.A;return I.A=j_,n}function pu(){Hn=4,jr||(gn&4194048)!==gn&&za.current!==null||(nl=!0),(_r&134217727)===0&&(vi&134217727)===0||Dn===null||Tr(Dn,gn,Ba,!1)}function Zm(n,s,o){var d=jn;jn|=2;var b=Gv(),x=Xv();(Dn!==n||gn!==s)&&(mu=null,rl(n,s)),s=!1;var F=Hn;e:do try{if(Cn!==0&&hn!==null){var W=hn,he=Fa;switch(Cn){case 8:Wm(),F=6;break e;case 3:case 2:case 9:case 6:za.current===null&&(s=!0);var Oe=Cn;if(Cn=0,Fa=null,il(n,W,he,Oe),o&&nl){F=0;break e}break;default:Oe=Cn,Cn=0,Fa=null,il(n,W,he,Oe)}}A_(),F=Hn;break}catch(tt){Vv(n,tt)}while(!0);return s&&n.shellSuspendCounter++,qs=ui=null,jn=d,I.H=b,I.A=x,hn===null&&(Dn=null,gn=0,Lc()),F}function A_(){for(;hn!==null;)Kv(hn)}function T_(n,s){var o=jn;jn|=2;var d=Gv(),b=Xv();Dn!==n||gn!==s?(mu=null,fu=at()+500,rl(n,s)):nl=wt(n,s);e:do try{if(Cn!==0&&hn!==null){s=hn;var x=Fa;t:switch(Cn){case 1:Cn=0,Fa=null,il(n,s,x,1);break;case 2:case 9:if(rb(x)){Cn=0,Fa=null,Wv(s);break}s=function(){Cn!==2&&Cn!==9||Dn!==n||(Cn=7),As(n)},x.then(s,s);break e;case 3:Cn=7;break e;case 4:Cn=5;break e;case 7:rb(x)?(Cn=0,Fa=null,Wv(s)):(Cn=0,Fa=null,il(n,s,x,7));break;case 5:var F=null;switch(hn.tag){case 26:F=hn.memoizedState;case 5:case 27:var W=hn;if(F?Lx(F):W.stateNode.complete){Cn=0,Fa=null;var he=W.sibling;if(he!==null)hn=he;else{var Oe=W.return;Oe!==null?(hn=Oe,yu(Oe)):hn=null}break t}}Cn=0,Fa=null,il(n,s,x,5);break;case 6:Cn=0,Fa=null,il(n,s,x,6);break;case 8:Wm(),Hn=6;break e;default:throw Error(i(462))}}M_();break}catch(tt){Vv(n,tt)}while(!0);return qs=ui=null,I.H=d,I.A=b,jn=o,hn!==null?0:(Dn=null,gn=0,Lc(),Hn)}function M_(){for(;hn!==null&&!Ct();)Kv(hn)}function Kv(n){var s=vv(n.alternate,n,Qs);n.memoizedProps=n.pendingProps,s===null?yu(n):hn=s}function Wv(n){var s=n,o=s.alternate;switch(s.tag){case 15:case 0:s=mv(o,s,s.pendingProps,s.type,void 0,gn);break;case 11:s=mv(o,s,s.pendingProps,s.type.render,s.ref,gn);break;case 5:fm(s);default:Sv(o,s),s=hn=Xg(s,Qs),s=vv(o,s,Qs)}n.memoizedProps=n.pendingProps,s===null?yu(n):hn=s}function il(n,s,o,d){qs=ui=null,fm(s),Ki=null,Ql=0;var b=s.return;try{if(b_(n,b,s,o,gn)){Hn=1,au(n,Ka(o,n.current)),hn=null;return}}catch(x){if(b!==null)throw hn=b,x;Hn=1,au(n,Ka(o,n.current)),hn=null;return}s.flags&32768?(vn||d===1?n=!0:nl||(gn&536870912)!==0?n=!1:(jr=n=!0,(d===2||d===9||d===3||d===6)&&(d=za.current,d!==null&&d.tag===13&&(d.flags|=16384))),Zv(s,n)):yu(s)}function yu(n){var s=n;do{if((s.flags&32768)!==0){Zv(s,jr);return}n=s.return;var o=S_(s.alternate,s,Qs);if(o!==null){hn=o;return}if(s=s.sibling,s!==null){hn=s;return}hn=s=n}while(s!==null);Hn===0&&(Hn=5)}function Zv(n,s){do{var o=w_(n.alternate,n);if(o!==null){o.flags&=32767,hn=o;return}if(o=n.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!s&&(n=n.sibling,n!==null)){hn=n;return}hn=n=o}while(n!==null);Hn=6,hn=null}function Qv(n,s,o,d,b,x,F,W,he){n.cancelPendingCommit=null;do gu();while(Jn!==0);if((jn&6)!==0)throw Error(i(327));if(s!==null){if(s===n.current)throw Error(i(177));if(x=s.lanes|s.childLanes,x|=Ff,be(n,o,x,F,W,he),n===Dn&&(hn=Dn=null,gn=0),sl=s,Ar=n,Js=o,Gm=x,Xm=b,Uv=d,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,I_(Pe,function(){return ax(),null})):(n.callbackNode=null,n.callbackPriority=0),d=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||d){d=I.T,I.T=null,b=L.p,L.p=2,F=jn,jn|=4;try{N_(n,s,o)}finally{jn=F,L.p=b,I.T=d}}Jn=1,Jv(),ex(),tx()}}function Jv(){if(Jn===1){Jn=0;var n=Ar,s=sl,o=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||o){o=I.T,I.T=null;var d=L.p;L.p=2;var b=jn;jn|=4;try{Dv(s,n);var x=ch,F=Fg(n.containerInfo),W=x.focusedElem,he=x.selectionRange;if(F!==W&&W&&W.ownerDocument&&$g(W.ownerDocument.documentElement,W)){if(he!==null&&If(W)){var Oe=he.start,tt=he.end;if(tt===void 0&&(tt=Oe),"selectionStart"in W)W.selectionStart=Oe,W.selectionEnd=Math.min(tt,W.value.length);else{var lt=W.ownerDocument||document,Fe=lt&&lt.defaultView||window;if(Fe.getSelection){var Ye=Fe.getSelection(),zt=W.textContent.length,Wt=Math.min(he.start,zt),kn=he.end===void 0?Wt:Math.min(he.end,zt);!Ye.extend&&Wt>kn&&(F=kn,kn=Wt,Wt=F);var Ce=zg(W,Wt),xe=zg(W,kn);if(Ce&&xe&&(Ye.rangeCount!==1||Ye.anchorNode!==Ce.node||Ye.anchorOffset!==Ce.offset||Ye.focusNode!==xe.node||Ye.focusOffset!==xe.offset)){var Ie=lt.createRange();Ie.setStart(Ce.node,Ce.offset),Ye.removeAllRanges(),Wt>kn?(Ye.addRange(Ie),Ye.extend(xe.node,xe.offset)):(Ie.setEnd(xe.node,xe.offset),Ye.addRange(Ie))}}}}for(lt=[],Ye=W;Ye=Ye.parentNode;)Ye.nodeType===1&&lt.push({element:Ye,left:Ye.scrollLeft,top:Ye.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<lt.length;W++){var rt=lt[W];rt.element.scrollLeft=rt.left,rt.element.scrollTop=rt.top}}Tu=!!oh,ch=oh=null}finally{jn=b,L.p=d,I.T=o}}n.current=s,Jn=2}}function ex(){if(Jn===2){Jn=0;var n=Ar,s=sl,o=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||o){o=I.T,I.T=null;var d=L.p;L.p=2;var b=jn;jn|=4;try{Av(n,s.alternate,s)}finally{jn=b,L.p=d,I.T=o}}Jn=3}}function tx(){if(Jn===4||Jn===3){Jn=0,Be();var n=Ar,s=sl,o=Js,d=Uv;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Jn=5:(Jn=0,sl=Ar=null,nx(n,n.pendingLanes));var b=n.pendingLanes;if(b===0&&(Cr=null),ie(o),s=s.stateNode,Xe&&typeof Xe.onCommitFiberRoot=="function")try{Xe.onCommitFiberRoot(Ge,s,void 0,(s.current.flags&128)===128)}catch{}if(d!==null){s=I.T,b=L.p,L.p=2,I.T=null;try{for(var x=n.onRecoverableError,F=0;F<d.length;F++){var W=d[F];x(W.value,{componentStack:W.stack})}}finally{I.T=s,L.p=b}}(Js&3)!==0&&gu(),As(n),b=n.pendingLanes,(o&261930)!==0&&(b&42)!==0?n===Km?yo++:(yo=0,Km=n):yo=0,go(0)}}function nx(n,s){(n.pooledCacheLanes&=s)===0&&(s=n.pooledCache,s!=null&&(n.pooledCache=null,Wl(s)))}function gu(){return Jv(),ex(),tx(),ax()}function ax(){if(Jn!==5)return!1;var n=Ar,s=Gm;Gm=0;var o=ie(Js),d=I.T,b=L.p;try{L.p=32>o?32:o,I.T=null,o=Xm,Xm=null;var x=Ar,F=Js;if(Jn=0,sl=Ar=null,Js=0,(jn&6)!==0)throw Error(i(331));var W=jn;if(jn|=4,$v(x.current),Lv(x,x.current,F,o),jn=W,go(0,!1),Xe&&typeof Xe.onPostCommitFiberRoot=="function")try{Xe.onPostCommitFiberRoot(Ge,x)}catch{}return!0}finally{L.p=b,I.T=d,nx(n,s)}}function sx(n,s,o){s=Ka(o,s),s=Cm(n.stateNode,s,2),n=Sr(n,s,2),n!==null&&(te(n,2),As(n))}function An(n,s,o){if(n.tag===3)sx(n,n,o);else for(;s!==null;){if(s.tag===3){sx(s,n,o);break}else if(s.tag===1){var d=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Cr===null||!Cr.has(d))){n=Ka(o,n),o=rv(2),d=Sr(s,o,2),d!==null&&(iv(o,d,s,n),te(d,2),As(d));break}}s=s.return}}function Qm(n,s,o){var d=n.pingCache;if(d===null){d=n.pingCache=new __;var b=new Set;d.set(s,b)}else b=d.get(s),b===void 0&&(b=new Set,d.set(s,b));b.has(o)||(Pm=!0,b.add(o),n=R_.bind(null,n,s,o),s.then(n,n))}function R_(n,s,o){var d=n.pingCache;d!==null&&d.delete(s),n.pingedLanes|=n.suspendedLanes&o,n.warmLanes&=~o,Dn===n&&(gn&o)===o&&(Hn===4||Hn===3&&(gn&62914560)===gn&&300>at()-du?(jn&2)===0&&rl(n,0):Vm|=o,al===gn&&(al=0)),As(n)}function rx(n,s){s===0&&(s=Ht()),n=li(n,s),n!==null&&(te(n,s),As(n))}function k_(n){var s=n.memoizedState,o=0;s!==null&&(o=s.retryLane),rx(n,o)}function D_(n,s){var o=0;switch(n.tag){case 31:case 13:var d=n.stateNode,b=n.memoizedState;b!==null&&(o=b.retryLane);break;case 19:d=n.stateNode;break;case 22:d=n.stateNode._retryCache;break;default:throw Error(i(314))}d!==null&&d.delete(s),rx(n,o)}function I_(n,s){return _t(n,s)}var bu=null,ll=null,Jm=!1,vu=!1,eh=!1,Mr=0;function As(n){n!==ll&&n.next===null&&(ll===null?bu=ll=n:ll=ll.next=n),vu=!0,Jm||(Jm=!0,O_())}function go(n,s){if(!eh&&vu){eh=!0;do for(var o=!1,d=bu;d!==null;){if(n!==0){var b=d.pendingLanes;if(b===0)var x=0;else{var F=d.suspendedLanes,W=d.pingedLanes;x=(1<<31-Te(42|n)+1)-1,x&=b&~(F&~W),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(o=!0,cx(d,x))}else x=gn,x=Qt(d,d===Dn?x:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(x&3)===0||wt(d,x)||(o=!0,cx(d,x));d=d.next}while(o);eh=!1}}function L_(){ix()}function ix(){vu=Jm=!1;var n=0;Mr!==0&&Y_()&&(n=Mr);for(var s=at(),o=null,d=bu;d!==null;){var b=d.next,x=lx(d,s);x===0?(d.next=null,o===null?bu=b:o.next=b,b===null&&(ll=o)):(o=d,(n!==0||(x&3)!==0)&&(vu=!0)),d=b}Jn!==0&&Jn!==5||go(n),Mr!==0&&(Mr=0)}function lx(n,s){for(var o=n.suspendedLanes,d=n.pingedLanes,b=n.expirationTimes,x=n.pendingLanes&-62914561;0<x;){var F=31-Te(x),W=1<<F,he=b[F];he===-1?((W&o)===0||(W&d)!==0)&&(b[F]=Ft(W,s)):he<=s&&(n.expiredLanes|=W),x&=~W}if(s=Dn,o=gn,o=Qt(n,n===s?o:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),d=n.callbackNode,o===0||n===s&&(Cn===2||Cn===9)||n.cancelPendingCommit!==null)return d!==null&&d!==null&&Tt(d),n.callbackNode=null,n.callbackPriority=0;if((o&3)===0||wt(n,o)){if(s=o&-o,s===n.callbackPriority)return s;switch(d!==null&&Tt(d),ie(o)){case 2:case 8:o=ye;break;case 32:o=Pe;break;case 268435456:o=pe;break;default:o=Pe}return d=ox.bind(null,n),o=_t(o,d),n.callbackPriority=s,n.callbackNode=o,s}return d!==null&&d!==null&&Tt(d),n.callbackPriority=2,n.callbackNode=null,2}function ox(n,s){if(Jn!==0&&Jn!==5)return n.callbackNode=null,n.callbackPriority=0,null;var o=n.callbackNode;if(gu()&&n.callbackNode!==o)return null;var d=gn;return d=Qt(n,n===Dn?d:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),d===0?null:(Hv(n,d,s),lx(n,at()),n.callbackNode!=null&&n.callbackNode===o?ox.bind(null,n):null)}function cx(n,s){if(gu())return null;Hv(n,s,!0)}function O_(){X_(function(){(jn&6)!==0?_t(ce,L_):ix()})}function th(){if(Mr===0){var n=Yi;n===0&&(n=Ke,Ke<<=1,(Ke&261888)===0&&(Ke=256)),Mr=n}return Mr}function ux(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:ma(""+n)}function dx(n,s){var o=s.ownerDocument.createElement("input");return o.name=s.name,o.value=s.value,n.id&&o.setAttribute("form",n.id),s.parentNode.insertBefore(o,s),n=new FormData(n),o.parentNode.removeChild(o),n}function z_(n,s,o,d,b){if(s==="submit"&&o&&o.stateNode===b){var x=ux((b[Ee]||null).action),F=d.submitter;F&&(s=(s=F[Ee]||null)?ux(s.formAction):F.getAttribute("formAction"),s!==null&&(x=s,F=null));var W=new Rc("action","action",null,d,b);n.push({event:W,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(Mr!==0){var he=F?dx(b,F):new FormData(b);Sm(o,{pending:!0,data:he,method:b.method,action:x},null,he)}}else typeof x=="function"&&(W.preventDefault(),he=F?dx(b,F):new FormData(b),Sm(o,{pending:!0,data:he,method:b.method,action:x},x,he))},currentTarget:b}]})}}for(var nh=0;nh<$f.length;nh++){var ah=$f[nh],$_=ah.toLowerCase(),F_=ah[0].toUpperCase()+ah.slice(1);ds($_,"on"+F_)}ds(qg,"onAnimationEnd"),ds(Hg,"onAnimationIteration"),ds(Pg,"onAnimationStart"),ds("dblclick","onDoubleClick"),ds("focusin","onFocus"),ds("focusout","onBlur"),ds(t_,"onTransitionRun"),ds(n_,"onTransitionStart"),ds(a_,"onTransitionCancel"),ds(Vg,"onTransitionEnd"),ae("onMouseEnter",["mouseout","mouseover"]),ae("onMouseLeave",["mouseout","mouseover"]),ae("onPointerEnter",["pointerout","pointerover"]),ae("onPointerLeave",["pointerout","pointerover"]),K("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),K("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),K("onBeforeInput",["compositionend","keypress","textInput","paste"]),K("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),K("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),K("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var bo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),B_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(bo));function fx(n,s){s=(s&4)!==0;for(var o=0;o<n.length;o++){var d=n[o],b=d.event;d=d.listeners;e:{var x=void 0;if(s)for(var F=d.length-1;0<=F;F--){var W=d[F],he=W.instance,Oe=W.currentTarget;if(W=W.listener,he!==x&&b.isPropagationStopped())break e;x=W,b.currentTarget=Oe;try{x(b)}catch(tt){Ic(tt)}b.currentTarget=null,x=he}else for(F=0;F<d.length;F++){if(W=d[F],he=W.instance,Oe=W.currentTarget,W=W.listener,he!==x&&b.isPropagationStopped())break e;x=W,b.currentTarget=Oe;try{x(b)}catch(tt){Ic(tt)}b.currentTarget=null,x=he}}}}function pn(n,s){var o=s[le];o===void 0&&(o=s[le]=new Set);var d=n+"__bubble";o.has(d)||(mx(s,n,2,!1),o.add(d))}function sh(n,s,o){var d=0;s&&(d|=4),mx(o,n,d,s)}var xu="_reactListening"+Math.random().toString(36).slice(2);function rh(n){if(!n[xu]){n[xu]=!0,Ve.forEach(function(o){o!=="selectionchange"&&(B_.has(o)||sh(o,!1,n),sh(o,!0,n))});var s=n.nodeType===9?n:n.ownerDocument;s===null||s[xu]||(s[xu]=!0,sh("selectionchange",!1,s))}}function mx(n,s,o,d){switch(qx(s)){case 2:var b=hC;break;case 8:b=pC;break;default:b=xh}o=b.bind(null,s,o,n),b=void 0,!Zt||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(b=!0),d?b!==void 0?n.addEventListener(s,o,{capture:!0,passive:b}):n.addEventListener(s,o,!0):b!==void 0?n.addEventListener(s,o,{passive:b}):n.addEventListener(s,o,!1)}function ih(n,s,o,d,b){var x=d;if((s&1)===0&&(s&2)===0&&d!==null)e:for(;;){if(d===null)return;var F=d.tag;if(F===3||F===4){var W=d.stateNode.containerInfo;if(W===b)break;if(F===4)for(F=d.return;F!==null;){var he=F.tag;if((he===3||he===4)&&F.stateNode.containerInfo===b)return;F=F.return}for(;W!==null;){if(F=We(W),F===null)return;if(he=F.tag,he===5||he===6||he===26||he===27){d=x=F;continue e}W=W.parentNode}}d=d.return}Gt(function(){var Oe=x,tt=Es(o),lt=[];e:{var Fe=Yg.get(n);if(Fe!==void 0){var Ye=Rc,zt=n;switch(n){case"keypress":if(Oi(o)===0)break e;case"keydown":case"keyup":Ye=Dj;break;case"focusin":zt="focus",Ye=Tf;break;case"focusout":zt="blur",Ye=Tf;break;case"beforeblur":case"afterblur":Ye=Tf;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ye=Sg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ye=Sj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ye=Oj;break;case qg:case Hg:case Pg:Ye=Ej;break;case Vg:Ye=$j;break;case"scroll":case"scrollend":Ye=vj;break;case"wheel":Ye=Bj;break;case"copy":case"cut":case"paste":Ye=_j;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ye=Ng;break;case"toggle":case"beforetoggle":Ye=qj}var Wt=(s&4)!==0,kn=!Wt&&(n==="scroll"||n==="scrollend"),Ce=Wt?Fe!==null?Fe+"Capture":null:Fe;Wt=[];for(var xe=Oe,Ie;xe!==null;){var rt=xe;if(Ie=rt.stateNode,rt=rt.tag,rt!==5&&rt!==26&&rt!==27||Ie===null||Ce===null||(rt=nn(xe,Ce),rt!=null&&Wt.push(vo(xe,rt,Ie))),kn)break;xe=xe.return}0<Wt.length&&(Fe=new Ye(Fe,zt,null,o,tt),lt.push({event:Fe,listeners:Wt}))}}if((s&7)===0){e:{if(Fe=n==="mouseover"||n==="pointerover",Ye=n==="mouseout"||n==="pointerout",Fe&&o!==ha&&(zt=o.relatedTarget||o.fromElement)&&(We(zt)||zt[st]))break e;if((Ye||Fe)&&(Fe=tt.window===tt?tt:(Fe=tt.ownerDocument)?Fe.defaultView||Fe.parentWindow:window,Ye?(zt=o.relatedTarget||o.toElement,Ye=Oe,zt=zt?We(zt):null,zt!==null&&(kn=c(zt),Wt=zt.tag,zt!==kn||Wt!==5&&Wt!==27&&Wt!==6)&&(zt=null)):(Ye=null,zt=Oe),Ye!==zt)){if(Wt=Sg,rt="onMouseLeave",Ce="onMouseEnter",xe="mouse",(n==="pointerout"||n==="pointerover")&&(Wt=Ng,rt="onPointerLeave",Ce="onPointerEnter",xe="pointer"),kn=Ye==null?Fe:Qe(Ye),Ie=zt==null?Fe:Qe(zt),Fe=new Wt(rt,xe+"leave",Ye,o,tt),Fe.target=kn,Fe.relatedTarget=Ie,rt=null,We(tt)===Oe&&(Wt=new Wt(Ce,xe+"enter",zt,o,tt),Wt.target=Ie,Wt.relatedTarget=kn,rt=Wt),kn=rt,Ye&&zt)t:{for(Wt=U_,Ce=Ye,xe=zt,Ie=0,rt=Ce;rt;rt=Wt(rt))Ie++;rt=0;for(var Yt=xe;Yt;Yt=Wt(Yt))rt++;for(;0<Ie-rt;)Ce=Wt(Ce),Ie--;for(;0<rt-Ie;)xe=Wt(xe),rt--;for(;Ie--;){if(Ce===xe||xe!==null&&Ce===xe.alternate){Wt=Ce;break t}Ce=Wt(Ce),xe=Wt(xe)}Wt=null}else Wt=null;Ye!==null&&hx(lt,Fe,Ye,Wt,!1),zt!==null&&kn!==null&&hx(lt,kn,zt,Wt,!0)}}e:{if(Fe=Oe?Qe(Oe):window,Ye=Fe.nodeName&&Fe.nodeName.toLowerCase(),Ye==="select"||Ye==="input"&&Fe.type==="file")var xn=Rg;else if(Tg(Fe))if(kg)xn=Qj;else{xn=Wj;var Bt=Kj}else Ye=Fe.nodeName,!Ye||Ye.toLowerCase()!=="input"||Fe.type!=="checkbox"&&Fe.type!=="radio"?Oe&&Vt(Oe.elementType)&&(xn=Rg):xn=Zj;if(xn&&(xn=xn(n,Oe))){Mg(lt,xn,o,tt);break e}Bt&&Bt(n,Fe,Oe),n==="focusout"&&Oe&&Fe.type==="number"&&Oe.memoizedProps.value!=null&&ai(Fe,"number",Fe.value)}switch(Bt=Oe?Qe(Oe):window,n){case"focusin":(Tg(Bt)||Bt.contentEditable==="true")&&($i=Bt,Lf=Oe,Gl=null);break;case"focusout":Gl=Lf=$i=null;break;case"mousedown":Of=!0;break;case"contextmenu":case"mouseup":case"dragend":Of=!1,Bg(lt,o,tt);break;case"selectionchange":if(e_)break;case"keydown":case"keyup":Bg(lt,o,tt)}var sn;if(Rf)e:{switch(n){case"compositionstart":var bn="onCompositionStart";break e;case"compositionend":bn="onCompositionEnd";break e;case"compositionupdate":bn="onCompositionUpdate";break e}bn=void 0}else zi?Cg(n,o)&&(bn="onCompositionEnd"):n==="keydown"&&o.keyCode===229&&(bn="onCompositionStart");bn&&(Eg&&o.locale!=="ko"&&(zi||bn!=="onCompositionStart"?bn==="onCompositionEnd"&&zi&&(sn=us()):(Ln=tt,Ia="value"in Ln?Ln.value:Ln.textContent,zi=!0)),Bt=Su(Oe,bn),0<Bt.length&&(bn=new wg(bn,n,null,o,tt),lt.push({event:bn,listeners:Bt}),sn?bn.data=sn:(sn=Ag(o),sn!==null&&(bn.data=sn)))),(sn=Pj?Vj(n,o):Yj(n,o))&&(bn=Su(Oe,"onBeforeInput"),0<bn.length&&(Bt=new wg("onBeforeInput","beforeinput",null,o,tt),lt.push({event:Bt,listeners:bn}),Bt.data=sn)),z_(lt,n,Oe,o,tt)}fx(lt,s)})}function vo(n,s,o){return{instance:n,listener:s,currentTarget:o}}function Su(n,s){for(var o=s+"Capture",d=[];n!==null;){var b=n,x=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||x===null||(b=nn(n,o),b!=null&&d.unshift(vo(n,b,x)),b=nn(n,s),b!=null&&d.push(vo(n,b,x))),n.tag===3)return d;n=n.return}return[]}function U_(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function hx(n,s,o,d,b){for(var x=s._reactName,F=[];o!==null&&o!==d;){var W=o,he=W.alternate,Oe=W.stateNode;if(W=W.tag,he!==null&&he===d)break;W!==5&&W!==26&&W!==27||Oe===null||(he=Oe,b?(Oe=nn(o,x),Oe!=null&&F.unshift(vo(o,Oe,he))):b||(Oe=nn(o,x),Oe!=null&&F.push(vo(o,Oe,he)))),o=o.return}F.length!==0&&n.push({event:s,listeners:F})}var q_=/\r\n?/g,H_=/\u0000|\uFFFD/g;function px(n){return(typeof n=="string"?n:""+n).replace(q_,`
`).replace(H_,"")}function yx(n,s){return s=px(s),px(n)===s}function Rn(n,s,o,d,b,x){switch(o){case"children":typeof d=="string"?s==="body"||s==="textarea"&&d===""||je(n,d):(typeof d=="number"||typeof d=="bigint")&&s!=="body"&&je(n,""+d);break;case"className":It(n,"class",d);break;case"tabIndex":It(n,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":It(n,o,d);break;case"style":mn(n,d,x);break;case"data":if(s!=="object"){It(n,"data",d);break}case"src":case"href":if(d===""&&(s!=="a"||o!=="href")){n.removeAttribute(o);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){n.removeAttribute(o);break}d=ma(""+d),n.setAttribute(o,d);break;case"action":case"formAction":if(typeof d=="function"){n.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(o==="formAction"?(s!=="input"&&Rn(n,s,"name",b.name,b,null),Rn(n,s,"formEncType",b.formEncType,b,null),Rn(n,s,"formMethod",b.formMethod,b,null),Rn(n,s,"formTarget",b.formTarget,b,null)):(Rn(n,s,"encType",b.encType,b,null),Rn(n,s,"method",b.method,b,null),Rn(n,s,"target",b.target,b,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){n.removeAttribute(o);break}d=ma(""+d),n.setAttribute(o,d);break;case"onClick":d!=null&&(n.onclick=ra);break;case"onScroll":d!=null&&pn("scroll",n);break;case"onScrollEnd":d!=null&&pn("scrollend",n);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(o=d.__html,o!=null){if(b.children!=null)throw Error(i(60));n.innerHTML=o}}break;case"multiple":n.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":n.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){n.removeAttribute("xlink:href");break}o=ma(""+d),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(o,""+d):n.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(o,""):n.removeAttribute(o);break;case"capture":case"download":d===!0?n.setAttribute(o,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(o,d):n.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?n.setAttribute(o,d):n.removeAttribute(o);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?n.removeAttribute(o):n.setAttribute(o,d);break;case"popover":pn("beforetoggle",n),pn("toggle",n),jt(n,"popover",d);break;case"xlinkActuate":tn(n,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":tn(n,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":tn(n,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":tn(n,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":tn(n,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":tn(n,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":tn(n,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":tn(n,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":tn(n,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":jt(n,"is",d);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=En.get(o)||o,jt(n,o,d))}}function lh(n,s,o,d,b,x){switch(o){case"style":mn(n,d,x);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(o=d.__html,o!=null){if(b.children!=null)throw Error(i(60));n.innerHTML=o}}break;case"children":typeof d=="string"?je(n,d):(typeof d=="number"||typeof d=="bigint")&&je(n,""+d);break;case"onScroll":d!=null&&pn("scroll",n);break;case"onScrollEnd":d!=null&&pn("scrollend",n);break;case"onClick":d!=null&&(n.onclick=ra);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ft.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(b=o.endsWith("Capture"),s=o.slice(2,b?o.length-7:void 0),x=n[Ee]||null,x=x!=null?x[o]:null,typeof x=="function"&&n.removeEventListener(s,x,b),typeof d=="function")){typeof x!="function"&&x!==null&&(o in n?n[o]=null:n.hasAttribute(o)&&n.removeAttribute(o)),n.addEventListener(s,d,b);break e}o in n?n[o]=d:d===!0?n.setAttribute(o,""):jt(n,o,d)}}}function ca(n,s,o){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":pn("error",n),pn("load",n);var d=!1,b=!1,x;for(x in o)if(o.hasOwnProperty(x)){var F=o[x];if(F!=null)switch(x){case"src":d=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:Rn(n,s,x,F,o,null)}}b&&Rn(n,s,"srcSet",o.srcSet,o,null),d&&Rn(n,s,"src",o.src,o,null);return;case"input":pn("invalid",n);var W=x=F=b=null,he=null,Oe=null;for(d in o)if(o.hasOwnProperty(d)){var tt=o[d];if(tt!=null)switch(d){case"name":b=tt;break;case"type":F=tt;break;case"checked":he=tt;break;case"defaultChecked":Oe=tt;break;case"value":x=tt;break;case"defaultValue":W=tt;break;case"children":case"dangerouslySetInnerHTML":if(tt!=null)throw Error(i(137,s));break;default:Rn(n,s,d,tt,o,null)}}ni(n,x,W,he,Oe,F,b,!1);return;case"select":pn("invalid",n),d=F=x=null;for(b in o)if(o.hasOwnProperty(b)&&(W=o[b],W!=null))switch(b){case"value":x=W;break;case"defaultValue":F=W;break;case"multiple":d=W;default:Rn(n,s,b,W,o,null)}s=x,o=F,n.multiple=!!d,s!=null?cs(n,!!d,s,!1):o!=null&&cs(n,!!d,o,!0);return;case"textarea":pn("invalid",n),x=b=d=null;for(F in o)if(o.hasOwnProperty(F)&&(W=o[F],W!=null))switch(F){case"value":d=W;break;case"defaultValue":b=W;break;case"children":x=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(i(91));break;default:Rn(n,s,F,W,o,null)}ue(n,d,b,x);return;case"option":for(he in o)if(o.hasOwnProperty(he)&&(d=o[he],d!=null))switch(he){case"selected":n.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:Rn(n,s,he,d,o,null)}return;case"dialog":pn("beforetoggle",n),pn("toggle",n),pn("cancel",n),pn("close",n);break;case"iframe":case"object":pn("load",n);break;case"video":case"audio":for(d=0;d<bo.length;d++)pn(bo[d],n);break;case"image":pn("error",n),pn("load",n);break;case"details":pn("toggle",n);break;case"embed":case"source":case"link":pn("error",n),pn("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Oe in o)if(o.hasOwnProperty(Oe)&&(d=o[Oe],d!=null))switch(Oe){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:Rn(n,s,Oe,d,o,null)}return;default:if(Vt(s)){for(tt in o)o.hasOwnProperty(tt)&&(d=o[tt],d!==void 0&&lh(n,s,tt,d,o,void 0));return}}for(W in o)o.hasOwnProperty(W)&&(d=o[W],d!=null&&Rn(n,s,W,d,o,null))}function P_(n,s,o,d){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,x=null,F=null,W=null,he=null,Oe=null,tt=null;for(Ye in o){var lt=o[Ye];if(o.hasOwnProperty(Ye)&&lt!=null)switch(Ye){case"checked":break;case"value":break;case"defaultValue":he=lt;default:d.hasOwnProperty(Ye)||Rn(n,s,Ye,null,d,lt)}}for(var Fe in d){var Ye=d[Fe];if(lt=o[Fe],d.hasOwnProperty(Fe)&&(Ye!=null||lt!=null))switch(Fe){case"type":x=Ye;break;case"name":b=Ye;break;case"checked":Oe=Ye;break;case"defaultChecked":tt=Ye;break;case"value":F=Ye;break;case"defaultValue":W=Ye;break;case"children":case"dangerouslySetInnerHTML":if(Ye!=null)throw Error(i(137,s));break;default:Ye!==lt&&Rn(n,s,Fe,Ye,d,lt)}}os(n,F,W,he,Oe,tt,x,b);return;case"select":Ye=F=W=Fe=null;for(x in o)if(he=o[x],o.hasOwnProperty(x)&&he!=null)switch(x){case"value":break;case"multiple":Ye=he;default:d.hasOwnProperty(x)||Rn(n,s,x,null,d,he)}for(b in d)if(x=d[b],he=o[b],d.hasOwnProperty(b)&&(x!=null||he!=null))switch(b){case"value":Fe=x;break;case"defaultValue":W=x;break;case"multiple":F=x;default:x!==he&&Rn(n,s,b,x,d,he)}s=W,o=F,d=Ye,Fe!=null?cs(n,!!o,Fe,!1):!!d!=!!o&&(s!=null?cs(n,!!o,s,!0):cs(n,!!o,o?[]:"",!1));return;case"textarea":Ye=Fe=null;for(W in o)if(b=o[W],o.hasOwnProperty(W)&&b!=null&&!d.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:Rn(n,s,W,null,d,b)}for(F in d)if(b=d[F],x=o[F],d.hasOwnProperty(F)&&(b!=null||x!=null))switch(F){case"value":Fe=b;break;case"defaultValue":Ye=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(i(91));break;default:b!==x&&Rn(n,s,F,b,d,x)}Yn(n,Fe,Ye);return;case"option":for(var zt in o)if(Fe=o[zt],o.hasOwnProperty(zt)&&Fe!=null&&!d.hasOwnProperty(zt))switch(zt){case"selected":n.selected=!1;break;default:Rn(n,s,zt,null,d,Fe)}for(he in d)if(Fe=d[he],Ye=o[he],d.hasOwnProperty(he)&&Fe!==Ye&&(Fe!=null||Ye!=null))switch(he){case"selected":n.selected=Fe&&typeof Fe!="function"&&typeof Fe!="symbol";break;default:Rn(n,s,he,Fe,d,Ye)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Wt in o)Fe=o[Wt],o.hasOwnProperty(Wt)&&Fe!=null&&!d.hasOwnProperty(Wt)&&Rn(n,s,Wt,null,d,Fe);for(Oe in d)if(Fe=d[Oe],Ye=o[Oe],d.hasOwnProperty(Oe)&&Fe!==Ye&&(Fe!=null||Ye!=null))switch(Oe){case"children":case"dangerouslySetInnerHTML":if(Fe!=null)throw Error(i(137,s));break;default:Rn(n,s,Oe,Fe,d,Ye)}return;default:if(Vt(s)){for(var kn in o)Fe=o[kn],o.hasOwnProperty(kn)&&Fe!==void 0&&!d.hasOwnProperty(kn)&&lh(n,s,kn,void 0,d,Fe);for(tt in d)Fe=d[tt],Ye=o[tt],!d.hasOwnProperty(tt)||Fe===Ye||Fe===void 0&&Ye===void 0||lh(n,s,tt,Fe,d,Ye);return}}for(var Ce in o)Fe=o[Ce],o.hasOwnProperty(Ce)&&Fe!=null&&!d.hasOwnProperty(Ce)&&Rn(n,s,Ce,null,d,Fe);for(lt in d)Fe=d[lt],Ye=o[lt],!d.hasOwnProperty(lt)||Fe===Ye||Fe==null&&Ye==null||Rn(n,s,lt,Fe,d,Ye)}function gx(n){switch(n){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function V_(){if(typeof performance.getEntriesByType=="function"){for(var n=0,s=0,o=performance.getEntriesByType("resource"),d=0;d<o.length;d++){var b=o[d],x=b.transferSize,F=b.initiatorType,W=b.duration;if(x&&W&&gx(F)){for(F=0,W=b.responseEnd,d+=1;d<o.length;d++){var he=o[d],Oe=he.startTime;if(Oe>W)break;var tt=he.transferSize,lt=he.initiatorType;tt&&gx(lt)&&(he=he.responseEnd,F+=tt*(he<W?1:(W-Oe)/(he-Oe)))}if(--d,s+=8*(x+F)/(b.duration/1e3),n++,10<n)break}}if(0<n)return s/n/1e6}return navigator.connection&&(n=navigator.connection.downlink,typeof n=="number")?n:5}var oh=null,ch=null;function wu(n){return n.nodeType===9?n:n.ownerDocument}function bx(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function vx(n,s){if(n===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&s==="foreignObject"?0:n}function uh(n,s){return n==="textarea"||n==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var dh=null;function Y_(){var n=window.event;return n&&n.type==="popstate"?n===dh?!1:(dh=n,!0):(dh=null,!1)}var xx=typeof setTimeout=="function"?setTimeout:void 0,G_=typeof clearTimeout=="function"?clearTimeout:void 0,Sx=typeof Promise=="function"?Promise:void 0,X_=typeof queueMicrotask=="function"?queueMicrotask:typeof Sx<"u"?function(n){return Sx.resolve(null).then(n).catch(K_)}:xx;function K_(n){setTimeout(function(){throw n})}function Rr(n){return n==="head"}function wx(n,s){var o=s,d=0;do{var b=o.nextSibling;if(n.removeChild(o),b&&b.nodeType===8)if(o=b.data,o==="/$"||o==="/&"){if(d===0){n.removeChild(b),dl(s);return}d--}else if(o==="$"||o==="$?"||o==="$~"||o==="$!"||o==="&")d++;else if(o==="html")xo(n.ownerDocument.documentElement);else if(o==="head"){o=n.ownerDocument.head,xo(o);for(var x=o.firstChild;x;){var F=x.nextSibling,W=x.nodeName;x[re]||W==="SCRIPT"||W==="STYLE"||W==="LINK"&&x.rel.toLowerCase()==="stylesheet"||o.removeChild(x),x=F}}else o==="body"&&xo(n.ownerDocument.body);o=b}while(o);dl(s)}function Nx(n,s){var o=n;n=0;do{var d=o.nextSibling;if(o.nodeType===1?s?(o._stashedDisplay=o.style.display,o.style.display="none"):(o.style.display=o._stashedDisplay||"",o.getAttribute("style")===""&&o.removeAttribute("style")):o.nodeType===3&&(s?(o._stashedText=o.nodeValue,o.nodeValue=""):o.nodeValue=o._stashedText||""),d&&d.nodeType===8)if(o=d.data,o==="/$"){if(n===0)break;n--}else o!=="$"&&o!=="$?"&&o!=="$~"&&o!=="$!"||n++;o=d}while(o)}function fh(n){var s=n.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var o=s;switch(s=s.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":fh(o),Ze(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}n.removeChild(o)}}function W_(n,s,o,d){for(;n.nodeType===1;){var b=o;if(n.nodeName.toLowerCase()!==s.toLowerCase()){if(!d&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(d){if(!n[re])switch(s){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(x=n.getAttribute("rel"),x==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(x!==b.rel||n.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||n.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||n.getAttribute("title")!==(b.title==null?null:b.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(x=n.getAttribute("src"),(x!==(b.src==null?null:b.src)||n.getAttribute("type")!==(b.type==null?null:b.type)||n.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&x&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(s==="input"&&n.type==="hidden"){var x=b.name==null?null:""+b.name;if(b.type==="hidden"&&n.getAttribute("name")===x)return n}else return n;if(n=es(n.nextSibling),n===null)break}return null}function Z_(n,s,o){if(s==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!o||(n=es(n.nextSibling),n===null))return null;return n}function Ex(n,s){for(;n.nodeType!==8;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!s||(n=es(n.nextSibling),n===null))return null;return n}function mh(n){return n.data==="$?"||n.data==="$~"}function hh(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState!=="loading"}function Q_(n,s){var o=n.ownerDocument;if(n.data==="$~")n._reactRetry=s;else if(n.data!=="$?"||o.readyState!=="loading")s();else{var d=function(){s(),o.removeEventListener("DOMContentLoaded",d)};o.addEventListener("DOMContentLoaded",d),n._reactRetry=d}}function es(n){for(;n!=null;n=n.nextSibling){var s=n.nodeType;if(s===1||s===3)break;if(s===8){if(s=n.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return n}var ph=null;function jx(n){n=n.nextSibling;for(var s=0;n;){if(n.nodeType===8){var o=n.data;if(o==="/$"||o==="/&"){if(s===0)return es(n.nextSibling);s--}else o!=="$"&&o!=="$!"&&o!=="$?"&&o!=="$~"&&o!=="&"||s++}n=n.nextSibling}return null}function _x(n){n=n.previousSibling;for(var s=0;n;){if(n.nodeType===8){var o=n.data;if(o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"){if(s===0)return n;s--}else o!=="/$"&&o!=="/&"||s++}n=n.previousSibling}return null}function Cx(n,s,o){switch(s=wu(o),n){case"html":if(n=s.documentElement,!n)throw Error(i(452));return n;case"head":if(n=s.head,!n)throw Error(i(453));return n;case"body":if(n=s.body,!n)throw Error(i(454));return n;default:throw Error(i(451))}}function xo(n){for(var s=n.attributes;s.length;)n.removeAttributeNode(s[0]);Ze(n)}var ts=new Map,Ax=new Set;function Nu(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var er=L.d;L.d={f:J_,r:eC,D:tC,C:nC,L:aC,m:sC,X:iC,S:rC,M:lC};function J_(){var n=er.f(),s=hu();return n||s}function eC(n){var s=dt(n);s!==null&&s.tag===5&&s.type==="form"?Vb(s):er.r(n)}var ol=typeof document>"u"?null:document;function Tx(n,s,o){var d=ol;if(d&&typeof s=="string"&&s){var b=fa(s);b='link[rel="'+n+'"][href="'+b+'"]',typeof o=="string"&&(b+='[crossorigin="'+o+'"]'),Ax.has(b)||(Ax.add(b),n={rel:n,crossOrigin:o,href:s},d.querySelector(b)===null&&(s=d.createElement("link"),ca(s,"link",n),ke(s),d.head.appendChild(s)))}}function tC(n){er.D(n),Tx("dns-prefetch",n,null)}function nC(n,s){er.C(n,s),Tx("preconnect",n,s)}function aC(n,s,o){er.L(n,s,o);var d=ol;if(d&&n&&s){var b='link[rel="preload"][as="'+fa(s)+'"]';s==="image"&&o&&o.imageSrcSet?(b+='[imagesrcset="'+fa(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(b+='[imagesizes="'+fa(o.imageSizes)+'"]')):b+='[href="'+fa(n)+'"]';var x=b;switch(s){case"style":x=cl(n);break;case"script":x=ul(n)}ts.has(x)||(n=g({rel:"preload",href:s==="image"&&o&&o.imageSrcSet?void 0:n,as:s},o),ts.set(x,n),d.querySelector(b)!==null||s==="style"&&d.querySelector(So(x))||s==="script"&&d.querySelector(wo(x))||(s=d.createElement("link"),ca(s,"link",n),ke(s),d.head.appendChild(s)))}}function sC(n,s){er.m(n,s);var o=ol;if(o&&n){var d=s&&typeof s.as=="string"?s.as:"script",b='link[rel="modulepreload"][as="'+fa(d)+'"][href="'+fa(n)+'"]',x=b;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=ul(n)}if(!ts.has(x)&&(n=g({rel:"modulepreload",href:n},s),ts.set(x,n),o.querySelector(b)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(wo(x)))return}d=o.createElement("link"),ca(d,"link",n),ke(d),o.head.appendChild(d)}}}function rC(n,s,o){er.S(n,s,o);var d=ol;if(d&&n){var b=yt(d).hoistableStyles,x=cl(n);s=s||"default";var F=b.get(x);if(!F){var W={loading:0,preload:null};if(F=d.querySelector(So(x)))W.loading=5;else{n=g({rel:"stylesheet",href:n,"data-precedence":s},o),(o=ts.get(x))&&yh(n,o);var he=F=d.createElement("link");ke(he),ca(he,"link",n),he._p=new Promise(function(Oe,tt){he.onload=Oe,he.onerror=tt}),he.addEventListener("load",function(){W.loading|=1}),he.addEventListener("error",function(){W.loading|=2}),W.loading|=4,Eu(F,s,d)}F={type:"stylesheet",instance:F,count:1,state:W},b.set(x,F)}}}function iC(n,s){er.X(n,s);var o=ol;if(o&&n){var d=yt(o).hoistableScripts,b=ul(n),x=d.get(b);x||(x=o.querySelector(wo(b)),x||(n=g({src:n,async:!0},s),(s=ts.get(b))&&gh(n,s),x=o.createElement("script"),ke(x),ca(x,"link",n),o.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},d.set(b,x))}}function lC(n,s){er.M(n,s);var o=ol;if(o&&n){var d=yt(o).hoistableScripts,b=ul(n),x=d.get(b);x||(x=o.querySelector(wo(b)),x||(n=g({src:n,async:!0,type:"module"},s),(s=ts.get(b))&&gh(n,s),x=o.createElement("script"),ke(x),ca(x,"link",n),o.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},d.set(b,x))}}function Mx(n,s,o,d){var b=(b=Z.current)?Nu(b):null;if(!b)throw Error(i(446));switch(n){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(s=cl(o.href),o=yt(b).hoistableStyles,d=o.get(s),d||(d={type:"style",instance:null,count:0,state:null},o.set(s,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){n=cl(o.href);var x=yt(b).hoistableStyles,F=x.get(n);if(F||(b=b.ownerDocument||b,F={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(n,F),(x=b.querySelector(So(n)))&&!x._p&&(F.instance=x,F.state.loading=5),ts.has(n)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},ts.set(n,o),x||oC(b,n,o,F.state))),s&&d===null)throw Error(i(528,""));return F}if(s&&d!==null)throw Error(i(529,""));return null;case"script":return s=o.async,o=o.src,typeof o=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=ul(o),o=yt(b).hoistableScripts,d=o.get(s),d||(d={type:"script",instance:null,count:0,state:null},o.set(s,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,n))}}function cl(n){return'href="'+fa(n)+'"'}function So(n){return'link[rel="stylesheet"]['+n+"]"}function Rx(n){return g({},n,{"data-precedence":n.precedence,precedence:null})}function oC(n,s,o,d){n.querySelector('link[rel="preload"][as="style"]['+s+"]")?d.loading=1:(s=n.createElement("link"),d.preload=s,s.addEventListener("load",function(){return d.loading|=1}),s.addEventListener("error",function(){return d.loading|=2}),ca(s,"link",o),ke(s),n.head.appendChild(s))}function ul(n){return'[src="'+fa(n)+'"]'}function wo(n){return"script[async]"+n}function kx(n,s,o){if(s.count++,s.instance===null)switch(s.type){case"style":var d=n.querySelector('style[data-href~="'+fa(o.href)+'"]');if(d)return s.instance=d,ke(d),d;var b=g({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return d=(n.ownerDocument||n).createElement("style"),ke(d),ca(d,"style",b),Eu(d,o.precedence,n),s.instance=d;case"stylesheet":b=cl(o.href);var x=n.querySelector(So(b));if(x)return s.state.loading|=4,s.instance=x,ke(x),x;d=Rx(o),(b=ts.get(b))&&yh(d,b),x=(n.ownerDocument||n).createElement("link"),ke(x);var F=x;return F._p=new Promise(function(W,he){F.onload=W,F.onerror=he}),ca(x,"link",d),s.state.loading|=4,Eu(x,o.precedence,n),s.instance=x;case"script":return x=ul(o.src),(b=n.querySelector(wo(x)))?(s.instance=b,ke(b),b):(d=o,(b=ts.get(x))&&(d=g({},o),gh(d,b)),n=n.ownerDocument||n,b=n.createElement("script"),ke(b),ca(b,"link",d),n.head.appendChild(b),s.instance=b);case"void":return null;default:throw Error(i(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(d=s.instance,s.state.loading|=4,Eu(d,o.precedence,n));return s.instance}function Eu(n,s,o){for(var d=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=d.length?d[d.length-1]:null,x=b,F=0;F<d.length;F++){var W=d[F];if(W.dataset.precedence===s)x=W;else if(x!==b)break}x?x.parentNode.insertBefore(n,x.nextSibling):(s=o.nodeType===9?o.head:o,s.insertBefore(n,s.firstChild))}function yh(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.title==null&&(n.title=s.title)}function gh(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.integrity==null&&(n.integrity=s.integrity)}var ju=null;function Dx(n,s,o){if(ju===null){var d=new Map,b=ju=new Map;b.set(o,d)}else b=ju,d=b.get(o),d||(d=new Map,b.set(o,d));if(d.has(n))return d;for(d.set(n,null),o=o.getElementsByTagName(n),b=0;b<o.length;b++){var x=o[b];if(!(x[re]||x[pt]||n==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var F=x.getAttribute(s)||"";F=n+F;var W=d.get(F);W?W.push(x):d.set(F,[x])}}return d}function Ix(n,s,o){n=n.ownerDocument||n,n.head.insertBefore(o,s==="title"?n.querySelector("head > title"):null)}function cC(n,s,o){if(o===1||s.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return n=s.disabled,typeof s.precedence=="string"&&n==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Lx(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}function uC(n,s,o,d){if(o.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var b=cl(d.href),x=s.querySelector(So(b));if(x){s=x._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(n.count++,n=_u.bind(n),s.then(n,n)),o.state.loading|=4,o.instance=x,ke(x);return}x=s.ownerDocument||s,d=Rx(d),(b=ts.get(b))&&yh(d,b),x=x.createElement("link"),ke(x);var F=x;F._p=new Promise(function(W,he){F.onload=W,F.onerror=he}),ca(x,"link",d),o.instance=x}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(o,s),(s=o.state.preload)&&(o.state.loading&3)===0&&(n.count++,o=_u.bind(n),s.addEventListener("load",o),s.addEventListener("error",o))}}var bh=0;function dC(n,s){return n.stylesheets&&n.count===0&&Au(n,n.stylesheets),0<n.count||0<n.imgCount?function(o){var d=setTimeout(function(){if(n.stylesheets&&Au(n,n.stylesheets),n.unsuspend){var x=n.unsuspend;n.unsuspend=null,x()}},6e4+s);0<n.imgBytes&&bh===0&&(bh=62500*V_());var b=setTimeout(function(){if(n.waitingForImages=!1,n.count===0&&(n.stylesheets&&Au(n,n.stylesheets),n.unsuspend)){var x=n.unsuspend;n.unsuspend=null,x()}},(n.imgBytes>bh?50:800)+s);return n.unsuspend=o,function(){n.unsuspend=null,clearTimeout(d),clearTimeout(b)}}:null}function _u(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Au(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var Cu=null;function Au(n,s){n.stylesheets=null,n.unsuspend!==null&&(n.count++,Cu=new Map,s.forEach(fC,n),Cu=null,_u.call(n))}function fC(n,s){if(!(s.state.loading&4)){var o=Cu.get(n);if(o)var d=o.get(null);else{o=new Map,Cu.set(n,o);for(var b=n.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<b.length;x++){var F=b[x];(F.nodeName==="LINK"||F.getAttribute("media")!=="not all")&&(o.set(F.dataset.precedence,F),d=F)}d&&o.set(null,d)}b=s.instance,F=b.getAttribute("data-precedence"),x=o.get(F)||d,x===d&&o.set(null,b),o.set(F,b),this.count++,d=_u.bind(this),b.addEventListener("load",d),b.addEventListener("error",d),x?x.parentNode.insertBefore(b,x.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(b,n.firstChild)),s.state.loading|=4}}var No={$$typeof:O,Provider:null,Consumer:null,_currentValue:$,_currentValue2:$,_threadCount:0};function mC(n,s,o,d,b,x,F,W,he){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=kt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kt(0),this.hiddenUpdates=kt(null),this.identifierPrefix=d,this.onUncaughtError=b,this.onCaughtError=x,this.onRecoverableError=F,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=he,this.incompleteTransitions=new Map}function Ox(n,s,o,d,b,x,F,W,he,Oe,tt,lt){return n=new mC(n,s,o,F,he,Oe,tt,lt,W),s=1,x===!0&&(s|=24),x=Oa(3,null,null,s),n.current=x,x.stateNode=n,s=Zf(),s.refCount++,n.pooledCache=s,s.refCount++,x.memoizedState={element:d,isDehydrated:o,cache:s},tm(x),n}function zx(n){return n?(n=Ui,n):Ui}function $x(n,s,o,d,b,x){b=zx(b),d.context===null?d.context=b:d.pendingContext=b,d=xr(s),d.payload={element:o},x=x===void 0?null:x,x!==null&&(d.callback=x),o=Sr(n,d,s),o!==null&&(Aa(o,n,s),eo(o,n,s))}function Fx(n,s){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var o=n.retryLane;n.retryLane=o!==0&&o<s?o:s}}function vh(n,s){Fx(n,s),(n=n.alternate)&&Fx(n,s)}function Bx(n){if(n.tag===13||n.tag===31){var s=li(n,67108864);s!==null&&Aa(s,n,67108864),vh(n,67108864)}}function Ux(n){if(n.tag===13||n.tag===31){var s=Ua();s=xt(s);var o=li(n,s);o!==null&&Aa(o,n,s),vh(n,s)}}var Tu=!0;function hC(n,s,o,d){var b=I.T;I.T=null;var x=L.p;try{L.p=2,xh(n,s,o,d)}finally{L.p=x,I.T=b}}function pC(n,s,o,d){var b=I.T;I.T=null;var x=L.p;try{L.p=8,xh(n,s,o,d)}finally{L.p=x,I.T=b}}function xh(n,s,o,d){if(Tu){var b=Sh(d);if(b===null)ih(n,s,d,Mu,o),Hx(n,d);else if(gC(b,n,s,o,d))d.stopPropagation();else if(Hx(n,d),s&4&&-1<yC.indexOf(n)){for(;b!==null;){var x=dt(b);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var F=Ut(x.pendingLanes);if(F!==0){var W=x;for(W.pendingLanes|=2,W.entangledLanes|=2;F;){var he=1<<31-Te(F);W.entanglements[1]|=he,F&=~he}As(x),(jn&6)===0&&(fu=at()+500,go(0))}}break;case 31:case 13:W=li(x,2),W!==null&&Aa(W,x,2),hu(),vh(x,2)}if(x=Sh(d),x===null&&ih(n,s,d,Mu,o),x===b)break;b=x}b!==null&&d.stopPropagation()}else ih(n,s,d,null,o)}}function Sh(n){return n=Es(n),wh(n)}var Mu=null;function wh(n){if(Mu=null,n=We(n),n!==null){var s=c(n);if(s===null)n=null;else{var o=s.tag;if(o===13){if(n=f(s),n!==null)return n;n=null}else if(o===31){if(n=m(s),n!==null)return n;n=null}else if(o===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;n=null}else s!==n&&(n=null)}}return Mu=n,null}function qx(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(fe()){case ce:return 2;case ye:return 8;case Pe:case ee:return 32;case pe:return 268435456;default:return 32}default:return 32}}var Nh=!1,kr=null,Dr=null,Ir=null,Eo=new Map,jo=new Map,Lr=[],yC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Hx(n,s){switch(n){case"focusin":case"focusout":kr=null;break;case"dragenter":case"dragleave":Dr=null;break;case"mouseover":case"mouseout":Ir=null;break;case"pointerover":case"pointerout":Eo.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":jo.delete(s.pointerId)}}function _o(n,s,o,d,b,x){return n===null||n.nativeEvent!==x?(n={blockedOn:s,domEventName:o,eventSystemFlags:d,nativeEvent:x,targetContainers:[b]},s!==null&&(s=dt(s),s!==null&&Bx(s)),n):(n.eventSystemFlags|=d,s=n.targetContainers,b!==null&&s.indexOf(b)===-1&&s.push(b),n)}function gC(n,s,o,d,b){switch(s){case"focusin":return kr=_o(kr,n,s,o,d,b),!0;case"dragenter":return Dr=_o(Dr,n,s,o,d,b),!0;case"mouseover":return Ir=_o(Ir,n,s,o,d,b),!0;case"pointerover":var x=b.pointerId;return Eo.set(x,_o(Eo.get(x)||null,n,s,o,d,b)),!0;case"gotpointercapture":return x=b.pointerId,jo.set(x,_o(jo.get(x)||null,n,s,o,d,b)),!0}return!1}function Px(n){var s=We(n.target);if(s!==null){var o=c(s);if(o!==null){if(s=o.tag,s===13){if(s=f(o),s!==null){n.blockedOn=s,qe(n.priority,function(){Ux(o)});return}}else if(s===31){if(s=m(o),s!==null){n.blockedOn=s,qe(n.priority,function(){Ux(o)});return}}else if(s===3&&o.stateNode.current.memoizedState.isDehydrated){n.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Ru(n){if(n.blockedOn!==null)return!1;for(var s=n.targetContainers;0<s.length;){var o=Sh(n.nativeEvent);if(o===null){o=n.nativeEvent;var d=new o.constructor(o.type,o);ha=d,o.target.dispatchEvent(d),ha=null}else return s=dt(o),s!==null&&Bx(s),n.blockedOn=o,!1;s.shift()}return!0}function Vx(n,s,o){Ru(n)&&o.delete(s)}function bC(){Nh=!1,kr!==null&&Ru(kr)&&(kr=null),Dr!==null&&Ru(Dr)&&(Dr=null),Ir!==null&&Ru(Ir)&&(Ir=null),Eo.forEach(Vx),jo.forEach(Vx)}function ku(n,s){n.blockedOn===s&&(n.blockedOn=null,Nh||(Nh=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,bC)))}var Du=null;function Yx(n){Du!==n&&(Du=n,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Du===n&&(Du=null);for(var s=0;s<n.length;s+=3){var o=n[s],d=n[s+1],b=n[s+2];if(typeof d!="function"){if(wh(d||o)===null)continue;break}var x=dt(o);x!==null&&(n.splice(s,3),s-=3,Sm(x,{pending:!0,data:b,method:o.method,action:d},d,b))}}))}function dl(n){function s(he){return ku(he,n)}kr!==null&&ku(kr,n),Dr!==null&&ku(Dr,n),Ir!==null&&ku(Ir,n),Eo.forEach(s),jo.forEach(s);for(var o=0;o<Lr.length;o++){var d=Lr[o];d.blockedOn===n&&(d.blockedOn=null)}for(;0<Lr.length&&(o=Lr[0],o.blockedOn===null);)Px(o),o.blockedOn===null&&Lr.shift();if(o=(n.ownerDocument||n).$$reactFormReplay,o!=null)for(d=0;d<o.length;d+=3){var b=o[d],x=o[d+1],F=b[Ee]||null;if(typeof x=="function")F||Yx(o);else if(F){var W=null;if(x&&x.hasAttribute("formAction")){if(b=x,F=x[Ee]||null)W=F.formAction;else if(wh(b)!==null)continue}else W=F.action;typeof W=="function"?o[d+1]=W:(o.splice(d,3),d-=3),Yx(o)}}}function Gx(){function n(x){x.canIntercept&&x.info==="react-transition"&&x.intercept({handler:function(){return new Promise(function(F){return b=F})},focusReset:"manual",scroll:"manual"})}function s(){b!==null&&(b(),b=null),d||setTimeout(o,20)}function o(){if(!d&&!navigation.transition){var x=navigation.currentEntry;x&&x.url!=null&&navigation.navigate(x.url,{state:x.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,b=null;return navigation.addEventListener("navigate",n),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(o,100),function(){d=!0,navigation.removeEventListener("navigate",n),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),b!==null&&(b(),b=null)}}}function Eh(n){this._internalRoot=n}Iu.prototype.render=Eh.prototype.render=function(n){var s=this._internalRoot;if(s===null)throw Error(i(409));var o=s.current,d=Ua();$x(o,d,n,s,null,null)},Iu.prototype.unmount=Eh.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var s=n.containerInfo;$x(n.current,2,null,n,null,null),hu(),s[st]=null}};function Iu(n){this._internalRoot=n}Iu.prototype.unstable_scheduleHydration=function(n){if(n){var s=_e();n={blockedOn:null,target:n,priority:s};for(var o=0;o<Lr.length&&s!==0&&s<Lr[o].priority;o++);Lr.splice(o,0,n),o===0&&Px(n)}};var Xx=t.version;if(Xx!=="19.2.0")throw Error(i(527,Xx,"19.2.0"));L.findDOMNode=function(n){var s=n._reactInternals;if(s===void 0)throw typeof n.render=="function"?Error(i(188)):(n=Object.keys(n).join(","),Error(i(268,n)));return n=p(s),n=n!==null?y(n):null,n=n===null?null:n.stateNode,n};var vC={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:I,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lu.isDisabled&&Lu.supportsFiber)try{Ge=Lu.inject(vC),Xe=Lu}catch{}}return Ao.createRoot=function(n,s){if(!l(n))throw Error(i(299));var o=!1,d="",b=tv,x=nv,F=av;return s!=null&&(s.unstable_strictMode===!0&&(o=!0),s.identifierPrefix!==void 0&&(d=s.identifierPrefix),s.onUncaughtError!==void 0&&(b=s.onUncaughtError),s.onCaughtError!==void 0&&(x=s.onCaughtError),s.onRecoverableError!==void 0&&(F=s.onRecoverableError)),s=Ox(n,1,!1,null,null,o,d,null,b,x,F,Gx),n[st]=s.current,rh(n),new Eh(s)},Ao.hydrateRoot=function(n,s,o){if(!l(n))throw Error(i(299));var d=!1,b="",x=tv,F=nv,W=av,he=null;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(b=o.identifierPrefix),o.onUncaughtError!==void 0&&(x=o.onUncaughtError),o.onCaughtError!==void 0&&(F=o.onCaughtError),o.onRecoverableError!==void 0&&(W=o.onRecoverableError),o.formState!==void 0&&(he=o.formState)),s=Ox(n,1,!0,s,o??null,d,b,he,x,F,W,Gx),s.context=zx(null),o=s.current,d=Ua(),d=xt(d),b=xr(d),b.callback=null,Sr(o,b,d),o=d,s.current.lanes=o,te(s,o),As(s),n[st]=s.current,rh(n),new Iu(s)},Ao.version="19.2.0",Ao}var s0;function AC(){if(s0)return Ch.exports;s0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Ch.exports=CC(),Ch.exports}var TC=AC();/**
 * react-router v7.9.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Bw=e=>{throw TypeError(e)},MC=(e,t,r)=>t.has(e)||Bw("Cannot "+r),Rh=(e,t,r)=>(MC(e,t,"read from private field"),r?r.call(e):t.get(e)),RC=(e,t,r)=>t.has(e)?Bw("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),r0="popstate";function kC(e={}){function t(i,l){let{pathname:c,search:f,hash:m}=i.location;return ac("",{pathname:c,search:f,hash:m},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function r(i,l){return typeof l=="string"?l:Kr(l)}return IC(t,r,null,e)}function rn(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Vn(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function DC(){return Math.random().toString(36).substring(2,10)}function i0(e,t){return{usr:e.state,key:e.key,idx:t}}function ac(e,t,r=null,i){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof t=="string"?Jr(t):t,state:r,key:t&&t.key||i||DC()}}function Kr({pathname:e="/",search:t="",hash:r=""}){return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Jr(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substring(r),e=e.substring(0,r));let i=e.indexOf("?");i>=0&&(t.search=e.substring(i),e=e.substring(0,i)),e&&(t.pathname=e)}return t}function IC(e,t,r,i={}){let{window:l=document.defaultView,v5Compat:c=!1}=i,f=l.history,m="POP",h=null,p=y();p==null&&(p=0,f.replaceState({...f.state,idx:p},""));function y(){return(f.state||{idx:null}).idx}function g(){m="POP";let E=y(),C=E==null?null:E-p;p=E,h&&h({action:m,location:N.location,delta:C})}function v(E,C){m="PUSH";let A=ac(N.location,E,C);p=y()+1;let O=i0(A,p),_=N.createHref(A);try{f.pushState(O,"",_)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;l.location.assign(_)}c&&h&&h({action:m,location:N.location,delta:1})}function S(E,C){m="REPLACE";let A=ac(N.location,E,C);p=y();let O=i0(A,p),_=N.createHref(A);f.replaceState(O,"",_),c&&h&&h({action:m,location:N.location,delta:0})}function w(E){return Uw(E)}let N={get action(){return m},get location(){return e(l,f)},listen(E){if(h)throw new Error("A history only accepts one active listener");return l.addEventListener(r0,g),h=E,()=>{l.removeEventListener(r0,g),h=null}},createHref(E){return t(l,E)},createURL:w,encodeLocation(E){let C=w(E);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:v,replace:S,go(E){return f.go(E)}};return N}function Uw(e,t=!1){let r="http://localhost";typeof window<"u"&&(r=window.location.origin!=="null"?window.location.origin:window.location.href),rn(r,"No window.location.(origin|href) available to create URL");let i=typeof e=="string"?e:Kr(e);return i=i.replace(/ $/,"%20"),!t&&i.startsWith("//")&&(i=r+i),new URL(i,r)}var Go,l0=class{constructor(e){if(RC(this,Go,new Map),e)for(let[t,r]of e)this.set(t,r)}get(e){if(Rh(this,Go).has(e))return Rh(this,Go).get(e);if(e.defaultValue!==void 0)return e.defaultValue;throw new Error("No value found for context")}set(e,t){Rh(this,Go).set(e,t)}};Go=new WeakMap;var LC=new Set(["lazy","caseSensitive","path","id","index","children"]);function OC(e){return LC.has(e)}var zC=new Set(["lazy","caseSensitive","path","id","index","middleware","children"]);function $C(e){return zC.has(e)}function FC(e){return e.index===!0}function sc(e,t,r=[],i={},l=!1){return e.map((c,f)=>{let m=[...r,String(f)],h=typeof c.id=="string"?c.id:m.join("-");if(rn(c.index!==!0||!c.children,"Cannot specify children on an index route"),rn(l||!i[h],`Found a route id collision on id "${h}".  Route id's must be globally unique within Data Router usages`),FC(c)){let p={...c,...t(c),id:h};return i[h]=p,p}else{let p={...c,...t(c),id:h,children:void 0};return i[h]=p,c.children&&(p.children=sc(c.children,t,m,i,l)),p}})}function Hr(e,t,r="/"){return fd(e,t,r,!1)}function fd(e,t,r,i){let l=typeof t=="string"?Jr(t):t,c=ka(l.pathname||"/",r);if(c==null)return null;let f=qw(e);UC(f);let m=null;for(let h=0;m==null&&h<f.length;++h){let p=QC(c);m=WC(f[h],p,i)}return m}function BC(e,t){let{route:r,pathname:i,params:l}=e;return{id:r.id,pathname:i,params:l,data:t[r.id],loaderData:t[r.id],handle:r.handle}}function qw(e,t=[],r=[],i="",l=!1){let c=(f,m,h=l,p)=>{let y={relativePath:p===void 0?f.path||"":p,caseSensitive:f.caseSensitive===!0,childrenIndex:m,route:f};if(y.relativePath.startsWith("/")){if(!y.relativePath.startsWith(i)&&h)return;rn(y.relativePath.startsWith(i),`Absolute route path "${y.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),y.relativePath=y.relativePath.slice(i.length)}let g=Ds([i,y.relativePath]),v=r.concat(y);f.children&&f.children.length>0&&(rn(f.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),qw(f.children,t,v,g,h)),!(f.path==null&&!f.index)&&t.push({path:g,score:XC(g,f.index),routesMeta:v})};return e.forEach((f,m)=>{if(f.path===""||!f.path?.includes("?"))c(f,m);else for(let h of Hw(f.path))c(f,m,!0,h)}),t}function Hw(e){let t=e.split("/");if(t.length===0)return[];let[r,...i]=t,l=r.endsWith("?"),c=r.replace(/\?$/,"");if(i.length===0)return l?[c,""]:[c];let f=Hw(i.join("/")),m=[];return m.push(...f.map(h=>h===""?c:[c,h].join("/"))),l&&m.push(...f),m.map(h=>e.startsWith("/")&&h===""?"/":h)}function UC(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:KC(t.routesMeta.map(i=>i.childrenIndex),r.routesMeta.map(i=>i.childrenIndex)))}var qC=/^:[\w-]+$/,HC=3,PC=2,VC=1,YC=10,GC=-2,o0=e=>e==="*";function XC(e,t){let r=e.split("/"),i=r.length;return r.some(o0)&&(i+=GC),t&&(i+=PC),r.filter(l=>!o0(l)).reduce((l,c)=>l+(qC.test(c)?HC:c===""?VC:YC),i)}function KC(e,t){return e.length===t.length&&e.slice(0,-1).every((i,l)=>i===t[l])?e[e.length-1]-t[t.length-1]:0}function WC(e,t,r=!1){let{routesMeta:i}=e,l={},c="/",f=[];for(let m=0;m<i.length;++m){let h=i[m],p=m===i.length-1,y=c==="/"?t:t.slice(c.length)||"/",g=Cd({path:h.relativePath,caseSensitive:h.caseSensitive,end:p},y),v=h.route;if(!g&&p&&r&&!i[i.length-1].route.index&&(g=Cd({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},y)),!g)return null;Object.assign(l,g.params),f.push({params:l,pathname:Ds([c,g.pathname]),pathnameBase:nA(Ds([c,g.pathnameBase])),route:v}),g.pathnameBase!=="/"&&(c=Ds([c,g.pathnameBase]))}return f}function Cd(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,i]=ZC(e.path,e.caseSensitive,e.end),l=t.match(r);if(!l)return null;let c=l[0],f=c.replace(/(.)\/+$/,"$1"),m=l.slice(1);return{params:i.reduce((p,{paramName:y,isOptional:g},v)=>{if(y==="*"){let w=m[v]||"";f=c.slice(0,c.length-w.length).replace(/(.)\/+$/,"$1")}const S=m[v];return g&&!S?p[y]=void 0:p[y]=(S||"").replace(/%2F/g,"/"),p},{}),pathname:c,pathnameBase:f,pattern:e}}function ZC(e,t=!1,r=!0){Vn(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let i=[],l="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,m,h)=>(i.push({paramName:m,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(i.push({paramName:"*"}),l+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?l+="\\/*$":e!==""&&e!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,t?void 0:"i"),i]}function QC(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Vn(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function ka(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,i=e.charAt(r);return i&&i!=="/"?null:e.slice(r)||"/"}function JC({basename:e,pathname:t}){return t==="/"?e:Ds([e,t])}function eA(e,t="/"){let{pathname:r,search:i="",hash:l=""}=typeof e=="string"?Jr(e):e;return{pathname:r?r.startsWith("/")?r:tA(r,t):t,search:aA(i),hash:sA(l)}}function tA(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(l=>{l===".."?r.length>1&&r.pop():l!=="."&&r.push(l)}),r.length>1?r.join("/"):"/"}function kh(e,t,r,i){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Pw(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function Xd(e){let t=Pw(e);return t.map((r,i)=>i===t.length-1?r.pathname:r.pathnameBase)}function Kd(e,t,r,i=!1){let l;typeof e=="string"?l=Jr(e):(l={...e},rn(!l.pathname||!l.pathname.includes("?"),kh("?","pathname","search",l)),rn(!l.pathname||!l.pathname.includes("#"),kh("#","pathname","hash",l)),rn(!l.search||!l.search.includes("#"),kh("#","search","hash",l)));let c=e===""||l.pathname==="",f=c?"/":l.pathname,m;if(f==null)m=r;else{let g=t.length-1;if(!i&&f.startsWith("..")){let v=f.split("/");for(;v[0]==="..";)v.shift(),g-=1;l.pathname=v.join("/")}m=g>=0?t[g]:"/"}let h=eA(l,m),p=f&&f!=="/"&&f.endsWith("/"),y=(c||f===".")&&r.endsWith("/");return!h.pathname.endsWith("/")&&(p||y)&&(h.pathname+="/"),h}var Ds=e=>e.join("/").replace(/\/\/+/g,"/"),nA=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),aA=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,sA=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e,Ad=class{constructor(e,t,r,i=!1){this.status=e,this.statusText=t||"",this.internal=i,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}};function rc(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}var Vw=["POST","PUT","PATCH","DELETE"],rA=new Set(Vw),iA=["GET",...Vw],lA=new Set(iA),oA=new Set([301,302,303,307,308]),cA=new Set([307,308]),Dh={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},uA={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Ni={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},dA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,wy=e=>dA.test(e),fA=e=>({hasErrorBoundary:!!e.hasErrorBoundary}),Yw="remix-router-transitions",Gw=Symbol("ResetLoaderData");function mA(e){const t=e.window?e.window:typeof window<"u"?window:void 0,r=typeof t<"u"&&typeof t.document<"u"&&typeof t.document.createElement<"u";rn(e.routes.length>0,"You must provide a non-empty routes array to createRouter");let i=e.hydrationRouteProperties||[],l=e.mapRouteProperties||fA,c={},f=sc(e.routes,l,void 0,c),m,h=e.basename||"/";h.startsWith("/")||(h=`/${h}`);let p=e.dataStrategy||bA,y={...e.future},g=null,v=new Set,S=null,w=null,N=null,E=e.hydrationData!=null,C=Hr(f,e.history.location,h),A=!1,O=null,_;if(C==null&&!e.patchRoutesOnNavigation){let te=as(404,{pathname:e.history.location.pathname}),{matches:be,route:ve}=Ou(f);_=!0,C=be,O={[ve.id]:te}}else if(C&&!e.hydrationData&&wt(C,f,e.history.location.pathname).active&&(C=null),C)if(C.some(te=>te.route.lazy))_=!1;else if(!C.some(te=>Ny(te.route)))_=!0;else{let te=e.hydrationData?e.hydrationData.loaderData:null,be=e.hydrationData?e.hydrationData.errors:null;if(be){let ve=C.findIndex(Ue=>be[Ue.route.id]!==void 0);_=C.slice(0,ve+1).every(Ue=>!Lp(Ue.route,te,be))}else _=C.every(ve=>!Lp(ve.route,te,be))}else{_=!1,C=[];let te=wt(null,f,e.history.location.pathname);te.active&&te.matches&&(A=!0,C=te.matches)}let k,D={historyAction:e.history.action,location:e.history.location,matches:C,initialized:_,navigation:Dh,restoreScrollPosition:e.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:e.hydrationData&&e.hydrationData.loaderData||{},actionData:e.hydrationData&&e.hydrationData.actionData||null,errors:e.hydrationData&&e.hydrationData.errors||O,fetchers:new Map,blockers:new Map},j="POP",z=!1,P,G=!1,H=new Map,X=null,V=!1,R=!1,B=new Set,I=new Map,L=0,$=-1,M=new Map,U=new Set,T=new Map,q=new Map,Y=new Set,Q=new Map,oe,Z=null;function de(){if(g=e.history.listen(({action:te,location:be,delta:ve})=>{if(oe){oe(),oe=void 0;return}Vn(Q.size===0||ve!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let Ue=At({currentLocation:D.location,nextLocation:be,historyAction:te});if(Ue&&ve!=null){let it=new Promise(xt=>{oe=xt});e.history.go(ve*-1),Dt(Ue,{state:"blocked",location:be,proceed(){Dt(Ue,{state:"proceeding",proceed:void 0,reset:void 0,location:be}),it.then(()=>e.history.go(ve))},reset(){let xt=new Map(D.blockers);xt.set(Ue,Ni),ne({blockers:xt})}});return}return Ae(te,be)}),r){DA(t,H);let te=()=>IA(t,H);t.addEventListener("pagehide",te),X=()=>t.removeEventListener("pagehide",te)}return D.initialized||Ae("POP",D.location,{initialHydration:!0}),k}function J(){g&&g(),X&&X(),v.clear(),P&&P.abort(),D.fetchers.forEach((te,be)=>pe(be)),D.blockers.forEach((te,be)=>mt(be))}function se(te){return v.add(te),()=>v.delete(te)}function ne(te,be={}){te.matches&&(te.matches=te.matches.map(it=>{let xt=c[it.route.id],ie=it.route;return ie.element!==xt.element||ie.errorElement!==xt.errorElement||ie.hydrateFallbackElement!==xt.hydrateFallbackElement?{...it,route:xt}:it})),D={...D,...te};let ve=[],Ue=[];D.fetchers.forEach((it,xt)=>{it.state==="idle"&&(Y.has(xt)?ve.push(xt):Ue.push(xt))}),Y.forEach(it=>{!D.fetchers.has(it)&&!I.has(it)&&ve.push(it)}),[...v].forEach(it=>it(D,{deletedFetchers:ve,viewTransitionOpts:be.viewTransitionOpts,flushSync:be.flushSync===!0})),ve.forEach(it=>pe(it)),Ue.forEach(it=>D.fetchers.delete(it))}function we(te,be,{flushSync:ve}={}){let Ue=D.actionData!=null&&D.navigation.formMethod!=null&&Ta(D.navigation.formMethod)&&D.navigation.state==="loading"&&te.state?._isRedirect!==!0,it;be.actionData?Object.keys(be.actionData).length>0?it=be.actionData:it=null:Ue?it=D.actionData:it=null;let xt=be.loaderData?b0(D.loaderData,be.loaderData,be.matches||[],be.errors):D.loaderData,ie=D.blockers;ie.size>0&&(ie=new Map(ie),ie.forEach((pt,Ee)=>ie.set(Ee,Ni)));let _e=V?!1:Qt(te,be.matches||D.matches),qe=z===!0||D.navigation.formMethod!=null&&Ta(D.navigation.formMethod)&&te.state?._isRedirect!==!0;m&&(f=m,m=void 0),V||j==="POP"||(j==="PUSH"?e.history.push(te,te.state):j==="REPLACE"&&e.history.replace(te,te.state));let ht;if(j==="POP"){let pt=H.get(D.location.pathname);pt&&pt.has(te.pathname)?ht={currentLocation:D.location,nextLocation:te}:H.has(te.pathname)&&(ht={currentLocation:te,nextLocation:D.location})}else if(G){let pt=H.get(D.location.pathname);pt?pt.add(te.pathname):(pt=new Set([te.pathname]),H.set(D.location.pathname,pt)),ht={currentLocation:D.location,nextLocation:te}}ne({...be,actionData:it,loaderData:xt,historyAction:j,location:te,initialized:!0,navigation:Dh,revalidation:"idle",restoreScrollPosition:_e,preventScrollReset:qe,blockers:ie},{viewTransitionOpts:ht,flushSync:ve===!0}),j="POP",z=!1,G=!1,V=!1,R=!1,Z?.resolve(),Z=null}async function Le(te,be){if(typeof te=="number"){e.history.go(te);return}let ve=Ip(D.location,D.matches,h,te,be?.fromRouteId,be?.relative),{path:Ue,submission:it,error:xt}=c0(!1,ve,be),ie=D.location,_e=ac(D.location,Ue,be&&be.state);_e={..._e,...e.history.encodeLocation(_e)};let qe=be&&be.replace!=null?be.replace:void 0,ht="PUSH";qe===!0?ht="REPLACE":qe===!1||it!=null&&Ta(it.formMethod)&&it.formAction===D.location.pathname+D.location.search&&(ht="REPLACE");let pt=be&&"preventScrollReset"in be?be.preventScrollReset===!0:void 0,Ee=(be&&be.flushSync)===!0,st=At({currentLocation:ie,nextLocation:_e,historyAction:ht});if(st){Dt(st,{state:"blocked",location:_e,proceed(){Dt(st,{state:"proceeding",proceed:void 0,reset:void 0,location:_e}),Le(te,be)},reset(){let le=new Map(D.blockers);le.set(st,Ni),ne({blockers:le})}});return}await Ae(ht,_e,{submission:it,pendingError:xt,preventScrollReset:pt,replace:be&&be.replace,enableViewTransition:be&&be.viewTransition,flushSync:Ee})}function Me(){Z||(Z=LA()),fe(),ne({revalidation:"loading"});let te=Z.promise;return D.navigation.state==="submitting"?te:D.navigation.state==="idle"?(Ae(D.historyAction,D.location,{startUninterruptedRevalidation:!0}),te):(Ae(j||D.historyAction,D.navigation.location,{overrideNavigation:D.navigation,enableViewTransition:G===!0}),te)}async function Ae(te,be,ve){P&&P.abort(),P=null,j=te,V=(ve&&ve.startUninterruptedRevalidation)===!0,Ut(D.location,D.matches),z=(ve&&ve.preventScrollReset)===!0,G=(ve&&ve.enableViewTransition)===!0;let Ue=m||f,it=ve&&ve.overrideNavigation,xt=ve?.initialHydration&&D.matches&&D.matches.length>0&&!A?D.matches:Hr(Ue,be,h),ie=(ve&&ve.flushSync)===!0;if(xt&&D.initialized&&!R&&_A(D.location,be)&&!(ve&&ve.submission&&Ta(ve.submission.formMethod))){we(be,{matches:xt},{flushSync:ie});return}let _e=wt(xt,Ue,be.pathname);if(_e.active&&_e.matches&&(xt=_e.matches),!xt){let{error:ut,notFoundMatches:gt,route:re}=Ke(be.pathname);we(be,{matches:gt,loaderData:{},errors:{[re.id]:ut}},{flushSync:ie});return}P=new AbortController;let qe=xl(e.history,be,P.signal,ve&&ve.submission),ht=e.getContext?await e.getContext():new l0,pt;if(ve&&ve.pendingError)pt=[Pr(xt).route.id,{type:"error",error:ve.pendingError}];else if(ve&&ve.submission&&Ta(ve.submission.formMethod)){let ut=await ot(qe,be,ve.submission,xt,ht,_e.active,ve&&ve.initialHydration===!0,{replace:ve.replace,flushSync:ie});if(ut.shortCircuited)return;if(ut.pendingActionResult){let[gt,re]=ut.pendingActionResult;if(qa(re)&&rc(re.error)&&re.error.status===404){P=null,we(be,{matches:ut.matches,loaderData:{},errors:{[gt]:re.error}});return}}xt=ut.matches||xt,pt=ut.pendingActionResult,it=Ih(be,ve.submission),ie=!1,_e.active=!1,qe=xl(e.history,qe.url,qe.signal)}let{shortCircuited:Ee,matches:st,loaderData:le,errors:Je}=await ze(qe,be,xt,ht,_e.active,it,ve&&ve.submission,ve&&ve.fetcherSubmission,ve&&ve.replace,ve&&ve.initialHydration===!0,ie,pt);Ee||(P=null,we(be,{matches:st||xt,...v0(pt),loaderData:le,errors:Je}))}async function ot(te,be,ve,Ue,it,xt,ie,_e={}){fe();let qe=RA(be,ve);if(ne({navigation:qe},{flushSync:_e.flushSync===!0}),xt){let Ee=await Ft(Ue,be.pathname,te.signal);if(Ee.type==="aborted")return{shortCircuited:!0};if(Ee.type==="error"){if(Ee.partialMatches.length===0){let{matches:le,route:Je}=Ou(f);return{matches:le,pendingActionResult:[Je.id,{type:"error",error:Ee.error}]}}let st=Pr(Ee.partialMatches).route.id;return{matches:Ee.partialMatches,pendingActionResult:[st,{type:"error",error:Ee.error}]}}else if(Ee.matches)Ue=Ee.matches;else{let{notFoundMatches:st,error:le,route:Je}=Ke(be.pathname);return{matches:st,pendingActionResult:[Je.id,{type:"error",error:le}]}}}let ht,pt=md(Ue,be);if(!pt.route.action&&!pt.route.lazy)ht={type:"error",error:as(405,{method:te.method,pathname:be.pathname,routeId:pt.route.id})};else{let Ee=wl(l,c,te,Ue,pt,ie?[]:i,it),st=await Be(te,Ee,it,null);if(ht=st[pt.route.id],!ht){for(let le of Ue)if(st[le.route.id]){ht=st[le.route.id];break}}if(te.signal.aborted)return{shortCircuited:!0}}if(ji(ht)){let Ee;return _e&&_e.replace!=null?Ee=_e.replace:Ee=p0(ht.response.headers.get("Location"),new URL(te.url),h)===D.location.pathname+D.location.search,await Ct(te,ht,!0,{submission:ve,replace:Ee}),{shortCircuited:!0}}if(qa(ht)){let Ee=Pr(Ue,pt.route.id);return(_e&&_e.replace)!==!0&&(j="PUSH"),{matches:Ue,pendingActionResult:[Ee.route.id,ht,pt.route.id]}}return{matches:Ue,pendingActionResult:[pt.route.id,ht]}}async function ze(te,be,ve,Ue,it,xt,ie,_e,qe,ht,pt,Ee){let st=xt||Ih(be,ie),le=ie||_e||S0(st),Je=!V&&!ht;if(it){if(Je){let Ne=nt(Ee);ne({navigation:st,...Ne!==void 0?{actionData:Ne}:{}},{flushSync:pt})}let ae=await Ft(ve,be.pathname,te.signal);if(ae.type==="aborted")return{shortCircuited:!0};if(ae.type==="error"){if(ae.partialMatches.length===0){let{matches:He,route:bt}=Ou(f);return{matches:He,loaderData:{},errors:{[bt.id]:ae.error}}}let Ne=Pr(ae.partialMatches).route.id;return{matches:ae.partialMatches,loaderData:{},errors:{[Ne]:ae.error}}}else if(ae.matches)ve=ae.matches;else{let{error:Ne,notFoundMatches:He,route:bt}=Ke(be.pathname);return{matches:He,loaderData:{},errors:{[bt.id]:Ne}}}}let ut=m||f,{dsMatches:gt,revalidatingFetchers:re}=u0(te,Ue,l,c,e.history,D,ve,le,be,ht?[]:i,ht===!0,R,B,Y,T,U,ut,h,e.patchRoutesOnNavigation!=null,Ee);if($=++L,!e.dataStrategy&&!gt.some(ae=>ae.shouldLoad)&&!gt.some(ae=>ae.route.middleware&&ae.route.middleware.length>0)&&re.length===0){let ae=Xe();return we(be,{matches:ve,loaderData:{},errors:Ee&&qa(Ee[1])?{[Ee[0]]:Ee[1].error}:null,...v0(Ee),...ae?{fetchers:new Map(D.fetchers)}:{}},{flushSync:pt}),{shortCircuited:!0}}if(Je){let ae={};if(!it){ae.navigation=st;let Ne=nt(Ee);Ne!==void 0&&(ae.actionData=Ne)}re.length>0&&(ae.fetchers=$e(re)),ne(ae,{flushSync:pt})}re.forEach(ae=>{Se(ae.key),ae.controller&&I.set(ae.key,ae.controller)});let Ze=()=>re.forEach(ae=>Se(ae.key));P&&P.signal.addEventListener("abort",Ze);let{loaderResults:We,fetcherResults:dt}=await at(gt,re,te,Ue);if(te.signal.aborted)return{shortCircuited:!0};P&&P.signal.removeEventListener("abort",Ze),re.forEach(ae=>I.delete(ae.key));let Qe=zu(We);if(Qe)return await Ct(te,Qe.result,!0,{replace:qe}),{shortCircuited:!0};if(Qe=zu(dt),Qe)return U.add(Qe.key),await Ct(te,Qe.result,!0,{replace:qe}),{shortCircuited:!0};let{loaderData:yt,errors:ke}=g0(D,ve,We,Ee,re,dt);ht&&D.errors&&(ke={...D.errors,...ke});let Ve=Xe(),ft=et($),K=Ve||ft||re.length>0;return{matches:ve,loaderData:yt,errors:ke,...K?{fetchers:new Map(D.fetchers)}:{}}}function nt(te){if(te&&!qa(te[1]))return{[te[0]]:te[1].data};if(D.actionData)return Object.keys(D.actionData).length===0?null:D.actionData}function $e(te){return te.forEach(be=>{let ve=D.fetchers.get(be.key),Ue=To(void 0,ve?ve.data:void 0);D.fetchers.set(be.key,Ue)}),new Map(D.fetchers)}async function vt(te,be,ve,Ue){Se(te);let it=(Ue&&Ue.flushSync)===!0,xt=m||f,ie=Ip(D.location,D.matches,h,ve,be,Ue?.relative),_e=Hr(xt,ie,h),qe=wt(_e,xt,ie);if(qe.active&&qe.matches&&(_e=qe.matches),!_e){ye(te,be,as(404,{pathname:ie}),{flushSync:it});return}let{path:ht,submission:pt,error:Ee}=c0(!0,ie,Ue);if(Ee){ye(te,be,Ee,{flushSync:it});return}let st=e.getContext?await e.getContext():new l0,le=(Ue&&Ue.preventScrollReset)===!0;if(pt&&Ta(pt.formMethod)){await _t(te,be,ht,_e,st,qe.active,it,le,pt);return}T.set(te,{routeId:be,path:ht}),await Tt(te,be,ht,_e,st,qe.active,it,le,pt)}async function _t(te,be,ve,Ue,it,xt,ie,_e,qe){fe(),T.delete(te);let ht=D.fetchers.get(te);ce(te,kA(qe,ht),{flushSync:ie});let pt=new AbortController,Ee=xl(e.history,ve,pt.signal,qe);if(xt){let Nt=await Ft(Ue,new URL(Ee.url).pathname,Ee.signal,te);if(Nt.type==="aborted")return;if(Nt.type==="error"){ye(te,be,Nt.error,{flushSync:ie});return}else if(Nt.matches)Ue=Nt.matches;else{ye(te,be,as(404,{pathname:ve}),{flushSync:ie});return}}let st=md(Ue,ve);if(!st.route.action&&!st.route.lazy){let Nt=as(405,{method:qe.formMethod,pathname:ve,routeId:be});ye(te,be,Nt,{flushSync:ie});return}I.set(te,pt);let le=L,Je=wl(l,c,Ee,Ue,st,i,it),gt=(await Be(Ee,Je,it,te))[st.route.id];if(Ee.signal.aborted){I.get(te)===pt&&I.delete(te);return}if(Y.has(te)){if(ji(gt)||qa(gt)){ce(te,ar(void 0));return}}else{if(ji(gt))if(I.delete(te),$>le){ce(te,ar(void 0));return}else return U.add(te),ce(te,To(qe)),Ct(Ee,gt,!1,{fetcherSubmission:qe,preventScrollReset:_e});if(qa(gt)){ye(te,be,gt.error);return}}let re=D.navigation.location||D.location,Ze=xl(e.history,re,pt.signal),We=m||f,dt=D.navigation.state!=="idle"?Hr(We,D.navigation.location,h):D.matches;rn(dt,"Didn't find any matches after fetcher action");let Qe=++L;M.set(te,Qe);let yt=To(qe,gt.data);D.fetchers.set(te,yt);let{dsMatches:ke,revalidatingFetchers:Ve}=u0(Ze,it,l,c,e.history,D,dt,qe,re,i,!1,R,B,Y,T,U,We,h,e.patchRoutesOnNavigation!=null,[st.route.id,gt]);Ve.filter(Nt=>Nt.key!==te).forEach(Nt=>{let jt=Nt.key,It=D.fetchers.get(jt),tn=To(void 0,It?It.data:void 0);D.fetchers.set(jt,tn),Se(jt),Nt.controller&&I.set(jt,Nt.controller)}),ne({fetchers:new Map(D.fetchers)});let ft=()=>Ve.forEach(Nt=>Se(Nt.key));pt.signal.addEventListener("abort",ft);let{loaderResults:K,fetcherResults:ae}=await at(ke,Ve,Ze,it);if(pt.signal.aborted)return;if(pt.signal.removeEventListener("abort",ft),M.delete(te),I.delete(te),Ve.forEach(Nt=>I.delete(Nt.key)),D.fetchers.has(te)){let Nt=ar(gt.data);D.fetchers.set(te,Nt)}let Ne=zu(K);if(Ne)return Ct(Ze,Ne.result,!1,{preventScrollReset:_e});if(Ne=zu(ae),Ne)return U.add(Ne.key),Ct(Ze,Ne.result,!1,{preventScrollReset:_e});let{loaderData:He,errors:bt}=g0(D,dt,K,void 0,Ve,ae);et(Qe),D.navigation.state==="loading"&&Qe>$?(rn(j,"Expected pending action"),P&&P.abort(),we(D.navigation.location,{matches:dt,loaderData:He,errors:bt,fetchers:new Map(D.fetchers)})):(ne({errors:bt,loaderData:b0(D.loaderData,He,dt,bt),fetchers:new Map(D.fetchers)}),R=!1)}async function Tt(te,be,ve,Ue,it,xt,ie,_e,qe){let ht=D.fetchers.get(te);ce(te,To(qe,ht?ht.data:void 0),{flushSync:ie});let pt=new AbortController,Ee=xl(e.history,ve,pt.signal);if(xt){let re=await Ft(Ue,new URL(Ee.url).pathname,Ee.signal,te);if(re.type==="aborted")return;if(re.type==="error"){ye(te,be,re.error,{flushSync:ie});return}else if(re.matches)Ue=re.matches;else{ye(te,be,as(404,{pathname:ve}),{flushSync:ie});return}}let st=md(Ue,ve);I.set(te,pt);let le=L,Je=wl(l,c,Ee,Ue,st,i,it),gt=(await Be(Ee,Je,it,te))[st.route.id];if(I.get(te)===pt&&I.delete(te),!Ee.signal.aborted){if(Y.has(te)){ce(te,ar(void 0));return}if(ji(gt))if($>le){ce(te,ar(void 0));return}else{U.add(te),await Ct(Ee,gt,!1,{preventScrollReset:_e});return}if(qa(gt)){ye(te,be,gt.error);return}ce(te,ar(gt.data))}}async function Ct(te,be,ve,{submission:Ue,fetcherSubmission:it,preventScrollReset:xt,replace:ie}={}){be.response.headers.has("X-Remix-Revalidate")&&(R=!0);let _e=be.response.headers.get("Location");rn(_e,"Expected a Location header on the redirect Response"),_e=p0(_e,new URL(te.url),h);let qe=ac(D.location,_e,{_isRedirect:!0});if(r){let Je=!1;if(be.response.headers.has("X-Remix-Reload-Document"))Je=!0;else if(wy(_e)){const ut=Uw(_e,!0);Je=ut.origin!==t.location.origin||ka(ut.pathname,h)==null}if(Je){ie?t.location.replace(_e):t.location.assign(_e);return}}P=null;let ht=ie===!0||be.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:pt,formAction:Ee,formEncType:st}=D.navigation;!Ue&&!it&&pt&&Ee&&st&&(Ue=S0(D.navigation));let le=Ue||it;if(cA.has(be.response.status)&&le&&Ta(le.formMethod))await Ae(ht,qe,{submission:{...le,formAction:_e},preventScrollReset:xt||z,enableViewTransition:ve?G:void 0});else{let Je=Ih(qe,Ue);await Ae(ht,qe,{overrideNavigation:Je,fetcherSubmission:it,preventScrollReset:xt||z,enableViewTransition:ve?G:void 0})}}async function Be(te,be,ve,Ue){let it,xt={};try{it=await xA(p,te,be,Ue,ve,!1)}catch(ie){return be.filter(_e=>_e.shouldLoad).forEach(_e=>{xt[_e.route.id]={type:"error",error:ie}}),xt}if(te.signal.aborted)return xt;for(let[ie,_e]of Object.entries(it))if(TA(_e)){let qe=_e.result;xt[ie]={type:"redirect",response:EA(qe,te,ie,be,h)}}else xt[ie]=await NA(_e);return xt}async function at(te,be,ve,Ue){let it=Be(ve,te,Ue,null),xt=Promise.all(be.map(async qe=>{if(qe.matches&&qe.match&&qe.request&&qe.controller){let pt=(await Be(qe.request,qe.matches,Ue,qe.key))[qe.match.route.id];return{[qe.key]:pt}}else return Promise.resolve({[qe.key]:{type:"error",error:as(404,{pathname:qe.path})}})})),ie=await it,_e=(await xt).reduce((qe,ht)=>Object.assign(qe,ht),{});return{loaderResults:ie,fetcherResults:_e}}function fe(){R=!0,T.forEach((te,be)=>{I.has(be)&&B.add(be),Se(be)})}function ce(te,be,ve={}){D.fetchers.set(te,be),ne({fetchers:new Map(D.fetchers)},{flushSync:(ve&&ve.flushSync)===!0})}function ye(te,be,ve,Ue={}){let it=Pr(D.matches,be);pe(te),ne({errors:{[it.route.id]:ve},fetchers:new Map(D.fetchers)},{flushSync:(Ue&&Ue.flushSync)===!0})}function Pe(te){return q.set(te,(q.get(te)||0)+1),Y.has(te)&&Y.delete(te),D.fetchers.get(te)||uA}function ee(te,be){Se(te,be?.reason),ce(te,ar(null))}function pe(te){let be=D.fetchers.get(te);I.has(te)&&!(be&&be.state==="loading"&&M.has(te))&&Se(te),T.delete(te),M.delete(te),U.delete(te),Y.delete(te),B.delete(te),D.fetchers.delete(te)}function me(te){let be=(q.get(te)||0)-1;be<=0?(q.delete(te),Y.add(te)):q.set(te,be),ne({fetchers:new Map(D.fetchers)})}function Se(te,be){let ve=I.get(te);ve&&(ve.abort(be),I.delete(te))}function Ge(te){for(let be of te){let ve=Pe(be),Ue=ar(ve.data);D.fetchers.set(be,Ue)}}function Xe(){let te=[],be=!1;for(let ve of U){let Ue=D.fetchers.get(ve);rn(Ue,`Expected fetcher: ${ve}`),Ue.state==="loading"&&(U.delete(ve),te.push(ve),be=!0)}return Ge(te),be}function et(te){let be=[];for(let[ve,Ue]of M)if(Ue<te){let it=D.fetchers.get(ve);rn(it,`Expected fetcher: ${ve}`),it.state==="loading"&&(Se(ve),M.delete(ve),be.push(ve))}return Ge(be),be.length>0}function Te(te,be){let ve=D.blockers.get(te)||Ni;return Q.get(te)!==be&&Q.set(te,be),ve}function mt(te){D.blockers.delete(te),Q.delete(te)}function Dt(te,be){let ve=D.blockers.get(te)||Ni;rn(ve.state==="unblocked"&&be.state==="blocked"||ve.state==="blocked"&&be.state==="blocked"||ve.state==="blocked"&&be.state==="proceeding"||ve.state==="blocked"&&be.state==="unblocked"||ve.state==="proceeding"&&be.state==="unblocked",`Invalid blocker state transition: ${ve.state} -> ${be.state}`);let Ue=new Map(D.blockers);Ue.set(te,be),ne({blockers:Ue})}function At({currentLocation:te,nextLocation:be,historyAction:ve}){if(Q.size===0)return;Q.size>1&&Vn(!1,"A router only supports one blocker at a time");let Ue=Array.from(Q.entries()),[it,xt]=Ue[Ue.length-1],ie=D.blockers.get(it);if(!(ie&&ie.state==="proceeding")&&xt({currentLocation:te,nextLocation:be,historyAction:ve}))return it}function Ke(te){let be=as(404,{pathname:te}),ve=m||f,{matches:Ue,route:it}=Ou(ve);return{notFoundMatches:Ue,route:it,error:be}}function ct(te,be,ve){if(S=te,N=be,w=ve||null,!E&&D.navigation===Dh){E=!0;let Ue=Qt(D.location,D.matches);Ue!=null&&ne({restoreScrollPosition:Ue})}return()=>{S=null,N=null,w=null}}function Rt(te,be){return w&&w(te,be.map(Ue=>BC(Ue,D.loaderData)))||te.key}function Ut(te,be){if(S&&N){let ve=Rt(te,be);S[ve]=N()}}function Qt(te,be){if(S){let ve=Rt(te,be),Ue=S[ve];if(typeof Ue=="number")return Ue}return null}function wt(te,be,ve){if(e.patchRoutesOnNavigation)if(te){if(Object.keys(te[0].params).length>0)return{active:!0,matches:fd(be,ve,h,!0)}}else return{active:!0,matches:fd(be,ve,h,!0)||[]};return{active:!1,matches:null}}async function Ft(te,be,ve,Ue){if(!e.patchRoutesOnNavigation)return{type:"success",matches:te};let it=te;for(;;){let xt=m==null,ie=m||f,_e=c;try{await e.patchRoutesOnNavigation({signal:ve,path:be,matches:it,fetcherKey:Ue,patch:(pt,Ee)=>{ve.aborted||d0(pt,Ee,ie,_e,l,!1)}})}catch(pt){return{type:"error",error:pt,partialMatches:it}}finally{xt&&!ve.aborted&&(f=[...f])}if(ve.aborted)return{type:"aborted"};let qe=Hr(ie,be,h);if(qe)return{type:"success",matches:qe};let ht=fd(ie,be,h,!0);if(!ht||it.length===ht.length&&it.every((pt,Ee)=>pt.route.id===ht[Ee].route.id))return{type:"success",matches:null};it=ht}}function Ht(te){c={},m=sc(te,l,void 0,c)}function kt(te,be,ve=!1){let Ue=m==null;d0(te,be,m||f,c,l,ve),Ue&&(f=[...f],ne({}))}return k={get basename(){return h},get future(){return y},get state(){return D},get routes(){return f},get window(){return t},initialize:de,subscribe:se,enableScrollRestoration:ct,navigate:Le,fetch:vt,revalidate:Me,createHref:te=>e.history.createHref(te),encodeLocation:te=>e.history.encodeLocation(te),getFetcher:Pe,resetFetcher:ee,deleteFetcher:me,dispose:J,getBlocker:Te,deleteBlocker:mt,patchRoutes:kt,_internalFetchControllers:I,_internalSetRoutes:Ht,_internalSetStateDoNotUseOrYouWillBreakYourApp(te){ne(te)}},k}function hA(e){return e!=null&&("formData"in e&&e.formData!=null||"body"in e&&e.body!==void 0)}function Ip(e,t,r,i,l,c){let f,m;if(l){f=[];for(let p of t)if(f.push(p),p.route.id===l){m=p;break}}else f=t,m=t[t.length-1];let h=Kd(i||".",Xd(f),ka(e.pathname,r)||e.pathname,c==="path");if(i==null&&(h.search=e.search,h.hash=e.hash),(i==null||i===""||i===".")&&m){let p=Ey(h.search);if(m.route.index&&!p)h.search=h.search?h.search.replace(/^\?/,"?index&"):"?index";else if(!m.route.index&&p){let y=new URLSearchParams(h.search),g=y.getAll("index");y.delete("index"),g.filter(S=>S).forEach(S=>y.append("index",S));let v=y.toString();h.search=v?`?${v}`:""}}return r!=="/"&&(h.pathname=JC({basename:r,pathname:h.pathname})),Kr(h)}function c0(e,t,r){if(!r||!hA(r))return{path:t};if(r.formMethod&&!MA(r.formMethod))return{path:t,error:as(405,{method:r.formMethod})};let i=()=>({path:t,error:as(400,{type:"invalid-body"})}),c=(r.formMethod||"get").toUpperCase(),f=Jw(t);if(r.body!==void 0){if(r.formEncType==="text/plain"){if(!Ta(c))return i();let g=typeof r.body=="string"?r.body:r.body instanceof FormData||r.body instanceof URLSearchParams?Array.from(r.body.entries()).reduce((v,[S,w])=>`${v}${S}=${w}
`,""):String(r.body);return{path:t,submission:{formMethod:c,formAction:f,formEncType:r.formEncType,formData:void 0,json:void 0,text:g}}}else if(r.formEncType==="application/json"){if(!Ta(c))return i();try{let g=typeof r.body=="string"?JSON.parse(r.body):r.body;return{path:t,submission:{formMethod:c,formAction:f,formEncType:r.formEncType,formData:void 0,json:g,text:void 0}}}catch{return i()}}}rn(typeof FormData=="function","FormData is not available in this environment");let m,h;if(r.formData)m=zp(r.formData),h=r.formData;else if(r.body instanceof FormData)m=zp(r.body),h=r.body;else if(r.body instanceof URLSearchParams)m=r.body,h=y0(m);else if(r.body==null)m=new URLSearchParams,h=new FormData;else try{m=new URLSearchParams(r.body),h=y0(m)}catch{return i()}let p={formMethod:c,formAction:f,formEncType:r&&r.formEncType||"application/x-www-form-urlencoded",formData:h,json:void 0,text:void 0};if(Ta(p.formMethod))return{path:t,submission:p};let y=Jr(t);return e&&y.search&&Ey(y.search)&&m.append("index",""),y.search=`?${m}`,{path:Kr(y),submission:p}}function u0(e,t,r,i,l,c,f,m,h,p,y,g,v,S,w,N,E,C,A,O){let _=O?qa(O[1])?O[1].error:O[1].data:void 0,k=l.createURL(c.location),D=l.createURL(h),j;if(y&&c.errors){let V=Object.keys(c.errors)[0];j=f.findIndex(R=>R.route.id===V)}else if(O&&qa(O[1])){let V=O[0];j=f.findIndex(R=>R.route.id===V)-1}let z=O?O[1].statusCode:void 0,P=z&&z>=400,G={currentUrl:k,currentParams:c.matches[0]?.params||{},nextUrl:D,nextParams:f[0].params,...m,actionResult:_,actionStatus:z},H=f.map((V,R)=>{let{route:B}=V,I=null;if(j!=null&&R>j?I=!1:B.lazy?I=!0:Ny(B)?y?I=Lp(B,c.loaderData,c.errors):pA(c.loaderData,c.matches[R],V)&&(I=!0):I=!1,I!==null)return Op(r,i,e,V,p,t,I);let L=P?!1:g||k.pathname+k.search===D.pathname+D.search||k.search!==D.search||yA(c.matches[R],V),$={...G,defaultShouldRevalidate:L},M=Td(V,$);return Op(r,i,e,V,p,t,M,$)}),X=[];return w.forEach((V,R)=>{if(y||!f.some(q=>q.route.id===V.routeId)||S.has(R))return;let B=c.fetchers.get(R),I=B&&B.state!=="idle"&&B.data===void 0,L=Hr(E,V.path,C);if(!L){if(A&&I)return;X.push({key:R,routeId:V.routeId,path:V.path,matches:null,match:null,request:null,controller:null});return}if(N.has(R))return;let $=md(L,V.path),M=new AbortController,U=xl(l,V.path,M.signal),T=null;if(v.has(R))v.delete(R),T=wl(r,i,U,L,$,p,t);else if(I)g&&(T=wl(r,i,U,L,$,p,t));else{let q={...G,defaultShouldRevalidate:P?!1:g};Td($,q)&&(T=wl(r,i,U,L,$,p,t,q))}T&&X.push({key:R,routeId:V.routeId,path:V.path,matches:T,match:$,request:U,controller:M})}),{dsMatches:H,revalidatingFetchers:X}}function Ny(e){return e.loader!=null||e.middleware!=null&&e.middleware.length>0}function Lp(e,t,r){if(e.lazy)return!0;if(!Ny(e))return!1;let i=t!=null&&e.id in t,l=r!=null&&r[e.id]!==void 0;return!i&&l?!1:typeof e.loader=="function"&&e.loader.hydrate===!0?!0:!i&&!l}function pA(e,t,r){let i=!t||r.route.id!==t.route.id,l=!e.hasOwnProperty(r.route.id);return i||l}function yA(e,t){let r=e.route.path;return e.pathname!==t.pathname||r!=null&&r.endsWith("*")&&e.params["*"]!==t.params["*"]}function Td(e,t){if(e.route.shouldRevalidate){let r=e.route.shouldRevalidate(t);if(typeof r=="boolean")return r}return t.defaultShouldRevalidate}function d0(e,t,r,i,l,c){let f;if(e){let p=i[e];rn(p,`No route found to patch children into: routeId = ${e}`),p.children||(p.children=[]),f=p.children}else f=r;let m=[],h=[];if(t.forEach(p=>{let y=f.find(g=>Xw(p,g));y?h.push({existingRoute:y,newRoute:p}):m.push(p)}),m.length>0){let p=sc(m,l,[e||"_","patch",String(f?.length||"0")],i);f.push(...p)}if(c&&h.length>0)for(let p=0;p<h.length;p++){let{existingRoute:y,newRoute:g}=h[p],v=y,[S]=sc([g],l,[],{},!0);Object.assign(v,{element:S.element?S.element:v.element,errorElement:S.errorElement?S.errorElement:v.errorElement,hydrateFallbackElement:S.hydrateFallbackElement?S.hydrateFallbackElement:v.hydrateFallbackElement})}}function Xw(e,t){return"id"in e&&"id"in t&&e.id===t.id?!0:e.index===t.index&&e.path===t.path&&e.caseSensitive===t.caseSensitive?(!e.children||e.children.length===0)&&(!t.children||t.children.length===0)?!0:e.children.every((r,i)=>t.children?.some(l=>Xw(r,l))):!1}var f0=new WeakMap,Kw=({key:e,route:t,manifest:r,mapRouteProperties:i})=>{let l=r[t.id];if(rn(l,"No route found in manifest"),!l.lazy||typeof l.lazy!="object")return;let c=l.lazy[e];if(!c)return;let f=f0.get(l);f||(f={},f0.set(l,f));let m=f[e];if(m)return m;let h=(async()=>{let p=OC(e),g=l[e]!==void 0&&e!=="hasErrorBoundary";if(p)Vn(!p,"Route property "+e+" is not a supported lazy route property. This property will be ignored."),f[e]=Promise.resolve();else if(g)Vn(!1,`Route "${l.id}" has a static property "${e}" defined. The lazy property will be ignored.`);else{let v=await c();v!=null&&(Object.assign(l,{[e]:v}),Object.assign(l,i(l)))}typeof l.lazy=="object"&&(l.lazy[e]=void 0,Object.values(l.lazy).every(v=>v===void 0)&&(l.lazy=void 0))})();return f[e]=h,h},m0=new WeakMap;function gA(e,t,r,i,l){let c=r[e.id];if(rn(c,"No route found in manifest"),!e.lazy)return{lazyRoutePromise:void 0,lazyHandlerPromise:void 0};if(typeof e.lazy=="function"){let y=m0.get(c);if(y)return{lazyRoutePromise:y,lazyHandlerPromise:y};let g=(async()=>{rn(typeof e.lazy=="function","No lazy route function found");let v=await e.lazy(),S={};for(let w in v){let N=v[w];if(N===void 0)continue;let E=$C(w),A=c[w]!==void 0&&w!=="hasErrorBoundary";E?Vn(!E,"Route property "+w+" is not a supported property to be returned from a lazy route function. This property will be ignored."):A?Vn(!A,`Route "${c.id}" has a static property "${w}" defined but its lazy function is also returning a value for this property. The lazy route property "${w}" will be ignored.`):S[w]=N}Object.assign(c,S),Object.assign(c,{...i(c),lazy:void 0})})();return m0.set(c,g),g.catch(()=>{}),{lazyRoutePromise:g,lazyHandlerPromise:g}}let f=Object.keys(e.lazy),m=[],h;for(let y of f){if(l&&l.includes(y))continue;let g=Kw({key:y,route:e,manifest:r,mapRouteProperties:i});g&&(m.push(g),y===t&&(h=g))}let p=m.length>0?Promise.all(m).then(()=>{}):void 0;return p?.catch(()=>{}),h?.catch(()=>{}),{lazyRoutePromise:p,lazyHandlerPromise:h}}async function h0(e){let t=e.matches.filter(l=>l.shouldLoad),r={};return(await Promise.all(t.map(l=>l.resolve()))).forEach((l,c)=>{r[t[c].route.id]=l}),r}async function bA(e){return e.matches.some(t=>t.route.middleware)?Ww(e,()=>h0(e)):h0(e)}function Ww(e,t){return vA(e,t,i=>i,CA,r);function r(i,l,c){if(c)return Promise.resolve(Object.assign(c.value,{[l]:{type:"error",result:i}}));{let{matches:f}=e,m=Math.min(Math.max(f.findIndex(p=>p.route.id===l),0),Math.max(f.findIndex(p=>p.unstable_shouldCallHandler()),0)),h=Pr(f,f[m].route.id).route.id;return Promise.resolve({[h]:{type:"error",result:i}})}}}async function vA(e,t,r,i,l){let{matches:c,request:f,params:m,context:h}=e,p=c.flatMap(g=>g.route.middleware?g.route.middleware.map(v=>[g.route.id,v]):[]);return await Zw({request:f,params:m,context:h},p,t,r,i,l)}async function Zw(e,t,r,i,l,c,f=0){let{request:m}=e;if(m.signal.aborted)throw m.signal.reason??new Error(`Request aborted: ${m.method} ${m.url}`);let h=t[f];if(!h)return await r();let[p,y]=h,g,v=async()=>{if(g)throw new Error("You may only call `next()` once per middleware");try{return g={value:await Zw(e,t,r,i,l,c,f+1)},g.value}catch(S){return g={value:await c(S,p,g)},g.value}};try{let S=await y(e,v),w=S!=null?i(S):void 0;return l(w)?w:g?w??g.value:(g={value:await v()},g.value)}catch(S){return await c(S,p,g)}}function Qw(e,t,r,i,l){let c=Kw({key:"middleware",route:i.route,manifest:t,mapRouteProperties:e}),f=gA(i.route,Ta(r.method)?"action":"loader",t,e,l);return{middleware:c,route:f.lazyRoutePromise,handler:f.lazyHandlerPromise}}function Op(e,t,r,i,l,c,f,m=null){let h=!1,p=Qw(e,t,r,i,l);return{...i,_lazyPromises:p,shouldLoad:f,unstable_shouldRevalidateArgs:m,unstable_shouldCallHandler(y){return h=!0,m?typeof y=="boolean"?Td(i,{...m,defaultShouldRevalidate:y}):Td(i,m):f},resolve(y){let{lazy:g,loader:v,middleware:S}=i.route,w=h||f||y&&!Ta(r.method)&&(g||v),N=S&&S.length>0&&!v&&!g;return w&&!N?SA({request:r,match:i,lazyHandlerPromise:p?.handler,lazyRoutePromise:p?.route,handlerOverride:y,scopedContext:c}):Promise.resolve({type:"data",result:void 0})}}}function wl(e,t,r,i,l,c,f,m=null){return i.map(h=>h.route.id!==l.route.id?{...h,shouldLoad:!1,unstable_shouldRevalidateArgs:m,unstable_shouldCallHandler:()=>!1,_lazyPromises:Qw(e,t,r,h,c),resolve:()=>Promise.resolve({type:"data",result:void 0})}:Op(e,t,r,h,c,f,!0,m))}async function xA(e,t,r,i,l,c){r.some(p=>p._lazyPromises?.middleware)&&await Promise.all(r.map(p=>p._lazyPromises?.middleware));let f={request:t,params:r[0].params,context:l,matches:r},h=await e({...f,fetcherKey:i,runClientMiddleware:p=>{let y=f;return Ww(y,()=>p({...y,fetcherKey:i,runClientMiddleware:()=>{throw new Error("Cannot call `runClientMiddleware()` from within an `runClientMiddleware` handler")}}))}});try{await Promise.all(r.flatMap(p=>[p._lazyPromises?.handler,p._lazyPromises?.route]))}catch{}return h}async function SA({request:e,match:t,lazyHandlerPromise:r,lazyRoutePromise:i,handlerOverride:l,scopedContext:c}){let f,m,h=Ta(e.method),p=h?"action":"loader",y=g=>{let v,S=new Promise((E,C)=>v=C);m=()=>v(),e.signal.addEventListener("abort",m);let w=E=>typeof g!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${p}" [routeId: ${t.route.id}]`)):g({request:e,params:t.params,context:c},...E!==void 0?[E]:[]),N=(async()=>{try{return{type:"data",result:await(l?l(C=>w(C)):w())}}catch(E){return{type:"error",result:E}}})();return Promise.race([N,S])};try{let g=h?t.route.action:t.route.loader;if(r||i)if(g){let v,[S]=await Promise.all([y(g).catch(w=>{v=w}),r,i]);if(v!==void 0)throw v;f=S}else{await r;let v=h?t.route.action:t.route.loader;if(v)[f]=await Promise.all([y(v),i]);else if(p==="action"){let S=new URL(e.url),w=S.pathname+S.search;throw as(405,{method:e.method,pathname:w,routeId:t.route.id})}else return{type:"data",result:void 0}}else if(g)f=await y(g);else{let v=new URL(e.url),S=v.pathname+v.search;throw as(404,{pathname:S})}}catch(g){return{type:"error",result:g}}finally{m&&e.signal.removeEventListener("abort",m)}return f}async function wA(e){let t=e.headers.get("Content-Type");return t&&/\bapplication\/json\b/.test(t)?e.body==null?null:e.json():e.text()}async function NA(e){let{result:t,type:r}=e;if(e1(t)){let i;try{i=await wA(t)}catch(l){return{type:"error",error:l}}return r==="error"?{type:"error",error:new Ad(t.status,t.statusText,i),statusCode:t.status,headers:t.headers}:{type:"data",data:i,statusCode:t.status,headers:t.headers}}return r==="error"?x0(t)?t.data instanceof Error?{type:"error",error:t.data,statusCode:t.init?.status,headers:t.init?.headers?new Headers(t.init.headers):void 0}:{type:"error",error:new Ad(t.init?.status||500,void 0,t.data),statusCode:rc(t)?t.status:void 0,headers:t.init?.headers?new Headers(t.init.headers):void 0}:{type:"error",error:t,statusCode:rc(t)?t.status:void 0}:x0(t)?{type:"data",data:t.data,statusCode:t.init?.status,headers:t.init?.headers?new Headers(t.init.headers):void 0}:{type:"data",data:t}}function EA(e,t,r,i,l){let c=e.headers.get("Location");if(rn(c,"Redirects returned/thrown from loaders/actions must have a Location header"),!wy(c)){let f=i.slice(0,i.findIndex(m=>m.route.id===r)+1);c=Ip(new URL(t.url),f,l,c),e.headers.set("Location",c)}return e}function p0(e,t,r){if(wy(e)){let i=e,l=i.startsWith("//")?new URL(t.protocol+i):new URL(i),c=ka(l.pathname,r)!=null;if(l.origin===t.origin&&c)return l.pathname+l.search+l.hash}return e}function xl(e,t,r,i){let l=e.createURL(Jw(t)).toString(),c={signal:r};if(i&&Ta(i.formMethod)){let{formMethod:f,formEncType:m}=i;c.method=f.toUpperCase(),m==="application/json"?(c.headers=new Headers({"Content-Type":m}),c.body=JSON.stringify(i.json)):m==="text/plain"?c.body=i.text:m==="application/x-www-form-urlencoded"&&i.formData?c.body=zp(i.formData):c.body=i.formData}return new Request(l,c)}function zp(e){let t=new URLSearchParams;for(let[r,i]of e.entries())t.append(r,typeof i=="string"?i:i.name);return t}function y0(e){let t=new FormData;for(let[r,i]of e.entries())t.append(r,i);return t}function jA(e,t,r,i=!1,l=!1){let c={},f=null,m,h=!1,p={},y=r&&qa(r[1])?r[1].error:void 0;return e.forEach(g=>{if(!(g.route.id in t))return;let v=g.route.id,S=t[v];if(rn(!ji(S),"Cannot handle redirect results in processLoaderData"),qa(S)){let w=S.error;if(y!==void 0&&(w=y,y=void 0),f=f||{},l)f[v]=w;else{let N=Pr(e,v);f[N.route.id]==null&&(f[N.route.id]=w)}i||(c[v]=Gw),h||(h=!0,m=rc(S.error)?S.error.status:500),S.headers&&(p[v]=S.headers)}else c[v]=S.data,S.statusCode&&S.statusCode!==200&&!h&&(m=S.statusCode),S.headers&&(p[v]=S.headers)}),y!==void 0&&r&&(f={[r[0]]:y},r[2]&&(c[r[2]]=void 0)),{loaderData:c,errors:f,statusCode:m||200,loaderHeaders:p}}function g0(e,t,r,i,l,c){let{loaderData:f,errors:m}=jA(t,r,i);return l.filter(h=>!h.matches||h.matches.some(p=>p.shouldLoad)).forEach(h=>{let{key:p,match:y,controller:g}=h;if(g&&g.signal.aborted)return;let v=c[p];if(rn(v,"Did not find corresponding fetcher result"),qa(v)){let S=Pr(e.matches,y?.route.id);m&&m[S.route.id]||(m={...m,[S.route.id]:v.error}),e.fetchers.delete(p)}else if(ji(v))rn(!1,"Unhandled fetcher revalidation redirect");else{let S=ar(v.data);e.fetchers.set(p,S)}}),{loaderData:f,errors:m}}function b0(e,t,r,i){let l=Object.entries(t).filter(([,c])=>c!==Gw).reduce((c,[f,m])=>(c[f]=m,c),{});for(let c of r){let f=c.route.id;if(!t.hasOwnProperty(f)&&e.hasOwnProperty(f)&&c.route.loader&&(l[f]=e[f]),i&&i.hasOwnProperty(f))break}return l}function v0(e){return e?qa(e[1])?{actionData:{}}:{actionData:{[e[0]]:e[1].data}}:{}}function Pr(e,t){return(t?e.slice(0,e.findIndex(i=>i.route.id===t)+1):[...e]).reverse().find(i=>i.route.hasErrorBoundary===!0)||e[0]}function Ou(e){let t=e.length===1?e[0]:e.find(r=>r.index||!r.path||r.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:t}],route:t}}function as(e,{pathname:t,routeId:r,method:i,type:l,message:c}={}){let f="Unknown Server Error",m="Unknown @remix-run/router error";return e===400?(f="Bad Request",i&&t&&r?m=`You made a ${i} request to "${t}" but did not provide a \`loader\` for route "${r}", so there is no way to handle the request.`:l==="invalid-body"&&(m="Unable to encode submission body")):e===403?(f="Forbidden",m=`Route "${r}" does not match URL "${t}"`):e===404?(f="Not Found",m=`No route matches URL "${t}"`):e===405&&(f="Method Not Allowed",i&&t&&r?m=`You made a ${i.toUpperCase()} request to "${t}" but did not provide an \`action\` for route "${r}", so there is no way to handle the request.`:i&&(m=`Invalid request method "${i.toUpperCase()}"`)),new Ad(e||500,f,new Error(m),!0)}function zu(e){let t=Object.entries(e);for(let r=t.length-1;r>=0;r--){let[i,l]=t[r];if(ji(l))return{key:i,result:l}}}function Jw(e){let t=typeof e=="string"?Jr(e):e;return Kr({...t,hash:""})}function _A(e,t){return e.pathname!==t.pathname||e.search!==t.search?!1:e.hash===""?t.hash!=="":e.hash===t.hash?!0:t.hash!==""}function CA(e){return e!=null&&typeof e=="object"&&Object.entries(e).every(([t,r])=>typeof t=="string"&&AA(r))}function AA(e){return e!=null&&typeof e=="object"&&"type"in e&&"result"in e&&(e.type==="data"||e.type==="error")}function TA(e){return e1(e.result)&&oA.has(e.result.status)}function qa(e){return e.type==="error"}function ji(e){return(e&&e.type)==="redirect"}function x0(e){return typeof e=="object"&&e!=null&&"type"in e&&"data"in e&&"init"in e&&e.type==="DataWithResponseInit"}function e1(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.headers=="object"&&typeof e.body<"u"}function MA(e){return lA.has(e.toUpperCase())}function Ta(e){return rA.has(e.toUpperCase())}function Ey(e){return new URLSearchParams(e).getAll("index").some(t=>t==="")}function md(e,t){let r=typeof t=="string"?Jr(t).search:t.search;if(e[e.length-1].route.index&&Ey(r||""))return e[e.length-1];let i=Pw(e);return i[i.length-1]}function S0(e){let{formMethod:t,formAction:r,formEncType:i,text:l,formData:c,json:f}=e;if(!(!t||!r||!i)){if(l!=null)return{formMethod:t,formAction:r,formEncType:i,formData:void 0,json:void 0,text:l};if(c!=null)return{formMethod:t,formAction:r,formEncType:i,formData:c,json:void 0,text:void 0};if(f!==void 0)return{formMethod:t,formAction:r,formEncType:i,formData:void 0,json:f,text:void 0}}}function Ih(e,t){return t?{state:"loading",location:e,formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text}:{state:"loading",location:e,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function RA(e,t){return{state:"submitting",location:e,formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text}}function To(e,t){return e?{state:"loading",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:t}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function kA(e,t){return{state:"submitting",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:t?t.data:void 0}}function ar(e){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function DA(e,t){try{let r=e.sessionStorage.getItem(Yw);if(r){let i=JSON.parse(r);for(let[l,c]of Object.entries(i||{}))c&&Array.isArray(c)&&t.set(l,new Set(c||[]))}}catch{}}function IA(e,t){if(t.size>0){let r={};for(let[i,l]of t)r[i]=[...l];try{e.sessionStorage.setItem(Yw,JSON.stringify(r))}catch(i){Vn(!1,`Failed to save applied view transitions in sessionStorage (${i}).`)}}}function LA(){let e,t,r=new Promise((i,l)=>{e=async c=>{i(c);try{await r}catch{}},t=async c=>{l(c);try{await r}catch{}}});return{promise:r,resolve:e,reject:t}}var Ii=u.createContext(null);Ii.displayName="DataRouter";var wc=u.createContext(null);wc.displayName="DataRouterState";u.createContext(!1);var jy=u.createContext({isTransitioning:!1});jy.displayName="ViewTransition";var t1=u.createContext(new Map);t1.displayName="Fetchers";var OA=u.createContext(null);OA.displayName="Await";var Ss=u.createContext(null);Ss.displayName="Navigation";var Wd=u.createContext(null);Wd.displayName="Location";var ls=u.createContext({outlet:null,matches:[],isDataRoute:!1});ls.displayName="Route";var _y=u.createContext(null);_y.displayName="RouteError";function zA(e,{relative:t}={}){rn(Dl(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:i}=u.useContext(Ss),{hash:l,pathname:c,search:f}=Nc(e,{relative:t}),m=c;return r!=="/"&&(m=c==="/"?r:Ds([r,c])),i.createHref({pathname:m,search:f,hash:l})}function Dl(){return u.useContext(Wd)!=null}function Ga(){return rn(Dl(),"useLocation() may be used only in the context of a <Router> component."),u.useContext(Wd).location}var n1="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function a1(e){u.useContext(Ss).static||u.useLayoutEffect(e)}function $n(){let{isDataRoute:e}=u.useContext(ls);return e?ZA():$A()}function $A(){rn(Dl(),"useNavigate() may be used only in the context of a <Router> component.");let e=u.useContext(Ii),{basename:t,navigator:r}=u.useContext(Ss),{matches:i}=u.useContext(ls),{pathname:l}=Ga(),c=JSON.stringify(Xd(i)),f=u.useRef(!1);return a1(()=>{f.current=!0}),u.useCallback((h,p={})=>{if(Vn(f.current,n1),!f.current)return;if(typeof h=="number"){r.go(h);return}let y=Kd(h,JSON.parse(c),l,p.relative==="path");e==null&&t!=="/"&&(y.pathname=y.pathname==="/"?t:Ds([t,y.pathname])),(p.replace?r.replace:r.push)(y,p.state,p)},[t,r,c,l,e])}var FA=u.createContext(null);function BA(e){let t=u.useContext(ls).outlet;return u.useMemo(()=>t&&u.createElement(FA.Provider,{value:e},t),[t,e])}function ws(){let{matches:e}=u.useContext(ls),t=e[e.length-1];return t?t.params:{}}function Nc(e,{relative:t}={}){let{matches:r}=u.useContext(ls),{pathname:i}=Ga(),l=JSON.stringify(Xd(r));return u.useMemo(()=>Kd(e,JSON.parse(l),i,t==="path"),[e,l,i,t])}function UA(e,t,r,i,l){rn(Dl(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:c}=u.useContext(Ss),{matches:f}=u.useContext(ls),m=f[f.length-1],h=m?m.params:{},p=m?m.pathname:"/",y=m?m.pathnameBase:"/",g=m&&m.route;{let A=g&&g.path||"";l1(p,!g||A.endsWith("*")||A.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${p}" (under <Route path="${A}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${A}"> to <Route path="${A==="/"?"*":`${A}/*`}">.`)}let v=Ga(),S;S=v;let w=S.pathname||"/",N=w;if(y!=="/"){let A=y.replace(/^\//,"").split("/");N="/"+w.replace(/^\//,"").split("/").slice(A.length).join("/")}let E=Hr(e,{pathname:N});return Vn(g||E!=null,`No routes matched location "${S.pathname}${S.search}${S.hash}" `),Vn(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${S.pathname}${S.search}${S.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),YA(E&&E.map(A=>Object.assign({},A,{params:Object.assign({},h,A.params),pathname:Ds([y,c.encodeLocation?c.encodeLocation(A.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:A.pathname]),pathnameBase:A.pathnameBase==="/"?y:Ds([y,c.encodeLocation?c.encodeLocation(A.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:A.pathnameBase])})),f,r,i,l)}function qA(){let e=KA(),t=rc(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",l={padding:"0.5rem",backgroundColor:i},c={padding:"2px 4px",backgroundColor:i},f=null;return console.error("Error handled by React Router default ErrorBoundary:",e),f=u.createElement(u.Fragment,null,u.createElement("p",null," Hey developer "),u.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",u.createElement("code",{style:c},"ErrorBoundary")," or"," ",u.createElement("code",{style:c},"errorElement")," prop on your route.")),u.createElement(u.Fragment,null,u.createElement("h2",null,"Unexpected Application Error!"),u.createElement("h3",{style:{fontStyle:"italic"}},t),r?u.createElement("pre",{style:l},r):null,f)}var HA=u.createElement(qA,null),PA=class extends u.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.unstable_onError?this.props.unstable_onError(e,t):console.error("React Router caught the following error during render",e)}render(){return this.state.error!==void 0?u.createElement(ls.Provider,{value:this.props.routeContext},u.createElement(_y.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function VA({routeContext:e,match:t,children:r}){let i=u.useContext(Ii);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),u.createElement(ls.Provider,{value:e},r)}function YA(e,t=[],r=null,i=null,l=null){if(e==null){if(!r)return null;if(r.errors)e=r.matches;else if(t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let c=e,f=r?.errors;if(f!=null){let p=c.findIndex(y=>y.route.id&&f?.[y.route.id]!==void 0);rn(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(f).join(",")}`),c=c.slice(0,Math.min(c.length,p+1))}let m=!1,h=-1;if(r)for(let p=0;p<c.length;p++){let y=c[p];if((y.route.HydrateFallback||y.route.hydrateFallbackElement)&&(h=p),y.route.id){let{loaderData:g,errors:v}=r,S=y.route.loader&&!g.hasOwnProperty(y.route.id)&&(!v||v[y.route.id]===void 0);if(y.route.lazy||S){m=!0,h>=0?c=c.slice(0,h+1):c=[c[0]];break}}}return c.reduceRight((p,y,g)=>{let v,S=!1,w=null,N=null;r&&(v=f&&y.route.id?f[y.route.id]:void 0,w=y.route.errorElement||HA,m&&(h<0&&g===0?(l1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),S=!0,N=null):h===g&&(S=!0,N=y.route.hydrateFallbackElement||null)));let E=t.concat(c.slice(0,g+1)),C=()=>{let A;return v?A=w:S?A=N:y.route.Component?A=u.createElement(y.route.Component,null):y.route.element?A=y.route.element:A=p,u.createElement(VA,{match:y,routeContext:{outlet:p,matches:E,isDataRoute:r!=null},children:A})};return r&&(y.route.ErrorBoundary||y.route.errorElement||g===0)?u.createElement(PA,{location:r.location,revalidation:r.revalidation,component:w,error:v,children:C(),routeContext:{outlet:null,matches:E,isDataRoute:!0},unstable_onError:i}):C()},null)}function Cy(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function s1(e){let t=u.useContext(Ii);return rn(t,Cy(e)),t}function r1(e){let t=u.useContext(wc);return rn(t,Cy(e)),t}function GA(e){let t=u.useContext(ls);return rn(t,Cy(e)),t}function Ay(e){let t=GA(e),r=t.matches[t.matches.length-1];return rn(r.route.id,`${e} can only be used on routes that contain a unique "id"`),r.route.id}function XA(){return Ay("useRouteId")}function KA(){let e=u.useContext(_y),t=r1("useRouteError"),r=Ay("useRouteError");return e!==void 0?e:t.errors?.[r]}var WA=0;function i1(e){let{router:t,basename:r}=s1("useBlocker"),i=r1("useBlocker"),[l,c]=u.useState(""),f=u.useCallback(m=>{if(typeof e!="function")return!!e;if(r==="/")return e(m);let{currentLocation:h,nextLocation:p,historyAction:y}=m;return e({currentLocation:{...h,pathname:ka(h.pathname,r)||h.pathname},nextLocation:{...p,pathname:ka(p.pathname,r)||p.pathname},historyAction:y})},[r,e]);return u.useEffect(()=>{let m=String(++WA);return c(m),()=>t.deleteBlocker(m)},[t]),u.useEffect(()=>{l!==""&&t.getBlocker(l,f)},[t,l,f]),l&&i.blockers.has(l)?i.blockers.get(l):Ni}function ZA(){let{router:e}=s1("useNavigate"),t=Ay("useNavigate"),r=u.useRef(!1);return a1(()=>{r.current=!0}),u.useCallback(async(l,c={})=>{Vn(r.current,n1),r.current&&(typeof l=="number"?e.navigate(l):await e.navigate(l,{fromRouteId:t,...c}))},[e,t])}var w0={};function l1(e,t,r){!t&&!w0[e]&&(w0[e]=!0,Vn(!1,r))}var N0={};function E0(e,t){!e&&!N0[t]&&(N0[t]=!0,console.warn(t))}function QA(e){let t={hasErrorBoundary:e.hasErrorBoundary||e.ErrorBoundary!=null||e.errorElement!=null};return e.Component&&(e.element&&Vn(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(t,{element:u.createElement(e.Component),Component:void 0})),e.HydrateFallback&&(e.hydrateFallbackElement&&Vn(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(t,{hydrateFallbackElement:u.createElement(e.HydrateFallback),HydrateFallback:void 0})),e.ErrorBoundary&&(e.errorElement&&Vn(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(t,{errorElement:u.createElement(e.ErrorBoundary),ErrorBoundary:void 0})),t}var JA=["HydrateFallback","hydrateFallbackElement"],e2=class{constructor(){this.status="pending",this.promise=new Promise((e,t)=>{this.resolve=r=>{this.status==="pending"&&(this.status="resolved",e(r))},this.reject=r=>{this.status==="pending"&&(this.status="rejected",t(r))}})}};function t2({router:e,flushSync:t,unstable_onError:r}){let[i,l]=u.useState(e.state),[c,f]=u.useState(),[m,h]=u.useState({isTransitioning:!1}),[p,y]=u.useState(),[g,v]=u.useState(),[S,w]=u.useState(),N=u.useRef(new Map),E=u.useCallback(k=>{l(D=>(k.errors&&r&&Object.entries(k.errors).forEach(([j,z])=>{D.errors?.[j]!==z&&r(z)}),k))},[r]),C=u.useCallback((k,{deletedFetchers:D,flushSync:j,viewTransitionOpts:z})=>{k.fetchers.forEach((G,H)=>{G.data!==void 0&&N.current.set(H,G.data)}),D.forEach(G=>N.current.delete(G)),E0(j===!1||t!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let P=e.window!=null&&e.window.document!=null&&typeof e.window.document.startViewTransition=="function";if(E0(z==null||P,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!z||!P){t&&j?t(()=>E(k)):u.startTransition(()=>E(k));return}if(t&&j){t(()=>{g&&(p&&p.resolve(),g.skipTransition()),h({isTransitioning:!0,flushSync:!0,currentLocation:z.currentLocation,nextLocation:z.nextLocation})});let G=e.window.document.startViewTransition(()=>{t(()=>E(k))});G.finished.finally(()=>{t(()=>{y(void 0),v(void 0),f(void 0),h({isTransitioning:!1})})}),t(()=>v(G));return}g?(p&&p.resolve(),g.skipTransition(),w({state:k,currentLocation:z.currentLocation,nextLocation:z.nextLocation})):(f(k),h({isTransitioning:!0,flushSync:!1,currentLocation:z.currentLocation,nextLocation:z.nextLocation}))},[e.window,t,g,p,E]);u.useLayoutEffect(()=>e.subscribe(C),[e,C]),u.useEffect(()=>{m.isTransitioning&&!m.flushSync&&y(new e2)},[m]),u.useEffect(()=>{if(p&&c&&e.window){let k=c,D=p.promise,j=e.window.document.startViewTransition(async()=>{u.startTransition(()=>E(k)),await D});j.finished.finally(()=>{y(void 0),v(void 0),f(void 0),h({isTransitioning:!1})}),v(j)}},[c,p,e.window,E]),u.useEffect(()=>{p&&c&&i.location.key===c.location.key&&p.resolve()},[p,g,i.location,c]),u.useEffect(()=>{!m.isTransitioning&&S&&(f(S.state),h({isTransitioning:!0,flushSync:!1,currentLocation:S.currentLocation,nextLocation:S.nextLocation}),w(void 0))},[m.isTransitioning,S]);let A=u.useMemo(()=>({createHref:e.createHref,encodeLocation:e.encodeLocation,go:k=>e.navigate(k),push:(k,D,j)=>e.navigate(k,{state:D,preventScrollReset:j?.preventScrollReset}),replace:(k,D,j)=>e.navigate(k,{replace:!0,state:D,preventScrollReset:j?.preventScrollReset})}),[e]),O=e.basename||"/",_=u.useMemo(()=>({router:e,navigator:A,static:!1,basename:O,unstable_onError:r}),[e,A,O,r]);return u.createElement(u.Fragment,null,u.createElement(Ii.Provider,{value:_},u.createElement(wc.Provider,{value:i},u.createElement(t1.Provider,{value:N.current},u.createElement(jy.Provider,{value:m},u.createElement(r2,{basename:O,location:i.location,navigationType:i.historyAction,navigator:A},u.createElement(n2,{routes:e.routes,future:e.future,state:i,unstable_onError:r})))))),null)}var n2=u.memo(a2);function a2({routes:e,future:t,state:r,unstable_onError:i}){return UA(e,void 0,r,i,t)}function Xo({to:e,replace:t,state:r,relative:i}){rn(Dl(),"<Navigate> may be used only in the context of a <Router> component.");let{static:l}=u.useContext(Ss);Vn(!l,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:c}=u.useContext(ls),{pathname:f}=Ga(),m=$n(),h=Kd(e,Xd(c),f,i==="path"),p=JSON.stringify(h);return u.useEffect(()=>{m(JSON.parse(p),{replace:t,state:r,relative:i})},[m,p,i,t,r]),null}function s2(e){return BA(e.context)}function Xt(e){rn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function r2({basename:e="/",children:t=null,location:r,navigationType:i="POP",navigator:l,static:c=!1}){rn(!Dl(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let f=e.replace(/^\/*/,"/"),m=u.useMemo(()=>({basename:f,navigator:l,static:c,future:{}}),[f,l,c]);typeof r=="string"&&(r=Jr(r));let{pathname:h="/",search:p="",hash:y="",state:g=null,key:v="default"}=r,S=u.useMemo(()=>{let w=ka(h,f);return w==null?null:{location:{pathname:w,search:p,hash:y,state:g,key:v},navigationType:i}},[f,h,p,y,g,v,i]);return Vn(S!=null,`<Router basename="${f}"> is not able to match the URL "${h}${p}${y}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:u.createElement(Ss.Provider,{value:m},u.createElement(Wd.Provider,{children:t,value:S}))}function $p(e,t=[]){let r=[];return u.Children.forEach(e,(i,l)=>{if(!u.isValidElement(i))return;let c=[...t,l];if(i.type===u.Fragment){r.push.apply(r,$p(i.props.children,c));return}rn(i.type===Xt,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),rn(!i.props.index||!i.props.children,"An index route cannot have child routes.");let f={id:i.props.id||c.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(f.children=$p(i.props.children,c)),r.push(f)}),r}var i2=$p,hd="get",pd="application/x-www-form-urlencoded";function Zd(e){return e!=null&&typeof e.tagName=="string"}function l2(e){return Zd(e)&&e.tagName.toLowerCase()==="button"}function o2(e){return Zd(e)&&e.tagName.toLowerCase()==="form"}function c2(e){return Zd(e)&&e.tagName.toLowerCase()==="input"}function u2(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function d2(e,t){return e.button===0&&(!t||t==="_self")&&!u2(e)}function Fp(e=""){return new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let i=e[r];return t.concat(Array.isArray(i)?i.map(l=>[r,l]):[[r,i]])},[]))}function f2(e,t){let r=Fp(e);return t&&t.forEach((i,l)=>{r.has(l)||t.getAll(l).forEach(c=>{r.append(l,c)})}),r}var $u=null;function m2(){if($u===null)try{new FormData(document.createElement("form"),0),$u=!1}catch{$u=!0}return $u}var h2=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Lh(e){return e!=null&&!h2.has(e)?(Vn(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${pd}"`),null):e}function p2(e,t){let r,i,l,c,f;if(o2(e)){let m=e.getAttribute("action");i=m?ka(m,t):null,r=e.getAttribute("method")||hd,l=Lh(e.getAttribute("enctype"))||pd,c=new FormData(e)}else if(l2(e)||c2(e)&&(e.type==="submit"||e.type==="image")){let m=e.form;if(m==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=e.getAttribute("formaction")||m.getAttribute("action");if(i=h?ka(h,t):null,r=e.getAttribute("formmethod")||m.getAttribute("method")||hd,l=Lh(e.getAttribute("formenctype"))||Lh(m.getAttribute("enctype"))||pd,c=new FormData(m,e),!m2()){let{name:p,type:y,value:g}=e;if(y==="image"){let v=p?`${p}.`:"";c.append(`${v}x`,"0"),c.append(`${v}y`,"0")}else p&&c.append(p,g)}}else{if(Zd(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=hd,i=null,l=pd,f=e}return c&&l==="text/plain"&&(f=c,c=void 0),{action:i,method:r.toLowerCase(),encType:l,formData:c,body:f}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Ty(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function y2(e,t,r){let i=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return i.pathname==="/"?i.pathname=`_root.${r}`:t&&ka(i.pathname,t)==="/"?i.pathname=`${t.replace(/\/$/,"")}/_root.${r}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${r}`,i}async function g2(e,t){if(e.id in t)return t[e.id];try{let r=await import(e.module);return t[e.id]=r,r}catch(r){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function b2(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function v2(e,t,r){let i=await Promise.all(e.map(async l=>{let c=t.routes[l.route.id];if(c){let f=await g2(c,r);return f.links?f.links():[]}return[]}));return N2(i.flat(1).filter(b2).filter(l=>l.rel==="stylesheet"||l.rel==="preload").map(l=>l.rel==="stylesheet"?{...l,rel:"prefetch",as:"style"}:{...l,rel:"prefetch"}))}function j0(e,t,r,i,l,c){let f=(h,p)=>r[p]?h.route.id!==r[p].route.id:!0,m=(h,p)=>r[p].pathname!==h.pathname||r[p].route.path?.endsWith("*")&&r[p].params["*"]!==h.params["*"];return c==="assets"?t.filter((h,p)=>f(h,p)||m(h,p)):c==="data"?t.filter((h,p)=>{let y=i.routes[h.route.id];if(!y||!y.hasLoader)return!1;if(f(h,p)||m(h,p))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(l.pathname+l.search+l.hash,window.origin),currentParams:r[0]?.params||{},nextUrl:new URL(e,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function x2(e,t,{includeHydrateFallback:r}={}){return S2(e.map(i=>{let l=t.routes[i.route.id];if(!l)return[];let c=[l.module];return l.clientActionModule&&(c=c.concat(l.clientActionModule)),l.clientLoaderModule&&(c=c.concat(l.clientLoaderModule)),r&&l.hydrateFallbackModule&&(c=c.concat(l.hydrateFallbackModule)),l.imports&&(c=c.concat(l.imports)),c}).flat(1))}function S2(e){return[...new Set(e)]}function w2(e){let t={},r=Object.keys(e).sort();for(let i of r)t[i]=e[i];return t}function N2(e,t){let r=new Set;return new Set(t),e.reduce((i,l)=>{let c=JSON.stringify(w2(l));return r.has(c)||(r.add(c),i.push({key:c,link:l})),i},[])}function o1(){let e=u.useContext(Ii);return Ty(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function E2(){let e=u.useContext(wc);return Ty(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var My=u.createContext(void 0);My.displayName="FrameworkContext";function c1(){let e=u.useContext(My);return Ty(e,"You must render this element inside a <HydratedRouter> element"),e}function j2(e,t){let r=u.useContext(My),[i,l]=u.useState(!1),[c,f]=u.useState(!1),{onFocus:m,onBlur:h,onMouseEnter:p,onMouseLeave:y,onTouchStart:g}=t,v=u.useRef(null);u.useEffect(()=>{if(e==="render"&&f(!0),e==="viewport"){let N=C=>{C.forEach(A=>{f(A.isIntersecting)})},E=new IntersectionObserver(N,{threshold:.5});return v.current&&E.observe(v.current),()=>{E.disconnect()}}},[e]),u.useEffect(()=>{if(i){let N=setTimeout(()=>{f(!0)},100);return()=>{clearTimeout(N)}}},[i]);let S=()=>{l(!0)},w=()=>{l(!1),f(!1)};return r?e!=="intent"?[c,v,{}]:[c,v,{onFocus:Mo(m,S),onBlur:Mo(h,w),onMouseEnter:Mo(p,S),onMouseLeave:Mo(y,w),onTouchStart:Mo(g,S)}]:[!1,v,{}]}function Mo(e,t){return r=>{e&&e(r),r.defaultPrevented||t(r)}}function _2({page:e,...t}){let{router:r}=o1(),i=u.useMemo(()=>Hr(r.routes,e,r.basename),[r.routes,e,r.basename]);return i?u.createElement(A2,{page:e,matches:i,...t}):null}function C2(e){let{manifest:t,routeModules:r}=c1(),[i,l]=u.useState([]);return u.useEffect(()=>{let c=!1;return v2(e,t,r).then(f=>{c||l(f)}),()=>{c=!0}},[e,t,r]),i}function A2({page:e,matches:t,...r}){let i=Ga(),{manifest:l,routeModules:c}=c1(),{basename:f}=o1(),{loaderData:m,matches:h}=E2(),p=u.useMemo(()=>j0(e,t,h,l,i,"data"),[e,t,h,l,i]),y=u.useMemo(()=>j0(e,t,h,l,i,"assets"),[e,t,h,l,i]),g=u.useMemo(()=>{if(e===i.pathname+i.search+i.hash)return[];let w=new Set,N=!1;if(t.forEach(C=>{let A=l.routes[C.route.id];!A||!A.hasLoader||(!p.some(O=>O.route.id===C.route.id)&&C.route.id in m&&c[C.route.id]?.shouldRevalidate||A.hasClientLoader?N=!0:w.add(C.route.id))}),w.size===0)return[];let E=y2(e,f,"data");return N&&w.size>0&&E.searchParams.set("_routes",t.filter(C=>w.has(C.route.id)).map(C=>C.route.id).join(",")),[E.pathname+E.search]},[f,m,i,l,p,t,e,c]),v=u.useMemo(()=>x2(y,l),[y,l]),S=C2(y);return u.createElement(u.Fragment,null,g.map(w=>u.createElement("link",{key:w,rel:"prefetch",as:"fetch",href:w,...r})),v.map(w=>u.createElement("link",{key:w,rel:"modulepreload",href:w,...r})),S.map(({key:w,link:N})=>u.createElement("link",{key:w,nonce:r.nonce,...N})))}function T2(...e){return t=>{e.forEach(r=>{typeof r=="function"?r(t):r!=null&&(r.current=t)})}}var u1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{u1&&(window.__reactRouterVersion="7.9.3")}catch{}function M2(e,t){return mA({basename:t?.basename,getContext:t?.getContext,future:t?.future,history:kC({window:t?.window}),hydrationData:R2(),routes:e,mapRouteProperties:QA,hydrationRouteProperties:JA,dataStrategy:t?.dataStrategy,patchRoutesOnNavigation:t?.patchRoutesOnNavigation,window:t?.window}).initialize()}function R2(){let e=window?.__staticRouterHydrationData;return e&&e.errors&&(e={...e,errors:k2(e.errors)}),e}function k2(e){if(!e)return null;let t=Object.entries(e),r={};for(let[i,l]of t)if(l&&l.__type==="RouteErrorResponse")r[i]=new Ad(l.status,l.statusText,l.data,l.internal===!0);else if(l&&l.__type==="Error"){if(l.__subType){let c=window[l.__subType];if(typeof c=="function")try{let f=new c(l.message);f.stack="",r[i]=f}catch{}}if(r[i]==null){let c=new Error(l.message);c.stack="",r[i]=c}}else r[i]=l;return r}var d1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Jt=u.forwardRef(function({onClick:t,discover:r="render",prefetch:i="none",relative:l,reloadDocument:c,replace:f,state:m,target:h,to:p,preventScrollReset:y,viewTransition:g,...v},S){let{basename:w}=u.useContext(Ss),N=typeof p=="string"&&d1.test(p),E,C=!1;if(typeof p=="string"&&N&&(E=p,u1))try{let P=new URL(window.location.href),G=p.startsWith("//")?new URL(P.protocol+p):new URL(p),H=ka(G.pathname,w);G.origin===P.origin&&H!=null?p=H+G.search+G.hash:C=!0}catch{Vn(!1,`<Link to="${p}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let A=zA(p,{relative:l}),[O,_,k]=j2(i,v),D=O2(p,{replace:f,state:m,target:h,preventScrollReset:y,relative:l,viewTransition:g});function j(P){t&&t(P),P.defaultPrevented||D(P)}let z=u.createElement("a",{...v,...k,href:E||A,onClick:C||c?t:j,ref:T2(S,_),target:h,"data-discover":!N&&r==="render"?"true":void 0});return O&&!N?u.createElement(u.Fragment,null,z,u.createElement(_2,{page:A})):z});Jt.displayName="Link";var D2=u.forwardRef(function({"aria-current":t="page",caseSensitive:r=!1,className:i="",end:l=!1,style:c,to:f,viewTransition:m,children:h,...p},y){let g=Nc(f,{relative:p.relative}),v=Ga(),S=u.useContext(wc),{navigator:w,basename:N}=u.useContext(Ss),E=S!=null&&H2(g)&&m===!0,C=w.encodeLocation?w.encodeLocation(g).pathname:g.pathname,A=v.pathname,O=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;r||(A=A.toLowerCase(),O=O?O.toLowerCase():null,C=C.toLowerCase()),O&&N&&(O=ka(O,N)||O);const _=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let k=A===C||!l&&A.startsWith(C)&&A.charAt(_)==="/",D=O!=null&&(O===C||!l&&O.startsWith(C)&&O.charAt(C.length)==="/"),j={isActive:k,isPending:D,isTransitioning:E},z=k?t:void 0,P;typeof i=="function"?P=i(j):P=[i,k?"active":null,D?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let G=typeof c=="function"?c(j):c;return u.createElement(Jt,{...p,"aria-current":z,className:P,ref:y,style:G,to:f,viewTransition:m},typeof h=="function"?h(j):h)});D2.displayName="NavLink";var I2=u.forwardRef(({discover:e="render",fetcherKey:t,navigate:r,reloadDocument:i,replace:l,state:c,method:f=hd,action:m,onSubmit:h,relative:p,preventScrollReset:y,viewTransition:g,...v},S)=>{let w=B2(),N=U2(m,{relative:p}),E=f.toLowerCase()==="get"?"get":"post",C=typeof m=="string"&&d1.test(m),A=O=>{if(h&&h(O),O.defaultPrevented)return;O.preventDefault();let _=O.nativeEvent.submitter,k=_?.getAttribute("formmethod")||f;w(_||O.currentTarget,{fetcherKey:t,method:k,navigate:r,replace:l,state:c,relative:p,preventScrollReset:y,viewTransition:g})};return u.createElement("form",{ref:S,method:E,action:N,onSubmit:i?h:A,...v,"data-discover":!C&&e==="render"?"true":void 0})});I2.displayName="Form";function L2(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function f1(e){let t=u.useContext(Ii);return rn(t,L2(e)),t}function O2(e,{target:t,replace:r,state:i,preventScrollReset:l,relative:c,viewTransition:f}={}){let m=$n(),h=Ga(),p=Nc(e,{relative:c});return u.useCallback(y=>{if(d2(y,t)){y.preventDefault();let g=r!==void 0?r:Kr(h)===Kr(p);m(e,{replace:g,state:i,preventScrollReset:l,relative:c,viewTransition:f})}},[h,m,p,r,i,t,e,l,c,f])}function z2(e){Vn(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=u.useRef(Fp(e)),r=u.useRef(!1),i=Ga(),l=u.useMemo(()=>f2(i.search,r.current?null:t.current),[i.search]),c=$n(),f=u.useCallback((m,h)=>{const p=Fp(typeof m=="function"?m(new URLSearchParams(l)):m);r.current=!0,c("?"+p,h)},[c,l]);return[l,f]}var $2=0,F2=()=>`__${String(++$2)}__`;function B2(){let{router:e}=f1("useSubmit"),{basename:t}=u.useContext(Ss),r=XA();return u.useCallback(async(i,l={})=>{let{action:c,method:f,encType:m,formData:h,body:p}=p2(i,t);if(l.navigate===!1){let y=l.fetcherKey||F2();await e.fetch(y,r,l.action||c,{preventScrollReset:l.preventScrollReset,formData:h,body:p,formMethod:l.method||f,formEncType:l.encType||m,flushSync:l.flushSync})}else await e.navigate(l.action||c,{preventScrollReset:l.preventScrollReset,formData:h,body:p,formMethod:l.method||f,formEncType:l.encType||m,replace:l.replace,state:l.state,fromRouteId:r,flushSync:l.flushSync,viewTransition:l.viewTransition})},[e,t,r])}function U2(e,{relative:t}={}){let{basename:r}=u.useContext(Ss),i=u.useContext(ls);rn(i,"useFormAction must be used inside a RouteContext");let[l]=i.matches.slice(-1),c={...Nc(e||".",{relative:t})},f=Ga();if(e==null){c.search=f.search;let m=new URLSearchParams(c.search),h=m.getAll("index");if(h.some(y=>y==="")){m.delete("index"),h.filter(g=>g).forEach(g=>m.append("index",g));let y=m.toString();c.search=y?`?${y}`:""}}return(!e||e===".")&&l.route.index&&(c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(c.pathname=c.pathname==="/"?r:Ds([r,c.pathname])),Kr(c)}function m1(e,t){let{capture:r}=t||{};u.useEffect(()=>{let i=r!=null?{capture:r}:void 0;return window.addEventListener("beforeunload",e,i),()=>{window.removeEventListener("beforeunload",e,i)}},[e,r])}function q2({when:e,message:t}){let r=i1(e);u.useEffect(()=>{r.state==="blocked"&&(window.confirm(t)?setTimeout(r.proceed,0):r.reset())},[r,t]),u.useEffect(()=>{r.state==="blocked"&&!e&&r.reset()},[r,e])}function H2(e,{relative:t}={}){let r=u.useContext(jy);rn(r!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=f1("useViewTransitionState"),l=Nc(e,{relative:t});if(!r.isTransitioning)return!1;let c=ka(r.currentLocation.pathname,i)||r.currentLocation.pathname,f=ka(r.nextLocation.pathname,i)||r.nextLocation.pathname;return Cd(l.pathname,f)!=null||Cd(l.pathname,c)!=null}var Ec=Fw();const h1=Di(Ec);function P2(e){return u.createElement(t2,{flushSync:Ec.flushSync,...e})}/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V2=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Y2=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,i)=>i?i.toUpperCase():r.toLowerCase()),_0=e=>{const t=Y2(e);return t.charAt(0).toUpperCase()+t.slice(1)},p1=(...e)=>e.filter((t,r,i)=>!!t&&t.trim()!==""&&i.indexOf(t)===r).join(" ").trim(),G2=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var X2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K2=u.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:i,className:l="",children:c,iconNode:f,...m},h)=>u.createElement("svg",{ref:h,...X2,width:t,height:t,stroke:e,strokeWidth:i?Number(r)*24/Number(t):r,className:p1("lucide",l),...!c&&!G2(m)&&{"aria-hidden":"true"},...m},[...f.map(([p,y])=>u.createElement(p,y)),...Array.isArray(c)?c:[c]]));/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=(e,t)=>{const r=u.forwardRef(({className:i,...l},c)=>u.createElement(K2,{ref:c,iconNode:t,className:p1(`lucide-${V2(_0(e))}`,`lucide-${e}`,i),...l}));return r.displayName=_0(e),r};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W2=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],C0=Ot("arrow-down",W2);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z2=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Ry=Ot("arrow-left",Z2);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q2=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],y1=Ot("arrow-right",Q2);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J2=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],A0=Ot("arrow-up",J2);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eT=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}]],ky=Ot("bell-ring",eT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tT=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Md=Ot("bell",tT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nT=[["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M14 7a4 4 0 0 1 4 4v3a6 6 0 0 1-12 0v-3a4 4 0 0 1 4-4z",key:"uouzyp"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M21 21a4 4 0 0 0-3.81-4",key:"1b0z45"}],["path",{d:"M21 5a4 4 0 0 1-3.55 3.97",key:"5cxbf6"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M3 21a4 4 0 0 1 3.81-4",key:"1fjd4g"}],["path",{d:"M3 5a4 4 0 0 0 3.55 3.97",key:"1d7oge"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M9 7.13V6a3 3 0 1 1 6 0v1.13",key:"1vgav8"}]],Dy=Ot("bug",nT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aT=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],T0=Ot("calendar-days",aT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sT=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],rT=Ot("check-check",sT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iT=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],g1=Ot("check",iT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lT=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Vr=Ot("chevron-down",lT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oT=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Iy=Ot("chevron-right",oT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Ha=Ot("circle-alert",cT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Qd=Ot("circle-check",uT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dT=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],fT=Ot("circle-play",dT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mT=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ly=Ot("clock",mT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hT=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],M0=Ot("cloud-upload",hT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pT=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],yT=Ot("crown",pT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gT=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],R0=Ot("database",gT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bT=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],vT=Ot("download",bT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xT=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],b1=Ot("eye",xT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ST=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],wT=Ot("file-check",ST);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NT=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Bp=Ot("file-text",NT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ET=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Jd=Ot("funnel",ET);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jT=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],_T=Ot("grip-vertical",jT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CT=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],v1=Ot("history",CT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AT=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],TT=Ot("image",AT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Oy=Ot("info",MT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RT=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],x1=Ot("layers",RT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kT=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],k0=Ot("link-2",kT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DT=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],S1=Ot("list-checks",DT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IT=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],D0=Ot("list",IT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LT=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],wn=Ot("loader-circle",LT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OT=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],zT=Ot("log-out",OT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $T=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],FT=Ot("lock",$T);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BT=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],UT=Ot("maximize-2",BT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qT=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],HT=Ot("menu",qT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PT=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],VT=Ot("message-square",PT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YT=[["path",{d:"M5 12h14",key:"1ays0h"}]],w1=Ot("minus",YT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GT=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],XT=Ot("moon",GT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KT=[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]],Up=Ot("notebook-pen",KT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WT=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ZT=Ot("pen-line",WT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QT=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],N1=Ot("pen",QT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JT=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],lr=Ot("pencil",JT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eM=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],tM=Ot("pin",eM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nM=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Va=Ot("plus",nM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aM=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Il=Ot("rotate-ccw",aM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sM=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],I0=Ot("save",sM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rM=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],ic=Ot("search",rM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iM=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],lM=Ot("send",iM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oM=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],E1=Ot("settings",oM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cM=[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]],uM=Ot("shapes",cM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dM=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],j1=Ot("shield-check",dM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fM=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M9 12h6",key:"1c52cq"}],["path",{d:"M12 9v6",key:"199k2o"}]],mM=Ot("shield-plus",fM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hM=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],pM=Ot("sliders-horizontal",hM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yM=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Li=Ot("sparkles",yM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gM=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],bM=Ot("sun",gM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vM=[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5",key:"hbey2j"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18",key:"1hf58s"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20",key:"pidxm4"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21",key:"1pehsh"}]],xM=Ot("swords",vM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],zy=Ot("target",SM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wM=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ua=Ot("trash-2",wM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NM=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ma=Ot("triangle-alert",NM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EM=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],jM=Ot("upload",EM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _M=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],_1=Ot("users",_M);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CM=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],AM=Ot("user",CM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TM=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],MM=Ot("workflow",TM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RM=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Da=Ot("x",RM),_n="http://ttrdb.eu-west-2.elasticbeanstalk.com/api".replace(/\/$/,"")||"http://localhost:3000/api",kM=Object.freeze(Object.defineProperty({__proto__:null,API_BASE:_n},Symbol.toStringTag,{value:"Module"})),C1=u.createContext(null);function DM({children:e}){const[t,r]=u.useState(null),[i,l]=u.useState(null),[c,f]=u.useState(!1);u.useEffect(()=>{try{const p=localStorage.getItem("gamedb_session");if(p){const y=JSON.parse(p);y?.user&&y?.token?(r(y.user),l(y.token)):(console.warn(" Incomplete session found, clearing..."),localStorage.removeItem("gamedb_session"))}}catch(p){console.warn(" Invalid stored session, clearing...",p),localStorage.removeItem("gamedb_session")}finally{f(!0)}},[]),u.useEffect(()=>{c&&(i&&t?localStorage.setItem("gamedb_session",JSON.stringify({user:t,token:i})):localStorage.removeItem("gamedb_session"))},[i,t,c]);const m=async(p,y)=>{try{const v=await(await fetch(`${_n}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:p,password:y})})).json();if(console.log(" Raw login response:",v),!v.success||!v.token)throw new Error(v.message||"Invalid credentials");return r(v.user),l(v.token),localStorage.setItem("gamedb_session",JSON.stringify({user:v.user,token:v.token})),console.log(" Login successful:",v.user),!0}catch(g){return console.error(" Login error:",g.message),alert(`Login failed: ${g.message}`),!1}},h=()=>{r(null),l(null),localStorage.removeItem("gamedb_session")};return c?a.jsx(C1.Provider,{value:{user:t,token:i,sessionReady:c,login:m,logout:h},children:e}):a.jsx("div",{className:"loading-screen",children:"Loading session..."})}function Nn(){return u.useContext(C1)}function ei(){try{return JSON.parse(localStorage.getItem("gamedb_session"))?.token||null}catch{return null}}async function IM(e=5,t=200){for(let r=0;r<e;r++){const i=ei();if(i)return i;await new Promise(l=>setTimeout(l,t))}return null}async function fr(){const e=await IM();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function mr(e,t="request"){if(e.status===401)throw console.warn(` Unauthorized during ${t}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${e.status} ${r}`)}return e.json()}async function jc(e={}){const t=await fr(),r=new URLSearchParams;Object.entries(e).forEach(([f,m])=>{m!=null&&m!==""&&r.set(f,m)});const i=r.toString(),l=i?`${_n}/campaigns?${i}`:`${_n}/campaigns`,c=await fetch(l,{headers:t});return mr(c,"fetch campaigns")}async function LM(e){const t=await fr(),r=await fetch(`${_n}/campaigns`,{method:"POST",headers:t,body:JSON.stringify(e)});return mr(r,"create campaign")}async function OM(e,t){const r=await fr(),i=await fetch(`${_n}/campaigns/${e}`,{method:"PUT",headers:r,body:JSON.stringify(t)});return mr(i,"update campaign")}async function zM(e){const t=await fr(),r=await fetch(`${_n}/campaigns/${e}`,{method:"DELETE",headers:t});return mr(r,"delete campaign")}async function $M(e,t={}){if(!e)throw new Error("campaignId is required to fetch notes");const r=await fr(),i=new URLSearchParams;Object.entries(t).forEach(([m,h])=>{if(!(h==null||h==="")){if(Array.isArray(h)){h.map(p=>p==null?"":String(p)).filter(p=>p.trim()!=="").forEach(p=>{i.append(`${m}[]`,p)});return}i.set(m,h)}});const l=i.toString(),c=`${_n}/campaigns/${e}/entity-notes${l?`?${l}`:""}`,f=await fetch(c,{headers:r});return mr(f,"fetch campaign entity notes")}async function FM(e){if(!e)throw new Error("campaignId is required to fetch session notes");const t=await fr(),r=`${_n}/campaigns/${e}/session-notes`,i=await fetch(r,{headers:t});return mr(i,"fetch campaign session notes")}async function BM(e,t={}){if(!e)throw new Error("campaignId is required to create a session note");const r=await fr(),i=await fetch(`${_n}/campaigns/${e}/session-notes`,{method:"POST",headers:r,body:JSON.stringify(t)});return mr(i,"create session note")}async function UM(e,t,r={}){if(!e)throw new Error("campaignId is required to update a session note");if(!t)throw new Error("noteId is required to update a session note");const i=await fr(),l=await fetch(`${_n}/campaigns/${e}/session-notes/${t}`,{method:"PUT",headers:i,body:JSON.stringify(r)});return mr(l,"update session note")}async function qM(e,t){if(!e)throw new Error("campaignId is required to delete a session note");if(!t)throw new Error("noteId is required to delete a session note");const r=await fr(),i=await fetch(`${_n}/campaigns/${e}/session-notes/${t}`,{method:"DELETE",headers:r});return mr(i,"delete session note")}async function HM(e=5,t=200){for(let r=0;r<e;r++){const i=ei();if(i)return i;await new Promise(l=>setTimeout(l,t))}return null}async function ef(){const e=await HM();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function tf(e,t="request"){if(e.status===401)throw console.warn(` Unauthorized during ${t}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${e.status} ${r}`)}return e.json()}async function Ll(){const e=await ef(),t=await fetch(`${_n}/worlds`,{headers:e});return tf(t,"fetch worlds")}async function PM(e){const t=await ef(),r=await fetch(`${_n}/worlds`,{method:"POST",headers:t,body:JSON.stringify(e)});return tf(r,"create world")}async function VM(e,t){const r=await ef(),i=await fetch(`${_n}/worlds/${e}`,{method:"PUT",headers:r,body:JSON.stringify(t)});return tf(i,"update world")}async function YM(e){const t=await ef(),r=await fetch(`${_n}/worlds/${e}`,{method:"DELETE",headers:t});return tf(r,"delete world")}const A1=u.createContext(null),yd="gamedb_campaign_context",GM=new Set(["dm","player"]),Ro=(e,t)=>{if(typeof window>"u")return;const r=e?String(e):"",i=r?"":t?String(t):"";try{r?localStorage.setItem(yd,JSON.stringify({type:"campaign",id:r})):i?localStorage.setItem(yd,JSON.stringify({type:"world",id:i})):localStorage.removeItem(yd)}catch(l){console.warn(" Unable to persist campaign context",l)}},XM=e=>{if(!e||typeof e!="string")return{type:"",id:""};try{const t=JSON.parse(e);if(t&&typeof t=="object"){const r=t.type==="world"?"world":"campaign",i=t.id?String(t.id):"";if(i)return{type:r,id:i}}}catch{if(e.trim())return{type:"campaign",id:e.trim()}}return e.trim()?{type:"campaign",id:e.trim()}:{type:"",id:""}},KM=(e,t)=>Array.isArray(e)?t?t.role==="system_admin"?e:e.filter(r=>Array.isArray(r?.members)&&r.members.some(i=>i?.user_id===t.id&&GM.has(i?.role))):[]:[];function WM({children:e}){const{user:t,sessionReady:r}=Nn(),[i,l]=u.useState([]),[c,f]=u.useState(!1),[m,h]=u.useState(""),[p,y]=u.useState(""),[g,v]=u.useState([]),[S,w]=u.useState(!1),[N,E]=u.useState(""),[C,A]=u.useState(""),[O,_]=u.useState(""),[k,D]=u.useState(!1);u.useEffect(()=>{if(r)try{const M=localStorage.getItem(yd);if(!M){y(""),A("");return}const{type:U,id:T}=XM(M);U==="world"?(A(T),y("")):U==="campaign"?(y(T),A("")):(y(""),A(""))}catch(M){console.warn(" Unable to restore campaign context",M),y(""),A("")}finally{D(!0)}},[r]),u.useEffect(()=>{!r||!k||Ro(p,C)},[p,C,r,k]);const j=u.useCallback(async()=>{if(!r||!t)return l([]),h(""),[];f(!0),h("");try{const M=await jc(),U=Array.isArray(M?.data)?M.data:Array.isArray(M)?M:[],T=KM(U,t);return l(T),y(q=>q&&T.some(Q=>String(Q.id)===String(q))?q:""),T}catch(M){return console.error(" Failed to load campaigns",M),h(M.message||"Failed to load campaigns"),l([]),[]}finally{f(!1)}},[r,t]),z=u.useCallback(async()=>{if(!r||!t)return v([]),E(""),[];w(!0),E("");try{const M=await Ll(),U=Array.isArray(M?.data)?M.data:Array.isArray(M)?M:[];return v(U),A(T=>T&&U.some(Y=>String(Y.id)===String(T))?T:""),U}catch(M){return console.error(" Failed to load worlds",M),E(M.message||"Failed to load worlds"),v([]),[]}finally{w(!1)}},[r,t]);u.useEffect(()=>{if(!(!r||!k)){if(!t){l([]),y(""),h(""),f(!1),v([]),A(""),E(""),w(!1);return}j(),z()}},[r,k,t,j,z]);const P=u.useCallback(M=>{const U=M==null?"":String(M);y(U),U?(A(""),_(""),Ro(U,"")):Ro("","")},[]),G=u.useCallback(M=>{const U=M==null?"":String(M);A(U),U?(y(""),_(""),Ro("",U)):Ro("","")},[]);u.useEffect(()=>{_("")},[p]);const H=u.useCallback(M=>{const U=M==null?"":String(M);_(U)},[]),X=u.useMemo(()=>p&&i.find(M=>String(M.id)===String(p))||null,[i,p]),V=u.useMemo(()=>C&&g.find(M=>String(M.id)===String(C))||null,[g,C]),R=u.useMemo(()=>p?"campaign":C?"world":"",[p,C]),B=u.useMemo(()=>R==="world"&&V?V:X?.world?X.world:V,[R,V,X]),I=u.useMemo(()=>B?.id?String(B.id):"",[B]),L=u.useMemo(()=>`${R||"none"}:${p||C||""||"none"}:${I||"none"}:${O||"none"}`,[p,C,R,I,O]),$=u.useMemo(()=>({campaigns:i,selectedCampaign:X,selectedCampaignId:p,setSelectedCampaignId:P,worlds:g,worldLoading:S,worldError:N,selectedWorld:V,selectedWorldId:C,setSelectedWorldId:G,viewAsCharacterId:O,setViewAsCharacterId:H,selectedContextType:R,activeWorld:B,activeWorldId:I,contextKey:L,loading:c,error:m,refreshCampaigns:j,refreshWorlds:z}),[i,X,p,P,g,S,N,V,C,G,O,H,R,B,I,L,c,m,j,z]);return a.jsx(A1.Provider,{value:$,children:e})}function Bn(){const e=u.useContext(A1);if(!e)throw new Error("useCampaignContext must be used within a CampaignProvider");return e}const T1=u.createContext(null),ZM=()=>{if(typeof window>"u")return"light";const e=window.localStorage.getItem("theme");return e==="light"||e==="dark"?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"};function QM({children:e}){const[t,r]=u.useState(ZM);u.useEffect(()=>{typeof document>"u"||(document.body.classList.remove("theme-light","theme-dark"),document.body.classList.add(t==="dark"?"theme-dark":"theme-light"),document.documentElement.setAttribute("data-theme",t),window.localStorage.setItem("theme",t))},[t]),u.useEffect(()=>{if(typeof window>"u")return;const l=window.matchMedia("(prefers-color-scheme: dark)"),c=f=>{r(f.matches?"dark":"light")};if(!window.localStorage.getItem("theme"))return l.addEventListener("change",c),()=>l.removeEventListener("change",c)},[]);const i=u.useMemo(()=>({theme:t,setTheme:r,toggleTheme:()=>r(l=>l==="dark"?"light":"dark")}),[t]);return a.jsx(T1.Provider,{value:i,children:e})}function JM(){const e=u.useContext(T1);if(!e)throw new Error("useTheme must be used within a ThemeProvider");return e}const eR=768;function $y(e=eR){const[t,r]=u.useState(()=>typeof window>"u"?!1:window.matchMedia(`(max-width: ${e}px)`).matches);return u.useEffect(()=>{if(typeof window>"u")return;const i=window.matchMedia(`(max-width: ${e}px)`),l=c=>{r(c.matches)};return r(i.matches),typeof i.addEventListener=="function"?(i.addEventListener("change",l),()=>i.removeEventListener("change",l)):(i.addListener(l),()=>i.removeListener(l))},[e]),t}async function tR(e=5,t=200){for(let r=0;r<e;r++){const i=ei();if(i)return i;await new Promise(l=>setTimeout(l,t))}return null}async function nf(){const e=await tR();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function af(e,t="request"){if(e.status===401)throw console.warn(` Unauthorized during ${t}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${e.status} ${r}`)}return e.json()}async function Ls(e={}){const t=await nf(),r=new URLSearchParams;Object.entries(e).forEach(([f,m])=>{m!=null&&m!==""&&r.set(f,m)});const i=r.toString(),l=i?`${_n}/characters?${i}`:`${_n}/characters`,c=await fetch(l,{headers:t});return af(c,"fetch characters")}async function nR(e){const t=await nf(),r=await fetch(`${_n}/characters`,{method:"POST",headers:t,body:JSON.stringify(e)});return af(r,"create character")}async function aR(e,t){const r=await nf(),i=await fetch(`${_n}/characters/${e}`,{method:"PUT",headers:r,body:JSON.stringify(t)});return af(i,"update character")}async function sR(e){const t=await nf(),r=await fetch(`${_n}/characters/${e}`,{method:"DELETE",headers:t});return af(r,"delete character")}const L0="drawer-panel-open",rR=300,Oh={sm:"360px",md:"420px",lg:"560px"},iR=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])",'[tabindex]:not([tabindex="-1"])'],lR=()=>{const e=document.createElement("div");return e.className="drawer-portal-container",e},oR=(e,t)=>e?typeof e=="number"?`${e}px`:String(e):t&&Oh[t]?Oh[t]:Oh.md;function Wr({isOpen:e,onClose:t,title:r,description:i,children:l,footer:c,footerActions:f,width:m,size:h="md",labelledBy:p,closeLabel:y="Close panel",className:g="",mobileFull:v=!0}){const S=u.useRef(null),w=u.useRef(null),N=u.useRef(null),E=u.useRef(null),[C,A]=u.useState(e),[O,_]=u.useState(!1),k=u.useMemo(()=>p||`drawer-${Math.random().toString(36).slice(2)}`,[p]),D=i?`${k}-description`:void 0,j=oR(m,h);if(u.useEffect(()=>(S.current||(S.current=lR(),document.body.appendChild(S.current)),()=>{S.current&&S.current.parentNode&&S.current.parentNode.removeChild(S.current),S.current=null}),[]),u.useEffect(()=>e?(E.current&&(clearTimeout(E.current),E.current=null),A(!0),_(!1),()=>{}):C?(_(!0),E.current=setTimeout(()=>{A(!1),_(!1),E.current=null},rR),()=>{E.current&&(clearTimeout(E.current),E.current=null)}):()=>{},[e,C]),u.useEffect(()=>{if(!e)return;N.current=document.activeElement instanceof HTMLElement?document.activeElement:null,document.body.classList.add(L0);const H=()=>w.current?Array.from(w.current.querySelectorAll(iR.join(","))).filter(I=>I instanceof HTMLElement&&I.offsetParent!==null):[],X=()=>{const L=H()[0];L?L.focus({preventScroll:!0}):w.current&&w.current.focus({preventScroll:!0})},V=I=>{if(I.key==="Escape"){I.preventDefault(),t?.();return}if(I.key!=="Tab")return;const L=H();if(L.length===0){I.preventDefault(),w.current?.focus({preventScroll:!0});return}const $=L[0],M=L[L.length-1],U=document.activeElement;if(I.shiftKey){(U===$||!w.current?.contains(U))&&(I.preventDefault(),M.focus({preventScroll:!0}));return}U===M&&(I.preventDefault(),$.focus({preventScroll:!0}))},R=I=>{w.current?.contains(I.target)||X()},B=setTimeout(()=>{if(!w.current)return;const I=w.current.querySelector("[data-autofocus]");if(I instanceof HTMLElement){I.focus({preventScroll:!0});return}X()},20);return document.addEventListener("keydown",V),document.addEventListener("focusin",R),()=>{clearTimeout(B),document.removeEventListener("keydown",V),document.removeEventListener("focusin",R),document.body.classList.remove(L0),N.current instanceof HTMLElement&&N.current.focus({preventScroll:!0})}},[e,t]),!C||!S.current)return null;const z=["drawer-panel-wrapper",e?"drawer-panel-wrapper--open":"",O?"drawer-panel-wrapper--closing":""].filter(Boolean).join(" "),P=["drawer-panel",h?`drawer-panel--${h}`:"",v?"drawer-panel--mobile-full":"",g].filter(Boolean).join(" "),G=f??c;return Ec.createPortal(a.jsxs("div",{className:z,role:"presentation",children:[a.jsx("div",{className:"drawer-panel-overlay",onClick:t,role:"presentation"}),a.jsxs("aside",{ref:w,className:P,role:"dialog","aria-modal":"true","aria-labelledby":k,"aria-describedby":D,tabIndex:-1,style:{"--drawer-panel-width":j},children:[a.jsxs("div",{className:"drawer-panel-header",children:[a.jsxs("div",{className:"drawer-panel-heading",children:[a.jsx("h2",{id:k,children:r}),i?a.jsx("p",{id:D,className:"drawer-panel-description",children:i}):null]}),a.jsx("button",{type:"button",className:"icon-btn",onClick:t,"aria-label":y,children:""})]}),a.jsx("div",{className:"drawer-panel-body",children:l}),G?a.jsx("div",{className:"drawer-panel-footer",children:G}):null]})]}),S.current)}const sf="app_history",M1=100,qp="history:updated",R1=()=>typeof window<"u"?window:null,rf=()=>!!R1()?.localStorage,k1=e=>{const t=R1();if(t)try{t.dispatchEvent(new CustomEvent(qp,{detail:Array.isArray(e)?e:[]}))}catch(r){console.warn(" Failed to broadcast history change",r)}},Hp=e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t},Fy=e=>{if(!e||e.id===void 0||e.id===null||!e.type)return null;const t=Hp(e.viewedAt)||new Date,r=e.worldId??e.world_id??e.worldID??e.world?.id??e.world?.world_id??null,i=e.worldName??e.world_name??e.world?.name??null;return{id:String(e.id),type:String(e.type),title:e.title?String(e.title):"Untitled record",viewedAt:t.toISOString(),...r?{worldId:String(r)}:{},...i?{worldName:String(i)}:{}}},cR=e=>e.slice().sort((t,r)=>{const i=Hp(t?.viewedAt),l=Hp(r?.viewedAt),c=i?i.getTime():0;return(l?l.getTime():0)-c}),Pp=()=>{if(!rf())return[];try{const e=window.localStorage.getItem(sf);if(!e)return[];const t=JSON.parse(e);if(!Array.isArray(t))return[];const r=t.map(Fy).filter(Boolean);return cR(r)}catch(e){return console.warn(" Failed to parse stored history",e),[]}},uR=e=>{if(!rf())return[];if(!Array.isArray(e))return[];const t=e.map(Fy).filter(Boolean).slice(0,M1);return window.localStorage.setItem(sf,JSON.stringify(t)),k1(t),t},dR=e=>{if(!rf())return[];const t=Fy(e);if(!t)return Pp();const r=Pp().filter(l=>!(l.id===t.id&&l.type===t.type)),i=[t,...r].slice(0,M1);return uR(i),i},fR=()=>{rf()&&(window.localStorage.removeItem(sf),k1([]))},zh=()=>typeof window>"u"?[]:Pp();function D1(e=null){const[t,r]=u.useState(()=>zh()),i=u.useCallback(()=>{const m=zh();return r(m),m},[]),l=u.useCallback(m=>{if(!m)return zh();const h=dR(m);return r(h),h},[]),c=u.useCallback(()=>{fR(),r([])},[]);u.useEffect(()=>{i()},[i]);const f=u.useMemo(()=>{if(!e)return null;const{id:m,type:h,title:p,viewedAt:y}=e;if(m==null||!h)return null;const g={id:m,type:h,title:p,viewedAt:y},v=e.worldId??e.world_id??e.world?.id??e.world?.world_id??null,S=e.worldName??e.world_name??e.world?.name??null;return v!=null&&(g.worldId=v),S&&(g.worldName=S),g},[e]);return u.useEffect(()=>{f&&l(f)},[f,l]),u.useEffect(()=>{if(typeof window>"u")return;const m=p=>{p.key&&p.key!==sf||i()},h=()=>{i()};return window.addEventListener("storage",m),window.addEventListener(qp,h),()=>{window.removeEventListener("storage",m),window.removeEventListener(qp,h)}},[i]),{history:t,addEntry:l,refreshHistory:i,clearHistory:c}}const I1=3600*1e3,mR=24*I1,hR=e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t},Vp=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),pR=(e,t)=>{if(!e)return"older";const r=t.getTime()-e.getTime();if(r<I1)return"lastHour";if(Vp(e,t))return"today";const i=new Date(t);return i.setDate(t.getDate()-1),Vp(e,i)?"yesterday":r<7*mR?"lastSevenDays":"older"},yR=[{key:"lastHour",label:"Last hour"},{key:"today",label:"Today"},{key:"yesterday",label:"Yesterday"},{key:"lastSevenDays",label:"Last seven days"},{key:"older",label:"Older"}],gR=(e,t)=>{if(!e)return"";if(Vp(e,t)){const l=String(e.getHours()).padStart(2,"0"),c=String(e.getMinutes()).padStart(2,"0");return`${l}.${c}`}const r=String(e.getDate()).padStart(2,"0"),i=e.toLocaleString(void 0,{month:"short"});return`${r} ${i}`},bR=e=>{if(!e)return"record";const t=String(e);return t.includes(":")?t.split(":").pop().replace(/[-_]+/g," "):t.replace(/_/g," ")},vR=e=>!e?.type||!e?.id?null:String(e.type).toLowerCase().startsWith("entity")?`/entities/${e.id}`:null;function xR({isOpen:e,onClose:t}){const{history:r,clearHistory:i}=D1(),{campaigns:l,worlds:c,loading:f,worldLoading:m,selectedContextType:h,activeWorldId:p}=Bn(),y=new Date,g=u.useMemo(()=>!f&&!m,[f,m]),v=u.useMemo(()=>{const A=new Set,O=_=>{if(!_&&_!==0)return;const k=String(_);k&&A.add(k)};return Array.isArray(c)&&c.forEach(_=>{O(_?.id??_?.world_id)}),Array.isArray(l)&&l.forEach(_=>{O(_?.world?.id??_?.world_id)}),A},[l,c]),S=u.useMemo(()=>!h||!p?"":String(p),[h,p]),w=u.useMemo(()=>!Array.isArray(r)||r.length===0?[]:!g||!v.size?r:r.filter(A=>{if(!A)return!1;if(!String(A.type||"").toLowerCase().startsWith("entity"))return!0;const _=A.worldId??A.world_id??A.world?.id??A.world?.world_id??null;return S&&(!_||String(_)!==S)?!1:_?v.has(String(_)):!0}),[r,v,g,S]),N=g&&Array.isArray(r)&&r.length>0&&w.length<r.length,E=u.useMemo(()=>{if(!Array.isArray(w)||w.length===0)return[];const A=new Date,O=yR.map(k=>({...k,items:[]})),_=new Map(O.map(k=>[k.key,k]));return w.forEach(k=>{const D=hR(k?.viewedAt),j=pR(D,A),z=_.get(j);z&&z.items.push({...k,parsedDate:D})}),O.filter(k=>k.items.length>0)},[w]),C=()=>{i()};return a.jsx(Wr,{isOpen:e,onClose:t,title:"History",description:"Recently viewed records",size:"sm",children:a.jsxs("div",{className:"history-tab",children:[a.jsxs("div",{className:"history-tab-header",children:[a.jsxs("div",{className:"history-tab-title",children:[a.jsx(Ly,{size:18}),a.jsx("span",{children:"Recently viewed"})]}),a.jsxs("button",{type:"button",className:"history-clear-btn",onClick:C,disabled:!r.length,children:[a.jsx(ua,{size:14}),"Clear"]})]}),!w.length&&a.jsx("p",{className:"history-empty",children:N?"You do not currently have access to any records in your recent history.":"No records viewed yet. Start exploring to build a history."}),E.map(A=>a.jsxs("section",{className:"history-group",children:[a.jsx("h3",{className:"history-group-title",children:A.label}),a.jsx("ul",{className:"history-entry-list",children:A.items.map(O=>{const _=vR(O),k=a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"history-entry-title",children:O.title||"Untitled record"}),a.jsxs("div",{className:"history-entry-meta",children:[a.jsx("span",{className:"history-entry-type",children:bR(O.type)}),a.jsx("time",{className:"history-entry-time",children:gR(O.parsedDate,y)})]})]});return a.jsx("li",{children:_?a.jsx(Jt,{to:_,className:"history-entry history-entry-link",onClick:t,children:k}):a.jsx("div",{className:"history-entry",children:k})},`${O.type}-${O.id}`)})})]},A.key))]})})}const SR="gamedb_campaign_context",wR="X-Campaign-Context-Id",NR=e=>{if(!e||typeof e!="string")return null;try{const r=JSON.parse(e);if(r&&typeof r=="object"){const i=r.type==="world"?"world":"campaign",l=r.id?String(r.id):"";return l?{type:i,id:l}:null}}catch{const r=e.trim();if(r)return{type:"campaign",id:r}}const t=e.trim();return t?{type:"campaign",id:t}:null};async function ko(e,t,r,i={}){const{headers:l,includeCampaignContext:c=!0,...f}=i||{},m=typeof FormData<"u"&&r instanceof FormData,h={...m?{}:{"Content-Type":"application/json"},...l},p=ei();if(p&&(h.Authorization=`Bearer ${p}`),c)try{const N=localStorage.getItem(SR);if(N){const E=NR(N);E?.type==="campaign"&&E.id&&(h[wR]=E.id)}}catch(N){console.warn(" Unable to include campaign context header",N)}const y=(()=>{if(r!==void 0)return m?r:JSON.stringify(r)})(),g=await fetch(`${_n}${t}`,{method:e,headers:h,body:y,...f}),S=(g.headers.get("content-type")||"").includes("application/json"),w=S?await g.json():await g.text();if(!g.ok){g.status===401&&(localStorage.removeItem("gamedb_session"),setTimeout(()=>{window.location.pathname!=="/login"&&(window.location.href="/login")},150));const N=S&&w?.message||(typeof w=="string"?w:"Request failed"),E=new Error(N);throw E.status=g.status,E}return w}const Mt={get:(e,t)=>ko("GET",e,void 0,t),post:(e,t,r)=>ko("POST",e,t,r),put:(e,t,r)=>ko("PUT",e,t,r),patch:(e,t,r)=>ko("PATCH",e,t,r),delete:(e,t)=>ko("DELETE",e,void 0,t)},L1=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([l,c])=>{c!=null&&c!==""&&t.set(l,c)});const r=t.toString(),i=r?`/notifications?${r}`:"/notifications";return Mt.get(i)},ER=e=>Mt.patch(`/notifications/${e}/read`),jR=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([l,c])=>{c!=null&&c!==""&&t.set(l,c)});const r=t.toString(),i=r?`/notifications/read-all?${r}`:"/notifications/read-all";return Mt.patch(i)},_R=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([l,c])=>{c!=null&&c!==""&&t.set(l,c)});const r=t.toString(),i=r?`/notifications/unread-count?${r}`:"/notifications/unread-count";return Mt.get(i)},O1=u.createContext(null),$h=3e4,CR=12e4;function AR({children:e}){const{user:t,sessionReady:r}=Nn(),[i,l]=u.useState([]),[c,f]=u.useState(0),[m,h]=u.useState(!1),[p,y]=u.useState(""),g=u.useRef(null),v=u.useRef(null),S=u.useRef(!0);u.useEffect(()=>{const _=()=>{S.current=!document.hidden,!document.hidden&&v.current&&Date.now()-v.current>$h&&(w(),N())};return document.addEventListener("visibilitychange",_),()=>{document.removeEventListener("visibilitychange",_)}},[]);const w=u.useCallback(async()=>{if(!t?.id||!r){l([]),h(!1);return}h(!0),y("");try{const _=await L1({limit:50}),k=Array.isArray(_?.data)?_.data:[];l(k),v.current=Date.now()}catch(_){console.error(" Failed to load notifications",_),y(_.message||"Failed to load notifications")}finally{h(!1)}},[t?.id,r]),N=u.useCallback(async()=>{if(!t?.id||!r){f(0);return}try{const k=(await _R())?.count??0;f(k)}catch(_){console.error(" Failed to load unread count",_)}},[t?.id,r]),E=u.useCallback(()=>{w(),N()},[w,N]),C=u.useCallback(async _=>{if(_)try{await ER(_),l(k=>k.map(D=>D.id===_?{...D,read:!0,readAt:new Date().toISOString()}:D)),f(k=>Math.max(0,k-1))}catch(k){throw console.error(" Failed to mark notification read",k),k}},[]),A=u.useCallback(async(_={})=>{try{await jR(_),l(k=>k.map(D=>({...D,read:!0,readAt:new Date().toISOString()}))),f(0)}catch(k){throw console.error(" Failed to mark all notifications read",k),k}},[]);u.useEffect(()=>{if(!t?.id||!r){g.current&&(clearInterval(g.current),g.current=null),l([]),f(0);return}w(),N();const _=()=>{g.current&&clearInterval(g.current);const D=S.current?$h:CR;g.current=setInterval(()=>{S.current?(N(),(!v.current||Date.now()-v.current>$h*2)&&w()):N()},D)};_();const k=()=>{S.current=!document.hidden,_()};return document.addEventListener("visibilitychange",k),()=>{g.current&&(clearInterval(g.current),g.current=null),document.removeEventListener("visibilitychange",k)}},[t?.id,r,w,N]);const O=u.useMemo(()=>({notifications:i,unreadCount:c,loading:m,error:p,refresh:E,markRead:C,markAllRead:A}),[i,c,m,p,E,C,A]);return a.jsx(O1.Provider,{value:O,children:e})}function TR(){const e=u.useContext(O1);if(!e)throw new Error("useNotifications must be used within NotificationProvider");return e}function z1(){return TR()}function $1({open:e,campaignName:t,onSwitch:r,onCancel:i}){return e?a.jsx("div",{className:"unsaved-dialog-backdrop",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"unsaved-dialog",role:"document",children:[a.jsxs("div",{className:"unsaved-dialog-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"unsaved-dialog-label",children:"Campaign context"}),a.jsx("h2",{children:"Switch campaign context?"})]}),a.jsx("button",{type:"button",className:"icon-btn","aria-label":"Close dialog",onClick:i,children:a.jsx(Da,{size:18})})]}),a.jsxs("div",{className:"unsaved-dialog-body",children:[a.jsxs("p",{children:["This notification is for the campaign ",a.jsx("strong",{children:t||"another campaign"}),". You're currently viewing a different campaign context."]}),a.jsx("p",{className:"unsaved-dialog-help",children:"Would you like to switch to the correct campaign context to view this notification?"})]}),a.jsxs("div",{className:"unsaved-dialog-actions",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:r,children:"Switch campaign context"}),a.jsx("button",{type:"button",className:"btn cancel",onClick:i,children:"Cancel"})]})]})}):null}const MR=e=>{if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const i=new Date-t,l=Math.floor(i/6e4),c=Math.floor(i/36e5),f=Math.floor(i/864e5);return l<1?"Just now":l<60?`${l}m ago`:c<24?`${c}h ago`:f<7?`${f}d ago`:t.toLocaleDateString(void 0,{month:"short",day:"numeric"})},RR=e=>{const{type:t,metadata:r={}}=e;switch(t){case"entity_comment":return`${r.author_name||"Someone"} commented on ${r.entity_name||"an entity"}`;case"entity_mention_entity_note":return`${r.author_name||"Someone"} mentioned ${r.related_entity_name||"an entity"} in a note`;case"entity_mention_session_note":return`${r.author_name||"Someone"} mentioned ${r.related_entity_name||"an entity"} in a session note`;case"session_note_added":return`${r.author_name||"Someone"} created a session note${r.campaign_name?` for ${r.campaign_name}`:""}`;case"session_note_updated":return`${r.author_name||"Someone"} updated a session note${r.campaign_name?` for ${r.campaign_name}`:""}`;case"request_note_added":return`${r.author_name||"Someone"} added a note to "${r.request_title||"a feature/bug"}"`;case"request_status_changed":return`Status changed for "${r.request_title||"a feature/bug"}"`;case"request_assigned":return`You were assigned to "${r.request_title||"a feature/bug"}"`;default:return"New notification"}};function kR(){const{notifications:e,unreadCount:t,loading:r,markRead:i}=z1(),{selectedCampaignId:l,setSelectedCampaignId:c}=Bn(),f=$n(),[m,h]=u.useState(!1),p=u.useRef(null),[y,g]=u.useState({open:!1,notification:null});u.useEffect(()=>{const A=O=>{p.current&&!p.current.contains(O.target)&&h(!1)};if(m)return document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)}},[m]);const v=e.filter(A=>!A.read).slice(0,5),S=A=>{if(h(!1),A.actionUrl)f(A.actionUrl);else{const{type:O,metadata:_={}}=A;if(O==="entity_comment"||O==="entity_mention_entity_note"){const k=_.entity_id||_.related_entity_id,D=A.campaignId||A.campaign?.id||l;k&&f(`/entities/${k}${D?`?campaignId=${D}`:""}#notes`)}else if(O==="session_note_added"||O==="session_note_updated"||O==="entity_mention_session_note"){const k=A.campaignId||A.campaign?.id||_.target_id||l;f(`/notes/session${k?`?campaignId=${k}`:""}`)}else if(O==="request_note_added"||O==="request_status_changed"||O==="request_assigned"){const k=_.request_id||_.requestId;f(k?`/requests/${k}`:"/requests")}else f("/notifications")}},w=async A=>{if(!A.read)try{await i(A.id)}catch(k){console.error("Failed to mark notification read",k)}const O=A.campaignId||A.campaign?.id||"";if(O&&O!==(l||"")){g({open:!0,notification:A});return}S(A)},N=()=>{const{notification:A}=y;if(!A)return;const O=A.campaignId||A.campaign?.id||"";O&&c(O),g({open:!1,notification:null}),setTimeout(()=>{S(A)},100)},E=()=>{g({open:!1,notification:null})},C=v.length>0;return a.jsxs("div",{className:"notification-widget",ref:p,children:[a.jsxs("button",{type:"button",className:"notification-widget-button",onClick:()=>h(!m),title:"Notifications",children:[t>0?a.jsx(ky,{size:20}):a.jsx(Md,{size:20}),t>0&&a.jsx("span",{className:"notification-widget-badge",children:t>99?"99+":t})]}),m&&a.jsxs("div",{className:"notification-widget-dropdown",children:[a.jsxs("div",{className:"notification-widget-header",children:[a.jsx("h3",{children:"Notifications"}),t>0&&a.jsxs("span",{className:"notification-widget-count",children:[t," unread"]})]}),r?a.jsx("div",{className:"notification-widget-loading",children:"Loading..."}):C?a.jsx("div",{className:"notification-widget-list",children:v.map(A=>a.jsxs("div",{className:`notification-widget-item ${A.read?"read":"unread"}`,onClick:()=>w(A),children:[a.jsxs("div",{className:"notification-widget-item-content",children:[a.jsx("p",{className:"notification-widget-item-message",children:RR(A)}),a.jsx("span",{className:"notification-widget-item-time",children:MR(A.createdAt)})]}),!A.read&&a.jsx("div",{className:"notification-widget-item-dot"})]},A.id))}):a.jsx("div",{className:"notification-widget-empty",children:"No new notifications"}),a.jsx("div",{className:"notification-widget-footer",children:a.jsxs(Jt,{to:"/notifications",className:"notification-widget-view-all",onClick:()=>h(!1),children:["View all notifications ",a.jsx(Iy,{size:14})]})})]}),a.jsx($1,{open:y.open,campaignName:y.notification?.campaign?.name||"",onSwitch:N,onCancel:E})]})}const DR=(e={})=>{const t=new URLSearchParams,r=e.viewAsCharacterId??e.characterId??e.character_id??e.viewAs;if(r!=null){const i=String(r).trim();i&&t.set("viewAsCharacterId",i)}return t.toString()},lc=(e,t={})=>{if(!e)return Promise.reject(new Error("worldId is required to load entities"));const r=new URLSearchParams,i=DR(t);i&&r.set("viewAsCharacterId",new URLSearchParams(i).get("viewAsCharacterId")),t.importance!==void 0&&t.importance!==null&&(Array.isArray(t.importance)?t.importance:[t.importance]).forEach(m=>{m!=null&&r.append("importance[]",m)});const l=r.toString(),c=l?`?${l}`:"";return Mt.get(`/worlds/${e}/entities${c}`)},IR=()=>Mt.get("/entities/unassigned"),cr=e=>Mt.get(`/entities/${e}`),lf=({worldId:e,query:t,typeIds:r=[],limit:i=20,offset:l=0})=>{if(!e)return Promise.reject(new Error("worldId is required"));const c=new URLSearchParams;c.set("worldId",e),t&&c.set("q",t),(Array.isArray(r)?r:[r]).map(h=>h==null?"":String(h).trim()).filter(Boolean).forEach(h=>{c.append("typeIds[]",h)}),i!=null&&c.set("limit",i),l!=null&&c.set("offset",l);const m=c.toString();return Mt.get(`/entities/search${m?`?${m}`:""}`)},LR=({query:e,campaignId:t,worldId:r,limit:i=20,offset:l=0})=>{const c=new URLSearchParams;e&&c.set("q",e),t&&c.set("campaignId",t),r&&c.set("worldId",r),i!=null&&c.set("limit",i),l!=null&&c.set("offset",l);const f=c.toString();return Mt.get(`/entities/global-search${f?`?${f}`:""}`)},By=e=>Mt.post("/entities",e),Uy=(e,t)=>Mt.patch(`/entities/${e}`,t),OR=(e,t)=>Mt.patch(`/entities/${e}/importance`,{importance:t}),zR=e=>Mt.delete(`/entities/${e}`),F1=(e,t)=>{if(!e)return Promise.reject(new Error("entityId is required"));if(!t)return Promise.reject(new Error("file is required"));const r=new FormData;return r.append("file",t),Mt.post(`/entities/${e}/image`,r)},B1=e=>e?Mt.delete(`/entities/${e}/image`):Promise.reject(new Error("entityId is required")),$R=(e,t)=>Mt.post(`/entities/${e}/secrets`,t),FR=(e,t,r)=>Mt.patch(`/entities/${e}/secrets/${t}`,r),BR=(e,t={})=>{const r=new URLSearchParams,i=t.campaignId??t.campaign_id;i&&r.set("campaignId",i);const l=r.toString();return Mt.get(`/entities/${e}/notes${l?`?${l}`:""}`)},UR=(e,t={})=>{const r=new URLSearchParams,i=t.campaignId??t.campaign_id;i&&r.set("campaignId",i);const l=r.toString();return Mt.get(`/entities/${e}/mentions/entity-notes${l?`?${l}`:""}`)},qR=(e,t={})=>{const r=new URLSearchParams,i=t.campaignId??t.campaign_id;i&&r.set("campaignId",i);const l=r.toString();return Mt.get(`/entities/${e}/mentions/session-notes${l?`?${l}`:""}`)},HR=(e,t)=>Mt.post(`/entities/${e}/notes`,t),U1=(e,t,r)=>Mt.patch(`/entities/${e}/notes/${t}`,r),q1=(e,t,r={})=>{const i=new URLSearchParams,l=r.campaignId??r.campaign_id;l&&i.set("campaignId",l);const c=i.toString();return Mt.delete(`/entities/${e}/notes/${t}${c?`?${c}`:""}`)},PR=async(e,t=1)=>{const r=new URLSearchParams;if(t!=null){const c=Number(t);!Number.isNaN(c)&&c>0&&r.set("depth",String(c))}const i=r.toString(),l=await Mt.get(`/entities/${e}/graph${i?`?${i}`:""}`,{credentials:"include"});if(!l?.success)throw new Error(l?.message||"Failed to load graph");return l.data},VR=300,YR=(e,t)=>{const[r,i]=u.useState(e);return u.useEffect(()=>{const l=setTimeout(()=>i(e),t);return()=>clearTimeout(l)},[e,t]),r},Fu=e=>({name:"Name",description:"Description",notes:"Notes",mentions:"Mentions",relationships:"Relationships",title:"Title",content:"Content"})[e]||e;function O0({isMobile:e,onClose:t}){const r=$n(),{selectedCampaignId:i,activeWorldId:l}=Bn(),[c,f]=u.useState(""),m=!!(i||l),[h,p]=u.useState({entities:[],sessionNotes:[]}),[y,g]=u.useState(!1),[v,S]=u.useState(""),[w,N]=u.useState(-1),[E,C]=u.useState(!1),A=YR(c,VR),O=u.useRef(null),_=u.useRef(null),k=u.useRef(0),D=u.useMemo(()=>{const B=[];return h.entities.forEach(I=>{B.push({type:"entity",data:I})}),h.sessionNotes.forEach(I=>{B.push({type:"sessionNote",data:I})}),B},[h]),j=D.length>0,z=E&&(c.trim().length>0||j),P=u.useCallback(async B=>{if(!B.trim()){p({entities:[],sessionNotes:[]}),g(!1);return}if(!m){S("Please select a campaign or world context to search"),p({entities:[],sessionNotes:[]}),g(!1);return}const I=++k.current;g(!0),S("");try{const L=await LR({query:B,campaignId:i,worldId:l,limit:20,offset:0});if(I!==k.current)return;const $=L?.data||{entities:[],sessionNotes:[]};p({entities:Array.isArray($.entities)?$.entities:[],sessionNotes:Array.isArray($.sessionNotes)?$.sessionNotes:[]})}catch(L){if(I!==k.current)return;S(L.message||"Failed to search"),p({entities:[],sessionNotes:[]})}finally{I===k.current&&g(!1)}},[l,i,m]);u.useEffect(()=>{A.trim().length>0?P(A):(p({entities:[],sessionNotes:[]}),g(!1))},[A,P]),u.useEffect(()=>{E&&_.current&&!e&&_.current.focus()},[E,e]),u.useEffect(()=>{const B=I=>{O.current&&!O.current.contains(I.target)&&(e||C(!1))};if(E)return document.addEventListener("mousedown",B),()=>document.removeEventListener("mousedown",B)},[E,e]),u.useEffect(()=>{const B=I=>{if(z)if(I.key==="ArrowDown")I.preventDefault(),N(L=>L<D.length-1?L+1:L);else if(I.key==="ArrowUp")I.preventDefault(),N(L=>L>0?L-1:-1);else if(I.key==="Enter"&&w>=0){I.preventDefault();const L=D[w];L&&X(L)}else I.key==="Escape"&&(I.preventDefault(),C(!1),f(""),e&&t&&t())};if(z)return document.addEventListener("keydown",B),()=>document.removeEventListener("keydown",B)},[z,w,D,e,t]);const G=B=>{f(B.target.value),N(-1),E||C(!0)},H=()=>{C(!0)},X=B=>{B.type==="entity"?r(`/entities/${B.data.id}`):B.type==="sessionNote"&&r(`/campaigns/${i}/session-notes`),C(!1),f(""),e&&t&&t()},V=()=>{f(""),p({entities:[],sessionNotes:[]}),N(-1),e&&t&&t()},R=B=>{if(!B)return"";try{return new Date(B).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return B}};return e?a.jsxs("div",{className:"global-search-mobile",children:[a.jsx("div",{className:"global-search-mobile-overlay",onClick:t}),a.jsxs("div",{className:"global-search-mobile-content",children:[a.jsxs("div",{className:`global-search-input-wrapper ${m?"":"disabled"}`,children:[a.jsx(ic,{size:20,className:"global-search-icon"}),a.jsx("input",{ref:_,type:"text",className:"global-search-input",placeholder:m?"Search entities and session notes...":"Select a campaign or world to search",value:c,onChange:G,onFocus:H,disabled:!m,autoFocus:!0}),c&&a.jsx("button",{type:"button",className:"global-search-clear",onClick:V,"aria-label":"Clear search",children:a.jsx(Da,{size:16})})]}),z&&a.jsxs("div",{className:"global-search-results",children:[y&&a.jsx("div",{className:"global-search-loading",children:a.jsx("span",{children:"Searching..."})}),!y&&v&&a.jsx("div",{className:"global-search-error",children:a.jsx("span",{children:v})}),!y&&!v&&!j&&c.trim().length>0&&a.jsx("div",{className:"global-search-empty",children:a.jsx("span",{children:"No results found"})}),!y&&!v&&j&&a.jsx("div",{className:"global-search-results-list",children:D.map((B,I)=>a.jsx("button",{type:"button",className:`global-search-result-item ${I===w?"selected":""}`,onClick:()=>X(B),children:B.type==="entity"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"global-search-result-header",children:[a.jsx("span",{className:"global-search-result-name",children:B.data.name}),B.data.typeName&&a.jsx("span",{className:"global-search-result-type",children:B.data.typeName})]}),a.jsx("div",{className:"global-search-result-meta",children:a.jsxs("span",{className:"global-search-match-type",children:["Matched in ",Fu(B.data.matchType)]})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"global-search-result-header",children:[a.jsx("span",{className:"global-search-result-name",children:B.data.session_title||"Session Note"}),a.jsx("span",{className:"global-search-result-type",children:"Session Note"})]}),a.jsx("div",{className:"global-search-result-meta",children:a.jsxs("span",{className:"global-search-match-type",children:[R(B.data.session_date),"  Matched in"," ",Fu(B.data.matchType)]})})]})},`${B.type}-${B.data.id}`))})]})]})]}):a.jsxs("div",{className:"global-search",ref:O,children:[a.jsxs("div",{className:`global-search-input-wrapper ${m?"":"disabled"}`,children:[a.jsx(ic,{size:18,className:"global-search-icon"}),a.jsx("input",{ref:_,type:"text",className:"global-search-input",placeholder:m?"Search entities and session notes...":"Select a campaign or world to search",value:c,onChange:G,onFocus:H,disabled:!m}),c&&a.jsx("button",{type:"button",className:"global-search-clear",onClick:V,"aria-label":"Clear search",children:a.jsx(Da,{size:16})})]}),z&&a.jsxs("div",{className:"global-search-dropdown",children:[y&&a.jsx("div",{className:"global-search-loading",children:a.jsx("span",{children:"Searching..."})}),!y&&v&&a.jsx("div",{className:"global-search-error",children:a.jsx("span",{children:v})}),!y&&!v&&!j&&c.trim().length>0&&a.jsx("div",{className:"global-search-empty",children:a.jsx("span",{children:"No results found"})}),!y&&!v&&j&&a.jsx("div",{className:"global-search-results-list",children:D.map((B,I)=>a.jsx("button",{type:"button",className:`global-search-result-item ${I===w?"selected":""}`,onClick:()=>X(B),children:B.type==="entity"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"global-search-result-header",children:[a.jsx("span",{className:"global-search-result-name",children:B.data.name}),B.data.typeName&&a.jsx("span",{className:"global-search-result-type",children:B.data.typeName})]}),a.jsx("div",{className:"global-search-result-meta",children:a.jsxs("span",{className:"global-search-match-type",children:["Matched in ",Fu(B.data.matchType)]})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"global-search-result-header",children:[a.jsx("span",{className:"global-search-result-name",children:B.data.session_title||"Session Note"}),a.jsx("span",{className:"global-search-result-type",children:"Session Note"})]}),a.jsx("div",{className:"global-search-result-meta",children:a.jsxs("span",{className:"global-search-match-type",children:[R(B.data.session_date),"  Matched in"," ",Fu(B.data.matchType)]})})]})},`${B.type}-${B.data.id}`))})]})]})}function GR({onMenuToggle:e}){const[t,r]=u.useState(!1),i=u.useRef(null),{user:l,logout:c}=Nn(),{theme:f,toggleTheme:m}=JM(),{campaigns:h,selectedCampaignId:p,setSelectedCampaignId:y,selectedCampaign:g,loading:v,error:S,worlds:w,selectedWorld:N,selectedWorldId:E,setSelectedWorldId:C,worldLoading:A,worldError:O,viewAsCharacterId:_,setViewAsCharacterId:k}=Bn();u.useEffect(()=>{const ze=nt=>{i.current&&!i.current.contains(nt.target)&&r(!1)};return document.addEventListener("mousedown",ze),()=>document.removeEventListener("mousedown",ze)},[]);const D=ze=>{y(ze.target.value)},j=ze=>{C(ze.target.value)},z=$y(),[P,G]=u.useState([]),[H,X]=u.useState(!1),[V,R]=u.useState(""),[B,I]=u.useState(!1),[L,$]=u.useState(!1),[M,U]=u.useState(!1),T=u.useMemo(()=>!g||!l?"":g.members?.find(nt=>nt?.user_id===l.id)?.role||"",[g,l]),q=u.useMemo(()=>{if(!g?.world)return"";const ze=g.world;return ze.created_by||ze.creator?.id||ze.owner_id||ze.owner?.id||""},[g]),Y=u.useMemo(()=>!p||!l?!1:l.role==="system_admin"||T==="dm"?!0:q?String(q)===String(l.id):!1,[T,p,q,l]);u.useEffect(()=>{Y||k("")},[Y,k]),u.useEffect(()=>{let ze=!1;if(!Y||!p){G([]),X(!1),R("");return}return(async()=>{X(!0),R("");try{const $e=await Ls({scope:"others",campaign_id:p}),vt=Array.isArray($e?.data)?$e.data:Array.isArray($e)?$e:[];if(ze)return;const _t=vt.map(Tt=>{if(!Tt?.id)return null;const Ct=Tt.name||"Unnamed character",Be=Tt.player?.username||Tt.player?.email||Tt.player?.name||"";return{id:String(Tt.id),label:Be?`${Ct} (${Be})`:Ct}}).filter(Boolean).sort((Tt,Ct)=>Tt.label.localeCompare(Ct.label,void 0,{sensitivity:"base"}));G(_t)}catch($e){ze||(console.error(" Failed to load characters for view-as context",$e),G([]),R($e.message||"Unable to load characters"),k(""))}finally{ze||X(!1)}})(),()=>{ze=!0}},[Y,p,k]);const Q=u.useMemo(()=>{if(H)return"Loading characters";if(V)return V;if(!_)return"Viewing entities as yourself (DM/owner)";const ze=P.find(nt=>nt.id===_);return ze?`Viewing as ${ze.label}`:"Viewing as selected character"},[_,P,V,H]),oe=u.useMemo(()=>v?"Loading campaigns":S?"Unable to load campaigns":h.length?g?`${g.name}${g.world?.name?`  ${g.world.name}`:""}`:"Select a campaign":"No eligible campaigns",[h,S,v,g]),Z=u.useMemo(()=>g?.world?g.world.name?`Campaign world  ${g.world.name}`:"Campaign world selected":A?"Loading worlds":O?"Unable to load worlds":w.length?N?N.name?`World  ${N.name}`:"Selected world":"Select a world":"No accessible worlds",[g,N,A,O,w.length]),de=u.useMemo(()=>{const ze=new Set,nt=[];if(w.forEach($e=>{if(!$e?.id)return;const vt=String($e.id);ze.has(vt)||(nt.push({id:vt,name:$e.name||`World #${vt}`}),ze.add(vt))}),g?.world?.id){const $e=String(g.world.id);ze.has($e)||nt.unshift({id:$e,name:g.world.name||"Campaign world"})}return nt},[w,g]);u.useEffect(()=>{z||I(!1)},[z]);const J=ze=>{if(!l)return"";const nt=ze?.members?.find($e=>$e.user_id===l.id);return nt?nt.role==="dm"?"DM":nt.role==="player"?"Player":nt.role||"":l.role==="system_admin"?"System Admin":""},se=()=>I(!1),ne=a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"campaign-selector",title:oe,children:[a.jsx("label",{htmlFor:"campaign-context-select",children:"Campaign"}),a.jsxs("select",{id:"campaign-context-select",value:p,onChange:D,disabled:v||!h.length&&!p,children:[a.jsx("option",{value:"",children:v?"Loading campaigns":S?"Unable to load campaigns":h.length?"Select a campaign":"No campaigns available"}),h.map(ze=>{const nt=J(ze),$e=[nt?`as ${nt}`:null,ze.world?.name?`World: ${ze.world.name}`:null].filter(Boolean).join("  "),vt=$e?`${ze.name} (${$e})`:ze.name;return a.jsx("option",{value:ze.id,children:vt},ze.id)})]})]}),a.jsxs("div",{className:"campaign-selector",title:Z,children:[a.jsx("label",{htmlFor:"world-context-select",children:"World"}),a.jsxs("select",{id:"world-context-select",value:E,onChange:j,disabled:A,children:[a.jsx("option",{value:"",children:g?.world?g.world.name?`Using ${g.world.name}`:"Using campaign world":A?"Loading worlds":O?"Unable to load worlds":w.length?"Select a world":"No worlds available"}),de.map(ze=>a.jsx("option",{value:ze.id,children:ze.name},ze.id))]})]}),Y&&a.jsxs("div",{className:"campaign-selector",title:Q,children:[a.jsx("label",{htmlFor:"character-context-select",children:"View as"}),a.jsxs("select",{id:"character-context-select",value:_,onChange:ze=>k(ze.target.value),disabled:H||!!V,children:[a.jsx("option",{value:"",children:H?"Loading characters":V||"Entire campaign context"}),P.map(ze=>a.jsx("option",{value:ze.id,children:ze.label},ze.id))]})]})]}),we=a.jsx("button",{type:"button",className:`menu-btn ${z?"menu-btn-icon":"menu-btn-text"}`,onClick:e,"aria-label":z?"Toggle navigation menu":void 0,children:z?a.jsx(HT,{size:20}):"Menu"}),Le=a.jsx("button",{type:"button",className:`history-btn ${z?"history-btn-icon":"history-btn-text"}`,title:"View recently viewed records","aria-label":z?"Open history":void 0,onClick:()=>$(!0),children:z?a.jsx(Ly,{size:20}):"History"}),Me=a.jsx("button",{type:"button",className:`context-btn ${z?"context-btn-icon":"context-btn-text"}`,onClick:()=>I(!0),"aria-label":z?"Change context":void 0,title:z?"Change context":void 0,disabled:!z,children:z?a.jsx(x1,{size:20}):"Context"}),Ae=!!(p||E),ot=a.jsx("button",{type:"button",className:`search-btn ${z?"search-btn-icon":"search-btn-text"} ${Ae?"":"disabled"}`,onClick:()=>Ae&&U(!0),"aria-label":z?"Open search":void 0,title:z?Ae?"Open search":"Select a campaign or world to search":void 0,disabled:!Ae,children:z?a.jsx(ic,{size:20}):"Search"});return a.jsxs("header",{className:"app-header",children:[a.jsx("div",{className:"header-start",children:z?a.jsxs(a.Fragment,{children:[a.jsx("h1",{className:"title",children:a.jsx(Jt,{to:"/",className:"title-link",children:"GameDB"})}),we,Me,ot,Le]}):a.jsxs(a.Fragment,{children:[a.jsx("h1",{className:"title",children:a.jsx(Jt,{to:"/",className:"title-link",children:"GameDB"})}),we,Le]})}),!z&&a.jsxs("div",{className:"header-center",children:[ne,(p||E)&&a.jsx(O0,{isMobile:!1})]}),a.jsx("div",{className:"header-end",children:a.jsx(kR,{})}),a.jsxs("div",{className:"user-menu",ref:i,children:[a.jsx("button",{className:"user-icon",onClick:()=>r(!t),title:"User Menu",children:a.jsx(AM,{size:20})}),t&&a.jsxs("div",{className:"user-dropdown",children:[a.jsxs("div",{className:"user-info",children:[a.jsx("strong",{children:l?.username||"User"}),a.jsx("br",{}),a.jsx("small",{children:l?.role||""})]}),a.jsxs("button",{className:"dropdown-action",onClick:m,children:[f==="dark"?a.jsx(bM,{size:16}):a.jsx(XT,{size:16}),f==="dark"?"Light mode":"Dark mode"]}),a.jsxs(Jt,{to:"/security",className:"dropdown-action",onClick:()=>r(!1),children:[a.jsx(FT,{size:16}),"Security"]}),a.jsxs("button",{className:"dropdown-action logout",onClick:c,children:[a.jsx(zT,{size:16}),"Logout"]})]})]}),z&&B&&a.jsxs("div",{className:"mobile-context-overlay",role:"dialog","aria-modal":"true",children:[a.jsx("button",{className:"mobile-context-overlay-close",onClick:se,"aria-label":"Close context picker"}),a.jsxs("div",{className:"mobile-context-panel",children:[a.jsxs("div",{className:"mobile-context-header",children:[a.jsx("h2",{children:"Choose context"}),a.jsx("button",{type:"button",onClick:se,"aria-label":"Close context picker",children:a.jsx(Da,{size:20})})]}),a.jsx("div",{className:"mobile-context-body",children:ne})]})]}),a.jsx(xR,{isOpen:L,onClose:()=>$(!1)}),z&&M&&a.jsx(O0,{isMobile:!0,onClose:()=>U(!1)})]})}const XR=e=>e==null?"":String(e).trim(),ti=e=>{let t={};typeof e=="string"?t={worldId:e}:e&&typeof e=="object"&&!Array.isArray(e)&&(t={...e});const r=new URLSearchParams,i=XR(t.worldId??t.world_id);if(!i)return Promise.reject(new Error("worldId is required to list entity types"));r.set("worldId",i);const l=r.toString(),c=l?`?${l}`:"";return Mt.get(`/entity-types${c}`)},KR=e=>Mt.post("/entity-types",e),WR=e=>Mt.get(`/entity-types/${e}`),ZR=(e,t)=>Mt.patch(`/entity-types/${e}`,t),QR=e=>Mt.delete(`/entity-types/${e}`),of=(e,t="perform this action")=>e==null||e===""?Promise.reject(new Error(`Entity type id is required to ${t}`)):null,cf=e=>{const t=of(e,"load entity type field order");return t||Mt.get(`/entity-types/${e}/field-order`)},JR=(e,t)=>{const r=of(e,"update entity type field order");return r||Mt.put(`/entity-types/${e}/field-order`,t)},uf=e=>{const t=of(e,"load entity type field rules");return t||Mt.get(`/entity-types/${e}/field-rules`)},ek=(e,t)=>{const r=of(e,"create entity type field rule");return r||Mt.post(`/entity-types/${e}/field-rules`,t)},H1=(e,t="perform this action")=>e==null||e===""?Promise.reject(new Error(`Field rule id is required to ${t}`)):null,Fh=(e,t)=>{const r=H1(e,"update this field rule");return r||Mt.patch(`/entity-type-field-rules/${e}`,t)},tk=e=>{const t=H1(e,"delete this field rule");return t||Mt.delete(`/entity-type-field-rules/${e}`)},P1=(e,t={})=>{if(!e)return Promise.reject(new Error("worldId is required to load entity type usage"));const r=new URLSearchParams,i=t.viewAsCharacterId??t.characterId??t.character_id??t.viewAs;if(i!=null){const f=String(i).trim();f&&r.set("viewAsCharacterId",f)}const l=r.toString(),c=l?`?${l}`:"";return Mt.get(`/worlds/${e}/entity-types${c}`)},nk=e=>Mt.get(`/entity-types/${e}/list-columns`),ak=(e,t)=>Mt.patch(`/entity-types/${e}/list-columns`,t);function sk({open:e,pinned:t,allowPinning:r=!0,onPinToggle:i,onClose:l}){const c=Ga(),{user:f}=Nn(),{selectedCampaign:m,selectedCampaignId:h,activeWorld:p,activeWorldId:y,viewAsCharacterId:g,contextKey:v}=Bn(),[S,w]=u.useState(!1),[N,E]=u.useState(!1),[C,A]=u.useState(!1),[O,_]=u.useState(!1),[k,D]=u.useState(!1),[j,z]=u.useState([]),[P,G]=u.useState(!1),[H,X]=u.useState("");u.useEffect(()=>{z([]),X("")},[v]);const R=u.useMemo(()=>new URLSearchParams(c.search),[c.search]).get("entityType")??"",B=c.pathname==="/entities"||c.pathname.startsWith("/entities/"),I=y||"",L=f?.role==="system_admin",$=!!y,M=u.useMemo(()=>!m||!f?"":m.members?.find(Ae=>Ae?.user_id===f.id)?.role??"",[m,f]),U=u.useMemo(()=>{if(!p||!f?.id)return!1;const Me=p.created_by??p.creator?.id??p.owner_id??p.owner?.id??"";return Me?String(Me)===String(f.id):!1},[p,f?.id]),T=!!($&&(L||M==="dm"||U)),q=!!($&&(L||U)),Y=!!($&&(L||U)),Q=!!($&&(L||U)),oe=!!($&&U),Z=u.useMemo(()=>!m||!Array.isArray(m.members)||!f?.id?!1:m.members.some(Me=>Me?.user_id===f.id&&Me?.role==="player"),[m,f]),de=u.useMemo(()=>!m||!Array.isArray(m.members)||!f?.id?!1:m.members.some(Me=>Me?.user_id===f.id&&Me?.role==="dm"),[m,f]),J=!!($&&(T||q||Y||Q||oe)),se=u.useMemo(()=>h?L?!0:de||Z:!1,[L,de,Z,h]);u.useEffect(()=>{let Me=!1;if(!I){z([]),X(""),G(!1);return}return(async()=>{G(!0),X("");try{const ot=await P1(I,{viewAsCharacterId:g}),ze=Array.isArray(ot?.data)?ot.data:Array.isArray(ot)?ot:[];Me||z(ze)}catch(ot){Me||(console.error(" Failed to load entity types for world",ot),z([]),X("Unable to load entity types"))}finally{Me||G(!1)}})(),()=>{Me=!0}},[I,v,g]);const ne=u.useCallback(Me=>Me==="/"?c.pathname==="/":c.pathname===Me||c.pathname.startsWith(`${Me}/`),[c.pathname]),we=u.useCallback(Me=>{$||(Me.preventDefault(),alert("Please select a campaign or world context before viewing entities."))},[$]),Le=u.useCallback(Me=>{if(t||Me.defaultPrevented)return;const Ae=Me.target,ot=Ae instanceof Element?Ae:Ae?.parentElement;if(!ot||typeof ot.closest!="function")return;const ze=ot.closest("a");ze&&Me.currentTarget.contains(ze)&&l()},[t,l]);return a.jsxs("aside",{className:`sidebar ${e?"open":"closed"}`,children:[a.jsxs("div",{className:"sidebar-header",children:[a.jsx("span",{children:"Navigation"}),r&&a.jsx("button",{type:"button",className:`pin-btn ${t?"pinned":""}`,title:t?"Unpin menu":"Pin menu","aria-pressed":t,onClick:i,children:a.jsx(tM,{size:16,className:"pin-icon"})})]}),a.jsxs("nav",{className:"nav-links",onClick:t?void 0:Le,children:[a.jsx(Jt,{to:"/",className:ne("/")?"active":"",children:"Home"}),a.jsx(Jt,{to:"/worlds",className:ne("/worlds")?"active":"",children:"Worlds"}),J&&a.jsxs("div",{className:`nav-group ${C?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>A(Me=>!Me),"aria-expanded":!C,"aria-controls":"world-admin-nav",children:[a.jsx("span",{className:"nav-heading",children:"World Admin"}),a.jsx(Vr,{size:14,className:`nav-heading-icon ${C?"collapsed":""}`})]}),a.jsxs("div",{id:"world-admin-nav",className:"nav-sub-links",children:[T&&a.jsxs(Jt,{to:"/entities",className:`nav-entity-link ${B&&!R?"active":""}`,onClick:we,children:[a.jsx(R0,{size:16,className:"nav-icon"}),a.jsx("span",{children:"All Entities"})]}),T&&a.jsxs(Jt,{to:"/entity-relationships",className:`nav-entity-link ${ne("/entity-relationships")?"active":""}`,children:[a.jsx(k0,{size:16,className:"nav-icon"}),a.jsx("span",{children:"All Relationships"})]}),q&&a.jsxs(Jt,{to:"/entity-types",className:`nav-entity-link ${ne("/entity-types")?"active":""}`,children:[a.jsx(uM,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Entity Types"})]}),Y&&a.jsxs(Jt,{to:"/entities/bulk-upload",className:`nav-entity-link ${ne("/entities/bulk-upload")?"active":""}`,children:[a.jsx(R0,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Bulk Entity Upload"})]}),Q&&a.jsxs(Jt,{to:"/relationship-types",className:`nav-entity-link ${ne("/relationship-types")?"active":""}`,children:[a.jsx(k0,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Relationship Types"})]}),oe&&I&&a.jsxs(Jt,{to:`/worlds/${I}/access/bulk`,className:`nav-entity-link ${ne(`/worlds/${I}/access/bulk`)?"active":""}`,children:[a.jsx(j1,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Bulk Access Editor"})]}),oe&&I&&a.jsxs(Jt,{to:`/worlds/${I}/collections`,className:`nav-entity-link ${ne(`/worlds/${I}/collections`)?"active":""}`,children:[a.jsx(x1,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Collections"})]}),oe&&I&&a.jsxs(Jt,{to:`/worlds/${I}/access/audit`,className:`nav-entity-link ${ne(`/worlds/${I}/access/audit`)?"active":""}`,children:[a.jsx(v1,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Access Audit Log"})]}),U&&!$&&a.jsx("span",{className:"nav-helper",children:"Select a world you own to use the bulk access tools"})]})]}),a.jsxs("div",{className:`nav-group ${S?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>w(Me=>!Me),"aria-expanded":!S,"aria-controls":"campaigns-nav",children:[a.jsx("span",{className:"nav-heading",children:"Campaigns"}),a.jsx(Vr,{size:14,className:`nav-heading-icon ${S?"collapsed":""}`})]}),a.jsxs("div",{id:"campaigns-nav",className:"nav-sub-links",children:[a.jsx(Jt,{to:"/campaigns/my",className:ne("/campaigns/my")?"active":"",children:"My Campaigns"}),a.jsx(Jt,{to:"/campaigns/all",className:ne("/campaigns/all")?"active":"",children:"All"})]})]}),a.jsxs("div",{className:`nav-group ${O?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>_(Me=>!Me),"aria-expanded":!O,"aria-controls":"entities-nav",children:[a.jsx("span",{className:"nav-heading",children:"Entities"}),a.jsx(Vr,{size:14,className:`nav-heading-icon ${O?"collapsed":""}`})]}),a.jsxs("div",{id:"entities-nav",className:"nav-sub-links",children:[P&&a.jsx("span",{className:"nav-helper",children:"Loading entity types"}),!P&&H&&a.jsx("span",{className:"nav-helper error",children:H}),!P&&!H&&j.length===0&&a.jsx("span",{className:"nav-helper",children:$?"No entities in this world yet":"Select a campaign or world context to see entity types"}),j.map(Me=>a.jsxs(Jt,{to:`/entities?entityType=${Me.id}`,className:`nav-entity-type ${B&&R===Me.id?"active":""}`,children:[a.jsx("span",{className:"nav-entity-label",children:Me.name}),a.jsx("span",{className:"nav-entity-count",children:Me.entityCount})]},Me.id))]})]}),a.jsxs("div",{className:`nav-group ${k?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>D(Me=>!Me),"aria-expanded":!k,"aria-controls":"notes-nav",children:[a.jsx("span",{className:"nav-heading",children:"Notes"}),a.jsx(Vr,{size:14,className:`nav-heading-icon ${k?"collapsed":""}`})]}),a.jsxs("div",{id:"notes-nav",className:"nav-sub-links",children:[!h&&a.jsx("span",{className:"nav-helper",children:"Select a campaign to view notes"}),h&&!se&&a.jsx("span",{className:"nav-helper",children:"Notes are available to campaign members"}),se&&a.jsxs(a.Fragment,{children:[a.jsxs(Jt,{to:"/notes/session",className:ne("/notes/session")?"active":"",children:[a.jsx(Up,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Session Notes"})]}),a.jsxs(Jt,{to:"/notes/entities",className:ne("/notes/entities")?"active":"",children:[a.jsx(Bp,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Entity Notes"})]})]})]})]}),a.jsxs("div",{className:`nav-group ${N?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>E(Me=>!Me),"aria-expanded":!N,"aria-controls":"characters-nav",children:[a.jsx("span",{className:"nav-heading",children:"Characters"}),a.jsx(Vr,{size:14,className:`nav-heading-icon ${N?"collapsed":""}`})]}),a.jsxs("div",{id:"characters-nav",className:"nav-sub-links",children:[a.jsx(Jt,{to:"/characters/my",className:ne("/characters/my")?"active":"",children:"My Characters"}),h&&Z&&a.jsx(Jt,{to:"/characters/companions",className:ne("/characters/companions")?"active":"",children:"My Companions"}),h&&de&&a.jsx(Jt,{to:"/characters/others",className:ne("/characters/others")?"active":"",children:"All Characters"}),f?.role==="system_admin"&&a.jsx(Jt,{to:"/characters/all",className:ne("/characters/all")?"active admin-link":"admin-link",children:"All Characters"})]})]}),a.jsxs(Jt,{to:"/requests",className:ne("/requests")?"active":"",children:[a.jsx(Bp,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Feature/Bugs"})]}),f?.role==="system_admin"&&a.jsx(Jt,{to:"/users",className:c.pathname==="/users"?"active admin-link":"admin-link",title:"User Management (Admin Only)",children:"Users"})]})]})}function rk(){const e=()=>typeof window>"u"?!1:window.matchMedia("(max-width: 768px)").matches,[t,r]=u.useState(e),[i,l]=u.useState(()=>!e()),[c,f]=u.useState(!1),m=Ga(),h=u.useRef(i),p=u.useRef(!0);u.useEffect(()=>{if(typeof window>"u")return;const N=window.matchMedia("(max-width: 768px)"),E=C=>{r(C.matches)};return r(N.matches),typeof N.addEventListener=="function"?(N.addEventListener("change",E),()=>N.removeEventListener("change",E)):(N.addListener(E),()=>N.removeListener(E))},[]),u.useEffect(()=>{if(t)l(!1),f(!1);else{const N=p.current;l(N),f(E=>N?!1:E)}},[t]);const y=u.useCallback(()=>{f(N=>!N)},[]),g=u.useCallback(()=>{t||l(N=>{const E=!N;return p.current=E,f(!E),E})},[t]);u.useEffect(()=>{h.current=i},[i]),u.useEffect(()=>{if(i||!c)return;const N=E=>{const C=E.target;(C instanceof Element?C:C&&"parentElement"in C?C.parentElement:null)?.closest?.(".sidebar")||f(!1)};return document.addEventListener("mousedown",N),()=>{document.removeEventListener("mousedown",N)}},[i,c]),u.useEffect(()=>{h.current||f(!1)},[m.pathname,m.search]);const v=(m.pathname||"").match(/^\/entities\/([^/]+)\/?$/),S=!!(v&&v[1]!=="bulk-upload"),w=["content",i?"pinned":"",S?"content--entity-detail":""].filter(Boolean).join(" ");return a.jsxs("div",{className:"app-shell",children:[a.jsx(GR,{onMenuToggle:y}),a.jsxs("div",{className:"app-body",children:[a.jsx(sk,{open:c||i,pinned:i,allowPinning:!t,onPinToggle:g,onClose:()=>f(!1)}),!i&&c&&a.jsx("button",{type:"button",className:"sidebar-overlay","aria-label":"Close navigation menu",onClick:()=>f(!1)}),a.jsxs("main",{className:w,children:[a.jsx(s2,{})," "]})]})]})}const Bu={dm:1,player:2,other:3},ik=(e,t)=>!e||!Array.isArray(e.members)||!t?null:e.members.find(r=>r?.user_id===t)??null;function lk(){const{user:e}=Nn(),{campaigns:t,loading:r,error:i,selectedCampaignId:l,setSelectedCampaignId:c,selectedCampaign:f,refreshCampaigns:m}=Bn(),h=e?.username||"Adventurer",[p,y]=u.useState([]),[g,v]=u.useState([]),[S,w]=u.useState(!1),[N,E]=u.useState(!1),[C,A]=u.useState(""),[O,_]=u.useState(""),k=u.useMemo(()=>Array.isArray(t)?[...t].map(H=>({campaign:H,membership:ik(H,e?.id)})).sort((H,X)=>{const V=Bu[H.membership?.role]??Bu.other,R=Bu[X.membership?.role]??Bu.other;return V!==R?V-R:H.campaign.name.localeCompare(X.campaign.name)}):[],[t,e?.id]),D=H=>{H&&c(String(H))};u.useEffect(()=>{let H=!1;if(y([]),v([]),A(""),_(""),!l||!e?.id)return w(!1),E(!1),()=>{H=!0};const X=R=>(Array.isArray(R?.data)?R.data:Array.isArray(R)?R:[]).map(I=>{const L=Number(I?.level);return{id:I?.id,name:I?.name||"Unnamed character",className:I?.class||"",level:Number.isNaN(L)?null:L,isActive:I?.is_active??!0,playerName:I?.player?.username||""}});return(async()=>{w(!0),E(!1);try{const R=await Ls({scope:"my",campaign_id:l});if(H)return;const B=X(R);if(y(B),A(""),w(!1),B.length>0){E(!0);try{const I=await Ls({scope:"companions",campaign_id:l});if(H)return;const L=X(I);v(L),_("")}catch(I){if(H)return;console.error(" Failed to load companions for home widgets",I),v([]),_(I.message||"Failed to load companions")}finally{H||E(!1)}}else v([]),_(""),E(!1)}catch(R){if(H)return;console.error(" Failed to load characters for home widgets",R),y([]),v([]),A(R.message||"Failed to load characters"),_(""),w(!1),E(!1)}})(),()=>{H=!0}},[l,e?.id]);const j=()=>r?a.jsxs("div",{className:"home-empty-state",children:[a.jsx(wn,{className:"spin",size:24}),a.jsx("p",{children:"Loading your campaigns"})]}):i?a.jsxs("div",{className:"home-empty-state error",children:[a.jsx("p",{children:i}),a.jsx("button",{type:"button",className:"home-refresh",onClick:m,children:"Try again"})]}):k.length?a.jsx("div",{className:"campaign-grid",children:k.map(({campaign:H,membership:X})=>{const V=String(H.id),R=l===V,B=X?.role??"guest",I=B==="dm"?"Dungeon Master":B==="player"?"Player":"Observer";return a.jsxs("button",{type:"button",className:`campaign-card ${B} ${R?"active":""}`,onClick:()=>D(V),"aria-pressed":R,children:[a.jsxs("header",{children:[a.jsxs("span",{className:"campaign-role","aria-label":`Role: ${I}`,children:[B==="dm"?a.jsx(yT,{size:18}):a.jsx(xM,{size:18}),I]}),R&&a.jsx("span",{className:"campaign-pill",children:"Active"})]}),a.jsxs("div",{className:"campaign-body",children:[a.jsx("h3",{children:H.name}),H.world?.name&&a.jsxs("p",{className:"campaign-world",children:["World  ",H.world.name]})]}),a.jsx("footer",{children:a.jsx("span",{children:"Set campaign context"})})]},V)})}):a.jsxs("div",{className:"home-empty-state",children:[a.jsx(Li,{size:24}),a.jsx("p",{children:"No campaigns yet. Join one to get started!"})]}),z=()=>S?a.jsxs("div",{className:"home-widget-empty",children:[a.jsx(wn,{className:"spin",size:20}),a.jsx("p",{children:"Loading your characters"})]}):C?a.jsx("div",{className:"home-widget-error",children:a.jsx("p",{children:C})}):p.length?a.jsx("div",{className:"home-card-grid",children:p.map(H=>a.jsxs("article",{className:"home-card",children:[a.jsxs("header",{children:[a.jsx("h3",{children:H.name}),a.jsx("span",{className:`home-card-status ${H.isActive?"active":"inactive"}`,children:H.isActive?"Active":"Inactive"})]}),a.jsxs("div",{className:"home-card-meta",children:[H.className&&a.jsx("span",{children:H.className}),H.level!==null&&a.jsxs("span",{children:["Level ",H.level]})]})]},H.id))}):a.jsx("div",{className:"home-widget-empty",children:a.jsx("p",{children:"No characters in this campaign yet."})}),P=()=>N?a.jsxs("div",{className:"home-widget-empty",children:[a.jsx(wn,{className:"spin",size:20}),a.jsx("p",{children:"Loading companions"})]}):O?a.jsx("div",{className:"home-widget-error",children:a.jsx("p",{children:O})}):g.length?a.jsx("div",{className:"home-card-grid",children:g.map(H=>a.jsxs("article",{className:"home-card",children:[a.jsxs("header",{children:[a.jsx("h3",{children:H.name}),a.jsx("span",{className:`home-card-status ${H.isActive?"active":"inactive"}`,children:H.isActive?"Active":"Inactive"})]}),a.jsxs("div",{className:"home-card-meta",children:[H.className&&a.jsx("span",{children:H.className}),H.level!==null&&a.jsxs("span",{children:["Level ",H.level]})]}),H.playerName&&a.jsxs("p",{className:"home-card-player",children:["Played by ",H.playerName]})]},H.id))}):a.jsx("div",{className:"home-widget-empty",children:a.jsx("p",{children:"No companions discovered in this campaign yet."})}),G=!!f&&p.length>0&&!C;return a.jsxs("div",{className:"home-page",children:[a.jsxs("section",{className:"home-hero",children:[a.jsxs("div",{className:"home-hero-text",children:[a.jsx("p",{className:"home-eyebrow",children:"Your Tabletop Worldbuilding Database"}),a.jsxs("h1",{children:["Welcome, ",h,"."]}),a.jsx("p",{className:"home-description",children:"Select a campaign to explore and build the world."})]}),f&&a.jsxs("div",{className:"home-active-campaign",children:[a.jsx("span",{className:"home-active-label",children:"Currently focused"}),a.jsx("h2",{children:f.name}),f.world?.name&&a.jsx("p",{children:f.world.name})]})]}),a.jsxs("section",{className:"home-section",children:[a.jsxs("div",{className:"home-section-header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"Your campaigns"}),a.jsx("p",{children:"Choose a tile below to update the active campaign context."})]}),a.jsx("button",{type:"button",className:"home-refresh",onClick:m,disabled:r,children:"Refresh"})]}),j()]}),G&&a.jsxs(a.Fragment,{children:[a.jsxs("section",{className:"home-section",children:[a.jsxs("div",{className:"home-section-header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"My Characters"}),a.jsxs("p",{children:["Quick access to your heroes in ",f.name,"."]})]}),a.jsx(Jt,{to:"/characters/my",className:"home-link",children:"Manage"})]}),z()]}),a.jsxs("section",{className:"home-section",children:[a.jsxs("div",{className:"home-section-header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"My Companions"}),a.jsxs("p",{children:["Meet the fellow adventurers journeying in ",f.name,"."]})]}),a.jsx(Jt,{to:"/characters/companions",className:"home-link",children:"View list"})]}),P()]})]})]})}function ok({columns:e,visibleCols:t,onChange:r,onClose:i}){const l=u.useRef(null);u.useEffect(()=>{const m=h=>{l.current&&!l.current.contains(h.target)&&i()};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[i]);const c=m=>{r(t.includes(m)?t.filter(h=>h!==m):[...t,m])},f=()=>{r(e.map(m=>m.key)),i()};return a.jsxs("div",{className:"column-picker",ref:l,children:[a.jsx("div",{className:"column-picker-list",children:e.map(m=>a.jsxs("label",{className:"column-option",children:[a.jsx("input",{type:"checkbox",checked:t.includes(m.key),onChange:()=>c(m.key)}),m.label]},m.key))}),a.jsx("button",{className:"reset-btn",onClick:f,children:"Reset Columns"})]})}function qy({value:e,onChange:t,placeholder:r="Search...",ariaLabel:i}){return a.jsx("input",{className:"search-input compact",type:"text",placeholder:r,"aria-label":i||r,value:e,onChange:l=>t(l.target.value)})}const ck={text:"string",string:"string",varchar:"string",number:"number",integer:"number",float:"number",decimal:"number",numeric:"number",boolean:"boolean",bool:"boolean",checkbox:"boolean",date:"date",datetime:"date",timestamp:"date"},z0={string:[{value:"contains",label:"contains"},{value:"not_contains",label:"doesn't contain"},{value:"equals",label:"is exactly"},{value:"not_equals",label:"is not"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"}],number:[{value:"equals",label:"is"},{value:"not_equals",label:"is not"},{value:"greater_than",label:"is greater than"},{value:"less_than",label:"is less than"},{value:"greater_or_equal",label:"is on or above"},{value:"less_or_equal",label:"is on or below"}],boolean:[{value:"is_true",label:"is true"},{value:"is_false",label:"is false"}],date:[{value:"on",label:"is on"},{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"on_or_before",label:"is on or before"},{value:"on_or_after",label:"is on or after"}]},_i={logic:"AND",conditions:[]},Ol=e=>{if(!e)return"string";const t=String(e).toLowerCase();return ck[t]||"string"},Yp=e=>{const t=Ol(e);return z0[t]||z0.string},V1=(e,t="string")=>{if(e==null||e==="")return"Unassigned";const r=Ol(t);if(Array.isArray(e))return e.length?e.map(i=>V1(i,t)).join(", "):"Unassigned";if(r==="date"){const i=e instanceof Date?e:new Date(e);return Number.isNaN(i.getTime())?String(e):i.toLocaleDateString()}return r==="boolean"?e?"True":"False":String(e)},Rd=e=>{if(e==null||e==="")return null;const t=Number(e);return Number.isNaN(t)?null:t},kd=e=>{if(e==null||e==="")return null;const t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?null:t},Gp=e=>{if(e==null||e==="")return null;if(typeof e=="string"){const t=e.trim();return t.length>0?t:null}if(typeof e=="object"&&!Array.isArray(e)){const t=e.id??e.value??e.key??e.slug??e.uuid??null;return t!=null?String(t).trim():null}if(Array.isArray(e)){for(const t of e){const r=Gp(t);if(r)return r}return null}return null},Y1=e=>{if(e==null)return"";if(typeof e=="string")return e.toLowerCase();if(typeof e=="number")return String(e);if(typeof e=="boolean")return e?"true":"false";if(e instanceof Date)return e.toISOString().toLowerCase();if(Array.isArray(e))return e.map(t=>Y1(t)).filter(Boolean).join(" ");if(typeof e=="object")try{return JSON.stringify(e).toLowerCase()}catch{return""}return String(e).toLowerCase()},uk=e=>{const t=e.trim().toLowerCase();return t?r=>Y1(r).includes(t):()=>!0},dk=(e,t)=>e.localeCompare(t,void 0,{sensitivity:"base"}),fk=(e,t,r="string")=>{const i=Ol(r),l=e==null||e==="",c=t==null||t==="";if(l&&c)return 0;if(l)return 1;if(c)return-1;if(i==="number"){const f=Rd(e),m=Rd(t);return f===null&&m===null?0:f===null?1:m===null?-1:f-m}if(i==="date"){const f=kd(e),m=kd(t);return!f&&!m?0:f?m?f.getTime()-m.getTime():-1:1}if(i==="boolean"){const f=!!e;return f===!!t?0:f?-1:1}return dk(String(e),String(t))},mk=(e,t,r="string")=>{const{operator:i,value:l}=t,c=Ol(r),f=r&&String(r).toLowerCase()==="reference",m=h=>{if(f){const S=Gp(h),w=Gp(l)||String(l??"").trim(),N=S?String(S).toLowerCase():"",E=w?String(w).toLowerCase():"";switch(i){case"equals":return N===E&&N.length>0;case"not_equals":return N!==E||N.length===0;case"contains":return N.includes(E);case"not_contains":return!N.includes(E)}}if(c==="number"){const S=Rd(h),w=Rd(l);if(S===null&&w===null)return i==="equals";if(S===null||w===null)return!1;switch(i){case"equals":return S===w;case"not_equals":return S!==w;case"greater_than":return S>w;case"less_than":return S<w;case"greater_or_equal":return S>=w;case"less_or_equal":return S<=w;default:return!1}}if(c==="date"){const S=kd(h),w=kd(l);if(!S||!w)return!1;switch(i){case"on":return S.getFullYear()===w.getFullYear()&&S.getMonth()===w.getMonth()&&S.getDate()===w.getDate();case"before":return S.getTime()<w.getTime();case"after":return S.getTime()>w.getTime();case"on_or_before":return S.getTime()<=w.getTime();case"on_or_after":return S.getTime()>=w.getTime();default:return!1}}if(c==="boolean"){const S=!!h;return i==="is_true"?S===!0:i==="is_false"?S===!1:i==="equals"?S===(String(l).toLowerCase()==="true"):i==="not_equals"?S!==(String(l).toLowerCase()==="true"):!1}const p=String(h??""),y=String(l??""),g=p.toLowerCase(),v=y.toLowerCase();switch(i){case"contains":return g.includes(v);case"not_contains":return!g.includes(v);case"equals":return g===v;case"not_equals":return g!==v;case"starts_with":return g.startsWith(v);case"ends_with":return g.endsWith(v);default:return!1}};return Array.isArray(e)?e.length===0?m(""):i==="not_contains"?e.every(h=>!m(h)):e.some(h=>m(h)):m(e)},G1=e=>{if(!e||typeof e!="object")return!1;const{conditions:t}=e;return Array.isArray(t)?t.some(r=>r.field&&r.operator):!1},gd=(e="",t="string")=>({id:`condition-${Math.random().toString(36).slice(2)}`,field:e,operator:Yp(t)[0]?.value||"equals",value:""}),$0=(e,t)=>{if(!e||!t||typeof t!="string")return;const r=t.split(".");let i=e;for(const l of r){if(i==null)return;i=i[l]}return i},Do=e=>Array.isArray(e)?e:[],hk=(e=[])=>e.map(t=>({...t,dataType:Ol(t.dataType||t.type)})),pk={};function X1(e,t=pk){const r=u.useMemo(()=>hk(t.columns||[]),[t.columns]),i=u.useMemo(()=>new Map(r.map(L=>[L.key,L])),[r]),l=u.useCallback((L,$)=>{const M=i.get($)||{};return typeof M.accessor=="function"?M.accessor(L):M.path?$0(L,M.path):$0(L,$)??L?.[$]},[i]),[c,f]=u.useState(""),[m,h]=u.useState({key:"",direction:"asc"}),[p,y]=u.useState(""),[g,v]=u.useState(_i),[S,w]=u.useState(new Set),N=u.useCallback(()=>{w(new Set)},[]),E=u.useCallback(L=>{L&&h($=>{if($.key===L){const M=$.direction==="asc"?"desc":"asc";return{key:L,direction:M}}return{key:L,direction:"asc"}})},[]),C=u.useCallback(L=>{y($=>{const M=$===L?"":L;return M!==$&&N(),M})},[N]),A=u.useMemo(()=>uk(c),[c]),O=u.useMemo(()=>r.filter(L=>L.searchable!==!1),[r]),_=u.useMemo(()=>{if(!c)return Do(e);const L=A;return Do(e).filter($=>O.some(M=>{const U=l($,M.key);return L(U)}))},[e,A,l,O,c]),k=u.useMemo(()=>g||_i,[g]),D=u.useMemo(()=>Do(k.conditions),[k]),j=(k.logic||"AND").toUpperCase()==="OR"?"OR":"AND",z=G1(k),P=u.useMemo(()=>z?_.filter(L=>{const $=D.map(M=>{const U=i.get(M.field);if(!U||!M.operator)return!1;const T=l(L,M.field);return mk(T,M,U.dataType)});return j==="OR"?$.some(Boolean):$.every(Boolean)}):_,[_,D,i,l,j,z]),G=u.useMemo(()=>{const L=Do(P);if(!m.key)return L;const $=i.get(m.key);if(!$)return L;const M=[...L];return M.sort((U,T)=>{const q=l(U,m.key),Y=l(T,m.key),Q=fk(q,Y,$.dataType);return m.direction==="asc"?Q:-Q}),M},[P,m,i,l]),H=u.useMemo(()=>{if(!p)return[];const L=i.get(p);if(!L)return[];const $=[],M=new Map;return G.forEach(U=>{const T=l(U,p),q=V1(T,L.dataType),Y=`${p}:${q}`;M.has(Y)||(M.set(Y,$.length),$.push({id:Y,value:T,label:q,items:[]}));const Q=M.get(Y);$[Q].items.push(U)}),$},[G,p,i,l]),X=u.useCallback(L=>{L&&w($=>{const M=new Set($);return M.has(L)?M.delete(L):M.add(L),M})},[]),V=u.useCallback(L=>L?S.has(L):!1,[S]),R=u.useCallback(()=>{v(_i)},[]),B=u.useCallback(L=>{if(!L||typeof L!="object"){v(_i);return}const $=(L.logic||"AND").toUpperCase()==="OR"?"OR":"AND",M=Do(L.conditions).map(U=>{const T=i.get(U.field);return T?{...U,field:T.key,operator:U.operator||gd(T.key,T.dataType).operator,value:U.value??""}:null});v({logic:$,conditions:M.filter(Boolean)})},[i]);return{searchTerm:c,setSearchTerm:f,sortState:m,toggleSort:E,groupBy:p,setGroupBy:C,filters:k,setFilters:B,clearFilters:R,filterActive:z,data:G,groups:H,visibleData:p?H:G,getValue:l,toggleGroupCollapse:X,isGroupCollapsed:V,columns:r}}const K1=e=>{if(!e||typeof e!="object")return e;const t=e.imageData!==void 0?e.imageData:e.image_data!==void 0?e.image_data:null,r=e.imageMimeType!==void 0?e.imageMimeType:e.image_mime_type!==void 0?e.image_mime_type:null;return e.imageData===t&&e.imageMimeType===r?e:{...e,imageData:t,imageMimeType:r}},Pa=e=>{if(!e||typeof e!="object")return null;const t=e.data&&typeof e.data=="object"&&"id"in e.data?e.data:e.entity&&typeof e.entity=="object"&&"id"in e.entity?e.entity:"id"in e?e:null;return t?K1(t):null},zl=e=>{if(!e||typeof e!="object")return"";const t=e.imageData??e.image_data,r=e.imageMimeType??e.image_mime_type;return!t||!r?"":`data:${r};base64,${t}`},yk=Object.freeze([]);function oc({worldId:e,label:t,value:r,onChange:i,allowedTypeIds:l=[],disabled:c=!1,placeholder:f="Search entities",staticOptions:m,minSearchLength:h=2,onResolved:p,required:y=!1}){const[g,v]=u.useState(""),[S,w]=u.useState([]),[N,E]=u.useState(!1),[C,A]=u.useState(!1),[O,_]=u.useState(null),[k,D]=u.useState(""),j=u.useRef(null),z=u.useRef(null),P=u.useRef(p),G=u.useMemo(()=>[...l],[JSON.stringify(l)]),H=Array.isArray(m)?m:yk,X=u.useMemo(()=>Array.isArray(H)?H.map((U,T)=>{if(U==null)return null;if(typeof U=="object"){const Y=U.value??U.id??U.key??U.slug??`static-${T}`;if(Y==null)return null;const Q=U.label??U.name??U.title??U.display??U.displayName??Y;return{id:String(Y),name:String(Q),entity_type:U.entity_type||U.entityType||null,typeName:U.typeName||null,_static:!0}}const q=String(U);return{id:q,name:q,_static:!0}}).filter(Boolean):[],[H]),V=U=>{if(!U)return"";const T=U.entity_type?.name||U.entityType?.name||U.typeName||U.type?.name||"";return T?`${U.name} (${T})`:U.name};u.useEffect(()=>{c&&A(!1)},[c]),u.useEffect(()=>()=>{z.current&&clearTimeout(z.current)},[]),u.useEffect(()=>{if(!r){_(null),v("");return}if(typeof r=="object"&&r.id){const Y=V(r);(!O||O.id!==r.id)&&(_(r),v(Y));return}if(typeof r!="string")return;const U=r;if(O?.id===U)return;const T=X.find(Y=>String(Y.id)===String(U));if(T){_(T),v(V(T));return}let q=!1;return(async()=>{try{const Y=await cr(U);if(q)return;const Q=Pa(Y);if(Q?.id){_(Q),v(V(Q));return}}catch(Y){q||console.warn("Entity lookup failed",Y)}q||(_({id:U,name:U}),v(U))})(),()=>{q=!0}},[r,X,O?.id]),u.useEffect(()=>{if(!g.trim()||O||c)return;const U=g.trim();if(U.length<h){w([]);return}return z.current&&clearTimeout(z.current),z.current=setTimeout(()=>{if(!e){w([]),E(!1);return}(async()=>{try{E(!0),D("");const T=await lf({worldId:e,query:U,typeIds:G,limit:20}),q=Array.isArray(T?.data)?T.data:T;w(Array.isArray(q)?q:[])}catch(T){console.error("Entity search failed",T),w([]),D(T.message||"Failed to search entities.")}finally{E(!1)}})()},400),()=>{z.current&&clearTimeout(z.current)}},[g,e,O,G,c,h]),u.useEffect(()=>{const U=T=>{j.current&&!j.current.contains(T.target)&&A(!1)};return document.addEventListener("mousedown",U),()=>document.removeEventListener("mousedown",U)},[]),u.useEffect(()=>{P.current=p},[p]),u.useEffect(()=>{P.current?.(O||null)},[O]);const R=u.useMemo(()=>{if(!X.length)return[];if(!g.trim())return X;const U=g.trim().toLowerCase();return X.filter(T=>V(T).toLowerCase().includes(U))},[X,g]),B=u.useMemo(()=>{const U=new Map,T=[];return R.forEach(q=>{const Y=q?.id;if(Y==null)return;const Q=String(Y);U.has(Q)||(U.set(Q,!0),T.push(q))}),S.forEach(q=>{const Y=q?.id;if(Y==null)return;const Q=String(Y);U.has(Q)||(U.set(Q,!0),T.push(q))}),T},[R,S]),I=U=>{U&&(_(U),v(V(U)),A(!1),w([]),D(""),i?.(U))},L=()=>{_(null),v(""),w([]),D(""),A(!1),i?.(null)},$=C&&B.length>0,M=C&&!N&&!B.length&&g.trim().length>=h&&!O;return a.jsxs("div",{className:"entity-search-select",ref:j,children:[t&&a.jsx("label",{children:t}),a.jsxs("div",{className:"entity-search-wrapper",children:[a.jsx("input",{type:"text",value:g,required:y,onChange:U=>{const T=U.target.value;v(T),_(null),c||A(!0)},onFocus:()=>{c||A(!0)},disabled:c,placeholder:f,className:"entity-search-input"}),O&&!c&&a.jsx("button",{type:"button",className:"clear-btn",onClick:L,title:"Clear selection","aria-label":"Clear selection",children:""})]}),N&&a.jsx("div",{className:"small text-muted",children:"Searching"}),k&&a.jsx("div",{className:"small text-warning",children:k}),$&&a.jsx("ul",{className:"entity-results",children:B.map(U=>a.jsx("li",{onMouseDown:T=>T.preventDefault(),onClick:()=>I(U),className:O?.id===U.id?"selected":"",children:V(U)},U.id))}),M&&a.jsx("div",{className:"small text-muted",style:{marginTop:"0.25rem"},children:"No matches found."})]})}const F0=e=>Array.isArray(e)?e:[],gk=e=>{const t=e?.options?.choices;return!Array.isArray(t)||t.length===0?[]:t.map((r,i)=>{if(r==null)return null;if(typeof r=="object"){const c=r.value??r.id??r.key??r.slug??`choice-${i}`,f=r.label??r.name??r.title??r.display??c;return c==null?null:{value:String(c),label:String(f??c)}}const l=String(r);return{value:l,label:l}}).filter(Boolean)};function W1({open:e,onClose:t,fields:r=[],value:i=_i,worldId:l,onApply:c}){const f=Array.isArray(r)?r:[],m=f[0]?.key||"",[h,p]=u.useState(i.logic||"AND"),[y,g]=u.useState(()=>{const D=F0(i.conditions);return D.length>0?D.map(j=>({...j})):[gd(m,f[0]?.dataType)]}),[v,S]=u.useState(new Map);u.useEffect(()=>{if(!e)return;p(i.logic||"AND");const D=F0(i.conditions);D.length>0?g(D.map(j=>({...j}))):g([gd(m,f[0]?.dataType)])},[e,i,m,f]);const w=()=>{const D=y[0]?.field||m,j=f.find(z=>z.key===D);g(z=>[...z,gd(D,j?.dataType)])},N=(D,j)=>{g(z=>{const P=[...z],G=f.find(H=>H.key===j);return P[D]={...P[D],field:j,operator:Yp(G?.dataType)[0]?.value||"equals",value:""},P})},E=(D,j)=>{g(z=>{const P=[...z];return P[D]={...P[D],operator:j},P})},C=(D,j)=>{g(z=>{const P=[...z];return P[D]={...P[D],value:j},P})},A=D=>{g(j=>{if(j.length===1)return j;const z=[...j];return z.splice(D,1),z})},O=()=>{const D=y.map(j=>({...j})).filter(j=>j.field&&j.operator);if(D.length===0){c?.(_i);return}c?.({logic:h,conditions:D})},_=u.useMemo(()=>(Array.isArray(r)?r:[]).map(j=>({...j,originalDataType:j.dataType||j.type||"string",dataType:Ol(j.dataType||j.type)})),[r]),k=u.useCallback((D,j)=>{if(!D){S(G=>{const H=new Map(G),X=y[j];return X?.value&&H.delete(String(X.value)),H});return}const z=String(D.id),P=D.name||`Entity ${z}`;S(G=>{const H=new Map(G);return H.set(z,P),H})},[y]);return e?a.jsx("div",{className:"condition-modal-backdrop",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"condition-modal",children:[a.jsxs("div",{className:"condition-modal-header",children:[a.jsx("h2",{children:"Filters"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:t,"aria-label":"Close filters",children:a.jsx(Da,{size:18})})]}),a.jsxs("div",{className:"condition-logic",children:[a.jsx("span",{children:"Match records where"}),a.jsxs("div",{className:"logic-toggle",role:"group","aria-label":"Filter logic",children:[a.jsx("button",{type:"button",className:`logic-btn${h==="AND"?" is-active":""}`,onClick:()=>p("AND"),children:"All conditions (AND)"}),a.jsx("button",{type:"button",className:`logic-btn${h==="OR"?" is-active":""}`,onClick:()=>p("OR"),children:"Any condition (OR)"})]})]}),a.jsx("div",{className:"condition-list",children:Array.isArray(y)&&y.map((D,j)=>{const z=_.find(V=>V.key===D.field)||_[0]||{dataType:"string",key:""},P=Yp(z.dataType),G=Array.isArray(P)?P:[],H=D.operator||G[0]?.value||"equals",X=!["is_true","is_false"].includes(H);return a.jsxs("div",{className:"condition-row",children:[a.jsx("select",{className:"condition-field",value:D.field||z.key,onChange:V=>N(j,V.target.value),children:_.map(V=>a.jsx("option",{value:V.key,children:V.label},V.key))}),a.jsx("select",{className:"condition-operator",value:H,onChange:V=>E(j,V.target.value),children:G.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))}),X?(()=>{const V=z.originalDataType||z.dataType,R=V==="boolean"||V==="bool",B=V==="enum",I=z.referenceTypeId||z.reference_type_id||z.referenceType?.id||null,L=(V==="reference"||z.dataType==="reference")&&I,$=(H==="equals"||H==="not_equals")&&(R||B||L);if($&&R)return a.jsxs("select",{className:"condition-value",value:D.value??"",onChange:M=>C(j,M.target.value),children:[a.jsx("option",{value:"",children:"Select..."}),a.jsx("option",{value:"true",children:"True"}),a.jsx("option",{value:"false",children:"False"})]});if($&&B){const M=gk(z),U=Array.isArray(M)?M:[];return U.length===0?a.jsx("input",{className:"condition-value",type:"text",value:D.value??"",onChange:T=>C(j,T.target.value),placeholder:"Value"}):a.jsxs("select",{className:"condition-value",value:D.value??"",onChange:T=>C(j,T.target.value),children:[a.jsx("option",{value:"",children:"Select..."}),U.map(T=>a.jsx("option",{value:T.value,children:T.label},T.value))]})}if($&&L){const M=z.referenceTypeId||z.reference_type_id||z.referenceType?.id||null,U=M?String(M).trim():null,T=z.referenceTypeName||z.reference_type_name||z.referenceType?.name||"entities",q=D.value,Y=U&&U.length>0?[U]:[],Q=q||null;return a.jsx("div",{className:"condition-value-reference",children:a.jsx(oc,{worldId:l,value:Q,allowedTypeIds:Y,placeholder:`Search ${T.toLowerCase()}...`,disabled:!l||!U,onChange:oe=>{if(!oe)C(j,""),k(null,j);else{const Z=String(oe.id);C(j,Z),k(oe,j)}},onResolved:oe=>k(oe,j),minSearchLength:2})})}return a.jsx("input",{className:"condition-value",type:z.dataType==="number"?"number":z.dataType==="date"?"date":"text",value:D.value??"",onChange:M=>C(j,M.target.value),placeholder:"Value"})})():a.jsx("span",{className:"condition-value placeholder",children:"No value"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>A(j),disabled:y.length===1,"aria-label":"Remove condition",children:a.jsx(ua,{size:16})})]},D.id||`${D.field}-${j}`)})}),a.jsxs("div",{className:"condition-actions",children:[a.jsxs("button",{type:"button",className:"btn secondary",onClick:w,children:[a.jsx(Va,{size:16})," Add condition"]}),a.jsxs("div",{className:"condition-action-right",children:[G1(i)&&a.jsx("button",{type:"button",className:"btn ghost",onClick:()=>c?.(_i),children:"Clear filters"}),a.jsx("button",{type:"button",className:"btn submit",onClick:O,children:"Apply filters"})]})]})]})}):null}function df({data:e,columns:t,title:r,extraActions:i,onRowClick:l}){const[c,f]=u.useState(t.map(k=>k.key)),[m,h]=u.useState(!1),[p,y]=u.useState(!1),[g,v]=u.useState({open:!1,column:null,x:0,y:0}),S=u.useMemo(()=>t.map(k=>({...k,dataType:k.dataType||k.type||"string"})),[t]),w=X1(e,{columns:S}),N=S.filter(k=>c.includes(k.key));u.useEffect(()=>{f(k=>{const D=S.map(z=>z.key),j=k.filter(z=>D.includes(z));return D.forEach(z=>{j.includes(z)||j.push(z)}),j.length===k.length&&j.every((z,P)=>z===k[P])?k:j})},[S]);const E=k=>{w.toggleSort(k.key)},C=(k,D)=>{k.preventDefault(),v({open:!0,column:D,x:k.clientX,y:k.clientY})};u.useEffect(()=>{if(!g.open)return;const k=()=>v({open:!1,column:null,x:0,y:0});return window.addEventListener("click",k),window.addEventListener("contextmenu",k),()=>{window.removeEventListener("click",k),window.removeEventListener("contextmenu",k)}},[g.open]);const A=k=>{w.setGroupBy(k.key),v({open:!1,column:null,x:0,y:0})},O=(k,D)=>{if(typeof D.render=="function")return D.render(k,w.getValue(k,D.key));const j=k[D.key];return j!==void 0?j:w.getValue(k,D.key)},_=w.groupBy?w.groups.some(k=>k.items.length>0):w.data.length>0;return a.jsxs("div",{className:"list-viewer",children:[a.jsxs("div",{className:"list-viewer-header",children:[a.jsx("h2",{children:r}),a.jsxs("div",{className:"list-controls",children:[i&&a.jsx("div",{className:"extra-actions",children:i}),a.jsx(qy,{value:w.searchTerm,onChange:w.setSearchTerm,placeholder:`Search ${r.toLowerCase()}...`}),a.jsxs("button",{type:"button",className:`btn secondary compact${w.filterActive?" is-active":""}`,onClick:()=>y(!0),children:[a.jsx(Jd,{size:16})," Filters"]}),a.jsxs("div",{className:"column-picker-wrapper",children:[a.jsx("button",{className:"icon-btn",title:"Column settings",onClick:()=>h(k=>!k),children:a.jsx(E1,{size:18})}),m&&a.jsx("div",{className:"column-picker-popover",children:a.jsx(ok,{columns:S,visibleCols:c,onChange:f,onClose:()=>h(!1)})})]})]})]}),_?a.jsx("div",{className:"list-viewer-table-wrapper",children:a.jsxs("table",{children:[a.jsx("thead",{children:a.jsx("tr",{children:N.map(k=>{const D=w.sortState.key===k.key,j=w.sortState.direction,z=w.groupBy===k.key;return a.jsx("th",{onClick:()=>E(k),onContextMenu:P=>C(P,k),className:"sortable-header",role:"button",tabIndex:0,children:a.jsxs("span",{className:"header-label",children:[k.label,D&&a.jsx("span",{className:"sort-indicator",children:j==="asc"?"":""}),z&&a.jsx("span",{className:"group-indicator",children:"Grouped"})]})},k.key)})})}),a.jsx("tbody",{children:w.groupBy?w.groups.map(k=>a.jsxs(u.Fragment,{children:[a.jsx("tr",{className:"group-header-row",children:a.jsxs("td",{colSpan:N.length,children:[a.jsx("button",{type:"button",className:"group-toggle",onClick:()=>w.toggleGroupCollapse(k.id),children:w.isGroupCollapsed(k.id)?a.jsx(Iy,{size:14}):a.jsx(Vr,{size:14})}),a.jsxs("span",{className:"group-label",children:[k.label," ",a.jsxs("span",{className:"group-count",children:["(",k.items.length,")"]})]})]})}),!w.isGroupCollapsed(k.id)&&k.items.map(D=>a.jsx("tr",{onClick:()=>l&&l(D),className:l?"clickable-row":"",children:N.map(j=>a.jsx("td",{"data-column":j.label||j.key,children:O(D,j)},j.key))},D.id))]},k.id)):w.data.map(k=>a.jsx("tr",{onClick:()=>l&&l(k),className:l?"clickable-row":"",children:N.map(D=>a.jsx("td",{"data-column":D.label||D.key,children:O(k,D)},D.key))},k.id))})]})}):a.jsx("div",{className:"empty-state",children:a.jsx("p",{children:"No results found."})}),g.open&&g.column&&a.jsxs("div",{className:"column-context-menu",style:{top:g.y,left:g.x},role:"menu",children:[a.jsx("button",{type:"button",onClick:()=>A(g.column),children:w.groupBy===g.column.key?"Remove grouping":`Group by ${g.column.label}`}),w.groupBy&&w.groupBy!==g.column.key&&a.jsx("button",{type:"button",onClick:()=>A({key:""}),children:"Clear grouping"})]}),a.jsx(W1,{open:p,onClose:()=>y(!1),fields:S.map(k=>({key:k.key,label:k.label,dataType:k.dataType})),value:w.filters,onApply:k=>{w.setFilters(k),y(!1)}})]})}const bk="modulepreload",vk=function(e){return"/"+e},B0={},Z1=function(t,r,i){let l=Promise.resolve();if(r&&r.length>0){let p=function(y){return Promise.all(y.map(g=>Promise.resolve(g).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};var f=p;document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),h=m?.nonce||m?.getAttribute("nonce");l=p(r.map(y=>{if(y=vk(y),y in B0)return;B0[y]=!0;const g=y.endsWith(".css"),v=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${v}`))return;const S=document.createElement("link");if(S.rel=g?"stylesheet":bk,g||(S.as="script"),S.crossOrigin="",S.href=y,h&&S.setAttribute("nonce",h),document.head.appendChild(S),g)return new Promise((w,N)=>{S.addEventListener("load",w),S.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${y}`)))})}))}function c(m){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=m,window.dispatchEvent(h),!h.defaultPrevented)throw m}return l.then(m=>{for(const h of m||[])h.status==="rejected"&&c(h.reason);return t().catch(c)})};function Q1(e){if(!e&&e!==0)return null;if(typeof e=="object"&&e!==null){const r=e.value??e.id??e.key??e.slug??null;if(r==null)return null;const i=e.label??e.name??e.title??e.username??e.email??String(r);return{value:String(r),label:String(i),raw:e}}const t=String(e);return{value:t,label:t,raw:e}}function ks({selected:e=[],options:t=[],onChange:r,placeholder:i="Search and select...",disabled:l=!1,noOptionsMessage:c="No options available.",loading:f=!1,inputId:m}){const[h,p]=u.useState(""),[y,g]=u.useState(!1),v=u.useRef(null),S=u.useMemo(()=>{const j=t.map(P=>Q1(P)).filter(Boolean),z=new Set;return j.filter(P=>{const G=P.value;return z.has(G)?!1:(z.add(G),!0)})},[t]),w=u.useMemo(()=>{const j=new Set;return e.forEach(z=>{z!=null&&j.add(String(z))}),j},[e]),N=u.useMemo(()=>{const j=new Map(S.map(z=>[z.value,z]));return Array.from(w).map(z=>{const P=j.get(z);return P||{value:z,label:z}})},[S,w]),E=u.useMemo(()=>S.filter(j=>!w.has(j.value)),[S,w]),C=u.useMemo(()=>{if(!h)return E;const j=h.toLowerCase();return E.filter(z=>z.label.toLowerCase().includes(j))},[E,h]);u.useEffect(()=>{if(!y)return;const j=z=>{v.current&&(v.current.contains(z.target)||g(!1))};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[y]);const A=j=>{if(l)return;const z=[],P=new Set;j.forEach(G=>{if(G==null)return;const H=String(G);P.has(H)||(P.add(H),z.push(H))}),r?.(z)},O=j=>{if(!j)return;const z=[...w,j.value];A(z),p(""),g(!1)},_=j=>{const z=String(j),P=Array.from(w).filter(G=>G!==z);A(P)},k=y&&!l,D=()=>f?"Loading options...":E.length===0?w.size>0?"All options selected.":c:"No matches found.";return a.jsxs("div",{className:`list-collector ${l?"disabled":""}`,ref:v,children:[a.jsxs("div",{className:"list-collector-input-wrapper",children:[a.jsx("input",{id:m,type:"text",className:"list-collector-input",value:h,placeholder:i,disabled:l,onFocus:()=>!l&&g(!0),onChange:j=>{p(j.target.value),y||g(!0)},onKeyDown:j=>{j.key==="Enter"&&C.length>0&&(j.preventDefault(),O(C[0])),j.key==="Escape"&&(g(!1),j.currentTarget.blur())}}),a.jsx("span",{className:"list-collector-icon","aria-hidden":"true",children:""})]}),k&&a.jsx("div",{className:"list-collector-dropdown",children:C.length>0?a.jsx("ul",{children:C.map(j=>a.jsx("li",{children:a.jsx("button",{type:"button",onMouseDown:z=>z.preventDefault(),onClick:()=>O(j),className:"list-collector-option",children:j.label})},j.value))}):a.jsx("div",{className:"list-collector-empty",children:D()})}),N.length>0&&a.jsx("div",{className:"list-collector-pills",children:N.map(j=>a.jsxs("span",{className:"list-collector-pill",children:[a.jsx("span",{className:"pill-label",children:j.label}),!l&&a.jsx("button",{type:"button",className:"pill-remove",onClick:()=>_(j.value),"aria-label":`Remove ${j.label}`,children:""})]},j.value))})]})}const xk=e=>e===null?"null":e===void 0?"undefined":Array.isArray(e)?"array":e instanceof Date?"date":typeof e,ff=(e,t,r={})=>{const i=(c,f,m,h="<<anonymous>>")=>{const p=f[m];return p==null?(c&&console.warn(`[PropTypes] Prop "${m}" is marked as required in "${h}", but its value is ${String(p)}.`),null):e(p,f,m,h)?(r.afterValidate&&r.afterValidate(p,f,m,h),null):(console.warn(`[PropTypes] Invalid prop "${m}" supplied to "${h}". Expected ${t}, but received ${xk(p)}.`),null)},l=i.bind(null,!1);return l.isRequired=i.bind(null,!0),l._validate=c=>c==null||e(c),l._expectedDescription=t,l},Uu=e=>ff(t=>typeof t===e,e),Sk=()=>ff(e=>e!==null&&typeof e=="object"&&!Array.isArray(e)&&!(e instanceof Date),"object"),wk=e=>{const t=c=>Array.isArray(c)?!e||typeof e!="function"?!0:c.every(f=>e._validate?e._validate(f):!0):!1,r=(c,f,m,h)=>{Array.isArray(c)&&(!e||typeof e!="function"||c.forEach((p,y)=>{try{e({[`${m}[${y}]`]:p},`${m}[${y}]`,h)}catch{}}))},i=`an array of ${e?._expectedDescription??"the specified type"}`,l=ff(t,i,{afterValidate:r});return l._validate=c=>c==null?!0:Array.isArray(c)?c.every(f=>e&&e._validate?e._validate(f):!0):!1,l},Nk=e=>{const t=Array.isArray(e)?e.filter(Boolean):[],r=c=>t.some(f=>f&&typeof f._validate=="function"?f._validate(c):!0),i=t.map(c=>c?._expectedDescription).filter(Boolean),l=i.length>0?i.join(", "):"one of the specified types";return ff(r,l)},on={string:Uu("string"),number:Uu("number"),bool:Uu("boolean"),func:Uu("function"),object:Sk(),arrayOf:e=>wk(e),oneOfType:e=>Nk(e)},Zr=e=>e?Array.isArray(e)?e:Array.isArray(e.data)?e.data:[]:[],Xp=e=>{if(e==null)return null;if(typeof e=="string"){const t=e.trim();return t?t.toLowerCase():null}if(typeof e=="number")return String(e);if(typeof e=="object"){if(Array.isArray(e)){for(const t of e){const r=Xp(t);if(r)return r}return null}return Xp(e.fieldKey??e.field_key??e.key??e.name??e.id)??null}return null},Tn=(e,t)=>{const r=Xp(t);r&&e.add(r)},Ek=e=>{if(!e||typeof e!="object")return[];const t=new Set;return Tn(t,e.id),Tn(t,e.field_id),Tn(t,e.entity_type_field_id),Tn(t,e.fieldId),Tn(t,e.name),Tn(t,e.key),Tn(t,e.field),Tn(t,e.metadataField),Tn(t,e.metadata_field),e?.sourceField&&Tn(t,e.sourceField),e?.source_field&&Tn(t,e.source_field),Array.from(t)},jk=e=>Array.isArray(e)?e.map((t,r)=>{if(!t||typeof t!="object")return null;const i=new Set;if(Tn(i,t.fieldKey),Tn(i,t.field_key),Tn(i,t.field),Tn(i,t.fieldName),Tn(i,t.field_name),Tn(i,t.fieldId),Tn(i,t.field_id),Tn(i,t.target),Tn(i,t.targetField),Tn(i,t.target_field),Tn(i,t.metadataField),Tn(i,t.metadata_field),Tn(i,t.entity_type_field_id),Tn(i,t.name),Tn(i,t.key),t.field&&typeof t.field=="object"&&(Tn(i,t.field.id),Tn(i,t.field.name),Tn(i,t.field.key)),!i.size)return null;const l=(y,g=0)=>{if(y==null||y==="")return g;const v=Number(y);return Number.isFinite(v)?v:g},c=l(t.sectionOrder??t.section_order??t.sectionIndex??t.section_index,0),f=l(t.column??t.columnOrder??t.column_index??t.columnIndex,0),m=l(t.fieldOrder??t.field_order??t.order??t.order_index??t.position??t.sortOrder??t.sort_order,r),h=l(t.priority??t.weight??t.rank,r),p=c*1e6+f*1e4+m*100+h;return{identifiers:Array.from(i),rank:p,sectionOrder:c,columnOrder:f,fieldPosition:m,priority:h}}).filter(Boolean):[],Hy=(e=[],t=[])=>{if(!Array.isArray(e)||e.length===0)return[];const r=jk(t),i=new Map;r.length>0&&r.forEach(f=>{f.identifiers.forEach(m=>{i.has(m)||i.set(m,f.rank)})});const l=(f,m)=>{if(f==null||f==="")return m;const h=Number(f);return Number.isFinite(h)?h:m},c=e.map((f,m)=>{const h=Ek(f);let p=Number.POSITIVE_INFINITY;h.forEach(g=>{if(!g)return;const v=i.get(g);v!==void 0&&v<p&&(p=v)});const y=l(f?.sortOrder??f?.sort_order,m);return{field:f,rank:p,fallbackSort:y,index:m}});return c.sort((f,m)=>{const h=Number.isFinite(f.rank),p=Number.isFinite(m.rank);return h&&p&&f.rank!==m.rank?f.rank-m.rank:h&&!p?-1:!h&&p?1:f.fallbackSort!==m.fallbackSort?f.fallbackSort-m.fallbackSort:f.index-m.index}),c.map(f=>f.field)},Py=e=>!!e&&typeof e=="object"&&!Array.isArray(e),_k=e=>Array.isArray(e)?e:e==null?[]:[e],xs=e=>e==null?null:typeof e=="string"?e.trim()||null:typeof e=="number"?String(e):Py(e)?xs(e.field??e.fieldKey??e.field_name??e.source??e.sourceField??e.source_field??e.key??e.name??e.target??e.targetField??e.target_field??e.metadataField??e.metadata_field??e.id)??null:null,Ck=e=>{if(!e||typeof e!="object")return null;const t=l=>l==null?null:String(l).trim()||null,r=t(e.key??e.name??e.field);if(r&&r.startsWith("metadata."))return r;const i=t(e.metadataField??e.metadata_field)||(r&&!r.includes(".")?r:null)||t(e.name);return i?i.startsWith("metadata.")?i:`metadata.${i}`:r},Ak=(e=[])=>{const t=new Map,r=(i,l)=>{if(!i||!l)return;const c=xs(i),f=xs(l);!c||!f||(t.set(c,f),t.set(c.toLowerCase(),f))};return e.forEach(i=>{if(!i||typeof i!="object")return;const l=Ck(i);if(!l)return;r(l,l),[i.id,i.field_id,i.fieldId,i.entity_type_field_id,i.field,i.name,i.key,i.metadataField,i.metadata_field,i.fieldKey,i.field_key,i.target,i.targetField,i.target_field,i.source,i.sourceField,i.source_field].forEach(f=>r(f,l))}),t},Tk={eq:"equals","=":"equals","==":"equals","===":"equals",equals:"equals",equal:"equals",match:"equals",matches:"equals",ne:"not_equals","!=":"not_equals","!==":"not_equals",not:"not_equals",notequals:"not_equals",not_equals:"not_equals",different:"not_equals",contains:"contains",includes:"contains",has:"contains",not_contains:"not_contains",excludes:"not_contains",notincludes:"not_contains",in:"in",any:"in",within:"in",not_in:"not_in",none:"not_in",outside:"not_in",gt:"gt",greater:"gt",greater_than:"gt",gte:"gte",ge:"gte",greater_or_equal:"gte",lt:"lt",less:"lt",less_than:"lt",lte:"lte",le:"lte",less_or_equal:"lte",is_set:"is_set",isset:"is_set",set:"is_set",exists:"is_set",present:"is_set",is_not_set:"is_not_set",notset:"is_not_set",missing:"is_not_set",empty:"is_empty",is_empty:"is_empty",not_empty:"is_not_empty",filled:"is_not_empty",truthy:"truthy",falsy:"falsy"},Mk=e=>{if(e==null)return"equals";const t=String(e).trim().toLowerCase();return Tk[t]??"equals"},Rk={all:"all",every:"all",and:"all",any:"any",some:"any",or:"any",either:"any",none:"none",not:"none"},kk=e=>{if(e==null)return"all";const t=String(e).trim().toLowerCase();return Rk[t]??"all"},Dk={show:"show",display:"show",reveal:"show",visible:"show",enable:"show",hide:"hide",remove:"hide",conceal:"hide",hidden:"hide",disable:"hide",require:"require",required:"require",mandatory:"require",optional:"optional",option:"optional",allow:"optional"},Ik=e=>{if(e==null)return null;const t=String(e).trim().toLowerCase();return Dk[t]??null},U0=(e,t=0)=>{if(!e)return null;if(!Py(e)){if(typeof e=="string"){const[f,...m]=e.split("="),h=xs(f);if(!h)return null;const p=m.join("=").trim();return{field:h,operator:"equals",values:p?[p]:[]}}return null}const r=xs(e.field??e.fieldKey??e.field_name??e.source??e.sourceField??e.source_field??e.input??e.left??e.property??e.key??e.name);if(!r)return null;const i=Mk(e.operator??e.comparator??e.condition??e.type),l=e.values??e.value??e.match??e.compareTo??e.matchValue??e.expected,c=_k(l).filter(f=>f!==void 0);return{field:r,operator:i,values:c,id:e.id??`condition-${t}`}},Lk=e=>{const t=["conditions","criteria","when","rules","predicates","matchers"];for(const i of t)if(Array.isArray(e?.[i]))return e[i].map((l,c)=>U0(l,c)).filter(Boolean);const r=U0(e,0);return r?[r]:[]},Bh=(e,t=0)=>{if(!e||!Py(e)&&typeof e!="string")return null;if(typeof e=="string"){const l=xs(e);return l?{target:l,action:"show",id:`action-${t}`}:null}const r=xs(e.target??e.targetField??e.target_field??e.field??e.fieldKey??e.field_name??e.path??e.name??e.key??e.metadataField??e.metadata_field),i=Ik(e.action??e.type??e.behavior??e.behaviour??e.effect??e.command);return!r||!i?null:{target:r,action:i,id:e.id??`action-${t}`}},Ok=e=>{const t=["actions","effects","apply","then","responses"];for(const i of t)if(Array.isArray(e?.[i]))return e[i].map((l,c)=>Bh(l,c)).filter(Boolean);if(Array.isArray(e?.targets)&&e.targets.length>0)return e.targets.map((i,l)=>Bh({target:i,action:e.action??e.effect??e.behavior??e.behaviour},l)).filter(Boolean);const r=e.target??e.targetField??e.target_field??e.actionTarget??e.fieldTarget??e.metadataField??e.metadata_field;return r&&(e.action||e.effect||e.behavior||e.behaviour)?[Bh({target:r,action:e.action??e.effect??e.behavior??e.behaviour})].filter(Boolean):[]},Kp=e=>{if(e==null)return"";if(typeof e=="number"&&Number.isFinite(e))return String(e);if(typeof e=="boolean")return e?"true":"false";if(e instanceof Date)return String(e.getTime());if(typeof e=="string")return e.trim().toLowerCase();if(Array.isArray(e))return e.map(t=>Kp(t));if(typeof e=="object")try{return JSON.stringify(e)}catch{return String(e)}return String(e)},ps=(e,t)=>{if(Array.isArray(e))return e.some(f=>ps(f,t));if(Array.isArray(t))return t.some(f=>ps(e,f));const r=Number(e),i=Number(t);if(!Number.isNaN(r)&&!Number.isNaN(i))return r===i;const l=Kp(e),c=Kp(t);return l===c},fl=e=>e==null?!1:typeof e=="string"?e.trim().length>0:Array.isArray(e)?e.length>0:e instanceof Date?!0:typeof e=="object"?Object.keys(e).length>0:!0,zk=(e,t)=>{if(t==null)return;let r=t;if(typeof r!="string"){const l=xs(r);if(!l)return;r=l}if(!r)return;const i=r.replace(/\[(.*?)\]/g,(l,c)=>`.${c.replace(/^['"]|['"]$/g,"")}`).split(".").map(l=>l.trim()).filter(l=>l.length>0);if(i.length)return i.reduce((l,c)=>{if(l!=null)return c==="*"?l:l[c]},e)},Uh=(e,t)=>{if(!e)return!1;const{field:r,operator:i,values:l=[]}=e,c=zk(t,r);switch(i){case"equals":return l.length?l.some(f=>ps(c,f)):!1;case"not_equals":return l.length?l.every(f=>!ps(c,f)):fl(c);case"contains":return Array.isArray(c)?c.some(f=>l.some(m=>ps(f,m))):typeof c=="string"?l.some(f=>f==null?!1:c.toLowerCase().includes(String(f).toLowerCase())):!1;case"not_contains":return Array.isArray(c)?c.every(f=>l.every(m=>!ps(f,m))):typeof c=="string"?l.every(f=>f==null?!0:!c.toLowerCase().includes(String(f).toLowerCase())):!0;case"in":return l.length?Array.isArray(c)?c.some(f=>l.some(m=>ps(f,m))):l.some(f=>ps(c,f)):!1;case"not_in":return l.length?Array.isArray(c)?c.every(f=>l.every(m=>!ps(f,m))):l.every(f=>!ps(c,f)):!0;case"gt":case"gte":case"lt":case"lte":{const f=Number(c);if(Number.isNaN(f))return!1;const m=l.find(p=>p!=null),h=Number(m);return Number.isNaN(h)?!1:i==="gt"?f>h:i==="gte"?f>=h:i==="lt"?f<h:f<=h}case"is_set":return fl(c);case"is_not_set":return!fl(c);case"is_empty":return!fl(c);case"is_not_empty":return fl(c);case"truthy":return!!c;case"falsy":return!c;default:return l.length?l.some(f=>ps(c,f)):fl(c)}},$k=(e,t)=>{const r=Array.isArray(e?.conditions)?e.conditions:[];if(r.length===0)return!0;switch(e?.matchMode){case"any":return r.some(i=>Uh(i,t));case"none":return!r.some(i=>Uh(i,t));case"all":default:return r.every(i=>Uh(i,t))}},Vy=(e=[],t=[])=>{if(!Array.isArray(e))return[];const r=Ak(t),i=c=>{const f=xs(c);if(!f)return typeof c=="string"?c:null;if(r.size>0){const m=r.get(f)||r.get(f.toLowerCase());if(m)return m}return f},l=e.map((c,f)=>{if(!c||typeof c!="object"||c.disabled||c.enabled===!1)return null;const m=Array.isArray(c.conditions)&&Array.isArray(c.actions)&&c.conditions.every(w=>w?.field&&w?.operator)&&c.actions.every(w=>w?.target&&w?.action),h=m?c.conditions.map(w=>({...w})):Lk(c),p=m?c.actions.map(w=>({...w})):Ok(c);if(!h.length||!p.length)return null;const y=h.map(w=>{const N=i(w?.field);return N?{...w,field:N}:null}).filter(Boolean),g=p.map(w=>{const N=i(w?.target);return N?{...w,target:N}:null}).filter(Boolean);if(!y.length||!g.length)return null;const v=c.priority??c.order??c.sort??c.rank??f,S=Number.isFinite(Number(v))?Number(v):f;return{id:c.id??`field-rule-${f}`,name:c.name??c.label??"",matchMode:kk(c.matchMode??c.match_mode??c.matchType??c.logic??c.condition),conditions:y,actions:g,priority:S}}).filter(Boolean);return l.sort((c,f)=>c.priority-f.priority),l},Yy=(e,t={})=>{const r=Array.isArray(e)?e:[],i=t&&typeof t=="object"?t:{},l={},c=new Set;return r.forEach(f=>{!f||!$k(f,i)||f.actions.forEach(h=>{if(!h?.target||!h?.action)return;const p=h.target,y=xs(p)?.toLowerCase()??null;l[p]=h.action,y&&l[y]===void 0&&(l[y]=h.action),h.action==="show"?(c.add(p),y&&c.add(y)):h.action==="hide"&&(c.delete(p),y&&c.delete(y))})}),{actionsByField:l,showRuleTargets:c}},cc=(e,t,r=new Set,i=!0)=>{if(!e)return!1;const l=typeof t=="string"?t.toLowerCase():"",c=xs(e)?.toLowerCase()??null;return r instanceof Set&&(r.has(e)||(c?r.has(c):!1))||l==="show"?!1:l==="hide"||l==="hidden"||i===!1},J1=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?typeof e=="string"?e:String(e):t.toLocaleString()},Fk=e=>{const t=e?.value;if(t==null)return"";switch(e?.dataType){case"boolean":return!!t;case"number":{const r=Number(t);return Number.isNaN(r)?t:r}case"enum":return typeof t=="object"&&t!==null?t.value??t.id??t.key??t.slug??t.name??"":t;case"date":return J1(t);case"reference":if(typeof t=="object"&&t!==null){const r=t.label??t.name??t.title??t.display??t.displayName??t.text??t.value??t.id;if(r==null)try{return JSON.stringify(t,null,2)}catch(i){return console.warn(" Failed to serialise reference metadata field",i),String(t)}return String(r)}return t;case"text":if(typeof t=="object")try{return JSON.stringify(t,null,2)}catch(r){return console.warn(" Failed to serialise text metadata field",r),String(t)}return t;default:if(typeof t=="object")try{return JSON.stringify(t,null,2)}catch(r){return console.warn(" Failed to serialise metadata field",r),String(t)}return t}},Bk=e=>{const t=e?.value;return t==null?e?.dataType==="boolean"?!1:"":e?.dataType==="boolean"?!!t:e?.dataType==="reference"&&typeof t=="object"&&t!==null?t.value??t.id??t.key??t.slug??t.uuid??"":t},eN=(e=[])=>!Array.isArray(e)||e.length===0?{}:e.reduce((t,r)=>(r?.name&&(t[r.name]=Fk(r)),t),{}),Uk=(e=[])=>!Array.isArray(e)||e.length===0?{}:e.reduce((t,r)=>(r?.name&&(t[r.name]=Bk(r)),t),{}),qk=(e=[])=>!Array.isArray(e)||e.length===0?{}:e.reduce((t,r)=>{if(!r?.name||r.dataType!=="reference")return t;const i=(()=>{if(r.displayValue)return r.displayValue;if(r.display)return r.display;if(r.selectedLabel)return r.selectedLabel;const l=r.value;return!l||typeof l!="object"?null:l.label??l.name??l.title??l.display??l.displayName??l.text??l.value??l.id??null})();return i==null||(t[r.name]=String(i)),t},{}),Gy=e=>{if(e==null||e==="")return null;if(typeof e=="string"){const t=e.trim();return t.length>0?t:null}if(typeof e=="number"||typeof e=="bigint")return String(e);if(typeof e=="object"&&!Array.isArray(e)){const t=e.id??e.value??e.entity_id??e.entityId??e.key??e.slug??e.uuid??null;if(t!=null){const r=String(t).trim();return r.length>0?r:null}return null}if(Array.isArray(e)){for(const t of e){const r=Gy(t);if(r)return r}return null}return null},Xy=e=>{if(e==null)return null;if(typeof e=="object"&&!Array.isArray(e)){const t=e.displayValue??e.display??e.label??e.name??e.title??e.displayName??e.text??null;if(t!=null){const r=String(t).trim();return r.length>0?r:null}return null}if(Array.isArray(e)){for(const t of e){const r=Xy(t);if(r)return r}return null}return null},q0=450,qh="preparing-open",tN=e=>{if(e==null)return"";if(Array.isArray(e)){const t=e.map(r=>r==null?null:typeof r=="object"?r.label||r.name||r.title||r.value||r.id||null:String(r)).filter(Boolean);return t.length>0?t.join(", "):""}if(typeof e=="object")try{return JSON.stringify(e,null,2)}catch(t){return console.warn(" Failed to serialise metadata value",t),String(e)}return typeof e=="boolean"?e?"Yes":"No":e===""?"":String(e)},H0=e=>{if(!e||typeof e!="object")return null;const t=e.displayValue??e.label??e.name??e.title??e.display??e.displayName??e.text??e.value??e.id;return t==null?null:String(t)},Hk=e=>{if(!e)return"";const{dataType:t,value:r}=e;if(r==null)return t==="boolean"?"No":"";switch(t){case"boolean":return r?"Yes":"No";case"number":{const i=Number(r);return Number.isNaN(i)?String(r):String(i)}case"enum":return typeof r=="object"&&r!==null?r.label||r.name||r.title||r.value||r.id||"":String(r);case"reference":{if(Array.isArray(r)){const i=r.map(c=>c==null?null:typeof c=="object"?H0(c)||null:String(c)).filter(Boolean);if(i.length>0)return i.join(", ");const l=e.displayValue||e.display||e.selectedLabel||e.referenceName||e.referenceLabel;return l?String(l):""}if(typeof r=="object"&&r!==null){const i=H0(r);if(i)return i;try{return JSON.stringify(r,null,2)}catch(l){return console.warn(" Failed to serialise reference metadata value",l),String(r)}}if(r==="")return"";if(e.displayValue||e.display||e.selectedLabel){const i=e.displayValue||e.display||e.selectedLabel;return i?String(i):""}return String(r)}case"date":return J1(r);case"text":default:return tN(r)}},Pk=(e,t)=>{if(!e)return[];const r=Array.isArray(e.fields)?e.fields:[];if(r.length>0)return Hy(r,t).filter(c=>c?.name||c?.label).map((c,f)=>{const m=c.name||c.label||`field-${f}`,h=c.label||c.name||`Field ${f+1}`,p=c?.name?`metadata.${c.name}`:c?.key||m,y=c.visibleByDefault!==void 0?!!c.visibleByDefault:c.visible_by_default!==void 0?!!c.visible_by_default:!0;return{key:m,label:h,value:Hk(c),fieldKey:p,visibleByDefault:y}});const i=e.metadata&&typeof e.metadata=="object"&&e.metadata||e.meta&&typeof e.meta=="object"&&e.meta||null;return i?Object.entries(i).map(([l,c])=>({key:l,label:l,value:tN(c),fieldKey:l&&`metadata.${l}`,visibleByDefault:!0})):[]},Vk=e=>{if(!e)return{};if(Array.isArray(e.fields)&&e.fields.length>0)return eN(e.fields);const t=e.metadata&&typeof e.metadata=="object"&&e.metadata||e.meta&&typeof e.meta=="object"&&e.meta||null;return t?{...t}:{}};function Ky({entity:e,entityId:t,onClose:r,isLoading:i=!1,error:l="",fallbackName:c="",fieldOrder:f=[],fieldRules:m=[]}){const h=$n(),[p,y]=u.useState(()=>t?{entity:e,entityId:t,isLoading:i,error:l,fallbackName:c}:null),[g,v]=u.useState(t?"open":"closed"),S=u.useRef(null),w=u.useRef(null);u.useEffect(()=>()=>{w.current&&(clearTimeout(w.current),w.current=null)},[]),u.useEffect(()=>{if(t&&S.current?.entityId===t&&(S.current={entity:e,entityId:t,isLoading:i,error:l,fallbackName:c}),t){if(!p){y({entity:e,entityId:t,isLoading:i,error:l,fallbackName:c}),v(qh);return}if(p.entityId===t){y(T=>!T||T.entity===e&&T.isLoading===i&&T.error===l&&T.fallbackName===(c||T.fallbackName||"")?T:{...T,entity:e,isLoading:i,error:l,fallbackName:c||T.fallbackName||""}),g==="closing"&&w.current?(clearTimeout(w.current),w.current=null,S.current=null,v("opening")):g==="closed"&&v(qh);return}S.current={entity:e,entityId:t,isLoading:i,error:l,fallbackName:c},g!=="closing"&&v("closing"),w.current||(w.current=setTimeout(()=>{y(S.current),S.current=null,v("opening"),w.current=null},q0));return}p&&(g!=="closing"&&v("closing"),w.current||(S.current=null,w.current=setTimeout(()=>{y(null),v("closed"),w.current=null},q0)))},[e,t,i,l,c,p,g]),u.useEffect(()=>{if(g!==qh)return;const T=requestAnimationFrame(()=>{v("opening")});return()=>cancelAnimationFrame(T)},[g]),u.useEffect(()=>{if(g!=="opening")return;const T=requestAnimationFrame(()=>{v("open")});return()=>cancelAnimationFrame(T)},[g]);const N=!!p,E=g==="closing",C=p?.entity,A=p?.entityId,O=p?.isLoading??!1,_=p?.error??"",k=p?.fallbackName,D=C?.fields,j=u.useMemo(()=>Vy(m,D),[m,D]),z=u.useMemo(()=>Vk(C),[C]),P=u.useMemo(()=>({metadata:z}),[z]),G=u.useMemo(()=>Yy(j,P),[j,P]),H=u.useMemo(()=>Pk(C,f),[C,f]),X=u.useMemo(()=>{if(!H.length)return[];const T=G?.actionsByField??{},q=G?.showRuleTargets??new Set;return H.filter(Y=>{if(!Y?.fieldKey)return!0;const Q=T[Y.fieldKey],oe=Y.visibleByDefault!==void 0?!!Y.visibleByDefault:Y.visible_by_default!==void 0?!!Y.visible_by_default:!0;return!cc(Y.fieldKey,Q,q,oe)})},[H,G]),V=X.length>0,R=C?.name||k||(O?"Loading entity":"Unknown entity"),B=C?.type?.name||C?.typeName||"Entity",I=u.useMemo(()=>zl(C),[C]);if(!N)return null;const $=["entity-info-drawer-wrapper",g==="open"?"entity-info-drawer-wrapper--open":"",g==="opening"?"entity-info-drawer-wrapper--opening":"",E?"entity-info-drawer-wrapper--closing":""].filter(Boolean).join(" "),M=()=>{A&&h(`/entities/${A}`)},U=!!A&&!O&&!_;return a.jsxs("div",{className:$,role:"presentation",children:[a.jsx("div",{className:"entity-info-drawer__overlay",onClick:r,role:"presentation"}),a.jsxs("aside",{className:"entity-info-drawer",role:"complementary","aria-label":"Entity details",children:[a.jsxs("header",{className:"entity-info-drawer__header",children:[a.jsxs("div",{className:"entity-info-drawer__header-top",children:[a.jsx("p",{className:"entity-info-drawer__type",title:B,children:B}),a.jsxs("div",{className:"entity-info-drawer__actions",children:[a.jsx("button",{type:"button",className:"entity-info-drawer__link",onClick:M,disabled:!U,children:"Go to Record"}),a.jsx("button",{type:"button",className:"entity-info-drawer__close",onClick:r,"aria-label":"Close entity details",children:""})]})]}),a.jsx("h2",{className:"entity-info-drawer__title",title:R,children:R})]}),I&&!O&&!_?a.jsx("div",{className:"entity-info-drawer__image",children:a.jsx("img",{src:I,alt:`Portrait of ${R}`,loading:"lazy"})}):null,C?.summary&&!O&&!_&&a.jsx("p",{className:"entity-info-drawer__summary",children:C.summary}),!C?.summary&&C?.description&&!O&&!_&&a.jsx("p",{className:"entity-info-drawer__summary",children:C.description}),O&&a.jsx("p",{className:"entity-info-drawer__status","aria-live":"polite",children:"Loading entity information"}),!!_&&!O&&a.jsx("p",{className:"entity-info-drawer__status entity-info-drawer__status--error","aria-live":"assertive",children:_}),!O&&!_&&V&&a.jsx("dl",{className:"entity-info-drawer__metadata",children:X.map(T=>a.jsxs("div",{className:"entity-info-drawer__metadata-item",children:[a.jsx("dt",{children:T.label}),a.jsx("dd",{children:T.value})]},T.key))}),!O&&!_&&!V&&a.jsx("p",{className:"entity-info-drawer__status",children:"No additional metadata available."})]})]})}Ky.propTypes={entityId:on.string,onClose:on.func.isRequired,isLoading:on.bool,error:on.string,fallbackName:on.string,fieldOrder:on.arrayOf(on.object),fieldRules:on.arrayOf(on.object)};function Os({entityId:e,entityName:t="entity",className:r=""}){const[i,l]=u.useState(!1),[c,f]=u.useState(!1),[m,h]=u.useState(null),[p,y]=u.useState(""),[g,v]=u.useState([]),[S,w]=u.useState([]),N=u.useRef(null),E=u.useMemo(()=>e==null?null:String(e),[e]);u.useEffect(()=>(N.current||(N.current=document.createElement("div"),document.body.appendChild(N.current)),()=>{N.current&&N.current.parentNode&&(N.current.parentNode.removeChild(N.current),N.current=null)}),[]);const C=u.useCallback(()=>{l(!1),y(""),h(null),f(!1)},[]),A=k=>{if(k.preventDefault(),k.stopPropagation(),e==null)return;const D=typeof t=="string"?t.trim():"";E&&D&&h(j=>j&&j.id===E?j.name||!D?j:{...j,name:D}:{id:E,name:D}),l(!0)};u.useEffect(()=>{if(!E)return;const k=typeof t=="string"?t.trim():"";k&&h(D=>!D||D.id!==E||D.name===k||D.name&&D.name!==k?D:{...D,name:k})},[E,t]),u.useEffect(()=>{if(!i||!E)return;let k=!1;return(async()=>{f(!0),y("");try{const j=await cr(E);if(k)return;const z=Pa(j);if(!z){h(null),y("Entity not found");return}h(z)}catch(j){if(k)return;console.error(" Failed to load entity preview",j),h(null),y(j.message||"Failed to load entity information")}finally{k||f(!1)}})(),()=>{k=!0}},[i,E]);const O=u.useMemo(()=>m&&(m.entity_type_id||m.entityType?.id||m.entity_type?.id)||null,[m]);u.useEffect(()=>{if(!O){v([]),w([]);return}if(!i)return;let k=!1;return(async()=>{try{const[j,z]=await Promise.all([cf(O).catch(P=>(console.error(" Failed to load preview field order",P),null)),uf(O).catch(P=>(console.error(" Failed to load preview field rules",P),null))]);if(k)return;v(Zr(j)),w(Zr(z))}catch(j){if(k)return;console.error(" Failed to load preview field layout",j),v([]),w([])}})(),()=>{k=!0}},[i,O]),u.useEffect(()=>{if(!i)return;const k=D=>{D.key==="Escape"&&(D.preventDefault(),C())};return window.addEventListener("keydown",k),()=>{window.removeEventListener("keydown",k)}},[i,C]);const _=i&&N.current?a.jsx(Ky,{entityId:E,entity:m,isLoading:c,error:p,fallbackName:t,onClose:C,fieldOrder:g,fieldRules:S}):null;return a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:`entity-info-trigger ${r}`.trim(),onClick:A,"aria-label":`View details for ${t}`,children:a.jsx(Oy,{size:16,"aria-hidden":"true"})}),N.current&&Ec.createPortal(_,N.current)]})}Os.propTypes={entityId:on.oneOfType([on.string,on.number]).isRequired,entityName:on.string,className:on.string};function mf({field:e,data:t,onChange:r,mode:i="edit"}){const l=e.key||e.name||e.field||"",[c,f]=u.useState([]),[m,h]=u.useState(!e.optionsSource),[p,y]=u.useState(()=>JSON.stringify(e.optionsCriteria??null)),[g,v]=u.useState(()=>({selectedLabel:e?.selectedLabel?String(e.selectedLabel):"",selectedValue:null})),S=i==="view";async function w(M=5,U=200){for(let T=0;T<M;T++){const q=ei();if(q)return q;await new Promise(Y=>setTimeout(Y,U))}return null}const N=u.useCallback(M=>{if(M==null)return"null";try{return JSON.stringify(M)}catch(U){return console.warn(" Unable to serialise options criteria",U),String(M)}},[]);u.useEffect(()=>{const M=N(e.optionsCriteria??null);y(U=>U===M?U:M)},[e.optionsCriteria,N]),u.useEffect(()=>{let M=!0;return(async()=>{if(!e.optionsSource){M&&(f([]),h(!0));return}const{API_BASE:T}=await Z1(async()=>{const{API_BASE:se}=await Promise.resolve().then(()=>kM);return{API_BASE:se}},[]);let q=null;const Y=new URLSearchParams;let Q=null;const oe=se=>{if(se==null)return null;if(typeof se=="string"){const ne=new URLSearchParams(se);return ne.get("world_id")||ne.get("worldId")}if(Array.isArray(se)){for(const ne of se)if(Array.isArray(ne)&&ne.length>=2){const[we,Le]=ne;if(we==="world_id"||we==="worldId")return Le}else if(ne&&typeof ne=="object"){const we=oe(ne);if(we)return we}return null}return typeof se=="object"&&(se.world_id||se.worldId)||null},Z=se=>{if(se==null)return null;if(typeof se=="string"){const ne=new URLSearchParams(se);ne.delete("world_id"),ne.delete("worldId");const we=ne.toString();return we||null}if(Array.isArray(se)){const ne=se.map(we=>{if(Array.isArray(we)&&we.length>=2){const[Le,Me]=we;return Le==="world_id"||Le==="worldId"?null:[Le,Me]}if(we&&typeof we=="object"){const Le=Z(we);return Le||null}return we}).filter(we=>we==null?!1:Array.isArray(we)?!0:typeof we=="object"?Object.keys(we).length>0:!0);return ne.length>0?ne:null}if(typeof se=="object"){const ne={...se};return delete ne.world_id,delete ne.worldId,Object.keys(ne).length>0?ne:null}return se};switch(e.optionsSource){case"worlds":q="/worlds";break;case"campaigns":q="/campaigns";break;case"entities":{const se=oe(e.optionsCriteria),ne=e.worldId||e.world_id||t?.world_id||t?.worldId||null,we=se||ne;if(!we){console.warn(" Unable to resolve world id for entity options"),q=null;break}q=`/worlds/${we}/entities`,Q=Z(e.optionsCriteria);break}case"users":q="/users";break;case"players":{q="/users";const se=e.roles||"player,user";Y.set("roles",se);break}default:q=null}if(!q){M&&(f([]),h(!0));return}const J=(()=>{try{let se;if(q.startsWith("http"))se=new URL(q);else{const Le=T.replace(/\/$/,""),Me=q.startsWith("/")?q:`/${q}`;se=new URL(`${Le}${Me}`)}Y.forEach((Le,Me)=>{Le!=null&&se.searchParams.append(Me,Le)});const ne=Q??e.optionsCriteria,we=Le=>{if(!(!Le&&Le!==0)){if(typeof Le=="string"){new URLSearchParams(Le).forEach((Ae,ot)=>{se.searchParams.append(ot,Ae)});return}if(Array.isArray(Le)){Le.forEach(Me=>{if(Array.isArray(Me)&&Me.length>=2){const[Ae,ot]=Me;if(ot==null)return;Array.isArray(ot)?ot.forEach(ze=>{ze!=null&&se.searchParams.append(Ae,ze)}):se.searchParams.append(Ae,ot);return}typeof Me=="object"&&Me!==null&&we(Me)});return}typeof Le=="object"&&Object.entries(Le).forEach(([Me,Ae])=>{Ae!=null&&(Array.isArray(Ae)?Ae.forEach(ot=>{ot!=null&&se.searchParams.append(Me,ot)}):se.searchParams.append(Me,Ae))})}};return we(ne),se}catch(se){return console.error(" Failed to construct options endpoint URL",se),null}})();if(!J){M&&(f([]),h(!0));return}M&&h(!1);try{const se=await w();if(!se){console.warn(" No auth token available when loading options"),M&&h(!0);return}const ne=await fetch(J,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${se}`}}),we=ne.headers.get("content-type");if(!we||!we.includes("application/json")){const ze=await ne.text();console.error(` ${e.optionsSource} returned non-JSON response:`,{status:ne.status,statusText:ne.statusText,contentType:we,url:J.toString(),preview:ze.substring(0,200)}),M&&h(!0);return}const Le=await ne.json();if(!ne.ok){console.warn(` ${e.optionsSource} fetch failed`,Le),M&&h(!0);return}e.optionsSource==="worlds"&&console.log(" Worlds response:",Le);const Me=ze=>{if(!ze||typeof ze!="object")return null;const nt=e.optionValueKey||"id",$e=e.optionLabelKey||"name",vt=ze?.[nt]??ze?.id??null;if(!vt)return null;let _t=ze?.[$e];if(!_t){const Tt=["name","title","username"];for(const Ct of Tt)if(ze?.[Ct]){_t=ze[Ct];break}}return _t||(_t=String(vt)),{value:vt,label:_t}},ot=(Array.isArray(Le?.data)?Le.data:Array.isArray(Le)?Le:[]).map(Me).filter(Boolean);M&&(f(ot),h(!0),ot.length===0&&console.warn(` ${e.optionsSource} returned no data`,Le))}catch(se){console.error(` Failed to load ${e.optionsSource}:`,se),M&&h(!0)}})(),()=>{M=!1}},[e.optionsSource,e.optionLabelKey,e.optionValueKey,p,e.roles,e.worldId,e.world_id,t?.world_id,t?.worldId]),u.useEffect(()=>{e?.selectedLabel&&v(M=>M.selectedLabel===String(e.selectedLabel)?M:{...M,selectedLabel:String(e.selectedLabel)})},[e?.selectedLabel]);const E=e.label||l,C=(e.type||"text").toLowerCase(),A=e.referenceTypeId??e.reference_type_id??e.referenceType?.id??null,O=e.referenceTypeName??e.reference_type_name??e.referenceType?.name??"",_=l.includes(".")?l.split(".").reduce((M,U)=>M?M[U]:void 0,t):t?.[l],k=["checkbox","boolean"].includes(C)?!!_:C==="multiselect"?Array.isArray(_)?_.map(M=>{if(M==null)return null;if(typeof M=="object"){const U=e.optionValueKey||"id",T=M?.[U]??M?.id??M?.value??M?.key??null;return T==null?null:String(T)}return String(M)}).filter(M=>M!=null):typeof _=="string"&&_.length>0?_.split(",").map(M=>M.trim()).filter(Boolean):[]:_??"",D=e.readonly||e.disabled,j=S||D,z=M=>M==null||M===""?"":Array.isArray(M)?M.length>0?M.join(", "):"":typeof M=="boolean"?M?"Yes":"No":String(M),P=z(k),G=M=>r?.(l,M.target.value),H=M=>r?.(l,M.target.checked),X=u.useCallback((M,U)=>{if(!(!U||typeof U!="string")&&!(!M||typeof M!="object"))return U.includes(".")?U.split(".").filter(T=>T.length>0).reduce((T,q)=>{if(T!=null&&typeof T=="object")return T[q]},M):M?.[U]},[]),V=u.useCallback(()=>{const M=[e.worldId,e.world_id,t?.worldId,t?.world_id];e.world&&typeof e.world=="object"&&M.push(e.world.id,e.world.world_id),t?.world&&typeof t.world=="object"&&M.push(t.world.id,t.world.world_id),t?.metadata&&typeof t.metadata=="object"&&M.push(t.metadata.worldId,t.metadata.world_id);for(const U of M){if(U==null)continue;const T=String(U).trim();if(T)return T}return""},[e.worldId,e.world_id,e.world,t?.worldId,t?.world_id,t?.world,t?.metadata]),R=C==="reference"&&k!==void 0&&k!==null?String(k):"",B=u.useMemo(()=>{if(C!=="reference")return[];const M=e.options?.choices;return Array.isArray(M)?M.map((U,T)=>{if(U==null)return null;if(typeof U=="object"){const Y=U.value??U.id??U.key??U.slug??`choice-${T}`;if(Y==null)return null;const Q=U.label??U.name??U.title??U.display??U.displayName??Y;return{value:String(Y),label:String(Q)}}const q=String(U);return{value:q,label:q}}).filter(Boolean):[]},[C,e.options?.choices]);if(u.useEffect(()=>{C==="reference"&&(R||v(M=>!M.selectedLabel&&!M.selectedValue?M:{...M,selectedLabel:"",selectedValue:null}))},[C,R]),u.useEffect(()=>{if(C!=="reference"||!R)return;const M=B.find(T=>T.value===R),U=(()=>{if(typeof e.value=="object"&&e.value!==null){const T=e.value.label??e.value.name??e.value.title??e.value.display??e.value.displayName??e.value.text??e.value.value??e.value.id??null;if(T!=null){const q=String(T).trim();if(q)return q}}return M?.label?String(M.label):""})();if(!U){v(T=>T.selectedValue===R?T:{...T,selectedValue:R});return}v(T=>T.selectedValue===R&&T.selectedLabel===U?T:{...T,selectedLabel:U,selectedValue:R})},[C,R,e.value,B]),!l)return console.warn(" Field without key/name skipped:",e),null;const I=M=>{const U=[];return e.helpText&&U.push(a.jsx("p",{className:"help-text",children:e.helpText},"help")),M&&U.push(a.jsx("p",{className:"help-text warning",children:e.noOptionsMessage||"No options available."},"empty")),U};if(C==="reference"){const M=V(),U=typeof O=="string"&&O.trim()?O.trim():"entities",T=B.length>0,Y=!!!(A&&M)&&!T;if(j){let J=(e.displayKey&&X(t,e.displayKey)?X(t,e.displayKey):null)??g.selectedLabel??B.find(we=>we.value===R)?.label??"";!J&&R&&(J=R);const se=Gy(_||e.value||R),ne=Xy(_||e.value)||J||R;return a.jsxs("div",{className:`form-group ${j?"readonly":""}`,children:[a.jsx("label",{children:E}),a.jsxs("div",{style:{position:"relative",display:"inline-block",width:"100%"},children:[a.jsx("input",{type:"text",value:z(J),disabled:!0,className:"readonly-control",style:{paddingRight:se?"2.5rem":"0.8rem",width:"100%"}}),se&&a.jsx("div",{style:{position:"absolute",right:"0.5rem",top:"50%",transform:"translateY(-50%)",zIndex:1},children:a.jsx(Os,{entityId:se,entityName:ne,className:"entity-info-trigger--field-button"})})]}),I(!1)]})}const Q=de=>{if(!de){r?.(l,""),v(we=>({...we,selectedLabel:"",selectedValue:null}));return}const J=de.id??de.value??de.key??de.slug??de.uuid??null;if(J==null){r?.(l,"");return}const se=String(J),ne=de.name??de.label??de.title??de.display??de.displayName??"";r?.(l,se),v(we=>({...we,selectedLabel:ne||we.selectedLabel||se,selectedValue:se}))},oe=de=>{if(!de){v(we=>({...we,selectedLabel:"",selectedValue:null}));return}const J=de.id??de.value??de.key??de.slug??de.uuid??null;if(J==null)return;const se=String(J),ne=de.name??de.label??de.title??de.display??de.displayName??"";v(we=>we.selectedValue===se&&we.selectedLabel===ne?we:{...we,selectedLabel:ne||we.selectedLabel||se,selectedValue:se})},Z=R&&g.selectedLabel?{id:R,name:g.selectedLabel}:R;return a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:E}),a.jsx(oc,{worldId:M,value:Z,allowedTypeIds:A?[A]:[],disabled:Y,placeholder:`Search ${U.toLowerCase()}...`,staticOptions:B,onChange:Q,onResolved:oe,required:!!e.required}),!A&&a.jsx("p",{className:"help-text warning",children:"Reference type configuration is missing."}),A&&!M&&a.jsx("p",{className:"help-text warning",children:"Select a world to search for entities."}),I(!1)]})}if(["select","dropdown"].includes(C)){const M=[...e.options||[],...c],U=k??"",T=m&&e.optionsSource&&M.length===0;if(j){const q=M.find(oe=>oe?typeof oe=="object"?String(oe.value)===String(U):String(oe)===String(U):!1),Y=e.displayKey&&X(t,e.displayKey)?X(t,e.displayKey):null,Q=z(Y||(q?typeof q=="object"?q.label??q.value:q:U));return a.jsxs("div",{className:`form-group ${j?"readonly":""}`,children:[a.jsx("label",{children:E}),a.jsx("input",{type:"text",value:Q,disabled:!0,className:"readonly-control"}),I(!1)]})}return a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:E}),a.jsx("div",{className:"select-wrapper",children:a.jsxs("select",{value:U,onChange:G,disabled:T,children:[a.jsx("option",{value:"",children:"Select..."}),M.map((q,Y)=>{const Q=typeof q=="object"?q.value:q,oe=typeof q=="object"?q.label:q;return a.jsx("option",{value:Q,children:oe},Q||Y)})]})}),I(T)]})}if(C==="multiselect"){const M=[...Array.isArray(e.selectedOptions)?e.selectedOptions:[],...Array.isArray(e.prefillOptions)?e.prefillOptions:[]],U=[...e.options||[],...c,...M].map((oe,Z)=>{const de=Q1(oe);if(de)return de;if(typeof oe=="object"&&oe!==null){const se=oe.value??oe.id??oe.key??oe.slug??`opt-${Z}`,ne=oe.label??oe.name??oe.title??oe.username??oe.email??se;return se==null?null:{value:String(se),label:String(ne)}}if(oe==null)return null;const J=String(oe);return{value:J,label:J}}).filter(Boolean),T=new Map,q=U.filter(oe=>{const Z=String(oe.value);return T.has(Z)?!1:(T.set(Z,oe),!0)}),Y=Array.isArray(k)?k.map(oe=>String(oe)).filter(Boolean):[],Q=m&&e.optionsSource&&q.length===0;if(j){const oe=Y.map(Z=>{const de=T.get(String(Z));return de?de.label??de.value??String(Z):String(Z)}).filter(Boolean);return a.jsxs("div",{className:`form-group ${j?"readonly":""}`,children:[a.jsx("label",{children:E}),a.jsx("textarea",{className:"textarea-field",value:oe.length?oe.join(`
`):"",readOnly:!0}),I(!1)]})}return a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:E}),a.jsx(ks,{selected:Y,options:q,onChange:oe=>r?.(l,oe),placeholder:e.placeholder||"Search and select...",noOptionsMessage:e.noOptionsMessage||"No options available.",loading:!m&&!!e.optionsSource}),I(Q)]})}if(["textarea","multiline"].includes(C))return a.jsxs("div",{className:`form-group ${j?"readonly":""}`,children:[a.jsx("label",{children:E}),a.jsx("textarea",{className:"textarea-field",rows:e.rows||4,value:j?P:k,onChange:G,disabled:j}),I(!1)]});if(["checkbox","boolean"].includes(C))return a.jsxs("div",{className:"form-group checkbox",children:[a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:!!k,onChange:H,disabled:j}),E]}),I(!1)]});if(C==="readonly"){const M=k?.username||k?.name||k||"-";return a.jsxs("div",{className:"form-group readonly",children:[a.jsx("label",{children:E}),a.jsx("div",{className:"readonly-value",children:M}),I(!1)]})}const L=(j?"text":e.inputType)||"text",$=(()=>{if(k==null)return"";if(new Set(["number","date","datetime-local","month","time","week","range"]).has(L)&&typeof k=="string"){const U=k.trim();if(!U||U==="")return""}return k})();return j?a.jsxs("div",{className:"form-group readonly",children:[a.jsx("label",{children:E}),a.jsx("div",{className:"readonly-value",children:P}),I(!1)]}):a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:E}),a.jsx("input",{type:L,value:$,onChange:G,placeholder:e.placeholder||"",className:j?"readonly-control":void 0}),I(!1)]})}const nN="You have unsaved changes. Select Cancel to stay here and save, or OK to leave without saving.";function Yk(e,t=nN,r){const i=u.useCallback(({currentLocation:l,nextLocation:c})=>!e||r?.current?!1:!(l.pathname===c.pathname&&l.search===c.search&&l.hash===c.hash),[e,r]);q2({when:i,message:t}),m1(u.useCallback(l=>{!e||r?.current||(l.preventDefault(),l.returnValue="")},[e,r]),{capture:!0})}function Gk({schema:e,initialData:t={},onSubmit:r,onCancel:i,onDelete:l,hideActions:c=!1,enableUnsavedPrompt:f=!0,onStateChange:m,fieldRules:h},p){const[y,g]=u.useState(()=>t?{...t}:{}),[v,S]=u.useState(()=>JSON.stringify(t??{})),[w,N]=u.useState(""),[E,C]=u.useState("success"),[A,O]=u.useState(!1),[_,k]=u.useState(()=>({actionsByField:{},showRuleTargets:new Set})),D=u.useMemo(()=>{if(!e)return[];const q=Array.isArray(e.fields)?e.fields.filter(Q=>Q&&typeof Q=="object"):[],Y=Array.isArray(e.sections)?e.sections.flatMap(Q=>Array.isArray(Q?.fields)?Q.fields:[]).filter(Q=>Q&&typeof Q=="object"):[];return q.length===0&&Y.length===0?[]:[...Y,...q]},[e]),j=u.useMemo(()=>{const q=Array.isArray(h)?h:[];return Vy(q,D)},[h,D]);u.useEffect(()=>{const q=t?{...t}:{};g(q),S(JSON.stringify(t??{})),N(""),C("success")},[t]),u.useEffect(()=>{if(!j.length){k({actionsByField:{},showRuleTargets:new Set});return}const q=Yy(j,y);k(q)},[j,y]);const z=u.useMemo(()=>Array.isArray(e?.sections)&&e.sections.length>0?e.sections:Array.isArray(e?.fields)?[{title:e.title,columns:e.columns||1,fields:e.fields}]:[],[e]),P=(q,Y,Q)=>{if(!Y||Y.length===0)return q;const oe={...q||{}};let Z=oe;for(let de=0;de<Y.length;de+=1){const J=Y[de];if(de===Y.length-1)Z[J]=Q;else{const ne=Z[J],we=ne&&typeof ne=="object"&&!Array.isArray(ne)?{...ne}:{};Z[J]=we,Z=we}}return oe},G=(q,Y)=>{if(!(!Y||typeof Y!="string")&&!(!q||typeof q!="object"))return Y.includes(".")?Y.split(".").filter(Q=>Q.length>0).reduce((Q,oe)=>{if(Q!=null&&typeof Q=="object")return Q[oe]},q):q?.[Y]},H=(q,Y)=>{!q||typeof q!="string"||g(Q=>{if(!q.includes("."))return{...Q||{},[q]:Y};const oe=q.split(".").filter(Z=>Z.length>0);return oe.length===0?{...Q||{}}:P(Q,oe,Y)})},X=u.useMemo(()=>JSON.stringify(y??{}),[y]),V=u.useMemo(()=>X!==v,[X,v]),R=u.useRef(!1);u.useEffect(()=>{V||(R.current=!1)},[V]),u.useEffect(()=>{V&&w&&(N(""),C("success"))},[V,w]),u.useEffect(()=>{typeof m=="function"&&m({isDirty:V,isSubmitting:A})},[V,A,m]),Yk(f&&V,void 0,R);const I=u.useCallback(()=>{if(!z.length)return!0;const q=[];return z.forEach(Y=>{(Array.isArray(Y.fields)?Y.fields:[]).forEach(oe=>{const Z=oe?.key||oe?.name||oe?.field;if(!Z)return;const de=_.actionsByField[Z],J=oe?.visibleByDefault!==void 0?!!oe.visibleByDefault:oe?.visible_by_default!==void 0?!!oe.visible_by_default:!0;if(cc(Z,de,_.showRuleTargets,J)||!(!!oe?.required||de==="require"))return;const ne=G(y,Z);(Array.isArray(ne)?ne.length>0:ne!=null&&ne!=="")||q.push(oe.label||oe.name||Z)})}),q.length>0?(C("error"),N(`Please complete required fields: ${q.join(", ")}`),!1):!0},[z,y,_]),L=u.useCallback(async()=>{if(!r)return!0;if(!I())return!1;const q=JSON.stringify(y??{});O(!0),C("success"),N(""),R.current=!0;try{const Y=await r(y);if(Y===!1)return R.current=!1,!1;const Q=Y&&typeof Y=="object"&&!Array.isArray(Y)?Y:{};S(q);const oe=typeof Y=="string"?Y:Q.message||e?.saveSuccessMessage||"";if(oe){const Z=Q.status==="error"?"error":"success";C(Z),N(oe)}return R.current=!1,Q}catch(Y){return console.error("Failed to submit form:",Y),C("error"),N(Y.message||"Failed to save changes."),R.current=!1,!1}finally{O(!1)}},[y,r,e,I]),$=async q=>{q.preventDefault(),await L()},M=()=>{i&&(!V||window.confirm(nN))&&(S(X),R.current=!0,i())},U=async()=>{if(l)try{await l(y)&&(S(X),R.current=!0)}catch(q){console.error("Failed to delete record:",q)}},T=u.useCallback((q=t)=>{const Y=q?{...q}:{};g(Y),S(JSON.stringify(q??{})),N(""),C("success"),R.current=!1},[t]);return u.useImperativeHandle(p,()=>({submit:L,reset:T,isDirty:()=>V,isSubmitting:()=>A}),[L,T,V,A]),a.jsxs("form",{className:"record-form",onSubmit:$,children:[a.jsx("h2",{className:"form-title",children:e?.title||"Record"}),z.map((q,Y)=>a.jsxs("div",{className:"form-section",children:[q.title?a.jsx("h3",{children:q.title}):null,a.jsx("div",{className:`form-grid cols-${q.columns||1} ${(q.columns||1)>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":""}`,children:(q.fields||[]).map((Q,oe)=>{if(!Q||typeof Q!="object")return console.warn(" Skipping invalid field in schema:",Q),null;const Z=Q.key||Q.name||Q.field||`field-${oe}`,de=_.actionsByField[Z],J=Q.visibleByDefault!==void 0?!!Q.visibleByDefault:Q.visible_by_default!==void 0?!!Q.visible_by_default:!0;if(cc(Z,de,_.showRuleTargets,J))return null;const se={...Q};de==="disable"&&(se.disabled=!0),de==="require"&&(se.required=!0);const ne=Q.span||Q.colSpan||null,we=a.jsx(mf,{field:se,data:y,onChange:H,mode:"edit"},`${Z}-${oe}`);return ne&&Number.isFinite(ne)&&ne>1?a.jsx("div",{style:{gridColumn:`span ${ne}`},children:we},`${Z}-${oe}-wrapper`):we})})]},Y)),w?a.jsx("div",{className:`form-feedback ${E}`,role:E==="error"?"alert":"status",children:w}):null,c?null:a.jsxs("div",{className:"form-actions sticky-actions",role:"toolbar",children:[a.jsx("div",{className:"left-actions",children:l?a.jsx("button",{type:"button",className:"btn delete",onClick:U,disabled:A,children:e?.deleteLabel||"Delete"}):null}),a.jsxs("div",{className:"right-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:M,disabled:A,children:e?.cancelLabel||"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:A,children:e?.saveLabel||"Save"})]})]})]})}const bs=u.forwardRef(Gk),Xk="Create New World",Kk=[{title:"General",columns:2,fields:[{key:"name",label:"Name",type:"text"},{key:"system",label:"System",type:"text"}]},{title:"Entity Creation",columns:1,fields:[{key:"entity_creation_scope",label:"Who can create entities?",type:"select",options:[{value:"owner_dm",label:"World Owner & DMs"},{value:"all_players",label:"All Players (campaign scoped)"}],helpText:"When set to All Players, campaign members can only create entities scoped to their campaign."}]},{title:"Description",columns:1,fields:[{key:"description",label:"Description",type:"textarea"}]}],Wk={title:Xk,sections:Kk},uc={OWNER_DMS:"owner_dm",ALL_PLAYERS:"all_players"},Hh=[{value:uc.OWNER_DMS,label:"World Owner / DMs"},{value:uc.ALL_PLAYERS,label:"All Players (campaign scoped)"}],aN=e=>{if(!e)return Hh[0].label;const t=String(e).trim().toLowerCase(),r=Hh.find(i=>i.value===t);return r?r.label:Hh[0].label};function Zk(){const e=$n(),{token:t,sessionReady:r}=Nn(),[i,l]=u.useState([]),[c,f]=u.useState(!1),[m,h]=u.useState(null),[p,y]=u.useState(!1),g=u.useCallback(async()=>{if(t){f(!0),h(null);try{const E=await Ll();l(E?.data||E||[])}catch(E){console.error(" Failed to load worlds:",E),h(E.message)}finally{f(!1)}}},[t]);u.useEffect(()=>{r&&t&&g()},[r,t,g]);const v=[{key:"name",label:"Name"},{key:"system",label:"System"},{key:"status",label:"Status"},{key:"entity_creation_scope",label:"Entity Creation",render:E=>aN(E.entity_creation_scope)},{key:"description",label:"Description"},{key:"createdAt",label:"Created"}],S=()=>y(!0),w=()=>y(!1),N=async E=>{try{return(await PM(E)).success?(await g(),y(!1),!0):!1}catch(C){return alert(`Failed to create world: ${C.message}`),!1}};return r?t?c?a.jsx("p",{children:"Loading worlds..."}):m?a.jsxs("p",{className:"error",children:["Error: ",m]}):p?a.jsx(bs,{schema:Wk,initialData:{entity_creation_scope:uc.OWNER_DMS},onSubmit:N,onCancel:w,showUpdateAction:!1}):a.jsx(df,{data:i,columns:v,title:"Worlds",extraActions:a.jsx("button",{type:"button",className:"btn submit",onClick:S,children:"+ New"}),onRowClick:E=>e(`/worlds/${E.id}`)}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}function sN({schema:e,data:t={},onClose:r,closeLabel:i="Back",infoMessage:l}){const c=u.useMemo(()=>Array.isArray(e?.sections)&&e.sections.length>0?e.sections:Array.isArray(e?.fields)?[{title:e.title,columns:e.columns||1,fields:e.fields}]:[],[e]);return a.jsxs("div",{className:"record-form record-view",children:[a.jsx("h2",{className:"form-title",children:e?.title||"Details"}),c.map((f,m)=>a.jsxs("div",{className:"form-section",children:[f.title?a.jsx("h3",{children:f.title}):null,a.jsx("div",{className:`form-grid cols-${f.columns||1}`,children:(f.fields||[]).map((h,p)=>!h||typeof h!="object"?(console.warn(" Skipping invalid field in schema:",h),null):a.jsx(mf,{field:h,data:t,mode:"view"},`${h.key||h.name||h.field||"field"}-${p}`))})]},m)),l?a.jsx("p",{className:"record-info",children:l}):null,r?a.jsxs("div",{className:"form-actions sticky-actions view-actions",role:"toolbar",children:[a.jsx("div",{className:"left-actions","aria-hidden":"true"}),a.jsx("div",{className:"right-actions",children:a.jsx("button",{type:"button",className:"btn cancel",onClick:r,children:i})})]}):null]})}const Qk="Edit World",Jk=[{title:"General",columns:2,fields:[{key:"name",label:"Name",type:"text"},{key:"system",label:"System",type:"text"},{key:"status",label:"Status",type:"select",options:[{value:"active",label:"Active"},{value:"archived",label:"Archived"}]}]},{title:"Entity Creation",columns:1,fields:[{key:"entity_creation_scope",label:"Who can create entities?",type:"select",options:[{value:"owner_dm",label:"World Owner & DMs"},{value:"all_players",label:"All Players (campaign scoped)"}],helpText:"When set to All Players, campaign members can only create entities scoped to their campaign."}]},{title:"Description",columns:1,fields:[{key:"description",label:"Description",type:"textarea"}]},{title:"Metadata",columns:2,fields:[{key:"created_by",label:"Created By",type:"readonly"},{key:"createdAt",label:"Created Date",type:"readonly"},{key:"updatedAt",label:"Updated Date",type:"readonly"}]}],e3={title:Qk,sections:Jk},t3="World Details",n3=[{title:"General",columns:2,fields:[{name:"name",label:"Name",type:"text"},{name:"system",label:"System",type:"text"},{name:"statusLabel",label:"Status",type:"text"},{name:"entityCreationScopeLabel",label:"Entity Creation",type:"text"}]},{title:"Description",columns:1,fields:[{name:"description",label:"Description",type:"textarea"}]},{title:"Metadata",columns:2,fields:[{name:"ownerName",label:"Created By",type:"text"},{name:"createdAt",label:"Created",type:"text"},{name:"updatedAt",label:"Updated",type:"text"}]}],a3={title:t3,sections:n3},Gr=e=>{if(!e)return"";const t=e instanceof Date?e:new Date(e);if(Number.isNaN(t.getTime()))return typeof e=="string"?e:"";const r=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+1).padStart(2,"0"),l=t.getFullYear(),c=String(t.getHours()).padStart(2,"0"),f=String(t.getMinutes()).padStart(2,"0");return`${r}/${i}/${l} ${c}:${f}`};function s3(){const{id:e}=ws(),t=$n(),{user:r,token:i,sessionReady:l}=Nn(),[c,f]=u.useState(null),[m,h]=u.useState(!0),[p,y]=u.useState(null),g=u.useCallback(async()=>{try{const C=await Ll(),A=(C?.data||C||[]).find(O=>O.id===e);f(A),A||y("World not found")}catch(C){console.error(" Failed to load world:",C),y(C.message)}finally{h(!1)}},[e]);u.useEffect(()=>{l&&i&&g()},[l,i,g]);const v=async(C,A={})=>{const{stayOnPage:O=!1}=A;try{const _={name:C?.name,description:C?.description,system:C?.system,status:C?.status,entity_creation_scope:C?.entity_creation_scope},k=await VM(e,_);if(k.success){const D=k.data||{...c,..._};return f(D),O?{message:"World updated successfully."}:(t("/worlds"),!0)}return!1}catch(_){return alert(`Failed to update world: ${_.message}`),!1}},S=async()=>{if(!confirm("Delete this world?"))return!1;try{return(await YM(e)).success?(t("/worlds"),!0):!1}catch(C){return alert(`Failed to delete world: ${C.message}`),!1}},w=u.useMemo(()=>!c||!r?!1:r.role==="system_admin"?!0:c.created_by===r.id,[r,c]),N=u.useMemo(()=>c?{...c,created_by:c.creator||c.created_by}:null,[c]),E=u.useMemo(()=>{if(!c)return null;const C=c.status||"",A=C.length>0?C.charAt(0).toUpperCase()+C.slice(1):"",O=aN(c.entity_creation_scope),_=c.creator?.username||c.creator?.name||c.created_by||"";return{name:c.name||"",system:c.system||"",statusLabel:A,entityCreationScopeLabel:O,description:c.description||"",ownerName:_,createdAt:Gr(c.createdAt),updatedAt:Gr(c.updatedAt)}},[c]);return l?i?m?a.jsx("p",{children:"Loading world..."}):p?a.jsxs("p",{className:"error",children:["Error: ",p]}):c?w?a.jsx(bs,{schema:e3,initialData:N||c,onSubmit:v,onDelete:S,onCancel:()=>t("/worlds")}):a.jsx(sN,{schema:a3,data:E||{},onClose:()=>t("/worlds"),closeLabel:"Back to worlds",infoMessage:"You can view this world but only the creator or a system admin can make changes."}):a.jsx("p",{children:"World not found"}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}async function r3(e=5,t=200){for(let r=0;r<e;r++){const i=ei();if(i)return i;await new Promise(l=>setTimeout(l,t))}return null}async function Wy(){const e=await r3();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function Zy(e,t="request"){if(e.status===401)throw new Error("Unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${e.status} ${r}`)}return e.json()}async function i3(e){if(!e)throw new Error("campaignId is required");const t=await Wy(),r=new URL(`${_n}/user-campaign-roles`);r.searchParams.set("campaign_id",e);const i=await fetch(r.toString(),{headers:t});return Zy(i,"load campaign members")}async function l3(e,t){const r=await Wy(),i=await fetch(`${_n}/user-campaign-roles/${e}`,{method:"PUT",headers:r,body:JSON.stringify(t)});return Zy(i,"update campaign assignment")}async function o3(e){const t=await Wy(),r=await fetch(`${_n}/user-campaign-roles/${e}`,{method:"DELETE",headers:t});return Zy(r,"remove user from campaign")}const c3=[{label:"Dungeon Master",value:"dm"},{label:"Player",value:"player"},{label:"Observer",value:"observer"}];function u3({campaignId:e,canManage:t,onMembersChanged:r}){const[i,l]=u.useState([]),[c,f]=u.useState(!0),[m,h]=u.useState(null),p=u.useCallback(async()=>{if(e){h(null),f(!0);try{const S=(await i3(e))?.data||[];l(S)}catch(v){h(v.message)}finally{f(!1)}}},[e]);u.useEffect(()=>{p()},[p]);const y=async(v,S)=>{h(null);try{const N=(await l3(v,{role:S}))?.data;N&&l(E=>{const C=E.map(A=>A.id===N.id?N:A);return typeof r=="function"&&r(C),C})}catch(w){h(w.message)}},g=async v=>{if(confirm("Remove this user from the campaign?")){h(null);try{await o3(v),l(S=>{const w=S.filter(N=>N.id!==v);return typeof r=="function"&&r(w),w})}catch(S){h(S.message)}}};return e?a.jsx(a.Fragment,{children:a.jsxs("div",{className:"panel",children:[a.jsx("div",{className:"panel-header",children:a.jsx("h3",{children:"Campaign Members"})}),m&&a.jsx("p",{className:"error",children:m}),c?a.jsx("p",{children:"Loading members"}):i.length===0?a.jsx("p",{children:"No users associated with this campaign yet."}):a.jsxs("table",{className:"compact-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"User"}),a.jsx("th",{children:"Role"}),a.jsx("th",{children:"Added"}),t?a.jsx("th",{children:"Actions"}):null]})}),a.jsx("tbody",{children:i.map(v=>a.jsxs("tr",{children:[a.jsx("td",{children:v.user?.username||v.user?.email||v.user_id}),a.jsx("td",{children:t?a.jsx("select",{value:v.role,onChange:S=>y(v.id,S.target.value),children:c3.map(S=>a.jsx("option",{value:S.value,children:S.label},S.value))}):v.role}),a.jsx("td",{children:v.createdAt?new Date(v.createdAt).toLocaleString():""}),t?a.jsx("td",{children:a.jsx("button",{type:"button",className:"btn danger",onClick:()=>g(v.id),children:"Remove"})}):null]},v.id))})]}),t?a.jsx("p",{className:"help-text",children:"Manage who can participate through the Players list. Update roles here to promote Dungeon Masters or set observers."}):null]})}):null}const d3="New Campaign",f3=[{name:"world_id",label:"World",type:"select",optionsSource:"worlds",optionsCriteria:{owned_only:!0},required:!0},{name:"name",label:"Name",type:"text",required:!0,placeholder:"Enter campaign name"},{name:"description",label:"Description",type:"textarea",placeholder:"Brief description of the campaign world"},{name:"status",label:"Status",type:"select",options:[{label:"Draft",value:"draft"},{label:"Active",value:"active"},{label:"Completed",value:"completed"},{label:"Archived",value:"archived"}],default:"draft"}],m3="Create Campaign",h3={title:d3,fields:f3,submitLabel:m3},p3="Edit Campaign",y3=[{name:"world_id",label:"World",type:"select",optionsSource:"worlds",required:!0,readonly:!0},{name:"name",label:"Name",type:"text",required:!0},{name:"description",label:"Description",type:"textarea"},{name:"status",label:"Status",type:"select",options:[{label:"Draft",value:"draft"},{label:"Active",value:"active"},{label:"Completed",value:"completed"},{label:"Archived",value:"archived"}]},{name:"player_ids",label:"Players",type:"multiselect",optionsSource:"players",optionLabelKey:"username",optionValueKey:"id",helpText:"Players selected here can create characters in this campaign.",noOptionsMessage:"No eligible players are currently available."}],g3="Save Changes",b3="Delete Campaign",P0={title:p3,fields:y3,submitLabel:g3,deleteLabel:b3},v3="Campaign Details",x3=[{title:"Overview",columns:2,fields:[{name:"name",label:"Name",type:"text"},{name:"statusLabel",label:"Status",type:"text"},{name:"worldName",label:"World",type:"text"},{name:"ownerName",label:"Owner",type:"text"}]},{title:"Description",columns:1,fields:[{name:"description",label:"Description",type:"textarea"}]},{title:"Metadata",columns:2,fields:[{name:"createdAt",label:"Created",type:"text"},{name:"updatedAt",label:"Updated",type:"text"}]}],S3={title:v3,sections:x3};function qu({scope:e="all"}){const t=$n(),{id:r}=ws(),{user:i,token:l,sessionReady:c}=Nn(),[f,m]=u.useState([]),[h,p]=u.useState(!1),[y,g]=u.useState("list"),[v,S]=u.useState(null),[w,N]=u.useState(null),[E,C]=u.useState("details"),A=u.useMemo(()=>`/campaigns/${e}`,[e]),O=u.useCallback(J=>{if(!J)return J;const se=Array.isArray(J.members)?J.members.filter(ne=>ne.role==="player"):[];return{...J,ownerName:J.owner?.username||"",worldName:J.world?.name||"",player_ids:se.map(ne=>ne.user_id)}},[]),_=u.useCallback(async()=>{if(l){p(!0),N(null);try{const J=await jc(),ne=(J?.data||J||[]).map(we=>O(we));m(ne)}catch(J){N(J.message)}finally{p(!1)}}},[l,O]);u.useEffect(()=>{c&&l&&_()},[c,l,_]),u.useEffect(()=>{g("list"),S(null),C("details")},[e]),u.useEffect(()=>{if(!r){y!=="new"&&g("list"),S(null);return}const J=f.find(ne=>String(ne.id)===r);if(!J){h||t(A,{replace:!0});return}const se=!!i&&(i.role==="system_admin"||J.created_by===i.id);S(J),g(se?"edit":"view")},[r,f,t,A,h,y,i]),u.useEffect(()=>{C("details")},[v?.id]);const k=u.useMemo(()=>[{key:"name",label:"Name"},{key:"worldName",label:"World"},{key:"ownerName",label:"Owner"},{key:"status",label:"Status"},{key:"description",label:"Description"},{key:"createdAt",label:"Created"}],[]),D=J=>!J||!i?!1:i.role==="system_admin"||J.created_by===i.id,j=u.useMemo(()=>{if(i?.role!=="system_admin")return P0;const J=JSON.parse(JSON.stringify(P0)),se={name:"created_by",label:"Owner",type:"select",optionsSource:"users",optionLabelKey:"username",optionValueKey:"id"};if(Array.isArray(J.fields)){const ne=J.fields.findIndex(we=>we?.name==="created_by");if(ne>=0)J.fields[ne]={...J.fields[ne],...se};else{const we=Math.min(2,J.fields.length);J.fields.splice(we,0,se)}}return J},[i]),z=()=>{t(A),g("new"),S(null)},P=()=>{g("list"),S(null),t(A)},G=async J=>{try{return(await LM(J)).success?(await _(),t(A),g("list"),S(null),!0):!1}catch(se){return alert(`Failed to create campaign: ${se.message}`),!1}},H=async(J,se={})=>{const{stayOnPage:ne=!1}=se;if(!D(v))return alert("You do not have permission to update this campaign."),!1;const we={...J};Object.prototype.hasOwnProperty.call(J,"player_ids")&&(Array.isArray(J.player_ids)?we.player_ids=J.player_ids.filter(Le=>Le!=null&&Le!==""):typeof J.player_ids=="string"&&J.player_ids!==""?we.player_ids=[J.player_ids]:we.player_ids=[]);try{const Le=await OM(v.id,we);if(Le.success){const Me=O(Le.data);return m(Ae=>Ae.map(ot=>ot.id===Me.id?Me:ot)),S(Ae=>!Ae||Ae.id!==Me.id?Ae:Me),ne?{message:"Campaign updated successfully."}:(g("list"),S(null),t(A),!0)}return!1}catch(Le){return alert(`Failed to update campaign: ${Le.message}`),!1}},X=u.useCallback((J,se)=>{const ne=we=>{if(!Array.isArray(we))return{members:[],playerIds:[]};const Le=we.filter(Me=>Me.role==="player");return{members:we,playerIds:Le.map(Me=>Me.user_id)}};m(we=>we.map(Le=>{if(Le.id!==J)return Le;const{members:Me,playerIds:Ae}=ne(se);return{...Le,members:Me,player_ids:Ae}})),S(we=>{if(!we||we.id!==J)return we;const{members:Le,playerIds:Me}=ne(se);return{...we,members:Le,player_ids:Me}})},[]),V=async J=>{const se=J||v,ne=se?.id;if(!ne)return!1;if(!D(se))return alert("You do not have permission to delete this campaign."),!1;if(!confirm("Delete this campaign?"))return!1;try{return(await zM(ne)).success?(await _(),g("list"),S(null),t(A),!0):!1}catch(we){return alert(we.message),!1}},R=()=>{g("list"),S(null),t(A)},B=u.useMemo(()=>{if(!v)return null;const J=v.created_by??v.owner?.id??"",se=Array.isArray(v.members)?v.members.filter(ne=>ne.role==="player"):[];return{...v,created_by:J,player_ids:se.map(ne=>ne.user_id)}},[v]),I=u.useMemo(()=>{const J=JSON.parse(JSON.stringify(j));return Array.isArray(J.fields)?J.fields=J.fields.filter(se=>se?.name!=="player_ids"):Array.isArray(J.sections)&&(J.sections=J.sections.map(se=>({...se,fields:(se.fields||[]).filter(ne=>ne?.name!=="player_ids")})).filter(se=>se.fields&&se.fields.length>0)),J.title="Campaign Details",J},[j]),L=u.useMemo(()=>{if(!v||!Array.isArray(v.members))return[];const J=new Set;return v.members.map(se=>{const ne=se?.user_id??se?.user?.id;if(!ne)return null;const we=String(ne);if(J.has(we))return null;J.add(we);const Le=se?.user?.username||se?.user?.displayName||se?.user?.display_name||se?.user?.name||se?.user?.email||se?.display_name||we;return{value:we,label:Le}}).filter(Boolean)},[v]),$=u.useMemo(()=>{const J={title:"Campaign Membership",fields:[]},se=we=>{if(!we)return null;if(Array.isArray(we.fields)){for(const Le of we.fields)if(Le?.name==="player_ids")return Le}return null};let ne=null;if(Array.isArray(j.fields))ne=se(j);else if(Array.isArray(j.sections)){for(const we of j.sections)if(ne=se(we),ne)break}if(ne){const we=JSON.parse(JSON.stringify(ne));L.length>0&&(we.selectedOptions=L),J.fields=[we]}return J},[j,L]),M=u.useMemo(()=>B?{player_ids:B.player_ids??[]}:null,[B]),U=u.useMemo(()=>{if(!v)return null;const J=v.status||"",se=J?J.charAt(0).toUpperCase()+J.slice(1):"";return{...v,statusLabel:se,createdAt:Gr(v.createdAt),updatedAt:Gr(v.updatedAt)}},[v]),T=u.useMemo(()=>e==="my"?i?.id?f.filter(J=>J.created_by===i.id):[]:f,[f,e,i]),q=e==="my"?"My Campaigns":"All Campaigns",Y=e==="my"?"Back to my campaigns":"Back to all campaigns",Q=u.useMemo(()=>!v||!Array.isArray(v.members)||!i?.id?!1:v.members.some(J=>J?.user_id===i.id&&J?.role==="dm"),[v,i]),oe=v?`/campaigns/${v.id}/access/bulk`:"",de=e!=="my"&&!!(v&&Q)&&oe?a.jsxs("div",{className:"campaign-access-cta",children:[a.jsxs("div",{children:[a.jsx("p",{className:"campaign-access-eyebrow",children:"Campaign Tools"}),a.jsxs("h3",{children:["Manage entity access for ",v.name]}),a.jsx("p",{className:"campaign-access-copy",children:"The Campaign Access Editor keeps changes scoped to this campaigns members."})]}),a.jsx("div",{className:"campaign-access-actions",children:a.jsx(Jt,{to:oe,className:"btn outline",children:"Open Access Editor"})})]}):null;return c?l?h?a.jsx("p",{children:"Loading campaigns..."}):w?a.jsxs("p",{className:"error",children:["Error: ",w]}):y==="new"?a.jsx(bs,{schema:h3,initialData:{},onSubmit:G,onCancel:P,showUpdateAction:!1}):y==="edit"&&v&&B?a.jsxs("div",{className:"campaign-editor",children:[de,a.jsxs("div",{className:"campaign-tabs",role:"tablist","aria-label":"Campaign editor tabs",children:[a.jsx("button",{type:"button",role:"tab","aria-selected":E==="details",className:`campaign-tab${E==="details"?" is-active":""}`,onClick:()=>C("details"),children:"Details"}),a.jsx("button",{type:"button",role:"tab","aria-selected":E==="membership",className:`campaign-tab${E==="membership"?" is-active":""}`,onClick:()=>C("membership"),children:"Membership"})]}),a.jsx("div",{className:"campaign-tab-panel",role:"tabpanel",children:E==="details"?a.jsx(bs,{schema:I,initialData:B,onSubmit:H,onDelete:V,onCancel:P}):a.jsxs("div",{className:"campaign-membership",children:[a.jsx(bs,{schema:$,initialData:M,onSubmit:H,onCancel:P}),a.jsx(u3,{campaignId:v.id,canManage:D(v),onMembersChanged:J=>X(v.id,J)})]})})]}):y==="view"&&v?a.jsxs("div",{className:"campaign-view-wrapper",children:[de,a.jsx(sN,{schema:S3,data:U||{},onClose:R,closeLabel:Y,infoMessage:"You can view this campaign but only the owner or a system admin can make changes."})]}):a.jsx(df,{data:T,columns:k,title:q,extraActions:a.jsx("button",{type:"button",className:"btn submit",onClick:z,children:"+ New"}),onRowClick:J=>{S(J),g(D(J)?"edit":"view"),t(`${A}/${J.id}`)}}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const w3="New Character",N3=[{title:"Associations",columns:2,fields:[{key:"campaign_id",label:"Campaign",type:"select",optionsSource:"campaigns",required:!0,noOptionsMessage:"You do not have any campaigns available for character creation.",helpText:"Only campaigns you own or have been added to as a player are listed here."},{key:"user_id",label:"Player",type:"select",optionsSource:"users",optionLabelKey:"username",required:!0}]},{title:"Character Details",columns:2,fields:[{key:"name",label:"Name",type:"text",placeholder:"Character name",required:!0},{key:"level",label:"Level",type:"text",inputType:"number",placeholder:"1"},{key:"class",label:"Class",type:"text",placeholder:"Fighter, Wizard..."},{key:"race",label:"Race",type:"text",placeholder:"Elf, Human..."},{key:"alignment",label:"Alignment",type:"text",placeholder:"Neutral Good"},{key:"is_active",label:"Active Character",type:"checkbox"}]},{title:"Notes",columns:1,fields:[{key:"notes",label:"Notes",type:"textarea",rows:6,placeholder:"Backstory, hooks, etc."}]}],E3={title:w3,sections:N3},j3="Edit Character",_3=[{title:"Associations",columns:2,fields:[{key:"campaign_id",label:"Campaign",type:"select",optionsSource:"campaigns",required:!0},{key:"user_id",label:"Player",type:"select",optionsSource:"users",optionLabelKey:"username",required:!0}]},{title:"Character Details",columns:2,fields:[{key:"name",label:"Name",type:"text",required:!0},{key:"level",label:"Level",type:"text",inputType:"number"},{key:"class",label:"Class",type:"text"},{key:"race",label:"Race",type:"text"},{key:"alignment",label:"Alignment",type:"text"},{key:"is_active",label:"Active Character",type:"checkbox"}]},{title:"Notes",columns:1,fields:[{key:"notes",label:"Notes",type:"textarea",rows:6}]}],C3={title:j3,sections:_3},Io=(e={})=>({id:e.id,name:e.name||"",race:e.race||"",class:e.class||"",level:e.level??1,alignment:e.alignment||"",notes:e.notes||"",is_active:e.is_active??!0,campaign_id:e.campaign_id||"",user_id:e.user_id||""}),V0=(e={})=>{const t=Number(e.level);return{name:e.name,race:e.race||null,class:e.class||null,level:Number.isNaN(t)?1:t,alignment:e.alignment||null,notes:e.notes||null,is_active:!!e.is_active,campaign_id:e.campaign_id||null,user_id:e.user_id||null}};function zr({scope:e="my"}){const t=$n(),{id:r}=ws(),{token:i,sessionReady:l,user:c}=Nn(),{selectedCampaign:f,selectedCampaignId:m,setSelectedCampaignId:h}=Bn(),[p,y]=u.useState([]),[g,v]=u.useState(!1),[S,w]=u.useState(null),[N,E]=u.useState("list"),[C,A]=u.useState(null),[O,_]=u.useState(null),[k,D]=u.useState(""),j=u.useMemo(()=>`/characters/${e}`,[e]),z=u.useMemo(()=>!f||!Array.isArray(f.members)||!c?.id?!1:f.members.some(T=>T?.user_id===c.id&&T?.role==="player"),[f,c]),P=u.useMemo(()=>!f||!Array.isArray(f.members)||!c?.id?!1:f.members.some(T=>T?.user_id===c.id&&T?.role==="dm"),[f,c]),G=u.useMemo(()=>{switch(e){case"my":return"My Characters";case"others":return f?.name?`All Characters  ${f.name}`:"All Characters";case"all":return"All Characters";case"companions":return f?.name?`My Companions  ${f.name}`:"My Companions";default:return"Characters"}},[e,f]),H=e==="my"||c?.role==="system_admin";u.useEffect(()=>{e==="all"&&c&&c.role!=="system_admin"&&t("/characters/my",{replace:!0})},[e,c,t]),u.useEffect(()=>{E("list"),A(null),_(null),D("")},[e]),u.useEffect(()=>{if(!r){N!=="new"&&E("list"),A(null),_(null);return}const T=p.find(Y=>String(Y.id)===r);if(!T){g||t(j,{replace:!0});return}if(!(T.isOwned||c?.role==="system_admin")){t(j,{replace:!0});return}A(T.formValues||Io(T)),_(T.id),E("edit")},[r,p,c,t,j,g,N]);const X=u.useCallback(async()=>{if(i&&!(e==="all"&&c&&c.role!=="system_admin")){if(w(null),e==="companions"){if(!m){y([]),D("Select a campaign to view your companions. Use Go to Campaign from My Characters to set one."),v(!1);return}if(!z){y([]),D("You must be a player in the selected campaign to view companions."),v(!1);return}}if(e==="others"){if(!m){y([]),D("Select a campaign to view all characters. Use Go to Campaign from My Characters to set one."),v(!1);return}if(!P){y([]),D("You must be a DM in the selected campaign to view all characters."),v(!1);return}}D(""),v(!0);try{const T={scope:e};(e==="companions"||e==="others"||e==="my"&&m)&&(T.campaign_id=m);const q=await Ls(T),Y=(q?.data||q||[]).map(Q=>({...Q,playerName:Q.player?.username||"",campaignName:Q.campaign?.name||"",status:Q.is_active?"Active":"Inactive",formValues:Io(Q),isOwned:Q.user_id===c?.id}));y(Y)}catch(T){console.error(" Failed to load characters:",T),w(T.message)}finally{v(!1)}}},[i,e,c,m,z,P]);u.useEffect(()=>{l&&i&&X()},[l,i,X]);const V=e==="my"&&!m,R=u.useMemo(()=>[{key:"name",label:"Name"},{key:"class",label:"Class"},{key:"level",label:"Level"},{key:"race",label:"Race"},{key:"alignment",label:"Alignment"},{key:"playerName",label:"Player"},{key:"campaignName",label:"Campaign"},{key:"status",label:"Status"}],[]),B=u.useMemo(()=>V?[...R,{key:"campaignAction",label:"Actions",render:T=>T.campaign_id?a.jsx("button",{type:"button",className:"btn secondary compact",onClick:q=>{q.stopPropagation(),h(String(T.campaign_id))},children:"Go to Campaign"}):"No campaign"}]:R,[R,V,h]),I=()=>{H&&(t(j),E("new"),A(null),_(null))},L=()=>{E("list"),A(null),_(null),t(j)},$=async T=>{try{return await nR(V0(T)),E("list"),A(null),t(j),await X(),!0}catch(q){return alert(`Error creating character: ${q.message}`),!1}},M=async(T,q={})=>{const{stayOnPage:Y=!1}=q;if(!O)return!1;try{const Q=await aR(O,V0(T)),oe=Q?.data||Q||{id:O};if(await X(),Y){const Z=Io(oe&&typeof oe=="object"?oe:{...T,id:O});return A(Z),{message:"Character updated successfully."}}return E("list"),A(null),_(null),t(j),!0}catch(Q){return alert(`Error updating character: ${Q.message}`),!1}},U=async()=>{if(!O||!confirm("Delete this character?"))return!1;try{return await sR(O),E("list"),A(null),_(null),t(j),await X(),!0}catch(T){return alert(`Error deleting character: ${T.message}`),!1}};return l?i?g?a.jsx("p",{children:"Loading characters..."}):S?a.jsx("p",{className:"error",children:S}):N==="new"?a.jsx(bs,{schema:E3,initialData:{level:1,is_active:!0,user_id:c?.role==="system_admin"?"":c?.id||""},onSubmit:$,onCancel:L,showUpdateAction:!1}):N==="edit"?a.jsx(bs,{schema:C3,initialData:C||{},onSubmit:M,onCancel:L,onDelete:U}):N==="list"&&k?a.jsx("div",{className:"empty-state",children:a.jsx("p",{children:k})}):a.jsx(df,{data:p,columns:B,title:G,extraActions:H?a.jsx("button",{type:"button",className:"btn submit",onClick:I,children:"+ New"}):null,onRowClick:T=>{(T.isOwned||c?.role==="system_admin")&&(t(`${j}/${T.id}`),A(T.formValues||Io(T)),_(T.id),E("edit"))}}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}function hf(){const e=ei();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function pf(e,t="request"){if(e.status===401)throw new Error("Unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${r}`)}return e.json()}async function Qy(){const e=await fetch(`${_n}/users`,{headers:hf()});return pf(e,"fetch users")}async function A3(e){const t=await fetch(`${_n}/users`,{method:"POST",headers:hf(),body:JSON.stringify(e)});return pf(t,"create user")}async function T3(e,t){const r=await fetch(`${_n}/users/${e}`,{method:"PUT",headers:hf(),body:JSON.stringify(t)});return pf(r,"update user")}async function M3(e){const t=await fetch(`${_n}/users/${e}`,{method:"DELETE",headers:hf()});return pf(t,"delete user")}const R3="Create New User",k3=[{title:"Account Details",columns:2,fields:[{key:"username",label:"Username",type:"text",placeholder:"Enter username"},{key:"email",label:"Email",type:"text",inputType:"email",placeholder:"user@example.com"},{key:"password",label:"Password",type:"text",inputType:"password",placeholder:"Choose a secure password"},{key:"role",label:"Role",type:"select",options:[{value:"user",label:"User"},{value:"system_admin",label:"System Admin"}],default:"user"}]}],D3={title:R3,sections:k3},I3="Edit User",L3=[{title:"Account Details",columns:2,fields:[{key:"username",label:"Username",type:"text"},{key:"email",label:"Email",type:"text",inputType:"email"},{key:"role",label:"Role",type:"select",options:[{value:"user",label:"User"},{value:"system_admin",label:"System Admin"}]},{key:"password",label:"New Password",type:"text",inputType:"password",placeholder:"Leave blank to keep current password"}]}],O3={title:I3,sections:L3};function z3(){const{user:e,token:t,sessionReady:r}=Nn(),[i,l]=u.useState([]),[c,f]=u.useState(!1),[m,h]=u.useState(null),[p,y]=u.useState("list"),[g,v]=u.useState(null),S=u.useCallback(async()=>{if(!(!t||e?.role!=="system_admin")){f(!0),h(null);try{const _=await Qy();l(_?.data||_||[])}catch(_){console.error(" Failed to load users:",_),h(_.message)}finally{f(!1)}}},[t,e?.role]);u.useEffect(()=>{r&&t&&e?.role==="system_admin"&&S()},[r,t,e?.role,S]);const w=[{key:"username",label:"Username"},{key:"email",label:"Email"},{key:"role",label:"Role"},{key:"createdAt",label:"Created"}],N=()=>{v(null),y("new")},E=()=>{y("list"),v(null)},C=async _=>{try{const k={username:_.username,email:_.email,password:_.password,role:_.role||"user"};return await A3(k),y("list"),v(null),await S(),!0}catch(k){return alert(`Error creating user: ${k.message}`),!1}},A=async(_,k={})=>{const{stayOnPage:D=!1}=k;if(!g?.id)return!1;try{const j={username:_.username,email:_.email,role:_.role};_.password&&(j.password=_.password);const P=(await T3(g.id,j))?.data||{...g,...j};return await S(),D?(v(P),{message:"User updated successfully."}):(y("list"),v(null),!0)}catch(j){return alert(`Error updating user: ${j.message}`),!1}},O=async()=>{if(!g?.id||!confirm(`Delete user "${g.username}"?`))return!1;try{return await M3(g.id),y("list"),v(null),await S(),!0}catch(_){return alert(`Error deleting user: ${_.message}`),!1}};return r?t?!e||e.role!=="system_admin"?a.jsx("p",{className:"error",children:"Access denied. Admins only."}):c?a.jsx("p",{children:"Loading users..."}):m?a.jsxs("p",{className:"error",children:["Error: ",m]}):p==="new"?a.jsx(bs,{schema:D3,initialData:{},onSubmit:C,onCancel:E,showUpdateAction:!1}):p==="edit"?a.jsx(bs,{schema:O3,initialData:g||{},onSubmit:A,onCancel:E,onDelete:O}):a.jsx(df,{data:i,columns:w,title:"Users",extraActions:a.jsx("button",{type:"button",className:"btn submit",onClick:N,children:"+ New"}),onRowClick:_=>{v(_),y("edit")}}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}function $3(){const{login:e}=Nn(),t=$n(),[r,i]=u.useState(""),[l,c]=u.useState(""),[f,m]=u.useState(""),[h,p]=u.useState(!1),y=async g=>{g.preventDefault(),m(""),p(!0);try{await e(r,l)?t("/"):m("Invalid username or password")}catch{m("Login failed. Please try again.")}finally{p(!1)}};return a.jsx("div",{className:"login-page",children:a.jsxs("div",{className:"login-card",children:[a.jsx("h1",{className:"login-title",children:"GameDB"}),a.jsx("p",{className:"login-subtitle",children:"Sign in to your account"}),a.jsxs("form",{onSubmit:y,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Username"}),a.jsx("input",{type:"text",value:r,onChange:g=>i(g.target.value),placeholder:"Enter username",required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Password"}),a.jsx("input",{type:"password",value:l,onChange:g=>c(g.target.value),placeholder:"Enter password",required:!0})]}),f&&a.jsx("p",{className:"error-msg",children:f}),a.jsx("button",{type:"submit",disabled:h,children:h?"Signing in...":"Sign In"})]})]})})}const rN=e=>Mt.get(`/entity-types/${e}/fields`),F3=(e,t)=>Mt.post(`/entity-types/${e}/fields`,t),B3=(e,t)=>Mt.patch(`/entity-type-fields/${e}`,t),U3=e=>Mt.delete(`/entity-type-fields/${e}`),q3=[{value:"global",label:"Global"},{value:"selective",label:"Selective"},{value:"hidden",label:"Hidden"}],H3=[{value:"global",label:"Global"},{value:"selective",label:"Selective"},{value:"hidden",label:"Hidden"},{value:"owner_only",label:"Owner only"}],xi=(e,t)=>`${e}-${t}`;function iN({canEdit:e,accessSettings:t,accessOptions:r,accessOptionsLoading:i,accessSaving:l,onSettingChange:c,idPrefix:f="entity-access"}){const m=!e||l,h=xi(f,"read-mode"),p=xi(f,"read-campaigns"),y=xi(f,"read-users"),g=xi(f,"read-characters"),v=xi(f,"write-mode"),S=xi(f,"write-campaigns"),w=xi(f,"write-users");return a.jsxs("div",{className:"entity-access-columns",children:[a.jsxs("div",{className:"entity-access-column",children:[a.jsx("h3",{children:"Read access"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:h,children:"Visibility"}),a.jsx("select",{id:h,value:t.readMode,onChange:N=>c("readMode",N.target.value),disabled:m,children:q3.map(N=>a.jsx("option",{value:N.value,children:N.label},N.value))})]}),t.readMode==="selective"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:p,children:"Campaigns"}),a.jsx(ks,{inputId:p,selected:t.readCampaigns,options:r.campaigns||[],onChange:N=>c("readCampaigns",N),placeholder:"Select campaigns...",noOptionsMessage:i?"Loading campaigns...":"No campaigns available for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Members of selected campaigns can view this entity."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:y,children:"Users"}),a.jsx(ks,{inputId:y,selected:t.readUsers,options:r.users||[],onChange:N=>c("readUsers",N),placeholder:"Select users...",noOptionsMessage:i?"Loading users...":"No eligible users found for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Choose players who have characters in this world."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:g,children:"Characters"}),a.jsx(ks,{inputId:g,selected:t.readCharacters,options:r.characters||[],onChange:N=>c("readCharacters",N),placeholder:"Select characters...",noOptionsMessage:i?"Loading characters...":"No characters available for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Grant visibility to specific characters regardless of campaign."})]})]})]}),a.jsxs("div",{className:"entity-access-column",children:[a.jsx("h3",{children:"Write access"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:v,children:"Write"}),a.jsx("select",{id:v,value:t.writeMode,onChange:N=>c("writeMode",N.target.value),disabled:m,children:H3.map(N=>a.jsx("option",{value:N.value,children:N.label},N.value))})]}),t.writeMode==="selective"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:S,children:"Campaigns"}),a.jsx(ks,{inputId:S,selected:t.writeCampaigns,options:r.campaigns||[],onChange:N=>c("writeCampaigns",N),placeholder:"Select campaigns...",noOptionsMessage:i?"Loading campaigns...":"No campaigns available for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Dungeon Masters of these campaigns can edit this entity."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:w,children:"Users"}),a.jsx(ks,{inputId:w,selected:t.writeUsers,options:r.users||[],onChange:N=>c("writeUsers",N),placeholder:"Select users...",noOptionsMessage:i?"Loading users...":"No eligible users found for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Grant edit access to specific players with characters here."})]})]})]})]})}const Hu=e=>!e||typeof e!="string"?"":e.trim(),Y0=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[];async function lN(e){if(!e)return{campaigns:[],users:[],characters:[]};const[t,r]=await Promise.all([jc({world_id:e}),Ls({world_id:e})]),l=Y0(t).map(h=>({value:String(h.id),label:h.name||"Untitled campaign"})),c=Y0(r),f=new Map,m=new Map;return c.forEach(h=>{const p=h?.user_id||h?.player?.id;if(!p)return;const y=String(p);if(f.has(y))return;const g=h?.player||{},v=Hu(g.username),S=Hu(g.email);let w=v||S||`User ${y.slice(0,8)}`;v&&S&&v!==S&&(w=`${v} (${S})`),f.set(y,{value:y,label:w});const N=h?.id||h?.character_id;if(!N)return;const E=Hu(h.name)||"Unnamed character",C=Hu(h?.campaign?.name||h?.campaign_name||""),A=C?`${E}  ${C}`:E;m.set(String(N),{value:String(N),label:A})}),{campaigns:l,users:Array.from(f.values()),characters:Array.from(m.values())}}const Ph=(e,t,r)=>Number.isNaN(e)?t:Math.min(Math.max(e,t),r),P3=220,V3=3;function oN({src:e,size:t=P3,onCropChange:r,className:i="",zoomLabel:l="Zoom"}){const[c,f]=u.useState({width:0,height:0}),[m,h]=u.useState(1),[p,y]=u.useState({x:0,y:0}),[g,v]=u.useState(!1),S=u.useRef({x:0,y:0}),w=u.useRef(null),N=u.useRef(null);u.useEffect(()=>{if(!e){f({width:0,height:0});return}let H=!1;const X=new Image;return X.onload=()=>{H||f({width:X.naturalWidth,height:X.naturalHeight})},X.onerror=()=>{H||f({width:0,height:0})},X.src=e,()=>{H=!0}},[e]);const E=u.useMemo(()=>{if(!c.width||!c.height)return 1;const H=t/c.width,X=t/c.height;return Math.max(H,X)},[c,t]);u.useEffect(()=>{if(!c.width||!c.height)return;h(E);const H=c.width*E,X=c.height*E;y({x:(t-H)/2,y:(t-X)/2})},[c,E,t]);const C=u.useCallback((H,X=m)=>{if(!c.width||!c.height)return H;const V=c.width*X,R=c.height*X,B=Math.min(0,t-V),I=Math.max(0,t-V),L=Math.min(0,t-R),$=Math.max(0,t-R);return{x:Ph(H.x,B,I),y:Ph(H.y,L,$)}},[c,m,t]),A=H=>{if(!e)return;H.preventDefault(),N.current?.setPointerCapture?.(H.pointerId),w.current=H.pointerId,S.current={x:H.clientX,y:H.clientY},v(!0)},O=H=>{if(!g)return;H.preventDefault();const X=H.clientX-S.current.x,V=H.clientY-S.current.y;S.current={x:H.clientX,y:H.clientY},y(R=>C({x:R.x+X,y:R.y+V}))},_=u.useCallback(()=>{const H=N.current;w.current!==null&&(H?.releasePointerCapture?.(w.current),w.current=null),v(!1)},[]),k=E*V3,D=Math.max(E/50,.01),j=k-E>.001,z=H=>{const X=Ph(Number(H.target.value),E,k);h(X),y(V=>C(V,X))};u.useEffect(()=>{typeof r=="function"&&(!c.width||!c.height||!e||r({offset:p,scale:m,containerSize:t,naturalWidth:c.width,naturalHeight:c.height}))},[p,m,t,c,r,e]),u.useEffect(()=>{const H=N.current;if(!H)return;const X=()=>_(),V=()=>_();return H.addEventListener("pointerup",X),H.addEventListener("pointerleave",V),H.addEventListener("pointercancel",V),()=>{H.removeEventListener("pointerup",X),H.removeEventListener("pointerleave",V),H.removeEventListener("pointercancel",V)}},[_]);const P=c.width*m,G=c.height*m;return a.jsxs("div",{className:`image-cropper ${i}`.trim(),children:[a.jsxs("div",{className:`image-cropper__frame${g?" is-dragging":""}`,ref:N,style:{width:t,height:t},onPointerDown:A,onPointerMove:O,role:"presentation",children:[e?a.jsx("img",{src:e,alt:"Selected artwork preview",draggable:!1,style:{width:P,height:G,transform:`translate(${p.x}px, ${p.y}px)`}}):a.jsx("div",{className:"image-cropper__empty",children:"Unable to preview image"}),a.jsx("div",{className:"image-cropper__outline","aria-hidden":"true"}),a.jsx("div",{className:"image-cropper__instructions","aria-hidden":"true",children:"Drag to reposition"})]}),j?a.jsxs("label",{className:"image-cropper__zoom",children:[a.jsx("span",{children:l}),a.jsx("input",{type:"range",min:E,max:k,step:D,value:m,onChange:z})]}):a.jsx("p",{className:"image-cropper__zoom image-cropper__zoom--disabled",children:"Zoom unavailable for this image"})]})}const cN=async(e,t,r={})=>{if(!e||!t)return e;const{offset:i,scale:l,containerSize:c,naturalWidth:f,naturalHeight:m}=t;if(!i||!l||!c||!f||!m||typeof createImageBitmap!="function")return e;try{const h=await createImageBitmap(e),p=f?h.width/f:1,y=m?h.height/m:1,g=(p+y)/2||1,v=l*g,S=c/v,w=c/v,N=(0-i.x)/l*g,E=(0-i.y)/l*g,C=Math.min(Math.max(S,1),h.width),A=Math.min(Math.max(w,1),h.height),O=h.width-C,_=h.height-A,k=Math.min(Math.max(N,0),Math.max(O,0)),D=Math.min(Math.max(E,0),Math.max(_,0)),j=document.createElement("canvas");j.width=Math.round(C),j.height=Math.round(A),j.getContext("2d").drawImage(h,k,D,C,A,0,0,j.width,j.height),h.close?.();const P=r.mimeType||e.type||"image/jpeg",G=r.quality||(P==="image/png"?void 0:.92),H=await new Promise((V,R)=>{j.toBlob(B=>{B?V(B):R(new Error("Unable to crop image"))},P,G)}),X=(()=>{if(!e.name)return"cropped-image";const V=P==="image/png"?".png":".jpg";return e.name.toLowerCase().endsWith(V)?e.name:`${e.name.includes(".")?e.name.slice(0,e.name.lastIndexOf(".")):e.name}${V}`})();return new File([H],X,{type:P})}catch(h){return console.warn(" Unable to crop image, using original selection",h),e}},Y3=[{value:"hidden",label:"Hidden"},{value:"partial",label:"Partial"},{value:"visible",label:"Visible"}],G3=new Set(["image/png","image/jpeg","image/jpg"]),X3=2*1024*1024,K3=new Set(["global","selective","hidden"]),W3=new Set(["global","selective","hidden","owner_only"]),Pu=()=>({campaigns:[],users:[],characters:[]}),Vh=(e="")=>{const t=String(e||"").trim();return t?{readMode:"selective",readCampaigns:[t],readUsers:[],readCharacters:[],writeMode:"selective",writeCampaigns:[t],writeUsers:[]}:{readMode:"global",readCampaigns:[],readUsers:[],readCharacters:[],writeMode:"global",writeCampaigns:[],writeUsers:[]}},Z3=e=>Number.isFinite(e)?e>=1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:e>=1024?`${(e/1024).toFixed(1)} KB`:`${e} bytes`:"",Q3=e=>{const t=e?.options?.choices;return!Array.isArray(t)||t.length===0?[]:t.map((r,i)=>{if(r==null)return null;if(typeof r=="object"){const c=r.value??r.id??r.key??r.slug??`choice-${i}`,f=r.label??r.name??r.title??r.display??c;return c==null?null:{value:c,label:String(f??c)}}const l=String(r);return{value:l,label:l}}).filter(Boolean)},J3=e=>{if(!e)return"";if(e instanceof Date)return e.toISOString().slice(0,10);if(typeof e=="string"){const r=e.trim();if(!r)return"";if(/^\d{4}-\d{2}-\d{2}/.test(r))return r.slice(0,10);const i=new Date(r);return Number.isNaN(i.getTime())?"":i.toISOString().slice(0,10)}const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toISOString().slice(0,10)},e4=(e,t)=>{if(e==null)return"";switch(t?.dataType||t?.data_type){case"boolean":{if(typeof e=="boolean")return e?"true":"false";if(typeof e=="number")return e!==0?"true":"false";if(typeof e=="string"){const i=e.trim().toLowerCase();if(i==="true"||i==="false")return i}return""}case"number":return e===""?"":String(e);case"date":return J3(e);case"reference":{if(typeof e=="object"&&e!==null){const i=e.id??e.value??e.entity_id??e.entityId??null;if(i!=null)return String(i)}return String(e)}default:return String(e)}},t4=(e,t)=>{const r=t?.dataType||t?.data_type;if(e!=null){if(typeof e=="string"){const i=e.trim();if(r!=="boolean"&&i==="")return"";e=i}switch(r){case"number":{if(e==="")return"";const i=Number(e);return Number.isNaN(i)?e:i}case"boolean":{if(typeof e=="boolean")return e;if(typeof e=="number")return e!==0;if(typeof e=="string"){const i=e.toLowerCase();if(i==="true")return!0;if(i==="false")return!1}return e}case"reference":return typeof e=="string"?e.trim():e;default:return e}}},G0="entity-form-advanced-open",n4=e=>{if(e==null)return"";if(typeof e=="object")try{return JSON.stringify(e)}catch{return""}return String(e)},a4=e=>{const t=e.trim();if(t.length===0)return"";if(t==="true")return!0;if(t==="false")return!1;const r=t[0],i=t[t.length-1];if(r==="{"&&i==="}"||r==="["&&i==="]")try{return JSON.parse(t)}catch{return e}return e};function uN({worldId:e,entityId:t,onCancel:r,onSaved:i,formId:l="entity-form",onStateChange:c,hideActions:f=!1,selectedEntityTypeId:m="",activeView:h="details",onViewChange:p,defaultCampaignId:y=""}){const g=!!t,v=u.useRef(0),S=u.useRef(null),w=u.useRef(null),N=u.useRef(null),E=u.useRef(String(y??"")),C=u.useCallback((le="",Je="")=>(v.current+=1,{id:v.current,key:le,value:Je}),[v]),[A,O]=u.useState([]),[_,k]=u.useState(!1),[D,j]=u.useState(!1),[z,P]=u.useState(!1),[G,H]=u.useState(!1),[X,V]=u.useState(""),[R,B]=u.useState({name:"",description:"",entityTypeId:m||"",visibility:"visible"}),[I,L]=u.useState(()=>(v.current=0,[C()])),[$,M]=u.useState([]),[U,T]=u.useState({}),[q,Y]=u.useState({}),[Q,oe]=u.useState(()=>Vh(y)),[Z,de]=u.useState(()=>Pu()),[J,se]=u.useState(!1),[ne,we]=u.useState(""),Le=u.useRef(!1),[Me,Ae]=u.useState(null),[ot,ze]=u.useState(null),[nt,$e]=u.useState(null),[vt,_t]=u.useState(""),[Tt,Ct]=u.useState(""),[Be,at]=u.useState(!1),[fe,ce]=u.useState(!1),[ye,Pe]=u.useState(()=>{if(typeof window>"u")return!1;try{return window.sessionStorage?.getItem(G0)==="true"}catch(le){return console.warn(" Unable to read advanced options preference",le),!1}}),ee=u.useMemo(()=>I.some(le=>le.key.trim()!==""||le.value.trim()!==""),[I]),pe=u.useCallback(le=>{if(le&&typeof URL<"u")try{URL.revokeObjectURL(le)}catch(Je){console.warn("Unable to revoke preview URL",Je)}},[]),me=u.useCallback(()=>{ze(null),$e(null),Ct(""),_t(le=>(pe(le),"")),w.current&&(w.current.value=""),N.current&&(N.current.value="")},[pe]);u.useEffect(()=>()=>{pe(vt)},[pe,vt]);const Se=u.useCallback(le=>{const Je=le.target.files?.[0];if(Je){if(!G3.has(Je.type)){Ct("Only PNG or JPG images are allowed."),le.target.value="";return}if(Je.size>X3){Ct("Image must be smaller than 2 MB."),le.target.value="";return}Ct(""),ze(Je),$e(null),_t(ut=>(pe(ut),URL.createObjectURL(Je)))}},[pe]),Ge=u.useCallback(()=>{!t||Be||fe||D||w.current?.click()},[t,fe,Be,D]),Xe=u.useCallback(le=>{if(!le){Ae(null);return}const Je=le.imageData??le.image_data??null,ut=le.imageMimeType??le.image_mime_type??null;Ae(Je&&ut?{imageData:Je,imageMimeType:ut}:null)},[]),et=u.useCallback(async()=>{if(!t)return null;const le=await cr(t),Je=Pa(le);return Je&&Xe(Je),Je},[Xe,t]),Te=u.useCallback(async()=>{if(!(!t||!ot)){at(!0),Ct("");try{const le=nt?await cN(ot,nt):ot;await F1(t,le),await et(),me()}catch(le){Ct(le.message||"Failed to upload image")}finally{at(!1)}}},[t,ot,nt,et,me]),mt=u.useCallback(async()=>{if(!(!t||Be||fe)){Ct(""),ce(!0);try{await B1(t),await et(),me()}catch(le){Ct(le.message||"Failed to remove image")}finally{ce(!1)}}},[t,fe,Be,et,me]),Dt=u.useMemo(()=>{const le="PNG or JPG up to 2 MB.";return ot?`${le} Selected: ${ot.name} (${Z3(ot.size)})`:le},[ot]),At=ot?a.jsxs("div",{className:"entity-image-actions",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:Te,disabled:Be,children:Be?"Uploading":"Save Image"}),a.jsx("button",{type:"button",className:"btn secondary",onClick:me,disabled:Be,children:"Cancel"})]}):null,Ke=u.useCallback(le=>le.length>0?le:[C()],[C]),ct=u.useCallback(le=>{if(v.current=0,!le||typeof le!="object"||Array.isArray(le))return[C()];const Je=Object.entries(le);return Je.length===0?[C()]:Je.map(([ut,gt])=>C(ut,n4(gt)))},[C]);u.useEffect(()=>{let le=!1;return(async()=>{if(le||V(""),!e){O([]),k(!1);return}k(!0);try{const ut=await ti({worldId:e}),gt=Array.isArray(ut)?ut:Array.isArray(ut?.data)?ut.data:[];if(!le){const re=gt.map(Ze=>{const We=Ze?.id||Ze?.entity_type_id||Ze?.entityTypeId||"";return We?{id:We,name:Ze?.name||Ze?.label||Ze?.title||"Untitled"}:null}).filter(Boolean);O(re)}}catch(ut){le||(V(ut.message||"Failed to load entity types"),O([]))}finally{le||k(!1)}})(),()=>{le=!0}},[e]),u.useEffect(()=>{if(!e){B(le=>({...le,entityTypeId:""}));return}B(le=>!le.entityTypeId||A.some(ut=>ut.id===le.entityTypeId)?le:{...le,entityTypeId:""})},[e,A]),u.useEffect(()=>{let le=!1;const Je=()=>{v.current=0,B({name:"",description:"",entityTypeId:m||"",visibility:"visible"}),L([C()]),M([]),T({}),V(""),p?.("details");const gt=Vh(E.current);oe(gt),Le.current=!1,de(Pu()),we(""),Ae(null),me()};if(!g)return Je(),j(!1),S.current=null,()=>{};const ut=async()=>{j(!0),V(""),Ct("");try{const gt=await cr(t),re=Pa(gt);if(!re)throw new Error("Entity not found");if(!le){const Ze=ct(re.metadata);B({name:re.name||"",description:re.description||"",entityTypeId:re.entity_type_id||re.entityType?.id||"",visibility:re.visibility||"visible"}),L(Ke(Ze)),Xe(re),me()}}catch(gt){le||V(gt.message||"Failed to load entity")}finally{le||j(!1)}};return S.current!==t&&(Ae(null),me(),S.current=t),ut(),()=>{le=!0}},[t,g,Ke,C,ct,m,p,Xe,me]);const Rt=le=>Je=>{const{value:ut}=Je.target;B(gt=>({...gt,[le]:ut}))},Ut=(le,Je)=>ut=>{const{value:gt}=ut.target;L(re=>re.map(Ze=>Ze.id===le?{...Ze,[Je]:gt}:Ze))},Qt=()=>{L(le=>[...le,C()])},wt=le=>{L(Je=>Ke(Je.filter(ut=>ut.id!==le)))},Ft=le=>Je=>{const{value:ut}=Je.target;T(gt=>({...gt,[le]:ut}))},Ht=u.useCallback((le,Je)=>{we(""),oe(ut=>{const gt={...ut};if(le==="readMode"||le==="writeMode"){const re=typeof Je=="string"?Je.trim().toLowerCase():"global";return le==="readMode"?(gt.readMode=K3.has(re)?re:"global",gt.readMode!=="selective"&&(gt.readCampaigns=[],gt.readUsers=[],gt.readCharacters=[])):(gt.writeMode=W3.has(re)?re:"global",gt.writeMode!=="selective"&&(gt.writeCampaigns=[],gt.writeUsers=[])),gt}return["readCampaigns","readUsers","readCharacters","writeCampaigns","writeUsers"].includes(le)?(gt[le]=Array.isArray(Je)?Je.map(re=>String(re).trim()).filter(Boolean):[],gt):(gt[le]=Je,gt)})},[]);u.useEffect(()=>{Le.current=!1,de(Pu()),we("")},[e]),u.useEffect(()=>{if(g)return;const le=String(y??"");if(le===E.current)return;const Je=Vh(le);E.current=le,oe(Je)},[y,g]),u.useEffect(()=>{if(h!=="access"||!e||Le.current)return;let le=!1;return se(!0),we(""),(async()=>{try{const ut=await lN(e);if(le)return;de({campaigns:ut.campaigns??[],users:ut.users??[],characters:ut.characters??[]}),Le.current=!0}catch(ut){if(le)return;de(Pu()),we(ut.message||"Failed to load access options"),Le.current=!1}finally{le||se(!1)}})(),()=>{le=!0}},[h,e]);const kt=u.useCallback(()=>{Pe(le=>{const Je=!le;try{typeof window<"u"&&window.sessionStorage?.setItem(G0,Je?"true":"false")}catch(ut){console.warn(" Unable to persist advanced options preference",ut)}return Je})},[]),te=async le=>{if(le.preventDefault(),!e&&!g){V("A world must be selected before creating an entity.");return}const Je=R.name.trim();if(!Je){V("Name is required.");return}const ut=R.entityTypeId||m||"";if(!ut){V("Entity type is required.");return}const gt=g&&R.visibility||"visible";if(g&&!Y3.some(dt=>dt.value===gt)){V("Invalid visibility selected.");return}let re={};if(g)I.forEach(({key:dt,value:Qe})=>{const yt=dt.trim();yt&&(re[yt]=a4(Qe))});else if($.length>0){const dt={};for(const Qe of $){const yt=Qe.name,ke=U[yt],Ve=ke!=null&&(typeof ke!="string"||ke.trim()!=="");if(Qe.required&&!Ve){const ft=Qe.label||Qe.name;V(`${ft} is required.`);return}Ve&&(dt[yt]=t4(ke,Qe))}re=dt}const Ze=R.description?R.description.trim():"",We={name:Je,description:Ze,visibility:gt,metadata:re,entity_type_id:ut};try{if(H(!0),V(""),g)await Uy(t,We);else{const dt={read_access:Q.readMode,write_access:Q.writeMode,read_campaign_ids:Q.readMode==="selective"?Q.readCampaigns:[],read_user_ids:Q.readMode==="selective"?Q.readUsers:[],read_character_ids:Q.readMode==="selective"?Q.readCharacters:[],write_campaign_ids:Q.writeMode==="selective"?Q.writeCampaigns:[],write_user_ids:Q.writeMode==="selective"?Q.writeUsers:[]};await By({...We,...dt,world_id:e})}i?.(g?"edit":"create")}catch(dt){V(dt.message||"Failed to save entity")}finally{H(!1)}},be=_||D||z,ve=!g,Ue=ve&&h==="access";u.useEffect(()=>{if(p){if(!ve&&h!=="details"){p("details");return}Ue&&!e&&p("details")}},[h,ve,Ue,p,e]),u.useEffect(()=>{if(!c)return;c({mode:g?"edit":"create",saving:G,isBusy:be,submitLabel:G?"Saving...":g?"Save Changes":"Create Entity",submitDisabled:G||be,cancelDisabled:G,accessButtonVisible:ve,accessButtonDisabled:G||be||!e&&!Ue})},[c,g,G,be,ve,Ue,e]),u.useEffect(()=>{g||B(le=>({...le,entityTypeId:m||""}))},[g,m]);const it=u.useMemo(()=>g?"":R.entityTypeId?R.entityTypeId:m||"",[g,m,R.entityTypeId]);u.useEffect(()=>{if(g){M([]),T({}),Y({});return}if(!it){M([]),T({}),Y({});return}let le=!1;return(async()=>{P(!0);try{const ut=await rN(it),gt=Array.isArray(ut)?ut:Array.isArray(ut?.data)?ut.data:[];if(le)return;const re=gt.map(We=>{if(!We)return null;const dt=We.name||We.field_name;if(!dt)return null;const Qe=We.data_type||We.dataType||"text",yt=We.reference_type_id??We.referenceTypeId??We.referenceType?.id??null,ke=We.reference_type_name??We.referenceTypeName??We.referenceType?.name??"",Ve=We.reference_filter??We.referenceFilter??We.referenceFilterJson??{};return{id:We.id||dt,name:dt,label:We.label||We.name||dt,dataType:Qe,required:!!We.required,options:We.options||{},defaultValue:We.default_value??We.defaultValue??null,referenceTypeId:yt,referenceTypeName:ke,referenceFilter:Ve}}).filter(Boolean);M(re),Y({});const Ze={};re.forEach(We=>{const dt=We.defaultValue;dt!=null&&dt!==""?Ze[We.name]=e4(dt,We):Ze[We.name]=""}),T(Ze)}catch(ut){le||(V(ut.message||"Failed to load metadata fields"),M([]),T({}),Y({}))}finally{le||P(!1)}})(),()=>{le=!0}},[it,g]);const xt=u.useMemo(()=>{const le=R.entityTypeId||m||"";return le&&A.find(Je=>Je.id===le)||null},[A,R.entityTypeId,m]),ie=le=>{const Je=`metadata-field-${le.id}`,ut=U[le.name]??"",gt=!!le.required;switch(le.dataType){case"boolean":return a.jsxs("select",{id:Je,value:ut,onChange:Ft(le.name),disabled:G||z,required:gt,children:[a.jsx("option",{value:"",children:"Select..."}),a.jsx("option",{value:"true",children:"True"}),a.jsx("option",{value:"false",children:"False"})]});case"enum":{const re=Q3(le);return a.jsxs("select",{id:Je,value:ut,onChange:Ft(le.name),disabled:G||z,required:gt,children:[a.jsx("option",{value:"",children:"Select..."}),re.map(Ze=>a.jsx("option",{value:Ze.value,children:Ze.label},Ze.value))]})}case"reference":{const re=le.referenceTypeId??le.reference_type_id??null,Ze=re?String(re).trim():null,We=le.referenceTypeName||"entities",dt=typeof We=="string"&&We.trim()?We.trim():"entities",Qe=Array.isArray(le.options?.choices)?le.options.choices.map((jt,It)=>{if(jt==null)return null;if(typeof jt=="object"){const un=jt.value??jt.id??jt.key??jt.slug??`choice-${It}`;if(un==null)return null;const Kt=jt.label??jt.name??jt.title??jt.display??jt.displayName??un;return{value:String(un),label:String(Kt)}}const tn=String(jt);return{value:tn,label:tn}}).filter(Boolean):[],yt=Qe.length>0,Ve=G||z||!yt&&!!!(e&&Ze),ft=q[le.name]||"",K=!ft&&ut&&Qe.find(jt=>String(jt.value)===String(ut))?.label||"",ae=ut&&(ft||K)?{id:ut,name:ft||K}:ut,Ne=ut?String(ut):"",He=q[le.name]||K||dt,bt=jt=>{if(!jt){T(Kt=>({...Kt,[le.name]:""})),Y(Kt=>{if(!Kt[le.name])return Kt;const na={...Kt};return delete na[le.name],na});return}const It=jt.id??jt.value??jt.key??jt.slug??jt.uuid??null;if(It==null){T(Kt=>({...Kt,[le.name]:""}));return}const tn=String(It),un=jt.name??jt.label??jt.title??jt.display??jt.displayName??"";T(Kt=>({...Kt,[le.name]:tn})),Y(Kt=>({...Kt,[le.name]:un||tn}))},Nt=jt=>{if(!jt){Y(Kt=>{if(!Kt[le.name])return Kt;const na={...Kt};return delete na[le.name],na});return}const It=jt.id??jt.value??jt.key??jt.slug??jt.uuid??null;if(It==null)return;const tn=String(It),un=jt.name??jt.label??jt.title??jt.display??jt.displayName??"";Y(Kt=>Kt[le.name]===(un||tn)?Kt:{...Kt,[le.name]:un||tn})};return a.jsxs("div",{className:"reference-field-control",children:[a.jsxs("div",{className:"reference-field-input-row",children:[a.jsx(oc,{worldId:e,value:ae,allowedTypeIds:Ze&&Ze.length>0?[Ze]:[],placeholder:`Search ${dt.toLowerCase()}...`,disabled:Ve,staticOptions:Qe,onChange:bt,onResolved:Nt,required:gt}),Ne&&a.jsx(Os,{entityId:Ne,entityName:He,className:"reference-field-info-btn"})]}),!Ze&&a.jsx("p",{className:"field-hint warning",children:"Reference type configuration is missing."}),Ze&&!e&&a.jsx("p",{className:"field-hint warning",children:"Select a world to search for entities."})]})}case"number":return a.jsx("input",{id:Je,type:"number",value:ut,onChange:Ft(le.name),disabled:G||z,required:gt});case"text":return a.jsx("textarea",{id:Je,value:ut,onChange:Ft(le.name),disabled:G||z,rows:4,required:gt});case"date":return a.jsx("input",{id:Je,type:"date",value:ut,onChange:Ft(le.name),disabled:G||z,required:gt});default:return a.jsx("input",{id:Je,type:"text",value:ut,onChange:Ft(le.name),disabled:G||z,required:gt})}},_e=!g&&!!m,qe=!g&&$.length>0,ht=()=>a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-type",children:"Type *"}),_e?a.jsx("input",{id:"entity-type",type:"text",value:xt?.name||"",readOnly:!0,disabled:!0}):a.jsxs("select",{id:"entity-type",value:R.entityTypeId,onChange:Rt("entityTypeId"),disabled:G||_,required:!0,children:[a.jsx("option",{value:"",children:"Select type..."}),A.map(le=>a.jsx("option",{value:le.id,children:le.name},le.id))]})]}),pt=vt||zl(Me),Ee=R.name?`${R.name} artwork`:"Entity artwork",st=()=>a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-name",children:"Name *"}),a.jsx("input",{id:"entity-name",type:"text",value:R.name,onChange:Rt("name"),placeholder:"e.g. Waterdeep",disabled:G,required:!0,"data-autofocus":!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-description",children:"Description"}),a.jsx("textarea",{id:"entity-description",value:R.description,onChange:Rt("description"),placeholder:"Optional summary of the entity",rows:4,disabled:G})]})]});return a.jsxs("form",{id:l,className:"entity-form",onSubmit:te,children:[be?a.jsx("div",{className:"form-loading",children:"Loading..."}):a.jsx(a.Fragment,{children:Ue?a.jsxs("section",{className:"entity-card entity-access-card drawer-access-card",children:[a.jsx("h3",{className:"entity-card-title",children:"Manage access"}),a.jsx("p",{className:"entity-access-note help-text",children:"Configure who can view and edit this entity. Users with write access will automatically receive read access."}),ne&&a.jsx("div",{className:"alert error",role:"alert",children:ne}),e?a.jsx(iN,{canEdit:!G,accessSettings:Q,accessOptions:Z,accessOptionsLoading:J,accessSaving:G,onSettingChange:Ht,idPrefix:"entity-create-access"}):a.jsx("p",{className:"entity-empty-state",children:"Assign this entity to a world to configure access settings."})]}):a.jsxs(a.Fragment,{children:[g&&Me?a.jsxs("div",{className:"entity-form-image-wrapper",children:[a.jsxs("div",{className:"entity-form-image-panel","aria-live":"polite",children:[a.jsx("div",{className:`entity-image-preview ${pt?"has-image":""}`.trim(),children:pt?a.jsx("img",{src:pt,alt:Ee,loading:"lazy"}):a.jsx("div",{className:"entity-image-placeholder",children:a.jsx("p",{children:"No image"})})}),a.jsxs("div",{className:"entity-form-image-panel-actions",children:[a.jsx("button",{type:"button",className:"btn secondary",onClick:Ge,disabled:!t||Be||fe||D,children:Be?"Uploading":"Replace Image"}),a.jsx("button",{type:"button",className:"btn secondary",onClick:mt,disabled:!t||fe||Be,children:fe?"Removing":"Remove Image"})]}),At,a.jsx("input",{type:"file",ref:w,accept:"image/png,image/jpeg",onChange:Se,hidden:!0,disabled:!t||Be||fe}),a.jsx("p",{className:"entity-image-helper",children:Dt}),Tt?a.jsx("p",{className:"entity-image-status entity-image-status--error",children:Tt}):null,!Tt&&Be?a.jsx("p",{className:"entity-image-status",children:"Uploading image"}):null,!Tt&&fe?a.jsx("p",{className:"entity-image-status",children:"Removing image"}):null]}),a.jsx("div",{className:"entity-form-image-fields",children:st()})]}):st(),!g&&ht(),g&&!Me?a.jsxs("div",{className:"form-group entity-form-upload-section",children:[a.jsx("label",{htmlFor:"entity-image-upload",children:"Upload image"}),a.jsx("input",{id:"entity-image-upload",type:"file",accept:"image/png,image/jpeg",ref:N,onChange:Se,disabled:!t||Be||fe}),ot&&vt?a.jsx("div",{className:"entity-form-upload-preview",children:a.jsx(oN,{src:vt,size:220,zoomLabel:"Zoom to crop",onCropChange:$e})}):null,At,a.jsx("p",{className:"entity-image-helper",children:Dt}),Tt?a.jsx("p",{className:"entity-image-status entity-image-status--error",children:Tt}):null,!Tt&&Be?a.jsx("p",{className:"entity-image-status",children:"Uploading image"}):null,!Tt&&fe?a.jsx("p",{className:"entity-image-status",children:"Removing image"}):null]}):null,qe&&a.jsxs("div",{className:"metadata-field-section",children:[a.jsx("h3",{children:"Information"}),$.map(le=>a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`metadata-field-${le.id}`,children:[le.label,le.required?" *":""]}),ie(le)]},le.id))]}),ve&&!e&&a.jsx("p",{className:"help-text",children:"Assign a world to configure access controls."}),g&&a.jsx("div",{className:"form-two-column",children:ht()}),g&&a.jsxs("div",{className:"advanced-options",children:[a.jsxs("button",{type:"button",className:"advanced-options-toggle",onClick:kt,"aria-expanded":ye,children:[a.jsx("span",{children:"Advanced options"}),ee?a.jsx("span",{className:"advanced-indicator",children:"Metadata added"}):null,a.jsx("span",{className:"advanced-chevron","aria-hidden":"true",children:ye?"":""})]}),ye&&a.jsx("div",{className:"advanced-options-body",children:a.jsxs("div",{className:"metadata-editor",children:[a.jsxs("div",{className:"metadata-header",children:[a.jsxs("h3",{children:["Metadata ",ee?"":"(optional)"]}),a.jsx("button",{type:"button",className:"btn neutral",onClick:Qt,disabled:G,children:"Add field"})]}),a.jsx("div",{className:"metadata-list",children:I.map((le,Je)=>a.jsxs("div",{className:"metadata-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`metadata-key-${le.id}`,className:"sr-only",children:["Metadata key ",Je+1]}),a.jsx("input",{id:`metadata-key-${le.id}`,type:"text",placeholder:"Key",value:le.key,onChange:Ut(le.id,"key"),disabled:G})]}),a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`metadata-value-${le.id}`,className:"sr-only",children:["Metadata value ",Je+1]}),a.jsx("input",{id:`metadata-value-${le.id}`,type:"text",placeholder:"Value",value:le.value,onChange:Ut(le.id,"value"),disabled:G})]}),a.jsx("div",{className:"metadata-actions",children:a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>wt(le.id),disabled:G||I.length===1,title:"Remove field",children:""})})]},le.id))})]})})]})]})}),X&&a.jsx("div",{className:"form-error",role:"alert",children:X}),!f&&a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:r,disabled:G,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:G||be,children:G?"Saving...":g?"Save Changes":"Create Entity"})]})]})}const s4={visible:"badge-visible",partial:"badge-partial",hidden:"badge-hidden"},r4=new Set(["system_admin"]),X0="entityType",ns=["name","type","visibility","createdAt"],Vu=[{key:"name",label:"Name",type:"core"},{key:"type",label:"Type",type:"core"},{key:"importance",label:"Importance",type:"core"},{key:"visibility",label:"Visibility",type:"core"},{key:"createdAt",label:"Created",type:"core"},{key:"description",label:"Description",type:"core"}],Yh="user",K0="system",ml=(e="create")=>({mode:e,submitLabel:e==="edit"?"Save Changes":"Create Entity",submitDisabled:!1,cancelDisabled:!1,accessButtonVisible:!1,accessButtonDisabled:!1}),Gh=(e=[],t=[])=>e.length!==t.length?!1:e.every((r,i)=>r===t[i]),Xh=(e,t,r)=>{const i=new Set(r),l=[];if(Array.isArray(e)&&e.forEach(f=>{if(typeof f!="string")return;const m=f.trim();!m||!i.has(m)||l.includes(m)||l.push(m)}),l.length>0)return l;const c=Array.isArray(t)?t.filter(f=>typeof f=="string"&&i.has(f)):[];return c.length>0?[...c]:i.size>0?[i.values().next().value]:[]},i4=e=>{if(!e||typeof e!="object")return"";const t=e.displayValue??e.display??e.label??e.displayName??e.text??e.name??e.title??e.value??e.id??null;return t!=null?String(t).trim():""},Jy=e=>!e||typeof e!="object"?!1:Array.isArray(e)?e.some(t=>Jy(t)):Object.prototype.hasOwnProperty.call(e,"displayValue")||Object.prototype.hasOwnProperty.call(e,"display")||Object.prototype.hasOwnProperty.call(e,"label"),dN=e=>{if(e==null)return"";if(Array.isArray(e)){const t=e.map(r=>dN(r)).filter(r=>!!r);return t.length?t.join(", "):""}return typeof e=="object"?i4(e):String(e).trim()},Kh=(e,t=null)=>{if(e==null)return"";const r=t?.dataType||t?.data_type||"";if(r==="reference"||Jy(e))return dN(e)||"";if(typeof e=="boolean")return e?"Yes":"No";if(typeof e=="number")return Number.isFinite(e)?String(e):"";if(r==="number"){const c=Number(e);return Number.isFinite(c)?String(c):""}if(e instanceof Date)return e.toLocaleDateString();if(r==="date"||typeof e=="string"&&r==="text"){const c=new Date(e);if(!Number.isNaN(c.getTime()))return c.toLocaleDateString()}if(Array.isArray(e))return e.length===0?"":e.filter(c=>c!=null&&String(c).trim()!=="").map(c=>typeof c=="string"?c.trim():String(c)).join(", ");if(typeof e=="object")try{return JSON.stringify(e)}catch(c){return console.warn(" Failed to stringify metadata value",c),""}return String(e).trim()||""};function l4(){const{user:e,token:t,sessionReady:r}=Nn(),{selectedCampaign:i,selectedCampaignId:l,activeWorld:c,activeWorldId:f,selectedContextType:m,viewAsCharacterId:h,contextKey:p}=Bn(),[y,g]=z2(),v=$y(),[S,w]=u.useState([]),[N,E]=u.useState(!1),[C,A]=u.useState(""),[O,_]=u.useState(!1),[k,D]=u.useState(null),[j,z]=u.useState(""),[P,G]=u.useState(""),[H,X]=u.useState(null),[V,R]=u.useState(null),[B,I]=u.useState(!1),[L,$]=u.useState(""),[M,U]=u.useState(null),[T,q]=u.useState(null),[Y,Q]=u.useState(()=>[...ns]),[oe,Z]=u.useState(()=>[...ns]),[de,J]=u.useState(!1),[se,ne]=u.useState(""),[we,Le]=u.useState(""),[Me,Ae]=u.useState(""),[ot,ze]=u.useState(""),[nt,$e]=u.useState(()=>ml("create")),[vt,_t]=u.useState("details"),[Tt,Ct]=u.useState(!1),[Be,at]=u.useState({open:!1,columnKey:"",columnLabel:"",x:0,y:0}),[fe,ce]=u.useState(!1),[ye,Pe]=u.useState([]),ee=y.toString(),pe=f||"",me=!!pe,Se=y.get(X0)??"",Ge=!!Se,Xe=u.useRef(`entity-form-${Math.random().toString(36).slice(2)}`),et=u.useRef(`${pe}:${p}`),Te=u.useCallback((ue,je="info")=>{X({message:ue,tone:je})},[]);u.useEffect(()=>{!v||!de||J(!1)},[v,de]),u.useEffect(()=>{nt.accessButtonVisible||vt!=="details"&&_t("details")},[nt.accessButtonVisible,vt]),u.useEffect(()=>{if(!Be.open)return;const ue=()=>at({open:!1,columnKey:"",columnLabel:"",x:0,y:0});return window.addEventListener("click",ue),window.addEventListener("contextmenu",ue),()=>{window.removeEventListener("click",ue),window.removeEventListener("contextmenu",ue)}},[Be.open]),u.useEffect(()=>{if(!H)return;const ue=setTimeout(()=>X(null),3500);return()=>clearTimeout(ue)},[H]);const mt=u.useCallback(ue=>{if(!ue)return"";const je=new Date(ue);return Number.isNaN(je.getTime())?"":je.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},[]),Dt=u.useMemo(()=>!i||!e?"":i.members?.find(je=>je.user_id===e.id)?.role||"",[i,e]),At=u.useMemo(()=>{if(!c||!e?.id)return!1;const ue=c.created_by||c.creator?.id||c.owner_id||c.owner?.id||"";return ue?String(ue)===String(e.id):!1},[c,e?.id]),Ke=u.useMemo(()=>e?r4.has(e.role)?!0:pe?m==="world"?At:!!(i&&(Dt==="dm"||At)):!1:!1,[e,pe,m,i,Dt,At]),ct=c?.entity_creation_scope??"",Rt=u.useMemo(()=>!l||!i||!e||ct!==uc.ALL_PLAYERS?!1:Dt==="player",[l,i,e,ct,Dt]),Ut=Ke||Rt,Qt=e?.role==="system_admin",wt=u.useCallback(async(ue,je={})=>{if(!t)return w([]),[];const{useUnassigned:Pt=!1,viewAsCharacterId:yn=""}=je;if(Pt){if(!Qt)return w([]),A("Only system administrators can view unassigned entities"),[];E(!0),A("");try{const Vt=await IR(),En=Array.isArray(Vt)?Vt:Array.isArray(Vt?.data)?Vt.data:[];return w(En),En}catch(Vt){return console.error(" Failed to load unassigned entities",Vt),A(Vt.message||"Failed to load unassigned entities"),w([]),[]}finally{E(!1)}}const mn=ue??pe;if(!mn)return w([]),[];E(!0),A("");try{const Vt=await lc(mn,{viewAsCharacterId:yn,importance:ye.length>0?ye:void 0}),En=Array.isArray(Vt)?Vt:Array.isArray(Vt?.data)?Vt.data:[];return w(En),En}catch(Vt){return console.error(" Failed to load entities",Vt),A(Vt.message||"Failed to load entities"),w([]),[]}finally{E(!1)}},[t,pe,Qt,p]);u.useEffect(()=>{if(!t){w([]);return}if(fe){wt(null,{useUnassigned:!0});return}if(!pe){w([]);return}wt(pe,{viewAsCharacterId:h})},[pe,t,fe,wt,p,h,ye]),u.useEffect(()=>{if(fe){et.current=`${pe}:${p}`;return}const ue=`${pe}:${p}`;et.current!==ue&&(O&&(_(!1),D(null)),z(""),$e(ml("create")),A(""),X(null),et.current=ue)},[pe,p,O,fe]),u.useEffect(()=>{!Qt&&fe&&ce(!1)},[Qt,fe]),u.useEffect(()=>{fe&&O&&(_(!1),D(null),z(""),$e(ml("create")))},[fe,O]),u.useEffect(()=>{if(J(!1),ne(""),!Se||!t||!r){R(null),$(""),U(null),q(null),Q([...ns]),Z([...ns]),I(!1);return}let ue=!1;return(async()=>{I(!0),$("");try{const Pt=await nk(Se);if(ue)return;const yn=Pt?.data??Pt??{},mn=yn.data??yn,Vt=Array.isArray(mn.coreColumns)&&mn.coreColumns.length?mn.coreColumns:Vu,En=new Map(Vu.map($t=>[$t.key,$t])),Un=Vt.map($t=>{const Ln=En.get($t.key)??{};return{...Ln,...$t,type:"core",label:$t.label||Ln.label||$t.key}}),ma=Vu.filter($t=>!Un.some(Ln=>Ln.key===$t.key)),ra=[...Un,...ma],Es=(Array.isArray(mn.metadataColumns)?mn.metadataColumns:[]).filter($t=>typeof $t?.key=="string").map($t=>({key:$t.key,name:$t.name||$t.key.replace(/^metadata\./,""),label:$t.label||$t.name||$t.key.replace(/^metadata\./,""),dataType:$t.dataType||$t.data_type||"",required:!!$t.required,options:$t.options||$t.choices||{},referenceTypeId:$t.referenceTypeId||$t.reference_type_id||null,referenceTypeName:$t.referenceTypeName||$t.reference_type_name||"",referenceFilter:$t.referenceFilter||$t.reference_filter||$t.referenceFilterJson||{}})).sort(($t,Ln)=>$t.label.localeCompare(Ln.label,void 0,{sensitivity:"base"})),ge=new Set([...ra.map($t=>$t.key),...Es.map($t=>$t.key)]);ns.forEach($t=>ge.add($t));const Re=Xh(ns,ns,ge),St=mn.systemDefault?.columns,Lt=Array.isArray(St)&&St.length?Xh(St,Re,ge):[...Re],Gt=mn.userPreference?.columns,nn=Array.isArray(Gt)&&Gt.length>0,ln=nn?Xh(Gt,Lt,ge):[],Zt=nn&&ln.length?ln:Lt;R({coreColumns:ra,metadataColumns:Es}),q(Lt.length?{columns:[...Lt],updatedAt:mn.systemDefault?.updatedAt??null}:null),U(nn&&ln.length?{columns:[...ln],updatedAt:mn.userPreference?.updatedAt??null}:null),Q([...Zt]),Z([...Zt])}catch(Pt){if(ue)return;console.error(" Failed to load column configuration",Pt),$(Pt.message||"Failed to load column configuration"),R(null),U(null),q(null),Q([...ns]),Z([...ns])}finally{ue||I(!1)}})(),()=>{ue=!0}},[Se,t,r]);const Ft=u.useMemo(()=>{let ue=S;return Se&&(ue=ue.filter(je=>(je.entity_type_id||je.entityType?.id||je.entity_type?.id||"")===Se)),ye.length>0&&l&&(ue=ue.filter(je=>{const Pt=je.importance||null;return ye.includes(Pt)})),ue},[S,Se,ye,l]),Ht=u.useMemo(()=>{if(!Se)return"";const ue=S.find(je=>(je.entity_type_id||je.entityType?.id||je.entity_type?.id||"")===Se);return ue?.entityType?.name||ue?.entity_type?.name||""},[S,Se]),kt=u.useMemo(()=>{const ue=[],je=new Set,Pt=(Vt,En)=>{if(!Vt||typeof Vt!="object")return;const Un=typeof Vt.key=="string"?Vt.key.trim():"";if(!Un||je.has(Un))return;const ma=Vt.label||Vt.name||(typeof Vt.title=="string"?Vt.title:""),ra=typeof ma=="string"&&ma.trim()?ma.trim():Un;ue.push({...Vt,key:Un,label:ra,type:Vt.type||En}),je.add(Un)};return(V?.coreColumns??Vu).forEach(Vt=>Pt(Vt,"core")),(V?.metadataColumns??[]).forEach(Vt=>Pt(Vt,"metadata")),ue},[V]),te=u.useMemo(()=>{const ue=new Map;return kt.forEach(je=>{ue.set(je.key,{...je,type:je.type==="metadata"?"metadata":"core"})}),ue},[kt]),be=u.useMemo(()=>Array.from(te.keys()),[te]),ve=u.useMemo(()=>{const ue=ns.filter(je=>te.has(je));return ue.length>0?ue:be.length>0?[be[0]]:[...ns]},[be,te]),Ue=u.useMemo(()=>{if(v){const ue=[];return te.has("name")&&ue.push("name"),te.has("description")&&ue.push("description"),ue.length>0?ue:ve.filter(je=>te.has(je))}return Se?Y:ns},[v,te,ve,Se,Y]);u.useEffect(()=>{Se&&Q(ue=>{const je=ue.filter(Pt=>te.has(Pt));return je.length>0?je:ve})},[Se,te,ve]),u.useEffect(()=>{Z([...Y])},[Y]);const it=u.useMemo(()=>{const ue=Ue.map(je=>te.get(je)).filter(Boolean);return ue.length>0?ue:ve.map(je=>te.get(je)).filter(Boolean)},[Ue,te,ve]),xt=T?.columns??ve,ie=M?.columns??xt,_e=!!Se&&!Gh(oe,ie),qe=!!Se&&!Gh(oe,xt),ht=we===Yh,pt=we===K0,Ee=Gh(oe,xt),st=()=>{Z([...xt]),ne(""),Ae(""),ze("")},le=ue=>{Se&&Z(je=>je.includes(ue)?je.length===1?(ne("You must keep at least one column selected."),je):(ne(""),Me===ue&&(Ae(""),ze("")),je.filter(Pt=>Pt!==ue)):te.has(ue)?(ne(""),[...je,ue]):je)},Je=(ue,je)=>{Se&&oe.includes(ue)&&(Ae(ue),ze(""),je?.dataTransfer&&(je.dataTransfer.effectAllowed="move",je.dataTransfer.setData("text/plain",ue)))},ut=(ue,je)=>{!Me||Me===ue||oe.includes(ue)&&(je&&(je.preventDefault(),je.dataTransfer&&(je.dataTransfer.dropEffect="move")),ze(ue))},gt=ue=>{Se&&(Z(je=>{if(!Me||Me===ue)return je;const Pt=je.indexOf(Me),yn=je.indexOf(ue);if(Pt===-1||yn===-1)return je;const mn=[...je],[Vt]=mn.splice(Pt,1),En=Pt<yn?Math.max(yn-1,0):yn;return mn.splice(En,0,Vt),mn}),ze(""),Ae(""))},re=()=>{Se&&(Z(ue=>{if(!Me||!ue.includes(Me))return ue;const je=ue.filter(Pt=>Pt!==Me);return je.push(Me),je}),ze(""),Ae(""))},Ze=()=>{ze(""),Ae("")},We=()=>{Se&&(ne(""),J(ue=>{const je=!ue;return!ue&&je&&(Z([...Y]),Ae(""),ze("")),ue&&!je&&(Ae(""),ze("")),je}))},dt=()=>{J(!1),ze(""),Ae("")},Qe=async ue=>{if(Se){if(oe.length===0){ne("Please select at least one column.");return}Le(ue),ne("");try{await ak(Se,{scope:ue,columns:oe}),ue===Yh?(U({columns:[...oe],updatedAt:new Date().toISOString()}),Q([...oe]),dt(),Te("Column preference saved","success")):(q({columns:[...oe],updatedAt:new Date().toISOString()}),Q([...oe]),Te("System default updated","success"))}catch(je){console.error(" Failed to save column selection",je),ne(je.message||"Failed to save column settings")}finally{Le("")}}},yt=u.useCallback(ue=>ue?.entityType?.name||ue?.entity_type?.name||"",[]),ke=u.useCallback((ue,je)=>{if(!ue)return"";switch(je){case"name":return ue.name||"";case"type":return yt(ue);case"visibility":return ue.visibility||"visible";case"createdAt":return ue.createdAt||ue.created_at||"";case"description":return ue.description||"";default:{if(je.startsWith("metadata.")){const Pt=ue.metadata&&typeof ue.metadata=="object"?ue.metadata:{},yn=je.replace(/^metadata\./,"");return Pt?.[yn]}return ue[je]}}},[yt]),Ve=u.useCallback(ue=>{if(ue==null||ue==="")return null;if(typeof ue=="string"){const je=ue.trim();return je.length>0?je:null}if(typeof ue=="object"&&!Array.isArray(ue)){const je=ue.id??ue.value??ue.key??ue.slug??ue.uuid??null;return je!=null?String(je).trim():null}if(Array.isArray(ue)){for(const je of ue){const Pt=Ve(je);if(Pt)return Pt}return null}return null},[]),ft=u.useMemo(()=>{const ue=[];return te.forEach(je=>{const yn=(je.type==="metadata"?je.dataType||je.data_type||"string":je.dataType)||(je.key==="createdAt"?"date":"string"),mn=yn==="reference"||je.dataType&&String(je.dataType).toLowerCase()==="reference"||je.data_type&&String(je.data_type).toLowerCase()==="reference",Vt=En=>{const Un=ke(En,je.key);if(mn){const ma=Ve(Un);return ma!==null?ma:Un}return Un};ue.push({key:je.key,label:je.label||je.name||je.key,dataType:yn,accessor:Vt})}),ue},[te,ke,Ve]),K=u.useMemo(()=>new Map(ft.map(ue=>[ue.key,ue])),[ft]),ae=X1(Ft,{columns:ft}),Ne=u.useCallback(ue=>{const je=ae.groupBy?te.get(ae.groupBy):null;if(!je)return Kh(ue);if(je.key==="visibility"){const Pt=typeof ue=="string"?ue:"";return Pt?Pt.charAt(0).toUpperCase()+Pt.slice(1):"Hidden"}return je.key==="createdAt"?mt(ue):je.key==="type"?ue||"Unassigned":je.key.startsWith("metadata.")?Kh(ue,je):je.key==="name"||je.key==="description"?ue?String(ue):"":ue?String(ue):"Unassigned"},[te,ae.groupBy,mt]),He=u.useMemo(()=>ft.map(ue=>{const je=te.get(ue.key),Pt=je?.data_type||je?.dataType||ue.dataType,yn={key:ue.key,label:K.get(ue.key)?.label||ue.label||ue.key,dataType:ue.dataType,originalDataType:Pt};je?.options&&(yn.options=je.options);const mn=je?.referenceTypeId||je?.reference_type_id;mn&&(yn.referenceTypeId=mn);const Vt=je?.referenceTypeName||je?.referenceType?.name;Vt&&(yn.referenceTypeName=Vt);const En=je?.referenceFilter||je?.reference_filter;return En&&(yn.referenceFilter=En),yn}),[ft,K,te]),bt=ue=>{ue&&ae.toggleSort(ue)},Nt=(ue,je)=>{ue.preventDefault(),at({open:!0,columnKey:je.key,columnLabel:je.label||je.name||je.key,x:ue.clientX,y:ue.clientY})},jt=ue=>{ae.setGroupBy(ue),at({open:!1,columnKey:"",columnLabel:"",x:0,y:0})},It=(ue,je)=>{const Pt=je.metadata&&typeof je.metadata=="object"?je.metadata:{};switch(ue.key){case"name":const yn=l?je.importance:null,mn={critical:"",important:"",medium:""};return a.jsxs(a.Fragment,{children:[a.jsx(Jt,{to:`/entities/${je.id}`,state:{fromEntities:{search:ee}},className:"entity-name-link",children:je.name}),je.id?a.jsxs(a.Fragment,{children:["",a.jsx(Os,{entityId:je.id,entityName:je.name||"entity"})]}):null,yn&&a.jsxs(a.Fragment,{children:["",a.jsx("span",{className:"entity-importance-indicator",title:`Importance: ${yn}`,children:mn[yn]||""})]})]});case"type":return yt(je);case"visibility":{const Vt=je.visibility||"visible",En=s4[Vt]||"badge-hidden";return a.jsx("span",{className:`visibility-badge ${En}`,children:Vt.charAt(0).toUpperCase()+Vt.slice(1)})}case"createdAt":return mt(je.createdAt||je.created_at);case"description":return je.description?je.description:"";case"importance":{if(!l)return"";const Vt=je.importance;if(!Vt)return"";const En={critical:"Critical",important:"Important",medium:"Medium"},Un={critical:"#dc2626",important:"#ea580c",medium:"#6b7280"};return a.jsx("span",{className:"importance-badge",style:{"--importance-color":Un[Vt]},children:En[Vt]||Vt})}default:{if(ue.key.startsWith("metadata.")){const Vt=ue.key.replace(/^metadata\./,""),En=Pt?.[Vt],Un=Kh(En,ue);if(((ue?.dataType||ue?.data_type||"")==="reference"||Jy(En))&&En!==null&&En!==void 0){const ha=Gy(En),Es=Xy(En)||Un||"entity";if(ha)return a.jsxs(a.Fragment,{children:[Un,"",a.jsx(Os,{entityId:ha,entityName:Es})]})}return Un}return""}}},tn=()=>{_(!1),D(null),z(""),$e(ml("create")),_t("details")},un=async ue=>{tn(),fe?await wt(null,{useUnassigned:!0}):pe&&await wt(pe,{viewAsCharacterId:h}),Te(ue==="create"?"Entity created":"Entity updated","success")},Kt=async ue=>{if(!(!Ke||!ue?.id||!window.confirm(`Delete entity "${ue.name}"? This action cannot be undone.`)))try{G(ue.id),await zR(ue.id),Te("Entity deleted","success"),fe?await wt(null,{useUnassigned:!0}):pe&&await wt(pe,{viewAsCharacterId:h})}catch(Pt){console.error(" Failed to delete entity",Pt),Te(Pt.message||"Failed to delete entity","error")}finally{G("")}},na=()=>{if(fe){wt(null,{useUnassigned:!0});return}pe&&wt(pe,{viewAsCharacterId:h})},ba=()=>{!Ut||!pe||fe||(D(null),z(""),$e(ml("create")),_t("details"),_(!0))},$s=ue=>{if(!Ke||!ue?.id)return;const je=typeof ue.name=="string"?ue.name.trim():"";D(ue.id),z(je),$e(ml("edit")),_t("details"),_(!0)},va=u.useCallback(ue=>{ue&&$e(je=>({...je,...ue}))},[]),Bl=u.useMemo(()=>{if(!k)return"";const ue=S.find(Pt=>Pt.id===k);return typeof ue?.name=="string"&&ue.name.trim()||typeof j=="string"&&j.trim()||""||"Untitled entity"},[S,k,j]),fa=k?`Edit Entity: ${Bl}`:"Add Entity",os=u.useCallback(()=>{g(ue=>{const je=new URLSearchParams(ue);return je.delete(X0),je})},[g]);if(!r)return a.jsx("p",{children:"Restoring session..."});if(!t)return a.jsx("p",{children:"Authenticating..."});const ni=Ft.length>0,ai=ae.groupBy?ae.groups.some(ue=>ue.items.length>0):ae.data.length>0,cs=`entities-page${v?" entities-page--mobile":""}`,Yn=i?`${i.name}${c?.name?`  ${c.name}`:""}`:me?`World  ${c?.name||"Untitled world"}`:"";return a.jsxs("section",{className:cs,children:[a.jsx("div",{className:"entities-header",children:a.jsxs("div",{className:"entities-header-top",children:[a.jsxs("div",{className:"entities-header-left",children:[a.jsx("h1",{children:"Entities"}),fe?a.jsx("p",{className:"entities-subtitle",children:"Showing entities without a world assignment."}):me?a.jsx("p",{className:"entities-subtitle",children:Yn}):a.jsx("p",{className:"entities-subtitle",children:"Select a campaign or world you own to choose a world context."})]}),a.jsxs("div",{className:"entities-header-controls-row",children:[a.jsx(qy,{value:ae.searchTerm,onChange:ae.setSearchTerm,placeholder:"Search entities...",ariaLabel:"Search entities"}),a.jsxs("div",{className:"entities-controls",children:[Qt&&a.jsx("button",{type:"button",className:`btn secondary compact${fe?" is-active":""}`,onClick:()=>ce(ue=>!ue),"aria-pressed":fe,title:fe?"Show entities for the selected world":"Show entities that do not have a world assigned",children:"No World"}),l&&a.jsxs("div",{className:"entities-importance-filters",children:[["critical","important","medium"].map(ue=>{const je=ye.includes(ue);return a.jsx("button",{type:"button",className:`btn secondary compact importance-filter importance-${ue}${je?" is-active":""}`,onClick:()=>{Pe(Pt=>je?Pt.filter(yn=>yn!==ue):[...Pt,ue])},title:`Filter by ${ue} importance`,children:ue.charAt(0).toUpperCase()+ue.slice(1)},ue)}),ye.length>0&&a.jsx("button",{type:"button",className:"btn secondary compact importance-filter-clear",onClick:()=>Pe([]),title:"Clear importance filters",children:a.jsx(Da,{size:14})})]}),a.jsxs("div",{className:"entities-filters-refresh-group",children:[a.jsxs("button",{type:"button",className:`btn secondary compact${ae.filterActive?" is-active":""}`,onClick:()=>Ct(!0),children:[a.jsx(Jd,{size:16})," Filters"]}),a.jsx("button",{type:"button",className:"icon-btn",title:"Refresh entities",onClick:na,disabled:N||!fe&&!pe,children:a.jsx(Il,{size:16})})]}),!v&&Ge&&a.jsxs("div",{className:"entities-column-menu-wrapper",children:[a.jsxs("button",{type:"button",className:"btn secondary compact","aria-haspopup":"dialog",onClick:We,children:[a.jsx(pM,{size:16})," Columns"]}),de&&a.jsx("div",{className:"entities-column-drawer-overlay",role:"presentation",onClick:dt,children:a.jsxs("div",{className:"entities-column-drawer",role:"dialog","aria-modal":"true","aria-labelledby":"column-drawer-title",onClick:ue=>ue.stopPropagation(),children:[a.jsxs("div",{className:"entities-column-drawer-header",children:[a.jsxs("div",{children:[a.jsxs("h3",{id:"column-drawer-title",children:["Columns for ",Ht||"selected type"]}),a.jsx("p",{className:"entities-column-info",children:"Choose which fields are visible in this list. Drag the handle to reorder selected columns and save to keep your personal preference."})]}),a.jsx("button",{type:"button",className:"icon-btn",onClick:dt,title:"Close column settings",children:a.jsx(Da,{size:16})})]}),a.jsx("div",{className:"entities-column-drawer-body",children:B?a.jsx("p",{className:"entities-column-info",children:"Loading columns"}):L?a.jsx("div",{className:"alert error",role:"alert",children:L}):a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"entities-column-hint",children:"Checked columns appear in the table. Drag the grip icon to adjust their display order."}),a.jsxs("ul",{className:"entities-column-list",children:[oe.map(ue=>{const je=kt.find(mn=>mn.key===ue);if(!je)return null;const Pt=Me===ue,yn=je.type==="metadata"?"Metadata":"Core";return a.jsxs(u.Fragment,{children:[ot===ue&&a.jsx("div",{className:"drop-indicator"}),a.jsxs("li",{className:`entities-column-item${Pt?" is-dragging":""}`,draggable:!0,onDragStart:mn=>Je(ue,mn),onDragOver:mn=>ut(ue,mn),onDrop:()=>gt(ue),onDragEnd:Ze,children:[a.jsxs("div",{className:"entities-column-item-main",children:[a.jsx("input",{type:"checkbox",checked:!0,onChange:()=>le(ue)}),a.jsx("label",{className:"entities-column-name",children:je.label}),a.jsx("span",{className:"entities-column-type-badge",children:yn})]}),a.jsx("button",{type:"button",className:"entities-column-handle",draggable:!0,onDragStart:mn=>Je(ue,mn),children:a.jsx(_T,{size:18})})]})]},ue)}),Me&&ot==="__end"&&a.jsx("div",{className:"drop-indicator end"}),kt.filter(ue=>!oe.includes(ue.key)).map(ue=>{const je=ue.type==="metadata"?"Metadata":"Core";return a.jsxs("li",{className:"entities-column-item inactive",children:[a.jsxs("div",{className:"entities-column-item-main",children:[a.jsx("input",{type:"checkbox",checked:!1,onChange:()=>le(ue.key)}),a.jsx("label",{className:"entities-column-name",children:ue.label}),a.jsx("span",{className:"entities-column-type-badge",children:je})]}),a.jsx("div",{className:"entities-column-handle-placeholder"})]},ue.key)})]}),Me&&a.jsx("div",{className:`entities-column-dropzone${ot==="__end"?" is-active":""}`,onDragOver:ue=>{Me&&(ue.preventDefault(),ue.dataTransfer&&(ue.dataTransfer.dropEffect="move"),ze("__end"))},onDragLeave:()=>{ot==="__end"&&ze("")},onDrop:ue=>{ue.preventDefault(),re()},children:"Drop here to move column to the end"}),kt.every(ue=>ue.type!=="metadata")&&a.jsx("p",{className:"entities-column-empty",children:"This entity type does not have metadata fields yet."}),se&&a.jsx("p",{className:"entities-column-error",children:se})]})}),a.jsxs("div",{className:"entities-column-drawer-footer",children:[a.jsx("div",{className:"entities-column-footer-left",children:a.jsx("button",{type:"button",className:"btn secondary",onClick:st,disabled:B||Ee,children:"Use system default"})}),a.jsxs("div",{className:"entities-column-footer-right",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:()=>Qe(Yh),disabled:B||ht||!_e,children:ht?"Saving":"Save for me"}),Qt&&a.jsxs("div",{className:"entities-column-admin",children:[a.jsx("span",{className:"entities-column-admin-label",children:"System settings (admin only)"}),a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>Qe(K0),disabled:B||pt||!qe,title:"Set these columns as the default for all users",children:pt?"Saving":"Set as system default"})]})]})]})]})})]})]}),a.jsxs("button",{type:"button",className:"btn submit",onClick:ba,disabled:!Ut||!pe||N||fe,children:[a.jsx(Va,{size:18})," Add Entity"]})]})]})}),fe&&a.jsx("div",{className:"alert info",role:"status",children:"Entities listed here do not have a world assigned. Open an entity to update its world from the entity detail view."}),H&&a.jsx("div",{className:`toast-banner ${H.tone}`,role:"status",children:H.message}),C&&a.jsx("div",{className:"alert error",role:"alert",children:C}),N?a.jsx("div",{className:"empty-state",children:"Loading entities..."}):!pe&&!fe?a.jsx("div",{className:"empty-state",children:"Select a campaign to view its entities."}):ni?ai?a.jsx("div",{className:"entities-table-wrapper",children:a.jsxs("table",{className:"entities-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[it.map(ue=>{const je=ae.sortState.key===ue.key,Pt=ae.groupBy===ue.key;return a.jsx("th",{onClick:()=>bt(ue.key),onContextMenu:yn=>Nt(yn,ue),className:"sortable-header",children:a.jsxs("span",{className:"header-label",children:[ue.label,je&&a.jsx("span",{className:"sort-indicator",children:ae.sortState.direction==="asc"?"":""}),Pt&&a.jsx("span",{className:"group-indicator",children:"Grouped"})]})},ue.key)}),Ke&&a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:ae.groupBy?ae.groups.map(ue=>a.jsxs(u.Fragment,{children:[a.jsx("tr",{className:"entities-group-row",children:a.jsxs("td",{colSpan:it.length+(Ke?1:0),children:[a.jsx("button",{type:"button",className:"group-toggle",onClick:()=>ae.toggleGroupCollapse(ue.id),"aria-label":`Toggle group ${Ne(ue.value)}`,children:ae.isGroupCollapsed(ue.id)?a.jsx(Iy,{size:14}):a.jsx(Vr,{size:14})}),a.jsxs("span",{className:"entities-group-label",children:[Ne(ue.value)," ",a.jsxs("span",{className:"entities-group-count",children:["(",ue.items.length,")"]})]})]})}),!ae.isGroupCollapsed(ue.id)&&ue.items.map(je=>a.jsxs("tr",{children:[it.map(Pt=>a.jsx("td",{children:It(Pt,je)},Pt.key)),Ke&&a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>$s(je),title:"Edit entity",disabled:N,children:a.jsx(lr,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>Kt(je),title:"Delete entity",disabled:P===je.id,children:a.jsx(ua,{size:16})})]})})]},je.id))]},ue.id)):ae.data.map(ue=>a.jsxs("tr",{children:[it.map(je=>a.jsx("td",{children:It(je,ue)},je.key)),Ke&&a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>$s(ue),title:"Edit entity",disabled:N,children:a.jsx(lr,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>Kt(ue),title:"Delete entity",disabled:P===ue.id,children:a.jsx(ua,{size:16})})]})})]},ue.id))})]})}):a.jsxs("div",{className:"empty-state",children:[a.jsx("p",{className:"empty-title",children:"No entities match your filters."}),a.jsx("div",{className:"empty-actions",children:(ae.filterActive||ae.searchTerm)&&a.jsxs("div",{className:"empty-action-buttons",children:[ae.filterActive&&a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>ae.clearFilters(),children:"Clear filters"}),ae.searchTerm&&a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>ae.setSearchTerm(""),children:"Reset search"})]})})]}):a.jsx("div",{className:"empty-state",children:Ge?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"empty-title",children:"No entities of this type yet."}),a.jsx("button",{type:"button",className:"btn secondary",onClick:os,children:"View all entities"})]}):Ut?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"empty-title",children:"No entities yet."}),a.jsxs("p",{children:["Click ",a.jsx("strong",{children:"Add Entity"})," to create your first entity."]})]}):a.jsx("p",{children:"Nothing to show right now."})}),Be.open&&a.jsxs("div",{className:"column-context-menu",style:{top:Be.y,left:Be.x},role:"menu",children:[a.jsx("button",{type:"button",onClick:()=>jt(Be.columnKey),children:ae.groupBy===Be.columnKey?"Remove grouping":`Group by ${Be.columnLabel}`}),ae.groupBy&&ae.groupBy!==Be.columnKey&&a.jsx("button",{type:"button",onClick:()=>jt(""),children:"Clear grouping"})]}),a.jsx(W1,{open:Tt,onClose:()=>Ct(!1),fields:He,value:ae.filters,worldId:pe,onApply:ue=>{ae.setFilters(ue),Ct(!1)}}),a.jsx(Wr,{isOpen:O,onClose:tn,title:fa,width:420,footerActions:a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:tn,disabled:nt.cancelDisabled,children:"Cancel"}),nt.accessButtonVisible&&a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>_t(ue=>ue==="access"?"details":"access"),disabled:nt.accessButtonDisabled,children:vt==="access"?"Details":"Access"}),a.jsx("button",{type:"submit",className:"btn submit",form:Xe.current,disabled:nt.submitDisabled,children:nt.submitLabel})]}),children:a.jsx(uN,{worldId:fe?"":pe,entityId:k,onCancel:tn,onSaved:un,formId:Xe.current,onStateChange:va,hideActions:!0,selectedEntityTypeId:Ge?Se:"",activeView:vt,onViewChange:_t,defaultCampaignId:i?.id||""})})]})}function o4({tabs:e=[],activeTab:t,onChange:r}){if(!Array.isArray(e)||e.length===0)return null;const i=l=>{typeof r=="function"&&r(l)};return a.jsx("nav",{className:"tab-nav flex flex-wrap gap-2",role:"tablist",children:e.map(l=>{const{id:c,label:f}=l,m=c===t;return a.jsx("button",{type:"button",role:"tab","aria-selected":m,className:`tab-nav-button whitespace-nowrap px-3 py-2 ${m?"is-active":""}`,onClick:()=>i(c),children:f},c)})})}const c4=(e,t)=>{const r=new URLSearchParams;t&&r.set("campaignId",t);const i=r.toString(),l=i?`/entities/${e}/follow?${i}`:`/entities/${e}/follow`;return Mt.post(l)},fN=(e,t)=>{const r=new URLSearchParams;t&&r.set("campaignId",t);const i=r.toString(),l=i?`/entities/${e}/follow?${i}`:`/entities/${e}/follow`;return Mt.delete(l)},u4=e=>{const t=new URLSearchParams;e&&t.set("campaignId",e);const r=t.toString(),i=r?`/entities/followed?${r}`:"/entities/followed";return Mt.get(i)},d4=(e,t)=>{const r=new URLSearchParams;t&&r.set("campaignId",t);const i=r.toString(),l=i?`/entities/${e}/follow-status?${i}`:`/entities/${e}/follow-status`;return Mt.get(l)};function f4({entityId:e}){const{user:t}=Nn(),{selectedCampaignId:r}=Bn(),[i,l]=u.useState(!1),[c,f]=u.useState(!1),[m,h]=u.useState(!0);u.useEffect(()=>{if(!e||!r||!t?.id){h(!1);return}(async()=>{try{h(!0);const g=await d4(e,r);l(g?.following??!1)}catch(g){console.error("Failed to check follow status",g),l(!1)}finally{h(!1)}})()},[e,r,t?.id]);const p=async()=>{if(!e||!r||c||m)return;const y=!i;f(!0);try{y?await c4(e,r):await fN(e,r),l(y)}catch(g){console.error("Failed to toggle follow",g),l(!y)}finally{f(!1)}};return r?m?a.jsx("button",{type:"button",className:"entity-follow-button",disabled:!0,title:"Checking follow status...",children:a.jsx(Md,{size:18})}):a.jsx("button",{type:"button",className:`entity-follow-button ${i?"following":""}`,onClick:p,disabled:c,title:i?"Unfollow entity":"Follow entity",children:i?a.jsx(ky,{size:18}):a.jsx(Md,{size:18})}):null}function m4({entityId:e,name:t,canEdit:r,isEditing:i,onToggleEdit:l,onSave:c,isSaving:f=!1,isSaveDisabled:m=!1,isMobile:h=!1}){const p=t||"Untitled entity",y=()=>{typeof l=="function"&&l()},g=()=>{typeof c=="function"&&c()};return a.jsxs("div",{className:"entity-header flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 sm:gap-2",role:"banner",children:[a.jsx("div",{className:"entity-header-center",children:a.jsx("h1",{className:h?"entity-header-title-mobile":"",children:p})}),a.jsxs("div",{className:"entity-header-right",children:[e&&a.jsx(f4,{entityId:e}),r?a.jsxs("div",{className:"entity-header-actions",children:[i&&typeof c=="function"?a.jsx("button",{type:"button",className:"btn submit",onClick:g,disabled:m||f,children:f?"Saving":"Save"}):null,a.jsxs("button",{type:"button",className:`edit-mode-toggle ${i?"is-active":""}`,role:"switch","aria-checked":i,onClick:y,children:[a.jsx("span",{className:"edit-mode-toggle-track","aria-hidden":"true",children:a.jsx("span",{className:"edit-mode-toggle-thumb"})}),a.jsx("span",{className:"edit-mode-toggle-text",children:"Edit"})]})]}):null]})]})}const h4=[{value:"critical",label:"Critical",icon:Ha,color:"#dc2626"},{value:"important",label:"Important",icon:Oy,color:"#ea580c"},{value:"medium",label:"Medium",icon:w1,color:"#6b7280"},{value:null,label:"None",icon:Da,color:"#9ca3af"}];function p4({entityId:e,importance:t,onUpdate:r}){const{selectedCampaignId:i}=Bn(),[l,c]=u.useState(!1);if(!i)return null;const f=async m=>{if(!(l||m===t)){c(!0);try{await OR(e,m),r?.(m)}catch(h){console.error("Failed to update entity importance",h)}finally{c(!1)}}};return a.jsxs("div",{className:"entity-importance-selector",children:[a.jsx("span",{className:"entity-importance-label",children:"Importance:"}),a.jsx("div",{className:"entity-importance-buttons",children:h4.map(m=>{const h=m.icon,p=t===m.value;return a.jsxs("button",{type:"button",className:`entity-importance-button ${p?"selected":""}`,onClick:()=>f(m.value),disabled:l,title:m.label,style:p?{"--importance-color":m.color}:{},children:[a.jsx(h,{size:16}),a.jsx("span",{className:"entity-importance-button-label",children:m.label})]},m.value||"none")})})]})}var Wh={exports:{}},Zh,W0;function y4(){if(W0)return Zh;W0=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Zh=e,Zh}var Qh,Z0;function g4(){if(Z0)return Qh;Z0=1;var e=y4();function t(){}function r(){}return r.resetWarningCache=t,Qh=function(){function i(f,m,h,p,y,g){if(g!==e){var v=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw v.name="Invariant Violation",v}}i.isRequired=i;function l(){return i}var c={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:l,element:i,elementType:i,instanceOf:l,node:i,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:r,resetWarningCache:t};return c.PropTypes=c,c},Qh}var Q0;function b4(){return Q0||(Q0=1,Wh.exports=g4()()),Wh.exports}var v4=b4();const Et=Di(v4);function mN({maxWidth:e=1280,className:t="",children:r}){const l={"--entity-page-max-width":typeof e=="number"?`${e}px`:e},c=["entity-page-layout",t].filter(Boolean).join(" ");return a.jsx("div",{className:c,style:l,children:a.jsx("div",{className:"entity-page-layout__inner",children:r})})}mN.propTypes={maxWidth:Et.oneOfType([Et.number,Et.string]),className:Et.string,children:Et.node};const x4=new Set(["image/png","image/jpeg","image/jpg"]),S4=2*1024*1024,w4=e=>Number.isFinite(e)?e>=1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:e>=1024?`${(e/1024).toFixed(1)} KB`:`${e} bytes`:"";function N4({entity:e,canEdit:t,isEditing:r,onEntityUpdate:i,variant:l="card"}){const[c,f]=u.useState(null),[m,h]=u.useState(""),[p,y]=u.useState(""),[g,v]=u.useState(!1),[S,w]=u.useState(!1),N=u.useRef(null),[E,C]=u.useState(null),A=!!e?.id,O=!!(e?.imageData&&e?.imageMimeType),_=u.useMemo(()=>zl(e),[e]),k=m||_,D=e?.name?`${e.name} artwork`:"Entity artwork",j=l==="compact",z=u.useCallback(()=>{f(null),h($=>($&&URL.revokeObjectURL($),"")),C(null),y(""),N.current&&(N.current.value="")},[]);u.useEffect(()=>()=>{m&&URL.revokeObjectURL(m)},[m]),u.useEffect(()=>{!r&&c&&z()},[r,c,z]);const P=()=>{!t||!r||g||S||N.current?.click()},G=$=>{const M=$.target.files?.[0];if(M){if(!x4.has(M.type)){y("Only PNG or JPG images are allowed."),$.target.value="";return}if(M.size>S4){y("Image must be smaller than 2 MB."),$.target.value="";return}y(""),f(M),C(null),h(U=>(U&&URL.revokeObjectURL(U),URL.createObjectURL(M)))}},H=u.useCallback($=>{$&&typeof i=="function"&&i($)},[i]),X=async()=>{if(!(!c||!A)){v(!0),y("");try{const $=E?await cN(c,E):c,M=await F1(e.id,$),U=Pa(M);if(!U)throw new Error("Failed to upload image");H(U),z()}catch($){y($.message||"Failed to upload image")}finally{v(!1)}}},V=async()=>{if(A){w(!0),y("");try{const $=await B1(e.id),M=Pa($);if(M)H(M);else{const U=K1({...e||{},imageData:null,imageMimeType:null,image_data:null,image_mime_type:null});H(U)}z()}catch($){y($.message||"Failed to delete image")}finally{w(!1)}}},R=u.useMemo(()=>{const $=["PNG or JPG up to 2 MB.","Uploads are resized to 256256 JPG (~70% quality, ~150 KB)."];return c&&$.push(`Selected: ${c.name} (${w4(c.size)})`),$.join(" ")},[c]),B=j?"div":"section",I=j?"entity-image-card entity-image-card--compact":"entity-card entity-image-card",L=u.useCallback($=>{C($)},[]);return u.useEffect(()=>{c||C(null)},[c]),a.jsxs(B,{className:I,children:[a.jsxs("div",{className:"entity-card-header",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"entity-card-title",children:"Image"}),a.jsx("p",{children:j?"Shown in the dossier summary.":"Displayed on the dossier tab."})]}),t&&r?a.jsxs("div",{className:"entity-card-actions",children:[O&&!c?a.jsx("button",{type:"button",className:"btn secondary",onClick:V,disabled:S,children:S?"Removing":a.jsxs("span",{className:"entity-image-action-label",children:[a.jsx(ua,{size:16,"aria-hidden":"true"})," Remove image"]})}):null,a.jsx("button",{type:"button",className:"btn secondary",onClick:P,disabled:g||S,children:a.jsxs("span",{className:"entity-image-action-label",children:[a.jsx(jM,{size:16,"aria-hidden":"true"})," Choose image"]})})]}):null]}),a.jsxs("div",{className:"entity-card-body",children:[a.jsxs("div",{className:`entity-image-preview ${k&&!c?"has-image":""}`.trim(),children:[c&&m?a.jsx(oN,{src:m,size:220,onCropChange:L}):k?a.jsx("img",{src:k,alt:D,loading:"lazy"}):a.jsxs("div",{className:"entity-image-placeholder",children:[a.jsx(TT,{size:32,"aria-hidden":"true"}),a.jsx("p",{children:"No image uploaded"})]}),c?a.jsx("button",{type:"button",className:"entity-image-preview-clear",onClick:z,disabled:g,"aria-label":"Clear selected image",children:a.jsx(Da,{size:16,"aria-hidden":"true"})}):null]}),c&&t&&r?a.jsxs("div",{className:"entity-image-actions",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:X,disabled:g,children:g?"Uploading":"Save Image"}),a.jsx("button",{type:"button",className:"btn secondary",onClick:z,disabled:g,children:"Cancel"})]}):null,a.jsx("input",{type:"file",ref:N,accept:"image/png,image/jpeg",onChange:G,hidden:!0}),a.jsx("p",{className:"entity-image-helper",children:R}),p?a.jsx("p",{className:"entity-image-status entity-image-status--error",children:p}):null,!p&&g?a.jsx("p",{className:"entity-image-status",children:"Uploading image"}):null,!p&&S?a.jsx("p",{className:"entity-image-status",children:"Removing image"}):null]})]})}function hN({open:e,eyebrowLabel:t="Heads up",title:r="Unsaved changes",description:i="You have unsaved changes on this record.",destinationLabel:l="",saving:c=!1,onSaveAndContinue:f,onContinueWithoutSaving:m,onStay:h}){if(!e)return null;const p=l?` before continuing to ${l}`:"";return a.jsx("div",{className:"unsaved-dialog-backdrop",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"unsaved-dialog",role:"document",children:[a.jsxs("div",{className:"unsaved-dialog-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"unsaved-dialog-label",children:t}),a.jsx("h2",{children:r})]}),a.jsx("button",{type:"button",className:"icon-btn","aria-label":"Close dialog",onClick:h,children:a.jsx(Da,{size:18})})]}),a.jsxs("div",{className:"unsaved-dialog-body",children:[a.jsxs("p",{children:[i,p,"."]}),a.jsx("p",{className:"unsaved-dialog-help",children:"Choose an option below to continue."})]}),a.jsxs("div",{className:"unsaved-dialog-actions",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:f,disabled:c,children:c?"Saving":"Save and continue"}),a.jsx("button",{type:"button",className:"btn ghost",onClick:m,disabled:c,children:"Continue without saving"}),a.jsx("button",{type:"button",className:"btn cancel",onClick:h,disabled:c,children:"Stay here"})]})]})})}const Jh=()=>({relationshipTypes:{mode:"all",values:[]},relatedEntityTypes:{mode:"all",values:[]}}),E4=e=>Mt.get(`/entity-relationships?worldId=${e}`),j4=e=>Mt.get(`/entity-relationships/${e}`),_4=e=>Mt.get(`/entity-relationships/entity/${e}`),pN=e=>Mt.post("/entity-relationships",e),C4=(e,t)=>Mt.patch(`/entity-relationships/${e}`,t),A4=e=>Mt.delete(`/entity-relationships/${e}`),T4=e=>e==null?"":String(e).trim(),yf=e=>{let t={};typeof e=="string"?t={worldId:e}:e&&typeof e=="object"&&!Array.isArray(e)&&(t={...e});const r=new URLSearchParams,i=T4(t.worldId??t.world_id);i&&r.set("worldId",i);const l=r.toString(),c=l?`?${l}`:"";return Mt.get(`/entity-relationship-types${c}`)},M4=e=>Mt.get(`/entity-relationship-types/${e}`),R4=e=>Mt.post("/entity-relationship-types",e),k4=(e,t)=>Mt.patch(`/entity-relationship-types/${e}`,t),D4=e=>Mt.delete(`/entity-relationship-types/${e}`);function I4({worldId:e,onCreated:t}){const[r,i]=u.useState(""),[l,c]=u.useState(""),[f,m]=u.useState(""),[h,p]=u.useState(!1),[y,g]=u.useState(""),[v,S]=u.useState([]);u.useEffect(()=>{let N=!1;return(async()=>{if(!e){S([]);return}try{const C=await ti({worldId:e});if(!N){const A=Array.isArray(C?.data)?C.data:C;S(Array.isArray(A)?A:[])}}catch(C){N||(console.error(" Failed to load entity types",C),S([]))}})(),()=>{N=!0}},[e]);const w=async N=>{if(N.preventDefault(),!r||!l){g("Name and type are required.");return}try{p(!0),g("");const C=await By({world_id:e,name:r,description:f,entity_type_id:l,visibility:"visible"}),A=C?.data||C;t(A),i(""),c(""),m("")}catch(E){console.error(" Failed to create entity inline",E),g(E.message||"Failed to create entity")}finally{p(!1)}};return a.jsxs("form",{className:"inline-entity-creator",onSubmit:w,children:[a.jsx("h4",{children:"Create New Entity"}),y&&a.jsx("div",{className:"alert error",children:y}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Name"}),a.jsx("input",{type:"text",value:r,onChange:N=>i(N.target.value),placeholder:"Entity name..."})]}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Type"}),a.jsxs("select",{value:l,onChange:N=>c(N.target.value),children:[a.jsx("option",{value:"",children:"Select type..."}),v.map(N=>a.jsx("option",{value:N.id,children:N.name},N.id))]})]}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Description"}),a.jsx("textarea",{rows:"2",value:f,onChange:N=>m(N.target.value),placeholder:"Optional..."})]}),a.jsx("div",{className:"form-actions",children:a.jsx("button",{type:"submit",className:"btn primary",disabled:h||!e,children:h?"Creating":"Create Entity"})})]})}function yN({worldId:e,fromEntity:t=null,onCreated:r,onCancel:i,existingRelationships:l=[]}){const[c,f]=u.useState([]),[m,h]=u.useState(!0),[p,y]=u.useState(""),[g,v]=u.useState(null),[S,w]=u.useState(null),[N,E]=u.useState(""),[C,A]=u.useState(null),[O,_]=u.useState(!1);u.useEffect(()=>{e&&(h(!0),yf({worldId:e}).then(L=>{const $=Array.isArray(L?.data)?L.data:L?.data||[];f($||[])}).catch(L=>y(L.message||"Failed to load data")).finally(()=>h(!1)))},[e]),u.useEffect(()=>{if(!t||g||!t.id||!t.name)return;const L={id:t.id,name:t.name,entity_type_id:t.entity_type_id||t.entityType?.id||t.entity_type?.id,entityType:t.entityType||t.entity_type||null,typeName:t.typeName||t.entityType?.name||t.entity_type?.name};v(L)},[t]);const k=L=>{if(!L)return null;const $=L.entity_type_id||L.typeId||L.entityType?.id||L.entity_type?.id,M=L.typeName||L.entityType?.name||L.entity_type?.name;return{...L,entity_type_id:$,typeName:M}},D=L=>L?.name||L?.title||L?.displayName||"Unnamed entity",j=u.useMemo(()=>{const L=k(g),$=k(S);if(!L||!$)return[];const M=L.entity_type_id,U=$.entity_type_id;if(!M||!U)return[];const T=(q=[])=>q.map(Y=>Y.id||Y.entity_type_id||Y.entityTypeId||Y.type_id||Y.typeId||Y).map(String);return c.map(q=>{const Y=T(q.from_entity_types),Q=T(q.to_entity_types),oe=Y.includes(String(M))&&Q.includes(String(U)),Z=Y.includes(String(U))&&Q.includes(String(M));return oe||Z?{...q,_supportsDirect:oe,_supportsReverse:Z}:null}).filter(Boolean)},[c,g,S]),z=u.useMemo(()=>j.find(L=>String(L.id)===String(N)),[N,j]),P=u.useMemo(()=>z?C==="reverse"&&z._supportsReverse?"reverse":C==="direct"&&z._supportsDirect||z._supportsDirect?"direct":z._supportsReverse?"reverse":null:null,[C,z]);u.useEffect(()=>{if(!z){C!==null&&A(null);return}if(P===null){C!==null&&A(null);return}if(C===null){A(P);return}C!==P&&A(P)},[z,P,C]),u.useEffect(()=>{if(!N)return;j.some($=>String($.id)===String(N))||(E(""),A(null))},[j,N]);const G=P==="direct"?g:S,H=P==="direct"?S:g,X=D(G),V=D(H),R=z?.from_name||z?.fromName||z?.name||"relates to",B=z?.to_name||z?.toName||z?.name||"relates to",I=async()=>{if(y(""),!g||!S||!N)return y("Please select both entities and a relationship type.");if(g.id===S.id)return y("Cannot create self-relationships.");if(l.find(T=>(T.from_entity_id===g.id&&T.to_entity_id===S.id||T.from_entity_id===S.id&&T.to_entity_id===g.id)&&T.relationship_type_id===N)){y("This relationship already exists.");return}const $=P;if(!z||!$){y("Please select a valid relationship type.");return}const M=$==="direct"?g.id:S.id,U=$==="direct"?S.id:g.id;try{await pN({from_entity_id:M,to_entity_id:U,relationship_type_id:N}),r?.({from_entity_id:M,to_entity_id:U,relationship_type_id:N,__direction:$})}catch(T){T.response?.status===409||T.response?.data?.message?.toLowerCase?.().includes("duplicate")||T.message?.toLowerCase?.().includes("duplicate")||T.message?.toLowerCase?.().includes("conflict")?y("This relationship already exists."):T.response?.data?.message?y(T.response.data.message):y("Failed to create relationship."),console.warn(" Relationship create error:",T)}};return m?a.jsx("p",{children:"Loading relationship data"}):a.jsxs("div",{className:"relationship-builder-v3",children:[a.jsx("h2",{children:"Add Relationship"}),p&&a.jsx("div",{className:"alert error",children:p}),a.jsx("div",{className:"form-row",children:a.jsx(oc,{worldId:e,label:"Entity 1",value:g?.id||"",onChange:L=>{t||(v(L),E(""),A(null))},disabled:!!t})}),a.jsxs("div",{className:"form-row entity2-section",children:[a.jsx(oc,{worldId:e,label:"Entity 2",value:S?.id||"",onChange:L=>w(L)}),!O&&a.jsx("button",{type:"button",className:"btn small tertiary",onClick:()=>_(!0),style:{alignSelf:"flex-start",marginTop:"0.4rem"},children:"+ Create new entity"}),O&&a.jsx(I4,{worldId:e,onCreated:async L=>{try{const $=await cr(L.id),M=Pa($)||L;w(M)}catch{w(L)}_(!1)}})]}),g&&S&&a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Relationship Type"}),a.jsxs("select",{value:N,onChange:L=>{const $=L.target.value;if(E($),!$){A(null);return}const M=j.find(U=>String(U.id)===String($));M?._supportsDirect?A("direct"):M?._supportsReverse?A("reverse"):A(null)},children:[a.jsx("option",{value:"",children:"Select relationship type"}),j.length>0?j.map(L=>a.jsxs("option",{value:L.id,children:[L.name," (",L.from_name,"  ",L.to_name,")"]},L.id)):a.jsx("option",{disabled:!0,children:"No valid relationship types"})]})]}),g&&S&&z&&P&&a.jsxs("div",{className:"relationship-preview",children:[a.jsxs("div",{className:"preview-header",children:[a.jsx("h3",{children:"Relationship preview"}),z._supportsDirect&&z._supportsReverse&&a.jsx("button",{type:"button",className:"btn small secondary",onClick:()=>A(L=>L==="reverse"?"direct":"reverse"),children:"Swap entities"})]}),a.jsxs("p",{children:[a.jsx("strong",{children:X})," ",R," ",a.jsx("strong",{children:V})]}),a.jsxs("p",{children:[a.jsx("strong",{children:V})," ",B," ",a.jsx("strong",{children:X})]})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{className:"btn primary",disabled:!g||!S||!N,onClick:I,children:"Create Relationship"}),a.jsx("button",{className:"btn secondary",onClick:i,children:"Cancel"})]})]})}const gN=["global","selective","hidden"],L4=[...gN,"owner_only"],J0=new Set(gN),eS=new Set(L4),ep=(e,t)=>{if(typeof e!="string")return"global";const r=e.toLowerCase();return t.has(r)?r:"global"},Lo=e=>e?Array.isArray(e)?e.map(t=>t==null?"":String(t).trim()).filter(Boolean):typeof e=="string"?e.split(",").map(t=>t.trim()).filter(Boolean):[]:[],tp=()=>({campaigns:[],users:[],characters:[]});function O4(e,t,r){const i=e?.id,l=e?.world?.id||e?.world_id||"",c=u.useMemo(()=>e?{readMode:ep(e.read_access||e.readAccess,J0),readCampaigns:Lo(e.read_campaign_ids||e.readCampaignIds),readUsers:Lo(e.read_user_ids||e.readUserIds),readCharacters:Lo(e.read_character_ids||e.readCharacterIds),writeMode:ep(e.write_access||e.writeAccess,eS),writeCampaigns:Lo(e.write_campaign_ids||e.writeCampaignIds),writeUsers:Lo(e.write_user_ids||e.writeUserIds)}:{readMode:"global",readCampaigns:[],readUsers:[],readCharacters:[],writeMode:"global",writeCampaigns:[],writeUsers:[]},[e]),[f,m]=u.useState(c),[h,p]=u.useState(()=>tp()),[y,g]=u.useState(!1),[v,S]=u.useState(""),[w,N]=u.useState(!1),[E,C]=u.useState(""),[A,O]=u.useState("");u.useEffect(()=>{m(c)},[c]);const _=u.useCallback(async()=>{if(t){if(!l){p(tp()),S(""),g(!1);return}g(!0),S("");try{const P=await lN(l);p({campaigns:P.campaigns??[],users:P.users??[],characters:P.characters??[]})}catch(P){console.error(" Failed to load access options",P),p(tp()),S(P.message||"Failed to load access options")}finally{g(!1)}}},[t,l]);u.useEffect(()=>{_()},[_]);const k=u.useMemo(()=>{const P=["readMode","readCampaigns","readUsers","readCharacters","writeMode","writeCampaigns","writeUsers"],G=H=>Array.isArray(H)?H.map(X=>String(X).trim()).filter(Boolean).sort():[];return P.some(H=>{const X=f[H],V=c[H];if(Array.isArray(X)||Array.isArray(V)){const R=G(X),B=G(V);return R.length!==B.length?!0:R.some((I,L)=>I!==B[L])}return X!==V})},[f,c]),D=u.useCallback((P,G)=>{C(""),O(""),m(H=>{const X={...H};if(P==="readMode"||P==="writeMode"){const R=ep(G,P==="readMode"?J0:eS);return X[P]=R,P==="readMode"&&R!=="selective"&&(X.readCampaigns=[],X.readUsers=[],X.readCharacters=[]),P==="writeMode"&&R!=="selective"&&(X.writeCampaigns=[],X.writeUsers=[]),X}return["readCampaigns","readUsers","readCharacters","writeCampaigns","writeUsers"].includes(P)?(X[P]=Array.isArray(G)?G.map(V=>String(V).trim()).filter(Boolean):[],X):(X[P]=G,X)})},[]),j=u.useCallback(()=>{m(c),C(""),O("")},[c]),z=u.useCallback(async()=>{if(!r||!i)return!1;if(!k)return!0;C(""),O(""),N(!0);try{const P={read_access:f.readMode,write_access:f.writeMode,read_campaign_ids:f.readMode==="selective"?f.readCampaigns:[],read_user_ids:f.readMode==="selective"?f.readUsers:[],read_character_ids:f.readMode==="selective"?f.readCharacters:[],write_campaign_ids:f.writeMode==="selective"?f.writeCampaigns:[],write_user_ids:f.writeMode==="selective"?f.writeUsers:[]},G=await Uy(i,P);if(!(G?.data||G))throw new Error("Failed to save access settings");return O("Access settings saved."),!0}catch(P){return console.error(" Failed to save access settings",P),C(P.message||"Failed to save access settings"),!1}finally{N(!1)}},[r,i,f,k]);return{accessSettings:f,accessOptions:h,accessOptionsError:v,accessOptionsLoading:y,accessSaving:w,accessSaveError:E,accessSaveSuccess:A,isAccessDirty:k,handleAccessSettingChange:D,resetAccessSettings:j,handleAccessSave:z}}function z4(e){const t=u.useMemo(()=>typeof e=="function"?e:()=>!1,[e]);return i1(t)||Ni}function $4({isEditing:e,canEdit:t,formError:r,formRef:i,editSchema:l,editInitialData:c,handleUpdate:f,handleFormStateChange:m,dossierSchema:h,viewData:p,featuredImageSrc:y,renderSchemaSections:g,imageSection:v,fieldRules:S,viewRuleContext:w}){const N=Array.isArray(h?.sections)?h.sections:[],E=N[0]||null,C=N[1]||null,A=N.slice(2),O=w?.actionsByField??{},_=w?.showRuleTargets??new Set,k=(G,H)=>{if(!G)return null;const X=Number.isFinite(G.columns)?Math.max(1,Number(G.columns)):1,V=Array.isArray(G.fields)?G.fields:[];return V.length?a.jsx("div",{className:`entity-field-grid ${X>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":""}`,style:{"--entity-field-columns":X},children:V.map((R,B)=>{const I=R?.key||R?.name||R?.field||`${H}-${B}`,L=O[I],$=R.visibleByDefault!==void 0?!!R.visibleByDefault:R.visible_by_default!==void 0?!!R.visible_by_default:!0;return cc(I,L,_,$)?null:a.jsx(mf,{field:{...R},data:p,mode:"view"},`${H}-${I}`)})}):a.jsx("p",{className:"entity-empty-state",children:"No fields available."})},D=!!y&&!e,j=p?.name||"Entity",z=!!v&&e&&t,P=()=>{if(!D)return g(h,p,"dossier",w);const G={...h||{},sections:A};return a.jsxs(a.Fragment,{children:[a.jsx("section",{className:"entity-card entity-dossier-header-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:a.jsxs("div",{className:"entity-dossier-header",children:[a.jsxs("div",{className:"entity-dossier-header-content",children:[E?.title?a.jsx("h2",{className:"entity-card-title",children:E.title}):null,k(E,"dossier-summary"),C?a.jsx("div",{className:"entity-dossier-description",children:k(C,"dossier-description")}):null]}),a.jsx("div",{className:"entity-dossier-header-image sm:ml-6 sm:w-64 w-full mt-4 sm:mt-0",children:a.jsx("img",{src:y,alt:`${j} artwork`,loading:"lazy"})})]})}),g(G,p,"dossier",w)]})};return a.jsxs("div",{className:"entity-tab-content",children:[r&&a.jsx("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:a.jsx("div",{className:"alert error",role:"alert",children:r})}),e&&t?a.jsx("section",{className:"entity-card entity-card--form entity-edit-form-wrapper bg-white rounded-lg border p-4 sm:p-6 w-full",children:a.jsxs("div",{className:"entity-edit-form-container",children:[a.jsx("div",{className:"entity-edit-form-content",children:a.jsx(bs,{ref:i,schema:l,initialData:c||{},onSubmit:f,onStateChange:m,hideActions:!0,enableUnsavedPrompt:!1,fieldRules:S})}),z?a.jsx("div",{className:"entity-edit-form-image sm:ml-6 sm:w-64 w-full mt-4 sm:mt-0",children:v}):null]})}):P()]})}function F4({entity:e,toast:t,onExplore:r,canEdit:i,relationshipsLoading:l,relationshipsError:c,filteredRelationships:f,sortedRelationships:m,relationshipsEmptyMessage:h,relationshipFilters:p,relationshipFilterOptions:y,filterButtonDisabled:g,handleRelationshipFiltersChange:v,handleRelationshipFiltersReset:S,showRelationshipForm:w,setShowRelationshipForm:N,worldId:E,loadRelationships:C}){const[A,O]=u.useState(!1),_=w!==void 0?w:A,[k,D]=u.useState(!1),j=u.useRef(null);u.useEffect(()=>{if(!k)return;const L=M=>{j.current&&(j.current.contains(M.target)||D(!1))},$=M=>{M.key==="Escape"&&D(!1)};return document.addEventListener("mousedown",L),document.addEventListener("touchstart",L),document.addEventListener("keydown",$),()=>{document.removeEventListener("mousedown",L),document.removeEventListener("touchstart",L),document.removeEventListener("keydown",$)}},[k]);const z=Array.isArray(y?.relationshipTypes)?y.relationshipTypes:[],P=Array.isArray(y?.relatedEntityTypes)?y.relatedEntityTypes:[],G=p?.relationshipTypes?.values||[],H=p?.relatedEntityTypes?.values||[],X=L=>{const $=Array.from(L.target.selectedOptions,M=>M.value);v&&v({relationshipTypes:{mode:$.length>0?"include":"all",values:$},relatedEntityTypes:p?.relatedEntityTypes||{mode:"all",values:[]}})},V=L=>{const $=Array.from(L.target.selectedOptions,M=>M.value);v&&v({relationshipTypes:p?.relationshipTypes||{mode:"all",values:[]},relatedEntityTypes:{mode:$.length>0?"include":"all",values:$}})},R=()=>{S&&S(),D(!1)},B=()=>{D(!1)},I=G.length>0||H.length>0;return a.jsxs(a.Fragment,{children:[t&&a.jsxs("div",{className:`toast-banner ${t.tone}`,role:"status",children:[a.jsx("span",{children:t.message}),t.link?a.jsx(Jt,{to:t.link.to,className:"toast-banner-link",children:t.link.label}):null]}),a.jsxs("div",{className:"bg-white border border-neutral-200 rounded-xl shadow-sm p-6 mb-6 w-full",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Relationships"}),a.jsxs("div",{className:"flex items-center gap-2",children:[typeof r=="function"?a.jsx("button",{type:"button",className:"btn-secondary",onClick:r,children:"Explore"}):null,a.jsxs("div",{className:"relative",ref:j,children:[a.jsx("button",{id:"filterButton",type:"button",className:`btn-secondary${I?" is-active":""}`,onClick:()=>D(L=>!L),disabled:g,children:"Filter"}),k&&!g?a.jsxs("div",{className:"bg-white border border-neutral-200 rounded-lg shadow-lg p-4 w-[260px] absolute top-full mt-2 right-0 z-10",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"text-sm font-medium text-neutral-700 mb-1 block",children:"Relationship Types"}),a.jsx("select",{className:"w-full border border-neutral-300 rounded-md px-3 py-1 text-sm",multiple:!0,size:5,value:G,onChange:X,children:z.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"text-sm font-medium text-neutral-700 mb-1 block",children:"Related Entity Types"}),a.jsx("select",{className:"w-full border border-neutral-300 rounded-md px-3 py-1 text-sm",multiple:!0,size:5,value:H,onChange:V,children:P.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))})]}),a.jsxs("div",{className:"flex items-center justify-between mt-2",children:[a.jsx("button",{type:"button",className:"text-sm text-neutral-600 hover:text-neutral-900",onClick:R,children:"Clear filters"}),a.jsx("button",{type:"button",className:"btn-secondary text-sm",onClick:B,children:"Done"})]})]}):null]}),i&&a.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{N&&N(!0),w===void 0&&O(!0)},children:"Add relationship"})]})]}),l?a.jsx("p",{children:"Loading relationships..."}):c?a.jsx("div",{className:"alert error",role:"alert",children:c}):m.length===0?a.jsx("p",{className:"text-sm text-neutral-500",children:h}):f.length===0?a.jsx("p",{className:"text-sm text-neutral-500",children:"No relationships match your filters."}):a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-left text-neutral-600 border-b border-neutral-200",children:[a.jsx("th",{className:"py-2 font-medium",children:"Relationship"}),a.jsx("th",{className:"py-2 font-medium",children:"Type"}),a.jsx("th",{className:"py-2 font-medium",children:"Direction"})]})}),a.jsx("tbody",{children:f.map(L=>{const $=String(L.fromId)===String(e.id),M=$?L.toName:L.fromName,U=$?L.toId:L.fromId,T=L.sourceLabel||L.source_relationship_label||"",q=L.targetLabel||L.target_relationship_label||"";return a.jsxs("tr",{className:"border-b border-neutral-100 last:border-0",children:[a.jsxs("td",{className:"py-3",children:[a.jsx("strong",{children:e.name})," ",$?T:q," ",a.jsx(Jt,{to:`/entities/${U}`,className:"text-blue-600 hover:underline",children:M||""}),U?a.jsx(Os,{entityId:U,entityName:M}):null]}),a.jsx("td",{className:"py-3",children:L.typeName||""}),a.jsx("td",{className:"py-3",children:$?"Outgoing":"Incoming"})]},L.id)})})]})]}),E&&e?a.jsx(Wr,{isOpen:_,onClose:()=>{N?N(!1):O(!1)},title:"Add relationship",description:"Link this entity to others without leaving the page.",size:"md",children:a.jsx(yN,{worldId:E,fromEntity:e,onCreated:()=>{N?N(!1):O(!1),C&&C()},onCancel:()=>{N?N(!1):O(!1)}})}):null]})}function B4({canEdit:e,worldId:t,accessSettings:r,accessOptions:i,accessOptionsError:l,accessOptionsLoading:c,accessSaving:f,accessSaveError:m,accessSaveSuccess:h,handleAccessSettingChange:p}){return a.jsx("div",{className:"entity-tab-content",children:a.jsxs("section",{className:"entity-card entity-access-card",children:[a.jsx("h2",{className:"entity-card-title",children:"Access controls"}),a.jsx("p",{className:"entity-access-note help-text",children:"Configure who can view and edit this entity. Users with write access will automatically receive read access. Changes are saved along with the rest of the record."}),l&&a.jsx("div",{className:"alert error",role:"alert",children:l}),t?a.jsxs(a.Fragment,{children:[a.jsx(iN,{canEdit:e,accessSettings:r,accessOptions:i,accessOptionsLoading:c,accessSaving:f,onSettingChange:p}),a.jsxs("div",{className:"entity-access-actions",children:[m&&a.jsx("div",{className:"alert error",role:"alert",children:m}),h&&a.jsx("div",{className:"alert success",role:"status",children:h})]})]}):a.jsx("p",{className:"entity-empty-state",children:"Assign this entity to a world to configure access settings."})]})})}function U4({renderSchemaSections:e,systemSchema:t,viewData:r}){return a.jsx("div",{className:"entity-tab-content",children:e(t,r,"system")})}const tS=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})},Yu=e=>{if(!e)return"";const t=e.username?.trim?.()||"",r=e.email?.trim?.()||"";return t&&r&&t!==r?`${t} (${r})`:t||r||"Unknown user"},q4=e=>Array.isArray(e)?e.filter(t=>t&&typeof t=="object").map(t=>({...t})):[],np=(e,t)=>{const r=new Set,i=[];return e.forEach(l=>{if(!l)return;let c=l[t];if(c||(t==="user_id"?c=l.user?.id:t==="campaign_id"&&(c=l.campaign?.id)),!c)return;const f=String(c);r.has(f)||(r.add(f),i.push(l))}),i},nS=(e,t)=>{if(!e)return[];const r=Array.isArray(e.permissions)?e.permissions:[],i=new Set,l=[];return r.forEach(c=>{if(!c)return;let f=c[t];if(f||(t==="user_id"?f=c.user?.id:t==="campaign_id"&&(f=c.campaign?.id)),!f)return;const m=String(f);i.has(m)||(i.add(m),l.push(m))}),l};function H4({entity:e,secrets:t,worldId:r,canManageSecrets:i,onSecretCreated:l,onSecretUpdated:c}){const[f,m]=u.useState(""),[h,p]=u.useState(""),[y,g]=u.useState([]),[v,S]=u.useState([]),[w,N]=u.useState({campaigns:[],users:[]}),[E,C]=u.useState(!1),[A,O]=u.useState(""),[_,k]=u.useState(!1),[D,j]=u.useState(!1),[z,P]=u.useState(""),[G,H]=u.useState(""),[X,V]=u.useState(!1),[R,B]=u.useState(null),I=u.useMemo(()=>!!R?.id,[R?.id]),L=u.useMemo(()=>`entity-secret-create-${e?.id||"new"}`,[e?.id]),$=u.useMemo(()=>q4(t),[t]),M=u.useCallback(()=>{m(""),p(""),g([]),S([])},[]),U=u.useCallback(()=>{D||(B(null),M(),P(""),H(""),V(!0))},[M,D]),T=u.useCallback(ne=>{if(!i||D||!ne)return;const we=ne.title??"",Le=ne.content??"";m(we?String(we):""),p(Le?String(Le):""),g(nS(ne,"campaign_id")),S(nS(ne,"user_id")),N(Me=>{const Ae=Array.isArray(Me?.campaigns)?[...Me.campaigns]:[],ot=Array.isArray(Me?.users)?[...Me.users]:[],ze=($e,vt,_t)=>{if(!vt)return;const Tt=String(vt);$e.some(Ct=>Ct?.value===Tt)||$e.push({value:Tt,label:_t})};return(Array.isArray(ne.permissions)?ne.permissions:[]).forEach($e=>{if(!$e)return;const vt=$e.user_id??$e.user?.id;if(vt){const Tt=$e.user?Yu($e.user):`User ${String(vt).slice(0,8)}`;ze(ot,vt,Tt)}const _t=$e.campaign_id??$e.campaign?.id;if(_t){const Tt=$e.campaign?.name?$e.campaign.name:`Campaign ${String(_t).slice(0,8)}`;ze(Ae,_t,Tt)}}),{campaigns:Ae,users:ot}}),B(ne),P(""),H(""),V(!0)},[i,D]),q=u.useCallback(()=>{D||(V(!1),P(""),B(null),M())},[M,D]),Y=u.useCallback(async()=>{if(!i||!r){N({campaigns:[],users:[]}),O(""),C(!1),k(!0);return}C(!0),O("");try{const[ne,we]=await Promise.all([jc({world_id:r}),Ls({world_id:r})]),Me=(Array.isArray(ne?.data)?ne.data:Array.isArray(ne)?ne:[]).map(nt=>({value:String(nt.id),label:nt.name||"Untitled campaign"})),Ae=Array.isArray(we?.data)?we.data:Array.isArray(we)?we:[],ot=[];Ae.forEach(nt=>{const $e=nt?.player||{},vt=$e.id||nt?.user_id;vt&&ot.push({value:String(vt),label:Yu($e)})});const ze=np(ot,"value");N({campaigns:Me,users:ze}),k(!0)}catch(ne){console.error(" Failed to load secret visibility options",ne),N({campaigns:[],users:[]}),O(ne.message||"Failed to load share options"),k(!0)}finally{C(!1)}},[i,r]);u.useEffect(()=>{k(!1),N({campaigns:[],users:[]}),O("")},[r,i]),u.useEffect(()=>{!X||_||Y()},[X,_,Y]);const Q=async ne=>{if(ne.preventDefault(),!e?.id||D)return;const we=h.trim();if(!we){P("Description is required."),H("");return}j(!0),P(""),H("");try{const Le={summary:f.trim()||void 0,description:we,campaign_ids:y,user_ids:v};let Me;I&&R?.id?Me=await FR(e.id,R.id,Le):Me=await $R(e.id,Le);const Ae=Me?.data||Me;I&&R?.id?(c?.(Ae),H("Secret updated successfully.")):(l?.(Ae),H("Secret created successfully.")),M(),B(null),V(!1)}catch(Le){P(Le.message||"Failed to save secret")}finally{j(!1)}},oe=ne=>{if(!i||!Array.isArray(ne?.permissions))return null;const we=ne.permissions.map(Ae=>({...Ae})).filter(Ae=>Ae);if(we.length===0)return a.jsx("p",{className:"entity-secret-shared",children:"Not shared with any campaigns or users."});const Le=np(we.filter(Ae=>Ae.user_id||Ae.user),"user_id"),Me=np(we.filter(Ae=>Ae.campaign_id||Ae.campaign),"campaign_id");return a.jsxs("div",{className:"entity-secret-shared",children:[Le.length>0&&a.jsxs("div",{children:[a.jsx("strong",{children:"Shared with players:"}),a.jsx("ul",{className:"entity-secret-share-list",children:Le.map(Ae=>{const ot=Ae.user?Yu(Ae.user):`User ${String(Ae.user_id).slice(0,8)}`,ze=Ae.user_id||ot;return a.jsx("li",{className:"entity-secret-share-pill",children:ot},ze)})})]}),Me.length>0&&a.jsxs("div",{children:[a.jsx("strong",{children:"Shared with campaigns:"}),a.jsx("ul",{className:"entity-secret-share-list",children:Me.map(Ae=>{const ot=Ae.campaign?.name||`Campaign ${String(Ae.campaign_id).slice(0,8)}`,ze=Ae.campaign_id||ot;return a.jsx("li",{className:"entity-secret-share-pill",children:ot},ze)})})]})]})},Z=I?"Edit secret":"Create a secret",de=I?"Update the secret content or who can access it.":"Secrets are hidden notes that are only visible to selected campaigns or players.",J=I?"Update secret":"Save secret",se=I?"Updating secret...":"Creating secret...";return a.jsxs("div",{className:"entity-tab-content",children:[i&&a.jsx(Wr,{isOpen:X,onClose:q,title:Z,description:de,size:"lg",footerActions:a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{type:"button",className:"border border-neutral-300 bg-white px-4 py-2 rounded-md text-sm hover:bg-neutral-100 text-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",onClick:q,disabled:D,children:"Cancel"}),a.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-md text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",form:L,disabled:D,children:D?se:J})]}),children:a.jsxs("form",{id:L,className:"entity-secret-form-body",onSubmit:Q,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-secret-summary",className:"text-sm font-medium text-neutral-700",children:"Summary"}),a.jsx("input",{id:"entity-secret-summary",type:"text",value:f,onChange:ne=>m(ne.target.value),placeholder:"Short label for this secret (optional)",disabled:D,"data-autofocus":"true",className:"w-full border rounded-md px-3 py-2 text-sm"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-secret-description",className:"text-sm font-medium text-neutral-700",children:"Description"}),a.jsx("textarea",{id:"entity-secret-description",value:h,onChange:ne=>p(ne.target.value),rows:4,placeholder:"Detail the secret information...",disabled:D,required:!0,className:"w-full border rounded-md px-3 py-2 text-sm min-h-[120px]"})]}),a.jsxs("div",{className:"entity-secret-share-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-secret-campaigns",className:"text-sm font-medium text-neutral-700",children:"Share with campaigns"}),a.jsx(ks,{inputId:"entity-secret-campaigns",selected:y,options:w.campaigns,onChange:g,placeholder:"Select campaigns...",disabled:D||E,loading:E,noOptionsMessage:E?"Loading campaigns...":"No campaigns available in this world."}),a.jsx("p",{className:"help-text",children:"Dungeon Masters of selected campaigns will be able to read this secret."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-secret-users",className:"text-sm font-medium text-neutral-700",children:"Share with players"}),a.jsx(ks,{inputId:"entity-secret-users",selected:v,options:w.users,onChange:S,placeholder:"Select users...",disabled:D||E,loading:E,noOptionsMessage:E?"Loading users...":"No eligible players found for this world."}),a.jsx("p",{className:"help-text",children:"Choose specific players who should see this information."})]})]}),A&&a.jsx("div",{className:"alert error",role:"alert",children:A}),z&&a.jsx("div",{className:"alert error",role:"alert",children:z})]})}),a.jsxs("section",{className:"entity-card entity-secret-list-card",children:[a.jsxs("div",{className:"entity-card-header entity-card-header--subtle",children:[a.jsxs("h2",{className:"entity-card-title",children:["Secrets for ",e?.name||"this entity"]}),i&&a.jsx("div",{className:"entity-card-actions",children:a.jsx("button",{type:"button",className:"btn submit",onClick:U,disabled:D,children:"New secret"})})]}),G&&a.jsx("div",{className:"alert success",role:"status",children:G}),$.length===0?a.jsx("p",{className:"entity-empty-state",children:"No secrets available for this entity yet."}):a.jsx("ul",{className:"entity-secret-list",children:$.map(ne=>{const we=ne.createdAt||ne.created_at,Le=ne.updatedAt||ne.updated_at,Me=Yu(ne.creator);return a.jsxs("li",{className:"entity-secret-item",children:[a.jsxs("div",{className:"entity-secret-header",children:[a.jsx("h3",{children:ne.title||"Untitled secret"}),a.jsxs("div",{className:"entity-secret-meta",children:[Me&&a.jsxs("span",{children:["Created by ",Me]}),we&&a.jsxs("span",{children:["Created ",tS(we)]}),Le&&Le!==we&&a.jsxs("span",{children:["Updated ",tS(Le)]})]})]}),i&&a.jsx("div",{className:"entity-secret-actions",children:a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>T(ne),disabled:D,children:"Edit secret"})}),ne.content?a.jsx("p",{className:"entity-secret-content",children:ne.content}):null,oe(ne)]},ne.id||ne.createdAt)})})]})]})}function P4(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function V4(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function Y4(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function Dd(e){return P4(e)||V4(e)||Y4()}function is(){return is=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},is.apply(this,arguments)}function G4(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function X4(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function K4(e,t,r){return t&&X4(e.prototype,t),e}function fn(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wp(e,t){return Wp=Object.setPrototypeOf||function(i,l){return i.__proto__=l,i},Wp(e,t)}function W4(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Wp(e,t)}function Nl(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Nl=function(r){return typeof r}:Nl=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Nl(e)}function bd(e){return typeof Symbol=="function"&&Nl(Symbol.iterator)==="symbol"?bd=function(r){return Nl(r)}:bd=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":Nl(r)},bd(e)}function Z4(e,t){return t&&(bd(t)==="object"||typeof t=="function")?t:fn(e)}function Id(e){return Id=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},Id(e)}function cn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ap,aS;function Q4(){if(aS)return ap;aS=1;var e=function(t,r,i,l,c,f,m,h){if(!t){var p;if(r===void 0)p=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var y=[i,l,c,f,m,h],g=0;p=new Error(r.replace(/%s/g,function(){return y[g++]})),p.name="Invariant Violation"}throw p.framesToPop=1,p}};return ap=e,ap}var J4=Q4();const Cl=Di(J4);function eD(e){if(Array.isArray(e))return e}function tD(e,t){var r=[],i=!0,l=!1,c=void 0;try{for(var f=e[Symbol.iterator](),m;!(i=(m=f.next()).done)&&(r.push(m.value),!(t&&r.length===t));i=!0);}catch(h){l=!0,c=h}finally{try{!i&&f.return!=null&&f.return()}finally{if(l)throw c}}return r}function nD(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function Ld(e,t){return eD(e)||tD(e,t)||nD()}function aD(e,t){if(e==null)return{};var r={},i=Object.keys(e),l,c;for(c=0;c<i.length;c++)l=i[c],!(t.indexOf(l)>=0)&&(r[l]=e[l]);return r}function sD(e,t){if(e==null)return{};var r=aD(e,t),i,l;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(l=0;l<c.length;l++)i=c[l],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}var sp,sS;function rD(){if(sS)return sp;sS=1;function e(t,r,i){return r in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}return sp=e,sp}var iD=rD();const dc=Di(iD);var rp,rS;function lD(){if(rS)return rp;rS=1;function e(t){if(Array.isArray(t)){for(var r=0,i=new Array(t.length);r<t.length;r++)i[r]=t[r];return i}}return rp=e,rp}var ip,iS;function oD(){if(iS)return ip;iS=1;function e(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}return ip=e,ip}var lp,lS;function cD(){if(lS)return lp;lS=1;function e(){throw new TypeError("Invalid attempt to spread non-iterable instance")}return lp=e,lp}var op,oS;function uD(){if(oS)return op;oS=1;var e=lD(),t=oD(),r=cD();function i(l){return e(l)||t(l)||r()}return op=i,op}var dD=uD();const rr=Di(dD);var $l=function(t){return t===Object(t)?Object.keys(t):[]},bN=function(t){return t===Object(t)?Object.values(t):[]};function vN(e,t){var r=Object.assign({},e);return vd(e)&&vd(t)&&$l(t).forEach(function(i){vd(t[i])?i in e?r[i]=vN(e[i],t[i]):Object.assign(r,dc({},i,t[i])):Object.assign(r,dc({},i,t[i]))}),r}var Zp=function(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),l=1;l<r;l++)i[l-1]=arguments[l];return i.reduce(function(c,f){return vN(c,f)},t)},fD=function(t,r){var i=Object.assign({},t);if(r)for(var l=0;l<r.length;l++)delete i[r[l]];return i},vd=function(t){return t===Object(t)&&!(t instanceof Date)&&!Array.isArray(t)},mD=function(t){return(t||[]).filter(Boolean)},eg=function(t){return t[0]==="&"},hD=function(t){return!eg(t)},cS=function(t){return t.replace(/-(\w)/g,function(r,i){return i.toUpperCase()})},pD=function(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=$l(t),l={},c=0,f=i.length;c<f;c+=1){var m=i[c],h=Object.prototype.toString.call(t[m])!=="[object Object]"||m[0]===":"||m[0]==="@"||r.indexOf(m)>=0;h&&(l[m]=t[m])}return l},xN=function(t,r){for(var i=r.map(cS),l=$l(t),c={},f=0,m=l.length;f<m;f+=1){var h=l[f];(r.indexOf(h)>=0||i.indexOf(cS(h))>=0)&&(c[h]=t[h])}return c},yD=function e(t,r){for(var i=Zp.apply(void 0,[{},fD(t,r)].concat(rr(bN(xN(t,r))))),l=$l(i).filter(eg),c=0,f=l.length;c<f;c+=1){var m=l[c],h=e(i[m],r);r.indexOf(m)>=0?(delete i[m],i=Zp({},i,h)):i[m]=h}return i};function uS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function dS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uS(Object(r),!0).forEach(function(i){dc(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var gD=["animationName"],SN=function(t){var r=t.style,i=t.className;return dS(dS({},r?{style:pD(r,gD)}:{}),i?{className:i}:{})},wN=u.createContext(SN);wN.Provider;var NN=function(t){if(t){if(typeof t=="string")return[t];if(!Array.isArray(t)){var r=t;return $l(t).reduce(function(i,l){return i.concat(r[l]?[l]:[])},[])}}else return[];return t},bD={},vD=function(t){return function(r,i){var l=i||bD;t.memoize=t.memoize||new WeakMap;var c;t.memoize.has(l)?c=t.memoize.get(l):(c={},t.memoize.set(l,c));var f=NN(r).join(" ");return f in c?c[f]:c[f]=t(r||[],i)}};function fS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function hl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fS(Object(r),!0).forEach(function(i){dc(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var xD=function(t){var r=t&&$l(t)[0];return r&&r.split("__")[0].split("--")[0]},SD=function(t,r,i){if(t){var l=t.split(" ")[0],c=[].concat(rr(r.length===0?i.map(function(f){return"".concat(l,"--").concat(f.substring(1))}):[]),rr(r.map(function(f){return"".concat(l,"__").concat(f)})));return r.length===0?[t].concat(rr(c)):c}};function EN(e){var t=e.style,r=e.className,i=e.classNames,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:SN,c=r||xD(i)||t?.className,f=typeof t=="function"?t:vD(function(g,v){var S=NN(g);Cl(Array.isArray(S),"First parameter must be a string, an array of strings, a plain object with boolean values, or a falsy value."),Cl(!v||vd(v),"Optional second parameter must be a plain object.");var w=S.filter(eg),N=S.filter(hD),E=N.length>0?function(O){return bN(xN(O,N))}:function(O){return[O]},C=function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return E(yD(_,w))},A=SD(c,N,w);return EN(hl(hl(hl({},(t||v)&&{style:Zp.apply(void 0,[{}].concat(rr(C(v)),rr(C(t))))}),A&&{className:A.join(" ")}),i&&{classNames:i}),l)}),m=hl({},typeof t=="function"?t:{style:t}),h=rr(new Set([].concat(rr(m.className?m.className.split(" "):[]),rr(c?c.split(" "):[])))),p=i?mD(h.map(function(g){return i[g]})):h,y=l(hl(hl({},m),p.length>0?{className:p.join(" ")}:{}));return Object.assign(f,y),f}function mS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function Oo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mS(Object(r),!0).forEach(function(i){dc(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var wD=function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return r.reduce(function(l,c){return Oo(Oo(Oo({},l),typeof c=="function"?c:{}),{},{style:Oo(Oo({},l.style),typeof c=="function"?c.style:c)})},{})},tg=function(t,r,i){var l=r.style,c=r.className,f=r.classNames,m=u.useContext(wN),h=u.useMemo(function(){return EN({style:l,className:c,classNames:f},m)},[l,c,f,m]);return h(i,t)},xd=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},Rs={id:"__id__",display:"__display__"},hS=function(t,r){Cl(r==="id"||r==="display",'Second arg must be either "id" or "display", got: "'.concat(r,'"'));var i=t.indexOf(Rs.display),l=t.indexOf(Rs.id);return i<0&&(i=null),l<0&&(l=null),Cl(i!==null||l!==null,"The markup '".concat(t,"' does not contain either of the placeholders '__id__' or '__display__'")),i!==null&&l!==null?r==="id"&&l<=i||r==="display"&&i<=l?0:1:0},ND=function(t){var r=/^\/(.+)\/(\w+)?$/;return new RegExp(t.map(function(i){var l=r.exec(i.toString()),c=Ld(l,3),f=c[1],m=c[2];return Cl(!m,"RegExp flags are not supported. Change /".concat(f,"/").concat(m," into /").concat(f,"/")),"(".concat(f,")")}).join("|"),"g")},jN=function(t){var r=0;return t.indexOf("__id__")>=0&&r++,t.indexOf("__display__")>=0&&r++,r},ED=function(){},_c=function(t,r,i){for(var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:ED,c=ND(r.map(function(k){return k.regex})),f=2,m=r.map(function(k){var D=k.markup,j=f;return f+=jN(D)+1,j}),h,p=0,y=0;(h=c.exec(t))!==null;){var g=m.find(function(k){return!!h[k]}),v=m.indexOf(g),S=r[v],w=S.markup,N=S.displayTransform,E=g+hS(w,"id"),C=g+hS(w,"display"),A=h[E],O=N(A,h[C]),_=t.substring(p,h.index);l(_,p,y),y+=_.length,i(h[0],h.index,y,A,O,v,p),y+=O.length,p=c.lastIndex}p<t.length&&l(t.substring(p),p,y)},Ei=function(t,r){var i="";return _c(t,r,function(l,c,f,m,h){i+=h},function(l){i+=l}),i},Na=function(t,r,i){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"START";if(typeof i!="number")return i;var c,f=function(p,y,g){c===void 0&&g+p.length>=i&&(c=y+i-g)},m=function(p,y,g,v,S,w,N){c===void 0&&g+S.length>i&&(l==="NULL"?c=null:c=y+(l==="END"?p.length:0))};return _c(t,r,m,f),c===void 0?t.length:c},tc=function(t,r,i,l){return t.substring(0,r)+l+t.substring(i)},jD=function(t,r,i,l){var c=i.selectionStartBefore,f=i.selectionEndBefore,m=i.selectionEndAfter,h=Ei(t,l),p=h.length-r.length;c==="undefined"&&(c=m+p),f==="undefined"&&(f=c),c===f&&f===m&&h.length===r.length&&(c=c-1);var y=r.slice(c,m),g=Math.min(c,m),v=f;c===m&&(v=Math.max(f,c+p));var S=Na(t,l,g,"START"),w=Na(t,l,v,"END"),N=Na(t,l,g,"NULL"),E=Na(t,l,v,"NULL"),C=N===null||E===null,A=tc(t,S,w,y);if(!C){var O=Ei(A,l);if(O!==r){for(g=0;r[g]===O[g];)g++;y=r.slice(g,m),v=h.lastIndexOf(r.substring(m)),S=Na(t,l,g,"START"),w=Na(t,l,v,"END"),A=tc(t,S,w,y)}}return A},pS=function(t,r,i){var l=i,c=!1,f=function(h,p,y,g,v,S,w){y<=i&&y+v.length>i&&(l=y,c=!0)};if(_c(t,r,f),c)return l},Ko=function(t,r){var i=[];return _c(t,r,function(l,c,f,m,h,p,y){i.push({id:m,display:h,childIndex:p,index:c,plainTextIndex:f})}),i},_N=function(t,r){return"".concat(t,"-").concat(r)},Gu=function(t){return Object.values(t).reduce(function(r,i){var l=i.results;return r+l.length},0)},_D=function(t,r){var i=Ko(t,r),l=i[i.length-1];return l?l.plainTextIndex+l.display.length:0},CD=function(t){var r=xd(t),i=t[t.indexOf(Rs.display)+Rs.display.length],l=t[t.indexOf(Rs.id)+Rs.id.length];return new RegExp(r.replace(Rs.display,"([^".concat(xd(i||""),"]+?)")).replace(Rs.id,"([^".concat(xd(l||""),"]+?)")))},Br=function(t){return u.Children.toArray(t).map(function(r){var i=r.props,l=i.markup,c=i.regex,f=i.displayTransform;return{markup:l,regex:c?AD(c,l):CD(l),displayTransform:f||function(m,h){return h||m}}})},AD=function(t,r){var i=new RegExp(t.toString()+"|").exec("").length-1,l=jN(r);return Cl(i===l,"Number of capturing groups in RegExp ".concat(t.toString()," (").concat(i,") does not match the number of placeholders in the markup '").concat(r,"' (").concat(l,")")),t},TD=function(t,r,i){return t.replace(Rs.id,r).replace(Rs.display,i)},MD=[{base:"A",letters:/(&#65;|&#9398;|&#65313;|&#192;|&#193;|&#194;|&#7846;|&#7844;|&#7850;|&#7848;|&#195;|&#256;|&#258;|&#7856;|&#7854;|&#7860;|&#7858;|&#550;|&#480;|&#196;|&#478;|&#7842;|&#197;|&#506;|&#461;|&#512;|&#514;|&#7840;|&#7852;|&#7862;|&#7680;|&#260;|&#570;|&#11375;|[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F])/g},{base:"AA",letters:/(&#42802;|[\uA732])/g},{base:"AE",letters:/(&#198;|&#508;|&#482;|[\u00C6\u01FC\u01E2])/g},{base:"AO",letters:/(&#42804;|[\uA734])/g},{base:"AU",letters:/(&#42806;|[\uA736])/g},{base:"AV",letters:/(&#42808;|&#42810;|[\uA738\uA73A])/g},{base:"AY",letters:/(&#42812;|[\uA73C])/g},{base:"B",letters:/(&#66;|&#9399;|&#65314;|&#7682;|&#7684;|&#7686;|&#579;|&#386;|&#385;|[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181])/g},{base:"C",letters:/(&#67;|&#9400;|&#65315;|&#262;|&#264;|&#266;|&#268;|&#199;|&#7688;|&#391;|&#571;|&#42814;|[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E])/g},{base:"D",letters:/(&#68;|&#9401;|&#65316;|&#7690;|&#270;|&#7692;|&#7696;|&#7698;|&#7694;|&#272;|&#395;|&#394;|&#393;|&#42873;|&#208;|[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779\u00D0])/g},{base:"DZ",letters:/(&#497;|&#452;|[\u01F1\u01C4])/g},{base:"Dz",letters:/(&#498;|&#453;|[\u01F2\u01C5])/g},{base:"E",letters:/(&#69;|&#9402;|&#65317;|&#200;|&#201;|&#202;|&#7872;|&#7870;|&#7876;|&#7874;|&#7868;|&#274;|&#7700;|&#7702;|&#276;|&#278;|&#203;|&#7866;|&#282;|&#516;|&#518;|&#7864;|&#7878;|&#552;|&#7708;|&#280;|&#7704;|&#7706;|&#400;|&#398;|[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E])/g},{base:"F",letters:/(&#70;|&#9403;|&#65318;|&#7710;|&#401;|&#42875;|[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B])/g},{base:"G",letters:/(&#71;|&#9404;|&#65319;|&#500;|&#284;|&#7712;|&#286;|&#288;|&#486;|&#290;|&#484;|&#403;|&#42912;|&#42877;|&#42878;|[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E])/g},{base:"H",letters:/(&#72;|&#9405;|&#65320;|&#292;|&#7714;|&#7718;|&#542;|&#7716;|&#7720;|&#7722;|&#294;|&#11367;|&#11381;|&#42893;|[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D])/g},{base:"I",letters:/(&#73;|&#9406;|&#65321;|&#204;|&#205;|&#206;|&#296;|&#298;|&#300;|&#304;|&#207;|&#7726;|&#7880;|&#463;|&#520;|&#522;|&#7882;|&#302;|&#7724;|&#407;|[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197])/g},{base:"J",letters:/(&#74;|&#9407;|&#65322;|&#308;|&#584;|[\u004A\u24BF\uFF2A\u0134\u0248])/g},{base:"K",letters:/(&#75;|&#9408;|&#65323;|&#7728;|&#488;|&#7730;|&#310;|&#7732;|&#408;|&#11369;|&#42816;|&#42818;|&#42820;|&#42914;|[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2])/g},{base:"L",letters:/(&#76;|&#9409;|&#65324;|&#319;|&#313;|&#317;|&#7734;|&#7736;|&#315;|&#7740;|&#7738;|&#321;|&#573;|&#11362;|&#11360;|&#42824;|&#42822;|&#42880;|[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780])/g},{base:"LJ",letters:/(&#455;|[\u01C7])/g},{base:"Lj",letters:/(&#456;|[\u01C8])/g},{base:"M",letters:/(&#77;|&#9410;|&#65325;|&#7742;|&#7744;|&#7746;|&#11374;|&#412;|[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C])/g},{base:"N",letters:/(&#78;|&#9411;|&#65326;|&#504;|&#323;|&#209;|&#7748;|&#327;|&#7750;|&#325;|&#7754;|&#7752;|&#544;|&#413;|&#42896;|&#42916;|&#330;|[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4\u014A])/g},{base:"NJ",letters:/(&#458;|[\u01CA])/g},{base:"Nj",letters:/(&#459;|[\u01CB])/g},{base:"O",letters:/(&#79;|&#9412;|&#65327;|&#210;|&#211;|&#212;|&#7890;|&#7888;|&#7894;|&#7892;|&#213;|&#7756;|&#556;|&#7758;|&#332;|&#7760;|&#7762;|&#334;|&#558;|&#560;|&#214;|&#554;|&#7886;|&#336;|&#465;|&#524;|&#526;|&#416;|&#7900;|&#7898;|&#7904;|&#7902;|&#7906;|&#7884;|&#7896;|&#490;|&#492;|&#216;|&#510;|&#390;|&#415;|&#42826;|&#42828;|[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C])/g},{base:"OE",letters:/(&#338;|[\u0152])/g},{base:"OI",letters:/(&#418;|[\u01A2])/g},{base:"OO",letters:/(&#42830;|[\uA74E])/g},{base:"OU",letters:/(&#546;|[\u0222])/g},{base:"P",letters:/(&#80;|&#9413;|&#65328;|&#7764;|&#7766;|&#420;|&#11363;|&#42832;|&#42834;|&#42836;|[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754])/g},{base:"Q",letters:/(&#81;|&#9414;|&#65329;|&#42838;|&#42840;|&#586;|[\u0051\u24C6\uFF31\uA756\uA758\u024A])/g},{base:"R",letters:/(&#82;|&#9415;|&#65330;|&#340;|&#7768;|&#344;|&#528;|&#530;|&#7770;|&#7772;|&#342;|&#7774;|&#588;|&#11364;|&#42842;|&#42918;|&#42882;|[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782])/g},{base:"S",letters:/(&#83;|&#9416;|&#65331;|&#7838;|&#346;|&#7780;|&#348;|&#7776;|&#352;|&#7782;|&#7778;|&#7784;|&#536;|&#350;|&#11390;|&#42920;|&#42884;|[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784])/g},{base:"T",letters:/(&#84;|&#9417;|&#65332;|&#7786;|&#356;|&#7788;|&#538;|&#354;|&#7792;|&#7790;|&#358;|&#428;|&#430;|&#574;|&#42886;|[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786])/g},{base:"TH",letters:/(&#222;|[\u00DE])/g},{base:"TZ",letters:/(&#42792;|[\uA728])/g},{base:"U",letters:/(&#85;|&#9418;|&#65333;|&#217;|&#218;|&#219;|&#360;|&#7800;|&#362;|&#7802;|&#364;|&#220;|&#475;|&#471;|&#469;|&#473;|&#7910;|&#366;|&#368;|&#467;|&#532;|&#534;|&#431;|&#7914;|&#7912;|&#7918;|&#7916;|&#7920;|&#7908;|&#7794;|&#370;|&#7798;|&#7796;|&#580;|[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244])/g},{base:"V",letters:/(&#86;|&#9419;|&#65334;|&#7804;|&#7806;|&#434;|&#42846;|&#581;|[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245])/g},{base:"VY",letters:/(&#42848;|[\uA760])/g},{base:"W",letters:/(&#87;|&#9420;|&#65335;|&#7808;|&#7810;|&#372;|&#7814;|&#7812;|&#7816;|&#11378;|[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72])/g},{base:"X",letters:/(&#88;|&#9421;|&#65336;|&#7818;|&#7820;|[\u0058\u24CD\uFF38\u1E8A\u1E8C])/g},{base:"Y",letters:/(&#89;|&#9422;|&#65337;|&#7922;|&#221;|&#374;|&#7928;|&#562;|&#7822;|&#376;|&#7926;|&#7924;|&#435;|&#590;|&#7934;|[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE])/g},{base:"Z",letters:/(&#90;|&#9423;|&#65338;|&#377;|&#7824;|&#379;|&#381;|&#7826;|&#7828;|&#437;|&#548;|&#11391;|&#11371;|&#42850;|[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762])/g},{base:"a",letters:/(&#97;|&#9424;|&#65345;|&#7834;|&#224;|&#225;|&#226;|&#7847;|&#7845;|&#7851;|&#7849;|&#227;|&#257;|&#259;|&#7857;|&#7855;|&#7861;|&#7859;|&#551;|&#481;|&#228;|&#479;|&#7843;|&#229;|&#507;|&#462;|&#513;|&#515;|&#7841;|&#7853;|&#7863;|&#7681;|&#261;|&#11365;|&#592;|[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250])/g},{base:"aa",letters:/(&#42803;|[\uA733])/g},{base:"ae",letters:/(&#230;|&#509;|&#483;|[\u00E6\u01FD\u01E3])/g},{base:"ao",letters:/(&#42805;|[\uA735])/g},{base:"au",letters:/(&#42807;|[\uA737])/g},{base:"av",letters:/(&#42809;|&#42811;|[\uA739\uA73B])/g},{base:"ay",letters:/(&#42813;|[\uA73D])/g},{base:"b",letters:/(&#98;|&#9425;|&#65346;|&#7683;|&#7685;|&#7687;|&#384;|&#387;|&#595;|[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253])/g},{base:"c",letters:/(&#99;|&#9426;|&#65347;|&#263;|&#265;|&#267;|&#269;|&#231;|&#7689;|&#392;|&#572;|&#42815;|&#8580;|[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184])/g},{base:"d",letters:/(&#100;|&#9427;|&#65348;|&#7691;|&#271;|&#7693;|&#7697;|&#7699;|&#7695;|&#273;|&#396;|&#598;|&#599;|&#42874;|&#240;|[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A\u00F0])/g},{base:"dz",letters:/(&#499;|&#454;|[\u01F3\u01C6])/g},{base:"e",letters:/(&#101;|&#9428;|&#65349;|&#232;|&#233;|&#234;|&#7873;|&#7871;|&#7877;|&#7875;|&#7869;|&#275;|&#7701;|&#7703;|&#277;|&#279;|&#235;|&#7867;|&#283;|&#517;|&#519;|&#7865;|&#7879;|&#553;|&#7709;|&#281;|&#7705;|&#7707;|&#583;|&#603;|&#477;|[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD])/g},{base:"f",letters:/(&#102;|&#9429;|&#65350;|&#7711;|&#402;|&#42876;|[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C])/g},{base:"g",letters:/(&#103;|&#9430;|&#65351;|&#501;|&#285;|&#7713;|&#287;|&#289;|&#487;|&#291;|&#485;|&#608;|&#42913;|&#7545;|&#42879;|[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F])/g},{base:"h",letters:/(&#104;|&#9431;|&#65352;|&#293;|&#7715;|&#7719;|&#543;|&#7717;|&#7721;|&#7723;|&#7830;|&#295;|&#11368;|&#11382;|&#613;|[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265])/g},{base:"hv",letters:/(&#405;|[\u0195])/g},{base:"i",letters:/(&#105;|&#9432;|&#65353;|&#236;|&#237;|&#238;|&#297;|&#299;|&#301;|&#239;|&#7727;|&#7881;|&#464;|&#521;|&#523;|&#7883;|&#303;|&#7725;|&#616;|&#305;|[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131])/g},{base:"ij",letters:/(&#307;|[\u0133])/g},{base:"j",letters:/(&#106;|&#9433;|&#65354;|&#309;|&#496;|&#585;|[\u006A\u24D9\uFF4A\u0135\u01F0\u0249])/g},{base:"k",letters:/(&#107;|&#9434;|&#65355;|&#7729;|&#489;|&#7731;|&#311;|&#7733;|&#409;|&#11370;|&#42817;|&#42819;|&#42821;|&#42915;|[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3])/g},{base:"l",letters:/(&#108;|&#9435;|&#65356;|&#320;|&#314;|&#318;|&#7735;|&#7737;|&#316;|&#7741;|&#7739;|&#322;|&#410;|&#619;|&#11361;|&#42825;|&#42881;|&#42823;|[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u0142\u019A\u026B\u2C61\uA749\uA781\uA747])/g},{base:"lj",letters:/(&#457;|[\u01C9])/g},{base:"m",letters:/(&#109;|&#9436;|&#65357;|&#7743;|&#7745;|&#7747;|&#625;|&#623;|[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F])/g},{base:"n",letters:/(&#110;|&#9437;|&#65358;|&#505;|&#324;|&#241;|&#7749;|&#328;|&#7751;|&#326;|&#7755;|&#7753;|&#414;|&#626;|&#329;|&#42897;|&#42917;|&#331;|[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5\u014B])/g},{base:"nj",letters:/(&#460;|[\u01CC])/g},{base:"o",letters:/(&#111;|&#9438;|&#65359;|&#242;|&#243;|&#244;|&#7891;|&#7889;|&#7895;|&#7893;|&#245;|&#7757;|&#557;|&#7759;|&#333;|&#7761;|&#7763;|&#335;|&#559;|&#561;|&#246;|&#555;|&#7887;|&#337;|&#466;|&#525;|&#527;|&#417;|&#7901;|&#7899;|&#7905;|&#7903;|&#7907;|&#7885;|&#7897;|&#491;|&#493;|&#248;|&#511;|&#596;|&#42827;|&#42829;|&#629;|[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275])/g},{base:"oe",letters:/(&#339;|[\u0153])/g},{base:"oi",letters:/(&#419;|[\u01A3])/g},{base:"ou",letters:/(&#547;|[\u0223])/g},{base:"oo",letters:/(&#42831;|[\uA74F])/g},{base:"p",letters:/(&#112;|&#9439;|&#65360;|&#7765;|&#7767;|&#421;|&#7549;|&#42833;|&#42835;|&#42837;|[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755])/g},{base:"q",letters:/(&#113;|&#9440;|&#65361;|&#587;|&#42839;|&#42841;|[\u0071\u24E0\uFF51\u024B\uA757\uA759])/g},{base:"r",letters:/(&#114;|&#9441;|&#65362;|&#341;|&#7769;|&#345;|&#529;|&#531;|&#7771;|&#7773;|&#343;|&#7775;|&#589;|&#637;|&#42843;|&#42919;|&#42883;|[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783])/g},{base:"s",letters:/(&#115;|&#9442;|&#65363;|&#347;|&#7781;|&#349;|&#7777;|&#353;|&#7783;|&#7779;|&#7785;|&#537;|&#351;|&#575;|&#42921;|&#42885;|&#7835;|&#383;|[\u0073\u24E2\uFF53\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B\u017F])/g},{base:"ss",letters:/(&#223;|[\u00DF])/g},{base:"t",letters:/(&#116;|&#9443;|&#65364;|&#7787;|&#7831;|&#357;|&#7789;|&#539;|&#355;|&#7793;|&#7791;|&#359;|&#429;|&#648;|&#11366;|&#42887;|[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787])/g},{base:"th",letters:/(&#254;|[\u00FE])/g},{base:"tz",letters:/(&#42793;|[\uA729])/g},{base:"u",letters:/(&#117;|&#9444;|&#65365;|&#249;|&#250;|&#251;|&#361;|&#7801;|&#363;|&#7803;|&#365;|&#252;|&#476;|&#472;|&#470;|&#474;|&#7911;|&#367;|&#369;|&#468;|&#533;|&#535;|&#432;|&#7915;|&#7913;|&#7919;|&#7917;|&#7921;|&#7909;|&#7795;|&#371;|&#7799;|&#7797;|&#649;|[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289])/g},{base:"v",letters:/(&#118;|&#9445;|&#65366;|&#7805;|&#7807;|&#651;|&#42847;|&#652;|[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C])/g},{base:"vy",letters:/(&#42849;|[\uA761])/g},{base:"w",letters:/(&#119;|&#9446;|&#65367;|&#7809;|&#7811;|&#373;|&#7815;|&#7813;|&#7832;|&#7817;|&#11379;|[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73])/g},{base:"x",letters:/(&#120;|&#9447;|&#65368;|&#7819;|&#7821;|[\u0078\u24E7\uFF58\u1E8B\u1E8D])/g},{base:"y",letters:/(&#121;|&#9448;|&#65369;|&#7923;|&#253;|&#375;|&#7929;|&#563;|&#7823;|&#255;|&#7927;|&#7833;|&#7925;|&#436;|&#591;|&#7935;|[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF])/g},{base:"z",letters:/(&#122;|&#9449;|&#65370;|&#378;|&#7825;|&#380;|&#382;|&#7827;|&#7829;|&#438;|&#549;|&#576;|&#11372;|&#42851;|[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763])/g}],RD=function(t){var r=t;return MD.forEach(function(i){r=r.replace(i.letters,i.base)}),r},yS=function(t){return RD(t).toLowerCase()},CN=function(t,r,i){return i?yS(t).indexOf(yS(r)):t.toLowerCase().indexOf(r.toLowerCase())},kD=function(){return!!document.documentMode},Qp=function(t){return typeof t=="number"},DD=function(t){return t===Object(t)?Object.keys(t):[]},ID=function(t){for(var r,i=arguments.length,l=new Array(i>1?i-1:0),c=1;c<i;c++)l[c-1]=arguments[c];var f=(r=[]).concat.apply(r,l);return Object.keys(t).reduce(function(m,h){return t.hasOwnProperty(h)&&!f.includes(h)&&t[h]!==void 0&&(m[h]=t[h]),m},{})},LD=["style","className","classNames"];function gS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function bS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gS(Object(r),!0).forEach(function(i){cn(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function gf(e,t){var r=function(l){var c=function(h){var p=h.style,y=h.className,g=h.classNames,v=sD(h,LD),S=t?t(v):void 0,w=tg(e,{style:p,className:y,classNames:g},S);return De.createElement(l,is({},v,{style:w}))},f=l.displayName||l.name||"Component";return c.displayName="defaultStyle(".concat(f,")"),De.forwardRef(function(m,h){return c(bS(bS({},m),{},{ref:h}))})};return r}var OD=function(t,r){return t.hasOwnProperty(r)?t[r]++:t[r]=0,r+"_"+t[r]};function AN(e){var t=e.selectionStart,r=e.selectionEnd,i=e.value,l=i===void 0?"":i,c=e.onCaretPositionChange,f=e.containerRef,m=e.children;e.singleLine;var h=e.style,p=u.useState({left:void 0,top:void 0}),y=Ld(p,2),g=y[0],v=y[1],S=u.useState(),w=Ld(S,2),N=w[0],E=w[1];u.useEffect(function(){C()});var C=function(){if(N){var R=N.offsetLeft,B=N.offsetTop;if(!(g.left===R&&g.top===B)){var I={left:R,top:B};v(I),c(I)}}},A=Br(m),O;r===t&&(O=Na(l,A,t,"START"));var _=[],k={},D=_,j=0,z=function(R,B,I){if(Qp(O)&&O>=B&&O<=B+R.length){var L=O-B;D.push(G(R.substring(0,L),j)),D=[G(R.substring(L),j)]}else D.push(G(R,j));j++},P=function(R,B,I,L,$,M,U){var T=OD(k,L);D.push(H(L,$,M,T))},G=function(R,B){return De.createElement("span",is({},h("substring"),{key:B}),R)},H=function(R,B,I,L){var $={id:R,display:B,key:L},M=u.Children.toArray(m)[I];return De.cloneElement(M,$)},X=function(R){return De.createElement("span",is({},h("caret"),{ref:E,key:"caret"}),R)};return _c(l,A,P,z),D.push(" "),D!==_&&_.push(X(D)),De.createElement("div",is({},h,{ref:f}),_)}AN.propTypes={selectionStart:Et.number,selectionEnd:Et.number,value:Et.string.isRequired,onCaretPositionChange:Et.func.isRequired,containerRef:Et.oneOfType([Et.func,Et.shape({current:typeof Element>"u"?Et.any:Et.instanceOf(Element)})]),children:Et.oneOfType([Et.element,Et.arrayOf(Et.element)]).isRequired};var zD=gf({position:"relative",boxSizing:"border-box",width:"100%",color:"transparent",overflow:"hidden",whiteSpace:"pre-wrap",wordWrap:"break-word",border:"1px solid transparent",textAlign:"start","&singleLine":{whiteSpace:"pre",wordWrap:null},substring:{visibility:"hidden"}},function(e){return{"&singleLine":e.singleLine}}),$D=zD(AN);function TN(e){var t=e.id,r=e.focused,i=e.ignoreAccents,l=e.index,c=e.onClick,f=e.onMouseEnter,m=e.query,h=e.renderSuggestion,p=e.suggestion,y=e.style;e.className,e.classNames;var g={onClick:c,onMouseEnter:f},v=function(){var E=S(),C=w(E);return h?h(p,m,C,l,r):C},S=function(){if(typeof p=="string")return p;var E=p.id,C=p.display;return E===void 0||!C?E:C},w=function(E){var C=CN(E,m,i);return C===-1?De.createElement("span",y("display"),E):De.createElement("span",y("display"),E.substring(0,C),De.createElement("b",y("highlight"),E.substring(C,C+m.length)),E.substring(C+m.length))};return De.createElement("li",is({id:t,role:"option","aria-selected":r},g,y),v())}TN.propTypes={id:Et.string.isRequired,query:Et.string.isRequired,index:Et.number.isRequired,ignoreAccents:Et.bool,suggestion:Et.oneOfType([Et.string,Et.shape({id:Et.oneOfType([Et.string,Et.number]).isRequired,display:Et.string})]).isRequired,renderSuggestion:Et.func,focused:Et.bool};var FD=gf({cursor:"pointer"},function(e){return{"&focused":e.focused}}),BD=FD(TN);function UD(e){var t=e.style,r=e.className,i=e.classNames,l=tg(qD,{style:t,className:r,classNames:i}),c=l("spinner");return De.createElement("div",l,De.createElement("div",c,De.createElement("div",c(["element","element1"])),De.createElement("div",c(["element","element2"])),De.createElement("div",c(["element","element3"])),De.createElement("div",c(["element","element4"])),De.createElement("div",c(["element","element5"]))))}var qD={};function MN(e){var t=e.id,r=e.suggestions,i=r===void 0?{}:r,l=e.a11ySuggestionsListLabel,c=e.focusIndex,f=e.position,m=e.left,h=e.right,p=e.top,y=e.scrollFocusedIntoView,g=e.isLoading,v=e.isOpened,S=e.onSelect,w=S===void 0?function(){return null}:S,N=e.ignoreAccents,E=e.containerRef,C=e.children,A=e.style,O=e.customSuggestionsContainer,_=e.onMouseDown,k=e.onMouseEnter,D=u.useState(void 0),j=Ld(D,2),z=j[0],P=j[1];u.useEffect(function(){if(!(!z||z.offsetHeight>=z.scrollHeight||!y)){var I=z.scrollTop,L=z.children[c].getBoundingClientRect(),$=L.top,M=L.bottom,U=z.getBoundingClientRect(),T=U.top;$=$-T+I,M=M-T+I,$<I?z.scrollTop=$:M>z.offsetHeight&&(z.scrollTop=M-z.offsetHeight)}},[c,y,z]);var G=function(){var L=De.createElement("ul",is({ref:P,id:t,role:"listbox","aria-label":l},A("list")),Object.values(i).reduce(function($,M){var U=M.results,T=M.queryInfo;return[].concat(Dd($),Dd(U.map(function(q,Y){return H(q,T,$.length+Y)})))},[]));return O?O(L):L},H=function(L,$,M){var U=M===c,T=$.childIndex,q=$.query,Y=u.Children.toArray(C)[T].props.renderSuggestion;return De.createElement(BD,{style:A("item"),key:"".concat(T,"-").concat(B(L)),id:_N(t,M),query:q,index:M,ignoreAccents:N,renderSuggestion:Y,suggestion:L,focused:U,onClick:function(){return R(L,$)},onMouseEnter:function(){return V(M)}})},X=function(){if(g)return De.createElement(UD,{style:A("loadingIndicator")})},V=function(L,$){k&&k(L)},R=function(L,$){w(L,$)},B=function(L){return typeof L=="string"?L:L.id};return v?De.createElement("div",is({},wD({position:f||"absolute",left:m,right:h,top:p},A),{onMouseDown:_,ref:E}),G(),X()):null}MN.propTypes={id:Et.string.isRequired,suggestions:Et.object.isRequired,a11ySuggestionsListLabel:Et.string,focusIndex:Et.number,position:Et.string,left:Et.number,right:Et.number,top:Et.number,scrollFocusedIntoView:Et.bool,isLoading:Et.bool,isOpened:Et.bool.isRequired,onSelect:Et.func,ignoreAccents:Et.bool,customSuggestionsContainer:Et.func,containerRef:Et.oneOfType([Et.func,Et.shape({current:typeof Element>"u"?Et.any:Et.instanceOf(Element)})])};var HD=gf({zIndex:1,backgroundColor:"white",marginTop:14,minWidth:100,list:{margin:0,padding:0,listStyleType:"none"}}),PD=HD(MN);function vS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function hs(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?vS(Object(r),!0).forEach(function(i){cn(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function VD(e){var t=YD();return function(){var i=Id(e),l;if(t){var c=Id(this).constructor;l=Reflect.construct(i,arguments,c)}else l=i.apply(this,arguments);return Z4(this,l)}}function YD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var GD=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t instanceof RegExp)return t;var i=r.allowSpaceInQuery,l=xd(t);return new RegExp("(?:^|\\s)(".concat(l,"([^").concat(i?"":"\\s").concat(l,"]*))$"))},XD=function(t,r){return t instanceof Array?function(i,l){for(var c=[],f=0,m=t.length;f<m;++f){var h=t[f].display||t[f].id;CN(h,i,r)>=0&&c.push(t[f])}return c}:t},pl={TAB:9,RETURN:13,ESC:27,UP:38,DOWN:40},Xu=!1,RN={singleLine:Et.bool,allowSpaceInQuery:Et.bool,allowSuggestionsAboveCursor:Et.bool,forceSuggestionsAboveCursor:Et.bool,ignoreAccents:Et.bool,a11ySuggestionsListLabel:Et.string,value:Et.string,onKeyDown:Et.func,customSuggestionsContainer:Et.func,onSelect:Et.func,onBlur:Et.func,onChange:Et.func,suggestionsPortalHost:typeof Element>"u"?Et.any:Et.PropTypes.instanceOf(Element),inputRef:Et.oneOfType([Et.func,Et.shape({current:typeof Element>"u"?Et.any:Et.instanceOf(Element)})]),children:Et.oneOfType([Et.element,Et.arrayOf(Et.element)]).isRequired},ng=(function(e){W4(r,e);var t=VD(r);function r(i){var l;return G4(this,r),l=t.call(this,i),cn(fn(l),"setContainerElement",function(c){l.containerElement=c}),cn(fn(l),"getInputProps",function(){var c=l.props,f=c.readOnly,m=c.disabled,h=c.style,p=ID(l.props,["style","classNames","className"],DD(RN));return hs(hs(hs(hs({},p),h("input")),{},{value:l.getPlainText(),onScroll:l.updateHighlighterScroll},!f&&!m&&{onChange:l.handleChange,onSelect:l.handleSelect,onKeyDown:l.handleKeyDown,onBlur:l.handleBlur,onCompositionStart:l.handleCompositionStart,onCompositionEnd:l.handleCompositionEnd}),l.isOpened()&&{role:"combobox","aria-controls":l.uuidSuggestionsOverlay,"aria-expanded":!0,"aria-autocomplete":"list","aria-haspopup":"listbox","aria-activedescendant":_N(l.uuidSuggestionsOverlay,l.state.focusIndex)})}),cn(fn(l),"renderControl",function(){var c=l.props,f=c.singleLine,m=c.style,h=l.getInputProps();return De.createElement("div",m("control"),l.renderHighlighter(),f?l.renderInput(h):l.renderTextarea(h))}),cn(fn(l),"renderInput",function(c){return De.createElement("input",is({type:"text",ref:l.setInputRef},c))}),cn(fn(l),"renderTextarea",function(c){return De.createElement("textarea",is({ref:l.setInputRef},c))}),cn(fn(l),"setInputRef",function(c){l.inputElement=c;var f=l.props.inputRef;typeof f=="function"?f(c):f&&(f.current=c)}),cn(fn(l),"setSuggestionsElement",function(c){l.suggestionsElement=c}),cn(fn(l),"renderSuggestionsOverlay",function(){if(!Qp(l.state.selectionStart))return null;var c=l.state.suggestionsPosition,f=c.position,m=c.left,h=c.top,p=c.right,y=De.createElement(PD,{id:l.uuidSuggestionsOverlay,style:l.props.style("suggestions"),position:f,left:m,top:h,right:p,focusIndex:l.state.focusIndex,scrollFocusedIntoView:l.state.scrollFocusedIntoView,containerRef:l.setSuggestionsElement,suggestions:l.state.suggestions,customSuggestionsContainer:l.props.customSuggestionsContainer,onSelect:l.addMention,onMouseDown:l.handleSuggestionsMouseDown,onMouseEnter:l.handleSuggestionsMouseEnter,isLoading:l.isLoading(),isOpened:l.isOpened(),ignoreAccents:l.props.ignoreAccents,a11ySuggestionsListLabel:l.props.a11ySuggestionsListLabel},l.props.children);return l.props.suggestionsPortalHost?h1.createPortal(y,l.props.suggestionsPortalHost):y}),cn(fn(l),"renderHighlighter",function(){var c=l.state,f=c.selectionStart,m=c.selectionEnd,h=l.props,p=h.singleLine,y=h.children,g=h.value,v=h.style;return De.createElement($D,{containerRef:l.setHighlighterElement,style:v("highlighter"),value:g,singleLine:p,selectionStart:f,selectionEnd:m,onCaretPositionChange:l.handleCaretPositionChange},y)}),cn(fn(l),"setHighlighterElement",function(c){l.highlighterElement=c}),cn(fn(l),"handleCaretPositionChange",function(c){l.setState({caretPosition:c})}),cn(fn(l),"getPlainText",function(){return Ei(l.props.value||"",Br(l.props.children))}),cn(fn(l),"executeOnChange",function(c){for(var f=arguments.length,m=new Array(f>1?f-1:0),h=1;h<f;h++)m[h-1]=arguments[h];if(l.props.onChange){var p;return(p=l.props).onChange.apply(p,[c].concat(m))}if(l.props.valueLink){var y;return(y=l.props.valueLink).requestChange.apply(y,[c.target.value].concat(m))}}),cn(fn(l),"handleChange",function(c){if(Xu=!1,kD()){var f=document.activeElement&&document.activeElement.contentDocument||document;if(f.activeElement!==c.target)return}var m=l.props.value||"",h=Br(l.props.children),p=c.target.value,y=l.state.selectionStart;y==null&&(y=c.target.selectionStart);var g=l.state.selectionEnd;g==null&&(g=c.target.selectionEnd);var v=jD(m,p,{selectionStartBefore:y,selectionEndBefore:g,selectionEndAfter:c.target.selectionEnd},h);p=Ei(v,h);var S=c.target.selectionStart,w=c.target.selectionEnd,N=!1,E=pS(m,h,S);E!==void 0&&l.state.selectionEnd>E&&(S=E+(c.nativeEvent.data?c.nativeEvent.data.length:0),w=S,N=!0),l.setState({selectionStart:S,selectionEnd:w,setSelectionAfterMentionChange:N});var C=Ko(v,h);c.nativeEvent.isComposing&&S===w&&l.updateMentionsQueries(l.inputElement.value,S);var A={target:{value:v}};l.executeOnChange(A,v,p,C)}),cn(fn(l),"handleSelect",function(c){if(l.setState({selectionStart:c.target.selectionStart,selectionEnd:c.target.selectionEnd}),!Xu){var f=l.inputElement;c.target.selectionStart===c.target.selectionEnd?l.updateMentionsQueries(f.value,c.target.selectionStart):l.clearSuggestions(),l.updateHighlighterScroll(),l.props.onSelect(c)}}),cn(fn(l),"handleKeyDown",function(c){var f=Gu(l.state.suggestions);if(f===0||!l.suggestionsElement){l.props.onKeyDown(c);return}switch(Object.values(pl).indexOf(c.keyCode)>=0&&(c.preventDefault(),c.stopPropagation()),c.keyCode){case pl.ESC:{l.clearSuggestions();return}case pl.DOWN:{l.shiftFocus(1);return}case pl.UP:{l.shiftFocus(-1);return}case pl.RETURN:{l.selectFocused();return}case pl.TAB:{l.selectFocused();return}default:return}}),cn(fn(l),"shiftFocus",function(c){var f=Gu(l.state.suggestions);l.setState({focusIndex:(f+l.state.focusIndex+c)%f,scrollFocusedIntoView:!0})}),cn(fn(l),"selectFocused",function(){var c=l.state,f=c.suggestions,m=c.focusIndex,h=Object.values(f).reduce(function(g,v){var S=v.results,w=v.queryInfo;return[].concat(Dd(g),Dd(S.map(function(N){return{result:N,queryInfo:w}})))},[])[m],p=h.result,y=h.queryInfo;l.addMention(p,y),l.setState({focusIndex:0})}),cn(fn(l),"handleBlur",function(c){var f=l._suggestionsMouseDown;l._suggestionsMouseDown=!1,f||l.setState({selectionStart:null,selectionEnd:null}),window.setTimeout(function(){l.updateHighlighterScroll()},1),l.props.onBlur(c,f)}),cn(fn(l),"handleSuggestionsMouseDown",function(c){l._suggestionsMouseDown=!0}),cn(fn(l),"handleSuggestionsMouseEnter",function(c){l.setState({focusIndex:c,scrollFocusedIntoView:!1})}),cn(fn(l),"updateSuggestionsPosition",function(){var c=l.state.caretPosition,f=l.props,m=f.suggestionsPortalHost,h=f.allowSuggestionsAboveCursor,p=f.forceSuggestionsAboveCursor;if(!(!c||!l.suggestionsElement)){var y=l.suggestionsElement,g=l.highlighterElement,v=g.getBoundingClientRect(),S=cp(g,"font-size"),w={left:v.left+c.left,top:v.top+c.top+S},N=Math.max(document.documentElement.clientHeight,window.innerHeight||0);if(y){var E={};if(m){E.position="fixed";var C=w.left,A=w.top;C-=cp(y,"margin-left"),A-=cp(y,"margin-top"),C-=g.scrollLeft,A-=g.scrollTop;var O=Math.max(document.documentElement.clientWidth,window.innerWidth||0);C+y.offsetWidth>O?E.left=Math.max(0,O-y.offsetWidth):E.left=C,h&&A+y.offsetHeight>N&&y.offsetHeight<A-S||p?E.top=Math.max(0,A-y.offsetHeight-S):E.top=A}else{var _=c.left-g.scrollLeft,k=c.top-g.scrollTop;_+y.offsetWidth>l.containerElement.offsetWidth?E.right=0:E.left=_,h&&w.top-g.scrollTop+y.offsetHeight>N&&y.offsetHeight<v.top-S-g.scrollTop||p?E.top=k-y.offsetHeight-S:E.top=k}E.left===l.state.suggestionsPosition.left&&E.top===l.state.suggestionsPosition.top&&E.position===l.state.suggestionsPosition.position||l.setState({suggestionsPosition:E})}}}),cn(fn(l),"updateHighlighterScroll",function(){var c=l.inputElement,f=l.highlighterElement;!c||!f||(f.scrollLeft=c.scrollLeft,f.scrollTop=c.scrollTop,f.height=c.height)}),cn(fn(l),"handleCompositionStart",function(){Xu=!0}),cn(fn(l),"handleCompositionEnd",function(){Xu=!1}),cn(fn(l),"setSelection",function(c,f){if(!(c===null||f===null)){var m=l.inputElement;if(m.setSelectionRange)m.setSelectionRange(c,f);else if(m.createTextRange){var h=m.createTextRange();h.collapse(!0),h.moveEnd("character",f),h.moveStart("character",c),h.select()}}}),cn(fn(l),"updateMentionsQueries",function(c,f){l._queryId++,l.suggestions={},l.setState({suggestions:{}});var m=l.props.value||"",h=l.props.children,p=Br(h),y=Na(m,p,f,"NULL");if(y!==null){var g=_D(m.substring(0,y),p),v=c.substring(g,f);De.Children.forEach(h,function(S,w){if(S){var N=GD(S.props.trigger,l.props),E=v.match(N);if(E){var C=g+v.indexOf(E[1],E.index);l.queryData(E[2],w,C,C+E[1].length,c)}}})}}),cn(fn(l),"clearSuggestions",function(){l._queryId++,l.suggestions={},l.setState({suggestions:{},focusIndex:0})}),cn(fn(l),"queryData",function(c,f,m,h,p){var y=l.props,g=y.children,v=y.ignoreAccents,S=u.Children.toArray(g)[f],w=XD(S.props.data,v),N=w(c,l.updateSuggestions.bind(null,l._queryId,f,c,m,h,p));N instanceof Array&&l.updateSuggestions(l._queryId,f,c,m,h,p,N)}),cn(fn(l),"updateSuggestions",function(c,f,m,h,p,y,g){if(c===l._queryId){l.suggestions=hs(hs({},l.suggestions),{},cn({},f,{queryInfo:{childIndex:f,query:m,querySequenceStart:h,querySequenceEnd:p,plainTextValue:y},results:g}));var v=l.state.focusIndex,S=Gu(l.suggestions);l.setState({suggestions:l.suggestions,focusIndex:v>=S?Math.max(S-1,0):v})}}),cn(fn(l),"addMention",function(c,f){var m=c.id,h=c.display,p=f.childIndex,y=f.querySequenceStart,g=f.querySequenceEnd,v=f.plainTextValue,S=l.props.value||"",w=Br(l.props.children),N=u.Children.toArray(l.props.children)[p],E=N.props,C=E.markup,A=E.displayTransform,O=E.appendSpaceOnAdd,_=E.onAdd,k=Na(S,w,y,"START"),D=k+g-y,j=TD(C,m,h);O&&(j+=" ");var z=tc(S,k,D,j);l.inputElement.focus();var P=A(m,h);O&&(P+=" ");var G=y+P.length;l.setState({selectionStart:G,selectionEnd:G,setSelectionAfterMentionChange:!0});var H={target:{value:z}},X=Ko(z,w),V=tc(v,y,g,P);l.executeOnChange(H,z,V,X),_&&_(m,h,k,D),l.clearSuggestions()}),cn(fn(l),"isLoading",function(){var c=!1;return De.Children.forEach(l.props.children,function(f){c=c||f&&f.props.isLoading}),c}),cn(fn(l),"isOpened",function(){return Qp(l.state.selectionStart)&&(Gu(l.state.suggestions)!==0||l.isLoading())}),cn(fn(l),"_queryId",0),l.suggestions={},l.uuidSuggestionsOverlay=Math.random().toString(16).substring(2),l.handleCopy=l.handleCopy.bind(fn(l)),l.handleCut=l.handleCut.bind(fn(l)),l.handlePaste=l.handlePaste.bind(fn(l)),l.state={focusIndex:0,selectionStart:null,selectionEnd:null,suggestions:{},caretPosition:null,suggestionsPosition:{},setSelectionAfterHandlePaste:!1},l}return K4(r,[{key:"componentDidMount",value:function(){document.addEventListener("copy",this.handleCopy),document.addEventListener("cut",this.handleCut),document.addEventListener("paste",this.handlePaste),this.updateSuggestionsPosition()}},{key:"componentDidUpdate",value:function(l,c){c.suggestionsPosition===this.state.suggestionsPosition&&this.updateSuggestionsPosition(),this.state.setSelectionAfterMentionChange&&(this.setState({setSelectionAfterMentionChange:!1}),this.setSelection(this.state.selectionStart,this.state.selectionEnd)),this.state.setSelectionAfterHandlePaste&&(this.setState({setSelectionAfterHandlePaste:!1}),this.setSelection(this.state.selectionStart,this.state.selectionEnd))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("copy",this.handleCopy),document.removeEventListener("cut",this.handleCut),document.removeEventListener("paste",this.handlePaste)}},{key:"render",value:function(){return De.createElement("div",is({ref:this.setContainerElement},this.props.style),this.renderControl(),this.renderSuggestionsOverlay())}},{key:"handlePaste",value:function(l){if(l.target===this.inputElement&&this.supportsClipboardActions(l)){l.preventDefault();var c=this.state,f=c.selectionStart,m=c.selectionEnd,h=this.props,p=h.value,y=h.children,g=Br(y),v=Na(p,g,f,"START"),S=Na(p,g,m,"END"),w=l.clipboardData.getData("text/react-mentions"),N=l.clipboardData.getData("text/plain"),E=tc(p,v,S,w||N).replace(/\r/g,""),C=Ei(E,g),A={target:hs(hs({},l.target),{},{value:E})};this.executeOnChange(A,E,C,Ko(E,g));var O=pS(p,g,f),_=(O||f)+Ei(w||N,g).length;this.setState({selectionStart:_,selectionEnd:_,setSelectionAfterHandlePaste:!0})}}},{key:"saveSelectionToClipboard",value:function(l){var c=this.inputElement.selectionStart,f=this.inputElement.selectionEnd,m=this.props,h=m.children,p=m.value,y=Br(h),g=Na(p,y,c,"START"),v=Na(p,y,f,"END");l.clipboardData.setData("text/plain",l.target.value.slice(c,f)),l.clipboardData.setData("text/react-mentions",p.slice(g,v))}},{key:"supportsClipboardActions",value:function(l){return!!l.clipboardData}},{key:"handleCopy",value:function(l){l.target===this.inputElement&&this.supportsClipboardActions(l)&&(l.preventDefault(),this.saveSelectionToClipboard(l))}},{key:"handleCut",value:function(l){if(l.target===this.inputElement&&this.supportsClipboardActions(l)){l.preventDefault(),this.saveSelectionToClipboard(l);var c=this.state,f=c.selectionStart,m=c.selectionEnd,h=this.props,p=h.children,y=h.value,g=Br(p),v=Na(y,g,f,"START"),S=Na(y,g,m,"END"),w=[y.slice(0,v),y.slice(S)].join(""),N=Ei(w,g),E={target:hs(hs({},l.target),{},{value:N})};this.executeOnChange(E,w,N,Ko(y,g))}}}]),r})(De.Component);cn(ng,"propTypes",RN);cn(ng,"defaultProps",{ignoreAccents:!1,singleLine:!1,allowSuggestionsAboveCursor:!1,onKeyDown:function(){return null},onSelect:function(){return null},onBlur:function(){return null}});var cp=function(t,r){var i=parseFloat(window.getComputedStyle(t,null).getPropertyValue(r));return isFinite(i)?i:0},KD=typeof navigator<"u"&&/iPhone|iPad|iPod/i.test(navigator.userAgent),WD=gf({position:"relative",overflowY:"visible",input:{display:"block",width:"100%",position:"absolute",margin:0,top:0,left:0,boxSizing:"border-box",backgroundColor:"transparent",fontFamily:"inherit",fontSize:"inherit",letterSpacing:"inherit"},"&multiLine":{input:hs({height:"100%",bottom:0,overflow:"hidden",resize:"none"},KD?{marginTop:1,marginLeft:-3}:null)}},function(e){var t=e.singleLine;return{"&singleLine":t,"&multiLine":!t}}),ZD=WD(ng),QD={fontWeight:"inherit"},Al=function(t){var r=t.display,i=t.style,l=t.className,c=t.classNames,f=tg(QD,{style:i,className:l,classNames:c});return De.createElement("strong",f,r)};Al.propTypes={onAdd:Et.func,onRemove:Et.func,renderSuggestion:Et.func,trigger:Et.oneOfType([Et.string,Et.instanceOf(RegExp)]),markup:Et.string,displayTransform:Et.func,allowSpaceInQuery:Et.bool,isLoading:Et.bool};Al.defaultProps={trigger:"@",markup:"@[__display__](__id__)",displayTransform:function(t,r){return r||t},onAdd:function(){return null},onRemove:function(){return null},renderSuggestion:null,isLoading:!1,appendSpaceOnAdd:!1};function Od({inputProps:e,...t}){const r=u.useRef(null);return u.useEffect(()=>{if(!r.current||!e)return;const i=()=>{const l=r.current?.querySelector("textarea");return l?(Object.entries(e).forEach(([c,f])=>{if(f!=null)if(c==="className"){const m=l.className||"";l.className=m?`${m} ${f}`.trim():f}else if(c.startsWith("data-")||c.startsWith("aria-"))l.setAttribute(c,String(f));else if(c==="rows")l.setAttribute("rows",String(f));else if(c==="required")l.required=!!f;else if(c==="id")l.id=String(f);else try{typeof f=="boolean"?f?l.setAttribute(c,""):l.removeAttribute(c):l[c]=f}catch{try{l.setAttribute(c,String(f))}catch{}}}),!0):!1};if(!i()){const l=setTimeout(()=>{i()},10);return()=>clearTimeout(l)}},[e]),a.jsx("div",{ref:r,children:a.jsx(ZD,{...t})})}const JD=/\s*\(([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\)$/i,eI=/\(([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\)/gi,Tl=e=>{if(!e)return"";let t=String(e).trim();return t=t.replace(JD,"").trim(),t=t.replace(eI,"").trim(),t},fc=(e="",t=[])=>{const r=typeof e=="string"?e:"";if(!r)return[];const i=Array.isArray(t)?t:[],l=new Map;i.forEach(p=>{if(!p)return;const y=p.entityId??p.entity_id??p.id??p.entityID??null;if(!y)return;const g=String(y);if(l.has(g))return;const v=p.entityName??p.entity_name??p.label??p.name,S=v?Tl(v):"";l.set(g,{entityId:g,entityName:S})});const c=[],f=/@\[(.+?)]\(([^)]+)\)/g;let m=0,h;for(;(h=f.exec(r))!==null;){h.index>m&&c.push({type:"text",text:r.slice(m,h.index)});const p=String(h[2]),y=h[1],g=Tl(y)||String(y??""),v=l.get(p)||{entityId:p,entityName:g};c.push({type:"mention",...v}),m=f.lastIndex}return m<r.length&&c.push({type:"text",text:r.slice(m)}),c},tI={private:"Private",companions:"Shared with companions",dm:"Shared with DM",party:"Share with Party"},nI=[{value:"private",label:"Private"},{value:"companions",label:"My Companions"}],aI=[{value:"private",label:"Private"},{value:"party",label:"Share with Party"}],up=e=>{if(!e)return"";if(e instanceof Date){if(Number.isNaN(e.getTime()))return"";try{return e.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.warn("Unable to format Date object",t,e),""}}if(typeof e=="string"||typeof e=="number")try{const t=new Date(e);return Number.isNaN(t.getTime())?(console.warn("Invalid date value:",e),""):t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.warn("Unable to parse date value",t,e),""}return console.warn("Unexpected date value type:",typeof e,e),""},dp=e=>e?.author?.username||e?.author?.name||e?.author?.email||e?.author_name||e?.author_email||"Unknown adventurer",xS=e=>{const t=e?.author||{},r=t?.id??t?.authorId??e?.authorId??e?.author_id??e?.authorID;if(r!=null)return`id:${String(r)}`;const i=t?.email??e?.author_email;if(i)return`email:${String(i).toLowerCase()}`;const l=t?.username??t?.name??e?.author_username??e?.author_name;return l?`name:${String(l).toLowerCase()}`:"unknown"},Sa=Object.freeze([]),SS="What do you want to remember?";function kN({entity:e,worldId:t,selectedCampaign:r,selectedCampaignId:i,isCampaignDm:l,isCampaignPlayer:c,canCreateNote:f,notes:m=Sa,loading:h,error:p,onCreateNote:y,creating:g,campaignMatchesEntityWorld:v,onNoteUpdate:S,onNoteDelete:w}){const{user:N}=Nn(),[E,C]=u.useState(""),[A,O]=u.useState("private"),[_,k]=u.useState(""),[D,j]=u.useState(Sa),[z,P]=u.useState(!1),[G,H]=u.useState(""),[X,V]=u.useState(""),[R,B]=u.useState(""),[I,L]=u.useState(!1),[$,M]=u.useState("all"),[U,T]=u.useState("notes"),[q,Y]=u.useState("entity"),[Q,oe]=u.useState(null),[Z,de]=u.useState(""),[J,se]=u.useState("private"),[ne,we]=u.useState(""),[Le,Me]=u.useState(!1),[Ae,ot]=u.useState(null),[ze,nt]=u.useState({items:Sa,loading:!1,error:"",loaded:!1}),[$e,vt]=u.useState({items:Sa,loading:!1,error:"",loaded:!1}),[_t,Tt]=u.useState(()=>new Set),Ct=!!i&&!!f&&!!v,Be=u.useMemo(()=>l?aI:nI,[l]),at=u.useMemo(()=>t||e&&typeof e=="object"&&((e.world||{}).id||e.world_id)||"",[e,t]),fe=u.useCallback(re=>{if(!N||!re)return!1;const Ze=re?.author?.id??re?.createdBy??re?.created_by??re?.authorId??re?.author_id??null;return Ze?String(Ze)===String(N.id):!1},[N]),ce=u.useCallback((re,Ze)=>{const We=typeof Ze=="string"?Ze:typeof re?.target?.value=="string"?re.target.value:"";C(We),V("")},[]),ye=u.useCallback(async(re,Ze)=>{const We=re?.trim()??"";if(typeof Ze=="function"){if(!at||We.length===0){Ze([]);return}try{const dt=await lf({worldId:at,query:We,limit:8}),Qe=Array.isArray(dt?.data)?dt.data:dt,yt=Array.isArray(Qe)?Qe.map(ke=>{const Ve=ke?.id??ke?.entity?.id;if(!Ve)return null;const ft=ke?.name||ke?.displayName||ke?.entity?.name||"Unnamed entity",K=Tl(ft)||"Unnamed entity";return{id:Ve,display:K}}).filter(Boolean):[];Ze(yt)}catch(dt){console.error("Failed to search entities for mentions",dt),Ze([])}}},[at]),Pe=u.useCallback(()=>{L(!1),V(""),B("")},[]),ee=u.useCallback(()=>{Ct&&(V(""),B(""),L(!0))},[Ct]),pe=u.useCallback(async re=>{if(re.preventDefault(),!Ct||!y)return;const Ze=E.trim();if(!Ze){V("Please enter a note before saving");return}if(c&&!_){V("Select which character this note is for");return}V(""),B("");try{const We={content:Ze,shareType:A,campaignId:i};c&&(We.characterId=_);const dt=await y(We);if(!dt||dt.success!==!0){V(dt?.message||"Failed to save note");return}C(""),c||k(""),Pe()}catch(We){console.error("Failed to submit note",We),V(We.message||"Failed to save note")}},[Ct,E,y,A,i,c,_,Pe]),me=u.useCallback(re=>{if(!re||!e?.id)return;const Ze=re?.characterId??re?.character_id??"";oe(re.id),de(re?.content??""),se(re?.shareType??re?.share_type??"private"),we(Ze),V("")},[e?.id]),Se=u.useCallback(()=>{oe(null),de(""),se("private"),we(""),V("")},[]),Ge=u.useCallback((re,Ze)=>{const We=typeof Ze=="string"?Ze:typeof re?.target?.value=="string"?re.target.value:"";de(We),V("")},[]),Xe=u.useCallback(async re=>{if(!re||!e?.id||!i)return;const Ze=Z.trim();if(!Ze){V("Please enter a note before saving");return}const We=re?.characterId??re?.character_id??"";if(c&&We&&!ne){V("Select which character this note is for");return}Me(!0),V("");try{const dt={content:Ze,shareType:J,campaignId:i};c&&ne&&(dt.characterId=ne);const Qe=await U1(e.id,re.id,dt),yt=Qe?.data||Qe;if(!yt)throw new Error("Note could not be updated");S&&await S(yt),Se()}catch(dt){console.error("Failed to update note",dt),V(dt.message||"Failed to update note")}finally{Me(!1)}},[e?.id,i,Z,J,ne,c,S,Se]),et=u.useCallback(async re=>{if(!(!re?.id||!e?.id||!i||!window.confirm("Are you sure you want to delete this note? This action cannot be undone."))){ot(re.id),V("");try{await q1(e.id,re.id,{campaignId:i}),w&&await w(re.id)}catch(We){console.error("Failed to delete note",We),V(We.message||"Failed to delete note")}finally{ot(null)}}},[e?.id,i,w]),Te=u.useMemo(()=>{const re=Array.isArray(m)?m:Sa;return re.length<=1?re:[...re].sort((Ze,We)=>{const dt=new Date(Ze?.createdAt??Ze?.created_at??0).getTime(),Qe=new Date(We?.createdAt??We?.created_at??0).getTime();return Number.isNaN(dt)||Number.isNaN(Qe)?0:Qe-dt})},[m]),mt=u.useMemo(()=>{const re=[{value:"all",label:"All notes"}],Ze=new Set(["all"]);return Te.forEach(We=>{const dt=xS(We);!dt||Ze.has(dt)||(Ze.add(dt),re.push({value:dt,label:dp(We)}))}),re},[Te]),Dt=u.useMemo(()=>$==="all"?Te:Te.filter(re=>xS(re)===$),[$,Te]),At=u.useMemo(()=>Array.isArray(ze.items)?ze.items:Sa,[ze.items]),Ke=u.useMemo(()=>Array.isArray($e.items)?$e.items:Sa,[$e.items]);u.useEffect(()=>{O("private")},[l,i]),u.useEffect(()=>{mt.some(re=>re.value===$)||M("all")},[mt,$]),u.useEffect(()=>{nt({items:Sa,loading:!1,error:"",loaded:!1}),vt({items:Sa,loading:!1,error:"",loaded:!1}),Tt(new Set),Y("entity")},[i,e?.id,v]),u.useEffect(()=>{let re=!1;return!c||!i?(j(Sa),P(!1),H(""),k(""),()=>{re=!0}):((async()=>{P(!0),H("");try{const We=await Ls({scope:"my",campaign_id:i});if(re)return;const Qe=(Array.isArray(We?.data)?We.data:Array.isArray(We)?We:[]).map(yt=>({id:yt?.id?String(yt.id):"",name:yt?.name||"Unnamed character"})).filter(yt=>yt.id);j(Qe),Qe.length===1?k(Qe[0].id):Qe.some(yt=>yt.id===_)||k("")}catch(We){if(re)return;console.error("Failed to load characters for notes",We),j(Sa),k(""),H(We.message||"Failed to load characters")}finally{re||P(!1)}})(),()=>{re=!0})},[c,i,_]);const ct=u.useCallback(async()=>{if(!(!e?.id||!i||!v)){nt(re=>({...re,loading:!0,error:""}));try{const re=await UR(e.id,{campaignId:i}),Ze=Array.isArray(re?.data)?re.data:Array.isArray(re)?re:Sa;nt({items:Ze,loading:!1,error:"",loaded:!0})}catch(re){nt({items:Sa,loading:!1,error:re?.message||"Failed to load mentions",loaded:!0})}}},[v,e?.id,i]),Rt=u.useCallback(async()=>{if(!(!e?.id||!i||!v)){vt(re=>({...re,loading:!0,error:""}));try{const re=await qR(e.id,{campaignId:i}),Ze=Array.isArray(re?.data)?re.data:Array.isArray(re)?re:Sa;vt({items:Ze,loading:!1,error:"",loaded:!0})}catch(re){vt({items:Sa,loading:!1,error:re?.message||"Failed to load mentions",loaded:!0})}}},[v,e?.id,i]);u.useEffect(()=>{U==="mentions"&&(!ze.loading&&!ze.loaded&&ct(),!$e.loading&&!$e.loaded&&Rt())},[U,ze.loading,ze.loaded,$e.loading,$e.loaded,ct,Rt]);const Ut=u.useCallback(re=>{const Ze=fc(re?.content,re?.mentions);if(!Ze.length)return"";const We=Ze.map(dt=>dt.type==="mention"?`@${dt.entityName||"entity"}`:dt.text||"").join("").replace(/\s+/g," ").trim();return We.length<=180?We:`${We.slice(0,177)}`},[]),Qt=u.useCallback(re=>{const Ze=re?.sessionDate??re?.session_date;if(!Ze)return"";try{const We=new Date(Ze);if(!Number.isNaN(We.getTime()))return We.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch(We){return console.warn("Unable to format session date",We),Ze}return Ze},[]),wt=u.useCallback(re=>{const Ze=String(re);Tt(We=>{const dt=new Set(We);return dt.has(Ze)?dt.delete(Ze):dt.add(Ze),dt})},[]),Ft=u.useCallback(re=>_t.has(String(re)),[_t]),Ht=u.useCallback(()=>{!e?.id||!i||!v||(q==="entity"?ct():Rt())},[v,e?.id,ct,Rt,q,i]),kt=u.useCallback(re=>{const Ze=fc(re?.content,re?.mentions);return Ze.length?Ze.map((We,dt)=>{if(We.type==="mention"&&We.entityId){const Qe=`${re?.id||"note"}-mention-${dt}`,yt=We.entityName||"entity";return a.jsxs("span",{className:"entity-note-mention",children:["@",yt,a.jsx(Os,{entityId:We.entityId,entityName:yt})]},Qe)}return a.jsx("span",{className:"entity-note-text",children:We.text},`${re?.id||"note"}-text-${dt}`)}):null},[]);u.useCallback(re=>`entity-note-share entity-note-share-${re}`,[]);const te=At.length,be=Ke.length,ve=ze.loading,Ue=$e.loading,it=ze.error,xt=$e.error,ie=ze.loaded,_e=$e.loaded,qe=!i||!v||(q==="entity"?ve:Ue),ht=c&&Ct,pt=ht&&D.length===1,Ee=g,st=g||!E.trim()||c&&!_,le=Te.length===0||mt.length<=1;u.useEffect(()=>{(U!=="notes"||!Ct)&&I&&Pe()},[U,Ct,I,Pe]);const Je=r?.name||"",ut=u.useCallback(re=>{const Ze=dp(re),We=re?.character?.name||"";return We?`${Ze} (as ${We})`:Ze},[]),gt=u.useCallback(re=>{const Ze=String(re?.shareType??re?.share_type??"private");return tI[Ze]||"Private"},[]);return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"entity-notes-card-strict",children:[a.jsxs("div",{className:"entity-notes-header-row",children:[a.jsx("h2",{className:"entity-notes-title",children:"Notes"}),U==="notes"&&Ct?a.jsx("button",{type:"button",className:"btn-primary",onClick:ee,disabled:g,children:"+ Create note"}):null]}),r?.name?a.jsxs("p",{className:"entity-notes-campaign-line",children:["Campaign: ",Je]}):null,a.jsxs("div",{className:"entity-notes-tabs-row",children:[a.jsx("button",{type:"button",className:`entity-notes-strict-tab-button${U==="notes"?" active":""}`,onClick:()=>T("notes"),children:"Notes"}),a.jsx("button",{type:"button",className:`entity-notes-strict-tab-button${U==="mentions"?" active":""}`,onClick:()=>T("mentions"),children:"@Mentions"})]}),U==="notes"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"entity-notes-strict-filter",children:[a.jsx("span",{className:"entity-notes-strict-filter-label",children:"Show notes from"}),a.jsx("select",{className:"entity-notes-strict-filter-select",value:$,onChange:re=>M(re.target.value),disabled:le,children:mt.map(re=>a.jsx("option",{value:re.value,children:re.label},re.value))})]}),p?a.jsxs("div",{className:"entity-notes-strict-alert error",children:[a.jsx(Ha,{size:16}),a.jsx("p",{children:p})]}):null,h?a.jsxs("div",{className:"entity-notes-strict-loading",children:[a.jsx(wn,{className:"spin",size:20}),a.jsx("span",{children:"Loading notes"})]}):null,!h&&Dt.length===0?a.jsx("p",{className:"entity-notes-strict-empty",children:"No notes yet."}):null,!h&&Dt.length>0?a.jsx("div",{className:"entity-notes-strict-list",children:Dt.map(re=>{const Ze=re?.createdAt??re?.created_at??re?.timestamp??null,We=up(Ze);String(re?.shareType??re?.share_type??"private");const dt=Q===re?.id,Qe=fe(re);return re?.characterId??re?.character_id,a.jsx("div",{className:"entity-notes-strict-note-item",children:dt?a.jsxs("div",{className:"entity-notes-strict-edit-panel",children:[a.jsx(Od,{value:Z,onChange:Ge,markup:"@[__display__](__id__)",placeholder:SS,className:"entity-note-mentions",inputProps:{className:"entity-notes-strict-textarea","aria-label":"Edit note content",rows:5,required:!0},children:a.jsx(Al,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(yt,ke)=>`@${ke}`,data:ye,appendSpaceOnAdd:!0})}),a.jsx("p",{className:"entity-notes-strict-share-label",children:"Share with"}),a.jsx("div",{className:"entity-notes-strict-share-options",children:Be.map(yt=>a.jsxs("label",{className:"entity-notes-strict-share-option",children:[a.jsx("input",{type:"radio",name:`entity-note-share-edit-${re.id}`,value:yt.value,checked:J===yt.value,onChange:()=>se(yt.value),disabled:Le}),yt.value==="private"?"Private":yt.value==="party"?"Share with Party":yt.label]},yt.value))}),X?a.jsxs("div",{className:"entity-notes-strict-alert error",children:[a.jsx(Ha,{size:16}),a.jsx("p",{children:X})]}):null,a.jsxs("div",{className:"entity-notes-strict-edit-actions",children:[a.jsx("button",{type:"button",className:"btn-primary",onClick:()=>Xe(re),disabled:Le||!Z.trim(),children:Le?a.jsxs(a.Fragment,{children:[a.jsx(wn,{className:"spin",size:16})," Saving"]}):"Save"}),a.jsx("button",{type:"button",className:"btn-secondary",onClick:Se,disabled:Le,children:"Cancel"})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"entity-notes-strict-note-header",children:[a.jsxs("div",{className:"entity-notes-strict-note-title-row",children:[a.jsx("span",{className:"entity-notes-strict-note-title",children:ut(re)}),a.jsx("span",{className:"entity-notes-strict-note-visibility",children:gt(re)})]}),a.jsx("span",{className:"entity-notes-strict-note-timestamp",children:We||""})]}),a.jsx("p",{className:"entity-notes-strict-note-body",children:kt(re)}),Qe?a.jsxs("div",{className:"entity-notes-strict-note-actions",children:[a.jsx("button",{type:"button",className:"entity-notes-strict-edit-button",onClick:()=>me(re),children:"Edit"}),a.jsx("button",{type:"button",className:"entity-notes-strict-delete-button",onClick:()=>et(re),disabled:Ae===re.id,children:Ae===re.id?a.jsx(wn,{className:"spin",size:14}):"Delete"})]}):null]})},re?.id)})}):null]}):a.jsxs("div",{className:"entity-notes-strict-mentions",children:[a.jsxs("div",{className:"entity-notes-strict-mentions-header",children:[a.jsxs("div",{className:"entity-notes-strict-mention-toggle",children:[a.jsxs("button",{type:"button",className:`entity-notes-strict-mention-toggle-button${q==="entity"?" active":""}`,onClick:()=>Y("entity"),children:["Entity Notes",ie?a.jsx("span",{className:"entity-notes-strict-mention-count",children:te}):null]}),a.jsxs("button",{type:"button",className:`entity-notes-strict-mention-toggle-button${q==="session"?" active":""}`,onClick:()=>Y("session"),children:["Session Notes",_e?a.jsx("span",{className:"entity-notes-strict-mention-count",children:be}):null]})]}),a.jsx("button",{type:"button",className:"btn-secondary",onClick:Ht,disabled:qe,children:(q==="entity"?ve:Ue)?a.jsxs(a.Fragment,{children:[a.jsx(wn,{className:"spin",size:16})," Refreshing"]}):"Refresh"})]}),q==="entity"?a.jsxs(a.Fragment,{children:[it?a.jsxs("div",{className:"entity-notes-strict-alert error",children:[a.jsx(Ha,{size:16}),a.jsx("p",{children:it})]}):null,ve?a.jsxs("div",{className:"entity-notes-strict-loading",children:[a.jsx(wn,{className:"spin",size:20}),a.jsx("span",{children:"Loading mentions"})]}):null,!ve&&ie&&te===0?a.jsx("p",{className:"entity-notes-strict-empty",children:"This entity hasn't been mentioned in other entity notes yet."}):null,!ve&&ie&&te>0?a.jsx("div",{className:"entity-notes-strict-list",children:At.map((re,Ze)=>{const We=re?.id??re?.entityNoteId??re?.entity_note_id??`entity-mention-${Ze}`,dt=String(We),Qe=re?.createdAt??re?.created_at,yt=Qe?new Date(Qe):null,ke=up(yt);return String(re?.shareType??re?.share_type??"private"),yt&&!Number.isNaN(yt.getTime())&&yt.toISOString(),re?.entity?.name??re?.entityName,re?.entity?.id??re?.entityId??re?.entity_id,a.jsxs("div",{className:"entity-notes-strict-note-item",children:[a.jsxs("div",{className:"entity-notes-strict-note-header",children:[a.jsxs("div",{className:"entity-notes-strict-note-title-row",children:[a.jsx("span",{className:"entity-notes-strict-note-title",children:ut(re)}),a.jsx("span",{className:"entity-notes-strict-note-visibility",children:gt(re)})]}),a.jsx("span",{className:"entity-notes-strict-note-timestamp",children:ke||""})]}),a.jsx("p",{className:"entity-notes-strict-note-body",children:kt(re)})]},`entity-mention-${dt}`)})}):null]}):a.jsxs(a.Fragment,{children:[xt?a.jsxs("div",{className:"entity-notes-strict-alert error",children:[a.jsx(Ha,{size:16}),a.jsx("p",{children:xt})]}):null,Ue?a.jsxs("div",{className:"entity-notes-strict-loading",children:[a.jsx(wn,{className:"spin",size:20}),a.jsx("span",{children:"Loading session mentions"})]}):null,!Ue&&_e&&be===0?a.jsx("p",{className:"entity-notes-strict-empty",children:"This entity hasn't been mentioned in session notes yet."}):null,!Ue&&_e&&be>0?a.jsx("div",{className:"entity-notes-strict-list",children:Ke.map((re,Ze)=>{const We=re?.id??re?.noteId??re?.note_id??`session-mention-${Ze}`,dt=String(We),Qe=Ft(dt),yt=Ut(re),ke=re?.sessionTitle??re?.session_title??"Session note";Qt(re),dp(re);const Ve=re?.updatedAt??re?.updated_at??re?.createdAt??re?.created_at,ft=Ve?new Date(Ve):null,K=up(ft),ae=yt||"This session note does not include any text.";return a.jsxs("div",{className:"entity-notes-strict-note-item",children:[a.jsxs("div",{className:"entity-notes-strict-note-header",children:[a.jsx("div",{className:"entity-notes-strict-note-title-row",children:a.jsx("span",{className:"entity-notes-strict-note-title",children:ke})}),a.jsx("span",{className:"entity-notes-strict-note-timestamp",children:K||""})]}),Qe?a.jsx("p",{className:"entity-notes-strict-note-body",children:kt(re)}):a.jsx("p",{className:"entity-notes-strict-note-body",children:ae}),a.jsx("div",{className:"entity-notes-strict-note-actions",children:a.jsx("button",{type:"button",className:"entity-notes-strict-action-button",onClick:()=>wt(dt),children:Qe?"Hide note":"View note"})})]},`session-mention-${dt}`)})}):null]})]})]}),a.jsx(Wr,{isOpen:I&&Ct,onClose:Pe,title:"Create note",children:a.jsx("div",{className:"entity-notes-form",children:a.jsxs("form",{onSubmit:pe,className:"entity-notes-form-body",children:[a.jsx("label",{className:"entity-notes-label",htmlFor:"entity-note-content",children:"Note"}),a.jsx("div",{className:"entity-note-editor-field",children:a.jsx(Od,{value:E,onChange:ce,markup:"@[__display__](__id__)",placeholder:SS,className:"entity-note-mentions",inputProps:{id:"entity-note-content",className:"entity-note-textarea","aria-label":"Entity note content",rows:5,required:!0,"data-autofocus":!0},children:a.jsx(Al,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(re,Ze)=>`@${Ze}`,data:ye,appendSpaceOnAdd:!0})})}),a.jsxs("fieldset",{className:"entity-notes-share",children:[a.jsx("legend",{children:"Share with"}),Be.map(re=>a.jsxs("label",{className:"entity-notes-share-option",children:[a.jsx("input",{type:"radio",name:"entity-note-share",value:re.value,checked:A===re.value,onChange:()=>O(re.value),disabled:Ee}),a.jsx("span",{children:re.label})]},re.value))]}),ht?a.jsxs("div",{className:"entity-notes-character",children:[a.jsx("label",{htmlFor:"entity-note-character",children:"Character"}),a.jsxs("select",{id:"entity-note-character",value:_,onChange:re=>k(re.target.value),disabled:z||pt,required:!0,children:[a.jsx("option",{value:"",disabled:!0,children:z?"Loading characters":"Select character"}),D.map(re=>a.jsx("option",{value:re.id,children:re.name},re.id))]}),pt?a.jsxs("p",{className:"entity-notes-hint",children:["Notes will be associated with your character ",D[0]?.name,"."]}):null,G?a.jsxs("div",{className:"entity-notes-alert error",children:[a.jsx(Ha,{size:16}),a.jsx("p",{children:G})]}):null,!z&&!G&&D.length===0?a.jsx("p",{className:"entity-notes-hint",children:"You need an active character in this campaign to attach notes."}):null]}):null,X?a.jsxs("div",{className:"entity-notes-alert error",children:[a.jsx(Ha,{size:16}),a.jsx("p",{children:X})]}):null,R?a.jsx("div",{className:"entity-notes-alert success",children:a.jsx("p",{children:R})}):null,a.jsx("div",{className:"entity-notes-actions",children:a.jsx("button",{type:"submit",className:"primary",disabled:st,children:g?a.jsxs(a.Fragment,{children:[a.jsx(wn,{className:"spin",size:16})," Saving"]}):"Save note"})})]})})})]})}kN.propTypes={entity:on.object,worldId:on.oneOfType([on.string,on.number]),selectedCampaign:on.object,selectedCampaignId:on.oneOfType([on.string,on.number]),isCampaignDm:on.bool,isCampaignPlayer:on.bool,canCreateNote:on.bool,notes:on.arrayOf(on.object),loading:on.bool,error:on.string,onCreateNote:on.func,creating:on.bool,campaignMatchesEntityWorld:on.bool,onNoteUpdate:on.func,onNoteDelete:on.func};const sI=e=>{const t=e?.options?.choices;return!Array.isArray(t)||t.length===0?[]:t.map((r,i)=>{if(r==null)return null;if(typeof r=="object"){const c=r.value??r.id??r.key??r.slug??`choice-${i}`,f=r.label??r.name??r.title??r.display??c;return c==null?null:{value:c,label:String(f??c)}}const l=String(r);return{value:l,label:l}}).filter(Boolean)},rI=e=>{if(!e?.name)return null;const t=`metadata.${e.name}`,r=e.visibleByDefault!==void 0?!!e.visibleByDefault:e.visible_by_default!==void 0?!!e.visible_by_default:!0,i={key:t,name:t,label:e.label||e.name,metadataField:e.name,dataType:e.dataType,visibleByDefault:r};switch(e.dataType){case"text":return{...i,type:"textarea",rows:3};case"boolean":return{...i,type:"boolean"};case"enum":return{...i,type:"select",options:sI(e)};case"number":return{...i,type:"text",inputType:"number"};case"date":return{...i,type:"text"};case"reference":{const l=e.referenceTypeId??e.reference_type_id??e.referenceType?.id??null,c=e.referenceTypeName??e.reference_type_name??e.referenceType?.name??"",f=e.referenceFilter??e.reference_filter??e.referenceFilterJson??{},m=(()=>{if(e.displayValue)return String(e.displayValue);if(e.display)return String(e.display);if(e.selectedLabel)return String(e.selectedLabel);const h=e.value;if(!h||typeof h!="object")return"";const p=h.label??h.name??h.title??h.display??h.displayName??h.text??h.value;return p!=null?String(p):""})();return{...i,type:"reference",referenceTypeId:l,referenceTypeName:c,referenceFilter:f,displayKey:`metadataDisplay.${e.name}`,selectedLabel:m}}default:return{...i,type:"text"}}},Ku=(e,t,r="")=>{if(e!=null){const i=String(e).trim();if(i)return i}if(t!=null){const i=String(t).trim();if(i)return`name:${i.toLowerCase()}`}if(r){const i=String(r).trim();if(i)return`label:${i.toLowerCase().normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"fallback"}`}return""};function iI(){const{id:e}=ws(),t=$n(),r=Ga(),{user:i,token:l,sessionReady:c}=Nn(),{selectedCampaign:f,selectedCampaignId:m,setSelectedCampaignId:h}=Bn(),p=$y(),[y,g]=u.useState(null),v=u.useCallback(ge=>{const Re=Pa(ge);Re&&g(St=>St?!Re.permissions&&St.permissions?{...Re,permissions:St.permissions}:(Re.permissions,Re):Re)},[]),[S,w]=u.useState(!0),[N,E]=u.useState(""),[C,A]=u.useState(""),[O,_]=u.useState("dossier"),[k,D]=u.useState(!1),[j,z]=u.useState(!1),[P,G]=u.useState(!1),[H,X]=u.useState(null),[V,R]=u.useState({items:[],loading:!1,error:""}),[B,I]=u.useState(!1),L=u.useRef(null),[$,M]=u.useState({isDirty:!1,isSubmitting:!1}),[U,T]=u.useState(!1),[q,Y]=u.useState(null),Q=u.useRef(null),[oe,Z]=u.useState(!1),[de,J]=u.useState([]),[se,ne]=u.useState(""),[we,Le]=u.useState(!1),[Me,Ae]=u.useState([]),[ot,ze]=u.useState([]),[nt,$e]=u.useState(()=>Jh()),vt=u.useRef(r),_t=u.useRef(null),Ct=u.useMemo(()=>!f||!i?.id?null:(Array.isArray(f.members)?f.members:[]).find(St=>{if(!St)return!1;const Lt=St.user_id??St.userId??St.user?.id??St.id??null;return Lt?String(Lt)===String(i.id):!1})||null,[f,i?.id])?.role??null,Be=u.useMemo(()=>i?.role==="system_admin"?!0:Ct==="dm",[Ct,i?.role]),at=u.useMemo(()=>Ct==="player",[Ct]),fe=u.useMemo(()=>!!(Be||at),[Be,at]),ce=u.useMemo(()=>y?y.world?.id?String(y.world.id):y.world_id?String(y.world_id):y.worldId?String(y.worldId):"":"",[y]),ye=u.useMemo(()=>f?f.world?.id?String(f.world.id):f.world_id?String(f.world_id):"":"",[f]),Pe=u.useMemo(()=>!m||!ce||!ye?!0:String(ce)===String(ye),[m,ce,ye]),ee=r.state?.fromEntities?.search||"",pe=u.useMemo(()=>ee?ee.startsWith("?")?`/entities${ee}`:`/entities?${ee}`:"/entities",[ee]),me=u.useCallback(ge=>{if(!ge)return"the next page";const Re=ge.pathname||"",St=ge.search||"",Lt=`${Re}${St}`;return Lt?Lt===pe?"the previous page":Lt:"the next page"},[pe]),Se=u.useCallback(ge=>{if(!ge)return"";const Re=ge.pathname||"",St=ge.search||"",Lt=ge.hash||"";return`${Re}${St}${Lt}`},[]),Ge=u.useCallback(ge=>{if(!ge||typeof ge!="string")return null;const Re=ge.indexOf("#"),St=ge.indexOf("?");let Lt=ge.length;Re>=0&&(Lt=Re),St>=0&&St<Lt&&(Lt=St);const Gt=ge.slice(0,Lt)||"",nn=St>=0?ge.slice(St,Re>=0?Re:void 0):"",ln=Re>=0?ge.slice(Re):"";return{pathname:Gt,search:nn,hash:ln}},[]),Xe=u.useCallback(ge=>{if(ge){if(ge.externalUrl){typeof window<"u"&&window.location.assign(ge.externalUrl);return}if(ge.to!==void 0&&ge.to!==null){const Re=ge.to;if(typeof Re=="string"){_t.current=Re,t(Re,{replace:ge.replace,state:ge.state});return}const St=Se(Re);St&&(_t.current=St),t(Re,{replace:ge.replace,state:ge.state})}}},[Se,t]),et=u.useCallback(ge=>{ge&&g(Re=>{if(!Re)return Re;const St=Array.isArray(Re.secrets)?Re.secrets:[],Lt=St.findIndex(Zt=>!Zt||!ge||!Zt.id||!ge.id?!1:String(Zt.id)===String(ge.id)),Gt=Lt>=0?St.map((Zt,$t)=>$t===Lt?ge:Zt):[...St,ge],nn=Zt=>{if(!Zt)return 0;const $t=new Date(Zt).getTime();return Number.isNaN($t)?0:$t},ln=Gt.slice().sort((Zt,$t)=>nn(Zt?.created_at||Zt?.createdAt)-nn($t?.created_at||$t?.createdAt));return{...Re,secrets:ln}})},[]),Te=u.useCallback(async()=>{const ge=await BR(e,{campaignId:m});return Array.isArray(ge?.data)?ge.data:Array.isArray(ge)?ge:[]},[e,m]);u.useEffect(()=>{let ge=!1;return!e||!m||!Pe?(R({items:[],loading:!1,error:""}),()=>{ge=!0}):(R(St=>({...St,loading:!0,error:""})),(async()=>{try{const St=await Te();ge||R({items:St,loading:!1,error:""})}catch(St){if(!ge){const nn=(St.status===403||St.status==="403"||St.message==="Forbidden")&&!!m?"CAMPAIGN_CONTEXT_ACCESS_DENIED":St.message||"Failed to load notes";R(ln=>({...ln,loading:!1,error:nn}))}}})(),()=>{ge=!0})},[e,m,Pe,Te]);const mt=u.useCallback(async()=>{if(!e||!m||!Pe){R({items:[],loading:!1,error:""});return}R(ge=>({...ge,loading:!0,error:""}));try{const ge=await Te();R({items:ge,loading:!1,error:""})}catch(ge){R(Re=>({...Re,loading:!1,error:ge.message||"Failed to load notes"}))}},[e,m,Pe,Te]),Dt=u.useCallback(async ge=>{if(!e)return{success:!1,message:"Entity not found"};if(!m)return{success:!1,message:"Select a campaign first"};I(!0);try{const Re={...ge,campaignId:ge?.campaignId??m},St=await HR(e,Re),Lt=St?.data||St;if(!Lt)throw new Error("Note could not be created");const Gt=Lt?.createdAt??Lt?.created_at??new Date().toISOString(),nn=Lt?.createdAt&&Lt?.created_at?Lt:{...Lt,...Lt?.createdAt?{}:{createdAt:Gt},...Lt?.created_at?{}:{created_at:Gt}};return R(ln=>{const Zt=Array.isArray(ln?.items)?ln.items.slice():[],$t=Lt?.id,Ln=$t?Zt.filter(Ia=>Ia?.id!==$t):Zt;return{items:[nn,...Ln],loading:!1,error:""}}),{success:!0,note:nn}}catch(Re){return{success:!1,message:Re.message||"Failed to create note"}}finally{I(!1)}},[e,m]),At=u.useCallback(async ge=>{if(!ge?.id)return;const Re=ge?.updatedAt??ge?.updated_at??ge?.createdAt??ge?.created_at??new Date().toISOString(),St=ge?.updatedAt&&ge?.updated_at?ge:{...ge,...ge?.updatedAt?{}:{updatedAt:Re},...ge?.updated_at?{}:{updated_at:Re}};R(Lt=>{const Gt=Array.isArray(Lt?.items)?Lt.items.slice():[],nn=St?.id;if(!nn)return Lt;const ln=Gt.findIndex(Zt=>Zt?.id===nn);if(ln>=0){const Zt=[...Gt];return Zt[ln]=St,{items:Zt,loading:!1,error:""}}return{items:[St,...Gt],loading:!1,error:""}})},[]),Ke=u.useCallback(async ge=>{ge&&R(Re=>({items:(Array.isArray(Re?.items)?Re.items.slice():[]).filter(Gt=>Gt?.id!==ge),loading:!1,error:""}))},[]),ct=u.useMemo(()=>y?.permissions&&typeof y.permissions.canEdit=="boolean"?y.permissions.canEdit:!y||!i?!1:!!(i.role==="system_admin"||y.world?.created_by&&y.world.created_by===i.id||y.created_by&&y.created_by===i.id),[y,i]),Rt=u.useMemo(()=>Array.isArray(y?.secrets)?y.secrets:[],[y?.secrets]),Ut=u.useMemo(()=>!!y?.permissions?.canManageSecrets,[y?.permissions?.canManageSecrets]),Qt=Ut||Rt.length>0,wt=u.useMemo(()=>{const ge=[{id:"dossier",label:"Dossier"},{id:"notes",label:"Notes"},{id:"relationships",label:"Relationships"}];return Qt&&ge.push({id:"secrets",label:"Secrets"}),ct&&k&&ge.push({id:"access",label:"Access"}),ge.push({id:"system",label:"System"}),ge},[Qt,ct,k]);u.useEffect(()=>{new Set(wt.map(Re=>Re.id)).has(O)||_("dossier")},[wt,O]);const Ft=u.useCallback((ge,Re,St,Lt=null)=>{if(!ge)return null;const Gt=Array.isArray(ge.sections)?ge.sections:[],nn=Lt?.actionsByField??{},ln=Lt?.showRuleTargets??new Set;return Gt.map((Zt,$t)=>{const Ln=`${St||"section"}-${Zt.title||$t}`,Ia=Number.isFinite(Zt.columns)?Math.max(1,Number(Zt.columns)):1,Fs=Array.isArray(Zt.fields)?Zt.fields:[];return a.jsxs("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:[Zt.title?a.jsx("h2",{className:"entity-card-title",children:Zt.title}):null,a.jsx("div",{className:`entity-field-grid ${Ia>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":""}`,style:{"--entity-field-columns":Ia},children:Fs.length>0?Fs.map((us,Oi)=>{const hr=us?.key||us?.name||us?.field||`${Ln}-field-${Oi}`,Mc=nn[hr],pa=us.visibleByDefault!==void 0?!!us.visibleByDefault:us.visible_by_default!==void 0?!!us.visible_by_default:!0;return cc(hr,Mc,ln,pa)?null:a.jsx(mf,{field:{...us},data:Re,mode:"view"},hr)}):a.jsx("p",{className:"entity-empty-state",children:"No fields available."})})]},Ln)})},[]);u.useEffect(()=>{if(!H)return;const ge=setTimeout(()=>X(null),4e3);return()=>clearTimeout(ge)},[H]);const Ht=u.useCallback(async()=>{if(e){w(!0),E(""),A("");try{const ge=await cr(e),Re=Pa(ge);if(!Re){g(null),E("Entity not found");return}v(Re)}catch(ge){const Re=ge.status===403||ge.status==="403"||ge.message==="Forbidden";E(Re&&!!m?"CAMPAIGN_CONTEXT_ACCESS_DENIED":ge.message||"Failed to load entity"),g(null)}finally{w(!1)}}},[e,v,m]),kt=u.useCallback(async ge=>{if(!ge){Ae([]),ze([]);return}try{const[Re,St]=await Promise.all([cf(ge).catch(()=>null),uf(ge).catch(()=>null)]);Ae(Zr(Re)),ze(Zr(St))}catch{Ae([]),ze([])}},[]);u.useEffect(()=>{c&&l&&Ht()},[c,l,Ht]),u.useEffect(()=>{const ge=y?.entity_type_id||y?.entityType?.id||y?.entity_type?.id||null;if(!ge){Ae([]),ze([]);return}kt(ge)},[y?.entity_type_id,y?.entityType?.id,y?.entity_type?.id,kt]);const te=u.useMemo(()=>Array.isArray(y?.fields)?Hy(y.fields,Me).map(Re=>rI(Re)).filter(Boolean):[],[y?.fields,Me]),be=u.useMemo(()=>!y?.fields||y.fields.length===0?{__placeholder:"No metadata defined for this entity type."}:eN(y.fields),[y]),ve=y?.fields,Ue=u.useMemo(()=>Vy(ot,ve),[ot,ve]),it=u.useMemo(()=>!y?.fields||y.fields.length===0?{}:qk(y.fields),[y]),xt=u.useMemo(()=>!y?.fields||y.fields.length===0?{}:Uk(y.fields),[y]),ie=u.useMemo(()=>{if(!y?.id)return null;const ge=y?.entityType?.name||y?.entity_type?.name||y?.entityTypeName||"entity";return{id:y.id,type:`entity:${ge}`,title:y.name||"Untitled entity",worldId:ce,worldName:y?.world?.name||y?.world_name||""}},[y?.id,y?.name,y?.entityType?.name,y?.entity_type?.name,y?.entityTypeName,ce,y?.world?.name,y?.world_name]);D1(ie);const _e=u.useRef(null),qe=u.useRef(!1),ht=u.useRef(!1);u.useEffect(()=>{const ge=y?.id,Re=_e.current;ge!==Re&&Re!==null&&!ht.current&&(D(!1),qe.current=!1),_e.current=ge},[y?.id,k]);const pt=y?.createdAt||y?.created_at,Ee=y?.updatedAt||y?.updated_at,st=u.useMemo(()=>y?{name:y.name||"",description:y.description||"",typeName:y.entityType?.name||y.entity_type?.name||"",worldName:y.world?.name||y.world_name||"",worldId:ce,createdAt:Gr(pt),updatedAt:Gr(Ee),metadata:be,metadataDisplay:it,createdBy:y.creator?.username||y.creator?.email||y.created_by||"",updatedBy:y.updated_by||""}:null,[y,be,it,ce,pt,Ee]),le=u.useMemo(()=>Yy(Ue,st||{}),[Ue,st]),Je=u.useMemo(()=>y?{name:y.name||"",description:y.description||"",visibility:y.visibility||"visible",entityTypeName:y.entityType?.name||y.entity_type?.name||"",worldName:y.world?.name||y.world_name||"",worldId:ce,createdAt:Gr(pt),updatedAt:Gr(Ee),metadata:xt}:null,[y,ce,pt,Ee,xt]);u.useEffect(()=>{if(!k||!y||!Je||!L.current?.reset||!qe.current)return;const ge=setTimeout(()=>{L.current?.reset&&Je&&L.current.reset(Je),qe.current=!1},150);return()=>clearTimeout(ge)},[k,y,Je]);const ut=u.useMemo(()=>{if(!y)return"";const ge=y.imageMimeType||y.image_mime_type||"",Re=y.imageData||y.image_data||"";return!ge||!Re?"":`data:${ge};base64,${Re}`},[y]),gt=u.useMemo(()=>!y||!ct?null:a.jsx(N4,{entity:y,canEdit:ct,isEditing:k,onEntityUpdate:v,variant:k?"compact":"card"}),[y,ct,k,v]),re="Information",Ze=u.useMemo(()=>{const ge=te.length>0;return{title:"Edit Entity",sections:[{title:"Edit Entity",columns:2,fields:[{key:"name",label:"Name",type:"text"},{key:"entityTypeName",label:"Type",type:"readonly"},{key:"description",label:"Description",type:"textarea",rows:4,span:2}]},{title:re,columns:ge?2:1,fields:ge?te:[{key:"metadata.__placeholder",name:"metadata.__placeholder",label:"Information",type:"readonly"}]}]}},[te,re]),We=u.useMemo(()=>{const ge=te.length>0?te:[{key:"metadata.__placeholder",name:"metadata.__placeholder",label:"Information",type:"readonly"}];return{title:"Entity Overview",sections:[{title:"Summary",columns:2,fields:[{key:"name",label:"Name",type:"readonly"},{key:"typeName",label:"Type",type:"readonly"}]},{title:"Description",columns:1,fields:[{key:"description",label:"Description",type:"textarea",rows:4}]},{title:re,columns:te.length>0?2:1,fields:ge}]}},[te,re]),dt=u.useMemo(()=>({sections:[{title:"System",columns:2,fields:[{key:"worldName",label:"World",type:"readonly"},{key:"createdAt",label:"Created",type:"readonly"},{key:"createdBy",label:"Created by",type:"readonly"},{key:"updatedAt",label:"Updated",type:"readonly"},{key:"updatedBy",label:"Updated by",type:"readonly"}]}]}),[]),{accessSettings:Qe,accessOptions:yt,accessOptionsError:ke,accessOptionsLoading:Ve,accessSaving:ft,accessSaveError:K,accessSaveSuccess:ae,isAccessDirty:Ne,handleAccessSettingChange:He,resetAccessSettings:bt,handleAccessSave:Nt}=O4(y,l,ct),jt=u.useMemo(()=>y?.world?.id||y?.world_id||"",[y]),It=y?.id?String(y.id):"",tn=u.useCallback(async()=>{if(!It||!l){J([]),ne(""),Le(!1);return}Le(!0),ne("");try{const ge=await _4(It),Re=Array.isArray(ge)?ge:Array.isArray(ge?.data)?ge.data:[];J(Re)}catch(ge){J([]),ne(ge.message||"Failed to load relationships")}finally{Le(!1)}},[It,l]);u.useEffect(()=>{tn()},[tn]);const un=u.useMemo(()=>{if(!Array.isArray(de))return[];const ge=Re=>Re?typeof Re=="string"||typeof Re=="number"?String(Re).trim():typeof Re=="object"?String(Re.id||Re.entity_id||Re.entityId||"").trim():"":"";return de.map(Re=>{const St=Re.relationshipType||Re.relationship_type||Re.type||Re.relationshipTypeId||{},Lt=St?.from_name||St?.fromName||Re.source_relationship_label||Re.sourceLabel||"",Gt=St?.to_name||St?.toName||Re.target_relationship_label||Re.targetLabel||"";return{id:Re.id,typeId:ge(Re.relationship_type_id||Re.relationshipTypeId||Re.typeId||Re.type),typeName:Re.relationshipType?.name||Re.type?.name||"",fromId:ge(Re.from_entity_id||Re.fromEntityId||Re.from),toId:ge(Re.to_entity_id||Re.toEntityId||Re.to),fromName:Re.from_entity?.name||Re.from?.name||"",toName:Re.to_entity?.name||Re.to?.name||"",fromEntityTypeName:Re.from_entity_type?.name||Re.fromEntityTypeName||"",toEntityTypeName:Re.to_entity_type?.name||Re.toEntityTypeName||"",direction:Re.context?.__direction==="reverse"?"reverse":"forward",sourceLabel:Lt||"",targetLabel:Gt||""}})},[de]),Kt=u.useMemo(()=>un.filter(ge=>ge.fromId===It||ge.toId===It).sort((ge,Re)=>{const St=ge.fromId===It?ge.toName:ge.fromName,Lt=Re.fromId===It?Re.toName:Re.fromName;return St.localeCompare(Lt,void 0,{sensitivity:"base"})}),[un,It]),na=u.useMemo(()=>{const ge=new Map,Re=new Map;Kt.forEach(Gt=>{const nn=Gt.typeName||"Unknown type",ln=Ku(Gt.typeId,Gt.typeName,nn);ln&&!ge.has(ln)&&ge.set(ln,nn);const $t=Gt.fromId===It?Gt.toEntityTypeName:Gt.fromEntityTypeName,Ln=Ku(null,$t,$t);Ln&&!Re.has(Ln)&&Re.set(Ln,$t)});const St=Array.from(ge.entries()).map(([Gt,nn])=>({value:Gt,label:nn})),Lt=Array.from(Re.entries()).map(([Gt,nn])=>({value:Gt,label:nn}));return{relationshipTypes:St,relatedEntityTypes:Lt}},[Kt,It]),ba=u.useMemo(()=>{const ge=nt.relationshipTypes||{mode:"all",values:[]},Re=nt.relatedEntityTypes||{mode:"all",values:[]};return Kt.filter(St=>{const Lt=Ku(St.typeId,St.typeName,St.typeName);if(ge.mode!=="all"&&ge.values.length){const Gt=Lt&&ge.values.includes(Lt);if(ge.mode==="include"&&!Gt||ge.mode==="exclude"&&Gt)return!1}if(Re.mode!=="all"&&Re.values.length){const nn=St.fromId===It?St.toEntityTypeName:St.fromEntityTypeName,ln=Ku(null,nn,nn),Zt=ln&&Re.values.includes(ln);if(Re.mode==="include"&&!Zt||Re.mode==="exclude"&&Zt)return!1}return!0})},[Kt,nt,It]),$s=u.useCallback(ge=>{$e(!ge||typeof ge!="object"?Jh():ge)},[]),va=u.useCallback(()=>{$e(Jh())},[]),Bl=we,fa=u.useMemo(()=>`No relationships found for ${y?.name||"this entity"}.`,[y?.name]),os=u.useCallback(async()=>{if(!ct)return!1;ht.current=!0;let ge=!0,Re=!1;try{if($.isDirty&&L.current?.submit&&await L.current.submit()===!1&&(ge=!1),ge&&Ne&&(await Nt()?Re=!0:ge=!1),ge&&Re&&y?.id)try{const St=await cr(y.id),Lt=Pa(St);Lt&&v(Lt)}catch{}return ge}finally{setTimeout(()=>{ht.current=!1},200)}},[ct,$.isDirty,Ne,Nt,y?.id,v,k]),ni=u.useCallback(()=>{const ge=Q.current;Y(null),ge?.proceed?.()},[]),ai=u.useCallback(async()=>{Z(!0);try{if(await os()){T(!1);const Re=Q.current;Re?.type!=="exit-edit"?ni():(Y(null),Re?.proceed?.())}}finally{Z(!1)}},[os,ni]),cs=u.useCallback(()=>{L.current?.reset?.(Je||{}),bt()},[Je,bt]),Yn=u.useMemo(()=>k&&($.isDirty||Ne),[k,$.isDirty,Ne]),ue=u.useCallback(()=>{D(!1),_("dossier")},[_,y?.id,ct,Yn]),je=u.useCallback(ge=>{if(!ge)return;const Re=()=>{if(ge.label)return ge.label;if(ge.externalUrl)return ge.externalLabel||ge.externalUrl;if(typeof ge.to=="string"){const St=ge.location||Ge(ge.to);return me(St)}return me(ge.location||ge.to)};if(!Yn){Xe(ge);return}Y({type:"navigation",label:Re(),proceed:()=>Xe(ge),discard:()=>Xe(ge),stay:()=>{}}),T(!0)},[me,Yn,Ge,Xe,Y,T]);u.useEffect(()=>{if(typeof document>"u"||!Yn)return;const ge=Re=>{if(!Yn||Re.defaultPrevented||Re.button!==0||Re.metaKey||Re.ctrlKey||Re.shiftKey||Re.altKey)return;const St=Re.target,Lt=St instanceof Element?St:St&&"parentElement"in St?St.parentElement:null;if(!Lt||typeof Lt.closest!="function")return;const Gt=Lt.closest("a[href]");if(!Gt||Gt.hasAttribute("data-ignore-unsaved-warning"))return;const nn=Gt.getAttribute("href");if(!nn||nn.startsWith("#")||nn.startsWith("javascript:"))return;const ln=Gt.getAttribute("target");if(ln&&ln.toLowerCase()!=="_self")return;let Zt;try{Zt=new URL(nn,window.location.href)}catch{return}const $t=Gt.getAttribute("data-navigation-label")||Gt.getAttribute("aria-label")||Gt.title||Gt.textContent?.trim()||"",Ln=Zt.origin!==window.location.origin;if(Re.preventDefault(),Re.stopPropagation(),Ln){je({externalUrl:Zt.href,label:$t||Zt.href});return}const Ia=`${Zt.pathname}${Zt.search}${Zt.hash}`,Fs=`${window.location.pathname}${window.location.search}${window.location.hash}`;!Ia||Ia===Fs||je({to:Ia,location:Ge(Ia),label:$t||me({pathname:Zt.pathname,search:Zt.search})})};return document.addEventListener("click",ge,!0),()=>{document.removeEventListener("click",ge,!0)}},[me,Yn,Ge,je]);const Pt=u.useCallback(()=>{const ge=`/entities/${e}/relationship-viewer`;je({to:ge,location:Ge(ge)})},[e,Ge,je]),yn=u.useCallback(()=>{if(ct){if(A(""),!k){D(!0);return}if(Yn){Y({type:"exit-edit",label:"view mode",proceed:async()=>{await os()&&ue()},discard:()=>{cs(),ue()}}),T(!0);return}ue()}},[ct,ue,Yn,k,cs,os]),mn=u.useCallback(async ge=>{if(!y?.id)return!1;A("");try{const Re={name:ge?.name,description:ge?.description,metadata:ge?.metadata||{}};y?.visibility&&(Re.visibility=y.visibility);const St=await Uy(y.id,Re),Lt=Pa(St);if(!Lt)throw new Error("Failed to update entity");return v(Lt),qe.current=!0,{message:"Entity updated successfully."}}catch(Re){return A(Re.message||"Failed to update entity"),qe.current=!1,!1}},[y?.id,y?.visibility,v,k]),Vt=u.useCallback(ge=>{M(Re=>{const St={isDirty:!!ge?.isDirty,isSubmitting:!!ge?.isSubmitting};return Re.isDirty===St.isDirty&&Re.isSubmitting===St.isSubmitting?Re:St})},[y?.id,k]),En=u.useCallback(ge=>{!ge||ge===O||_(ge)},[O,_]),Un=u.useCallback(()=>{T(!1);const ge=Q.current;Y(null),ge?.discard?.()},[]),ma=u.useCallback(()=>{T(!1);const ge=Q.current;Y(null),ge?.stay?.()},[]);m1(u.useCallback(ge=>{Yn&&(ge.preventDefault(),ge.returnValue="")},[Yn]),{capture:!0});const ra=u.useCallback(({currentLocation:ge,nextLocation:Re})=>!Yn||!Re?!1:!(ge.pathname===Re.pathname&&ge.search===Re.search&&ge.hash===Re.hash),[Yn]),ha=z4(ra);if(u.useEffect(()=>{Q.current=q},[q]),u.useEffect(()=>{if(ha.state==="blocked"){if(!Yn){ha.reset?.();return}if(q){if(q.type==="navigation")return;ha.reset?.();return}Y({type:"navigation",label:me(ha.location),proceed:()=>ha.proceed?.(),discard:()=>ha.proceed?.(),stay:()=>ha.reset?.()}),T(!0)}},[ha,Yn,q,me]),u.useEffect(()=>{const ge=vt.current,Re=Se(ge),St=Se(r);if(Re===St){vt.current=r;return}if(!Yn){vt.current=r,_t.current=null;return}if(_t.current&&_t.current===St){_t.current=null,vt.current=r;return}if(!ge||q){vt.current=ge||r;return}const Lt=St||"/",Gt=Re||"/",nn=()=>{_t.current=Lt,t(Lt)},ln=()=>{_t.current=Gt,t(Gt)};Y({type:"navigation",label:me(r),proceed:nn,discard:nn,stay:ln}),T(!0),_t.current=Gt,t(Gt,{replace:!0})},[Se,me,Yn,r,t,q]),!c)return a.jsx("p",{children:"Restoring session..."});if(!l)return a.jsx("p",{children:"Authenticating..."});if(S)return a.jsx("p",{children:"Loading entity..."});if(N==="CAMPAIGN_CONTEXT_ACCESS_DENIED")return a.jsxs("div",{className:"alert error",style:{padding:"1.5rem",maxWidth:"600px",margin:"2rem auto"},children:[a.jsx("h2",{style:{marginTop:0,marginBottom:"1rem"},children:"Access Restricted by Campaign Context"}),a.jsx("p",{style:{marginBottom:"1rem"},children:"You don't have access to this entity with your current campaign context selected. This entity may belong to a different campaign or world, or your current campaign context doesn't have permission to view it."}),a.jsx("p",{style:{marginBottom:"1.5rem"},children:"To view this entity, please change your campaign context using the selector in the header to a campaign that has access to this entity."}),a.jsx("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap"},children:a.jsx("button",{type:"button",onClick:()=>t("/entities"),style:{padding:"0.5rem 1rem",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Go to Entities"})})]});if(N)return a.jsx("div",{className:"alert error",children:N});if(!y||!st)return a.jsx("p",{children:"Entity not found"});const Es=`entity-detail-page${p?" entity-detail-page--mobile":""}${p&&j?" entity-detail-page--header-expanded":""}`;return a.jsxs(a.Fragment,{children:[a.jsx(mN,{maxWidth:1280,className:Es,children:a.jsxs("div",{className:"w-full max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 overflow-x-hidden",children:[a.jsx("header",{className:`entity-page-header ${p&&!j?"entity-page-header--collapsed":""}`,children:a.jsxs("div",{className:"entity-page-header__inner",children:[p&&a.jsx("button",{type:"button",className:"entity-page-header__drag-handle",onClick:()=>z(!j),"aria-label":j?"Collapse header":"Expand header","aria-expanded":j,children:a.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:j?"rotated":"",children:a.jsx("polyline",{points:"6 9 12 15 18 9"})})}),a.jsx(m4,{entityId:e,name:y.name,canEdit:ct,isEditing:k,onToggleEdit:yn,onSave:os,isSaving:$.isSubmitting||ft,isSaveDisabled:!$.isDirty&&!Ne,isMobile:p}),a.jsxs("div",{className:`entity-page-header__tabs flex flex-wrap items-center justify-between gap-4 mt-4 ${p&&!j?"entity-page-header__tabs--collapsed":""}`,children:[a.jsx(o4,{tabs:wt,activeTab:O,onChange:En}),e&&a.jsx(p4,{entityId:e,importance:y.importance,onUpdate:ge=>{g(Re=>Re?{...Re,importance:ge}:null)}})]})]})}),a.jsx("div",{className:"entity-detail-shell",children:a.jsxs("div",{className:"entity-detail-body",children:[a.jsx("div",{className:"entity-tab-panel",role:"tabpanel",hidden:O!=="dossier",children:a.jsx($4,{isEditing:k,canEdit:ct,formError:C,formRef:L,editSchema:Ze,editInitialData:Je,handleUpdate:mn,handleFormStateChange:Vt,dossierSchema:We,viewData:st,featuredImageSrc:ut,renderSchemaSections:Ft,imageSection:gt,fieldRules:Ue,viewRuleContext:le})}),O==="notes"&&a.jsx(kN,{entity:y,worldId:ce,selectedCampaign:f,selectedCampaignId:m,isCampaignDm:Be,isCampaignPlayer:at,canCreateNote:fe,notes:V.items,loading:V.loading,error:V.error,onReload:mt,onCreateNote:Dt,onNoteUpdate:At,onNoteDelete:Ke,creating:B,campaignMatchesEntityWorld:Pe}),O==="relationships"&&a.jsx(F4,{entity:y,toast:H,onExplore:Pt,canEdit:ct,relationshipsLoading:we,relationshipsError:se,sortedRelationships:Kt,filteredRelationships:ba,relationshipsEmptyMessage:fa,relationshipFilters:nt,relationshipFilterOptions:na,filterButtonDisabled:Bl,handleRelationshipFiltersChange:$s,handleRelationshipFiltersReset:va,showRelationshipForm:P,setShowRelationshipForm:G,worldId:jt,loadRelationships:tn}),O==="secrets"&&Qt&&a.jsx(H4,{entity:y,secrets:Rt,worldId:jt,canManageSecrets:Ut,onSecretCreated:et,onSecretUpdated:et}),O==="access"&&k&&ct&&a.jsx(B4,{canEdit:ct,worldId:jt,accessSettings:Qe,accessOptions:yt,accessOptionsError:ke,accessOptionsLoading:Ve,accessSaving:ft,accessSaveError:K,accessSaveSuccess:ae,handleAccessSettingChange:He}),O==="system"&&a.jsx(U4,{renderSchemaSections:Ft,systemSchema:dt,viewData:st})]})})]})}),a.jsx(hN,{open:U,destinationLabel:q?.label||"",saving:oe,onSaveAndContinue:ai,onContinueWithoutSaving:Un,onStay:ma})]})}function lI({initialData:e={},onSubmit:t,onCancel:r,submitting:i=!1,errorMessage:l,worlds:c=[]}){const[f,m]=u.useState({name:"",description:"",worldId:""}),[h,p]=u.useState("");u.useEffect(()=>{const S=e?.world_id||e?.worldId||e?.world?.id||"";m({name:e?.name||"",description:e?.description||"",worldId:S?String(S):""}),p("")},[e]);const y=u.useMemo(()=>f.name!==(e?.name||"")||f.description!==(e?.description||"")||f.worldId!==(e?.world_id||e?.worldId||e?.world?.id||""),[e,f.description,f.name,f.worldId]);u.useEffect(()=>{p(l||"")},[l]);const g=S=>w=>{const{value:N}=w.target;m(E=>({...E,[S]:N}))},v=async S=>{S.preventDefault();const w=f.name.trim();if(!w){p("Name is required.");return}const N=f.worldId.trim();if(!N){p("Select a world for this entity type.");return}p("");const E={name:w,description:f.description?.trim()||"",world_id:N};try{if(await t?.(E)===!1)return}catch(C){p(C.message||"Failed to save entity type")}};return a.jsxs("form",{className:"entity-type-form",onSubmit:v,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-type-name",children:"Name *"}),a.jsx("input",{id:"entity-type-name",type:"text",value:f.name,onChange:g("name"),placeholder:"e.g. Faction",disabled:i,autoFocus:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-type-world",children:"World *"}),a.jsxs("select",{id:"entity-type-world",value:f.worldId,onChange:g("worldId"),disabled:i,required:!0,children:[a.jsx("option",{value:"",children:"Select world..."}),c.map(S=>a.jsx("option",{value:S.id,children:S.name},S.id))]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-type-description",children:"Description"}),a.jsx("textarea",{id:"entity-type-description",value:f.description,onChange:g("description"),placeholder:"Optional description for this entity type",rows:5,disabled:i,className:"textarea-field"})]}),h&&a.jsx("div",{className:"form-error",role:"alert",children:h}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:r,disabled:i,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:i||!y,children:i?"Saving...":"Save"})]})]})}const oI=new Set(["system_admin"]);function cI(){const e=$n(),{user:t,token:r,sessionReady:i}=Nn(),{selectedCampaign:l,activeWorld:c,activeWorldId:f,contextKey:m}=Bn(),[h,p]=u.useState([]),[y,g]=u.useState(!1),[v,S]=u.useState(""),[w,N]=u.useState(!1),[E,C]=u.useState(null),[A,O]=u.useState(!1),[_,k]=u.useState(""),[D,j]=u.useState(""),[z,P]=u.useState(null),G=f||l?.world?.id||"",H=u.useRef(`${G}:${m}`),X=!!G,V=u.useMemo(()=>G?[{id:G,name:c?.name||l?.world?.name||"Untitled world"}]:[],[G,c?.name,l?.world?.name]),R=u.useMemo(()=>{const J=l?.world||c;return J&&(J.created_by||J.creator?.id||J.owner_id||J.owner?.id)||""},[l,c]),B=!!(t?.id&&R===t.id),I=u.useMemo(()=>t?t.role&&oI.has(t.role)?!0:B:!1,[t,B]),L=u.useMemo(()=>{if(l){const J=l.name||"Selected campaign",se=l.world?.name||c?.name;return se?`${J}  ${se}`:J}return c?c.name||"Selected world":""},[l,c]),$=u.useCallback((J,se="info")=>{P({message:J,tone:se})},[]);u.useEffect(()=>{if(!z)return;const J=setTimeout(()=>P(null),3500);return()=>clearTimeout(J)},[z]);const M=u.useCallback(async()=>{if(!r||!G)return g(!1),p([]),[];g(!0),S("");try{const J=await ti({worldId:G}),se=Array.isArray(J)?J:Array.isArray(J?.data)?J.data:[];return p(se),se}catch(J){return console.error(" Failed to load entity types",J),S(J.message||"Failed to load entity types"),p([]),[]}finally{g(!1)}},[r,G]);u.useEffect(()=>{if(!(!i||!r)){if(!G){p([]),S(""),g(!1);return}M()}},[i,r,G,M,m]),u.useEffect(()=>{const J=`${G}:${m}`;H.current!==J&&(N(!1),C(null),j(""),P(null),p([]),S(""),O(!1),k(""),H.current=J)},[G,m]);const U=()=>{!I||!X||e("/entity-types/new")},T=J=>{I&&(C(J),j(""),N(!0))},q=J=>{J?.id&&e(`/entity-types/${J.id}/fields`)},Y=()=>{N(!1),C(null),j("")},Q=async J=>{if(!E?.id)return j("No entity type selected for editing."),!1;try{O(!0),j(""),await ZR(E.id,J),$("Entity type updated","success"),Y(),await M()}catch(se){console.error(" Failed to save entity type",se);const ne=se.message||"Failed to save entity type";return j(ne),$(ne,"error"),!1}finally{O(!1)}return!0},oe=async J=>{if(!(!I||!J?.id||!window.confirm(`Delete entity type "${J.name}"? This action cannot be undone.`)))try{k(J.id),await QR(J.id),$("Entity type deleted","success"),E?.id===J.id&&Y(),await M()}catch(ne){console.error(" Failed to delete entity type",ne),$(ne.message||"Failed to delete entity type","error")}finally{k("")}},Z=J=>{if(!J)return"";const se=new Date(J);return Number.isNaN(se.getTime())?"":se.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},de=h.length;return i?r?a.jsxs("section",{className:"entity-types-page",children:[a.jsxs("div",{className:"entity-types-header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Entity Types"}),l?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"entity-types-subtitle",children:L}),a.jsxs("p",{className:"entity-types-subtitle",children:[de," types defined"]})]}):a.jsx("p",{className:"entity-types-subtitle",children:"Select a campaign or world you own to choose a world context."})]}),a.jsxs("button",{type:"button",className:"btn submit",onClick:U,disabled:!I||A||_||!X,children:[a.jsx(Va,{size:18})," Add Entity Type"]})]}),!I&&a.jsx("div",{className:"alert info",role:"status",children:"You can view the existing entity types, but only system administrators or the world owner can make changes."}),z&&a.jsx("div",{className:`toast-banner ${z.tone}`,role:"status",children:z.message}),v&&a.jsx("div",{className:"alert error",role:"alert",children:v}),a.jsx("div",{className:"entity-types-table-wrapper",children:X?y?a.jsx("div",{className:"empty-state",children:"Loading entity types..."}):h.length===0?a.jsx("div",{className:"empty-state",children:"No entity types defined yet."}):a.jsxs("table",{className:"entity-types-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Name"}),a.jsx("th",{children:"Description"}),a.jsx("th",{children:"World"}),a.jsx("th",{children:"Created"}),a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:h.map(J=>{const se=J.createdAt||J.created_at,ne=J?.world?.name||J?.world_name||J?.worldName||"";return a.jsxs("tr",{children:[a.jsx("td",{children:J.name}),a.jsx("td",{className:"description-cell",children:J.description?J.description:""}),a.jsx("td",{children:ne}),a.jsx("td",{children:Z(se)}),a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-type-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Manage fields",onClick:()=>q(J),children:a.jsx(D0,{size:16})}),I&&a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Edit entity type",onClick:()=>T(J),disabled:A||_===J.id,children:a.jsx(lr,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete entity type",onClick:()=>oe(J),disabled:_===J.id||A,children:a.jsx(ua,{size:16})})]})]})})]},J.id)})})]}):a.jsx("div",{className:"empty-state",children:"Select a campaign or world you own to view entity types."})}),a.jsx("div",{className:"entity-type-cards",children:X?y?a.jsx("div",{className:"card-placeholder",children:"Loading entity types..."}):h.length===0?a.jsx("div",{className:"card-placeholder",children:"No entity types defined yet."}):h.map(J=>{const se=J.createdAt||J.created_at;return a.jsxs("div",{className:"entity-type-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsx("h3",{children:J.name}),a.jsxs("div",{className:"entity-type-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Manage fields",onClick:()=>q(J),children:a.jsx(D0,{size:16})}),I&&a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Edit entity type",onClick:()=>T(J),disabled:A||_===J.id,children:a.jsx(lr,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete entity type",onClick:()=>oe(J),disabled:_===J.id||A,children:a.jsx(ua,{size:16})})]})]})]}),a.jsx("p",{className:"card-description",children:J.description?J.description:"No description"}),a.jsxs("p",{className:"card-meta",children:["World: ",J?.world?.name||J?.world_name||""]}),a.jsxs("p",{className:"card-meta",children:["Created ",Z(se)]})]},`card-${J.id}`)}):a.jsx("div",{className:"card-placeholder",children:"Select a campaign or world you own to view entity types."})}),w&&a.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"side-panel",children:[a.jsxs("div",{className:"side-panel-header",children:[a.jsx("h2",{children:E?"Edit Entity Type":"Add Entity Type"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:Y,title:"Close form",disabled:A,children:a.jsx(Da,{size:18})})]}),a.jsx("div",{className:"side-panel-content",children:a.jsx(lI,{initialData:E,onSubmit:Q,onCancel:Y,submitting:A,errorMessage:D,worlds:V})})]})})]}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const uI=[{value:"text",label:"Text"},{value:"number",label:"Number"},{value:"boolean",label:"Boolean"},{value:"date",label:"Date"},{value:"enum",label:"Enum"},{value:"reference",label:"Reference"}];function dI({initialData:e={},referenceTypes:t=[],onSubmit:r,onCancel:i,submitting:l=!1,errorMessage:c}){const[f,m]=u.useState({name:"",label:"",data_type:"text",required:!1,visibleByDefault:!0,enumChoices:"",reference_type_id:"",reference_filter:""}),[h,p]=u.useState("");u.useEffect(()=>{if(!e){m({name:"",label:"",data_type:"text",required:!1,visibleByDefault:!0,enumChoices:"",reference_type_id:"",reference_filter:""}),p("");return}const N=Array.isArray(e.options?.choices)?e.options.choices.join(", "):typeof e.options=="string"?e.options:"",E=e.reference_filter?typeof e.reference_filter=="string"?e.reference_filter:JSON.stringify(e.reference_filter,null,2):"";m({name:e.name||"",label:e.label||"",data_type:e.data_type||"text",required:!!e.required,visibleByDefault:e.visibleByDefault!==void 0?!!e.visibleByDefault:e.visible_by_default!==void 0?!!e.visible_by_default:!0,enumChoices:N,reference_type_id:e.reference_type_id||"",reference_filter:E}),p("")},[e]),u.useEffect(()=>{p(c||"")},[c]);const y=f.data_type==="enum",g=f.data_type==="reference",v=u.useMemo(()=>t.map(N=>({value:N.id,label:N.name})),[t]),S=N=>E=>{const{value:C,type:A,checked:O}=E.target;m(_=>({..._,[N]:A==="checkbox"?O:C}))},w=async N=>{N.preventDefault();const E=f.name.trim(),C=f.label.trim();if(!E){p("Field name is required.");return}if(!C){p("Field label is required.");return}if(!f.data_type){p("Data type is required.");return}let A={};if(g){if(!f.reference_type_id){p("Reference type is required for reference fields.");return}const _=f.reference_filter.trim();if(_)try{if(A=JSON.parse(_),typeof A!="object"||Array.isArray(A))throw new Error("Reference filter must be a JSON object.")}catch(k){p(k.message||"Reference filter must be valid JSON.");return}}const O={name:E,label:C,data_type:f.data_type,required:!!f.required,visible_by_default:!!f.visibleByDefault};if(y){const _=f.enumChoices.split(",").map(k=>k.trim()).filter(Boolean);if(!_.length){p("Enum options are required for enum fields.");return}O.options={choices:_}}else O.options={};g?(O.reference_type_id=f.reference_type_id,O.reference_filter=A):(O.reference_type_id=null,O.reference_filter={});try{if(await r?.(O)===!1)return;p("")}catch(_){p(_.message||"Failed to save field")}};return a.jsxs("form",{className:"entity-type-field-form",onSubmit:w,children:[a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-field-name",children:"Field Name *"}),a.jsx("input",{id:"entity-field-name",type:"text",value:f.name,onChange:S("name"),placeholder:"e.g. alignment",disabled:l})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-field-label",children:"Label *"}),a.jsx("input",{id:"entity-field-label",type:"text",value:f.label,onChange:S("label"),placeholder:"e.g. Alignment",disabled:l})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-field-data-type",children:"Data Type *"}),a.jsx("select",{id:"entity-field-data-type",value:f.data_type,onChange:S("data_type"),disabled:l,children:uI.map(N=>a.jsx("option",{value:N.value,children:N.label},N.value))}),a.jsx("p",{className:"field-hint",children:"Determines how the value is stored and rendered in entity forms."})]}),a.jsxs("div",{className:"form-group checkbox-group",children:[a.jsxs("div",{className:"checkbox-control",children:[a.jsx("input",{id:"entity-field-required",type:"checkbox",checked:f.required,onChange:S("required"),disabled:l}),a.jsx("label",{htmlFor:"entity-field-required",children:"Required"})]}),a.jsx("span",{className:"field-hint",children:"Mark as required on entity forms."})]}),a.jsxs("div",{className:"form-group checkbox-group",children:[a.jsxs("div",{className:"checkbox-control",children:[a.jsx("input",{id:"entity-field-visible-default",type:"checkbox",checked:f.visibleByDefault,onChange:S("visibleByDefault"),disabled:l}),a.jsx("label",{htmlFor:"entity-field-visible-default",children:"Visible by default"})]}),a.jsx("span",{className:"field-hint",children:"Uncheck to hide this field unless a rule explicitly shows it."})]}),y&&a.jsxs("div",{className:"form-group form-group-full",children:[a.jsx("label",{htmlFor:"entity-field-options",children:"Enum Options *"}),a.jsx("textarea",{id:"entity-field-options",value:f.enumChoices,onChange:S("enumChoices"),placeholder:"Comma separated values, e.g. Lawful Good, Neutral, Chaotic Evil",rows:3,disabled:l}),a.jsx("p",{className:"field-hint",children:"Comma-separated list of allowed values."})]}),g&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group form-group-full",children:[a.jsx("label",{htmlFor:"entity-field-reference-type",children:"Reference Type *"}),a.jsxs("select",{id:"entity-field-reference-type",value:f.reference_type_id,onChange:S("reference_type_id"),disabled:l,children:[a.jsx("option",{value:"",children:"Select entity type"}),v.map(N=>a.jsx("option",{value:N.value,children:N.label},N.value))]}),a.jsx("p",{className:"field-hint",children:"Choose which entity type this field should reference."})]}),a.jsxs("div",{className:"form-group form-group-full",children:[a.jsx("label",{htmlFor:"entity-field-reference-filter",children:"Reference Filter"}),a.jsx("textarea",{id:"entity-field-reference-filter",value:f.reference_filter,onChange:S("reference_filter"),placeholder:'Optional JSON filter, e.g. {"metadata.subtype": "Town"}',rows:4,disabled:l}),a.jsx("p",{className:"field-hint",children:"Limit selectable entities by filter criteria."})]})]})]}),h&&a.jsx("div",{className:"form-error",role:"alert",children:h}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:i,disabled:l,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:l,children:l?"Saving...":"Save Field"})]})]})}const fI=[{value:"equals",label:"Equals"},{value:"not_equals",label:"Does not equal"},{value:"contains",label:"Contains"},{value:"not_contains",label:"Does not contain"},{value:"in",label:"Is one of"},{value:"not_in",label:"Is not one of"},{value:"gt",label:"Greater than"},{value:"gte",label:"Greater than or equal"},{value:"lt",label:"Less than"},{value:"lte",label:"Less than or equal"},{value:"is_set",label:"Has a value"},{value:"is_not_set",label:"Is empty"}],mI=[{value:"show",label:"Show field"},{value:"hide",label:"Hide field"}],hI=[{value:"all",label:"All conditions must match"},{value:"any",label:"Any condition can match"},{value:"none",label:"None of the conditions can match"}],pI=new Set(["is_set","is_not_set"]),Jp=()=>({field:"",operator:"equals",valuesText:""}),ey=()=>({target:"",action:"show"}),yI=(e=[])=>Array.isArray(e)?e.map((t,r)=>{if(t==null)return null;if(typeof t=="object"){const l=t.value??t.id??t.key??t.slug??`choice-${r}`;if(l==null)return null;const c=t.label??t.name??t.title??t.display??l;return{value:String(l),label:String(c??l)}}const i=String(t);return{value:i,label:i}}).filter(Boolean):[],gI=(e=[])=>!Array.isArray(e)||!e.length?[Jp()]:e.map(t=>({field:t.field||t.fieldKey||"",operator:t.operator||"equals",valuesText:Array.isArray(t.values)?t.values.join(", "):""})),bI=(e=[])=>!Array.isArray(e)||!e.length?[ey()]:e.map(t=>({target:t.target||t.field||"",action:t.action||"show"})),fp=e=>e.split(",").map(t=>t.trim()).filter(t=>t.length>0);function vI({fields:e=[],initialData:t=null,onSubmit:r,onCancel:i,submitting:l=!1,errorMessage:c=""}){const[f,m]=u.useState(""),[h,p]=u.useState("all"),[y,g]=u.useState([Jp()]),[v,S]=u.useState([ey()]),[w,N]=u.useState("");u.useEffect(()=>{m(t?.name||""),p(t?.match_mode||t?.matchMode||"all"),g(gI(t?.conditions)),S(bI(t?.actions))},[t]),u.useEffect(()=>{N(c||"")},[c]);const E=u.useMemo(()=>e.map(H=>({value:H.id||H.name,label:H.label||H.name})),[e]),C=u.useMemo(()=>{const H=new Map;return e.forEach(X=>{if(!X)return;const V=R=>{if(R==null)return;const B=String(R);B&&(H.set(B,X),H.set(B.toLowerCase(),X))};V(X.id),V(X.field_id),V(X.fieldId),V(X.name),V(X.key)}),H},[e]),A=u.useCallback(H=>{if(H==null)return null;const X=String(H);return C.get(X)||C.get(X.toLowerCase())||null},[C]),O=(H,X,V)=>{g(R=>{const B=R.slice();return B[H]={...B[H],[X]:V},B})},_=(H,X,V)=>{S(R=>{const B=R.slice();return B[H]={...B[H],[X]:V},B})},k=()=>g(H=>[...H,Jp()]),D=H=>g(X=>X.length===1?X:X.filter((V,R)=>R!==H)),j=()=>S(H=>[...H,ey()]),z=H=>S(X=>X.length===1?X:X.filter((V,R)=>R!==H)),P=u.useCallback((H,X)=>{g(V=>{if(!Array.isArray(V)||H<0||H>=V.length)return V;const R=V.slice(),B=R[H];if(!B)return V;const I=fp(B.valuesText||""),L=String(X);let $;return I.includes(L)?$=I.filter(M=>M!==L):$=[...I,L],R[H]={...B,valuesText:$.join(", ")},R})},[]),G=async H=>{if(H.preventDefault(),!y.length){N("Add at least one condition.");return}if(!v.length){N("Add at least one action.");return}const X=y.map(B=>({field:B.field,operator:B.operator,values:fp(B.valuesText||"")})).filter(B=>B.field&&B.operator);if(!X.length){N("Each condition needs a field and operator.");return}const V=v.map(B=>({target:B.target,action:B.action})).filter(B=>B.target&&B.action);if(!V.length){N("Each action needs a target and action type.");return}const R={name:f.trim(),match_mode:h,conditions:X,actions:V};try{if(await r?.(R)===!1)return;N("")}catch(B){N(B.message||"Failed to save rule")}};return a.jsxs("form",{className:"field-rule-form",onSubmit:G,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"field-rule-name",children:"Rule Name"}),a.jsx("input",{id:"field-rule-name",type:"text",value:f,onChange:H=>m(H.target.value),placeholder:"e.g. Show hometown when origin is set",disabled:l})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"field-rule-match-mode",children:"When should this rule run?"}),a.jsx("select",{id:"field-rule-match-mode",value:h,onChange:H=>p(H.target.value),disabled:l,children:hI.map(H=>a.jsx("option",{value:H.value,children:H.label},H.value))})]}),a.jsxs("div",{className:"field-rule-editor-section",children:[a.jsxs("div",{className:"field-rule-editor-heading",children:[a.jsx("h3",{children:"Conditions"}),a.jsx("button",{type:"button",className:"btn ghost",onClick:k,disabled:l,children:"Add condition"})]}),a.jsx("p",{className:"field-hint",children:"Fields to watch before applying the actions."}),a.jsx("div",{className:"field-rule-list",role:"list",children:y.map((H,X)=>a.jsxs("div",{className:"field-rule-row",role:"listitem",children:[a.jsxs("select",{value:H.field,onChange:V=>O(X,"field",V.target.value),disabled:l,children:[a.jsx("option",{value:"",children:"Choose field"}),E.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))]}),a.jsx("select",{value:H.operator,onChange:V=>O(X,"operator",V.target.value),disabled:l,children:fI.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))}),(()=>{const V=A(H.field),B=(V?.data_type||V?.dataType)==="enum"?yI(V?.options?.choices):[],I=pI.has(H.operator);if(!I&&B.length>0){const $=new Set(fp(H.valuesText||""));return a.jsx("div",{className:"field-rule-enum-values",role:"group","aria-label":"Enum choices",children:B.map(M=>a.jsxs("label",{className:"field-rule-enum-option",children:[a.jsx("input",{type:"checkbox",checked:$.has(M.value),onChange:()=>P(X,M.value),disabled:l}),a.jsx("span",{children:M.label})]},`${M.value}-${X}`))})}return a.jsx("input",{type:"text",value:H.valuesText,onChange:$=>O(X,"valuesText",$.target.value),placeholder:"Comma separated values",disabled:l||I})})(),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>D(X),disabled:y.length===1||l,title:"Remove condition",children:""})]},`condition-${X}`))})]}),a.jsxs("div",{className:"field-rule-editor-section",children:[a.jsxs("div",{className:"field-rule-editor-heading",children:[a.jsx("h3",{children:"Actions"}),a.jsx("button",{type:"button",className:"btn ghost",onClick:j,disabled:l,children:"Add action"})]}),a.jsx("p",{className:"field-hint",children:"Choose what should happen when the conditions above match."}),a.jsx("div",{className:"field-rule-list",role:"list",children:v.map((H,X)=>a.jsxs("div",{className:"field-rule-row",role:"listitem",children:[a.jsxs("select",{value:H.target,onChange:V=>_(X,"target",V.target.value),disabled:l,children:[a.jsx("option",{value:"",children:"Choose field"}),E.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))]}),a.jsx("select",{value:H.action,onChange:V=>_(X,"action",V.target.value),disabled:l,children:mI.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>z(X),disabled:v.length===1||l,title:"Remove action",children:""})]},`action-${X}`))})]}),w&&a.jsx("div",{className:"form-error",role:"alert",children:w}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:i,disabled:l,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:l,children:l?"Saving":"Save Rule"})]})]})}const xI=new Set(["system_admin"]),mp={text:"Text",number:"Number",boolean:"Boolean",date:"Date",enum:"Enum",reference:"Reference"},SI={equals:"equals",not_equals:"does not equal",contains:"contains",not_contains:"does not contain",in:"is one of",not_in:"is not one of",gt:"is greater than",gte:"is greater than or equal to",lt:"is less than",lte:"is less than or equal to",is_set:"is set",is_not_set:"is empty"},wI={show:"Show",hide:"Hide"},wS={all:"All conditions must match",any:"Any condition can match",none:"No conditions can match"};function NI(){const{id:e}=ws(),t=$n(),{user:r,token:i,sessionReady:l}=Nn(),[c,f]=u.useState(null),[m,h]=u.useState([]),[p,y]=u.useState([]),[g,v]=u.useState(!1),[S,w]=u.useState(!1),[N,E]=u.useState(""),[C,A]=u.useState(""),[O,_]=u.useState(!1),[k,D]=u.useState(null),[j,z]=u.useState(!1),[P,G]=u.useState(""),[H,X]=u.useState(""),[V,R]=u.useState(null),[B,I]=u.useState([]),[L,$]=u.useState([]),[M,U]=u.useState([]),[T,q]=u.useState(!1),[Y,Q]=u.useState(!1),[oe,Z]=u.useState(""),[de,J]=u.useState(!1),[se,ne]=u.useState(!1),[we,Le]=u.useState(""),[Me,Ae]=u.useState(!1),[ot,ze]=u.useState(null),[nt,$e]=u.useState(!1),[vt,_t]=u.useState(""),[Tt,Ct]=u.useState(""),[Be,at]=u.useState(""),fe=c?.name||"Entity Type",ce=u.useMemo(()=>!c||!r?!1:xI.has(r.role)||c.world_owner_id&&c.world_owner_id===r.id||c.created_by&&c.created_by===r.id?!0:Array.isArray(c.managers)?c.managers.some(ie=>ie===r.id):!1,[c,r]),ye=ie=>{if(!ie)return"";const{options:_e}=ie;return _e?Array.isArray(_e.choices)&&_e.choices.length>0?_e.choices.join(", "):typeof _e=="string"&&_e.trim()?_e:"":""},Pe=u.useCallback((ie,_e="info")=>{R({message:ie,tone:_e})},[]);u.useEffect(()=>{if(!V)return;const ie=setTimeout(()=>R(null),3500);return()=>clearTimeout(ie)},[V]);const ee=ie=>ie?Array.isArray(ie)?ie:ie?.data?ie.data:ie:null,pe=u.useCallback(async()=>{if(e){v(!0),E("");try{const ie=await WR(e),_e=ee(ie);f(_e)}catch(ie){console.error(" Failed to load entity type details",ie),E(ie.message||"Failed to load entity type")}finally{v(!1)}}},[e]),me=u.useCallback(async ie=>{const _e=typeof ie=="string"?ie.trim():ie||"";if(!_e){h([]);return}try{const qe=await ti({worldId:_e}),ht=ee(qe);Array.isArray(ht)?h(ht):h([])}catch(qe){console.error(" Failed to load reference types",qe),h([])}},[]),Se=u.useCallback(async()=>{if(e){w(!0),A("");try{const ie=await rN(e),_e=ee(ie);y(Array.isArray(_e)?_e:[])}catch(ie){console.error(" Failed to load fields",ie),A(ie.message||"Failed to load fields"),y([])}finally{w(!1)}}},[e]),Ge=u.useCallback(async()=>{if(e){J(!0),ne(!0),Z(""),Le("");try{const[ie,_e]=await Promise.all([cf(e).catch(qe=>(console.error(" Failed to load field order",qe),Z(qe.message||"Failed to load field order"),null)),uf(e).catch(qe=>(console.error(" Failed to load field rules",qe),Le(qe.message||"Failed to load conditional rules"),null))]);I(Zr(ie)),$(Zr(_e))}catch(ie){Z(ie.message||"Failed to load field order"),Le(ie.message||"Failed to load conditional rules"),I([]),$([])}finally{J(!1),ne(!1)}}},[e]);u.useEffect(()=>{!l||!i||(pe(),Se(),Ge())},[l,i,pe,Se,Ge]),u.useEffect(()=>{if(!c){h([]);return}const ie=c?.world_id||c?.worldId||c?.world?.id||"";me(ie)},[c,c?.world_id,c?.worldId,c?.world?.id,me]),u.useEffect(()=>{l&&(i||t("/login"))},[l,i,t]);const Xe=u.useCallback(()=>!Array.isArray(p)||p.length===0?[]:Hy(p,B).map((_e,qe)=>({id:_e.id,name:_e.name,label:_e.label||_e.name,data_type:_e.data_type,required:_e.required,order:qe})),[p,B]);u.useEffect(()=>{T||U(Xe())},[Xe,T]);const et=u.useCallback(()=>{q(!1),U(Xe())},[Xe]),Te=u.useMemo(()=>{const ie=new Map;return p.forEach(_e=>{if(!_e)return;const qe=_e.label||_e.name||"Field";_e.id&&(ie.set(_e.id,qe),ie.set(String(_e.id).toLowerCase(),qe)),_e.name&&(ie.set(_e.name,qe),ie.set(_e.name.toLowerCase(),qe))}),ie},[p]),mt=u.useCallback(ie=>{if(!ie)return"";const _e=Te.get(ie.field)||ie.field,qe=SI[ie.operator]||ie.operator,ht=Array.isArray(ie.values)?ie.values.filter(Boolean):[];return!ht.length||["is_set","is_not_set"].includes(ie.operator)?`${_e} ${qe}`:`${_e} ${qe} ${ht.join(", ")}`},[Te]),Dt=u.useCallback(ie=>{if(!ie)return"";const _e=Te.get(ie.target)||ie.target;return`${wI[ie.action]||ie.action} ${_e}`},[Te]),At=()=>{ce&&(D(null),X(""),_(!0))},Ke=ie=>{ce&&(D(ie),X(""),_(!0))},ct=()=>{_(!1),D(null),X("")},Rt=async ie=>{if(!ce)return!1;try{z(!0),X(""),k?.id?(await B3(k.id,ie),Pe("Field updated","success")):(await F3(e,ie),Pe("Field created","success")),ct(),await Se(),await Ge()}catch(_e){console.error(" Failed to save field",_e);const qe=_e.message||"Failed to save field";return X(qe),Pe(qe,"error"),!1}finally{z(!1)}return!0},Ut=async ie=>{if(!(!ce||!ie?.id||!window.confirm(`Delete field "${ie.label||ie.name}"? This action cannot be undone.`)))try{G(ie.id),await U3(ie.id),Pe("Field deleted","success"),await Se(),await Ge()}catch(qe){console.error(" Failed to delete field",qe),Pe(qe.message||"Failed to delete field","error")}finally{G("")}},Qt=(ie,_e)=>{U(qe=>{const ht=ie+_e;if(ht<0||ht>=qe.length)return qe;const pt=qe.slice(),[Ee]=pt.splice(ie,1);return pt.splice(ht,0,Ee),pt.map((st,le)=>({...st,order:le}))}),q(!0)},wt=async()=>{if(!(!ce||!T)){Q(!0);try{const ie=M.map((_e,qe)=>({field_id:_e.id,section_order:0,column_order:0,field_order:qe,priority:qe}));await JR(e,{entries:ie}),Pe("Field order updated","success"),q(!1),await Ge()}catch(ie){const _e=ie.message||"Failed to update field order";Z(_e),Pe(_e,"error")}finally{Q(!1)}}},Ft=(ie=null)=>{ce&&(ze(ie),_t(""),Ae(!0))},Ht=()=>{Ae(!1),ze(null),_t("")},kt=async ie=>{if(!ce)return!1;try{$e(!0),_t(""),ot?.id?(await Fh(ot.id,ie),Pe("Rule updated","success")):(await ek(e,ie),Pe("Rule created","success")),Ht(),await Ge()}catch(_e){const qe=_e.message||"Failed to save rule";return _t(qe),Pe(qe,"error"),!1}finally{$e(!1)}return!0},te=async ie=>{if(!(!ce||!ie?.id||!window.confirm(`Delete the rule "${ie.name||"Untitled rule"}"?`)))try{Ct(ie.id),await tk(ie.id),Pe("Rule deleted","success"),await Ge()}catch(qe){Pe(qe.message||"Failed to delete rule","error")}finally{Ct("")}},be=async(ie,_e)=>{if(!ce||!ie?.id)return;const qe=L.findIndex(Ee=>Ee.id===ie.id),ht=qe+_e;if(qe===-1||ht<0||ht>=L.length)return;const pt=L[ht];try{at(ie.id),await Promise.all([Fh(ie.id,{priority:ht}),Fh(pt.id,{priority:qe})]),Pe("Rule order updated","success"),await Ge()}catch(Ee){Pe(Ee.message||"Failed to reorder rule","error")}finally{at("")}},ve=ie=>{if(!ie)return"";const _e=new Date(ie);return Number.isNaN(_e.getTime())?"":_e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},Ue=u.useMemo(()=>{const ie=new Map;return m.forEach(_e=>{_e?.id&&ie.set(_e.id,_e.name)}),ie},[m]),it=u.useMemo(()=>!Array.isArray(m)||!m.length?[]:c?.world_id?m.filter(ie=>{if(!ie)return!1;if(!c.world_id)return!0;const _e=ie.world_id??ie.worldId??ie.world?.id;return _e?_e===c.world_id:!0}):m,[c,m]),xt=N||C;return l?i?a.jsxs("section",{className:"entity-type-fields-page",children:[a.jsxs("div",{className:"entity-type-fields-header",children:[a.jsxs("div",{className:"entity-type-fields-heading",children:[a.jsxs("button",{type:"button",className:"link-button",onClick:()=>t("/entity-types"),children:[a.jsx(Ry,{size:16})," Back to Entity Types"]}),a.jsxs("h1",{children:["Fields for ",fe]}),c?.world_name&&a.jsxs("p",{className:"entity-type-fields-subtitle",children:["World: ",c.world_name]})]}),ce&&a.jsxs("button",{type:"button",className:"btn submit",onClick:At,disabled:j||P,children:[a.jsx(Va,{size:18})," Add Field"]})]}),!ce&&a.jsx("div",{className:"alert info",role:"status",children:"You can view these fields, but only the world owner or system administrators can make changes."}),V&&a.jsx("div",{className:`toast-banner ${V.tone}`,role:"status",children:V.message}),xt&&a.jsx("div",{className:"alert error",role:"alert",children:xt}),a.jsx("div",{className:"entity-types-table-wrapper",children:g||S?a.jsx("div",{className:"empty-state",children:"Loading fields..."}):p.length===0?a.jsx("div",{className:"empty-state",children:"No custom fields defined yet."}):a.jsxs("table",{className:"entity-types-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Field Name"}),a.jsx("th",{children:"Label"}),a.jsx("th",{children:"Data Type"}),a.jsx("th",{children:"Reference Type"}),a.jsx("th",{children:"Required"}),a.jsx("th",{children:"Created"}),ce&&a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:p.map(ie=>{const _e=ie.createdAt||ie.created_at,qe=ie.reference_type_name||Ue.get(ie.reference_type_id),ht=mp[ie.data_type]||ie.data_type;return a.jsxs("tr",{children:[a.jsx("td",{children:ie.name}),a.jsx("td",{children:ie.label||""}),a.jsx("td",{children:ht}),a.jsx("td",{children:qe||(ie.data_type==="reference"?"":"N/A")}),a.jsx("td",{children:ie.required?"Yes":"No"}),a.jsx("td",{children:ve(_e)}),ce&&a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-type-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Edit field",onClick:()=>Ke(ie),disabled:j||P===ie.id,children:a.jsx(lr,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete field",onClick:()=>Ut(ie),disabled:P===ie.id||j,children:a.jsx(ua,{size:16})})]})})]},ie.id)})})]})}),a.jsxs("section",{className:"field-layout-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsxs("h2",{children:[a.jsx(S1,{size:18})," Field order"]}),ce&&a.jsxs("div",{className:"layout-card-actions",children:[a.jsx("button",{type:"button",className:"btn ghost",onClick:et,disabled:Y||!T,children:"Reset"}),a.jsx("button",{type:"button",className:"btn submit",onClick:wt,disabled:Y||!T||M.length===0,children:Y?"Saving":"Save order"})]})]}),a.jsx("p",{className:"card-description",children:"Use this list to control how the metadata fields appear on entity forms and detail pages."}),oe&&a.jsx("div",{className:"alert error",role:"alert",children:oe}),de?a.jsx("div",{className:"card-placeholder",children:"Loading layout"}):M.length===0?a.jsx("div",{className:"card-placeholder",children:"No fields available to order yet."}):a.jsx("ol",{className:"field-layout-list",children:M.map((ie,_e)=>a.jsxs("li",{className:"field-layout-row",children:[a.jsxs("div",{className:"field-layout-info",children:[a.jsx("span",{className:"field-layout-index",children:_e+1}),a.jsxs("div",{className:"field-layout-details",children:[a.jsx("span",{className:"field-layout-name",children:ie.label||ie.name}),a.jsx("span",{className:"field-layout-meta",children:mp[ie.data_type]||ie.data_type})]})]}),ce&&a.jsxs("div",{className:"layout-controls",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Qt(_e,-1),disabled:_e===0||Y,title:"Move up",children:a.jsx(A0,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Qt(_e,1),disabled:_e===M.length-1||Y,title:"Move down",children:a.jsx(C0,{size:16})})]})]},ie.id||ie.name||_e))})]}),a.jsxs("section",{className:"field-rules-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsxs("h2",{children:[a.jsx(Li,{size:18})," Conditional rules"]}),ce&&a.jsxs("button",{type:"button",className:"btn submit",onClick:()=>Ft(null),disabled:nt,children:[a.jsx(Va,{size:16})," Add rule"]})]}),a.jsx("p",{className:"card-description",children:"Automatically show or hide fields when other metadata matches specific conditions."}),we&&a.jsx("div",{className:"alert error",role:"alert",children:we}),se?a.jsx("div",{className:"card-placeholder",children:"Loading rules"}):L.length===0?a.jsx("div",{className:"card-placeholder",children:"No conditional rules have been configured."}):a.jsx("div",{className:"field-rules-list",children:L.map((ie,_e)=>a.jsxs("article",{className:"field-rule-card",children:[a.jsxs("div",{className:"field-rule-content",children:[a.jsx("h3",{children:ie.name||`Rule ${_e+1}`}),a.jsx("p",{className:"field-rule-match",children:wS[ie.match_mode]||wS.all}),a.jsx("ul",{className:"field-rule-condition-list",children:Array.isArray(ie.conditions)&&ie.conditions.map((qe,ht)=>a.jsx("li",{children:mt(qe)},`condition-${ie.id}-${ht}`))}),a.jsx("div",{className:"field-rule-action-list",children:Array.isArray(ie.actions)&&ie.actions.map((qe,ht)=>a.jsx("span",{children:Dt(qe)},`action-${ie.id}-${ht}`))})]}),ce&&a.jsxs("div",{className:"field-rule-controls",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>be(ie,-1),disabled:_e===0||Be===ie.id,title:"Move rule up",children:a.jsx(A0,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>be(ie,1),disabled:_e===L.length-1||Be===ie.id,title:"Move rule down",children:a.jsx(C0,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Ft(ie),title:"Edit rule",disabled:nt||Tt===ie.id,children:a.jsx(lr,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>te(ie),title:"Delete rule",disabled:Tt===ie.id||nt,children:a.jsx(ua,{size:16})})]})]},ie.id))})]}),a.jsx("div",{className:"entity-type-cards",children:g||S?a.jsx("div",{className:"card-placeholder",children:"Loading fields..."}):p.length===0?a.jsx("div",{className:"card-placeholder",children:"No custom fields defined yet."}):p.map(ie=>{const _e=ie.createdAt||ie.created_at,qe=ie.reference_type_name||Ue.get(ie.reference_type_id),ht=mp[ie.data_type]||ie.data_type;return a.jsxs("div",{className:"entity-type-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsx("h3",{children:ie.label||ie.name}),ce&&a.jsxs("div",{className:"entity-type-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Edit field",onClick:()=>Ke(ie),disabled:j||P===ie.id,children:a.jsx(lr,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete field",onClick:()=>Ut(ie),disabled:P===ie.id||j,children:a.jsx(ua,{size:16})})]})]}),a.jsxs("dl",{className:"field-card-metadata",children:[a.jsxs("div",{children:[a.jsx("dt",{children:"Field Name"}),a.jsx("dd",{children:ie.name})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Data Type"}),a.jsx("dd",{children:ht})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Required"}),a.jsx("dd",{children:ie.required?"Yes":"No"})]}),ie.data_type==="enum"&&a.jsxs("div",{children:[a.jsx("dt",{children:"Options"}),a.jsx("dd",{children:ye(ie)})]}),ie.data_type==="reference"&&a.jsxs("div",{children:[a.jsx("dt",{children:"Reference Type"}),a.jsx("dd",{children:qe||""})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Created"}),a.jsx("dd",{children:ve(_e)})]})]})]},`field-card-${ie.id}`)})}),O&&a.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"side-panel",children:[a.jsxs("div",{className:"side-panel-header",children:[a.jsx("h2",{children:k?"Edit Field":"Add Field"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:ct,title:"Close form",disabled:j,children:a.jsx(Da,{size:18})})]}),a.jsx("div",{className:"side-panel-content",children:a.jsx(dI,{initialData:k,referenceTypes:it,onSubmit:Rt,onCancel:ct,submitting:j,errorMessage:H})})]})}),Me&&a.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"side-panel",children:[a.jsxs("div",{className:"side-panel-header",children:[a.jsx("h2",{children:ot?"Edit conditional rule":"Add conditional rule"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:Ht,title:"Close form",disabled:nt,children:a.jsx(Da,{size:18})})]}),a.jsx("div",{className:"side-panel-content",children:a.jsx(vI,{fields:p,initialData:ot,onSubmit:kt,onCancel:Ht,submitting:nt,errorMessage:vt})})]})})]}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const EI="Create Entity Type",jI=[{title:"Details",columns:1,fields:[{key:"name",label:"Name",type:"text",placeholder:"e.g. Faction"},{key:"world_id",label:"World",type:"select",optionsSource:"worlds",placeholder:"Select the world this type belongs to",required:!0},{key:"description",label:"Description",type:"textarea",placeholder:"Optional description for this entity type"}]}],_I={title:EI,sections:jI};function CI(){const e=$n(),{user:t,token:r,sessionReady:i}=Nn(),{selectedCampaign:l}=Bn(),[c,f]=u.useState(!1),m=u.useMemo(()=>{if(!l?.world)return"";const w=l.world;return w.created_by||w.creator?.id||w.owner_id||w.owner?.id||""},[l]),h=!!(t?.id&&m===t.id),p=u.useMemo(()=>t?t.role==="system_admin"?!0:h:!1,[t,h]),y=l?.world?.id??"",g=l?.world?.name??"";if(!i)return a.jsx("p",{children:"Restoring session..."});if(!r)return a.jsx("p",{children:"Authenticating..."});if(!p)return a.jsxs("section",{className:"page limited-access",children:[a.jsx("h1",{children:"Create Entity Type"}),a.jsx("p",{children:"Only system administrators or the world owner can create entity types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/entity-types"),children:"Back to Entity Types"})]});if(!y)return a.jsxs("section",{className:"page create-entity-type",children:[a.jsx("h1",{children:"Create Entity Type"}),a.jsx("p",{children:"Select a campaign from the header to choose a world context before creating entity types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/entity-types"),children:"Back to Entity Types"})]});const v=()=>{e("/entity-types")},S=async w=>{if(c)return!1;const N=typeof w?.name=="string"?w.name.trim():"",E=typeof w?.description=="string"?w.description.trim():"",A=(typeof w?.world_id=="string"&&w.world_id||typeof w?.worldId=="string"&&w.worldId||w?.world&&typeof w.world.id=="string"&&w.world.id||y||"").trim();if(!N)return alert("Name is required"),!1;if(!A)return alert("Select a world before creating the entity type"),!1;f(!0);try{const _=await KR({name:N,description:E,world_id:A}),k=_?.data??_;return!k||!k.id?(alert("Failed to create entity type"),!1):(e(`/entity-types/${k.id}/fields`),!0)}catch(O){return alert(`Failed to create entity type: ${O.message}`),!1}finally{f(!1)}};return a.jsxs("section",{className:"page create-entity-type",children:[c&&a.jsx("div",{className:"form-status",role:"status","aria-live":"polite",children:"Saving entity type..."}),a.jsx(bs,{schema:_I,initialData:{world_id:y,world:y?{id:y,name:g||"Selected world"}:void 0},onSubmit:S,onCancel:v,showUpdateAction:!1})]})}const DN=u.createContext({}),AI=new Set(["true","1","yes","on"]),NS=e=>{if(e==null)return;if(typeof e=="boolean")return e;const t=String(e).trim().toLowerCase();if(t!=="")return AI.has(t)},TI=e=>{const t=NS(e);if(t!==void 0)return t;const r=NS(void 0);return r!==void 0?r:!1};function MI({children:e,initialFeatures:t={}}){const r=TI(t.rel_builder_v2),i=u.useMemo(()=>({...t,rel_builder_v2:r}),[t,r]);return a.jsx(DN.Provider,{value:i,children:e})}const RI=()=>u.useContext(DN),kI=e=>!!RI()?.[e],DI="visible",II=e=>{if(!e)return null;const t=e.id??e.value??e.entity_type_id??e.entityTypeId??(typeof e=="string"||typeof e=="number"?e:null);if(t==null||t==="")return null;const r=e.name||e.label||e.title||e.display||e.slug||(typeof e=="string"||typeof e=="number"?String(e):"Untitled type");return{id:String(t),name:String(r)}};function ES({allowedTypeIds:e=[],defaultTypeId:t="",worldId:r,onCreated:i,onCancel:l,entityTypes:c=[],onToast:f}){const[m,h]=u.useState({name:"",entityTypeId:"",summary:""}),[p,y]=u.useState(!1),[g,v]=u.useState(""),[S,w]=u.useState(""),N=u.useRef(!1),E=u.useMemo(()=>new Set((e||[]).map(j=>String(j))),[e]),C=u.useMemo(()=>{const j=(Array.isArray(c)?c:[]).map(z=>II(z)).filter(Boolean);return E.size===0?j:j.filter(z=>E.has(z.id))},[c,E]),A=u.useMemo(()=>t&&E.size>0&&E.has(String(t))?String(t):C.length>0?C[0].id:t?String(t):"",[t,E,C]);u.useEffect(()=>{h(j=>({...j,entityTypeId:A}))},[A]);const O=u.useCallback(()=>{h({name:"",entityTypeId:A,summary:""}),v(""),w(""),N.current=!1},[A]),_=j=>z=>{const{value:P}=z.target;h(G=>({...G,[j]:P}))};u.useEffect(()=>{if(!m.entityTypeId){w("");return}E.size>0&&!E.has(String(m.entityTypeId))?(w("This type is not allowed for the selected relationship."),N.current||(f?.("This entity type is not allowed for this relationship.","warning"),N.current=!0)):(w(""),N.current=!1)},[m.entityTypeId,E,f]);const k=async j=>{if(j.preventDefault(),!r){v("Select a world before creating entities.");return}const z=m.name.trim();if(!z){v("Name is required.");return}const P=m.entityTypeId;if(!P){v("Entity type is required.");return}if(E.size>0&&!E.has(String(P))){w("This type is not allowed for the selected relationship."),N.current||(f?.("This entity type is not allowed for this relationship.","warning"),N.current=!0);return}try{y(!0),v("");const G={world_id:r,name:z,entity_type_id:P,visibility:DI},H=m.summary.trim();H&&(G.description=H);const X=await By(G),V=X?.data?.data??X?.data??X;if(!V||V.id===void 0||V.id===null)throw new Error("Failed to create entity");i?.(V),O()}catch(G){v(G.message||"Could not create entity. Please try again."),f?.("Could not create entity. Please try again.","error")}finally{y(!1)}},D=p||!m.name.trim()||!m.entityTypeId||E.size>0&&!E.has(String(m.entityTypeId))||C.length===0;return a.jsxs("div",{className:"entity-mini-create-inline",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-mini-name",children:"Name *"}),a.jsx("input",{id:"entity-mini-name",type:"text",value:m.name,onChange:_("name"),disabled:p,required:!0})]}),a.jsxs("div",{className:"form-two-column",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-mini-type",children:"Type *"}),a.jsxs("select",{id:"entity-mini-type",value:m.entityTypeId,onChange:_("entityTypeId"),disabled:p||C.length===0,required:!0,children:[a.jsx("option",{value:"",children:"Select type..."}),C.map(j=>a.jsx("option",{value:j.id,children:j.name},j.id))]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-mini-summary",children:"Summary"}),a.jsx("input",{id:"entity-mini-summary",type:"text",value:m.summary,onChange:_("summary"),placeholder:"Optional short summary",disabled:p})]})]}),(g||S)&&a.jsx("div",{className:`form-error${S?" warning":""}`,role:"alert",children:S||g}),a.jsxs("div",{className:"inline-actions",children:[a.jsx("button",{type:"button",className:"btn secondary",onClick:l,disabled:p,children:"Cancel"}),a.jsx("button",{type:"button",className:"btn",disabled:D,onClick:k,children:p?"Creating":"Save"})]})]})}const LI=[{value:"source",label:"This entity is the source"},{value:"target",label:"This entity is the target"}];function OI({value:e,onChange:t,disabled:r=!1}){const i=l=>{const c=l.target.value==="target"?"target":"source";c!==e&&t?.(c)};return a.jsxs("fieldset",{className:"perspective-toggle",disabled:r,children:[a.jsx("legend",{children:"Relationship Perspective"}),a.jsx("div",{role:"radiogroup","aria-label":"Relationship perspective",className:"perspective-toggle-options",children:LI.map(l=>{const c=["perspective-toggle-option"];return l.value===e&&c.push("active"),r&&c.push("disabled"),a.jsxs("label",{className:c.join(" "),children:[a.jsx("input",{type:"radio",name:"relationship-perspective",value:l.value,checked:e===l.value,onChange:i,disabled:r}),a.jsx("span",{children:l.label})]},l.value)})})]})}const Wu=e=>e==null?"":String(e).trim(),zI=e=>{if(e==null)return"";if(typeof e=="object")try{return JSON.stringify(e)}catch{return""}return String(e)},$I=e=>{const t=e.trim();if(!t)return"";if(t==="true")return!0;if(t==="false")return!1;const r=t[0],i=t[t.length-1];if(r==="{"&&i==="}"||r==="["&&i==="]")try{return JSON.parse(t)}catch{return e}const l=Number(t);return!Number.isNaN(l)&&t!==""?l:e},Zu=e=>{if(!Array.isArray(e)||e.length===0)return"";if(e.length===1)return e[0];if(e.length===2)return`${e[0]} or ${e[1]}`;const t=e.slice(0,-1),r=e[e.length-1];return`${t.join(", ")}, or ${r}`},FI=e=>{if(!e||e.id===void 0||e.id===null)return null;const t=e.entity_type_id??e.entityTypeId??e.entity_type?.id??e.entityType?.id??null,r=e.entityType||e.entity_type||(t&&e.entity_type_name?{id:t,name:e.entity_type_name}:null);return{...e,id:e.id,name:e.name||"Untitled entity",entity_type_id:t,entityType:r}},jS=e=>e?.name||e?.entityType?.name||e?.entity_type?.name||"",Wo=(e,t)=>{if(!e)return[];const r=t==="from"?e?.from_entity_types??e?.fromEntityTypes??e?.fromTypes??[]:e?.to_entity_types??e?.toEntityTypes??e?.toTypes??[];return Array.isArray(r)?r:[]},BI=e=>{if(!e)return"";if(typeof e=="string"||typeof e=="number")return String(e).trim();if(typeof e=="object"){if(e.id!==void 0&&e.id!==null)return String(e.id);if(e.entity_type_id!==void 0&&e.entity_type_id!==null)return String(e.entity_type_id);if(e.entityTypeId!==void 0&&e.entityTypeId!==null)return String(e.entityTypeId);if(e.entityType?.id!==void 0&&e.entityType?.id!==null)return String(e.entityType.id);if(e.entity_type?.id!==void 0&&e.entity_type?.id!==null)return String(e.entity_type.id)}return""},zo=(e,t)=>Wo(e,t).map(r=>BI(r)).filter(r=>r!=="");function UI({worldId:e,relationshipId:t,onCancel:r,onSaved:i,onToast:l,defaultFromEntityId:c,lockFromEntity:f=!1,defaultToEntityId:m,lockToEntity:h=!1,defaultPerspective:p="source",currentEntityId:y,currentEntityTypeId:g,formId:v="relationship-form",onStateChange:S,hideActions:w=!1}){const N=!!t,E=N,C=N,A=u.useRef(0),O=u.useCallback((K="",ae="")=>(A.current+=1,{id:A.current,key:K,value:ae}),[]),_=u.useCallback(K=>K.length>0?K:[O()],[O]),k=u.useCallback(K=>{if(!K||typeof K!="object"||Array.isArray(K))return"";const ae=K.__direction||K.direction;return ae?String(ae):""},[]),D=u.useCallback(K=>{if(A.current=0,!K||typeof K!="object"||Array.isArray(K))return[O()];const ae=Object.entries(K).filter(([Ne])=>typeof Ne!="string"?!0:!Ne.startsWith("__"));return ae.length===0?[O()]:ae.map(([Ne,He])=>O(Ne,zI(He)))},[O]),j=Wu(c),z=Wu(m),P=Wu(y),G=Wu(g),H=p==="target"?"reverse":"forward",X=H==="forward"?j:"",V=H==="reverse"?z:"",[R,B]=u.useState([]),[I,L]=u.useState([]),[$,M]=u.useState([]),[U,T]=u.useState({fromEntityId:X,toEntityId:V,relationshipTypeId:""}),[q,Y]=u.useState(()=>(A.current=0,[O()])),[Q,oe]=u.useState(H),[Z,de]=u.useState(!1),[J,se]=u.useState(!1),[ne,we]=u.useState(!1),[Le,Me]=u.useState(!1),[Ae,ot]=u.useState(!1),[ze,nt]=u.useState(""),[$e,vt]=u.useState(""),[_t,Tt]=u.useState(null),Ct=u.useRef({from:null,to:null}),[Be,at]=u.useState({from:"",to:""}),fe=Q==="reverse"?"target":"source",ce=fe==="source",ye=u.useMemo(()=>fe==="target"?h?"to":f?"from":"":f?"from":h?"to":"",[f,h,fe]),Pe=ye==="from"?"to":ye==="to"?"from":"",ee=u.useMemo(()=>q.some(K=>K.key.trim()!==""||K.value.trim()!==""),[q]);u.useEffect(()=>{let K=!1;return e?((async()=>{de(!0);try{const Ne=await lc(e),He=Array.isArray(Ne)?Ne:Array.isArray(Ne?.data)?Ne.data:[];K||B(He)}catch(Ne){K||(B([]),nt(Ne.message||"Failed to load entities"))}finally{K||de(!1)}})(),()=>{K=!0}):(B([]),()=>{})},[e]),u.useEffect(()=>{let K=!1;return e?((async()=>{se(!0);try{const Ne=await yf({worldId:e}),He=Array.isArray(Ne)?Ne:Array.isArray(Ne?.data)?Ne.data:[];K||L(He)}catch(Ne){K||(L([]),nt(Ne.message||"Failed to load relationship types"))}finally{K||se(!1)}})(),()=>{K=!0}):(L([]),se(!1),()=>{})},[e]),u.useEffect(()=>{let K=!1;return(async()=>{if(!e){M([]),we(!1);return}we(!0);try{const Ne=await ti({worldId:e}),He=Array.isArray(Ne)?Ne:Array.isArray(Ne?.data)?Ne.data:[];K||M(He)}catch(Ne){K||(M([]),nt(He=>He||Ne.message||"Failed to load entity types"))}finally{K||we(!1)}})(),()=>{K=!0}},[e]);const pe=K=>{if(!K)return"";const ae=K.entity_type_id??K.entityTypeId??K.entityType?.id??K.entity_type?.id??"";return ae?String(ae):""},me=u.useMemo(()=>U.fromEntityId&&R.find(K=>String(K.id)===String(U.fromEntityId))||null,[R,U.fromEntityId]),Se=u.useMemo(()=>pe(me),[me]),Ge=u.useMemo(()=>U.toEntityId&&R.find(K=>String(K.id)===String(U.toEntityId))||null,[R,U.toEntityId]),Xe=u.useMemo(()=>pe(Ge),[Ge]),et=u.useMemo(()=>ye==="from"?Se||(P&&U.fromEntityId===P&&G||j&&U.fromEntityId===j&&G?G:""):ye==="to"?Xe||(P&&U.toEntityId===P&&G||z&&U.toEntityId===z&&G?G:""):"",[ye,Se,Xe,U.fromEntityId,U.toEntityId,P,G,j,z]),Te=u.useMemo(()=>Q==="reverse"?ye==="to"?"from":"to":"from",[Q,ye]),mt=u.useMemo(()=>Q==="reverse"?ye==="to"?"to":"from":"to",[Q,ye]),Dt=u.useMemo(()=>{const K=et?String(et):"";if(K){if(ye==="from")return{typeId:K,role:Te};if(ye==="to")return{typeId:K,role:mt}}return Se?{typeId:String(Se),role:Te}:Xe?{typeId:String(Xe),role:mt}:null},[et,ye,Se,Xe,Te,mt]),At=u.useMemo(()=>{if(!I?.length)return[];const K=(Ne,He,bt)=>{if(!bt)return Ne;const Nt=String(bt);return Ne.filter(jt=>{const It=zo(jt,He);return It.length===0?!0:It.includes(Nt)})};let ae=I;if(Dt){const{typeId:Ne,role:He}=Dt;ae=K(ae,He,Ne)}return ae=K(ae,Te,Se),ae=K(ae,mt,Xe),ae},[I,Dt,Te,mt,Se,Xe]),Ke=u.useMemo(()=>U.relationshipTypeId?I.find(K=>String(K.id)===String(U.relationshipTypeId)):null,[I,U.relationshipTypeId]),ct=u.useMemo(()=>Ke?zo(Ke,Te):[],[Ke,Te]),Rt=u.useMemo(()=>Ke?zo(Ke,mt):[],[Ke,mt]),Ut=u.useMemo(()=>ct.length>0?String(ct[0]):"",[ct]),Qt=u.useMemo(()=>Rt.length>0?String(Rt[0]):"",[Rt]),wt=K=>{const ae=K==="target"?"reverse":"forward";vt(""),Q!==ae&&T(Ne=>{const He={...Ne,relationshipTypeId:""};if(!N){const bt=P||"";if(ae==="reverse"){const Nt=z||bt;Nt&&(He.toEntityId=Nt,f&&Ne.fromEntityId===Nt&&(He.fromEntityId=""))}else{const Nt=j||bt;Nt&&(He.fromEntityId=Nt,h&&Ne.toEntityId===Nt&&(He.toEntityId=""))}}return He}),oe(Ne=>Ne===ae?Ne:ae)},Ft=u.useCallback(K=>{if(K==="from"){if(ye==="from")return;if(!ct.length){l?.("This entity type is not allowed for this relationship.","warning");return}}else{if(ye==="to")return;if(!Rt.length){l?.("This entity type is not allowed for this relationship.","warning");return}}Tt(K)},[ct.length,Rt.length,ye,l]);u.useEffect(()=>{(_t==="from"&&ct.length===0||_t==="to"&&Rt.length===0)&&Tt(null)},[_t,ct.length,Rt.length]);const Ht=u.useMemo(()=>{if(!ct.length)return R;const K=new Set(ct);return R.filter(ae=>K.has(pe(ae)))},[R,ct]),kt=u.useMemo(()=>{if(!Rt.length)return R;const K=new Set(Rt);return R.filter(ae=>K.has(pe(ae)))},[R,Rt]);u.useEffect(()=>{if(!U.relationshipTypeId)return;At.some(ae=>String(ae.id)===String(U.relationshipTypeId))||T(ae=>({...ae,relationshipTypeId:""}))},[At,U.relationshipTypeId]),u.useEffect(()=>{if(!U.relationshipTypeId||!Se)return;if(f||h||P){vt("");return}const K=String(Se),ae=I.find(jt=>String(jt.id)===String(U.relationshipTypeId));if(!ae)return;const Ne=zo(ae,"from"),He=zo(ae,"to"),bt=Ne.includes(K),Nt=He.includes(K);if(bt&&Nt){vt("");return}if(bt&&Q!=="forward"){oe("forward"),vt("");return}if(!bt&&Nt){const jt="Direction auto-corrected because this entity is only allowed as a target.";Q!=="reverse"?(oe("reverse"),vt(jt)):vt(It=>It||jt);return}!bt&&!Nt&&(vt(""),T(jt=>({...jt,relationshipTypeId:""})))},[U.relationshipTypeId,Se,I,Q,f,h,P]),u.useEffect(()=>{if(!U.fromEntityId||!ct.length)return;const K=new Set(ct),ae=R.find(He=>String(He.id)===String(U.fromEntityId));if(!ae)return;const Ne=pe(ae);(!Ne||!K.has(Ne))&&T(He=>({...He,fromEntityId:""}))},[ct,R,U.fromEntityId]),u.useEffect(()=>{if(!U.toEntityId||!Rt.length)return;const K=new Set(Rt),ae=R.find(He=>String(He.id)===String(U.toEntityId));if(!ae)return;const Ne=pe(ae);(!Ne||!K.has(Ne))&&T(He=>({...He,toEntityId:""}))},[Rt,R,U.toEntityId]);const te=u.useMemo(()=>{if(!Ke)return"";const K=Wo(Ke,Te);return K.length?K.map(ae=>ae?.name||ae?.entityType?.name||ae?.entity_type?.name||"Unknown type").join(", "):""},[Ke,Te]),be=u.useMemo(()=>{if(!Ke)return"";const K=Wo(Ke,mt);return K.length?K.map(ae=>ae?.name||ae?.entityType?.name||ae?.entity_type?.name||"Unknown type").join(", "):""},[Ke,mt]),ve=Te==="from"?"source":"target",Ue=mt==="from"?"source":"target",it=`Allowed ${ve}s`,xt=`Allowed ${Ue}s`,ie=u.useMemo(()=>Ke&&(Q==="reverse"?Ke.to_name||Ke.toName:Ke.from_name||Ke.fromName)||"",[Ke,Q]),_e=u.useMemo(()=>Ke&&(Q==="reverse"?Ke.from_name||Ke.fromName:Ke.to_name||Ke.toName)||"",[Ke,Q]),qe=u.useMemo(()=>Ke?Wo(Ke,Te).map(K=>jS(K)).filter(K=>K&&K.trim()):[],[Ke,Te]),ht=u.useMemo(()=>Ke?Wo(Ke,mt).map(K=>jS(K)).filter(K=>K&&K.trim()):[],[Ke,mt]),pt=u.useMemo(()=>!Ke||!qe.length&&!ht.length?"":qe.length&&ht.length?`This relationship can only be initiated from ${Zu(qe)} and targets ${Zu(ht)}.`:qe.length?`This relationship can only be initiated from ${Zu(qe)}.`:`This relationship targets ${Zu(ht)}.`,[Ke,qe,ht]),Ee=u.useMemo(()=>{if(!ye||!Ke)return"";const K=et?String(et):"";if(!K)return"";if(ye==="from"){if(ct.length>0&&!ct.includes(K))return ce?"This entity is not an allowed source for the selected relationship type. Try switching perspective.":"This entity is not an allowed target for the selected relationship type. Try switching perspective."}else if(ye==="to"&&Rt.length>0&&!Rt.includes(K))return ce?"This entity is not an allowed target for the selected relationship type. Try switching perspective.":"This entity is not an allowed source for the selected relationship type. Try switching perspective.";return""},[ye,Ke,et,ct,Rt,ce]),st=u.useMemo(()=>ye?ye==="from"?ce?"This entity is fixed as the source for this relationship.":"This field is locked to the current entity.":ye==="to"?ce?"This field is locked to the current entity.":"This entity is fixed as the target for this relationship.":"":"",[ye,ce]),le=!!Ee;u.useEffect(()=>{let K=!1;const ae=()=>{A.current=0,T({fromEntityId:H==="forward"?j:"",toEntityId:H==="reverse"?z:"",relationshipTypeId:""}),Y([O()]),oe(H),nt(""),Tt(null)};return!N||!t?(ae(),Me(!1),()=>{}):((async()=>{Me(!0),nt("");try{const He=await j4(t),bt=He?.data||He;if(!bt)throw new Error("Relationship not found");if(!K){const Nt=bt.from_entity_id||bt.fromEntityId||bt.from_entity?.id||bt.fromEntity?.id||"",jt=bt.to_entity_id||bt.toEntityId||bt.to_entity?.id||bt.toEntity?.id||"",It=bt.entity_relationship_type_id||bt.relationship_type_id||bt.relationshipType?.id||bt.relationship_type?.id||"";T({fromEntityId:Nt?String(Nt):"",toEntityId:jt?String(jt):"",relationshipTypeId:It?String(It):""}),oe(k(bt.context)||"forward"),Y(_(D(bt.context)))}}catch(He){K||nt(He.message||"Failed to load relationship")}finally{K||Me(!1)}})(),()=>{K=!0})},[t,N,_,D,O,k,H,j,z]),u.useEffect(()=>{if(N)return;const K=p==="target"?"reverse":"forward";oe(ae=>ae===K?ae:K)},[p,N]),u.useEffect(()=>{if(N||!ye)return;const K=P||"",ae=ye==="from"?j||K:z||K;ae&&T(Ne=>{const He=ye==="from"?"fromEntityId":"toEntityId";if(Ne[He]===ae)return Ne;const bt={...Ne,[He]:ae};return ye==="from"&&h&&Ne.toEntityId===ae&&(bt.toEntityId=""),ye==="to"&&f&&Ne.fromEntityId===ae&&(bt.fromEntityId=""),bt})},[N,ye,f,h,j,z,P]);const Je=K=>ae=>{const{value:Ne}=ae.target;T(He=>{if(N)return{...He,[K]:Ne};const bt={...He,relationshipTypeId:Ne};return ye==="from"?bt.toEntityId="":ye==="to"&&(bt.fromEntityId=""),bt}),Tt(null)},ut=K=>{const{value:ae}=K.target;Tt(Ne=>Ne==="from"?null:Ne),T(Ne=>({...Ne,fromEntityId:ae}))},gt=K=>{const{value:ae}=K.target;Tt(Ne=>Ne==="to"?null:Ne),T(Ne=>({...Ne,toEntityId:ae}))},re=u.useCallback(()=>{Tt(null)},[]),Ze=u.useCallback((K,ae)=>{const Ne=K==="to"?"to":"from",He=ae?String(ae):"";at(bt=>({...bt,[Ne]:He})),Ct.current[Ne]&&clearTimeout(Ct.current[Ne]),Ct.current[Ne]=setTimeout(()=>{at(bt=>({...bt,[Ne]:""})),Ct.current[Ne]=null},2e3)},[]),We=u.useCallback((K,ae)=>{const Ne=FI(ae);if(!Ne)return;const He=String(Ne.id);B(It=>{const tn={...Ne,id:He},un=It.findIndex(Kt=>String(Kt.id)===He);if(un>=0){const Kt=[...It];return Kt[un]={...Kt[un],...tn},Kt}return[tn,...It]}),K==="from"?T(It=>({...It,fromEntityId:He})):K==="to"&&T(It=>({...It,toEntityId:He})),Ze(K,He),Tt(null);const bt=K==="from"?ve:Ue,Nt=`${bt[0].toUpperCase()}${bt.slice(1)}`,jt=Nt?`New ${Nt} entity added and selected.`:"New entity added and selected.";l?.(jt,"success")},[Ze,ve,Ue,l]);u.useEffect(()=>{const K=Ct.current;return()=>{Object.values(K).forEach(ae=>{ae&&clearTimeout(ae)})}},[]);const dt=(K,ae)=>Ne=>{const{value:He}=Ne.target;Y(bt=>bt.map(Nt=>Nt.id===K?{...Nt,[ae]:He}:Nt))},Qe=()=>{Y(K=>[...K,O()])},yt=K=>{Y(ae=>_(ae.filter(Ne=>Ne.id!==K)))},ke=async K=>{if(K.preventDefault(),!e){nt("Select a world before creating relationships.");return}const ae=U.fromEntityId.trim(),Ne=U.toEntityId.trim(),He=U.relationshipTypeId.trim();if(!ae||!Ne){nt("Both entities are required.");return}if(!He){nt("Relationship type is required.");return}const bt={};q.forEach(({key:Kt,value:na})=>{const ba=Kt.trim();ba&&(ba.startsWith("__")||(bt[ba]=$I(na)))});const Nt=Q==="reverse"?"reverse":"forward";bt.__direction=Nt;let jt=ae,It=Ne;Nt==="reverse"&&(!P||U.fromEntityId===P)&&(jt=Ne,It=ae);const un={world_id:e,from_entity_id:jt,to_entity_id:It,relationship_type_id:He,bidirectional:!0,context:bt};try{if(ot(!0),nt(""),N)await C4(t,un),i?.("edit");else{const Kt=await pN(un),na=Kt?.data??Kt,ba=na?.data??na;i?.("create",ba)}}catch(Kt){nt(Kt.message||"Failed to save relationship")}finally{ot(!1)}},Ve=Z||J||Le||ne,ft=!!Dt?.typeId&&At.length===0;return u.useEffect(()=>{if(!S)return;S({mode:N?"edit":"create",saving:Ae,isBusy:Ve,submitLabel:Ae?"Saving...":N?"Save Changes":"Create Relationship",submitDisabled:Ae||Ve||le,cancelDisabled:Ae})},[S,N,Ae,Ve,le]),a.jsxs("form",{id:v,className:"entity-form relationship-form",onSubmit:ke,children:[a.jsx(OI,{value:fe,onChange:wt,disabled:Ae||Ve}),Ee&&a.jsx("div",{className:"alert warning",role:"alert",children:Ee}),$e&&a.jsx("div",{className:"alert warning",role:"status",children:$e}),a.jsxs("div",{className:"form-two-column",children:[a.jsxs("div",{className:`form-group${Be.from&&Be.from===U.fromEntityId?" entity-select-highlight":""}`,children:[a.jsx("label",{htmlFor:"relationship-from-entity",children:"From Entity *"}),a.jsxs("select",{id:"relationship-from-entity",value:U.fromEntityId,onChange:ut,disabled:Ae||Ve||ye==="from",required:!0,"data-autofocus":Pe==="from"?!0:void 0,children:[a.jsx("option",{value:"",children:"Select entity..."}),Ht.map(K=>a.jsx("option",{value:K.id,children:K.name},K.id))]}),ye==="from"&&st&&a.jsx("p",{className:"field-hint",children:st}),E&&ie&&a.jsxs("p",{className:"field-hint",children:["Displayed label: ",ie]}),E&&Ke&&te&&a.jsxs("p",{className:"field-hint",children:[it,": ",te]}),ye!=="from"&&a.jsx("div",{className:"inline-create-trigger",children:ct.length>0?a.jsx("button",{type:"button",className:"link-button",onClick:()=>Ft("from"),disabled:_t==="from",children:"+ Create new"}):a.jsx("button",{type:"button",className:"link-button disabled",disabled:!0,children:"+ Create new"})}),ye!=="from"&&ct.length===0&&a.jsx("p",{className:"inline-create-hint disabled",children:"Inline creation isnt available for this relationship."}),Ke&&ct.length>0&&Ht.length===0&&a.jsxs("p",{className:"field-hint",children:["No entities match the allowed ",ve," types yet. Use + Create new to add one without leaving this page."]}),ye!=="from"&&_t==="from"&&a.jsx(ES,{allowedTypeIds:ct,defaultTypeId:Ut,worldId:e,entityTypes:$,onCreated:K=>We("from",K),onCancel:re,onToast:l},`inline-from-${U.relationshipTypeId}`)]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type",children:"Relationship Type *"}),a.jsxs("select",{id:"relationship-type",value:U.relationshipTypeId,onChange:Je("relationshipTypeId"),disabled:Ae||Ve||!At.length,required:!0,children:[a.jsx("option",{value:"",children:"Select type..."}),At.map(K=>{const ae=K.from_name||K.fromName||K.name,Ne=K.to_name||K.toName||K.name,He=ae===Ne?ae:`${ae}  ${Ne}`;return a.jsxs("option",{value:K.id,children:[K.name,"  ",He]},K.id)})]}),ft&&a.jsx("p",{className:"field-hint",children:"No relationship types include the selected entity type."}),pt&&a.jsx("p",{className:"helper-hint",children:pt})]})]}),a.jsx("div",{className:"form-two-column",children:a.jsxs("div",{className:`form-group${Be.to&&Be.to===U.toEntityId?" entity-select-highlight":""}`,children:[a.jsx("label",{htmlFor:"relationship-to-entity",children:"To Entity *"}),a.jsxs("select",{id:"relationship-to-entity",value:U.toEntityId,onChange:gt,disabled:Ae||Ve||ye==="to",required:!0,"data-autofocus":Pe==="to"?!0:void 0,children:[a.jsx("option",{value:"",children:"Select entity..."}),kt.map(K=>a.jsx("option",{value:K.id,children:K.name},K.id))]}),ye==="to"&&st&&a.jsx("p",{className:"field-hint",children:st}),E&&_e&&a.jsxs("p",{className:"field-hint",children:["Displayed label: ",_e]}),E&&Ke&&be&&a.jsxs("p",{className:"field-hint",children:[xt,": ",be]}),ye!=="to"&&a.jsx("div",{className:"inline-create-trigger",children:Rt.length>0?a.jsx("button",{type:"button",className:"link-button",onClick:()=>Ft("to"),disabled:_t==="to",children:"+ Create new"}):a.jsx("button",{type:"button",className:"link-button disabled",disabled:!0,children:"+ Create new"})}),ye!=="to"&&Rt.length===0&&a.jsx("p",{className:"inline-create-hint disabled",children:"Inline creation isnt available for this relationship."}),Ke&&Rt.length>0&&kt.length===0&&a.jsxs("p",{className:"field-hint",children:["No entities match the allowed ",Ue," types yet. Use + Create new to add one without losing your place."]}),ye!=="to"&&_t==="to"&&a.jsx(ES,{allowedTypeIds:Rt,defaultTypeId:Qt,worldId:e,entityTypes:$,onCreated:K=>We("to",K),onCancel:re,onToast:l},`inline-to-${U.relationshipTypeId}`)]})}),C&&a.jsxs("div",{className:"metadata-editor",children:[a.jsxs("div",{className:"metadata-header",children:[a.jsxs("h3",{children:["Context ",ee?"":"(optional)"]}),a.jsx("button",{type:"button",className:"btn neutral",onClick:Qe,disabled:Ae||Ve,children:"Add field"})]}),a.jsx("div",{className:"metadata-list",children:q.map((K,ae)=>a.jsxs("div",{className:"metadata-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`context-key-${K.id}`,className:"sr-only",children:["Context key ",ae+1]}),a.jsx("input",{id:`context-key-${K.id}`,type:"text",placeholder:"Key",value:K.key,onChange:dt(K.id,"key"),disabled:Ae||Ve})]}),a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`context-value-${K.id}`,className:"sr-only",children:["Context value ",ae+1]}),a.jsx("input",{id:`context-value-${K.id}`,type:"text",placeholder:"Value",value:K.value,onChange:dt(K.id,"value"),disabled:Ae||Ve})]}),a.jsx("div",{className:"metadata-actions",children:a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>yt(K.id),disabled:Ae||Ve||q.length===1,title:"Remove field",children:""})})]},K.id))})]}),Ve&&a.jsx("div",{className:"form-loading",role:"status",children:"Loading data..."}),ze&&a.jsx("div",{className:"form-error",role:"alert",children:ze}),!w&&a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:r,disabled:Ae,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:Ae||Ve||le,children:Ae?"Saving...":N?"Save Changes":"Create Relationship"})]})]})}function qI(e){return a.jsx(UI,{...e})}const HI=new Set(["system_admin"]),_S=(e="create")=>({mode:e,submitLabel:e==="edit"?"Save Changes":"Create Relationship",submitDisabled:!1,cancelDisabled:!1,saving:!1,isBusy:!1});function PI(){const{user:e,token:t,sessionReady:r}=Nn(),{selectedCampaign:i,activeWorld:l,activeWorldId:c,selectedContextType:f,contextKey:m}=Bn(),h=kI("rel_builder_v2"),[p,y]=u.useState(!1),[g,v]=u.useState(!1),[S,w]=u.useState([]),[N,E]=u.useState([]),[C,A]=u.useState({}),O=u.useRef({}),[_,k]=u.useState(!1),[D,j]=u.useState(!1),[z,P]=u.useState(""),[G,H]=u.useState(null),[X,V]=u.useState(""),[R,B]=u.useState(null),[I,L]=u.useState(()=>_S("create")),[$,M]=u.useState(""),[U,T]=u.useState(""),q=c||"",Y=!!q,Q=u.useRef(`${q}:${m}`),oe=u.useRef(`relationship-form-${Math.random().toString(36).slice(2)}`),Z=(ee="create")=>{L(_S(ee))},de=u.useCallback((ee,pe="info")=>{B({message:ee,tone:pe})},[]);u.useEffect(()=>{if(!R)return;const ee=setTimeout(()=>B(null),3500);return()=>clearTimeout(ee)},[R]);const J=u.useMemo(()=>!i||!e?"":i.members?.find(pe=>pe.user_id===e.id)?.role||"",[i,e]),se=u.useMemo(()=>{const ee=i?.world||l;if(!ee||!e?.id)return!1;const pe=ee.created_by||ee.creator?.id||ee.owner_id||ee.owner?.id||"";return pe?String(pe)===String(e.id):!1},[i,l,e?.id]),ne=u.useMemo(()=>!e||!q?!1:HI.has(e.role)?!0:f==="world"?se:!!(i&&(J==="dm"||se)),[e,q,f,i,J,se]),we=u.useCallback(async ee=>{const pe=Array.from(new Set(ee.map(et=>et==null?"":String(et)).filter(Boolean)));if(pe.length===0)return;const me=O.current,Se=pe.filter(et=>!me[et]);if(Se.length===0)return;const Ge=await Promise.all(Se.map(async et=>{try{const Te=await cr(et),mt=Pa(Te);return{id:et,data:mt}}catch(Te){return console.error(" Failed to resolve entity",Te),{id:et,data:null}}})),Xe={};Ge.forEach(({id:et,data:Te})=>{Te?Xe[et]={id:Te.id||et,name:Te.name||`Entity ${et}`,typeName:Te.entityType?.name||Te.entity_type?.name||""}:Xe[et]={id:et,name:`Entity #${et}`,typeName:""}}),O.current={...O.current,...Xe},A(et=>({...et,...Xe}))},[]),Le=u.useCallback(async ee=>{const pe=ee?{worldId:ee}:{};j(!0);try{const me=await yf(pe),Se=Array.isArray(me)?me:Array.isArray(me?.data)?me.data:[];E(Se)}catch(me){console.error(" Failed to load relationship types",me),de(me.message||"Failed to load relationship types","error"),E([])}finally{j(!1)}},[de]);u.useEffect(()=>{if(!q){E([]);return}Le(q)},[Le,q,m]);const Me=u.useCallback(async ee=>{const pe=ee??q;if(!pe||!t)return w([]),[];k(!0),P("");try{const me=await E4(pe),Se=Array.isArray(me)?me:Array.isArray(me?.data)?me.data:[];w(Se);const Ge=[];return Se.forEach(Xe=>{const et=Xe.from_entity_id||Xe.fromEntityId||Xe.from_entity?.id||Xe.fromEntity?.id||"",Te=Xe.to_entity_id||Xe.toEntityId||Xe.to_entity?.id||Xe.toEntity?.id||"";et&&Ge.push(et),Te&&Ge.push(Te)}),await we(Ge),Se}catch(me){return console.error(" Failed to load relationships",me),w([]),P(me.message||"Failed to load relationships"),[]}finally{k(!1)}},[q,t,we,m]);u.useEffect(()=>{if(!q||!t){w([]),O.current={},A({});return}Me(q)},[q,t,Me,m]),u.useEffect(()=>{const ee=`${q}:${m}`;Q.current!==ee&&(p&&y(!1),g&&v(!1),H(null),B(null),M(""),T(""),P(""),O.current={},A({}),Q.current=ee)},[q,m,p,g]);const Ae=u.useMemo(()=>{const ee=new Map;return N.forEach(pe=>{pe?.id&&ee.set(String(pe.id),pe)}),ee},[N]),ot=ee=>{if(!ee)return"";if(typeof ee=="object"&&ee!==null&&!Array.isArray(ee)){const pe=ee.__direction||ee.direction;return pe?String(pe):""}return""},ze=u.useMemo(()=>S.map(ee=>{const pe=ee.from_entity_id||ee.fromEntityId||ee.from_entity?.id||ee.fromEntity?.id||"",me=ee.to_entity_id||ee.toEntityId||ee.to_entity?.id||ee.toEntity?.id||"",Se=ee.entity_relationship_type_id||ee.relationship_type_id||ee.relationshipType?.id||ee.relationship_type?.id||"",Ge=ee.relationshipType||ee.relationship_type||Ae.get(String(Se))||{},Xe=Ge.name||ee.relationshipTypeName||Ae.get(String(Se))?.name||"",et=Ge.from_name||Ge.fromName||Ae.get(String(Se))?.from_name||Ae.get(String(Se))?.fromName||Xe,Te=Ge.to_name||Ge.toName||Ae.get(String(Se))?.to_name||Ae.get(String(Se))?.toName||Xe,mt=ot(ee.context),Dt=mt==="reverse"?Te:et,At=!!(ee.bidirectional??ee.is_bidirectional??ee.two_way??!1);return{...ee,fromEntityId:pe?String(pe):"",toEntityId:me?String(me):"",relationshipTypeId:Se?String(Se):"",typeName:Dt,direction:mt,typeFromName:et,typeToName:Te,bidirectional:At,fromEntityName:ee.fromEntity?.name||ee.from_entity?.name||ee.fromEntityName||"",toEntityName:ee.toEntity?.name||ee.to_entity?.name||ee.toEntityName||"",fromEntityTypeName:ee.fromEntity?.entityType?.name||ee.from_entity?.entity_type?.name||"",toEntityTypeName:ee.toEntity?.entityType?.name||ee.to_entity?.entity_type?.name||""}}),[S,Ae]),nt=i?`${i.name}${l?.name?`  ${l.name}`:""}`:Y?`World  ${l?.name||"Untitled world"}`:"",$e=u.useCallback((ee,pe="",me="")=>{if(!ee)return"";const Se=C[ee],Ge=Se?.name||pe||`Entity #${ee}`,Xe=Se?.typeName||me;return Xe?`${Ge} (${Xe})`:Ge},[C]),vt=u.useMemo(()=>{const ee=U.trim().toLowerCase();return ze.filter(pe=>{if($&&pe.relationshipTypeId!==$)return!1;if(!ee)return!0;const me=$e(pe.fromEntityId,pe.fromEntityName,pe.fromEntityTypeName).toLowerCase(),Se=$e(pe.toEntityId,pe.toEntityName,pe.toEntityTypeName).toLowerCase();return me.includes(ee)||Se.includes(ee)})},[ze,$,U,$e]);if(!r)return a.jsx("p",{children:"Restoring session..."});if(!t)return a.jsx("p",{children:"Authenticating..."});const _t=vt.length>0,Tt=G?"Edit Relationship":"Add Relationship",Ct=()=>{q&&Me(q)},Be=()=>{if(!(!ne||!q)){if(h){y(!0);return}H(null),Z("create"),v(!0)}},at=ee=>{!ne||!ee?.id||(H(ee.id),Z("edit"),v(!0))},fe=()=>{v(!1),H(null),Z("create")},ce=(ee={})=>{L(pe=>({...pe,...ee}))},ye=async(ee,pe)=>{if(fe(),!!q){if(await Me(q),ee==="create"&&pe){const me=$e(pe.from_entity_id,pe?.from_entity?.name,pe?.from_entity?.entityType?.name||pe?.from_entity?.entity_type?.name),Se=$e(pe.to_entity_id,pe?.to_entity?.name,pe?.to_entity?.entityType?.name||pe?.to_entity?.entity_type?.name),Ge=pe?.relationshipType?.name||"relationship";de(`Added ${me}  ${Se} (${Ge}).`,"success");return}de(ee==="create"?"Relationship created":"Relationship updated","success")}},Pe=async ee=>{if(!ne||!ee?.id)return;const pe=$e(ee.fromEntityId,ee.fromEntityName,ee.fromEntityTypeName),me=$e(ee.toEntityId,ee.toEntityName,ee.toEntityTypeName);if(window.confirm(`Delete relationship "${pe}"  "${me}"? This action cannot be undone.`))try{V(ee.id),await A4(ee.id),de("Relationship deleted","success"),q&&await Me(q)}catch(Ge){console.error(" Failed to delete relationship",Ge),de(Ge.message||"Failed to delete relationship","error")}finally{V("")}};return a.jsxs("section",{className:"entities-page relationships-page",children:[a.jsxs("div",{className:"entities-header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Entity Relationships"}),Y?a.jsx("p",{className:"entities-subtitle",children:nt}):a.jsx("p",{className:"entities-subtitle",children:"Select a campaign or world you own to choose a world context."})]}),a.jsxs("div",{className:"entities-controls",children:[a.jsxs("select",{value:$,onChange:ee=>M(ee.target.value),disabled:D||N.length===0,title:"Filter by relationship type",children:[a.jsx("option",{value:"",children:"All types"}),N.map(ee=>a.jsx("option",{value:String(ee.id),children:ee.name},ee.id))]}),a.jsx(qy,{value:U,onChange:T}),a.jsx("button",{type:"button",className:"icon-btn",title:"Refresh relationships",onClick:Ct,disabled:!q||_,children:a.jsx(Il,{size:16})}),a.jsxs("button",{type:"button",className:"btn submit",onClick:Be,disabled:!ne||!q||_,children:[a.jsx(Va,{size:16})," Add Relationship"]})]})]}),i&&Y&&!ne&&a.jsx("div",{className:"alert info",role:"status",children:"You can view existing relationships, but only the world owner, a campaign DM, or a system administrator can create or edit them."}),R&&a.jsx("div",{className:`toast-banner ${R.tone}`,role:"status",children:R.message}),z&&a.jsx("div",{className:"alert error",role:"alert",children:z}),_?a.jsx("div",{className:"empty-state",children:"Loading relationships..."}):q?_t?a.jsx("div",{className:"entities-table-wrapper",children:a.jsxs("table",{className:"entities-table relationships-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"From Entity"}),a.jsx("th",{children:"Relationship Type"}),a.jsx("th",{children:"To Entity"}),a.jsx("th",{children:"Bidirectional"}),ne&&a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:vt.map(ee=>{const pe=$e(ee.fromEntityId,ee.fromEntityName,ee.fromEntityTypeName),me=$e(ee.toEntityId,ee.toEntityName,ee.toEntityTypeName);return a.jsxs("tr",{children:[a.jsx("td",{children:pe}),a.jsx("td",{children:ee.typeName||""}),a.jsx("td",{children:me}),a.jsx("td",{children:a.jsx("span",{className:`visibility-badge ${ee.bidirectional?"badge-visible":"badge-hidden"}`,children:ee.bidirectional?"Yes":"No"})}),ne&&a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>at(ee),title:"Edit relationship",disabled:_,children:a.jsx(lr,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>Pe(ee),title:"Delete relationship",disabled:X===ee.id,children:a.jsx(ua,{size:16})})]})})]},ee.id)})})]})}):a.jsx("div",{className:"empty-state",children:$||U?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"empty-title",children:"No relationships match your filters."}),a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>{M(""),T("")},children:"Clear filters"})]}):ne?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"empty-title",children:"No relationships yet."}),a.jsxs("button",{type:"button",className:"btn submit",onClick:Be,disabled:!q,children:[a.jsx(Va,{size:16})," Add your first relationship"]})]}):a.jsx("p",{className:"empty-title",children:"No relationships to display."})}):a.jsx("div",{className:"empty-state",children:"Select a campaign or world you own to view its relationships."}),h&&a.jsx(Wr,{isOpen:p,onClose:()=>y(!1),title:"Add Relationship",description:"Link two entities in this world.",size:"lg",children:a.jsx(yN,{worldId:q,existingRelationships:S||[],onCreated:()=>{y(!1),Me(q),de("Relationship created","success")},onCancel:()=>y(!1)})}),a.jsx(Wr,{isOpen:g,onClose:fe,title:Tt,size:"lg",footerActions:a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:fe,disabled:I.cancelDisabled,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",form:oe.current,disabled:I.submitDisabled,children:I.submitLabel})]}),children:a.jsx(qI,{worldId:q,relationshipId:G,onCancel:fe,onSaved:ye,onStateChange:ce,formId:oe.current,hideActions:!0})})]})}const VI=new Set(["system_admin"]),YI=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},CS=(e=[])=>!Array.isArray(e)||e.length===0?"":e.map(t=>t?.name||t?.label||"Unknown").filter(Boolean).join(", "),GI=e=>{if(!e)return"";const t=e.from_name||e.fromName||e.name||"",r=e.to_name||e.toName||e.name||"";return`${t}  ${r}`};function XI(){const e=$n(),t=Ga(),{user:r,token:i,sessionReady:l}=Nn(),{selectedCampaign:c}=Bn(),[f,m]=u.useState([]),[h,p]=u.useState(!1),[y,g]=u.useState(""),[v,S]=u.useState(null),[w,N]=u.useState(""),E=u.useMemo(()=>{if(!c?.world)return"";const R=c.world;return R.created_by||R.creator?.id||R.owner_id||R.owner?.id||""},[c]),C=!!(r?.id&&E===r.id),A=u.useMemo(()=>r?r.role&&VI.has(r.role)?!0:C:!1,[r,C]),O=c?.world?.id??"",_=!!O,k=u.useRef(O),D=u.useMemo(()=>{if(!c)return"";const R=c.name||"Selected campaign",B=c.world?.name;return B?`${R}  ${B}`:R},[c]);u.useEffect(()=>{if(!v)return;const R=setTimeout(()=>S(null),3500);return()=>clearTimeout(R)},[v]);const j=u.useCallback((R,B="info")=>{S({message:R,tone:B})},[]),z=u.useCallback(()=>{e(t.pathname,{replace:!0,state:{}})},[t.pathname,e]);u.useEffect(()=>{if(t.state?.toast){const{message:R,tone:B}=t.state.toast;j(R,B),z()}},[t.state,j,z]),u.useEffect(()=>{k.current!==O&&(k.current=O,m([]),g(""),p(!1),S(null),N(""))},[O]);const P=u.useCallback(async()=>{if(!(!i||!A)){if(!O){m([]),g("");return}p(!0),g("");try{const R=await yf({worldId:O}),B=Array.isArray(R)?R:Array.isArray(R?.data)?R.data:[];m(B)}catch(R){console.error(" Failed to load relationship types",R),m([]),g(R.message||"Failed to load relationship types")}finally{p(!1)}}},[i,A,O]);u.useEffect(()=>{if(!(!l||!i||!A)){if(!O){m([]),p(!1),g("");return}P()}},[l,i,A,O,P]);const G=()=>{!i||h||!_||!A||P()},H=()=>{!A||!_||e("/relationship-types/new")},X=R=>{!A||!R?.id||e(`/relationship-types/${R.id}/edit`)},V=async R=>{if(!(!A||!_||!R?.id||!window.confirm(`Delete relationship type "${R.name}"? This cannot be undone.`)))try{N(R.id),await D4(R.id),j("Relationship type deleted","success"),await P()}catch(I){console.error(" Failed to delete relationship type",I),j(I.message||"Failed to delete relationship type","error")}finally{N("")}};return l?i?A?a.jsxs("section",{className:"entity-types-page relationship-types-page",children:[a.jsxs("div",{className:"entity-types-header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Relationship Types"}),c?a.jsxs("p",{className:"entity-types-subtitle",children:[D,_?`  ${f.length} types defined`:""]}):a.jsx("p",{className:"entity-types-subtitle",children:"Select a campaign from the header to choose a world context."})]}),a.jsxs("div",{className:"entity-types-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Refresh",onClick:G,disabled:h||!_,children:a.jsx(Il,{size:16})}),a.jsxs("button",{type:"button",className:"btn submit",onClick:H,disabled:h||!_,children:[a.jsx(Va,{size:18})," Add Relationship Type"]})]})]}),v&&a.jsx("div",{className:`toast-banner ${v.tone}`,children:v.message}),y&&a.jsx("div",{className:"alert error",children:y}),a.jsx("div",{className:"entity-types-table-wrapper",children:_?h?a.jsx("div",{className:"empty-state",children:"Loading relationship types..."}):f.length===0?a.jsx("div",{className:"empty-state",children:"No relationship types defined yet."}):a.jsxs("table",{className:"entity-types-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Name"}),a.jsx("th",{children:"Directional Labels"}),a.jsx("th",{children:"World"}),a.jsx("th",{children:"Allowed Sources"}),a.jsx("th",{children:"Allowed Targets"}),a.jsx("th",{children:"Created"}),a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:f.map(R=>{const B=R.createdAt||R.created_at;return a.jsxs("tr",{children:[a.jsx("td",{children:R.name}),a.jsx("td",{children:GI(R)}),a.jsx("td",{children:R.world?.name||""}),a.jsx("td",{children:CS(R.from_entity_types)}),a.jsx("td",{children:CS(R.to_entity_types)}),a.jsx("td",{children:YI(B)}),a.jsxs("td",{className:"actions-column",children:[a.jsx("button",{className:"icon-btn",title:"Edit",onClick:()=>X(R),disabled:h||w===R.id,children:a.jsx(lr,{size:16})}),a.jsx("button",{className:"icon-btn danger",title:"Delete",onClick:()=>V(R),disabled:w===R.id,children:a.jsx(ua,{size:16})})]})]},R.id)})})]}):a.jsx("div",{className:"empty-state",children:"Select a campaign from the header to view relationship types."})})]}):a.jsxs("section",{className:"entity-types-page relationship-types-page",children:[a.jsx("div",{className:"entity-types-header",children:a.jsx("h1",{children:"Relationship Types"})}),a.jsx("div",{className:"alert info",children:"Only system administrators or the world owner can manage relationship types."})]}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const AS=e=>Array.isArray(e)?[...new Set(e.map(t=>t?String(t):"").filter(Boolean))]:[],TS=(e={})=>({name:e?.name||"",fromName:e?.from_name||e?.fromName||"",toName:e?.to_name||e?.toName||"",description:e?.description||"",worldId:e?.world?.id||e?.world_id||"",fromEntityTypeIds:AS((e?.from_entity_types||[]).map(t=>t?.id||t?.entity_type_id)),toEntityTypeIds:AS((e?.to_entity_types||[]).map(t=>t?.id||t?.entity_type_id))}),MS=(e=[],t=[])=>{if(e.length!==t.length)return!1;const r=[...e].sort(),i=[...t].sort();return r.every((l,c)=>l===i[c])};function IN({initialValues:e={},entityTypes:t=[],worlds:r=[],saving:i=!1,optionsLoading:l=!1,errorMessage:c="",onSubmit:f,onCancel:m}){const h=u.useMemo(()=>TS(e),[e]),[p,y]=u.useState(h),[g,v]=u.useState("");u.useEffect(()=>{y(TS(e)),v("")},[e]),u.useEffect(()=>{v(c||"")},[c]);const S=u.useMemo(()=>p.name!==h.name||p.fromName!==h.fromName||p.toName!==h.toName||p.description!==h.description||p.worldId!==h.worldId||!MS(p.fromEntityTypeIds,h.fromEntityTypeIds)||!MS(p.toEntityTypeIds,h.toEntityTypeIds),[h,p]),w=u.useMemo(()=>Array.isArray(t)?t.map(O=>{const _=O?.id||O?.entity_type_id||O?.entityTypeId||O?.value||"";if(!_)return null;const k=O?.world_id||O?.worldId||O?.world?.id||"";return{value:String(_),label:O?.name||O?.label||"Untitled type",worldId:k?String(k):""}}).filter(Boolean):[],[t]),N=u.useMemo(()=>{const O=p.worldId?String(p.worldId):"";return O?w.filter(_=>_.worldId===O):[]},[w,p.worldId]);u.useEffect(()=>{if(!(p.worldId?String(p.worldId):"")){y(k=>k.fromEntityTypeIds.length===0&&k.toEntityTypeIds.length===0?k:{...k,fromEntityTypeIds:[],toEntityTypeIds:[]});return}const _=new Set(N.map(k=>k.value));y(k=>{const D=k.fromEntityTypeIds.filter(z=>_.has(String(z))),j=k.toEntityTypeIds.filter(z=>_.has(String(z)));return D.length===k.fromEntityTypeIds.length&&j.length===k.toEntityTypeIds.length?k:{...k,fromEntityTypeIds:D,toEntityTypeIds:j}})},[N,p.worldId]);const E=O=>_=>{const{value:k}=_.target;y(D=>({...D,[O]:k}))},C=O=>(_=[])=>{const k=Array.isArray(_)?_:[];y(D=>({...D,[O]:k}))},A=async O=>{O.preventDefault();const _=p.name.trim(),k=p.fromName.trim(),D=p.toName.trim();if(!_)return v("Name is required.");if(!k)return v("Provide a label for the source direction.");if(!D)return v("Provide a label for the target direction.");if(!p.worldId)return v("Select a world for this relationship type.");if(!p.fromEntityTypeIds.length)return v("Select at least one allowed source entity type.");if(!p.toEntityTypeIds.length)return v("Select at least one allowed target entity type.");v("");const j={name:_,from_name:k,to_name:D,description:p.description?.trim()||"",world_id:p.worldId,from_entity_type_ids:p.fromEntityTypeIds,to_entity_type_ids:p.toEntityTypeIds};try{if(await f?.(j)===!1)return}catch(z){v(z.message||"Failed to save relationship type")}};return a.jsxs("form",{className:"relationship-type-form",onSubmit:A,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-name",children:"Name *"}),a.jsx("input",{id:"relationship-type-name",type:"text",value:p.name,onChange:E("name"),placeholder:"e.g. Enemy",disabled:i||l,autoFocus:!0})]}),a.jsxs("div",{className:"form-two-column",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-from-name",children:"Source relationship label *"}),a.jsx("input",{id:"relationship-type-from-name",type:"text",value:p.fromName,onChange:E("fromName"),placeholder:"e.g. Parent of",disabled:i||l})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-to-name",children:"Target relationship label *"}),a.jsx("input",{id:"relationship-type-to-name",type:"text",value:p.toName,onChange:E("toName"),placeholder:"e.g. Child of",disabled:i||l})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-description",children:"Description"}),a.jsx("textarea",{id:"relationship-type-description",value:p.description,onChange:E("description"),placeholder:"Optional description",rows:4,disabled:i||l,className:"textarea-field"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-world",children:"World *"}),a.jsxs("select",{id:"relationship-type-world",value:p.worldId,onChange:E("worldId"),disabled:i||l,required:!0,children:[a.jsx("option",{value:"",children:"Select world..."}),r.map(O=>a.jsx("option",{value:O.id,children:O.name},O.id))]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-from-entities",children:"Allowed source entity types *"}),a.jsx(ks,{selected:p.fromEntityTypeIds,options:N,onChange:C("fromEntityTypeIds"),placeholder:"Search entity types...",disabled:i||l,loading:l,noOptionsMessage:p.worldId?"No entity types available for this world.":"Select a world to choose entity types."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-to-entities",children:"Allowed target entity types *"}),a.jsx(ks,{selected:p.toEntityTypeIds,options:N,onChange:C("toEntityTypeIds"),placeholder:"Search entity types...",disabled:i||l,loading:l,noOptionsMessage:p.worldId?"No entity types available for this world.":"Select a world to choose entity types."})]}),g&&a.jsx("div",{className:"form-error",children:g}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:m,disabled:i,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:i||l||!S,children:i?"Saving...":"Save"})]})]})}function KI(){const e=$n(),{user:t,token:r,sessionReady:i}=Nn(),{selectedCampaign:l}=Bn(),[c,f]=u.useState([]),[m,h]=u.useState(!1),[p,y]=u.useState(""),[g,v]=u.useState(""),[S,w]=u.useState(!1),N=u.useMemo(()=>{if(!l?.world)return"";const j=l.world;return j.created_by||j.creator?.id||j.owner_id||j.owner?.id||""},[l]),E=!!(t?.id&&N===t.id),C=u.useMemo(()=>t?t.role==="system_admin"?!0:E:!1,[t,E]),A=l?.world?.id??"",O=u.useMemo(()=>{if(!l?.world?.id)return[];const j=l.world;return[{id:j.id,name:j.name||"Untitled world"}]},[l]),_=u.useCallback(async()=>{if(!r||!A){f([]),y("Select a campaign to choose a world context before creating relationship types.");return}h(!0),y("");try{const j=await ti({worldId:A}),z=Array.isArray(j?.data)?j.data:Array.isArray(j)?j:[];f(z)}catch(j){console.error(" Failed to load relationship type options",j),f([]),y(j.message||"Failed to load supporting data")}finally{h(!1)}},[r,A]);if(u.useEffect(()=>{!i||!r||_()},[i,r,_]),!i)return a.jsx("p",{children:"Restoring session..."});if(!r)return a.jsx("p",{children:"Authenticating..."});if(!C)return a.jsxs("section",{className:"page relationship-type-form-page limited-access",children:[a.jsx("h1",{children:"Create Relationship Type"}),a.jsx("p",{children:"Only system administrators or the world owner can create relationship types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]});if(!A)return a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Create Relationship Type"}),a.jsx("p",{children:"Select a campaign from the header to choose a world context before creating relationship types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]});const k=()=>e("/relationship-types"),D=async j=>{if(S)return!1;v(""),w(!0);try{const z={...j,world_id:j.world_id??j.worldId??j.world?.id??A};if(!z.world_id)throw new Error("A world must be selected before creating a relationship type");console.log(" Final payload being sent:",z);const P=await R4(z),G=P?.data??P;if(!G||!G.id)throw new Error("Failed to create relationship type");return e("/relationship-types",{state:{toast:{message:"Relationship type created",tone:"success"}}}),!0}catch(z){return console.error(" Failed to create relationship type",z),v(z.message||"Failed to create relationship type"),!1}finally{w(!1)}};return a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Create Relationship Type"}),a.jsx("p",{className:"page-subtitle",children:"Define the directional names and allowed entity types for this relationship."}),p&&a.jsx("div",{className:"alert error",children:p}),a.jsx(IN,{initialValues:{world_id:A},entityTypes:c,worlds:O,saving:S,optionsLoading:m,errorMessage:g,onSubmit:D,onCancel:k})]})}function WI(){const e=$n(),{id:t}=ws(),{user:r,token:i,sessionReady:l}=Nn(),{selectedCampaign:c}=Bn(),[f,m]=u.useState([]),[h,p]=u.useState(!1),[y,g]=u.useState(""),[v,S]=u.useState(""),[w,N]=u.useState(null),[E,C]=u.useState(!0),[A,O]=u.useState(""),[_,k]=u.useState(!1),D=r?.role==="system_admin",j=u.useMemo(()=>{if(!c||!r)return!1;const $=c.world?.created_by??c.world?.creator?.id??c.world?.owner_id??c.world?.owner?.id??"";return $?$===r.id:!1},[c,r]),z=u.useMemo(()=>!!(D||j),[D,j]),P=c?.world?.id??"",G=c?.world?.name??"",H=u.useMemo(()=>{if(!w)return null;const $=w?.world?.id||w?.world_id||w?.worldId||"";if(!$)return null;const M=w?.world?.name||w?.world_name||w?.worldName||"";return{id:$,name:M||"Untitled world"}},[w]),[X,V]=u.useState([]);u.useEffect(()=>{const $=[];P&&$.push({id:P,name:G||"Untitled world"}),H&&!$.some(M=>M.id===H.id)&&$.push(H),V($)},[P,G,H]);const R=u.useCallback(async()=>{if(i){p(!0),g("");try{const $=P||H?.id||w?.world?.id||w?.world_id||"";if(!$){m([]),g("Select a campaign to choose a world context before editing relationship types.");return}const M=await ti({worldId:$}),U=Array.isArray(M?.data)?M.data:Array.isArray(M)?M:[];m(U)}catch($){console.error(" Failed to load relationship type options",$),m([]),g($.message||"Failed to load supporting data")}finally{p(!1)}}},[i,P,H,w]),B=u.useCallback(async()=>{if(!(!i||!t)){C(!0),O("");try{const $=await M4(t),M=$?.data??$;if(!M)throw new Error("Relationship type not found");N(M)}catch($){console.error(" Failed to load relationship type",$),O($.message||"Failed to load relationship type"),N(null)}finally{C(!1)}}},[t,i]);if(u.useEffect(()=>{!l||!i||B()},[l,i,B]),u.useEffect(()=>{!l||!i||E||R()},[l,i,E,R]),!l)return a.jsx("p",{children:"Restoring session..."});if(!i)return a.jsx("p",{children:"Authenticating..."});if(!z)return a.jsxs("section",{className:"page relationship-type-form-page limited-access",children:[a.jsx("h1",{children:"Edit Relationship Type"}),a.jsx("p",{children:"Only system administrators can edit relationship types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]});const I=()=>e("/relationship-types"),L=async $=>{if(_||!t)return!1;S(""),k(!0);try{const M={...$,world_id:$.world_id||$.worldId||$.selectedWorldId||$.world?.id||P||w?.world_id};if(!M.world_id)throw new Error("A world must be selected before saving changes");const U=await k4(t,M),T=U?.data??U;if(!T||!T.id)throw new Error("Failed to update relationship type");return e("/relationship-types",{state:{toast:{message:"Relationship type updated",tone:"success"}}}),!0}catch(M){return console.error(" Failed to update relationship type",M),S(M.message||"Failed to update relationship type"),!1}finally{k(!1)}};return E?a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Edit Relationship Type"}),a.jsx("div",{className:"form-status",children:"Loading relationship type..."})]}):A||!w?a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Edit Relationship Type"}),a.jsx("div",{className:"alert error",children:A||"Relationship type not found."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]}):a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Edit Relationship Type"}),a.jsx("p",{className:"page-subtitle",children:"Update the directional labels or allowed entity types for this relationship."}),y&&a.jsx("div",{className:"alert error",children:y}),a.jsx(IN,{initialValues:w,entityTypes:f,worlds:X,saving:_,optionsLoading:h,errorMessage:v,onSubmit:L,onCancel:I})]})}function ZI(){return a.jsx("section",{className:"page-placeholder",children:a.jsx("h1",{children:"Entity Secrets Page  Coming Soon"})})}function QI({children:e}){const{token:t,sessionReady:r}=Nn();return r?t?e:a.jsx(Xo,{to:"/login",replace:!0}):a.jsx("p",{children:"Restoring session..."})}function da(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let r=0,i;r<e.length;r++)(i=da(e[r]))!==""&&(t+=(t&&" ")+i);else for(let r in e)e[r]&&(t+=(t&&" ")+r);return t}var hp={exports:{}},pp={},yp={exports:{}},gp={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RS;function JI(){if(RS)return gp;RS=1;var e=Sc();function t(g,v){return g===v&&(g!==0||1/g===1/v)||g!==g&&v!==v}var r=typeof Object.is=="function"?Object.is:t,i=e.useState,l=e.useEffect,c=e.useLayoutEffect,f=e.useDebugValue;function m(g,v){var S=v(),w=i({inst:{value:S,getSnapshot:v}}),N=w[0].inst,E=w[1];return c(function(){N.value=S,N.getSnapshot=v,h(N)&&E({inst:N})},[g,S,v]),l(function(){return h(N)&&E({inst:N}),g(function(){h(N)&&E({inst:N})})},[g]),f(S),S}function h(g){var v=g.getSnapshot;g=g.value;try{var S=v();return!r(g,S)}catch{return!0}}function p(g,v){return v()}var y=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?p:m;return gp.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:y,gp}var kS;function eL(){return kS||(kS=1,yp.exports=JI()),yp.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DS;function tL(){if(DS)return pp;DS=1;var e=Sc(),t=eL();function r(p,y){return p===y&&(p!==0||1/p===1/y)||p!==p&&y!==y}var i=typeof Object.is=="function"?Object.is:r,l=t.useSyncExternalStore,c=e.useRef,f=e.useEffect,m=e.useMemo,h=e.useDebugValue;return pp.useSyncExternalStoreWithSelector=function(p,y,g,v,S){var w=c(null);if(w.current===null){var N={hasValue:!1,value:null};w.current=N}else N=w.current;w=m(function(){function C(D){if(!A){if(A=!0,O=D,D=v(D),S!==void 0&&N.hasValue){var j=N.value;if(S(j,D))return _=j}return _=D}if(j=_,i(O,D))return j;var z=v(D);return S!==void 0&&S(j,z)?(O=D,j):(O=D,_=z)}var A=!1,O,_,k=g===void 0?null:g;return[function(){return C(y())},k===null?void 0:function(){return C(k())}]},[y,g,v,S]);var E=l(p,w[0],w[1]);return f(function(){N.hasValue=!0,N.value=E},[E]),h(E),E},pp}var IS;function nL(){return IS||(IS=1,hp.exports=tL()),hp.exports}var aL=nL();const sL=Di(aL),rL={},LS=e=>{let t;const r=new Set,i=(y,g)=>{const v=typeof y=="function"?y(t):y;if(!Object.is(v,t)){const S=t;t=g??(typeof v!="object"||v===null)?v:Object.assign({},t,v),r.forEach(w=>w(t,S))}},l=()=>t,h={setState:i,getState:l,getInitialState:()=>p,subscribe:y=>(r.add(y),()=>r.delete(y)),destroy:()=>{(rL?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},p=t=e(i,l,h);return h},iL=e=>e?LS(e):LS,{useDebugValue:lL}=De,{useSyncExternalStoreWithSelector:oL}=sL,cL=e=>e;function LN(e,t=cL,r){const i=oL(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return lL(i),i}const OS=(e,t)=>{const r=iL(e),i=(l,c=t)=>LN(r,l,c);return Object.assign(i,r),i},uL=(e,t)=>e?OS(e,t):OS;function sa(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[i,l]of e)if(!Object.is(l,t.get(i)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(const i of r)if(!Object.prototype.hasOwnProperty.call(t,i)||!Object.is(e[i],t[i]))return!1;return!0}var dL={value:()=>{}};function bf(){for(var e=0,t=arguments.length,r={},i;e<t;++e){if(!(i=arguments[e]+"")||i in r||/[\s.]/.test(i))throw new Error("illegal type: "+i);r[i]=[]}return new Sd(r)}function Sd(e){this._=e}function fL(e,t){return e.trim().split(/^|\s+/).map(function(r){var i="",l=r.indexOf(".");if(l>=0&&(i=r.slice(l+1),r=r.slice(0,l)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:i}})}Sd.prototype=bf.prototype={constructor:Sd,on:function(e,t){var r=this._,i=fL(e+"",r),l,c=-1,f=i.length;if(arguments.length<2){for(;++c<f;)if((l=(e=i[c]).type)&&(l=mL(r[l],e.name)))return l;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++c<f;)if(l=(e=i[c]).type)r[l]=zS(r[l],e.name,t);else if(t==null)for(l in r)r[l]=zS(r[l],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new Sd(e)},call:function(e,t){if((l=arguments.length-2)>0)for(var r=new Array(l),i=0,l,c;i<l;++i)r[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(c=this._[e],i=0,l=c.length;i<l;++i)c[i].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],l=0,c=i.length;l<c;++l)i[l].value.apply(t,r)}};function mL(e,t){for(var r=0,i=e.length,l;r<i;++r)if((l=e[r]).name===t)return l.value}function zS(e,t,r){for(var i=0,l=e.length;i<l;++i)if(e[i].name===t){e[i]=dL,e=e.slice(0,i).concat(e.slice(i+1));break}return r!=null&&e.push({name:t,value:r}),e}var ty="http://www.w3.org/1999/xhtml";const $S={svg:"http://www.w3.org/2000/svg",xhtml:ty,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function vf(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),$S.hasOwnProperty(t)?{space:$S[t],local:e}:e}function hL(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===ty&&t.documentElement.namespaceURI===ty?t.createElement(e):t.createElementNS(r,e)}}function pL(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function ON(e){var t=vf(e);return(t.local?pL:hL)(t)}function yL(){}function ag(e){return e==null?yL:function(){return this.querySelector(e)}}function gL(e){typeof e!="function"&&(e=ag(e));for(var t=this._groups,r=t.length,i=new Array(r),l=0;l<r;++l)for(var c=t[l],f=c.length,m=i[l]=new Array(f),h,p,y=0;y<f;++y)(h=c[y])&&(p=e.call(h,h.__data__,y,c))&&("__data__"in h&&(p.__data__=h.__data__),m[y]=p);return new Ya(i,this._parents)}function bL(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function vL(){return[]}function zN(e){return e==null?vL:function(){return this.querySelectorAll(e)}}function xL(e){return function(){return bL(e.apply(this,arguments))}}function SL(e){typeof e=="function"?e=xL(e):e=zN(e);for(var t=this._groups,r=t.length,i=[],l=[],c=0;c<r;++c)for(var f=t[c],m=f.length,h,p=0;p<m;++p)(h=f[p])&&(i.push(e.call(h,h.__data__,p,f)),l.push(h));return new Ya(i,l)}function $N(e){return function(){return this.matches(e)}}function FN(e){return function(t){return t.matches(e)}}var wL=Array.prototype.find;function NL(e){return function(){return wL.call(this.children,e)}}function EL(){return this.firstElementChild}function jL(e){return this.select(e==null?EL:NL(typeof e=="function"?e:FN(e)))}var _L=Array.prototype.filter;function CL(){return Array.from(this.children)}function AL(e){return function(){return _L.call(this.children,e)}}function TL(e){return this.selectAll(e==null?CL:AL(typeof e=="function"?e:FN(e)))}function ML(e){typeof e!="function"&&(e=$N(e));for(var t=this._groups,r=t.length,i=new Array(r),l=0;l<r;++l)for(var c=t[l],f=c.length,m=i[l]=[],h,p=0;p<f;++p)(h=c[p])&&e.call(h,h.__data__,p,c)&&m.push(h);return new Ya(i,this._parents)}function BN(e){return new Array(e.length)}function RL(){return new Ya(this._enter||this._groups.map(BN),this._parents)}function zd(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}zd.prototype={constructor:zd,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function kL(e){return function(){return e}}function DL(e,t,r,i,l,c){for(var f=0,m,h=t.length,p=c.length;f<p;++f)(m=t[f])?(m.__data__=c[f],i[f]=m):r[f]=new zd(e,c[f]);for(;f<h;++f)(m=t[f])&&(l[f]=m)}function IL(e,t,r,i,l,c,f){var m,h,p=new Map,y=t.length,g=c.length,v=new Array(y),S;for(m=0;m<y;++m)(h=t[m])&&(v[m]=S=f.call(h,h.__data__,m,t)+"",p.has(S)?l[m]=h:p.set(S,h));for(m=0;m<g;++m)S=f.call(e,c[m],m,c)+"",(h=p.get(S))?(i[m]=h,h.__data__=c[m],p.delete(S)):r[m]=new zd(e,c[m]);for(m=0;m<y;++m)(h=t[m])&&p.get(v[m])===h&&(l[m]=h)}function LL(e){return e.__data__}function OL(e,t){if(!arguments.length)return Array.from(this,LL);var r=t?IL:DL,i=this._parents,l=this._groups;typeof e!="function"&&(e=kL(e));for(var c=l.length,f=new Array(c),m=new Array(c),h=new Array(c),p=0;p<c;++p){var y=i[p],g=l[p],v=g.length,S=zL(e.call(y,y&&y.__data__,p,i)),w=S.length,N=m[p]=new Array(w),E=f[p]=new Array(w),C=h[p]=new Array(v);r(y,g,N,E,C,S,t);for(var A=0,O=0,_,k;A<w;++A)if(_=N[A]){for(A>=O&&(O=A+1);!(k=E[O])&&++O<w;);_._next=k||null}}return f=new Ya(f,i),f._enter=m,f._exit=h,f}function zL(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function $L(){return new Ya(this._exit||this._groups.map(BN),this._parents)}function FL(e,t,r){var i=this.enter(),l=this,c=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),t!=null&&(l=t(l),l&&(l=l.selection())),r==null?c.remove():r(c),i&&l?i.merge(l).order():l}function BL(e){for(var t=e.selection?e.selection():e,r=this._groups,i=t._groups,l=r.length,c=i.length,f=Math.min(l,c),m=new Array(l),h=0;h<f;++h)for(var p=r[h],y=i[h],g=p.length,v=m[h]=new Array(g),S,w=0;w<g;++w)(S=p[w]||y[w])&&(v[w]=S);for(;h<l;++h)m[h]=r[h];return new Ya(m,this._parents)}function UL(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var i=e[t],l=i.length-1,c=i[l],f;--l>=0;)(f=i[l])&&(c&&f.compareDocumentPosition(c)^4&&c.parentNode.insertBefore(f,c),c=f);return this}function qL(e){e||(e=HL);function t(g,v){return g&&v?e(g.__data__,v.__data__):!g-!v}for(var r=this._groups,i=r.length,l=new Array(i),c=0;c<i;++c){for(var f=r[c],m=f.length,h=l[c]=new Array(m),p,y=0;y<m;++y)(p=f[y])&&(h[y]=p);h.sort(t)}return new Ya(l,this._parents).order()}function HL(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function PL(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function VL(){return Array.from(this)}function YL(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],l=0,c=i.length;l<c;++l){var f=i[l];if(f)return f}return null}function GL(){let e=0;for(const t of this)++e;return e}function XL(){return!this.node()}function KL(e){for(var t=this._groups,r=0,i=t.length;r<i;++r)for(var l=t[r],c=0,f=l.length,m;c<f;++c)(m=l[c])&&e.call(m,m.__data__,c,l);return this}function WL(e){return function(){this.removeAttribute(e)}}function ZL(e){return function(){this.removeAttributeNS(e.space,e.local)}}function QL(e,t){return function(){this.setAttribute(e,t)}}function JL(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function e5(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function t5(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function n5(e,t){var r=vf(e);if(arguments.length<2){var i=this.node();return r.local?i.getAttributeNS(r.space,r.local):i.getAttribute(r)}return this.each((t==null?r.local?ZL:WL:typeof t=="function"?r.local?t5:e5:r.local?JL:QL)(r,t))}function UN(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function a5(e){return function(){this.style.removeProperty(e)}}function s5(e,t,r){return function(){this.style.setProperty(e,t,r)}}function r5(e,t,r){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,r)}}function i5(e,t,r){return arguments.length>1?this.each((t==null?a5:typeof t=="function"?r5:s5)(e,t,r??"")):Ml(this.node(),e)}function Ml(e,t){return e.style.getPropertyValue(t)||UN(e).getComputedStyle(e,null).getPropertyValue(t)}function l5(e){return function(){delete this[e]}}function o5(e,t){return function(){this[e]=t}}function c5(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function u5(e,t){return arguments.length>1?this.each((t==null?l5:typeof t=="function"?c5:o5)(e,t)):this.node()[e]}function qN(e){return e.trim().split(/^|\s+/)}function sg(e){return e.classList||new HN(e)}function HN(e){this._node=e,this._names=qN(e.getAttribute("class")||"")}HN.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function PN(e,t){for(var r=sg(e),i=-1,l=t.length;++i<l;)r.add(t[i])}function VN(e,t){for(var r=sg(e),i=-1,l=t.length;++i<l;)r.remove(t[i])}function d5(e){return function(){PN(this,e)}}function f5(e){return function(){VN(this,e)}}function m5(e,t){return function(){(t.apply(this,arguments)?PN:VN)(this,e)}}function h5(e,t){var r=qN(e+"");if(arguments.length<2){for(var i=sg(this.node()),l=-1,c=r.length;++l<c;)if(!i.contains(r[l]))return!1;return!0}return this.each((typeof t=="function"?m5:t?d5:f5)(r,t))}function p5(){this.textContent=""}function y5(e){return function(){this.textContent=e}}function g5(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function b5(e){return arguments.length?this.each(e==null?p5:(typeof e=="function"?g5:y5)(e)):this.node().textContent}function v5(){this.innerHTML=""}function x5(e){return function(){this.innerHTML=e}}function S5(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function w5(e){return arguments.length?this.each(e==null?v5:(typeof e=="function"?S5:x5)(e)):this.node().innerHTML}function N5(){this.nextSibling&&this.parentNode.appendChild(this)}function E5(){return this.each(N5)}function j5(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function _5(){return this.each(j5)}function C5(e){var t=typeof e=="function"?e:ON(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function A5(){return null}function T5(e,t){var r=typeof e=="function"?e:ON(e),i=t==null?A5:typeof t=="function"?t:ag(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),i.apply(this,arguments)||null)})}function M5(){var e=this.parentNode;e&&e.removeChild(this)}function R5(){return this.each(M5)}function k5(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function D5(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function I5(e){return this.select(e?D5:k5)}function L5(e){return arguments.length?this.property("__data__",e):this.node().__data__}function O5(e){return function(t){e.call(this,t,this.__data__)}}function z5(e){return e.trim().split(/^|\s+/).map(function(t){var r="",i=t.indexOf(".");return i>=0&&(r=t.slice(i+1),t=t.slice(0,i)),{type:t,name:r}})}function $5(e){return function(){var t=this.__on;if(t){for(var r=0,i=-1,l=t.length,c;r<l;++r)c=t[r],(!e.type||c.type===e.type)&&c.name===e.name?this.removeEventListener(c.type,c.listener,c.options):t[++i]=c;++i?t.length=i:delete this.__on}}}function F5(e,t,r){return function(){var i=this.__on,l,c=O5(t);if(i){for(var f=0,m=i.length;f<m;++f)if((l=i[f]).type===e.type&&l.name===e.name){this.removeEventListener(l.type,l.listener,l.options),this.addEventListener(l.type,l.listener=c,l.options=r),l.value=t;return}}this.addEventListener(e.type,c,r),l={type:e.type,name:e.name,value:t,listener:c,options:r},i?i.push(l):this.__on=[l]}}function B5(e,t,r){var i=z5(e+""),l,c=i.length,f;if(arguments.length<2){var m=this.node().__on;if(m){for(var h=0,p=m.length,y;h<p;++h)for(l=0,y=m[h];l<c;++l)if((f=i[l]).type===y.type&&f.name===y.name)return y.value}return}for(m=t?F5:$5,l=0;l<c;++l)this.each(m(i[l],t,r));return this}function YN(e,t,r){var i=UN(e),l=i.CustomEvent;typeof l=="function"?l=new l(t,r):(l=i.document.createEvent("Event"),r?(l.initEvent(t,r.bubbles,r.cancelable),l.detail=r.detail):l.initEvent(t,!1,!1)),e.dispatchEvent(l)}function U5(e,t){return function(){return YN(this,e,t)}}function q5(e,t){return function(){return YN(this,e,t.apply(this,arguments))}}function H5(e,t){return this.each((typeof t=="function"?q5:U5)(e,t))}function*P5(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],l=0,c=i.length,f;l<c;++l)(f=i[l])&&(yield f)}var GN=[null];function Ya(e,t){this._groups=e,this._parents=t}function Cc(){return new Ya([[document.documentElement]],GN)}function V5(){return this}Ya.prototype=Cc.prototype={constructor:Ya,select:gL,selectAll:SL,selectChild:jL,selectChildren:TL,filter:ML,data:OL,enter:RL,exit:$L,join:FL,merge:BL,selection:V5,order:UL,sort:qL,call:PL,nodes:VL,node:YL,size:GL,empty:XL,each:KL,attr:n5,style:i5,property:u5,classed:h5,text:b5,html:w5,raise:E5,lower:_5,append:C5,insert:T5,remove:R5,clone:I5,datum:L5,on:B5,dispatch:H5,[Symbol.iterator]:P5};function ss(e){return typeof e=="string"?new Ya([[document.querySelector(e)]],[document.documentElement]):new Ya([[e]],GN)}function Y5(e){let t;for(;t=e.sourceEvent;)e=t;return e}function ys(e,t){if(e=Y5(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var i=r.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}if(t.getBoundingClientRect){var l=t.getBoundingClientRect();return[e.clientX-l.left-t.clientLeft,e.clientY-l.top-t.clientTop]}}return[e.pageX,e.pageY]}const G5={passive:!1},mc={capture:!0,passive:!1};function bp(e){e.stopImmediatePropagation()}function El(e){e.preventDefault(),e.stopImmediatePropagation()}function XN(e){var t=e.document.documentElement,r=ss(e).on("dragstart.drag",El,mc);"onselectstart"in t?r.on("selectstart.drag",El,mc):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function KN(e,t){var r=e.document.documentElement,i=ss(e).on("dragstart.drag",null);t&&(i.on("click.drag",El,mc),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in r?i.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}const Qu=e=>()=>e;function ny(e,{sourceEvent:t,subject:r,target:i,identifier:l,active:c,x:f,y:m,dx:h,dy:p,dispatch:y}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:l,enumerable:!0,configurable:!0},active:{value:c,enumerable:!0,configurable:!0},x:{value:f,enumerable:!0,configurable:!0},y:{value:m,enumerable:!0,configurable:!0},dx:{value:h,enumerable:!0,configurable:!0},dy:{value:p,enumerable:!0,configurable:!0},_:{value:y}})}ny.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function X5(e){return!e.ctrlKey&&!e.button}function K5(){return this.parentNode}function W5(e,t){return t??{x:e.x,y:e.y}}function Z5(){return navigator.maxTouchPoints||"ontouchstart"in this}function Q5(){var e=X5,t=K5,r=W5,i=Z5,l={},c=bf("start","drag","end"),f=0,m,h,p,y,g=0;function v(_){_.on("mousedown.drag",S).filter(i).on("touchstart.drag",E).on("touchmove.drag",C,G5).on("touchend.drag touchcancel.drag",A).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function S(_,k){if(!(y||!e.call(this,_,k))){var D=O(this,t.call(this,_,k),_,k,"mouse");D&&(ss(_.view).on("mousemove.drag",w,mc).on("mouseup.drag",N,mc),XN(_.view),bp(_),p=!1,m=_.clientX,h=_.clientY,D("start",_))}}function w(_){if(El(_),!p){var k=_.clientX-m,D=_.clientY-h;p=k*k+D*D>g}l.mouse("drag",_)}function N(_){ss(_.view).on("mousemove.drag mouseup.drag",null),KN(_.view,p),El(_),l.mouse("end",_)}function E(_,k){if(e.call(this,_,k)){var D=_.changedTouches,j=t.call(this,_,k),z=D.length,P,G;for(P=0;P<z;++P)(G=O(this,j,_,k,D[P].identifier,D[P]))&&(bp(_),G("start",_,D[P]))}}function C(_){var k=_.changedTouches,D=k.length,j,z;for(j=0;j<D;++j)(z=l[k[j].identifier])&&(El(_),z("drag",_,k[j]))}function A(_){var k=_.changedTouches,D=k.length,j,z;for(y&&clearTimeout(y),y=setTimeout(function(){y=null},500),j=0;j<D;++j)(z=l[k[j].identifier])&&(bp(_),z("end",_,k[j]))}function O(_,k,D,j,z,P){var G=c.copy(),H=ys(P||D,k),X,V,R;if((R=r.call(_,new ny("beforestart",{sourceEvent:D,target:v,identifier:z,active:f,x:H[0],y:H[1],dx:0,dy:0,dispatch:G}),j))!=null)return X=R.x-H[0]||0,V=R.y-H[1]||0,function B(I,L,$){var M=H,U;switch(I){case"start":l[z]=B,U=f++;break;case"end":delete l[z],--f;case"drag":H=ys($||L,k),U=f;break}G.call(I,_,new ny(I,{sourceEvent:L,subject:R,target:v,identifier:z,active:U,x:H[0]+X,y:H[1]+V,dx:H[0]-M[0],dy:H[1]-M[1],dispatch:G}),j)}}return v.filter=function(_){return arguments.length?(e=typeof _=="function"?_:Qu(!!_),v):e},v.container=function(_){return arguments.length?(t=typeof _=="function"?_:Qu(_),v):t},v.subject=function(_){return arguments.length?(r=typeof _=="function"?_:Qu(_),v):r},v.touchable=function(_){return arguments.length?(i=typeof _=="function"?_:Qu(!!_),v):i},v.on=function(){var _=c.on.apply(c,arguments);return _===c?v:_},v.clickDistance=function(_){return arguments.length?(g=(_=+_)*_,v):Math.sqrt(g)},v}function rg(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function WN(e,t){var r=Object.create(e.prototype);for(var i in t)r[i]=t[i];return r}function Ac(){}var hc=.7,$d=1/hc,jl="\\s*([+-]?\\d+)\\s*",pc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Is="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",J5=/^#([0-9a-f]{3,8})$/,eO=new RegExp(`^rgb\\(${jl},${jl},${jl}\\)$`),tO=new RegExp(`^rgb\\(${Is},${Is},${Is}\\)$`),nO=new RegExp(`^rgba\\(${jl},${jl},${jl},${pc}\\)$`),aO=new RegExp(`^rgba\\(${Is},${Is},${Is},${pc}\\)$`),sO=new RegExp(`^hsl\\(${pc},${Is},${Is}\\)$`),rO=new RegExp(`^hsla\\(${pc},${Is},${Is},${pc}\\)$`),FS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};rg(Ac,yc,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:BS,formatHex:BS,formatHex8:iO,formatHsl:lO,formatRgb:US,toString:US});function BS(){return this.rgb().formatHex()}function iO(){return this.rgb().formatHex8()}function lO(){return ZN(this).formatHsl()}function US(){return this.rgb().formatRgb()}function yc(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=J5.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?qS(t):r===3?new Ra(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?Ju(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?Ju(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=eO.exec(e))?new Ra(t[1],t[2],t[3],1):(t=tO.exec(e))?new Ra(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=nO.exec(e))?Ju(t[1],t[2],t[3],t[4]):(t=aO.exec(e))?Ju(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=sO.exec(e))?VS(t[1],t[2]/100,t[3]/100,1):(t=rO.exec(e))?VS(t[1],t[2]/100,t[3]/100,t[4]):FS.hasOwnProperty(e)?qS(FS[e]):e==="transparent"?new Ra(NaN,NaN,NaN,0):null}function qS(e){return new Ra(e>>16&255,e>>8&255,e&255,1)}function Ju(e,t,r,i){return i<=0&&(e=t=r=NaN),new Ra(e,t,r,i)}function oO(e){return e instanceof Ac||(e=yc(e)),e?(e=e.rgb(),new Ra(e.r,e.g,e.b,e.opacity)):new Ra}function ay(e,t,r,i){return arguments.length===1?oO(e):new Ra(e,t,r,i??1)}function Ra(e,t,r,i){this.r=+e,this.g=+t,this.b=+r,this.opacity=+i}rg(Ra,ay,WN(Ac,{brighter(e){return e=e==null?$d:Math.pow($d,e),new Ra(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?hc:Math.pow(hc,e),new Ra(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ra(Ti(this.r),Ti(this.g),Ti(this.b),Fd(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:HS,formatHex:HS,formatHex8:cO,formatRgb:PS,toString:PS}));function HS(){return`#${Ci(this.r)}${Ci(this.g)}${Ci(this.b)}`}function cO(){return`#${Ci(this.r)}${Ci(this.g)}${Ci(this.b)}${Ci((isNaN(this.opacity)?1:this.opacity)*255)}`}function PS(){const e=Fd(this.opacity);return`${e===1?"rgb(":"rgba("}${Ti(this.r)}, ${Ti(this.g)}, ${Ti(this.b)}${e===1?")":`, ${e})`}`}function Fd(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ti(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Ci(e){return e=Ti(e),(e<16?"0":"")+e.toString(16)}function VS(e,t,r,i){return i<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new gs(e,t,r,i)}function ZN(e){if(e instanceof gs)return new gs(e.h,e.s,e.l,e.opacity);if(e instanceof Ac||(e=yc(e)),!e)return new gs;if(e instanceof gs)return e;e=e.rgb();var t=e.r/255,r=e.g/255,i=e.b/255,l=Math.min(t,r,i),c=Math.max(t,r,i),f=NaN,m=c-l,h=(c+l)/2;return m?(t===c?f=(r-i)/m+(r<i)*6:r===c?f=(i-t)/m+2:f=(t-r)/m+4,m/=h<.5?c+l:2-c-l,f*=60):m=h>0&&h<1?0:f,new gs(f,m,h,e.opacity)}function uO(e,t,r,i){return arguments.length===1?ZN(e):new gs(e,t,r,i??1)}function gs(e,t,r,i){this.h=+e,this.s=+t,this.l=+r,this.opacity=+i}rg(gs,uO,WN(Ac,{brighter(e){return e=e==null?$d:Math.pow($d,e),new gs(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?hc:Math.pow(hc,e),new gs(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*t,l=2*r-i;return new Ra(vp(e>=240?e-240:e+120,l,i),vp(e,l,i),vp(e<120?e+240:e-120,l,i),this.opacity)},clamp(){return new gs(YS(this.h),ed(this.s),ed(this.l),Fd(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Fd(this.opacity);return`${e===1?"hsl(":"hsla("}${YS(this.h)}, ${ed(this.s)*100}%, ${ed(this.l)*100}%${e===1?")":`, ${e})`}`}}));function YS(e){return e=(e||0)%360,e<0?e+360:e}function ed(e){return Math.max(0,Math.min(1,e||0))}function vp(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const QN=e=>()=>e;function dO(e,t){return function(r){return e+r*t}}function fO(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(i){return Math.pow(e+i*t,r)}}function mO(e){return(e=+e)==1?JN:function(t,r){return r-t?fO(t,r,e):QN(isNaN(t)?r:t)}}function JN(e,t){var r=t-e;return r?dO(e,r):QN(isNaN(e)?t:e)}const GS=(function e(t){var r=mO(t);function i(l,c){var f=r((l=ay(l)).r,(c=ay(c)).r),m=r(l.g,c.g),h=r(l.b,c.b),p=JN(l.opacity,c.opacity);return function(y){return l.r=f(y),l.g=m(y),l.b=h(y),l.opacity=p(y),l+""}}return i.gamma=e,i})(1);function Ur(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}var sy=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,xp=new RegExp(sy.source,"g");function hO(e){return function(){return e}}function pO(e){return function(t){return e(t)+""}}function yO(e,t){var r=sy.lastIndex=xp.lastIndex=0,i,l,c,f=-1,m=[],h=[];for(e=e+"",t=t+"";(i=sy.exec(e))&&(l=xp.exec(t));)(c=l.index)>r&&(c=t.slice(r,c),m[f]?m[f]+=c:m[++f]=c),(i=i[0])===(l=l[0])?m[f]?m[f]+=l:m[++f]=l:(m[++f]=null,h.push({i:f,x:Ur(i,l)})),r=xp.lastIndex;return r<t.length&&(c=t.slice(r),m[f]?m[f]+=c:m[++f]=c),m.length<2?h[0]?pO(h[0].x):hO(t):(t=h.length,function(p){for(var y=0,g;y<t;++y)m[(g=h[y]).i]=g.x(p);return m.join("")})}var XS=180/Math.PI,ry={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function eE(e,t,r,i,l,c){var f,m,h;return(f=Math.sqrt(e*e+t*t))&&(e/=f,t/=f),(h=e*r+t*i)&&(r-=e*h,i-=t*h),(m=Math.sqrt(r*r+i*i))&&(r/=m,i/=m,h/=m),e*i<t*r&&(e=-e,t=-t,h=-h,f=-f),{translateX:l,translateY:c,rotate:Math.atan2(t,e)*XS,skewX:Math.atan(h)*XS,scaleX:f,scaleY:m}}var td;function gO(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?ry:eE(t.a,t.b,t.c,t.d,t.e,t.f)}function bO(e){return e==null||(td||(td=document.createElementNS("http://www.w3.org/2000/svg","g")),td.setAttribute("transform",e),!(e=td.transform.baseVal.consolidate()))?ry:(e=e.matrix,eE(e.a,e.b,e.c,e.d,e.e,e.f))}function tE(e,t,r,i){function l(p){return p.length?p.pop()+" ":""}function c(p,y,g,v,S,w){if(p!==g||y!==v){var N=S.push("translate(",null,t,null,r);w.push({i:N-4,x:Ur(p,g)},{i:N-2,x:Ur(y,v)})}else(g||v)&&S.push("translate("+g+t+v+r)}function f(p,y,g,v){p!==y?(p-y>180?y+=360:y-p>180&&(p+=360),v.push({i:g.push(l(g)+"rotate(",null,i)-2,x:Ur(p,y)})):y&&g.push(l(g)+"rotate("+y+i)}function m(p,y,g,v){p!==y?v.push({i:g.push(l(g)+"skewX(",null,i)-2,x:Ur(p,y)}):y&&g.push(l(g)+"skewX("+y+i)}function h(p,y,g,v,S,w){if(p!==g||y!==v){var N=S.push(l(S)+"scale(",null,",",null,")");w.push({i:N-4,x:Ur(p,g)},{i:N-2,x:Ur(y,v)})}else(g!==1||v!==1)&&S.push(l(S)+"scale("+g+","+v+")")}return function(p,y){var g=[],v=[];return p=e(p),y=e(y),c(p.translateX,p.translateY,y.translateX,y.translateY,g,v),f(p.rotate,y.rotate,g,v),m(p.skewX,y.skewX,g,v),h(p.scaleX,p.scaleY,y.scaleX,y.scaleY,g,v),p=y=null,function(S){for(var w=-1,N=v.length,E;++w<N;)g[(E=v[w]).i]=E.x(S);return g.join("")}}}var vO=tE(gO,"px, ","px)","deg)"),xO=tE(bO,", ",")",")"),SO=1e-12;function KS(e){return((e=Math.exp(e))+1/e)/2}function wO(e){return((e=Math.exp(e))-1/e)/2}function NO(e){return((e=Math.exp(2*e))-1)/(e+1)}const EO=(function e(t,r,i){function l(c,f){var m=c[0],h=c[1],p=c[2],y=f[0],g=f[1],v=f[2],S=y-m,w=g-h,N=S*S+w*w,E,C;if(N<SO)C=Math.log(v/p)/t,E=function(j){return[m+j*S,h+j*w,p*Math.exp(t*j*C)]};else{var A=Math.sqrt(N),O=(v*v-p*p+i*N)/(2*p*r*A),_=(v*v-p*p-i*N)/(2*v*r*A),k=Math.log(Math.sqrt(O*O+1)-O),D=Math.log(Math.sqrt(_*_+1)-_);C=(D-k)/t,E=function(j){var z=j*C,P=KS(k),G=p/(r*A)*(P*NO(t*z+k)-wO(k));return[m+G*S,h+G*w,p*P/KS(t*z+k)]}}return E.duration=C*1e3*t/Math.SQRT2,E}return l.rho=function(c){var f=Math.max(.001,+c),m=f*f,h=m*m;return e(f,m,h)},l})(Math.SQRT2,2,4);var Rl=0,Zo=0,$o=0,nE=1e3,Bd,Qo,Ud=0,Ri=0,xf=0,gc=typeof performance=="object"&&performance.now?performance:Date,aE=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function ig(){return Ri||(aE(jO),Ri=gc.now()+xf)}function jO(){Ri=0}function qd(){this._call=this._time=this._next=null}qd.prototype=sE.prototype={constructor:qd,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?ig():+r)+(t==null?0:+t),!this._next&&Qo!==this&&(Qo?Qo._next=this:Bd=this,Qo=this),this._call=e,this._time=r,iy()},stop:function(){this._call&&(this._call=null,this._time=1/0,iy())}};function sE(e,t,r){var i=new qd;return i.restart(e,t,r),i}function _O(){ig(),++Rl;for(var e=Bd,t;e;)(t=Ri-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Rl}function WS(){Ri=(Ud=gc.now())+xf,Rl=Zo=0;try{_O()}finally{Rl=0,AO(),Ri=0}}function CO(){var e=gc.now(),t=e-Ud;t>nE&&(xf-=t,Ud=e)}function AO(){for(var e,t=Bd,r,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:Bd=r);Qo=e,iy(i)}function iy(e){if(!Rl){Zo&&(Zo=clearTimeout(Zo));var t=e-Ri;t>24?(e<1/0&&(Zo=setTimeout(WS,e-gc.now()-xf)),$o&&($o=clearInterval($o))):($o||(Ud=gc.now(),$o=setInterval(CO,nE)),Rl=1,aE(WS))}}function ZS(e,t,r){var i=new qd;return t=t==null?0:+t,i.restart(l=>{i.stop(),e(l+t)},t,r),i}var TO=bf("start","end","cancel","interrupt"),MO=[],rE=0,QS=1,ly=2,wd=3,JS=4,oy=5,Nd=6;function Sf(e,t,r,i,l,c){var f=e.__transition;if(!f)e.__transition={};else if(r in f)return;RO(e,r,{name:t,index:i,group:l,on:TO,tween:MO,time:c.time,delay:c.delay,duration:c.duration,ease:c.ease,timer:null,state:rE})}function lg(e,t){var r=Ns(e,t);if(r.state>rE)throw new Error("too late; already scheduled");return r}function zs(e,t){var r=Ns(e,t);if(r.state>wd)throw new Error("too late; already running");return r}function Ns(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function RO(e,t,r){var i=e.__transition,l;i[t]=r,r.timer=sE(c,0,r.time);function c(p){r.state=QS,r.timer.restart(f,r.delay,r.time),r.delay<=p&&f(p-r.delay)}function f(p){var y,g,v,S;if(r.state!==QS)return h();for(y in i)if(S=i[y],S.name===r.name){if(S.state===wd)return ZS(f);S.state===JS?(S.state=Nd,S.timer.stop(),S.on.call("interrupt",e,e.__data__,S.index,S.group),delete i[y]):+y<t&&(S.state=Nd,S.timer.stop(),S.on.call("cancel",e,e.__data__,S.index,S.group),delete i[y])}if(ZS(function(){r.state===wd&&(r.state=JS,r.timer.restart(m,r.delay,r.time),m(p))}),r.state=ly,r.on.call("start",e,e.__data__,r.index,r.group),r.state===ly){for(r.state=wd,l=new Array(v=r.tween.length),y=0,g=-1;y<v;++y)(S=r.tween[y].value.call(e,e.__data__,r.index,r.group))&&(l[++g]=S);l.length=g+1}}function m(p){for(var y=p<r.duration?r.ease.call(null,p/r.duration):(r.timer.restart(h),r.state=oy,1),g=-1,v=l.length;++g<v;)l[g].call(e,y);r.state===oy&&(r.on.call("end",e,e.__data__,r.index,r.group),h())}function h(){r.state=Nd,r.timer.stop(),delete i[t];for(var p in i)return;delete e.__transition}}function Ed(e,t){var r=e.__transition,i,l,c=!0,f;if(r){t=t==null?null:t+"";for(f in r){if((i=r[f]).name!==t){c=!1;continue}l=i.state>ly&&i.state<oy,i.state=Nd,i.timer.stop(),i.on.call(l?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete r[f]}c&&delete e.__transition}}function kO(e){return this.each(function(){Ed(this,e)})}function DO(e,t){var r,i;return function(){var l=zs(this,e),c=l.tween;if(c!==r){i=r=c;for(var f=0,m=i.length;f<m;++f)if(i[f].name===t){i=i.slice(),i.splice(f,1);break}}l.tween=i}}function IO(e,t,r){var i,l;if(typeof r!="function")throw new Error;return function(){var c=zs(this,e),f=c.tween;if(f!==i){l=(i=f).slice();for(var m={name:t,value:r},h=0,p=l.length;h<p;++h)if(l[h].name===t){l[h]=m;break}h===p&&l.push(m)}c.tween=l}}function LO(e,t){var r=this._id;if(e+="",arguments.length<2){for(var i=Ns(this.node(),r).tween,l=0,c=i.length,f;l<c;++l)if((f=i[l]).name===e)return f.value;return null}return this.each((t==null?DO:IO)(r,e,t))}function og(e,t,r){var i=e._id;return e.each(function(){var l=zs(this,i);(l.value||(l.value={}))[t]=r.apply(this,arguments)}),function(l){return Ns(l,i).value[t]}}function iE(e,t){var r;return(typeof t=="number"?Ur:t instanceof yc?GS:(r=yc(t))?(t=r,GS):yO)(e,t)}function OO(e){return function(){this.removeAttribute(e)}}function zO(e){return function(){this.removeAttributeNS(e.space,e.local)}}function $O(e,t,r){var i,l=r+"",c;return function(){var f=this.getAttribute(e);return f===l?null:f===i?c:c=t(i=f,r)}}function FO(e,t,r){var i,l=r+"",c;return function(){var f=this.getAttributeNS(e.space,e.local);return f===l?null:f===i?c:c=t(i=f,r)}}function BO(e,t,r){var i,l,c;return function(){var f,m=r(this),h;return m==null?void this.removeAttribute(e):(f=this.getAttribute(e),h=m+"",f===h?null:f===i&&h===l?c:(l=h,c=t(i=f,m)))}}function UO(e,t,r){var i,l,c;return function(){var f,m=r(this),h;return m==null?void this.removeAttributeNS(e.space,e.local):(f=this.getAttributeNS(e.space,e.local),h=m+"",f===h?null:f===i&&h===l?c:(l=h,c=t(i=f,m)))}}function qO(e,t){var r=vf(e),i=r==="transform"?xO:iE;return this.attrTween(e,typeof t=="function"?(r.local?UO:BO)(r,i,og(this,"attr."+e,t)):t==null?(r.local?zO:OO)(r):(r.local?FO:$O)(r,i,t))}function HO(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function PO(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function VO(e,t){var r,i;function l(){var c=t.apply(this,arguments);return c!==i&&(r=(i=c)&&PO(e,c)),r}return l._value=t,l}function YO(e,t){var r,i;function l(){var c=t.apply(this,arguments);return c!==i&&(r=(i=c)&&HO(e,c)),r}return l._value=t,l}function GO(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var i=vf(e);return this.tween(r,(i.local?VO:YO)(i,t))}function XO(e,t){return function(){lg(this,e).delay=+t.apply(this,arguments)}}function KO(e,t){return t=+t,function(){lg(this,e).delay=t}}function WO(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?XO:KO)(t,e)):Ns(this.node(),t).delay}function ZO(e,t){return function(){zs(this,e).duration=+t.apply(this,arguments)}}function QO(e,t){return t=+t,function(){zs(this,e).duration=t}}function JO(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?ZO:QO)(t,e)):Ns(this.node(),t).duration}function e7(e,t){if(typeof t!="function")throw new Error;return function(){zs(this,e).ease=t}}function t7(e){var t=this._id;return arguments.length?this.each(e7(t,e)):Ns(this.node(),t).ease}function n7(e,t){return function(){var r=t.apply(this,arguments);if(typeof r!="function")throw new Error;zs(this,e).ease=r}}function a7(e){if(typeof e!="function")throw new Error;return this.each(n7(this._id,e))}function s7(e){typeof e!="function"&&(e=$N(e));for(var t=this._groups,r=t.length,i=new Array(r),l=0;l<r;++l)for(var c=t[l],f=c.length,m=i[l]=[],h,p=0;p<f;++p)(h=c[p])&&e.call(h,h.__data__,p,c)&&m.push(h);return new ur(i,this._parents,this._name,this._id)}function r7(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,i=t.length,l=r.length,c=Math.min(i,l),f=new Array(i),m=0;m<c;++m)for(var h=t[m],p=r[m],y=h.length,g=f[m]=new Array(y),v,S=0;S<y;++S)(v=h[S]||p[S])&&(g[S]=v);for(;m<i;++m)f[m]=t[m];return new ur(f,this._parents,this._name,this._id)}function i7(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function l7(e,t,r){var i,l,c=i7(t)?lg:zs;return function(){var f=c(this,e),m=f.on;m!==i&&(l=(i=m).copy()).on(t,r),f.on=l}}function o7(e,t){var r=this._id;return arguments.length<2?Ns(this.node(),r).on.on(e):this.each(l7(r,e,t))}function c7(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function u7(){return this.on("end.remove",c7(this._id))}function d7(e){var t=this._name,r=this._id;typeof e!="function"&&(e=ag(e));for(var i=this._groups,l=i.length,c=new Array(l),f=0;f<l;++f)for(var m=i[f],h=m.length,p=c[f]=new Array(h),y,g,v=0;v<h;++v)(y=m[v])&&(g=e.call(y,y.__data__,v,m))&&("__data__"in y&&(g.__data__=y.__data__),p[v]=g,Sf(p[v],t,r,v,p,Ns(y,r)));return new ur(c,this._parents,t,r)}function f7(e){var t=this._name,r=this._id;typeof e!="function"&&(e=zN(e));for(var i=this._groups,l=i.length,c=[],f=[],m=0;m<l;++m)for(var h=i[m],p=h.length,y,g=0;g<p;++g)if(y=h[g]){for(var v=e.call(y,y.__data__,g,h),S,w=Ns(y,r),N=0,E=v.length;N<E;++N)(S=v[N])&&Sf(S,t,r,N,v,w);c.push(v),f.push(y)}return new ur(c,f,t,r)}var m7=Cc.prototype.constructor;function h7(){return new m7(this._groups,this._parents)}function p7(e,t){var r,i,l;return function(){var c=Ml(this,e),f=(this.style.removeProperty(e),Ml(this,e));return c===f?null:c===r&&f===i?l:l=t(r=c,i=f)}}function lE(e){return function(){this.style.removeProperty(e)}}function y7(e,t,r){var i,l=r+"",c;return function(){var f=Ml(this,e);return f===l?null:f===i?c:c=t(i=f,r)}}function g7(e,t,r){var i,l,c;return function(){var f=Ml(this,e),m=r(this),h=m+"";return m==null&&(h=m=(this.style.removeProperty(e),Ml(this,e))),f===h?null:f===i&&h===l?c:(l=h,c=t(i=f,m))}}function b7(e,t){var r,i,l,c="style."+t,f="end."+c,m;return function(){var h=zs(this,e),p=h.on,y=h.value[c]==null?m||(m=lE(t)):void 0;(p!==r||l!==y)&&(i=(r=p).copy()).on(f,l=y),h.on=i}}function v7(e,t,r){var i=(e+="")=="transform"?vO:iE;return t==null?this.styleTween(e,p7(e,i)).on("end.style."+e,lE(e)):typeof t=="function"?this.styleTween(e,g7(e,i,og(this,"style."+e,t))).each(b7(this._id,e)):this.styleTween(e,y7(e,i,t),r).on("end.style."+e,null)}function x7(e,t,r){return function(i){this.style.setProperty(e,t.call(this,i),r)}}function S7(e,t,r){var i,l;function c(){var f=t.apply(this,arguments);return f!==l&&(i=(l=f)&&x7(e,f,r)),i}return c._value=t,c}function w7(e,t,r){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,S7(e,t,r??""))}function N7(e){return function(){this.textContent=e}}function E7(e){return function(){var t=e(this);this.textContent=t??""}}function j7(e){return this.tween("text",typeof e=="function"?E7(og(this,"text",e)):N7(e==null?"":e+""))}function _7(e){return function(t){this.textContent=e.call(this,t)}}function C7(e){var t,r;function i(){var l=e.apply(this,arguments);return l!==r&&(t=(r=l)&&_7(l)),t}return i._value=e,i}function A7(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,C7(e))}function T7(){for(var e=this._name,t=this._id,r=oE(),i=this._groups,l=i.length,c=0;c<l;++c)for(var f=i[c],m=f.length,h,p=0;p<m;++p)if(h=f[p]){var y=Ns(h,t);Sf(h,e,r,p,f,{time:y.time+y.delay+y.duration,delay:0,duration:y.duration,ease:y.ease})}return new ur(i,this._parents,e,r)}function M7(){var e,t,r=this,i=r._id,l=r.size();return new Promise(function(c,f){var m={value:f},h={value:function(){--l===0&&c()}};r.each(function(){var p=zs(this,i),y=p.on;y!==e&&(t=(e=y).copy(),t._.cancel.push(m),t._.interrupt.push(m),t._.end.push(h)),p.on=t}),l===0&&c()})}var R7=0;function ur(e,t,r,i){this._groups=e,this._parents=t,this._name=r,this._id=i}function oE(){return++R7}var tr=Cc.prototype;ur.prototype={constructor:ur,select:d7,selectAll:f7,selectChild:tr.selectChild,selectChildren:tr.selectChildren,filter:s7,merge:r7,selection:h7,transition:T7,call:tr.call,nodes:tr.nodes,node:tr.node,size:tr.size,empty:tr.empty,each:tr.each,on:o7,attr:qO,attrTween:GO,style:v7,styleTween:w7,text:j7,textTween:A7,remove:u7,tween:LO,delay:WO,duration:JO,ease:t7,easeVarying:a7,end:M7,[Symbol.iterator]:tr[Symbol.iterator]};function k7(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var D7={time:null,delay:0,duration:250,ease:k7};function I7(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}function L7(e){var t,r;e instanceof ur?(t=e._id,e=e._name):(t=oE(),(r=D7).time=ig(),e=e==null?null:e+"");for(var i=this._groups,l=i.length,c=0;c<l;++c)for(var f=i[c],m=f.length,h,p=0;p<m;++p)(h=f[p])&&Sf(h,e,t,p,f,r||I7(h,t));return new ur(i,this._parents,e,t)}Cc.prototype.interrupt=kO;Cc.prototype.transition=L7;const nd=e=>()=>e;function O7(e,{sourceEvent:t,target:r,transform:i,dispatch:l}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:l}})}function ir(e,t,r){this.k=e,this.x=t,this.y=r}ir.prototype={constructor:ir,scale:function(e){return e===1?this:new ir(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new ir(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var or=new ir(1,0,0);ir.prototype;function Sp(e){e.stopImmediatePropagation()}function Fo(e){e.preventDefault(),e.stopImmediatePropagation()}function z7(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function $7(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function ew(){return this.__zoom||or}function F7(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function B7(){return navigator.maxTouchPoints||"ontouchstart"in this}function U7(e,t,r){var i=e.invertX(t[0][0])-r[0][0],l=e.invertX(t[1][0])-r[1][0],c=e.invertY(t[0][1])-r[0][1],f=e.invertY(t[1][1])-r[1][1];return e.translate(l>i?(i+l)/2:Math.min(0,i)||Math.max(0,l),f>c?(c+f)/2:Math.min(0,c)||Math.max(0,f))}function cE(){var e=z7,t=$7,r=U7,i=F7,l=B7,c=[0,1/0],f=[[-1/0,-1/0],[1/0,1/0]],m=250,h=EO,p=bf("start","zoom","end"),y,g,v,S=500,w=150,N=0,E=10;function C(R){R.property("__zoom",ew).on("wheel.zoom",z,{passive:!1}).on("mousedown.zoom",P).on("dblclick.zoom",G).filter(l).on("touchstart.zoom",H).on("touchmove.zoom",X).on("touchend.zoom touchcancel.zoom",V).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}C.transform=function(R,B,I,L){var $=R.selection?R.selection():R;$.property("__zoom",ew),R!==$?k(R,B,I,L):$.interrupt().each(function(){D(this,arguments).event(L).start().zoom(null,typeof B=="function"?B.apply(this,arguments):B).end()})},C.scaleBy=function(R,B,I,L){C.scaleTo(R,function(){var $=this.__zoom.k,M=typeof B=="function"?B.apply(this,arguments):B;return $*M},I,L)},C.scaleTo=function(R,B,I,L){C.transform(R,function(){var $=t.apply(this,arguments),M=this.__zoom,U=I==null?_($):typeof I=="function"?I.apply(this,arguments):I,T=M.invert(U),q=typeof B=="function"?B.apply(this,arguments):B;return r(O(A(M,q),U,T),$,f)},I,L)},C.translateBy=function(R,B,I,L){C.transform(R,function(){return r(this.__zoom.translate(typeof B=="function"?B.apply(this,arguments):B,typeof I=="function"?I.apply(this,arguments):I),t.apply(this,arguments),f)},null,L)},C.translateTo=function(R,B,I,L,$){C.transform(R,function(){var M=t.apply(this,arguments),U=this.__zoom,T=L==null?_(M):typeof L=="function"?L.apply(this,arguments):L;return r(or.translate(T[0],T[1]).scale(U.k).translate(typeof B=="function"?-B.apply(this,arguments):-B,typeof I=="function"?-I.apply(this,arguments):-I),M,f)},L,$)};function A(R,B){return B=Math.max(c[0],Math.min(c[1],B)),B===R.k?R:new ir(B,R.x,R.y)}function O(R,B,I){var L=B[0]-I[0]*R.k,$=B[1]-I[1]*R.k;return L===R.x&&$===R.y?R:new ir(R.k,L,$)}function _(R){return[(+R[0][0]+ +R[1][0])/2,(+R[0][1]+ +R[1][1])/2]}function k(R,B,I,L){R.on("start.zoom",function(){D(this,arguments).event(L).start()}).on("interrupt.zoom end.zoom",function(){D(this,arguments).event(L).end()}).tween("zoom",function(){var $=this,M=arguments,U=D($,M).event(L),T=t.apply($,M),q=I==null?_(T):typeof I=="function"?I.apply($,M):I,Y=Math.max(T[1][0]-T[0][0],T[1][1]-T[0][1]),Q=$.__zoom,oe=typeof B=="function"?B.apply($,M):B,Z=h(Q.invert(q).concat(Y/Q.k),oe.invert(q).concat(Y/oe.k));return function(de){if(de===1)de=oe;else{var J=Z(de),se=Y/J[2];de=new ir(se,q[0]-J[0]*se,q[1]-J[1]*se)}U.zoom(null,de)}})}function D(R,B,I){return!I&&R.__zooming||new j(R,B)}function j(R,B){this.that=R,this.args=B,this.active=0,this.sourceEvent=null,this.extent=t.apply(R,B),this.taps=0}j.prototype={event:function(R){return R&&(this.sourceEvent=R),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(R,B){return this.mouse&&R!=="mouse"&&(this.mouse[1]=B.invert(this.mouse[0])),this.touch0&&R!=="touch"&&(this.touch0[1]=B.invert(this.touch0[0])),this.touch1&&R!=="touch"&&(this.touch1[1]=B.invert(this.touch1[0])),this.that.__zoom=B,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(R){var B=ss(this.that).datum();p.call(R,this.that,new O7(R,{sourceEvent:this.sourceEvent,target:C,transform:this.that.__zoom,dispatch:p}),B)}};function z(R,...B){if(!e.apply(this,arguments))return;var I=D(this,B).event(R),L=this.__zoom,$=Math.max(c[0],Math.min(c[1],L.k*Math.pow(2,i.apply(this,arguments)))),M=ys(R);if(I.wheel)(I.mouse[0][0]!==M[0]||I.mouse[0][1]!==M[1])&&(I.mouse[1]=L.invert(I.mouse[0]=M)),clearTimeout(I.wheel);else{if(L.k===$)return;I.mouse=[M,L.invert(M)],Ed(this),I.start()}Fo(R),I.wheel=setTimeout(U,w),I.zoom("mouse",r(O(A(L,$),I.mouse[0],I.mouse[1]),I.extent,f));function U(){I.wheel=null,I.end()}}function P(R,...B){if(v||!e.apply(this,arguments))return;var I=R.currentTarget,L=D(this,B,!0).event(R),$=ss(R.view).on("mousemove.zoom",q,!0).on("mouseup.zoom",Y,!0),M=ys(R,I),U=R.clientX,T=R.clientY;XN(R.view),Sp(R),L.mouse=[M,this.__zoom.invert(M)],Ed(this),L.start();function q(Q){if(Fo(Q),!L.moved){var oe=Q.clientX-U,Z=Q.clientY-T;L.moved=oe*oe+Z*Z>N}L.event(Q).zoom("mouse",r(O(L.that.__zoom,L.mouse[0]=ys(Q,I),L.mouse[1]),L.extent,f))}function Y(Q){$.on("mousemove.zoom mouseup.zoom",null),KN(Q.view,L.moved),Fo(Q),L.event(Q).end()}}function G(R,...B){if(e.apply(this,arguments)){var I=this.__zoom,L=ys(R.changedTouches?R.changedTouches[0]:R,this),$=I.invert(L),M=I.k*(R.shiftKey?.5:2),U=r(O(A(I,M),L,$),t.apply(this,B),f);Fo(R),m>0?ss(this).transition().duration(m).call(k,U,L,R):ss(this).call(C.transform,U,L,R)}}function H(R,...B){if(e.apply(this,arguments)){var I=R.touches,L=I.length,$=D(this,B,R.changedTouches.length===L).event(R),M,U,T,q;for(Sp(R),U=0;U<L;++U)T=I[U],q=ys(T,this),q=[q,this.__zoom.invert(q),T.identifier],$.touch0?!$.touch1&&$.touch0[2]!==q[2]&&($.touch1=q,$.taps=0):($.touch0=q,M=!0,$.taps=1+!!y);y&&(y=clearTimeout(y)),M&&($.taps<2&&(g=q[0],y=setTimeout(function(){y=null},S)),Ed(this),$.start())}}function X(R,...B){if(this.__zooming){var I=D(this,B).event(R),L=R.changedTouches,$=L.length,M,U,T,q;for(Fo(R),M=0;M<$;++M)U=L[M],T=ys(U,this),I.touch0&&I.touch0[2]===U.identifier?I.touch0[0]=T:I.touch1&&I.touch1[2]===U.identifier&&(I.touch1[0]=T);if(U=I.that.__zoom,I.touch1){var Y=I.touch0[0],Q=I.touch0[1],oe=I.touch1[0],Z=I.touch1[1],de=(de=oe[0]-Y[0])*de+(de=oe[1]-Y[1])*de,J=(J=Z[0]-Q[0])*J+(J=Z[1]-Q[1])*J;U=A(U,Math.sqrt(de/J)),T=[(Y[0]+oe[0])/2,(Y[1]+oe[1])/2],q=[(Q[0]+Z[0])/2,(Q[1]+Z[1])/2]}else if(I.touch0)T=I.touch0[0],q=I.touch0[1];else return;I.zoom("touch",r(O(U,T,q),I.extent,f))}}function V(R,...B){if(this.__zooming){var I=D(this,B).event(R),L=R.changedTouches,$=L.length,M,U;for(Sp(R),v&&clearTimeout(v),v=setTimeout(function(){v=null},S),M=0;M<$;++M)U=L[M],I.touch0&&I.touch0[2]===U.identifier?delete I.touch0:I.touch1&&I.touch1[2]===U.identifier&&delete I.touch1;if(I.touch1&&!I.touch0&&(I.touch0=I.touch1,delete I.touch1),I.touch0)I.touch0[1]=this.__zoom.invert(I.touch0[0]);else if(I.end(),I.taps===2&&(U=ys(U,this),Math.hypot(g[0]-U[0],g[1]-U[1])<E)){var T=ss(this).on("dblclick.zoom");T&&T.apply(this,arguments)}}}return C.wheelDelta=function(R){return arguments.length?(i=typeof R=="function"?R:nd(+R),C):i},C.filter=function(R){return arguments.length?(e=typeof R=="function"?R:nd(!!R),C):e},C.touchable=function(R){return arguments.length?(l=typeof R=="function"?R:nd(!!R),C):l},C.extent=function(R){return arguments.length?(t=typeof R=="function"?R:nd([[+R[0][0],+R[0][1]],[+R[1][0],+R[1][1]]]),C):t},C.scaleExtent=function(R){return arguments.length?(c[0]=+R[0],c[1]=+R[1],C):[c[0],c[1]]},C.translateExtent=function(R){return arguments.length?(f[0][0]=+R[0][0],f[1][0]=+R[1][0],f[0][1]=+R[0][1],f[1][1]=+R[1][1],C):[[f[0][0],f[0][1]],[f[1][0],f[1][1]]]},C.constrain=function(R){return arguments.length?(r=R,C):r},C.duration=function(R){return arguments.length?(m=+R,C):m},C.interpolate=function(R){return arguments.length?(h=R,C):h},C.on=function(){var R=p.on.apply(p,arguments);return R===p?C:R},C.clickDistance=function(R){return arguments.length?(N=(R=+R)*R,C):Math.sqrt(N)},C.tapDistance=function(R){return arguments.length?(E=+R,C):E},C}const wf=u.createContext(null),q7=wf.Provider,dr={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,t)=>`Couldn't create edge for ${e?"target":"source"} handle id: "${e?t.targetHandle:t.sourceHandle}", edge id: ${t.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},uE=dr.error001();function In(e,t){const r=u.useContext(wf);if(r===null)throw new Error(uE);return LN(r,e,t)}const ta=()=>{const e=u.useContext(wf);if(e===null)throw new Error(uE);return u.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy}),[e])},H7=e=>e.userSelectionActive?"none":"all";function cg({position:e,children:t,className:r,style:i,...l}){const c=In(H7),f=`${e}`.split("-");return De.createElement("div",{className:da(["react-flow__panel",r,...f]),style:{...i,pointerEvents:c},...l},t)}function P7({proOptions:e,position:t="bottom-right"}){return e?.hideAttribution?null:De.createElement(cg,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},De.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}const V7=({x:e,y:t,label:r,labelStyle:i={},labelShowBg:l=!0,labelBgStyle:c={},labelBgPadding:f=[2,4],labelBgBorderRadius:m=2,children:h,className:p,...y})=>{const g=u.useRef(null),[v,S]=u.useState({x:0,y:0,width:0,height:0}),w=da(["react-flow__edge-textwrapper",p]);return u.useEffect(()=>{if(g.current){const N=g.current.getBBox();S({x:N.x,y:N.y,width:N.width,height:N.height})}},[r]),typeof r>"u"||!r?null:De.createElement("g",{transform:`translate(${e-v.width/2} ${t-v.height/2})`,className:w,visibility:v.width?"visible":"hidden",...y},l&&De.createElement("rect",{width:v.width+2*f[0],x:-f[0],y:-f[1],height:v.height+2*f[1],className:"react-flow__edge-textbg",style:c,rx:m,ry:m}),De.createElement("text",{className:"react-flow__edge-text",y:v.height/2,dy:"0.3em",ref:g,style:i},r),h)};var Y7=u.memo(V7);const ug=e=>({width:e.offsetWidth,height:e.offsetHeight}),kl=(e,t=0,r=1)=>Math.min(Math.max(e,t),r),dg=(e={x:0,y:0},t)=>({x:kl(e.x,t[0][0],t[1][0]),y:kl(e.y,t[0][1],t[1][1])}),tw=(e,t,r)=>e<t?kl(Math.abs(e-t),1,50)/50:e>r?-kl(Math.abs(e-r),1,50)/50:0,dE=(e,t)=>{const r=tw(e.x,35,t.width-35)*20,i=tw(e.y,35,t.height-35)*20;return[r,i]},fE=e=>e.getRootNode?.()||window?.document,mE=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),bc=({x:e,y:t,width:r,height:i})=>({x:e,y:t,x2:e+r,y2:t+i}),hE=({x:e,y:t,x2:r,y2:i})=>({x:e,y:t,width:r-e,height:i-t}),nw=e=>({...e.positionAbsolute||{x:0,y:0},width:e.width||0,height:e.height||0}),G7=(e,t)=>hE(mE(bc(e),bc(t))),cy=(e,t)=>{const r=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),i=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(r*i)},X7=e=>rs(e.width)&&rs(e.height)&&rs(e.x)&&rs(e.y),rs=e=>!isNaN(e)&&isFinite(e),Pn=Symbol.for("internals"),pE=["Enter"," ","Escape"],K7=(e,t)=>{},W7=e=>"nativeEvent"in e;function uy(e){const r=(W7(e)?e.nativeEvent:e).composedPath?.()?.[0]||e.target;return["INPUT","SELECT","TEXTAREA"].includes(r?.nodeName)||r?.hasAttribute("contenteditable")||!!r?.closest(".nokey")}const yE=e=>"clientX"in e,Xr=(e,t)=>{const r=yE(e),i=r?e.clientX:e.touches?.[0].clientX,l=r?e.clientY:e.touches?.[0].clientY;return{x:i-(t?.left??0),y:l-(t?.top??0)}},Hd=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0,Fl=({id:e,path:t,labelX:r,labelY:i,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:g,markerStart:v,interactionWidth:S=20})=>De.createElement(De.Fragment,null,De.createElement("path",{id:e,style:y,d:t,fill:"none",className:"react-flow__edge-path",markerEnd:g,markerStart:v}),S&&De.createElement("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:S,className:"react-flow__edge-interaction"}),l&&rs(r)&&rs(i)?De.createElement(Y7,{x:r,y:i,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p}):null);Fl.displayName="BaseEdge";function Bo(e,t,r){return r===void 0?r:i=>{const l=t().edges.find(c=>c.id===e);l&&r(i,{...l})}}function gE({sourceX:e,sourceY:t,targetX:r,targetY:i}){const l=Math.abs(r-e)/2,c=r<e?r+l:r-l,f=Math.abs(i-t)/2,m=i<t?i+f:i-f;return[c,m,l,f]}function bE({sourceX:e,sourceY:t,targetX:r,targetY:i,sourceControlX:l,sourceControlY:c,targetControlX:f,targetControlY:m}){const h=e*.125+l*.375+f*.375+r*.125,p=t*.125+c*.375+m*.375+i*.125,y=Math.abs(h-e),g=Math.abs(p-t);return[h,p,y,g]}var ki;(function(e){e.Strict="strict",e.Loose="loose"})(ki||(ki={}));var Ai;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(Ai||(Ai={}));var vc;(function(e){e.Partial="partial",e.Full="full"})(vc||(vc={}));var Yr;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Yr||(Yr={}));var Pd;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Pd||(Pd={}));var qt;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(qt||(qt={}));function aw({pos:e,x1:t,y1:r,x2:i,y2:l}){return e===qt.Left||e===qt.Right?[.5*(t+i),r]:[t,.5*(r+l)]}function vE({sourceX:e,sourceY:t,sourcePosition:r=qt.Bottom,targetX:i,targetY:l,targetPosition:c=qt.Top}){const[f,m]=aw({pos:r,x1:e,y1:t,x2:i,y2:l}),[h,p]=aw({pos:c,x1:i,y1:l,x2:e,y2:t}),[y,g,v,S]=bE({sourceX:e,sourceY:t,targetX:i,targetY:l,sourceControlX:f,sourceControlY:m,targetControlX:h,targetControlY:p});return[`M${e},${t} C${f},${m} ${h},${p} ${i},${l}`,y,g,v,S]}const fg=u.memo(({sourceX:e,sourceY:t,targetX:r,targetY:i,sourcePosition:l=qt.Bottom,targetPosition:c=qt.Top,label:f,labelStyle:m,labelShowBg:h,labelBgStyle:p,labelBgPadding:y,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:w,interactionWidth:N})=>{const[E,C,A]=vE({sourceX:e,sourceY:t,sourcePosition:l,targetX:r,targetY:i,targetPosition:c});return De.createElement(Fl,{path:E,labelX:C,labelY:A,label:f,labelStyle:m,labelShowBg:h,labelBgStyle:p,labelBgPadding:y,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:w,interactionWidth:N})});fg.displayName="SimpleBezierEdge";const sw={[qt.Left]:{x:-1,y:0},[qt.Right]:{x:1,y:0},[qt.Top]:{x:0,y:-1},[qt.Bottom]:{x:0,y:1}},Z7=({source:e,sourcePosition:t=qt.Bottom,target:r})=>t===qt.Left||t===qt.Right?e.x<r.x?{x:1,y:0}:{x:-1,y:0}:e.y<r.y?{x:0,y:1}:{x:0,y:-1},rw=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Q7({source:e,sourcePosition:t=qt.Bottom,target:r,targetPosition:i=qt.Top,center:l,offset:c}){const f=sw[t],m=sw[i],h={x:e.x+f.x*c,y:e.y+f.y*c},p={x:r.x+m.x*c,y:r.y+m.y*c},y=Z7({source:h,sourcePosition:t,target:p}),g=y.x!==0?"x":"y",v=y[g];let S=[],w,N;const E={x:0,y:0},C={x:0,y:0},[A,O,_,k]=gE({sourceX:e.x,sourceY:e.y,targetX:r.x,targetY:r.y});if(f[g]*m[g]===-1){w=l.x??A,N=l.y??O;const j=[{x:w,y:h.y},{x:w,y:p.y}],z=[{x:h.x,y:N},{x:p.x,y:N}];f[g]===v?S=g==="x"?j:z:S=g==="x"?z:j}else{const j=[{x:h.x,y:p.y}],z=[{x:p.x,y:h.y}];if(g==="x"?S=f.x===v?z:j:S=f.y===v?j:z,t===i){const V=Math.abs(e[g]-r[g]);if(V<=c){const R=Math.min(c-1,c-V);f[g]===v?E[g]=(h[g]>e[g]?-1:1)*R:C[g]=(p[g]>r[g]?-1:1)*R}}if(t!==i){const V=g==="x"?"y":"x",R=f[g]===m[V],B=h[V]>p[V],I=h[V]<p[V];(f[g]===1&&(!R&&B||R&&I)||f[g]!==1&&(!R&&I||R&&B))&&(S=g==="x"?j:z)}const P={x:h.x+E.x,y:h.y+E.y},G={x:p.x+C.x,y:p.y+C.y},H=Math.max(Math.abs(P.x-S[0].x),Math.abs(G.x-S[0].x)),X=Math.max(Math.abs(P.y-S[0].y),Math.abs(G.y-S[0].y));H>=X?(w=(P.x+G.x)/2,N=S[0].y):(w=S[0].x,N=(P.y+G.y)/2)}return[[e,{x:h.x+E.x,y:h.y+E.y},...S,{x:p.x+C.x,y:p.y+C.y},r],w,N,_,k]}function J7(e,t,r,i){const l=Math.min(rw(e,t)/2,rw(t,r)/2,i),{x:c,y:f}=t;if(e.x===c&&c===r.x||e.y===f&&f===r.y)return`L${c} ${f}`;if(e.y===f){const p=e.x<r.x?-1:1,y=e.y<r.y?1:-1;return`L ${c+l*p},${f}Q ${c},${f} ${c},${f+l*y}`}const m=e.x<r.x?1:-1,h=e.y<r.y?-1:1;return`L ${c},${f+l*h}Q ${c},${f} ${c+l*m},${f}`}function Vd({sourceX:e,sourceY:t,sourcePosition:r=qt.Bottom,targetX:i,targetY:l,targetPosition:c=qt.Top,borderRadius:f=5,centerX:m,centerY:h,offset:p=20}){const[y,g,v,S,w]=Q7({source:{x:e,y:t},sourcePosition:r,target:{x:i,y:l},targetPosition:c,center:{x:m,y:h},offset:p});return[y.reduce((E,C,A)=>{let O="";return A>0&&A<y.length-1?O=J7(y[A-1],C,y[A+1],f):O=`${A===0?"M":"L"}${C.x} ${C.y}`,E+=O,E},""),g,v,S,w]}const Nf=u.memo(({sourceX:e,sourceY:t,targetX:r,targetY:i,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,sourcePosition:g=qt.Bottom,targetPosition:v=qt.Top,markerEnd:S,markerStart:w,pathOptions:N,interactionWidth:E})=>{const[C,A,O]=Vd({sourceX:e,sourceY:t,sourcePosition:g,targetX:r,targetY:i,targetPosition:v,borderRadius:N?.borderRadius,offset:N?.offset});return De.createElement(Fl,{path:C,labelX:A,labelY:O,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:S,markerStart:w,interactionWidth:E})});Nf.displayName="SmoothStepEdge";const mg=u.memo(e=>De.createElement(Nf,{...e,pathOptions:u.useMemo(()=>({borderRadius:0,offset:e.pathOptions?.offset}),[e.pathOptions?.offset])}));mg.displayName="StepEdge";function e6({sourceX:e,sourceY:t,targetX:r,targetY:i}){const[l,c,f,m]=gE({sourceX:e,sourceY:t,targetX:r,targetY:i});return[`M ${e},${t}L ${r},${i}`,l,c,f,m]}const hg=u.memo(({sourceX:e,sourceY:t,targetX:r,targetY:i,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:g,markerStart:v,interactionWidth:S})=>{const[w,N,E]=e6({sourceX:e,sourceY:t,targetX:r,targetY:i});return De.createElement(Fl,{path:w,labelX:N,labelY:E,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:g,markerStart:v,interactionWidth:S})});hg.displayName="StraightEdge";function ad(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function iw({pos:e,x1:t,y1:r,x2:i,y2:l,c}){switch(e){case qt.Left:return[t-ad(t-i,c),r];case qt.Right:return[t+ad(i-t,c),r];case qt.Top:return[t,r-ad(r-l,c)];case qt.Bottom:return[t,r+ad(l-r,c)]}}function xE({sourceX:e,sourceY:t,sourcePosition:r=qt.Bottom,targetX:i,targetY:l,targetPosition:c=qt.Top,curvature:f=.25}){const[m,h]=iw({pos:r,x1:e,y1:t,x2:i,y2:l,c:f}),[p,y]=iw({pos:c,x1:i,y1:l,x2:e,y2:t,c:f}),[g,v,S,w]=bE({sourceX:e,sourceY:t,targetX:i,targetY:l,sourceControlX:m,sourceControlY:h,targetControlX:p,targetControlY:y});return[`M${e},${t} C${m},${h} ${p},${y} ${i},${l}`,g,v,S,w]}const Yd=u.memo(({sourceX:e,sourceY:t,targetX:r,targetY:i,sourcePosition:l=qt.Bottom,targetPosition:c=qt.Top,label:f,labelStyle:m,labelShowBg:h,labelBgStyle:p,labelBgPadding:y,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:w,pathOptions:N,interactionWidth:E})=>{const[C,A,O]=xE({sourceX:e,sourceY:t,sourcePosition:l,targetX:r,targetY:i,targetPosition:c,curvature:N?.curvature});return De.createElement(Fl,{path:C,labelX:A,labelY:O,label:f,labelStyle:m,labelShowBg:h,labelBgStyle:p,labelBgPadding:y,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:w,interactionWidth:E})});Yd.displayName="BezierEdge";const pg=u.createContext(null),t6=pg.Provider;pg.Consumer;const n6=()=>u.useContext(pg),a6=e=>"id"in e&&"source"in e&&"target"in e,s6=({source:e,sourceHandle:t,target:r,targetHandle:i})=>`reactflow__edge-${e}${t||""}-${r}${i||""}`,dy=(e,t)=>typeof e>"u"?"":typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(i=>`${i}=${e[i]}`).join("&")}`,r6=(e,t)=>t.some(r=>r.source===e.source&&r.target===e.target&&(r.sourceHandle===e.sourceHandle||!r.sourceHandle&&!e.sourceHandle)&&(r.targetHandle===e.targetHandle||!r.targetHandle&&!e.targetHandle)),i6=(e,t)=>{if(!e.source||!e.target)return t;let r;return a6(e)?r={...e}:r={...e,id:s6(e)},r6(r,t)?t:t.concat(r)},fy=({x:e,y:t},[r,i,l],c,[f,m])=>{const h={x:(e-r)/l,y:(t-i)/l};return c?{x:f*Math.round(h.x/f),y:m*Math.round(h.y/m)}:h},SE=({x:e,y:t},[r,i,l])=>({x:e*l+r,y:t*l+i}),Mi=(e,t=[0,0])=>{if(!e)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const r=(e.width??0)*t[0],i=(e.height??0)*t[1],l={x:e.position.x-r,y:e.position.y-i};return{...l,positionAbsolute:e.positionAbsolute?{x:e.positionAbsolute.x-r,y:e.positionAbsolute.y-i}:l}},Ef=(e,t=[0,0])=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const r=e.reduce((i,l)=>{const{x:c,y:f}=Mi(l,t).positionAbsolute;return mE(i,bc({x:c,y:f,width:l.width||0,height:l.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return hE(r)},wE=(e,t,[r,i,l]=[0,0,1],c=!1,f=!1,m=[0,0])=>{const h={x:(t.x-r)/l,y:(t.y-i)/l,width:t.width/l,height:t.height/l},p=[];return e.forEach(y=>{const{width:g,height:v,selectable:S=!0,hidden:w=!1}=y;if(f&&!S||w)return!1;const{positionAbsolute:N}=Mi(y,m),E={x:N.x,y:N.y,width:g||0,height:v||0},C=cy(h,E),A=typeof g>"u"||typeof v>"u"||g===null||v===null,O=c&&C>0,_=(g||0)*(v||0);(A||O||C>=_||y.dragging)&&p.push(y)}),p},NE=(e,t)=>{const r=e.map(i=>i.id);return t.filter(i=>r.includes(i.source)||r.includes(i.target))},EE=(e,t,r,i,l,c=.1)=>{const f=t/(e.width*(1+c)),m=r/(e.height*(1+c)),h=Math.min(f,m),p=kl(h,i,l),y=e.x+e.width/2,g=e.y+e.height/2,v=t/2-y*p,S=r/2-g*p;return{x:v,y:S,zoom:p}},wi=(e,t=0)=>e.transition().duration(t);function lw(e,t,r,i){return(t[r]||[]).reduce((l,c)=>(`${e.id}-${c.id}-${r}`!==i&&l.push({id:c.id||null,type:r,nodeId:e.id,x:(e.positionAbsolute?.x??0)+c.x+c.width/2,y:(e.positionAbsolute?.y??0)+c.y+c.height/2}),l),[])}function l6(e,t,r,i,l,c){const{x:f,y:m}=Xr(e),p=t.elementsFromPoint(f,m).find(w=>w.classList.contains("react-flow__handle"));if(p){const w=p.getAttribute("data-nodeid");if(w){const N=yg(void 0,p),E=p.getAttribute("data-handleid"),C=c({nodeId:w,id:E,type:N});if(C){const A=l.find(O=>O.nodeId===w&&O.type===N&&O.id===E);return{handle:{id:E,type:N,nodeId:w,x:A?.x||r.x,y:A?.y||r.y},validHandleResult:C}}}}let y=[],g=1/0;if(l.forEach(w=>{const N=Math.sqrt((w.x-r.x)**2+(w.y-r.y)**2);if(N<=i){const E=c(w);N<=g&&(N<g?y=[{handle:w,validHandleResult:E}]:N===g&&y.push({handle:w,validHandleResult:E}),g=N)}}),!y.length)return{handle:null,validHandleResult:jE()};if(y.length===1)return y[0];const v=y.some(({validHandleResult:w})=>w.isValid),S=y.some(({handle:w})=>w.type==="target");return y.find(({handle:w,validHandleResult:N})=>S?w.type==="target":v?N.isValid:!0)||y[0]}const o6={source:null,target:null,sourceHandle:null,targetHandle:null},jE=()=>({handleDomNode:null,isValid:!1,connection:o6,endHandle:null});function _E(e,t,r,i,l,c,f){const m=l==="target",h=f.querySelector(`.react-flow__handle[data-id="${e?.nodeId}-${e?.id}-${e?.type}"]`),p={...jE(),handleDomNode:h};if(h){const y=yg(void 0,h),g=h.getAttribute("data-nodeid"),v=h.getAttribute("data-handleid"),S=h.classList.contains("connectable"),w=h.classList.contains("connectableend"),N={source:m?g:r,sourceHandle:m?v:i,target:m?r:g,targetHandle:m?i:v};p.connection=N,S&&w&&(t===ki.Strict?m&&y==="source"||!m&&y==="target":g!==r||v!==i)&&(p.endHandle={nodeId:g,handleId:v,type:y},p.isValid=c(N))}return p}function c6({nodes:e,nodeId:t,handleId:r,handleType:i}){return e.reduce((l,c)=>{if(c[Pn]){const{handleBounds:f}=c[Pn];let m=[],h=[];f&&(m=lw(c,f,"source",`${t}-${r}-${i}`),h=lw(c,f,"target",`${t}-${r}-${i}`)),l.push(...m,...h)}return l},[])}function yg(e,t){return e||(t?.classList.contains("target")?"target":t?.classList.contains("source")?"source":null)}function wp(e){e?.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function u6(e,t){let r=null;return t?r="valid":e&&!t&&(r="invalid"),r}function CE({event:e,handleId:t,nodeId:r,onConnect:i,isTarget:l,getState:c,setState:f,isValidConnection:m,edgeUpdaterType:h,onReconnectEnd:p}){const y=fE(e.target),{connectionMode:g,domNode:v,autoPanOnConnect:S,connectionRadius:w,onConnectStart:N,panBy:E,getNodes:C,cancelConnection:A}=c();let O=0,_;const{x:k,y:D}=Xr(e),j=y?.elementFromPoint(k,D),z=yg(h,j),P=v?.getBoundingClientRect();if(!P||!z)return;let G,H=Xr(e,P),X=!1,V=null,R=!1,B=null;const I=c6({nodes:C(),nodeId:r,handleId:t,handleType:z}),L=()=>{if(!S)return;const[U,T]=dE(H,P);E({x:U,y:T}),O=requestAnimationFrame(L)};f({connectionPosition:H,connectionStatus:null,connectionNodeId:r,connectionHandleId:t,connectionHandleType:z,connectionStartHandle:{nodeId:r,handleId:t,type:z},connectionEndHandle:null}),N?.(e,{nodeId:r,handleId:t,handleType:z});function $(U){const{transform:T}=c();H=Xr(U,P);const{handle:q,validHandleResult:Y}=l6(U,y,fy(H,T,!1,[1,1]),w,I,Q=>_E(Q,g,r,t,l?"target":"source",m,y));if(_=q,X||(L(),X=!0),B=Y.handleDomNode,V=Y.connection,R=Y.isValid,f({connectionPosition:_&&R?SE({x:_.x,y:_.y},T):H,connectionStatus:u6(!!_,R),connectionEndHandle:Y.endHandle}),!_&&!R&&!B)return wp(G);V.source!==V.target&&B&&(wp(G),G=B,B.classList.add("connecting","react-flow__handle-connecting"),B.classList.toggle("valid",R),B.classList.toggle("react-flow__handle-valid",R))}function M(U){(_||B)&&V&&R&&i?.(V),c().onConnectEnd?.(U),h&&p?.(U),wp(G),A(),cancelAnimationFrame(O),X=!1,R=!1,V=null,B=null,y.removeEventListener("mousemove",$),y.removeEventListener("mouseup",M),y.removeEventListener("touchmove",$),y.removeEventListener("touchend",M)}y.addEventListener("mousemove",$),y.addEventListener("mouseup",M),y.addEventListener("touchmove",$),y.addEventListener("touchend",M)}const ow=()=>!0,d6=e=>({connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName}),f6=(e,t,r)=>i=>{const{connectionStartHandle:l,connectionEndHandle:c,connectionClickStartHandle:f}=i;return{connecting:l?.nodeId===e&&l?.handleId===t&&l?.type===r||c?.nodeId===e&&c?.handleId===t&&c?.type===r,clickConnecting:f?.nodeId===e&&f?.handleId===t&&f?.type===r}},AE=u.forwardRef(({type:e="source",position:t=qt.Top,isValidConnection:r,isConnectable:i=!0,isConnectableStart:l=!0,isConnectableEnd:c=!0,id:f,onConnect:m,children:h,className:p,onMouseDown:y,onTouchStart:g,...v},S)=>{const w=f||null,N=e==="target",E=ta(),C=n6(),{connectOnClick:A,noPanClassName:O}=In(d6,sa),{connecting:_,clickConnecting:k}=In(f6(C,w,e),sa);C||E.getState().onError?.("010",dr.error010());const D=P=>{const{defaultEdgeOptions:G,onConnect:H,hasDefaultEdges:X}=E.getState(),V={...G,...P};if(X){const{edges:R,setEdges:B}=E.getState();B(i6(V,R))}H?.(V),m?.(V)},j=P=>{if(!C)return;const G=yE(P);l&&(G&&P.button===0||!G)&&CE({event:P,handleId:w,nodeId:C,onConnect:D,isTarget:N,getState:E.getState,setState:E.setState,isValidConnection:r||E.getState().isValidConnection||ow}),G?y?.(P):g?.(P)},z=P=>{const{onClickConnectStart:G,onClickConnectEnd:H,connectionClickStartHandle:X,connectionMode:V,isValidConnection:R}=E.getState();if(!C||!X&&!l)return;if(!X){G?.(P,{nodeId:C,handleId:w,handleType:e}),E.setState({connectionClickStartHandle:{nodeId:C,type:e,handleId:w}});return}const B=fE(P.target),I=r||R||ow,{connection:L,isValid:$}=_E({nodeId:C,id:w,type:e},V,X.nodeId,X.handleId||null,X.type,I,B);$&&D(L),H?.(P),E.setState({connectionClickStartHandle:null})};return De.createElement("div",{"data-handleid":w,"data-nodeid":C,"data-handlepos":t,"data-id":`${C}-${w}-${e}`,className:da(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",O,p,{source:!N,target:N,connectable:i,connectablestart:l,connectableend:c,connecting:k,connectionindicator:i&&(l&&!_||c&&_)}]),onMouseDown:j,onTouchStart:j,onClick:A?z:void 0,ref:S,...v},h)});AE.displayName="Handle";var Qr=u.memo(AE);const TE=({data:e,isConnectable:t,targetPosition:r=qt.Top,sourcePosition:i=qt.Bottom})=>De.createElement(De.Fragment,null,De.createElement(Qr,{type:"target",position:r,isConnectable:t}),e?.label,De.createElement(Qr,{type:"source",position:i,isConnectable:t}));TE.displayName="DefaultNode";var my=u.memo(TE);const ME=({data:e,isConnectable:t,sourcePosition:r=qt.Bottom})=>De.createElement(De.Fragment,null,e?.label,De.createElement(Qr,{type:"source",position:r,isConnectable:t}));ME.displayName="InputNode";var RE=u.memo(ME);const kE=({data:e,isConnectable:t,targetPosition:r=qt.Top})=>De.createElement(De.Fragment,null,De.createElement(Qr,{type:"target",position:r,isConnectable:t}),e?.label);kE.displayName="OutputNode";var DE=u.memo(kE);const gg=()=>null;gg.displayName="GroupNode";const m6=e=>({selectedNodes:e.getNodes().filter(t=>t.selected),selectedEdges:e.edges.filter(t=>t.selected).map(t=>({...t}))}),sd=e=>e.id;function h6(e,t){return sa(e.selectedNodes.map(sd),t.selectedNodes.map(sd))&&sa(e.selectedEdges.map(sd),t.selectedEdges.map(sd))}const IE=u.memo(({onSelectionChange:e})=>{const t=ta(),{selectedNodes:r,selectedEdges:i}=In(m6,h6);return u.useEffect(()=>{const l={nodes:r,edges:i};e?.(l),t.getState().onSelectionChange.forEach(c=>c(l))},[r,i,e]),null});IE.displayName="SelectionListener";const p6=e=>!!e.onSelectionChange;function y6({onSelectionChange:e}){const t=In(p6);return e||t?De.createElement(IE,{onSelectionChange:e}):null}const g6=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset});function yl(e,t){u.useEffect(()=>{typeof e<"u"&&t(e)},[e])}function dn(e,t,r){u.useEffect(()=>{typeof t<"u"&&r({[e]:t})},[t])}const b6=({nodes:e,edges:t,defaultNodes:r,defaultEdges:i,onConnect:l,onConnectStart:c,onConnectEnd:f,onClickConnectStart:m,onClickConnectEnd:h,nodesDraggable:p,nodesConnectable:y,nodesFocusable:g,edgesFocusable:v,edgesUpdatable:S,elevateNodesOnSelect:w,minZoom:N,maxZoom:E,nodeExtent:C,onNodesChange:A,onEdgesChange:O,elementsSelectable:_,connectionMode:k,snapGrid:D,snapToGrid:j,translateExtent:z,connectOnClick:P,defaultEdgeOptions:G,fitView:H,fitViewOptions:X,onNodesDelete:V,onEdgesDelete:R,onNodeDrag:B,onNodeDragStart:I,onNodeDragStop:L,onSelectionDrag:$,onSelectionDragStart:M,onSelectionDragStop:U,noPanClassName:T,nodeOrigin:q,rfId:Y,autoPanOnConnect:Q,autoPanOnNodeDrag:oe,onError:Z,connectionRadius:de,isValidConnection:J,nodeDragThreshold:se})=>{const{setNodes:ne,setEdges:we,setDefaultNodesAndEdges:Le,setMinZoom:Me,setMaxZoom:Ae,setTranslateExtent:ot,setNodeExtent:ze,reset:nt}=In(g6,sa),$e=ta();return u.useEffect(()=>{const vt=i?.map(_t=>({..._t,...G}));return Le(r,vt),()=>{nt()}},[]),dn("defaultEdgeOptions",G,$e.setState),dn("connectionMode",k,$e.setState),dn("onConnect",l,$e.setState),dn("onConnectStart",c,$e.setState),dn("onConnectEnd",f,$e.setState),dn("onClickConnectStart",m,$e.setState),dn("onClickConnectEnd",h,$e.setState),dn("nodesDraggable",p,$e.setState),dn("nodesConnectable",y,$e.setState),dn("nodesFocusable",g,$e.setState),dn("edgesFocusable",v,$e.setState),dn("edgesUpdatable",S,$e.setState),dn("elementsSelectable",_,$e.setState),dn("elevateNodesOnSelect",w,$e.setState),dn("snapToGrid",j,$e.setState),dn("snapGrid",D,$e.setState),dn("onNodesChange",A,$e.setState),dn("onEdgesChange",O,$e.setState),dn("connectOnClick",P,$e.setState),dn("fitViewOnInit",H,$e.setState),dn("fitViewOnInitOptions",X,$e.setState),dn("onNodesDelete",V,$e.setState),dn("onEdgesDelete",R,$e.setState),dn("onNodeDrag",B,$e.setState),dn("onNodeDragStart",I,$e.setState),dn("onNodeDragStop",L,$e.setState),dn("onSelectionDrag",$,$e.setState),dn("onSelectionDragStart",M,$e.setState),dn("onSelectionDragStop",U,$e.setState),dn("noPanClassName",T,$e.setState),dn("nodeOrigin",q,$e.setState),dn("rfId",Y,$e.setState),dn("autoPanOnConnect",Q,$e.setState),dn("autoPanOnNodeDrag",oe,$e.setState),dn("onError",Z,$e.setState),dn("connectionRadius",de,$e.setState),dn("isValidConnection",J,$e.setState),dn("nodeDragThreshold",se,$e.setState),yl(e,ne),yl(t,we),yl(N,Me),yl(E,Ae),yl(z,ot),yl(C,ze),null},cw={display:"none"},v6={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},LE="react-flow__node-desc",OE="react-flow__edge-desc",x6="react-flow__aria-live",S6=e=>e.ariaLiveMessage;function w6({rfId:e}){const t=In(S6);return De.createElement("div",{id:`${x6}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:v6},t)}function N6({rfId:e,disableKeyboardA11y:t}){return De.createElement(De.Fragment,null,De.createElement("div",{id:`${LE}-${e}`,style:cw},"Press enter or space to select a node.",!t&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),De.createElement("div",{id:`${OE}-${e}`,style:cw},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!t&&De.createElement(w6,{rfId:e}))}var xc=(e=null,t={actInsideInputWithModifier:!0})=>{const[r,i]=u.useState(!1),l=u.useRef(!1),c=u.useRef(new Set([])),[f,m]=u.useMemo(()=>{if(e!==null){const p=(Array.isArray(e)?e:[e]).filter(g=>typeof g=="string").map(g=>g.split("+")),y=p.reduce((g,v)=>g.concat(...v),[]);return[p,y]}return[[],[]]},[e]);return u.useEffect(()=>{const h=typeof document<"u"?document:null,p=t?.target||h;if(e!==null){const y=S=>{if(l.current=S.ctrlKey||S.metaKey||S.shiftKey,(!l.current||l.current&&!t.actInsideInputWithModifier)&&uy(S))return!1;const N=dw(S.code,m);c.current.add(S[N]),uw(f,c.current,!1)&&(S.preventDefault(),i(!0))},g=S=>{if((!l.current||l.current&&!t.actInsideInputWithModifier)&&uy(S))return!1;const N=dw(S.code,m);uw(f,c.current,!0)?(i(!1),c.current.clear()):c.current.delete(S[N]),S.key==="Meta"&&c.current.clear(),l.current=!1},v=()=>{c.current.clear(),i(!1)};return p?.addEventListener("keydown",y),p?.addEventListener("keyup",g),window.addEventListener("blur",v),()=>{p?.removeEventListener("keydown",y),p?.removeEventListener("keyup",g),window.removeEventListener("blur",v)}}},[e,i]),r};function uw(e,t,r){return e.filter(i=>r||i.length===t.size).some(i=>i.every(l=>t.has(l)))}function dw(e,t){return t.includes(e)?"code":"key"}function zE(e,t,r,i){const l=e.parentNode||e.parentId;if(!l)return r;const c=t.get(l),f=Mi(c,i);return zE(c,t,{x:(r.x??0)+f.x,y:(r.y??0)+f.y,z:(c[Pn]?.z??0)>(r.z??0)?c[Pn]?.z??0:r.z??0},i)}function $E(e,t,r){e.forEach(i=>{const l=i.parentNode||i.parentId;if(l&&!e.has(l))throw new Error(`Parent node ${l} not found`);if(l||r?.[i.id]){const{x:c,y:f,z:m}=zE(i,e,{...i.position,z:i[Pn]?.z??0},t);i.positionAbsolute={x:c,y:f},i[Pn].z=m,r?.[i.id]&&(i[Pn].isParent=!0)}})}function Np(e,t,r,i){const l=new Map,c={},f=i?1e3:0;return e.forEach(m=>{const h=(rs(m.zIndex)?m.zIndex:0)+(m.selected?f:0),p=t.get(m.id),y={...m,positionAbsolute:{x:m.position.x,y:m.position.y}},g=m.parentNode||m.parentId;g&&(c[g]=!0);const v=p?.type&&p?.type!==m.type;Object.defineProperty(y,Pn,{enumerable:!1,value:{handleBounds:v?void 0:p?.[Pn]?.handleBounds,z:h}}),l.set(m.id,y)}),$E(l,r,c),l}function FE(e,t={}){const{getNodes:r,width:i,height:l,minZoom:c,maxZoom:f,d3Zoom:m,d3Selection:h,fitViewOnInitDone:p,fitViewOnInit:y,nodeOrigin:g}=e(),v=t.initial&&!p&&y;if(m&&h&&(v||!t.initial)){const w=r().filter(E=>{const C=t.includeHiddenNodes?E.width&&E.height:!E.hidden;return t.nodes?.length?C&&t.nodes.some(A=>A.id===E.id):C}),N=w.every(E=>E.width&&E.height);if(w.length>0&&N){const E=Ef(w,g),{x:C,y:A,zoom:O}=EE(E,i,l,t.minZoom??c,t.maxZoom??f,t.padding??.1),_=or.translate(C,A).scale(O);return typeof t.duration=="number"&&t.duration>0?m.transform(wi(h,t.duration),_):m.transform(h,_),!0}}return!1}function E6(e,t){return e.forEach(r=>{const i=t.get(r.id);i&&t.set(i.id,{...i,[Pn]:i[Pn],selected:r.selected})}),new Map(t)}function j6(e,t){return t.map(r=>{const i=e.find(l=>l.id===r.id);return i&&(r.selected=i.selected),r})}function rd({changedNodes:e,changedEdges:t,get:r,set:i}){const{nodeInternals:l,edges:c,onNodesChange:f,onEdgesChange:m,hasDefaultNodes:h,hasDefaultEdges:p}=r();e?.length&&(h&&i({nodeInternals:E6(e,l)}),f?.(e)),t?.length&&(p&&i({edges:j6(t,c)}),m?.(t))}const gl=()=>{},_6={zoomIn:gl,zoomOut:gl,zoomTo:gl,getZoom:()=>1,setViewport:gl,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:gl,fitBounds:gl,project:e=>e,screenToFlowPosition:e=>e,flowToScreenPosition:e=>e,viewportInitialized:!1},C6=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection}),A6=()=>{const e=ta(),{d3Zoom:t,d3Selection:r}=In(C6,sa);return u.useMemo(()=>r&&t?{zoomIn:l=>t.scaleBy(wi(r,l?.duration),1.2),zoomOut:l=>t.scaleBy(wi(r,l?.duration),1/1.2),zoomTo:(l,c)=>t.scaleTo(wi(r,c?.duration),l),getZoom:()=>e.getState().transform[2],setViewport:(l,c)=>{const[f,m,h]=e.getState().transform,p=or.translate(l.x??f,l.y??m).scale(l.zoom??h);t.transform(wi(r,c?.duration),p)},getViewport:()=>{const[l,c,f]=e.getState().transform;return{x:l,y:c,zoom:f}},fitView:l=>FE(e.getState,l),setCenter:(l,c,f)=>{const{width:m,height:h,maxZoom:p}=e.getState(),y=typeof f?.zoom<"u"?f.zoom:p,g=m/2-l*y,v=h/2-c*y,S=or.translate(g,v).scale(y);t.transform(wi(r,f?.duration),S)},fitBounds:(l,c)=>{const{width:f,height:m,minZoom:h,maxZoom:p}=e.getState(),{x:y,y:g,zoom:v}=EE(l,f,m,h,p,c?.padding??.1),S=or.translate(y,g).scale(v);t.transform(wi(r,c?.duration),S)},project:l=>{const{transform:c,snapToGrid:f,snapGrid:m}=e.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),fy(l,c,f,m)},screenToFlowPosition:l=>{const{transform:c,snapToGrid:f,snapGrid:m,domNode:h}=e.getState();if(!h)return l;const{x:p,y}=h.getBoundingClientRect(),g={x:l.x-p,y:l.y-y};return fy(g,c,f,m)},flowToScreenPosition:l=>{const{transform:c,domNode:f}=e.getState();if(!f)return l;const{x:m,y:h}=f.getBoundingClientRect(),p=SE(l,c);return{x:p.x+m,y:p.y+h}},viewportInitialized:!0}:_6,[t,r])};function jf(){const e=A6(),t=ta(),r=u.useCallback(()=>t.getState().getNodes().map(N=>({...N})),[]),i=u.useCallback(N=>t.getState().nodeInternals.get(N),[]),l=u.useCallback(()=>{const{edges:N=[]}=t.getState();return N.map(E=>({...E}))},[]),c=u.useCallback(N=>{const{edges:E=[]}=t.getState();return E.find(C=>C.id===N)},[]),f=u.useCallback(N=>{const{getNodes:E,setNodes:C,hasDefaultNodes:A,onNodesChange:O}=t.getState(),_=E(),k=typeof N=="function"?N(_):N;if(A)C(k);else if(O){const D=k.length===0?_.map(j=>({type:"remove",id:j.id})):k.map(j=>({item:j,type:"reset"}));O(D)}},[]),m=u.useCallback(N=>{const{edges:E=[],setEdges:C,hasDefaultEdges:A,onEdgesChange:O}=t.getState(),_=typeof N=="function"?N(E):N;if(A)C(_);else if(O){const k=_.length===0?E.map(D=>({type:"remove",id:D.id})):_.map(D=>({item:D,type:"reset"}));O(k)}},[]),h=u.useCallback(N=>{const E=Array.isArray(N)?N:[N],{getNodes:C,setNodes:A,hasDefaultNodes:O,onNodesChange:_}=t.getState();if(O){const D=[...C(),...E];A(D)}else if(_){const k=E.map(D=>({item:D,type:"add"}));_(k)}},[]),p=u.useCallback(N=>{const E=Array.isArray(N)?N:[N],{edges:C=[],setEdges:A,hasDefaultEdges:O,onEdgesChange:_}=t.getState();if(O)A([...C,...E]);else if(_){const k=E.map(D=>({item:D,type:"add"}));_(k)}},[]),y=u.useCallback(()=>{const{getNodes:N,edges:E=[],transform:C}=t.getState(),[A,O,_]=C;return{nodes:N().map(k=>({...k})),edges:E.map(k=>({...k})),viewport:{x:A,y:O,zoom:_}}},[]),g=u.useCallback(({nodes:N,edges:E})=>{const{nodeInternals:C,getNodes:A,edges:O,hasDefaultNodes:_,hasDefaultEdges:k,onNodesDelete:D,onEdgesDelete:j,onNodesChange:z,onEdgesChange:P}=t.getState(),G=(N||[]).map(B=>B.id),H=(E||[]).map(B=>B.id),X=A().reduce((B,I)=>{const L=I.parentNode||I.parentId,$=!G.includes(I.id)&&L&&B.find(U=>U.id===L);return(typeof I.deletable=="boolean"?I.deletable:!0)&&(G.includes(I.id)||$)&&B.push(I),B},[]),V=O.filter(B=>typeof B.deletable=="boolean"?B.deletable:!0),R=V.filter(B=>H.includes(B.id));if(X||R){const B=NE(X,V),I=[...R,...B],L=I.reduce(($,M)=>($.includes(M.id)||$.push(M.id),$),[]);if((k||_)&&(k&&t.setState({edges:O.filter($=>!L.includes($.id))}),_&&(X.forEach($=>{C.delete($.id)}),t.setState({nodeInternals:new Map(C)}))),L.length>0&&(j?.(I),P&&P(L.map($=>({id:$,type:"remove"})))),X.length>0&&(D?.(X),z)){const $=X.map(M=>({id:M.id,type:"remove"}));z($)}}},[]),v=u.useCallback(N=>{const E=X7(N),C=E?null:t.getState().nodeInternals.get(N.id);return!E&&!C?[null,null,E]:[E?N:nw(C),C,E]},[]),S=u.useCallback((N,E=!0,C)=>{const[A,O,_]=v(N);return A?(C||t.getState().getNodes()).filter(k=>{if(!_&&(k.id===O.id||!k.positionAbsolute))return!1;const D=nw(k),j=cy(D,A);return E&&j>0||j>=A.width*A.height}):[]},[]),w=u.useCallback((N,E,C=!0)=>{const[A]=v(N);if(!A)return!1;const O=cy(A,E);return C&&O>0||O>=A.width*A.height},[]);return u.useMemo(()=>({...e,getNodes:r,getNode:i,getEdges:l,getEdge:c,setNodes:f,setEdges:m,addNodes:h,addEdges:p,toObject:y,deleteElements:g,getIntersectingNodes:S,isNodeIntersecting:w}),[e,r,i,l,c,f,m,h,p,y,g,S,w])}const T6={actInsideInputWithModifier:!1};var M6=({deleteKeyCode:e,multiSelectionKeyCode:t})=>{const r=ta(),{deleteElements:i}=jf(),l=xc(e,T6),c=xc(t);u.useEffect(()=>{if(l){const{edges:f,getNodes:m}=r.getState(),h=m().filter(y=>y.selected),p=f.filter(y=>y.selected);i({nodes:h,edges:p}),r.setState({nodesSelectionActive:!1})}},[l]),u.useEffect(()=>{r.setState({multiSelectionActive:c})},[c])};function R6(e){const t=ta();u.useEffect(()=>{let r;const i=()=>{if(!e.current)return;const l=ug(e.current);(l.height===0||l.width===0)&&t.getState().onError?.("004",dr.error004()),t.setState({width:l.width||500,height:l.height||500})};return i(),window.addEventListener("resize",i),e.current&&(r=new ResizeObserver(()=>i()),r.observe(e.current)),()=>{window.removeEventListener("resize",i),r&&e.current&&r.unobserve(e.current)}},[])}const bg={position:"absolute",width:"100%",height:"100%",top:0,left:0},k6=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,id=e=>({x:e.x,y:e.y,zoom:e.k}),bl=(e,t)=>e.target.closest(`.${t}`),fw=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),mw=e=>{const t=e.ctrlKey&&Hd()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t},D6=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler,userSelectionActive:e.userSelectionActive}),I6=({onMove:e,onMoveStart:t,onMoveEnd:r,onPaneContextMenu:i,zoomOnScroll:l=!0,zoomOnPinch:c=!0,panOnScroll:f=!1,panOnScrollSpeed:m=.5,panOnScrollMode:h=Ai.Free,zoomOnDoubleClick:p=!0,elementsSelectable:y,panOnDrag:g=!0,defaultViewport:v,translateExtent:S,minZoom:w,maxZoom:N,zoomActivationKeyCode:E,preventScrolling:C=!0,children:A,noWheelClassName:O,noPanClassName:_})=>{const k=u.useRef(),D=ta(),j=u.useRef(!1),z=u.useRef(!1),P=u.useRef(null),G=u.useRef({x:0,y:0,zoom:0}),{d3Zoom:H,d3Selection:X,d3ZoomHandler:V,userSelectionActive:R}=In(D6,sa),B=xc(E),I=u.useRef(0),L=u.useRef(!1),$=u.useRef();return R6(P),u.useEffect(()=>{if(P.current){const M=P.current.getBoundingClientRect(),U=cE().scaleExtent([w,N]).translateExtent(S),T=ss(P.current).call(U),q=or.translate(v.x,v.y).scale(kl(v.zoom,w,N)),Y=[[0,0],[M.width,M.height]],Q=U.constrain()(q,Y,S);U.transform(T,Q),U.wheelDelta(mw),D.setState({d3Zoom:U,d3Selection:T,d3ZoomHandler:T.on("wheel.zoom"),transform:[Q.x,Q.y,Q.k],domNode:P.current.closest(".react-flow")})}},[]),u.useEffect(()=>{X&&H&&(f&&!B&&!R?X.on("wheel.zoom",M=>{if(bl(M,O))return!1;M.preventDefault(),M.stopImmediatePropagation();const U=X.property("__zoom").k||1;if(M.ctrlKey&&c){const J=ys(M),se=mw(M),ne=U*Math.pow(2,se);H.scaleTo(X,ne,J,M);return}const T=M.deltaMode===1?20:1;let q=h===Ai.Vertical?0:M.deltaX*T,Y=h===Ai.Horizontal?0:M.deltaY*T;!Hd()&&M.shiftKey&&h!==Ai.Vertical&&(q=M.deltaY*T,Y=0),H.translateBy(X,-(q/U)*m,-(Y/U)*m,{internal:!0});const Q=id(X.property("__zoom")),{onViewportChangeStart:oe,onViewportChange:Z,onViewportChangeEnd:de}=D.getState();clearTimeout($.current),L.current||(L.current=!0,t?.(M,Q),oe?.(Q)),L.current&&(e?.(M,Q),Z?.(Q),$.current=setTimeout(()=>{r?.(M,Q),de?.(Q),L.current=!1},150))},{passive:!1}):typeof V<"u"&&X.on("wheel.zoom",function(M,U){if(!C&&M.type==="wheel"&&!M.ctrlKey||bl(M,O))return null;M.preventDefault(),V.call(this,M,U)},{passive:!1}))},[R,f,h,X,H,V,B,c,C,O,t,e,r]),u.useEffect(()=>{H&&H.on("start",M=>{if(!M.sourceEvent||M.sourceEvent.internal)return null;I.current=M.sourceEvent?.button;const{onViewportChangeStart:U}=D.getState(),T=id(M.transform);j.current=!0,G.current=T,M.sourceEvent?.type==="mousedown"&&D.setState({paneDragging:!0}),U?.(T),t?.(M.sourceEvent,T)})},[H,t]),u.useEffect(()=>{H&&(R&&!j.current?H.on("zoom",null):R||H.on("zoom",M=>{const{onViewportChange:U}=D.getState();if(D.setState({transform:[M.transform.x,M.transform.y,M.transform.k]}),z.current=!!(i&&fw(g,I.current??0)),(e||U)&&!M.sourceEvent?.internal){const T=id(M.transform);U?.(T),e?.(M.sourceEvent,T)}}))},[R,H,e,g,i]),u.useEffect(()=>{H&&H.on("end",M=>{if(!M.sourceEvent||M.sourceEvent.internal)return null;const{onViewportChangeEnd:U}=D.getState();if(j.current=!1,D.setState({paneDragging:!1}),i&&fw(g,I.current??0)&&!z.current&&i(M.sourceEvent),z.current=!1,(r||U)&&k6(G.current,M.transform)){const T=id(M.transform);G.current=T,clearTimeout(k.current),k.current=setTimeout(()=>{U?.(T),r?.(M.sourceEvent,T)},f?150:0)}})},[H,f,g,r,i]),u.useEffect(()=>{H&&H.filter(M=>{const U=B||l,T=c&&M.ctrlKey;if((g===!0||Array.isArray(g)&&g.includes(1))&&M.button===1&&M.type==="mousedown"&&(bl(M,"react-flow__node")||bl(M,"react-flow__edge")))return!0;if(!g&&!U&&!f&&!p&&!c||R||!p&&M.type==="dblclick"||bl(M,O)&&M.type==="wheel"||bl(M,_)&&(M.type!=="wheel"||f&&M.type==="wheel"&&!B)||!c&&M.ctrlKey&&M.type==="wheel"||!U&&!f&&!T&&M.type==="wheel"||!g&&(M.type==="mousedown"||M.type==="touchstart")||Array.isArray(g)&&!g.includes(M.button)&&M.type==="mousedown")return!1;const q=Array.isArray(g)&&g.includes(M.button)||!M.button||M.button<=1;return(!M.ctrlKey||M.type==="wheel")&&q})},[R,H,l,c,f,p,g,y,B]),De.createElement("div",{className:"react-flow__renderer",ref:P,style:bg},A)},L6=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function O6(){const{userSelectionActive:e,userSelectionRect:t}=In(L6,sa);return e&&t?De.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}function hw(e,t){const r=t.parentNode||t.parentId,i=e.find(l=>l.id===r);if(i){const l=t.position.x+t.width-i.width,c=t.position.y+t.height-i.height;if(l>0||c>0||t.position.x<0||t.position.y<0){if(i.style={...i.style},i.style.width=i.style.width??i.width,i.style.height=i.style.height??i.height,l>0&&(i.style.width+=l),c>0&&(i.style.height+=c),t.position.x<0){const f=Math.abs(t.position.x);i.position.x=i.position.x-f,i.style.width+=f,t.position.x=0}if(t.position.y<0){const f=Math.abs(t.position.y);i.position.y=i.position.y-f,i.style.height+=f,t.position.y=0}i.width=i.style.width,i.height=i.style.height}}}function BE(e,t){if(e.some(i=>i.type==="reset"))return e.filter(i=>i.type==="reset").map(i=>i.item);const r=e.filter(i=>i.type==="add").map(i=>i.item);return t.reduce((i,l)=>{const c=e.filter(m=>m.id===l.id);if(c.length===0)return i.push(l),i;const f={...l};for(const m of c)if(m)switch(m.type){case"select":{f.selected=m.selected;break}case"position":{typeof m.position<"u"&&(f.position=m.position),typeof m.positionAbsolute<"u"&&(f.positionAbsolute=m.positionAbsolute),typeof m.dragging<"u"&&(f.dragging=m.dragging),f.expandParent&&hw(i,f);break}case"dimensions":{typeof m.dimensions<"u"&&(f.width=m.dimensions.width,f.height=m.dimensions.height),typeof m.updateStyle<"u"&&(f.style={...f.style||{},...m.dimensions}),typeof m.resizing=="boolean"&&(f.resizing=m.resizing),f.expandParent&&hw(i,f);break}case"remove":return i}return i.push(f),i},r)}function UE(e,t){return BE(e,t)}function z6(e,t){return BE(e,t)}const qr=(e,t)=>({id:e,type:"select",selected:t});function Sl(e,t){return e.reduce((r,i)=>{const l=t.includes(i.id);return!i.selected&&l?(i.selected=!0,r.push(qr(i.id,!0))):i.selected&&!l&&(i.selected=!1,r.push(qr(i.id,!1))),r},[])}const Ep=(e,t)=>r=>{r.target===t.current&&e?.(r)},$6=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging}),qE=u.memo(({isSelecting:e,selectionMode:t=vc.Full,panOnDrag:r,onSelectionStart:i,onSelectionEnd:l,onPaneClick:c,onPaneContextMenu:f,onPaneScroll:m,onPaneMouseEnter:h,onPaneMouseMove:p,onPaneMouseLeave:y,children:g})=>{const v=u.useRef(null),S=ta(),w=u.useRef(0),N=u.useRef(0),E=u.useRef(),{userSelectionActive:C,elementsSelectable:A,dragging:O}=In($6,sa),_=()=>{S.setState({userSelectionActive:!1,userSelectionRect:null}),w.current=0,N.current=0},k=V=>{c?.(V),S.getState().resetSelectedElements(),S.setState({nodesSelectionActive:!1})},D=V=>{if(Array.isArray(r)&&r?.includes(2)){V.preventDefault();return}f?.(V)},j=m?V=>m(V):void 0,z=V=>{const{resetSelectedElements:R,domNode:B}=S.getState();if(E.current=B?.getBoundingClientRect(),!A||!e||V.button!==0||V.target!==v.current||!E.current)return;const{x:I,y:L}=Xr(V,E.current);R(),S.setState({userSelectionRect:{width:0,height:0,startX:I,startY:L,x:I,y:L}}),i?.(V)},P=V=>{const{userSelectionRect:R,nodeInternals:B,edges:I,transform:L,onNodesChange:$,onEdgesChange:M,nodeOrigin:U,getNodes:T}=S.getState();if(!e||!E.current||!R)return;S.setState({userSelectionActive:!0,nodesSelectionActive:!1});const q=Xr(V,E.current),Y=R.startX??0,Q=R.startY??0,oe={...R,x:q.x<Y?q.x:Y,y:q.y<Q?q.y:Q,width:Math.abs(q.x-Y),height:Math.abs(q.y-Q)},Z=T(),de=wE(B,oe,L,t===vc.Partial,!0,U),J=NE(de,I).map(ne=>ne.id),se=de.map(ne=>ne.id);if(w.current!==se.length){w.current=se.length;const ne=Sl(Z,se);ne.length&&$?.(ne)}if(N.current!==J.length){N.current=J.length;const ne=Sl(I,J);ne.length&&M?.(ne)}S.setState({userSelectionRect:oe})},G=V=>{if(V.button!==0)return;const{userSelectionRect:R}=S.getState();!C&&R&&V.target===v.current&&k?.(V),S.setState({nodesSelectionActive:w.current>0}),_(),l?.(V)},H=V=>{C&&(S.setState({nodesSelectionActive:w.current>0}),l?.(V)),_()},X=A&&(e||C);return De.createElement("div",{className:da(["react-flow__pane",{dragging:O,selection:e}]),onClick:X?void 0:Ep(k,v),onContextMenu:Ep(D,v),onWheel:Ep(j,v),onMouseEnter:X?void 0:h,onMouseDown:X?z:void 0,onMouseMove:X?P:p,onMouseUp:X?G:void 0,onMouseLeave:X?H:y,ref:v,style:bg},g,De.createElement(O6,null))});qE.displayName="Pane";function HE(e,t){const r=e.parentNode||e.parentId;if(!r)return!1;const i=t.get(r);return i?i.selected?!0:HE(i,t):!1}function pw(e,t,r){let i=e;do{if(i?.matches(t))return!0;if(i===r.current)return!1;i=i.parentElement}while(i);return!1}function F6(e,t,r,i){return Array.from(e.values()).filter(l=>(l.selected||l.id===i)&&(!l.parentNode||l.parentId||!HE(l,e))&&(l.draggable||t&&typeof l.draggable>"u")).map(l=>({id:l.id,position:l.position||{x:0,y:0},positionAbsolute:l.positionAbsolute||{x:0,y:0},distance:{x:r.x-(l.positionAbsolute?.x??0),y:r.y-(l.positionAbsolute?.y??0)},delta:{x:0,y:0},extent:l.extent,parentNode:l.parentNode||l.parentId,parentId:l.parentNode||l.parentId,width:l.width,height:l.height,expandParent:l.expandParent}))}function B6(e,t){return!t||t==="parent"?t:[t[0],[t[1][0]-(e.width||0),t[1][1]-(e.height||0)]]}function PE(e,t,r,i,l=[0,0],c){const f=B6(e,e.extent||i);let m=f;const h=e.parentNode||e.parentId;if(e.extent==="parent"&&!e.expandParent)if(h&&e.width&&e.height){const g=r.get(h),{x:v,y:S}=Mi(g,l).positionAbsolute;m=g&&rs(v)&&rs(S)&&rs(g.width)&&rs(g.height)?[[v+e.width*l[0],S+e.height*l[1]],[v+g.width-e.width+e.width*l[0],S+g.height-e.height+e.height*l[1]]]:m}else c?.("005",dr.error005()),m=f;else if(e.extent&&h&&e.extent!=="parent"){const g=r.get(h),{x:v,y:S}=Mi(g,l).positionAbsolute;m=[[e.extent[0][0]+v,e.extent[0][1]+S],[e.extent[1][0]+v,e.extent[1][1]+S]]}let p={x:0,y:0};if(h){const g=r.get(h);p=Mi(g,l).positionAbsolute}const y=m&&m!=="parent"?dg(t,m):t;return{position:{x:y.x-p.x,y:y.y-p.y},positionAbsolute:y}}function jp({nodeId:e,dragItems:t,nodeInternals:r}){const i=t.map(l=>({...r.get(l.id),position:l.position,positionAbsolute:l.positionAbsolute}));return[e?i.find(l=>l.id===e):i[0],i]}const yw=(e,t,r,i)=>{const l=t.querySelectorAll(e);if(!l||!l.length)return null;const c=Array.from(l),f=t.getBoundingClientRect(),m={x:f.width*i[0],y:f.height*i[1]};return c.map(h=>{const p=h.getBoundingClientRect();return{id:h.getAttribute("data-handleid"),position:h.getAttribute("data-handlepos"),x:(p.left-f.left-m.x)/r,y:(p.top-f.top-m.y)/r,...ug(h)}})};function Uo(e,t,r){return r===void 0?r:i=>{const l=t().nodeInternals.get(e);l&&r(i,{...l})}}function hy({id:e,store:t,unselect:r=!1,nodeRef:i}){const{addSelectedNodes:l,unselectNodesAndEdges:c,multiSelectionActive:f,nodeInternals:m,onError:h}=t.getState(),p=m.get(e);if(!p){h?.("012",dr.error012(e));return}t.setState({nodesSelectionActive:!1}),p.selected?(r||p.selected&&f)&&(c({nodes:[p],edges:[]}),requestAnimationFrame(()=>i?.current?.blur())):l([e])}function U6(){const e=ta();return u.useCallback(({sourceEvent:r})=>{const{transform:i,snapGrid:l,snapToGrid:c}=e.getState(),f=r.touches?r.touches[0].clientX:r.clientX,m=r.touches?r.touches[0].clientY:r.clientY,h={x:(f-i[0])/i[2],y:(m-i[1])/i[2]};return{xSnapped:c?l[0]*Math.round(h.x/l[0]):h.x,ySnapped:c?l[1]*Math.round(h.y/l[1]):h.y,...h}},[])}function _p(e){return(t,r,i)=>e?.(t,i)}function VE({nodeRef:e,disabled:t=!1,noDragClassName:r,handleSelector:i,nodeId:l,isSelectable:c,selectNodesOnDrag:f}){const m=ta(),[h,p]=u.useState(!1),y=u.useRef([]),g=u.useRef({x:null,y:null}),v=u.useRef(0),S=u.useRef(null),w=u.useRef({x:0,y:0}),N=u.useRef(null),E=u.useRef(!1),C=u.useRef(!1),A=u.useRef(!1),O=U6();return u.useEffect(()=>{if(e?.current){const _=ss(e.current),k=({x:z,y:P})=>{const{nodeInternals:G,onNodeDrag:H,onSelectionDrag:X,updateNodePositions:V,nodeExtent:R,snapGrid:B,snapToGrid:I,nodeOrigin:L,onError:$}=m.getState();g.current={x:z,y:P};let M=!1,U={x:0,y:0,x2:0,y2:0};if(y.current.length>1&&R){const q=Ef(y.current,L);U=bc(q)}if(y.current=y.current.map(q=>{const Y={x:z-q.distance.x,y:P-q.distance.y};I&&(Y.x=B[0]*Math.round(Y.x/B[0]),Y.y=B[1]*Math.round(Y.y/B[1]));const Q=[[R[0][0],R[0][1]],[R[1][0],R[1][1]]];y.current.length>1&&R&&!q.extent&&(Q[0][0]=q.positionAbsolute.x-U.x+R[0][0],Q[1][0]=q.positionAbsolute.x+(q.width??0)-U.x2+R[1][0],Q[0][1]=q.positionAbsolute.y-U.y+R[0][1],Q[1][1]=q.positionAbsolute.y+(q.height??0)-U.y2+R[1][1]);const oe=PE(q,Y,G,Q,L,$);return M=M||q.position.x!==oe.position.x||q.position.y!==oe.position.y,q.position=oe.position,q.positionAbsolute=oe.positionAbsolute,q}),!M)return;V(y.current,!0,!0),p(!0);const T=l?H:_p(X);if(T&&N.current){const[q,Y]=jp({nodeId:l,dragItems:y.current,nodeInternals:G});T(N.current,q,Y)}},D=()=>{if(!S.current)return;const[z,P]=dE(w.current,S.current);if(z!==0||P!==0){const{transform:G,panBy:H}=m.getState();g.current.x=(g.current.x??0)-z/G[2],g.current.y=(g.current.y??0)-P/G[2],H({x:z,y:P})&&k(g.current)}v.current=requestAnimationFrame(D)},j=z=>{const{nodeInternals:P,multiSelectionActive:G,nodesDraggable:H,unselectNodesAndEdges:X,onNodeDragStart:V,onSelectionDragStart:R}=m.getState();C.current=!0;const B=l?V:_p(R);(!f||!c)&&!G&&l&&(P.get(l)?.selected||X()),l&&c&&f&&hy({id:l,store:m,nodeRef:e});const I=O(z);if(g.current=I,y.current=F6(P,H,I,l),B&&y.current){const[L,$]=jp({nodeId:l,dragItems:y.current,nodeInternals:P});B(z.sourceEvent,L,$)}};if(t)_.on(".drag",null);else{const z=Q5().on("start",P=>{const{domNode:G,nodeDragThreshold:H}=m.getState();H===0&&j(P),A.current=!1;const X=O(P);g.current=X,S.current=G?.getBoundingClientRect()||null,w.current=Xr(P.sourceEvent,S.current)}).on("drag",P=>{const G=O(P),{autoPanOnNodeDrag:H,nodeDragThreshold:X}=m.getState();if(P.sourceEvent.type==="touchmove"&&P.sourceEvent.touches.length>1&&(A.current=!0),!A.current){if(!E.current&&C.current&&H&&(E.current=!0,D()),!C.current){const V=G.xSnapped-(g?.current?.x??0),R=G.ySnapped-(g?.current?.y??0);Math.sqrt(V*V+R*R)>X&&j(P)}(g.current.x!==G.xSnapped||g.current.y!==G.ySnapped)&&y.current&&C.current&&(N.current=P.sourceEvent,w.current=Xr(P.sourceEvent,S.current),k(G))}}).on("end",P=>{if(!(!C.current||A.current)&&(p(!1),E.current=!1,C.current=!1,cancelAnimationFrame(v.current),y.current)){const{updateNodePositions:G,nodeInternals:H,onNodeDragStop:X,onSelectionDragStop:V}=m.getState(),R=l?X:_p(V);if(G(y.current,!1,!1),R){const[B,I]=jp({nodeId:l,dragItems:y.current,nodeInternals:H});R(P.sourceEvent,B,I)}}}).filter(P=>{const G=P.target;return!P.button&&(!r||!pw(G,`.${r}`,e))&&(!i||pw(G,i,e))});return _.call(z),()=>{_.on(".drag",null)}}}},[e,t,r,i,c,m,l,f,O]),h}function YE(){const e=ta();return u.useCallback(r=>{const{nodeInternals:i,nodeExtent:l,updateNodePositions:c,getNodes:f,snapToGrid:m,snapGrid:h,onError:p,nodesDraggable:y}=e.getState(),g=f().filter(A=>A.selected&&(A.draggable||y&&typeof A.draggable>"u")),v=m?h[0]:5,S=m?h[1]:5,w=r.isShiftPressed?4:1,N=r.x*v*w,E=r.y*S*w,C=g.map(A=>{if(A.positionAbsolute){const O={x:A.positionAbsolute.x+N,y:A.positionAbsolute.y+E};m&&(O.x=h[0]*Math.round(O.x/h[0]),O.y=h[1]*Math.round(O.y/h[1]));const{positionAbsolute:_,position:k}=PE(A,O,i,l,void 0,p);A.position=k,A.positionAbsolute=_}return A});c(C,!0,!1)},[])}const _l={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var qo=e=>{const t=({id:r,type:i,data:l,xPos:c,yPos:f,xPosOrigin:m,yPosOrigin:h,selected:p,onClick:y,onMouseEnter:g,onMouseMove:v,onMouseLeave:S,onContextMenu:w,onDoubleClick:N,style:E,className:C,isDraggable:A,isSelectable:O,isConnectable:_,isFocusable:k,selectNodesOnDrag:D,sourcePosition:j,targetPosition:z,hidden:P,resizeObserver:G,dragHandle:H,zIndex:X,isParent:V,noDragClassName:R,noPanClassName:B,initialized:I,disableKeyboardA11y:L,ariaLabel:$,rfId:M,hasHandleBounds:U})=>{const T=ta(),q=u.useRef(null),Y=u.useRef(null),Q=u.useRef(j),oe=u.useRef(z),Z=u.useRef(i),de=O||A||y||g||v||S,J=YE(),se=Uo(r,T.getState,g),ne=Uo(r,T.getState,v),we=Uo(r,T.getState,S),Le=Uo(r,T.getState,w),Me=Uo(r,T.getState,N),Ae=nt=>{const{nodeDragThreshold:$e}=T.getState();if(O&&(!D||!A||$e>0)&&hy({id:r,store:T,nodeRef:q}),y){const vt=T.getState().nodeInternals.get(r);vt&&y(nt,{...vt})}},ot=nt=>{if(!uy(nt)&&!L)if(pE.includes(nt.key)&&O){const $e=nt.key==="Escape";hy({id:r,store:T,unselect:$e,nodeRef:q})}else A&&p&&Object.prototype.hasOwnProperty.call(_l,nt.key)&&(T.setState({ariaLiveMessage:`Moved selected node ${nt.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~c}, y: ${~~f}`}),J({x:_l[nt.key].x,y:_l[nt.key].y,isShiftPressed:nt.shiftKey}))};u.useEffect(()=>()=>{Y.current&&(G?.unobserve(Y.current),Y.current=null)},[]),u.useEffect(()=>{if(q.current&&!P){const nt=q.current;(!I||!U||Y.current!==nt)&&(Y.current&&G?.unobserve(Y.current),G?.observe(nt),Y.current=nt)}},[P,I,U]),u.useEffect(()=>{const nt=Z.current!==i,$e=Q.current!==j,vt=oe.current!==z;q.current&&(nt||$e||vt)&&(nt&&(Z.current=i),$e&&(Q.current=j),vt&&(oe.current=z),T.getState().updateNodeDimensions([{id:r,nodeElement:q.current,forceUpdate:!0}]))},[r,i,j,z]);const ze=VE({nodeRef:q,disabled:P||!A,noDragClassName:R,handleSelector:H,nodeId:r,isSelectable:O,selectNodesOnDrag:D});return P?null:De.createElement("div",{className:da(["react-flow__node",`react-flow__node-${i}`,{[B]:A},C,{selected:p,selectable:O,parent:V,dragging:ze}]),ref:q,style:{zIndex:X,transform:`translate(${m}px,${h}px)`,pointerEvents:de?"all":"none",visibility:I?"visible":"hidden",...E},"data-id":r,"data-testid":`rf__node-${r}`,onMouseEnter:se,onMouseMove:ne,onMouseLeave:we,onContextMenu:Le,onClick:Ae,onDoubleClick:Me,onKeyDown:k?ot:void 0,tabIndex:k?0:void 0,role:k?"button":void 0,"aria-describedby":L?void 0:`${LE}-${M}`,"aria-label":$},De.createElement(t6,{value:r},De.createElement(e,{id:r,data:l,type:i,xPos:c,yPos:f,selected:p,isConnectable:_,sourcePosition:j,targetPosition:z,dragging:ze,dragHandle:H,zIndex:X})))};return t.displayName="NodeWrapper",u.memo(t)};const q6=e=>{const t=e.getNodes().filter(r=>r.selected);return{...Ef(t,e.nodeOrigin),transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`,userSelectionActive:e.userSelectionActive}};function H6({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:r}){const i=ta(),{width:l,height:c,x:f,y:m,transformString:h,userSelectionActive:p}=In(q6,sa),y=YE(),g=u.useRef(null);if(u.useEffect(()=>{r||g.current?.focus({preventScroll:!0})},[r]),VE({nodeRef:g}),p||!l||!c)return null;const v=e?w=>{const N=i.getState().getNodes().filter(E=>E.selected);e(w,N)}:void 0,S=w=>{Object.prototype.hasOwnProperty.call(_l,w.key)&&y({x:_l[w.key].x,y:_l[w.key].y,isShiftPressed:w.shiftKey})};return De.createElement("div",{className:da(["react-flow__nodesselection","react-flow__container",t]),style:{transform:h}},De.createElement("div",{ref:g,className:"react-flow__nodesselection-rect",onContextMenu:v,tabIndex:r?void 0:-1,onKeyDown:r?void 0:S,style:{width:l,height:c,top:m,left:f}}))}var P6=u.memo(H6);const V6=e=>e.nodesSelectionActive,GE=({children:e,onPaneClick:t,onPaneMouseEnter:r,onPaneMouseMove:i,onPaneMouseLeave:l,onPaneContextMenu:c,onPaneScroll:f,deleteKeyCode:m,onMove:h,onMoveStart:p,onMoveEnd:y,selectionKeyCode:g,selectionOnDrag:v,selectionMode:S,onSelectionStart:w,onSelectionEnd:N,multiSelectionKeyCode:E,panActivationKeyCode:C,zoomActivationKeyCode:A,elementsSelectable:O,zoomOnScroll:_,zoomOnPinch:k,panOnScroll:D,panOnScrollSpeed:j,panOnScrollMode:z,zoomOnDoubleClick:P,panOnDrag:G,defaultViewport:H,translateExtent:X,minZoom:V,maxZoom:R,preventScrolling:B,onSelectionContextMenu:I,noWheelClassName:L,noPanClassName:$,disableKeyboardA11y:M})=>{const U=In(V6),T=xc(g),q=xc(C),Y=q||G,Q=q||D,oe=T||v&&Y!==!0;return M6({deleteKeyCode:m,multiSelectionKeyCode:E}),De.createElement(I6,{onMove:h,onMoveStart:p,onMoveEnd:y,onPaneContextMenu:c,elementsSelectable:O,zoomOnScroll:_,zoomOnPinch:k,panOnScroll:Q,panOnScrollSpeed:j,panOnScrollMode:z,zoomOnDoubleClick:P,panOnDrag:!T&&Y,defaultViewport:H,translateExtent:X,minZoom:V,maxZoom:R,zoomActivationKeyCode:A,preventScrolling:B,noWheelClassName:L,noPanClassName:$},De.createElement(qE,{onSelectionStart:w,onSelectionEnd:N,onPaneClick:t,onPaneMouseEnter:r,onPaneMouseMove:i,onPaneMouseLeave:l,onPaneContextMenu:c,onPaneScroll:f,panOnDrag:Y,isSelecting:!!oe,selectionMode:S},e,U&&De.createElement(P6,{onSelectionContextMenu:I,noPanClassName:$,disableKeyboardA11y:M})))};GE.displayName="FlowRenderer";var Y6=u.memo(GE);function G6(e){return In(u.useCallback(r=>e?wE(r.nodeInternals,{x:0,y:0,width:r.width,height:r.height},r.transform,!0):r.getNodes(),[e]))}function X6(e){const t={input:qo(e.input||RE),default:qo(e.default||my),output:qo(e.output||DE),group:qo(e.group||gg)},r={},i=Object.keys(e).filter(l=>!["input","default","output","group"].includes(l)).reduce((l,c)=>(l[c]=qo(e[c]||my),l),r);return{...t,...i}}const K6=({x:e,y:t,width:r,height:i,origin:l})=>!r||!i?{x:e,y:t}:l[0]<0||l[1]<0||l[0]>1||l[1]>1?{x:e,y:t}:{x:e-r*l[0],y:t-i*l[1]},W6=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions,onError:e.onError}),XE=e=>{const{nodesDraggable:t,nodesConnectable:r,nodesFocusable:i,elementsSelectable:l,updateNodeDimensions:c,onError:f}=In(W6,sa),m=G6(e.onlyRenderVisibleElements),h=u.useRef(),p=u.useMemo(()=>{if(typeof ResizeObserver>"u")return null;const y=new ResizeObserver(g=>{const v=g.map(S=>({id:S.target.getAttribute("data-id"),nodeElement:S.target,forceUpdate:!0}));c(v)});return h.current=y,y},[]);return u.useEffect(()=>()=>{h?.current?.disconnect()},[]),De.createElement("div",{className:"react-flow__nodes",style:bg},m.map(y=>{let g=y.type||"default";e.nodeTypes[g]||(f?.("003",dr.error003(g)),g="default");const v=e.nodeTypes[g]||e.nodeTypes.default,S=!!(y.draggable||t&&typeof y.draggable>"u"),w=!!(y.selectable||l&&typeof y.selectable>"u"),N=!!(y.connectable||r&&typeof y.connectable>"u"),E=!!(y.focusable||i&&typeof y.focusable>"u"),C=e.nodeExtent?dg(y.positionAbsolute,e.nodeExtent):y.positionAbsolute,A=C?.x??0,O=C?.y??0,_=K6({x:A,y:O,width:y.width??0,height:y.height??0,origin:e.nodeOrigin});return De.createElement(v,{key:y.id,id:y.id,className:y.className,style:y.style,type:g,data:y.data,sourcePosition:y.sourcePosition||qt.Bottom,targetPosition:y.targetPosition||qt.Top,hidden:y.hidden,xPos:A,yPos:O,xPosOrigin:_.x,yPosOrigin:_.y,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!y.selected,isDraggable:S,isSelectable:w,isConnectable:N,isFocusable:E,resizeObserver:p,dragHandle:y.dragHandle,zIndex:y[Pn]?.z??0,isParent:!!y[Pn]?.isParent,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!y.width&&!!y.height,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,ariaLabel:y.ariaLabel,hasHandleBounds:!!y[Pn]?.handleBounds})}))};XE.displayName="NodeRenderer";var Z6=u.memo(XE);const Q6=(e,t,r)=>r===qt.Left?e-t:r===qt.Right?e+t:e,J6=(e,t,r)=>r===qt.Top?e-t:r===qt.Bottom?e+t:e,gw="react-flow__edgeupdater",bw=({position:e,centerX:t,centerY:r,radius:i=10,onMouseDown:l,onMouseEnter:c,onMouseOut:f,type:m})=>De.createElement("circle",{onMouseDown:l,onMouseEnter:c,onMouseOut:f,className:da([gw,`${gw}-${m}`]),cx:Q6(t,i,e),cy:J6(r,i,e),r:i,stroke:"transparent",fill:"transparent"}),e8=()=>!0;var vl=e=>{const t=({id:r,className:i,type:l,data:c,onClick:f,onEdgeDoubleClick:m,selected:h,animated:p,label:y,labelStyle:g,labelShowBg:v,labelBgStyle:S,labelBgPadding:w,labelBgBorderRadius:N,style:E,source:C,target:A,sourceX:O,sourceY:_,targetX:k,targetY:D,sourcePosition:j,targetPosition:z,elementsSelectable:P,hidden:G,sourceHandleId:H,targetHandleId:X,onContextMenu:V,onMouseEnter:R,onMouseMove:B,onMouseLeave:I,reconnectRadius:L,onReconnect:$,onReconnectStart:M,onReconnectEnd:U,markerEnd:T,markerStart:q,rfId:Y,ariaLabel:Q,isFocusable:oe,isReconnectable:Z,pathOptions:de,interactionWidth:J,disableKeyboardA11y:se})=>{const ne=u.useRef(null),[we,Le]=u.useState(!1),[Me,Ae]=u.useState(!1),ot=ta(),ze=u.useMemo(()=>`url('#${dy(q,Y)}')`,[q,Y]),nt=u.useMemo(()=>`url('#${dy(T,Y)}')`,[T,Y]);if(G)return null;const $e=me=>{const{edges:Se,addSelectedEdges:Ge,unselectNodesAndEdges:Xe,multiSelectionActive:et}=ot.getState(),Te=Se.find(mt=>mt.id===r);Te&&(P&&(ot.setState({nodesSelectionActive:!1}),Te.selected&&et?(Xe({nodes:[],edges:[Te]}),ne.current?.blur()):Ge([r])),f&&f(me,Te))},vt=Bo(r,ot.getState,m),_t=Bo(r,ot.getState,V),Tt=Bo(r,ot.getState,R),Ct=Bo(r,ot.getState,B),Be=Bo(r,ot.getState,I),at=(me,Se)=>{if(me.button!==0)return;const{edges:Ge,isValidConnection:Xe}=ot.getState(),et=Se?A:C,Te=(Se?X:H)||null,mt=Se?"target":"source",Dt=Xe||e8,At=Se,Ke=Ge.find(Ut=>Ut.id===r);Ae(!0),M?.(me,Ke,mt);const ct=Ut=>{Ae(!1),U?.(Ut,Ke,mt)};CE({event:me,handleId:Te,nodeId:et,onConnect:Ut=>$?.(Ke,Ut),isTarget:At,getState:ot.getState,setState:ot.setState,isValidConnection:Dt,edgeUpdaterType:mt,onReconnectEnd:ct})},fe=me=>at(me,!0),ce=me=>at(me,!1),ye=()=>Le(!0),Pe=()=>Le(!1),ee=!P&&!f,pe=me=>{if(!se&&pE.includes(me.key)&&P){const{unselectNodesAndEdges:Se,addSelectedEdges:Ge,edges:Xe}=ot.getState();me.key==="Escape"?(ne.current?.blur(),Se({edges:[Xe.find(Te=>Te.id===r)]})):Ge([r])}};return De.createElement("g",{className:da(["react-flow__edge",`react-flow__edge-${l}`,i,{selected:h,animated:p,inactive:ee,updating:we}]),onClick:$e,onDoubleClick:vt,onContextMenu:_t,onMouseEnter:Tt,onMouseMove:Ct,onMouseLeave:Be,onKeyDown:oe?pe:void 0,tabIndex:oe?0:void 0,role:oe?"button":"img","data-testid":`rf__edge-${r}`,"aria-label":Q===null?void 0:Q||`Edge from ${C} to ${A}`,"aria-describedby":oe?`${OE}-${Y}`:void 0,ref:ne},!Me&&De.createElement(e,{id:r,source:C,target:A,selected:h,animated:p,label:y,labelStyle:g,labelShowBg:v,labelBgStyle:S,labelBgPadding:w,labelBgBorderRadius:N,data:c,style:E,sourceX:O,sourceY:_,targetX:k,targetY:D,sourcePosition:j,targetPosition:z,sourceHandleId:H,targetHandleId:X,markerStart:ze,markerEnd:nt,pathOptions:de,interactionWidth:J}),Z&&De.createElement(De.Fragment,null,(Z==="source"||Z===!0)&&De.createElement(bw,{position:j,centerX:O,centerY:_,radius:L,onMouseDown:fe,onMouseEnter:ye,onMouseOut:Pe,type:"source"}),(Z==="target"||Z===!0)&&De.createElement(bw,{position:z,centerX:k,centerY:D,radius:L,onMouseDown:ce,onMouseEnter:ye,onMouseOut:Pe,type:"target"})))};return t.displayName="EdgeWrapper",u.memo(t)};function t8(e){const t={default:vl(e.default||Yd),straight:vl(e.bezier||hg),step:vl(e.step||mg),smoothstep:vl(e.step||Nf),simplebezier:vl(e.simplebezier||fg)},r={},i=Object.keys(e).filter(l=>!["default","bezier"].includes(l)).reduce((l,c)=>(l[c]=vl(e[c]||Yd),l),r);return{...t,...i}}function vw(e,t,r=null){const i=(r?.x||0)+t.x,l=(r?.y||0)+t.y,c=r?.width||t.width,f=r?.height||t.height;switch(e){case qt.Top:return{x:i+c/2,y:l};case qt.Right:return{x:i+c,y:l+f/2};case qt.Bottom:return{x:i+c/2,y:l+f};case qt.Left:return{x:i,y:l+f/2}}}function xw(e,t){return e?e.length===1||!t?e[0]:t&&e.find(r=>r.id===t)||null:null}const n8=(e,t,r,i,l,c)=>{const f=vw(r,e,t),m=vw(c,i,l);return{sourceX:f.x,sourceY:f.y,targetX:m.x,targetY:m.y}};function a8({sourcePos:e,targetPos:t,sourceWidth:r,sourceHeight:i,targetWidth:l,targetHeight:c,width:f,height:m,transform:h}){const p={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x+r,t.x+l),y2:Math.max(e.y+i,t.y+c)};p.x===p.x2&&(p.x2+=1),p.y===p.y2&&(p.y2+=1);const y=bc({x:(0-h[0])/h[2],y:(0-h[1])/h[2],width:f/h[2],height:m/h[2]}),g=Math.max(0,Math.min(y.x2,p.x2)-Math.max(y.x,p.x)),v=Math.max(0,Math.min(y.y2,p.y2)-Math.max(y.y,p.y));return Math.ceil(g*v)>0}function Sw(e){const t=e?.[Pn]?.handleBounds||null,r=t&&e?.width&&e?.height&&typeof e?.positionAbsolute?.x<"u"&&typeof e?.positionAbsolute?.y<"u";return[{x:e?.positionAbsolute?.x||0,y:e?.positionAbsolute?.y||0,width:e?.width||0,height:e?.height||0},t,!!r]}const s8=[{level:0,isMaxLevel:!0,edges:[]}];function r8(e,t,r=!1){let i=-1;const l=e.reduce((f,m)=>{const h=rs(m.zIndex);let p=h?m.zIndex:0;if(r){const y=t.get(m.target),g=t.get(m.source),v=m.selected||y?.selected||g?.selected,S=Math.max(g?.[Pn]?.z||0,y?.[Pn]?.z||0,1e3);p=(h?m.zIndex:0)+(v?S:0)}return f[p]?f[p].push(m):f[p]=[m],i=p>i?p:i,f},{}),c=Object.entries(l).map(([f,m])=>{const h=+f;return{edges:m,level:h,isMaxLevel:h===i}});return c.length===0?s8:c}function i8(e,t,r){const i=In(u.useCallback(l=>e?l.edges.filter(c=>{const f=t.get(c.source),m=t.get(c.target);return f?.width&&f?.height&&m?.width&&m?.height&&a8({sourcePos:f.positionAbsolute||{x:0,y:0},targetPos:m.positionAbsolute||{x:0,y:0},sourceWidth:f.width,sourceHeight:f.height,targetWidth:m.width,targetHeight:m.height,width:l.width,height:l.height,transform:l.transform})}):l.edges,[e,t]));return r8(i,t,r)}const l8=({color:e="none",strokeWidth:t=1})=>De.createElement("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),o8=({color:e="none",strokeWidth:t=1})=>De.createElement("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),ww={[Pd.Arrow]:l8,[Pd.ArrowClosed]:o8};function c8(e){const t=ta();return u.useMemo(()=>Object.prototype.hasOwnProperty.call(ww,e)?ww[e]:(t.getState().onError?.("009",dr.error009(e)),null),[e])}const u8=({id:e,type:t,color:r,width:i=12.5,height:l=12.5,markerUnits:c="strokeWidth",strokeWidth:f,orient:m="auto-start-reverse"})=>{const h=c8(t);return h?De.createElement("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${i}`,markerHeight:`${l}`,viewBox:"-10 -10 20 20",markerUnits:c,orient:m,refX:"0",refY:"0"},De.createElement(h,{color:r,strokeWidth:f})):null},d8=({defaultColor:e,rfId:t})=>r=>{const i=[];return r.edges.reduce((l,c)=>([c.markerStart,c.markerEnd].forEach(f=>{if(f&&typeof f=="object"){const m=dy(f,t);i.includes(m)||(l.push({id:m,color:f.color||e,...f}),i.push(m))}}),l),[]).sort((l,c)=>l.id.localeCompare(c.id))},KE=({defaultColor:e,rfId:t})=>{const r=In(u.useCallback(d8({defaultColor:e,rfId:t}),[e,t]),(i,l)=>!(i.length!==l.length||i.some((c,f)=>c.id!==l[f].id)));return De.createElement("defs",null,r.map(i=>De.createElement(u8,{id:i.id,key:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient})))};KE.displayName="MarkerDefinitions";var f8=u.memo(KE);const m8=e=>({nodesConnectable:e.nodesConnectable,edgesFocusable:e.edgesFocusable,edgesUpdatable:e.edgesUpdatable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals,onError:e.onError}),WE=({defaultMarkerColor:e,onlyRenderVisibleElements:t,elevateEdgesOnSelect:r,rfId:i,edgeTypes:l,noPanClassName:c,onEdgeContextMenu:f,onEdgeMouseEnter:m,onEdgeMouseMove:h,onEdgeMouseLeave:p,onEdgeClick:y,onEdgeDoubleClick:g,onReconnect:v,onReconnectStart:S,onReconnectEnd:w,reconnectRadius:N,children:E,disableKeyboardA11y:C})=>{const{edgesFocusable:A,edgesUpdatable:O,elementsSelectable:_,width:k,height:D,connectionMode:j,nodeInternals:z,onError:P}=In(m8,sa),G=i8(t,z,r);return k?De.createElement(De.Fragment,null,G.map(({level:H,edges:X,isMaxLevel:V})=>De.createElement("svg",{key:H,style:{zIndex:H},width:k,height:D,className:"react-flow__edges react-flow__container"},V&&De.createElement(f8,{defaultColor:e,rfId:i}),De.createElement("g",null,X.map(R=>{const[B,I,L]=Sw(z.get(R.source)),[$,M,U]=Sw(z.get(R.target));if(!L||!U)return null;let T=R.type||"default";l[T]||(P?.("011",dr.error011(T)),T="default");const q=l[T]||l.default,Y=j===ki.Strict?M.target:(M.target??[]).concat(M.source??[]),Q=xw(I.source,R.sourceHandle),oe=xw(Y,R.targetHandle),Z=Q?.position||qt.Bottom,de=oe?.position||qt.Top,J=!!(R.focusable||A&&typeof R.focusable>"u"),se=R.reconnectable||R.updatable,ne=typeof v<"u"&&(se||O&&typeof se>"u");if(!Q||!oe)return P?.("008",dr.error008(Q,R)),null;const{sourceX:we,sourceY:Le,targetX:Me,targetY:Ae}=n8(B,Q,Z,$,oe,de);return De.createElement(q,{key:R.id,id:R.id,className:da([R.className,c]),type:T,data:R.data,selected:!!R.selected,animated:!!R.animated,hidden:!!R.hidden,label:R.label,labelStyle:R.labelStyle,labelShowBg:R.labelShowBg,labelBgStyle:R.labelBgStyle,labelBgPadding:R.labelBgPadding,labelBgBorderRadius:R.labelBgBorderRadius,style:R.style,source:R.source,target:R.target,sourceHandleId:R.sourceHandle,targetHandleId:R.targetHandle,markerEnd:R.markerEnd,markerStart:R.markerStart,sourceX:we,sourceY:Le,targetX:Me,targetY:Ae,sourcePosition:Z,targetPosition:de,elementsSelectable:_,onContextMenu:f,onMouseEnter:m,onMouseMove:h,onMouseLeave:p,onClick:y,onEdgeDoubleClick:g,onReconnect:v,onReconnectStart:S,onReconnectEnd:w,reconnectRadius:N,rfId:i,ariaLabel:R.ariaLabel,isFocusable:J,isReconnectable:ne,pathOptions:"pathOptions"in R?R.pathOptions:void 0,interactionWidth:R.interactionWidth,disableKeyboardA11y:C})})))),E):null};WE.displayName="EdgeRenderer";var h8=u.memo(WE);const p8=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function y8({children:e}){const t=In(p8);return De.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:t}},e)}function g8(e){const t=jf(),r=u.useRef(!1);u.useEffect(()=>{!r.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),r.current=!0)},[e,t.viewportInitialized])}const b8={[qt.Left]:qt.Right,[qt.Right]:qt.Left,[qt.Top]:qt.Bottom,[qt.Bottom]:qt.Top},ZE=({nodeId:e,handleType:t,style:r,type:i=Yr.Bezier,CustomComponent:l,connectionStatus:c})=>{const{fromNode:f,handleId:m,toX:h,toY:p,connectionMode:y}=In(u.useCallback(D=>({fromNode:D.nodeInternals.get(e),handleId:D.connectionHandleId,toX:(D.connectionPosition.x-D.transform[0])/D.transform[2],toY:(D.connectionPosition.y-D.transform[1])/D.transform[2],connectionMode:D.connectionMode}),[e]),sa),g=f?.[Pn]?.handleBounds;let v=g?.[t];if(y===ki.Loose&&(v=v||g?.[t==="source"?"target":"source"]),!f||!v)return null;const S=m?v.find(D=>D.id===m):v[0],w=S?S.x+S.width/2:(f.width??0)/2,N=S?S.y+S.height/2:f.height??0,E=(f.positionAbsolute?.x??0)+w,C=(f.positionAbsolute?.y??0)+N,A=S?.position,O=A?b8[A]:null;if(!A||!O)return null;if(l)return De.createElement(l,{connectionLineType:i,connectionLineStyle:r,fromNode:f,fromHandle:S,fromX:E,fromY:C,toX:h,toY:p,fromPosition:A,toPosition:O,connectionStatus:c});let _="";const k={sourceX:E,sourceY:C,sourcePosition:A,targetX:h,targetY:p,targetPosition:O};return i===Yr.Bezier?[_]=xE(k):i===Yr.Step?[_]=Vd({...k,borderRadius:0}):i===Yr.SmoothStep?[_]=Vd(k):i===Yr.SimpleBezier?[_]=vE(k):_=`M${E},${C} ${h},${p}`,De.createElement("path",{d:_,fill:"none",className:"react-flow__connection-path",style:r})};ZE.displayName="ConnectionLine";const v8=e=>({nodeId:e.connectionNodeId,handleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,connectionStatus:e.connectionStatus,width:e.width,height:e.height});function x8({containerStyle:e,style:t,type:r,component:i}){const{nodeId:l,handleType:c,nodesConnectable:f,width:m,height:h,connectionStatus:p}=In(v8,sa);return!(l&&c&&m&&f)?null:De.createElement("svg",{style:e,width:m,height:h,className:"react-flow__edges react-flow__connectionline react-flow__container"},De.createElement("g",{className:da(["react-flow__connection",p])},De.createElement(ZE,{nodeId:l,handleType:c,style:t,type:r,CustomComponent:i,connectionStatus:p})))}function Nw(e,t){return u.useRef(null),ta(),u.useMemo(()=>t(e),[e])}const QE=({nodeTypes:e,edgeTypes:t,onMove:r,onMoveStart:i,onMoveEnd:l,onInit:c,onNodeClick:f,onEdgeClick:m,onNodeDoubleClick:h,onEdgeDoubleClick:p,onNodeMouseEnter:y,onNodeMouseMove:g,onNodeMouseLeave:v,onNodeContextMenu:S,onSelectionContextMenu:w,onSelectionStart:N,onSelectionEnd:E,connectionLineType:C,connectionLineStyle:A,connectionLineComponent:O,connectionLineContainerStyle:_,selectionKeyCode:k,selectionOnDrag:D,selectionMode:j,multiSelectionKeyCode:z,panActivationKeyCode:P,zoomActivationKeyCode:G,deleteKeyCode:H,onlyRenderVisibleElements:X,elementsSelectable:V,selectNodesOnDrag:R,defaultViewport:B,translateExtent:I,minZoom:L,maxZoom:$,preventScrolling:M,defaultMarkerColor:U,zoomOnScroll:T,zoomOnPinch:q,panOnScroll:Y,panOnScrollSpeed:Q,panOnScrollMode:oe,zoomOnDoubleClick:Z,panOnDrag:de,onPaneClick:J,onPaneMouseEnter:se,onPaneMouseMove:ne,onPaneMouseLeave:we,onPaneScroll:Le,onPaneContextMenu:Me,onEdgeContextMenu:Ae,onEdgeMouseEnter:ot,onEdgeMouseMove:ze,onEdgeMouseLeave:nt,onReconnect:$e,onReconnectStart:vt,onReconnectEnd:_t,reconnectRadius:Tt,noDragClassName:Ct,noWheelClassName:Be,noPanClassName:at,elevateEdgesOnSelect:fe,disableKeyboardA11y:ce,nodeOrigin:ye,nodeExtent:Pe,rfId:ee})=>{const pe=Nw(e,X6),me=Nw(t,t8);return g8(c),De.createElement(Y6,{onPaneClick:J,onPaneMouseEnter:se,onPaneMouseMove:ne,onPaneMouseLeave:we,onPaneContextMenu:Me,onPaneScroll:Le,deleteKeyCode:H,selectionKeyCode:k,selectionOnDrag:D,selectionMode:j,onSelectionStart:N,onSelectionEnd:E,multiSelectionKeyCode:z,panActivationKeyCode:P,zoomActivationKeyCode:G,elementsSelectable:V,onMove:r,onMoveStart:i,onMoveEnd:l,zoomOnScroll:T,zoomOnPinch:q,zoomOnDoubleClick:Z,panOnScroll:Y,panOnScrollSpeed:Q,panOnScrollMode:oe,panOnDrag:de,defaultViewport:B,translateExtent:I,minZoom:L,maxZoom:$,onSelectionContextMenu:w,preventScrolling:M,noDragClassName:Ct,noWheelClassName:Be,noPanClassName:at,disableKeyboardA11y:ce},De.createElement(y8,null,De.createElement(h8,{edgeTypes:me,onEdgeClick:m,onEdgeDoubleClick:p,onlyRenderVisibleElements:X,onEdgeContextMenu:Ae,onEdgeMouseEnter:ot,onEdgeMouseMove:ze,onEdgeMouseLeave:nt,onReconnect:$e,onReconnectStart:vt,onReconnectEnd:_t,reconnectRadius:Tt,defaultMarkerColor:U,noPanClassName:at,elevateEdgesOnSelect:!!fe,disableKeyboardA11y:ce,rfId:ee},De.createElement(x8,{style:A,type:C,component:O,containerStyle:_})),De.createElement("div",{className:"react-flow__edgelabel-renderer"}),De.createElement(Z6,{nodeTypes:pe,onNodeClick:f,onNodeDoubleClick:h,onNodeMouseEnter:y,onNodeMouseMove:g,onNodeMouseLeave:v,onNodeContextMenu:S,selectNodesOnDrag:R,onlyRenderVisibleElements:X,noPanClassName:at,noDragClassName:Ct,disableKeyboardA11y:ce,nodeOrigin:ye,nodeExtent:Pe,rfId:ee})))};QE.displayName="GraphView";var S8=u.memo(QE);const py=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],$r={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:py,nodeExtent:py,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:ki.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:K7,isValidConnection:void 0},w8=()=>uL((e,t)=>({...$r,setNodes:r=>{const{nodeInternals:i,nodeOrigin:l,elevateNodesOnSelect:c}=t();e({nodeInternals:Np(r,i,l,c)})},getNodes:()=>Array.from(t().nodeInternals.values()),setEdges:r=>{const{defaultEdgeOptions:i={}}=t();e({edges:r.map(l=>({...i,...l}))})},setDefaultNodesAndEdges:(r,i)=>{const l=typeof r<"u",c=typeof i<"u",f=l?Np(r,new Map,t().nodeOrigin,t().elevateNodesOnSelect):new Map;e({nodeInternals:f,edges:c?i:[],hasDefaultNodes:l,hasDefaultEdges:c})},updateNodeDimensions:r=>{const{onNodesChange:i,nodeInternals:l,fitViewOnInit:c,fitViewOnInitDone:f,fitViewOnInitOptions:m,domNode:h,nodeOrigin:p}=t(),y=h?.querySelector(".react-flow__viewport");if(!y)return;const g=window.getComputedStyle(y),{m22:v}=new window.DOMMatrixReadOnly(g.transform),S=r.reduce((N,E)=>{const C=l.get(E.id);if(C?.hidden)l.set(C.id,{...C,[Pn]:{...C[Pn],handleBounds:void 0}});else if(C){const A=ug(E.nodeElement);!!(A.width&&A.height&&(C.width!==A.width||C.height!==A.height||E.forceUpdate))&&(l.set(C.id,{...C,[Pn]:{...C[Pn],handleBounds:{source:yw(".source",E.nodeElement,v,p),target:yw(".target",E.nodeElement,v,p)}},...A}),N.push({id:C.id,type:"dimensions",dimensions:A}))}return N},[]);$E(l,p);const w=f||c&&!f&&FE(t,{initial:!0,...m});e({nodeInternals:new Map(l),fitViewOnInitDone:w}),S?.length>0&&i?.(S)},updateNodePositions:(r,i=!0,l=!1)=>{const{triggerNodeChanges:c}=t(),f=r.map(m=>{const h={id:m.id,type:"position",dragging:l};return i&&(h.positionAbsolute=m.positionAbsolute,h.position=m.position),h});c(f)},triggerNodeChanges:r=>{const{onNodesChange:i,nodeInternals:l,hasDefaultNodes:c,nodeOrigin:f,getNodes:m,elevateNodesOnSelect:h}=t();if(r?.length){if(c){const p=UE(r,m()),y=Np(p,l,f,h);e({nodeInternals:y})}i?.(r)}},addSelectedNodes:r=>{const{multiSelectionActive:i,edges:l,getNodes:c}=t();let f,m=null;i?f=r.map(h=>qr(h,!0)):(f=Sl(c(),r),m=Sl(l,[])),rd({changedNodes:f,changedEdges:m,get:t,set:e})},addSelectedEdges:r=>{const{multiSelectionActive:i,edges:l,getNodes:c}=t();let f,m=null;i?f=r.map(h=>qr(h,!0)):(f=Sl(l,r),m=Sl(c(),[])),rd({changedNodes:m,changedEdges:f,get:t,set:e})},unselectNodesAndEdges:({nodes:r,edges:i}={})=>{const{edges:l,getNodes:c}=t(),f=r||c(),m=i||l,h=f.map(y=>(y.selected=!1,qr(y.id,!1))),p=m.map(y=>qr(y.id,!1));rd({changedNodes:h,changedEdges:p,get:t,set:e})},setMinZoom:r=>{const{d3Zoom:i,maxZoom:l}=t();i?.scaleExtent([r,l]),e({minZoom:r})},setMaxZoom:r=>{const{d3Zoom:i,minZoom:l}=t();i?.scaleExtent([l,r]),e({maxZoom:r})},setTranslateExtent:r=>{t().d3Zoom?.translateExtent(r),e({translateExtent:r})},resetSelectedElements:()=>{const{edges:r,getNodes:i}=t(),c=i().filter(m=>m.selected).map(m=>qr(m.id,!1)),f=r.filter(m=>m.selected).map(m=>qr(m.id,!1));rd({changedNodes:c,changedEdges:f,get:t,set:e})},setNodeExtent:r=>{const{nodeInternals:i}=t();i.forEach(l=>{l.positionAbsolute=dg(l.position,r)}),e({nodeExtent:r,nodeInternals:new Map(i)})},panBy:r=>{const{transform:i,width:l,height:c,d3Zoom:f,d3Selection:m,translateExtent:h}=t();if(!f||!m||!r.x&&!r.y)return!1;const p=or.translate(i[0]+r.x,i[1]+r.y).scale(i[2]),y=[[0,0],[l,c]],g=f?.constrain()(p,y,h);return f.transform(m,g),i[0]!==g.x||i[1]!==g.y||i[2]!==g.k},cancelConnection:()=>e({connectionNodeId:$r.connectionNodeId,connectionHandleId:$r.connectionHandleId,connectionHandleType:$r.connectionHandleType,connectionStatus:$r.connectionStatus,connectionStartHandle:$r.connectionStartHandle,connectionEndHandle:$r.connectionEndHandle}),reset:()=>e({...$r})}),Object.is),JE=({children:e})=>{const t=u.useRef(null);return t.current||(t.current=w8()),De.createElement(q7,{value:t.current},e)};JE.displayName="ReactFlowProvider";const ej=({children:e})=>u.useContext(wf)?De.createElement(De.Fragment,null,e):De.createElement(JE,null,e);ej.displayName="ReactFlowWrapper";const N8={input:RE,default:my,output:DE,group:gg},E8={default:Yd,straight:hg,step:mg,smoothstep:Nf,simplebezier:fg},j8=[0,0],_8=[15,15],C8={x:0,y:0,zoom:1},A8={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},tj=u.forwardRef(({nodes:e,edges:t,defaultNodes:r,defaultEdges:i,className:l,nodeTypes:c=N8,edgeTypes:f=E8,onNodeClick:m,onEdgeClick:h,onInit:p,onMove:y,onMoveStart:g,onMoveEnd:v,onConnect:S,onConnectStart:w,onConnectEnd:N,onClickConnectStart:E,onClickConnectEnd:C,onNodeMouseEnter:A,onNodeMouseMove:O,onNodeMouseLeave:_,onNodeContextMenu:k,onNodeDoubleClick:D,onNodeDragStart:j,onNodeDrag:z,onNodeDragStop:P,onNodesDelete:G,onEdgesDelete:H,onSelectionChange:X,onSelectionDragStart:V,onSelectionDrag:R,onSelectionDragStop:B,onSelectionContextMenu:I,onSelectionStart:L,onSelectionEnd:$,connectionMode:M=ki.Strict,connectionLineType:U=Yr.Bezier,connectionLineStyle:T,connectionLineComponent:q,connectionLineContainerStyle:Y,deleteKeyCode:Q="Backspace",selectionKeyCode:oe="Shift",selectionOnDrag:Z=!1,selectionMode:de=vc.Full,panActivationKeyCode:J="Space",multiSelectionKeyCode:se=Hd()?"Meta":"Control",zoomActivationKeyCode:ne=Hd()?"Meta":"Control",snapToGrid:we=!1,snapGrid:Le=_8,onlyRenderVisibleElements:Me=!1,selectNodesOnDrag:Ae=!0,nodesDraggable:ot,nodesConnectable:ze,nodesFocusable:nt,nodeOrigin:$e=j8,edgesFocusable:vt,edgesUpdatable:_t,elementsSelectable:Tt,defaultViewport:Ct=C8,minZoom:Be=.5,maxZoom:at=2,translateExtent:fe=py,preventScrolling:ce=!0,nodeExtent:ye,defaultMarkerColor:Pe="#b1b1b7",zoomOnScroll:ee=!0,zoomOnPinch:pe=!0,panOnScroll:me=!1,panOnScrollSpeed:Se=.5,panOnScrollMode:Ge=Ai.Free,zoomOnDoubleClick:Xe=!0,panOnDrag:et=!0,onPaneClick:Te,onPaneMouseEnter:mt,onPaneMouseMove:Dt,onPaneMouseLeave:At,onPaneScroll:Ke,onPaneContextMenu:ct,children:Rt,onEdgeContextMenu:Ut,onEdgeDoubleClick:Qt,onEdgeMouseEnter:wt,onEdgeMouseMove:Ft,onEdgeMouseLeave:Ht,onEdgeUpdate:kt,onEdgeUpdateStart:te,onEdgeUpdateEnd:be,onReconnect:ve,onReconnectStart:Ue,onReconnectEnd:it,reconnectRadius:xt=10,edgeUpdaterRadius:ie=10,onNodesChange:_e,onEdgesChange:qe,noDragClassName:ht="nodrag",noWheelClassName:pt="nowheel",noPanClassName:Ee="nopan",fitView:st=!1,fitViewOptions:le,connectOnClick:Je=!0,attributionPosition:ut,proOptions:gt,defaultEdgeOptions:re,elevateNodesOnSelect:Ze=!0,elevateEdgesOnSelect:We=!1,disableKeyboardA11y:dt=!1,autoPanOnConnect:Qe=!0,autoPanOnNodeDrag:yt=!0,connectionRadius:ke=20,isValidConnection:Ve,onError:ft,style:K,id:ae,nodeDragThreshold:Ne,...He},bt)=>{const Nt=ae||"1";return De.createElement("div",{...He,style:{...K,...A8},ref:bt,className:da(["react-flow",l]),"data-testid":"rf__wrapper",id:ae},De.createElement(ej,null,De.createElement(S8,{onInit:p,onMove:y,onMoveStart:g,onMoveEnd:v,onNodeClick:m,onEdgeClick:h,onNodeMouseEnter:A,onNodeMouseMove:O,onNodeMouseLeave:_,onNodeContextMenu:k,onNodeDoubleClick:D,nodeTypes:c,edgeTypes:f,connectionLineType:U,connectionLineStyle:T,connectionLineComponent:q,connectionLineContainerStyle:Y,selectionKeyCode:oe,selectionOnDrag:Z,selectionMode:de,deleteKeyCode:Q,multiSelectionKeyCode:se,panActivationKeyCode:J,zoomActivationKeyCode:ne,onlyRenderVisibleElements:Me,selectNodesOnDrag:Ae,defaultViewport:Ct,translateExtent:fe,minZoom:Be,maxZoom:at,preventScrolling:ce,zoomOnScroll:ee,zoomOnPinch:pe,zoomOnDoubleClick:Xe,panOnScroll:me,panOnScrollSpeed:Se,panOnScrollMode:Ge,panOnDrag:et,onPaneClick:Te,onPaneMouseEnter:mt,onPaneMouseMove:Dt,onPaneMouseLeave:At,onPaneScroll:Ke,onPaneContextMenu:ct,onSelectionContextMenu:I,onSelectionStart:L,onSelectionEnd:$,onEdgeContextMenu:Ut,onEdgeDoubleClick:Qt,onEdgeMouseEnter:wt,onEdgeMouseMove:Ft,onEdgeMouseLeave:Ht,onReconnect:ve??kt,onReconnectStart:Ue??te,onReconnectEnd:it??be,reconnectRadius:xt??ie,defaultMarkerColor:Pe,noDragClassName:ht,noWheelClassName:pt,noPanClassName:Ee,elevateEdgesOnSelect:We,rfId:Nt,disableKeyboardA11y:dt,nodeOrigin:$e,nodeExtent:ye}),De.createElement(b6,{nodes:e,edges:t,defaultNodes:r,defaultEdges:i,onConnect:S,onConnectStart:w,onConnectEnd:N,onClickConnectStart:E,onClickConnectEnd:C,nodesDraggable:ot,nodesConnectable:ze,nodesFocusable:nt,edgesFocusable:vt,edgesUpdatable:_t,elementsSelectable:Tt,elevateNodesOnSelect:Ze,minZoom:Be,maxZoom:at,nodeExtent:ye,onNodesChange:_e,onEdgesChange:qe,snapToGrid:we,snapGrid:Le,connectionMode:M,translateExtent:fe,connectOnClick:Je,defaultEdgeOptions:re,fitView:st,fitViewOptions:le,onNodesDelete:G,onEdgesDelete:H,onNodeDragStart:j,onNodeDrag:z,onNodeDragStop:P,onSelectionDrag:R,onSelectionDragStart:V,onSelectionDragStop:B,noPanClassName:Ee,nodeOrigin:$e,rfId:Nt,autoPanOnConnect:Qe,autoPanOnNodeDrag:yt,onError:ft,connectionRadius:ke,isValidConnection:Ve,nodeDragThreshold:Ne}),De.createElement(y6,{onSelectionChange:X}),Rt,De.createElement(P7,{proOptions:gt,position:ut}),De.createElement(N6,{rfId:Nt,disableKeyboardA11y:dt})))});tj.displayName="ReactFlow";const T8=e=>e.domNode?.querySelector(".react-flow__edgelabel-renderer");function M8({children:e}){const t=In(T8);return t?Ec.createPortal(e,t):null}const nj=({id:e,x:t,y:r,width:i,height:l,style:c,color:f,strokeColor:m,strokeWidth:h,className:p,borderRadius:y,shapeRendering:g,onClick:v,selected:S})=>{const{background:w,backgroundColor:N}=c||{},E=f||w||N;return De.createElement("rect",{className:da(["react-flow__minimap-node",{selected:S},p]),x:t,y:r,rx:y,ry:y,width:i,height:l,fill:E,stroke:m,strokeWidth:h,shapeRendering:g,onClick:v?C=>v(C,e):void 0})};nj.displayName="MiniMapNode";var R8=u.memo(nj);const k8=e=>e.nodeOrigin,D8=e=>e.getNodes().filter(t=>!t.hidden&&t.width&&t.height),Cp=e=>e instanceof Function?e:()=>e;function I8({nodeStrokeColor:e="transparent",nodeColor:t="#e2e2e2",nodeClassName:r="",nodeBorderRadius:i=5,nodeStrokeWidth:l=2,nodeComponent:c=R8,onClick:f}){const m=In(D8,sa),h=In(k8),p=Cp(t),y=Cp(e),g=Cp(r),v=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return De.createElement(De.Fragment,null,m.map(S=>{const{x:w,y:N}=Mi(S,h).positionAbsolute;return De.createElement(c,{key:S.id,x:w,y:N,width:S.width,height:S.height,style:S.style,selected:S.selected,className:g(S),color:p(S),borderRadius:i,strokeColor:y(S),strokeWidth:l,shapeRendering:v,onClick:f,id:S.id})}))}var L8=u.memo(I8);const O8=200,z8=150,$8=e=>{const t=e.getNodes(),r={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:r,boundingRect:t.length>0?G7(Ef(t,e.nodeOrigin),r):r,rfId:e.rfId}},F8="react-flow__minimap-desc";function aj({style:e,className:t,nodeStrokeColor:r="transparent",nodeColor:i="#e2e2e2",nodeClassName:l="",nodeBorderRadius:c=5,nodeStrokeWidth:f=2,nodeComponent:m,maskColor:h="rgb(240, 240, 240, 0.6)",maskStrokeColor:p="none",maskStrokeWidth:y=1,position:g="bottom-right",onClick:v,onNodeClick:S,pannable:w=!1,zoomable:N=!1,ariaLabel:E="React Flow mini map",inversePan:C=!1,zoomStep:A=10,offsetScale:O=5}){const _=ta(),k=u.useRef(null),{boundingRect:D,viewBB:j,rfId:z}=In($8,sa),P=e?.width??O8,G=e?.height??z8,H=D.width/P,X=D.height/G,V=Math.max(H,X),R=V*P,B=V*G,I=O*V,L=D.x-(R-D.width)/2-I,$=D.y-(B-D.height)/2-I,M=R+I*2,U=B+I*2,T=`${F8}-${z}`,q=u.useRef(0);q.current=V,u.useEffect(()=>{if(k.current){const oe=ss(k.current),Z=se=>{const{transform:ne,d3Selection:we,d3Zoom:Le}=_.getState();if(se.sourceEvent.type!=="wheel"||!we||!Le)return;const Me=-se.sourceEvent.deltaY*(se.sourceEvent.deltaMode===1?.05:se.sourceEvent.deltaMode?1:.002)*A,Ae=ne[2]*Math.pow(2,Me);Le.scaleTo(we,Ae)},de=se=>{const{transform:ne,d3Selection:we,d3Zoom:Le,translateExtent:Me,width:Ae,height:ot}=_.getState();if(se.sourceEvent.type!=="mousemove"||!we||!Le)return;const ze=q.current*Math.max(1,ne[2])*(C?-1:1),nt={x:ne[0]-se.sourceEvent.movementX*ze,y:ne[1]-se.sourceEvent.movementY*ze},$e=[[0,0],[Ae,ot]],vt=or.translate(nt.x,nt.y).scale(ne[2]),_t=Le.constrain()(vt,$e,Me);Le.transform(we,_t)},J=cE().on("zoom",w?de:null).on("zoom.wheel",N?Z:null);return oe.call(J),()=>{oe.on("zoom",null)}}},[w,N,C,A]);const Y=v?oe=>{const Z=ys(oe);v(oe,{x:Z[0],y:Z[1]})}:void 0,Q=S?(oe,Z)=>{const de=_.getState().nodeInternals.get(Z);S(oe,de)}:void 0;return De.createElement(cg,{position:g,style:e,className:da(["react-flow__minimap",t]),"data-testid":"rf__minimap"},De.createElement("svg",{width:P,height:G,viewBox:`${L} ${$} ${M} ${U}`,role:"img","aria-labelledby":T,ref:k,onClick:Y},E&&De.createElement("title",{id:T},E),De.createElement(L8,{onClick:Q,nodeColor:i,nodeStrokeColor:r,nodeBorderRadius:c,nodeClassName:l,nodeStrokeWidth:f,nodeComponent:m}),De.createElement("path",{className:"react-flow__minimap-mask",d:`M${L-I},${$-I}h${M+I*2}v${U+I*2}h${-M-I*2}z
        M${j.x},${j.y}h${j.width}v${j.height}h${-j.width}z`,fill:h,fillRule:"evenodd",stroke:p,strokeWidth:y,pointerEvents:"none"})))}aj.displayName="MiniMap";var B8=u.memo(aj);function U8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},De.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function q8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},De.createElement("path",{d:"M0 0h32v4.2H0z"}))}function H8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},De.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function P8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},De.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function V8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},De.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const Jo=({children:e,className:t,...r})=>De.createElement("button",{type:"button",className:da(["react-flow__controls-button",t]),...r},e);Jo.displayName="ControlButton";const Y8=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),sj=({style:e,showZoom:t=!0,showFitView:r=!0,showInteractive:i=!0,fitViewOptions:l,onZoomIn:c,onZoomOut:f,onFitView:m,onInteractiveChange:h,className:p,children:y,position:g="bottom-left"})=>{const v=ta(),[S,w]=u.useState(!1),{isInteractive:N,minZoomReached:E,maxZoomReached:C}=In(Y8,sa),{zoomIn:A,zoomOut:O,fitView:_}=jf();if(u.useEffect(()=>{w(!0)},[]),!S)return null;const k=()=>{A(),c?.()},D=()=>{O(),f?.()},j=()=>{_(l),m?.()},z=()=>{v.setState({nodesDraggable:!N,nodesConnectable:!N,elementsSelectable:!N}),h?.(!N)};return De.createElement(cg,{className:da(["react-flow__controls",p]),position:g,style:e,"data-testid":"rf__controls"},t&&De.createElement(De.Fragment,null,De.createElement(Jo,{onClick:k,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:C},De.createElement(U8,null)),De.createElement(Jo,{onClick:D,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:E},De.createElement(q8,null))),r&&De.createElement(Jo,{className:"react-flow__controls-fitview",onClick:j,title:"fit view","aria-label":"fit view"},De.createElement(H8,null)),i&&De.createElement(Jo,{className:"react-flow__controls-interactive",onClick:z,title:"toggle interactivity","aria-label":"toggle interactivity"},N?De.createElement(V8,null):De.createElement(P8,null)),y)};sj.displayName="Controls";var G8=u.memo(sj),vs;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(vs||(vs={}));function X8({color:e,dimensions:t,lineWidth:r}){return De.createElement("path",{stroke:e,strokeWidth:r,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`})}function K8({color:e,radius:t}){return De.createElement("circle",{cx:t,cy:t,r:t,fill:e})}const W8={[vs.Dots]:"#91919a",[vs.Lines]:"#eee",[vs.Cross]:"#e2e2e2"},Z8={[vs.Dots]:1,[vs.Lines]:1,[vs.Cross]:6},Q8=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function rj({id:e,variant:t=vs.Dots,gap:r=20,size:i,lineWidth:l=1,offset:c=2,color:f,style:m,className:h}){const p=u.useRef(null),{transform:y,patternId:g}=In(Q8,sa),v=f||W8[t],S=i||Z8[t],w=t===vs.Dots,N=t===vs.Cross,E=Array.isArray(r)?r:[r,r],C=[E[0]*y[2]||1,E[1]*y[2]||1],A=S*y[2],O=N?[A,A]:C,_=w?[A/c,A/c]:[O[0]/c,O[1]/c];return De.createElement("svg",{className:da(["react-flow__background",h]),style:{...m,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:p,"data-testid":"rf__background"},De.createElement("pattern",{id:g+e,x:y[0]%C[0],y:y[1]%C[1],width:C[0],height:C[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${_[0]},-${_[1]})`},w?De.createElement(K8,{color:v,radius:A/c}):De.createElement(X8,{dimensions:O,color:v,lineWidth:l})),De.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${g+e})`}))}rj.displayName="Background";var J8=u.memo(rj);const ez=420,tz=520,nz=16,ld=(e,t,r)=>Math.min(Math.max(e,t),r),Ew=e=>e?.type?.name||e?.typeName||"Entity";function az({position:e,cluster:t,onClose:r,onAddToBoard:i,onReturnToGroup:l,onSetTargetEntity:c,onOpenEntityInfo:f,releasedEntityIds:m=[]}){const{label:h,relationshipType:p,entities:y=[],placedEntityIds:g=[],sourceId:v}=t||{},[S,w]=u.useState(null),[N,E]=u.useState(null),[C,A]=u.useState({x:e?.x??100,y:e?.y??100}),O=u.useRef(null),_=u.useRef(null),k=u.useCallback(()=>{const $=S?.parentElement;if($){const M=$.getBoundingClientRect();return{left:M.left,top:M.top,width:M.width,height:M.height}}return{left:0,top:0,width:window.innerWidth,height:window.innerHeight}},[S]),D=u.useMemo(()=>new Set((Array.isArray(g)?g:[]).map(String)),[g]),j=u.useMemo(()=>new Set((Array.isArray(m)?m:[]).map(String)),[m]),z=u.useMemo(()=>Array.isArray(y)?y.filter($=>!j.has(String($.id))):[],[y,j]),P=z.length,G=u.useMemo(()=>{const $=k(),M=O.current?.offsetWidth??ez,U=O.current?.offsetHeight??Math.min($.height*.7,tz),T=nz;return{minX:T,minY:T,maxX:Math.max(T,$.width-M-T),maxY:Math.max(T,$.height-U-T),containerRect:$,entityCount:P}},[P,k]);u.useEffect(()=>{const $=document.querySelector(".react-flow__renderer")||document.querySelector(".react-flow")||document.body,M=document.createElement("div");return M.style.position=$===document.body?"fixed":"absolute",M.style.top="0",M.style.left="0",M.style.right="0",M.style.bottom="0",M.style.zIndex="2500",M.style.pointerEvents="auto",$.appendChild(M),w(M),()=>$.removeChild(M)},[]),u.useEffect(()=>{A({x:ld(e?.x??100,G.minX,G.maxX),y:ld(e?.y??100,G.minY,G.maxY)})},[G,e?.x,e?.y]);const H=u.useCallback($=>{if(!_.current)return;const{offsetX:M,offsetY:U,bounds:T,containerRect:q}=_.current,Y=ld($.clientX-q.left-M,T.minX,T.maxX),Q=ld($.clientY-q.top-U,T.minY,T.maxY);A({x:Y,y:Q})},[]),X=u.useCallback(()=>{_.current=null,window.removeEventListener("pointermove",H),window.removeEventListener("pointerup",X),window.removeEventListener("pointercancel",X)},[H]),V=$=>{if($.button!==0||$.target.closest("button")||$.target.closest(".cluster-popup-entity"))return;$.preventDefault(),$.stopPropagation();const M=G,U=M.containerRect||k(),T=$.clientX-U.left-(C?.x??M.minX),q=$.clientY-U.top-(C?.y??M.minY);_.current={offsetX:T,offsetY:q,bounds:M,containerRect:U},window.addEventListener("pointermove",H),window.addEventListener("pointerup",X),window.addEventListener("pointercancel",X)};u.useEffect(()=>()=>X(),[X]);const R=u.useCallback(()=>{X(),r?.()},[X,r]);u.useEffect(()=>{const $=M=>M.key==="Escape"&&R();return document.addEventListener("keydown",$),()=>document.removeEventListener("keydown",$)},[R]),u.useEffect(()=>{E(null)},[t?.id]);const B=u.useCallback(($,M)=>{M||E(U=>U===$?null:$)},[]),I=u.useCallback($=>{$&&(j.has(String($))||(i?.(t,$),E(null)))},[t,i,j]),L=u.useCallback($=>{$&&(l?.(t,$),E(null))},[t,l]);return S?h1.createPortal(a.jsx("div",{className:"cluster-popup-overlay",children:a.jsxs("div",{ref:O,className:"cluster-popup-panel",style:{top:`${C?.y??100}px`,left:`${C?.x??100}px`},children:[a.jsxs("div",{className:"cluster-popup-header",onPointerDown:V,children:[a.jsxs("div",{className:"cluster-popup-title",children:[a.jsx("div",{className:"cluster-popup-relationship",children:p||"Cluster"}),a.jsx("div",{className:"cluster-popup-label",children:h||"Entities"})]}),a.jsx("button",{onClick:R,className:"cluster-popup-close","aria-label":"Close cluster",children:a.jsx("span",{"aria-hidden":"true",children:""})})]}),a.jsx("div",{className:"cluster-popup-instructions",children:"Use the action icons to set a relationship target, open entity details, or add and manage entities on the board."}),a.jsx("div",{className:"cluster-popup-entities",children:z.length?z.map($=>{const M=String($.id),U=D.has(M)||j.has(M),T=N===M,q=v!=null&&M===String(v);return a.jsxs("div",{className:`cluster-popup-entity ${U?"is-placed":""} ${T?"is-selected":""}`,title:$.name||`Entity ${$.id}`,onClick:()=>B(M,U),children:[a.jsx("div",{className:"cluster-popup-entity-header",children:a.jsx("div",{className:"cluster-popup-entity-name",children:$.name||`Entity ${$.id}`})}),a.jsx("div",{className:"cluster-popup-entity-meta",title:Ew($),children:Ew($)}),a.jsxs("div",{className:"cluster-popup-entity-actions",role:"group","aria-label":"Entity actions",children:[U?a.jsx("button",{type:"button",className:"cluster-popup-entity-action",onClick:Y=>{Y.stopPropagation(),L($)},onPointerDown:Y=>Y.stopPropagation(),"aria-label":"Recall entity to cluster",title:"Recall to cluster",disabled:!l,children:a.jsx(Il,{size:16,"aria-hidden":"true"})}):a.jsx("button",{type:"button",className:"cluster-popup-entity-action is-primary",onClick:Y=>{Y.stopPropagation(),I(M)},onPointerDown:Y=>Y.stopPropagation(),"aria-label":"Add entity to board",title:"Add to board",disabled:!i,children:a.jsx(Va,{size:16,"aria-hidden":"true"})}),a.jsx("button",{type:"button",className:"cluster-popup-entity-action",onClick:Y=>{Y.stopPropagation(),f?.(M)},onPointerDown:Y=>Y.stopPropagation(),"aria-label":"Open entity details",title:"Open details",disabled:!f,children:a.jsx(b1,{size:16,"aria-hidden":"true"})}),!q&&a.jsx("button",{type:"button",className:"cluster-popup-entity-action",onClick:Y=>{Y.stopPropagation(),c?.(M)},onPointerDown:Y=>Y.stopPropagation(),"aria-label":"Use as relationship source",title:"Set as source",disabled:!c,children:a.jsx(zy,{size:16,"aria-hidden":"true"})})]})]},$.id)}):a.jsx("div",{className:"cluster-popup-empty",children:"No entities in this cluster."})})]})}),S):null}function sz({id:e,data:t}){const[r,i]=u.useState(!1),[l,c]=u.useState({x:0,y:0}),[f,m]=u.useState([]);u.useEffect(()=>{const E=t?.containedIds||t?.data?.containedIds||[],C=t?.allNodes||t?.data?.allNodes||[];if(E.length&&C.length){const A=C.filter(O=>E.includes(O.id));m(A)}else m([])},[t]);const h=E=>{E.stopPropagation();const A=(document.querySelector(".react-flow__renderer")||document.querySelector(".react-flow"))?.getBoundingClientRect(),O=A?.width??window.innerWidth,_=A?.height??window.innerHeight,k=420,D=Math.min(_*.7,520),j=16,z=E.clientX-(A?.left??0),P=E.clientY-(A?.top??0);let G=z+j,H=P-D/2;const X=O-k-j,V=j;G>X&&(G=Math.max(V,z-k-j)),G=Math.max(V,Math.min(G,X));const R=_-D-j,B=j;H<B?H=B:H>R&&(H=R),c({x:G,y:H}),i(!0)},p=()=>i(!1),y=u.useMemo(()=>new Set((t?.placedEntityIds||[]).map(E=>String(E))),[t?.placedEntityIds]),g=f.length,v=t?.count??g+y.size,S=g,w=v?`contains ${S} of ${v}`:"contains 0 of 0",N=t?.relationshipType||t?.label||"Cluster";return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"cluster-node",onClick:h,children:[a.jsx(Qr,{id:"top",type:"target",position:qt.Top,style:{width:12,height:12,background:"#fcd34d",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(120, 53, 15, 0.2)"}}),a.jsx("div",{className:"cluster-node__header",children:a.jsx("div",{className:"cluster-node__badge",children:S})}),a.jsx("div",{className:"cluster-node__label",children:N}),a.jsx("div",{className:"cluster-node__count",children:w}),a.jsx(Qr,{id:"bottom",type:"source",position:qt.Bottom,style:{width:12,height:12,background:"#fcd34d",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(120, 53, 15, 0.2)"}})]}),r&&a.jsx(az,{position:l,cluster:{id:e,label:t?.label,entities:f,relationshipType:t?.relationshipType,sourceId:t?.sourceId,placedEntityIds:t?.placedEntityIds||[]},onClose:p,onAddToBoard:t?.onAddToBoard,onReturnToGroup:t?.onReturnToGroup,onSetTargetEntity:t?.onSetTargetEntity,onOpenEntityInfo:t?.onOpenEntityInfo,releasedEntityIds:t?.manuallyReleasedIds||[]})]})}function rz({data:e}){const t=!!e?.isCenter,r=e?.label||"Entity",i=e?.typeName||"Entity",l=e?.style||{},c=e?.entityId||e?.id,f=e?.imageUrl||zl(e?.entity),m=p=>{p?.preventDefault(),p?.stopPropagation(),!(!e?.onSetTarget||!c||t)&&e.onSetTarget(String(c))},h=p=>{p?.preventDefault(),p?.stopPropagation(),!(!e?.onOpenInfo||!c)&&e.onOpenInfo(String(c))};return a.jsxs("div",{className:`entity-node ${t?"entity-node--center":"entity-node--standard"}`,style:{...l},children:[a.jsx(Qr,{id:"top",type:"target",position:qt.Top,style:{width:12,height:12,background:"#cbd5f5",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(15, 23, 42, 0.25)"}}),t&&a.jsx("span",{className:"entity-node__center-indicator"}),a.jsxs("div",{className:"entity-node__content",children:[a.jsxs("div",{className:"entity-node__row entity-node__row--title",children:[f?a.jsx("div",{className:"entity-node__avatar","aria-hidden":"true",children:a.jsx("img",{src:f,alt:"",loading:"lazy"})}):null,a.jsx("div",{className:"entity-node__label",title:r,children:r})]}),a.jsxs("div",{className:"entity-node__row entity-node__row--meta",children:[a.jsx("div",{className:`entity-node__type-pill ${t?"is-center":""}`,children:i}),a.jsxs("div",{className:"entity-node__actions","aria-hidden":!e?.onSetTarget&&!e?.onOpenInfo,children:[a.jsx("button",{type:"button",className:"entity-node__action",onClick:m,onPointerDown:p=>p.stopPropagation(),"aria-label":"Use as relationship source",disabled:t||!e?.onSetTarget,children:a.jsx(zy,{size:16,strokeWidth:2.25,absoluteStrokeWidth:!0,"aria-hidden":"true"})}),a.jsx("button",{type:"button",className:"entity-node__action",onClick:h,onPointerDown:p=>p.stopPropagation(),"aria-label":"Open entity in new window",disabled:!e?.onOpenInfo,children:a.jsx(Oy,{size:16,strokeWidth:2.25,absoluteStrokeWidth:!0,"aria-hidden":"true"})})]})]})]}),a.jsx(Qr,{id:"bottom",type:"source",position:qt.Bottom,style:{width:12,height:12,background:"#cbd5f5",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(15, 23, 42, 0.25)"}})]})}const _f=220,vg=160,Tc=220,ij=120,xg=40,lj=5,ea="Related",iz=40,lz=120,Ho=Math.max(Tc,_f)+iz,oj=ij+lz,Gd=Tc+xg,yy=/(part of|owned by|managed by|works for|reports to|child of|belongs to|member of|subsidiary of|division of|child)/i,jw=/(owns|manages|contains|has member|employs|parent of|parent|oversees|supervises|leads)/i,cj=/(owns|contains|parent|manages|supervises|leads|employs|has member|has child)/i,oz=/(child of|belongs to|part of|owned by|managed by|reports to|works for)/i,cz=/\s*\(linked to source\)/gi;function wa(e,t){if(typeof e=="string"){const r=e.replace(cz,"").trim();if(r)return r}return t}function jd(e){if(!e)return!1;const t=e?.type;return t==="cluster"||t==="clusterNode"}function uz(e,t,r){if(!e||!t||!(r instanceof Map))return!1;let i=String(t);const l=String(e),c=new Set;for(;i&&!c.has(i);){if(c.add(i),i===l)return!0;const f=r.get(i)?.parentId;i=f!=null?String(f):null}return!1}function _w(e){if(!e)return null;const t=String(e.id??"");if(!t)return null;const r=wa(e?.name,`Entity ${t}`),i=e?.type?.name||e?.typeName||"Entity";return{...e,id:t,name:r,typeName:i}}function dz(e,t){if(!e)return{parentId:null,childId:null};const r=e?.fromEntityId!=null?String(e.fromEntityId):null,i=e?.toEntityId!=null?String(e.toEntityId):null,l=e?.relationshipType;let c=r&&i?r:null,f=r&&i?i:null;const m=l&&typeof l=="object"?l:null,h=(...A)=>{for(const O of A)if(O!=null&&O!=="")return O;return null},p=h(m?.from_label,m?.fromLabel,m?.from_name,m?.fromName),y=h(m?.to_label,m?.toLabel,m?.to_name,m?.toName),g=A=>typeof A=="string"&&yy.test(A),v=A=>typeof A=="string"&&jw.test(A),S=g(p),w=g(y),N=v(p),E=v(y);w&&!S?(c=i,f=r):S&&!w?(c=r,f=i):N&&!E?(c=i,f=r):E&&!N&&(c=r,f=i);const C=(()=>{if(!l)return"";if(typeof l=="string")return l.toLowerCase();const A=l?.label||l?.name||l?.from_label||l?.to_label||"";return String(A).toLowerCase()})();if(r&&i&&C){const A=/(parent|owns|contains)/.test(C);if(/(child|belongs to|part of)/.test(C)&&!A){const _=c;c=f,f=_}}return!c&&!f&&r&&i&&C&&(yy.test(C)?(c=i,f=r):jw.test(C)&&(c=r,f=i)),{parentId:c,childId:f}}function uj(e,t){if(!e)return null;const r=e?.from_entity??e?.fromEntityId??e?.from??e?.source??e?.sourceId??null,i=e?.to_entity??e?.toEntityId??e?.to??e?.target??e?.targetId??null,l=r!=null?String(r):null,c=i!=null?String(i):null;if(!l||!c||l===c)return null;const f=e?.id!=null&&e.id!==""?String(e.id):`edge-${l}-${c}`,m=e?.relationshipType??e?.type??e?.data?.relationshipType??null,h={fromEntityId:l,toEntityId:c,relationshipType:m},{parentId:p,childId:y}=dz(h),g=m&&typeof m=="object"?{id:m?.id??null,name:m?.name||m?.label||m?.from_label||m?.to_label||null,label:m?.label??null,from_label:m?.from_label??null,to_label:m?.to_label??null}:m,v=(()=>{if(!g)return e?.label||e?.typeName||e?.data?.typeName||ea;if(typeof g=="string")return g||ea;const{from_label:E,to_label:C,label:A,name:O}=g;return t!=null&&String(t)===l?E||A||O||ea:t!=null&&String(t)===c?C||A||O||ea:A||O||E||C||ea})(),S=String(v||ea).trim()||ea,w=!g||typeof g=="string"?(typeof g=="string"?g:null)||ea:g?.name||g?.label||g?.from_label||g?.to_label||ea,N=g&&typeof g=="object"?g?.id??null:null;return{id:f,source:p??l,target:y??c,parentId:p,childId:y,label:S,typeName:w??ea,typeId:N??null,fromEntityId:l,toEntityId:c,relationshipType:g??null,relationshipLabel:S,raw:e}}function fz(e,t,r=lj,i=null,l=1){const c=[],f=new Map,m=[],h=new Set,p=i!=null?String(i):null;if(!Array.isArray(t)||!t.length)return{clusters:c,suppressedNodes:f,edges:t||[]};const y=new Map((Array.isArray(e)?e:[]).map(j=>[String(j?.id??""),j])),g=new Map;p&&g.set(p,0),y.forEach((j,z)=>{const P=typeof j?.data?.level=="number"?j.data.level:typeof j?.level=="number"?j.level:null;P!=null&&Number.isFinite(P)&&g.set(z,P)});const v=new Map,S=new Map;t.forEach(j=>{if(!j)return;const z=j.parentId||j.source||null,P=j.childId||j.target||null;if(!z||!P)return;const G=String(z),H=String(P),X=y.get(G)||e.find(R=>String(R?.id??"")===G);!X||X.inCluster||(y.get(H)||e.find(R=>String(R?.id??"")===H))?.inCluster||(v.has(G)||v.set(G,new Set),v.get(G).add(H),S.has(H)||S.set(H,new Set),S.get(H).add(G))});const w=new Map;if(p){w.set(p,{parentId:null});const j=new Set,z=[p];for(;z.length;){const P=z.pop();if(!P||j.has(P))continue;j.add(P),w.has(P)||w.set(P,{parentId:null});const G=S.get(P);if(G&&G.size){const[H]=Array.from(G),X=H!=null?String(H):null;if(X){const V=w.get(P)||{};V.parentId?w.set(P,{...V}):w.set(P,{...V,parentId:X}),G.forEach(R=>{const B=R!=null?String(R):null;B&&(w.has(B)||w.set(B,{parentId:null}),j.has(B)||z.push(B))})}}}}const N=new Set(g.keys());if(p){N.add(p);const j=S.get(p);j&&j.forEach(z=>{g.has(z)||g.set(z,0),N.add(z)})}const E=Array.from(N),C=new Set(Array.from(N)),A=1e4;let O=0;for(;E.length&&O<A;){O+=1;const j=E.shift();if(!j)continue;C.has(j)||C.add(j);const z=g.get(j);if(z==null||!Number.isFinite(z))continue;const P=v.get(j);P&&P.forEach(G=>{if(C.has(G))return;const H=z+1,X=g.get(G);(X==null||H<X)&&(g.set(G,H),C.add(G),E.push(G))})}O>=A&&console.warn(`groupChildrenByRelationship: Reached maximum iteration limit (${A}), possible circular relationship detected`);const _=new Map;if(t.forEach(j=>{if(!j)return;const z=j.parentId||j.source||null,P=j.childId||j.target||null;if(!z||!P)return;const G=String(z),H=String(P);if(!G||!H||G===H)return;const X=y.get(G),V=y.get(H);if(X?.inCluster||V?.inCluster)return;const R=g.get(G)??0,B=g.get(H)??R+1;if(R>=l||B>l)return;const I=String(j.relationshipLabel||j.label||ea).trim()||ea,L=j.typeName&&String(j.typeName).trim()||(typeof j.relationshipType=="object"?String(j.relationshipType?.name||j.relationshipType?.label||j.relationshipType?.from_label||j.relationshipType?.to_label||"").trim():null)||null,$=j.typeId!=null?String(j.typeId):j.relationshipType&&typeof j.relationshipType=="object"&&j.relationshipType?.id!=null?String(j.relationshipType.id):null,M=L||$||"unknown-type",U=`${G}-${M}`;_.has(U)||_.set(U,{parentId:G,typeName:L,typeId:$,typeKey:M,relationshipLabel:I,childMap:new Map});const T=_.get(U);T.childMap.has(H)||T.childMap.set(H,[]),T.childMap.get(H).push(j)}),_.forEach(j=>{if(y.get(j.parentId)?.inCluster||e.find($=>String($?.id??"")===j.parentId)?.inCluster)return;const P=Array.from(j.childMap.keys()).filter($=>!y.get($)?.inCluster);if(P.length<r)return;const G=Nz(j.typeName||j.typeKey),H=`cluster-${j.parentId}-${G}`,X=g.get(j.parentId)??0,V=j.typeName||j.relationshipLabel||ea,R=P.filter($=>!y.get($)?.inCluster);if(!R.length)return;const B={id:H,parentId:j.parentId,relationshipType:V,typeName:j.typeName,typeId:j.typeId,containedIds:[...R],label:"",count:0,parentLevel:X},I=p&&B.containedIds.length?B.containedIds.filter($=>uz($,p,w)):[],L=new Set(I);I.length&&(B.containedIds=B.containedIds.filter($=>!L.has($)),I.forEach($=>{const M=y.get($)||null;M&&(M.isExpandedProtected=!0,M.inCluster&&(M.inCluster=!1));const U=e.find(T=>String(T?.id??"")===$);U&&U!==M&&(U.isExpandedProtected=!0,U.inCluster&&(U.inCluster=!1))})),B.containedIds.length&&(B.containedIds.forEach($=>{const M=e.find(U=>String(U?.id??"")===$)||y.get($);M&&(M.inCluster=!0)}),B.count=B.containedIds.length,B.label=`${V} (${B.count})`,c.push(B),R.forEach($=>{if(L.has($))return;const M=y.get($)||e.find(T=>String(T?.id??"")===$)||null;if(M?.isExpandedProtected){M.inCluster=!1;return}f.set($,{clusterId:B.id,parentId:j.parentId,relationshipType:V,typeName:j.typeName,typeId:j.typeId,entity:M}),M&&(M.inCluster=!0),(j.childMap.get($)||[]).forEach(T=>h.add(T.id))}),m.push({id:`edge-${j.parentId}-${B.id}`,source:j.parentId,target:B.id,label:B.label,parentId:j.parentId,childId:B.id,relationshipLabel:V,relationshipType:V,typeName:j.typeName,typeId:j.typeId,isClusterEdge:!0}))}),!c.length)return{clusters:c,suppressedNodes:f,edges:t};const D=[...t.filter(j=>{if(!j||h.has(j.id))return!1;const z=String(j.target??j.childId??"");if(z&&f.has(z))return!1;const P=String(j.source??j.parentId??"");return!(P&&f.has(P))}),...m];return{clusters:c,suppressedNodes:f,edges:D}}function mz(e,{isCenter:t=!1}={}){const r=String(e.id),i=wa(e?.name,`Entity ${r}`),l=e?.typeName||"Entity",c=!!e?.isExpandedProtected,f=zl(e);return{id:r,type:"entity",width:Tc,height:ij,isExpandedProtected:c,position:{x:0,y:0},data:{label:i,typeName:l,entityId:r,isCenter:t,isExpandedProtected:c,imageUrl:f}}}function hz(e,t){const r=e.relationshipType||ea,i=e.label||r,l=e.count??(Array.isArray(e.containedIds)?e.containedIds.length:0),c=typeof e.parentLevel=="number"&&Number.isFinite(e.parentLevel)?e.parentLevel:null;return{id:e.id,type:"cluster",width:_f,height:vg,position:{x:0,y:0},data:{label:i,relationshipType:r,containedIds:e.containedIds,count:l,sourceId:e.parentId,placedEntityIds:[],allNodes:t,parentLevel:c}}}function pz(e,t,r){const i=r!=null?String(r):null;t.forEach(l=>{if(!l)return;const c=String(l.id);e.has(c)||e.set(c,c===i?0:1)}),i&&e.set(i,0),e.forEach((l,c)=>{(typeof l!="number"||!Number.isFinite(l))&&e.set(c,c===i?0:1)})}function yz(e,t){let r=1/0;t.forEach(m=>{if(!m)return;const h=e.get(m.id);typeof h=="number"&&Number.isFinite(h)&&h<r&&(r=h)}),Number.isFinite(r)||(r=0);const i=new Map,l=new Map;t.forEach(m=>{if(!m)return;const p=(e.get(m.id)??0)-r;l.set(m.id,p),i.has(p)||i.set(p,[]),i.get(p).push(m)});const c=Array.from(i.keys()).sort((m,h)=>m-h),f=new Map;return c.forEach(m=>{const h=i.get(m)||[];h.sort((p,y)=>{const g=p?.data?.label||p.id,v=y?.data?.label||y.id;return g.localeCompare(v)}),f.set(m,h)}),{groups:f,visualLevels:l}}function gy(e){if(!e)return"";const t=typeof e?.data?.label=="string"?e.data.label.trim():"";if(t)return t;const r=typeof e?.name=="string"?e.name.trim():"";return r||(e?.id!=null?String(e.id):"")}function dj(e,t){const r=gy(e),i=gy(t);return r.localeCompare(i)}function gz(e,t,r,i={}){const{centerId:l=null}=i,c=l!=null?String(l):null,f=new Map;e.forEach(h=>{if(!h)return;const p=h?.parentId??h?.data?.parentId??h?.source??h?.data?.source??null,y=h?.childId??h?.data?.childId??h?.target??h?.data?.target??null,g=p!=null?String(p):null,v=y!=null?String(y):null;if(!g||!v||g===v)return;const S=h?.label??h?.relationshipLabel??"",w=S||fj(h),N=S||Sz(h),E=sr(w)||sr(N)||sr(S),C=!!w&&(xz(w)||cj.test(w)),A={parentId:g,relationshipKey:E,relationshipName:N,indicatesParental:C};f.has(v)||f.set(v,[]),f.get(v).push(A)});const m=new Map;return f.forEach((h,p)=>{let y=null,g=1/0,v="",S=null,w="",N="";h.forEach(E=>{if(!E)return;const C=E.parentId,A=t.get(C);if(typeof A!="number"||!Number.isFinite(A))return;const O=r.get(C),_=gy(O);if(y==null||A<g){y=C,g=A,v=_,S=E,w=sr(E?.relationshipKey),N=E?.relationshipName??"";return}if(A===g){const k=!!S?.indicatesParental;if(!!E?.indicatesParental&&!k){y=C,v=_,S=E,w=sr(E?.relationshipKey),N=E?.relationshipName??"";return}_.localeCompare(v)<0&&(y=C,v=_,S=E,w=sr(E?.relationshipKey),N=E?.relationshipName??"")}}),y!=null&&m.set(p,{parentId:y,relationshipKey:w,relationshipName:N,indicatesParental:!!S?.indicatesParental})}),r.forEach((h,p)=>{if(!h)return;const y=String(p);if(!y||m.has(y)||!jd(h))return;const g=[h.parentId,h.data?.parentId,h.data?.sourceId,h.data?.source].map(w=>w!=null?String(w):null).filter(Boolean);let v=g.find(w=>r.has(w));!v&&g.length&&(v=g[0]);const S=t.get(y)??1/0;if(!v){const w=Array.isArray(h?.data?.containedIds)?h.data.containedIds.map(N=>N!=null?String(N):null).filter(N=>{if(!N||!r.has(N))return!1;const E=t.get(N);return typeof E=="number"&&Number.isFinite(E)&&E<S}):[];w.length&&(w.sort((N,E)=>{const C=t.get(N)??1/0,A=t.get(E)??1/0;return C===A?N.localeCompare(E):C-A}),v=w[0])}if(!v&&c&&r.has(c)&&(v=c===y?null:c),v){const w=[typeof h?.data?.relationshipType=="string"?h.data.relationshipType:null,typeof h?.relationshipType=="string"?h.relationshipType:null].filter(C=>typeof C=="string"&&C.trim()),N=w.length?w[0].trim():"",E=sr(N);m.set(y,{parentId:v,relationshipKey:E,relationshipName:N})}}),m}function by(e,t){if(!e||!t)return null;const r=e.get(t);return r?typeof r=="string"?{parentId:r,relationshipKey:"",relationshipName:""}:typeof r=="object"?{parentId:r?.parentId!=null?String(r.parentId):r?.sourceId!=null?String(r.sourceId):null,relationshipKey:sr(r?.relationshipKey),relationshipName:typeof r?.relationshipName=="string"?r.relationshipName:""}:null:null}function bz(e){return(t,r)=>{if(!t&&!r)return 0;if(!t)return 1;if(!r)return-1;const i=by(e,t.id),l=by(e,r.id),c=i?.relationshipKey||"",f=l?.relationshipKey||"";if(c&&f){const m=c.localeCompare(f);if(m!==0)return m}else{if(c)return-1;if(f)return 1}return dj(t,r)}}function vz(e,t=new Map){const r=new Map;let i=1/0;const l=0,c=Array.from(e.keys()).sort((p,y)=>p-y);let f=0;c.forEach(p=>{const y=e.get(p)||[];if(!y.length)return;const g=new Map,v=[];y.forEach(C=>{const A=by(t,C.id),O=A?.parentId??null,_=O?r.get(O):null;if(O&&_){const k=A?.relationshipKey||sr(A?.relationshipName)||"no-relationship";g.has(O)||g.set(O,{anchorX:_.x,relationshipGroups:new Map});const D=g.get(O);D.relationshipGroups.has(k)||D.relationshipGroups.set(k,[]),D.relationshipGroups.get(k).push(C)}else v.push(C)});const S=bz(t);g.forEach(C=>{C.relationshipGroups.forEach((A,O)=>{A.sort(S)})});const w=l+p*oj;let N=-1/0;if(Array.from(g.keys()).sort((C,A)=>{const O=g.get(C),_=g.get(A);return(O?.anchorX??0)-(_?.anchorX??0)}).forEach(C=>{const A=g.get(C);if(!A)return;const O=Array.from(A.relationshipGroups.keys()).sort(),_=[];if(O.forEach(j=>{const z=A.relationshipGroups.get(j)||[];_.push(...z)}),_.length===0)return;const k=(_.length-1)*Ho,D=A.anchorX-k/2;_.forEach((j,z)=>{const P=D+z*Ho;r.set(j.id,{x:P,y:w,level:p,levelIndex:f}),f+=1,P<i&&(i=P),P>N&&(N=P)})}),v.length){v.sort(dj);const C=(v.length-1)*Ho,A=N!==-1/0?N+Ho:-C/2;v.forEach((O,_)=>{const k=A+_*Ho;r.set(O.id,{x:k,y:w,level:p,levelIndex:f}),f+=1,k<i&&(i=k),k>N&&(N=k)})}});const m=Number.isFinite(i)&&i<0?-i:0,h=new Map;return m>0?r.forEach((p,y)=>{h.set(y,{x:p.x+m,y:p.y,level:p.level,levelIndex:p.levelIndex})}):r.forEach((p,y)=>{h.set(y,p)}),h}function xz(e){return e?yy.test(String(e)):!1}function fj(e){if(!e)return"";const t=e?.data?.relationshipType??e?.relationshipType??e?.data?.relationshipLabel??e?.relationshipLabel??e?.data?.label??e?.label??e?.data?.typeName??e?.typeName??"";if(typeof t=="string")return t.toLowerCase().trim();if(t&&typeof t=="object"){const r=t?.label??t?.name??t?.from_label??t?.to_label??"";if(typeof r=="string")return r.toLowerCase().trim()}return""}function Sz(e){if(!e)return"";const t=e?.data?.relationshipType??e?.relationshipType??e?.data?.relationshipLabel??e?.relationshipLabel??e?.data?.label??e?.label??e?.data?.typeName??e?.typeName??"";if(typeof t=="string")return t.trim();if(t&&typeof t=="object"){const r=t?.label??t?.name??t?.from_label??t?.to_label??"";if(typeof r=="string")return r.trim()}return""}function sr(e){if(typeof e=="string"){const t=e.trim();return t?t.toLowerCase():""}return""}function wz(e,t){const r=new Map;if(!e)return r;const i=String(e);r.set(i,0);const l=new Map,c=new Map;t.forEach(y=>{if(!y)return;const g=y?.parentId??y?.data?.parentId??y?.source??null,v=y?.childId??y?.data?.childId??y?.target??null,S=g!=null?String(g):null,w=v!=null?String(v):null;!S||!w||S===w||(l.has(S)||l.set(S,new Set),l.get(S).add(w),c.has(w)||c.set(w,new Set),c.get(w).add(S))});const f=[i],m=new Set([i]),h=1e4;let p=0;for(;f.length&&p<h;){p+=1;const y=f.shift();if(!y)continue;m.has(y)||m.add(y);const g=r.get(y)??0,v=c.get(y);v&&v.forEach(w=>{const N=w!=null?String(w):null;if(!N||m.has(N))return;const E=g-1,C=r.get(N);(C==null||E<C)&&(r.set(N,E),m.add(N),f.push(N))});const S=l.get(y);S&&S.forEach(w=>{const N=w!=null?String(w):null;if(!N||m.has(N))return;const E=g+1,C=r.get(N);(C==null||E<C)&&(r.set(N,E),m.add(N),f.push(N))})}return p>=h&&console.warn(`buildLevelsFromEdges: Reached maximum iteration limit (${h}), possible circular relationship detected`),r}function ec(e,t,r){const i=Array.isArray(e)?e.map(_=>({..._,id:String(_.id),data:{..._.data}})):[];if(!i.length)return e;const l=i.filter(_=>jd(_)),c=i.filter(_=>!jd(_)),f=c.filter(_=>!_.inCluster),m=f.length?f:c,h=new Map;m.forEach(_=>h.set(_.id,_)),l.forEach(_=>h.set(_.id,_));const p=Array.from(h.values());if(!p.length)return e;const y=r!=null?String(r):p[0]?.id??null;if(!y)return e;const g=new Set(p.map(_=>_.id)),S=(Array.isArray(t)?t.map((_,k)=>{if(!_)return null;const D=_?.source!=null?String(_.source):"",j=_?.target!=null?String(_.target):"";if(!D||!j||D===j)return null;const z=_?.data?.relationshipType||_?.data?.typeName||_?.label||"",P=_?.data?.parentId??_?.parentId??_?.data?.parent??null,G=_?.data?.childId??_?.childId??null,H=P!=null?String(P):null,X=G!=null?String(G):null;return{id:_?.id!=null?String(_.id):`edge-${k}`,source:D,target:j,label:_?.label||z||ea,data:{relationshipType:z||ea,parentId:H,childId:X},parentId:H,childId:X}}).filter(Boolean):[]).map(_=>{if(!_)return null;const k={..._,data:{..._.data||{}}},D=k.source||"",j=k.target||"";if(!D||!j||D===j)return null;let z=k.parentId!=null?String(k.parentId):null,P=k.childId!=null?String(k.childId):null;if(!z||!P){let G=D,H=j;const X=fj(k),V=X&&cj.test(X);if(X&&oz.test(X)&&!V){const B=G;G=H,H=B}z=z??G,P=P??H}return(!z||!P||z===P)&&(z=D,P=j),k.source=z,k.target=P,k.parentId=z,k.childId=P,k.data={...k.data,parentId:z,childId:P},k}).filter(Boolean).filter(_=>g.has(_.source)&&g.has(_.target)),w=wz(y,S);pz(w,p,y),p.forEach(_=>{if(!_||!jd(_))return;const k=_.parentId??_.data?.parentId??_.data?.sourceId??_.data?.source??null;if(!k)return;const D=String(k),j=w.get(D)??0;w.set(_.id,j+1)});const{groups:N,visualLevels:E}=yz(w,p),C=new Map(p.map(_=>[_.id,_])),A=gz(S,w,C,{centerId:y}),O=vz(N,A);return i.map(_=>{const k=w.get(_.id)??0,D=E.get(_.id)??k,j={x:_?.position?.x??0,y:D*oj,level:D,levelIndex:_?.data?.levelIndex??0},z=O.get(_.id)||j;return{..._,position:{x:z.x,y:z.y},data:{..._.data,level:k,visualLevel:z.level??D,levelIndex:z.levelIndex}}})}function Nz(e){return String(e??"group").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function Ez(e){return Array.from(e.values()).map(t=>({id:t.id,name:t.name,typeName:t.typeName,isExpandedProtected:!!t.isExpandedProtected}))}function jz(e){const t=new Map;return Array.isArray(e)&&e.forEach(r=>{if(!r||r.isClusterEdge||r?.data?.isClusterEdge||r?.data?.isClusterChildEdge)return;const i=r?.parentId??r?.source??null,l=r?.childId??r?.target??null;if(i==null||l==null)return;const c=String(i),f=String(l);f&&(t.has(f)||t.set(f,new Set),t.get(f).add(c))}),t}function _z({centerId:e=null,parentLookup:t=new Map,suppressedIds:r=new Set,candidateIds:i=new Set,alwaysIncludeIds:l=new Set}){const c=new Map,f=e!=null?String(e):null,m=new Set(l instanceof Set?Array.from(l).map(String):Array.isArray(l)?l.map(p=>String(p)):[]);function h(p,y=new Set){const g=String(p);if(!g)return!1;if(c.has(g))return c.get(g);if(r.has(g)||!i.has(g)&&!m.has(g))return c.set(g,!1),!1;if(f&&g===f||m.has(g))return c.set(g,!0),!0;const v=t.get(g);if(!v||v.size===0)return c.set(g,!0),!0;if(y.has(g))return c.set(g,!1),!1;y.add(g);let S=!1;for(const w of v){const N=String(w);if(N&&!r.has(N)){if(!i.has(N)&&!m.has(N)){S=!0;continue}if(m.has(N)){S=!0;continue}h(N,y)&&(S=!0)}}return y.delete(g),S?(c.set(g,!0),!0):(c.set(g,!1),!1)}return h}function Cz(e,t,r=lj,i={}){const l=t!=null?String(t):null,c=Array.isArray(e?.nodes)?e.nodes:[],f=Array.isArray(e?.edges)?e.edges:[],m=new Map;if(c.forEach(Z=>{const de=_w(Z);de&&m.set(de.id,de)}),!l)return{nodes:[],edges:[],suppressedNodes:new Map,clusters:[]};if(!m.has(l)){const Z=_w(c[0]);Z?m.set(l,{...Z,id:l}):m.set(l,{id:l,name:`Entity ${l}`,typeName:"Entity"})}const h=f.map(Z=>uj(Z,l)).filter(Boolean),p=Array.from(m.values()),y=i?.alwaysIncludeIds,g=new Set(y instanceof Set?Array.from(y).map(String):Array.isArray(y)?y.map(Z=>String(Z)):y&&typeof y=="object"?Object.values(y).map(Z=>String(Z)):[]),{clusters:v,suppressedNodes:S,edges:w}=fz(p,h,r,l),N=Ez(m),E=S instanceof Map?S:new Map(Object.entries(S||{}).map(([Z,de])=>[String(Z),de])),C=new Map;E.forEach((Z,de)=>{const J=String(de),se=Z?.clusterId!=null?String(Z.clusterId):null,ne=Z?.parentId!=null?String(Z.parentId):null,we=Z?.relationshipType||ea,Le=Z?.entity||m.get(J)||null;C.set(J,{clusterId:se,parentId:ne,relationshipType:we,entity:Le?{...Le,id:J,name:wa(Le?.name,`Entity ${J}`),typeName:Le?.typeName||Le?.type?.name||"Entity",isExpandedProtected:!!Le?.isExpandedProtected}:null})}),g.forEach(Z=>{C.delete(String(Z))});const A=new Set(Array.from(C.keys())),O=(Array.isArray(v)?v:[]).map(Z=>hz(Z,N)),k=p.map(Z=>mz(Z,{isCenter:Z.id===l})).filter(Z=>!A.has(String(Z.id))),D=new Set(k.map(Z=>String(Z.id)));l!=null&&D.add(String(l)),g.forEach(Z=>{D.add(String(Z))});const j=jz(h),z=_z({centerId:l,parentLookup:j,suppressedIds:A,candidateIds:D,alwaysIncludeIds:g}),P=k.filter(Z=>z(String(Z.id))),G=new Set(P.map(Z=>String(Z.id))),X=[...P.filter(Z=>{const de=String(Z.id);if(!de)return!1;const J=j.get(de);if(!J||!J.size)return!0;for(const se of J){const ne=se!=null?String(se):"";if(ne&&G.has(ne))return!0}return!1}),...O],V=new Set(X.map(Z=>String(Z.id))),R=h.filter(Z=>{if(!Z)return!1;const de=Z.parentId!=null?Z.parentId:Z.source!=null?Z.source:null;if(de==null)return!0;const J=String(de);return!(!V.has(J)||A.has(J))}),I=(Array.isArray(w)&&w.length?w:R).filter(Z=>{if(!Z)return!1;if(Z.isClusterEdge)return!0;const de=Z.parentId!=null?Z.parentId:Z.source!=null?Z.source:null;if(de!=null){const Le=String(de);if(!V.has(Le)||A.has(Le))return!1}const J=Z.source!=null?Z.source:Z.parentId!=null?Z.parentId:null,se=Z.target!=null?Z.target:Z.childId!=null?Z.childId:null,ne=J!=null?String(J):"",we=se!=null?String(se):"";return!(ne&&A.has(ne)||we&&A.has(we))}),L=new Set;I.forEach(Z=>{const de=Z.source!=null?String(Z.source):Z.parentId!=null?String(Z.parentId):null,J=Z.target!=null?String(Z.target):Z.childId!=null?String(Z.childId):null;de&&L.add(de),J&&L.add(J)}),l&&L.add(l);const $=X.filter(Z=>L.has(String(Z.id))),M=new Set(l!=null?[String(l)]:[]);let U=!0;for(;U;){U=!1;for(const Z of I){if(!Z)continue;const de=Z.parentId!=null?Z.parentId:Z.source!=null?Z.source:null,J=Z.childId!=null?Z.childId:Z.target!=null?Z.target:null,se=de!=null?String(de):"",ne=J!=null?String(J):"",we=!!se,Le=!!ne;we&&M.has(se)&&Le&&!M.has(ne)&&(M.add(ne),U=!0),Le&&M.has(ne)&&we&&!M.has(se)&&(M.add(se),U=!0)}}const T=$.filter(Z=>M.has(String(Z.id))),Y=I.filter(Z=>{const de=Z.parentId!=null?String(Z.parentId):String(Z.source??""),J=Z.childId!=null?String(Z.childId):String(Z.target??"");return de&&J&&M.has(de)&&M.has(J)}).map(Z=>({id:Z.id,source:Z.source,target:Z.target,type:"smoothstep",animated:!Z.isClusterEdge,label:Z.label||Z.relationshipLabel||ea,data:{relationshipType:Z.relationshipLabel||Z.label||ea,parentId:Z.parentId??null,childId:Z.childId??null,isClusterEdge:!!Z.isClusterEdge},parentId:Z.parentId??null,childId:Z.childId??null,sourceHandle:"bottom",targetHandle:"top"})),Q=ec(T,Y,l),oe=Q.filter(Z=>Z.type==="cluster");return{nodes:Q,edges:Y,suppressedNodes:C,clusters:oe}}function Az(e,t,r=[]){if(!e||!t)return null;const i=e?.position?.x??0,l=e?.position?.y??0,c=e?.width??_f,f=e?.height??vg,m=String(t.id),h=zl(t),p=Array.isArray(r)?r.map(C=>String(C)):[],y=p.indexOf(m),g=Math.max(p.length-1,0)*Gd,v=i+c/2,S=v-g/2,w=Tc,N=y>=0?S+y*Gd-w/2:v-w/2,E=l+f+xg;return{id:m,type:"entity",position:{x:N,y:E},data:{label:wa(t.name,`Entity ${m}`),typeName:t?.type?.name||t?.typeName||"Entity",isCenter:!1,isAdHoc:!0,entityId:m,imageUrl:h}}}function od(e,t,r=[]){if(!t||!Array.isArray(r)||r.length===0)return e;const i=r.map(N=>String(N)),l=new Map(i.map((N,E)=>[N,E])),c=t?.position?.x??0,f=t?.position?.y??0,m=t?.width??_f,h=t?.height??vg,p=f+h+xg,y=(i.length-1)*Gd,v=c+m/2-y/2;let S=!1;const w=e.map(N=>{if(N.type!=="entity"||!N.data?.isAdHoc)return N;const E=l.get(String(N.id));if(E==null)return N;const C=N?.width??Tc,A=v+E*Gd-C/2,O=p;return N?.position?.x===A&&N?.position?.y===O?N:(S=!0,{...N,position:{x:A,y:O}})});return S?w:e}function Tz(e,t){return uj(e,t)}function mj({onRefocus:e,onZoomToFit:t,onAutoArrange:r,depth:i,onIncreaseDepth:l,onDecreaseDepth:c,style:f}){return a.jsxs("div",{className:`relationship-toolbar ${f?.compact?"relationship-toolbar--compact":""}`,role:"toolbar","aria-label":"Relationship viewer controls",style:f,children:[a.jsxs("div",{className:"relationship-toolbar__actions",children:[a.jsxs("button",{type:"button",className:"relationship-toolbar__button",onClick:e,children:[a.jsx(zy,{"aria-hidden":"true"}),a.jsx("span",{children:"Refocus"})]}),a.jsxs("button",{type:"button",className:"relationship-toolbar__button",onClick:t,children:[a.jsx(UT,{"aria-hidden":"true"}),a.jsx("span",{children:"Zoom to fit"})]}),a.jsxs("button",{type:"button",className:"relationship-toolbar__button",onClick:r,children:[a.jsx(MM,{"aria-hidden":"true"}),a.jsx("span",{children:"Auto arrange"})]})]}),a.jsxs("div",{className:"relationship-toolbar__levels","aria-label":"Relationship depth controls",children:[a.jsx("span",{className:"relationship-toolbar__levels-label",children:"Levels"}),a.jsxs("div",{className:"relationship-toolbar__levels-controls",children:[a.jsx("button",{type:"button",className:"relationship-toolbar__levels-button",onClick:l,disabled:i>=3,"aria-label":"Increase relationship depth",children:a.jsx(Va,{"aria-hidden":"true"})}),a.jsx("span",{className:"relationship-toolbar__levels-value","aria-live":"polite",children:i}),a.jsx("button",{type:"button",className:"relationship-toolbar__levels-button",onClick:c,disabled:i<=1,"aria-label":"Decrease relationship depth",children:a.jsx(w1,{"aria-hidden":"true"})})]})]})]})}mj.propTypes={onRefocus:on.func.isRequired,onZoomToFit:on.func.isRequired,onAutoArrange:on.func.isRequired,depth:on.number.isRequired,onIncreaseDepth:on.func.isRequired,onDecreaseDepth:on.func.isRequired};function Mz({id:e,source:t,target:r,data:i,markerEnd:l,style:c,selected:f}){const{getNode:m}=jf(),h=m(t),p=m(r);if(!h||!p)return null;const y=h.width??200,g=h.height??80,v=p.width??200;p.height;const S=h.positionAbsolute?.x??h.position?.x??0,w=h.positionAbsolute?.y??h.position?.y??0,N=p.positionAbsolute?.x??p.position?.x??0,E=p.positionAbsolute?.y??p.position?.y??0,C=S+y/2,A=w+g,O=N+v/2,_=E,[k]=Vd({sourceX:C,sourceY:A,sourcePosition:"bottom",targetX:O,targetY:_,targetPosition:"top"}),D=-18,j=O,z=_+D,P=i?.relationshipType||i?.label||"Related";return a.jsxs(a.Fragment,{children:[a.jsx(Fl,{id:e,path:k,markerEnd:l,style:c,selected:f}),a.jsx(M8,{children:a.jsx("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${j}px,${z}px)`,fontSize:12,pointerEvents:"all",background:"rgba(255, 255, 255, 0.9)",padding:"2px 6px",borderRadius:"4px",border:"1px solid #e2e8f0",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.1)",whiteSpace:"nowrap",zIndex:10},className:"nodrag nopan",children:P})})]})}const Rz={cluster:sz,entity:rz},kz={smoothstep:Mz},Dz="Related";function Iz(e){const t=new Map;return Array.isArray(e)&&e.forEach(r=>{if(!r)return;const i=r?.parentId!=null?r.parentId:r?.source!=null?r.source:null,l=r?.childId!=null?r.childId:r?.target!=null?r.target:null;if(i==null||l==null)return;const c=String(i),f=String(l);!c||!f||c===f||(t.has(c)||t.set(c,[]),t.get(c).push(r))}),t}function Lz(e,t){const r=new Map;if(!e)return r;const i=String(e);if(!i)return r;r.set(i,0);const l=[i],c=new Set([i]),f=1e4;let m=0;for(;l.length&&m<f;){m+=1;const h=l.shift();if(!h)continue;const p=r.get(h)??0,y=t.get(h);!y||!y.length||y.forEach(g=>{if(!g)return;const v=g?.childId!=null?g.childId:g?.target!=null?g.target:null,S=v!=null?String(v):null;!S||c.has(S)||S===h||(r.set(S,p+1),c.add(S),l.push(S))})}return m>=f&&console.warn(`computeDepthLookup: Reached maximum iteration limit (${f}), possible circular relationship detected`),r}function Oz(e){const t=new Map;return Array.isArray(e)&&e.forEach(r=>{if(!r)return;const i=r?.parentId!=null?r.parentId:r?.source!=null?r.source:null,l=r?.childId!=null?r.childId:r?.target!=null?r.target:null;if(i==null||l==null)return;const c=String(i),f=String(l);!c||!f||c===f||(t.has(f)||t.set(f,new Set),t.get(f).add(c))}),t}function zz(e,t,r=null){const i=e!=null?String(e):null;if(!i)return new Set;const l=Oz(t);if(!l.size)return new Set;const c=new Set,f=[],m=new Map,h=l.get(i);for(h&&h.size&&h.forEach(p=>{const y=String(p);y&&(c.add(y),f.push(y),m.set(y,1))});f.length;){const p=f.shift();if(!p)continue;const y=m.get(p)??1;if(r!=null&&y>=r)continue;const g=l.get(p);!g||!g.size||g.forEach(v=>{const S=String(v);if(!S||S===p||c.has(S))return;const w=y+1;r!=null&&w>r||(c.add(S),m.set(S,w),f.push(S))})}return c}function Cw(e){if(!e)return null;const t=e?.parentId!=null?e.parentId:e?.source!=null?e.source:null,r=e?.childId!=null?e.childId:e?.target!=null?e.target:null,i=t!=null?String(t):null,l=r!=null?String(r):null;if(!i||!l||i===l)return null;const c=e?.relationshipLabel||e?.label||e?.typeName||Dz;return{id:e?.id!=null&&e.id!==""?String(e.id):`edge-${i}-${l}`,source:i,target:l,type:"smoothstep",animated:!e?.isClusterEdge,label:c,data:{relationshipType:c,parentId:i,childId:l,isClusterEdge:!!e?.isClusterEdge},parentId:i,childId:l,sourceHandle:"bottom",targetHandle:"top"}}function $z(){const{entityId:e}=ws(),t=$n(),[r,i]=u.useState(!0),[l,c]=u.useState(null),[f,m]=u.useState([]),[h,p]=u.useState([]),[y,g]=u.useState({}),[v,S]=u.useState(null),[w,N]=u.useState(1),E=u.useRef(null),C=u.useRef(null),[A,O]=u.useState(null),[_,k]=u.useState(null),[D,j]=u.useState(null),[z,P]=u.useState(!1),[G,H]=u.useState([]),[X,V]=u.useState([]),R=u.useRef(new Map),B=u.useRef(new Map),I=u.useRef(new Map),L=u.useRef(new Set),$=u.useRef([]),M=u.useRef([]),U=u.useRef([]),T=u.useRef(new Map),q=u.useRef(new Set),Y=u.useRef(null),Q=u.useRef(new Map),oe=u.useRef(new Map),Z=u.useRef(null),de=u.useMemo(()=>Rz,[]),J=u.useMemo(()=>kz,[]),se=u.useCallback(ee=>{if(!Array.isArray(ee)||!ee.length)return ee;const pe=T.current;if(!(pe instanceof Map)||!pe.size)return ee;let me=!1;const Se=ee.map(Ge=>{if(!Ge||!(Ge.type==="entity"||Ge.type==="cluster"))return Ge;const et=pe.get(String(Ge.id));return et?(me=!0,{...Ge,position:{x:et.x,y:et.y},positionAbsolute:{x:et.x,y:et.y}}):Ge});return me?Se:ee},[]);u.useEffect(()=>{$.current=f},[f]),u.useEffect(()=>{M.current=h},[h]),u.useEffect(()=>()=>{Z.current!=null&&(clearTimeout(Z.current),Z.current=null)},[]),u.useEffect(()=>{const ee=e!=null?String(e):null;if(ee&&Y.current!==ee){Y.current=ee,T.current=new Map,q.current=new Set,g({});return}ee||(Y.current=null,T.current=new Map,q.current=new Set,g({}))},[e]),u.useEffect(()=>{if(!A){k(null),j(null),P(!1),H([]),V([]);return}let ee=!1;return(async()=>{P(!0),j(null),k(null);try{const me=await cr(A);if(ee)return;const Se=Pa(me);k(Se||null)}catch(me){if(ee)return;console.error("Failed to load entity info:",me),k(null),j(me.message||"Failed to load entity info")}finally{ee||P(!1)}})(),()=>{ee=!0}},[A]);const ne=u.useMemo(()=>_&&(_.entity_type_id||_.entityType?.id||_.entity_type?.id)||null,[_]);u.useEffect(()=>{if(!ne){H([]),V([]);return}let ee=!1;return(async()=>{try{const[me,Se]=await Promise.all([cf(ne).catch(Ge=>(console.error(" Failed to load drawer field order",Ge),null)),uf(ne).catch(Ge=>(console.error(" Failed to load drawer field rules",Ge),null))]);if(ee)return;H(Zr(me)),V(Zr(Se))}catch(me){if(ee)return;console.error(" Failed to load drawer field layout",me),H([]),V([])}})(),()=>{ee=!0}},[ne]);const we=u.useCallback(ee=>m(pe=>UE(ee,pe)),[]),Le=u.useCallback(ee=>p(pe=>z6(ee,pe)),[]),Me=u.useCallback(ee=>{ee&&t(`/entities/${ee}/relationship-viewer`)},[t]),Ae=u.useCallback(ee=>{if(!ee)return;const pe=String(ee);O(me=>me===pe?me:pe)},[]),ot=u.useCallback(()=>{O(null),k(null),j(null),P(!1)},[]),ze=u.useCallback(ee=>{ee&&L.current.delete(String(ee))},[]),nt=u.useCallback(ee=>{ee&&L.current.add(String(ee))},[]),$e=u.useCallback(ee=>{if(!ee)return new Map;const pe=String(ee),me=Array.isArray(M.current)?M.current:[],Se=new Map,Ge=[pe],Xe=new Set;for(;Ge.length;){const et=Ge.pop();!et||Xe.has(et)||(Xe.add(et),me.forEach(Te=>{if(!Te||Te?.data?.isClusterEdge||Te?.data?.isClusterChildEdge)return;const mt=Te?.parentId??Te?.data?.parentId??Te?.source??null,Dt=Te?.childId??Te?.data?.childId??Te?.target??null;if(mt==null||Dt==null)return;const At=String(mt);if(At!==et)return;const Ke=String(Dt);if(!(!Ke||Ke===pe)){if(!Se.has(Ke)){const ct=Te?.data?.relationshipType||Te?.relationshipLabel||Te?.label||"Related";Se.set(Ke,{parentId:At,relationshipType:ct})}Xe.has(Ke)||Ge.push(Ke)}}))}return Se},[]),vt=u.useCallback((ee,pe)=>{if(ee==null||pe==null)return;const me=String(ee);if(!me)return;const Se=oe.current instanceof Map?oe.current:null;!Se||q.current.has(me)&&Se.has(me)||Se.set(me,pe)},[]),_t=u.useCallback((ee,pe)=>{if(!ee)return;const me=String(typeof ee=="string"?ee:ee?.id??ee?.data?.id??ee);if(!me)return;const Se=$.current.find(Ee=>String(Ee.id)===me&&Ee.type==="cluster");if(!Se)return;const Ge=q.current,et=U.current.find(Ee=>String(Ee.id)===me)||{id:me,relationshipType:Se?.data?.relationshipType||Se?.data?.label||"Related",label:Se?.data?.label||Se?.data?.relationshipType||"Related",containedIds:(Se?.data?.containedIds||[]).map(Ee=>String(Ee)).filter(Ee=>!Ge.has(Ee)),parentId:Se?.data?.sourceId!=null?String(Se.data.sourceId):null},Te=R.current,mt=I.current,Dt=B.current;if(!(Te instanceof Map)||!(mt instanceof Map))return;const At=pe??(typeof ee=="object"&&ee?.entityId!=null?ee.entityId:null),Ke=At!=null?String(At):null;if(Ke&&Ge.has(Ke))return;const ct=new Map;Array.isArray($.current)&&$.current.forEach(Ee=>{if(!Ee||Ee.type&&Ee.type!=="entity")return;const st=String(Ee.id);st&&ct.set(st,Ee)}),mt instanceof Map&&mt.forEach((Ee,st)=>{if(!Ee)return;const le=String(st);le&&ct.set(le,Ee)}),(Array.isArray(Se?.data?.allNodes)?Se.data.allNodes:[]).forEach(Ee=>{if(!Ee||Ee?.type&&Ee.type!=="entity")return;const st=Ee?.id!=null?String(Ee.id):null;if(!st||ct.has(st))return;const le=Ee?.data||{},Je=le?.label||Ee?.name||le?.name||`Entity ${st}`,ut={id:st,type:Ee?.type||"entity",position:Ee?.position||{x:0,y:0},data:{...le,label:wa(Je,`Entity ${st}`),typeName:le?.typeName||le?.type?.name||Ee?.typeName||Ee?.type&&Ee?.type.name||"Entity",entityId:le?.entityId!=null?String(le.entityId):st,isAdHoc:le?.isAdHoc!=null?!!le.isAdHoc:!0,isExpandedProtected:!!le?.isExpandedProtected}};ct.set(st,ut)});let Ut=Ke?[Ke].filter(Ee=>Te.has(Ee)):[];if(Ut.length===0&&Ke&&(Ut=[String(Ke)]),!Ut.length)if(Ke){const Ee=String(Ke);Te.delete(Ee),mt.delete(Ee),Dt instanceof Map&&Dt.delete(Ee),q.current.add(Ee)}else{ze(me);return}const Qt=Ut.map(Ee=>{const st=String(Ee);return{id:st,definition:mt.get(st)||ct.get(st)||null,meta:Dt.get(st)||Te.get(st)||null}}).filter(Ee=>{if(!Ee?.definition)return!1;const st=Ee?.id!=null?String(Ee.id):null;return st?!Ge.has(st):!1});if(!Qt.length){Ke||ze(me);return}const wt=et.parentId!=null?String(et.parentId):null,Ft=new Set($.current.map(Ee=>String(Ee.id))),Ht=Qt.filter(({id:Ee,meta:st})=>{const le=Ee!=null?String(Ee):null;if(le&&Ge.has(le))return!1;const Je=st?.parentId!=null?String(st.parentId):wt;return wt&&Je!==wt?!1:Je?Te.has(Je)?!1:Ft.has(Je):!0});if(!Ht.length)return;Ht.forEach(({id:Ee})=>{const st=String(Ee);st&&Ge.add(st)});const kt=et.relationshipType||et.label||"Related",te=[...M.current];Ht.forEach(({id:Ee})=>{Te.delete(String(Ee))});const be=[],ve=[],Ue=Q.current instanceof Map?Q.current:new Map,it=oe.current instanceof Map?oe.current:new Map,xt=Number.isFinite(Number(w))?Number(w):null;if(Ue.size){const Ee=B.current instanceof Map?B.current:new Map,st=new Set(Array.isArray($.current)?$.current.map(Qe=>String(Qe.id)):[]),le=new Set,Je=new Set;Ht.forEach(({id:Qe})=>{if(!Qe)return;const yt=String(Qe);st.add(yt),le.add(yt)});const ut=Ht.map(({id:Qe})=>String(Qe)),gt=new Set,re=new Set,Ze=new Set,We=1e4;let dt=0;if(!(it instanceof Map)){console.warn("Depth lookup not properly initialized, skipping relationship extension");return}try{for(;ut.length&&dt<We;){dt+=1;const Qe=ut.shift();if(!Qe||gt.has(Qe))continue;if(Ze.has(Qe)){console.warn(`Circular reference detected for entity ${Qe}, skipping`);continue}gt.add(Qe),Ze.add(Qe);const yt=typeof it.get=="function"?it.get(Qe)??0:0;if(xt!=null&&yt!=null&&Number.isFinite(yt)&&yt>=xt){Ze.delete(Qe);continue}if(!(Ue instanceof Map)||typeof Ue.get!="function"){Ze.delete(Qe);continue}const ke=Ue.get(Qe);if(!Array.isArray(ke)||!ke.length){Ze.delete(Qe);continue}ke.forEach(Ve=>{if(Ve)try{const ft=Ve?.childId!=null?Ve.childId:Ve?.target!=null?Ve.target:null,K=ft!=null?String(ft):null;if(!K||K===Qe)return;const ae=Number.isFinite(yt)?yt+1:1;if(xt!=null&&Number.isFinite(xt)&&ae>xt)return;if(st.has(K))vt(K,ae),le.has(K)&&!gt.has(K)&&!Ze.has(K)&&ut.push(K);else if(!Je.has(K)){let Ne=null;if(Te.has(K)){if(!(mt instanceof Map)||typeof mt.get!="function")return;const He=mt.get(K);if(!He)return;Te.delete(K),mt.delete(K),Ee instanceof Map&&Ee.delete(K),Ge.add(K),Ne=He}else{if(!(ct instanceof Map)||typeof ct.get!="function")return;const He=ct.get(K);if(!He)return;const bt=He?.data?.label||He?.data?.name||`Entity ${K}`;Ne={...He,id:String(K),type:He.type||"entity",position:He.position||{x:0,y:0},data:{...He?.data||{},label:wa(bt,`Entity ${K}`),typeName:He?.data?.typeName||He?.data?.type?.name||"Entity",entityId:He?.data?.entityId!=null?String(He.data.entityId):String(K),isAdHoc:He?.data?.isAdHoc!=null?!!He.data.isAdHoc:!0,isExpandedProtected:!!He?.data?.isExpandedProtected}}}Ne&&(be.push({id:K,definition:Ne}),Je.add(K),st.add(K),le.add(K),!gt.has(K)&&!Ze.has(K)&&ut.push(K),vt(K,ae),ct.set(K,Ne))}vt(K,ae);try{const Ne=Cw(Ve);Ne&&!re.has(Ne.id)&&(re.add(Ne.id),ve.push(Ne))}catch(Ne){console.warn("Failed to convert edge to ReactFlow format:",Ne)}}catch(ft){console.warn(`Error processing edge for entity ${Qe}:`,ft)}}),Ze.delete(Qe)}dt>=We&&console.warn(`Relationship extension reached maximum iteration limit (${We}), stopping to prevent infinite loop`)}catch(Qe){console.error("Error during relationship extension traversal:",Qe)}if(ve.length){const Qe=new Set(te.map(yt=>yt.id));ve.forEach(yt=>{!yt||Qe.has(yt.id)||(Qe.add(yt.id),te.push(yt))})}}const ie=et.containedIds.filter(Ee=>{const st=String(Ee);return Ge.has(st)?!1:Te.has(st)});g(Ee=>{const st={...Ee};let le=!1;return Ht.forEach(({id:Je})=>{st[Je]||(st[Je]={clusterId:et.id,relationshipType:et.relationshipType||null,sourceId:et.parentId||null},le=!0)}),le?st:Ee}),ve.length&&p(Ee=>{const st=new Set(Ee.map(Je=>Je.id)),le=ve.filter(Je=>!st.has(Je.id));return le.length?[...Ee,...le]:Ee}),m(Ee=>{const st=Ee.find(Qe=>String(Qe.id)===me&&Qe.type==="cluster");if(!st)return Ee;const le=new Set(Ee.map(Qe=>String(Qe.id)));let Je=Ee,ut=!1;const gt=new Set((st.data?.placedEntityIds||[]).map(Qe=>String(Qe)));Ht.forEach(({id:Qe,definition:yt,meta:ke})=>{const Ve=String(Qe);if(gt.add(Ve),le.has(Ve))return;const ft=ke?.entity||{id:Qe,name:yt?.data?.label||`Entity ${Qe}`,typeName:yt?.data?.typeName||yt?.data?.type?.name||"Entity",isExpandedProtected:!!yt?.data?.isExpandedProtected},K=Az(st,ft,Array.from(gt))||yt;if(!K)return;const ae=wa(K.data?.label,`Entity ${Qe}`),Ne=wa(ft?.name,ae),He={...K,id:String(Qe),type:"entity",data:{...K.data,label:Ne,typeName:ft?.typeName||K.data?.typeName||"Entity",entityId:String(Qe),isAdHoc:!0,onSetTarget:Me,onOpenInfo:Ae,isExpandedProtected:!!ft?.isExpandedProtected}};le.add(Ve),ut=!0,Je=[...Je,He];const bt=`cluster-context-${me}-${Ve}`;if(!M.current.find(jt=>jt.id===bt)){const jt={id:bt,source:me,target:Ve,type:"smoothstep",animated:!1,label:"",style:{stroke:"#bbb",strokeDasharray:"4 2"},data:{isClusterContext:!0,parentId:me,childId:Ve},sourceHandle:"bottom",targetHandle:"top"};M.current.push(jt),p(It=>[...It,jt])}}),be.forEach(({id:Qe,definition:yt})=>{if(!Qe||le.has(String(Qe)))return;const ke={...yt,id:String(Qe),type:"entity",data:{...yt?.data,label:yt?.data?.label||yt?.data?.name||`Entity ${Qe}`,typeName:yt?.data?.typeName||yt?.data?.type?.name||"Entity",entityId:String(Qe),isAdHoc:!0,onSetTarget:Me,onOpenInfo:Ae,isExpandedProtected:!!yt?.data?.isExpandedProtected}};le.add(String(Qe)),ut=!0,Je=[...Je,ke]});const re=Array.from(gt),Ze=`${kt} (${ie.length})`;let We=Je.map(Qe=>String(Qe.id)!==me||Qe.type!=="cluster"?Qe:{...Qe,data:{...Qe.data,placedEntityIds:re,manuallyReleasedIds:re,label:Ze}});const dt=We.find(Qe=>String(Qe.id)===me&&Qe.type==="cluster")||st;return We=od(We,dt,re),!ut&&!Ee.some(yt=>String(yt.id)!==me||yt.type!=="cluster"?!1:yt.data?.label!==Ze)?Ee:se(ec(We,te))});const _e=`${kt} (${ie.length})`;et.label=_e,U.current=U.current.map(Ee=>String(Ee.id)===me?{...Ee,label:_e}:Ee);const qe=Ee=>{if(!Array.isArray(Ee)||!Ee.length)return[];const st=Q.current instanceof Map?Q.current:new Map,le=oe.current instanceof Map?oe.current:new Map,Je=q.current,ut=R.current instanceof Map?R.current:null,gt=I.current instanceof Map?I.current:null,re=B.current instanceof Map?B.current:null;if(!gt)return[];const Ze=Number.isFinite(Number(w))?Number(w):null,We=new Set(M.current.map(Ve=>String(Ve.id))),dt=[],Qe=[],yt=new Map,ke=new Set;if(Ee.forEach(Ve=>{const ft=Ve!=null?String(Ve):null;if(!ft||!(st instanceof Map)||typeof st.get!="function"||!(le instanceof Map)||typeof le.get!="function")return;const K=st.get(ft)||[];if(!Array.isArray(K))return;const ae=le.get(ft),Ne=Number.isFinite(ae)?ae+1:null;K.forEach(He=>{if(He)try{const bt=He?.childId!=null?He.childId:He?.target!=null?He.target:null,Nt=bt!=null?String(bt):null;if(!Nt||Nt===ft||Je.has(Nt))return;try{const va=Cw(He);va&&!We.has(va.id)&&(We.add(va.id),dt.push(va))}catch(va){console.warn(`Failed to convert edge to ReactFlow format for parent ${ft}:`,va)}if(!(Ze==null||Ne!=null&&Ne<=Ze)||!(gt instanceof Map)||typeof gt.has!="function"||!gt.has(Nt))return;const It=gt.get(Nt);if(!It)return;const tn=re&&re.get(Nt)||ut&&ut.get(Nt)||null;gt.delete(Nt),ut&&ut.delete(Nt),re&&re.delete(Nt);const un=Je.has(Nt);Je.add(Nt),Ne!=null&&(!un||!(le instanceof Map)||!le.has(Nt))&&vt(Nt,Ne);const Kt=tn?.entity||null,na=wa(It?.data?.label,wa(It?.data?.name,`Entity ${Nt}`)),ba=wa(Kt?.name,na),$s={...It,id:Nt,type:"entity",data:{...It?.data,label:ba,typeName:Kt?.typeName||It?.data?.typeName||It?.data?.type?.name||"Entity",entityId:Nt,isAdHoc:!0,onSetTarget:Me,onOpenInfo:Ae,isExpandedProtected:!!(Kt?.isExpandedProtected??It?.data?.isExpandedProtected)}};Qe.push($s),ke.add(Nt),tn?.clusterId&&yt.set(Nt,{clusterId:String(tn.clusterId),relationshipType:tn?.relationshipType||null,sourceId:tn?.parentId!=null?String(tn.parentId):null})}catch(bt){console.warn(`Error processing edge for parent ${ft} child ${childId}:`,bt)}})}),dt.length){const Ve=dt.filter(Boolean);Ve.length&&(M.current=[...M.current,...Ve],p(ft=>[...ft,...Ve]))}return Qe.length&&m(Ve=>{const ft=new Set(Ve.map(He=>String(He.id))),K=Qe.filter(He=>{const bt=He?.id!=null?String(He.id):null;return!bt||ft.has(bt)?!1:(ft.add(bt),!0)});if(!K.length)return Ve;const ae=[...Ve,...K],Ne=ec(ae,M.current);return se(Ne)}),yt.size&&g(Ve=>{const ft={...Ve};let K=!1;return yt.forEach((ae,Ne)=>{const He=ft[Ne];(!He||He.clusterId!==ae.clusterId||He.relationshipType!==ae.relationshipType||He.sourceId!==ae.sourceId)&&(ft[Ne]=ae,K=!0)}),K?ft:Ve}),Array.from(ke)},ht=new Set,pt=[...Ht.map(({id:Ee})=>String(Ee)),...be.map(({id:Ee})=>String(Ee))].filter(Boolean);for(;pt.length;){const Ee=[];for(;pt.length;){const le=pt.shift();!le||ht.has(le)||Ee.push(le)}if(!Ee.length)break;const st=qe(Ee);Ee.forEach(le=>ht.add(le)),st.forEach(le=>{ht.has(le)||pt.push(le)})}},[se,Ae,Me,vt,ze,w]),Tt=u.useCallback((ee,pe)=>{if(!ee||!pe)return;const me=String(pe.id),Se=String(ee.id);if(pe?.isExpandedProtected||$.current.some(wt=>String(wt?.id)===me&&wt?.data?.isExpandedProtected))return;const Xe=new Map($.current.map(wt=>[String(wt.id),wt])),et=$e(me),mt=Array.from(et.entries()).map(([wt])=>String(wt)).filter(wt=>{if(wt===me)return!1;const Ft=Xe.get(wt);return!(!Ft||Ft?.data?.isExpandedProtected)}),Dt=new Set(mt);q.current.delete(me),T.current.delete(me),mt.forEach(wt=>{q.current.delete(String(wt)),T.current.delete(String(wt))}),g(wt=>{const Ft={...wt};let Ht=!1;return Ft[me]&&(delete Ft[me],Ht=!0),mt.forEach(kt=>{Ft[kt]&&(delete Ft[kt],Ht=!0)}),Ht?Ft:wt});let At=[];m(wt=>{const Ft=wt.find(ve=>ve.id===ee.id);let kt=wt.filter(ve=>{const Ue=String(ve.id);return Ue===me&&ve.type==="entity"?!ve.data?.isAdHoc:Dt.has(Ue)&&ve.type==="entity"?!!ve.data?.isExpandedProtected:!0}).map(ve=>{if(ve.id!==ee.id||ve.type!=="cluster")return ve;const Ue=new Set((ve.data?.placedEntityIds||[]).map(String));return Ue.has(me)?(Ue.delete(me),{...ve,data:{...ve.data,placedEntityIds:Array.from(Ue),manuallyReleasedIds:Array.from(Ue)}}):ve});const te=kt.find(ve=>ve.id===ee.id&&ve.type==="cluster"),be=te?.data?.placedEntityIds?.map(ve=>String(ve))||[];return At=be,se(od(kt,te||Ft,be))}),p(wt=>{const Ft=new Set([me,...mt]);return wt.filter(Ht=>{const kt=Ht?.source!=null?String(Ht.source):Ht?.parentId!=null?String(Ht.parentId):null,te=Ht?.target!=null?String(Ht.target):Ht?.childId!=null?String(Ht.childId):null;return!(kt&&Ft.has(kt)||te&&Ft.has(te))})});const Ke=ee.relationshipType||ee.label||"Related",ct=wa(pe?.name,`Entity ${me}`),Rt={clusterId:Se,parentId:ee.sourceId?String(ee.sourceId):null,relationshipType:Ke,entity:{id:me,name:ct,typeName:pe?.typeName||pe?.type?.name||"Entity",type:pe?.type}};R.current.set(me,Rt),B.current.set(me,Rt),I.current.set(me,{id:me,type:"entity",position:{x:0,y:0},data:{label:ct,typeName:pe?.typeName||pe?.type?.name||"Entity",entityId:me,isAdHoc:!0,isExpandedProtected:!!pe?.isExpandedProtected}});const Ut=U.current.find(wt=>wt.id===Se);if(Ut){const wt=q.current,Ft=ee.containedIds.filter(kt=>{const te=String(kt);return wt.has(te)?!1:R.current.has(te)}),Ht=`${Ut.relationshipType||ee.relationshipType||"Related"} (${Ft.length})`;Ut.label=Ht,U.current=U.current.map(kt=>kt.id===Se?{...kt,label:Ht}:kt),m(kt=>kt.map(te=>String(te.id)!==Se||te.type!=="cluster"?te:{...te,data:{...te.data,label:Ht}}))}At.length?ze(Se):nt(Se);const Qt=Array.isArray(U.current)?U.current:[];mt.forEach(wt=>{const Ft=Xe.get(wt);if(!Ft)return;const Ht=et.get(wt)||{},kt=Ht?.parentId!=null?String(Ht.parentId):null,te=Ht?.relationshipType||"Related",be=Qt.find(Ue=>{if(!Ue)return!1;const it=Ue?.parentId!=null?String(Ue.parentId):null;return it&&kt&&it!==kt?!1:Array.isArray(Ue?.containedIds)?Ue.containedIds.some(xt=>String(xt)===String(wt)):!1}),ve={clusterId:be?String(be.id):null,parentId:kt,relationshipType:te,entity:{id:String(wt),name:Ft?.data?.label||`Entity ${wt}`,typeName:Ft?.data?.typeName||Ft?.data?.type?.name||"Entity",type:Ft?.data?.type||null,isExpandedProtected:!!Ft?.data?.isExpandedProtected}};R.current.set(String(wt),ve),B.current.set(String(wt),ve),I.current.set(String(wt),{id:String(wt),type:"entity",position:{x:0,y:0},data:{label:Ft?.data?.label||`Entity ${wt}`,typeName:Ft?.data?.typeName||Ft?.data?.type?.name||"Entity",entityId:String(wt),isAdHoc:!0,isExpandedProtected:!!Ft?.data?.isExpandedProtected}})})},[se,$e,nt,ze]),Ct=u.useCallback(ee=>{if(!ee)return;const pe=String(typeof ee=="string"?ee:ee?.id??ee?.data?.id??ee);if(!pe)return;const me=U.current.find(At=>String(At.id)===pe);if(!me)return;const Se=R.current,Ge=B.current,Xe=me.containedIds.filter(At=>$.current.some(Ke=>String(Ke.id)===String(At)));if(!Xe.length){nt(pe);return}Xe.forEach(At=>{const Ke=String(At);q.current.delete(Ke),T.current.delete(Ke);const ct=$.current.find(Ut=>String(Ut.id)===Ke);ct?.type==="entity"&&I.current.set(Ke,{id:Ke,type:"entity",position:{x:0,y:0},data:{label:ct.data?.label||`Entity ${Ke}`,typeName:ct.data?.typeName||"Entity",entityId:Ke,isAdHoc:!0,isExpandedProtected:!!ct.data?.isExpandedProtected}});const Rt=Ge.get(Ke)||{clusterId:pe,parentId:me.parentId||null,relationshipType:me.relationshipType||me.label||"Related",entity:ct?.data?{id:Ke,name:ct.data?.label||`Entity ${Ke}`,typeName:ct.data?.typeName||"Entity",isExpandedProtected:!!ct.data?.isExpandedProtected}:I.current.get(Ke)?.data?{id:Ke,name:I.current.get(Ke)?.data?.label||`Entity ${Ke}`,typeName:I.current.get(Ke)?.data?.typeName||"Entity",isExpandedProtected:!!I.current.get(Ke)?.data?.isExpandedProtected}:null};Se.set(Ke,Rt),Ge.set(Ke,Rt)});const et=M.current.filter(At=>{const Ke=String(At.source),ct=String(At.target);return!Xe.includes(Ke)&&!Xe.includes(ct)});p(et),g(At=>{const Ke={...At};let ct=!1;return Xe.forEach(Rt=>{Ke[Rt]&&(delete Ke[Rt],ct=!0)}),ct?Ke:At});const Te=q.current,mt=me.containedIds.filter(At=>{const Ke=String(At);return Te.has(Ke)?!1:Se.has(Ke)}),Dt=`${me.relationshipType||me.label||"Related"} (${mt.length})`;me.label=Dt,U.current=U.current.map(At=>String(At.id)===pe?{...At,label:Dt}:At),m(At=>{const ct=At.filter(Rt=>!Xe.includes(String(Rt.id))).map(Rt=>String(Rt.id)!==pe||Rt.type!=="cluster"?Rt:{...Rt,data:{...Rt.data,placedEntityIds:me.containedIds.filter(Ut=>{const Qt=String(Ut);return Te.has(Qt)?!1:!Se.has(Qt)}).map(Ut=>String(Ut)),manuallyReleasedIds:me.containedIds.filter(Ut=>{const Qt=String(Ut);return Te.has(Qt)?!1:!Se.has(Qt)}).map(Ut=>String(Ut)),label:Dt}});return se(ec(ct,et))}),nt(pe)},[se,nt]),Be=u.useCallback((ee,pe)=>{if(!pe||pe.type!=="entity"&&pe.type!=="cluster")return;const me=String(pe.id);if(T.current.set(me,{x:pe?.position?.x??0,y:pe?.position?.y??0}),pe.type!=="entity")return;const Se=me,Ge=y[Se];if(!Ge?.clusterId)return;const Xe=document.querySelector(`[data-id="${Ge.clusterId}"]`),et=document.querySelector(`[data-id="${Se}"]`);if(!Xe||!et)return;const Te=Xe.getBoundingClientRect(),mt=et.getBoundingClientRect(),Dt=mt.left+mt.width/2,At=mt.top+mt.height/2;if(!(Dt>=Te.left&&Dt<=Te.right&&At>=Te.top&&At<=Te.bottom))return;const ct=f.find(Rt=>Rt.id===Ge.clusterId);ct&&(pe?.data?.isExpandedProtected||Tt({id:ct.id,relationshipType:ct.data?.relationshipType,sourceId:ct.data?.sourceId,placedEntityIds:ct.data?.placedEntityIds||[]},{id:Se,name:pe?.data?.label,typeName:pe?.data?.typeName,isExpandedProtected:!!pe?.data?.isExpandedProtected}))},[y,Tt,f]);u.useEffect(()=>{m(ee=>{const pe=Object.entries(y).reduce((Se,[Ge,Xe])=>{const et=Xe?.clusterId;if(!et)return Se;const Te=String(et);return Se[Te]||(Se[Te]=[]),Se[Te].push(String(Ge)),Se},{});let me=ee.map(Se=>{if(Se.type!=="cluster")return Se;const Ge=pe[Se.id]||[],Xe=(Se.data?.placedEntityIds||[]).map(Te=>String(Te));return Ge.length!==Xe.length||Ge.some((Te,mt)=>Te!==Xe[mt])?{...Se,data:{...Se.data,placedEntityIds:Ge,manuallyReleasedIds:Ge}}:Se});for(const[Se,Ge]of Object.entries(pe)){const Xe=me.find(et=>et.id===Se&&et.type==="cluster");Xe&&(me=od(me,Xe,Ge))}return se(me)})},[se,y]),u.useEffect(()=>{if(!e)return;let ee=!0;const pe=new AbortController,me=3e4;async function Se(){i(!0),c(null);const Ge=performance.now();console.log(`[RelationshipViewer] Starting graph fetch for entity ${e} at depth ${w}`);try{const Xe=R.current instanceof Map?Array.from(R.current.entries()):[],et=new Map(Xe.map(([kt,te])=>[String(kt),te])),Te=new Set(et.keys()),mt=new Promise((kt,te)=>{setTimeout(()=>{te(new Error(`Graph fetch timed out after ${me/1e3} seconds`))},me)}),Dt=PR(e,w),At=await Promise.race([Dt,mt]),Ke=performance.now()-Ge;console.log(`[RelationshipViewer] Graph fetch completed in ${Ke.toFixed(2)}ms`);const ct=At??{};let Rt=Array.isArray(ct.edges)?ct.edges:[];Te.size&&Array.isArray(ct.edges)&&(Rt=ct.edges.filter(kt=>{const te=kt?.from_entity??kt?.fromEntityId??kt?.from??kt?.source??kt?.sourceId??null,be=kt?.to_entity??kt?.toEntityId??kt?.to??kt?.target??kt?.targetId??null,ve=te!=null?String(te):null,Ue=be!=null?String(be):null,it=ve?Te.has(ve):!1,xt=Ue?Te.has(Ue):!1;return!it&&!xt?!0:!(it&&xt)}));const Ut=Rt.map(kt=>Tz(kt,e)).filter(Boolean),Qt=Iz(Ut);Q.current=Qt,oe.current=Lz(e,Qt);const wt=Number.isFinite(Number(w))?Number(w):null,Ft=zz(e,Ut,wt),Ht=performance.now();console.log(`[RelationshipViewer] Starting graph processing: ${Rt.length} edges`),setTimeout(()=>{try{if(!ee)return;const kt=performance.now(),{nodes:te,edges:be,suppressedNodes:ve,clusters:Ue}=Cz({...ct,edges:Rt},e,void 0,{alwaysIncludeIds:Ft}),it=performance.now()-kt;if(console.log(`[RelationshipViewer] buildReactFlowGraph completed in ${it.toFixed(2)}ms: ${te.length} nodes, ${be.length} edges`),!ee)return;const xt=K=>K?K.type==="cluster"?{...K,data:{...K.data,onAddToBoard:(ae,Ne)=>_t(ae,Ne),onReturnToGroup:Tt,onCollapseCluster:Ct,onSetTargetEntity:Me,onOpenEntityInfo:Ae,placedEntityIds:[]}}:K.type==="entity"?{...K,data:{...K.data,onSetTarget:Me,onOpenInfo:Ae}}:{...K}:null,ie=q.current,_e=te.map(xt),qe=Object.entries(y).reduce((K,[ae,Ne])=>{const He=Ne?.clusterId!=null?String(Ne.clusterId):null;return He&&(K.has(He)||K.set(He,[]),K.get(He).push(String(ae))),K},new Map),ht=K=>{const ae=Array.isArray(K)?K.map(Ne=>String(Ne)):[];return ie.size?ae.filter(Ne=>!ie.has(Ne)):ae},pt=K=>{if(!K)return K;const ae=K?.id!=null?String(K.id):null,Ne=ht(K?.data?.containedIds||[]),He=ae&&qe.has(ae)?qe.get(ae):[],bt=Array.isArray(He)?He.map(Nt=>String(Nt)):[];return{...K,data:{...K?.data,containedIds:Ne,count:Ne.length+bt.length,placedEntityIds:bt,manuallyReleasedIds:bt}}},Ee=_e.map(K=>K?.type==="cluster"?pt(K):K),st=new Map,le=ve,Je=(K,ae)=>{if(ie.has(K))return;const Ne=wa(ae?.entity?.name,`Entity ${K}`);st.set(K,{clusterId:ae?.clusterId!=null?String(ae.clusterId):null,parentId:ae?.parentId!=null?String(ae.parentId):null,relationshipType:ae?.relationshipType||"Related",entity:ae?.entity?{...ae.entity,id:String(ae.entity.id??K),name:Ne,typeName:ae.entity?.typeName||ae.entity?.type?.name||"Entity",isExpandedProtected:!!ae.entity?.isExpandedProtected}:null})};le instanceof Map?le.forEach((K,ae)=>{const Ne=String(ae);Je(Ne,K)}):Object.entries(le||{}).forEach(([K,ae])=>{const Ne=String(K);Je(Ne,ae)}),R.current=st,B.current=new Map(st);const ut=new Map;le instanceof Map?le.forEach((K,ae)=>{const Ne=String(ae),He=K?.entity||null,bt=wa(He?.name,`Entity ${Ne}`);ut.set(Ne,{id:Ne,type:"entity",position:{x:0,y:0},data:{label:bt,typeName:He?.typeName||He?.type?.name||"Entity",entityId:Ne,isAdHoc:!0,isExpandedProtected:!!He?.isExpandedProtected}})}):Object.entries(le||{}).forEach(([K,ae])=>{const Ne=String(K),He=ae?.entity||null,bt=wa(He?.name,`Entity ${Ne}`);ut.set(Ne,{id:Ne,type:"entity",position:{x:0,y:0},data:{label:bt,typeName:He?.typeName||He?.type?.name||"Entity",entityId:Ne,isAdHoc:!0,isExpandedProtected:!!He?.isExpandedProtected}})}),I.current=ut;const gt=new Set,Ze=(Array.isArray(Ue)?Ue:Ee.filter(K=>K.type==="cluster")).map(K=>pt(K));Ze.forEach(K=>{gt.add(String(K.id))}),L.current=gt;const We=Ze.map(K=>({id:String(K.id),relationshipType:K?.data?.relationshipType||K?.data?.label||"Related",label:K?.data?.label||K?.data?.relationshipType||"Related",containedIds:(K?.data?.containedIds||[]).map(ae=>String(ae)),parentId:K?.data?.sourceId!=null?String(K.data.sourceId):null}));U.current=We;const dt=new Map(Array.isArray($.current)?$.current.map(K=>[String(K.id),K]):[]),Qe=[...Ee];ie.forEach(K=>{const ae=String(K);if(Qe.some(bt=>String(bt.id)===ae))return;const Ne=dt.get(ae);if(Ne){Qe.push(Ne);return}const He=ut.get(ae);if(He){const bt=xt(He);bt&&Qe.push({...bt,id:ae,type:"entity"})}});const yt=new Set(Array.isArray(be)?be.map(K=>K.id):[]),ke=(Array.isArray(M.current)?M.current:[]).filter(K=>{if(!K||yt.has(K.id))return!1;const ae=K?.data?.childId??K?.target??K?.data?.targetId??null,Ne=K?.data?.parentId??K?.source??K?.data?.sourceId??null,He=ae!=null?String(ae):null,bt=Ne!=null?String(Ne):null;return!!(He&&ie.has(He)||bt&&ie.has(bt))}),Ve=Array.isArray(be)?[...be,...ke]:ke,ft=performance.now()-Ht;console.log(`[RelationshipViewer] Total processing completed in ${ft.toFixed(2)}ms`),m(se(Qe)),p(Ve),ee&&i(!1)}catch(kt){ee&&(console.error("[RelationshipViewer] Error processing graph data:",kt),c(kt.message||"Failed to process graph data"),i(!1))}},0)}catch(Xe){ee&&(console.error("[RelationshipViewer] Error fetching graph:",Xe),c(Xe.message||"Failed to load graph"),i(!1))}}return Se(),()=>{ee=!1,pe.abort()}},[se,e,w,_t,Ct,Ae,Tt,Me]);const at=u.useCallback(()=>{if(!v||!e)return;const ee=String(e),pe=v.getNode(ee);if(!pe)return;const me=pe.width??0,Se=pe.height??0,Ge=pe.position.x+me/2,Xe=pe.position.y+Se/2;v.setCenter(Ge,Xe,{zoom:Math.max(1,v.getZoom()),duration:500})},[e,v]),fe=u.useCallback(()=>{!v||!f.length||v.fitView({padding:.2,duration:500})},[f.length,v]),ce=u.useCallback(()=>{e&&(m(ee=>{if(!ee?.length)return ee;const pe=ec(ee,h,e),me=new Map(pe.map(Te=>[String(Te.id),{...Te.position}])),Se=ee.map(Te=>{const mt=me.get(String(Te.id));return!mt||Te?.position?.x===mt.x&&Te?.position?.y===mt.y?Te:{...Te,position:{...mt}}}),Ge=Object.entries(y).reduce((Te,[mt,Dt])=>{const At=Dt?.clusterId;if(!At)return Te;const Ke=String(At);return Te[Ke]||(Te[Ke]=[]),Te[Ke].push(String(mt)),Te},{});if(!Object.keys(Ge).length)return Se;let Xe=Se.map(Te=>{if(Te.type!=="cluster")return Te;const mt=Ge[Te.id]||[],Dt=(Te.data?.placedEntityIds||[]).map(String);return mt.length!==Dt.length||mt.some((Ke,ct)=>Ke!==Dt[ct])?{...Te,data:{...Te.data,placedEntityIds:mt,manuallyReleasedIds:mt}}:Te});for(const[Te,mt]of Object.entries(Ge)){const Dt=Xe.find(At=>At.id===Te&&At.type==="cluster");Dt&&(Xe=od(Xe,Dt,mt))}const et=T.current;return et instanceof Map&&et.size&&Xe.forEach(Te=>{if(!Te||!(Te.type==="entity"||Te.type==="cluster"))return;const Dt=String(Te.id);et.has(Dt)&&et.set(Dt,{x:Te.position?.x??0,y:Te.position?.y??0})}),se(Xe)}),v&&requestAnimationFrame(()=>{v.fitView({padding:.2,duration:400})}))},[se,y,h,e,v]),ye=u.useCallback(()=>{r||N(ee=>Math.min(3,ee+1))},[r]),Pe=u.useCallback(()=>{r||N(ee=>Math.max(1,ee-1))},[r]);return u.useEffect(()=>{if(!E.current||!C.current)return;const ee=()=>{const Se=E.current,Ge=C.current;if(!Se||!Ge)return;const Xe=Se.getBoundingClientRect();Xe.width>0&&Xe.height>0&&(Ge.style.width=`${Xe.width}px`,Ge.style.height=`${Xe.height}px`)},pe=setTimeout(ee,0),me=new ResizeObserver(ee);return me.observe(E.current),()=>{clearTimeout(pe),me.disconnect()}},[]),r?a.jsx("p",{className:"p-4",children:"Loading graph..."}):l?a.jsxs("p",{className:"p-4 text-red-500",children:["Error: ",l]}):f.length?a.jsxs("div",{className:"relative h-full w-full",style:{width:"100%",height:"100%"},children:[a.jsx("div",{ref:E,className:"absolute inset-0 bg-slate-100",style:{width:"100%",height:"100%"},children:a.jsx("div",{ref:C,className:"absolute inset-0",style:{width:"100%",height:"100%"},children:a.jsxs(tj,{nodes:f,edges:h,onNodesChange:we,onEdgesChange:Le,onNodeDragStop:Be,nodeTypes:de,edgeTypes:J,fitView:!0,onInit:S,children:[a.jsx(B8,{}),a.jsx(G8,{}),a.jsx(J8,{gap:16})]})})}),a.jsxs("header",{className:"absolute top-0 z-20 bg-white border-b px-6 py-4 flex items-center justify-between relationship-viewer-header",style:{left:0,right:0,width:"100%",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1)"},children:[a.jsx("h1",{className:"text-xl font-bold text-gray-900 tracking-tight",children:"Relationship Explorer"}),a.jsx(mj,{style:{compact:!0},onRefocus:at,onZoomToFit:fe,onAutoArrange:ce,depth:w,onIncreaseDepth:ye,onDecreaseDepth:Pe})]}),a.jsx(Ky,{entityId:A,entity:_,isLoading:z,error:D,onClose:ot,fieldOrder:G,fieldRules:X})]}):a.jsx("p",{className:"p-4",children:"No relationships found for this entity."})}function Po({step:e,title:t,subtitle:r,children:i,disabled:l=!1}){return a.jsxs("section",{className:`step-card${l?" step-card--disabled":""}`,"aria-disabled":l,children:[a.jsxs("header",{className:"step-card__header",children:[a.jsx("span",{className:"step-card__badge",children:e}),a.jsxs("div",{children:[a.jsx("h3",{className:"step-card__title",children:t}),r&&a.jsx("p",{className:"step-card__subtitle",children:r})]})]}),a.jsx("div",{className:"step-card__body",children:i})]})}const Aw=["B","KB","MB","GB"];function Fz(e){if(!Number.isFinite(e)||e<=0)return"0 B";const t=Math.min(Math.floor(Math.log(e)/Math.log(1024)),Aw.length-1),r=e/1024**t;return`${r.toFixed(r>=10||t===0?0:1)} ${Aw[t]}`}function Bz({files:e=[],selectedId:t,onSelect:r,onDelete:i}){return e.length?a.jsx("ul",{className:"uploaded-file-list",children:e.map(l=>{const c=l.id===t;return a.jsxs("li",{className:`uploaded-file-list__item${c?" is-selected":""}`,children:[a.jsxs("button",{type:"button",className:"uploaded-file-list__select",onClick:()=>r(c?null:l.id),children:[a.jsx(Bp,{size:16}),a.jsx("span",{className:"uploaded-file-list__name",children:l.file_name}),a.jsx("span",{className:"uploaded-file-list__meta",children:Fz(l.size_bytes)})]}),a.jsx("button",{type:"button",className:"uploaded-file-list__delete",onClick:()=>i(l.id),"aria-label":`Delete ${l.file_name}`,children:a.jsx(ua,{size:16})})]},l.id)})}):a.jsx("p",{className:"uploaded-file-list__empty",children:"No files uploaded yet."})}function Uz({isOpen:e,onClose:t,preview:r,previewing:i,importing:l,onImport:c,error:f}){if(!e)return null;const m=!!(r&&!i&&!l);return a.jsxs("div",{className:"preview-popout",role:"dialog","aria-modal":"true",children:[a.jsx("div",{className:"preview-popout__overlay",onClick:t}),a.jsxs("div",{className:"preview-popout__panel",children:[a.jsxs("header",{className:"preview-popout__header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"Import Preview"}),a.jsx("p",{children:"Review the summary before running the upload."})]}),a.jsx("button",{type:"button",onClick:t,"aria-label":"Close preview",className:"preview-popout__close",children:a.jsx(Da,{size:20})})]}),a.jsxs("div",{className:"preview-popout__content",children:[i&&a.jsxs("div",{className:"preview-popout__state",children:[a.jsx(wn,{className:"spin",size:28}),a.jsx("p",{children:"Generating preview"})]}),!i&&f&&a.jsxs("div",{className:"preview-popout__alert preview-popout__alert--error",children:[a.jsx(Ma,{size:18}),a.jsx("span",{children:f})]}),!i&&r&&a.jsxs("div",{className:"preview-popout__summary",children:[a.jsxs("div",{className:"preview-popout__summary-grid",children:[a.jsx(cd,{label:"Total rows",value:r.total}),a.jsx(cd,{label:"To create",value:r.createCount,tone:"success"}),a.jsx(cd,{label:"Duplicates",value:r.duplicateCount,tone:"warn"}),a.jsx(cd,{label:"Invalid",value:r.invalidCount,tone:"error"})]}),r.duplicateCount>0&&Array.isArray(r.duplicates)&&a.jsxs("div",{className:"preview-popout__list",children:[a.jsx("h3",{children:"Duplicate rows"}),a.jsx("ul",{children:r.duplicates.map(h=>a.jsxs("li",{children:[a.jsxs("span",{children:["Row ",h.row]}),a.jsx("span",{className:"preview-popout__list-name",children:h.name})]},h.row))})]}),r.invalidCount>0&&Array.isArray(r.invalidRows)&&a.jsxs("div",{className:"preview-popout__list",children:[a.jsx("h3",{children:"Invalid rows"}),a.jsx("ul",{children:r.invalidRows.map(h=>a.jsxs("li",{children:[a.jsxs("span",{children:["Row ",h.row]}),a.jsx("span",{className:"preview-popout__list-name",children:h.reason})]},h.row))})]})]})]}),a.jsxs("footer",{className:"preview-popout__footer",children:[a.jsx("button",{type:"button",className:"preview-popout__dismiss",onClick:t,children:"Cancel"}),a.jsxs("button",{type:"button",className:"preview-popout__confirm",disabled:!m,onClick:c,children:[l?a.jsx(wn,{className:"spin",size:18}):a.jsx(fT,{size:18}),"Run upload"]})]})]})]})}function cd({label:e,value:t,tone:r}){return a.jsxs("div",{className:`summary-metric${r?` summary-metric--${r}`:""}`,children:[a.jsx("span",{className:"summary-metric__label",children:e}),a.jsx("span",{className:"summary-metric__value",children:t}),r==="success"&&a.jsx("span",{className:"summary-metric__icon",children:a.jsx(Qd,{size:18})}),r==="warn"&&a.jsx("span",{className:"summary-metric__icon",children:a.jsx(Ma,{size:18})}),r==="error"&&a.jsx("span",{className:"summary-metric__icon",children:a.jsx(Ma,{size:18})})]})}function qz(){const{token:e}=Nn(),{activeWorldId:t,contextKey:r}=Bn(),i=t||"",[l,c]=u.useState(null),[f,m]=u.useState(!1),[h,p]=u.useState(""),[y,g]=u.useState(""),[v,S]=u.useState([]),[w,N]=u.useState([]),[E,C]=u.useState(""),[A,O]=u.useState(null),[_,k]=u.useState(!1),[D,j]=u.useState(!1),[z,P]=u.useState(!1),[G,H]=u.useState(null),[X,V]=u.useState(!1),[R,B]=u.useState(""),I=u.useRef(null);u.useEffect(()=>{(async()=>{if(!i){N([]);return}k(!0);try{const J=await P1(i),se=Array.isArray(J?.data)?J.data:Array.isArray(J)?J:[];N(se)}catch(J){console.warn(" Failed to load entity types",J),N([])}finally{k(!1)}})()},[i,r]);const L=async()=>{try{const de=await fetch("/api/entities/upload",{headers:{Authorization:`Bearer ${e}`}});if(!de.ok)throw new Error("Failed to fetch uploads");const J=await de.json();S(J.files||[])}catch(de){console.warn(" Could not fetch uploads",de)}};u.useEffect(()=>{e&&L()},[e]);const $=de=>{const J=de.target.files?.[0]??null;c(J),p(""),g("")},M=async()=>{if(!l)return g("Please select a file to upload.");const de=new FormData;de.append("file",l),m(!0),p(""),g("");try{const J=await fetch("/api/entities/upload",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:de}),se=await J.json();if(!J.ok)throw new Error(se.message||"Upload failed");p("File uploaded successfully."),c(null),I.current&&(I.current.value=""),await L()}catch(J){console.error("Upload error:",J),g(J.message)}finally{m(!1)}},U=async de=>{if(window.confirm("Delete this upload?"))try{const J=await fetch(`/api/entities/upload/${de}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),se=await J.json();if(!J.ok)throw new Error(se.message||"Failed to delete file");p("File deleted."),A===de&&(O(null),H(null)),await L()}catch(J){console.error(" Delete error:",J),g(J.message)}},T=async()=>{if(E){g(""),p("");try{const de=await fetch(`/api/entities/template/${E}`,{headers:{Authorization:`Bearer ${e}`}});if(!de.ok)throw new Error("Failed to generate template");const J=await de.blob(),se=window.URL.createObjectURL(J),ne=document.createElement("a");ne.href=se,ne.download="Entity_Template.xlsx",document.body.appendChild(ne),ne.click(),ne.remove(),window.URL.revokeObjectURL(se),p("Template generated successfully.")}catch(de){console.error(" Template generation failed",de),g("Failed to generate template")}}},q=async()=>{if(!E)return g("Select an Entity Type first.");if(!A)return g("Select an uploaded file to preview.");if(!i)return g("Select a world context before previewing.");P(!0),V(!0),H(null),B(""),p(""),g("");try{const de=await fetch(`/api/entities/preview/${E}`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({fileId:A,worldId:i})}),J=await de.json();if(!de.ok||!J.success)throw new Error(J.message||"Preview failed");H(J.summary)}catch(de){console.error(" Preview failed:",de),B(de.message)}finally{P(!1)}},Y=async()=>{if(!E)return g("Select an Entity Type first.");if(!A)return g("Select an uploaded file to import.");if(!i)return g("Select a world context before importing.");j(!0),p(""),g("");try{const de=await fetch(`/api/entities/import/${E}`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({fileId:A,worldId:i})}),J=await de.json();if(!de.ok)throw new Error(J.message||"Import failed");p(J.message||"Import completed successfully."),V(!1),H(null),await L()}catch(de){console.error(" Import error:",de),B(de.message)}finally{j(!1)}},Q=()=>{D||z||(V(!1),B(""))},oe=u.useMemo(()=>w.find(de=>String(de.id)===String(E))?.name??"",[w,E]),Z=u.useMemo(()=>v.find(de=>de.id===A)??null,[v,A]);return u.useEffect(()=>{O(null),H(null),V(!1),c(null),I.current&&(I.current.value=""),p(""),g(""),B("")},[E]),a.jsxs("div",{className:"bulk-upload-page",children:[a.jsxs("div",{className:"bulk-upload-page__header",children:[a.jsx("h1",{className:"bulk-upload-page__title",children:"Bulk Entity Upload"}),a.jsx("p",{className:"bulk-upload-page__subtitle",children:"Follow the guided steps to prepare your template, upload a data file, preview the import, and launch the upload from a dedicated review panel."})]}),h&&a.jsxs("div",{className:"bulk-upload-page__status",children:[a.jsx(Qd,{size:18}),a.jsx("span",{children:h})]}),y&&a.jsxs("div",{className:"bulk-upload-page__status bulk-upload-page__status--error",children:[a.jsx(Ma,{size:18}),a.jsx("span",{children:y})]}),a.jsxs("div",{className:"bulk-upload-page__grid",children:[a.jsx(Po,{step:"Select",title:"Choose an entity type",subtitle:_?"Loading entity types for this world...":"Pick which entity type you want to work with. Steps unlock after choosing.",children:a.jsxs("select",{value:E,onChange:de=>C(de.target.value),className:"entity-type-select",children:[a.jsx("option",{value:"",children:_?"Loading":"Select Entity Type"}),w.map(de=>a.jsx("option",{value:de.id,children:de.name},de.id))]})}),E&&a.jsxs(a.Fragment,{children:[a.jsx(Po,{step:1,title:"Generate a template",subtitle:"Download a spreadsheet tailored to the selected entity type.",children:a.jsxs("div",{className:"step-actions",children:[a.jsxs("button",{type:"button",className:"primary-action",onClick:T,children:[a.jsx(vT,{size:18}),"Download template"]}),oe&&a.jsxs("span",{className:"selected-file-banner",children:[a.jsx(Li,{size:16})," Template matches ",oe]})]})}),a.jsxs(Po,{step:2,title:"Upload your file",subtitle:"Upload the filled spreadsheet and pick which file to preview.",children:[a.jsxs("div",{className:"file-input",children:[a.jsxs("label",{htmlFor:"bulk-upload-file",children:[a.jsx(M0,{size:20}),a.jsxs("div",{children:[a.jsx("div",{className:"file-input__name",children:l?l.name:"Select a file to upload"}),a.jsx("small",{children:"Supported format: Excel (.xlsx)"})]})]}),a.jsx("input",{ref:I,id:"bulk-upload-file",type:"file",hidden:!0,onChange:$}),a.jsxs("button",{type:"button",className:"secondary-action",onClick:M,disabled:!l||f,children:[f?a.jsx(wn,{className:"spin",size:18}):a.jsx(M0,{size:18}),"Upload file"]})]}),Z&&a.jsxs("div",{className:"selected-file-banner",children:[a.jsx(wT,{size:16})," Selected file: ",Z.file_name]}),a.jsx(Bz,{files:v,selectedId:A,onSelect:de=>{O(de),H(null)},onDelete:U})]}),a.jsx(Po,{step:3,title:"Run a preview",subtitle:"Review potential changes in the popout before committing to an upload.",children:a.jsxs("div",{className:"step-actions",children:[a.jsxs("button",{type:"button",className:"primary-action",onClick:q,disabled:!A||z,children:[z?a.jsx(wn,{className:"spin",size:18}):a.jsx(S1,{size:18}),"Preview import"]}),a.jsx("span",{className:"bulk-upload-page__empty-state",children:"The upload can only be launched from the preview popout."})]})}),a.jsx(Po,{step:4,title:"Launch the upload",subtitle:"Confirm the summary inside the popout, then run the upload from there.",children:a.jsxs("div",{className:"step-actions",children:[a.jsxs("span",{className:"bulk-upload-page__empty-state",children:["After reviewing the preview, use the ",a.jsx("strong",{children:"Run upload"})," button in the panel to finish."]}),a.jsxs("span",{className:"selected-file-banner",children:[a.jsx(y1,{size:16})," Preview popout controls the final import."]})]})})]})]}),a.jsx(Uz,{isOpen:X,onClose:Q,preview:G,previewing:z,importing:D,onImport:Y,error:R})]})}function vy({content:e="",mentions:t=[],segments:r=null,noteId:i="note",textClassName:l="note-text",mentionClassName:c="note-mention",renderEmpty:f=null}){const m=u.useMemo(()=>Array.isArray(r)?r:fc(e,t),[e,t,r]);return!m||m.length===0?typeof f=="function"?f():null:m.map((h,p)=>{if(h.type==="mention"&&h.entityId){const y=h.entityName||"entity";return a.jsxs("span",{className:c,children:["@",y,a.jsx(Os,{entityId:h.entityId,entityName:y})]},`${i}-mention-${p}`)}return a.jsx("span",{className:l,children:h.text},`${i}-text-${p}`)})}const Hz=2500,Ms=Object.freeze([]),Pz="Use @ to tag entities mentioned in this session.",Ap=(e="create")=>({mode:e,submitLabel:e==="edit"?"Save Changes":"Create Entity",submitDisabled:!1,cancelDisabled:!1,accessButtonVisible:!1,accessButtonDisabled:!1}),Tp=e=>{if(!e)return{id:"",sessionDate:"",sessionTitle:"Session note",content:"",mentions:Ms,createdAt:null,updatedAt:null,author:null,lastEditor:null};const t=e.sessionDate??e.session_date??"",r=e.sessionTitle??e.session_title??"Session note",i=typeof e.content=="string"?e.content:"",l=Array.isArray(e.mentions)?e.mentions.filter(Boolean).map(c=>{const f=c?.entityName??c?.entity_name??c?.label??c?.name??"",m=Tl(f);return{...c,entityName:m}}):Ms;return{id:e.id??"",sessionDate:t,sessionTitle:r,content:i,mentions:l,createdAt:e.createdAt??e.created_at??null,updatedAt:e.updatedAt??e.updated_at??null,author:e.author??null,lastEditor:e.lastEditor??null}},ud=()=>new Date().toISOString().slice(0,10),dd=e=>{if(!e)return"Undated session";const t=/^\d{4}-\d{2}-\d{2}$/.test(e)?`${e}T00:00:00Z`:e,r=new Date(t);return Number.isNaN(r.getTime())?e:r.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},Vz=e=>{if(!e)return"";const t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};function Yz(){const{user:e}=Nn(),{selectedCampaign:t,selectedCampaignId:r}=Bn(),[i,l]=u.useState({items:Ms,loading:!1,error:""}),[c,f]=u.useState(""),[m,h]=u.useState(null),[p,y]=u.useState(!1),[g,v]=u.useState({status:"idle",lastSaved:"",error:""}),[S,w]=u.useState(""),[N,E]=u.useState(!1),[C,A]=u.useState(!1),[O,_]=u.useState(""),k=u.useRef(null),D=u.useRef(""),j=u.useRef(null),z=u.useRef(!1),P=u.useRef(""),[G,H]=u.useState(!1),[X,V]=u.useState(()=>Ap("create")),[R,B]=u.useState("details"),I=u.useRef(`entity-form-${Math.random().toString(36).slice(2)}`),L=u.useMemo(()=>t?.world?.id?t.world.id:t?.world_id?t.world_id:"",[t]),$=u.useMemo(()=>!t||!Array.isArray(t.members)||!e?null:t.members.find(at=>at?.user_id===e.id)?.role??null,[t,e]),M=u.useMemo(()=>e?.role==="system_admin"?!0:$==="dm",[$,e]),U=u.useMemo(()=>e?.role==="system_admin"||$==="dm"?!0:$==="player"?(t?.world?.entity_creation_scope??"")===uc.ALL_PLAYERS:!1,[$,e,t]),T=u.useCallback(async()=>{if(r){l(Be=>({...Be,loading:!0,error:""}));try{const Be=await FM(r),at=Array.isArray(Be?.data)?Be.data:Array.isArray(Be)?Be:[];l({items:at,loading:!1,error:""})}catch(Be){console.error(" Failed to load session notes",Be),l({items:Ms,loading:!1,error:Be?.message||"Failed to load session notes"})}}},[r]);u.useEffect(()=>{if(!r){l({items:Ms,loading:!1,error:""}),f(""),h(null),j.current=null;return}T()},[r,T]),u.useEffect(()=>{k.current=m},[m]),u.useEffect(()=>{D.current=c},[c]);const q=u.useMemo(()=>Array.isArray(i.items)?[...i.items].sort((Be,at)=>{const fe=(Be?.session_date??Be?.sessionDate??"")||"",ce=(at?.session_date??at?.sessionDate??"")||"";if(fe&&ce&&fe!==ce)return ce.localeCompare(fe);const ye=new Date(Be?.updated_at??Be?.updatedAt??Be?.created_at??Be?.createdAt??0).getTime();return new Date(at?.updated_at??at?.updatedAt??at?.created_at??at?.createdAt??0).getTime()-ye}):Ms,[i.items]),Y=u.useMemo(()=>{const Be=S.trim().toLowerCase();return Be?q.filter(at=>{if(!at)return!1;const fe=String(at?.session_title??at?.sessionTitle??"Session note").toLowerCase(),ce=String(at?.content??"").toLowerCase(),ye=dd(at?.session_date??at?.sessionDate??"").toString().toLowerCase();return fe.includes(Be)||ce.includes(Be)||ye.includes(Be)}):q},[S,q]),Q=u.useMemo(()=>c&&q.find(Be=>Be?.id===c)||null,[q,c]),oe=u.useMemo(()=>m?.sessionDate?dd(m.sessionDate):"Undated session",[m?.sessionDate]),Z=u.useMemo(()=>m?.updatedAt?Vz(m.updatedAt):"",[m?.updatedAt]),de=u.useMemo(()=>m?.content?fc(m.content,m.mentions):Ms,[m?.content,m?.mentions]);u.useEffect(()=>{const Be=S.trim().length>0,at=Y.length>0?Y:q;if(!c&&at.length>0){f(at[0].id);return}if(Be&&Y.length===0){c&&f(""),h(null),j.current=null;return}if(c&&Y.length>0&&!Y.some(ye=>ye?.id===c)){f(Y[0].id);return}if(!c){h(null),j.current=null;return}if(!Q){f(""),h(null),j.current=null;return}const fe=Tp(Q);h(fe),j.current=fe,v(ce=>({...ce,status:"idle",error:""}))},[Y,S,Q,c,q]),u.useEffect(()=>{if(!c){E(!1);return}if(P.current&&P.current===c){E(!0),P.current="";return}E(!1)},[c]),u.useEffect(()=>{_("")},[c]),u.useEffect(()=>{w("")},[r]);const J=u.useCallback((Be,at)=>{const fe=typeof at=="string"?at:typeof Be?.target?.value=="string"?Be.target.value:"";h(ce=>ce&&{...ce,content:fe})},[]),se=u.useCallback(async(Be,at)=>{const fe=Be?.trim()??"";if(typeof at=="function"){if(!L||fe.length===0){at([]);return}try{const ce=await lf({worldId:L,query:fe,limit:8}),ye=Array.isArray(ce?.data)?ce.data:ce,Pe=Array.isArray(ye)?ye.map(ee=>{const pe=ee?.id??ee?.entity?.id;if(!pe)return null;const me=ee?.name||ee?.displayName||ee?.entity?.name||"Unnamed entity",Se=Tl(me)||"Unnamed entity";return{id:pe,display:Se}}).filter(Boolean):[];at(Pe)}catch(ce){console.error(" Failed to search entities for mentions",ce),at([])}}},[L]),ne=u.useCallback((Be,at)=>{h(fe=>fe&&{...fe,[Be]:at})},[]),we=u.useMemo(()=>{if(!m?.id)return!1;const Be={sessionTitle:(m.sessionTitle||"").trim(),sessionDate:m.sessionDate||"",content:m.content||""},at=j.current||{},fe={sessionTitle:(at.sessionTitle||"").trim(),sessionDate:at.sessionDate||"",content:at.content||""};return JSON.stringify(Be)!==JSON.stringify(fe)},[m]),Le=u.useCallback(async()=>{const Be=r,at=D.current,fe=k.current;if(!Be||!at||!fe||z.current)return;const ce={sessionTitle:fe.sessionTitle?.trim()||"Session note",sessionDate:fe.sessionDate||ud(),content:fe.content||""},ye=j.current||{},Pe={sessionTitle:ye.sessionTitle?.trim()||"Session note",sessionDate:ye.sessionDate||ud(),content:ye.content||""};if(JSON.stringify(ce)!==JSON.stringify(Pe))try{z.current=!0,v(Se=>({...Se,status:"saving",error:""}));const ee=await UM(Be,at,ce),pe=ee?.data??ee,me=Tp(pe);j.current=me,h(me),l(Se=>{const Ge=Array.isArray(Se.items)?Se.items:Ms,Xe=Ge.some(et=>et?.id===pe?.id)?Ge.map(et=>et?.id===pe?.id?{...et,...pe}:et):[pe,...Ge];return{...Se,items:Xe}}),v({status:"saved",lastSaved:new Date().toISOString(),error:""})}catch(ee){console.error(" Failed to save session note",ee),v(pe=>({...pe,status:"error",error:ee?.message||"Failed to save session note"}))}finally{z.current=!1}},[r]);u.useEffect(()=>{if(!r||!m?.id||!we||z.current)return;const Be=setTimeout(()=>{Le()},Hz);return()=>clearTimeout(Be)},[m,we,Le,r]);const Me=u.useCallback(()=>{Le()},[Le]),Ae=u.useCallback(async()=>{const Be=r,at=D.current;if(!(!Be||!at)){A(!0),_("");try{await qM(Be,at),l(fe=>{const ye=(Array.isArray(fe.items)?fe.items:Ms).filter(Pe=>String(Pe?.id)!==String(at));return{...fe,items:ye}}),D.current="",f(""),h(null),j.current=null,v({status:"idle",lastSaved:"",error:""})}catch(fe){console.error(" Failed to delete session note",fe),_(fe?.message||"Failed to delete session note")}finally{A(!1)}}},[r]),ot=u.useCallback(async()=>{if(r){y(!0),v(Be=>({...Be,error:""}));try{const Be=await BM(r,{sessionTitle:`Session on ${dd(ud())}`,sessionDate:ud()}),at=Be?.data??Be,fe=Tp(at);l(ce=>{const Pe=(Array.isArray(ce.items)?ce.items:Ms).filter(ee=>ee?.id!==at?.id);return{...ce,items:[at,...Pe],error:""}}),w(""),P.current=at.id,f(at.id),h(fe),j.current=fe,E(!0),v({status:"idle",lastSaved:"",error:""})}catch(Be){console.error(" Failed to create session note",Be),v(at=>({...at,status:"error",error:Be?.message||"Failed to create session note"}))}finally{y(!1)}}},[r]),ze=u.useCallback(()=>{L&&(V(Ap("create")),B("details"),H(!0))},[L]),nt=u.useCallback(()=>{H(!1),V(Ap("create")),B("details")},[]),$e=u.useCallback(Be=>{Be&&V(at=>({...at,...Be}))},[]),vt=u.useCallback(async Be=>{nt()},[nt]),_t=t?.name??"",Tt=q.length,Ct=u.useMemo(()=>{if(g.status==="saving")return"Saving";if(g.status==="error")return"Changes not saved";if(g.status==="saved"&&g.lastSaved){const Be=new Date(g.lastSaved);return Number.isNaN(Be.getTime())?"Saved":`Saved ${Be.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})}`}return we?"Unsaved changes":""},[we,g]);return r?a.jsxs("div",{className:"notes-page",children:[a.jsx("div",{className:"notes-header",children:a.jsxs("div",{className:"notes-title",children:[a.jsx("h1",{children:"Session Notes"}),a.jsxs("p",{children:["Chronicle every game night for the ",a.jsx("strong",{children:_t})," campaign, @mention key entities, and keep everyone aligned with auto-saving notes."]})]})}),a.jsxs("div",{className:"session-notes-meta",children:[a.jsxs("span",{children:[a.jsx(_1,{size:16})," Players and DMs can add or update notes."," ",a.jsx(T0,{size:16})," ",Tt," ",Tt===1?"session":"sessions"," tracked."]}),Ct?a.jsxs("span",{className:`session-notes-autosave status-${g.status}`,children:[g.status==="saving"?a.jsx(wn,{size:14,className:"spinner"}):g.status==="saved"?a.jsx(g1,{size:14}):g.status==="error"?a.jsx(Ha,{size:14}):we?a.jsx(I0,{size:14}):null,a.jsx("span",{children:Ct})]}):null]}),i.error&&a.jsxs("div",{className:"notes-error",role:"alert",children:[a.jsxs("strong",{children:[a.jsx(Ha,{size:18})," Unable to load session notes"]}),a.jsx("span",{children:i.error})]}),a.jsxs("div",{className:"session-notes-layout",children:[a.jsxs("aside",{className:"session-notes-sidebar",children:[a.jsxs("label",{className:"session-notes-search",htmlFor:"session-notes-search-input",children:[a.jsx(ic,{size:16}),a.jsx("input",{id:"session-notes-search-input",type:"search",placeholder:"Search session notes",value:S,onChange:Be=>w(Be.target.value)})]}),a.jsxs("button",{type:"button",className:"session-notes-item-button session-notes-new-button",onClick:ot,disabled:p||i.loading,children:[p?a.jsx(wn,{size:16,className:"spinner"}):a.jsx(Va,{size:16}),a.jsx("span",{children:p?"Creating":"New Session"})]}),a.jsx("div",{className:"session-notes-list-container",children:i.loading?a.jsxs("div",{className:"session-notes-loading",children:[a.jsx(wn,{size:18,className:"spinner"}),a.jsx("span",{children:"Loading session notes"})]}):Y.length===0?q.length===0?a.jsxs("div",{className:"notes-empty",children:[a.jsx(Li,{size:20}),a.jsx("strong",{children:"No session notes yet"}),a.jsx("span",{children:"Create the first note to kick off your campaign journal."})]}):a.jsxs("div",{className:"notes-empty",children:[a.jsx(ic,{size:18}),a.jsx("strong",{children:"No matches"}),a.jsxs("span",{children:["No session notes include ",S.trim(),"."]})]}):a.jsx("ul",{className:"session-notes-list",role:"list",children:Y.map(Be=>{const at=Be?.id,fe=at===c,ce=Be?.session_title??Be?.sessionTitle??"Session note",ye=dd(Be?.session_date??Be?.sessionDate);return a.jsx("li",{className:`session-notes-item ${fe?"active":""}`,children:a.jsxs("button",{type:"button",className:"session-notes-item-button",onClick:()=>f(at),children:[a.jsx("span",{className:"session-note-card-title",children:ce}),a.jsx("span",{className:"session-note-card-date",children:ye})]})},at)})})})]}),a.jsx("section",{className:"session-notes-panel",children:m?.id?a.jsxs("div",{className:"session-note-shell",children:[a.jsxs("header",{className:"session-note-header",children:[a.jsx("div",{className:"session-note-heading",children:a.jsx("h2",{children:m.sessionTitle||"Session note"})}),a.jsxs("div",{className:"session-note-toolbar",children:[M?a.jsxs("button",{type:"button",className:"session-note-action danger",onClick:Ae,disabled:C,children:[C?a.jsx(wn,{size:16,className:"spinner"}):a.jsx(ua,{size:16}),a.jsx("span",{children:C?"Deleting":"Delete"})]}):null,a.jsxs("button",{type:"button",className:"session-note-action",onClick:()=>E(Be=>!Be),children:[N?a.jsx(b1,{size:16}):a.jsx(ZT,{size:16}),a.jsx("span",{children:N?"View note":"Edit note"})]}),N&&U?a.jsxs("button",{type:"button",className:"session-note-action primary",onClick:ze,children:[a.jsx(Va,{size:16}),a.jsx("span",{children:"Create Entity"})]}):null]})]}),O?a.jsxs("div",{className:"session-note-error",role:"alert",children:[a.jsx(Ha,{size:16}),a.jsx("span",{children:O})]}):null,N?a.jsxs("div",{className:"session-note-form",children:[a.jsxs("div",{className:"session-note-fields session-note-fields-row",children:[a.jsxs("div",{className:"session-note-field",children:[a.jsx("label",{htmlFor:"session-note-title",children:"Title"}),a.jsx("input",{id:"session-note-title",type:"text",value:m.sessionTitle||"",onChange:Be=>ne("sessionTitle",Be.target.value),placeholder:"The mystery of the Violet Spire"})]}),a.jsxs("div",{className:"session-note-field",children:[a.jsx("label",{htmlFor:"session-note-date",children:"Session date"}),a.jsx("input",{id:"session-note-date",type:"date",value:m.sessionDate||"",onChange:Be=>ne("sessionDate",Be.target.value),max:"9999-12-31"})]})]}),a.jsxs("div",{className:"session-note-fields",children:[a.jsx("label",{htmlFor:"session-note-content",children:"Notes"}),a.jsx("div",{className:"session-note-editor-field",children:a.jsx(Od,{value:m.content||"",onChange:J,markup:"@[__display__](__id__)",placeholder:Pz,className:"session-note-mentions",inputProps:{id:"session-note-content",className:"session-note-textarea","aria-label":"Session note content",rows:14},children:a.jsx(Al,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(Be,at)=>`@${at}`,data:se,appendSpaceOnAdd:!0})})}),a.jsx("div",{className:"session-note-save-button",children:a.jsxs("button",{type:"button",className:"session-note-action primary",onClick:Me,disabled:g.status==="saving"||!we,children:[g.status==="saving"?a.jsx(wn,{size:16,className:"spinner"}):a.jsx(I0,{size:16}),a.jsx("span",{children:g.status==="saving"?"Saving":"Save now"})]})}),de.length>0?a.jsxs("div",{className:"session-note-preview","aria-live":"polite",children:[a.jsx("h3",{children:"Preview"}),a.jsx("div",{className:"session-note-preview-content",children:a.jsx(vy,{segments:de,noteId:`${m?.id||"note"}-preview`,textClassName:"session-note-text",mentionClassName:"session-note-mention"})})]}):null]}),a.jsx("div",{className:"session-note-actions",children:m.author?.username?a.jsxs("span",{className:"session-note-meta",children:["Created by ",m.author.username,m.lastEditor?.username&&m.lastEditor.username!==m.author.username?`  Last updated by ${m.lastEditor.username}`:""]}):null})]}):a.jsxs("article",{className:"session-note-view","aria-live":"polite",children:[a.jsxs("div",{className:"session-note-view-meta",children:[a.jsxs("span",{children:[a.jsx(T0,{size:16})," ",oe]}),Z?a.jsxs("span",{children:["Updated ",Z]}):null]}),a.jsx("div",{className:"session-note-view-body",children:a.jsx(vy,{segments:de,noteId:`${m?.id||"note"}-view`,textClassName:"session-note-text",mentionClassName:"session-note-mention",renderEmpty:()=>a.jsx("p",{className:"session-note-view-empty",children:"No notes captured yet."})})}),m.author?.username?a.jsxs("div",{className:"session-note-view-meta session-note-view-authors",children:[a.jsxs("span",{children:["Created by ",m.author.username]}),m.lastEditor?.username&&m.lastEditor.username!==m.author.username?a.jsxs("span",{children:["Last updated by ",m.lastEditor.username]}):null]}):null]})]}):a.jsxs("div",{className:"notes-helper",children:[a.jsx(Up,{size:28}),a.jsx("strong",{children:"Select a session to get started"}),a.jsx("span",{children:"Create a new note or choose one from the list to see its details."})]})})]}),a.jsx(Wr,{isOpen:G,onClose:nt,title:"Create Entity",width:420,footerActions:a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:nt,disabled:X.cancelDisabled,children:"Cancel"}),X.accessButtonVisible&&a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>B(Be=>Be==="access"?"details":"access"),disabled:X.accessButtonDisabled,children:R==="access"?"Details":"Access"}),a.jsx("button",{type:"submit",className:"btn submit",form:I.current,disabled:X.submitDisabled,children:X.submitLabel})]}),children:a.jsx(uN,{worldId:L,entityId:null,onCancel:nt,onSaved:vt,formId:I.current,onStateChange:$e,hideActions:!0,activeView:R,onViewChange:B,defaultCampaignId:r||""})})]}):a.jsxs("div",{className:"notes-page",children:[a.jsx("div",{className:"notes-header",children:a.jsxs("div",{className:"notes-title",children:[a.jsx("h1",{children:"Session Notes"}),a.jsx("p",{children:"Select a campaign from the header to start collecting your notes."})]})}),a.jsxs("div",{className:"notes-helper",children:[a.jsx(Up,{size:28}),a.jsx("strong",{children:"No campaign selected"}),a.jsx("span",{children:"Pick a campaign to unlock collaborative session notes."})]})]})}const Gz={private:"Private",party:"Party",companions:"Companions",dm:"DM"},Xz=[{value:"private",label:"Private"},{value:"companions",label:"My Companions"}],Kz=[{value:"private",label:"Private"},{value:"party",label:"Share with Party"}],Wz="What do you want to remember?",Zz=e=>{if(!e)return"";const t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})},Si=e=>{const t=[e?.entityId,e?.entity_id,e?.entity?.id];for(const r of t)if(r)return String(r);return""},Mp=e=>{const t=[e?.author?.id,e?.createdBy,e?.created_by];for(const r of t)if(r)return String(r);return""},Tw=e=>{const t=e?.author;return t?.username?t.username:t?.email?t.email:e?.character?.name?`${e.character.name} (Character)`:(e?.created_by,"Unknown author")},Mw=e=>e?.entity?.name?e.entity.name:typeof e?.entityName=="string"&&e.entityName.trim()?e.entityName:"Unnamed entity",xy=e=>{const t=[e?.entity?.entityTypeId,e?.entity?.entity_type_id,e?.entity?.entityType?.id,e?.entity?.entityType?.entity_type_id];for(const r of t)if(r)return String(r);return""},Qz=(e,t=new Map)=>{if(e?.entity?.entityType?.name)return e.entity.entityType.name;const r=xy(e);return r&&t.has(r)?t.get(r):""};function Jz(){const{selectedCampaign:e,selectedCampaignId:t}=Bn(),{user:r}=Nn(),[i,l]=u.useState({items:[],loading:!1,error:""}),[c,f]=u.useState(""),[m,h]=u.useState(""),[p,y]=u.useState(""),[g,v]=u.useState(null),[S,w]=u.useState(""),[N,E]=u.useState("private"),[C,A]=u.useState(""),[O,_]=u.useState(!1),[k,D]=u.useState(null),[j,z]=u.useState(""),[P,G]=u.useState([]),[H,X]=u.useState(!1),[V,R]=u.useState(""),[B,I]=u.useState([]),[L,$]=u.useState(!1),M=u.useCallback(async()=>{if(t){l(fe=>({...fe,loading:!0,error:""}));try{const fe=await $M(t),ce=Array.isArray(fe?.data)?fe.data:Array.isArray(fe)?fe:[];l({items:ce,loading:!1,error:""})}catch(fe){console.error(" Failed to load campaign entity notes",fe),l({items:[],loading:!1,error:fe?.message||"Failed to load entity notes"})}}},[t]);u.useEffect(()=>{if(!t){l({items:[],loading:!1,error:""});return}M()},[t,M]),u.useEffect(()=>{f(""),h(""),y(""),v(null),w(""),E("private"),A(""),z("")},[t]);const T=u.useMemo(()=>!e||!r?.id?null:(Array.isArray(e.members)?e.members:[]).find(ye=>{if(!ye)return!1;const Pe=ye.user_id??ye.userId??ye.user?.id??ye.id??null;return Pe?String(Pe)===String(r.id):!1})||null,[e,r?.id])?.role??null,q=u.useMemo(()=>r?.role==="system_admin"?!0:T==="dm",[T,r?.role]),Y=u.useMemo(()=>T==="player",[T]),Q=u.useMemo(()=>e?.world?.id?e.world.id:e?.world_id?e.world_id:"",[e]);u.useEffect(()=>{let fe=!1;return Q?((async()=>{$(!0);try{const ye=await ti({worldId:Q});if(fe)return;const ee=(Array.isArray(ye?.data)?ye.data:Array.isArray(ye)?ye:[]).map(pe=>({id:pe?.id?String(pe.id):"",name:pe?.name||"Unnamed type"})).filter(pe=>pe.id);I(ee)}catch(ye){if(fe)return;console.error("Failed to load entity types",ye),I([])}finally{fe||$(!1)}})(),()=>{fe=!0}):(I([]),$(!1),()=>{fe=!0})},[Q]);const oe=u.useMemo(()=>q?Kz:Xz,[q]),Z=u.useCallback(fe=>{if(!r||!fe)return!1;const ce=fe?.author?.id??fe?.createdBy??fe?.created_by??fe?.authorId??fe?.author_id??null;return ce?String(ce)===String(r.id):!1},[r]);u.useEffect(()=>{let fe=!1;return!Y||!t?(G([]),X(!1),R(""),A(""),()=>{fe=!0}):((async()=>{X(!0),R("");try{const ye=await Ls({scope:"my",campaign_id:t});if(fe)return;const ee=(Array.isArray(ye?.data)?ye.data:Array.isArray(ye)?ye:[]).map(pe=>({id:pe?.id?String(pe.id):"",name:pe?.name||"Unnamed character"})).filter(pe=>pe.id);G(ee),ee.length===1?A(ee[0].id):ee.some(pe=>pe.id===C)||A("")}catch(ye){if(fe)return;console.error("Failed to load characters for notes",ye),G([]),A(""),R(ye.message||"Failed to load characters")}finally{fe||X(!1)}})(),()=>{fe=!0})},[Y,t,C]);const de=u.useCallback(async(fe,ce)=>{const ye=fe?.trim()??"";if(typeof ce!="function")return;if(ye.length===0){ce([]);return}let Pe="";if(g){const me=i.items.find(Se=>Se?.id===g);me&&(Pe=Si(me))}if(Pe||(Pe=c||""),!Pe){ce([]);return}const ee=i.items.find(me=>Si(me)===Pe),pe=ee?.entity?.world_id??ee?.entity?.world?.id??"";if(!pe){ce([]);return}try{const me=await lf({worldId:pe,query:ye,limit:8}),Se=Array.isArray(me?.data)?me.data:me,Ge=Array.isArray(Se)?Se.map(Xe=>{const et=Xe?.id??Xe?.entity?.id;if(!et)return null;const Te=Xe?.name||Xe?.displayName||Xe?.entity?.name||"Unnamed entity",mt=Tl(Te)||"Unnamed entity";return{id:et,display:mt}}).filter(Boolean):[];ce(Ge)}catch(me){console.error("Failed to search entities for mentions",me),ce([])}},[c,i.items,g]),J=u.useCallback(fe=>{if(!fe)return;const ce=fe?.characterId??fe?.character_id??"";v(fe.id),w(fe?.content??""),E(fe?.shareType??fe?.share_type??"private"),A(ce),z("")},[]),se=u.useCallback(()=>{v(null),w(""),E("private"),A(""),z("")},[]),ne=u.useCallback((fe,ce)=>{const ye=typeof ce=="string"?ce:typeof fe?.target?.value=="string"?fe.target.value:"";w(ye),z("")},[]),we=u.useCallback(async fe=>{if(!fe||!t)return;const ce=S.trim();if(!ce){z("Please enter a note before saving");return}const ye=Si(fe);if(!ye){z("Unable to determine entity for this note");return}const Pe=fe?.characterId??fe?.character_id??"";if(Y&&Pe&&!C){z("Select which character this note is for");return}_(!0),z("");try{const ee={content:ce,shareType:N,campaignId:t};Y&&C&&(ee.characterId=C);const pe=await U1(ye,fe.id,ee),me=pe?.data||pe;if(!me)throw new Error("Note could not be updated");l(Se=>{const Ge=Array.isArray(Se?.items)?Se.items.slice():[],Xe=me?.id;if(!Xe)return Se;const et=Ge.findIndex(Te=>Te?.id===Xe);if(et>=0){const Te=[...Ge];return Te[et]=me,{items:Te,loading:!1,error:""}}return Se}),se()}catch(ee){console.error("Failed to update note",ee),z(ee.message||"Failed to update note")}finally{_(!1)}},[t,S,N,C,Y,se]),Le=u.useCallback(async fe=>{if(!fe?.id||!t||!window.confirm("Are you sure you want to delete this note? This action cannot be undone."))return;const ye=Si(fe);if(!ye){z("Unable to determine entity for this note");return}D(fe.id),z("");try{await q1(ye,fe.id,{campaignId:t}),l(Pe=>({items:(Array.isArray(Pe?.items)?Pe.items.slice():[]).filter(me=>me?.id!==fe.id),loading:!1,error:""}))}catch(Pe){console.error("Failed to delete note",Pe),z(Pe.message||"Failed to delete note")}finally{D(null)}},[t]),Me=u.useCallback(fe=>{const ce=fc(fe?.content,fe?.mentions);return ce.length?ce.map((ye,Pe)=>{if(ye.type==="mention"&&ye.entityId){const ee=`${fe?.id||"note"}-mention-${Pe}`,pe=ye.entityName||"entity";return a.jsxs("span",{className:"note-mention",children:["@",pe]},ee)}return a.jsx("span",{className:"note-text",children:ye.text},`${fe?.id||"note"}-text-${Pe}`)}):null},[]),Ae=u.useMemo(()=>Array.isArray(i.items)?[...i.items].sort((fe,ce)=>{const ye=new Date(fe?.created_at||fe?.createdAt||0).getTime(),Pe=new Date(ce?.created_at||ce?.createdAt||0).getTime();return Number.isNaN(Pe)?-1:Number.isNaN(ye)?1:Pe-ye}):[],[i.items]),ot=u.useMemo(()=>{const fe=new Map;return Ae.forEach(ce=>{const ye=Si(ce);if(!ye)return;const Pe=Mw(ce);fe.has(ye)||fe.set(ye,Pe)}),Array.from(fe.entries()).map(([ce,ye])=>({id:ce,name:ye})).sort((ce,ye)=>ce.name.localeCompare(ye.name,void 0,{sensitivity:"base"}))},[Ae]),ze=u.useMemo(()=>{const fe=new Map;return Ae.forEach(ce=>{const ye=Mp(ce);if(!ye)return;const Pe=Tw(ce);fe.has(ye)||fe.set(ye,Pe)}),Array.from(fe.entries()).map(([ce,ye])=>({id:ce,name:ye})).sort((ce,ye)=>ce.name.localeCompare(ye.name,void 0,{sensitivity:"base"}))},[Ae]),nt=u.useMemo(()=>{const fe=new Map;return B.forEach(ce=>{ce.id&&fe.set(ce.id,ce.name)}),fe},[B]),$e=u.useMemo(()=>{const fe=new Map;return Ae.forEach(ce=>{const ye=xy(ce);if(!ye)return;const Pe=Qz(ce,nt)||`Type ${ye.slice(0,8)}`;fe.has(ye)||fe.set(ye,Pe)}),Array.from(fe.entries()).map(([ce,ye])=>({id:ce,name:ye})).sort((ce,ye)=>ce.name.localeCompare(ye.name,void 0,{sensitivity:"base"}))},[Ae,nt]),vt=u.useMemo(()=>Ae.filter(fe=>{const ce=Si(fe),ye=Mp(fe),Pe=xy(fe);return!(c&&ce!==c||m&&ye!==m||p&&Pe!==p)}),[Ae,c,m,p]),_t=u.useCallback(()=>{if(!r?.id)return;const fe=String(r.id),ce=ze.find(ye=>Ae.find(ee=>Mp(ee)===ye.id&&Z(ee))!==void 0);ce?(h(ce.id),f("")):ze.some(ye=>ye.id===fe)&&(h(fe),f(""))},[r?.id,ze,Ae,Z]),Tt=e?.name??"",Ct=vt.length,Be=Ae.length,at=!!(c||m||p);return t?a.jsxs("div",{className:"notes-page",children:[a.jsxs("div",{className:"notes-header",children:[a.jsxs("div",{className:"notes-title",children:[a.jsx("h1",{children:"Entity Notes"}),a.jsxs("p",{children:["Browse the notes created for entities in the"," ",a.jsx("strong",{children:Tt})," campaign, filter by entity or author, and jump back into the context of your adventures."]})]}),a.jsx("div",{className:"notes-actions",children:a.jsxs("button",{type:"button",className:"notes-action-button",onClick:M,disabled:i.loading,title:"Reload notes",children:[a.jsx(Il,{size:16}),a.jsx("span",{children:i.loading?"Loading":"Reload"})]})})]}),a.jsxs("div",{className:"notes-filters",children:[a.jsxs("div",{className:"notes-filter-group",children:[a.jsx("label",{htmlFor:"entity-filter",children:"Entity"}),a.jsxs("select",{id:"entity-filter",value:c,onChange:fe=>f(fe.target.value),disabled:i.loading||ot.length===0,children:[a.jsx("option",{value:"",children:"All entities"}),ot.map(fe=>a.jsx("option",{value:fe.id,children:fe.name},fe.id))]})]}),a.jsxs("div",{className:"notes-filter-group",children:[a.jsx("label",{htmlFor:"author-filter",children:"Author"}),a.jsxs("select",{id:"author-filter",value:m,onChange:fe=>h(fe.target.value),disabled:i.loading||ze.length===0,children:[a.jsx("option",{value:"",children:"All authors"}),ze.map(fe=>a.jsx("option",{value:fe.id,children:fe.name},fe.id))]})]}),a.jsxs("div",{className:"notes-filter-group",children:[a.jsx("label",{htmlFor:"entity-type-filter",children:"Entity type"}),a.jsxs("select",{id:"entity-type-filter",value:p,onChange:fe=>y(fe.target.value),disabled:i.loading||$e.length===0,children:[a.jsx("option",{value:"",children:"All entity types"}),$e.map(fe=>a.jsx("option",{value:fe.id,children:fe.name},fe.id))]})]}),a.jsxs("button",{type:"button",className:"notes-action-button",onClick:()=>{f(""),h(""),y("")},disabled:!at,children:[a.jsx(Jd,{size:16}),a.jsx("span",{children:"Reset filters"})]}),r?.id&&a.jsx("button",{type:"button",className:"notes-action-button",onClick:_t,title:"Show only my notes",children:a.jsx("span",{children:"My notes"})})]}),a.jsxs("div",{className:"notes-meta",children:[a.jsxs("span",{children:["Showing ",a.jsx("strong",{children:Ct})," of ",a.jsx("strong",{children:Be})," ",Be===1?"note":"notes",at?" (filtered)":""]}),i.loading&&a.jsx("span",{children:"Loading latest notes"})]}),i.error&&a.jsxs("div",{className:"notes-error",role:"alert",children:[a.jsxs("strong",{children:[a.jsx(Ha,{size:18})," Unable to load entity notes"]}),a.jsx("span",{children:i.error})]}),!i.loading&&!i.error&&vt.length===0&&a.jsxs("div",{className:"notes-empty",children:[a.jsx("strong",{children:"No notes to show"}),a.jsx("span",{children:Be===0?"No entity notes have been shared in this campaign yet.":"Adjust your filters to see more notes."})]}),j&&a.jsxs("div",{className:"notes-error",role:"alert",children:[a.jsxs("strong",{children:[a.jsx(Ha,{size:18})," Error"]}),a.jsx("span",{children:j})]}),vt.length>0&&a.jsx("div",{className:"notes-list",children:vt.map(fe=>{const ce=Si(fe),ye=String(fe?.shareType||fe?.share_type||"private"),Pe=fe?.created_at||fe?.createdAt,ee=Pe?new Date(Pe):null,pe=Zz(ee),me=ee&&!Number.isNaN(ee.getTime())?ee.toISOString():"",Se=Tw(fe),Ge=fe?.character?.name??"",Xe=Mw(fe),et=g===fe?.id,Te=Z(fe);return a.jsx("article",{className:"note-card",children:et?a.jsxs("div",{className:"entity-notes-strict-edit-panel",style:{padding:"1rem"},children:[a.jsx(Od,{value:S,onChange:ne,markup:"@[__display__](__id__)",placeholder:Wz,className:"entity-note-mentions",inputProps:{className:"entity-notes-strict-textarea","aria-label":"Edit note content",rows:5,required:!0},children:a.jsx(Al,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(mt,Dt)=>`@${Dt}`,data:de,appendSpaceOnAdd:!0})}),a.jsx("p",{style:{marginTop:"0.75rem",marginBottom:"0.5rem",fontWeight:600},children:"Share with"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"0.75rem"},children:oe.map(mt=>a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx("input",{type:"radio",name:`entity-note-share-edit-${fe.id}`,value:mt.value,checked:N===mt.value,onChange:()=>E(mt.value),disabled:O}),mt.value==="private"?"Private":mt.value==="party"?"Share with Party":mt.label]},mt.value))}),Y&&P.length>0&&a.jsxs("div",{style:{marginBottom:"0.75rem"},children:[a.jsx("label",{htmlFor:`edit-character-${fe.id}`,style:{display:"block",marginBottom:"0.25rem",fontWeight:600},children:"Character"}),a.jsx("select",{id:`edit-character-${fe.id}`,value:C,onChange:mt=>A(mt.target.value),disabled:H||P.length===1,style:{width:"100%",padding:"0.5rem",borderRadius:"8px",border:"1px solid #cbd5f5"},children:P.map(mt=>a.jsx("option",{value:mt.id,children:mt.name},mt.id))})]}),j?a.jsxs("div",{className:"notes-error",style:{marginTop:"0.75rem",marginBottom:"0.75rem"},children:[a.jsx(Ha,{size:16}),a.jsx("span",{children:j})]}):null,a.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.75rem"},children:[a.jsx("button",{type:"button",className:"notes-action-button",onClick:()=>we(fe),disabled:O||!S.trim(),children:O?a.jsxs(a.Fragment,{children:[a.jsx(wn,{className:"spin",size:16,style:{animation:"spinner-rotate 1s linear infinite"}}),"Saving"]}):"Save"}),a.jsx("button",{type:"button",className:"notes-action-button",onClick:se,disabled:O,style:{background:"#64748b"},children:"Cancel"})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("header",{className:"note-card-header",children:[a.jsx("div",{className:"note-entity-meta",children:a.jsx("h2",{children:ce?a.jsxs("span",{className:"entity-link-with-preview",children:[a.jsx(Jt,{to:`/entities/${ce}`,className:"entity-name-link",children:Xe}),a.jsx(Os,{entityId:ce,entityName:Xe})]}):Xe})}),a.jsx("div",{className:"note-tags",children:a.jsx("span",{className:`note-tag share-${ye}`,children:Gz[ye]??ye})})]}),a.jsxs("div",{className:"note-details",children:[a.jsxs("span",{children:["Author: ",Se]}),Ge?a.jsxs("span",{children:["Character: ",Ge]}):null,pe?a.jsxs("span",{children:["Created:"," ",a.jsx("time",{dateTime:me||void 0,children:pe})]}):null]}),a.jsx("div",{className:"note-content",children:Me(fe)||a.jsx(vy,{content:fe?.content,mentions:fe?.mentions,noteId:fe?.id||ce||"note",textClassName:"note-text",mentionClassName:"note-mention"})}),Te&&a.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",paddingTop:"0.75rem",borderTop:"1px solid rgba(15, 23, 42, 0.1)"},children:[a.jsxs("button",{type:"button",className:"notes-action-button",onClick:()=>J(fe),style:{background:"#1e40af",color:"#fff"},children:[a.jsx(N1,{size:14}),a.jsx("span",{children:"Edit"})]}),a.jsxs("button",{type:"button",className:"notes-action-button",onClick:()=>Le(fe),disabled:k===fe.id,style:{background:"#dc2626",color:"#fff"},children:[k===fe.id?a.jsx(wn,{size:14,className:"spin",style:{animation:"spinner-rotate 1s linear infinite"}}):a.jsx(ua,{size:14}),a.jsx("span",{children:k===fe.id?"Deleting":"Delete"})]})]})]})},fe.id??`${ce}-${me||"unknown"}`)})})]}):a.jsxs("div",{className:"notes-page",children:[a.jsx("div",{className:"notes-header",children:a.jsxs("div",{className:"notes-title",children:[a.jsx("h1",{children:"Entity Notes"}),a.jsx("p",{children:"Select a campaign from the header to view entity notes."})]})}),a.jsxs("div",{className:"notes-empty",children:[a.jsx("strong",{children:"No campaign selected"}),a.jsx("span",{children:"Pick a campaign to explore its shared entity notes."})]})]})}const e$=(e,t)=>Mt.post("/access/bulk/apply",e,t),t$=({worldId:e})=>{if(!e)return Promise.reject(new Error("worldId is required"));const t=new URLSearchParams({worldId:e});return Mt.get(`/access/bulk/runs?${t.toString()}`)},n$=e=>e?Mt.get(`/access/bulk/runs/${e}`):Promise.reject(new Error("runId is required")),a$=e=>e?Mt.post(`/access/bulk/runs/${e}/revert`):Promise.reject(new Error("runId is required")),hj=e=>{if(!e)return Promise.reject(new Error("worldId is required"));const t=new URLSearchParams({worldId:e});return Mt.get(`/access/collections?${t.toString()}`)},s$=e=>Mt.post("/access/collections",e),r$=(e,t)=>e?Mt.put(`/access/collections/${e}`,t):Promise.reject(new Error("Collection id is required")),i$=e=>e?Mt.delete(`/access/collections/${e}`):Promise.reject(new Error("Collection id is required")),l$=e=>e?Mt.get(`/access/collections/${e}/entities`):Promise.reject(new Error("Collection id is required")),nr=1e3,ga={NAME:"name",NAME_DESCRIPTION:"nameDescription",ALL_DATA:"allData",ALL_DATA_RELATIONSHIPS:"allDataRelationships"},_d=[{value:ga.NAME,label:"Name only",description:"Matches entity names only."},{value:ga.NAME_DESCRIPTION,label:"Name & description",description:"Matches entity names and their descriptions."},{value:ga.ALL_DATA,label:"All data",description:"Matches names, descriptions, and visible data fields."},{value:ga.ALL_DATA_RELATIONSHIPS,label:"All data & relationships",description:"Matches every field plus reference values, ideal for relationship lookups."}],Rw={[ga.NAME]:"Filter entities by name",[ga.NAME_DESCRIPTION]:"Search names or descriptions",[ga.ALL_DATA]:"Search names, descriptions, and data fields",[ga.ALL_DATA_RELATIONSHIPS]:"Search across data and related entities"},kw=140,nc=(e,t)=>{if(t==null||typeof t=="number"&&!Number.isFinite(t))return;const i=(t instanceof Date?t.toISOString():String(t)).trim().toLowerCase();i&&e.add(i)},Sy=(e,t,r)=>{if(e!=null){if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"){nc(r,e);return}if(e instanceof Date){nc(r,e);return}if(Array.isArray(e)){e.forEach(i=>Sy(i,t,r));return}t&&typeof e=="object"&&Object.values(e).forEach(i=>Sy(i,t,r))}},o$=(e,t)=>{if(!e)return[];const r=t&&_d.some(l=>l.value===t)?t:ga.NAME,i=new Set;return nc(i,e.name),r!==ga.NAME&&nc(i,e.description),(r===ga.ALL_DATA||r===ga.ALL_DATA_RELATIONSHIPS)&&(nc(i,e.entityType?.name),e.metadata&&typeof e.metadata=="object"&&Sy(e.metadata,r===ga.ALL_DATA_RELATIONSHIPS,i)),Array.from(i)},Dw=(e,t="start")=>{if(!e)return null;const r=new Date(e);return Number.isNaN(r.getTime())?null:(t==="end"?r.setHours(23,59,59,999):r.setHours(0,0,0,0),r.getTime())},Iw=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})},c$=e=>{if(!e)return"";const t=Iw(e.updatedAt||e.updated_at);if(t)return`Updated ${t}`;const r=Iw(e.createdAt||e.created_at);return r?`Created ${r}`:""},u$=e=>{if(!e)return"";const t=e.summary||e.summary_text||e.description||e.system_prompt||e.notes||"",r=typeof t=="string"?t.replace(/\s+/g," ").trim():"";return r?r.length<=kw?r:`${r.slice(0,kw-1).trim()}`:""},Vo=({label:e,count:t,options:r=[],selectedValues:i=[],onToggle:l,disabled:c})=>{const f=m=>{c||l(String(m))};return a.jsxs("div",{className:"token-selector",children:[a.jsxs("div",{className:"token-selector__label-row",children:[a.jsx("span",{children:e}),a.jsxs("span",{className:"token-selector__count",children:["(",t,")"]})]}),a.jsx("div",{className:"token-selector__chips",role:"listbox","aria-multiselectable":!0,children:r.length===0?a.jsx("p",{className:"token-selector__empty",children:"No options available."}):r.map(m=>{const h=String(m.id),p=i.includes(h);return a.jsx("button",{type:"button",className:`token-selector__chip ${p?"selected":""}`,onClick:()=>f(h),"aria-pressed":p,disabled:c,children:m.label},h)})})]})},Fr=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],Rp=(e,t="name")=>e.map(r=>({id:String(r.id??r.value??r),label:r[t]||r.name||r.email||r.id})),Lw=e=>{const t=e.filter(r=>r.count>0).map(r=>`${r.count} ${r.label}${r.count===1?"":"s"}`);return t.length===0?"":t.length===1?t[0]:t.length===2?`${t[0]} and ${t[1]}`:`${t.slice(0,-1).join(", ")}, and ${t[t.length-1]}`};function Ow(){const{worldId:e,campaignId:t}=ws(),r=$n(),{user:i}=Nn(),{selectedCampaign:l,selectedCampaignId:c,setSelectedCampaignId:f,loading:m}=Bn(),[h,p]=u.useState(null),[y,g]=u.useState(""),[v,S]=u.useState(!0),[w,N]=u.useState([]),[E,C]=u.useState([]),[A,O]=u.useState([]),[_,k]=u.useState([]),[D,j]=u.useState(!1),[z,P]=u.useState(""),[G,H]=u.useState(""),[X,V]=u.useState(ga.NAME),[R,B]=u.useState(""),[I,L]=u.useState(""),[$,M]=u.useState([]),[U,T]=u.useState(!1),[q,Y]=u.useState(""),[Q,oe]=u.useState(null),[Z,de]=u.useState({readCampaignIds:[],readUserIds:[],readCharacterIds:[],writeCampaignIds:[],writeUserIds:[],description:""}),[J,se]=u.useState("unchanged"),[ne,we]=u.useState("unchanged"),[Le,Me]=u.useState(!1),[Ae,ot]=u.useState("manual"),[ze,nt]=u.useState([]),[$e,vt]=u.useState(!1),[_t,Tt]=u.useState(""),[Ct,Be]=u.useState(""),[at,fe]=u.useState(null),[ce,ye]=u.useState(!1),Pe=!!t,ee=t?String(t):"",pe=u.useMemo(()=>!Pe||!ee||!c?!1:String(c)===ee,[Pe,ee,c]),me=Pe&&pe?l:null,Se=e||me?.world?.id||"";u.useEffect(()=>{!Pe||!ee||String(c||"")!==ee&&f(ee)},[Pe,ee,c,f]);const Ge=u.useMemo(()=>Pe||!h||!i?!1:String(h.created_by)===String(i.id),[Pe,h,i]),Xe=u.useMemo(()=>!Pe||!me||!i?.id||!Array.isArray(me.members)?!1:me.members.some(ke=>ke?.user_id===i.id&&ke?.role==="dm"),[me,Pe,i]),et=!!(Pe&&me&&Xe),Te=Ge||et;u.useEffect(()=>{if(!Se||!Te){nt([]),Tt(""),Be(""),fe(null);return}let ke=!1;return(async()=>{vt(!0),Tt("");try{const ft=await hj(Se),K=Fr(ft);ke||nt(K)}catch(ft){ke||(console.error("Failed to load collections",ft),nt([]),Tt(ft.message||"Failed to load collections"))}finally{ke||vt(!1)}})(),()=>{ke=!0}},[Se,Te]),u.useEffect(()=>{if(Pe){if(!ee){g("Campaign id is required to use this tool."),S(!1);return}if(!me){if(m){S(!0);return}g("Campaign not found or unavailable for your account."),S(!1);return}p(me.world||null),g(""),S(!1);return}if(!e){g("A world id is required to use the bulk access tool."),S(!1);return}(async()=>{S(!0),g("");try{const Ve=await Ll(),K=Fr(Ve).find(ae=>String(ae.id)===String(e));if(!K){g("World not found or unavailable."),p(null);return}p(K)}catch(Ve){console.error("Failed to load worlds",Ve),g(Ve.message||"Failed to load world data"),p(null)}finally{S(!1)}})()},[me,m,Pe,ee,e]);const mt=u.useCallback(async()=>{if(!(!Se||!Te)){j(!0),P("");try{if(Pe&&me){const[ke,Ve]=await Promise.all([lc(Se),Ls({campaign_id:me.id})]);N(Fr(ke)),C([me]),O(Fr(Ve));const ft=Array.isArray(me.members)?me.members.map(K=>({id:String(K.user_id),username:K.user?.username||K.user?.email||K.user_id})):[];k(ft)}else{const[ke,Ve,ft,K]=await Promise.all([lc(Se),jc({world_id:Se}),Ls({world_id:Se}),Qy()]);N(Fr(ke)),C(Fr(Ve)),O(Fr(ft)),k(Fr(K))}}catch(ke){console.error("Failed to load bulk access data",ke),P(ke.message||"Unable to load world data")}finally{j(!1)}}},[me,Te,Pe,Se]);u.useEffect(()=>{mt()},[mt]);const Dt=u.useMemo(()=>Pe?new Set((A||[]).map(ke=>String(ke.id))):new Set,[A,Pe]),At=u.useMemo(()=>{if(!Pe)return w;if(!me)return[];const ke=String(me.id);return w.filter(Ve=>(Ve.read_access??"global")==="global"||(Array.isArray(Ve.read_campaign_ids)?Ve.read_campaign_ids.map(Ne=>String(Ne)):[]).includes(ke)?!0:(Array.isArray(Ve.read_character_ids)?Ve.read_character_ids.map(Ne=>String(Ne)):[]).some(Ne=>Dt.has(Ne)))},[me,Dt,w,Pe]);u.useEffect(()=>{const ke=new Set(At.map(Ve=>Ve.id));M(Ve=>{const ft=Ve.filter(K=>ke.has(K));return ft.length===Ve.length?Ve:ft})},[At]);const Ke=u.useMemo(()=>{const ke=G.trim().toLowerCase(),Ve=Dw(R,"start"),ft=Dw(I,"end");return At.filter(K=>{const ae=K.createdAt??K.created_at??null;if(Ve!==null||ft!==null){if(!ae)return!1;const He=new Date(ae).getTime();if(Number.isNaN(He)||Ve!==null&&He<Ve||ft!==null&&He>ft)return!1}if(!ke)return!0;const Ne=o$(K,X);return Ne.length?Ne.some(He=>He.includes(ke)):!1})},[At,G,X,R,I]),ct=u.useMemo(()=>_d.find(ke=>ke.value===X),[X]),Rt=Rw[X]||Rw[ga.NAME],Ut=ke=>{const Ve=ke.target.value,ft=_d.some(K=>K.value===Ve);V(ft?Ve:ga.NAME)},Qt=()=>{B(""),L("")};u.useEffect(()=>{if(!Pe||!me)return;const ke=String(me.id),Ve=new Set([ke]),ft=new Set((_||[]).map(ae=>String(ae.id))),K=new Set((A||[]).map(ae=>String(ae.id)));de(ae=>{const Ne=(tn,un)=>tn.filter(Kt=>un.has(String(Kt))),He=Ne(ae.readCampaignIds,Ve),bt=Ne(ae.writeCampaignIds,Ve),Nt=Ne(ae.readUserIds,ft),jt=Ne(ae.writeUserIds,ft),It=Ne(ae.readCharacterIds,K);return He.length===ae.readCampaignIds.length&&bt.length===ae.writeCampaignIds.length&&Nt.length===ae.readUserIds.length&&jt.length===ae.writeUserIds.length&&It.length===ae.readCharacterIds.length?ae:{...ae,readCampaignIds:He,writeCampaignIds:bt,readUserIds:Nt,writeUserIds:jt,readCharacterIds:It}})},[me,A,Pe,_]);const wt=$.length,Ft=wt>=nr,Ht=wt>0;u.useEffect(()=>{wt===0&&Me(!1)},[wt]);const kt=ke=>{Y(""),M(Ve=>Ve.includes(ke)?Ve.filter(ft=>ft!==ke):Ve.length>=nr?(Y(`You can only select ${nr} entities at a time.`),Ve):[...Ve,ke])},te=()=>{Y(""),M(ke=>{const Ve=new Set(ke);for(const ft of Ke){if(Ve.size>=nr)break;Ve.add(ft.id)}return Ve.size>nr&&Y(`Selection capped at ${nr} entities.`),Array.from(Ve)})},be=()=>{M([]),Y(""),Ae==="collection"&&(Be(""),fe(null))},ve=ke=>{const Ve=ke.target.value;ot(Ve),Y(""),Ve==="manual"?(Be(""),fe(null)):M([])},Ue=async ke=>{const Ve=ke.target.value;if(Be(Ve),fe(null),Y(""),!Ve){M([]);return}ye(!0);try{const ft=await l$(Ve),K=ft?.data||ft,ae=Array.isArray(K?.entityIds)?K.entityIds:[];M(ae),fe({entityIds:ae,entityCount:K?.entityCount??ae.length,totalCount:K?.totalCount??ae.length,truncated:!!K?.truncated}),K?.truncated&&Y(`Only the first ${nr} entities were loaded from this collection.`)}catch(ft){console.error("Failed to resolve collection entities",ft),Y(ft.message||"Failed to load collection entities"),M([]),fe(null)}finally{ye(!1)}},it=ke=>{const{value:Ve}=ke.target;de(ft=>({...ft,description:Ve}))},xt=ke=>Ve=>{const ft=Ve.target.value;ke==="read"?(se(ft),ft==="unchanged"&&de(K=>({...K,readCampaignIds:[],readUserIds:[],readCharacterIds:[]}))):(we(ft),ft==="unchanged"&&de(K=>({...K,writeCampaignIds:[],writeUserIds:[]})))},ie=ke=>Ve=>{const ft=String(Ve);de(K=>{const ae=K[ke]||[],He=ae.includes(ft)?ae.filter(bt=>bt!==ft):[...ae,ft];return{...K,[ke]:He}})},_e=J==="activated",qe=ne==="activated",ht=u.useMemo(()=>_e?Z.readCampaignIds.length+Z.readUserIds.length+Z.readCharacterIds.length>0:!1,[Z,_e]),pt=u.useMemo(()=>qe?Z.writeCampaignIds.length+Z.writeUserIds.length>0:!1,[Z,qe]),Ee=_e||qe,st=u.useMemo(()=>{if(!_e)return"";const ke=Lw([{label:"campaign",count:Z.readCampaignIds.length},{label:"user",count:Z.readUserIds.length},{label:"character",count:Z.readCharacterIds.length}]);return ke?`You will add read access for ${ke}.`:""},[Z,_e]),le=u.useMemo(()=>{if(!qe)return"";const ke=Lw([{label:"campaign",count:Z.writeCampaignIds.length},{label:"user",count:Z.writeUserIds.length}]);return ke?`You will add write access for ${ke}.`:""},[Z,qe]),Je=Te&&$.length>0&&Ee&&!U,ut=async ke=>{if(ke.preventDefault(),!Te){Y("You do not have permission to apply bulk access updates.");return}if(!$.length){Y("Select at least one entity to continue.");return}if(!Ee){Y("Select at least one access type to update.");return}if(_e&&!ht){Y("Add at least one read campaign, character, or user.");return}if(qe&&!pt){Y("Add at least one campaign or user to grant write access.");return}const Ve={entityIds:$,readAccess:_e?"selective":"unchanged",writeAccess:qe?"selective":"unchanged",readCampaignIds:_e?Z.readCampaignIds:[],readUserIds:_e?Z.readUserIds:[],readCharacterIds:_e?Z.readCharacterIds:[],writeCampaignIds:qe?Z.writeCampaignIds:[],writeUserIds:qe?Z.writeUserIds:[],description:Z.description};T(!0),Y(""),oe(null);try{const ft=await e$(Ve,{includeCampaignContext:!!(Pe&&me)}),K=ft?.data||ft;oe({runId:K.runId,count:K.count})}catch(ft){console.error("Failed to apply bulk access",ft),Y(ft.message||"Unable to apply bulk access update")}finally{T(!1)}},gt=u.useMemo(()=>Pe&&me?[{id:String(me.id),label:me.name}]:Rp(E),[me,E,Pe]),re=u.useMemo(()=>Rp(_,"username"),[_]),Ze=u.useMemo(()=>Rp(A),[A]),We=u.useMemo(()=>{const ke=new Map;return w.forEach(Ve=>{ke.set(Ve.id,Ve)}),ke},[w]),dt=u.useMemo(()=>!at||!Array.isArray(at.entityIds)?[]:at.entityIds.slice(0,10).map(ke=>We.get(ke)?.name||ke),[at,We]);if(v)return a.jsx("div",{className:"bulk-access-page",children:a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(wn,{className:"spin",size:16})," Loading world context"]})});if(y)return a.jsxs("div",{className:"bulk-access-page",children:[a.jsxs("div",{className:"bulk-access-alert error",children:[a.jsx(Ma,{size:16})," ",y]}),a.jsx("button",{type:"button",className:"link-button",onClick:()=>r(-1),children:"Go back"})]});if(!Te){const ke=Pe?"Only a DM for this campaign can access this tool.":"Only the world owner can access this tool.";return a.jsx("div",{className:"bulk-access-page",children:a.jsxs("div",{className:"bulk-access-alert warning",children:[a.jsx(Ma,{size:16})," ",ke]})})}const Qe=Pe?"Campaign Admin  Access":"World Admin  Manual Access",yt=Pe?me?.name:h?.name;return a.jsxs("div",{className:"bulk-access-page",children:[a.jsxs("div",{className:"bulk-access-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"bulk-access-eyebrow",children:Qe}),a.jsxs("h1",{children:["Bulk Access Editor  ",yt||""]})]}),Ge&&a.jsx("div",{className:"bulk-access-header-actions",children:a.jsx(Jt,{to:`/worlds/${e}/access/audit`,className:"ghost-button",children:"View audit log"})})]}),a.jsx("p",{className:"bulk-access-helper bulk-access-topline",children:"This tool adds access to selected entities. It does not remove current access."}),et&&me&&a.jsxs("div",{className:"bulk-access-context-banner",children:["You are updating access in Campaign: ",a.jsx("strong",{children:me.name})]}),z&&a.jsxs("div",{className:"bulk-access-alert warning",children:[a.jsx(Ma,{size:16})," ",z]}),Q&&a.jsxs("div",{className:"bulk-access-alert success",children:[a.jsx(Qd,{size:16})," Applied access updates to ",Q.count," entities  Run ",Q.runId,Ge&&a.jsx(Jt,{to:`/worlds/${e}/access/audit`,className:"inline-link",children:"Review run"})]}),q&&a.jsxs("div",{className:"bulk-access-alert error",children:[a.jsx(Ma,{size:16})," ",q]}),a.jsxs("div",{className:"bulk-access-grid",children:[a.jsxs("section",{className:"bulk-access-card",children:[a.jsxs("header",{children:[a.jsxs("h2",{children:[a.jsx(mM,{size:18})," Choose entities (",wt,"/",nr,")"]}),a.jsxs("div",{className:"bulk-access-entity-actions",children:[!Le&&a.jsx("button",{type:"button",className:"ghost-button",onClick:te,disabled:Ft||Ae!=="manual",children:"Select filtered"}),a.jsx("button",{type:"button",className:"ghost-button",onClick:be,children:"Clear selection"}),Ht&&a.jsx("button",{type:"button",className:"ghost-button",onClick:()=>Me(ke=>!ke),children:Le?"Expand":"Collapse"})]})]}),Le?a.jsx("div",{className:"bulk-access-entity-collapsed-summary",children:a.jsxs("p",{children:[a.jsx("strong",{children:wt})," ",wt===1?"entity":"entities"," selected."]})}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"bulk-access-selection-mode",children:[a.jsxs("label",{children:[a.jsx("input",{type:"radio",value:"manual",checked:Ae==="manual",onChange:ve}),"Select manually"]}),a.jsxs("label",{children:[a.jsx("input",{type:"radio",value:"collection",checked:Ae==="collection",onChange:ve}),"Use collection"]})]}),Ae==="collection"?a.jsxs("div",{className:"bulk-access-collection-panel",children:[$e&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(wn,{className:"spin",size:16})," Loading collections"]}),!$e&&_t&&a.jsx("p",{className:"bulk-access-helper warning",children:_t}),!$e&&!_t&&ze.length===0&&a.jsxs("p",{className:"bulk-access-helper",children:["No collections available.",Ge&&!Pe&&e&&a.jsxs(a.Fragment,{children:[" ",a.jsx(Jt,{to:`/worlds/${e}/collections`,className:"inline-link",children:"Create one in the collections manager"}),"."]})]}),ze.length>0&&a.jsxs("select",{value:Ct,onChange:Ue,children:[a.jsx("option",{value:"",children:"Select a collection"}),ze.map(ke=>a.jsxs("option",{value:ke.id,children:[ke.name,"  ",ke.entityCount??ke.entity_ids?.length??0," entities"]},ke.id))]}),ce&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(wn,{className:"spin",size:16})," Resolving collection"]}),at&&a.jsxs("div",{className:"bulk-access-collection-preview",children:[a.jsxs("p",{children:[a.jsx("strong",{children:at.entityCount})," entities selected from this collection."]}),at.truncated&&a.jsxs("p",{className:"bulk-access-helper warning",children:["Only the first ",nr," entities can be updated at a time."]}),dt.length>0&&a.jsx("ul",{children:dt.map((ke,Ve)=>a.jsx("li",{children:ke},`${ke}-${Ve}`))})]}),Ae==="collection"&&Ge&&!Pe&&e&&a.jsx(Jt,{to:`/worlds/${e}/collections`,className:"inline-link",children:"Manage collections"})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"entity-filter",children:[a.jsxs("div",{className:"entity-filter__row entity-filter__row--search",children:[a.jsxs("div",{className:"entity-filter__input",children:[a.jsx("label",{htmlFor:"bulk-access-entity-search",children:"Search"}),a.jsx("input",{id:"bulk-access-entity-search",type:"text",placeholder:Rt,value:G,onChange:ke=>H(ke.target.value)})]}),a.jsxs("div",{className:"entity-filter__scope",children:[a.jsx("label",{htmlFor:"bulk-access-entity-scope",children:"Search scope"}),a.jsx("select",{id:"bulk-access-entity-scope",value:X,onChange:Ut,children:_d.map(ke=>a.jsx("option",{value:ke.value,children:ke.label},ke.value))})]})]}),a.jsxs("div",{className:"entity-filter__row entity-filter__dates",children:[a.jsxs("div",{className:"entity-filter__date-field",children:[a.jsx("label",{htmlFor:"bulk-access-created-after",children:"Created after"}),a.jsx("input",{id:"bulk-access-created-after",type:"date",value:R,onChange:ke=>B(ke.target.value)})]}),a.jsxs("div",{className:"entity-filter__date-field",children:[a.jsx("label",{htmlFor:"bulk-access-created-before",children:"Created before"}),a.jsx("input",{id:"bulk-access-created-before",type:"date",value:I,onChange:ke=>L(ke.target.value)})]}),(R||I)&&a.jsx("button",{type:"button",className:"ghost-button entity-filter__clear-dates",onClick:Qt,children:"Clear dates"})]}),ct?.description&&a.jsx("p",{className:"bulk-access-helper",children:ct.description})]}),a.jsxs("div",{className:"entity-selector-list",children:[D&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(wn,{className:"spin",size:16})," Loading entities"]}),!D&&Ke.length===0&&a.jsx("p",{className:"bulk-access-helper",children:Pe?"No entities are visible within this campaign context.":"No entities match the current filter."}),!D&&Ke.map(ke=>{const Ve=c$(ke),ft=u$(ke);return a.jsxs("label",{className:"entity-row",children:[a.jsx("input",{type:"checkbox",checked:$.includes(ke.id),onChange:()=>kt(ke.id),disabled:Ft&&!$.includes(ke.id)}),a.jsxs("div",{className:"entity-row__main",children:[a.jsx("span",{className:"entity-name",children:ke.name}),a.jsxs("div",{className:"entity-row__meta",children:[ke.entityType?.name&&a.jsx("span",{className:"entity-type",children:ke.entityType.name}),Ve&&a.jsx("span",{className:"entity-row__meta-text",children:Ve})]}),ft&&a.jsx("p",{className:"entity-row__summary",children:ft})]}),a.jsx(Os,{entityId:ke.id,entityName:ke.name,className:"entity-row__preview"})]},ke.id)})]})]})]})]}),a.jsxs("section",{className:"bulk-access-card bulk-access-card--form",children:[a.jsx("header",{children:a.jsx("h2",{children:"Access configuration"})}),a.jsxs("form",{className:"bulk-access-form",onSubmit:ut,children:[a.jsxs("div",{className:"access-section",children:[a.jsxs("div",{className:"access-section__header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"access-section__eyebrow",children:"Step 1"}),a.jsx("h3",{children:"Read access"})]}),a.jsxs("label",{className:"access-mode-select",children:[a.jsx("span",{children:"Mode"}),a.jsxs("select",{value:J,onChange:xt("read"),children:[a.jsx("option",{value:"unchanged",children:"Unchanged"}),a.jsx("option",{value:"activated",children:"Activated"})]})]})]}),a.jsx("p",{className:"bulk-access-helper access-helper-text",children:"This adds new access. It does not remove current access."}),_e&&a.jsxs("div",{className:"access-section__content",children:[a.jsxs("div",{className:"access-section__grid",children:[a.jsx(Vo,{label:"Read campaigns",count:Z.readCampaignIds.length,options:gt,selectedValues:Z.readCampaignIds,onToggle:ie("readCampaignIds")}),a.jsx(Vo,{label:"Read users",count:Z.readUserIds.length,options:re,selectedValues:Z.readUserIds,onToggle:ie("readUserIds")})]}),a.jsx(Vo,{label:"Read characters",count:Z.readCharacterIds.length,options:Ze,selectedValues:Z.readCharacterIds,onToggle:ie("readCharacterIds")})]})]}),a.jsxs("div",{className:"access-section",children:[a.jsxs("div",{className:"access-section__header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"access-section__eyebrow",children:"Step 2"}),a.jsx("h3",{children:"Write access"})]}),a.jsxs("label",{className:"access-mode-select",children:[a.jsx("span",{children:"Mode"}),a.jsxs("select",{value:ne,onChange:xt("write"),children:[a.jsx("option",{value:"unchanged",children:"Unchanged"}),a.jsx("option",{value:"activated",children:"Activated"})]})]})]}),a.jsx("p",{className:"bulk-access-helper access-helper-text",children:"This adds new access. It does not remove current access."}),qe&&a.jsx("div",{className:"access-section__content",children:a.jsxs("div",{className:"access-section__grid",children:[a.jsx(Vo,{label:"Write campaigns",count:Z.writeCampaignIds.length,options:gt,selectedValues:Z.writeCampaignIds,onToggle:ie("writeCampaignIds")}),a.jsx(Vo,{label:"Write users",count:Z.writeUserIds.length,options:re,selectedValues:Z.writeUserIds,onToggle:ie("writeUserIds")})]})})]}),a.jsxs("label",{className:"bulk-access-description",children:["Description (optional)",a.jsx("textarea",{name:"description",value:Z.description,onChange:it,rows:1,placeholder:"Explain why this access change was applied"})]}),a.jsxs("div",{className:"bulk-access-summary",children:[st&&a.jsx("p",{children:st}),le&&a.jsx("p",{children:le}),!st&&!le&&a.jsx("p",{className:"bulk-access-helper",children:"No access changes selected yet."}),!Ee&&a.jsx("p",{className:"bulk-access-helper warning",children:"Select at least one access type to update."}),_e&&!ht&&a.jsx("p",{className:"bulk-access-helper warning",children:"Add at least one read audience."}),qe&&!pt&&a.jsx("p",{className:"bulk-access-helper warning",children:"Add at least one write audience."})]}),a.jsxs("div",{className:"bulk-access-footer",children:[a.jsxs("div",{className:"bulk-access-footer__selection-info",children:[a.jsx("strong",{children:wt})," ",wt===1?"entity":"entities"," selected"]}),a.jsx("button",{type:"submit",className:"primary-button",disabled:!Je||U,children:U?a.jsxs(a.Fragment,{children:[a.jsx(wn,{className:"spin",size:16})," Applying"]}):"Confirm and Apply"})]})]})]})]})]})}const zw=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],$w=e=>{if(!e)return"";try{return new Date(e).toLocaleString()}catch{return e}},Ts=(e=[])=>!Array.isArray(e)||e.length===0?"":e.join(", ");function d$(){const{worldId:e}=ws(),t=$n(),{user:r}=Nn(),[i,l]=u.useState(null),[c,f]=u.useState(""),[m,h]=u.useState(!0),[p,y]=u.useState([]),[g,v]=u.useState(!1),[S,w]=u.useState(""),[N,E]=u.useState(null),[C,A]=u.useState(!1),[O,_]=u.useState(""),[k,D]=u.useState(!1),[j,z]=u.useState(""),P=u.useMemo(()=>!i||!r?!1:String(i.created_by)===String(r.id),[i,r]);u.useEffect(()=>{if(!e){f("Missing world id"),h(!1);return}(async()=>{h(!0),f("");try{const I=await Ll(),$=zw(I).find(M=>String(M.id)===String(e));if(!$){f("World not found or unavailable"),l(null);return}l($)}catch(I){console.error("Failed to load worlds",I),f(I.message||"Unable to load world data"),l(null)}finally{h(!1)}})()},[e]);const G=u.useCallback(async B=>{if(B){w(B),A(!0),_("");try{const I=await n$(B),L=I?.data||I;E(L)}catch(I){console.error("Failed to load run detail",I),_(I.message||"Unable to load run details"),E(null)}finally{A(!1)}}},[]),H=u.useCallback(async()=>{if(!(!e||!P)){v(!0),_("");try{const B=await t$({worldId:e}),I=zw(B);if(y(I),I.length===0){E(null),w("");return}(!S||!I.some(L=>L.id===S))&&await G(I[0].id)}catch(B){console.error("Failed to load bulk runs",B),_(B.message||"Unable to load audit runs"),y([])}finally{v(!1)}}},[G,P,S,e]);u.useEffect(()=>{H()},[H]);const X=async()=>{if(!(!S||!window.confirm("Revert this entire run? This cannot be undone."))){D(!0),_(""),z("");try{const B=await a$(S),I=B?.data||B;z(`Run ${I.runId} reverted successfully.`),await H(),await G(S)}catch(B){console.error("Failed to revert run",B),_(B.message||"Unable to revert run")}finally{D(!1)}}},V=B=>B?.reverted?"Reverted":"Active",R=(B,I,L)=>a.jsxs("div",{className:"audit-diff-row",children:[a.jsx("span",{className:"audit-diff-label",children:B}),a.jsxs("div",{className:"audit-diff-values",children:[a.jsx("span",{className:"old",children:I}),a.jsx(y1,{size:14}),a.jsx("span",{className:"new",children:L})]})]},B);return m?a.jsx("div",{className:"bulk-audit-page",children:a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(wn,{className:"spin",size:16})," Loading world context"]})}):c?a.jsxs("div",{className:"bulk-audit-page",children:[a.jsxs("div",{className:"bulk-access-alert error",children:[a.jsx(Ma,{size:16})," ",c]}),a.jsx("button",{type:"button",className:"link-button",onClick:()=>t(-1),children:"Go back"})]}):P?a.jsxs("div",{className:"bulk-audit-page",children:[a.jsxs("div",{className:"bulk-access-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"bulk-access-eyebrow",children:"World Admin  Access Audit"}),a.jsxs("h1",{children:["Bulk Access Runs  ",i?.name]})]}),a.jsx("div",{className:"bulk-access-header-actions",children:a.jsx(Jt,{to:`/worlds/${e}/access/bulk`,className:"ghost-button",children:"Back to editor"})})]}),O&&a.jsxs("div",{className:"bulk-access-alert error",children:[a.jsx(Ma,{size:16})," ",O]}),j&&a.jsxs("div",{className:"bulk-access-alert success",children:[a.jsx(j1,{size:16})," ",j]}),a.jsxs("div",{className:"bulk-audit-grid",children:[a.jsxs("section",{className:"bulk-access-card",children:[a.jsxs("header",{children:[a.jsxs("h2",{children:[a.jsx(v1,{size:18})," Audit runs (",p.length,")"]}),a.jsx("button",{type:"button",className:"ghost-button",onClick:H,disabled:g,children:g?a.jsxs(a.Fragment,{children:[a.jsx(wn,{className:"spin",size:14})," Refreshing"]}):"Refresh"})]}),a.jsxs("div",{className:"audit-run-list",children:[g&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(wn,{className:"spin",size:16})," Loading runs"]}),!g&&p.length===0&&a.jsx("p",{className:"bulk-access-helper",children:"No bulk access runs have been recorded for this world."}),!g&&p.map(B=>a.jsxs("button",{type:"button",className:`audit-run-row ${S===B.id?"active":""}`,onClick:()=>G(B.id),children:[a.jsxs("div",{children:[a.jsxs("p",{className:"audit-run-title",children:["Run ",B.id]}),a.jsxs("p",{className:"audit-run-meta",children:[$w(B.createdAt||B.created_at),"  ",B.change_count||B.entity_count||0," entities"]}),a.jsxs("p",{className:"audit-run-meta",children:[B.campaignContext?.name?`Campaign  ${B.campaignContext.name}`:"Scope  World"," ",B.role_used==="dm"?" DM run":" Owner run"]})]}),a.jsx("span",{className:`status-pill ${B.reverted?"reverted":"active"}`,children:V(B)})]},B.id))]})]}),a.jsxs("section",{className:"bulk-access-card",children:[a.jsxs("header",{children:[a.jsx("h2",{children:"Run details"}),N&&a.jsx("button",{type:"button",className:"ghost-button",onClick:X,disabled:N.reverted||k,children:k?a.jsxs(a.Fragment,{children:[a.jsx(wn,{className:"spin",size:14})," Reverting"]}):a.jsxs(a.Fragment,{children:[a.jsx(Il,{size:14})," Revert run"]})})]}),!N&&a.jsx("p",{className:"bulk-access-helper",children:"Select a run to see the access changes."}),C&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(wn,{className:"spin",size:16})," Loading details"]}),N&&!C&&a.jsxs("div",{className:"audit-detail",children:[a.jsxs("div",{className:"audit-detail-meta",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Status:"})," ",N.reverted?"Reverted":"Active"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"User:"})," ",N.actor?.username||"Unknown user"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"User role:"})," ",N.role_used==="dm"?"Campaign DM":"World owner"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Scope:"})," ",N.campaignContext?.name||"World-wide"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Created:"})," ",$w(N.createdAt||N.created_at)]}),N.description&&a.jsxs("p",{children:[a.jsx("strong",{children:"Description:"})," ",N.description]})]}),a.jsx("div",{className:"audit-changes",children:N.changes?.map(B=>{const I=B.entity?.name||B.entity_id;return a.jsxs("div",{className:"audit-change-card",children:[a.jsxs("div",{className:"audit-change-header",children:[a.jsx("p",{className:"audit-change-title",children:I}),a.jsxs("span",{className:"audit-change-subtitle",children:["Entity ",B.entity_id]})]}),a.jsxs("div",{className:"audit-change-body",children:[R("Read access",B.old_read_access,B.entity?.read_access||""),R("Write access",B.old_write_access,B.entity?.write_access||""),R("Read campaigns",Ts(B.old_read_campaign_names!==void 0?B.old_read_campaign_names:B.old_read_campaign_ids),Ts(B.entity?.read_campaign_names!==void 0?B.entity.read_campaign_names:B.entity?.read_campaign_ids)),R("Read users",Ts(B.old_read_user_names!==void 0?B.old_read_user_names:B.old_read_user_ids),Ts(B.entity?.read_user_names!==void 0?B.entity.read_user_names:B.entity?.read_user_ids)),R("Read characters",Ts(B.old_read_character_ids),Ts(B.entity?.read_character_ids)),R("Write campaigns",Ts(B.old_write_campaign_names!==void 0?B.old_write_campaign_names:B.old_write_campaign_ids),Ts(B.entity?.write_campaign_names!==void 0?B.entity.write_campaign_names:B.entity?.write_campaign_ids)),R("Write users",Ts(B.old_write_user_names!==void 0?B.old_write_user_names:B.old_write_user_ids),Ts(B.entity?.write_user_names!==void 0?B.entity.write_user_names:B.entity?.write_user_ids))]})]},B.id)})})]})]})]})]}):a.jsx("div",{className:"bulk-audit-page",children:a.jsxs("div",{className:"bulk-access-alert warning",children:[a.jsx(Ma,{size:16})," Only the world owner can view audit runs."]})})}const Yo=1e3,kp=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],Dp={name:"",description:"",shared:!1,entityIds:[]};function f$(){const{worldId:e}=ws(),t=$n(),{user:r,sessionReady:i}=Nn(),[l,c]=u.useState(null),[f,m]=u.useState(!0),[h,p]=u.useState(""),[y,g]=u.useState(!1),[v,S]=u.useState([]),[w,N]=u.useState([]),[E,C]=u.useState(""),[A,O]=u.useState("view"),[_,k]=u.useState(""),[D,j]=u.useState(Dp),[z,P]=u.useState(!1),[G,H]=u.useState(""),[X,V]=u.useState(""),[R,B]=u.useState(!1),[I,L]=u.useState(!1),[$,M]=u.useState(!1),[U,T]=u.useState(null),[q,Y]=u.useState(!1),Q=u.useMemo(()=>{if(!l||!r)return!1;const ce=l.created_by||l.creator?.id||l.owner?.id||l.owner_id||null;return ce&&r.id&&String(ce)===String(r.id)},[l,r]),oe=u.useCallback(async()=>{if(e)try{const ce=await hj(e),ye=kp(ce);S(ye)}catch(ce){console.error("Failed to load collections",ce),p(ce.message||"Failed to load collections")}},[e]),Z=u.useCallback(async()=>{if(e)try{const ce=await lc(e),ye=kp(ce);N(ye)}catch(ce){console.error("Failed to load entities for world",ce),p(ce.message||"Failed to load entities for this world")}},[e]);u.useEffect(()=>{if(!i||!e)return;(async()=>{m(!0),p(""),g(!1),c(null);try{const ye=await Ll(),ee=kp(ye).find(me=>String(me.id)===String(e));if(!ee){p("World not found or unavailable");return}c(ee);const pe=ee.created_by||ee.creator?.id||ee.owner?.id||ee.owner_id||null;if(!r||!pe||String(pe)!==String(r.id)){g(!0);return}await Promise.all([oe(),Z()])}catch(ye){console.error("Failed to load collections manager",ye),p(ye.message||"Failed to load collections manager")}finally{m(!1)}})()},[oe,Z,i,r,e]);const de=ce=>ye=>{const Pe=ce==="shared"?ye.target.checked:ye.target.value;j(ee=>({...ee,[ce]:Pe})),P(!0),H(""),V("")},J=ce=>{H(""),V(""),j(ye=>{const Pe=new Set(ye.entityIds||[]);if(Pe.has(ce))Pe.delete(ce);else{if(Pe.size>=Yo)return H(`Collections can include up to ${Yo} entities.`),ye;Pe.add(ce)}return P(!0),{...ye,entityIds:Array.from(Pe)}})},se=u.useMemo(()=>{if(!E)return w;const ce=E.toLowerCase();return w.filter(ye=>(ye.name||"").toLowerCase().includes(ce))},[w,E]),ne=u.useMemo(()=>[...v].sort((ce,ye)=>ce.shared&&!ye.shared?-1:ye.shared&&!ce.shared?1:(ce.name||"").localeCompare(ye.name||"",void 0,{sensitivity:"base"})),[v]),we=u.useCallback(()=>{k(""),j(Dp),O("view"),P(!1),H(""),V("")},[]),Le=u.useCallback(ce=>{ce&&(k(ce.id),j({name:ce.name||"",description:ce.description||"",shared:!!ce.shared,entityIds:Array.isArray(ce.entityIds)?ce.entityIds:[]}),O("edit"),P(!1),H(""),V(""))},[]),Me=ce=>{if(z){T(ce),M(!0);return}Ae(ce)},Ae=ce=>{M(!1),T(null),ce&&(ce.type==="select"?Le(ce.payload):ce.type==="create"?(O("create"),k(""),j(Dp),P(!1),H(""),V("")):ce.type==="close"&&we())},ot=ce=>{Me({type:"select",payload:ce,label:ce.name})},ze=()=>{Me({type:"create",label:"start a new collection"})},nt=()=>{Me({type:"close",label:"leave this editor"})},$e=()=>{M(!1),T(null)},vt=()=>{Ae(U)},_t=u.useCallback(async()=>{if(!e)return H("A world id is required to save this collection."),!1;if(!D.name.trim())return H("Name is required."),!1;if(D.entityIds.length>Yo)return H(`Collections can include up to ${Yo} entities.`),!1;const ce={worldId:e,name:D.name.trim(),description:D.description,shared:D.shared,entityIds:D.entityIds};B(!0),H(""),V("");try{let ye;A==="edit"&&_?ye=await r$(_,ce):ye=await s$(ce);const Pe=ye?.data||ye;return Pe?(S(ee=>{const pe=ee.findIndex(me=>me.id===Pe.id);if(pe>=0){const me=[...ee];return me[pe]=Pe,me}return[...ee,Pe]}),Le(Pe),O("edit"),V("Collection saved successfully."),P(!1)):await oe(),!0}catch(ye){return console.error("Failed to save collection",ye),H(ye.message||"Failed to save collection"),!1}finally{B(!1)}},[Le,D,oe,A,_,e]),Tt=async ce=>{ce.preventDefault(),await _t()},Ct=async()=>{if(_&&confirm("Delete this collection? This cannot be undone.")){L(!0),H(""),V("");try{await i$(_),S(ce=>ce.filter(ye=>ye.id!==_)),we(),V("Collection deleted.")}catch(ce){console.error("Failed to delete collection",ce),H(ce.message||"Failed to delete collection")}finally{L(!1)}}},Be=async()=>{Y(!0);const ce=await _t();Y(!1),ce&&Ae(U)};if(u.useEffect(()=>{const ce=ye=>{z&&(ye.preventDefault(),ye.returnValue="")};return window.addEventListener("beforeunload",ce),()=>window.removeEventListener("beforeunload",ce)},[z]),!i)return a.jsx("p",{className:"collections-helper",children:"Restoring session"});if(!e)return a.jsx("p",{className:"collections-helper",children:"World id is required."});if(f)return a.jsx("div",{className:"collections-page",children:a.jsxs("p",{className:"collections-helper",children:[a.jsx(wn,{size:16,className:"spin"})," Loading collections"]})});if(h)return a.jsxs("div",{className:"collections-page",children:[a.jsxs("div",{className:"collections-alert error",children:[a.jsx(Ma,{size:16})," ",h]}),a.jsx("button",{type:"button",className:"link-button",onClick:()=>t(-1),children:"Go back"})]});if(y||!Q)return a.jsx("div",{className:"collections-page",children:a.jsxs("div",{className:"collections-alert warning",children:[a.jsx(Ma,{size:16})," Only the world owner can manage collections."]})});const at=l?.name||"",fe=D.entityIds.length;return a.jsxs("div",{className:"collections-page",children:[a.jsxs("div",{className:"collections-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"collections-eyebrow",children:"World Admin  Collections"}),a.jsx("h1",{children:at})]}),a.jsx("div",{className:"collections-header-actions",children:a.jsx("button",{type:"button",className:"primary-button",onClick:ze,children:"New collection"})})]}),X&&a.jsxs("div",{className:"collections-alert success",children:[a.jsx(Qd,{size:16})," ",X]}),G&&a.jsxs("div",{className:"collections-alert error",children:[a.jsx(Ma,{size:16})," ",G]}),a.jsxs("div",{className:"collections-grid",children:[a.jsxs("section",{className:"collections-card",children:[a.jsxs("header",{children:[a.jsx("h2",{children:"Collections"}),a.jsxs("p",{className:"collections-helper",children:[v.length," saved  Shared sets are available to campaign DMs"]})]}),a.jsx("div",{className:"collections-table-wrapper",children:ne.length===0?a.jsx("p",{className:"collections-helper",children:"No collections yet. Create one to get started."}):a.jsxs("table",{className:"collections-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Name"}),a.jsx("th",{children:"Shared"}),a.jsx("th",{children:"Entities"}),a.jsx("th",{children:"Updated"})]})}),a.jsx("tbody",{children:ne.map(ce=>{const ye=_===ce.id;return a.jsxs("tr",{className:ye?"active":"",onClick:()=>ot(ce),children:[a.jsxs("td",{children:[a.jsx("span",{className:"collection-name",children:ce.name}),ce.description&&a.jsx("span",{className:"collection-description",children:ce.description})]}),a.jsx("td",{children:ce.shared?a.jsxs("span",{className:"shared-chip",children:[a.jsx(_1,{size:14})," Shared"]}):a.jsx("span",{className:"shared-chip private",children:"Owner only"})}),a.jsx("td",{children:ce.entityCount??ce.entity_ids?.length??0}),a.jsx("td",{children:ce.updatedAt?new Date(ce.updatedAt).toLocaleString():""})]},ce.id)})})]})})]}),a.jsx("section",{className:"collections-card",children:A==="view"&&!_?a.jsx("div",{className:"collections-placeholder",children:a.jsx("p",{children:"Select a collection to edit or create a new one."})}):a.jsxs("form",{className:"collections-form",onSubmit:Tt,children:[a.jsxs("header",{children:[a.jsx("h2",{children:A==="edit"?"Edit collection":"New collection"}),a.jsxs("p",{className:"collections-helper",children:[fe,"/",Yo," entities selected"]})]}),a.jsxs("label",{children:["Name",a.jsx("input",{type:"text",value:D.name,onChange:de("name"),required:!0})]}),a.jsxs("label",{children:["Description (optional)",a.jsx("textarea",{value:D.description,onChange:de("description"),rows:3})]}),a.jsxs("label",{className:"checkbox-label",children:[a.jsx("input",{type:"checkbox",checked:D.shared,onChange:de("shared")}),"Share with DMs in this world"]}),a.jsxs("div",{className:"collections-entity-picker",children:[a.jsxs("div",{className:"collections-entity-toolbar",children:[a.jsx("span",{children:"Entities"}),a.jsx("input",{type:"text",placeholder:"Filter by name",value:E,onChange:ce=>C(ce.target.value)})]}),a.jsx("div",{className:"collections-entity-list",children:se.length===0?a.jsx("p",{className:"collections-helper",children:"No entities match this filter."}):a.jsx("ul",{children:se.map(ce=>{const ye=D.entityIds.includes(ce.id);return a.jsx("li",{children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:ye,onChange:()=>J(ce.id)}),a.jsx("span",{className:"entity-name",children:ce.name}),a.jsx("span",{className:"entity-type",children:ce.entityType?.name||""})]})},ce.id)})})})]}),a.jsxs("div",{className:"collections-form-actions",children:[a.jsx("button",{type:"submit",className:"primary-button",disabled:R,children:R?"Saving":"Save collection"}),A==="edit"&&a.jsx("button",{type:"button",className:"ghost-button",onClick:Ct,disabled:I,children:I?"Deleting":"Delete"}),a.jsx("button",{type:"button",className:"ghost-button",onClick:nt,children:"Close"})]})]})})]}),a.jsx(hN,{open:$,destinationLabel:U?.label||"",saving:q,onSaveAndContinue:Be,onContinueWithoutSaving:vt,onStay:$e})]})}function m$(){const e=ei();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function h$(e,t="request"){if(e.status===401)throw new Error("Unauthorized");if(!e.ok){const r=await e.json().catch(()=>({message:"Unknown error"}));throw new Error(r.message||`Failed to ${t}`)}return e.json()}async function p$(e,t){const r=await fetch(`${_n}/auth/change-password`,{method:"POST",headers:m$(),body:JSON.stringify({currentPassword:e,newPassword:t})});return h$(r,"change password")}function y$(){const[e,t]=u.useState(""),[r,i]=u.useState(""),[l,c]=u.useState(""),[f,m]=u.useState(""),[h,p]=u.useState(""),[y,g]=u.useState(!1),v=async S=>{S.preventDefault(),m(""),p(""),g(!0);try{if(!e||!r||!l){m("All fields are required"),g(!1);return}if(r.length<6){m("New password must be at least 6 characters long"),g(!1);return}if(r!==l){m("New password and confirmation do not match"),g(!1);return}await p$(e,r),p("Password changed successfully"),t(""),i(""),c("")}catch(w){m(w.message||"Failed to change password. Please try again.")}finally{g(!1)}};return a.jsx("div",{className:"settings-page",children:a.jsxs("div",{className:"settings-container",children:[a.jsxs("div",{className:"settings-header",children:[a.jsx("h1",{className:"settings-title",children:"Security"}),a.jsx("p",{className:"settings-subtitle",children:"Manage your account security"})]}),a.jsxs("div",{className:"settings-section",children:[a.jsx("h2",{className:"settings-section-title",children:"Change Password"}),a.jsx("p",{className:"settings-section-description",children:"Enter your current password and choose a new password to update your account security."}),a.jsxs("form",{onSubmit:v,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"current-password",children:"Current Password"}),a.jsx("input",{id:"current-password",type:"password",value:e,onChange:S=>t(S.target.value),placeholder:"Enter current password",required:!0,disabled:y})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"new-password",children:"New Password"}),a.jsx("input",{id:"new-password",type:"password",value:r,onChange:S=>i(S.target.value),placeholder:"Enter new password (minimum 6 characters)",required:!0,minLength:6,disabled:y})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"confirm-password",children:"Confirm New Password"}),a.jsx("input",{id:"confirm-password",type:"password",value:l,onChange:S=>c(S.target.value),placeholder:"Confirm new password",required:!0,disabled:y})]}),f&&a.jsx("p",{className:"error-msg",children:f}),h&&a.jsx("p",{className:"success-msg",children:h}),a.jsx("button",{type:"submit",disabled:y,className:"settings-submit-btn",children:y?"Changing password...":"Change Password"})]})]})]})})}const g$=[{value:"",label:"All types"},{value:"entity_comment",label:"Entity comments"},{value:"entity_mention_entity_note",label:"Entity mentions (notes)"},{value:"entity_mention_session_note",label:"Entity mentions (sessions)"},{value:"session_note_added",label:"Session notes"},{value:"session_note_updated",label:"Session notes"},{value:"request_note_added",label:"Feature/Bug notes"},{value:"request_status_changed",label:"Feature/Bug status"},{value:"request_assigned",label:"Feature/Bug assignments"}],b$=e=>{const{type:t,metadata:r={}}=e;switch(t){case"entity_comment":return`${r.author_name||"Someone"} commented on ${r.entity_name||"an entity"}`;case"entity_mention_entity_note":return`${r.author_name||"Someone"} mentioned ${r.related_entity_name||"an entity"} in a note`;case"entity_mention_session_note":return`${r.author_name||"Someone"} mentioned ${r.related_entity_name||"an entity"} in a session note`;case"session_note_added":return`${r.author_name||"Someone"} created a session note${r.campaign_name?` for ${r.campaign_name}`:""}: ${r.session_title||"Untitled"}`;case"session_note_updated":return`${r.author_name||"Someone"} updated a session note${r.campaign_name?` for ${r.campaign_name}`:""}: ${r.session_title||"Untitled"}`;case"request_note_added":return`${r.author_name||"Someone"} added a note to "${r.request_title||"a feature/bug"}"`;case"request_status_changed":return`Status changed for "${r.request_title||"a feature/bug"}"`;case"request_assigned":return`You were assigned to "${r.request_title||"a feature/bug"}"`;default:return"New notification"}},v$=e=>{if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const i=new Date-t,l=Math.floor(i/6e4),c=Math.floor(i/36e5),f=Math.floor(i/864e5);return l<1?"Just now":l<60?`${l}m ago`:c<24?`${c}h ago`:f<7?`${f}d ago`:t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})};function x$(){const{notifications:e,markRead:t,markAllRead:r,refresh:i}=z1(),{selectedCampaignId:l,campaigns:c,setSelectedCampaignId:f}=Bn(),m=$n(),[h,p]=u.useState(!1),[y,g]=u.useState([]),[v,S]=u.useState(1),[w,N]=u.useState(!0),[E,C]=u.useState(""),[A,O]=u.useState(""),[_,k]=u.useState(l||""),[D,j]=u.useState({open:!1,notification:null}),z=async(L=1,$=!1)=>{p(!0);try{const M={page:L,limit:50};E==="unread"?M.read="false":E==="read"&&(M.read="true"),A&&(M.type=A),_&&(M.campaignId=_);const U=await L1(M),T=Array.isArray(U?.data)?U.data:[],q=U?.pagination||{};g($?Y=>[...Y,...T]:T),N(q.page<q.pages)}catch(M){console.error("Failed to load notifications",M)}finally{p(!1)}};u.useEffect(()=>{z(1,!1)},[E,A,_]);const P=async L=>{try{await t(L.id),g($=>$.map(M=>M.id===L.id?{...M,read:!0,readAt:new Date().toISOString()}:M))}catch($){console.error("Failed to mark notification read",$)}},G=async()=>{try{const L={};_&&(L.campaignId=_),A&&(L.type=A),await r(L),i(),z(v,!1)}catch(L){console.error("Failed to mark all notifications read",L)}},H=L=>{if(L.actionUrl)m(L.actionUrl);else{const{type:$,metadata:M={}}=L;if($==="entity_comment"||$==="entity_mention_entity_note"){const U=M.entity_id||M.related_entity_id,T=L.campaignId||L.campaign?.id||_;U&&m(`/entities/${U}${T?`?campaignId=${T}`:""}#notes`)}else if($==="session_note_added"||$==="session_note_updated"||$==="entity_mention_session_note"){const U=L.campaignId||L.campaign?.id||M.target_id||_;m(`/notes/session${U?`?campaignId=${U}`:""}`)}else if($==="request_note_added"||$==="request_status_changed"||$==="request_assigned"){const U=M.request_id||M.requestId;m(U?`/requests/${U}`:"/requests")}}},X=async L=>{L.read||await P(L);const $=L.campaignId||L.campaign?.id||"";if($&&$!==(l||"")){j({open:!0,notification:L});return}H(L)},V=()=>{const{notification:L}=D;if(!L)return;const $=L.campaignId||L.campaign?.id||"";$&&f($),j({open:!1,notification:null}),setTimeout(()=>{H(L)},100)},R=()=>{j({open:!1,notification:null})},B=y.filter(L=>!L.read).length,I=u.useMemo(()=>[{value:"",label:"All campaigns"},...(c||[]).map(L=>({value:L.id,label:L.name}))],[c]);return a.jsxs("div",{className:"notification-list-page",children:[a.jsxs("div",{className:"notification-list-header",children:[a.jsx("h1",{children:"Notifications"}),a.jsx("div",{className:"notification-list-actions",children:B>0&&a.jsxs("button",{type:"button",className:"notification-list-mark-all-read",onClick:G,disabled:h,children:[a.jsx(rT,{size:18}),"Mark all read"]})})]}),a.jsxs("div",{className:"notification-list-filters",children:[a.jsxs("select",{className:"notification-list-filter",value:E,onChange:L=>{C(L.target.value),S(1)},children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"unread",children:"Unread"}),a.jsx("option",{value:"read",children:"Read"})]}),a.jsx("select",{className:"notification-list-filter",value:A,onChange:L=>{O(L.target.value),S(1)},children:g$.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))}),a.jsx("select",{className:"notification-list-filter",value:_,onChange:L=>{k(L.target.value),S(1)},children:I.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))})]}),a.jsxs("div",{className:"notification-list-content",children:[h&&y.length===0?a.jsx("div",{className:"notification-list-empty",children:"Loading..."}):y.length===0?a.jsxs("div",{className:"notification-list-empty",children:[a.jsx("p",{children:"No notifications found."}),a.jsx("p",{className:"notification-list-empty-hint",children:"You're all caught up!"})]}):a.jsx("div",{className:"notification-list-items",children:y.map(L=>a.jsxs("div",{className:`notification-list-item ${L.read?"read":"unread"}`,onClick:()=>X(L),children:[a.jsxs("div",{className:"notification-list-item-content",children:[a.jsxs("div",{className:"notification-list-item-header",children:[a.jsx("p",{className:"notification-list-item-message",children:b$(L)}),!L.read&&a.jsx("div",{className:"notification-list-item-dot"})]}),a.jsxs("div",{className:"notification-list-item-meta",children:[a.jsx("span",{className:"notification-list-item-time",children:v$(L.createdAt)}),L.campaign&&a.jsx("span",{className:"notification-list-item-campaign",children:L.campaign.name})]})]}),!L.read&&a.jsx("button",{type:"button",className:"notification-list-item-mark-read",onClick:$=>{$.stopPropagation(),P(L)},title:"Mark as read",children:a.jsx(g1,{size:16})})]},L.id))}),w&&a.jsx("div",{className:"notification-list-load-more",children:a.jsx("button",{type:"button",onClick:()=>{const L=v+1;S(L),z(L,!0)},disabled:h,children:h?"Loading...":"Load more"})})]}),a.jsx($1,{open:D.open,campaignName:D.notification?.campaign?.name||"",onSwitch:V,onCancel:R})]})}function S$(){const{selectedCampaignId:e,campaigns:t}=Bn(),[r,i]=u.useState([]),[l,c]=u.useState(!1),[f,m]=u.useState(e||""),[h,p]=u.useState(null),y=async()=>{c(!0);try{const w=await u4(f||void 0),N=Array.isArray(w?.data)?w.data:[];i(N)}catch(w){console.error("Failed to load followed entities",w)}finally{c(!1)}};u.useEffect(()=>{y()},[f]);const g=async(w,N)=>{if(!(!w||!N||h===w)){p(w);try{await fN(w,N),i(E=>E.filter(C=>!(C.entityId===w&&C.campaignId===N)))}catch(E){console.error("Failed to unfollow entity",E)}finally{p(null)}}},v=u.useMemo(()=>[{value:"",label:"All campaigns"},...(t||[]).map(w=>({value:w.id,label:w.name}))],[t]),S=u.useMemo(()=>{const w={};return r.forEach(N=>{const E=N.campaignId||"no-campaign";w[E]||(w[E]={campaign:N.campaign,entities:[]}),w[E].entities.push(N)}),w},[r]);return a.jsxs("div",{className:"followed-entities-page",children:[a.jsxs("div",{className:"followed-entities-header",children:[a.jsx("h1",{children:"Followed Entities"}),a.jsx("div",{className:"followed-entities-actions",children:a.jsx("select",{className:"followed-entities-filter",value:f,onChange:w=>m(w.target.value),children:v.map(w=>a.jsx("option",{value:w.value,children:w.label},w.value))})})]}),a.jsx("div",{className:"followed-entities-content",children:l?a.jsx("div",{className:"followed-entities-empty",children:"Loading..."}):r.length===0?a.jsxs("div",{className:"followed-entities-empty",children:[a.jsx("p",{children:"No followed entities found."}),a.jsx("p",{className:"followed-entities-empty-hint",children:"Follow entities from their detail pages to receive notifications when they're commented on or mentioned."})]}):a.jsx("div",{className:"followed-entities-list",children:Object.entries(S).map(([w,N])=>a.jsxs("div",{className:"followed-entities-group",children:[a.jsx("h2",{className:"followed-entities-group-title",children:N.campaign?.name||"No campaign context"}),a.jsx("div",{className:"followed-entities-items",children:N.entities.map(E=>a.jsxs("div",{className:"followed-entities-item",children:[a.jsx(Jt,{to:`/entities/${E.entityId}${E.campaignId?`?campaignId=${E.campaignId}`:""}`,className:"followed-entities-item-link",children:a.jsxs("div",{className:"followed-entities-item-content",children:[a.jsx("h3",{className:"followed-entities-item-name",children:E.entity?.name||"Unnamed entity"}),E.entity?.entityType&&a.jsx("span",{className:"followed-entities-item-type",children:E.entity.entityType.name})]})}),a.jsx("button",{type:"button",className:"followed-entities-item-unfollow",onClick:()=>g(E.entityId,E.campaignId),disabled:h===E.entityId,title:"Unfollow",children:h===E.entityId?a.jsx(Md,{size:18}):a.jsx(ky,{size:18})})]},`${E.entityId}-${E.campaignId}`))})]},w))})})]})}const w$=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([l,c])=>{c!=null&&c!==""&&t.set(l,c)});const r=t.toString(),i=r?`/requests?${r}`:"/requests";return Mt.get(i)},N$=e=>Mt.get(`/requests/${e}`),E$=e=>Mt.post("/requests",e),j$=(e,t)=>Mt.patch(`/requests/${e}`,t),_$=e=>Mt.delete(`/requests/${e}`),C$={open:"blue",in_progress:"orange",testing:"yellow",resolved:"green",closed:"gray",backlog:"purple"};function pj({status:e}){const t=C$[e]||"gray",r=e?e.split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" "):"Unknown";return a.jsx("span",{className:`request-status-badge request-status-badge--${t}`,children:r})}function A$({request:e}){const t=r=>{if(!r)return"";const i=new Date(r);if(Number.isNaN(i.getTime()))return"";const c=new Date-i,f=Math.floor(c/6e4),m=Math.floor(c/36e5),h=Math.floor(c/864e5);return f<1?"Just now":f<60?`${f}m ago`:m<24?`${m}h ago`:h<7?`${h}d ago`:i.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})};return a.jsxs(Jt,{to:`/requests/${e.id}`,className:"request-card",children:[a.jsxs("div",{className:"request-card__header",children:[a.jsxs("div",{className:"request-card__type",children:[e.type==="bug"?a.jsx(Dy,{size:16,className:"request-card__type-icon"}):a.jsx(Li,{size:16,className:"request-card__type-icon"}),a.jsx("span",{className:"request-card__type-label",children:e.type==="bug"?"Bug":"Feature"})]}),a.jsx(pj,{status:e.status})]}),a.jsx("h3",{className:"request-card__title",children:e.title}),a.jsx("p",{className:"request-card__description",children:e.description.length>150?`${e.description.substring(0,150)}...`:e.description}),a.jsxs("div",{className:"request-card__footer",children:[a.jsxs("div",{className:"request-card__meta",children:[a.jsxs("span",{className:"request-card__creator",children:["by ",e.creator?.username||"Unknown"]}),e.assignee&&a.jsxs("span",{className:"request-card__assignee",children:[" ",e.assignee.username]})]}),a.jsxs("div",{className:"request-card__time",children:[a.jsx(Ly,{size:14}),a.jsx("span",{children:t(e.createdAt)})]})]})]})}function T$(){const{user:e}=Nn(),t=e?.role==="system_admin",[r,i]=u.useState([]),[l,c]=u.useState(!1),[f,m]=u.useState({type:"",status:"",isInBacklog:""}),[h,p]=u.useState({page:1,limit:20,total:0,pages:0}),y=async(w=1)=>{c(!0);try{const N={page:w,limit:h.limit,...f};Object.keys(N).forEach(C=>{(N[C]===""||N[C]===null||N[C]===void 0)&&delete N[C]});const E=await w$(N);i(Array.isArray(E?.data)?E.data:[]),p(E?.pagination||h)}catch(N){console.error("Failed to load requests",N),alert("Failed to load requests")}finally{c(!1)}};u.useEffect(()=>{y(1)},[f]);const g=(w,N)=>{m(E=>({...E,[w]:N}))},v=()=>{m({type:"",status:"",isInBacklog:""})},S=Object.values(f).some(w=>w!=="");return a.jsxs("div",{className:"request-list-page",children:[a.jsxs("div",{className:"request-list-page__header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Feature/Bugs"}),a.jsxs("div",{className:"request-list-page__subtitle-wrapper",children:[a.jsx("p",{className:"request-list-page__subtitle",children:t?"All bug reports and feature requests":"Your bug reports and feature requests"}),t&&a.jsx("span",{className:"request-list-page__admin-badge",children:"Admin View"})]})]}),a.jsxs(Jt,{to:"/requests/new",className:"request-list-page__create-button",children:[a.jsx(Va,{size:20}),"New Request"]})]}),a.jsxs("div",{className:"request-list-page__filters",children:[a.jsxs("div",{className:"request-list-page__filter-group",children:[a.jsx(Jd,{size:16}),a.jsx("label",{htmlFor:"filter-type",children:"Type:"}),a.jsxs("select",{id:"filter-type",value:f.type,onChange:w=>g("type",w.target.value),className:"request-list-page__filter-select",children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"bug",children:"Bug"}),a.jsx("option",{value:"feature",children:"Feature"})]})]}),a.jsxs("div",{className:"request-list-page__filter-group",children:[a.jsx("label",{htmlFor:"filter-status",children:"Status:"}),a.jsxs("select",{id:"filter-status",value:f.status,onChange:w=>g("status",w.target.value),className:"request-list-page__filter-select",children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"open",children:"Open"}),a.jsx("option",{value:"in_progress",children:"In Progress"}),a.jsx("option",{value:"testing",children:"Testing"}),a.jsx("option",{value:"resolved",children:"Resolved"}),a.jsx("option",{value:"closed",children:"Closed"}),a.jsx("option",{value:"backlog",children:"Backlog"})]})]}),t&&a.jsxs("div",{className:"request-list-page__filter-group",children:[a.jsx("label",{htmlFor:"filter-backlog",children:"Backlog:"}),a.jsxs("select",{id:"filter-backlog",value:f.isInBacklog,onChange:w=>g("isInBacklog",w.target.value),className:"request-list-page__filter-select",children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"true",children:"In Backlog"}),a.jsx("option",{value:"false",children:"Not in Backlog"})]})]}),S&&a.jsx("button",{onClick:v,className:"request-list-page__clear-filters",children:"Clear Filters"})]}),l?a.jsx("div",{className:"request-list-page__loading",children:"Loading requests..."}):r.length===0?a.jsxs("div",{className:"request-list-page__empty",children:[a.jsx("p",{children:"No requests found"}),a.jsx(Jt,{to:"/requests/new",className:"request-list-page__empty-link",children:"Create your first request"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"request-list-page__grid",children:r.map(w=>a.jsx(A$,{request:w},w.id))}),h.pages>1&&a.jsxs("div",{className:"request-list-page__pagination",children:[a.jsx("button",{onClick:()=>y(h.page-1),disabled:h.page<=1,className:"request-list-page__pagination-button",children:"Previous"}),a.jsxs("span",{className:"request-list-page__pagination-info",children:["Page ",h.page," of ",h.pages," (",h.total," total)"]}),a.jsx("button",{onClick:()=>y(h.page+1),disabled:h.page>=h.pages,className:"request-list-page__pagination-button",children:"Next"})]})]})]})}const yj=e=>Mt.get(`/requests/${e}/notes`),gj=(e,t)=>Mt.post(`/requests/${e}/notes`,t),M$=(e,t,r)=>Mt.patch(`/requests/${e}/notes/${t}`,r),bj=(e,t)=>Mt.delete(`/requests/${e}/notes/${t}`),R$=Object.freeze(Object.defineProperty({__proto__:null,createRequestNote:gj,deleteRequestNote:bj,fetchRequestNotes:yj,updateRequestNote:M$},Symbol.toStringTag,{value:"Module"}));function k$({onSubmit:e,loading:t=!1}){const[r,i]=u.useState(""),l=c=>{c.preventDefault(),r.trim()&&(e(r.trim()),i(""))};return a.jsxs("form",{onSubmit:l,className:"request-note-form",children:[a.jsx("textarea",{value:r,onChange:c=>i(c.target.value),placeholder:"Add a note...",className:"request-note-form__textarea",rows:3,disabled:t}),a.jsx("div",{className:"request-note-form__actions",children:a.jsxs("button",{type:"submit",disabled:!r.trim()||t,className:"request-note-form__submit",children:[a.jsx(lM,{size:16}),t?"Adding...":"Add Note"]})})]})}function D$({requestId:e,canAddNote:t}){const{user:r}=Nn(),[i,l]=u.useState([]),[c,f]=u.useState(!1),[m,h]=u.useState(!1),[p,y]=u.useState(null),[g,v]=u.useState(""),S=async()=>{f(!0);try{const _=await yj(e);l(Array.isArray(_?.data)?_.data:[])}catch(_){console.error("Failed to load notes",_)}finally{f(!1)}};u.useEffect(()=>{e&&S()},[e]);const w=async _=>{h(!0);try{await gj(e,{content:_}),await S()}catch(k){console.error("Failed to add note",k),alert("Failed to add note")}finally{h(!1)}},N=async _=>{if(confirm("Are you sure you want to delete this note?"))try{await bj(e,_),await S()}catch(k){console.error("Failed to delete note",k),alert("Failed to delete note")}},E=_=>{y(_.id),v(_.content)},C=()=>{y(null),v("")},A=async _=>{try{const{updateRequestNote:k}=await Z1(async()=>{const{updateRequestNote:D}=await Promise.resolve().then(()=>R$);return{updateRequestNote:D}},void 0);await k(e,_,{content:g}),y(null),v(""),await S()}catch(k){console.error("Failed to update note",k),alert("Failed to update note")}},O=_=>{if(!_)return"";const k=new Date(_);if(Number.isNaN(k.getTime()))return"";const j=new Date-k,z=Math.floor(j/6e4),P=Math.floor(j/36e5),G=Math.floor(j/864e5);return z<1?"Just now":z<60?`${z}m ago`:P<24?`${P}h ago`:G<7?`${G}d ago`:k.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})};return c?a.jsx("div",{className:"request-notes__loading",children:"Loading notes..."}):a.jsxs("div",{className:"request-notes",children:[a.jsxs("div",{className:"request-notes__header",children:[a.jsx(VT,{size:20}),a.jsxs("h3",{children:["Notes (",i.length,")"]})]}),t&&a.jsx(k$,{onSubmit:w,loading:m}),a.jsx("div",{className:"request-notes__list",children:i.length===0?a.jsx("div",{className:"request-notes__empty",children:"No notes yet"}):i.map(_=>a.jsx("div",{className:"request-note",children:p===_.id?a.jsxs("div",{className:"request-note__edit",children:[a.jsx("textarea",{value:g,onChange:k=>v(k.target.value),className:"request-note__edit-textarea",rows:3}),a.jsxs("div",{className:"request-note__edit-actions",children:[a.jsx("button",{onClick:()=>A(_.id),className:"request-note__edit-save",children:"Save"}),a.jsx("button",{onClick:C,className:"request-note__edit-cancel",children:"Cancel"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"request-note__content",children:_.content}),a.jsxs("div",{className:"request-note__footer",children:[a.jsxs("div",{className:"request-note__meta",children:[a.jsx("span",{className:"request-note__author",children:_.author?.username||"Unknown"}),a.jsx("span",{className:"request-note__time",children:O(_.createdAt)})]}),r?.id===_.createdBy&&a.jsxs("div",{className:"request-note__actions",children:[a.jsx("button",{onClick:()=>E(_),className:"request-note__action",title:"Edit note",children:a.jsx(N1,{size:14})}),a.jsx("button",{onClick:()=>N(_.id),className:"request-note__action",title:"Delete note",children:a.jsx(ua,{size:14})})]})]})]})},_.id))})]})}function I$(){const{id:e}=ws(),t=$n(),{user:r}=Nn(),i=r?.role==="system_admin",[l,c]=u.useState(null),[f,m]=u.useState(!1),[h,p]=u.useState(!1),[y,g]=u.useState([]),[v,S]=u.useState(!1),[w,N]=u.useState(!1),[E,C]=u.useState({status:"",assignedTo:"",testerId:"",priority:"",isInBacklog:!1}),A=async()=>{m(!0);try{const j=await N$(e);if(j?.success&&j?.data){const z=j.data;c(z),C({status:z.status||"",assignedTo:z.assignedTo||"",testerId:z.testerId||"",priority:z.priority||"",isInBacklog:z.isInBacklog||!1})}else throw new Error("Request not found")}catch(j){console.error("Failed to load request",j),alert(j.message||"Failed to load request"),t("/requests")}finally{m(!1)}};u.useEffect(()=>{e&&A()},[e]),u.useEffect(()=>{i&&w&&O()},[i,w]);const O=async()=>{S(!0);try{const j=await Qy();g(Array.isArray(j?.data)?j.data:[])}catch(j){console.error("Failed to load users",j)}finally{S(!1)}},_=async()=>{p(!0);try{const j={};if(E.status&&E.status!==l.status&&(j.status=E.status),E.assignedTo!==l.assignedTo&&(j.assignedTo=E.assignedTo||null),E.testerId!==l.testerId&&(j.testerId=E.testerId||null),E.priority!==l.priority&&(j.priority=E.priority||null),E.isInBacklog!==l.isInBacklog&&(j.isInBacklog=E.isInBacklog),Object.keys(j).length===0){N(!1);return}await j$(e,j),await A(),N(!1)}catch(j){console.error("Failed to update request",j),alert("Failed to update request")}finally{p(!1)}},k=async()=>{if(confirm("Are you sure you want to delete this request? This action cannot be undone."))try{await _$(e),t("/requests")}catch(j){console.error("Failed to delete request",j),alert("Failed to delete request")}},D=l&&(i||String(l.createdBy)===String(r?.id)||String(l.testerId)===String(r?.id));return f?a.jsx("div",{className:"request-detail-page__loading",children:"Loading request..."}):l?a.jsxs("div",{className:"request-detail-page",children:[a.jsxs("div",{className:"request-detail-page__header",children:[a.jsxs(Jt,{to:"/requests",className:"request-detail-page__back",children:[a.jsx(Ry,{size:20}),"Back to Feature/Bugs"]}),a.jsxs("div",{className:"request-detail-page__title-section",children:[a.jsxs("div",{className:"request-detail-page__type-badge",children:[l.type==="bug"?a.jsx(Dy,{size:20,className:"request-detail-page__type-icon"}):a.jsx(Li,{size:20,className:"request-detail-page__type-icon"}),a.jsx("span",{children:l.type==="bug"?"Bug":"Feature"})]}),a.jsx("h1",{children:l.title}),a.jsxs("div",{className:"request-detail-page__meta",children:[a.jsx(pj,{status:l.status}),l.priority&&a.jsxs("span",{className:"request-detail-page__priority",children:["Priority: ",l.priority]}),l.isInBacklog&&a.jsx("span",{className:"request-detail-page__backlog-badge",children:"In Backlog"})]})]})]}),a.jsx("div",{className:"request-detail-page__content",children:a.jsxs("div",{className:"request-detail-page__main",children:[a.jsxs("div",{className:"request-detail-page__section",children:[a.jsx("h2",{children:"Description"}),a.jsx("div",{className:"request-detail-page__description",children:l.description.split(`
`).map((j,z)=>a.jsx("p",{children:j},z))})]}),a.jsxs("div",{className:"request-detail-page__section",children:[a.jsx("h2",{children:"Details"}),a.jsxs("dl",{className:"request-detail-page__details",children:[a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Created by:"}),a.jsx("dd",{children:l.creator?.username||"Unknown"})]}),a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Created:"}),a.jsx("dd",{children:new Date(l.createdAt).toLocaleString()})]}),l.assignee&&a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Assigned to:"}),a.jsx("dd",{children:l.assignee.username})]}),l.tester&&a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Tester:"}),a.jsx("dd",{children:l.tester.username})]}),l.updatedAt!==l.createdAt&&a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Last updated:"}),a.jsx("dd",{children:new Date(l.updatedAt).toLocaleString()})]})]})]}),i&&a.jsxs("div",{className:"request-detail-page__section",children:[a.jsxs("div",{className:"request-detail-page__admin-header",children:[a.jsx("h2",{children:"Admin Controls"}),a.jsxs("button",{onClick:()=>N(!w),className:`request-detail-page__admin-toggle ${w?"request-detail-page__admin-toggle--active":""}`,type:"button",children:[a.jsx(E1,{size:18}),a.jsx("span",{children:w?"Hide Controls":"Show Controls"}),a.jsx(Vr,{size:16,className:`request-detail-page__admin-toggle-icon ${w?"request-detail-page__admin-toggle-icon--rotated":""}`})]})]}),w&&a.jsxs("div",{className:"request-detail-page__admin-form",children:[a.jsxs("div",{className:"request-detail-page__admin-field",children:[a.jsx("label",{children:"Status:"}),a.jsxs("select",{value:E.status,onChange:j=>C(z=>({...z,status:j.target.value})),className:"request-detail-page__admin-select",children:[a.jsx("option",{value:"open",children:"Open"}),a.jsx("option",{value:"in_progress",children:"In Progress"}),a.jsx("option",{value:"testing",children:"Testing"}),a.jsx("option",{value:"resolved",children:"Resolved"}),a.jsx("option",{value:"closed",children:"Closed"}),a.jsx("option",{value:"backlog",children:"Backlog"})]})]}),a.jsxs("div",{className:"request-detail-page__admin-field",children:[a.jsx("label",{children:"Tester:"}),a.jsxs("select",{value:E.testerId,onChange:j=>C(z=>({...z,testerId:j.target.value})),className:"request-detail-page__admin-select",disabled:v,children:[a.jsx("option",{value:"",children:"None"}),y.map(j=>a.jsxs("option",{value:j.id,children:[j.username," ",j.email?`(${j.email})`:""]},j.id))]})]}),a.jsxs("div",{className:"request-detail-page__admin-field",children:[a.jsx("label",{children:"Priority:"}),a.jsxs("select",{value:E.priority,onChange:j=>C(z=>({...z,priority:j.target.value})),className:"request-detail-page__admin-select",children:[a.jsx("option",{value:"",children:"None"}),a.jsx("option",{value:"low",children:"Low"}),a.jsx("option",{value:"medium",children:"Medium"}),a.jsx("option",{value:"high",children:"High"})]})]}),a.jsx("div",{className:"request-detail-page__admin-field",children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:E.isInBacklog,onChange:j=>C(z=>({...z,isInBacklog:j.target.checked}))}),"In Backlog"]})}),a.jsxs("div",{className:"request-detail-page__admin-actions",children:[a.jsx("button",{onClick:_,disabled:h,className:"request-detail-page__admin-save",children:h?"Saving...":"Save Changes"}),a.jsxs("button",{onClick:k,className:"request-detail-page__admin-delete",children:[a.jsx(ua,{size:16}),"Delete Request"]})]})]})]}),a.jsx(D$,{requestId:e,canAddNote:D})]})})]}):null}function L$(){const e=$n(),[t,r]=u.useState(!1),[i,l]=u.useState({type:"bug",title:"",description:"",priority:""}),[c,f]=u.useState({}),m=y=>{const{name:g,value:v}=y.target;l(S=>({...S,[g]:v})),c[g]&&f(S=>({...S,[g]:""}))},h=()=>{const y={};return i.title.trim()||(y.title="Title is required"),i.description.trim()||(y.description="Description is required"),f(y),Object.keys(y).length===0},p=async y=>{if(y.preventDefault(),!!h()){r(!0);try{const g={type:i.type,title:i.title.trim(),description:i.description.trim(),priority:i.priority||null},v=await E$(g);if(v?.success&&v?.data?.id)e(`/requests/${v.data.id}`);else throw new Error("Failed to create request")}catch(g){console.error("Failed to create request",g),alert(g.message||"Failed to create request")}finally{r(!1)}}};return a.jsxs("div",{className:"create-request-page",children:[a.jsxs("div",{className:"create-request-page__header",children:[a.jsxs("button",{onClick:()=>e("/requests"),className:"create-request-page__back",children:[a.jsx(Ry,{size:20}),"Back to Feature/Bugs"]}),a.jsx("h1",{children:"Create Feature/Bug Request"})]}),a.jsxs("form",{onSubmit:p,className:"create-request-form",children:[a.jsxs("div",{className:"create-request-form__section",children:[a.jsx("label",{className:"create-request-form__label",children:"Type"}),a.jsxs("div",{className:"create-request-form__type-options",children:[a.jsxs("label",{className:"create-request-form__type-option",children:[a.jsx("input",{type:"radio",name:"type",value:"bug",checked:i.type==="bug",onChange:m}),a.jsx(Dy,{size:20}),a.jsx("span",{children:"Bug"})]}),a.jsxs("label",{className:"create-request-form__type-option",children:[a.jsx("input",{type:"radio",name:"type",value:"feature",checked:i.type==="feature",onChange:m}),a.jsx(Li,{size:20}),a.jsx("span",{children:"Feature"})]})]})]}),a.jsxs("div",{className:"create-request-form__section",children:[a.jsxs("label",{htmlFor:"title",className:"create-request-form__label",children:["Title ",a.jsx("span",{className:"create-request-form__required",children:"*"})]}),a.jsx("input",{id:"title",name:"title",type:"text",value:i.title,onChange:m,className:`create-request-form__input ${c.title?"create-request-form__input--error":""}`,placeholder:"Brief description of the issue or feature",disabled:t}),c.title&&a.jsx("div",{className:"create-request-form__error",children:c.title})]}),a.jsxs("div",{className:"create-request-form__section",children:[a.jsxs("label",{htmlFor:"description",className:"create-request-form__label",children:["Description ",a.jsx("span",{className:"create-request-form__required",children:"*"})]}),a.jsx("textarea",{id:"description",name:"description",value:i.description,onChange:m,className:`create-request-form__textarea ${c.description?"create-request-form__textarea--error":""}`,placeholder:"Provide detailed information about the bug or feature request...",rows:8,disabled:t}),c.description&&a.jsx("div",{className:"create-request-form__error",children:c.description})]}),a.jsxs("div",{className:"create-request-form__section",children:[a.jsx("label",{htmlFor:"priority",className:"create-request-form__label",children:"Priority (optional)"}),a.jsxs("select",{id:"priority",name:"priority",value:i.priority,onChange:m,className:"create-request-form__select",disabled:t,children:[a.jsx("option",{value:"",children:"None"}),a.jsx("option",{value:"low",children:"Low"}),a.jsx("option",{value:"medium",children:"Medium"}),a.jsx("option",{value:"high",children:"High"})]})]}),a.jsxs("div",{className:"create-request-form__actions",children:[a.jsx("button",{type:"button",onClick:()=>e("/requests"),className:"create-request-form__cancel",disabled:t,children:"Cancel"}),a.jsx("button",{type:"submit",className:"create-request-form__submit",disabled:t,children:t?"Creating...":"Submit Request"})]})]})]})}const O$=M2(i2(a.jsxs(a.Fragment,{children:[a.jsx(Xt,{path:"/login",element:a.jsx($3,{})}),a.jsxs(Xt,{path:"/",element:a.jsx(QI,{children:a.jsx(rk,{})}),children:[a.jsx(Xt,{index:!0,element:a.jsx(lk,{})}),a.jsx(Xt,{path:"worlds",element:a.jsx(Zk,{})}),a.jsx(Xt,{path:"worlds/:id",element:a.jsx(s3,{})}),a.jsx(Xt,{path:"worlds/:worldId/access/bulk",element:a.jsx(Ow,{})}),a.jsx(Xt,{path:"worlds/:worldId/access/audit",element:a.jsx(d$,{})}),a.jsx(Xt,{path:"worlds/:worldId/collections",element:a.jsx(f$,{})}),a.jsx(Xt,{path:"campaigns/:campaignId/access/bulk",element:a.jsx(Ow,{})}),a.jsxs(Xt,{path:"campaigns",children:[a.jsx(Xt,{index:!0,element:a.jsx(Xo,{to:"/campaigns/my",replace:!0})}),a.jsx(Xt,{path:"my",element:a.jsx(qu,{scope:"my"})}),a.jsx(Xt,{path:"my/:id",element:a.jsx(qu,{scope:"my"})}),a.jsx(Xt,{path:"all",element:a.jsx(qu,{scope:"all"})}),a.jsx(Xt,{path:"all/:id",element:a.jsx(qu,{scope:"all"})})]}),a.jsx(Xt,{path:"entities",element:a.jsx(l4,{})}),a.jsx(Xt,{path:"entities/bulk-upload",element:a.jsx(qz,{})}),a.jsx(Xt,{path:"entities/followed",element:a.jsx(S$,{})}),a.jsx(Xt,{path:"entities/:entityId/relationship-viewer",element:a.jsx($z,{})}),a.jsx(Xt,{path:"entities/:id",element:a.jsx(iI,{})}),a.jsxs(Xt,{path:"entity-types",children:[a.jsx(Xt,{index:!0,element:a.jsx(cI,{})}),a.jsx(Xt,{path:"new",element:a.jsx(CI,{})}),a.jsx(Xt,{path:":id/fields",element:a.jsx(NI,{})})]}),a.jsxs(Xt,{path:"relationship-types",children:[a.jsx(Xt,{index:!0,element:a.jsx(XI,{})}),a.jsx(Xt,{path:"new",element:a.jsx(KI,{})}),a.jsx(Xt,{path:":id/edit",element:a.jsx(WI,{})})]}),a.jsx(Xt,{path:"entity-relationships",element:a.jsx(PI,{})}),a.jsx(Xt,{path:"entity-secrets",element:a.jsx(ZI,{})}),a.jsxs(Xt,{path:"notes",children:[a.jsx(Xt,{index:!0,element:a.jsx(Xo,{to:"/notes/session",replace:!0})}),a.jsx(Xt,{path:"session",element:a.jsx(Yz,{})}),a.jsx(Xt,{path:"entities",element:a.jsx(Jz,{})})]}),a.jsxs(Xt,{path:"characters",children:[a.jsx(Xt,{index:!0,element:a.jsx(Xo,{to:"/characters/my",replace:!0})}),a.jsx(Xt,{path:"my",element:a.jsx(zr,{scope:"my"})}),a.jsx(Xt,{path:"my/:id",element:a.jsx(zr,{scope:"my"})}),a.jsx(Xt,{path:"others",element:a.jsx(zr,{scope:"others"})}),a.jsx(Xt,{path:"others/:id",element:a.jsx(zr,{scope:"others"})}),a.jsx(Xt,{path:"companions",element:a.jsx(zr,{scope:"companions"})}),a.jsx(Xt,{path:"companions/:id",element:a.jsx(zr,{scope:"companions"})}),a.jsx(Xt,{path:"all",element:a.jsx(zr,{scope:"all"})}),a.jsx(Xt,{path:"all/:id",element:a.jsx(zr,{scope:"all"})})]}),a.jsx(Xt,{path:"users",element:a.jsx(z3,{})}),a.jsx(Xt,{path:"security",element:a.jsx(y$,{})}),a.jsx(Xt,{path:"notifications",element:a.jsx(x$,{})}),a.jsxs(Xt,{path:"requests",children:[a.jsx(Xt,{index:!0,element:a.jsx(T$,{})}),a.jsx(Xt,{path:"new",element:a.jsx(L$,{})}),a.jsx(Xt,{path:":id",element:a.jsx(I$,{})})]})]}),a.jsx(Xt,{path:"*",element:a.jsx(Xo,{to:"/",replace:!0})})]})));function z$(){return a.jsx(P2,{router:O$})}TC.createRoot(document.getElementById("root")).render(a.jsx(u.StrictMode,{children:a.jsx(QM,{children:a.jsx(MI,{children:a.jsx(DM,{children:a.jsx(WM,{children:a.jsx(AR,{children:a.jsx(z$,{})})})})})})}));

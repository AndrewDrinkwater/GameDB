(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function r(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(l){if(l.ep)return;l.ep=!0;const c=r(l);fetch(l.href,c)}})();function ki(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Nh={exports:{}},Ao={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wx;function SC(){if(Wx)return Ao;Wx=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function r(i,l,c){var f=null;if(c!==void 0&&(f=""+c),l.key!==void 0&&(f=""+l.key),"key"in l){c={};for(var m in l)m!=="key"&&(c[m]=l[m])}else c=l;return l=c.ref,{$$typeof:e,type:i,key:f,ref:l!==void 0?l:null,props:c}}return Ao.Fragment=t,Ao.jsx=r,Ao.jsxs=r,Ao}var Zx;function wC(){return Zx||(Zx=1,Nh.exports=SC()),Nh.exports}var a=wC(),Eh={exports:{}},en={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qx;function NC(){if(Qx)return en;Qx=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),f=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),v=Symbol.iterator;function S(R){return R===null||typeof R!="object"?null:(R=v&&R[v]||R["@@iterator"],typeof R=="function"?R:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N=Object.assign,j={};function _(R,q,G){this.props=R,this.context=q,this.refs=j,this.updater=G||w}_.prototype.isReactComponent={},_.prototype.setState=function(R,q){if(typeof R!="object"&&typeof R!="function"&&R!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,R,q,"setState")},_.prototype.forceUpdate=function(R){this.updater.enqueueForceUpdate(this,R,"forceUpdate")};function C(){}C.prototype=_.prototype;function O(R,q,G){this.props=R,this.context=q,this.refs=j,this.updater=G||w}var E=O.prototype=new C;E.constructor=O,N(E,_.prototype),E.isPureReactComponent=!0;var T=Array.isArray;function M(){}var A={H:null,A:null,T:null,S:null},z=Object.prototype.hasOwnProperty;function P(R,q,G){var J=G.ref;return{$$typeof:e,type:R,key:q,ref:J!==void 0?J:null,props:G}}function X(R,q){return P(R.type,q,R.props)}function H(R){return typeof R=="object"&&R!==null&&R.$$typeof===e}function Y(R){var q={"=":"=0",":":"=2"};return"$"+R.replace(/[=:]/g,function(G){return q[G]})}var V=/\/+/g;function I(R,q){return typeof R=="object"&&R!==null&&R.key!=null?Y(""+R.key):q.toString(36)}function F(R){switch(R.status){case"fulfilled":return R.value;case"rejected":throw R.reason;default:switch(typeof R.status=="string"?R.then(M,M):(R.status="pending",R.then(function(q){R.status==="pending"&&(R.status="fulfilled",R.value=q)},function(q){R.status==="pending"&&(R.status="rejected",R.reason=q)})),R.status){case"fulfilled":return R.value;case"rejected":throw R.reason}}throw R}function D(R,q,G,J,ie){var Z=typeof R;(Z==="undefined"||Z==="boolean")&&(R=null);var me=!1;if(R===null)me=!0;else switch(Z){case"bigint":case"string":case"number":me=!0;break;case"object":switch(R.$$typeof){case e:case t:me=!0;break;case y:return me=R._init,D(me(R._payload),q,G,J,ie)}}if(me)return ie=ie(R),me=J===""?"."+I(R,0):J,T(ie)?(G="",me!=null&&(G=me.replace(V,"$&/")+"/"),D(ie,q,G,"",function(ne){return ne})):ie!=null&&(H(ie)&&(ie=X(ie,G+(ie.key==null||R&&R.key===ie.key?"":(""+ie.key).replace(V,"$&/")+"/")+me)),q.push(ie)),1;me=0;var Q=J===""?".":J+":";if(T(R))for(var oe=0;oe<R.length;oe++)J=R[oe],Z=Q+I(J,oe),me+=D(J,q,G,Z,ie);else if(oe=S(R),typeof oe=="function")for(R=oe.call(R),oe=0;!(J=R.next()).done;)J=J.value,Z=Q+I(J,oe++),me+=D(J,q,G,Z,ie);else if(Z==="object"){if(typeof R.then=="function")return D(F(R),q,G,J,ie);throw q=String(R),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(R).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return me}function L(R,q,G){if(R==null)return R;var J=[],ie=0;return D(R,J,"","",function(Z){return q.call(G,Z,ie++)}),J}function U(R){if(R._status===-1){var q=R._result;q=q(),q.then(function(G){(R._status===0||R._status===-1)&&(R._status=1,R._result=G)},function(G){(R._status===0||R._status===-1)&&(R._status=2,R._result=G)}),R._status===-1&&(R._status=0,R._result=q)}if(R._status===1)return R._result.default;throw R._result}var k=typeof reportError=="function"?reportError:function(R){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof R=="object"&&R!==null&&typeof R.message=="string"?String(R.message):String(R),error:R});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",R);return}console.error(R)},B={map:L,forEach:function(R,q,G){L(R,function(){q.apply(this,arguments)},G)},count:function(R){var q=0;return L(R,function(){q++}),q},toArray:function(R){return L(R,function(q){return q})||[]},only:function(R){if(!H(R))throw Error("React.Children.only expected to receive a single React element child.");return R}};return en.Activity=g,en.Children=B,en.Component=_,en.Fragment=r,en.Profiler=l,en.PureComponent=O,en.StrictMode=i,en.Suspense=h,en.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,en.__COMPILER_RUNTIME={__proto__:null,c:function(R){return A.H.useMemoCache(R)}},en.cache=function(R){return function(){return R.apply(null,arguments)}},en.cacheSignal=function(){return null},en.cloneElement=function(R,q,G){if(R==null)throw Error("The argument must be a React element, but you passed "+R+".");var J=N({},R.props),ie=R.key;if(q!=null)for(Z in q.key!==void 0&&(ie=""+q.key),q)!z.call(q,Z)||Z==="key"||Z==="__self"||Z==="__source"||Z==="ref"&&q.ref===void 0||(J[Z]=q[Z]);var Z=arguments.length-2;if(Z===1)J.children=G;else if(1<Z){for(var me=Array(Z),Q=0;Q<Z;Q++)me[Q]=arguments[Q+2];J.children=me}return P(R.type,ie,J)},en.createContext=function(R){return R={$$typeof:f,_currentValue:R,_currentValue2:R,_threadCount:0,Provider:null,Consumer:null},R.Provider=R,R.Consumer={$$typeof:c,_context:R},R},en.createElement=function(R,q,G){var J,ie={},Z=null;if(q!=null)for(J in q.key!==void 0&&(Z=""+q.key),q)z.call(q,J)&&J!=="key"&&J!=="__self"&&J!=="__source"&&(ie[J]=q[J]);var me=arguments.length-2;if(me===1)ie.children=G;else if(1<me){for(var Q=Array(me),oe=0;oe<me;oe++)Q[oe]=arguments[oe+2];ie.children=Q}if(R&&R.defaultProps)for(J in me=R.defaultProps,me)ie[J]===void 0&&(ie[J]=me[J]);return P(R,Z,ie)},en.createRef=function(){return{current:null}},en.forwardRef=function(R){return{$$typeof:m,render:R}},en.isValidElement=H,en.lazy=function(R){return{$$typeof:y,_payload:{_status:-1,_result:R},_init:U}},en.memo=function(R,q){return{$$typeof:p,type:R,compare:q===void 0?null:q}},en.startTransition=function(R){var q=A.T,G={};A.T=G;try{var J=R(),ie=A.S;ie!==null&&ie(G,J),typeof J=="object"&&J!==null&&typeof J.then=="function"&&J.then(M,k)}catch(Z){k(Z)}finally{q!==null&&G.types!==null&&(q.types=G.types),A.T=q}},en.unstable_useCacheRefresh=function(){return A.H.useCacheRefresh()},en.use=function(R){return A.H.use(R)},en.useActionState=function(R,q,G){return A.H.useActionState(R,q,G)},en.useCallback=function(R,q){return A.H.useCallback(R,q)},en.useContext=function(R){return A.H.useContext(R)},en.useDebugValue=function(){},en.useDeferredValue=function(R,q){return A.H.useDeferredValue(R,q)},en.useEffect=function(R,q){return A.H.useEffect(R,q)},en.useEffectEvent=function(R){return A.H.useEffectEvent(R)},en.useId=function(){return A.H.useId()},en.useImperativeHandle=function(R,q,G){return A.H.useImperativeHandle(R,q,G)},en.useInsertionEffect=function(R,q){return A.H.useInsertionEffect(R,q)},en.useLayoutEffect=function(R,q){return A.H.useLayoutEffect(R,q)},en.useMemo=function(R,q){return A.H.useMemo(R,q)},en.useOptimistic=function(R,q){return A.H.useOptimistic(R,q)},en.useReducer=function(R,q,G){return A.H.useReducer(R,q,G)},en.useRef=function(R){return A.H.useRef(R)},en.useState=function(R){return A.H.useState(R)},en.useSyncExternalStore=function(R,q,G){return A.H.useSyncExternalStore(R,q,G)},en.useTransition=function(){return A.H.useTransition()},en.version="19.2.0",en}var Jx;function wc(){return Jx||(Jx=1,Eh.exports=NC()),Eh.exports}var u=wc();const De=ki(u);var jh={exports:{}},To={},_h={exports:{}},Ch={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var e0;function EC(){return e0||(e0=1,(function(e){function t(D,L){var U=D.length;D.push(L);e:for(;0<U;){var k=U-1>>>1,B=D[k];if(0<l(B,L))D[k]=L,D[U]=B,U=k;else break e}}function r(D){return D.length===0?null:D[0]}function i(D){if(D.length===0)return null;var L=D[0],U=D.pop();if(U!==L){D[0]=U;e:for(var k=0,B=D.length,R=B>>>1;k<R;){var q=2*(k+1)-1,G=D[q],J=q+1,ie=D[J];if(0>l(G,U))J<B&&0>l(ie,G)?(D[k]=ie,D[J]=U,k=J):(D[k]=G,D[q]=U,k=q);else if(J<B&&0>l(ie,U))D[k]=ie,D[J]=U,k=J;else break e}}return L}function l(D,L){var U=D.sortIndex-L.sortIndex;return U!==0?U:D.id-L.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;e.unstable_now=function(){return c.now()}}else{var f=Date,m=f.now();e.unstable_now=function(){return f.now()-m}}var h=[],p=[],y=1,g=null,v=3,S=!1,w=!1,N=!1,j=!1,_=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;function E(D){for(var L=r(p);L!==null;){if(L.callback===null)i(p);else if(L.startTime<=D)i(p),L.sortIndex=L.expirationTime,t(h,L);else break;L=r(p)}}function T(D){if(N=!1,E(D),!w)if(r(h)!==null)w=!0,M||(M=!0,Y());else{var L=r(p);L!==null&&F(T,L.startTime-D)}}var M=!1,A=-1,z=5,P=-1;function X(){return j?!0:!(e.unstable_now()-P<z)}function H(){if(j=!1,M){var D=e.unstable_now();P=D;var L=!0;try{e:{w=!1,N&&(N=!1,C(A),A=-1),S=!0;var U=v;try{t:{for(E(D),g=r(h);g!==null&&!(g.expirationTime>D&&X());){var k=g.callback;if(typeof k=="function"){g.callback=null,v=g.priorityLevel;var B=k(g.expirationTime<=D);if(D=e.unstable_now(),typeof B=="function"){g.callback=B,E(D),L=!0;break t}g===r(h)&&i(h),E(D)}else i(h);g=r(h)}if(g!==null)L=!0;else{var R=r(p);R!==null&&F(T,R.startTime-D),L=!1}}break e}finally{g=null,v=U,S=!1}L=void 0}}finally{L?Y():M=!1}}}var Y;if(typeof O=="function")Y=function(){O(H)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,I=V.port2;V.port1.onmessage=H,Y=function(){I.postMessage(null)}}else Y=function(){_(H,0)};function F(D,L){A=_(function(){D(e.unstable_now())},L)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(D){D.callback=null},e.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):z=0<D?Math.floor(1e3/D):5},e.unstable_getCurrentPriorityLevel=function(){return v},e.unstable_next=function(D){switch(v){case 1:case 2:case 3:var L=3;break;default:L=v}var U=v;v=L;try{return D()}finally{v=U}},e.unstable_requestPaint=function(){j=!0},e.unstable_runWithPriority=function(D,L){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var U=v;v=D;try{return L()}finally{v=U}},e.unstable_scheduleCallback=function(D,L,U){var k=e.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?k+U:k):U=k,D){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=U+B,D={id:y++,callback:L,priorityLevel:D,startTime:U,expirationTime:B,sortIndex:-1},U>k?(D.sortIndex=U,t(p,D),r(h)===null&&D===r(p)&&(N?(C(A),A=-1):N=!0,F(T,U-k))):(D.sortIndex=B,t(h,D),w||S||(w=!0,M||(M=!0,Y()))),D},e.unstable_shouldYield=X,e.unstable_wrapCallback=function(D){var L=v;return function(){var U=v;v=L;try{return D.apply(this,arguments)}finally{v=U}}}})(Ch)),Ch}var t0;function jC(){return t0||(t0=1,_h.exports=EC()),_h.exports}var Ah={exports:{}},ya={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n0;function _C(){if(n0)return ya;n0=1;var e=wc();function t(h){var p="https://react.dev/errors/"+h;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)p+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+h+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var i={d:{f:r,r:function(){throw Error(t(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},l=Symbol.for("react.portal");function c(h,p,y){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:g==null?null:""+g,children:h,containerInfo:p,implementation:y}}var f=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function m(h,p){if(h==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return ya.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,ya.createPortal=function(h,p){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(t(299));return c(h,p,null,y)},ya.flushSync=function(h){var p=f.T,y=i.p;try{if(f.T=null,i.p=2,h)return h()}finally{f.T=p,i.p=y,i.d.f()}},ya.preconnect=function(h,p){typeof h=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,i.d.C(h,p))},ya.prefetchDNS=function(h){typeof h=="string"&&i.d.D(h)},ya.preinit=function(h,p){if(typeof h=="string"&&p&&typeof p.as=="string"){var y=p.as,g=m(y,p.crossOrigin),v=typeof p.integrity=="string"?p.integrity:void 0,S=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;y==="style"?i.d.S(h,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:g,integrity:v,fetchPriority:S}):y==="script"&&i.d.X(h,{crossOrigin:g,integrity:v,fetchPriority:S,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},ya.preinitModule=function(h,p){if(typeof h=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var y=m(p.as,p.crossOrigin);i.d.M(h,{crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&i.d.M(h)},ya.preload=function(h,p){if(typeof h=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var y=p.as,g=m(y,p.crossOrigin);i.d.L(h,y,{crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},ya.preloadModule=function(h,p){if(typeof h=="string")if(p){var y=m(p.as,p.crossOrigin);i.d.m(h,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else i.d.m(h)},ya.requestFormReset=function(h){i.d.r(h)},ya.unstable_batchedUpdates=function(h,p){return h(p)},ya.useFormState=function(h,p,y){return f.H.useFormState(h,p,y)},ya.useFormStatus=function(){return f.H.useHostTransitionStatus()},ya.version="19.2.0",ya}var a0;function Uw(){if(a0)return Ah.exports;a0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Ah.exports=_C(),Ah.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s0;function CC(){if(s0)return To;s0=1;var e=jC(),t=wc(),r=Uw();function i(n){var s="https://react.dev/errors/"+n;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)s+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+n+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function c(n){var s=n,o=n;if(n.alternate)for(;s.return;)s=s.return;else{n=s;do s=n,(s.flags&4098)!==0&&(o=s.return),n=s.return;while(n)}return s.tag===3?o:null}function f(n){if(n.tag===13){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function m(n){if(n.tag===31){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function h(n){if(c(n)!==n)throw Error(i(188))}function p(n){var s=n.alternate;if(!s){if(s=c(n),s===null)throw Error(i(188));return s!==n?null:n}for(var o=n,d=s;;){var b=o.return;if(b===null)break;var x=b.alternate;if(x===null){if(d=b.return,d!==null){o=d;continue}break}if(b.child===x.child){for(x=b.child;x;){if(x===o)return h(b),n;if(x===d)return h(b),s;x=x.sibling}throw Error(i(188))}if(o.return!==d.return)o=b,d=x;else{for(var $=!1,K=b.child;K;){if(K===o){$=!0,o=b,d=x;break}if(K===d){$=!0,d=b,o=x;break}K=K.sibling}if(!$){for(K=x.child;K;){if(K===o){$=!0,o=x,d=b;break}if(K===d){$=!0,d=x,o=b;break}K=K.sibling}if(!$)throw Error(i(189))}}if(o.alternate!==d)throw Error(i(190))}if(o.tag!==3)throw Error(i(188));return o.stateNode.current===o?n:s}function y(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n;for(n=n.child;n!==null;){if(s=y(n),s!==null)return s;n=n.sibling}return null}var g=Object.assign,v=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),O=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),z=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),X=Symbol.for("react.memo_cache_sentinel"),H=Symbol.iterator;function Y(n){return n===null||typeof n!="object"?null:(n=H&&n[H]||n["@@iterator"],typeof n=="function"?n:null)}var V=Symbol.for("react.client.reference");function I(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===V?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case N:return"Fragment";case _:return"Profiler";case j:return"StrictMode";case T:return"Suspense";case M:return"SuspenseList";case P:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case w:return"Portal";case O:return n.displayName||"Context";case C:return(n._context.displayName||"Context")+".Consumer";case E:var s=n.render;return n=n.displayName,n||(n=s.displayName||s.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case A:return s=n.displayName||null,s!==null?s:I(n.type)||"Memo";case z:s=n._payload,n=n._init;try{return I(n(s))}catch{}}return null}var F=Array.isArray,D=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,U={pending:!1,data:null,method:null,action:null},k=[],B=-1;function R(n){return{current:n}}function q(n){0>B||(n.current=k[B],k[B]=null,B--)}function G(n,s){B++,k[B]=n.current,n.current=s}var J=R(null),ie=R(null),Z=R(null),me=R(null);function Q(n,s){switch(G(Z,s),G(ie,n),G(J,null),s.nodeType){case 9:case 11:n=(n=s.documentElement)&&(n=n.namespaceURI)?vx(n):0;break;default:if(n=s.tagName,s=s.namespaceURI)s=vx(s),n=xx(s,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}q(J),G(J,n)}function oe(){q(J),q(ie),q(Z)}function ne(n){n.memoizedState!==null&&G(me,n);var s=J.current,o=xx(s,n.type);s!==o&&(G(ie,n),G(J,o))}function we(n){ie.current===n&&(q(J),q(ie)),me.current===n&&(q(me),Eo._currentValue=U)}var ke,Re;function Te(n){if(ke===void 0)try{throw Error()}catch(o){var s=o.stack.trim().match(/\n( *(at )?)/);ke=s&&s[1]||"",Re=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ke+n+Re}var rt=!1;function He(n,s){if(!n||rt)return"";rt=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(s){var lt=function(){throw Error()};if(Object.defineProperty(lt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(lt,[])}catch(Ye){var Ue=Ye}Reflect.construct(n,[],lt)}else{try{lt.call()}catch(Ye){Ue=Ye}n.call(lt.prototype)}}else{try{throw Error()}catch(Ye){Ue=Ye}(lt=n())&&typeof lt.catch=="function"&&lt.catch(function(){})}}catch(Ye){if(Ye&&Ue&&typeof Ye.stack=="string")return[Ye.stack,Ue.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=d.DetermineComponentFrameRoot(),$=x[0],K=x[1];if($&&K){var pe=$.split(`
`),Oe=K.split(`
`);for(b=d=0;d<pe.length&&!pe[d].includes("DetermineComponentFrameRoot");)d++;for(;b<Oe.length&&!Oe[b].includes("DetermineComponentFrameRoot");)b++;if(d===pe.length||b===Oe.length)for(d=pe.length-1,b=Oe.length-1;1<=d&&0<=b&&pe[d]!==Oe[b];)b--;for(;1<=d&&0<=b;d--,b--)if(pe[d]!==Oe[b]){if(d!==1||b!==1)do if(d--,b--,0>b||pe[d]!==Oe[b]){var Je=`
`+pe[d].replace(" at new "," at ");return n.displayName&&Je.includes("<anonymous>")&&(Je=Je.replace("<anonymous>",n.displayName)),Je}while(1<=d&&0<=b);break}}}finally{rt=!1,Error.prepareStackTrace=o}return(o=n?n.displayName||n.name:"")?Te(o):""}function tt(n,s){switch(n.tag){case 26:case 27:case 5:return Te(n.type);case 16:return Te("Lazy");case 13:return n.child!==s&&s!==null?Te("Suspense Fallback"):Te("Suspense");case 19:return Te("SuspenseList");case 0:case 15:return He(n.type,!1);case 11:return He(n.type.render,!1);case 1:return He(n.type,!0);case 31:return Te("Activity");default:return""}}function Ie(n){try{var s="",o=null;do s+=tt(n,o),o=n,n=n.return;while(n);return s}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var vt=Object.prototype.hasOwnProperty,Ct=e.unstable_scheduleCallback,At=e.unstable_cancelCallback,_t=e.unstable_shouldYield,Pe=e.unstable_requestPaint,Ze=e.unstable_now,W=e.unstable_getCurrentPriorityLevel,ee=e.unstable_ImmediatePriority,te=e.unstable_UserBlockingPriority,ve=e.unstable_NormalPriority,le=e.unstable_LowPriority,Se=e.unstable_IdlePriority,Ee=e.log,ge=e.unstable_setDisableYieldValue,at=null,st=null;function nt(n){if(typeof Ee=="function"&&ge(n),st&&typeof st.setStrictMode=="function")try{st.setStrictMode(at,n)}catch{}}var $e=Math.clz32?Math.clz32:Rt,ft=Math.log,zt=Math.LN2;function Rt(n){return n>>>=0,n===0?32:31-(ft(n)/zt|0)|0}var pt=256,ct=262144,yt=4194304;function Mt(n){var s=n&42;if(s!==0)return s;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return n&261888;case 262144:case 524288:case 1048576:case 2097152:return n&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function Ft(n,s,o){var d=n.pendingLanes;if(d===0)return 0;var b=0,x=n.suspendedLanes,$=n.pingedLanes;n=n.warmLanes;var K=d&134217727;return K!==0?(d=K&~x,d!==0?b=Mt(d):($&=K,$!==0?b=Mt($):o||(o=K&~n,o!==0&&(b=Mt(o))))):(K=d&~x,K!==0?b=Mt(K):$!==0?b=Mt($):o||(o=d&~n,o!==0&&(b=Mt(o)))),b===0?0:s!==0&&s!==b&&(s&x)===0&&(x=b&-b,o=s&-s,x>=o||x===32&&(o&4194048)!==0)?s:b}function kt(n,s){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&s)===0}function Zt(n,s){switch(n){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Lt(){var n=yt;return yt<<=1,(yt&62914560)===0&&(yt=4194304),n}function Kt(n){for(var s=[],o=0;31>o;o++)s.push(n);return s}function se(n,s){n.pendingLanes|=s,s!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function be(n,s,o,d,b,x){var $=n.pendingLanes;n.pendingLanes=o,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=o,n.entangledLanes&=o,n.errorRecoveryDisabledLanes&=o,n.shellSuspendCounter=0;var K=n.entanglements,pe=n.expirationTimes,Oe=n.hiddenUpdates;for(o=$&~o;0<o;){var Je=31-$e(o),lt=1<<Je;K[Je]=0,pe[Je]=-1;var Ue=Oe[Je];if(Ue!==null)for(Oe[Je]=null,Je=0;Je<Ue.length;Je++){var Ye=Ue[Je];Ye!==null&&(Ye.lane&=-536870913)}o&=~lt}d!==0&&je(n,d,0),x!==0&&b===0&&n.tag!==0&&(n.suspendedLanes|=x&~($&~s))}function je(n,s,o){n.pendingLanes|=s,n.suspendedLanes&=~s;var d=31-$e(s);n.entangledLanes|=s,n.entanglements[d]=n.entanglements[d]|1073741824|o&261930}function We(n,s){var o=n.entangledLanes|=s;for(n=n.entanglements;o;){var d=31-$e(o),b=1<<d;b&s|n[d]&s&&(n[d]|=s),o&=~b}}function dt(n,s){var o=s&-s;return o=(o&42)!==0?1:gt(o),(o&(n.suspendedLanes|s))!==0?0:o}function gt(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function ce(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function re(){var n=L.p;return n!==0?n:(n=window.event,n===void 0?32:Hx(n.type))}function Ne(n,s){var o=L.p;try{return L.p=n,s()}finally{L.p=o}}var Be=Math.random().toString(36).slice(2),Ke="__reactFiber$"+Be,ot="__reactProps$"+Be,ze="__reactContainer$"+Be,ue="__reactEvents$"+Be,qe="__reactListeners$"+Be,Ge="__reactHandles$"+Be,ut="__reactResources$"+Be,ae="__reactMarker$"+Be;function Xe(n){delete n[Ke],delete n[ot],delete n[ue],delete n[qe],delete n[Ge]}function Fe(n){var s=n[Ke];if(s)return s;for(var o=n.parentNode;o;){if(s=o[ze]||o[Ke]){if(o=s.alternate,s.child!==null||o!==null&&o.child!==null)for(n=Cx(n);n!==null;){if(o=n[Ke])return o;n=Cx(n)}return s}n=o,o=n.parentNode}return null}function Qe(n){if(n=n[Ke]||n[ze]){var s=n.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return n}return null}function bt(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n.stateNode;throw Error(i(33))}function St(n){var s=n[ut];return s||(s=n[ut]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function _e(n){n[ae]=!0}var et=new Set,mt={};function fe(n,s){he(n,s),he(n+"Capture",s)}function he(n,s){for(mt[n]=s,n=0;n<s.length;n++)et.add(s[n])}var Ve=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),xt={},Nt={};function Et(n){return vt.call(Nt,n)?!0:vt.call(xt,n)?!1:Ve.test(n)?Nt[n]=!0:(xt[n]=!0,!1)}function jt(n,s,o){if(Et(s))if(o===null)n.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":n.removeAttribute(s);return;case"boolean":var d=s.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){n.removeAttribute(s);return}}n.setAttribute(s,""+o)}}function Wt(n,s,o){if(o===null)n.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(s);return}n.setAttribute(s,""+o)}}function ln(n,s,o,d){if(d===null)n.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(o);return}n.setAttributeNS(s,o,""+d)}}function dn(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Qt(n){var s=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function pa(n,s,o){var d=Object.getOwnPropertyDescriptor(n.constructor.prototype,s);if(!n.hasOwnProperty(s)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var b=d.get,x=d.set;return Object.defineProperty(n,s,{configurable:!0,get:function(){return b.call(this)},set:function($){o=""+$,x.call(this,$)}}),Object.defineProperty(n,s,{enumerable:d.enumerable}),{getValue:function(){return o},setValue:function($){o=""+$},stopTracking:function(){n._valueTracker=null,delete n[s]}}}}function Da(n){if(!n._valueTracker){var s=Qt(n)?"checked":"value";n._valueTracker=pa(n,s,""+n[s])}}function Jr(n){if(!n)return!1;var s=n._valueTracker;if(!s)return!0;var o=s.getValue(),d="";return n&&(d=Qt(n)?n.checked?"true":"false":n.value),n=d,n!==o?(s.setValue(n),!0):!1}function ur(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var Os=/[\n"\\]/g;function ia(n){return n.replace(Os,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function ei(n,s,o,d,b,x,$,K){n.name="",$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"?n.type=$:n.removeAttribute("type"),s!=null?$==="number"?(s===0&&n.value===""||n.value!=s)&&(n.value=""+dn(s)):n.value!==""+dn(s)&&(n.value=""+dn(s)):$!=="submit"&&$!=="reset"||n.removeAttribute("value"),s!=null?qn(n,$,dn(s)):o!=null?qn(n,$,dn(o)):d!=null&&n.removeAttribute("value"),b==null&&x!=null&&(n.defaultChecked=!!x),b!=null&&(n.checked=b&&typeof b!="function"&&typeof b!="symbol"),K!=null&&typeof K!="function"&&typeof K!="symbol"&&typeof K!="boolean"?n.name=""+dn(K):n.removeAttribute("name")}function ti(n,s,o,d,b,x,$,K){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(n.type=x),s!=null||o!=null){if(!(x!=="submit"&&x!=="reset"||s!=null)){Da(n);return}o=o!=null?""+dn(o):"",s=s!=null?""+dn(s):o,K||s===n.value||(n.value=s),n.defaultValue=s}d=d??b,d=typeof d!="function"&&typeof d!="symbol"&&!!d,n.checked=K?n.checked:!!d,n.defaultChecked=!!d,$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"&&(n.name=$),Da(n)}function qn(n,s,o){s==="number"&&ur(n.ownerDocument)===n||n.defaultValue===""+o||(n.defaultValue=""+o)}function Ia(n,s,o,d){if(n=n.options,s){s={};for(var b=0;b<o.length;b++)s["$"+o[b]]=!0;for(o=0;o<n.length;o++)b=s.hasOwnProperty("$"+n[o].value),n[o].selected!==b&&(n[o].selected=b),b&&d&&(n[o].defaultSelected=!0)}else{for(o=""+dn(o),s=null,b=0;b<n.length;b++){if(n[b].value===o){n[b].selected=!0,d&&(n[b].defaultSelected=!0);return}s!==null||n[b].disabled||(s=n[b])}s!==null&&(s.selected=!0)}}function ws(n,s,o){if(s!=null&&(s=""+dn(s),s!==n.value&&(n.value=s),o==null)){n.defaultValue!==s&&(n.defaultValue=s);return}n.defaultValue=o!=null?""+dn(o):""}function de(n,s,o,d){if(s==null){if(d!=null){if(o!=null)throw Error(i(92));if(F(d)){if(1<d.length)throw Error(i(93));d=d[0]}o=d}o==null&&(o=""),s=o}o=dn(s),n.defaultValue=o,d=n.textContent,d===o&&d!==""&&d!==null&&(n.value=d),Da(n)}function Ce(n,s){if(s){var o=n.firstChild;if(o&&o===n.lastChild&&o.nodeType===3){o.nodeValue=s;return}}n.textContent=s}var Bt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function pn(n,s,o){var d=s.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?d?n.setProperty(s,""):s==="float"?n.cssFloat="":n[s]="":d?n.setProperty(s,o):typeof o!="number"||o===0||Bt.has(s)?s==="float"?n.cssFloat=o:n[s]=(""+o).trim():n[s]=o+"px"}function fn(n,s,o){if(s!=null&&typeof s!="object")throw Error(i(62));if(n=n.style,o!=null){for(var d in o)!o.hasOwnProperty(d)||s!=null&&s.hasOwnProperty(d)||(d.indexOf("--")===0?n.setProperty(d,""):d==="float"?n.cssFloat="":n[d]="");for(var b in s)d=s[b],s.hasOwnProperty(b)&&o[b]!==d&&pn(n,b,d)}else for(var x in s)s.hasOwnProperty(x)&&pn(n,x,s[x])}function qt(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jn=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Hn=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Un(n){return Hn.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}function la(){}var ye=null;function Me(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var ht=null,Dt=null;function Vt(n){var s=Qe(n);if(s&&(n=s.stateNode)){var o=n[ot]||null;e:switch(n=s.stateNode,s.type){case"input":if(ei(n,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),s=o.name,o.type==="radio"&&s!=null){for(o=n;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+ia(""+s)+'"][type="radio"]'),s=0;s<o.length;s++){var d=o[s];if(d!==n&&d.form===n.form){var b=d[ot]||null;if(!b)throw Error(i(90));ei(d,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(s=0;s<o.length;s++)d=o[s],d.form===n.form&&Jr(d)}break e;case"textarea":ws(n,o.value,o.defaultValue);break e;case"select":s=o.value,s!=null&&Ia(n,!!o.multiple,s,!1)}}}var nn=!1;function xn(n,s,o){if(nn)return n(s,o);nn=!0;try{var d=n(s);return d}finally{if(nn=!1,(ht!==null||Dt!==null)&&(hu(),ht&&(s=ht,n=Dt,Dt=ht=null,Vt(s),n)))for(s=0;s<n.length;s++)Vt(n[s])}}function Gt(n,s){var o=n.stateNode;if(o===null)return null;var d=o[ot]||null;if(d===null)return null;o=d[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(n=n.type,d=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!d;break e;default:n=!1}if(n)return null;if(o&&typeof o!="function")throw Error(i(231,s,typeof o));return o}var vn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),oa=!1;if(vn)try{var Pt={};Object.defineProperty(Pt,"passive",{get:function(){oa=!0}}),window.addEventListener("test",Pt,Pt),window.removeEventListener("test",Pt,Pt)}catch{oa=!1}var Wn=null,Xa=null,Li=null;function Oi(){if(Li)return Li;var n,s=Xa,o=s.length,d,b="value"in Wn?Wn.value:Wn.textContent,x=b.length;for(n=0;n<o&&s[n]===b[n];n++);var $=o-n;for(d=1;d<=$&&s[o-d]===b[x-d];d++);return Li=b.slice(n,1<d?1-d:void 0)}function zi(n){var s=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&s===13&&(n=13)):n=s,n===10&&(n=13),32<=n||n===13?n:0}function $i(){return!0}function Sg(){return!1}function wa(n){function s(o,d,b,x,$){this._reactName=o,this._targetInst=b,this.type=d,this.nativeEvent=x,this.target=$,this.currentTarget=null;for(var K in n)n.hasOwnProperty(K)&&(o=n[K],this[K]=o?o(x):x[K]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?$i:Sg,this.isPropagationStopped=Sg,this}return g(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=$i)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=$i)},persist:function(){},isPersistent:$i}),s}var ni={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Rc=wa(ni),ql=g({},ni,{view:0,detail:0}),vj=wa(ql),jf,_f,Hl,kc=g({},ql,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Af,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Hl&&(Hl&&n.type==="mousemove"?(jf=n.screenX-Hl.screenX,_f=n.screenY-Hl.screenY):_f=jf=0,Hl=n),jf)},movementY:function(n){return"movementY"in n?n.movementY:_f}}),wg=wa(kc),xj=g({},kc,{dataTransfer:0}),Sj=wa(xj),wj=g({},ql,{relatedTarget:0}),Cf=wa(wj),Nj=g({},ni,{animationName:0,elapsedTime:0,pseudoElement:0}),Ej=wa(Nj),jj=g({},ni,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),_j=wa(jj),Cj=g({},ni,{data:0}),Ng=wa(Cj),Aj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Mj={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rj(n){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(n):(n=Mj[n])?!!s[n]:!1}function Af(){return Rj}var kj=g({},ql,{key:function(n){if(n.key){var s=Aj[n.key]||n.key;if(s!=="Unidentified")return s}return n.type==="keypress"?(n=zi(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Tj[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Af,charCode:function(n){return n.type==="keypress"?zi(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?zi(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Dj=wa(kj),Ij=g({},kc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Eg=wa(Ij),Lj=g({},ql,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Af}),Oj=wa(Lj),zj=g({},ni,{propertyName:0,elapsedTime:0,pseudoElement:0}),$j=wa(zj),Fj=g({},kc,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Uj=wa(Fj),Bj=g({},ni,{newState:0,oldState:0}),qj=wa(Bj),Hj=[9,13,27,32],Tf=vn&&"CompositionEvent"in window,Pl=null;vn&&"documentMode"in document&&(Pl=document.documentMode);var Pj=vn&&"TextEvent"in window&&!Pl,jg=vn&&(!Tf||Pl&&8<Pl&&11>=Pl),_g=" ",Cg=!1;function Ag(n,s){switch(n){case"keyup":return Hj.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Tg(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Fi=!1;function Vj(n,s){switch(n){case"compositionend":return Tg(s);case"keypress":return s.which!==32?null:(Cg=!0,_g);case"textInput":return n=s.data,n===_g&&Cg?null:n;default:return null}}function Yj(n,s){if(Fi)return n==="compositionend"||!Tf&&Ag(n,s)?(n=Oi(),Li=Xa=Wn=null,Fi=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return jg&&s.locale!=="ko"?null:s.data;default:return null}}var Gj={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Mg(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s==="input"?!!Gj[n.type]:s==="textarea"}function Rg(n,s,o,d){ht?Dt?Dt.push(d):Dt=[d]:ht=d,s=Su(s,"onChange"),0<s.length&&(o=new Rc("onChange","change",null,o,d),n.push({event:o,listeners:s}))}var Vl=null,Yl=null;function Xj(n){mx(n,0)}function Dc(n){var s=bt(n);if(Jr(s))return n}function kg(n,s){if(n==="change")return s}var Dg=!1;if(vn){var Mf;if(vn){var Rf="oninput"in document;if(!Rf){var Ig=document.createElement("div");Ig.setAttribute("oninput","return;"),Rf=typeof Ig.oninput=="function"}Mf=Rf}else Mf=!1;Dg=Mf&&(!document.documentMode||9<document.documentMode)}function Lg(){Vl&&(Vl.detachEvent("onpropertychange",Og),Yl=Vl=null)}function Og(n){if(n.propertyName==="value"&&Dc(Yl)){var s=[];Rg(s,Yl,n,Me(n)),xn(Xj,s)}}function Kj(n,s,o){n==="focusin"?(Lg(),Vl=s,Yl=o,Vl.attachEvent("onpropertychange",Og)):n==="focusout"&&Lg()}function Wj(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Dc(Yl)}function Zj(n,s){if(n==="click")return Dc(s)}function Qj(n,s){if(n==="input"||n==="change")return Dc(s)}function Jj(n,s){return n===s&&(n!==0||1/n===1/s)||n!==n&&s!==s}var La=typeof Object.is=="function"?Object.is:Jj;function Gl(n,s){if(La(n,s))return!0;if(typeof n!="object"||n===null||typeof s!="object"||s===null)return!1;var o=Object.keys(n),d=Object.keys(s);if(o.length!==d.length)return!1;for(d=0;d<o.length;d++){var b=o[d];if(!vt.call(s,b)||!La(n[b],s[b]))return!1}return!0}function zg(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function $g(n,s){var o=zg(n);n=0;for(var d;o;){if(o.nodeType===3){if(d=n+o.textContent.length,n<=s&&d>=s)return{node:o,offset:s-n};n=d}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=zg(o)}}function Fg(n,s){return n&&s?n===s?!0:n&&n.nodeType===3?!1:s&&s.nodeType===3?Fg(n,s.parentNode):"contains"in n?n.contains(s):n.compareDocumentPosition?!!(n.compareDocumentPosition(s)&16):!1:!1}function Ug(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var s=ur(n.document);s instanceof n.HTMLIFrameElement;){try{var o=typeof s.contentWindow.location.href=="string"}catch{o=!1}if(o)n=s.contentWindow;else break;s=ur(n.document)}return s}function kf(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s&&(s==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||s==="textarea"||n.contentEditable==="true")}var e_=vn&&"documentMode"in document&&11>=document.documentMode,Ui=null,Df=null,Xl=null,If=!1;function Bg(n,s,o){var d=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;If||Ui==null||Ui!==ur(d)||(d=Ui,"selectionStart"in d&&kf(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Xl&&Gl(Xl,d)||(Xl=d,d=Su(Df,"onSelect"),0<d.length&&(s=new Rc("onSelect","select",null,s,o),n.push({event:s,listeners:d}),s.target=Ui)))}function ai(n,s){var o={};return o[n.toLowerCase()]=s.toLowerCase(),o["Webkit"+n]="webkit"+s,o["Moz"+n]="moz"+s,o}var Bi={animationend:ai("Animation","AnimationEnd"),animationiteration:ai("Animation","AnimationIteration"),animationstart:ai("Animation","AnimationStart"),transitionrun:ai("Transition","TransitionRun"),transitionstart:ai("Transition","TransitionStart"),transitioncancel:ai("Transition","TransitionCancel"),transitionend:ai("Transition","TransitionEnd")},Lf={},qg={};vn&&(qg=document.createElement("div").style,"AnimationEvent"in window||(delete Bi.animationend.animation,delete Bi.animationiteration.animation,delete Bi.animationstart.animation),"TransitionEvent"in window||delete Bi.transitionend.transition);function si(n){if(Lf[n])return Lf[n];if(!Bi[n])return n;var s=Bi[n],o;for(o in s)if(s.hasOwnProperty(o)&&o in qg)return Lf[n]=s[o];return n}var Hg=si("animationend"),Pg=si("animationiteration"),Vg=si("animationstart"),t_=si("transitionrun"),n_=si("transitionstart"),a_=si("transitioncancel"),Yg=si("transitionend"),Gg=new Map,Of="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Of.push("scrollEnd");function cs(n,s){Gg.set(n,s),fe(s,[n])}var Ic=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)},Ka=[],qi=0,zf=0;function Lc(){for(var n=qi,s=zf=qi=0;s<n;){var o=Ka[s];Ka[s++]=null;var d=Ka[s];Ka[s++]=null;var b=Ka[s];Ka[s++]=null;var x=Ka[s];if(Ka[s++]=null,d!==null&&b!==null){var $=d.pending;$===null?b.next=b:(b.next=$.next,$.next=b),d.pending=b}x!==0&&Xg(o,b,x)}}function Oc(n,s,o,d){Ka[qi++]=n,Ka[qi++]=s,Ka[qi++]=o,Ka[qi++]=d,zf|=d,n.lanes|=d,n=n.alternate,n!==null&&(n.lanes|=d)}function $f(n,s,o,d){return Oc(n,s,o,d),zc(n)}function ri(n,s){return Oc(n,null,null,s),zc(n)}function Xg(n,s,o){n.lanes|=o;var d=n.alternate;d!==null&&(d.lanes|=o);for(var b=!1,x=n.return;x!==null;)x.childLanes|=o,d=x.alternate,d!==null&&(d.childLanes|=o),x.tag===22&&(n=x.stateNode,n===null||n._visibility&1||(b=!0)),n=x,x=x.return;return n.tag===3?(x=n.stateNode,b&&s!==null&&(b=31-$e(o),n=x.hiddenUpdates,d=n[b],d===null?n[b]=[s]:d.push(s),s.lane=o|536870912),x):null}function zc(n){if(50<go)throw go=0,Gm=null,Error(i(185));for(var s=n.return;s!==null;)n=s,s=n.return;return n.tag===3?n.stateNode:null}var Hi={};function s_(n,s,o,d){this.tag=n,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oa(n,s,o,d){return new s_(n,s,o,d)}function Ff(n){return n=n.prototype,!(!n||!n.isReactComponent)}function zs(n,s){var o=n.alternate;return o===null?(o=Oa(n.tag,s,n.key,n.mode),o.elementType=n.elementType,o.type=n.type,o.stateNode=n.stateNode,o.alternate=n,n.alternate=o):(o.pendingProps=s,o.type=n.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=n.flags&65011712,o.childLanes=n.childLanes,o.lanes=n.lanes,o.child=n.child,o.memoizedProps=n.memoizedProps,o.memoizedState=n.memoizedState,o.updateQueue=n.updateQueue,s=n.dependencies,o.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},o.sibling=n.sibling,o.index=n.index,o.ref=n.ref,o.refCleanup=n.refCleanup,o}function Kg(n,s){n.flags&=65011714;var o=n.alternate;return o===null?(n.childLanes=0,n.lanes=s,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=o.childLanes,n.lanes=o.lanes,n.child=o.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=o.memoizedProps,n.memoizedState=o.memoizedState,n.updateQueue=o.updateQueue,n.type=o.type,s=o.dependencies,n.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),n}function $c(n,s,o,d,b,x){var $=0;if(d=n,typeof n=="function")Ff(n)&&($=1);else if(typeof n=="string")$=cC(n,o,J.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case P:return n=Oa(31,o,s,b),n.elementType=P,n.lanes=x,n;case N:return ii(o.children,b,x,s);case j:$=8,b|=24;break;case _:return n=Oa(12,o,s,b|2),n.elementType=_,n.lanes=x,n;case T:return n=Oa(13,o,s,b),n.elementType=T,n.lanes=x,n;case M:return n=Oa(19,o,s,b),n.elementType=M,n.lanes=x,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case O:$=10;break e;case C:$=9;break e;case E:$=11;break e;case A:$=14;break e;case z:$=16,d=null;break e}$=29,o=Error(i(130,n===null?"null":typeof n,"")),d=null}return s=Oa($,o,s,b),s.elementType=n,s.type=d,s.lanes=x,s}function ii(n,s,o,d){return n=Oa(7,n,d,s),n.lanes=o,n}function Uf(n,s,o){return n=Oa(6,n,null,s),n.lanes=o,n}function Wg(n){var s=Oa(18,null,null,0);return s.stateNode=n,s}function Bf(n,s,o){return s=Oa(4,n.children!==null?n.children:[],n.key,s),s.lanes=o,s.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},s}var Zg=new WeakMap;function Wa(n,s){if(typeof n=="object"&&n!==null){var o=Zg.get(n);return o!==void 0?o:(s={value:n,source:s,stack:Ie(s)},Zg.set(n,s),s)}return{value:n,source:s,stack:Ie(s)}}var Pi=[],Vi=0,Fc=null,Kl=0,Za=[],Qa=0,dr=null,Ns=1,Es="";function $s(n,s){Pi[Vi++]=Kl,Pi[Vi++]=Fc,Fc=n,Kl=s}function Qg(n,s,o){Za[Qa++]=Ns,Za[Qa++]=Es,Za[Qa++]=dr,dr=n;var d=Ns;n=Es;var b=32-$e(d)-1;d&=~(1<<b),o+=1;var x=32-$e(s)+b;if(30<x){var $=b-b%5;x=(d&(1<<$)-1).toString(32),d>>=$,b-=$,Ns=1<<32-$e(s)+b|o<<b|d,Es=x+n}else Ns=1<<x|o<<b|d,Es=n}function qf(n){n.return!==null&&($s(n,1),Qg(n,1,0))}function Hf(n){for(;n===Fc;)Fc=Pi[--Vi],Pi[Vi]=null,Kl=Pi[--Vi],Pi[Vi]=null;for(;n===dr;)dr=Za[--Qa],Za[Qa]=null,Es=Za[--Qa],Za[Qa]=null,Ns=Za[--Qa],Za[Qa]=null}function Jg(n,s){Za[Qa++]=Ns,Za[Qa++]=Es,Za[Qa++]=dr,Ns=s.id,Es=s.overflow,dr=n}var ca=null,On=null,bn=!1,fr=null,Ja=!1,Pf=Error(i(519));function mr(n){var s=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Wl(Wa(s,n)),Pf}function eb(n){var s=n.stateNode,o=n.type,d=n.memoizedProps;switch(s[Ke]=n,s[ot]=d,o){case"dialog":hn("cancel",s),hn("close",s);break;case"iframe":case"object":case"embed":hn("load",s);break;case"video":case"audio":for(o=0;o<vo.length;o++)hn(vo[o],s);break;case"source":hn("error",s);break;case"img":case"image":case"link":hn("error",s),hn("load",s);break;case"details":hn("toggle",s);break;case"input":hn("invalid",s),ti(s,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":hn("invalid",s);break;case"textarea":hn("invalid",s),de(s,d.value,d.defaultValue,d.children)}o=d.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||s.textContent===""+o||d.suppressHydrationWarning===!0||gx(s.textContent,o)?(d.popover!=null&&(hn("beforetoggle",s),hn("toggle",s)),d.onScroll!=null&&hn("scroll",s),d.onScrollEnd!=null&&hn("scrollend",s),d.onClick!=null&&(s.onclick=la),s=!0):s=!1,s||mr(n,!0)}function tb(n){for(ca=n.return;ca;)switch(ca.tag){case 5:case 31:case 13:Ja=!1;return;case 27:case 3:Ja=!0;return;default:ca=ca.return}}function Yi(n){if(n!==ca)return!1;if(!bn)return tb(n),bn=!0,!1;var s=n.tag,o;if((o=s!==3&&s!==27)&&((o=s===5)&&(o=n.type,o=!(o!=="form"&&o!=="button")||oh(n.type,n.memoizedProps)),o=!o),o&&On&&mr(n),tb(n),s===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));On=_x(n)}else if(s===31){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));On=_x(n)}else s===27?(s=On,Cr(n.type)?(n=mh,mh=null,On=n):On=s):On=ca?ts(n.stateNode.nextSibling):null;return!0}function li(){On=ca=null,bn=!1}function Vf(){var n=fr;return n!==null&&(_a===null?_a=n:_a.push.apply(_a,n),fr=null),n}function Wl(n){fr===null?fr=[n]:fr.push(n)}var Yf=R(null),oi=null,Fs=null;function hr(n,s,o){G(Yf,s._currentValue),s._currentValue=o}function Us(n){n._currentValue=Yf.current,q(Yf)}function Gf(n,s,o){for(;n!==null;){var d=n.alternate;if((n.childLanes&s)!==s?(n.childLanes|=s,d!==null&&(d.childLanes|=s)):d!==null&&(d.childLanes&s)!==s&&(d.childLanes|=s),n===o)break;n=n.return}}function Xf(n,s,o,d){var b=n.child;for(b!==null&&(b.return=n);b!==null;){var x=b.dependencies;if(x!==null){var $=b.child;x=x.firstContext;e:for(;x!==null;){var K=x;x=b;for(var pe=0;pe<s.length;pe++)if(K.context===s[pe]){x.lanes|=o,K=x.alternate,K!==null&&(K.lanes|=o),Gf(x.return,o,n),d||($=null);break e}x=K.next}}else if(b.tag===18){if($=b.return,$===null)throw Error(i(341));$.lanes|=o,x=$.alternate,x!==null&&(x.lanes|=o),Gf($,o,n),$=null}else $=b.child;if($!==null)$.return=b;else for($=b;$!==null;){if($===n){$=null;break}if(b=$.sibling,b!==null){b.return=$.return,$=b;break}$=$.return}b=$}}function Gi(n,s,o,d){n=null;for(var b=s,x=!1;b!==null;){if(!x){if((b.flags&524288)!==0)x=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var $=b.alternate;if($===null)throw Error(i(387));if($=$.memoizedProps,$!==null){var K=b.type;La(b.pendingProps.value,$.value)||(n!==null?n.push(K):n=[K])}}else if(b===me.current){if($=b.alternate,$===null)throw Error(i(387));$.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(n!==null?n.push(Eo):n=[Eo])}b=b.return}n!==null&&Xf(s,n,o,d),s.flags|=262144}function Uc(n){for(n=n.firstContext;n!==null;){if(!La(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function ci(n){oi=n,Fs=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function ua(n){return nb(oi,n)}function Bc(n,s){return oi===null&&ci(n),nb(n,s)}function nb(n,s){var o=s._currentValue;if(s={context:s,memoizedValue:o,next:null},Fs===null){if(n===null)throw Error(i(308));Fs=s,n.dependencies={lanes:0,firstContext:s},n.flags|=524288}else Fs=Fs.next=s;return o}var r_=typeof AbortController<"u"?AbortController:function(){var n=[],s=this.signal={aborted:!1,addEventListener:function(o,d){n.push(d)}};this.abort=function(){s.aborted=!0,n.forEach(function(o){return o()})}},i_=e.unstable_scheduleCallback,l_=e.unstable_NormalPriority,Zn={$$typeof:O,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Kf(){return{controller:new r_,data:new Map,refCount:0}}function Zl(n){n.refCount--,n.refCount===0&&i_(l_,function(){n.controller.abort()})}var Ql=null,Wf=0,Xi=0,Ki=null;function o_(n,s){if(Ql===null){var o=Ql=[];Wf=0,Xi=Jm(),Ki={status:"pending",value:void 0,then:function(d){o.push(d)}}}return Wf++,s.then(ab,ab),s}function ab(){if(--Wf===0&&Ql!==null){Ki!==null&&(Ki.status="fulfilled");var n=Ql;Ql=null,Xi=0,Ki=null;for(var s=0;s<n.length;s++)(0,n[s])()}}function c_(n,s){var o=[],d={status:"pending",value:null,reason:null,then:function(b){o.push(b)}};return n.then(function(){d.status="fulfilled",d.value=s;for(var b=0;b<o.length;b++)(0,o[b])(s)},function(b){for(d.status="rejected",d.reason=b,b=0;b<o.length;b++)(0,o[b])(void 0)}),d}var sb=D.S;D.S=function(n,s){Bv=Ze(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&o_(n,s),sb!==null&&sb(n,s)};var ui=R(null);function Zf(){var n=ui.current;return n!==null?n:In.pooledCache}function qc(n,s){s===null?G(ui,ui.current):G(ui,s.pool)}function rb(){var n=Zf();return n===null?null:{parent:Zn._currentValue,pool:n}}var Wi=Error(i(460)),Qf=Error(i(474)),Hc=Error(i(542)),Pc={then:function(){}};function ib(n){return n=n.status,n==="fulfilled"||n==="rejected"}function lb(n,s,o){switch(o=n[o],o===void 0?n.push(s):o!==s&&(s.then(la,la),s=o),s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,cb(n),n;default:if(typeof s.status=="string")s.then(la,la);else{if(n=In,n!==null&&100<n.shellSuspendCounter)throw Error(i(482));n=s,n.status="pending",n.then(function(d){if(s.status==="pending"){var b=s;b.status="fulfilled",b.value=d}},function(d){if(s.status==="pending"){var b=s;b.status="rejected",b.reason=d}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,cb(n),n}throw fi=s,Wi}}function di(n){try{var s=n._init;return s(n._payload)}catch(o){throw o!==null&&typeof o=="object"&&typeof o.then=="function"?(fi=o,Wi):o}}var fi=null;function ob(){if(fi===null)throw Error(i(459));var n=fi;return fi=null,n}function cb(n){if(n===Wi||n===Hc)throw Error(i(483))}var Zi=null,Jl=0;function Vc(n){var s=Jl;return Jl+=1,Zi===null&&(Zi=[]),lb(Zi,n,s)}function eo(n,s){s=s.props.ref,n.ref=s!==void 0?s:null}function Yc(n,s){throw s.$$typeof===v?Error(i(525)):(n=Object.prototype.toString.call(s),Error(i(31,n==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":n)))}function ub(n){function s(Ae,xe){if(n){var Le=Ae.deletions;Le===null?(Ae.deletions=[xe],Ae.flags|=16):Le.push(xe)}}function o(Ae,xe){if(!n)return null;for(;xe!==null;)s(Ae,xe),xe=xe.sibling;return null}function d(Ae){for(var xe=new Map;Ae!==null;)Ae.key!==null?xe.set(Ae.key,Ae):xe.set(Ae.index,Ae),Ae=Ae.sibling;return xe}function b(Ae,xe){return Ae=zs(Ae,xe),Ae.index=0,Ae.sibling=null,Ae}function x(Ae,xe,Le){return Ae.index=Le,n?(Le=Ae.alternate,Le!==null?(Le=Le.index,Le<xe?(Ae.flags|=67108866,xe):Le):(Ae.flags|=67108866,xe)):(Ae.flags|=1048576,xe)}function $(Ae){return n&&Ae.alternate===null&&(Ae.flags|=67108866),Ae}function K(Ae,xe,Le,it){return xe===null||xe.tag!==6?(xe=Uf(Le,Ae.mode,it),xe.return=Ae,xe):(xe=b(xe,Le),xe.return=Ae,xe)}function pe(Ae,xe,Le,it){var Ht=Le.type;return Ht===N?Je(Ae,xe,Le.props.children,it,Le.key):xe!==null&&(xe.elementType===Ht||typeof Ht=="object"&&Ht!==null&&Ht.$$typeof===z&&di(Ht)===xe.type)?(xe=b(xe,Le.props),eo(xe,Le),xe.return=Ae,xe):(xe=$c(Le.type,Le.key,Le.props,null,Ae.mode,it),eo(xe,Le),xe.return=Ae,xe)}function Oe(Ae,xe,Le,it){return xe===null||xe.tag!==4||xe.stateNode.containerInfo!==Le.containerInfo||xe.stateNode.implementation!==Le.implementation?(xe=Bf(Le,Ae.mode,it),xe.return=Ae,xe):(xe=b(xe,Le.children||[]),xe.return=Ae,xe)}function Je(Ae,xe,Le,it,Ht){return xe===null||xe.tag!==7?(xe=ii(Le,Ae.mode,it,Ht),xe.return=Ae,xe):(xe=b(xe,Le),xe.return=Ae,xe)}function lt(Ae,xe,Le){if(typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint")return xe=Uf(""+xe,Ae.mode,Le),xe.return=Ae,xe;if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case S:return Le=$c(xe.type,xe.key,xe.props,null,Ae.mode,Le),eo(Le,xe),Le.return=Ae,Le;case w:return xe=Bf(xe,Ae.mode,Le),xe.return=Ae,xe;case z:return xe=di(xe),lt(Ae,xe,Le)}if(F(xe)||Y(xe))return xe=ii(xe,Ae.mode,Le,null),xe.return=Ae,xe;if(typeof xe.then=="function")return lt(Ae,Vc(xe),Le);if(xe.$$typeof===O)return lt(Ae,Bc(Ae,xe),Le);Yc(Ae,xe)}return null}function Ue(Ae,xe,Le,it){var Ht=xe!==null?xe.key:null;if(typeof Le=="string"&&Le!==""||typeof Le=="number"||typeof Le=="bigint")return Ht!==null?null:K(Ae,xe,""+Le,it);if(typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case S:return Le.key===Ht?pe(Ae,xe,Le,it):null;case w:return Le.key===Ht?Oe(Ae,xe,Le,it):null;case z:return Le=di(Le),Ue(Ae,xe,Le,it)}if(F(Le)||Y(Le))return Ht!==null?null:Je(Ae,xe,Le,it,null);if(typeof Le.then=="function")return Ue(Ae,xe,Vc(Le),it);if(Le.$$typeof===O)return Ue(Ae,xe,Bc(Ae,Le),it);Yc(Ae,Le)}return null}function Ye(Ae,xe,Le,it,Ht){if(typeof it=="string"&&it!==""||typeof it=="number"||typeof it=="bigint")return Ae=Ae.get(Le)||null,K(xe,Ae,""+it,Ht);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case S:return Ae=Ae.get(it.key===null?Le:it.key)||null,pe(xe,Ae,it,Ht);case w:return Ae=Ae.get(it.key===null?Le:it.key)||null,Oe(xe,Ae,it,Ht);case z:return it=di(it),Ye(Ae,xe,Le,it,Ht)}if(F(it)||Y(it))return Ae=Ae.get(Le)||null,Je(xe,Ae,it,Ht,null);if(typeof it.then=="function")return Ye(Ae,xe,Le,Vc(it),Ht);if(it.$$typeof===O)return Ye(Ae,xe,Le,Bc(xe,it),Ht);Yc(xe,it)}return null}function Ot(Ae,xe,Le,it){for(var Ht=null,Sn=null,$t=xe,an=xe=0,gn=null;$t!==null&&an<Le.length;an++){$t.index>an?(gn=$t,$t=null):gn=$t.sibling;var wn=Ue(Ae,$t,Le[an],it);if(wn===null){$t===null&&($t=gn);break}n&&$t&&wn.alternate===null&&s(Ae,$t),xe=x(wn,xe,an),Sn===null?Ht=wn:Sn.sibling=wn,Sn=wn,$t=gn}if(an===Le.length)return o(Ae,$t),bn&&$s(Ae,an),Ht;if($t===null){for(;an<Le.length;an++)$t=lt(Ae,Le[an],it),$t!==null&&(xe=x($t,xe,an),Sn===null?Ht=$t:Sn.sibling=$t,Sn=$t);return bn&&$s(Ae,an),Ht}for($t=d($t);an<Le.length;an++)gn=Ye($t,Ae,an,Le[an],it),gn!==null&&(n&&gn.alternate!==null&&$t.delete(gn.key===null?an:gn.key),xe=x(gn,xe,an),Sn===null?Ht=gn:Sn.sibling=gn,Sn=gn);return n&&$t.forEach(function(kr){return s(Ae,kr)}),bn&&$s(Ae,an),Ht}function Xt(Ae,xe,Le,it){if(Le==null)throw Error(i(151));for(var Ht=null,Sn=null,$t=xe,an=xe=0,gn=null,wn=Le.next();$t!==null&&!wn.done;an++,wn=Le.next()){$t.index>an?(gn=$t,$t=null):gn=$t.sibling;var kr=Ue(Ae,$t,wn.value,it);if(kr===null){$t===null&&($t=gn);break}n&&$t&&kr.alternate===null&&s(Ae,$t),xe=x(kr,xe,an),Sn===null?Ht=kr:Sn.sibling=kr,Sn=kr,$t=gn}if(wn.done)return o(Ae,$t),bn&&$s(Ae,an),Ht;if($t===null){for(;!wn.done;an++,wn=Le.next())wn=lt(Ae,wn.value,it),wn!==null&&(xe=x(wn,xe,an),Sn===null?Ht=wn:Sn.sibling=wn,Sn=wn);return bn&&$s(Ae,an),Ht}for($t=d($t);!wn.done;an++,wn=Le.next())wn=Ye($t,Ae,an,wn.value,it),wn!==null&&(n&&wn.alternate!==null&&$t.delete(wn.key===null?an:wn.key),xe=x(wn,xe,an),Sn===null?Ht=wn:Sn.sibling=wn,Sn=wn);return n&&$t.forEach(function(xC){return s(Ae,xC)}),bn&&$s(Ae,an),Ht}function Dn(Ae,xe,Le,it){if(typeof Le=="object"&&Le!==null&&Le.type===N&&Le.key===null&&(Le=Le.props.children),typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case S:e:{for(var Ht=Le.key;xe!==null;){if(xe.key===Ht){if(Ht=Le.type,Ht===N){if(xe.tag===7){o(Ae,xe.sibling),it=b(xe,Le.props.children),it.return=Ae,Ae=it;break e}}else if(xe.elementType===Ht||typeof Ht=="object"&&Ht!==null&&Ht.$$typeof===z&&di(Ht)===xe.type){o(Ae,xe.sibling),it=b(xe,Le.props),eo(it,Le),it.return=Ae,Ae=it;break e}o(Ae,xe);break}else s(Ae,xe);xe=xe.sibling}Le.type===N?(it=ii(Le.props.children,Ae.mode,it,Le.key),it.return=Ae,Ae=it):(it=$c(Le.type,Le.key,Le.props,null,Ae.mode,it),eo(it,Le),it.return=Ae,Ae=it)}return $(Ae);case w:e:{for(Ht=Le.key;xe!==null;){if(xe.key===Ht)if(xe.tag===4&&xe.stateNode.containerInfo===Le.containerInfo&&xe.stateNode.implementation===Le.implementation){o(Ae,xe.sibling),it=b(xe,Le.children||[]),it.return=Ae,Ae=it;break e}else{o(Ae,xe);break}else s(Ae,xe);xe=xe.sibling}it=Bf(Le,Ae.mode,it),it.return=Ae,Ae=it}return $(Ae);case z:return Le=di(Le),Dn(Ae,xe,Le,it)}if(F(Le))return Ot(Ae,xe,Le,it);if(Y(Le)){if(Ht=Y(Le),typeof Ht!="function")throw Error(i(150));return Le=Ht.call(Le),Xt(Ae,xe,Le,it)}if(typeof Le.then=="function")return Dn(Ae,xe,Vc(Le),it);if(Le.$$typeof===O)return Dn(Ae,xe,Bc(Ae,Le),it);Yc(Ae,Le)}return typeof Le=="string"&&Le!==""||typeof Le=="number"||typeof Le=="bigint"?(Le=""+Le,xe!==null&&xe.tag===6?(o(Ae,xe.sibling),it=b(xe,Le),it.return=Ae,Ae=it):(o(Ae,xe),it=Uf(Le,Ae.mode,it),it.return=Ae,Ae=it),$(Ae)):o(Ae,xe)}return function(Ae,xe,Le,it){try{Jl=0;var Ht=Dn(Ae,xe,Le,it);return Zi=null,Ht}catch($t){if($t===Wi||$t===Hc)throw $t;var Sn=Oa(29,$t,null,Ae.mode);return Sn.lanes=it,Sn.return=Ae,Sn}finally{}}}var mi=ub(!0),db=ub(!1),pr=!1;function Jf(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function em(n,s){n=n.updateQueue,s.updateQueue===n&&(s.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function yr(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function gr(n,s,o){var d=n.updateQueue;if(d===null)return null;if(d=d.shared,(_n&2)!==0){var b=d.pending;return b===null?s.next=s:(s.next=b.next,b.next=s),d.pending=s,s=zc(n),Xg(n,null,o),s}return Oc(n,d,s,o),zc(n)}function to(n,s,o){if(s=s.updateQueue,s!==null&&(s=s.shared,(o&4194048)!==0)){var d=s.lanes;d&=n.pendingLanes,o|=d,s.lanes=o,We(n,o)}}function tm(n,s){var o=n.updateQueue,d=n.alternate;if(d!==null&&(d=d.updateQueue,o===d)){var b=null,x=null;if(o=o.firstBaseUpdate,o!==null){do{var $={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};x===null?b=x=$:x=x.next=$,o=o.next}while(o!==null);x===null?b=x=s:x=x.next=s}else b=x=s;o={baseState:d.baseState,firstBaseUpdate:b,lastBaseUpdate:x,shared:d.shared,callbacks:d.callbacks},n.updateQueue=o;return}n=o.lastBaseUpdate,n===null?o.firstBaseUpdate=s:n.next=s,o.lastBaseUpdate=s}var nm=!1;function no(){if(nm){var n=Ki;if(n!==null)throw n}}function ao(n,s,o,d){nm=!1;var b=n.updateQueue;pr=!1;var x=b.firstBaseUpdate,$=b.lastBaseUpdate,K=b.shared.pending;if(K!==null){b.shared.pending=null;var pe=K,Oe=pe.next;pe.next=null,$===null?x=Oe:$.next=Oe,$=pe;var Je=n.alternate;Je!==null&&(Je=Je.updateQueue,K=Je.lastBaseUpdate,K!==$&&(K===null?Je.firstBaseUpdate=Oe:K.next=Oe,Je.lastBaseUpdate=pe))}if(x!==null){var lt=b.baseState;$=0,Je=Oe=pe=null,K=x;do{var Ue=K.lane&-536870913,Ye=Ue!==K.lane;if(Ye?(yn&Ue)===Ue:(d&Ue)===Ue){Ue!==0&&Ue===Xi&&(nm=!0),Je!==null&&(Je=Je.next={lane:0,tag:K.tag,payload:K.payload,callback:null,next:null});e:{var Ot=n,Xt=K;Ue=s;var Dn=o;switch(Xt.tag){case 1:if(Ot=Xt.payload,typeof Ot=="function"){lt=Ot.call(Dn,lt,Ue);break e}lt=Ot;break e;case 3:Ot.flags=Ot.flags&-65537|128;case 0:if(Ot=Xt.payload,Ue=typeof Ot=="function"?Ot.call(Dn,lt,Ue):Ot,Ue==null)break e;lt=g({},lt,Ue);break e;case 2:pr=!0}}Ue=K.callback,Ue!==null&&(n.flags|=64,Ye&&(n.flags|=8192),Ye=b.callbacks,Ye===null?b.callbacks=[Ue]:Ye.push(Ue))}else Ye={lane:Ue,tag:K.tag,payload:K.payload,callback:K.callback,next:null},Je===null?(Oe=Je=Ye,pe=lt):Je=Je.next=Ye,$|=Ue;if(K=K.next,K===null){if(K=b.shared.pending,K===null)break;Ye=K,K=Ye.next,Ye.next=null,b.lastBaseUpdate=Ye,b.shared.pending=null}}while(!0);Je===null&&(pe=lt),b.baseState=pe,b.firstBaseUpdate=Oe,b.lastBaseUpdate=Je,x===null&&(b.shared.lanes=0),wr|=$,n.lanes=$,n.memoizedState=lt}}function fb(n,s){if(typeof n!="function")throw Error(i(191,n));n.call(s)}function mb(n,s){var o=n.callbacks;if(o!==null)for(n.callbacks=null,n=0;n<o.length;n++)fb(o[n],s)}var Qi=R(null),Gc=R(0);function hb(n,s){n=Ks,G(Gc,n),G(Qi,s),Ks=n|s.baseLanes}function am(){G(Gc,Ks),G(Qi,Qi.current)}function sm(){Ks=Gc.current,q(Qi),q(Gc)}var za=R(null),es=null;function br(n){var s=n.alternate;G(Xn,Xn.current&1),G(za,n),es===null&&(s===null||Qi.current!==null||s.memoizedState!==null)&&(es=n)}function rm(n){G(Xn,Xn.current),G(za,n),es===null&&(es=n)}function pb(n){n.tag===22?(G(Xn,Xn.current),G(za,n),es===null&&(es=n)):vr()}function vr(){G(Xn,Xn.current),G(za,za.current)}function $a(n){q(za),es===n&&(es=null),q(Xn)}var Xn=R(0);function Xc(n){for(var s=n;s!==null;){if(s.tag===13){var o=s.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||dh(o)||fh(o)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Bs=0,tn=null,Rn=null,Qn=null,Kc=!1,Ji=!1,hi=!1,Wc=0,so=0,el=null,u_=0;function Pn(){throw Error(i(321))}function im(n,s){if(s===null)return!1;for(var o=0;o<s.length&&o<n.length;o++)if(!La(n[o],s[o]))return!1;return!0}function lm(n,s,o,d,b,x){return Bs=x,tn=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,D.H=n===null||n.memoizedState===null?Qb:wm,hi=!1,x=o(d,b),hi=!1,Ji&&(x=gb(s,o,d,b)),yb(n),x}function yb(n){D.H=lo;var s=Rn!==null&&Rn.next!==null;if(Bs=0,Qn=Rn=tn=null,Kc=!1,so=0,el=null,s)throw Error(i(300));n===null||Jn||(n=n.dependencies,n!==null&&Uc(n)&&(Jn=!0))}function gb(n,s,o,d){tn=n;var b=0;do{if(Ji&&(el=null),so=0,Ji=!1,25<=b)throw Error(i(301));if(b+=1,Qn=Rn=null,n.updateQueue!=null){var x=n.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}D.H=Jb,x=s(o,d)}while(Ji);return x}function d_(){var n=D.H,s=n.useState()[0];return s=typeof s.then=="function"?ro(s):s,n=n.useState()[0],(Rn!==null?Rn.memoizedState:null)!==n&&(tn.flags|=1024),s}function om(){var n=Wc!==0;return Wc=0,n}function cm(n,s,o){s.updateQueue=n.updateQueue,s.flags&=-2053,n.lanes&=~o}function um(n){if(Kc){for(n=n.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}Kc=!1}Bs=0,Qn=Rn=tn=null,Ji=!1,so=Wc=0,el=null}function ba(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qn===null?tn.memoizedState=Qn=n:Qn=Qn.next=n,Qn}function Kn(){if(Rn===null){var n=tn.alternate;n=n!==null?n.memoizedState:null}else n=Rn.next;var s=Qn===null?tn.memoizedState:Qn.next;if(s!==null)Qn=s,Rn=n;else{if(n===null)throw tn.alternate===null?Error(i(467)):Error(i(310));Rn=n,n={memoizedState:Rn.memoizedState,baseState:Rn.baseState,baseQueue:Rn.baseQueue,queue:Rn.queue,next:null},Qn===null?tn.memoizedState=Qn=n:Qn=Qn.next=n}return Qn}function Zc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ro(n){var s=so;return so+=1,el===null&&(el=[]),n=lb(el,n,s),s=tn,(Qn===null?s.memoizedState:Qn.next)===null&&(s=s.alternate,D.H=s===null||s.memoizedState===null?Qb:wm),n}function Qc(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return ro(n);if(n.$$typeof===O)return ua(n)}throw Error(i(438,String(n)))}function dm(n){var s=null,o=tn.updateQueue;if(o!==null&&(s=o.memoCache),s==null){var d=tn.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(s={data:d.data.map(function(b){return b.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),o===null&&(o=Zc(),tn.updateQueue=o),o.memoCache=s,o=s.data[s.index],o===void 0)for(o=s.data[s.index]=Array(n),d=0;d<n;d++)o[d]=X;return s.index++,o}function qs(n,s){return typeof s=="function"?s(n):s}function Jc(n){var s=Kn();return fm(s,Rn,n)}function fm(n,s,o){var d=n.queue;if(d===null)throw Error(i(311));d.lastRenderedReducer=o;var b=n.baseQueue,x=d.pending;if(x!==null){if(b!==null){var $=b.next;b.next=x.next,x.next=$}s.baseQueue=b=x,d.pending=null}if(x=n.baseState,b===null)n.memoizedState=x;else{s=b.next;var K=$=null,pe=null,Oe=s,Je=!1;do{var lt=Oe.lane&-536870913;if(lt!==Oe.lane?(yn&lt)===lt:(Bs&lt)===lt){var Ue=Oe.revertLane;if(Ue===0)pe!==null&&(pe=pe.next={lane:0,revertLane:0,gesture:null,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null}),lt===Xi&&(Je=!0);else if((Bs&Ue)===Ue){Oe=Oe.next,Ue===Xi&&(Je=!0);continue}else lt={lane:0,revertLane:Oe.revertLane,gesture:null,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null},pe===null?(K=pe=lt,$=x):pe=pe.next=lt,tn.lanes|=Ue,wr|=Ue;lt=Oe.action,hi&&o(x,lt),x=Oe.hasEagerState?Oe.eagerState:o(x,lt)}else Ue={lane:lt,revertLane:Oe.revertLane,gesture:Oe.gesture,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null},pe===null?(K=pe=Ue,$=x):pe=pe.next=Ue,tn.lanes|=lt,wr|=lt;Oe=Oe.next}while(Oe!==null&&Oe!==s);if(pe===null?$=x:pe.next=K,!La(x,n.memoizedState)&&(Jn=!0,Je&&(o=Ki,o!==null)))throw o;n.memoizedState=x,n.baseState=$,n.baseQueue=pe,d.lastRenderedState=x}return b===null&&(d.lanes=0),[n.memoizedState,d.dispatch]}function mm(n){var s=Kn(),o=s.queue;if(o===null)throw Error(i(311));o.lastRenderedReducer=n;var d=o.dispatch,b=o.pending,x=s.memoizedState;if(b!==null){o.pending=null;var $=b=b.next;do x=n(x,$.action),$=$.next;while($!==b);La(x,s.memoizedState)||(Jn=!0),s.memoizedState=x,s.baseQueue===null&&(s.baseState=x),o.lastRenderedState=x}return[x,d]}function bb(n,s,o){var d=tn,b=Kn(),x=bn;if(x){if(o===void 0)throw Error(i(407));o=o()}else o=s();var $=!La((Rn||b).memoizedState,o);if($&&(b.memoizedState=o,Jn=!0),b=b.queue,ym(Sb.bind(null,d,b,n),[n]),b.getSnapshot!==s||$||Qn!==null&&Qn.memoizedState.tag&1){if(d.flags|=2048,tl(9,{destroy:void 0},xb.bind(null,d,b,o,s),null),In===null)throw Error(i(349));x||(Bs&127)!==0||vb(d,s,o)}return o}function vb(n,s,o){n.flags|=16384,n={getSnapshot:s,value:o},s=tn.updateQueue,s===null?(s=Zc(),tn.updateQueue=s,s.stores=[n]):(o=s.stores,o===null?s.stores=[n]:o.push(n))}function xb(n,s,o,d){s.value=o,s.getSnapshot=d,wb(s)&&Nb(n)}function Sb(n,s,o){return o(function(){wb(s)&&Nb(n)})}function wb(n){var s=n.getSnapshot;n=n.value;try{var o=s();return!La(n,o)}catch{return!0}}function Nb(n){var s=ri(n,2);s!==null&&Ca(s,n,2)}function hm(n){var s=ba();if(typeof n=="function"){var o=n;if(n=o(),hi){nt(!0);try{o()}finally{nt(!1)}}}return s.memoizedState=s.baseState=n,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:qs,lastRenderedState:n},s}function Eb(n,s,o,d){return n.baseState=o,fm(n,Rn,typeof d=="function"?d:qs)}function f_(n,s,o,d,b){if(nu(n))throw Error(i(485));if(n=s.action,n!==null){var x={payload:b,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function($){x.listeners.push($)}};D.T!==null?o(!0):x.isTransition=!1,d(x),o=s.pending,o===null?(x.next=s.pending=x,jb(s,x)):(x.next=o.next,s.pending=o.next=x)}}function jb(n,s){var o=s.action,d=s.payload,b=n.state;if(s.isTransition){var x=D.T,$={};D.T=$;try{var K=o(b,d),pe=D.S;pe!==null&&pe($,K),_b(n,s,K)}catch(Oe){pm(n,s,Oe)}finally{x!==null&&$.types!==null&&(x.types=$.types),D.T=x}}else try{x=o(b,d),_b(n,s,x)}catch(Oe){pm(n,s,Oe)}}function _b(n,s,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(d){Cb(n,s,d)},function(d){return pm(n,s,d)}):Cb(n,s,o)}function Cb(n,s,o){s.status="fulfilled",s.value=o,Ab(s),n.state=o,s=n.pending,s!==null&&(o=s.next,o===s?n.pending=null:(o=o.next,s.next=o,jb(n,o)))}function pm(n,s,o){var d=n.pending;if(n.pending=null,d!==null){d=d.next;do s.status="rejected",s.reason=o,Ab(s),s=s.next;while(s!==d)}n.action=null}function Ab(n){n=n.listeners;for(var s=0;s<n.length;s++)(0,n[s])()}function Tb(n,s){return s}function Mb(n,s){if(bn){var o=In.formState;if(o!==null){e:{var d=tn;if(bn){if(On){t:{for(var b=On,x=Ja;b.nodeType!==8;){if(!x){b=null;break t}if(b=ts(b.nextSibling),b===null){b=null;break t}}x=b.data,b=x==="F!"||x==="F"?b:null}if(b){On=ts(b.nextSibling),d=b.data==="F!";break e}}mr(d)}d=!1}d&&(s=o[0])}}return o=ba(),o.memoizedState=o.baseState=s,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Tb,lastRenderedState:s},o.queue=d,o=Kb.bind(null,tn,d),d.dispatch=o,d=hm(!1),x=Sm.bind(null,tn,!1,d.queue),d=ba(),b={state:s,dispatch:null,action:n,pending:null},d.queue=b,o=f_.bind(null,tn,b,x,o),b.dispatch=o,d.memoizedState=n,[s,o,!1]}function Rb(n){var s=Kn();return kb(s,Rn,n)}function kb(n,s,o){if(s=fm(n,s,Tb)[0],n=Jc(qs)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var d=ro(s)}catch($){throw $===Wi?Hc:$}else d=s;s=Kn();var b=s.queue,x=b.dispatch;return o!==s.memoizedState&&(tn.flags|=2048,tl(9,{destroy:void 0},m_.bind(null,b,o),null)),[d,x,n]}function m_(n,s){n.action=s}function Db(n){var s=Kn(),o=Rn;if(o!==null)return kb(s,o,n);Kn(),s=s.memoizedState,o=Kn();var d=o.queue.dispatch;return o.memoizedState=n,[s,d,!1]}function tl(n,s,o,d){return n={tag:n,create:o,deps:d,inst:s,next:null},s=tn.updateQueue,s===null&&(s=Zc(),tn.updateQueue=s),o=s.lastEffect,o===null?s.lastEffect=n.next=n:(d=o.next,o.next=n,n.next=d,s.lastEffect=n),n}function Ib(){return Kn().memoizedState}function eu(n,s,o,d){var b=ba();tn.flags|=n,b.memoizedState=tl(1|s,{destroy:void 0},o,d===void 0?null:d)}function tu(n,s,o,d){var b=Kn();d=d===void 0?null:d;var x=b.memoizedState.inst;Rn!==null&&d!==null&&im(d,Rn.memoizedState.deps)?b.memoizedState=tl(s,x,o,d):(tn.flags|=n,b.memoizedState=tl(1|s,x,o,d))}function Lb(n,s){eu(8390656,8,n,s)}function ym(n,s){tu(2048,8,n,s)}function h_(n){tn.flags|=4;var s=tn.updateQueue;if(s===null)s=Zc(),tn.updateQueue=s,s.events=[n];else{var o=s.events;o===null?s.events=[n]:o.push(n)}}function Ob(n){var s=Kn().memoizedState;return h_({ref:s,nextImpl:n}),function(){if((_n&2)!==0)throw Error(i(440));return s.impl.apply(void 0,arguments)}}function zb(n,s){return tu(4,2,n,s)}function $b(n,s){return tu(4,4,n,s)}function Fb(n,s){if(typeof s=="function"){n=n();var o=s(n);return function(){typeof o=="function"?o():s(null)}}if(s!=null)return n=n(),s.current=n,function(){s.current=null}}function Ub(n,s,o){o=o!=null?o.concat([n]):null,tu(4,4,Fb.bind(null,s,n),o)}function gm(){}function Bb(n,s){var o=Kn();s=s===void 0?null:s;var d=o.memoizedState;return s!==null&&im(s,d[1])?d[0]:(o.memoizedState=[n,s],n)}function qb(n,s){var o=Kn();s=s===void 0?null:s;var d=o.memoizedState;if(s!==null&&im(s,d[1]))return d[0];if(d=n(),hi){nt(!0);try{n()}finally{nt(!1)}}return o.memoizedState=[d,s],d}function bm(n,s,o){return o===void 0||(Bs&1073741824)!==0&&(yn&261930)===0?n.memoizedState=s:(n.memoizedState=o,n=Hv(),tn.lanes|=n,wr|=n,o)}function Hb(n,s,o,d){return La(o,s)?o:Qi.current!==null?(n=bm(n,o,d),La(n,s)||(Jn=!0),n):(Bs&42)===0||(Bs&1073741824)!==0&&(yn&261930)===0?(Jn=!0,n.memoizedState=o):(n=Hv(),tn.lanes|=n,wr|=n,s)}function Pb(n,s,o,d,b){var x=L.p;L.p=x!==0&&8>x?x:8;var $=D.T,K={};D.T=K,Sm(n,!1,s,o);try{var pe=b(),Oe=D.S;if(Oe!==null&&Oe(K,pe),pe!==null&&typeof pe=="object"&&typeof pe.then=="function"){var Je=c_(pe,d);io(n,s,Je,Ba(n))}else io(n,s,d,Ba(n))}catch(lt){io(n,s,{then:function(){},status:"rejected",reason:lt},Ba())}finally{L.p=x,$!==null&&K.types!==null&&($.types=K.types),D.T=$}}function p_(){}function vm(n,s,o,d){if(n.tag!==5)throw Error(i(476));var b=Vb(n).queue;Pb(n,b,s,U,o===null?p_:function(){return Yb(n),o(d)})}function Vb(n){var s=n.memoizedState;if(s!==null)return s;s={memoizedState:U,baseState:U,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qs,lastRenderedState:U},next:null};var o={};return s.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qs,lastRenderedState:o},next:null},n.memoizedState=s,n=n.alternate,n!==null&&(n.memoizedState=s),s}function Yb(n){var s=Vb(n);s.next===null&&(s=n.alternate.memoizedState),io(n,s.next.queue,{},Ba())}function xm(){return ua(Eo)}function Gb(){return Kn().memoizedState}function Xb(){return Kn().memoizedState}function y_(n){for(var s=n.return;s!==null;){switch(s.tag){case 24:case 3:var o=Ba();n=yr(o);var d=gr(s,n,o);d!==null&&(Ca(d,s,o),to(d,s,o)),s={cache:Kf()},n.payload=s;return}s=s.return}}function g_(n,s,o){var d=Ba();o={lane:d,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},nu(n)?Wb(s,o):(o=$f(n,s,o,d),o!==null&&(Ca(o,n,d),Zb(o,s,d)))}function Kb(n,s,o){var d=Ba();io(n,s,o,d)}function io(n,s,o,d){var b={lane:d,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null};if(nu(n))Wb(s,b);else{var x=n.alternate;if(n.lanes===0&&(x===null||x.lanes===0)&&(x=s.lastRenderedReducer,x!==null))try{var $=s.lastRenderedState,K=x($,o);if(b.hasEagerState=!0,b.eagerState=K,La(K,$))return Oc(n,s,b,0),In===null&&Lc(),!1}catch{}finally{}if(o=$f(n,s,b,d),o!==null)return Ca(o,n,d),Zb(o,s,d),!0}return!1}function Sm(n,s,o,d){if(d={lane:2,revertLane:Jm(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},nu(n)){if(s)throw Error(i(479))}else s=$f(n,o,d,2),s!==null&&Ca(s,n,2)}function nu(n){var s=n.alternate;return n===tn||s!==null&&s===tn}function Wb(n,s){Ji=Kc=!0;var o=n.pending;o===null?s.next=s:(s.next=o.next,o.next=s),n.pending=s}function Zb(n,s,o){if((o&4194048)!==0){var d=s.lanes;d&=n.pendingLanes,o|=d,s.lanes=o,We(n,o)}}var lo={readContext:ua,use:Qc,useCallback:Pn,useContext:Pn,useEffect:Pn,useImperativeHandle:Pn,useLayoutEffect:Pn,useInsertionEffect:Pn,useMemo:Pn,useReducer:Pn,useRef:Pn,useState:Pn,useDebugValue:Pn,useDeferredValue:Pn,useTransition:Pn,useSyncExternalStore:Pn,useId:Pn,useHostTransitionStatus:Pn,useFormState:Pn,useActionState:Pn,useOptimistic:Pn,useMemoCache:Pn,useCacheRefresh:Pn};lo.useEffectEvent=Pn;var Qb={readContext:ua,use:Qc,useCallback:function(n,s){return ba().memoizedState=[n,s===void 0?null:s],n},useContext:ua,useEffect:Lb,useImperativeHandle:function(n,s,o){o=o!=null?o.concat([n]):null,eu(4194308,4,Fb.bind(null,s,n),o)},useLayoutEffect:function(n,s){return eu(4194308,4,n,s)},useInsertionEffect:function(n,s){eu(4,2,n,s)},useMemo:function(n,s){var o=ba();s=s===void 0?null:s;var d=n();if(hi){nt(!0);try{n()}finally{nt(!1)}}return o.memoizedState=[d,s],d},useReducer:function(n,s,o){var d=ba();if(o!==void 0){var b=o(s);if(hi){nt(!0);try{o(s)}finally{nt(!1)}}}else b=s;return d.memoizedState=d.baseState=b,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:b},d.queue=n,n=n.dispatch=g_.bind(null,tn,n),[d.memoizedState,n]},useRef:function(n){var s=ba();return n={current:n},s.memoizedState=n},useState:function(n){n=hm(n);var s=n.queue,o=Kb.bind(null,tn,s);return s.dispatch=o,[n.memoizedState,o]},useDebugValue:gm,useDeferredValue:function(n,s){var o=ba();return bm(o,n,s)},useTransition:function(){var n=hm(!1);return n=Pb.bind(null,tn,n.queue,!0,!1),ba().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,s,o){var d=tn,b=ba();if(bn){if(o===void 0)throw Error(i(407));o=o()}else{if(o=s(),In===null)throw Error(i(349));(yn&127)!==0||vb(d,s,o)}b.memoizedState=o;var x={value:o,getSnapshot:s};return b.queue=x,Lb(Sb.bind(null,d,x,n),[n]),d.flags|=2048,tl(9,{destroy:void 0},xb.bind(null,d,x,o,s),null),o},useId:function(){var n=ba(),s=In.identifierPrefix;if(bn){var o=Es,d=Ns;o=(d&~(1<<32-$e(d)-1)).toString(32)+o,s="_"+s+"R_"+o,o=Wc++,0<o&&(s+="H"+o.toString(32)),s+="_"}else o=u_++,s="_"+s+"r_"+o.toString(32)+"_";return n.memoizedState=s},useHostTransitionStatus:xm,useFormState:Mb,useActionState:Mb,useOptimistic:function(n){var s=ba();s.memoizedState=s.baseState=n;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=o,s=Sm.bind(null,tn,!0,o),o.dispatch=s,[n,s]},useMemoCache:dm,useCacheRefresh:function(){return ba().memoizedState=y_.bind(null,tn)},useEffectEvent:function(n){var s=ba(),o={impl:n};return s.memoizedState=o,function(){if((_n&2)!==0)throw Error(i(440));return o.impl.apply(void 0,arguments)}}},wm={readContext:ua,use:Qc,useCallback:Bb,useContext:ua,useEffect:ym,useImperativeHandle:Ub,useInsertionEffect:zb,useLayoutEffect:$b,useMemo:qb,useReducer:Jc,useRef:Ib,useState:function(){return Jc(qs)},useDebugValue:gm,useDeferredValue:function(n,s){var o=Kn();return Hb(o,Rn.memoizedState,n,s)},useTransition:function(){var n=Jc(qs)[0],s=Kn().memoizedState;return[typeof n=="boolean"?n:ro(n),s]},useSyncExternalStore:bb,useId:Gb,useHostTransitionStatus:xm,useFormState:Rb,useActionState:Rb,useOptimistic:function(n,s){var o=Kn();return Eb(o,Rn,n,s)},useMemoCache:dm,useCacheRefresh:Xb};wm.useEffectEvent=Ob;var Jb={readContext:ua,use:Qc,useCallback:Bb,useContext:ua,useEffect:ym,useImperativeHandle:Ub,useInsertionEffect:zb,useLayoutEffect:$b,useMemo:qb,useReducer:mm,useRef:Ib,useState:function(){return mm(qs)},useDebugValue:gm,useDeferredValue:function(n,s){var o=Kn();return Rn===null?bm(o,n,s):Hb(o,Rn.memoizedState,n,s)},useTransition:function(){var n=mm(qs)[0],s=Kn().memoizedState;return[typeof n=="boolean"?n:ro(n),s]},useSyncExternalStore:bb,useId:Gb,useHostTransitionStatus:xm,useFormState:Db,useActionState:Db,useOptimistic:function(n,s){var o=Kn();return Rn!==null?Eb(o,Rn,n,s):(o.baseState=n,[n,o.queue.dispatch])},useMemoCache:dm,useCacheRefresh:Xb};Jb.useEffectEvent=Ob;function Nm(n,s,o,d){s=n.memoizedState,o=o(d,s),o=o==null?s:g({},s,o),n.memoizedState=o,n.lanes===0&&(n.updateQueue.baseState=o)}var Em={enqueueSetState:function(n,s,o){n=n._reactInternals;var d=Ba(),b=yr(d);b.payload=s,o!=null&&(b.callback=o),s=gr(n,b,d),s!==null&&(Ca(s,n,d),to(s,n,d))},enqueueReplaceState:function(n,s,o){n=n._reactInternals;var d=Ba(),b=yr(d);b.tag=1,b.payload=s,o!=null&&(b.callback=o),s=gr(n,b,d),s!==null&&(Ca(s,n,d),to(s,n,d))},enqueueForceUpdate:function(n,s){n=n._reactInternals;var o=Ba(),d=yr(o);d.tag=2,s!=null&&(d.callback=s),s=gr(n,d,o),s!==null&&(Ca(s,n,o),to(s,n,o))}};function ev(n,s,o,d,b,x,$){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(d,x,$):s.prototype&&s.prototype.isPureReactComponent?!Gl(o,d)||!Gl(b,x):!0}function tv(n,s,o,d){n=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(o,d),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(o,d),s.state!==n&&Em.enqueueReplaceState(s,s.state,null)}function pi(n,s){var o=s;if("ref"in s){o={};for(var d in s)d!=="ref"&&(o[d]=s[d])}if(n=n.defaultProps){o===s&&(o=g({},o));for(var b in n)o[b]===void 0&&(o[b]=n[b])}return o}function nv(n){Ic(n)}function av(n){console.error(n)}function sv(n){Ic(n)}function au(n,s){try{var o=n.onUncaughtError;o(s.value,{componentStack:s.stack})}catch(d){setTimeout(function(){throw d})}}function rv(n,s,o){try{var d=n.onCaughtError;d(o.value,{componentStack:o.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function jm(n,s,o){return o=yr(o),o.tag=3,o.payload={element:null},o.callback=function(){au(n,s)},o}function iv(n){return n=yr(n),n.tag=3,n}function lv(n,s,o,d){var b=o.type.getDerivedStateFromError;if(typeof b=="function"){var x=d.value;n.payload=function(){return b(x)},n.callback=function(){rv(s,o,d)}}var $=o.stateNode;$!==null&&typeof $.componentDidCatch=="function"&&(n.callback=function(){rv(s,o,d),typeof b!="function"&&(Nr===null?Nr=new Set([this]):Nr.add(this));var K=d.stack;this.componentDidCatch(d.value,{componentStack:K!==null?K:""})})}function b_(n,s,o,d,b){if(o.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(s=o.alternate,s!==null&&Gi(s,o,b,!0),o=za.current,o!==null){switch(o.tag){case 31:case 13:return es===null?pu():o.alternate===null&&Vn===0&&(Vn=3),o.flags&=-257,o.flags|=65536,o.lanes=b,d===Pc?o.flags|=16384:(s=o.updateQueue,s===null?o.updateQueue=new Set([d]):s.add(d),Wm(n,d,b)),!1;case 22:return o.flags|=65536,d===Pc?o.flags|=16384:(s=o.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([d])},o.updateQueue=s):(o=s.retryQueue,o===null?s.retryQueue=new Set([d]):o.add(d)),Wm(n,d,b)),!1}throw Error(i(435,o.tag))}return Wm(n,d,b),pu(),!1}if(bn)return s=za.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=b,d!==Pf&&(n=Error(i(422),{cause:d}),Wl(Wa(n,o)))):(d!==Pf&&(s=Error(i(423),{cause:d}),Wl(Wa(s,o))),n=n.current.alternate,n.flags|=65536,b&=-b,n.lanes|=b,d=Wa(d,o),b=jm(n.stateNode,d,b),tm(n,b),Vn!==4&&(Vn=2)),!1;var x=Error(i(520),{cause:d});if(x=Wa(x,o),yo===null?yo=[x]:yo.push(x),Vn!==4&&(Vn=2),s===null)return!0;d=Wa(d,o),o=s;do{switch(o.tag){case 3:return o.flags|=65536,n=b&-b,o.lanes|=n,n=jm(o.stateNode,d,n),tm(o,n),!1;case 1:if(s=o.type,x=o.stateNode,(o.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Nr===null||!Nr.has(x))))return o.flags|=65536,b&=-b,o.lanes|=b,b=iv(b),lv(b,n,o,d),tm(o,b),!1}o=o.return}while(o!==null);return!1}var _m=Error(i(461)),Jn=!1;function da(n,s,o,d){s.child=n===null?db(s,null,o,d):mi(s,n.child,o,d)}function ov(n,s,o,d,b){o=o.render;var x=s.ref;if("ref"in d){var $={};for(var K in d)K!=="ref"&&($[K]=d[K])}else $=d;return ci(s),d=lm(n,s,o,$,x,b),K=om(),n!==null&&!Jn?(cm(n,s,b),Hs(n,s,b)):(bn&&K&&qf(s),s.flags|=1,da(n,s,d,b),s.child)}function cv(n,s,o,d,b){if(n===null){var x=o.type;return typeof x=="function"&&!Ff(x)&&x.defaultProps===void 0&&o.compare===null?(s.tag=15,s.type=x,uv(n,s,x,d,b)):(n=$c(o.type,null,d,s,s.mode,b),n.ref=s.ref,n.return=s,s.child=n)}if(x=n.child,!Im(n,b)){var $=x.memoizedProps;if(o=o.compare,o=o!==null?o:Gl,o($,d)&&n.ref===s.ref)return Hs(n,s,b)}return s.flags|=1,n=zs(x,d),n.ref=s.ref,n.return=s,s.child=n}function uv(n,s,o,d,b){if(n!==null){var x=n.memoizedProps;if(Gl(x,d)&&n.ref===s.ref)if(Jn=!1,s.pendingProps=d=x,Im(n,b))(n.flags&131072)!==0&&(Jn=!0);else return s.lanes=n.lanes,Hs(n,s,b)}return Cm(n,s,o,d,b)}function dv(n,s,o,d){var b=d.children,x=n!==null?n.memoizedState:null;if(n===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((s.flags&128)!==0){if(x=x!==null?x.baseLanes|o:o,n!==null){for(d=s.child=n.child,b=0;d!==null;)b=b|d.lanes|d.childLanes,d=d.sibling;d=b&~x}else d=0,s.child=null;return fv(n,s,x,o,d)}if((o&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},n!==null&&qc(s,x!==null?x.cachePool:null),x!==null?hb(s,x):am(),pb(s);else return d=s.lanes=536870912,fv(n,s,x!==null?x.baseLanes|o:o,o,d)}else x!==null?(qc(s,x.cachePool),hb(s,x),vr(),s.memoizedState=null):(n!==null&&qc(s,null),am(),vr());return da(n,s,b,o),s.child}function oo(n,s){return n!==null&&n.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function fv(n,s,o,d,b){var x=Zf();return x=x===null?null:{parent:Zn._currentValue,pool:x},s.memoizedState={baseLanes:o,cachePool:x},n!==null&&qc(s,null),am(),pb(s),n!==null&&Gi(n,s,d,!0),s.childLanes=b,null}function su(n,s){return s=iu({mode:s.mode,children:s.children},n.mode),s.ref=n.ref,n.child=s,s.return=n,s}function mv(n,s,o){return mi(s,n.child,null,o),n=su(s,s.pendingProps),n.flags|=2,$a(s),s.memoizedState=null,n}function v_(n,s,o){var d=s.pendingProps,b=(s.flags&128)!==0;if(s.flags&=-129,n===null){if(bn){if(d.mode==="hidden")return n=su(s,d),s.lanes=536870912,oo(null,n);if(rm(s),(n=On)?(n=jx(n,Ja),n=n!==null&&n.data==="&"?n:null,n!==null&&(s.memoizedState={dehydrated:n,treeContext:dr!==null?{id:Ns,overflow:Es}:null,retryLane:536870912,hydrationErrors:null},o=Wg(n),o.return=s,s.child=o,ca=s,On=null)):n=null,n===null)throw mr(s);return s.lanes=536870912,null}return su(s,d)}var x=n.memoizedState;if(x!==null){var $=x.dehydrated;if(rm(s),b)if(s.flags&256)s.flags&=-257,s=mv(n,s,o);else if(s.memoizedState!==null)s.child=n.child,s.flags|=128,s=null;else throw Error(i(558));else if(Jn||Gi(n,s,o,!1),b=(o&n.childLanes)!==0,Jn||b){if(d=In,d!==null&&($=dt(d,o),$!==0&&$!==x.retryLane))throw x.retryLane=$,ri(n,$),Ca(d,n,$),_m;pu(),s=mv(n,s,o)}else n=x.treeContext,On=ts($.nextSibling),ca=s,bn=!0,fr=null,Ja=!1,n!==null&&Jg(s,n),s=su(s,d),s.flags|=4096;return s}return n=zs(n.child,{mode:d.mode,children:d.children}),n.ref=s.ref,s.child=n,n.return=s,n}function ru(n,s){var o=s.ref;if(o===null)n!==null&&n.ref!==null&&(s.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(i(284));(n===null||n.ref!==o)&&(s.flags|=4194816)}}function Cm(n,s,o,d,b){return ci(s),o=lm(n,s,o,d,void 0,b),d=om(),n!==null&&!Jn?(cm(n,s,b),Hs(n,s,b)):(bn&&d&&qf(s),s.flags|=1,da(n,s,o,b),s.child)}function hv(n,s,o,d,b,x){return ci(s),s.updateQueue=null,o=gb(s,d,o,b),yb(n),d=om(),n!==null&&!Jn?(cm(n,s,x),Hs(n,s,x)):(bn&&d&&qf(s),s.flags|=1,da(n,s,o,x),s.child)}function pv(n,s,o,d,b){if(ci(s),s.stateNode===null){var x=Hi,$=o.contextType;typeof $=="object"&&$!==null&&(x=ua($)),x=new o(d,x),s.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=Em,s.stateNode=x,x._reactInternals=s,x=s.stateNode,x.props=d,x.state=s.memoizedState,x.refs={},Jf(s),$=o.contextType,x.context=typeof $=="object"&&$!==null?ua($):Hi,x.state=s.memoizedState,$=o.getDerivedStateFromProps,typeof $=="function"&&(Nm(s,o,$,d),x.state=s.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||($=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),$!==x.state&&Em.enqueueReplaceState(x,x.state,null),ao(s,d,x,b),no(),x.state=s.memoizedState),typeof x.componentDidMount=="function"&&(s.flags|=4194308),d=!0}else if(n===null){x=s.stateNode;var K=s.memoizedProps,pe=pi(o,K);x.props=pe;var Oe=x.context,Je=o.contextType;$=Hi,typeof Je=="object"&&Je!==null&&($=ua(Je));var lt=o.getDerivedStateFromProps;Je=typeof lt=="function"||typeof x.getSnapshotBeforeUpdate=="function",K=s.pendingProps!==K,Je||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(K||Oe!==$)&&tv(s,x,d,$),pr=!1;var Ue=s.memoizedState;x.state=Ue,ao(s,d,x,b),no(),Oe=s.memoizedState,K||Ue!==Oe||pr?(typeof lt=="function"&&(Nm(s,o,lt,d),Oe=s.memoizedState),(pe=pr||ev(s,o,pe,d,Ue,Oe,$))?(Je||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(s.flags|=4194308)):(typeof x.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=d,s.memoizedState=Oe),x.props=d,x.state=Oe,x.context=$,d=pe):(typeof x.componentDidMount=="function"&&(s.flags|=4194308),d=!1)}else{x=s.stateNode,em(n,s),$=s.memoizedProps,Je=pi(o,$),x.props=Je,lt=s.pendingProps,Ue=x.context,Oe=o.contextType,pe=Hi,typeof Oe=="object"&&Oe!==null&&(pe=ua(Oe)),K=o.getDerivedStateFromProps,(Oe=typeof K=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||($!==lt||Ue!==pe)&&tv(s,x,d,pe),pr=!1,Ue=s.memoizedState,x.state=Ue,ao(s,d,x,b),no();var Ye=s.memoizedState;$!==lt||Ue!==Ye||pr||n!==null&&n.dependencies!==null&&Uc(n.dependencies)?(typeof K=="function"&&(Nm(s,o,K,d),Ye=s.memoizedState),(Je=pr||ev(s,o,Je,d,Ue,Ye,pe)||n!==null&&n.dependencies!==null&&Uc(n.dependencies))?(Oe||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(d,Ye,pe),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(d,Ye,pe)),typeof x.componentDidUpdate=="function"&&(s.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof x.componentDidUpdate!="function"||$===n.memoizedProps&&Ue===n.memoizedState||(s.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||$===n.memoizedProps&&Ue===n.memoizedState||(s.flags|=1024),s.memoizedProps=d,s.memoizedState=Ye),x.props=d,x.state=Ye,x.context=pe,d=Je):(typeof x.componentDidUpdate!="function"||$===n.memoizedProps&&Ue===n.memoizedState||(s.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||$===n.memoizedProps&&Ue===n.memoizedState||(s.flags|=1024),d=!1)}return x=d,ru(n,s),d=(s.flags&128)!==0,x||d?(x=s.stateNode,o=d&&typeof o.getDerivedStateFromError!="function"?null:x.render(),s.flags|=1,n!==null&&d?(s.child=mi(s,n.child,null,b),s.child=mi(s,null,o,b)):da(n,s,o,b),s.memoizedState=x.state,n=s.child):n=Hs(n,s,b),n}function yv(n,s,o,d){return li(),s.flags|=256,da(n,s,o,d),s.child}var Am={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Tm(n){return{baseLanes:n,cachePool:rb()}}function Mm(n,s,o){return n=n!==null?n.childLanes&~o:0,s&&(n|=Ua),n}function gv(n,s,o){var d=s.pendingProps,b=!1,x=(s.flags&128)!==0,$;if(($=x)||($=n!==null&&n.memoizedState===null?!1:(Xn.current&2)!==0),$&&(b=!0,s.flags&=-129),$=(s.flags&32)!==0,s.flags&=-33,n===null){if(bn){if(b?br(s):vr(),(n=On)?(n=jx(n,Ja),n=n!==null&&n.data!=="&"?n:null,n!==null&&(s.memoizedState={dehydrated:n,treeContext:dr!==null?{id:Ns,overflow:Es}:null,retryLane:536870912,hydrationErrors:null},o=Wg(n),o.return=s,s.child=o,ca=s,On=null)):n=null,n===null)throw mr(s);return fh(n)?s.lanes=32:s.lanes=536870912,null}var K=d.children;return d=d.fallback,b?(vr(),b=s.mode,K=iu({mode:"hidden",children:K},b),d=ii(d,b,o,null),K.return=s,d.return=s,K.sibling=d,s.child=K,d=s.child,d.memoizedState=Tm(o),d.childLanes=Mm(n,$,o),s.memoizedState=Am,oo(null,d)):(br(s),Rm(s,K))}var pe=n.memoizedState;if(pe!==null&&(K=pe.dehydrated,K!==null)){if(x)s.flags&256?(br(s),s.flags&=-257,s=km(n,s,o)):s.memoizedState!==null?(vr(),s.child=n.child,s.flags|=128,s=null):(vr(),K=d.fallback,b=s.mode,d=iu({mode:"visible",children:d.children},b),K=ii(K,b,o,null),K.flags|=2,d.return=s,K.return=s,d.sibling=K,s.child=d,mi(s,n.child,null,o),d=s.child,d.memoizedState=Tm(o),d.childLanes=Mm(n,$,o),s.memoizedState=Am,s=oo(null,d));else if(br(s),fh(K)){if($=K.nextSibling&&K.nextSibling.dataset,$)var Oe=$.dgst;$=Oe,d=Error(i(419)),d.stack="",d.digest=$,Wl({value:d,source:null,stack:null}),s=km(n,s,o)}else if(Jn||Gi(n,s,o,!1),$=(o&n.childLanes)!==0,Jn||$){if($=In,$!==null&&(d=dt($,o),d!==0&&d!==pe.retryLane))throw pe.retryLane=d,ri(n,d),Ca($,n,d),_m;dh(K)||pu(),s=km(n,s,o)}else dh(K)?(s.flags|=192,s.child=n.child,s=null):(n=pe.treeContext,On=ts(K.nextSibling),ca=s,bn=!0,fr=null,Ja=!1,n!==null&&Jg(s,n),s=Rm(s,d.children),s.flags|=4096);return s}return b?(vr(),K=d.fallback,b=s.mode,pe=n.child,Oe=pe.sibling,d=zs(pe,{mode:"hidden",children:d.children}),d.subtreeFlags=pe.subtreeFlags&65011712,Oe!==null?K=zs(Oe,K):(K=ii(K,b,o,null),K.flags|=2),K.return=s,d.return=s,d.sibling=K,s.child=d,oo(null,d),d=s.child,K=n.child.memoizedState,K===null?K=Tm(o):(b=K.cachePool,b!==null?(pe=Zn._currentValue,b=b.parent!==pe?{parent:pe,pool:pe}:b):b=rb(),K={baseLanes:K.baseLanes|o,cachePool:b}),d.memoizedState=K,d.childLanes=Mm(n,$,o),s.memoizedState=Am,oo(n.child,d)):(br(s),o=n.child,n=o.sibling,o=zs(o,{mode:"visible",children:d.children}),o.return=s,o.sibling=null,n!==null&&($=s.deletions,$===null?(s.deletions=[n],s.flags|=16):$.push(n)),s.child=o,s.memoizedState=null,o)}function Rm(n,s){return s=iu({mode:"visible",children:s},n.mode),s.return=n,n.child=s}function iu(n,s){return n=Oa(22,n,null,s),n.lanes=0,n}function km(n,s,o){return mi(s,n.child,null,o),n=Rm(s,s.pendingProps.children),n.flags|=2,s.memoizedState=null,n}function bv(n,s,o){n.lanes|=s;var d=n.alternate;d!==null&&(d.lanes|=s),Gf(n.return,s,o)}function Dm(n,s,o,d,b,x){var $=n.memoizedState;$===null?n.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:d,tail:o,tailMode:b,treeForkCount:x}:($.isBackwards=s,$.rendering=null,$.renderingStartTime=0,$.last=d,$.tail=o,$.tailMode=b,$.treeForkCount=x)}function vv(n,s,o){var d=s.pendingProps,b=d.revealOrder,x=d.tail;d=d.children;var $=Xn.current,K=($&2)!==0;if(K?($=$&1|2,s.flags|=128):$&=1,G(Xn,$),da(n,s,d,o),d=bn?Kl:0,!K&&n!==null&&(n.flags&128)!==0)e:for(n=s.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&bv(n,o,s);else if(n.tag===19)bv(n,o,s);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break e;for(;n.sibling===null;){if(n.return===null||n.return===s)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}switch(b){case"forwards":for(o=s.child,b=null;o!==null;)n=o.alternate,n!==null&&Xc(n)===null&&(b=o),o=o.sibling;o=b,o===null?(b=s.child,s.child=null):(b=o.sibling,o.sibling=null),Dm(s,!1,b,o,x,d);break;case"backwards":case"unstable_legacy-backwards":for(o=null,b=s.child,s.child=null;b!==null;){if(n=b.alternate,n!==null&&Xc(n)===null){s.child=b;break}n=b.sibling,b.sibling=o,o=b,b=n}Dm(s,!0,o,null,x,d);break;case"together":Dm(s,!1,null,null,void 0,d);break;default:s.memoizedState=null}return s.child}function Hs(n,s,o){if(n!==null&&(s.dependencies=n.dependencies),wr|=s.lanes,(o&s.childLanes)===0)if(n!==null){if(Gi(n,s,o,!1),(o&s.childLanes)===0)return null}else return null;if(n!==null&&s.child!==n.child)throw Error(i(153));if(s.child!==null){for(n=s.child,o=zs(n,n.pendingProps),s.child=o,o.return=s;n.sibling!==null;)n=n.sibling,o=o.sibling=zs(n,n.pendingProps),o.return=s;o.sibling=null}return s.child}function Im(n,s){return(n.lanes&s)!==0?!0:(n=n.dependencies,!!(n!==null&&Uc(n)))}function x_(n,s,o){switch(s.tag){case 3:Q(s,s.stateNode.containerInfo),hr(s,Zn,n.memoizedState.cache),li();break;case 27:case 5:ne(s);break;case 4:Q(s,s.stateNode.containerInfo);break;case 10:hr(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,rm(s),null;break;case 13:var d=s.memoizedState;if(d!==null)return d.dehydrated!==null?(br(s),s.flags|=128,null):(o&s.child.childLanes)!==0?gv(n,s,o):(br(s),n=Hs(n,s,o),n!==null?n.sibling:null);br(s);break;case 19:var b=(n.flags&128)!==0;if(d=(o&s.childLanes)!==0,d||(Gi(n,s,o,!1),d=(o&s.childLanes)!==0),b){if(d)return vv(n,s,o);s.flags|=128}if(b=s.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),G(Xn,Xn.current),d)break;return null;case 22:return s.lanes=0,dv(n,s,o,s.pendingProps);case 24:hr(s,Zn,n.memoizedState.cache)}return Hs(n,s,o)}function xv(n,s,o){if(n!==null)if(n.memoizedProps!==s.pendingProps)Jn=!0;else{if(!Im(n,o)&&(s.flags&128)===0)return Jn=!1,x_(n,s,o);Jn=(n.flags&131072)!==0}else Jn=!1,bn&&(s.flags&1048576)!==0&&Qg(s,Kl,s.index);switch(s.lanes=0,s.tag){case 16:e:{var d=s.pendingProps;if(n=di(s.elementType),s.type=n,typeof n=="function")Ff(n)?(d=pi(n,d),s.tag=1,s=pv(null,s,n,d,o)):(s.tag=0,s=Cm(null,s,n,d,o));else{if(n!=null){var b=n.$$typeof;if(b===E){s.tag=11,s=ov(null,s,n,d,o);break e}else if(b===A){s.tag=14,s=cv(null,s,n,d,o);break e}}throw s=I(n)||n,Error(i(306,s,""))}}return s;case 0:return Cm(n,s,s.type,s.pendingProps,o);case 1:return d=s.type,b=pi(d,s.pendingProps),pv(n,s,d,b,o);case 3:e:{if(Q(s,s.stateNode.containerInfo),n===null)throw Error(i(387));d=s.pendingProps;var x=s.memoizedState;b=x.element,em(n,s),ao(s,d,null,o);var $=s.memoizedState;if(d=$.cache,hr(s,Zn,d),d!==x.cache&&Xf(s,[Zn],o,!0),no(),d=$.element,x.isDehydrated)if(x={element:d,isDehydrated:!1,cache:$.cache},s.updateQueue.baseState=x,s.memoizedState=x,s.flags&256){s=yv(n,s,d,o);break e}else if(d!==b){b=Wa(Error(i(424)),s),Wl(b),s=yv(n,s,d,o);break e}else{switch(n=s.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(On=ts(n.firstChild),ca=s,bn=!0,fr=null,Ja=!0,o=db(s,null,d,o),s.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling}else{if(li(),d===b){s=Hs(n,s,o);break e}da(n,s,d,o)}s=s.child}return s;case 26:return ru(n,s),n===null?(o=Rx(s.type,null,s.pendingProps,null))?s.memoizedState=o:bn||(o=s.type,n=s.pendingProps,d=wu(Z.current).createElement(o),d[Ke]=s,d[ot]=n,fa(d,o,n),_e(d),s.stateNode=d):s.memoizedState=Rx(s.type,n.memoizedProps,s.pendingProps,n.memoizedState),null;case 27:return ne(s),n===null&&bn&&(d=s.stateNode=Ax(s.type,s.pendingProps,Z.current),ca=s,Ja=!0,b=On,Cr(s.type)?(mh=b,On=ts(d.firstChild)):On=b),da(n,s,s.pendingProps.children,o),ru(n,s),n===null&&(s.flags|=4194304),s.child;case 5:return n===null&&bn&&((b=d=On)&&(d=W_(d,s.type,s.pendingProps,Ja),d!==null?(s.stateNode=d,ca=s,On=ts(d.firstChild),Ja=!1,b=!0):b=!1),b||mr(s)),ne(s),b=s.type,x=s.pendingProps,$=n!==null?n.memoizedProps:null,d=x.children,oh(b,x)?d=null:$!==null&&oh(b,$)&&(s.flags|=32),s.memoizedState!==null&&(b=lm(n,s,d_,null,null,o),Eo._currentValue=b),ru(n,s),da(n,s,d,o),s.child;case 6:return n===null&&bn&&((n=o=On)&&(o=Z_(o,s.pendingProps,Ja),o!==null?(s.stateNode=o,ca=s,On=null,n=!0):n=!1),n||mr(s)),null;case 13:return gv(n,s,o);case 4:return Q(s,s.stateNode.containerInfo),d=s.pendingProps,n===null?s.child=mi(s,null,d,o):da(n,s,d,o),s.child;case 11:return ov(n,s,s.type,s.pendingProps,o);case 7:return da(n,s,s.pendingProps,o),s.child;case 8:return da(n,s,s.pendingProps.children,o),s.child;case 12:return da(n,s,s.pendingProps.children,o),s.child;case 10:return d=s.pendingProps,hr(s,s.type,d.value),da(n,s,d.children,o),s.child;case 9:return b=s.type._context,d=s.pendingProps.children,ci(s),b=ua(b),d=d(b),s.flags|=1,da(n,s,d,o),s.child;case 14:return cv(n,s,s.type,s.pendingProps,o);case 15:return uv(n,s,s.type,s.pendingProps,o);case 19:return vv(n,s,o);case 31:return v_(n,s,o);case 22:return dv(n,s,o,s.pendingProps);case 24:return ci(s),d=ua(Zn),n===null?(b=Zf(),b===null&&(b=In,x=Kf(),b.pooledCache=x,x.refCount++,x!==null&&(b.pooledCacheLanes|=o),b=x),s.memoizedState={parent:d,cache:b},Jf(s),hr(s,Zn,b)):((n.lanes&o)!==0&&(em(n,s),ao(s,null,null,o),no()),b=n.memoizedState,x=s.memoizedState,b.parent!==d?(b={parent:d,cache:d},s.memoizedState=b,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=b),hr(s,Zn,d)):(d=x.cache,hr(s,Zn,d),d!==b.cache&&Xf(s,[Zn],o,!0))),da(n,s,s.pendingProps.children,o),s.child;case 29:throw s.pendingProps}throw Error(i(156,s.tag))}function Ps(n){n.flags|=4}function Lm(n,s,o,d,b){if((s=(n.mode&32)!==0)&&(s=!1),s){if(n.flags|=16777216,(b&335544128)===b)if(n.stateNode.complete)n.flags|=8192;else if(Gv())n.flags|=8192;else throw fi=Pc,Qf}else n.flags&=-16777217}function Sv(n,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!Ox(s))if(Gv())n.flags|=8192;else throw fi=Pc,Qf}function lu(n,s){s!==null&&(n.flags|=4),n.flags&16384&&(s=n.tag!==22?Lt():536870912,n.lanes|=s,rl|=s)}function co(n,s){if(!bn)switch(n.tailMode){case"hidden":s=n.tail;for(var o=null;s!==null;)s.alternate!==null&&(o=s),s=s.sibling;o===null?n.tail=null:o.sibling=null;break;case"collapsed":o=n.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?s||n.tail===null?n.tail=null:n.tail.sibling=null:d.sibling=null}}function zn(n){var s=n.alternate!==null&&n.alternate.child===n.child,o=0,d=0;if(s)for(var b=n.child;b!==null;)o|=b.lanes|b.childLanes,d|=b.subtreeFlags&65011712,d|=b.flags&65011712,b.return=n,b=b.sibling;else for(b=n.child;b!==null;)o|=b.lanes|b.childLanes,d|=b.subtreeFlags,d|=b.flags,b.return=n,b=b.sibling;return n.subtreeFlags|=d,n.childLanes=o,s}function S_(n,s,o){var d=s.pendingProps;switch(Hf(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zn(s),null;case 1:return zn(s),null;case 3:return o=s.stateNode,d=null,n!==null&&(d=n.memoizedState.cache),s.memoizedState.cache!==d&&(s.flags|=2048),Us(Zn),oe(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(n===null||n.child===null)&&(Yi(s)?Ps(s):n===null||n.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Vf())),zn(s),null;case 26:var b=s.type,x=s.memoizedState;return n===null?(Ps(s),x!==null?(zn(s),Sv(s,x)):(zn(s),Lm(s,b,null,d,o))):x?x!==n.memoizedState?(Ps(s),zn(s),Sv(s,x)):(zn(s),s.flags&=-16777217):(n=n.memoizedProps,n!==d&&Ps(s),zn(s),Lm(s,b,n,d,o)),null;case 27:if(we(s),o=Z.current,b=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==d&&Ps(s);else{if(!d){if(s.stateNode===null)throw Error(i(166));return zn(s),null}n=J.current,Yi(s)?eb(s):(n=Ax(b,d,o),s.stateNode=n,Ps(s))}return zn(s),null;case 5:if(we(s),b=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==d&&Ps(s);else{if(!d){if(s.stateNode===null)throw Error(i(166));return zn(s),null}if(x=J.current,Yi(s))eb(s);else{var $=wu(Z.current);switch(x){case 1:x=$.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:x=$.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":x=$.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":x=$.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":x=$.createElement("div"),x.innerHTML="<script><\/script>",x=x.removeChild(x.firstChild);break;case"select":x=typeof d.is=="string"?$.createElement("select",{is:d.is}):$.createElement("select"),d.multiple?x.multiple=!0:d.size&&(x.size=d.size);break;default:x=typeof d.is=="string"?$.createElement(b,{is:d.is}):$.createElement(b)}}x[Ke]=s,x[ot]=d;e:for($=s.child;$!==null;){if($.tag===5||$.tag===6)x.appendChild($.stateNode);else if($.tag!==4&&$.tag!==27&&$.child!==null){$.child.return=$,$=$.child;continue}if($===s)break e;for(;$.sibling===null;){if($.return===null||$.return===s)break e;$=$.return}$.sibling.return=$.return,$=$.sibling}s.stateNode=x;e:switch(fa(x,b,d),b){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&Ps(s)}}return zn(s),Lm(s,s.type,n===null?null:n.memoizedProps,s.pendingProps,o),null;case 6:if(n&&s.stateNode!=null)n.memoizedProps!==d&&Ps(s);else{if(typeof d!="string"&&s.stateNode===null)throw Error(i(166));if(n=Z.current,Yi(s)){if(n=s.stateNode,o=s.memoizedProps,d=null,b=ca,b!==null)switch(b.tag){case 27:case 5:d=b.memoizedProps}n[Ke]=s,n=!!(n.nodeValue===o||d!==null&&d.suppressHydrationWarning===!0||gx(n.nodeValue,o)),n||mr(s,!0)}else n=wu(n).createTextNode(d),n[Ke]=s,s.stateNode=n}return zn(s),null;case 31:if(o=s.memoizedState,n===null||n.memoizedState!==null){if(d=Yi(s),o!==null){if(n===null){if(!d)throw Error(i(318));if(n=s.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(557));n[Ke]=s}else li(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;zn(s),n=!1}else o=Vf(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=o),n=!0;if(!n)return s.flags&256?($a(s),s):($a(s),null);if((s.flags&128)!==0)throw Error(i(558))}return zn(s),null;case 13:if(d=s.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(b=Yi(s),d!==null&&d.dehydrated!==null){if(n===null){if(!b)throw Error(i(318));if(b=s.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(i(317));b[Ke]=s}else li(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;zn(s),b=!1}else b=Vf(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=b),b=!0;if(!b)return s.flags&256?($a(s),s):($a(s),null)}return $a(s),(s.flags&128)!==0?(s.lanes=o,s):(o=d!==null,n=n!==null&&n.memoizedState!==null,o&&(d=s.child,b=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(b=d.alternate.memoizedState.cachePool.pool),x=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(x=d.memoizedState.cachePool.pool),x!==b&&(d.flags|=2048)),o!==n&&o&&(s.child.flags|=8192),lu(s,s.updateQueue),zn(s),null);case 4:return oe(),n===null&&ah(s.stateNode.containerInfo),zn(s),null;case 10:return Us(s.type),zn(s),null;case 19:if(q(Xn),d=s.memoizedState,d===null)return zn(s),null;if(b=(s.flags&128)!==0,x=d.rendering,x===null)if(b)co(d,!1);else{if(Vn!==0||n!==null&&(n.flags&128)!==0)for(n=s.child;n!==null;){if(x=Xc(n),x!==null){for(s.flags|=128,co(d,!1),n=x.updateQueue,s.updateQueue=n,lu(s,n),s.subtreeFlags=0,n=o,o=s.child;o!==null;)Kg(o,n),o=o.sibling;return G(Xn,Xn.current&1|2),bn&&$s(s,d.treeForkCount),s.child}n=n.sibling}d.tail!==null&&Ze()>fu&&(s.flags|=128,b=!0,co(d,!1),s.lanes=4194304)}else{if(!b)if(n=Xc(x),n!==null){if(s.flags|=128,b=!0,n=n.updateQueue,s.updateQueue=n,lu(s,n),co(d,!0),d.tail===null&&d.tailMode==="hidden"&&!x.alternate&&!bn)return zn(s),null}else 2*Ze()-d.renderingStartTime>fu&&o!==536870912&&(s.flags|=128,b=!0,co(d,!1),s.lanes=4194304);d.isBackwards?(x.sibling=s.child,s.child=x):(n=d.last,n!==null?n.sibling=x:s.child=x,d.last=x)}return d.tail!==null?(n=d.tail,d.rendering=n,d.tail=n.sibling,d.renderingStartTime=Ze(),n.sibling=null,o=Xn.current,G(Xn,b?o&1|2:o&1),bn&&$s(s,d.treeForkCount),n):(zn(s),null);case 22:case 23:return $a(s),sm(),d=s.memoizedState!==null,n!==null?n.memoizedState!==null!==d&&(s.flags|=8192):d&&(s.flags|=8192),d?(o&536870912)!==0&&(s.flags&128)===0&&(zn(s),s.subtreeFlags&6&&(s.flags|=8192)):zn(s),o=s.updateQueue,o!==null&&lu(s,o.retryQueue),o=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),d=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(d=s.memoizedState.cachePool.pool),d!==o&&(s.flags|=2048),n!==null&&q(ui),null;case 24:return o=null,n!==null&&(o=n.memoizedState.cache),s.memoizedState.cache!==o&&(s.flags|=2048),Us(Zn),zn(s),null;case 25:return null;case 30:return null}throw Error(i(156,s.tag))}function w_(n,s){switch(Hf(s),s.tag){case 1:return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 3:return Us(Zn),oe(),n=s.flags,(n&65536)!==0&&(n&128)===0?(s.flags=n&-65537|128,s):null;case 26:case 27:case 5:return we(s),null;case 31:if(s.memoizedState!==null){if($a(s),s.alternate===null)throw Error(i(340));li()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 13:if($a(s),n=s.memoizedState,n!==null&&n.dehydrated!==null){if(s.alternate===null)throw Error(i(340));li()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 19:return q(Xn),null;case 4:return oe(),null;case 10:return Us(s.type),null;case 22:case 23:return $a(s),sm(),n!==null&&q(ui),n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 24:return Us(Zn),null;case 25:return null;default:return null}}function wv(n,s){switch(Hf(s),s.tag){case 3:Us(Zn),oe();break;case 26:case 27:case 5:we(s);break;case 4:oe();break;case 31:s.memoizedState!==null&&$a(s);break;case 13:$a(s);break;case 19:q(Xn);break;case 10:Us(s.type);break;case 22:case 23:$a(s),sm(),n!==null&&q(ui);break;case 24:Us(Zn)}}function uo(n,s){try{var o=s.updateQueue,d=o!==null?o.lastEffect:null;if(d!==null){var b=d.next;o=b;do{if((o.tag&n)===n){d=void 0;var x=o.create,$=o.inst;d=x(),$.destroy=d}o=o.next}while(o!==b)}}catch(K){Tn(s,s.return,K)}}function xr(n,s,o){try{var d=s.updateQueue,b=d!==null?d.lastEffect:null;if(b!==null){var x=b.next;d=x;do{if((d.tag&n)===n){var $=d.inst,K=$.destroy;if(K!==void 0){$.destroy=void 0,b=s;var pe=o,Oe=K;try{Oe()}catch(Je){Tn(b,pe,Je)}}}d=d.next}while(d!==x)}}catch(Je){Tn(s,s.return,Je)}}function Nv(n){var s=n.updateQueue;if(s!==null){var o=n.stateNode;try{mb(s,o)}catch(d){Tn(n,n.return,d)}}}function Ev(n,s,o){o.props=pi(n.type,n.memoizedProps),o.state=n.memoizedState;try{o.componentWillUnmount()}catch(d){Tn(n,s,d)}}function fo(n,s){try{var o=n.ref;if(o!==null){switch(n.tag){case 26:case 27:case 5:var d=n.stateNode;break;case 30:d=n.stateNode;break;default:d=n.stateNode}typeof o=="function"?n.refCleanup=o(d):o.current=d}}catch(b){Tn(n,s,b)}}function js(n,s){var o=n.ref,d=n.refCleanup;if(o!==null)if(typeof d=="function")try{d()}catch(b){Tn(n,s,b)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(b){Tn(n,s,b)}else o.current=null}function jv(n){var s=n.type,o=n.memoizedProps,d=n.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":o.autoFocus&&d.focus();break e;case"img":o.src?d.src=o.src:o.srcSet&&(d.srcset=o.srcSet)}}catch(b){Tn(n,n.return,b)}}function Om(n,s,o){try{var d=n.stateNode;P_(d,n.type,o,s),d[ot]=s}catch(b){Tn(n,n.return,b)}}function _v(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&Cr(n.type)||n.tag===4}function zm(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||_v(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&Cr(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function $m(n,s,o){var d=n.tag;if(d===5||d===6)n=n.stateNode,s?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(n,s):(s=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,s.appendChild(n),o=o._reactRootContainer,o!=null||s.onclick!==null||(s.onclick=la));else if(d!==4&&(d===27&&Cr(n.type)&&(o=n.stateNode,s=null),n=n.child,n!==null))for($m(n,s,o),n=n.sibling;n!==null;)$m(n,s,o),n=n.sibling}function ou(n,s,o){var d=n.tag;if(d===5||d===6)n=n.stateNode,s?o.insertBefore(n,s):o.appendChild(n);else if(d!==4&&(d===27&&Cr(n.type)&&(o=n.stateNode),n=n.child,n!==null))for(ou(n,s,o),n=n.sibling;n!==null;)ou(n,s,o),n=n.sibling}function Cv(n){var s=n.stateNode,o=n.memoizedProps;try{for(var d=n.type,b=s.attributes;b.length;)s.removeAttributeNode(b[0]);fa(s,d,o),s[Ke]=n,s[ot]=o}catch(x){Tn(n,n.return,x)}}var Vs=!1,ea=!1,Fm=!1,Av=typeof WeakSet=="function"?WeakSet:Set,sa=null;function N_(n,s){if(n=n.containerInfo,ih=Tu,n=Ug(n),kf(n)){if("selectionStart"in n)var o={start:n.selectionStart,end:n.selectionEnd};else e:{o=(o=n.ownerDocument)&&o.defaultView||window;var d=o.getSelection&&o.getSelection();if(d&&d.rangeCount!==0){o=d.anchorNode;var b=d.anchorOffset,x=d.focusNode;d=d.focusOffset;try{o.nodeType,x.nodeType}catch{o=null;break e}var $=0,K=-1,pe=-1,Oe=0,Je=0,lt=n,Ue=null;t:for(;;){for(var Ye;lt!==o||b!==0&&lt.nodeType!==3||(K=$+b),lt!==x||d!==0&&lt.nodeType!==3||(pe=$+d),lt.nodeType===3&&($+=lt.nodeValue.length),(Ye=lt.firstChild)!==null;)Ue=lt,lt=Ye;for(;;){if(lt===n)break t;if(Ue===o&&++Oe===b&&(K=$),Ue===x&&++Je===d&&(pe=$),(Ye=lt.nextSibling)!==null)break;lt=Ue,Ue=lt.parentNode}lt=Ye}o=K===-1||pe===-1?null:{start:K,end:pe}}else o=null}o=o||{start:0,end:0}}else o=null;for(lh={focusedElem:n,selectionRange:o},Tu=!1,sa=s;sa!==null;)if(s=sa,n=s.child,(s.subtreeFlags&1028)!==0&&n!==null)n.return=s,sa=n;else for(;sa!==null;){switch(s=sa,x=s.alternate,n=s.flags,s.tag){case 0:if((n&4)!==0&&(n=s.updateQueue,n=n!==null?n.events:null,n!==null))for(o=0;o<n.length;o++)b=n[o],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((n&1024)!==0&&x!==null){n=void 0,o=s,b=x.memoizedProps,x=x.memoizedState,d=o.stateNode;try{var Ot=pi(o.type,b);n=d.getSnapshotBeforeUpdate(Ot,x),d.__reactInternalSnapshotBeforeUpdate=n}catch(Xt){Tn(o,o.return,Xt)}}break;case 3:if((n&1024)!==0){if(n=s.stateNode.containerInfo,o=n.nodeType,o===9)uh(n);else if(o===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":uh(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(i(163))}if(n=s.sibling,n!==null){n.return=s.return,sa=n;break}sa=s.return}}function Tv(n,s,o){var d=o.flags;switch(o.tag){case 0:case 11:case 15:Gs(n,o),d&4&&uo(5,o);break;case 1:if(Gs(n,o),d&4)if(n=o.stateNode,s===null)try{n.componentDidMount()}catch($){Tn(o,o.return,$)}else{var b=pi(o.type,s.memoizedProps);s=s.memoizedState;try{n.componentDidUpdate(b,s,n.__reactInternalSnapshotBeforeUpdate)}catch($){Tn(o,o.return,$)}}d&64&&Nv(o),d&512&&fo(o,o.return);break;case 3:if(Gs(n,o),d&64&&(n=o.updateQueue,n!==null)){if(s=null,o.child!==null)switch(o.child.tag){case 27:case 5:s=o.child.stateNode;break;case 1:s=o.child.stateNode}try{mb(n,s)}catch($){Tn(o,o.return,$)}}break;case 27:s===null&&d&4&&Cv(o);case 26:case 5:Gs(n,o),s===null&&d&4&&jv(o),d&512&&fo(o,o.return);break;case 12:Gs(n,o);break;case 31:Gs(n,o),d&4&&kv(n,o);break;case 13:Gs(n,o),d&4&&Dv(n,o),d&64&&(n=o.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(o=k_.bind(null,o),Q_(n,o))));break;case 22:if(d=o.memoizedState!==null||Vs,!d){s=s!==null&&s.memoizedState!==null||ea,b=Vs;var x=ea;Vs=d,(ea=s)&&!x?Xs(n,o,(o.subtreeFlags&8772)!==0):Gs(n,o),Vs=b,ea=x}break;case 30:break;default:Gs(n,o)}}function Mv(n){var s=n.alternate;s!==null&&(n.alternate=null,Mv(s)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(s=n.stateNode,s!==null&&Xe(s)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var Fn=null,Na=!1;function Ys(n,s,o){for(o=o.child;o!==null;)Rv(n,s,o),o=o.sibling}function Rv(n,s,o){if(st&&typeof st.onCommitFiberUnmount=="function")try{st.onCommitFiberUnmount(at,o)}catch{}switch(o.tag){case 26:ea||js(o,s),Ys(n,s,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:ea||js(o,s);var d=Fn,b=Na;Cr(o.type)&&(Fn=o.stateNode,Na=!1),Ys(n,s,o),So(o.stateNode),Fn=d,Na=b;break;case 5:ea||js(o,s);case 6:if(d=Fn,b=Na,Fn=null,Ys(n,s,o),Fn=d,Na=b,Fn!==null)if(Na)try{(Fn.nodeType===9?Fn.body:Fn.nodeName==="HTML"?Fn.ownerDocument.body:Fn).removeChild(o.stateNode)}catch(x){Tn(o,s,x)}else try{Fn.removeChild(o.stateNode)}catch(x){Tn(o,s,x)}break;case 18:Fn!==null&&(Na?(n=Fn,Nx(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,o.stateNode),ml(n)):Nx(Fn,o.stateNode));break;case 4:d=Fn,b=Na,Fn=o.stateNode.containerInfo,Na=!0,Ys(n,s,o),Fn=d,Na=b;break;case 0:case 11:case 14:case 15:xr(2,o,s),ea||xr(4,o,s),Ys(n,s,o);break;case 1:ea||(js(o,s),d=o.stateNode,typeof d.componentWillUnmount=="function"&&Ev(o,s,d)),Ys(n,s,o);break;case 21:Ys(n,s,o);break;case 22:ea=(d=ea)||o.memoizedState!==null,Ys(n,s,o),ea=d;break;default:Ys(n,s,o)}}function kv(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null))){n=n.dehydrated;try{ml(n)}catch(o){Tn(s,s.return,o)}}}function Dv(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{ml(n)}catch(o){Tn(s,s.return,o)}}function E_(n){switch(n.tag){case 31:case 13:case 19:var s=n.stateNode;return s===null&&(s=n.stateNode=new Av),s;case 22:return n=n.stateNode,s=n._retryCache,s===null&&(s=n._retryCache=new Av),s;default:throw Error(i(435,n.tag))}}function cu(n,s){var o=E_(n);s.forEach(function(d){if(!o.has(d)){o.add(d);var b=D_.bind(null,n,d);d.then(b,b)}})}function Ea(n,s){var o=s.deletions;if(o!==null)for(var d=0;d<o.length;d++){var b=o[d],x=n,$=s,K=$;e:for(;K!==null;){switch(K.tag){case 27:if(Cr(K.type)){Fn=K.stateNode,Na=!1;break e}break;case 5:Fn=K.stateNode,Na=!1;break e;case 3:case 4:Fn=K.stateNode.containerInfo,Na=!0;break e}K=K.return}if(Fn===null)throw Error(i(160));Rv(x,$,b),Fn=null,Na=!1,x=b.alternate,x!==null&&(x.return=null),b.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Iv(s,n),s=s.sibling}var us=null;function Iv(n,s){var o=n.alternate,d=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:Ea(s,n),ja(n),d&4&&(xr(3,n,n.return),uo(3,n),xr(5,n,n.return));break;case 1:Ea(s,n),ja(n),d&512&&(ea||o===null||js(o,o.return)),d&64&&Vs&&(n=n.updateQueue,n!==null&&(d=n.callbacks,d!==null&&(o=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=o===null?d:o.concat(d))));break;case 26:var b=us;if(Ea(s,n),ja(n),d&512&&(ea||o===null||js(o,o.return)),d&4){var x=o!==null?o.memoizedState:null;if(d=n.memoizedState,o===null)if(d===null)if(n.stateNode===null){e:{d=n.type,o=n.memoizedProps,b=b.ownerDocument||b;t:switch(d){case"title":x=b.getElementsByTagName("title")[0],(!x||x[ae]||x[Ke]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=b.createElement(d),b.head.insertBefore(x,b.querySelector("head > title"))),fa(x,d,o),x[Ke]=n,_e(x),d=x;break e;case"link":var $=Ix("link","href",b).get(d+(o.href||""));if($){for(var K=0;K<$.length;K++)if(x=$[K],x.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&x.getAttribute("rel")===(o.rel==null?null:o.rel)&&x.getAttribute("title")===(o.title==null?null:o.title)&&x.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){$.splice(K,1);break t}}x=b.createElement(d),fa(x,d,o),b.head.appendChild(x);break;case"meta":if($=Ix("meta","content",b).get(d+(o.content||""))){for(K=0;K<$.length;K++)if(x=$[K],x.getAttribute("content")===(o.content==null?null:""+o.content)&&x.getAttribute("name")===(o.name==null?null:o.name)&&x.getAttribute("property")===(o.property==null?null:o.property)&&x.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&x.getAttribute("charset")===(o.charSet==null?null:o.charSet)){$.splice(K,1);break t}}x=b.createElement(d),fa(x,d,o),b.head.appendChild(x);break;default:throw Error(i(468,d))}x[Ke]=n,_e(x),d=x}n.stateNode=d}else Lx(b,n.type,n.stateNode);else n.stateNode=Dx(b,d,n.memoizedProps);else x!==d?(x===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):x.count--,d===null?Lx(b,n.type,n.stateNode):Dx(b,d,n.memoizedProps)):d===null&&n.stateNode!==null&&Om(n,n.memoizedProps,o.memoizedProps)}break;case 27:Ea(s,n),ja(n),d&512&&(ea||o===null||js(o,o.return)),o!==null&&d&4&&Om(n,n.memoizedProps,o.memoizedProps);break;case 5:if(Ea(s,n),ja(n),d&512&&(ea||o===null||js(o,o.return)),n.flags&32){b=n.stateNode;try{Ce(b,"")}catch(Ot){Tn(n,n.return,Ot)}}d&4&&n.stateNode!=null&&(b=n.memoizedProps,Om(n,b,o!==null?o.memoizedProps:b)),d&1024&&(Fm=!0);break;case 6:if(Ea(s,n),ja(n),d&4){if(n.stateNode===null)throw Error(i(162));d=n.memoizedProps,o=n.stateNode;try{o.nodeValue=d}catch(Ot){Tn(n,n.return,Ot)}}break;case 3:if(ju=null,b=us,us=Nu(s.containerInfo),Ea(s,n),us=b,ja(n),d&4&&o!==null&&o.memoizedState.isDehydrated)try{ml(s.containerInfo)}catch(Ot){Tn(n,n.return,Ot)}Fm&&(Fm=!1,Lv(n));break;case 4:d=us,us=Nu(n.stateNode.containerInfo),Ea(s,n),ja(n),us=d;break;case 12:Ea(s,n),ja(n);break;case 31:Ea(s,n),ja(n),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,cu(n,d)));break;case 13:Ea(s,n),ja(n),n.child.flags&8192&&n.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(du=Ze()),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,cu(n,d)));break;case 22:b=n.memoizedState!==null;var pe=o!==null&&o.memoizedState!==null,Oe=Vs,Je=ea;if(Vs=Oe||b,ea=Je||pe,Ea(s,n),ea=Je,Vs=Oe,ja(n),d&8192)e:for(s=n.stateNode,s._visibility=b?s._visibility&-2:s._visibility|1,b&&(o===null||pe||Vs||ea||yi(n)),o=null,s=n;;){if(s.tag===5||s.tag===26){if(o===null){pe=o=s;try{if(x=pe.stateNode,b)$=x.style,typeof $.setProperty=="function"?$.setProperty("display","none","important"):$.display="none";else{K=pe.stateNode;var lt=pe.memoizedProps.style,Ue=lt!=null&&lt.hasOwnProperty("display")?lt.display:null;K.style.display=Ue==null||typeof Ue=="boolean"?"":(""+Ue).trim()}}catch(Ot){Tn(pe,pe.return,Ot)}}}else if(s.tag===6){if(o===null){pe=s;try{pe.stateNode.nodeValue=b?"":pe.memoizedProps}catch(Ot){Tn(pe,pe.return,Ot)}}}else if(s.tag===18){if(o===null){pe=s;try{var Ye=pe.stateNode;b?Ex(Ye,!0):Ex(pe.stateNode,!1)}catch(Ot){Tn(pe,pe.return,Ot)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===n)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break e;for(;s.sibling===null;){if(s.return===null||s.return===n)break e;o===s&&(o=null),s=s.return}o===s&&(o=null),s.sibling.return=s.return,s=s.sibling}d&4&&(d=n.updateQueue,d!==null&&(o=d.retryQueue,o!==null&&(d.retryQueue=null,cu(n,o))));break;case 19:Ea(s,n),ja(n),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,cu(n,d)));break;case 30:break;case 21:break;default:Ea(s,n),ja(n)}}function ja(n){var s=n.flags;if(s&2){try{for(var o,d=n.return;d!==null;){if(_v(d)){o=d;break}d=d.return}if(o==null)throw Error(i(160));switch(o.tag){case 27:var b=o.stateNode,x=zm(n);ou(n,x,b);break;case 5:var $=o.stateNode;o.flags&32&&(Ce($,""),o.flags&=-33);var K=zm(n);ou(n,K,$);break;case 3:case 4:var pe=o.stateNode.containerInfo,Oe=zm(n);$m(n,Oe,pe);break;default:throw Error(i(161))}}catch(Je){Tn(n,n.return,Je)}n.flags&=-3}s&4096&&(n.flags&=-4097)}function Lv(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var s=n;Lv(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),n=n.sibling}}function Gs(n,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)Tv(n,s.alternate,s),s=s.sibling}function yi(n){for(n=n.child;n!==null;){var s=n;switch(s.tag){case 0:case 11:case 14:case 15:xr(4,s,s.return),yi(s);break;case 1:js(s,s.return);var o=s.stateNode;typeof o.componentWillUnmount=="function"&&Ev(s,s.return,o),yi(s);break;case 27:So(s.stateNode);case 26:case 5:js(s,s.return),yi(s);break;case 22:s.memoizedState===null&&yi(s);break;case 30:yi(s);break;default:yi(s)}n=n.sibling}}function Xs(n,s,o){for(o=o&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var d=s.alternate,b=n,x=s,$=x.flags;switch(x.tag){case 0:case 11:case 15:Xs(b,x,o),uo(4,x);break;case 1:if(Xs(b,x,o),d=x,b=d.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Oe){Tn(d,d.return,Oe)}if(d=x,b=d.updateQueue,b!==null){var K=d.stateNode;try{var pe=b.shared.hiddenCallbacks;if(pe!==null)for(b.shared.hiddenCallbacks=null,b=0;b<pe.length;b++)fb(pe[b],K)}catch(Oe){Tn(d,d.return,Oe)}}o&&$&64&&Nv(x),fo(x,x.return);break;case 27:Cv(x);case 26:case 5:Xs(b,x,o),o&&d===null&&$&4&&jv(x),fo(x,x.return);break;case 12:Xs(b,x,o);break;case 31:Xs(b,x,o),o&&$&4&&kv(b,x);break;case 13:Xs(b,x,o),o&&$&4&&Dv(b,x);break;case 22:x.memoizedState===null&&Xs(b,x,o),fo(x,x.return);break;case 30:break;default:Xs(b,x,o)}s=s.sibling}}function Um(n,s){var o=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),n=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(n=s.memoizedState.cachePool.pool),n!==o&&(n!=null&&n.refCount++,o!=null&&Zl(o))}function Bm(n,s){n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&Zl(n))}function ds(n,s,o,d){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Ov(n,s,o,d),s=s.sibling}function Ov(n,s,o,d){var b=s.flags;switch(s.tag){case 0:case 11:case 15:ds(n,s,o,d),b&2048&&uo(9,s);break;case 1:ds(n,s,o,d);break;case 3:ds(n,s,o,d),b&2048&&(n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&Zl(n)));break;case 12:if(b&2048){ds(n,s,o,d),n=s.stateNode;try{var x=s.memoizedProps,$=x.id,K=x.onPostCommit;typeof K=="function"&&K($,s.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(pe){Tn(s,s.return,pe)}}else ds(n,s,o,d);break;case 31:ds(n,s,o,d);break;case 13:ds(n,s,o,d);break;case 23:break;case 22:x=s.stateNode,$=s.alternate,s.memoizedState!==null?x._visibility&2?ds(n,s,o,d):mo(n,s):x._visibility&2?ds(n,s,o,d):(x._visibility|=2,nl(n,s,o,d,(s.subtreeFlags&10256)!==0||!1)),b&2048&&Um($,s);break;case 24:ds(n,s,o,d),b&2048&&Bm(s.alternate,s);break;default:ds(n,s,o,d)}}function nl(n,s,o,d,b){for(b=b&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var x=n,$=s,K=o,pe=d,Oe=$.flags;switch($.tag){case 0:case 11:case 15:nl(x,$,K,pe,b),uo(8,$);break;case 23:break;case 22:var Je=$.stateNode;$.memoizedState!==null?Je._visibility&2?nl(x,$,K,pe,b):mo(x,$):(Je._visibility|=2,nl(x,$,K,pe,b)),b&&Oe&2048&&Um($.alternate,$);break;case 24:nl(x,$,K,pe,b),b&&Oe&2048&&Bm($.alternate,$);break;default:nl(x,$,K,pe,b)}s=s.sibling}}function mo(n,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var o=n,d=s,b=d.flags;switch(d.tag){case 22:mo(o,d),b&2048&&Um(d.alternate,d);break;case 24:mo(o,d),b&2048&&Bm(d.alternate,d);break;default:mo(o,d)}s=s.sibling}}var ho=8192;function al(n,s,o){if(n.subtreeFlags&ho)for(n=n.child;n!==null;)zv(n,s,o),n=n.sibling}function zv(n,s,o){switch(n.tag){case 26:al(n,s,o),n.flags&ho&&n.memoizedState!==null&&uC(o,us,n.memoizedState,n.memoizedProps);break;case 5:al(n,s,o);break;case 3:case 4:var d=us;us=Nu(n.stateNode.containerInfo),al(n,s,o),us=d;break;case 22:n.memoizedState===null&&(d=n.alternate,d!==null&&d.memoizedState!==null?(d=ho,ho=16777216,al(n,s,o),ho=d):al(n,s,o));break;default:al(n,s,o)}}function $v(n){var s=n.alternate;if(s!==null&&(n=s.child,n!==null)){s.child=null;do s=n.sibling,n.sibling=null,n=s;while(n!==null)}}function po(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var d=s[o];sa=d,Uv(d,n)}$v(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Fv(n),n=n.sibling}function Fv(n){switch(n.tag){case 0:case 11:case 15:po(n),n.flags&2048&&xr(9,n,n.return);break;case 3:po(n);break;case 12:po(n);break;case 22:var s=n.stateNode;n.memoizedState!==null&&s._visibility&2&&(n.return===null||n.return.tag!==13)?(s._visibility&=-3,uu(n)):po(n);break;default:po(n)}}function uu(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var d=s[o];sa=d,Uv(d,n)}$v(n)}for(n=n.child;n!==null;){switch(s=n,s.tag){case 0:case 11:case 15:xr(8,s,s.return),uu(s);break;case 22:o=s.stateNode,o._visibility&2&&(o._visibility&=-3,uu(s));break;default:uu(s)}n=n.sibling}}function Uv(n,s){for(;sa!==null;){var o=sa;switch(o.tag){case 0:case 11:case 15:xr(8,o,s);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var d=o.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Zl(o.memoizedState.cache)}if(d=o.child,d!==null)d.return=o,sa=d;else e:for(o=n;sa!==null;){d=sa;var b=d.sibling,x=d.return;if(Mv(d),d===o){sa=null;break e}if(b!==null){b.return=x,sa=b;break e}sa=x}}}var j_={getCacheForType:function(n){var s=ua(Zn),o=s.data.get(n);return o===void 0&&(o=n(),s.data.set(n,o)),o},cacheSignal:function(){return ua(Zn).controller.signal}},__=typeof WeakMap=="function"?WeakMap:Map,_n=0,In=null,mn=null,yn=0,An=0,Fa=null,Sr=!1,sl=!1,qm=!1,Ks=0,Vn=0,wr=0,gi=0,Hm=0,Ua=0,rl=0,yo=null,_a=null,Pm=!1,du=0,Bv=0,fu=1/0,mu=null,Nr=null,ta=0,Er=null,il=null,Ws=0,Vm=0,Ym=null,qv=null,go=0,Gm=null;function Ba(){return(_n&2)!==0&&yn!==0?yn&-yn:D.T!==null?Jm():re()}function Hv(){if(Ua===0)if((yn&536870912)===0||bn){var n=ct;ct<<=1,(ct&3932160)===0&&(ct=262144),Ua=n}else Ua=536870912;return n=za.current,n!==null&&(n.flags|=32),Ua}function Ca(n,s,o){(n===In&&(An===2||An===9)||n.cancelPendingCommit!==null)&&(ll(n,0),jr(n,yn,Ua,!1)),se(n,o),((_n&2)===0||n!==In)&&(n===In&&((_n&2)===0&&(gi|=o),Vn===4&&jr(n,yn,Ua,!1)),_s(n))}function Pv(n,s,o){if((_n&6)!==0)throw Error(i(327));var d=!o&&(s&127)===0&&(s&n.expiredLanes)===0||kt(n,s),b=d?T_(n,s):Km(n,s,!0),x=d;do{if(b===0){sl&&!d&&jr(n,s,0,!1);break}else{if(o=n.current.alternate,x&&!C_(o)){b=Km(n,s,!1),x=!1;continue}if(b===2){if(x=s,n.errorRecoveryDisabledLanes&x)var $=0;else $=n.pendingLanes&-536870913,$=$!==0?$:$&536870912?536870912:0;if($!==0){s=$;e:{var K=n;b=yo;var pe=K.current.memoizedState.isDehydrated;if(pe&&(ll(K,$).flags|=256),$=Km(K,$,!1),$!==2){if(qm&&!pe){K.errorRecoveryDisabledLanes|=x,gi|=x,b=4;break e}x=_a,_a=b,x!==null&&(_a===null?_a=x:_a.push.apply(_a,x))}b=$}if(x=!1,b!==2)continue}}if(b===1){ll(n,0),jr(n,s,0,!0);break}e:{switch(d=n,x=b,x){case 0:case 1:throw Error(i(345));case 4:if((s&4194048)!==s)break;case 6:jr(d,s,Ua,!Sr);break e;case 2:_a=null;break;case 3:case 5:break;default:throw Error(i(329))}if((s&62914560)===s&&(b=du+300-Ze(),10<b)){if(jr(d,s,Ua,!Sr),Ft(d,0,!0)!==0)break e;Ws=s,d.timeoutHandle=Sx(Vv.bind(null,d,o,_a,mu,Pm,s,Ua,gi,rl,Sr,x,"Throttled",-0,0),b);break e}Vv(d,o,_a,mu,Pm,s,Ua,gi,rl,Sr,x,null,-0,0)}}break}while(!0);_s(n)}function Vv(n,s,o,d,b,x,$,K,pe,Oe,Je,lt,Ue,Ye){if(n.timeoutHandle=-1,lt=s.subtreeFlags,lt&8192||(lt&16785408)===16785408){lt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:la},zv(s,x,lt);var Ot=(x&62914560)===x?du-Ze():(x&4194048)===x?Bv-Ze():0;if(Ot=dC(lt,Ot),Ot!==null){Ws=x,n.cancelPendingCommit=Ot(Jv.bind(null,n,s,x,o,d,b,$,K,pe,Je,lt,null,Ue,Ye)),jr(n,x,$,!Oe);return}}Jv(n,s,x,o,d,b,$,K,pe)}function C_(n){for(var s=n;;){var o=s.tag;if((o===0||o===11||o===15)&&s.flags&16384&&(o=s.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var d=0;d<o.length;d++){var b=o[d],x=b.getSnapshot;b=b.value;try{if(!La(x(),b))return!1}catch{return!1}}if(o=s.child,s.subtreeFlags&16384&&o!==null)o.return=s,s=o;else{if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function jr(n,s,o,d){s&=~Hm,s&=~gi,n.suspendedLanes|=s,n.pingedLanes&=~s,d&&(n.warmLanes|=s),d=n.expirationTimes;for(var b=s;0<b;){var x=31-$e(b),$=1<<x;d[x]=-1,b&=~$}o!==0&&je(n,o,s)}function hu(){return(_n&6)===0?(bo(0),!1):!0}function Xm(){if(mn!==null){if(An===0)var n=mn.return;else n=mn,Fs=oi=null,um(n),Zi=null,Jl=0,n=mn;for(;n!==null;)wv(n.alternate,n),n=n.return;mn=null}}function ll(n,s){var o=n.timeoutHandle;o!==-1&&(n.timeoutHandle=-1,G_(o)),o=n.cancelPendingCommit,o!==null&&(n.cancelPendingCommit=null,o()),Ws=0,Xm(),In=n,mn=o=zs(n.current,null),yn=s,An=0,Fa=null,Sr=!1,sl=kt(n,s),qm=!1,rl=Ua=Hm=gi=wr=Vn=0,_a=yo=null,Pm=!1,(s&8)!==0&&(s|=s&32);var d=n.entangledLanes;if(d!==0)for(n=n.entanglements,d&=s;0<d;){var b=31-$e(d),x=1<<b;s|=n[b],d&=~x}return Ks=s,Lc(),o}function Yv(n,s){tn=null,D.H=lo,s===Wi||s===Hc?(s=ob(),An=3):s===Qf?(s=ob(),An=4):An=s===_m?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Fa=s,mn===null&&(Vn=1,au(n,Wa(s,n.current)))}function Gv(){var n=za.current;return n===null?!0:(yn&4194048)===yn?es===null:(yn&62914560)===yn||(yn&536870912)!==0?n===es:!1}function Xv(){var n=D.H;return D.H=lo,n===null?lo:n}function Kv(){var n=D.A;return D.A=j_,n}function pu(){Vn=4,Sr||(yn&4194048)!==yn&&za.current!==null||(sl=!0),(wr&134217727)===0&&(gi&134217727)===0||In===null||jr(In,yn,Ua,!1)}function Km(n,s,o){var d=_n;_n|=2;var b=Xv(),x=Kv();(In!==n||yn!==s)&&(mu=null,ll(n,s)),s=!1;var $=Vn;e:do try{if(An!==0&&mn!==null){var K=mn,pe=Fa;switch(An){case 8:Xm(),$=6;break e;case 3:case 2:case 9:case 6:za.current===null&&(s=!0);var Oe=An;if(An=0,Fa=null,ol(n,K,pe,Oe),o&&sl){$=0;break e}break;default:Oe=An,An=0,Fa=null,ol(n,K,pe,Oe)}}A_(),$=Vn;break}catch(Je){Yv(n,Je)}while(!0);return s&&n.shellSuspendCounter++,Fs=oi=null,_n=d,D.H=b,D.A=x,mn===null&&(In=null,yn=0,Lc()),$}function A_(){for(;mn!==null;)Wv(mn)}function T_(n,s){var o=_n;_n|=2;var d=Xv(),b=Kv();In!==n||yn!==s?(mu=null,fu=Ze()+500,ll(n,s)):sl=kt(n,s);e:do try{if(An!==0&&mn!==null){s=mn;var x=Fa;t:switch(An){case 1:An=0,Fa=null,ol(n,s,x,1);break;case 2:case 9:if(ib(x)){An=0,Fa=null,Zv(s);break}s=function(){An!==2&&An!==9||In!==n||(An=7),_s(n)},x.then(s,s);break e;case 3:An=7;break e;case 4:An=5;break e;case 7:ib(x)?(An=0,Fa=null,Zv(s)):(An=0,Fa=null,ol(n,s,x,7));break;case 5:var $=null;switch(mn.tag){case 26:$=mn.memoizedState;case 5:case 27:var K=mn;if($?Ox($):K.stateNode.complete){An=0,Fa=null;var pe=K.sibling;if(pe!==null)mn=pe;else{var Oe=K.return;Oe!==null?(mn=Oe,yu(Oe)):mn=null}break t}}An=0,Fa=null,ol(n,s,x,5);break;case 6:An=0,Fa=null,ol(n,s,x,6);break;case 8:Xm(),Vn=6;break e;default:throw Error(i(462))}}M_();break}catch(Je){Yv(n,Je)}while(!0);return Fs=oi=null,D.H=d,D.A=b,_n=o,mn!==null?0:(In=null,yn=0,Lc(),Vn)}function M_(){for(;mn!==null&&!_t();)Wv(mn)}function Wv(n){var s=xv(n.alternate,n,Ks);n.memoizedProps=n.pendingProps,s===null?yu(n):mn=s}function Zv(n){var s=n,o=s.alternate;switch(s.tag){case 15:case 0:s=hv(o,s,s.pendingProps,s.type,void 0,yn);break;case 11:s=hv(o,s,s.pendingProps,s.type.render,s.ref,yn);break;case 5:um(s);default:wv(o,s),s=mn=Kg(s,Ks),s=xv(o,s,Ks)}n.memoizedProps=n.pendingProps,s===null?yu(n):mn=s}function ol(n,s,o,d){Fs=oi=null,um(s),Zi=null,Jl=0;var b=s.return;try{if(b_(n,b,s,o,yn)){Vn=1,au(n,Wa(o,n.current)),mn=null;return}}catch(x){if(b!==null)throw mn=b,x;Vn=1,au(n,Wa(o,n.current)),mn=null;return}s.flags&32768?(bn||d===1?n=!0:sl||(yn&536870912)!==0?n=!1:(Sr=n=!0,(d===2||d===9||d===3||d===6)&&(d=za.current,d!==null&&d.tag===13&&(d.flags|=16384))),Qv(s,n)):yu(s)}function yu(n){var s=n;do{if((s.flags&32768)!==0){Qv(s,Sr);return}n=s.return;var o=S_(s.alternate,s,Ks);if(o!==null){mn=o;return}if(s=s.sibling,s!==null){mn=s;return}mn=s=n}while(s!==null);Vn===0&&(Vn=5)}function Qv(n,s){do{var o=w_(n.alternate,n);if(o!==null){o.flags&=32767,mn=o;return}if(o=n.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!s&&(n=n.sibling,n!==null)){mn=n;return}mn=n=o}while(n!==null);Vn=6,mn=null}function Jv(n,s,o,d,b,x,$,K,pe){n.cancelPendingCommit=null;do gu();while(ta!==0);if((_n&6)!==0)throw Error(i(327));if(s!==null){if(s===n.current)throw Error(i(177));if(x=s.lanes|s.childLanes,x|=zf,be(n,o,x,$,K,pe),n===In&&(mn=In=null,yn=0),il=s,Er=n,Ws=o,Vm=x,Ym=b,qv=d,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,I_(ve,function(){return sx(),null})):(n.callbackNode=null,n.callbackPriority=0),d=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||d){d=D.T,D.T=null,b=L.p,L.p=2,$=_n,_n|=4;try{N_(n,s,o)}finally{_n=$,L.p=b,D.T=d}}ta=1,ex(),tx(),nx()}}function ex(){if(ta===1){ta=0;var n=Er,s=il,o=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||o){o=D.T,D.T=null;var d=L.p;L.p=2;var b=_n;_n|=4;try{Iv(s,n);var x=lh,$=Ug(n.containerInfo),K=x.focusedElem,pe=x.selectionRange;if($!==K&&K&&K.ownerDocument&&Fg(K.ownerDocument.documentElement,K)){if(pe!==null&&kf(K)){var Oe=pe.start,Je=pe.end;if(Je===void 0&&(Je=Oe),"selectionStart"in K)K.selectionStart=Oe,K.selectionEnd=Math.min(Je,K.value.length);else{var lt=K.ownerDocument||document,Ue=lt&&lt.defaultView||window;if(Ue.getSelection){var Ye=Ue.getSelection(),Ot=K.textContent.length,Xt=Math.min(pe.start,Ot),Dn=pe.end===void 0?Xt:Math.min(pe.end,Ot);!Ye.extend&&Xt>Dn&&($=Dn,Dn=Xt,Xt=$);var Ae=$g(K,Xt),xe=$g(K,Dn);if(Ae&&xe&&(Ye.rangeCount!==1||Ye.anchorNode!==Ae.node||Ye.anchorOffset!==Ae.offset||Ye.focusNode!==xe.node||Ye.focusOffset!==xe.offset)){var Le=lt.createRange();Le.setStart(Ae.node,Ae.offset),Ye.removeAllRanges(),Xt>Dn?(Ye.addRange(Le),Ye.extend(xe.node,xe.offset)):(Le.setEnd(xe.node,xe.offset),Ye.addRange(Le))}}}}for(lt=[],Ye=K;Ye=Ye.parentNode;)Ye.nodeType===1&&lt.push({element:Ye,left:Ye.scrollLeft,top:Ye.scrollTop});for(typeof K.focus=="function"&&K.focus(),K=0;K<lt.length;K++){var it=lt[K];it.element.scrollLeft=it.left,it.element.scrollTop=it.top}}Tu=!!ih,lh=ih=null}finally{_n=b,L.p=d,D.T=o}}n.current=s,ta=2}}function tx(){if(ta===2){ta=0;var n=Er,s=il,o=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||o){o=D.T,D.T=null;var d=L.p;L.p=2;var b=_n;_n|=4;try{Tv(n,s.alternate,s)}finally{_n=b,L.p=d,D.T=o}}ta=3}}function nx(){if(ta===4||ta===3){ta=0,Pe();var n=Er,s=il,o=Ws,d=qv;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?ta=5:(ta=0,il=Er=null,ax(n,n.pendingLanes));var b=n.pendingLanes;if(b===0&&(Nr=null),ce(o),s=s.stateNode,st&&typeof st.onCommitFiberRoot=="function")try{st.onCommitFiberRoot(at,s,void 0,(s.current.flags&128)===128)}catch{}if(d!==null){s=D.T,b=L.p,L.p=2,D.T=null;try{for(var x=n.onRecoverableError,$=0;$<d.length;$++){var K=d[$];x(K.value,{componentStack:K.stack})}}finally{D.T=s,L.p=b}}(Ws&3)!==0&&gu(),_s(n),b=n.pendingLanes,(o&261930)!==0&&(b&42)!==0?n===Gm?go++:(go=0,Gm=n):go=0,bo(0)}}function ax(n,s){(n.pooledCacheLanes&=s)===0&&(s=n.pooledCache,s!=null&&(n.pooledCache=null,Zl(s)))}function gu(){return ex(),tx(),nx(),sx()}function sx(){if(ta!==5)return!1;var n=Er,s=Vm;Vm=0;var o=ce(Ws),d=D.T,b=L.p;try{L.p=32>o?32:o,D.T=null,o=Ym,Ym=null;var x=Er,$=Ws;if(ta=0,il=Er=null,Ws=0,(_n&6)!==0)throw Error(i(331));var K=_n;if(_n|=4,Fv(x.current),Ov(x,x.current,$,o),_n=K,bo(0,!1),st&&typeof st.onPostCommitFiberRoot=="function")try{st.onPostCommitFiberRoot(at,x)}catch{}return!0}finally{L.p=b,D.T=d,ax(n,s)}}function rx(n,s,o){s=Wa(o,s),s=jm(n.stateNode,s,2),n=gr(n,s,2),n!==null&&(se(n,2),_s(n))}function Tn(n,s,o){if(n.tag===3)rx(n,n,o);else for(;s!==null;){if(s.tag===3){rx(s,n,o);break}else if(s.tag===1){var d=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Nr===null||!Nr.has(d))){n=Wa(o,n),o=iv(2),d=gr(s,o,2),d!==null&&(lv(o,d,s,n),se(d,2),_s(d));break}}s=s.return}}function Wm(n,s,o){var d=n.pingCache;if(d===null){d=n.pingCache=new __;var b=new Set;d.set(s,b)}else b=d.get(s),b===void 0&&(b=new Set,d.set(s,b));b.has(o)||(qm=!0,b.add(o),n=R_.bind(null,n,s,o),s.then(n,n))}function R_(n,s,o){var d=n.pingCache;d!==null&&d.delete(s),n.pingedLanes|=n.suspendedLanes&o,n.warmLanes&=~o,In===n&&(yn&o)===o&&(Vn===4||Vn===3&&(yn&62914560)===yn&&300>Ze()-du?(_n&2)===0&&ll(n,0):Hm|=o,rl===yn&&(rl=0)),_s(n)}function ix(n,s){s===0&&(s=Lt()),n=ri(n,s),n!==null&&(se(n,s),_s(n))}function k_(n){var s=n.memoizedState,o=0;s!==null&&(o=s.retryLane),ix(n,o)}function D_(n,s){var o=0;switch(n.tag){case 31:case 13:var d=n.stateNode,b=n.memoizedState;b!==null&&(o=b.retryLane);break;case 19:d=n.stateNode;break;case 22:d=n.stateNode._retryCache;break;default:throw Error(i(314))}d!==null&&d.delete(s),ix(n,o)}function I_(n,s){return Ct(n,s)}var bu=null,cl=null,Zm=!1,vu=!1,Qm=!1,_r=0;function _s(n){n!==cl&&n.next===null&&(cl===null?bu=cl=n:cl=cl.next=n),vu=!0,Zm||(Zm=!0,O_())}function bo(n,s){if(!Qm&&vu){Qm=!0;do for(var o=!1,d=bu;d!==null;){if(n!==0){var b=d.pendingLanes;if(b===0)var x=0;else{var $=d.suspendedLanes,K=d.pingedLanes;x=(1<<31-$e(42|n)+1)-1,x&=b&~($&~K),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(o=!0,ux(d,x))}else x=yn,x=Ft(d,d===In?x:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(x&3)===0||kt(d,x)||(o=!0,ux(d,x));d=d.next}while(o);Qm=!1}}function L_(){lx()}function lx(){vu=Zm=!1;var n=0;_r!==0&&Y_()&&(n=_r);for(var s=Ze(),o=null,d=bu;d!==null;){var b=d.next,x=ox(d,s);x===0?(d.next=null,o===null?bu=b:o.next=b,b===null&&(cl=o)):(o=d,(n!==0||(x&3)!==0)&&(vu=!0)),d=b}ta!==0&&ta!==5||bo(n),_r!==0&&(_r=0)}function ox(n,s){for(var o=n.suspendedLanes,d=n.pingedLanes,b=n.expirationTimes,x=n.pendingLanes&-62914561;0<x;){var $=31-$e(x),K=1<<$,pe=b[$];pe===-1?((K&o)===0||(K&d)!==0)&&(b[$]=Zt(K,s)):pe<=s&&(n.expiredLanes|=K),x&=~K}if(s=In,o=yn,o=Ft(n,n===s?o:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),d=n.callbackNode,o===0||n===s&&(An===2||An===9)||n.cancelPendingCommit!==null)return d!==null&&d!==null&&At(d),n.callbackNode=null,n.callbackPriority=0;if((o&3)===0||kt(n,o)){if(s=o&-o,s===n.callbackPriority)return s;switch(d!==null&&At(d),ce(o)){case 2:case 8:o=te;break;case 32:o=ve;break;case 268435456:o=Se;break;default:o=ve}return d=cx.bind(null,n),o=Ct(o,d),n.callbackPriority=s,n.callbackNode=o,s}return d!==null&&d!==null&&At(d),n.callbackPriority=2,n.callbackNode=null,2}function cx(n,s){if(ta!==0&&ta!==5)return n.callbackNode=null,n.callbackPriority=0,null;var o=n.callbackNode;if(gu()&&n.callbackNode!==o)return null;var d=yn;return d=Ft(n,n===In?d:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),d===0?null:(Pv(n,d,s),ox(n,Ze()),n.callbackNode!=null&&n.callbackNode===o?cx.bind(null,n):null)}function ux(n,s){if(gu())return null;Pv(n,s,!0)}function O_(){X_(function(){(_n&6)!==0?Ct(ee,L_):lx()})}function Jm(){if(_r===0){var n=Xi;n===0&&(n=pt,pt<<=1,(pt&261888)===0&&(pt=256)),_r=n}return _r}function dx(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:Un(""+n)}function fx(n,s){var o=s.ownerDocument.createElement("input");return o.name=s.name,o.value=s.value,n.id&&o.setAttribute("form",n.id),s.parentNode.insertBefore(o,s),n=new FormData(n),o.parentNode.removeChild(o),n}function z_(n,s,o,d,b){if(s==="submit"&&o&&o.stateNode===b){var x=dx((b[ot]||null).action),$=d.submitter;$&&(s=(s=$[ot]||null)?dx(s.formAction):$.getAttribute("formAction"),s!==null&&(x=s,$=null));var K=new Rc("action","action",null,d,b);n.push({event:K,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(_r!==0){var pe=$?fx(b,$):new FormData(b);vm(o,{pending:!0,data:pe,method:b.method,action:x},null,pe)}}else typeof x=="function"&&(K.preventDefault(),pe=$?fx(b,$):new FormData(b),vm(o,{pending:!0,data:pe,method:b.method,action:x},x,pe))},currentTarget:b}]})}}for(var eh=0;eh<Of.length;eh++){var th=Of[eh],$_=th.toLowerCase(),F_=th[0].toUpperCase()+th.slice(1);cs($_,"on"+F_)}cs(Hg,"onAnimationEnd"),cs(Pg,"onAnimationIteration"),cs(Vg,"onAnimationStart"),cs("dblclick","onDoubleClick"),cs("focusin","onFocus"),cs("focusout","onBlur"),cs(t_,"onTransitionRun"),cs(n_,"onTransitionStart"),cs(a_,"onTransitionCancel"),cs(Yg,"onTransitionEnd"),he("onMouseEnter",["mouseout","mouseover"]),he("onMouseLeave",["mouseout","mouseover"]),he("onPointerEnter",["pointerout","pointerover"]),he("onPointerLeave",["pointerout","pointerover"]),fe("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),fe("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),fe("onBeforeInput",["compositionend","keypress","textInput","paste"]),fe("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),fe("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),fe("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var vo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),U_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(vo));function mx(n,s){s=(s&4)!==0;for(var o=0;o<n.length;o++){var d=n[o],b=d.event;d=d.listeners;e:{var x=void 0;if(s)for(var $=d.length-1;0<=$;$--){var K=d[$],pe=K.instance,Oe=K.currentTarget;if(K=K.listener,pe!==x&&b.isPropagationStopped())break e;x=K,b.currentTarget=Oe;try{x(b)}catch(Je){Ic(Je)}b.currentTarget=null,x=pe}else for($=0;$<d.length;$++){if(K=d[$],pe=K.instance,Oe=K.currentTarget,K=K.listener,pe!==x&&b.isPropagationStopped())break e;x=K,b.currentTarget=Oe;try{x(b)}catch(Je){Ic(Je)}b.currentTarget=null,x=pe}}}}function hn(n,s){var o=s[ue];o===void 0&&(o=s[ue]=new Set);var d=n+"__bubble";o.has(d)||(hx(s,n,2,!1),o.add(d))}function nh(n,s,o){var d=0;s&&(d|=4),hx(o,n,d,s)}var xu="_reactListening"+Math.random().toString(36).slice(2);function ah(n){if(!n[xu]){n[xu]=!0,et.forEach(function(o){o!=="selectionchange"&&(U_.has(o)||nh(o,!1,n),nh(o,!0,n))});var s=n.nodeType===9?n:n.ownerDocument;s===null||s[xu]||(s[xu]=!0,nh("selectionchange",!1,s))}}function hx(n,s,o,d){switch(Hx(s)){case 2:var b=hC;break;case 8:b=pC;break;default:b=bh}o=b.bind(null,s,o,n),b=void 0,!oa||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(b=!0),d?b!==void 0?n.addEventListener(s,o,{capture:!0,passive:b}):n.addEventListener(s,o,!0):b!==void 0?n.addEventListener(s,o,{passive:b}):n.addEventListener(s,o,!1)}function sh(n,s,o,d,b){var x=d;if((s&1)===0&&(s&2)===0&&d!==null)e:for(;;){if(d===null)return;var $=d.tag;if($===3||$===4){var K=d.stateNode.containerInfo;if(K===b)break;if($===4)for($=d.return;$!==null;){var pe=$.tag;if((pe===3||pe===4)&&$.stateNode.containerInfo===b)return;$=$.return}for(;K!==null;){if($=Fe(K),$===null)return;if(pe=$.tag,pe===5||pe===6||pe===26||pe===27){d=x=$;continue e}K=K.parentNode}}d=d.return}xn(function(){var Oe=x,Je=Me(o),lt=[];e:{var Ue=Gg.get(n);if(Ue!==void 0){var Ye=Rc,Ot=n;switch(n){case"keypress":if(zi(o)===0)break e;case"keydown":case"keyup":Ye=Dj;break;case"focusin":Ot="focus",Ye=Cf;break;case"focusout":Ot="blur",Ye=Cf;break;case"beforeblur":case"afterblur":Ye=Cf;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ye=wg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ye=Sj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ye=Oj;break;case Hg:case Pg:case Vg:Ye=Ej;break;case Yg:Ye=$j;break;case"scroll":case"scrollend":Ye=vj;break;case"wheel":Ye=Uj;break;case"copy":case"cut":case"paste":Ye=_j;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ye=Eg;break;case"toggle":case"beforetoggle":Ye=qj}var Xt=(s&4)!==0,Dn=!Xt&&(n==="scroll"||n==="scrollend"),Ae=Xt?Ue!==null?Ue+"Capture":null:Ue;Xt=[];for(var xe=Oe,Le;xe!==null;){var it=xe;if(Le=it.stateNode,it=it.tag,it!==5&&it!==26&&it!==27||Le===null||Ae===null||(it=Gt(xe,Ae),it!=null&&Xt.push(xo(xe,it,Le))),Dn)break;xe=xe.return}0<Xt.length&&(Ue=new Ye(Ue,Ot,null,o,Je),lt.push({event:Ue,listeners:Xt}))}}if((s&7)===0){e:{if(Ue=n==="mouseover"||n==="pointerover",Ye=n==="mouseout"||n==="pointerout",Ue&&o!==ye&&(Ot=o.relatedTarget||o.fromElement)&&(Fe(Ot)||Ot[ze]))break e;if((Ye||Ue)&&(Ue=Je.window===Je?Je:(Ue=Je.ownerDocument)?Ue.defaultView||Ue.parentWindow:window,Ye?(Ot=o.relatedTarget||o.toElement,Ye=Oe,Ot=Ot?Fe(Ot):null,Ot!==null&&(Dn=c(Ot),Xt=Ot.tag,Ot!==Dn||Xt!==5&&Xt!==27&&Xt!==6)&&(Ot=null)):(Ye=null,Ot=Oe),Ye!==Ot)){if(Xt=wg,it="onMouseLeave",Ae="onMouseEnter",xe="mouse",(n==="pointerout"||n==="pointerover")&&(Xt=Eg,it="onPointerLeave",Ae="onPointerEnter",xe="pointer"),Dn=Ye==null?Ue:bt(Ye),Le=Ot==null?Ue:bt(Ot),Ue=new Xt(it,xe+"leave",Ye,o,Je),Ue.target=Dn,Ue.relatedTarget=Le,it=null,Fe(Je)===Oe&&(Xt=new Xt(Ae,xe+"enter",Ot,o,Je),Xt.target=Le,Xt.relatedTarget=Dn,it=Xt),Dn=it,Ye&&Ot)t:{for(Xt=B_,Ae=Ye,xe=Ot,Le=0,it=Ae;it;it=Xt(it))Le++;it=0;for(var Ht=xe;Ht;Ht=Xt(Ht))it++;for(;0<Le-it;)Ae=Xt(Ae),Le--;for(;0<it-Le;)xe=Xt(xe),it--;for(;Le--;){if(Ae===xe||xe!==null&&Ae===xe.alternate){Xt=Ae;break t}Ae=Xt(Ae),xe=Xt(xe)}Xt=null}else Xt=null;Ye!==null&&px(lt,Ue,Ye,Xt,!1),Ot!==null&&Dn!==null&&px(lt,Dn,Ot,Xt,!0)}}e:{if(Ue=Oe?bt(Oe):window,Ye=Ue.nodeName&&Ue.nodeName.toLowerCase(),Ye==="select"||Ye==="input"&&Ue.type==="file")var Sn=kg;else if(Mg(Ue))if(Dg)Sn=Qj;else{Sn=Wj;var $t=Kj}else Ye=Ue.nodeName,!Ye||Ye.toLowerCase()!=="input"||Ue.type!=="checkbox"&&Ue.type!=="radio"?Oe&&qt(Oe.elementType)&&(Sn=kg):Sn=Zj;if(Sn&&(Sn=Sn(n,Oe))){Rg(lt,Sn,o,Je);break e}$t&&$t(n,Ue,Oe),n==="focusout"&&Oe&&Ue.type==="number"&&Oe.memoizedProps.value!=null&&qn(Ue,"number",Ue.value)}switch($t=Oe?bt(Oe):window,n){case"focusin":(Mg($t)||$t.contentEditable==="true")&&(Ui=$t,Df=Oe,Xl=null);break;case"focusout":Xl=Df=Ui=null;break;case"mousedown":If=!0;break;case"contextmenu":case"mouseup":case"dragend":If=!1,Bg(lt,o,Je);break;case"selectionchange":if(e_)break;case"keydown":case"keyup":Bg(lt,o,Je)}var an;if(Tf)e:{switch(n){case"compositionstart":var gn="onCompositionStart";break e;case"compositionend":gn="onCompositionEnd";break e;case"compositionupdate":gn="onCompositionUpdate";break e}gn=void 0}else Fi?Ag(n,o)&&(gn="onCompositionEnd"):n==="keydown"&&o.keyCode===229&&(gn="onCompositionStart");gn&&(jg&&o.locale!=="ko"&&(Fi||gn!=="onCompositionStart"?gn==="onCompositionEnd"&&Fi&&(an=Oi()):(Wn=Je,Xa="value"in Wn?Wn.value:Wn.textContent,Fi=!0)),$t=Su(Oe,gn),0<$t.length&&(gn=new Ng(gn,n,null,o,Je),lt.push({event:gn,listeners:$t}),an?gn.data=an:(an=Tg(o),an!==null&&(gn.data=an)))),(an=Pj?Vj(n,o):Yj(n,o))&&(gn=Su(Oe,"onBeforeInput"),0<gn.length&&($t=new Ng("onBeforeInput","beforeinput",null,o,Je),lt.push({event:$t,listeners:gn}),$t.data=an)),z_(lt,n,Oe,o,Je)}mx(lt,s)})}function xo(n,s,o){return{instance:n,listener:s,currentTarget:o}}function Su(n,s){for(var o=s+"Capture",d=[];n!==null;){var b=n,x=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||x===null||(b=Gt(n,o),b!=null&&d.unshift(xo(n,b,x)),b=Gt(n,s),b!=null&&d.push(xo(n,b,x))),n.tag===3)return d;n=n.return}return[]}function B_(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function px(n,s,o,d,b){for(var x=s._reactName,$=[];o!==null&&o!==d;){var K=o,pe=K.alternate,Oe=K.stateNode;if(K=K.tag,pe!==null&&pe===d)break;K!==5&&K!==26&&K!==27||Oe===null||(pe=Oe,b?(Oe=Gt(o,x),Oe!=null&&$.unshift(xo(o,Oe,pe))):b||(Oe=Gt(o,x),Oe!=null&&$.push(xo(o,Oe,pe)))),o=o.return}$.length!==0&&n.push({event:s,listeners:$})}var q_=/\r\n?/g,H_=/\u0000|\uFFFD/g;function yx(n){return(typeof n=="string"?n:""+n).replace(q_,`
`).replace(H_,"")}function gx(n,s){return s=yx(s),yx(n)===s}function kn(n,s,o,d,b,x){switch(o){case"children":typeof d=="string"?s==="body"||s==="textarea"&&d===""||Ce(n,d):(typeof d=="number"||typeof d=="bigint")&&s!=="body"&&Ce(n,""+d);break;case"className":Wt(n,"class",d);break;case"tabIndex":Wt(n,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":Wt(n,o,d);break;case"style":fn(n,d,x);break;case"data":if(s!=="object"){Wt(n,"data",d);break}case"src":case"href":if(d===""&&(s!=="a"||o!=="href")){n.removeAttribute(o);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){n.removeAttribute(o);break}d=Un(""+d),n.setAttribute(o,d);break;case"action":case"formAction":if(typeof d=="function"){n.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(o==="formAction"?(s!=="input"&&kn(n,s,"name",b.name,b,null),kn(n,s,"formEncType",b.formEncType,b,null),kn(n,s,"formMethod",b.formMethod,b,null),kn(n,s,"formTarget",b.formTarget,b,null)):(kn(n,s,"encType",b.encType,b,null),kn(n,s,"method",b.method,b,null),kn(n,s,"target",b.target,b,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){n.removeAttribute(o);break}d=Un(""+d),n.setAttribute(o,d);break;case"onClick":d!=null&&(n.onclick=la);break;case"onScroll":d!=null&&hn("scroll",n);break;case"onScrollEnd":d!=null&&hn("scrollend",n);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(o=d.__html,o!=null){if(b.children!=null)throw Error(i(60));n.innerHTML=o}}break;case"multiple":n.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":n.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){n.removeAttribute("xlink:href");break}o=Un(""+d),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(o,""+d):n.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(o,""):n.removeAttribute(o);break;case"capture":case"download":d===!0?n.setAttribute(o,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(o,d):n.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?n.setAttribute(o,d):n.removeAttribute(o);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?n.removeAttribute(o):n.setAttribute(o,d);break;case"popover":hn("beforetoggle",n),hn("toggle",n),jt(n,"popover",d);break;case"xlinkActuate":ln(n,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":ln(n,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":ln(n,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":ln(n,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":ln(n,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":ln(n,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":ln(n,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":ln(n,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":ln(n,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":jt(n,"is",d);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=jn.get(o)||o,jt(n,o,d))}}function rh(n,s,o,d,b,x){switch(o){case"style":fn(n,d,x);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(o=d.__html,o!=null){if(b.children!=null)throw Error(i(60));n.innerHTML=o}}break;case"children":typeof d=="string"?Ce(n,d):(typeof d=="number"||typeof d=="bigint")&&Ce(n,""+d);break;case"onScroll":d!=null&&hn("scroll",n);break;case"onScrollEnd":d!=null&&hn("scrollend",n);break;case"onClick":d!=null&&(n.onclick=la);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!mt.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(b=o.endsWith("Capture"),s=o.slice(2,b?o.length-7:void 0),x=n[ot]||null,x=x!=null?x[o]:null,typeof x=="function"&&n.removeEventListener(s,x,b),typeof d=="function")){typeof x!="function"&&x!==null&&(o in n?n[o]=null:n.hasAttribute(o)&&n.removeAttribute(o)),n.addEventListener(s,d,b);break e}o in n?n[o]=d:d===!0?n.setAttribute(o,""):jt(n,o,d)}}}function fa(n,s,o){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":hn("error",n),hn("load",n);var d=!1,b=!1,x;for(x in o)if(o.hasOwnProperty(x)){var $=o[x];if($!=null)switch(x){case"src":d=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:kn(n,s,x,$,o,null)}}b&&kn(n,s,"srcSet",o.srcSet,o,null),d&&kn(n,s,"src",o.src,o,null);return;case"input":hn("invalid",n);var K=x=$=b=null,pe=null,Oe=null;for(d in o)if(o.hasOwnProperty(d)){var Je=o[d];if(Je!=null)switch(d){case"name":b=Je;break;case"type":$=Je;break;case"checked":pe=Je;break;case"defaultChecked":Oe=Je;break;case"value":x=Je;break;case"defaultValue":K=Je;break;case"children":case"dangerouslySetInnerHTML":if(Je!=null)throw Error(i(137,s));break;default:kn(n,s,d,Je,o,null)}}ti(n,x,K,pe,Oe,$,b,!1);return;case"select":hn("invalid",n),d=$=x=null;for(b in o)if(o.hasOwnProperty(b)&&(K=o[b],K!=null))switch(b){case"value":x=K;break;case"defaultValue":$=K;break;case"multiple":d=K;default:kn(n,s,b,K,o,null)}s=x,o=$,n.multiple=!!d,s!=null?Ia(n,!!d,s,!1):o!=null&&Ia(n,!!d,o,!0);return;case"textarea":hn("invalid",n),x=b=d=null;for($ in o)if(o.hasOwnProperty($)&&(K=o[$],K!=null))switch($){case"value":d=K;break;case"defaultValue":b=K;break;case"children":x=K;break;case"dangerouslySetInnerHTML":if(K!=null)throw Error(i(91));break;default:kn(n,s,$,K,o,null)}de(n,d,b,x);return;case"option":for(pe in o)if(o.hasOwnProperty(pe)&&(d=o[pe],d!=null))switch(pe){case"selected":n.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:kn(n,s,pe,d,o,null)}return;case"dialog":hn("beforetoggle",n),hn("toggle",n),hn("cancel",n),hn("close",n);break;case"iframe":case"object":hn("load",n);break;case"video":case"audio":for(d=0;d<vo.length;d++)hn(vo[d],n);break;case"image":hn("error",n),hn("load",n);break;case"details":hn("toggle",n);break;case"embed":case"source":case"link":hn("error",n),hn("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Oe in o)if(o.hasOwnProperty(Oe)&&(d=o[Oe],d!=null))switch(Oe){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:kn(n,s,Oe,d,o,null)}return;default:if(qt(s)){for(Je in o)o.hasOwnProperty(Je)&&(d=o[Je],d!==void 0&&rh(n,s,Je,d,o,void 0));return}}for(K in o)o.hasOwnProperty(K)&&(d=o[K],d!=null&&kn(n,s,K,d,o,null))}function P_(n,s,o,d){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,x=null,$=null,K=null,pe=null,Oe=null,Je=null;for(Ye in o){var lt=o[Ye];if(o.hasOwnProperty(Ye)&&lt!=null)switch(Ye){case"checked":break;case"value":break;case"defaultValue":pe=lt;default:d.hasOwnProperty(Ye)||kn(n,s,Ye,null,d,lt)}}for(var Ue in d){var Ye=d[Ue];if(lt=o[Ue],d.hasOwnProperty(Ue)&&(Ye!=null||lt!=null))switch(Ue){case"type":x=Ye;break;case"name":b=Ye;break;case"checked":Oe=Ye;break;case"defaultChecked":Je=Ye;break;case"value":$=Ye;break;case"defaultValue":K=Ye;break;case"children":case"dangerouslySetInnerHTML":if(Ye!=null)throw Error(i(137,s));break;default:Ye!==lt&&kn(n,s,Ue,Ye,d,lt)}}ei(n,$,K,pe,Oe,Je,x,b);return;case"select":Ye=$=K=Ue=null;for(x in o)if(pe=o[x],o.hasOwnProperty(x)&&pe!=null)switch(x){case"value":break;case"multiple":Ye=pe;default:d.hasOwnProperty(x)||kn(n,s,x,null,d,pe)}for(b in d)if(x=d[b],pe=o[b],d.hasOwnProperty(b)&&(x!=null||pe!=null))switch(b){case"value":Ue=x;break;case"defaultValue":K=x;break;case"multiple":$=x;default:x!==pe&&kn(n,s,b,x,d,pe)}s=K,o=$,d=Ye,Ue!=null?Ia(n,!!o,Ue,!1):!!d!=!!o&&(s!=null?Ia(n,!!o,s,!0):Ia(n,!!o,o?[]:"",!1));return;case"textarea":Ye=Ue=null;for(K in o)if(b=o[K],o.hasOwnProperty(K)&&b!=null&&!d.hasOwnProperty(K))switch(K){case"value":break;case"children":break;default:kn(n,s,K,null,d,b)}for($ in d)if(b=d[$],x=o[$],d.hasOwnProperty($)&&(b!=null||x!=null))switch($){case"value":Ue=b;break;case"defaultValue":Ye=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(i(91));break;default:b!==x&&kn(n,s,$,b,d,x)}ws(n,Ue,Ye);return;case"option":for(var Ot in o)if(Ue=o[Ot],o.hasOwnProperty(Ot)&&Ue!=null&&!d.hasOwnProperty(Ot))switch(Ot){case"selected":n.selected=!1;break;default:kn(n,s,Ot,null,d,Ue)}for(pe in d)if(Ue=d[pe],Ye=o[pe],d.hasOwnProperty(pe)&&Ue!==Ye&&(Ue!=null||Ye!=null))switch(pe){case"selected":n.selected=Ue&&typeof Ue!="function"&&typeof Ue!="symbol";break;default:kn(n,s,pe,Ue,d,Ye)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Xt in o)Ue=o[Xt],o.hasOwnProperty(Xt)&&Ue!=null&&!d.hasOwnProperty(Xt)&&kn(n,s,Xt,null,d,Ue);for(Oe in d)if(Ue=d[Oe],Ye=o[Oe],d.hasOwnProperty(Oe)&&Ue!==Ye&&(Ue!=null||Ye!=null))switch(Oe){case"children":case"dangerouslySetInnerHTML":if(Ue!=null)throw Error(i(137,s));break;default:kn(n,s,Oe,Ue,d,Ye)}return;default:if(qt(s)){for(var Dn in o)Ue=o[Dn],o.hasOwnProperty(Dn)&&Ue!==void 0&&!d.hasOwnProperty(Dn)&&rh(n,s,Dn,void 0,d,Ue);for(Je in d)Ue=d[Je],Ye=o[Je],!d.hasOwnProperty(Je)||Ue===Ye||Ue===void 0&&Ye===void 0||rh(n,s,Je,Ue,d,Ye);return}}for(var Ae in o)Ue=o[Ae],o.hasOwnProperty(Ae)&&Ue!=null&&!d.hasOwnProperty(Ae)&&kn(n,s,Ae,null,d,Ue);for(lt in d)Ue=d[lt],Ye=o[lt],!d.hasOwnProperty(lt)||Ue===Ye||Ue==null&&Ye==null||kn(n,s,lt,Ue,d,Ye)}function bx(n){switch(n){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function V_(){if(typeof performance.getEntriesByType=="function"){for(var n=0,s=0,o=performance.getEntriesByType("resource"),d=0;d<o.length;d++){var b=o[d],x=b.transferSize,$=b.initiatorType,K=b.duration;if(x&&K&&bx($)){for($=0,K=b.responseEnd,d+=1;d<o.length;d++){var pe=o[d],Oe=pe.startTime;if(Oe>K)break;var Je=pe.transferSize,lt=pe.initiatorType;Je&&bx(lt)&&(pe=pe.responseEnd,$+=Je*(pe<K?1:(K-Oe)/(pe-Oe)))}if(--d,s+=8*(x+$)/(b.duration/1e3),n++,10<n)break}}if(0<n)return s/n/1e6}return navigator.connection&&(n=navigator.connection.downlink,typeof n=="number")?n:5}var ih=null,lh=null;function wu(n){return n.nodeType===9?n:n.ownerDocument}function vx(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function xx(n,s){if(n===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&s==="foreignObject"?0:n}function oh(n,s){return n==="textarea"||n==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var ch=null;function Y_(){var n=window.event;return n&&n.type==="popstate"?n===ch?!1:(ch=n,!0):(ch=null,!1)}var Sx=typeof setTimeout=="function"?setTimeout:void 0,G_=typeof clearTimeout=="function"?clearTimeout:void 0,wx=typeof Promise=="function"?Promise:void 0,X_=typeof queueMicrotask=="function"?queueMicrotask:typeof wx<"u"?function(n){return wx.resolve(null).then(n).catch(K_)}:Sx;function K_(n){setTimeout(function(){throw n})}function Cr(n){return n==="head"}function Nx(n,s){var o=s,d=0;do{var b=o.nextSibling;if(n.removeChild(o),b&&b.nodeType===8)if(o=b.data,o==="/$"||o==="/&"){if(d===0){n.removeChild(b),ml(s);return}d--}else if(o==="$"||o==="$?"||o==="$~"||o==="$!"||o==="&")d++;else if(o==="html")So(n.ownerDocument.documentElement);else if(o==="head"){o=n.ownerDocument.head,So(o);for(var x=o.firstChild;x;){var $=x.nextSibling,K=x.nodeName;x[ae]||K==="SCRIPT"||K==="STYLE"||K==="LINK"&&x.rel.toLowerCase()==="stylesheet"||o.removeChild(x),x=$}}else o==="body"&&So(n.ownerDocument.body);o=b}while(o);ml(s)}function Ex(n,s){var o=n;n=0;do{var d=o.nextSibling;if(o.nodeType===1?s?(o._stashedDisplay=o.style.display,o.style.display="none"):(o.style.display=o._stashedDisplay||"",o.getAttribute("style")===""&&o.removeAttribute("style")):o.nodeType===3&&(s?(o._stashedText=o.nodeValue,o.nodeValue=""):o.nodeValue=o._stashedText||""),d&&d.nodeType===8)if(o=d.data,o==="/$"){if(n===0)break;n--}else o!=="$"&&o!=="$?"&&o!=="$~"&&o!=="$!"||n++;o=d}while(o)}function uh(n){var s=n.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var o=s;switch(s=s.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":uh(o),Xe(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}n.removeChild(o)}}function W_(n,s,o,d){for(;n.nodeType===1;){var b=o;if(n.nodeName.toLowerCase()!==s.toLowerCase()){if(!d&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(d){if(!n[ae])switch(s){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(x=n.getAttribute("rel"),x==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(x!==b.rel||n.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||n.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||n.getAttribute("title")!==(b.title==null?null:b.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(x=n.getAttribute("src"),(x!==(b.src==null?null:b.src)||n.getAttribute("type")!==(b.type==null?null:b.type)||n.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&x&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(s==="input"&&n.type==="hidden"){var x=b.name==null?null:""+b.name;if(b.type==="hidden"&&n.getAttribute("name")===x)return n}else return n;if(n=ts(n.nextSibling),n===null)break}return null}function Z_(n,s,o){if(s==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!o||(n=ts(n.nextSibling),n===null))return null;return n}function jx(n,s){for(;n.nodeType!==8;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!s||(n=ts(n.nextSibling),n===null))return null;return n}function dh(n){return n.data==="$?"||n.data==="$~"}function fh(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState!=="loading"}function Q_(n,s){var o=n.ownerDocument;if(n.data==="$~")n._reactRetry=s;else if(n.data!=="$?"||o.readyState!=="loading")s();else{var d=function(){s(),o.removeEventListener("DOMContentLoaded",d)};o.addEventListener("DOMContentLoaded",d),n._reactRetry=d}}function ts(n){for(;n!=null;n=n.nextSibling){var s=n.nodeType;if(s===1||s===3)break;if(s===8){if(s=n.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return n}var mh=null;function _x(n){n=n.nextSibling;for(var s=0;n;){if(n.nodeType===8){var o=n.data;if(o==="/$"||o==="/&"){if(s===0)return ts(n.nextSibling);s--}else o!=="$"&&o!=="$!"&&o!=="$?"&&o!=="$~"&&o!=="&"||s++}n=n.nextSibling}return null}function Cx(n){n=n.previousSibling;for(var s=0;n;){if(n.nodeType===8){var o=n.data;if(o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"){if(s===0)return n;s--}else o!=="/$"&&o!=="/&"||s++}n=n.previousSibling}return null}function Ax(n,s,o){switch(s=wu(o),n){case"html":if(n=s.documentElement,!n)throw Error(i(452));return n;case"head":if(n=s.head,!n)throw Error(i(453));return n;case"body":if(n=s.body,!n)throw Error(i(454));return n;default:throw Error(i(451))}}function So(n){for(var s=n.attributes;s.length;)n.removeAttributeNode(s[0]);Xe(n)}var ns=new Map,Tx=new Set;function Nu(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var Zs=L.d;L.d={f:J_,r:eC,D:tC,C:nC,L:aC,m:sC,X:iC,S:rC,M:lC};function J_(){var n=Zs.f(),s=hu();return n||s}function eC(n){var s=Qe(n);s!==null&&s.tag===5&&s.type==="form"?Yb(s):Zs.r(n)}var ul=typeof document>"u"?null:document;function Mx(n,s,o){var d=ul;if(d&&typeof s=="string"&&s){var b=ia(s);b='link[rel="'+n+'"][href="'+b+'"]',typeof o=="string"&&(b+='[crossorigin="'+o+'"]'),Tx.has(b)||(Tx.add(b),n={rel:n,crossOrigin:o,href:s},d.querySelector(b)===null&&(s=d.createElement("link"),fa(s,"link",n),_e(s),d.head.appendChild(s)))}}function tC(n){Zs.D(n),Mx("dns-prefetch",n,null)}function nC(n,s){Zs.C(n,s),Mx("preconnect",n,s)}function aC(n,s,o){Zs.L(n,s,o);var d=ul;if(d&&n&&s){var b='link[rel="preload"][as="'+ia(s)+'"]';s==="image"&&o&&o.imageSrcSet?(b+='[imagesrcset="'+ia(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(b+='[imagesizes="'+ia(o.imageSizes)+'"]')):b+='[href="'+ia(n)+'"]';var x=b;switch(s){case"style":x=dl(n);break;case"script":x=fl(n)}ns.has(x)||(n=g({rel:"preload",href:s==="image"&&o&&o.imageSrcSet?void 0:n,as:s},o),ns.set(x,n),d.querySelector(b)!==null||s==="style"&&d.querySelector(wo(x))||s==="script"&&d.querySelector(No(x))||(s=d.createElement("link"),fa(s,"link",n),_e(s),d.head.appendChild(s)))}}function sC(n,s){Zs.m(n,s);var o=ul;if(o&&n){var d=s&&typeof s.as=="string"?s.as:"script",b='link[rel="modulepreload"][as="'+ia(d)+'"][href="'+ia(n)+'"]',x=b;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=fl(n)}if(!ns.has(x)&&(n=g({rel:"modulepreload",href:n},s),ns.set(x,n),o.querySelector(b)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(No(x)))return}d=o.createElement("link"),fa(d,"link",n),_e(d),o.head.appendChild(d)}}}function rC(n,s,o){Zs.S(n,s,o);var d=ul;if(d&&n){var b=St(d).hoistableStyles,x=dl(n);s=s||"default";var $=b.get(x);if(!$){var K={loading:0,preload:null};if($=d.querySelector(wo(x)))K.loading=5;else{n=g({rel:"stylesheet",href:n,"data-precedence":s},o),(o=ns.get(x))&&hh(n,o);var pe=$=d.createElement("link");_e(pe),fa(pe,"link",n),pe._p=new Promise(function(Oe,Je){pe.onload=Oe,pe.onerror=Je}),pe.addEventListener("load",function(){K.loading|=1}),pe.addEventListener("error",function(){K.loading|=2}),K.loading|=4,Eu($,s,d)}$={type:"stylesheet",instance:$,count:1,state:K},b.set(x,$)}}}function iC(n,s){Zs.X(n,s);var o=ul;if(o&&n){var d=St(o).hoistableScripts,b=fl(n),x=d.get(b);x||(x=o.querySelector(No(b)),x||(n=g({src:n,async:!0},s),(s=ns.get(b))&&ph(n,s),x=o.createElement("script"),_e(x),fa(x,"link",n),o.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},d.set(b,x))}}function lC(n,s){Zs.M(n,s);var o=ul;if(o&&n){var d=St(o).hoistableScripts,b=fl(n),x=d.get(b);x||(x=o.querySelector(No(b)),x||(n=g({src:n,async:!0,type:"module"},s),(s=ns.get(b))&&ph(n,s),x=o.createElement("script"),_e(x),fa(x,"link",n),o.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},d.set(b,x))}}function Rx(n,s,o,d){var b=(b=Z.current)?Nu(b):null;if(!b)throw Error(i(446));switch(n){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(s=dl(o.href),o=St(b).hoistableStyles,d=o.get(s),d||(d={type:"style",instance:null,count:0,state:null},o.set(s,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){n=dl(o.href);var x=St(b).hoistableStyles,$=x.get(n);if($||(b=b.ownerDocument||b,$={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(n,$),(x=b.querySelector(wo(n)))&&!x._p&&($.instance=x,$.state.loading=5),ns.has(n)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},ns.set(n,o),x||oC(b,n,o,$.state))),s&&d===null)throw Error(i(528,""));return $}if(s&&d!==null)throw Error(i(529,""));return null;case"script":return s=o.async,o=o.src,typeof o=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=fl(o),o=St(b).hoistableScripts,d=o.get(s),d||(d={type:"script",instance:null,count:0,state:null},o.set(s,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,n))}}function dl(n){return'href="'+ia(n)+'"'}function wo(n){return'link[rel="stylesheet"]['+n+"]"}function kx(n){return g({},n,{"data-precedence":n.precedence,precedence:null})}function oC(n,s,o,d){n.querySelector('link[rel="preload"][as="style"]['+s+"]")?d.loading=1:(s=n.createElement("link"),d.preload=s,s.addEventListener("load",function(){return d.loading|=1}),s.addEventListener("error",function(){return d.loading|=2}),fa(s,"link",o),_e(s),n.head.appendChild(s))}function fl(n){return'[src="'+ia(n)+'"]'}function No(n){return"script[async]"+n}function Dx(n,s,o){if(s.count++,s.instance===null)switch(s.type){case"style":var d=n.querySelector('style[data-href~="'+ia(o.href)+'"]');if(d)return s.instance=d,_e(d),d;var b=g({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return d=(n.ownerDocument||n).createElement("style"),_e(d),fa(d,"style",b),Eu(d,o.precedence,n),s.instance=d;case"stylesheet":b=dl(o.href);var x=n.querySelector(wo(b));if(x)return s.state.loading|=4,s.instance=x,_e(x),x;d=kx(o),(b=ns.get(b))&&hh(d,b),x=(n.ownerDocument||n).createElement("link"),_e(x);var $=x;return $._p=new Promise(function(K,pe){$.onload=K,$.onerror=pe}),fa(x,"link",d),s.state.loading|=4,Eu(x,o.precedence,n),s.instance=x;case"script":return x=fl(o.src),(b=n.querySelector(No(x)))?(s.instance=b,_e(b),b):(d=o,(b=ns.get(x))&&(d=g({},o),ph(d,b)),n=n.ownerDocument||n,b=n.createElement("script"),_e(b),fa(b,"link",d),n.head.appendChild(b),s.instance=b);case"void":return null;default:throw Error(i(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(d=s.instance,s.state.loading|=4,Eu(d,o.precedence,n));return s.instance}function Eu(n,s,o){for(var d=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=d.length?d[d.length-1]:null,x=b,$=0;$<d.length;$++){var K=d[$];if(K.dataset.precedence===s)x=K;else if(x!==b)break}x?x.parentNode.insertBefore(n,x.nextSibling):(s=o.nodeType===9?o.head:o,s.insertBefore(n,s.firstChild))}function hh(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.title==null&&(n.title=s.title)}function ph(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.integrity==null&&(n.integrity=s.integrity)}var ju=null;function Ix(n,s,o){if(ju===null){var d=new Map,b=ju=new Map;b.set(o,d)}else b=ju,d=b.get(o),d||(d=new Map,b.set(o,d));if(d.has(n))return d;for(d.set(n,null),o=o.getElementsByTagName(n),b=0;b<o.length;b++){var x=o[b];if(!(x[ae]||x[Ke]||n==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var $=x.getAttribute(s)||"";$=n+$;var K=d.get($);K?K.push(x):d.set($,[x])}}return d}function Lx(n,s,o){n=n.ownerDocument||n,n.head.insertBefore(o,s==="title"?n.querySelector("head > title"):null)}function cC(n,s,o){if(o===1||s.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return n=s.disabled,typeof s.precedence=="string"&&n==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Ox(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}function uC(n,s,o,d){if(o.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var b=dl(d.href),x=s.querySelector(wo(b));if(x){s=x._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(n.count++,n=_u.bind(n),s.then(n,n)),o.state.loading|=4,o.instance=x,_e(x);return}x=s.ownerDocument||s,d=kx(d),(b=ns.get(b))&&hh(d,b),x=x.createElement("link"),_e(x);var $=x;$._p=new Promise(function(K,pe){$.onload=K,$.onerror=pe}),fa(x,"link",d),o.instance=x}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(o,s),(s=o.state.preload)&&(o.state.loading&3)===0&&(n.count++,o=_u.bind(n),s.addEventListener("load",o),s.addEventListener("error",o))}}var yh=0;function dC(n,s){return n.stylesheets&&n.count===0&&Au(n,n.stylesheets),0<n.count||0<n.imgCount?function(o){var d=setTimeout(function(){if(n.stylesheets&&Au(n,n.stylesheets),n.unsuspend){var x=n.unsuspend;n.unsuspend=null,x()}},6e4+s);0<n.imgBytes&&yh===0&&(yh=62500*V_());var b=setTimeout(function(){if(n.waitingForImages=!1,n.count===0&&(n.stylesheets&&Au(n,n.stylesheets),n.unsuspend)){var x=n.unsuspend;n.unsuspend=null,x()}},(n.imgBytes>yh?50:800)+s);return n.unsuspend=o,function(){n.unsuspend=null,clearTimeout(d),clearTimeout(b)}}:null}function _u(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Au(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var Cu=null;function Au(n,s){n.stylesheets=null,n.unsuspend!==null&&(n.count++,Cu=new Map,s.forEach(fC,n),Cu=null,_u.call(n))}function fC(n,s){if(!(s.state.loading&4)){var o=Cu.get(n);if(o)var d=o.get(null);else{o=new Map,Cu.set(n,o);for(var b=n.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<b.length;x++){var $=b[x];($.nodeName==="LINK"||$.getAttribute("media")!=="not all")&&(o.set($.dataset.precedence,$),d=$)}d&&o.set(null,d)}b=s.instance,$=b.getAttribute("data-precedence"),x=o.get($)||d,x===d&&o.set(null,b),o.set($,b),this.count++,d=_u.bind(this),b.addEventListener("load",d),b.addEventListener("error",d),x?x.parentNode.insertBefore(b,x.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(b,n.firstChild)),s.state.loading|=4}}var Eo={$$typeof:O,Provider:null,Consumer:null,_currentValue:U,_currentValue2:U,_threadCount:0};function mC(n,s,o,d,b,x,$,K,pe){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Kt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Kt(0),this.hiddenUpdates=Kt(null),this.identifierPrefix=d,this.onUncaughtError=b,this.onCaughtError=x,this.onRecoverableError=$,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=pe,this.incompleteTransitions=new Map}function zx(n,s,o,d,b,x,$,K,pe,Oe,Je,lt){return n=new mC(n,s,o,$,pe,Oe,Je,lt,K),s=1,x===!0&&(s|=24),x=Oa(3,null,null,s),n.current=x,x.stateNode=n,s=Kf(),s.refCount++,n.pooledCache=s,s.refCount++,x.memoizedState={element:d,isDehydrated:o,cache:s},Jf(x),n}function $x(n){return n?(n=Hi,n):Hi}function Fx(n,s,o,d,b,x){b=$x(b),d.context===null?d.context=b:d.pendingContext=b,d=yr(s),d.payload={element:o},x=x===void 0?null:x,x!==null&&(d.callback=x),o=gr(n,d,s),o!==null&&(Ca(o,n,s),to(o,n,s))}function Ux(n,s){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var o=n.retryLane;n.retryLane=o!==0&&o<s?o:s}}function gh(n,s){Ux(n,s),(n=n.alternate)&&Ux(n,s)}function Bx(n){if(n.tag===13||n.tag===31){var s=ri(n,67108864);s!==null&&Ca(s,n,67108864),gh(n,67108864)}}function qx(n){if(n.tag===13||n.tag===31){var s=Ba();s=gt(s);var o=ri(n,s);o!==null&&Ca(o,n,s),gh(n,s)}}var Tu=!0;function hC(n,s,o,d){var b=D.T;D.T=null;var x=L.p;try{L.p=2,bh(n,s,o,d)}finally{L.p=x,D.T=b}}function pC(n,s,o,d){var b=D.T;D.T=null;var x=L.p;try{L.p=8,bh(n,s,o,d)}finally{L.p=x,D.T=b}}function bh(n,s,o,d){if(Tu){var b=vh(d);if(b===null)sh(n,s,d,Mu,o),Px(n,d);else if(gC(b,n,s,o,d))d.stopPropagation();else if(Px(n,d),s&4&&-1<yC.indexOf(n)){for(;b!==null;){var x=Qe(b);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var $=Mt(x.pendingLanes);if($!==0){var K=x;for(K.pendingLanes|=2,K.entangledLanes|=2;$;){var pe=1<<31-$e($);K.entanglements[1]|=pe,$&=~pe}_s(x),(_n&6)===0&&(fu=Ze()+500,bo(0))}}break;case 31:case 13:K=ri(x,2),K!==null&&Ca(K,x,2),hu(),gh(x,2)}if(x=vh(d),x===null&&sh(n,s,d,Mu,o),x===b)break;b=x}b!==null&&d.stopPropagation()}else sh(n,s,d,null,o)}}function vh(n){return n=Me(n),xh(n)}var Mu=null;function xh(n){if(Mu=null,n=Fe(n),n!==null){var s=c(n);if(s===null)n=null;else{var o=s.tag;if(o===13){if(n=f(s),n!==null)return n;n=null}else if(o===31){if(n=m(s),n!==null)return n;n=null}else if(o===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;n=null}else s!==n&&(n=null)}}return Mu=n,null}function Hx(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(W()){case ee:return 2;case te:return 8;case ve:case le:return 32;case Se:return 268435456;default:return 32}default:return 32}}var Sh=!1,Ar=null,Tr=null,Mr=null,jo=new Map,_o=new Map,Rr=[],yC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Px(n,s){switch(n){case"focusin":case"focusout":Ar=null;break;case"dragenter":case"dragleave":Tr=null;break;case"mouseover":case"mouseout":Mr=null;break;case"pointerover":case"pointerout":jo.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":_o.delete(s.pointerId)}}function Co(n,s,o,d,b,x){return n===null||n.nativeEvent!==x?(n={blockedOn:s,domEventName:o,eventSystemFlags:d,nativeEvent:x,targetContainers:[b]},s!==null&&(s=Qe(s),s!==null&&Bx(s)),n):(n.eventSystemFlags|=d,s=n.targetContainers,b!==null&&s.indexOf(b)===-1&&s.push(b),n)}function gC(n,s,o,d,b){switch(s){case"focusin":return Ar=Co(Ar,n,s,o,d,b),!0;case"dragenter":return Tr=Co(Tr,n,s,o,d,b),!0;case"mouseover":return Mr=Co(Mr,n,s,o,d,b),!0;case"pointerover":var x=b.pointerId;return jo.set(x,Co(jo.get(x)||null,n,s,o,d,b)),!0;case"gotpointercapture":return x=b.pointerId,_o.set(x,Co(_o.get(x)||null,n,s,o,d,b)),!0}return!1}function Vx(n){var s=Fe(n.target);if(s!==null){var o=c(s);if(o!==null){if(s=o.tag,s===13){if(s=f(o),s!==null){n.blockedOn=s,Ne(n.priority,function(){qx(o)});return}}else if(s===31){if(s=m(o),s!==null){n.blockedOn=s,Ne(n.priority,function(){qx(o)});return}}else if(s===3&&o.stateNode.current.memoizedState.isDehydrated){n.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Ru(n){if(n.blockedOn!==null)return!1;for(var s=n.targetContainers;0<s.length;){var o=vh(n.nativeEvent);if(o===null){o=n.nativeEvent;var d=new o.constructor(o.type,o);ye=d,o.target.dispatchEvent(d),ye=null}else return s=Qe(o),s!==null&&Bx(s),n.blockedOn=o,!1;s.shift()}return!0}function Yx(n,s,o){Ru(n)&&o.delete(s)}function bC(){Sh=!1,Ar!==null&&Ru(Ar)&&(Ar=null),Tr!==null&&Ru(Tr)&&(Tr=null),Mr!==null&&Ru(Mr)&&(Mr=null),jo.forEach(Yx),_o.forEach(Yx)}function ku(n,s){n.blockedOn===s&&(n.blockedOn=null,Sh||(Sh=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,bC)))}var Du=null;function Gx(n){Du!==n&&(Du=n,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Du===n&&(Du=null);for(var s=0;s<n.length;s+=3){var o=n[s],d=n[s+1],b=n[s+2];if(typeof d!="function"){if(xh(d||o)===null)continue;break}var x=Qe(o);x!==null&&(n.splice(s,3),s-=3,vm(x,{pending:!0,data:b,method:o.method,action:d},d,b))}}))}function ml(n){function s(pe){return ku(pe,n)}Ar!==null&&ku(Ar,n),Tr!==null&&ku(Tr,n),Mr!==null&&ku(Mr,n),jo.forEach(s),_o.forEach(s);for(var o=0;o<Rr.length;o++){var d=Rr[o];d.blockedOn===n&&(d.blockedOn=null)}for(;0<Rr.length&&(o=Rr[0],o.blockedOn===null);)Vx(o),o.blockedOn===null&&Rr.shift();if(o=(n.ownerDocument||n).$$reactFormReplay,o!=null)for(d=0;d<o.length;d+=3){var b=o[d],x=o[d+1],$=b[ot]||null;if(typeof x=="function")$||Gx(o);else if($){var K=null;if(x&&x.hasAttribute("formAction")){if(b=x,$=x[ot]||null)K=$.formAction;else if(xh(b)!==null)continue}else K=$.action;typeof K=="function"?o[d+1]=K:(o.splice(d,3),d-=3),Gx(o)}}}function Xx(){function n(x){x.canIntercept&&x.info==="react-transition"&&x.intercept({handler:function(){return new Promise(function($){return b=$})},focusReset:"manual",scroll:"manual"})}function s(){b!==null&&(b(),b=null),d||setTimeout(o,20)}function o(){if(!d&&!navigation.transition){var x=navigation.currentEntry;x&&x.url!=null&&navigation.navigate(x.url,{state:x.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,b=null;return navigation.addEventListener("navigate",n),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(o,100),function(){d=!0,navigation.removeEventListener("navigate",n),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),b!==null&&(b(),b=null)}}}function wh(n){this._internalRoot=n}Iu.prototype.render=wh.prototype.render=function(n){var s=this._internalRoot;if(s===null)throw Error(i(409));var o=s.current,d=Ba();Fx(o,d,n,s,null,null)},Iu.prototype.unmount=wh.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var s=n.containerInfo;Fx(n.current,2,null,n,null,null),hu(),s[ze]=null}};function Iu(n){this._internalRoot=n}Iu.prototype.unstable_scheduleHydration=function(n){if(n){var s=re();n={blockedOn:null,target:n,priority:s};for(var o=0;o<Rr.length&&s!==0&&s<Rr[o].priority;o++);Rr.splice(o,0,n),o===0&&Vx(n)}};var Kx=t.version;if(Kx!=="19.2.0")throw Error(i(527,Kx,"19.2.0"));L.findDOMNode=function(n){var s=n._reactInternals;if(s===void 0)throw typeof n.render=="function"?Error(i(188)):(n=Object.keys(n).join(","),Error(i(268,n)));return n=p(s),n=n!==null?y(n):null,n=n===null?null:n.stateNode,n};var vC={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:D,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lu.isDisabled&&Lu.supportsFiber)try{at=Lu.inject(vC),st=Lu}catch{}}return To.createRoot=function(n,s){if(!l(n))throw Error(i(299));var o=!1,d="",b=nv,x=av,$=sv;return s!=null&&(s.unstable_strictMode===!0&&(o=!0),s.identifierPrefix!==void 0&&(d=s.identifierPrefix),s.onUncaughtError!==void 0&&(b=s.onUncaughtError),s.onCaughtError!==void 0&&(x=s.onCaughtError),s.onRecoverableError!==void 0&&($=s.onRecoverableError)),s=zx(n,1,!1,null,null,o,d,null,b,x,$,Xx),n[ze]=s.current,ah(n),new wh(s)},To.hydrateRoot=function(n,s,o){if(!l(n))throw Error(i(299));var d=!1,b="",x=nv,$=av,K=sv,pe=null;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(b=o.identifierPrefix),o.onUncaughtError!==void 0&&(x=o.onUncaughtError),o.onCaughtError!==void 0&&($=o.onCaughtError),o.onRecoverableError!==void 0&&(K=o.onRecoverableError),o.formState!==void 0&&(pe=o.formState)),s=zx(n,1,!0,s,o??null,d,b,pe,x,$,K,Xx),s.context=$x(null),o=s.current,d=Ba(),d=gt(d),b=yr(d),b.callback=null,gr(o,b,d),o=d,s.current.lanes=o,se(s,o),_s(s),n[ze]=s.current,ah(n),new Iu(s)},To.version="19.2.0",To}var r0;function AC(){if(r0)return jh.exports;r0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),jh.exports=CC(),jh.exports}var TC=AC();/**
 * react-router v7.9.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Bw=e=>{throw TypeError(e)},MC=(e,t,r)=>t.has(e)||Bw("Cannot "+r),Th=(e,t,r)=>(MC(e,t,"read from private field"),r?r.call(e):t.get(e)),RC=(e,t,r)=>t.has(e)?Bw("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),i0="popstate";function kC(e={}){function t(i,l){let{pathname:c,search:f,hash:m}=i.location;return ac("",{pathname:c,search:f,hash:m},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function r(i,l){return typeof l=="string"?l:Vr(l)}return IC(t,r,null,e)}function sn(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Gn(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function DC(){return Math.random().toString(36).substring(2,10)}function l0(e,t){return{usr:e.state,key:e.key,idx:t}}function ac(e,t,r=null,i){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof t=="string"?Wr(t):t,state:r,key:t&&t.key||i||DC()}}function Vr({pathname:e="/",search:t="",hash:r=""}){return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Wr(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substring(r),e=e.substring(0,r));let i=e.indexOf("?");i>=0&&(t.search=e.substring(i),e=e.substring(0,i)),e&&(t.pathname=e)}return t}function IC(e,t,r,i={}){let{window:l=document.defaultView,v5Compat:c=!1}=i,f=l.history,m="POP",h=null,p=y();p==null&&(p=0,f.replaceState({...f.state,idx:p},""));function y(){return(f.state||{idx:null}).idx}function g(){m="POP";let j=y(),_=j==null?null:j-p;p=j,h&&h({action:m,location:N.location,delta:_})}function v(j,_){m="PUSH";let C=ac(N.location,j,_);p=y()+1;let O=l0(C,p),E=N.createHref(C);try{f.pushState(O,"",E)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;l.location.assign(E)}c&&h&&h({action:m,location:N.location,delta:1})}function S(j,_){m="REPLACE";let C=ac(N.location,j,_);p=y();let O=l0(C,p),E=N.createHref(C);f.replaceState(O,"",E),c&&h&&h({action:m,location:N.location,delta:0})}function w(j){return qw(j)}let N={get action(){return m},get location(){return e(l,f)},listen(j){if(h)throw new Error("A history only accepts one active listener");return l.addEventListener(i0,g),h=j,()=>{l.removeEventListener(i0,g),h=null}},createHref(j){return t(l,j)},createURL:w,encodeLocation(j){let _=w(j);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:v,replace:S,go(j){return f.go(j)}};return N}function qw(e,t=!1){let r="http://localhost";typeof window<"u"&&(r=window.location.origin!=="null"?window.location.origin:window.location.href),sn(r,"No window.location.(origin|href) available to create URL");let i=typeof e=="string"?e:Vr(e);return i=i.replace(/ $/,"%20"),!t&&i.startsWith("//")&&(i=r+i),new URL(i,r)}var Go,o0=class{constructor(e){if(RC(this,Go,new Map),e)for(let[t,r]of e)this.set(t,r)}get(e){if(Th(this,Go).has(e))return Th(this,Go).get(e);if(e.defaultValue!==void 0)return e.defaultValue;throw new Error("No value found for context")}set(e,t){Th(this,Go).set(e,t)}};Go=new WeakMap;var LC=new Set(["lazy","caseSensitive","path","id","index","children"]);function OC(e){return LC.has(e)}var zC=new Set(["lazy","caseSensitive","path","id","index","middleware","children"]);function $C(e){return zC.has(e)}function FC(e){return e.index===!0}function sc(e,t,r=[],i={},l=!1){return e.map((c,f)=>{let m=[...r,String(f)],h=typeof c.id=="string"?c.id:m.join("-");if(sn(c.index!==!0||!c.children,"Cannot specify children on an index route"),sn(l||!i[h],`Found a route id collision on id "${h}".  Route id's must be globally unique within Data Router usages`),FC(c)){let p={...c,...t(c),id:h};return i[h]=p,p}else{let p={...c,...t(c),id:h,children:void 0};return i[h]=p,c.children&&(p.children=sc(c.children,t,m,i,l)),p}})}function Fr(e,t,r="/"){return fd(e,t,r,!1)}function fd(e,t,r,i){let l=typeof t=="string"?Wr(t):t,c=Ra(l.pathname||"/",r);if(c==null)return null;let f=Hw(e);BC(f);let m=null;for(let h=0;m==null&&h<f.length;++h){let p=QC(c);m=WC(f[h],p,i)}return m}function UC(e,t){let{route:r,pathname:i,params:l}=e;return{id:r.id,pathname:i,params:l,data:t[r.id],loaderData:t[r.id],handle:r.handle}}function Hw(e,t=[],r=[],i="",l=!1){let c=(f,m,h=l,p)=>{let y={relativePath:p===void 0?f.path||"":p,caseSensitive:f.caseSensitive===!0,childrenIndex:m,route:f};if(y.relativePath.startsWith("/")){if(!y.relativePath.startsWith(i)&&h)return;sn(y.relativePath.startsWith(i),`Absolute route path "${y.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),y.relativePath=y.relativePath.slice(i.length)}let g=Rs([i,y.relativePath]),v=r.concat(y);f.children&&f.children.length>0&&(sn(f.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),Hw(f.children,t,v,g,h)),!(f.path==null&&!f.index)&&t.push({path:g,score:XC(g,f.index),routesMeta:v})};return e.forEach((f,m)=>{if(f.path===""||!f.path?.includes("?"))c(f,m);else for(let h of Pw(f.path))c(f,m,!0,h)}),t}function Pw(e){let t=e.split("/");if(t.length===0)return[];let[r,...i]=t,l=r.endsWith("?"),c=r.replace(/\?$/,"");if(i.length===0)return l?[c,""]:[c];let f=Pw(i.join("/")),m=[];return m.push(...f.map(h=>h===""?c:[c,h].join("/"))),l&&m.push(...f),m.map(h=>e.startsWith("/")&&h===""?"/":h)}function BC(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:KC(t.routesMeta.map(i=>i.childrenIndex),r.routesMeta.map(i=>i.childrenIndex)))}var qC=/^:[\w-]+$/,HC=3,PC=2,VC=1,YC=10,GC=-2,c0=e=>e==="*";function XC(e,t){let r=e.split("/"),i=r.length;return r.some(c0)&&(i+=GC),t&&(i+=PC),r.filter(l=>!c0(l)).reduce((l,c)=>l+(qC.test(c)?HC:c===""?VC:YC),i)}function KC(e,t){return e.length===t.length&&e.slice(0,-1).every((i,l)=>i===t[l])?e[e.length-1]-t[t.length-1]:0}function WC(e,t,r=!1){let{routesMeta:i}=e,l={},c="/",f=[];for(let m=0;m<i.length;++m){let h=i[m],p=m===i.length-1,y=c==="/"?t:t.slice(c.length)||"/",g=_d({path:h.relativePath,caseSensitive:h.caseSensitive,end:p},y),v=h.route;if(!g&&p&&r&&!i[i.length-1].route.index&&(g=_d({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},y)),!g)return null;Object.assign(l,g.params),f.push({params:l,pathname:Rs([c,g.pathname]),pathnameBase:nA(Rs([c,g.pathnameBase])),route:v}),g.pathnameBase!=="/"&&(c=Rs([c,g.pathnameBase]))}return f}function _d(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,i]=ZC(e.path,e.caseSensitive,e.end),l=t.match(r);if(!l)return null;let c=l[0],f=c.replace(/(.)\/+$/,"$1"),m=l.slice(1);return{params:i.reduce((p,{paramName:y,isOptional:g},v)=>{if(y==="*"){let w=m[v]||"";f=c.slice(0,c.length-w.length).replace(/(.)\/+$/,"$1")}const S=m[v];return g&&!S?p[y]=void 0:p[y]=(S||"").replace(/%2F/g,"/"),p},{}),pathname:c,pathnameBase:f,pattern:e}}function ZC(e,t=!1,r=!0){Gn(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let i=[],l="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,m,h)=>(i.push({paramName:m,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(i.push({paramName:"*"}),l+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?l+="\\/*$":e!==""&&e!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,t?void 0:"i"),i]}function QC(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Gn(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function Ra(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,i=e.charAt(r);return i&&i!=="/"?null:e.slice(r)||"/"}function JC({basename:e,pathname:t}){return t==="/"?e:Rs([e,t])}function eA(e,t="/"){let{pathname:r,search:i="",hash:l=""}=typeof e=="string"?Wr(e):e;return{pathname:r?r.startsWith("/")?r:tA(r,t):t,search:aA(i),hash:sA(l)}}function tA(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(l=>{l===".."?r.length>1&&r.pop():l!=="."&&r.push(l)}),r.length>1?r.join("/"):"/"}function Mh(e,t,r,i){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Vw(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function Yd(e){let t=Vw(e);return t.map((r,i)=>i===t.length-1?r.pathname:r.pathnameBase)}function Gd(e,t,r,i=!1){let l;typeof e=="string"?l=Wr(e):(l={...e},sn(!l.pathname||!l.pathname.includes("?"),Mh("?","pathname","search",l)),sn(!l.pathname||!l.pathname.includes("#"),Mh("#","pathname","hash",l)),sn(!l.search||!l.search.includes("#"),Mh("#","search","hash",l)));let c=e===""||l.pathname==="",f=c?"/":l.pathname,m;if(f==null)m=r;else{let g=t.length-1;if(!i&&f.startsWith("..")){let v=f.split("/");for(;v[0]==="..";)v.shift(),g-=1;l.pathname=v.join("/")}m=g>=0?t[g]:"/"}let h=eA(l,m),p=f&&f!=="/"&&f.endsWith("/"),y=(c||f===".")&&r.endsWith("/");return!h.pathname.endsWith("/")&&(p||y)&&(h.pathname+="/"),h}var Rs=e=>e.join("/").replace(/\/\/+/g,"/"),nA=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),aA=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,sA=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e,Cd=class{constructor(e,t,r,i=!1){this.status=e,this.statusText=t||"",this.internal=i,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}};function rc(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}var Yw=["POST","PUT","PATCH","DELETE"],rA=new Set(Yw),iA=["GET",...Yw],lA=new Set(iA),oA=new Set([301,302,303,307,308]),cA=new Set([307,308]),Rh={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},uA={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},wi={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},dA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,wy=e=>dA.test(e),fA=e=>({hasErrorBoundary:!!e.hasErrorBoundary}),Gw="remix-router-transitions",Xw=Symbol("ResetLoaderData");function mA(e){const t=e.window?e.window:typeof window<"u"?window:void 0,r=typeof t<"u"&&typeof t.document<"u"&&typeof t.document.createElement<"u";sn(e.routes.length>0,"You must provide a non-empty routes array to createRouter");let i=e.hydrationRouteProperties||[],l=e.mapRouteProperties||fA,c={},f=sc(e.routes,l,void 0,c),m,h=e.basename||"/";h.startsWith("/")||(h=`/${h}`);let p=e.dataStrategy||bA,y={...e.future},g=null,v=new Set,S=null,w=null,N=null,j=e.hydrationData!=null,_=Fr(f,e.history.location,h),C=!1,O=null,E;if(_==null&&!e.patchRoutesOnNavigation){let se=ss(404,{pathname:e.history.location.pathname}),{matches:be,route:je}=Ou(f);E=!0,_=be,O={[je.id]:se}}else if(_&&!e.hydrationData&&kt(_,f,e.history.location.pathname).active&&(_=null),_)if(_.some(se=>se.route.lazy))E=!1;else if(!_.some(se=>Ny(se.route)))E=!0;else{let se=e.hydrationData?e.hydrationData.loaderData:null,be=e.hydrationData?e.hydrationData.errors:null;if(be){let je=_.findIndex(We=>be[We.route.id]!==void 0);E=_.slice(0,je+1).every(We=>!Ip(We.route,se,be))}else E=_.every(je=>!Ip(je.route,se,be))}else{E=!1,_=[];let se=kt(null,f,e.history.location.pathname);se.active&&se.matches&&(C=!0,_=se.matches)}let T,M={historyAction:e.history.action,location:e.history.location,matches:_,initialized:E,navigation:Rh,restoreScrollPosition:e.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:e.hydrationData&&e.hydrationData.loaderData||{},actionData:e.hydrationData&&e.hydrationData.actionData||null,errors:e.hydrationData&&e.hydrationData.errors||O,fetchers:new Map,blockers:new Map},A="POP",z=!1,P,X=!1,H=new Map,Y=null,V=!1,I=!1,F=new Set,D=new Map,L=0,U=-1,k=new Map,B=new Set,R=new Map,q=new Map,G=new Set,J=new Map,ie,Z=null;function me(){if(g=e.history.listen(({action:se,location:be,delta:je})=>{if(ie){ie(),ie=void 0;return}Gn(J.size===0||je!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let We=Rt({currentLocation:M.location,nextLocation:be,historyAction:se});if(We&&je!=null){let dt=new Promise(gt=>{ie=gt});e.history.go(je*-1),zt(We,{state:"blocked",location:be,proceed(){zt(We,{state:"proceeding",proceed:void 0,reset:void 0,location:be}),dt.then(()=>e.history.go(je))},reset(){let gt=new Map(M.blockers);gt.set(We,wi),ne({blockers:gt})}});return}return Te(se,be)}),r){DA(t,H);let se=()=>IA(t,H);t.addEventListener("pagehide",se),Y=()=>t.removeEventListener("pagehide",se)}return M.initialized||Te("POP",M.location,{initialHydration:!0}),T}function Q(){g&&g(),Y&&Y(),v.clear(),P&&P.abort(),M.fetchers.forEach((se,be)=>Se(be)),M.blockers.forEach((se,be)=>ft(be))}function oe(se){return v.add(se),()=>v.delete(se)}function ne(se,be={}){se.matches&&(se.matches=se.matches.map(dt=>{let gt=c[dt.route.id],ce=dt.route;return ce.element!==gt.element||ce.errorElement!==gt.errorElement||ce.hydrateFallbackElement!==gt.hydrateFallbackElement?{...dt,route:gt}:dt})),M={...M,...se};let je=[],We=[];M.fetchers.forEach((dt,gt)=>{dt.state==="idle"&&(G.has(gt)?je.push(gt):We.push(gt))}),G.forEach(dt=>{!M.fetchers.has(dt)&&!D.has(dt)&&je.push(dt)}),[...v].forEach(dt=>dt(M,{deletedFetchers:je,viewTransitionOpts:be.viewTransitionOpts,flushSync:be.flushSync===!0})),je.forEach(dt=>Se(dt)),We.forEach(dt=>M.fetchers.delete(dt))}function we(se,be,{flushSync:je}={}){let We=M.actionData!=null&&M.navigation.formMethod!=null&&Aa(M.navigation.formMethod)&&M.navigation.state==="loading"&&se.state?._isRedirect!==!0,dt;be.actionData?Object.keys(be.actionData).length>0?dt=be.actionData:dt=null:We?dt=M.actionData:dt=null;let gt=be.loaderData?v0(M.loaderData,be.loaderData,be.matches||[],be.errors):M.loaderData,ce=M.blockers;ce.size>0&&(ce=new Map(ce),ce.forEach((Ke,ot)=>ce.set(ot,wi)));let re=V?!1:Ft(se,be.matches||M.matches),Ne=z===!0||M.navigation.formMethod!=null&&Aa(M.navigation.formMethod)&&se.state?._isRedirect!==!0;m&&(f=m,m=void 0),V||A==="POP"||(A==="PUSH"?e.history.push(se,se.state):A==="REPLACE"&&e.history.replace(se,se.state));let Be;if(A==="POP"){let Ke=H.get(M.location.pathname);Ke&&Ke.has(se.pathname)?Be={currentLocation:M.location,nextLocation:se}:H.has(se.pathname)&&(Be={currentLocation:se,nextLocation:M.location})}else if(X){let Ke=H.get(M.location.pathname);Ke?Ke.add(se.pathname):(Ke=new Set([se.pathname]),H.set(M.location.pathname,Ke)),Be={currentLocation:M.location,nextLocation:se}}ne({...be,actionData:dt,loaderData:gt,historyAction:A,location:se,initialized:!0,navigation:Rh,revalidation:"idle",restoreScrollPosition:re,preventScrollReset:Ne,blockers:ce},{viewTransitionOpts:Be,flushSync:je===!0}),A="POP",z=!1,X=!1,V=!1,I=!1,Z?.resolve(),Z=null}async function ke(se,be){if(typeof se=="number"){e.history.go(se);return}let je=Dp(M.location,M.matches,h,se,be?.fromRouteId,be?.relative),{path:We,submission:dt,error:gt}=u0(!1,je,be),ce=M.location,re=ac(M.location,We,be&&be.state);re={...re,...e.history.encodeLocation(re)};let Ne=be&&be.replace!=null?be.replace:void 0,Be="PUSH";Ne===!0?Be="REPLACE":Ne===!1||dt!=null&&Aa(dt.formMethod)&&dt.formAction===M.location.pathname+M.location.search&&(Be="REPLACE");let Ke=be&&"preventScrollReset"in be?be.preventScrollReset===!0:void 0,ot=(be&&be.flushSync)===!0,ze=Rt({currentLocation:ce,nextLocation:re,historyAction:Be});if(ze){zt(ze,{state:"blocked",location:re,proceed(){zt(ze,{state:"proceeding",proceed:void 0,reset:void 0,location:re}),ke(se,be)},reset(){let ue=new Map(M.blockers);ue.set(ze,wi),ne({blockers:ue})}});return}await Te(Be,re,{submission:dt,pendingError:gt,preventScrollReset:Ke,replace:be&&be.replace,enableViewTransition:be&&be.viewTransition,flushSync:ot})}function Re(){Z||(Z=LA()),W(),ne({revalidation:"loading"});let se=Z.promise;return M.navigation.state==="submitting"?se:M.navigation.state==="idle"?(Te(M.historyAction,M.location,{startUninterruptedRevalidation:!0}),se):(Te(A||M.historyAction,M.navigation.location,{overrideNavigation:M.navigation,enableViewTransition:X===!0}),se)}async function Te(se,be,je){P&&P.abort(),P=null,A=se,V=(je&&je.startUninterruptedRevalidation)===!0,Mt(M.location,M.matches),z=(je&&je.preventScrollReset)===!0,X=(je&&je.enableViewTransition)===!0;let We=m||f,dt=je&&je.overrideNavigation,gt=je?.initialHydration&&M.matches&&M.matches.length>0&&!C?M.matches:Fr(We,be,h),ce=(je&&je.flushSync)===!0;if(gt&&M.initialized&&!I&&_A(M.location,be)&&!(je&&je.submission&&Aa(je.submission.formMethod))){we(be,{matches:gt},{flushSync:ce});return}let re=kt(gt,We,be.pathname);if(re.active&&re.matches&&(gt=re.matches),!gt){let{error:Ge,notFoundMatches:ut,route:ae}=pt(be.pathname);we(be,{matches:ut,loaderData:{},errors:{[ae.id]:Ge}},{flushSync:ce});return}P=new AbortController;let Ne=wl(e.history,be,P.signal,je&&je.submission),Be=e.getContext?await e.getContext():new o0,Ke;if(je&&je.pendingError)Ke=[Ur(gt).route.id,{type:"error",error:je.pendingError}];else if(je&&je.submission&&Aa(je.submission.formMethod)){let Ge=await rt(Ne,be,je.submission,gt,Be,re.active,je&&je.initialHydration===!0,{replace:je.replace,flushSync:ce});if(Ge.shortCircuited)return;if(Ge.pendingActionResult){let[ut,ae]=Ge.pendingActionResult;if(qa(ae)&&rc(ae.error)&&ae.error.status===404){P=null,we(be,{matches:Ge.matches,loaderData:{},errors:{[ut]:ae.error}});return}}gt=Ge.matches||gt,Ke=Ge.pendingActionResult,dt=kh(be,je.submission),ce=!1,re.active=!1,Ne=wl(e.history,Ne.url,Ne.signal)}let{shortCircuited:ot,matches:ze,loaderData:ue,errors:qe}=await He(Ne,be,gt,Be,re.active,dt,je&&je.submission,je&&je.fetcherSubmission,je&&je.replace,je&&je.initialHydration===!0,ce,Ke);ot||(P=null,we(be,{matches:ze||gt,...x0(Ke),loaderData:ue,errors:qe}))}async function rt(se,be,je,We,dt,gt,ce,re={}){W();let Ne=RA(be,je);if(ne({navigation:Ne},{flushSync:re.flushSync===!0}),gt){let ot=await Zt(We,be.pathname,se.signal);if(ot.type==="aborted")return{shortCircuited:!0};if(ot.type==="error"){if(ot.partialMatches.length===0){let{matches:ue,route:qe}=Ou(f);return{matches:ue,pendingActionResult:[qe.id,{type:"error",error:ot.error}]}}let ze=Ur(ot.partialMatches).route.id;return{matches:ot.partialMatches,pendingActionResult:[ze,{type:"error",error:ot.error}]}}else if(ot.matches)We=ot.matches;else{let{notFoundMatches:ze,error:ue,route:qe}=pt(be.pathname);return{matches:ze,pendingActionResult:[qe.id,{type:"error",error:ue}]}}}let Be,Ke=md(We,be);if(!Ke.route.action&&!Ke.route.lazy)Be={type:"error",error:ss(405,{method:se.method,pathname:be.pathname,routeId:Ke.route.id})};else{let ot=El(l,c,se,We,Ke,ce?[]:i,dt),ze=await Pe(se,ot,dt,null);if(Be=ze[Ke.route.id],!Be){for(let ue of We)if(ze[ue.route.id]){Be=ze[ue.route.id];break}}if(se.signal.aborted)return{shortCircuited:!0}}if(Ei(Be)){let ot;return re&&re.replace!=null?ot=re.replace:ot=y0(Be.response.headers.get("Location"),new URL(se.url),h)===M.location.pathname+M.location.search,await _t(se,Be,!0,{submission:je,replace:ot}),{shortCircuited:!0}}if(qa(Be)){let ot=Ur(We,Ke.route.id);return(re&&re.replace)!==!0&&(A="PUSH"),{matches:We,pendingActionResult:[ot.route.id,Be,Ke.route.id]}}return{matches:We,pendingActionResult:[Ke.route.id,Be]}}async function He(se,be,je,We,dt,gt,ce,re,Ne,Be,Ke,ot){let ze=gt||kh(be,ce),ue=ce||re||w0(ze),qe=!V&&!Be;if(dt){if(qe){let Ve=tt(ot);ne({navigation:ze,...Ve!==void 0?{actionData:Ve}:{}},{flushSync:Ke})}let he=await Zt(je,be.pathname,se.signal);if(he.type==="aborted")return{shortCircuited:!0};if(he.type==="error"){if(he.partialMatches.length===0){let{matches:xt,route:Nt}=Ou(f);return{matches:xt,loaderData:{},errors:{[Nt.id]:he.error}}}let Ve=Ur(he.partialMatches).route.id;return{matches:he.partialMatches,loaderData:{},errors:{[Ve]:he.error}}}else if(he.matches)je=he.matches;else{let{error:Ve,notFoundMatches:xt,route:Nt}=pt(be.pathname);return{matches:xt,loaderData:{},errors:{[Nt.id]:Ve}}}}let Ge=m||f,{dsMatches:ut,revalidatingFetchers:ae}=d0(se,We,l,c,e.history,M,je,ue,be,Be?[]:i,Be===!0,I,F,G,R,B,Ge,h,e.patchRoutesOnNavigation!=null,ot);if(U=++L,!e.dataStrategy&&!ut.some(he=>he.shouldLoad)&&!ut.some(he=>he.route.middleware&&he.route.middleware.length>0)&&ae.length===0){let he=st();return we(be,{matches:je,loaderData:{},errors:ot&&qa(ot[1])?{[ot[0]]:ot[1].error}:null,...x0(ot),...he?{fetchers:new Map(M.fetchers)}:{}},{flushSync:Ke}),{shortCircuited:!0}}if(qe){let he={};if(!dt){he.navigation=ze;let Ve=tt(ot);Ve!==void 0&&(he.actionData=Ve)}ae.length>0&&(he.fetchers=Ie(ae)),ne(he,{flushSync:Ke})}ae.forEach(he=>{ge(he.key),he.controller&&D.set(he.key,he.controller)});let Xe=()=>ae.forEach(he=>ge(he.key));P&&P.signal.addEventListener("abort",Xe);let{loaderResults:Fe,fetcherResults:Qe}=await Ze(ut,ae,se,We);if(se.signal.aborted)return{shortCircuited:!0};P&&P.signal.removeEventListener("abort",Xe),ae.forEach(he=>D.delete(he.key));let bt=zu(Fe);if(bt)return await _t(se,bt.result,!0,{replace:Ne}),{shortCircuited:!0};if(bt=zu(Qe),bt)return B.add(bt.key),await _t(se,bt.result,!0,{replace:Ne}),{shortCircuited:!0};let{loaderData:St,errors:_e}=b0(M,je,Fe,ot,ae,Qe);Be&&M.errors&&(_e={...M.errors,..._e});let et=st(),mt=nt(U),fe=et||mt||ae.length>0;return{matches:je,loaderData:St,errors:_e,...fe?{fetchers:new Map(M.fetchers)}:{}}}function tt(se){if(se&&!qa(se[1]))return{[se[0]]:se[1].data};if(M.actionData)return Object.keys(M.actionData).length===0?null:M.actionData}function Ie(se){return se.forEach(be=>{let je=M.fetchers.get(be.key),We=Mo(void 0,je?je.data:void 0);M.fetchers.set(be.key,We)}),new Map(M.fetchers)}async function vt(se,be,je,We){ge(se);let dt=(We&&We.flushSync)===!0,gt=m||f,ce=Dp(M.location,M.matches,h,je,be,We?.relative),re=Fr(gt,ce,h),Ne=kt(re,gt,ce);if(Ne.active&&Ne.matches&&(re=Ne.matches),!re){te(se,be,ss(404,{pathname:ce}),{flushSync:dt});return}let{path:Be,submission:Ke,error:ot}=u0(!0,ce,We);if(ot){te(se,be,ot,{flushSync:dt});return}let ze=e.getContext?await e.getContext():new o0,ue=(We&&We.preventScrollReset)===!0;if(Ke&&Aa(Ke.formMethod)){await Ct(se,be,Be,re,ze,Ne.active,dt,ue,Ke);return}R.set(se,{routeId:be,path:Be}),await At(se,be,Be,re,ze,Ne.active,dt,ue,Ke)}async function Ct(se,be,je,We,dt,gt,ce,re,Ne){W(),R.delete(se);let Be=M.fetchers.get(se);ee(se,kA(Ne,Be),{flushSync:ce});let Ke=new AbortController,ot=wl(e.history,je,Ke.signal,Ne);if(gt){let Et=await Zt(We,new URL(ot.url).pathname,ot.signal,se);if(Et.type==="aborted")return;if(Et.type==="error"){te(se,be,Et.error,{flushSync:ce});return}else if(Et.matches)We=Et.matches;else{te(se,be,ss(404,{pathname:je}),{flushSync:ce});return}}let ze=md(We,je);if(!ze.route.action&&!ze.route.lazy){let Et=ss(405,{method:Ne.formMethod,pathname:je,routeId:be});te(se,be,Et,{flushSync:ce});return}D.set(se,Ke);let ue=L,qe=El(l,c,ot,We,ze,i,dt),ut=(await Pe(ot,qe,dt,se))[ze.route.id];if(ot.signal.aborted){D.get(se)===Ke&&D.delete(se);return}if(G.has(se)){if(Ei(ut)||qa(ut)){ee(se,er(void 0));return}}else{if(Ei(ut))if(D.delete(se),U>ue){ee(se,er(void 0));return}else return B.add(se),ee(se,Mo(Ne)),_t(ot,ut,!1,{fetcherSubmission:Ne,preventScrollReset:re});if(qa(ut)){te(se,be,ut.error);return}}let ae=M.navigation.location||M.location,Xe=wl(e.history,ae,Ke.signal),Fe=m||f,Qe=M.navigation.state!=="idle"?Fr(Fe,M.navigation.location,h):M.matches;sn(Qe,"Didn't find any matches after fetcher action");let bt=++L;k.set(se,bt);let St=Mo(Ne,ut.data);M.fetchers.set(se,St);let{dsMatches:_e,revalidatingFetchers:et}=d0(Xe,dt,l,c,e.history,M,Qe,Ne,ae,i,!1,I,F,G,R,B,Fe,h,e.patchRoutesOnNavigation!=null,[ze.route.id,ut]);et.filter(Et=>Et.key!==se).forEach(Et=>{let jt=Et.key,Wt=M.fetchers.get(jt),ln=Mo(void 0,Wt?Wt.data:void 0);M.fetchers.set(jt,ln),ge(jt),Et.controller&&D.set(jt,Et.controller)}),ne({fetchers:new Map(M.fetchers)});let mt=()=>et.forEach(Et=>ge(Et.key));Ke.signal.addEventListener("abort",mt);let{loaderResults:fe,fetcherResults:he}=await Ze(_e,et,Xe,dt);if(Ke.signal.aborted)return;if(Ke.signal.removeEventListener("abort",mt),k.delete(se),D.delete(se),et.forEach(Et=>D.delete(Et.key)),M.fetchers.has(se)){let Et=er(ut.data);M.fetchers.set(se,Et)}let Ve=zu(fe);if(Ve)return _t(Xe,Ve.result,!1,{preventScrollReset:re});if(Ve=zu(he),Ve)return B.add(Ve.key),_t(Xe,Ve.result,!1,{preventScrollReset:re});let{loaderData:xt,errors:Nt}=b0(M,Qe,fe,void 0,et,he);nt(bt),M.navigation.state==="loading"&&bt>U?(sn(A,"Expected pending action"),P&&P.abort(),we(M.navigation.location,{matches:Qe,loaderData:xt,errors:Nt,fetchers:new Map(M.fetchers)})):(ne({errors:Nt,loaderData:v0(M.loaderData,xt,Qe,Nt),fetchers:new Map(M.fetchers)}),I=!1)}async function At(se,be,je,We,dt,gt,ce,re,Ne){let Be=M.fetchers.get(se);ee(se,Mo(Ne,Be?Be.data:void 0),{flushSync:ce});let Ke=new AbortController,ot=wl(e.history,je,Ke.signal);if(gt){let ae=await Zt(We,new URL(ot.url).pathname,ot.signal,se);if(ae.type==="aborted")return;if(ae.type==="error"){te(se,be,ae.error,{flushSync:ce});return}else if(ae.matches)We=ae.matches;else{te(se,be,ss(404,{pathname:je}),{flushSync:ce});return}}let ze=md(We,je);D.set(se,Ke);let ue=L,qe=El(l,c,ot,We,ze,i,dt),ut=(await Pe(ot,qe,dt,se))[ze.route.id];if(D.get(se)===Ke&&D.delete(se),!ot.signal.aborted){if(G.has(se)){ee(se,er(void 0));return}if(Ei(ut))if(U>ue){ee(se,er(void 0));return}else{B.add(se),await _t(ot,ut,!1,{preventScrollReset:re});return}if(qa(ut)){te(se,be,ut.error);return}ee(se,er(ut.data))}}async function _t(se,be,je,{submission:We,fetcherSubmission:dt,preventScrollReset:gt,replace:ce}={}){be.response.headers.has("X-Remix-Revalidate")&&(I=!0);let re=be.response.headers.get("Location");sn(re,"Expected a Location header on the redirect Response"),re=y0(re,new URL(se.url),h);let Ne=ac(M.location,re,{_isRedirect:!0});if(r){let qe=!1;if(be.response.headers.has("X-Remix-Reload-Document"))qe=!0;else if(wy(re)){const Ge=qw(re,!0);qe=Ge.origin!==t.location.origin||Ra(Ge.pathname,h)==null}if(qe){ce?t.location.replace(re):t.location.assign(re);return}}P=null;let Be=ce===!0||be.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:Ke,formAction:ot,formEncType:ze}=M.navigation;!We&&!dt&&Ke&&ot&&ze&&(We=w0(M.navigation));let ue=We||dt;if(cA.has(be.response.status)&&ue&&Aa(ue.formMethod))await Te(Be,Ne,{submission:{...ue,formAction:re},preventScrollReset:gt||z,enableViewTransition:je?X:void 0});else{let qe=kh(Ne,We);await Te(Be,Ne,{overrideNavigation:qe,fetcherSubmission:dt,preventScrollReset:gt||z,enableViewTransition:je?X:void 0})}}async function Pe(se,be,je,We){let dt,gt={};try{dt=await xA(p,se,be,We,je,!1)}catch(ce){return be.filter(re=>re.shouldLoad).forEach(re=>{gt[re.route.id]={type:"error",error:ce}}),gt}if(se.signal.aborted)return gt;for(let[ce,re]of Object.entries(dt))if(TA(re)){let Ne=re.result;gt[ce]={type:"redirect",response:EA(Ne,se,ce,be,h)}}else gt[ce]=await NA(re);return gt}async function Ze(se,be,je,We){let dt=Pe(je,se,We,null),gt=Promise.all(be.map(async Ne=>{if(Ne.matches&&Ne.match&&Ne.request&&Ne.controller){let Ke=(await Pe(Ne.request,Ne.matches,We,Ne.key))[Ne.match.route.id];return{[Ne.key]:Ke}}else return Promise.resolve({[Ne.key]:{type:"error",error:ss(404,{pathname:Ne.path})}})})),ce=await dt,re=(await gt).reduce((Ne,Be)=>Object.assign(Ne,Be),{});return{loaderResults:ce,fetcherResults:re}}function W(){I=!0,R.forEach((se,be)=>{D.has(be)&&F.add(be),ge(be)})}function ee(se,be,je={}){M.fetchers.set(se,be),ne({fetchers:new Map(M.fetchers)},{flushSync:(je&&je.flushSync)===!0})}function te(se,be,je,We={}){let dt=Ur(M.matches,be);Se(se),ne({errors:{[dt.route.id]:je},fetchers:new Map(M.fetchers)},{flushSync:(We&&We.flushSync)===!0})}function ve(se){return q.set(se,(q.get(se)||0)+1),G.has(se)&&G.delete(se),M.fetchers.get(se)||uA}function le(se,be){ge(se,be?.reason),ee(se,er(null))}function Se(se){let be=M.fetchers.get(se);D.has(se)&&!(be&&be.state==="loading"&&k.has(se))&&ge(se),R.delete(se),k.delete(se),B.delete(se),G.delete(se),F.delete(se),M.fetchers.delete(se)}function Ee(se){let be=(q.get(se)||0)-1;be<=0?(q.delete(se),G.add(se)):q.set(se,be),ne({fetchers:new Map(M.fetchers)})}function ge(se,be){let je=D.get(se);je&&(je.abort(be),D.delete(se))}function at(se){for(let be of se){let je=ve(be),We=er(je.data);M.fetchers.set(be,We)}}function st(){let se=[],be=!1;for(let je of B){let We=M.fetchers.get(je);sn(We,`Expected fetcher: ${je}`),We.state==="loading"&&(B.delete(je),se.push(je),be=!0)}return at(se),be}function nt(se){let be=[];for(let[je,We]of k)if(We<se){let dt=M.fetchers.get(je);sn(dt,`Expected fetcher: ${je}`),dt.state==="loading"&&(ge(je),k.delete(je),be.push(je))}return at(be),be.length>0}function $e(se,be){let je=M.blockers.get(se)||wi;return J.get(se)!==be&&J.set(se,be),je}function ft(se){M.blockers.delete(se),J.delete(se)}function zt(se,be){let je=M.blockers.get(se)||wi;sn(je.state==="unblocked"&&be.state==="blocked"||je.state==="blocked"&&be.state==="blocked"||je.state==="blocked"&&be.state==="proceeding"||je.state==="blocked"&&be.state==="unblocked"||je.state==="proceeding"&&be.state==="unblocked",`Invalid blocker state transition: ${je.state} -> ${be.state}`);let We=new Map(M.blockers);We.set(se,be),ne({blockers:We})}function Rt({currentLocation:se,nextLocation:be,historyAction:je}){if(J.size===0)return;J.size>1&&Gn(!1,"A router only supports one blocker at a time");let We=Array.from(J.entries()),[dt,gt]=We[We.length-1],ce=M.blockers.get(dt);if(!(ce&&ce.state==="proceeding")&&gt({currentLocation:se,nextLocation:be,historyAction:je}))return dt}function pt(se){let be=ss(404,{pathname:se}),je=m||f,{matches:We,route:dt}=Ou(je);return{notFoundMatches:We,route:dt,error:be}}function ct(se,be,je){if(S=se,N=be,w=je||null,!j&&M.navigation===Rh){j=!0;let We=Ft(M.location,M.matches);We!=null&&ne({restoreScrollPosition:We})}return()=>{S=null,N=null,w=null}}function yt(se,be){return w&&w(se,be.map(We=>UC(We,M.loaderData)))||se.key}function Mt(se,be){if(S&&N){let je=yt(se,be);S[je]=N()}}function Ft(se,be){if(S){let je=yt(se,be),We=S[je];if(typeof We=="number")return We}return null}function kt(se,be,je){if(e.patchRoutesOnNavigation)if(se){if(Object.keys(se[0].params).length>0)return{active:!0,matches:fd(be,je,h,!0)}}else return{active:!0,matches:fd(be,je,h,!0)||[]};return{active:!1,matches:null}}async function Zt(se,be,je,We){if(!e.patchRoutesOnNavigation)return{type:"success",matches:se};let dt=se;for(;;){let gt=m==null,ce=m||f,re=c;try{await e.patchRoutesOnNavigation({signal:je,path:be,matches:dt,fetcherKey:We,patch:(Ke,ot)=>{je.aborted||f0(Ke,ot,ce,re,l,!1)}})}catch(Ke){return{type:"error",error:Ke,partialMatches:dt}}finally{gt&&!je.aborted&&(f=[...f])}if(je.aborted)return{type:"aborted"};let Ne=Fr(ce,be,h);if(Ne)return{type:"success",matches:Ne};let Be=fd(ce,be,h,!0);if(!Be||dt.length===Be.length&&dt.every((Ke,ot)=>Ke.route.id===Be[ot].route.id))return{type:"success",matches:null};dt=Be}}function Lt(se){c={},m=sc(se,l,void 0,c)}function Kt(se,be,je=!1){let We=m==null;f0(se,be,m||f,c,l,je),We&&(f=[...f],ne({}))}return T={get basename(){return h},get future(){return y},get state(){return M},get routes(){return f},get window(){return t},initialize:me,subscribe:oe,enableScrollRestoration:ct,navigate:ke,fetch:vt,revalidate:Re,createHref:se=>e.history.createHref(se),encodeLocation:se=>e.history.encodeLocation(se),getFetcher:ve,resetFetcher:le,deleteFetcher:Ee,dispose:Q,getBlocker:$e,deleteBlocker:ft,patchRoutes:Kt,_internalFetchControllers:D,_internalSetRoutes:Lt,_internalSetStateDoNotUseOrYouWillBreakYourApp(se){ne(se)}},T}function hA(e){return e!=null&&("formData"in e&&e.formData!=null||"body"in e&&e.body!==void 0)}function Dp(e,t,r,i,l,c){let f,m;if(l){f=[];for(let p of t)if(f.push(p),p.route.id===l){m=p;break}}else f=t,m=t[t.length-1];let h=Gd(i||".",Yd(f),Ra(e.pathname,r)||e.pathname,c==="path");if(i==null&&(h.search=e.search,h.hash=e.hash),(i==null||i===""||i===".")&&m){let p=Ey(h.search);if(m.route.index&&!p)h.search=h.search?h.search.replace(/^\?/,"?index&"):"?index";else if(!m.route.index&&p){let y=new URLSearchParams(h.search),g=y.getAll("index");y.delete("index"),g.filter(S=>S).forEach(S=>y.append("index",S));let v=y.toString();h.search=v?`?${v}`:""}}return r!=="/"&&(h.pathname=JC({basename:r,pathname:h.pathname})),Vr(h)}function u0(e,t,r){if(!r||!hA(r))return{path:t};if(r.formMethod&&!MA(r.formMethod))return{path:t,error:ss(405,{method:r.formMethod})};let i=()=>({path:t,error:ss(400,{type:"invalid-body"})}),c=(r.formMethod||"get").toUpperCase(),f=e1(t);if(r.body!==void 0){if(r.formEncType==="text/plain"){if(!Aa(c))return i();let g=typeof r.body=="string"?r.body:r.body instanceof FormData||r.body instanceof URLSearchParams?Array.from(r.body.entries()).reduce((v,[S,w])=>`${v}${S}=${w}
`,""):String(r.body);return{path:t,submission:{formMethod:c,formAction:f,formEncType:r.formEncType,formData:void 0,json:void 0,text:g}}}else if(r.formEncType==="application/json"){if(!Aa(c))return i();try{let g=typeof r.body=="string"?JSON.parse(r.body):r.body;return{path:t,submission:{formMethod:c,formAction:f,formEncType:r.formEncType,formData:void 0,json:g,text:void 0}}}catch{return i()}}}sn(typeof FormData=="function","FormData is not available in this environment");let m,h;if(r.formData)m=Op(r.formData),h=r.formData;else if(r.body instanceof FormData)m=Op(r.body),h=r.body;else if(r.body instanceof URLSearchParams)m=r.body,h=g0(m);else if(r.body==null)m=new URLSearchParams,h=new FormData;else try{m=new URLSearchParams(r.body),h=g0(m)}catch{return i()}let p={formMethod:c,formAction:f,formEncType:r&&r.formEncType||"application/x-www-form-urlencoded",formData:h,json:void 0,text:void 0};if(Aa(p.formMethod))return{path:t,submission:p};let y=Wr(t);return e&&y.search&&Ey(y.search)&&m.append("index",""),y.search=`?${m}`,{path:Vr(y),submission:p}}function d0(e,t,r,i,l,c,f,m,h,p,y,g,v,S,w,N,j,_,C,O){let E=O?qa(O[1])?O[1].error:O[1].data:void 0,T=l.createURL(c.location),M=l.createURL(h),A;if(y&&c.errors){let V=Object.keys(c.errors)[0];A=f.findIndex(I=>I.route.id===V)}else if(O&&qa(O[1])){let V=O[0];A=f.findIndex(I=>I.route.id===V)-1}let z=O?O[1].statusCode:void 0,P=z&&z>=400,X={currentUrl:T,currentParams:c.matches[0]?.params||{},nextUrl:M,nextParams:f[0].params,...m,actionResult:E,actionStatus:z},H=f.map((V,I)=>{let{route:F}=V,D=null;if(A!=null&&I>A?D=!1:F.lazy?D=!0:Ny(F)?y?D=Ip(F,c.loaderData,c.errors):pA(c.loaderData,c.matches[I],V)&&(D=!0):D=!1,D!==null)return Lp(r,i,e,V,p,t,D);let L=P?!1:g||T.pathname+T.search===M.pathname+M.search||T.search!==M.search||yA(c.matches[I],V),U={...X,defaultShouldRevalidate:L},k=Ad(V,U);return Lp(r,i,e,V,p,t,k,U)}),Y=[];return w.forEach((V,I)=>{if(y||!f.some(q=>q.route.id===V.routeId)||S.has(I))return;let F=c.fetchers.get(I),D=F&&F.state!=="idle"&&F.data===void 0,L=Fr(j,V.path,_);if(!L){if(C&&D)return;Y.push({key:I,routeId:V.routeId,path:V.path,matches:null,match:null,request:null,controller:null});return}if(N.has(I))return;let U=md(L,V.path),k=new AbortController,B=wl(l,V.path,k.signal),R=null;if(v.has(I))v.delete(I),R=El(r,i,B,L,U,p,t);else if(D)g&&(R=El(r,i,B,L,U,p,t));else{let q={...X,defaultShouldRevalidate:P?!1:g};Ad(U,q)&&(R=El(r,i,B,L,U,p,t,q))}R&&Y.push({key:I,routeId:V.routeId,path:V.path,matches:R,match:U,request:B,controller:k})}),{dsMatches:H,revalidatingFetchers:Y}}function Ny(e){return e.loader!=null||e.middleware!=null&&e.middleware.length>0}function Ip(e,t,r){if(e.lazy)return!0;if(!Ny(e))return!1;let i=t!=null&&e.id in t,l=r!=null&&r[e.id]!==void 0;return!i&&l?!1:typeof e.loader=="function"&&e.loader.hydrate===!0?!0:!i&&!l}function pA(e,t,r){let i=!t||r.route.id!==t.route.id,l=!e.hasOwnProperty(r.route.id);return i||l}function yA(e,t){let r=e.route.path;return e.pathname!==t.pathname||r!=null&&r.endsWith("*")&&e.params["*"]!==t.params["*"]}function Ad(e,t){if(e.route.shouldRevalidate){let r=e.route.shouldRevalidate(t);if(typeof r=="boolean")return r}return t.defaultShouldRevalidate}function f0(e,t,r,i,l,c){let f;if(e){let p=i[e];sn(p,`No route found to patch children into: routeId = ${e}`),p.children||(p.children=[]),f=p.children}else f=r;let m=[],h=[];if(t.forEach(p=>{let y=f.find(g=>Kw(p,g));y?h.push({existingRoute:y,newRoute:p}):m.push(p)}),m.length>0){let p=sc(m,l,[e||"_","patch",String(f?.length||"0")],i);f.push(...p)}if(c&&h.length>0)for(let p=0;p<h.length;p++){let{existingRoute:y,newRoute:g}=h[p],v=y,[S]=sc([g],l,[],{},!0);Object.assign(v,{element:S.element?S.element:v.element,errorElement:S.errorElement?S.errorElement:v.errorElement,hydrateFallbackElement:S.hydrateFallbackElement?S.hydrateFallbackElement:v.hydrateFallbackElement})}}function Kw(e,t){return"id"in e&&"id"in t&&e.id===t.id?!0:e.index===t.index&&e.path===t.path&&e.caseSensitive===t.caseSensitive?(!e.children||e.children.length===0)&&(!t.children||t.children.length===0)?!0:e.children.every((r,i)=>t.children?.some(l=>Kw(r,l))):!1}var m0=new WeakMap,Ww=({key:e,route:t,manifest:r,mapRouteProperties:i})=>{let l=r[t.id];if(sn(l,"No route found in manifest"),!l.lazy||typeof l.lazy!="object")return;let c=l.lazy[e];if(!c)return;let f=m0.get(l);f||(f={},m0.set(l,f));let m=f[e];if(m)return m;let h=(async()=>{let p=OC(e),g=l[e]!==void 0&&e!=="hasErrorBoundary";if(p)Gn(!p,"Route property "+e+" is not a supported lazy route property. This property will be ignored."),f[e]=Promise.resolve();else if(g)Gn(!1,`Route "${l.id}" has a static property "${e}" defined. The lazy property will be ignored.`);else{let v=await c();v!=null&&(Object.assign(l,{[e]:v}),Object.assign(l,i(l)))}typeof l.lazy=="object"&&(l.lazy[e]=void 0,Object.values(l.lazy).every(v=>v===void 0)&&(l.lazy=void 0))})();return f[e]=h,h},h0=new WeakMap;function gA(e,t,r,i,l){let c=r[e.id];if(sn(c,"No route found in manifest"),!e.lazy)return{lazyRoutePromise:void 0,lazyHandlerPromise:void 0};if(typeof e.lazy=="function"){let y=h0.get(c);if(y)return{lazyRoutePromise:y,lazyHandlerPromise:y};let g=(async()=>{sn(typeof e.lazy=="function","No lazy route function found");let v=await e.lazy(),S={};for(let w in v){let N=v[w];if(N===void 0)continue;let j=$C(w),C=c[w]!==void 0&&w!=="hasErrorBoundary";j?Gn(!j,"Route property "+w+" is not a supported property to be returned from a lazy route function. This property will be ignored."):C?Gn(!C,`Route "${c.id}" has a static property "${w}" defined but its lazy function is also returning a value for this property. The lazy route property "${w}" will be ignored.`):S[w]=N}Object.assign(c,S),Object.assign(c,{...i(c),lazy:void 0})})();return h0.set(c,g),g.catch(()=>{}),{lazyRoutePromise:g,lazyHandlerPromise:g}}let f=Object.keys(e.lazy),m=[],h;for(let y of f){if(l&&l.includes(y))continue;let g=Ww({key:y,route:e,manifest:r,mapRouteProperties:i});g&&(m.push(g),y===t&&(h=g))}let p=m.length>0?Promise.all(m).then(()=>{}):void 0;return p?.catch(()=>{}),h?.catch(()=>{}),{lazyRoutePromise:p,lazyHandlerPromise:h}}async function p0(e){let t=e.matches.filter(l=>l.shouldLoad),r={};return(await Promise.all(t.map(l=>l.resolve()))).forEach((l,c)=>{r[t[c].route.id]=l}),r}async function bA(e){return e.matches.some(t=>t.route.middleware)?Zw(e,()=>p0(e)):p0(e)}function Zw(e,t){return vA(e,t,i=>i,CA,r);function r(i,l,c){if(c)return Promise.resolve(Object.assign(c.value,{[l]:{type:"error",result:i}}));{let{matches:f}=e,m=Math.min(Math.max(f.findIndex(p=>p.route.id===l),0),Math.max(f.findIndex(p=>p.unstable_shouldCallHandler()),0)),h=Ur(f,f[m].route.id).route.id;return Promise.resolve({[h]:{type:"error",result:i}})}}}async function vA(e,t,r,i,l){let{matches:c,request:f,params:m,context:h}=e,p=c.flatMap(g=>g.route.middleware?g.route.middleware.map(v=>[g.route.id,v]):[]);return await Qw({request:f,params:m,context:h},p,t,r,i,l)}async function Qw(e,t,r,i,l,c,f=0){let{request:m}=e;if(m.signal.aborted)throw m.signal.reason??new Error(`Request aborted: ${m.method} ${m.url}`);let h=t[f];if(!h)return await r();let[p,y]=h,g,v=async()=>{if(g)throw new Error("You may only call `next()` once per middleware");try{return g={value:await Qw(e,t,r,i,l,c,f+1)},g.value}catch(S){return g={value:await c(S,p,g)},g.value}};try{let S=await y(e,v),w=S!=null?i(S):void 0;return l(w)?w:g?w??g.value:(g={value:await v()},g.value)}catch(S){return await c(S,p,g)}}function Jw(e,t,r,i,l){let c=Ww({key:"middleware",route:i.route,manifest:t,mapRouteProperties:e}),f=gA(i.route,Aa(r.method)?"action":"loader",t,e,l);return{middleware:c,route:f.lazyRoutePromise,handler:f.lazyHandlerPromise}}function Lp(e,t,r,i,l,c,f,m=null){let h=!1,p=Jw(e,t,r,i,l);return{...i,_lazyPromises:p,shouldLoad:f,unstable_shouldRevalidateArgs:m,unstable_shouldCallHandler(y){return h=!0,m?typeof y=="boolean"?Ad(i,{...m,defaultShouldRevalidate:y}):Ad(i,m):f},resolve(y){let{lazy:g,loader:v,middleware:S}=i.route,w=h||f||y&&!Aa(r.method)&&(g||v),N=S&&S.length>0&&!v&&!g;return w&&!N?SA({request:r,match:i,lazyHandlerPromise:p?.handler,lazyRoutePromise:p?.route,handlerOverride:y,scopedContext:c}):Promise.resolve({type:"data",result:void 0})}}}function El(e,t,r,i,l,c,f,m=null){return i.map(h=>h.route.id!==l.route.id?{...h,shouldLoad:!1,unstable_shouldRevalidateArgs:m,unstable_shouldCallHandler:()=>!1,_lazyPromises:Jw(e,t,r,h,c),resolve:()=>Promise.resolve({type:"data",result:void 0})}:Lp(e,t,r,h,c,f,!0,m))}async function xA(e,t,r,i,l,c){r.some(p=>p._lazyPromises?.middleware)&&await Promise.all(r.map(p=>p._lazyPromises?.middleware));let f={request:t,params:r[0].params,context:l,matches:r},h=await e({...f,fetcherKey:i,runClientMiddleware:p=>{let y=f;return Zw(y,()=>p({...y,fetcherKey:i,runClientMiddleware:()=>{throw new Error("Cannot call `runClientMiddleware()` from within an `runClientMiddleware` handler")}}))}});try{await Promise.all(r.flatMap(p=>[p._lazyPromises?.handler,p._lazyPromises?.route]))}catch{}return h}async function SA({request:e,match:t,lazyHandlerPromise:r,lazyRoutePromise:i,handlerOverride:l,scopedContext:c}){let f,m,h=Aa(e.method),p=h?"action":"loader",y=g=>{let v,S=new Promise((j,_)=>v=_);m=()=>v(),e.signal.addEventListener("abort",m);let w=j=>typeof g!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${p}" [routeId: ${t.route.id}]`)):g({request:e,params:t.params,context:c},...j!==void 0?[j]:[]),N=(async()=>{try{return{type:"data",result:await(l?l(_=>w(_)):w())}}catch(j){return{type:"error",result:j}}})();return Promise.race([N,S])};try{let g=h?t.route.action:t.route.loader;if(r||i)if(g){let v,[S]=await Promise.all([y(g).catch(w=>{v=w}),r,i]);if(v!==void 0)throw v;f=S}else{await r;let v=h?t.route.action:t.route.loader;if(v)[f]=await Promise.all([y(v),i]);else if(p==="action"){let S=new URL(e.url),w=S.pathname+S.search;throw ss(405,{method:e.method,pathname:w,routeId:t.route.id})}else return{type:"data",result:void 0}}else if(g)f=await y(g);else{let v=new URL(e.url),S=v.pathname+v.search;throw ss(404,{pathname:S})}}catch(g){return{type:"error",result:g}}finally{m&&e.signal.removeEventListener("abort",m)}return f}async function wA(e){let t=e.headers.get("Content-Type");return t&&/\bapplication\/json\b/.test(t)?e.body==null?null:e.json():e.text()}async function NA(e){let{result:t,type:r}=e;if(t1(t)){let i;try{i=await wA(t)}catch(l){return{type:"error",error:l}}return r==="error"?{type:"error",error:new Cd(t.status,t.statusText,i),statusCode:t.status,headers:t.headers}:{type:"data",data:i,statusCode:t.status,headers:t.headers}}return r==="error"?S0(t)?t.data instanceof Error?{type:"error",error:t.data,statusCode:t.init?.status,headers:t.init?.headers?new Headers(t.init.headers):void 0}:{type:"error",error:new Cd(t.init?.status||500,void 0,t.data),statusCode:rc(t)?t.status:void 0,headers:t.init?.headers?new Headers(t.init.headers):void 0}:{type:"error",error:t,statusCode:rc(t)?t.status:void 0}:S0(t)?{type:"data",data:t.data,statusCode:t.init?.status,headers:t.init?.headers?new Headers(t.init.headers):void 0}:{type:"data",data:t}}function EA(e,t,r,i,l){let c=e.headers.get("Location");if(sn(c,"Redirects returned/thrown from loaders/actions must have a Location header"),!wy(c)){let f=i.slice(0,i.findIndex(m=>m.route.id===r)+1);c=Dp(new URL(t.url),f,l,c),e.headers.set("Location",c)}return e}function y0(e,t,r){if(wy(e)){let i=e,l=i.startsWith("//")?new URL(t.protocol+i):new URL(i),c=Ra(l.pathname,r)!=null;if(l.origin===t.origin&&c)return l.pathname+l.search+l.hash}return e}function wl(e,t,r,i){let l=e.createURL(e1(t)).toString(),c={signal:r};if(i&&Aa(i.formMethod)){let{formMethod:f,formEncType:m}=i;c.method=f.toUpperCase(),m==="application/json"?(c.headers=new Headers({"Content-Type":m}),c.body=JSON.stringify(i.json)):m==="text/plain"?c.body=i.text:m==="application/x-www-form-urlencoded"&&i.formData?c.body=Op(i.formData):c.body=i.formData}return new Request(l,c)}function Op(e){let t=new URLSearchParams;for(let[r,i]of e.entries())t.append(r,typeof i=="string"?i:i.name);return t}function g0(e){let t=new FormData;for(let[r,i]of e.entries())t.append(r,i);return t}function jA(e,t,r,i=!1,l=!1){let c={},f=null,m,h=!1,p={},y=r&&qa(r[1])?r[1].error:void 0;return e.forEach(g=>{if(!(g.route.id in t))return;let v=g.route.id,S=t[v];if(sn(!Ei(S),"Cannot handle redirect results in processLoaderData"),qa(S)){let w=S.error;if(y!==void 0&&(w=y,y=void 0),f=f||{},l)f[v]=w;else{let N=Ur(e,v);f[N.route.id]==null&&(f[N.route.id]=w)}i||(c[v]=Xw),h||(h=!0,m=rc(S.error)?S.error.status:500),S.headers&&(p[v]=S.headers)}else c[v]=S.data,S.statusCode&&S.statusCode!==200&&!h&&(m=S.statusCode),S.headers&&(p[v]=S.headers)}),y!==void 0&&r&&(f={[r[0]]:y},r[2]&&(c[r[2]]=void 0)),{loaderData:c,errors:f,statusCode:m||200,loaderHeaders:p}}function b0(e,t,r,i,l,c){let{loaderData:f,errors:m}=jA(t,r,i);return l.filter(h=>!h.matches||h.matches.some(p=>p.shouldLoad)).forEach(h=>{let{key:p,match:y,controller:g}=h;if(g&&g.signal.aborted)return;let v=c[p];if(sn(v,"Did not find corresponding fetcher result"),qa(v)){let S=Ur(e.matches,y?.route.id);m&&m[S.route.id]||(m={...m,[S.route.id]:v.error}),e.fetchers.delete(p)}else if(Ei(v))sn(!1,"Unhandled fetcher revalidation redirect");else{let S=er(v.data);e.fetchers.set(p,S)}}),{loaderData:f,errors:m}}function v0(e,t,r,i){let l=Object.entries(t).filter(([,c])=>c!==Xw).reduce((c,[f,m])=>(c[f]=m,c),{});for(let c of r){let f=c.route.id;if(!t.hasOwnProperty(f)&&e.hasOwnProperty(f)&&c.route.loader&&(l[f]=e[f]),i&&i.hasOwnProperty(f))break}return l}function x0(e){return e?qa(e[1])?{actionData:{}}:{actionData:{[e[0]]:e[1].data}}:{}}function Ur(e,t){return(t?e.slice(0,e.findIndex(i=>i.route.id===t)+1):[...e]).reverse().find(i=>i.route.hasErrorBoundary===!0)||e[0]}function Ou(e){let t=e.length===1?e[0]:e.find(r=>r.index||!r.path||r.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:t}],route:t}}function ss(e,{pathname:t,routeId:r,method:i,type:l,message:c}={}){let f="Unknown Server Error",m="Unknown @remix-run/router error";return e===400?(f="Bad Request",i&&t&&r?m=`You made a ${i} request to "${t}" but did not provide a \`loader\` for route "${r}", so there is no way to handle the request.`:l==="invalid-body"&&(m="Unable to encode submission body")):e===403?(f="Forbidden",m=`Route "${r}" does not match URL "${t}"`):e===404?(f="Not Found",m=`No route matches URL "${t}"`):e===405&&(f="Method Not Allowed",i&&t&&r?m=`You made a ${i.toUpperCase()} request to "${t}" but did not provide an \`action\` for route "${r}", so there is no way to handle the request.`:i&&(m=`Invalid request method "${i.toUpperCase()}"`)),new Cd(e||500,f,new Error(m),!0)}function zu(e){let t=Object.entries(e);for(let r=t.length-1;r>=0;r--){let[i,l]=t[r];if(Ei(l))return{key:i,result:l}}}function e1(e){let t=typeof e=="string"?Wr(e):e;return Vr({...t,hash:""})}function _A(e,t){return e.pathname!==t.pathname||e.search!==t.search?!1:e.hash===""?t.hash!=="":e.hash===t.hash?!0:t.hash!==""}function CA(e){return e!=null&&typeof e=="object"&&Object.entries(e).every(([t,r])=>typeof t=="string"&&AA(r))}function AA(e){return e!=null&&typeof e=="object"&&"type"in e&&"result"in e&&(e.type==="data"||e.type==="error")}function TA(e){return t1(e.result)&&oA.has(e.result.status)}function qa(e){return e.type==="error"}function Ei(e){return(e&&e.type)==="redirect"}function S0(e){return typeof e=="object"&&e!=null&&"type"in e&&"data"in e&&"init"in e&&e.type==="DataWithResponseInit"}function t1(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.headers=="object"&&typeof e.body<"u"}function MA(e){return lA.has(e.toUpperCase())}function Aa(e){return rA.has(e.toUpperCase())}function Ey(e){return new URLSearchParams(e).getAll("index").some(t=>t==="")}function md(e,t){let r=typeof t=="string"?Wr(t).search:t.search;if(e[e.length-1].route.index&&Ey(r||""))return e[e.length-1];let i=Vw(e);return i[i.length-1]}function w0(e){let{formMethod:t,formAction:r,formEncType:i,text:l,formData:c,json:f}=e;if(!(!t||!r||!i)){if(l!=null)return{formMethod:t,formAction:r,formEncType:i,formData:void 0,json:void 0,text:l};if(c!=null)return{formMethod:t,formAction:r,formEncType:i,formData:c,json:void 0,text:void 0};if(f!==void 0)return{formMethod:t,formAction:r,formEncType:i,formData:void 0,json:f,text:void 0}}}function kh(e,t){return t?{state:"loading",location:e,formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text}:{state:"loading",location:e,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function RA(e,t){return{state:"submitting",location:e,formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text}}function Mo(e,t){return e?{state:"loading",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:t}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function kA(e,t){return{state:"submitting",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:t?t.data:void 0}}function er(e){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function DA(e,t){try{let r=e.sessionStorage.getItem(Gw);if(r){let i=JSON.parse(r);for(let[l,c]of Object.entries(i||{}))c&&Array.isArray(c)&&t.set(l,new Set(c||[]))}}catch{}}function IA(e,t){if(t.size>0){let r={};for(let[i,l]of t)r[i]=[...l];try{e.sessionStorage.setItem(Gw,JSON.stringify(r))}catch(i){Gn(!1,`Failed to save applied view transitions in sessionStorage (${i}).`)}}}function LA(){let e,t,r=new Promise((i,l)=>{e=async c=>{i(c);try{await r}catch{}},t=async c=>{l(c);try{await r}catch{}}});return{promise:r,resolve:e,reject:t}}var Di=u.createContext(null);Di.displayName="DataRouter";var Nc=u.createContext(null);Nc.displayName="DataRouterState";u.createContext(!1);var jy=u.createContext({isTransitioning:!1});jy.displayName="ViewTransition";var n1=u.createContext(new Map);n1.displayName="Fetchers";var OA=u.createContext(null);OA.displayName="Await";var vs=u.createContext(null);vs.displayName="Navigation";var Xd=u.createContext(null);Xd.displayName="Location";var os=u.createContext({outlet:null,matches:[],isDataRoute:!1});os.displayName="Route";var _y=u.createContext(null);_y.displayName="RouteError";function zA(e,{relative:t}={}){sn(Ol(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:i}=u.useContext(vs),{hash:l,pathname:c,search:f}=Ec(e,{relative:t}),m=c;return r!=="/"&&(m=c==="/"?r:Rs([r,c])),i.createHref({pathname:m,search:f,hash:l})}function Ol(){return u.useContext(Xd)!=null}function Ga(){return sn(Ol(),"useLocation() may be used only in the context of a <Router> component."),u.useContext(Xd).location}var a1="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function s1(e){u.useContext(vs).static||u.useLayoutEffect(e)}function $n(){let{isDataRoute:e}=u.useContext(os);return e?ZA():$A()}function $A(){sn(Ol(),"useNavigate() may be used only in the context of a <Router> component.");let e=u.useContext(Di),{basename:t,navigator:r}=u.useContext(vs),{matches:i}=u.useContext(os),{pathname:l}=Ga(),c=JSON.stringify(Yd(i)),f=u.useRef(!1);return s1(()=>{f.current=!0}),u.useCallback((h,p={})=>{if(Gn(f.current,a1),!f.current)return;if(typeof h=="number"){r.go(h);return}let y=Gd(h,JSON.parse(c),l,p.relative==="path");e==null&&t!=="/"&&(y.pathname=y.pathname==="/"?t:Rs([t,y.pathname])),(p.replace?r.replace:r.push)(y,p.state,p)},[t,r,c,l,e])}var FA=u.createContext(null);function UA(e){let t=u.useContext(os).outlet;return u.useMemo(()=>t&&u.createElement(FA.Provider,{value:e},t),[t,e])}function xs(){let{matches:e}=u.useContext(os),t=e[e.length-1];return t?t.params:{}}function Ec(e,{relative:t}={}){let{matches:r}=u.useContext(os),{pathname:i}=Ga(),l=JSON.stringify(Yd(r));return u.useMemo(()=>Gd(e,JSON.parse(l),i,t==="path"),[e,l,i,t])}function BA(e,t,r,i,l){sn(Ol(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:c}=u.useContext(vs),{matches:f}=u.useContext(os),m=f[f.length-1],h=m?m.params:{},p=m?m.pathname:"/",y=m?m.pathnameBase:"/",g=m&&m.route;{let C=g&&g.path||"";o1(p,!g||C.endsWith("*")||C.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${p}" (under <Route path="${C}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${C}"> to <Route path="${C==="/"?"*":`${C}/*`}">.`)}let v=Ga(),S;S=v;let w=S.pathname||"/",N=w;if(y!=="/"){let C=y.replace(/^\//,"").split("/");N="/"+w.replace(/^\//,"").split("/").slice(C.length).join("/")}let j=Fr(e,{pathname:N});return Gn(g||j!=null,`No routes matched location "${S.pathname}${S.search}${S.hash}" `),Gn(j==null||j[j.length-1].route.element!==void 0||j[j.length-1].route.Component!==void 0||j[j.length-1].route.lazy!==void 0,`Matched leaf route at location "${S.pathname}${S.search}${S.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),YA(j&&j.map(C=>Object.assign({},C,{params:Object.assign({},h,C.params),pathname:Rs([y,c.encodeLocation?c.encodeLocation(C.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:C.pathname]),pathnameBase:C.pathnameBase==="/"?y:Rs([y,c.encodeLocation?c.encodeLocation(C.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:C.pathnameBase])})),f,r,i,l)}function qA(){let e=KA(),t=rc(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",l={padding:"0.5rem",backgroundColor:i},c={padding:"2px 4px",backgroundColor:i},f=null;return console.error("Error handled by React Router default ErrorBoundary:",e),f=u.createElement(u.Fragment,null,u.createElement("p",null," Hey developer "),u.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",u.createElement("code",{style:c},"ErrorBoundary")," or"," ",u.createElement("code",{style:c},"errorElement")," prop on your route.")),u.createElement(u.Fragment,null,u.createElement("h2",null,"Unexpected Application Error!"),u.createElement("h3",{style:{fontStyle:"italic"}},t),r?u.createElement("pre",{style:l},r):null,f)}var HA=u.createElement(qA,null),PA=class extends u.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.unstable_onError?this.props.unstable_onError(e,t):console.error("React Router caught the following error during render",e)}render(){return this.state.error!==void 0?u.createElement(os.Provider,{value:this.props.routeContext},u.createElement(_y.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function VA({routeContext:e,match:t,children:r}){let i=u.useContext(Di);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),u.createElement(os.Provider,{value:e},r)}function YA(e,t=[],r=null,i=null,l=null){if(e==null){if(!r)return null;if(r.errors)e=r.matches;else if(t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let c=e,f=r?.errors;if(f!=null){let p=c.findIndex(y=>y.route.id&&f?.[y.route.id]!==void 0);sn(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(f).join(",")}`),c=c.slice(0,Math.min(c.length,p+1))}let m=!1,h=-1;if(r)for(let p=0;p<c.length;p++){let y=c[p];if((y.route.HydrateFallback||y.route.hydrateFallbackElement)&&(h=p),y.route.id){let{loaderData:g,errors:v}=r,S=y.route.loader&&!g.hasOwnProperty(y.route.id)&&(!v||v[y.route.id]===void 0);if(y.route.lazy||S){m=!0,h>=0?c=c.slice(0,h+1):c=[c[0]];break}}}return c.reduceRight((p,y,g)=>{let v,S=!1,w=null,N=null;r&&(v=f&&y.route.id?f[y.route.id]:void 0,w=y.route.errorElement||HA,m&&(h<0&&g===0?(o1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),S=!0,N=null):h===g&&(S=!0,N=y.route.hydrateFallbackElement||null)));let j=t.concat(c.slice(0,g+1)),_=()=>{let C;return v?C=w:S?C=N:y.route.Component?C=u.createElement(y.route.Component,null):y.route.element?C=y.route.element:C=p,u.createElement(VA,{match:y,routeContext:{outlet:p,matches:j,isDataRoute:r!=null},children:C})};return r&&(y.route.ErrorBoundary||y.route.errorElement||g===0)?u.createElement(PA,{location:r.location,revalidation:r.revalidation,component:w,error:v,children:_(),routeContext:{outlet:null,matches:j,isDataRoute:!0},unstable_onError:i}):_()},null)}function Cy(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function r1(e){let t=u.useContext(Di);return sn(t,Cy(e)),t}function i1(e){let t=u.useContext(Nc);return sn(t,Cy(e)),t}function GA(e){let t=u.useContext(os);return sn(t,Cy(e)),t}function Ay(e){let t=GA(e),r=t.matches[t.matches.length-1];return sn(r.route.id,`${e} can only be used on routes that contain a unique "id"`),r.route.id}function XA(){return Ay("useRouteId")}function KA(){let e=u.useContext(_y),t=i1("useRouteError"),r=Ay("useRouteError");return e!==void 0?e:t.errors?.[r]}var WA=0;function l1(e){let{router:t,basename:r}=r1("useBlocker"),i=i1("useBlocker"),[l,c]=u.useState(""),f=u.useCallback(m=>{if(typeof e!="function")return!!e;if(r==="/")return e(m);let{currentLocation:h,nextLocation:p,historyAction:y}=m;return e({currentLocation:{...h,pathname:Ra(h.pathname,r)||h.pathname},nextLocation:{...p,pathname:Ra(p.pathname,r)||p.pathname},historyAction:y})},[r,e]);return u.useEffect(()=>{let m=String(++WA);return c(m),()=>t.deleteBlocker(m)},[t]),u.useEffect(()=>{l!==""&&t.getBlocker(l,f)},[t,l,f]),l&&i.blockers.has(l)?i.blockers.get(l):wi}function ZA(){let{router:e}=r1("useNavigate"),t=Ay("useNavigate"),r=u.useRef(!1);return s1(()=>{r.current=!0}),u.useCallback(async(l,c={})=>{Gn(r.current,a1),r.current&&(typeof l=="number"?e.navigate(l):await e.navigate(l,{fromRouteId:t,...c}))},[e,t])}var N0={};function o1(e,t,r){!t&&!N0[e]&&(N0[e]=!0,Gn(!1,r))}var E0={};function j0(e,t){!e&&!E0[t]&&(E0[t]=!0,console.warn(t))}function QA(e){let t={hasErrorBoundary:e.hasErrorBoundary||e.ErrorBoundary!=null||e.errorElement!=null};return e.Component&&(e.element&&Gn(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(t,{element:u.createElement(e.Component),Component:void 0})),e.HydrateFallback&&(e.hydrateFallbackElement&&Gn(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(t,{hydrateFallbackElement:u.createElement(e.HydrateFallback),HydrateFallback:void 0})),e.ErrorBoundary&&(e.errorElement&&Gn(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(t,{errorElement:u.createElement(e.ErrorBoundary),ErrorBoundary:void 0})),t}var JA=["HydrateFallback","hydrateFallbackElement"],e2=class{constructor(){this.status="pending",this.promise=new Promise((e,t)=>{this.resolve=r=>{this.status==="pending"&&(this.status="resolved",e(r))},this.reject=r=>{this.status==="pending"&&(this.status="rejected",t(r))}})}};function t2({router:e,flushSync:t,unstable_onError:r}){let[i,l]=u.useState(e.state),[c,f]=u.useState(),[m,h]=u.useState({isTransitioning:!1}),[p,y]=u.useState(),[g,v]=u.useState(),[S,w]=u.useState(),N=u.useRef(new Map),j=u.useCallback(T=>{l(M=>(T.errors&&r&&Object.entries(T.errors).forEach(([A,z])=>{M.errors?.[A]!==z&&r(z)}),T))},[r]),_=u.useCallback((T,{deletedFetchers:M,flushSync:A,viewTransitionOpts:z})=>{T.fetchers.forEach((X,H)=>{X.data!==void 0&&N.current.set(H,X.data)}),M.forEach(X=>N.current.delete(X)),j0(A===!1||t!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let P=e.window!=null&&e.window.document!=null&&typeof e.window.document.startViewTransition=="function";if(j0(z==null||P,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!z||!P){t&&A?t(()=>j(T)):u.startTransition(()=>j(T));return}if(t&&A){t(()=>{g&&(p&&p.resolve(),g.skipTransition()),h({isTransitioning:!0,flushSync:!0,currentLocation:z.currentLocation,nextLocation:z.nextLocation})});let X=e.window.document.startViewTransition(()=>{t(()=>j(T))});X.finished.finally(()=>{t(()=>{y(void 0),v(void 0),f(void 0),h({isTransitioning:!1})})}),t(()=>v(X));return}g?(p&&p.resolve(),g.skipTransition(),w({state:T,currentLocation:z.currentLocation,nextLocation:z.nextLocation})):(f(T),h({isTransitioning:!0,flushSync:!1,currentLocation:z.currentLocation,nextLocation:z.nextLocation}))},[e.window,t,g,p,j]);u.useLayoutEffect(()=>e.subscribe(_),[e,_]),u.useEffect(()=>{m.isTransitioning&&!m.flushSync&&y(new e2)},[m]),u.useEffect(()=>{if(p&&c&&e.window){let T=c,M=p.promise,A=e.window.document.startViewTransition(async()=>{u.startTransition(()=>j(T)),await M});A.finished.finally(()=>{y(void 0),v(void 0),f(void 0),h({isTransitioning:!1})}),v(A)}},[c,p,e.window,j]),u.useEffect(()=>{p&&c&&i.location.key===c.location.key&&p.resolve()},[p,g,i.location,c]),u.useEffect(()=>{!m.isTransitioning&&S&&(f(S.state),h({isTransitioning:!0,flushSync:!1,currentLocation:S.currentLocation,nextLocation:S.nextLocation}),w(void 0))},[m.isTransitioning,S]);let C=u.useMemo(()=>({createHref:e.createHref,encodeLocation:e.encodeLocation,go:T=>e.navigate(T),push:(T,M,A)=>e.navigate(T,{state:M,preventScrollReset:A?.preventScrollReset}),replace:(T,M,A)=>e.navigate(T,{replace:!0,state:M,preventScrollReset:A?.preventScrollReset})}),[e]),O=e.basename||"/",E=u.useMemo(()=>({router:e,navigator:C,static:!1,basename:O,unstable_onError:r}),[e,C,O,r]);return u.createElement(u.Fragment,null,u.createElement(Di.Provider,{value:E},u.createElement(Nc.Provider,{value:i},u.createElement(n1.Provider,{value:N.current},u.createElement(jy.Provider,{value:m},u.createElement(r2,{basename:O,location:i.location,navigationType:i.historyAction,navigator:C},u.createElement(n2,{routes:e.routes,future:e.future,state:i,unstable_onError:r})))))),null)}var n2=u.memo(a2);function a2({routes:e,future:t,state:r,unstable_onError:i}){return BA(e,void 0,r,i,t)}function Xo({to:e,replace:t,state:r,relative:i}){sn(Ol(),"<Navigate> may be used only in the context of a <Router> component.");let{static:l}=u.useContext(vs);Gn(!l,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:c}=u.useContext(os),{pathname:f}=Ga(),m=$n(),h=Gd(e,Yd(c),f,i==="path"),p=JSON.stringify(h);return u.useEffect(()=>{m(JSON.parse(p),{replace:t,state:r,relative:i})},[m,p,i,t,r]),null}function s2(e){return UA(e.context)}function Yt(e){sn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function r2({basename:e="/",children:t=null,location:r,navigationType:i="POP",navigator:l,static:c=!1}){sn(!Ol(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let f=e.replace(/^\/*/,"/"),m=u.useMemo(()=>({basename:f,navigator:l,static:c,future:{}}),[f,l,c]);typeof r=="string"&&(r=Wr(r));let{pathname:h="/",search:p="",hash:y="",state:g=null,key:v="default"}=r,S=u.useMemo(()=>{let w=Ra(h,f);return w==null?null:{location:{pathname:w,search:p,hash:y,state:g,key:v},navigationType:i}},[f,h,p,y,g,v,i]);return Gn(S!=null,`<Router basename="${f}"> is not able to match the URL "${h}${p}${y}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:u.createElement(vs.Provider,{value:m},u.createElement(Xd.Provider,{children:t,value:S}))}function zp(e,t=[]){let r=[];return u.Children.forEach(e,(i,l)=>{if(!u.isValidElement(i))return;let c=[...t,l];if(i.type===u.Fragment){r.push.apply(r,zp(i.props.children,c));return}sn(i.type===Yt,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),sn(!i.props.index||!i.props.children,"An index route cannot have child routes.");let f={id:i.props.id||c.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(f.children=zp(i.props.children,c)),r.push(f)}),r}var i2=zp,hd="get",pd="application/x-www-form-urlencoded";function Kd(e){return e!=null&&typeof e.tagName=="string"}function l2(e){return Kd(e)&&e.tagName.toLowerCase()==="button"}function o2(e){return Kd(e)&&e.tagName.toLowerCase()==="form"}function c2(e){return Kd(e)&&e.tagName.toLowerCase()==="input"}function u2(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function d2(e,t){return e.button===0&&(!t||t==="_self")&&!u2(e)}function $p(e=""){return new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let i=e[r];return t.concat(Array.isArray(i)?i.map(l=>[r,l]):[[r,i]])},[]))}function f2(e,t){let r=$p(e);return t&&t.forEach((i,l)=>{r.has(l)||t.getAll(l).forEach(c=>{r.append(l,c)})}),r}var $u=null;function m2(){if($u===null)try{new FormData(document.createElement("form"),0),$u=!1}catch{$u=!0}return $u}var h2=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Dh(e){return e!=null&&!h2.has(e)?(Gn(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${pd}"`),null):e}function p2(e,t){let r,i,l,c,f;if(o2(e)){let m=e.getAttribute("action");i=m?Ra(m,t):null,r=e.getAttribute("method")||hd,l=Dh(e.getAttribute("enctype"))||pd,c=new FormData(e)}else if(l2(e)||c2(e)&&(e.type==="submit"||e.type==="image")){let m=e.form;if(m==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=e.getAttribute("formaction")||m.getAttribute("action");if(i=h?Ra(h,t):null,r=e.getAttribute("formmethod")||m.getAttribute("method")||hd,l=Dh(e.getAttribute("formenctype"))||Dh(m.getAttribute("enctype"))||pd,c=new FormData(m,e),!m2()){let{name:p,type:y,value:g}=e;if(y==="image"){let v=p?`${p}.`:"";c.append(`${v}x`,"0"),c.append(`${v}y`,"0")}else p&&c.append(p,g)}}else{if(Kd(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=hd,i=null,l=pd,f=e}return c&&l==="text/plain"&&(f=c,c=void 0),{action:i,method:r.toLowerCase(),encType:l,formData:c,body:f}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Ty(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function y2(e,t,r){let i=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return i.pathname==="/"?i.pathname=`_root.${r}`:t&&Ra(i.pathname,t)==="/"?i.pathname=`${t.replace(/\/$/,"")}/_root.${r}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${r}`,i}async function g2(e,t){if(e.id in t)return t[e.id];try{let r=await import(e.module);return t[e.id]=r,r}catch(r){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function b2(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function v2(e,t,r){let i=await Promise.all(e.map(async l=>{let c=t.routes[l.route.id];if(c){let f=await g2(c,r);return f.links?f.links():[]}return[]}));return N2(i.flat(1).filter(b2).filter(l=>l.rel==="stylesheet"||l.rel==="preload").map(l=>l.rel==="stylesheet"?{...l,rel:"prefetch",as:"style"}:{...l,rel:"prefetch"}))}function _0(e,t,r,i,l,c){let f=(h,p)=>r[p]?h.route.id!==r[p].route.id:!0,m=(h,p)=>r[p].pathname!==h.pathname||r[p].route.path?.endsWith("*")&&r[p].params["*"]!==h.params["*"];return c==="assets"?t.filter((h,p)=>f(h,p)||m(h,p)):c==="data"?t.filter((h,p)=>{let y=i.routes[h.route.id];if(!y||!y.hasLoader)return!1;if(f(h,p)||m(h,p))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(l.pathname+l.search+l.hash,window.origin),currentParams:r[0]?.params||{},nextUrl:new URL(e,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function x2(e,t,{includeHydrateFallback:r}={}){return S2(e.map(i=>{let l=t.routes[i.route.id];if(!l)return[];let c=[l.module];return l.clientActionModule&&(c=c.concat(l.clientActionModule)),l.clientLoaderModule&&(c=c.concat(l.clientLoaderModule)),r&&l.hydrateFallbackModule&&(c=c.concat(l.hydrateFallbackModule)),l.imports&&(c=c.concat(l.imports)),c}).flat(1))}function S2(e){return[...new Set(e)]}function w2(e){let t={},r=Object.keys(e).sort();for(let i of r)t[i]=e[i];return t}function N2(e,t){let r=new Set;return new Set(t),e.reduce((i,l)=>{let c=JSON.stringify(w2(l));return r.has(c)||(r.add(c),i.push({key:c,link:l})),i},[])}function c1(){let e=u.useContext(Di);return Ty(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function E2(){let e=u.useContext(Nc);return Ty(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var My=u.createContext(void 0);My.displayName="FrameworkContext";function u1(){let e=u.useContext(My);return Ty(e,"You must render this element inside a <HydratedRouter> element"),e}function j2(e,t){let r=u.useContext(My),[i,l]=u.useState(!1),[c,f]=u.useState(!1),{onFocus:m,onBlur:h,onMouseEnter:p,onMouseLeave:y,onTouchStart:g}=t,v=u.useRef(null);u.useEffect(()=>{if(e==="render"&&f(!0),e==="viewport"){let N=_=>{_.forEach(C=>{f(C.isIntersecting)})},j=new IntersectionObserver(N,{threshold:.5});return v.current&&j.observe(v.current),()=>{j.disconnect()}}},[e]),u.useEffect(()=>{if(i){let N=setTimeout(()=>{f(!0)},100);return()=>{clearTimeout(N)}}},[i]);let S=()=>{l(!0)},w=()=>{l(!1),f(!1)};return r?e!=="intent"?[c,v,{}]:[c,v,{onFocus:Ro(m,S),onBlur:Ro(h,w),onMouseEnter:Ro(p,S),onMouseLeave:Ro(y,w),onTouchStart:Ro(g,S)}]:[!1,v,{}]}function Ro(e,t){return r=>{e&&e(r),r.defaultPrevented||t(r)}}function _2({page:e,...t}){let{router:r}=c1(),i=u.useMemo(()=>Fr(r.routes,e,r.basename),[r.routes,e,r.basename]);return i?u.createElement(A2,{page:e,matches:i,...t}):null}function C2(e){let{manifest:t,routeModules:r}=u1(),[i,l]=u.useState([]);return u.useEffect(()=>{let c=!1;return v2(e,t,r).then(f=>{c||l(f)}),()=>{c=!0}},[e,t,r]),i}function A2({page:e,matches:t,...r}){let i=Ga(),{manifest:l,routeModules:c}=u1(),{basename:f}=c1(),{loaderData:m,matches:h}=E2(),p=u.useMemo(()=>_0(e,t,h,l,i,"data"),[e,t,h,l,i]),y=u.useMemo(()=>_0(e,t,h,l,i,"assets"),[e,t,h,l,i]),g=u.useMemo(()=>{if(e===i.pathname+i.search+i.hash)return[];let w=new Set,N=!1;if(t.forEach(_=>{let C=l.routes[_.route.id];!C||!C.hasLoader||(!p.some(O=>O.route.id===_.route.id)&&_.route.id in m&&c[_.route.id]?.shouldRevalidate||C.hasClientLoader?N=!0:w.add(_.route.id))}),w.size===0)return[];let j=y2(e,f,"data");return N&&w.size>0&&j.searchParams.set("_routes",t.filter(_=>w.has(_.route.id)).map(_=>_.route.id).join(",")),[j.pathname+j.search]},[f,m,i,l,p,t,e,c]),v=u.useMemo(()=>x2(y,l),[y,l]),S=C2(y);return u.createElement(u.Fragment,null,g.map(w=>u.createElement("link",{key:w,rel:"prefetch",as:"fetch",href:w,...r})),v.map(w=>u.createElement("link",{key:w,rel:"modulepreload",href:w,...r})),S.map(({key:w,link:N})=>u.createElement("link",{key:w,nonce:r.nonce,...N})))}function T2(...e){return t=>{e.forEach(r=>{typeof r=="function"?r(t):r!=null&&(r.current=t)})}}var d1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{d1&&(window.__reactRouterVersion="7.9.3")}catch{}function M2(e,t){return mA({basename:t?.basename,getContext:t?.getContext,future:t?.future,history:kC({window:t?.window}),hydrationData:R2(),routes:e,mapRouteProperties:QA,hydrationRouteProperties:JA,dataStrategy:t?.dataStrategy,patchRoutesOnNavigation:t?.patchRoutesOnNavigation,window:t?.window}).initialize()}function R2(){let e=window?.__staticRouterHydrationData;return e&&e.errors&&(e={...e,errors:k2(e.errors)}),e}function k2(e){if(!e)return null;let t=Object.entries(e),r={};for(let[i,l]of t)if(l&&l.__type==="RouteErrorResponse")r[i]=new Cd(l.status,l.statusText,l.data,l.internal===!0);else if(l&&l.__type==="Error"){if(l.__subType){let c=window[l.__subType];if(typeof c=="function")try{let f=new c(l.message);f.stack="",r[i]=f}catch{}}if(r[i]==null){let c=new Error(l.message);c.stack="",r[i]=c}}else r[i]=l;return r}var f1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Jt=u.forwardRef(function({onClick:t,discover:r="render",prefetch:i="none",relative:l,reloadDocument:c,replace:f,state:m,target:h,to:p,preventScrollReset:y,viewTransition:g,...v},S){let{basename:w}=u.useContext(vs),N=typeof p=="string"&&f1.test(p),j,_=!1;if(typeof p=="string"&&N&&(j=p,d1))try{let P=new URL(window.location.href),X=p.startsWith("//")?new URL(P.protocol+p):new URL(p),H=Ra(X.pathname,w);X.origin===P.origin&&H!=null?p=H+X.search+X.hash:_=!0}catch{Gn(!1,`<Link to="${p}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let C=zA(p,{relative:l}),[O,E,T]=j2(i,v),M=O2(p,{replace:f,state:m,target:h,preventScrollReset:y,relative:l,viewTransition:g});function A(P){t&&t(P),P.defaultPrevented||M(P)}let z=u.createElement("a",{...v,...T,href:j||C,onClick:_||c?t:A,ref:T2(S,E),target:h,"data-discover":!N&&r==="render"?"true":void 0});return O&&!N?u.createElement(u.Fragment,null,z,u.createElement(_2,{page:C})):z});Jt.displayName="Link";var D2=u.forwardRef(function({"aria-current":t="page",caseSensitive:r=!1,className:i="",end:l=!1,style:c,to:f,viewTransition:m,children:h,...p},y){let g=Ec(f,{relative:p.relative}),v=Ga(),S=u.useContext(Nc),{navigator:w,basename:N}=u.useContext(vs),j=S!=null&&H2(g)&&m===!0,_=w.encodeLocation?w.encodeLocation(g).pathname:g.pathname,C=v.pathname,O=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;r||(C=C.toLowerCase(),O=O?O.toLowerCase():null,_=_.toLowerCase()),O&&N&&(O=Ra(O,N)||O);const E=_!=="/"&&_.endsWith("/")?_.length-1:_.length;let T=C===_||!l&&C.startsWith(_)&&C.charAt(E)==="/",M=O!=null&&(O===_||!l&&O.startsWith(_)&&O.charAt(_.length)==="/"),A={isActive:T,isPending:M,isTransitioning:j},z=T?t:void 0,P;typeof i=="function"?P=i(A):P=[i,T?"active":null,M?"pending":null,j?"transitioning":null].filter(Boolean).join(" ");let X=typeof c=="function"?c(A):c;return u.createElement(Jt,{...p,"aria-current":z,className:P,ref:y,style:X,to:f,viewTransition:m},typeof h=="function"?h(A):h)});D2.displayName="NavLink";var I2=u.forwardRef(({discover:e="render",fetcherKey:t,navigate:r,reloadDocument:i,replace:l,state:c,method:f=hd,action:m,onSubmit:h,relative:p,preventScrollReset:y,viewTransition:g,...v},S)=>{let w=U2(),N=B2(m,{relative:p}),j=f.toLowerCase()==="get"?"get":"post",_=typeof m=="string"&&f1.test(m),C=O=>{if(h&&h(O),O.defaultPrevented)return;O.preventDefault();let E=O.nativeEvent.submitter,T=E?.getAttribute("formmethod")||f;w(E||O.currentTarget,{fetcherKey:t,method:T,navigate:r,replace:l,state:c,relative:p,preventScrollReset:y,viewTransition:g})};return u.createElement("form",{ref:S,method:j,action:N,onSubmit:i?h:C,...v,"data-discover":!_&&e==="render"?"true":void 0})});I2.displayName="Form";function L2(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function m1(e){let t=u.useContext(Di);return sn(t,L2(e)),t}function O2(e,{target:t,replace:r,state:i,preventScrollReset:l,relative:c,viewTransition:f}={}){let m=$n(),h=Ga(),p=Ec(e,{relative:c});return u.useCallback(y=>{if(d2(y,t)){y.preventDefault();let g=r!==void 0?r:Vr(h)===Vr(p);m(e,{replace:g,state:i,preventScrollReset:l,relative:c,viewTransition:f})}},[h,m,p,r,i,t,e,l,c,f])}function z2(e){Gn(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=u.useRef($p(e)),r=u.useRef(!1),i=Ga(),l=u.useMemo(()=>f2(i.search,r.current?null:t.current),[i.search]),c=$n(),f=u.useCallback((m,h)=>{const p=$p(typeof m=="function"?m(new URLSearchParams(l)):m);r.current=!0,c("?"+p,h)},[c,l]);return[l,f]}var $2=0,F2=()=>`__${String(++$2)}__`;function U2(){let{router:e}=m1("useSubmit"),{basename:t}=u.useContext(vs),r=XA();return u.useCallback(async(i,l={})=>{let{action:c,method:f,encType:m,formData:h,body:p}=p2(i,t);if(l.navigate===!1){let y=l.fetcherKey||F2();await e.fetch(y,r,l.action||c,{preventScrollReset:l.preventScrollReset,formData:h,body:p,formMethod:l.method||f,formEncType:l.encType||m,flushSync:l.flushSync})}else await e.navigate(l.action||c,{preventScrollReset:l.preventScrollReset,formData:h,body:p,formMethod:l.method||f,formEncType:l.encType||m,replace:l.replace,state:l.state,fromRouteId:r,flushSync:l.flushSync,viewTransition:l.viewTransition})},[e,t,r])}function B2(e,{relative:t}={}){let{basename:r}=u.useContext(vs),i=u.useContext(os);sn(i,"useFormAction must be used inside a RouteContext");let[l]=i.matches.slice(-1),c={...Ec(e||".",{relative:t})},f=Ga();if(e==null){c.search=f.search;let m=new URLSearchParams(c.search),h=m.getAll("index");if(h.some(y=>y==="")){m.delete("index"),h.filter(g=>g).forEach(g=>m.append("index",g));let y=m.toString();c.search=y?`?${y}`:""}}return(!e||e===".")&&l.route.index&&(c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(c.pathname=c.pathname==="/"?r:Rs([r,c.pathname])),Vr(c)}function h1(e,t){let{capture:r}=t||{};u.useEffect(()=>{let i=r!=null?{capture:r}:void 0;return window.addEventListener("beforeunload",e,i),()=>{window.removeEventListener("beforeunload",e,i)}},[e,r])}function q2({when:e,message:t}){let r=l1(e);u.useEffect(()=>{r.state==="blocked"&&(window.confirm(t)?setTimeout(r.proceed,0):r.reset())},[r,t]),u.useEffect(()=>{r.state==="blocked"&&!e&&r.reset()},[r,e])}function H2(e,{relative:t}={}){let r=u.useContext(jy);sn(r!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=m1("useViewTransitionState"),l=Ec(e,{relative:t});if(!r.isTransitioning)return!1;let c=Ra(r.currentLocation.pathname,i)||r.currentLocation.pathname,f=Ra(r.nextLocation.pathname,i)||r.nextLocation.pathname;return _d(l.pathname,f)!=null||_d(l.pathname,c)!=null}var Wd=Uw();const p1=ki(Wd);function P2(e){return u.createElement(t2,{flushSync:Wd.flushSync,...e})}/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V2=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Y2=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,i)=>i?i.toUpperCase():r.toLowerCase()),C0=e=>{const t=Y2(e);return t.charAt(0).toUpperCase()+t.slice(1)},y1=(...e)=>e.filter((t,r,i)=>!!t&&t.trim()!==""&&i.indexOf(t)===r).join(" ").trim(),G2=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var X2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K2=u.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:i,className:l="",children:c,iconNode:f,...m},h)=>u.createElement("svg",{ref:h,...X2,width:t,height:t,stroke:e,strokeWidth:i?Number(r)*24/Number(t):r,className:y1("lucide",l),...!c&&!G2(m)&&{"aria-hidden":"true"},...m},[...f.map(([p,y])=>u.createElement(p,y)),...Array.isArray(c)?c:[c]]));/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=(e,t)=>{const r=u.forwardRef(({className:i,...l},c)=>u.createElement(K2,{ref:c,iconNode:t,className:y1(`lucide-${V2(C0(e))}`,`lucide-${e}`,i),...l}));return r.displayName=C0(e),r};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W2=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],A0=It("arrow-down",W2);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z2=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Ry=It("arrow-left",Z2);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q2=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],g1=It("arrow-right",Q2);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J2=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],T0=It("arrow-up",J2);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eT=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}]],ky=It("bell-ring",eT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tT=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Td=It("bell",tT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nT=[["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M14 7a4 4 0 0 1 4 4v3a6 6 0 0 1-12 0v-3a4 4 0 0 1 4-4z",key:"uouzyp"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M21 21a4 4 0 0 0-3.81-4",key:"1b0z45"}],["path",{d:"M21 5a4 4 0 0 1-3.55 3.97",key:"5cxbf6"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M3 21a4 4 0 0 1 3.81-4",key:"1fjd4g"}],["path",{d:"M3 5a4 4 0 0 0 3.55 3.97",key:"1d7oge"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M9 7.13V6a3 3 0 1 1 6 0v1.13",key:"1vgav8"}]],Dy=It("bug",nT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aT=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],M0=It("calendar-days",aT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sT=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],rT=It("check-check",sT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iT=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],b1=It("check",iT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lT=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Br=It("chevron-down",lT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oT=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Iy=It("chevron-right",oT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Ha=It("circle-alert",cT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Zd=It("circle-check",uT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dT=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],fT=It("circle-play",dT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mT=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ly=It("clock",mT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hT=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],R0=It("cloud-upload",hT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pT=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],yT=It("crown",pT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gT=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],k0=It("database",gT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bT=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],vT=It("download",bT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xT=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],v1=It("eye",xT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ST=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],wT=It("file-check",ST);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NT=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Fp=It("file-text",NT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ET=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Qd=It("funnel",ET);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jT=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],_T=It("grip-vertical",jT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CT=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],x1=It("history",CT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AT=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],TT=It("image",AT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Oy=It("info",MT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RT=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],S1=It("layers",RT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kT=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],D0=It("link-2",kT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DT=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],w1=It("list-checks",DT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IT=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],I0=It("list",IT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LT=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Nn=It("loader-circle",LT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OT=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],zT=It("log-out",OT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $T=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],FT=It("lock",$T);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UT=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],BT=It("maximize-2",UT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qT=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],HT=It("menu",qT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PT=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],VT=It("message-square",PT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YT=[["path",{d:"M5 12h14",key:"1ays0h"}]],N1=It("minus",YT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GT=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],XT=It("moon",GT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KT=[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]],Up=It("notebook-pen",KT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WT=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ZT=It("pen-line",WT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QT=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],E1=It("pen",QT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JT=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],ar=It("pencil",JT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eM=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],tM=It("pin",eM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nM=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Va=It("plus",nM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aM=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],zl=It("rotate-ccw",aM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sM=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],L0=It("save",sM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rM=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],ic=It("search",rM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iM=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],lM=It("send",iM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oM=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],j1=It("settings",oM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cM=[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]],uM=It("shapes",cM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dM=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],_1=It("shield-check",dM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fM=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M9 12h6",key:"1c52cq"}],["path",{d:"M12 9v6",key:"199k2o"}]],mM=It("shield-plus",fM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hM=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],pM=It("sliders-horizontal",hM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yM=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Ii=It("sparkles",yM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gM=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],bM=It("sun",gM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vM=[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5",key:"hbey2j"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18",key:"1hf58s"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20",key:"pidxm4"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21",key:"1pehsh"}]],xM=It("swords",vM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],zy=It("target",SM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wM=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ma=It("trash-2",wM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NM=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ta=It("triangle-alert",NM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EM=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],jM=It("upload",EM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _M=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],C1=It("users",_M);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CM=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],AM=It("user",CM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TM=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],MM=It("workflow",TM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RM=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ka=It("x",RM),Cn="http://ttrdb.eu-west-2.elasticbeanstalk.com/api".replace(/\/$/,"")||"http://localhost:3000/api",kM=Object.freeze(Object.defineProperty({__proto__:null,API_BASE:Cn},Symbol.toStringTag,{value:"Module"})),A1=u.createContext(null);function DM({children:e}){const[t,r]=u.useState(null),[i,l]=u.useState(null),[c,f]=u.useState(!1);u.useEffect(()=>{try{const p=localStorage.getItem("gamedb_session");if(p){const y=JSON.parse(p);y?.user&&y?.token?(r(y.user),l(y.token)):(console.warn(" Incomplete session found, clearing..."),localStorage.removeItem("gamedb_session"))}}catch(p){console.warn(" Invalid stored session, clearing...",p),localStorage.removeItem("gamedb_session")}finally{f(!0)}},[]),u.useEffect(()=>{c&&(i&&t?localStorage.setItem("gamedb_session",JSON.stringify({user:t,token:i})):localStorage.removeItem("gamedb_session"))},[i,t,c]);const m=async(p,y)=>{try{const v=await(await fetch(`${Cn}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:p,password:y})})).json();if(console.log(" Raw login response:",v),!v.success||!v.token)throw new Error(v.message||"Invalid credentials");return r(v.user),l(v.token),localStorage.setItem("gamedb_session",JSON.stringify({user:v.user,token:v.token})),console.log(" Login successful:",v.user),!0}catch(g){return console.error(" Login error:",g.message),alert(`Login failed: ${g.message}`),!1}},h=()=>{r(null),l(null),localStorage.removeItem("gamedb_session")};return c?a.jsx(A1.Provider,{value:{user:t,token:i,sessionReady:c,login:m,logout:h},children:e}):a.jsx("div",{className:"loading-screen",children:"Loading session..."})}function En(){return u.useContext(A1)}function Zr(){try{return JSON.parse(localStorage.getItem("gamedb_session"))?.token||null}catch{return null}}async function IM(e=5,t=200){for(let r=0;r<e;r++){const i=Zr();if(i)return i;await new Promise(l=>setTimeout(l,t))}return null}async function or(){const e=await IM();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function cr(e,t="request"){if(e.status===401)throw console.warn(` Unauthorized during ${t}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${e.status} ${r}`)}return e.json()}async function jc(e={}){const t=await or(),r=new URLSearchParams;Object.entries(e).forEach(([f,m])=>{m!=null&&m!==""&&r.set(f,m)});const i=r.toString(),l=i?`${Cn}/campaigns?${i}`:`${Cn}/campaigns`,c=await fetch(l,{headers:t});return cr(c,"fetch campaigns")}async function LM(e){const t=await or(),r=await fetch(`${Cn}/campaigns`,{method:"POST",headers:t,body:JSON.stringify(e)});return cr(r,"create campaign")}async function OM(e,t){const r=await or(),i=await fetch(`${Cn}/campaigns/${e}`,{method:"PUT",headers:r,body:JSON.stringify(t)});return cr(i,"update campaign")}async function zM(e){const t=await or(),r=await fetch(`${Cn}/campaigns/${e}`,{method:"DELETE",headers:t});return cr(r,"delete campaign")}async function $M(e,t={}){if(!e)throw new Error("campaignId is required to fetch notes");const r=await or(),i=new URLSearchParams;Object.entries(t).forEach(([m,h])=>{if(!(h==null||h==="")){if(Array.isArray(h)){h.map(p=>p==null?"":String(p)).filter(p=>p.trim()!=="").forEach(p=>{i.append(`${m}[]`,p)});return}i.set(m,h)}});const l=i.toString(),c=`${Cn}/campaigns/${e}/entity-notes${l?`?${l}`:""}`,f=await fetch(c,{headers:r});return cr(f,"fetch campaign entity notes")}async function FM(e){if(!e)throw new Error("campaignId is required to fetch session notes");const t=await or(),r=`${Cn}/campaigns/${e}/session-notes`,i=await fetch(r,{headers:t});return cr(i,"fetch campaign session notes")}async function UM(e,t={}){if(!e)throw new Error("campaignId is required to create a session note");const r=await or(),i=await fetch(`${Cn}/campaigns/${e}/session-notes`,{method:"POST",headers:r,body:JSON.stringify(t)});return cr(i,"create session note")}async function BM(e,t,r={}){if(!e)throw new Error("campaignId is required to update a session note");if(!t)throw new Error("noteId is required to update a session note");const i=await or(),l=await fetch(`${Cn}/campaigns/${e}/session-notes/${t}`,{method:"PUT",headers:i,body:JSON.stringify(r)});return cr(l,"update session note")}async function qM(e,t){if(!e)throw new Error("campaignId is required to delete a session note");if(!t)throw new Error("noteId is required to delete a session note");const r=await or(),i=await fetch(`${Cn}/campaigns/${e}/session-notes/${t}`,{method:"DELETE",headers:r});return cr(i,"delete session note")}async function HM(e=5,t=200){for(let r=0;r<e;r++){const i=Zr();if(i)return i;await new Promise(l=>setTimeout(l,t))}return null}async function Jd(){const e=await HM();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function ef(e,t="request"){if(e.status===401)throw console.warn(` Unauthorized during ${t}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${e.status} ${r}`)}return e.json()}async function $l(){const e=await Jd(),t=await fetch(`${Cn}/worlds`,{headers:e});return ef(t,"fetch worlds")}async function PM(e){const t=await Jd(),r=await fetch(`${Cn}/worlds`,{method:"POST",headers:t,body:JSON.stringify(e)});return ef(r,"create world")}async function VM(e,t){const r=await Jd(),i=await fetch(`${Cn}/worlds/${e}`,{method:"PUT",headers:r,body:JSON.stringify(t)});return ef(i,"update world")}async function YM(e){const t=await Jd(),r=await fetch(`${Cn}/worlds/${e}`,{method:"DELETE",headers:t});return ef(r,"delete world")}const T1=u.createContext(null),yd="gamedb_campaign_context",GM=new Set(["dm","player"]),ko=(e,t)=>{if(typeof window>"u")return;const r=e?String(e):"",i=r?"":t?String(t):"";try{r?localStorage.setItem(yd,JSON.stringify({type:"campaign",id:r})):i?localStorage.setItem(yd,JSON.stringify({type:"world",id:i})):localStorage.removeItem(yd)}catch(l){console.warn(" Unable to persist campaign context",l)}},XM=e=>{if(!e||typeof e!="string")return{type:"",id:""};try{const t=JSON.parse(e);if(t&&typeof t=="object"){const r=t.type==="world"?"world":"campaign",i=t.id?String(t.id):"";if(i)return{type:r,id:i}}}catch{if(e.trim())return{type:"campaign",id:e.trim()}}return e.trim()?{type:"campaign",id:e.trim()}:{type:"",id:""}},KM=(e,t)=>Array.isArray(e)?t?t.role==="system_admin"?e:e.filter(r=>Array.isArray(r?.members)&&r.members.some(i=>i?.user_id===t.id&&GM.has(i?.role))):[]:[];function WM({children:e}){const{user:t,sessionReady:r}=En(),[i,l]=u.useState([]),[c,f]=u.useState(!1),[m,h]=u.useState(""),[p,y]=u.useState(""),[g,v]=u.useState([]),[S,w]=u.useState(!1),[N,j]=u.useState(""),[_,C]=u.useState(""),[O,E]=u.useState(""),[T,M]=u.useState(!1);u.useEffect(()=>{if(r)try{const k=localStorage.getItem(yd);if(!k){y(""),C("");return}const{type:B,id:R}=XM(k);B==="world"?(C(R),y("")):B==="campaign"?(y(R),C("")):(y(""),C(""))}catch(k){console.warn(" Unable to restore campaign context",k),y(""),C("")}finally{M(!0)}},[r]),u.useEffect(()=>{!r||!T||ko(p,_)},[p,_,r,T]);const A=u.useCallback(async()=>{if(!r||!t)return l([]),h(""),[];f(!0),h("");try{const k=await jc(),B=Array.isArray(k?.data)?k.data:Array.isArray(k)?k:[],R=KM(B,t);return l(R),y(q=>q&&R.some(J=>String(J.id)===String(q))?q:""),R}catch(k){return console.error(" Failed to load campaigns",k),h(k.message||"Failed to load campaigns"),l([]),[]}finally{f(!1)}},[r,t]),z=u.useCallback(async()=>{if(!r||!t)return v([]),j(""),[];w(!0),j("");try{const k=await $l(),B=Array.isArray(k?.data)?k.data:Array.isArray(k)?k:[];return v(B),C(R=>R&&B.some(G=>String(G.id)===String(R))?R:""),B}catch(k){return console.error(" Failed to load worlds",k),j(k.message||"Failed to load worlds"),v([]),[]}finally{w(!1)}},[r,t]);u.useEffect(()=>{if(!(!r||!T)){if(!t){l([]),y(""),h(""),f(!1),v([]),C(""),j(""),w(!1);return}A(),z()}},[r,T,t,A,z]);const P=u.useCallback(k=>{const B=k==null?"":String(k);y(B),B?(C(""),E(""),ko(B,"")):ko("","")},[]),X=u.useCallback(k=>{const B=k==null?"":String(k);C(B),B?(y(""),E(""),ko("",B)):ko("","")},[]);u.useEffect(()=>{E("")},[p]);const H=u.useCallback(k=>{const B=k==null?"":String(k);E(B)},[]),Y=u.useMemo(()=>p&&i.find(k=>String(k.id)===String(p))||null,[i,p]),V=u.useMemo(()=>_&&g.find(k=>String(k.id)===String(_))||null,[g,_]),I=u.useMemo(()=>p?"campaign":_?"world":"",[p,_]),F=u.useMemo(()=>I==="world"&&V?V:Y?.world?Y.world:V,[I,V,Y]),D=u.useMemo(()=>F?.id?String(F.id):"",[F]),L=u.useMemo(()=>`${I||"none"}:${p||_||""||"none"}:${D||"none"}:${O||"none"}`,[p,_,I,D,O]),U=u.useMemo(()=>({campaigns:i,selectedCampaign:Y,selectedCampaignId:p,setSelectedCampaignId:P,worlds:g,worldLoading:S,worldError:N,selectedWorld:V,selectedWorldId:_,setSelectedWorldId:X,viewAsCharacterId:O,setViewAsCharacterId:H,selectedContextType:I,activeWorld:F,activeWorldId:D,contextKey:L,loading:c,error:m,refreshCampaigns:A,refreshWorlds:z}),[i,Y,p,P,g,S,N,V,_,X,O,H,I,F,D,L,c,m,A,z]);return a.jsx(T1.Provider,{value:U,children:e})}function Bn(){const e=u.useContext(T1);if(!e)throw new Error("useCampaignContext must be used within a CampaignProvider");return e}const M1=u.createContext(null),ZM=()=>{if(typeof window>"u")return"light";const e=window.localStorage.getItem("theme");return e==="light"||e==="dark"?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"};function QM({children:e}){const[t,r]=u.useState(ZM);u.useEffect(()=>{typeof document>"u"||(document.body.classList.remove("theme-light","theme-dark"),document.body.classList.add(t==="dark"?"theme-dark":"theme-light"),document.documentElement.setAttribute("data-theme",t),window.localStorage.setItem("theme",t))},[t]),u.useEffect(()=>{if(typeof window>"u")return;const l=window.matchMedia("(prefers-color-scheme: dark)"),c=f=>{r(f.matches?"dark":"light")};if(!window.localStorage.getItem("theme"))return l.addEventListener("change",c),()=>l.removeEventListener("change",c)},[]);const i=u.useMemo(()=>({theme:t,setTheme:r,toggleTheme:()=>r(l=>l==="dark"?"light":"dark")}),[t]);return a.jsx(M1.Provider,{value:i,children:e})}function JM(){const e=u.useContext(M1);if(!e)throw new Error("useTheme must be used within a ThemeProvider");return e}const eR=768;function $y(e=eR){const[t,r]=u.useState(()=>typeof window>"u"?!1:window.matchMedia(`(max-width: ${e}px)`).matches);return u.useEffect(()=>{if(typeof window>"u")return;const i=window.matchMedia(`(max-width: ${e}px)`),l=c=>{r(c.matches)};return r(i.matches),typeof i.addEventListener=="function"?(i.addEventListener("change",l),()=>i.removeEventListener("change",l)):(i.addListener(l),()=>i.removeListener(l))},[e]),t}async function tR(e=5,t=200){for(let r=0;r<e;r++){const i=Zr();if(i)return i;await new Promise(l=>setTimeout(l,t))}return null}async function tf(){const e=await tR();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function nf(e,t="request"){if(e.status===401)throw console.warn(` Unauthorized during ${t}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${e.status} ${r}`)}return e.json()}async function Ds(e={}){const t=await tf(),r=new URLSearchParams;Object.entries(e).forEach(([f,m])=>{m!=null&&m!==""&&r.set(f,m)});const i=r.toString(),l=i?`${Cn}/characters?${i}`:`${Cn}/characters`,c=await fetch(l,{headers:t});return nf(c,"fetch characters")}async function nR(e){const t=await tf(),r=await fetch(`${Cn}/characters`,{method:"POST",headers:t,body:JSON.stringify(e)});return nf(r,"create character")}async function aR(e,t){const r=await tf(),i=await fetch(`${Cn}/characters/${e}`,{method:"PUT",headers:r,body:JSON.stringify(t)});return nf(i,"update character")}async function sR(e){const t=await tf(),r=await fetch(`${Cn}/characters/${e}`,{method:"DELETE",headers:t});return nf(r,"delete character")}const O0="drawer-panel-open",rR=300,Ih={sm:"360px",md:"420px",lg:"560px"},iR=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])",'[tabindex]:not([tabindex="-1"])'],lR=()=>{const e=document.createElement("div");return e.className="drawer-portal-container",e},oR=(e,t)=>e?typeof e=="number"?`${e}px`:String(e):t&&Ih[t]?Ih[t]:Ih.md;function Yr({isOpen:e,onClose:t,title:r,description:i,children:l,footer:c,footerActions:f,width:m,size:h="md",labelledBy:p,closeLabel:y="Close panel",className:g="",mobileFull:v=!0}){const S=u.useRef(null),w=u.useRef(null),N=u.useRef(null),j=u.useRef(null),[_,C]=u.useState(e),[O,E]=u.useState(!1),T=u.useMemo(()=>p||`drawer-${Math.random().toString(36).slice(2)}`,[p]),M=i?`${T}-description`:void 0,A=oR(m,h);if(u.useEffect(()=>(S.current||(S.current=lR(),document.body.appendChild(S.current)),()=>{S.current&&S.current.parentNode&&S.current.parentNode.removeChild(S.current),S.current=null}),[]),u.useEffect(()=>e?(j.current&&(clearTimeout(j.current),j.current=null),C(!0),E(!1),()=>{}):_?(E(!0),j.current=setTimeout(()=>{C(!1),E(!1),j.current=null},rR),()=>{j.current&&(clearTimeout(j.current),j.current=null)}):()=>{},[e,_]),u.useEffect(()=>{if(!e)return;N.current=document.activeElement instanceof HTMLElement?document.activeElement:null,document.body.classList.add(O0);const H=()=>w.current?Array.from(w.current.querySelectorAll(iR.join(","))).filter(D=>D instanceof HTMLElement&&D.offsetParent!==null):[],Y=()=>{const L=H()[0];L?L.focus({preventScroll:!0}):w.current&&w.current.focus({preventScroll:!0})},V=D=>{if(D.key==="Escape"){D.preventDefault(),t?.();return}if(D.key!=="Tab")return;const L=H();if(L.length===0){D.preventDefault(),w.current?.focus({preventScroll:!0});return}const U=L[0],k=L[L.length-1],B=document.activeElement;if(D.shiftKey){(B===U||!w.current?.contains(B))&&(D.preventDefault(),k.focus({preventScroll:!0}));return}B===k&&(D.preventDefault(),U.focus({preventScroll:!0}))},I=D=>{w.current?.contains(D.target)||Y()},F=setTimeout(()=>{if(!w.current)return;const D=w.current.querySelector("[data-autofocus]");if(D instanceof HTMLElement){D.focus({preventScroll:!0});return}Y()},20);return document.addEventListener("keydown",V),document.addEventListener("focusin",I),()=>{clearTimeout(F),document.removeEventListener("keydown",V),document.removeEventListener("focusin",I),document.body.classList.remove(O0),N.current instanceof HTMLElement&&N.current.focus({preventScroll:!0})}},[e,t]),!_||!S.current)return null;const z=["drawer-panel-wrapper",e?"drawer-panel-wrapper--open":"",O?"drawer-panel-wrapper--closing":""].filter(Boolean).join(" "),P=["drawer-panel",h?`drawer-panel--${h}`:"",v?"drawer-panel--mobile-full":"",g].filter(Boolean).join(" "),X=f??c;return Wd.createPortal(a.jsxs("div",{className:z,role:"presentation",children:[a.jsx("div",{className:"drawer-panel-overlay",onClick:t,role:"presentation"}),a.jsxs("aside",{ref:w,className:P,role:"dialog","aria-modal":"true","aria-labelledby":T,"aria-describedby":M,tabIndex:-1,style:{"--drawer-panel-width":A},children:[a.jsxs("div",{className:"drawer-panel-header",children:[a.jsxs("div",{className:"drawer-panel-heading",children:[a.jsx("h2",{id:T,children:r}),i?a.jsx("p",{id:M,className:"drawer-panel-description",children:i}):null]}),a.jsx("button",{type:"button",className:"icon-btn",onClick:t,"aria-label":y,children:""})]}),a.jsx("div",{className:"drawer-panel-body",children:l}),X?a.jsx("div",{className:"drawer-panel-footer",children:X}):null]})]}),S.current)}const af="app_history",R1=100,Bp="history:updated",k1=()=>typeof window<"u"?window:null,sf=()=>!!k1()?.localStorage,D1=e=>{const t=k1();if(t)try{t.dispatchEvent(new CustomEvent(Bp,{detail:Array.isArray(e)?e:[]}))}catch(r){console.warn(" Failed to broadcast history change",r)}},qp=e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t},Fy=e=>{if(!e||e.id===void 0||e.id===null||!e.type)return null;const t=qp(e.viewedAt)||new Date,r=e.worldId??e.world_id??e.worldID??e.world?.id??e.world?.world_id??null,i=e.worldName??e.world_name??e.world?.name??null;return{id:String(e.id),type:String(e.type),title:e.title?String(e.title):"Untitled record",viewedAt:t.toISOString(),...r?{worldId:String(r)}:{},...i?{worldName:String(i)}:{}}},cR=e=>e.slice().sort((t,r)=>{const i=qp(t?.viewedAt),l=qp(r?.viewedAt),c=i?i.getTime():0;return(l?l.getTime():0)-c}),Hp=()=>{if(!sf())return[];try{const e=window.localStorage.getItem(af);if(!e)return[];const t=JSON.parse(e);if(!Array.isArray(t))return[];const r=t.map(Fy).filter(Boolean);return cR(r)}catch(e){return console.warn(" Failed to parse stored history",e),[]}},uR=e=>{if(!sf())return[];if(!Array.isArray(e))return[];const t=e.map(Fy).filter(Boolean).slice(0,R1);return window.localStorage.setItem(af,JSON.stringify(t)),D1(t),t},dR=e=>{if(!sf())return[];const t=Fy(e);if(!t)return Hp();const r=Hp().filter(l=>!(l.id===t.id&&l.type===t.type)),i=[t,...r].slice(0,R1);return uR(i),i},fR=()=>{sf()&&(window.localStorage.removeItem(af),D1([]))},Lh=()=>typeof window>"u"?[]:Hp();function I1(e=null){const[t,r]=u.useState(()=>Lh()),i=u.useCallback(()=>{const m=Lh();return r(m),m},[]),l=u.useCallback(m=>{if(!m)return Lh();const h=dR(m);return r(h),h},[]),c=u.useCallback(()=>{fR(),r([])},[]);u.useEffect(()=>{i()},[i]);const f=u.useMemo(()=>{if(!e)return null;const{id:m,type:h,title:p,viewedAt:y}=e;if(m==null||!h)return null;const g={id:m,type:h,title:p,viewedAt:y},v=e.worldId??e.world_id??e.world?.id??e.world?.world_id??null,S=e.worldName??e.world_name??e.world?.name??null;return v!=null&&(g.worldId=v),S&&(g.worldName=S),g},[e]);return u.useEffect(()=>{f&&l(f)},[f,l]),u.useEffect(()=>{if(typeof window>"u")return;const m=p=>{p.key&&p.key!==af||i()},h=()=>{i()};return window.addEventListener("storage",m),window.addEventListener(Bp,h),()=>{window.removeEventListener("storage",m),window.removeEventListener(Bp,h)}},[i]),{history:t,addEntry:l,refreshHistory:i,clearHistory:c}}const L1=3600*1e3,mR=24*L1,hR=e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t},Pp=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),pR=(e,t)=>{if(!e)return"older";const r=t.getTime()-e.getTime();if(r<L1)return"lastHour";if(Pp(e,t))return"today";const i=new Date(t);return i.setDate(t.getDate()-1),Pp(e,i)?"yesterday":r<7*mR?"lastSevenDays":"older"},yR=[{key:"lastHour",label:"Last hour"},{key:"today",label:"Today"},{key:"yesterday",label:"Yesterday"},{key:"lastSevenDays",label:"Last seven days"},{key:"older",label:"Older"}],gR=(e,t)=>{if(!e)return"";if(Pp(e,t)){const l=String(e.getHours()).padStart(2,"0"),c=String(e.getMinutes()).padStart(2,"0");return`${l}.${c}`}const r=String(e.getDate()).padStart(2,"0"),i=e.toLocaleString(void 0,{month:"short"});return`${r} ${i}`},bR=e=>{if(!e)return"record";const t=String(e);return t.includes(":")?t.split(":").pop().replace(/[-_]+/g," "):t.replace(/_/g," ")},vR=e=>!e?.type||!e?.id?null:String(e.type).toLowerCase().startsWith("entity")?`/entities/${e.id}`:null;function xR({isOpen:e,onClose:t}){const{history:r,clearHistory:i}=I1(),{campaigns:l,worlds:c,loading:f,worldLoading:m,selectedContextType:h,activeWorldId:p}=Bn(),y=new Date,g=u.useMemo(()=>!f&&!m,[f,m]),v=u.useMemo(()=>{const C=new Set,O=E=>{if(!E&&E!==0)return;const T=String(E);T&&C.add(T)};return Array.isArray(c)&&c.forEach(E=>{O(E?.id??E?.world_id)}),Array.isArray(l)&&l.forEach(E=>{O(E?.world?.id??E?.world_id)}),C},[l,c]),S=u.useMemo(()=>!h||!p?"":String(p),[h,p]),w=u.useMemo(()=>!Array.isArray(r)||r.length===0?[]:!g||!v.size?r:r.filter(C=>{if(!C)return!1;if(!String(C.type||"").toLowerCase().startsWith("entity"))return!0;const E=C.worldId??C.world_id??C.world?.id??C.world?.world_id??null;return S&&(!E||String(E)!==S)?!1:E?v.has(String(E)):!0}),[r,v,g,S]),N=g&&Array.isArray(r)&&r.length>0&&w.length<r.length,j=u.useMemo(()=>{if(!Array.isArray(w)||w.length===0)return[];const C=new Date,O=yR.map(T=>({...T,items:[]})),E=new Map(O.map(T=>[T.key,T]));return w.forEach(T=>{const M=hR(T?.viewedAt),A=pR(M,C),z=E.get(A);z&&z.items.push({...T,parsedDate:M})}),O.filter(T=>T.items.length>0)},[w]),_=()=>{i()};return a.jsx(Yr,{isOpen:e,onClose:t,title:"History",description:"Recently viewed records",size:"sm",children:a.jsxs("div",{className:"history-tab",children:[a.jsxs("div",{className:"history-tab-header",children:[a.jsxs("div",{className:"history-tab-title",children:[a.jsx(Ly,{size:18}),a.jsx("span",{children:"Recently viewed"})]}),a.jsxs("button",{type:"button",className:"history-clear-btn",onClick:_,disabled:!r.length,children:[a.jsx(ma,{size:14}),"Clear"]})]}),!w.length&&a.jsx("p",{className:"history-empty",children:N?"You do not currently have access to any records in your recent history.":"No records viewed yet. Start exploring to build a history."}),j.map(C=>a.jsxs("section",{className:"history-group",children:[a.jsx("h3",{className:"history-group-title",children:C.label}),a.jsx("ul",{className:"history-entry-list",children:C.items.map(O=>{const E=vR(O),T=a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"history-entry-title",children:O.title||"Untitled record"}),a.jsxs("div",{className:"history-entry-meta",children:[a.jsx("span",{className:"history-entry-type",children:bR(O.type)}),a.jsx("time",{className:"history-entry-time",children:gR(O.parsedDate,y)})]})]});return a.jsx("li",{children:E?a.jsx(Jt,{to:E,className:"history-entry history-entry-link",onClick:t,children:T}):a.jsx("div",{className:"history-entry",children:T})},`${O.type}-${O.id}`)})})]},C.key))]})})}const SR="gamedb_campaign_context",wR="X-Campaign-Context-Id",NR=e=>{if(!e||typeof e!="string")return null;try{const r=JSON.parse(e);if(r&&typeof r=="object"){const i=r.type==="world"?"world":"campaign",l=r.id?String(r.id):"";return l?{type:i,id:l}:null}}catch{const r=e.trim();if(r)return{type:"campaign",id:r}}const t=e.trim();return t?{type:"campaign",id:t}:null};async function Do(e,t,r,i={}){const{headers:l,includeCampaignContext:c=!0,...f}=i||{},m=typeof FormData<"u"&&r instanceof FormData,h={...m?{}:{"Content-Type":"application/json"},...l},p=Zr();if(p&&(h.Authorization=`Bearer ${p}`),c)try{const N=localStorage.getItem(SR);if(N){const j=NR(N);j?.type==="campaign"&&j.id&&(h[wR]=j.id)}}catch(N){console.warn(" Unable to include campaign context header",N)}const y=(()=>{if(r!==void 0)return m?r:JSON.stringify(r)})(),g=await fetch(`${Cn}${t}`,{method:e,headers:h,body:y,...f}),S=(g.headers.get("content-type")||"").includes("application/json"),w=S?await g.json():await g.text();if(!g.ok){g.status===401&&(localStorage.removeItem("gamedb_session"),setTimeout(()=>{window.location.pathname!=="/login"&&(window.location.href="/login")},150));const N=S&&w?.message||(typeof w=="string"?w:"Request failed"),j=new Error(N);throw j.status=g.status,j}return w}const Tt={get:(e,t)=>Do("GET",e,void 0,t),post:(e,t,r)=>Do("POST",e,t,r),put:(e,t,r)=>Do("PUT",e,t,r),patch:(e,t,r)=>Do("PATCH",e,t,r),delete:(e,t)=>Do("DELETE",e,void 0,t)},O1=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([l,c])=>{c!=null&&c!==""&&t.set(l,c)});const r=t.toString(),i=r?`/notifications?${r}`:"/notifications";return Tt.get(i)},ER=e=>Tt.patch(`/notifications/${e}/read`),jR=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([l,c])=>{c!=null&&c!==""&&t.set(l,c)});const r=t.toString(),i=r?`/notifications/read-all?${r}`:"/notifications/read-all";return Tt.patch(i)},_R=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([l,c])=>{c!=null&&c!==""&&t.set(l,c)});const r=t.toString(),i=r?`/notifications/unread-count?${r}`:"/notifications/unread-count";return Tt.get(i)},z1=u.createContext(null),Oh=3e4,CR=12e4;function AR({children:e}){const{user:t,sessionReady:r}=En(),[i,l]=u.useState([]),[c,f]=u.useState(0),[m,h]=u.useState(!1),[p,y]=u.useState(""),g=u.useRef(null),v=u.useRef(null),S=u.useRef(!0);u.useEffect(()=>{const E=()=>{S.current=!document.hidden,!document.hidden&&v.current&&Date.now()-v.current>Oh&&(w(),N())};return document.addEventListener("visibilitychange",E),()=>{document.removeEventListener("visibilitychange",E)}},[]);const w=u.useCallback(async()=>{if(!t?.id||!r){l([]),h(!1);return}h(!0),y("");try{const E=await O1({limit:50}),T=Array.isArray(E?.data)?E.data:[];l(T),v.current=Date.now()}catch(E){console.error(" Failed to load notifications",E),y(E.message||"Failed to load notifications")}finally{h(!1)}},[t?.id,r]),N=u.useCallback(async()=>{if(!t?.id||!r){f(0);return}try{const T=(await _R())?.count??0;f(T)}catch(E){console.error(" Failed to load unread count",E)}},[t?.id,r]),j=u.useCallback(()=>{w(),N()},[w,N]),_=u.useCallback(async E=>{if(E)try{await ER(E),l(T=>T.map(M=>M.id===E?{...M,read:!0,readAt:new Date().toISOString()}:M)),f(T=>Math.max(0,T-1))}catch(T){throw console.error(" Failed to mark notification read",T),T}},[]),C=u.useCallback(async(E={})=>{try{await jR(E),l(T=>T.map(M=>({...M,read:!0,readAt:new Date().toISOString()}))),f(0)}catch(T){throw console.error(" Failed to mark all notifications read",T),T}},[]);u.useEffect(()=>{if(!t?.id||!r){g.current&&(clearInterval(g.current),g.current=null),l([]),f(0);return}w(),N();const E=()=>{g.current&&clearInterval(g.current);const M=S.current?Oh:CR;g.current=setInterval(()=>{S.current?(N(),(!v.current||Date.now()-v.current>Oh*2)&&w()):N()},M)};E();const T=()=>{S.current=!document.hidden,E()};return document.addEventListener("visibilitychange",T),()=>{g.current&&(clearInterval(g.current),g.current=null),document.removeEventListener("visibilitychange",T)}},[t?.id,r,w,N]);const O=u.useMemo(()=>({notifications:i,unreadCount:c,loading:m,error:p,refresh:j,markRead:_,markAllRead:C}),[i,c,m,p,j,_,C]);return a.jsx(z1.Provider,{value:O,children:e})}function TR(){const e=u.useContext(z1);if(!e)throw new Error("useNotifications must be used within NotificationProvider");return e}function $1(){return TR()}function F1({open:e,campaignName:t,onSwitch:r,onCancel:i}){return e?a.jsx("div",{className:"unsaved-dialog-backdrop",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"unsaved-dialog",role:"document",children:[a.jsxs("div",{className:"unsaved-dialog-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"unsaved-dialog-label",children:"Campaign context"}),a.jsx("h2",{children:"Switch campaign context?"})]}),a.jsx("button",{type:"button",className:"icon-btn","aria-label":"Close dialog",onClick:i,children:a.jsx(ka,{size:18})})]}),a.jsxs("div",{className:"unsaved-dialog-body",children:[a.jsxs("p",{children:["This notification is for the campaign ",a.jsx("strong",{children:t||"another campaign"}),". You're currently viewing a different campaign context."]}),a.jsx("p",{className:"unsaved-dialog-help",children:"Would you like to switch to the correct campaign context to view this notification?"})]}),a.jsxs("div",{className:"unsaved-dialog-actions",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:r,children:"Switch campaign context"}),a.jsx("button",{type:"button",className:"btn cancel",onClick:i,children:"Cancel"})]})]})}):null}const MR=e=>{if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const i=new Date-t,l=Math.floor(i/6e4),c=Math.floor(i/36e5),f=Math.floor(i/864e5);return l<1?"Just now":l<60?`${l}m ago`:c<24?`${c}h ago`:f<7?`${f}d ago`:t.toLocaleDateString(void 0,{month:"short",day:"numeric"})},RR=e=>{const{type:t,metadata:r={}}=e;switch(t){case"entity_comment":return`${r.author_name||"Someone"} commented on ${r.entity_name||"an entity"}`;case"entity_mention_entity_note":return`${r.author_name||"Someone"} mentioned ${r.related_entity_name||"an entity"} in a note`;case"entity_mention_session_note":return`${r.author_name||"Someone"} mentioned ${r.related_entity_name||"an entity"} in a session note`;case"session_note_added":return`${r.author_name||"Someone"} created a session note${r.campaign_name?` for ${r.campaign_name}`:""}`;case"session_note_updated":return`${r.author_name||"Someone"} updated a session note${r.campaign_name?` for ${r.campaign_name}`:""}`;case"request_note_added":return`${r.author_name||"Someone"} added a note to "${r.request_title||"a feature/bug"}"`;case"request_status_changed":return`Status changed for "${r.request_title||"a feature/bug"}"`;case"request_assigned":return`You were assigned to "${r.request_title||"a feature/bug"}"`;default:return"New notification"}};function kR(){const{notifications:e,unreadCount:t,loading:r,markRead:i}=$1(),{selectedCampaignId:l,setSelectedCampaignId:c}=Bn(),f=$n(),[m,h]=u.useState(!1),p=u.useRef(null),[y,g]=u.useState({open:!1,notification:null});u.useEffect(()=>{const C=O=>{p.current&&!p.current.contains(O.target)&&h(!1)};if(m)return document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[m]);const v=e.filter(C=>!C.read).slice(0,5),S=C=>{if(h(!1),C.actionUrl)f(C.actionUrl);else{const{type:O,metadata:E={}}=C;if(O==="entity_comment"||O==="entity_mention_entity_note"){const T=E.entity_id||E.related_entity_id,M=C.campaignId||C.campaign?.id||l;T&&f(`/entities/${T}${M?`?campaignId=${M}`:""}#notes`)}else if(O==="session_note_added"||O==="session_note_updated"||O==="entity_mention_session_note"){const T=C.campaignId||C.campaign?.id||E.target_id||l;f(`/notes/session${T?`?campaignId=${T}`:""}`)}else if(O==="request_note_added"||O==="request_status_changed"||O==="request_assigned"){const T=E.request_id||E.requestId;f(T?`/requests/${T}`:"/requests")}else f("/notifications")}},w=async C=>{if(!C.read)try{await i(C.id)}catch(T){console.error("Failed to mark notification read",T)}const O=C.campaignId||C.campaign?.id||"";if(O&&O!==(l||"")){g({open:!0,notification:C});return}S(C)},N=()=>{const{notification:C}=y;if(!C)return;const O=C.campaignId||C.campaign?.id||"";O&&c(O),g({open:!1,notification:null}),setTimeout(()=>{S(C)},100)},j=()=>{g({open:!1,notification:null})},_=v.length>0;return a.jsxs("div",{className:"notification-widget",ref:p,children:[a.jsxs("button",{type:"button",className:"notification-widget-button",onClick:()=>h(!m),title:"Notifications",children:[t>0?a.jsx(ky,{size:20}):a.jsx(Td,{size:20}),t>0&&a.jsx("span",{className:"notification-widget-badge",children:t>99?"99+":t})]}),m&&a.jsxs("div",{className:"notification-widget-dropdown",children:[a.jsxs("div",{className:"notification-widget-header",children:[a.jsx("h3",{children:"Notifications"}),t>0&&a.jsxs("span",{className:"notification-widget-count",children:[t," unread"]})]}),r?a.jsx("div",{className:"notification-widget-loading",children:"Loading..."}):_?a.jsx("div",{className:"notification-widget-list",children:v.map(C=>a.jsxs("div",{className:`notification-widget-item ${C.read?"read":"unread"}`,onClick:()=>w(C),children:[a.jsxs("div",{className:"notification-widget-item-content",children:[a.jsx("p",{className:"notification-widget-item-message",children:RR(C)}),a.jsx("span",{className:"notification-widget-item-time",children:MR(C.createdAt)})]}),!C.read&&a.jsx("div",{className:"notification-widget-item-dot"})]},C.id))}):a.jsx("div",{className:"notification-widget-empty",children:"No new notifications"}),a.jsx("div",{className:"notification-widget-footer",children:a.jsxs(Jt,{to:"/notifications",className:"notification-widget-view-all",onClick:()=>h(!1),children:["View all notifications ",a.jsx(Iy,{size:14})]})})]}),a.jsx(F1,{open:y.open,campaignName:y.notification?.campaign?.name||"",onSwitch:N,onCancel:j})]})}const DR=(e={})=>{const t=new URLSearchParams,r=e.viewAsCharacterId??e.characterId??e.character_id??e.viewAs;if(r!=null){const i=String(r).trim();i&&t.set("viewAsCharacterId",i)}return t.toString()},lc=(e,t={})=>{if(!e)return Promise.reject(new Error("worldId is required to load entities"));const r=new URLSearchParams,i=DR(t);i&&r.set("viewAsCharacterId",new URLSearchParams(i).get("viewAsCharacterId")),t.importance!==void 0&&t.importance!==null&&(Array.isArray(t.importance)?t.importance:[t.importance]).forEach(m=>{m!=null&&r.append("importance[]",m)});const l=r.toString(),c=l?`?${l}`:"";return Tt.get(`/worlds/${e}/entities${c}`)},IR=()=>Tt.get("/entities/unassigned"),rr=e=>Tt.get(`/entities/${e}`),rf=({worldId:e,query:t,typeIds:r=[],limit:i=20,offset:l=0})=>{if(!e)return Promise.reject(new Error("worldId is required"));const c=new URLSearchParams;c.set("worldId",e),t&&c.set("q",t),(Array.isArray(r)?r:[r]).map(h=>h==null?"":String(h).trim()).filter(Boolean).forEach(h=>{c.append("typeIds[]",h)}),i!=null&&c.set("limit",i),l!=null&&c.set("offset",l);const m=c.toString();return Tt.get(`/entities/search${m?`?${m}`:""}`)},LR=({query:e,campaignId:t,worldId:r,limit:i=20,offset:l=0})=>{const c=new URLSearchParams;e&&c.set("q",e),t&&c.set("campaignId",t),r&&c.set("worldId",r),i!=null&&c.set("limit",i),l!=null&&c.set("offset",l);const f=c.toString();return Tt.get(`/entities/global-search${f?`?${f}`:""}`)},Uy=e=>Tt.post("/entities",e),By=(e,t)=>Tt.patch(`/entities/${e}`,t),OR=(e,t)=>Tt.patch(`/entities/${e}/importance`,{importance:t}),zR=e=>Tt.delete(`/entities/${e}`),U1=(e,t)=>{if(!e)return Promise.reject(new Error("entityId is required"));if(!t)return Promise.reject(new Error("file is required"));const r=new FormData;return r.append("file",t),Tt.post(`/entities/${e}/image`,r)},B1=e=>e?Tt.delete(`/entities/${e}/image`):Promise.reject(new Error("entityId is required")),$R=(e,t)=>Tt.post(`/entities/${e}/secrets`,t),FR=(e,t,r)=>Tt.patch(`/entities/${e}/secrets/${t}`,r),UR=(e,t={})=>{const r=new URLSearchParams,i=t.campaignId??t.campaign_id;i&&r.set("campaignId",i);const l=r.toString();return Tt.get(`/entities/${e}/notes${l?`?${l}`:""}`)},BR=(e,t={})=>{const r=new URLSearchParams,i=t.campaignId??t.campaign_id;i&&r.set("campaignId",i);const l=r.toString();return Tt.get(`/entities/${e}/mentions/entity-notes${l?`?${l}`:""}`)},qR=(e,t={})=>{const r=new URLSearchParams,i=t.campaignId??t.campaign_id;i&&r.set("campaignId",i);const l=r.toString();return Tt.get(`/entities/${e}/mentions/session-notes${l?`?${l}`:""}`)},HR=(e,t)=>Tt.post(`/entities/${e}/notes`,t),q1=(e,t,r)=>Tt.patch(`/entities/${e}/notes/${t}`,r),H1=(e,t,r={})=>{const i=new URLSearchParams,l=r.campaignId??r.campaign_id;l&&i.set("campaignId",l);const c=i.toString();return Tt.delete(`/entities/${e}/notes/${t}${c?`?${c}`:""}`)},PR=async(e,t=1)=>{const r=new URLSearchParams;if(t!=null){const c=Number(t);!Number.isNaN(c)&&c>0&&r.set("depth",String(c))}const i=r.toString(),l=await Tt.get(`/entities/${e}/graph${i?`?${i}`:""}`,{credentials:"include"});if(!l?.success)throw new Error(l?.message||"Failed to load graph");return l.data},VR=300,YR=(e,t)=>{const[r,i]=u.useState(e);return u.useEffect(()=>{const l=setTimeout(()=>i(e),t);return()=>clearTimeout(l)},[e,t]),r},Fu=e=>({name:"Name",description:"Description",notes:"Notes",mentions:"Mentions",relationships:"Relationships",title:"Title",content:"Content"})[e]||e;function z0({isMobile:e,onClose:t}){const r=$n(),{selectedCampaignId:i,activeWorldId:l}=Bn(),[c,f]=u.useState(""),m=!!(i||l),[h,p]=u.useState({entities:[],sessionNotes:[]}),[y,g]=u.useState(!1),[v,S]=u.useState(""),[w,N]=u.useState(-1),[j,_]=u.useState(!1),C=YR(c,VR),O=u.useRef(null),E=u.useRef(null),T=u.useRef(0),M=u.useMemo(()=>{const F=[];return h.entities.forEach(D=>{F.push({type:"entity",data:D})}),h.sessionNotes.forEach(D=>{F.push({type:"sessionNote",data:D})}),F},[h]),A=M.length>0,z=j&&(c.trim().length>0||A),P=u.useCallback(async F=>{if(!F.trim()){p({entities:[],sessionNotes:[]}),g(!1);return}if(!m){S("Please select a campaign or world context to search"),p({entities:[],sessionNotes:[]}),g(!1);return}const D=++T.current;g(!0),S("");try{const L=await LR({query:F,campaignId:i,worldId:l,limit:20,offset:0});if(D!==T.current)return;const U=L?.data||{entities:[],sessionNotes:[]};p({entities:Array.isArray(U.entities)?U.entities:[],sessionNotes:Array.isArray(U.sessionNotes)?U.sessionNotes:[]})}catch(L){if(D!==T.current)return;S(L.message||"Failed to search"),p({entities:[],sessionNotes:[]})}finally{D===T.current&&g(!1)}},[l,i,m]);u.useEffect(()=>{C.trim().length>0?P(C):(p({entities:[],sessionNotes:[]}),g(!1))},[C,P]),u.useEffect(()=>{j&&E.current&&!e&&E.current.focus()},[j,e]),u.useEffect(()=>{const F=D=>{O.current&&!O.current.contains(D.target)&&(e||_(!1))};if(j)return document.addEventListener("mousedown",F),()=>document.removeEventListener("mousedown",F)},[j,e]),u.useEffect(()=>{const F=D=>{if(z)if(D.key==="ArrowDown")D.preventDefault(),N(L=>L<M.length-1?L+1:L);else if(D.key==="ArrowUp")D.preventDefault(),N(L=>L>0?L-1:-1);else if(D.key==="Enter"&&w>=0){D.preventDefault();const L=M[w];L&&Y(L)}else D.key==="Escape"&&(D.preventDefault(),_(!1),f(""),e&&t&&t())};if(z)return document.addEventListener("keydown",F),()=>document.removeEventListener("keydown",F)},[z,w,M,e,t]);const X=F=>{f(F.target.value),N(-1),j||_(!0)},H=()=>{_(!0)},Y=F=>{F.type==="entity"?r(`/entities/${F.data.id}`):F.type==="sessionNote"&&r(`/campaigns/${i}/session-notes`),_(!1),f(""),e&&t&&t()},V=()=>{f(""),p({entities:[],sessionNotes:[]}),N(-1),e&&t&&t()},I=F=>{if(!F)return"";try{return new Date(F).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return F}};return e?a.jsxs("div",{className:"global-search-mobile",children:[a.jsx("div",{className:"global-search-mobile-overlay",onClick:t}),a.jsxs("div",{className:"global-search-mobile-content",children:[a.jsxs("div",{className:`global-search-input-wrapper ${m?"":"disabled"}`,children:[a.jsx(ic,{size:20,className:"global-search-icon"}),a.jsx("input",{ref:E,type:"text",className:"global-search-input",placeholder:m?"Search entities and session notes...":"Select a campaign or world to search",value:c,onChange:X,onFocus:H,disabled:!m,autoFocus:!0}),c&&a.jsx("button",{type:"button",className:"global-search-clear",onClick:V,"aria-label":"Clear search",children:a.jsx(ka,{size:16})})]}),z&&a.jsxs("div",{className:"global-search-results",children:[y&&a.jsx("div",{className:"global-search-loading",children:a.jsx("span",{children:"Searching..."})}),!y&&v&&a.jsx("div",{className:"global-search-error",children:a.jsx("span",{children:v})}),!y&&!v&&!A&&c.trim().length>0&&a.jsx("div",{className:"global-search-empty",children:a.jsx("span",{children:"No results found"})}),!y&&!v&&A&&a.jsx("div",{className:"global-search-results-list",children:M.map((F,D)=>a.jsx("button",{type:"button",className:`global-search-result-item ${D===w?"selected":""}`,onClick:()=>Y(F),children:F.type==="entity"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"global-search-result-header",children:[a.jsx("span",{className:"global-search-result-name",children:F.data.name}),F.data.typeName&&a.jsx("span",{className:"global-search-result-type",children:F.data.typeName})]}),a.jsx("div",{className:"global-search-result-meta",children:a.jsxs("span",{className:"global-search-match-type",children:["Matched in ",Fu(F.data.matchType)]})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"global-search-result-header",children:[a.jsx("span",{className:"global-search-result-name",children:F.data.session_title||"Session Note"}),a.jsx("span",{className:"global-search-result-type",children:"Session Note"})]}),a.jsx("div",{className:"global-search-result-meta",children:a.jsxs("span",{className:"global-search-match-type",children:[I(F.data.session_date),"  Matched in"," ",Fu(F.data.matchType)]})})]})},`${F.type}-${F.data.id}`))})]})]})]}):a.jsxs("div",{className:"global-search",ref:O,children:[a.jsxs("div",{className:`global-search-input-wrapper ${m?"":"disabled"}`,children:[a.jsx(ic,{size:18,className:"global-search-icon"}),a.jsx("input",{ref:E,type:"text",className:"global-search-input",placeholder:m?"Search entities and session notes...":"Select a campaign or world to search",value:c,onChange:X,onFocus:H,disabled:!m}),c&&a.jsx("button",{type:"button",className:"global-search-clear",onClick:V,"aria-label":"Clear search",children:a.jsx(ka,{size:16})})]}),z&&a.jsxs("div",{className:"global-search-dropdown",children:[y&&a.jsx("div",{className:"global-search-loading",children:a.jsx("span",{children:"Searching..."})}),!y&&v&&a.jsx("div",{className:"global-search-error",children:a.jsx("span",{children:v})}),!y&&!v&&!A&&c.trim().length>0&&a.jsx("div",{className:"global-search-empty",children:a.jsx("span",{children:"No results found"})}),!y&&!v&&A&&a.jsx("div",{className:"global-search-results-list",children:M.map((F,D)=>a.jsx("button",{type:"button",className:`global-search-result-item ${D===w?"selected":""}`,onClick:()=>Y(F),children:F.type==="entity"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"global-search-result-header",children:[a.jsx("span",{className:"global-search-result-name",children:F.data.name}),F.data.typeName&&a.jsx("span",{className:"global-search-result-type",children:F.data.typeName})]}),a.jsx("div",{className:"global-search-result-meta",children:a.jsxs("span",{className:"global-search-match-type",children:["Matched in ",Fu(F.data.matchType)]})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"global-search-result-header",children:[a.jsx("span",{className:"global-search-result-name",children:F.data.session_title||"Session Note"}),a.jsx("span",{className:"global-search-result-type",children:"Session Note"})]}),a.jsx("div",{className:"global-search-result-meta",children:a.jsxs("span",{className:"global-search-match-type",children:[I(F.data.session_date),"  Matched in"," ",Fu(F.data.matchType)]})})]})},`${F.type}-${F.data.id}`))})]})]})}function GR({onMenuToggle:e}){const[t,r]=u.useState(!1),i=u.useRef(null),{user:l,logout:c}=En(),{theme:f,toggleTheme:m}=JM(),{campaigns:h,selectedCampaignId:p,setSelectedCampaignId:y,selectedCampaign:g,loading:v,error:S,worlds:w,selectedWorld:N,selectedWorldId:j,setSelectedWorldId:_,worldLoading:C,worldError:O,viewAsCharacterId:E,setViewAsCharacterId:T}=Bn();u.useEffect(()=>{const He=tt=>{i.current&&!i.current.contains(tt.target)&&r(!1)};return document.addEventListener("mousedown",He),()=>document.removeEventListener("mousedown",He)},[]);const M=He=>{y(He.target.value)},A=He=>{_(He.target.value)},z=$y(),[P,X]=u.useState([]),[H,Y]=u.useState(!1),[V,I]=u.useState(""),[F,D]=u.useState(!1),[L,U]=u.useState(!1),[k,B]=u.useState(!1),R=u.useMemo(()=>!g||!l?"":g.members?.find(tt=>tt?.user_id===l.id)?.role||"",[g,l]),q=u.useMemo(()=>{if(!g?.world)return"";const He=g.world;return He.created_by||He.creator?.id||He.owner_id||He.owner?.id||""},[g]),G=u.useMemo(()=>!p||!l?!1:l.role==="system_admin"||R==="dm"?!0:q?String(q)===String(l.id):!1,[R,p,q,l]);u.useEffect(()=>{G||T("")},[G,T]),u.useEffect(()=>{let He=!1;if(!G||!p){X([]),Y(!1),I("");return}return(async()=>{Y(!0),I("");try{const Ie=await Ds({scope:"others",campaign_id:p}),vt=Array.isArray(Ie?.data)?Ie.data:Array.isArray(Ie)?Ie:[];if(He)return;const Ct=vt.map(At=>{if(!At?.id)return null;const _t=At.name||"Unnamed character",Pe=At.player?.username||At.player?.email||At.player?.name||"";return{id:String(At.id),label:Pe?`${_t} (${Pe})`:_t}}).filter(Boolean).sort((At,_t)=>At.label.localeCompare(_t.label,void 0,{sensitivity:"base"}));X(Ct)}catch(Ie){He||(console.error(" Failed to load characters for view-as context",Ie),X([]),I(Ie.message||"Unable to load characters"),T(""))}finally{He||Y(!1)}})(),()=>{He=!0}},[G,p,T]);const J=u.useMemo(()=>{if(H)return"Loading characters";if(V)return V;if(!E)return"Viewing entities as yourself (DM/owner)";const He=P.find(tt=>tt.id===E);return He?`Viewing as ${He.label}`:"Viewing as selected character"},[E,P,V,H]),ie=u.useMemo(()=>v?"Loading campaigns":S?"Unable to load campaigns":h.length?g?`${g.name}${g.world?.name?`  ${g.world.name}`:""}`:"Select a campaign":"No eligible campaigns",[h,S,v,g]),Z=u.useMemo(()=>g?.world?g.world.name?`Campaign world  ${g.world.name}`:"Campaign world selected":C?"Loading worlds":O?"Unable to load worlds":w.length?N?N.name?`World  ${N.name}`:"Selected world":"Select a world":"No accessible worlds",[g,N,C,O,w.length]),me=u.useMemo(()=>{const He=new Set,tt=[];if(w.forEach(Ie=>{if(!Ie?.id)return;const vt=String(Ie.id);He.has(vt)||(tt.push({id:vt,name:Ie.name||`World #${vt}`}),He.add(vt))}),g?.world?.id){const Ie=String(g.world.id);He.has(Ie)||tt.unshift({id:Ie,name:g.world.name||"Campaign world"})}return tt},[w,g]);u.useEffect(()=>{z||D(!1)},[z]);const Q=He=>{if(!l)return"";const tt=He?.members?.find(Ie=>Ie.user_id===l.id);return tt?tt.role==="dm"?"DM":tt.role==="player"?"Player":tt.role||"":l.role==="system_admin"?"System Admin":""},oe=()=>D(!1),ne=a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"campaign-selector",title:ie,children:[a.jsx("label",{htmlFor:"campaign-context-select",children:"Campaign"}),a.jsxs("select",{id:"campaign-context-select",value:p,onChange:M,disabled:v||!h.length&&!p,children:[a.jsx("option",{value:"",children:v?"Loading campaigns":S?"Unable to load campaigns":h.length?"Select a campaign":"No campaigns available"}),h.map(He=>{const tt=Q(He),Ie=[tt?`as ${tt}`:null,He.world?.name?`World: ${He.world.name}`:null].filter(Boolean).join("  "),vt=Ie?`${He.name} (${Ie})`:He.name;return a.jsx("option",{value:He.id,children:vt},He.id)})]})]}),a.jsxs("div",{className:"campaign-selector",title:Z,children:[a.jsx("label",{htmlFor:"world-context-select",children:"World"}),a.jsxs("select",{id:"world-context-select",value:j,onChange:A,disabled:C,children:[a.jsx("option",{value:"",children:g?.world?g.world.name?`Using ${g.world.name}`:"Using campaign world":C?"Loading worlds":O?"Unable to load worlds":w.length?"Select a world":"No worlds available"}),me.map(He=>a.jsx("option",{value:He.id,children:He.name},He.id))]})]}),G&&a.jsxs("div",{className:"campaign-selector",title:J,children:[a.jsx("label",{htmlFor:"character-context-select",children:"View as"}),a.jsxs("select",{id:"character-context-select",value:E,onChange:He=>T(He.target.value),disabled:H||!!V,children:[a.jsx("option",{value:"",children:H?"Loading characters":V||"Entire campaign context"}),P.map(He=>a.jsx("option",{value:He.id,children:He.label},He.id))]})]})]}),we=a.jsx("button",{type:"button",className:`menu-btn ${z?"menu-btn-icon":"menu-btn-text"}`,onClick:e,"aria-label":z?"Toggle navigation menu":void 0,children:z?a.jsx(HT,{size:20}):"Menu"}),ke=a.jsx("button",{type:"button",className:`history-btn ${z?"history-btn-icon":"history-btn-text"}`,title:"View recently viewed records","aria-label":z?"Open history":void 0,onClick:()=>U(!0),children:z?a.jsx(Ly,{size:20}):"History"}),Re=a.jsx("button",{type:"button",className:`context-btn ${z?"context-btn-icon":"context-btn-text"}`,onClick:()=>D(!0),"aria-label":z?"Change context":void 0,title:z?"Change context":void 0,disabled:!z,children:z?a.jsx(S1,{size:20}):"Context"}),Te=!!(p||j),rt=a.jsx("button",{type:"button",className:`search-btn ${z?"search-btn-icon":"search-btn-text"} ${Te?"":"disabled"}`,onClick:()=>Te&&B(!0),"aria-label":z?"Open search":void 0,title:z?Te?"Open search":"Select a campaign or world to search":void 0,disabled:!Te,children:z?a.jsx(ic,{size:20}):"Search"});return a.jsxs("header",{className:"app-header",children:[a.jsx("div",{className:"header-start",children:z?a.jsxs(a.Fragment,{children:[a.jsx("h1",{className:"title",children:a.jsx(Jt,{to:"/",className:"title-link",children:"GameDB"})}),we,Re,rt,ke]}):a.jsxs(a.Fragment,{children:[a.jsx("h1",{className:"title",children:a.jsx(Jt,{to:"/",className:"title-link",children:"GameDB"})}),we,ke]})}),!z&&a.jsxs("div",{className:"header-center",children:[ne,(p||j)&&a.jsx(z0,{isMobile:!1})]}),a.jsx("div",{className:"header-end",children:a.jsx(kR,{})}),a.jsxs("div",{className:"user-menu",ref:i,children:[a.jsx("button",{className:"user-icon",onClick:()=>r(!t),title:"User Menu",children:a.jsx(AM,{size:20})}),t&&a.jsxs("div",{className:"user-dropdown",children:[a.jsxs("div",{className:"user-info",children:[a.jsx("strong",{children:l?.username||"User"}),a.jsx("br",{}),a.jsx("small",{children:l?.role||""})]}),a.jsxs("button",{className:"dropdown-action",onClick:m,children:[f==="dark"?a.jsx(bM,{size:16}):a.jsx(XT,{size:16}),f==="dark"?"Light mode":"Dark mode"]}),a.jsxs(Jt,{to:"/security",className:"dropdown-action",onClick:()=>r(!1),children:[a.jsx(FT,{size:16}),"Security"]}),a.jsxs("button",{className:"dropdown-action logout",onClick:c,children:[a.jsx(zT,{size:16}),"Logout"]})]})]}),z&&F&&a.jsxs("div",{className:"mobile-context-overlay",role:"dialog","aria-modal":"true",children:[a.jsx("button",{className:"mobile-context-overlay-close",onClick:oe,"aria-label":"Close context picker"}),a.jsxs("div",{className:"mobile-context-panel",children:[a.jsxs("div",{className:"mobile-context-header",children:[a.jsx("h2",{children:"Choose context"}),a.jsx("button",{type:"button",onClick:oe,"aria-label":"Close context picker",children:a.jsx(ka,{size:20})})]}),a.jsx("div",{className:"mobile-context-body",children:ne})]})]}),a.jsx(xR,{isOpen:L,onClose:()=>U(!1)}),z&&k&&a.jsx(z0,{isMobile:!0,onClose:()=>B(!1)})]})}const XR=e=>e==null?"":String(e).trim(),Qr=e=>{let t={};typeof e=="string"?t={worldId:e}:e&&typeof e=="object"&&!Array.isArray(e)&&(t={...e});const r=new URLSearchParams,i=XR(t.worldId??t.world_id);if(!i)return Promise.reject(new Error("worldId is required to list entity types"));r.set("worldId",i);const l=r.toString(),c=l?`?${l}`:"";return Tt.get(`/entity-types${c}`)},KR=e=>Tt.post("/entity-types",e),WR=e=>Tt.get(`/entity-types/${e}`),ZR=(e,t)=>Tt.patch(`/entity-types/${e}`,t),QR=e=>Tt.delete(`/entity-types/${e}`),lf=(e,t="perform this action")=>e==null||e===""?Promise.reject(new Error(`Entity type id is required to ${t}`)):null,of=e=>{const t=lf(e,"load entity type field order");return t||Tt.get(`/entity-types/${e}/field-order`)},JR=(e,t)=>{const r=lf(e,"update entity type field order");return r||Tt.put(`/entity-types/${e}/field-order`,t)},cf=e=>{const t=lf(e,"load entity type field rules");return t||Tt.get(`/entity-types/${e}/field-rules`)},ek=(e,t)=>{const r=lf(e,"create entity type field rule");return r||Tt.post(`/entity-types/${e}/field-rules`,t)},P1=(e,t="perform this action")=>e==null||e===""?Promise.reject(new Error(`Field rule id is required to ${t}`)):null,zh=(e,t)=>{const r=P1(e,"update this field rule");return r||Tt.patch(`/entity-type-field-rules/${e}`,t)},tk=e=>{const t=P1(e,"delete this field rule");return t||Tt.delete(`/entity-type-field-rules/${e}`)},V1=(e,t={})=>{if(!e)return Promise.reject(new Error("worldId is required to load entity type usage"));const r=new URLSearchParams,i=t.viewAsCharacterId??t.characterId??t.character_id??t.viewAs;if(i!=null){const f=String(i).trim();f&&r.set("viewAsCharacterId",f)}const l=r.toString(),c=l?`?${l}`:"";return Tt.get(`/worlds/${e}/entity-types${c}`)},nk=e=>Tt.get(`/entity-types/${e}/list-columns`),ak=(e,t)=>Tt.patch(`/entity-types/${e}/list-columns`,t);function sk({open:e,pinned:t,allowPinning:r=!0,onPinToggle:i,onClose:l}){const c=Ga(),{user:f}=En(),{selectedCampaign:m,selectedCampaignId:h,activeWorld:p,activeWorldId:y,viewAsCharacterId:g,contextKey:v}=Bn(),[S,w]=u.useState(!1),[N,j]=u.useState(!1),[_,C]=u.useState(!1),[O,E]=u.useState(!1),[T,M]=u.useState(!1),[A,z]=u.useState([]),[P,X]=u.useState(!1),[H,Y]=u.useState("");u.useEffect(()=>{z([]),Y("")},[v]);const I=u.useMemo(()=>new URLSearchParams(c.search),[c.search]).get("entityType")??"",F=c.pathname==="/entities"||c.pathname.startsWith("/entities/"),D=y||"",L=f?.role==="system_admin",U=!!y,k=u.useMemo(()=>!m||!f?"":m.members?.find(Te=>Te?.user_id===f.id)?.role??"",[m,f]),B=u.useMemo(()=>{if(!p||!f?.id)return!1;const Re=p.created_by??p.creator?.id??p.owner_id??p.owner?.id??"";return Re?String(Re)===String(f.id):!1},[p,f?.id]),R=!!(U&&(L||k==="dm"||B)),q=!!(U&&(L||B)),G=!!(U&&(L||B)),J=!!(U&&(L||B)),ie=!!(U&&B),Z=u.useMemo(()=>!m||!Array.isArray(m.members)||!f?.id?!1:m.members.some(Re=>Re?.user_id===f.id&&Re?.role==="player"),[m,f]),me=u.useMemo(()=>!m||!Array.isArray(m.members)||!f?.id?!1:m.members.some(Re=>Re?.user_id===f.id&&Re?.role==="dm"),[m,f]),Q=!!(U&&(R||q||G||J||ie)),oe=u.useMemo(()=>h?L?!0:me||Z:!1,[L,me,Z,h]);u.useEffect(()=>{let Re=!1;if(!D){z([]),Y(""),X(!1);return}return(async()=>{X(!0),Y("");try{const rt=await V1(D,{viewAsCharacterId:g}),He=Array.isArray(rt?.data)?rt.data:Array.isArray(rt)?rt:[];Re||z(He)}catch(rt){Re||(console.error(" Failed to load entity types for world",rt),z([]),Y("Unable to load entity types"))}finally{Re||X(!1)}})(),()=>{Re=!0}},[D,v,g]);const ne=u.useCallback(Re=>Re==="/"?c.pathname==="/":c.pathname===Re||c.pathname.startsWith(`${Re}/`),[c.pathname]),we=u.useCallback(Re=>{U||(Re.preventDefault(),alert("Please select a campaign or world context before viewing entities."))},[U]),ke=u.useCallback(Re=>{if(t||Re.defaultPrevented)return;const Te=Re.target,rt=Te instanceof Element?Te:Te?.parentElement;if(!rt||typeof rt.closest!="function")return;const He=rt.closest("a");He&&Re.currentTarget.contains(He)&&l()},[t,l]);return a.jsxs("aside",{className:`sidebar ${e?"open":"closed"}`,children:[a.jsxs("div",{className:"sidebar-header",children:[a.jsx("span",{children:"Navigation"}),r&&a.jsx("button",{type:"button",className:`pin-btn ${t?"pinned":""}`,title:t?"Unpin menu":"Pin menu","aria-pressed":t,onClick:i,children:a.jsx(tM,{size:16,className:"pin-icon"})})]}),a.jsxs("nav",{className:"nav-links",onClick:t?void 0:ke,children:[a.jsx(Jt,{to:"/",className:ne("/")?"active":"",children:"Home"}),a.jsx(Jt,{to:"/worlds",className:ne("/worlds")?"active":"",children:"Worlds"}),Q&&a.jsxs("div",{className:`nav-group ${_?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>C(Re=>!Re),"aria-expanded":!_,"aria-controls":"world-admin-nav",children:[a.jsx("span",{className:"nav-heading",children:"World Admin"}),a.jsx(Br,{size:14,className:`nav-heading-icon ${_?"collapsed":""}`})]}),a.jsxs("div",{id:"world-admin-nav",className:"nav-sub-links",children:[R&&a.jsxs(Jt,{to:"/entities",className:`nav-entity-link ${F&&!I?"active":""}`,onClick:we,children:[a.jsx(k0,{size:16,className:"nav-icon"}),a.jsx("span",{children:"All Entities"})]}),R&&a.jsxs(Jt,{to:"/entity-relationships",className:`nav-entity-link ${ne("/entity-relationships")?"active":""}`,children:[a.jsx(D0,{size:16,className:"nav-icon"}),a.jsx("span",{children:"All Relationships"})]}),q&&a.jsxs(Jt,{to:"/entity-types",className:`nav-entity-link ${ne("/entity-types")?"active":""}`,children:[a.jsx(uM,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Entity Types"})]}),G&&a.jsxs(Jt,{to:"/entities/bulk-upload",className:`nav-entity-link ${ne("/entities/bulk-upload")?"active":""}`,children:[a.jsx(k0,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Bulk Entity Upload"})]}),J&&a.jsxs(Jt,{to:"/relationship-types",className:`nav-entity-link ${ne("/relationship-types")?"active":""}`,children:[a.jsx(D0,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Relationship Types"})]}),ie&&D&&a.jsxs(Jt,{to:`/worlds/${D}/access/bulk`,className:`nav-entity-link ${ne(`/worlds/${D}/access/bulk`)?"active":""}`,children:[a.jsx(_1,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Bulk Access Editor"})]}),ie&&D&&a.jsxs(Jt,{to:`/worlds/${D}/collections`,className:`nav-entity-link ${ne(`/worlds/${D}/collections`)?"active":""}`,children:[a.jsx(S1,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Collections"})]}),ie&&D&&a.jsxs(Jt,{to:`/worlds/${D}/access/audit`,className:`nav-entity-link ${ne(`/worlds/${D}/access/audit`)?"active":""}`,children:[a.jsx(x1,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Access Audit Log"})]}),B&&!U&&a.jsx("span",{className:"nav-helper",children:"Select a world you own to use the bulk access tools"})]})]}),a.jsxs("div",{className:`nav-group ${S?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>w(Re=>!Re),"aria-expanded":!S,"aria-controls":"campaigns-nav",children:[a.jsx("span",{className:"nav-heading",children:"Campaigns"}),a.jsx(Br,{size:14,className:`nav-heading-icon ${S?"collapsed":""}`})]}),a.jsxs("div",{id:"campaigns-nav",className:"nav-sub-links",children:[a.jsx(Jt,{to:"/campaigns/my",className:ne("/campaigns/my")?"active":"",children:"My Campaigns"}),a.jsx(Jt,{to:"/campaigns/all",className:ne("/campaigns/all")?"active":"",children:"All"})]})]}),a.jsxs("div",{className:`nav-group ${O?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>E(Re=>!Re),"aria-expanded":!O,"aria-controls":"entities-nav",children:[a.jsx("span",{className:"nav-heading",children:"Entities"}),a.jsx(Br,{size:14,className:`nav-heading-icon ${O?"collapsed":""}`})]}),a.jsxs("div",{id:"entities-nav",className:"nav-sub-links",children:[P&&a.jsx("span",{className:"nav-helper",children:"Loading entity types"}),!P&&H&&a.jsx("span",{className:"nav-helper error",children:H}),!P&&!H&&A.length===0&&a.jsx("span",{className:"nav-helper",children:U?"No entities in this world yet":"Select a campaign or world context to see entity types"}),A.map(Re=>a.jsxs(Jt,{to:`/entities?entityType=${Re.id}`,className:`nav-entity-type ${F&&I===Re.id?"active":""}`,children:[a.jsx("span",{className:"nav-entity-label",children:Re.name}),a.jsx("span",{className:"nav-entity-count",children:Re.entityCount})]},Re.id))]})]}),a.jsxs("div",{className:`nav-group ${T?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>M(Re=>!Re),"aria-expanded":!T,"aria-controls":"notes-nav",children:[a.jsx("span",{className:"nav-heading",children:"Notes"}),a.jsx(Br,{size:14,className:`nav-heading-icon ${T?"collapsed":""}`})]}),a.jsxs("div",{id:"notes-nav",className:"nav-sub-links",children:[!h&&a.jsx("span",{className:"nav-helper",children:"Select a campaign to view notes"}),h&&!oe&&a.jsx("span",{className:"nav-helper",children:"Notes are available to campaign members"}),oe&&a.jsxs(a.Fragment,{children:[a.jsxs(Jt,{to:"/notes/session",className:ne("/notes/session")?"active":"",children:[a.jsx(Up,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Session Notes"})]}),a.jsxs(Jt,{to:"/notes/entities",className:ne("/notes/entities")?"active":"",children:[a.jsx(Fp,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Entity Notes"})]})]})]})]}),a.jsxs("div",{className:`nav-group ${N?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>j(Re=>!Re),"aria-expanded":!N,"aria-controls":"characters-nav",children:[a.jsx("span",{className:"nav-heading",children:"Characters"}),a.jsx(Br,{size:14,className:`nav-heading-icon ${N?"collapsed":""}`})]}),a.jsxs("div",{id:"characters-nav",className:"nav-sub-links",children:[a.jsx(Jt,{to:"/characters/my",className:ne("/characters/my")?"active":"",children:"My Characters"}),h&&Z&&a.jsx(Jt,{to:"/characters/companions",className:ne("/characters/companions")?"active":"",children:"My Companions"}),h&&me&&a.jsx(Jt,{to:"/characters/others",className:ne("/characters/others")?"active":"",children:"All Characters"}),f?.role==="system_admin"&&a.jsx(Jt,{to:"/characters/all",className:ne("/characters/all")?"active admin-link":"admin-link",children:"All Characters"})]})]}),a.jsxs(Jt,{to:"/requests",className:ne("/requests")?"active":"",children:[a.jsx(Fp,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Feature/Bugs"})]}),f?.role==="system_admin"&&a.jsx(Jt,{to:"/users",className:c.pathname==="/users"?"active admin-link":"admin-link",title:"User Management (Admin Only)",children:"Users"})]})]})}function rk(){const e=()=>typeof window>"u"?!1:window.matchMedia("(max-width: 768px)").matches,[t,r]=u.useState(e),[i,l]=u.useState(()=>!e()),[c,f]=u.useState(!1),m=Ga(),h=u.useRef(i),p=u.useRef(!0);u.useEffect(()=>{if(typeof window>"u")return;const N=window.matchMedia("(max-width: 768px)"),j=_=>{r(_.matches)};return r(N.matches),typeof N.addEventListener=="function"?(N.addEventListener("change",j),()=>N.removeEventListener("change",j)):(N.addListener(j),()=>N.removeListener(j))},[]),u.useEffect(()=>{if(t)l(!1),f(!1);else{const N=p.current;l(N),f(j=>N?!1:j)}},[t]);const y=u.useCallback(()=>{f(N=>!N)},[]),g=u.useCallback(()=>{t||l(N=>{const j=!N;return p.current=j,f(!j),j})},[t]);u.useEffect(()=>{h.current=i},[i]),u.useEffect(()=>{if(i||!c)return;const N=j=>{const _=j.target;(_ instanceof Element?_:_&&"parentElement"in _?_.parentElement:null)?.closest?.(".sidebar")||f(!1)};return document.addEventListener("mousedown",N),()=>{document.removeEventListener("mousedown",N)}},[i,c]),u.useEffect(()=>{h.current||f(!1)},[m.pathname,m.search]);const v=(m.pathname||"").match(/^\/entities\/([^/]+)\/?$/),S=!!(v&&v[1]!=="bulk-upload"),w=["content",i?"pinned":"",S?"content--entity-detail":""].filter(Boolean).join(" ");return a.jsxs("div",{className:"app-shell",children:[a.jsx(GR,{onMenuToggle:y}),a.jsxs("div",{className:"app-body",children:[a.jsx(sk,{open:c||i,pinned:i,allowPinning:!t,onPinToggle:g,onClose:()=>f(!1)}),!i&&c&&a.jsx("button",{type:"button",className:"sidebar-overlay","aria-label":"Close navigation menu",onClick:()=>f(!1)}),a.jsxs("main",{className:w,children:[a.jsx(s2,{})," "]})]})]})}const Uu={dm:1,player:2,other:3},ik=(e,t)=>!e||!Array.isArray(e.members)||!t?null:e.members.find(r=>r?.user_id===t)??null;function lk(){const{user:e}=En(),{campaigns:t,loading:r,error:i,selectedCampaignId:l,setSelectedCampaignId:c,selectedCampaign:f,refreshCampaigns:m}=Bn(),h=e?.username||"Adventurer",[p,y]=u.useState([]),[g,v]=u.useState([]),[S,w]=u.useState(!1),[N,j]=u.useState(!1),[_,C]=u.useState(""),[O,E]=u.useState(""),T=u.useMemo(()=>Array.isArray(t)?[...t].map(H=>({campaign:H,membership:ik(H,e?.id)})).sort((H,Y)=>{const V=Uu[H.membership?.role]??Uu.other,I=Uu[Y.membership?.role]??Uu.other;return V!==I?V-I:H.campaign.name.localeCompare(Y.campaign.name)}):[],[t,e?.id]),M=H=>{H&&c(String(H))};u.useEffect(()=>{let H=!1;if(y([]),v([]),C(""),E(""),!l||!e?.id)return w(!1),j(!1),()=>{H=!0};const Y=I=>(Array.isArray(I?.data)?I.data:Array.isArray(I)?I:[]).map(D=>{const L=Number(D?.level);return{id:D?.id,name:D?.name||"Unnamed character",className:D?.class||"",level:Number.isNaN(L)?null:L,isActive:D?.is_active??!0,playerName:D?.player?.username||""}});return(async()=>{w(!0),j(!1);try{const I=await Ds({scope:"my",campaign_id:l});if(H)return;const F=Y(I);if(y(F),C(""),w(!1),F.length>0){j(!0);try{const D=await Ds({scope:"companions",campaign_id:l});if(H)return;const L=Y(D);v(L),E("")}catch(D){if(H)return;console.error(" Failed to load companions for home widgets",D),v([]),E(D.message||"Failed to load companions")}finally{H||j(!1)}}else v([]),E(""),j(!1)}catch(I){if(H)return;console.error(" Failed to load characters for home widgets",I),y([]),v([]),C(I.message||"Failed to load characters"),E(""),w(!1),j(!1)}})(),()=>{H=!0}},[l,e?.id]);const A=()=>r?a.jsxs("div",{className:"home-empty-state",children:[a.jsx(Nn,{className:"spin",size:24}),a.jsx("p",{children:"Loading your campaigns"})]}):i?a.jsxs("div",{className:"home-empty-state error",children:[a.jsx("p",{children:i}),a.jsx("button",{type:"button",className:"home-refresh",onClick:m,children:"Try again"})]}):T.length?a.jsx("div",{className:"campaign-grid",children:T.map(({campaign:H,membership:Y})=>{const V=String(H.id),I=l===V,F=Y?.role??"guest",D=F==="dm"?"Dungeon Master":F==="player"?"Player":"Observer";return a.jsxs("button",{type:"button",className:`campaign-card ${F} ${I?"active":""}`,onClick:()=>M(V),"aria-pressed":I,children:[a.jsxs("header",{children:[a.jsxs("span",{className:"campaign-role","aria-label":`Role: ${D}`,children:[F==="dm"?a.jsx(yT,{size:18}):a.jsx(xM,{size:18}),D]}),I&&a.jsx("span",{className:"campaign-pill",children:"Active"})]}),a.jsxs("div",{className:"campaign-body",children:[a.jsx("h3",{children:H.name}),H.world?.name&&a.jsxs("p",{className:"campaign-world",children:["World  ",H.world.name]})]}),a.jsx("footer",{children:a.jsx("span",{children:"Set campaign context"})})]},V)})}):a.jsxs("div",{className:"home-empty-state",children:[a.jsx(Ii,{size:24}),a.jsx("p",{children:"No campaigns yet. Join one to get started!"})]}),z=()=>S?a.jsxs("div",{className:"home-widget-empty",children:[a.jsx(Nn,{className:"spin",size:20}),a.jsx("p",{children:"Loading your characters"})]}):_?a.jsx("div",{className:"home-widget-error",children:a.jsx("p",{children:_})}):p.length?a.jsx("div",{className:"home-card-grid",children:p.map(H=>a.jsxs("article",{className:"home-card",children:[a.jsxs("header",{children:[a.jsx("h3",{children:H.name}),a.jsx("span",{className:`home-card-status ${H.isActive?"active":"inactive"}`,children:H.isActive?"Active":"Inactive"})]}),a.jsxs("div",{className:"home-card-meta",children:[H.className&&a.jsx("span",{children:H.className}),H.level!==null&&a.jsxs("span",{children:["Level ",H.level]})]})]},H.id))}):a.jsx("div",{className:"home-widget-empty",children:a.jsx("p",{children:"No characters in this campaign yet."})}),P=()=>N?a.jsxs("div",{className:"home-widget-empty",children:[a.jsx(Nn,{className:"spin",size:20}),a.jsx("p",{children:"Loading companions"})]}):O?a.jsx("div",{className:"home-widget-error",children:a.jsx("p",{children:O})}):g.length?a.jsx("div",{className:"home-card-grid",children:g.map(H=>a.jsxs("article",{className:"home-card",children:[a.jsxs("header",{children:[a.jsx("h3",{children:H.name}),a.jsx("span",{className:`home-card-status ${H.isActive?"active":"inactive"}`,children:H.isActive?"Active":"Inactive"})]}),a.jsxs("div",{className:"home-card-meta",children:[H.className&&a.jsx("span",{children:H.className}),H.level!==null&&a.jsxs("span",{children:["Level ",H.level]})]}),H.playerName&&a.jsxs("p",{className:"home-card-player",children:["Played by ",H.playerName]})]},H.id))}):a.jsx("div",{className:"home-widget-empty",children:a.jsx("p",{children:"No companions discovered in this campaign yet."})}),X=!!f&&p.length>0&&!_;return a.jsxs("div",{className:"home-page",children:[a.jsxs("section",{className:"home-hero",children:[a.jsxs("div",{className:"home-hero-text",children:[a.jsx("p",{className:"home-eyebrow",children:"Your Tabletop Worldbuilding Database"}),a.jsxs("h1",{children:["Welcome, ",h,"."]}),a.jsx("p",{className:"home-description",children:"Select a campaign to explore and build the world."})]}),f&&a.jsxs("div",{className:"home-active-campaign",children:[a.jsx("span",{className:"home-active-label",children:"Currently focused"}),a.jsx("h2",{children:f.name}),f.world?.name&&a.jsx("p",{children:f.world.name})]})]}),a.jsxs("section",{className:"home-section",children:[a.jsxs("div",{className:"home-section-header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"Your campaigns"}),a.jsx("p",{children:"Choose a tile below to update the active campaign context."})]}),a.jsx("button",{type:"button",className:"home-refresh",onClick:m,disabled:r,children:"Refresh"})]}),A()]}),X&&a.jsxs(a.Fragment,{children:[a.jsxs("section",{className:"home-section",children:[a.jsxs("div",{className:"home-section-header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"My Characters"}),a.jsxs("p",{children:["Quick access to your heroes in ",f.name,"."]})]}),a.jsx(Jt,{to:"/characters/my",className:"home-link",children:"Manage"})]}),z()]}),a.jsxs("section",{className:"home-section",children:[a.jsxs("div",{className:"home-section-header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"My Companions"}),a.jsxs("p",{children:["Meet the fellow adventurers journeying in ",f.name,"."]})]}),a.jsx(Jt,{to:"/characters/companions",className:"home-link",children:"View list"})]}),P()]})]})]})}function ok({columns:e,visibleCols:t,onChange:r,onClose:i}){const l=u.useRef(null);u.useEffect(()=>{const m=h=>{l.current&&!l.current.contains(h.target)&&i()};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[i]);const c=m=>{r(t.includes(m)?t.filter(h=>h!==m):[...t,m])},f=()=>{r(e.map(m=>m.key)),i()};return a.jsxs("div",{className:"column-picker",ref:l,children:[a.jsx("div",{className:"column-picker-list",children:e.map(m=>a.jsxs("label",{className:"column-option",children:[a.jsx("input",{type:"checkbox",checked:t.includes(m.key),onChange:()=>c(m.key)}),m.label]},m.key))}),a.jsx("button",{className:"reset-btn",onClick:f,children:"Reset Columns"})]})}function qy({value:e,onChange:t,placeholder:r="Search...",ariaLabel:i}){return a.jsx("input",{className:"search-input compact",type:"text",placeholder:r,"aria-label":i||r,value:e,onChange:l=>t(l.target.value)})}const ck={text:"string",string:"string",varchar:"string",number:"number",integer:"number",float:"number",decimal:"number",numeric:"number",boolean:"boolean",bool:"boolean",checkbox:"boolean",date:"date",datetime:"date",timestamp:"date"},$0={string:[{value:"contains",label:"contains"},{value:"not_contains",label:"doesn't contain"},{value:"equals",label:"is exactly"},{value:"not_equals",label:"is not"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"}],number:[{value:"equals",label:"is"},{value:"not_equals",label:"is not"},{value:"greater_than",label:"is greater than"},{value:"less_than",label:"is less than"},{value:"greater_or_equal",label:"is on or above"},{value:"less_or_equal",label:"is on or below"}],boolean:[{value:"is_true",label:"is true"},{value:"is_false",label:"is false"}],date:[{value:"on",label:"is on"},{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"on_or_before",label:"is on or before"},{value:"on_or_after",label:"is on or after"}]},ji={logic:"AND",conditions:[]},Fl=e=>{if(!e)return"string";const t=String(e).toLowerCase();return ck[t]||"string"},Vp=e=>{const t=Fl(e);return $0[t]||$0.string},Y1=(e,t="string")=>{if(e==null||e==="")return"Unassigned";const r=Fl(t);if(Array.isArray(e))return e.length?e.map(i=>Y1(i,t)).join(", "):"Unassigned";if(r==="date"){const i=e instanceof Date?e:new Date(e);return Number.isNaN(i.getTime())?String(e):i.toLocaleDateString()}return r==="boolean"?e?"True":"False":String(e)},Md=e=>{if(e==null||e==="")return null;const t=Number(e);return Number.isNaN(t)?null:t},Rd=e=>{if(e==null||e==="")return null;const t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?null:t},Yp=e=>{if(e==null||e==="")return null;if(typeof e=="string"){const t=e.trim();return t.length>0?t:null}if(typeof e=="object"&&!Array.isArray(e)){const t=e.id??e.value??e.key??e.slug??e.uuid??null;return t!=null?String(t).trim():null}if(Array.isArray(e)){for(const t of e){const r=Yp(t);if(r)return r}return null}return null},G1=e=>{if(e==null)return"";if(typeof e=="string")return e.toLowerCase();if(typeof e=="number")return String(e);if(typeof e=="boolean")return e?"true":"false";if(e instanceof Date)return e.toISOString().toLowerCase();if(Array.isArray(e))return e.map(t=>G1(t)).filter(Boolean).join(" ");if(typeof e=="object")try{return JSON.stringify(e).toLowerCase()}catch{return""}return String(e).toLowerCase()},uk=e=>{const t=e.trim().toLowerCase();return t?r=>G1(r).includes(t):()=>!0},dk=(e,t)=>e.localeCompare(t,void 0,{sensitivity:"base"}),fk=(e,t,r="string")=>{const i=Fl(r),l=e==null||e==="",c=t==null||t==="";if(l&&c)return 0;if(l)return 1;if(c)return-1;if(i==="number"){const f=Md(e),m=Md(t);return f===null&&m===null?0:f===null?1:m===null?-1:f-m}if(i==="date"){const f=Rd(e),m=Rd(t);return!f&&!m?0:f?m?f.getTime()-m.getTime():-1:1}if(i==="boolean"){const f=!!e;return f===!!t?0:f?-1:1}return dk(String(e),String(t))},mk=(e,t,r="string")=>{const{operator:i,value:l}=t,c=Fl(r),f=r&&String(r).toLowerCase()==="reference",m=h=>{if(f){const S=Yp(h),w=Yp(l)||String(l??"").trim(),N=S?String(S).toLowerCase():"",j=w?String(w).toLowerCase():"";switch(i){case"equals":return N===j&&N.length>0;case"not_equals":return N!==j||N.length===0;case"contains":return N.includes(j);case"not_contains":return!N.includes(j)}}if(c==="number"){const S=Md(h),w=Md(l);if(S===null&&w===null)return i==="equals";if(S===null||w===null)return!1;switch(i){case"equals":return S===w;case"not_equals":return S!==w;case"greater_than":return S>w;case"less_than":return S<w;case"greater_or_equal":return S>=w;case"less_or_equal":return S<=w;default:return!1}}if(c==="date"){const S=Rd(h),w=Rd(l);if(!S||!w)return!1;switch(i){case"on":return S.getFullYear()===w.getFullYear()&&S.getMonth()===w.getMonth()&&S.getDate()===w.getDate();case"before":return S.getTime()<w.getTime();case"after":return S.getTime()>w.getTime();case"on_or_before":return S.getTime()<=w.getTime();case"on_or_after":return S.getTime()>=w.getTime();default:return!1}}if(c==="boolean"){const S=!!h;return i==="is_true"?S===!0:i==="is_false"?S===!1:i==="equals"?S===(String(l).toLowerCase()==="true"):i==="not_equals"?S!==(String(l).toLowerCase()==="true"):!1}const p=String(h??""),y=String(l??""),g=p.toLowerCase(),v=y.toLowerCase();switch(i){case"contains":return g.includes(v);case"not_contains":return!g.includes(v);case"equals":return g===v;case"not_equals":return g!==v;case"starts_with":return g.startsWith(v);case"ends_with":return g.endsWith(v);default:return!1}};return Array.isArray(e)?e.length===0?m(""):i==="not_contains"?e.every(h=>!m(h)):e.some(h=>m(h)):m(e)},X1=e=>{if(!e||typeof e!="object")return!1;const{conditions:t}=e;return Array.isArray(t)?t.some(r=>r.field&&r.operator):!1},gd=(e="",t="string")=>({id:`condition-${Math.random().toString(36).slice(2)}`,field:e,operator:Vp(t)[0]?.value||"equals",value:""}),F0=(e,t)=>{if(!e||!t||typeof t!="string")return;const r=t.split(".");let i=e;for(const l of r){if(i==null)return;i=i[l]}return i},Io=e=>Array.isArray(e)?e:[],hk=(e=[])=>e.map(t=>({...t,dataType:Fl(t.dataType||t.type)})),pk={};function K1(e,t=pk){const r=u.useMemo(()=>hk(t.columns||[]),[t.columns]),i=u.useMemo(()=>new Map(r.map(L=>[L.key,L])),[r]),l=u.useCallback((L,U)=>{const k=i.get(U)||{};return typeof k.accessor=="function"?k.accessor(L):k.path?F0(L,k.path):F0(L,U)??L?.[U]},[i]),[c,f]=u.useState(""),[m,h]=u.useState({key:"",direction:"asc"}),[p,y]=u.useState(""),[g,v]=u.useState(ji),[S,w]=u.useState(new Set),N=u.useCallback(()=>{w(new Set)},[]),j=u.useCallback(L=>{L&&h(U=>{if(U.key===L){const k=U.direction==="asc"?"desc":"asc";return{key:L,direction:k}}return{key:L,direction:"asc"}})},[]),_=u.useCallback(L=>{y(U=>{const k=U===L?"":L;return k!==U&&N(),k})},[N]),C=u.useMemo(()=>uk(c),[c]),O=u.useMemo(()=>r.filter(L=>L.searchable!==!1),[r]),E=u.useMemo(()=>{if(!c)return Io(e);const L=C;return Io(e).filter(U=>O.some(k=>{const B=l(U,k.key);return L(B)}))},[e,C,l,O,c]),T=u.useMemo(()=>g||ji,[g]),M=u.useMemo(()=>Io(T.conditions),[T]),A=(T.logic||"AND").toUpperCase()==="OR"?"OR":"AND",z=X1(T),P=u.useMemo(()=>z?E.filter(L=>{const U=M.map(k=>{const B=i.get(k.field);if(!B||!k.operator)return!1;const R=l(L,k.field);return mk(R,k,B.dataType)});return A==="OR"?U.some(Boolean):U.every(Boolean)}):E,[E,M,i,l,A,z]),X=u.useMemo(()=>{const L=Io(P);if(!m.key)return L;const U=i.get(m.key);if(!U)return L;const k=[...L];return k.sort((B,R)=>{const q=l(B,m.key),G=l(R,m.key),J=fk(q,G,U.dataType);return m.direction==="asc"?J:-J}),k},[P,m,i,l]),H=u.useMemo(()=>{if(!p)return[];const L=i.get(p);if(!L)return[];const U=[],k=new Map;return X.forEach(B=>{const R=l(B,p),q=Y1(R,L.dataType),G=`${p}:${q}`;k.has(G)||(k.set(G,U.length),U.push({id:G,value:R,label:q,items:[]}));const J=k.get(G);U[J].items.push(B)}),U},[X,p,i,l]),Y=u.useCallback(L=>{L&&w(U=>{const k=new Set(U);return k.has(L)?k.delete(L):k.add(L),k})},[]),V=u.useCallback(L=>L?S.has(L):!1,[S]),I=u.useCallback(()=>{v(ji)},[]),F=u.useCallback(L=>{if(!L||typeof L!="object"){v(ji);return}const U=(L.logic||"AND").toUpperCase()==="OR"?"OR":"AND",k=Io(L.conditions).map(B=>{const R=i.get(B.field);return R?{...B,field:R.key,operator:B.operator||gd(R.key,R.dataType).operator,value:B.value??""}:null});v({logic:U,conditions:k.filter(Boolean)})},[i]);return{searchTerm:c,setSearchTerm:f,sortState:m,toggleSort:j,groupBy:p,setGroupBy:_,filters:T,setFilters:F,clearFilters:I,filterActive:z,data:X,groups:H,visibleData:p?H:X,getValue:l,toggleGroupCollapse:Y,isGroupCollapsed:V,columns:r}}const W1=e=>{if(!e||typeof e!="object")return e;const t=e.imageData!==void 0?e.imageData:e.image_data!==void 0?e.image_data:null,r=e.imageMimeType!==void 0?e.imageMimeType:e.image_mime_type!==void 0?e.image_mime_type:null;return e.imageData===t&&e.imageMimeType===r?e:{...e,imageData:t,imageMimeType:r}},Pa=e=>{if(!e||typeof e!="object")return null;const t=e.data&&typeof e.data=="object"&&"id"in e.data?e.data:e.entity&&typeof e.entity=="object"&&"id"in e.entity?e.entity:"id"in e?e:null;return t?W1(t):null},Ul=e=>{if(!e||typeof e!="object")return"";const t=e.imageData??e.image_data,r=e.imageMimeType??e.image_mime_type;return!t||!r?"":`data:${r};base64,${t}`},yk=Object.freeze([]);function oc({worldId:e,label:t,value:r,onChange:i,allowedTypeIds:l=[],disabled:c=!1,placeholder:f="Search entities",staticOptions:m,minSearchLength:h=2,onResolved:p,required:y=!1}){const[g,v]=u.useState(""),[S,w]=u.useState([]),[N,j]=u.useState(!1),[_,C]=u.useState(!1),[O,E]=u.useState(null),[T,M]=u.useState(""),A=u.useRef(null),z=u.useRef(null),P=u.useRef(p),X=u.useMemo(()=>[...l],[JSON.stringify(l)]),H=Array.isArray(m)?m:yk,Y=u.useMemo(()=>Array.isArray(H)?H.map((B,R)=>{if(B==null)return null;if(typeof B=="object"){const G=B.value??B.id??B.key??B.slug??`static-${R}`;if(G==null)return null;const J=B.label??B.name??B.title??B.display??B.displayName??G;return{id:String(G),name:String(J),entity_type:B.entity_type||B.entityType||null,typeName:B.typeName||null,_static:!0}}const q=String(B);return{id:q,name:q,_static:!0}}).filter(Boolean):[],[H]),V=B=>{if(!B)return"";const R=B.entity_type?.name||B.entityType?.name||B.typeName||B.type?.name||"";return R?`${B.name} (${R})`:B.name};u.useEffect(()=>{c&&C(!1)},[c]),u.useEffect(()=>()=>{z.current&&clearTimeout(z.current)},[]),u.useEffect(()=>{if(!r){E(null),v("");return}if(typeof r=="object"&&r.id){const G=V(r);(!O||O.id!==r.id)&&(E(r),v(G));return}if(typeof r!="string")return;const B=r;if(O?.id===B)return;const R=Y.find(G=>String(G.id)===String(B));if(R){E(R),v(V(R));return}let q=!1;return(async()=>{try{const G=await rr(B);if(q)return;const J=Pa(G);if(J?.id){E(J),v(V(J));return}}catch(G){q||console.warn("Entity lookup failed",G)}q||(E({id:B,name:B}),v(B))})(),()=>{q=!0}},[r,Y,O?.id]),u.useEffect(()=>{if(!g.trim()||O||c)return;const B=g.trim();if(B.length<h){w([]);return}return z.current&&clearTimeout(z.current),z.current=setTimeout(()=>{if(!e){w([]),j(!1);return}(async()=>{try{j(!0),M("");const R=await rf({worldId:e,query:B,typeIds:X,limit:20}),q=Array.isArray(R?.data)?R.data:R;w(Array.isArray(q)?q:[])}catch(R){console.error("Entity search failed",R),w([]),M(R.message||"Failed to search entities.")}finally{j(!1)}})()},400),()=>{z.current&&clearTimeout(z.current)}},[g,e,O,X,c,h]),u.useEffect(()=>{const B=R=>{A.current&&!A.current.contains(R.target)&&C(!1)};return document.addEventListener("mousedown",B),()=>document.removeEventListener("mousedown",B)},[]),u.useEffect(()=>{P.current=p},[p]),u.useEffect(()=>{P.current?.(O||null)},[O]);const I=u.useMemo(()=>{if(!Y.length)return[];if(!g.trim())return Y;const B=g.trim().toLowerCase();return Y.filter(R=>V(R).toLowerCase().includes(B))},[Y,g]),F=u.useMemo(()=>{const B=new Map,R=[];return I.forEach(q=>{const G=q?.id;if(G==null)return;const J=String(G);B.has(J)||(B.set(J,!0),R.push(q))}),S.forEach(q=>{const G=q?.id;if(G==null)return;const J=String(G);B.has(J)||(B.set(J,!0),R.push(q))}),R},[I,S]),D=B=>{B&&(E(B),v(V(B)),C(!1),w([]),M(""),i?.(B))},L=()=>{E(null),v(""),w([]),M(""),C(!1),i?.(null)},U=_&&F.length>0,k=_&&!N&&!F.length&&g.trim().length>=h&&!O;return a.jsxs("div",{className:"entity-search-select",ref:A,children:[t&&a.jsx("label",{children:t}),a.jsxs("div",{className:"entity-search-wrapper",children:[a.jsx("input",{type:"text",value:g,required:y,onChange:B=>{const R=B.target.value;v(R),E(null),c||C(!0)},onFocus:()=>{c||C(!0)},disabled:c,placeholder:f,className:"entity-search-input"}),O&&!c&&a.jsx("button",{type:"button",className:"clear-btn",onClick:L,title:"Clear selection","aria-label":"Clear selection",children:""})]}),N&&a.jsx("div",{className:"small text-muted",children:"Searching"}),T&&a.jsx("div",{className:"small text-warning",children:T}),U&&a.jsx("ul",{className:"entity-results",children:F.map(B=>a.jsx("li",{onMouseDown:R=>R.preventDefault(),onClick:()=>D(B),className:O?.id===B.id?"selected":"",children:V(B)},B.id))}),k&&a.jsx("div",{className:"small text-muted",style:{marginTop:"0.25rem"},children:"No matches found."})]})}const U0=e=>Array.isArray(e)?e:[],gk=e=>{const t=e?.options?.choices;return!Array.isArray(t)||t.length===0?[]:t.map((r,i)=>{if(r==null)return null;if(typeof r=="object"){const c=r.value??r.id??r.key??r.slug??`choice-${i}`,f=r.label??r.name??r.title??r.display??c;return c==null?null:{value:String(c),label:String(f??c)}}const l=String(r);return{value:l,label:l}}).filter(Boolean)};function Z1({open:e,onClose:t,fields:r=[],value:i=ji,worldId:l,onApply:c}){const f=Array.isArray(r)?r:[],m=f[0]?.key||"",[h,p]=u.useState(i.logic||"AND"),[y,g]=u.useState(()=>{const M=U0(i.conditions);return M.length>0?M.map(A=>({...A})):[gd(m,f[0]?.dataType)]}),[v,S]=u.useState(new Map);u.useEffect(()=>{if(!e)return;p(i.logic||"AND");const M=U0(i.conditions);M.length>0?g(M.map(A=>({...A}))):g([gd(m,f[0]?.dataType)])},[e,i,m,f]);const w=()=>{const M=y[0]?.field||m,A=f.find(z=>z.key===M);g(z=>[...z,gd(M,A?.dataType)])},N=(M,A)=>{g(z=>{const P=[...z],X=f.find(H=>H.key===A);return P[M]={...P[M],field:A,operator:Vp(X?.dataType)[0]?.value||"equals",value:""},P})},j=(M,A)=>{g(z=>{const P=[...z];return P[M]={...P[M],operator:A},P})},_=(M,A)=>{g(z=>{const P=[...z];return P[M]={...P[M],value:A},P})},C=M=>{g(A=>{if(A.length===1)return A;const z=[...A];return z.splice(M,1),z})},O=()=>{const M=y.map(A=>({...A})).filter(A=>A.field&&A.operator);if(M.length===0){c?.(ji);return}c?.({logic:h,conditions:M})},E=u.useMemo(()=>(Array.isArray(r)?r:[]).map(A=>({...A,originalDataType:A.dataType||A.type||"string",dataType:Fl(A.dataType||A.type)})),[r]),T=u.useCallback((M,A)=>{if(!M){S(X=>{const H=new Map(X),Y=y[A];return Y?.value&&H.delete(String(Y.value)),H});return}const z=String(M.id),P=M.name||`Entity ${z}`;S(X=>{const H=new Map(X);return H.set(z,P),H})},[y]);return e?a.jsx("div",{className:"condition-modal-backdrop",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"condition-modal",children:[a.jsxs("div",{className:"condition-modal-header",children:[a.jsx("h2",{children:"Filters"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:t,"aria-label":"Close filters",children:a.jsx(ka,{size:18})})]}),a.jsxs("div",{className:"condition-logic",children:[a.jsx("span",{children:"Match records where"}),a.jsxs("div",{className:"logic-toggle",role:"group","aria-label":"Filter logic",children:[a.jsx("button",{type:"button",className:`logic-btn${h==="AND"?" is-active":""}`,onClick:()=>p("AND"),children:"All conditions (AND)"}),a.jsx("button",{type:"button",className:`logic-btn${h==="OR"?" is-active":""}`,onClick:()=>p("OR"),children:"Any condition (OR)"})]})]}),a.jsx("div",{className:"condition-list",children:Array.isArray(y)&&y.map((M,A)=>{const z=E.find(V=>V.key===M.field)||E[0]||{dataType:"string",key:""},P=Vp(z.dataType),X=Array.isArray(P)?P:[],H=M.operator||X[0]?.value||"equals",Y=!["is_true","is_false"].includes(H);return a.jsxs("div",{className:"condition-row",children:[a.jsx("select",{className:"condition-field",value:M.field||z.key,onChange:V=>N(A,V.target.value),children:E.map(V=>a.jsx("option",{value:V.key,children:V.label},V.key))}),a.jsx("select",{className:"condition-operator",value:H,onChange:V=>j(A,V.target.value),children:X.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))}),Y?(()=>{const V=z.originalDataType||z.dataType,I=V==="boolean"||V==="bool",F=V==="enum",D=z.referenceTypeId||z.reference_type_id||z.referenceType?.id||null,L=(V==="reference"||z.dataType==="reference")&&D,U=(H==="equals"||H==="not_equals")&&(I||F||L);if(U&&I)return a.jsxs("select",{className:"condition-value",value:M.value??"",onChange:k=>_(A,k.target.value),children:[a.jsx("option",{value:"",children:"Select..."}),a.jsx("option",{value:"true",children:"True"}),a.jsx("option",{value:"false",children:"False"})]});if(U&&F){const k=gk(z),B=Array.isArray(k)?k:[];return B.length===0?a.jsx("input",{className:"condition-value",type:"text",value:M.value??"",onChange:R=>_(A,R.target.value),placeholder:"Value"}):a.jsxs("select",{className:"condition-value",value:M.value??"",onChange:R=>_(A,R.target.value),children:[a.jsx("option",{value:"",children:"Select..."}),B.map(R=>a.jsx("option",{value:R.value,children:R.label},R.value))]})}if(U&&L){const k=z.referenceTypeId||z.reference_type_id||z.referenceType?.id||null,B=k?String(k).trim():null,R=z.referenceTypeName||z.reference_type_name||z.referenceType?.name||"entities",q=M.value,G=B&&B.length>0?[B]:[],J=q||null;return a.jsx("div",{className:"condition-value-reference",children:a.jsx(oc,{worldId:l,value:J,allowedTypeIds:G,placeholder:`Search ${R.toLowerCase()}...`,disabled:!l||!B,onChange:ie=>{if(!ie)_(A,""),T(null,A);else{const Z=String(ie.id);_(A,Z),T(ie,A)}},onResolved:ie=>T(ie,A),minSearchLength:2})})}return a.jsx("input",{className:"condition-value",type:z.dataType==="number"?"number":z.dataType==="date"?"date":"text",value:M.value??"",onChange:k=>_(A,k.target.value),placeholder:"Value"})})():a.jsx("span",{className:"condition-value placeholder",children:"No value"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>C(A),disabled:y.length===1,"aria-label":"Remove condition",children:a.jsx(ma,{size:16})})]},M.id||`${M.field}-${A}`)})}),a.jsxs("div",{className:"condition-actions",children:[a.jsxs("button",{type:"button",className:"btn secondary",onClick:w,children:[a.jsx(Va,{size:16})," Add condition"]}),a.jsxs("div",{className:"condition-action-right",children:[X1(i)&&a.jsx("button",{type:"button",className:"btn ghost",onClick:()=>c?.(ji),children:"Clear filters"}),a.jsx("button",{type:"button",className:"btn submit",onClick:O,children:"Apply filters"})]})]})]})}):null}function uf({data:e,columns:t,title:r,extraActions:i,onRowClick:l}){const[c,f]=u.useState(t.map(T=>T.key)),[m,h]=u.useState(!1),[p,y]=u.useState(!1),[g,v]=u.useState({open:!1,column:null,x:0,y:0}),S=u.useMemo(()=>t.map(T=>({...T,dataType:T.dataType||T.type||"string"})),[t]),w=K1(e,{columns:S}),N=S.filter(T=>c.includes(T.key));u.useEffect(()=>{f(T=>{const M=S.map(z=>z.key),A=T.filter(z=>M.includes(z));return M.forEach(z=>{A.includes(z)||A.push(z)}),A.length===T.length&&A.every((z,P)=>z===T[P])?T:A})},[S]);const j=T=>{w.toggleSort(T.key)},_=(T,M)=>{T.preventDefault(),v({open:!0,column:M,x:T.clientX,y:T.clientY})};u.useEffect(()=>{if(!g.open)return;const T=()=>v({open:!1,column:null,x:0,y:0});return window.addEventListener("click",T),window.addEventListener("contextmenu",T),()=>{window.removeEventListener("click",T),window.removeEventListener("contextmenu",T)}},[g.open]);const C=T=>{w.setGroupBy(T.key),v({open:!1,column:null,x:0,y:0})},O=(T,M)=>{if(typeof M.render=="function")return M.render(T,w.getValue(T,M.key));const A=T[M.key];return A!==void 0?A:w.getValue(T,M.key)},E=w.groupBy?w.groups.some(T=>T.items.length>0):w.data.length>0;return a.jsxs("div",{className:"list-viewer",children:[a.jsxs("div",{className:"list-viewer-header",children:[a.jsx("h2",{children:r}),a.jsxs("div",{className:"list-controls",children:[i&&a.jsx("div",{className:"extra-actions",children:i}),a.jsx(qy,{value:w.searchTerm,onChange:w.setSearchTerm,placeholder:`Search ${r.toLowerCase()}...`}),a.jsxs("button",{type:"button",className:`btn secondary compact${w.filterActive?" is-active":""}`,onClick:()=>y(!0),children:[a.jsx(Qd,{size:16})," Filters"]}),a.jsxs("div",{className:"column-picker-wrapper",children:[a.jsx("button",{className:"icon-btn",title:"Column settings",onClick:()=>h(T=>!T),children:a.jsx(j1,{size:18})}),m&&a.jsx("div",{className:"column-picker-popover",children:a.jsx(ok,{columns:S,visibleCols:c,onChange:f,onClose:()=>h(!1)})})]})]})]}),E?a.jsx("div",{className:"list-viewer-table-wrapper",children:a.jsxs("table",{children:[a.jsx("thead",{children:a.jsx("tr",{children:N.map(T=>{const M=w.sortState.key===T.key,A=w.sortState.direction,z=w.groupBy===T.key;return a.jsx("th",{onClick:()=>j(T),onContextMenu:P=>_(P,T),className:"sortable-header",role:"button",tabIndex:0,children:a.jsxs("span",{className:"header-label",children:[T.label,M&&a.jsx("span",{className:"sort-indicator",children:A==="asc"?"":""}),z&&a.jsx("span",{className:"group-indicator",children:"Grouped"})]})},T.key)})})}),a.jsx("tbody",{children:w.groupBy?w.groups.map(T=>a.jsxs(u.Fragment,{children:[a.jsx("tr",{className:"group-header-row",children:a.jsxs("td",{colSpan:N.length,children:[a.jsx("button",{type:"button",className:"group-toggle",onClick:()=>w.toggleGroupCollapse(T.id),children:w.isGroupCollapsed(T.id)?a.jsx(Iy,{size:14}):a.jsx(Br,{size:14})}),a.jsxs("span",{className:"group-label",children:[T.label," ",a.jsxs("span",{className:"group-count",children:["(",T.items.length,")"]})]})]})}),!w.isGroupCollapsed(T.id)&&T.items.map(M=>a.jsx("tr",{onClick:()=>l&&l(M),className:l?"clickable-row":"",children:N.map(A=>a.jsx("td",{"data-column":A.label||A.key,children:O(M,A)},A.key))},M.id))]},T.id)):w.data.map(T=>a.jsx("tr",{onClick:()=>l&&l(T),className:l?"clickable-row":"",children:N.map(M=>a.jsx("td",{"data-column":M.label||M.key,children:O(T,M)},M.key))},T.id))})]})}):a.jsx("div",{className:"empty-state",children:a.jsx("p",{children:"No results found."})}),g.open&&g.column&&a.jsxs("div",{className:"column-context-menu",style:{top:g.y,left:g.x},role:"menu",children:[a.jsx("button",{type:"button",onClick:()=>C(g.column),children:w.groupBy===g.column.key?"Remove grouping":`Group by ${g.column.label}`}),w.groupBy&&w.groupBy!==g.column.key&&a.jsx("button",{type:"button",onClick:()=>C({key:""}),children:"Clear grouping"})]}),a.jsx(Z1,{open:p,onClose:()=>y(!1),fields:S.map(T=>({key:T.key,label:T.label,dataType:T.dataType})),value:w.filters,onApply:T=>{w.setFilters(T),y(!1)}})]})}const bk="modulepreload",vk=function(e){return"/"+e},B0={},Q1=function(t,r,i){let l=Promise.resolve();if(r&&r.length>0){let p=function(y){return Promise.all(y.map(g=>Promise.resolve(g).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};var f=p;document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),h=m?.nonce||m?.getAttribute("nonce");l=p(r.map(y=>{if(y=vk(y),y in B0)return;B0[y]=!0;const g=y.endsWith(".css"),v=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${v}`))return;const S=document.createElement("link");if(S.rel=g?"stylesheet":bk,g||(S.as="script"),S.crossOrigin="",S.href=y,h&&S.setAttribute("nonce",h),document.head.appendChild(S),g)return new Promise((w,N)=>{S.addEventListener("load",w),S.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${y}`)))})}))}function c(m){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=m,window.dispatchEvent(h),!h.defaultPrevented)throw m}return l.then(m=>{for(const h of m||[])h.status==="rejected"&&c(h.reason);return t().catch(c)})};function J1(e){if(!e&&e!==0)return null;if(typeof e=="object"&&e!==null){const r=e.value??e.id??e.key??e.slug??null;if(r==null)return null;const i=e.label??e.name??e.title??e.username??e.email??String(r);return{value:String(r),label:String(i),raw:e}}const t=String(e);return{value:t,label:t,raw:e}}function Ms({selected:e=[],options:t=[],onChange:r,placeholder:i="Search and select...",disabled:l=!1,noOptionsMessage:c="No options available.",loading:f=!1,inputId:m}){const[h,p]=u.useState(""),[y,g]=u.useState(!1),v=u.useRef(null),S=u.useMemo(()=>{const A=t.map(P=>J1(P)).filter(Boolean),z=new Set;return A.filter(P=>{const X=P.value;return z.has(X)?!1:(z.add(X),!0)})},[t]),w=u.useMemo(()=>{const A=new Set;return e.forEach(z=>{z!=null&&A.add(String(z))}),A},[e]),N=u.useMemo(()=>{const A=new Map(S.map(z=>[z.value,z]));return Array.from(w).map(z=>{const P=A.get(z);return P||{value:z,label:z}})},[S,w]),j=u.useMemo(()=>S.filter(A=>!w.has(A.value)),[S,w]),_=u.useMemo(()=>{if(!h)return j;const A=h.toLowerCase();return j.filter(z=>z.label.toLowerCase().includes(A))},[j,h]);u.useEffect(()=>{if(!y)return;const A=z=>{v.current&&(v.current.contains(z.target)||g(!1))};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[y]);const C=A=>{if(l)return;const z=[],P=new Set;A.forEach(X=>{if(X==null)return;const H=String(X);P.has(H)||(P.add(H),z.push(H))}),r?.(z)},O=A=>{if(!A)return;const z=[...w,A.value];C(z),p(""),g(!1)},E=A=>{const z=String(A),P=Array.from(w).filter(X=>X!==z);C(P)},T=y&&!l,M=()=>f?"Loading options...":j.length===0?w.size>0?"All options selected.":c:"No matches found.";return a.jsxs("div",{className:`list-collector ${l?"disabled":""}`,ref:v,children:[a.jsxs("div",{className:"list-collector-input-wrapper",children:[a.jsx("input",{id:m,type:"text",className:"list-collector-input",value:h,placeholder:i,disabled:l,onFocus:()=>!l&&g(!0),onChange:A=>{p(A.target.value),y||g(!0)},onKeyDown:A=>{A.key==="Enter"&&_.length>0&&(A.preventDefault(),O(_[0])),A.key==="Escape"&&(g(!1),A.currentTarget.blur())}}),a.jsx("span",{className:"list-collector-icon","aria-hidden":"true",children:""})]}),T&&a.jsx("div",{className:"list-collector-dropdown",children:_.length>0?a.jsx("ul",{children:_.map(A=>a.jsx("li",{children:a.jsx("button",{type:"button",onMouseDown:z=>z.preventDefault(),onClick:()=>O(A),className:"list-collector-option",children:A.label})},A.value))}):a.jsx("div",{className:"list-collector-empty",children:M()})}),N.length>0&&a.jsx("div",{className:"list-collector-pills",children:N.map(A=>a.jsxs("span",{className:"list-collector-pill",children:[a.jsx("span",{className:"pill-label",children:A.label}),!l&&a.jsx("button",{type:"button",className:"pill-remove",onClick:()=>E(A.value),"aria-label":`Remove ${A.label}`,children:""})]},A.value))})]})}const xk=e=>e===null?"null":e===void 0?"undefined":Array.isArray(e)?"array":e instanceof Date?"date":typeof e,df=(e,t,r={})=>{const i=(c,f,m,h="<<anonymous>>")=>{const p=f[m];return p==null?(c&&console.warn(`[PropTypes] Prop "${m}" is marked as required in "${h}", but its value is ${String(p)}.`),null):e(p,f,m,h)?(r.afterValidate&&r.afterValidate(p,f,m,h),null):(console.warn(`[PropTypes] Invalid prop "${m}" supplied to "${h}". Expected ${t}, but received ${xk(p)}.`),null)},l=i.bind(null,!1);return l.isRequired=i.bind(null,!0),l._validate=c=>c==null||e(c),l._expectedDescription=t,l},Bu=e=>df(t=>typeof t===e,e),Sk=()=>df(e=>e!==null&&typeof e=="object"&&!Array.isArray(e)&&!(e instanceof Date),"object"),wk=e=>{const t=c=>Array.isArray(c)?!e||typeof e!="function"?!0:c.every(f=>e._validate?e._validate(f):!0):!1,r=(c,f,m,h)=>{Array.isArray(c)&&(!e||typeof e!="function"||c.forEach((p,y)=>{try{e({[`${m}[${y}]`]:p},`${m}[${y}]`,h)}catch{}}))},i=`an array of ${e?._expectedDescription??"the specified type"}`,l=df(t,i,{afterValidate:r});return l._validate=c=>c==null?!0:Array.isArray(c)?c.every(f=>e&&e._validate?e._validate(f):!0):!1,l},Nk=e=>{const t=Array.isArray(e)?e.filter(Boolean):[],r=c=>t.some(f=>f&&typeof f._validate=="function"?f._validate(c):!0),i=t.map(c=>c?._expectedDescription).filter(Boolean),l=i.length>0?i.join(", "):"one of the specified types";return df(r,l)},rn={string:Bu("string"),number:Bu("number"),bool:Bu("boolean"),func:Bu("function"),object:Sk(),arrayOf:e=>wk(e),oneOfType:e=>Nk(e)},Gr=e=>e?Array.isArray(e)?e:Array.isArray(e.data)?e.data:[]:[],Gp=e=>{if(e==null)return null;if(typeof e=="string"){const t=e.trim();return t?t.toLowerCase():null}if(typeof e=="number")return String(e);if(typeof e=="object"){if(Array.isArray(e)){for(const t of e){const r=Gp(t);if(r)return r}return null}return Gp(e.fieldKey??e.field_key??e.key??e.name??e.id)??null}return null},Mn=(e,t)=>{const r=Gp(t);r&&e.add(r)},Ek=e=>{if(!e||typeof e!="object")return[];const t=new Set;return Mn(t,e.id),Mn(t,e.field_id),Mn(t,e.entity_type_field_id),Mn(t,e.fieldId),Mn(t,e.name),Mn(t,e.key),Mn(t,e.field),Mn(t,e.metadataField),Mn(t,e.metadata_field),e?.sourceField&&Mn(t,e.sourceField),e?.source_field&&Mn(t,e.source_field),Array.from(t)},jk=e=>Array.isArray(e)?e.map((t,r)=>{if(!t||typeof t!="object")return null;const i=new Set;if(Mn(i,t.fieldKey),Mn(i,t.field_key),Mn(i,t.field),Mn(i,t.fieldName),Mn(i,t.field_name),Mn(i,t.fieldId),Mn(i,t.field_id),Mn(i,t.target),Mn(i,t.targetField),Mn(i,t.target_field),Mn(i,t.metadataField),Mn(i,t.metadata_field),Mn(i,t.entity_type_field_id),Mn(i,t.name),Mn(i,t.key),t.field&&typeof t.field=="object"&&(Mn(i,t.field.id),Mn(i,t.field.name),Mn(i,t.field.key)),!i.size)return null;const l=(y,g=0)=>{if(y==null||y==="")return g;const v=Number(y);return Number.isFinite(v)?v:g},c=l(t.sectionOrder??t.section_order??t.sectionIndex??t.section_index,0),f=l(t.column??t.columnOrder??t.column_index??t.columnIndex,0),m=l(t.fieldOrder??t.field_order??t.order??t.order_index??t.position??t.sortOrder??t.sort_order,r),h=l(t.priority??t.weight??t.rank,r),p=c*1e6+f*1e4+m*100+h;return{identifiers:Array.from(i),rank:p,sectionOrder:c,columnOrder:f,fieldPosition:m,priority:h}}).filter(Boolean):[],Hy=(e=[],t=[])=>{if(!Array.isArray(e)||e.length===0)return[];const r=jk(t),i=new Map;r.length>0&&r.forEach(f=>{f.identifiers.forEach(m=>{i.has(m)||i.set(m,f.rank)})});const l=(f,m)=>{if(f==null||f==="")return m;const h=Number(f);return Number.isFinite(h)?h:m},c=e.map((f,m)=>{const h=Ek(f);let p=Number.POSITIVE_INFINITY;h.forEach(g=>{if(!g)return;const v=i.get(g);v!==void 0&&v<p&&(p=v)});const y=l(f?.sortOrder??f?.sort_order,m);return{field:f,rank:p,fallbackSort:y,index:m}});return c.sort((f,m)=>{const h=Number.isFinite(f.rank),p=Number.isFinite(m.rank);return h&&p&&f.rank!==m.rank?f.rank-m.rank:h&&!p?-1:!h&&p?1:f.fallbackSort!==m.fallbackSort?f.fallbackSort-m.fallbackSort:f.index-m.index}),c.map(f=>f.field)},Py=e=>!!e&&typeof e=="object"&&!Array.isArray(e),_k=e=>Array.isArray(e)?e:e==null?[]:[e],bs=e=>e==null?null:typeof e=="string"?e.trim()||null:typeof e=="number"?String(e):Py(e)?bs(e.field??e.fieldKey??e.field_name??e.source??e.sourceField??e.source_field??e.key??e.name??e.target??e.targetField??e.target_field??e.metadataField??e.metadata_field??e.id)??null:null,Ck=e=>{if(!e||typeof e!="object")return null;const t=l=>l==null?null:String(l).trim()||null,r=t(e.key??e.name??e.field);if(r&&r.startsWith("metadata."))return r;const i=t(e.metadataField??e.metadata_field)||(r&&!r.includes(".")?r:null)||t(e.name);return i?i.startsWith("metadata.")?i:`metadata.${i}`:r},Ak=(e=[])=>{const t=new Map,r=(i,l)=>{if(!i||!l)return;const c=bs(i),f=bs(l);!c||!f||(t.set(c,f),t.set(c.toLowerCase(),f))};return e.forEach(i=>{if(!i||typeof i!="object")return;const l=Ck(i);if(!l)return;r(l,l),[i.id,i.field_id,i.fieldId,i.entity_type_field_id,i.field,i.name,i.key,i.metadataField,i.metadata_field,i.fieldKey,i.field_key,i.target,i.targetField,i.target_field,i.source,i.sourceField,i.source_field].forEach(f=>r(f,l))}),t},Tk={eq:"equals","=":"equals","==":"equals","===":"equals",equals:"equals",equal:"equals",match:"equals",matches:"equals",ne:"not_equals","!=":"not_equals","!==":"not_equals",not:"not_equals",notequals:"not_equals",not_equals:"not_equals",different:"not_equals",contains:"contains",includes:"contains",has:"contains",not_contains:"not_contains",excludes:"not_contains",notincludes:"not_contains",in:"in",any:"in",within:"in",not_in:"not_in",none:"not_in",outside:"not_in",gt:"gt",greater:"gt",greater_than:"gt",gte:"gte",ge:"gte",greater_or_equal:"gte",lt:"lt",less:"lt",less_than:"lt",lte:"lte",le:"lte",less_or_equal:"lte",is_set:"is_set",isset:"is_set",set:"is_set",exists:"is_set",present:"is_set",is_not_set:"is_not_set",notset:"is_not_set",missing:"is_not_set",empty:"is_empty",is_empty:"is_empty",not_empty:"is_not_empty",filled:"is_not_empty",truthy:"truthy",falsy:"falsy"},Mk=e=>{if(e==null)return"equals";const t=String(e).trim().toLowerCase();return Tk[t]??"equals"},Rk={all:"all",every:"all",and:"all",any:"any",some:"any",or:"any",either:"any",none:"none",not:"none"},kk=e=>{if(e==null)return"all";const t=String(e).trim().toLowerCase();return Rk[t]??"all"},Dk={show:"show",display:"show",reveal:"show",visible:"show",enable:"show",hide:"hide",remove:"hide",conceal:"hide",hidden:"hide",disable:"hide",require:"require",required:"require",mandatory:"require",optional:"optional",option:"optional",allow:"optional"},Ik=e=>{if(e==null)return null;const t=String(e).trim().toLowerCase();return Dk[t]??null},q0=(e,t=0)=>{if(!e)return null;if(!Py(e)){if(typeof e=="string"){const[f,...m]=e.split("="),h=bs(f);if(!h)return null;const p=m.join("=").trim();return{field:h,operator:"equals",values:p?[p]:[]}}return null}const r=bs(e.field??e.fieldKey??e.field_name??e.source??e.sourceField??e.source_field??e.input??e.left??e.property??e.key??e.name);if(!r)return null;const i=Mk(e.operator??e.comparator??e.condition??e.type),l=e.values??e.value??e.match??e.compareTo??e.matchValue??e.expected,c=_k(l).filter(f=>f!==void 0);return{field:r,operator:i,values:c,id:e.id??`condition-${t}`}},Lk=e=>{const t=["conditions","criteria","when","rules","predicates","matchers"];for(const i of t)if(Array.isArray(e?.[i]))return e[i].map((l,c)=>q0(l,c)).filter(Boolean);const r=q0(e,0);return r?[r]:[]},$h=(e,t=0)=>{if(!e||!Py(e)&&typeof e!="string")return null;if(typeof e=="string"){const l=bs(e);return l?{target:l,action:"show",id:`action-${t}`}:null}const r=bs(e.target??e.targetField??e.target_field??e.field??e.fieldKey??e.field_name??e.path??e.name??e.key??e.metadataField??e.metadata_field),i=Ik(e.action??e.type??e.behavior??e.behaviour??e.effect??e.command);return!r||!i?null:{target:r,action:i,id:e.id??`action-${t}`}},Ok=e=>{const t=["actions","effects","apply","then","responses"];for(const i of t)if(Array.isArray(e?.[i]))return e[i].map((l,c)=>$h(l,c)).filter(Boolean);if(Array.isArray(e?.targets)&&e.targets.length>0)return e.targets.map((i,l)=>$h({target:i,action:e.action??e.effect??e.behavior??e.behaviour},l)).filter(Boolean);const r=e.target??e.targetField??e.target_field??e.actionTarget??e.fieldTarget??e.metadataField??e.metadata_field;return r&&(e.action||e.effect||e.behavior||e.behaviour)?[$h({target:r,action:e.action??e.effect??e.behavior??e.behaviour})].filter(Boolean):[]},Xp=e=>{if(e==null)return"";if(typeof e=="number"&&Number.isFinite(e))return String(e);if(typeof e=="boolean")return e?"true":"false";if(e instanceof Date)return String(e.getTime());if(typeof e=="string")return e.trim().toLowerCase();if(Array.isArray(e))return e.map(t=>Xp(t));if(typeof e=="object")try{return JSON.stringify(e)}catch{return String(e)}return String(e)},ms=(e,t)=>{if(Array.isArray(e))return e.some(f=>ms(f,t));if(Array.isArray(t))return t.some(f=>ms(e,f));const r=Number(e),i=Number(t);if(!Number.isNaN(r)&&!Number.isNaN(i))return r===i;const l=Xp(e),c=Xp(t);return l===c},hl=e=>e==null?!1:typeof e=="string"?e.trim().length>0:Array.isArray(e)?e.length>0:e instanceof Date?!0:typeof e=="object"?Object.keys(e).length>0:!0,zk=(e,t)=>{if(t==null)return;let r=t;if(typeof r!="string"){const l=bs(r);if(!l)return;r=l}if(!r)return;const i=r.replace(/\[(.*?)\]/g,(l,c)=>`.${c.replace(/^['"]|['"]$/g,"")}`).split(".").map(l=>l.trim()).filter(l=>l.length>0);if(i.length)return i.reduce((l,c)=>{if(l!=null)return c==="*"?l:l[c]},e)},Fh=(e,t)=>{if(!e)return!1;const{field:r,operator:i,values:l=[]}=e,c=zk(t,r);switch(i){case"equals":return l.length?l.some(f=>ms(c,f)):!1;case"not_equals":return l.length?l.every(f=>!ms(c,f)):hl(c);case"contains":return Array.isArray(c)?c.some(f=>l.some(m=>ms(f,m))):typeof c=="string"?l.some(f=>f==null?!1:c.toLowerCase().includes(String(f).toLowerCase())):!1;case"not_contains":return Array.isArray(c)?c.every(f=>l.every(m=>!ms(f,m))):typeof c=="string"?l.every(f=>f==null?!0:!c.toLowerCase().includes(String(f).toLowerCase())):!0;case"in":return l.length?Array.isArray(c)?c.some(f=>l.some(m=>ms(f,m))):l.some(f=>ms(c,f)):!1;case"not_in":return l.length?Array.isArray(c)?c.every(f=>l.every(m=>!ms(f,m))):l.every(f=>!ms(c,f)):!0;case"gt":case"gte":case"lt":case"lte":{const f=Number(c);if(Number.isNaN(f))return!1;const m=l.find(p=>p!=null),h=Number(m);return Number.isNaN(h)?!1:i==="gt"?f>h:i==="gte"?f>=h:i==="lt"?f<h:f<=h}case"is_set":return hl(c);case"is_not_set":return!hl(c);case"is_empty":return!hl(c);case"is_not_empty":return hl(c);case"truthy":return!!c;case"falsy":return!c;default:return l.length?l.some(f=>ms(c,f)):hl(c)}},$k=(e,t)=>{const r=Array.isArray(e?.conditions)?e.conditions:[];if(r.length===0)return!0;switch(e?.matchMode){case"any":return r.some(i=>Fh(i,t));case"none":return!r.some(i=>Fh(i,t));case"all":default:return r.every(i=>Fh(i,t))}},Vy=(e=[],t=[])=>{if(!Array.isArray(e))return[];const r=Ak(t),i=c=>{const f=bs(c);if(!f)return typeof c=="string"?c:null;if(r.size>0){const m=r.get(f)||r.get(f.toLowerCase());if(m)return m}return f},l=e.map((c,f)=>{if(!c||typeof c!="object"||c.disabled||c.enabled===!1)return null;const m=Array.isArray(c.conditions)&&Array.isArray(c.actions)&&c.conditions.every(w=>w?.field&&w?.operator)&&c.actions.every(w=>w?.target&&w?.action),h=m?c.conditions.map(w=>({...w})):Lk(c),p=m?c.actions.map(w=>({...w})):Ok(c);if(!h.length||!p.length)return null;const y=h.map(w=>{const N=i(w?.field);return N?{...w,field:N}:null}).filter(Boolean),g=p.map(w=>{const N=i(w?.target);return N?{...w,target:N}:null}).filter(Boolean);if(!y.length||!g.length)return null;const v=c.priority??c.order??c.sort??c.rank??f,S=Number.isFinite(Number(v))?Number(v):f;return{id:c.id??`field-rule-${f}`,name:c.name??c.label??"",matchMode:kk(c.matchMode??c.match_mode??c.matchType??c.logic??c.condition),conditions:y,actions:g,priority:S}}).filter(Boolean);return l.sort((c,f)=>c.priority-f.priority),l},Yy=(e,t={})=>{const r=Array.isArray(e)?e:[],i=t&&typeof t=="object"?t:{},l={},c=new Set;return r.forEach(f=>{!f||!$k(f,i)||f.actions.forEach(h=>{if(!h?.target||!h?.action)return;const p=h.target,y=bs(p)?.toLowerCase()??null;l[p]=h.action,y&&l[y]===void 0&&(l[y]=h.action),h.action==="show"?(c.add(p),y&&c.add(y)):h.action==="hide"&&(c.delete(p),y&&c.delete(y))})}),{actionsByField:l,showRuleTargets:c}},cc=(e,t,r=new Set,i=!0)=>{if(!e)return!1;const l=typeof t=="string"?t.toLowerCase():"",c=bs(e)?.toLowerCase()??null;return r instanceof Set&&(r.has(e)||(c?r.has(c):!1))||l==="show"?!1:l==="hide"||l==="hidden"||i===!1},eN=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?typeof e=="string"?e:String(e):t.toLocaleString()},Fk=e=>{const t=e?.value;if(t==null)return"";switch(e?.dataType){case"boolean":return!!t;case"number":{const r=Number(t);return Number.isNaN(r)?t:r}case"enum":return typeof t=="object"&&t!==null?t.value??t.id??t.key??t.slug??t.name??"":t;case"date":return eN(t);case"reference":if(typeof t=="object"&&t!==null){const r=t.label??t.name??t.title??t.display??t.displayName??t.text??t.value??t.id;if(r==null)try{return JSON.stringify(t,null,2)}catch(i){return console.warn(" Failed to serialise reference metadata field",i),String(t)}return String(r)}return t;case"text":if(typeof t=="object")try{return JSON.stringify(t,null,2)}catch(r){return console.warn(" Failed to serialise text metadata field",r),String(t)}return t;default:if(typeof t=="object")try{return JSON.stringify(t,null,2)}catch(r){return console.warn(" Failed to serialise metadata field",r),String(t)}return t}},Uk=e=>{const t=e?.value;return t==null?e?.dataType==="boolean"?!1:"":e?.dataType==="boolean"?!!t:e?.dataType==="reference"&&typeof t=="object"&&t!==null?t.value??t.id??t.key??t.slug??t.uuid??"":t},tN=(e=[])=>!Array.isArray(e)||e.length===0?{}:e.reduce((t,r)=>(r?.name&&(t[r.name]=Fk(r)),t),{}),Bk=(e=[])=>!Array.isArray(e)||e.length===0?{}:e.reduce((t,r)=>(r?.name&&(t[r.name]=Uk(r)),t),{}),qk=(e=[])=>!Array.isArray(e)||e.length===0?{}:e.reduce((t,r)=>{if(!r?.name||r.dataType!=="reference")return t;const i=(()=>{if(r.displayValue)return r.displayValue;if(r.display)return r.display;if(r.selectedLabel)return r.selectedLabel;const l=r.value;return!l||typeof l!="object"?null:l.label??l.name??l.title??l.display??l.displayName??l.text??l.value??l.id??null})();return i==null||(t[r.name]=String(i)),t},{}),Gy=e=>{if(e==null||e==="")return null;if(typeof e=="string"){const t=e.trim();return t.length>0?t:null}if(typeof e=="number"||typeof e=="bigint")return String(e);if(typeof e=="object"&&!Array.isArray(e)){const t=e.id??e.value??e.entity_id??e.entityId??e.key??e.slug??e.uuid??null;if(t!=null){const r=String(t).trim();return r.length>0?r:null}return null}if(Array.isArray(e)){for(const t of e){const r=Gy(t);if(r)return r}return null}return null},Xy=e=>{if(e==null)return null;if(typeof e=="object"&&!Array.isArray(e)){const t=e.displayValue??e.display??e.label??e.name??e.title??e.displayName??e.text??null;if(t!=null){const r=String(t).trim();return r.length>0?r:null}return null}if(Array.isArray(e)){for(const t of e){const r=Xy(t);if(r)return r}return null}return null},H0=450,Uh="preparing-open",nN=e=>{if(e==null)return"";if(Array.isArray(e)){const t=e.map(r=>r==null?null:typeof r=="object"?r.label||r.name||r.title||r.value||r.id||null:String(r)).filter(Boolean);return t.length>0?t.join(", "):""}if(typeof e=="object")try{return JSON.stringify(e,null,2)}catch(t){return console.warn(" Failed to serialise metadata value",t),String(e)}return typeof e=="boolean"?e?"Yes":"No":e===""?"":String(e)},P0=e=>{if(!e||typeof e!="object")return null;const t=e.displayValue??e.label??e.name??e.title??e.display??e.displayName??e.text??e.value??e.id;return t==null?null:String(t)},Hk=e=>{if(!e)return"";const{dataType:t,value:r}=e;if(r==null)return t==="boolean"?"No":"";switch(t){case"boolean":return r?"Yes":"No";case"number":{const i=Number(r);return Number.isNaN(i)?String(r):String(i)}case"enum":return typeof r=="object"&&r!==null?r.label||r.name||r.title||r.value||r.id||"":String(r);case"reference":{if(Array.isArray(r)){const i=r.map(c=>c==null?null:typeof c=="object"?P0(c)||null:String(c)).filter(Boolean);if(i.length>0)return i.join(", ");const l=e.displayValue||e.display||e.selectedLabel||e.referenceName||e.referenceLabel;return l?String(l):""}if(typeof r=="object"&&r!==null){const i=P0(r);if(i)return i;try{return JSON.stringify(r,null,2)}catch(l){return console.warn(" Failed to serialise reference metadata value",l),String(r)}}if(r==="")return"";if(e.displayValue||e.display||e.selectedLabel){const i=e.displayValue||e.display||e.selectedLabel;return i?String(i):""}return String(r)}case"date":return eN(r);case"text":default:return nN(r)}},Pk=(e,t)=>{if(!e)return[];const r=Array.isArray(e.fields)?e.fields:[];if(r.length>0)return Hy(r,t).filter(c=>c?.name||c?.label).map((c,f)=>{const m=c.name||c.label||`field-${f}`,h=c.label||c.name||`Field ${f+1}`,p=c?.name?`metadata.${c.name}`:c?.key||m,y=c.visibleByDefault!==void 0?!!c.visibleByDefault:c.visible_by_default!==void 0?!!c.visible_by_default:!0;return{key:m,label:h,value:Hk(c),fieldKey:p,visibleByDefault:y}});const i=e.metadata&&typeof e.metadata=="object"&&e.metadata||e.meta&&typeof e.meta=="object"&&e.meta||null;return i?Object.entries(i).map(([l,c])=>({key:l,label:l,value:nN(c),fieldKey:l&&`metadata.${l}`,visibleByDefault:!0})):[]},Vk=e=>{if(!e)return{};if(Array.isArray(e.fields)&&e.fields.length>0)return tN(e.fields);const t=e.metadata&&typeof e.metadata=="object"&&e.metadata||e.meta&&typeof e.meta=="object"&&e.meta||null;return t?{...t}:{}};function Ky({entity:e,entityId:t,onClose:r,isLoading:i=!1,error:l="",fallbackName:c="",fieldOrder:f=[],fieldRules:m=[]}){const h=$n(),[p,y]=u.useState(()=>t?{entity:e,entityId:t,isLoading:i,error:l,fallbackName:c}:null),[g,v]=u.useState(t?"open":"closed"),S=u.useRef(null),w=u.useRef(null);u.useEffect(()=>()=>{w.current&&(clearTimeout(w.current),w.current=null)},[]),u.useEffect(()=>{if(t&&S.current?.entityId===t&&(S.current={entity:e,entityId:t,isLoading:i,error:l,fallbackName:c}),t){if(!p){y({entity:e,entityId:t,isLoading:i,error:l,fallbackName:c}),v(Uh);return}if(p.entityId===t){y(R=>!R||R.entity===e&&R.isLoading===i&&R.error===l&&R.fallbackName===(c||R.fallbackName||"")?R:{...R,entity:e,isLoading:i,error:l,fallbackName:c||R.fallbackName||""}),g==="closing"&&w.current?(clearTimeout(w.current),w.current=null,S.current=null,v("opening")):g==="closed"&&v(Uh);return}S.current={entity:e,entityId:t,isLoading:i,error:l,fallbackName:c},g!=="closing"&&v("closing"),w.current||(w.current=setTimeout(()=>{y(S.current),S.current=null,v("opening"),w.current=null},H0));return}p&&(g!=="closing"&&v("closing"),w.current||(S.current=null,w.current=setTimeout(()=>{y(null),v("closed"),w.current=null},H0)))},[e,t,i,l,c,p,g]),u.useEffect(()=>{if(g!==Uh)return;const R=requestAnimationFrame(()=>{v("opening")});return()=>cancelAnimationFrame(R)},[g]),u.useEffect(()=>{if(g!=="opening")return;const R=requestAnimationFrame(()=>{v("open")});return()=>cancelAnimationFrame(R)},[g]);const N=!!p,j=g==="closing",_=p?.entity,C=p?.entityId,O=p?.isLoading??!1,E=p?.error??"",T=p?.fallbackName,M=_?.fields,A=u.useMemo(()=>Vy(m,M),[m,M]),z=u.useMemo(()=>Vk(_),[_]),P=u.useMemo(()=>({metadata:z}),[z]),X=u.useMemo(()=>Yy(A,P),[A,P]),H=u.useMemo(()=>Pk(_,f),[_,f]),Y=u.useMemo(()=>{if(!H.length)return[];const R=X?.actionsByField??{},q=X?.showRuleTargets??new Set;return H.filter(G=>{if(!G?.fieldKey)return!0;const J=R[G.fieldKey],ie=G.visibleByDefault!==void 0?!!G.visibleByDefault:G.visible_by_default!==void 0?!!G.visible_by_default:!0;return!cc(G.fieldKey,J,q,ie)})},[H,X]),V=Y.length>0,I=_?.name||T||(O?"Loading entity":"Unknown entity"),F=_?.type?.name||_?.typeName||"Entity",D=u.useMemo(()=>Ul(_),[_]);if(!N)return null;const U=["entity-info-drawer-wrapper",g==="open"?"entity-info-drawer-wrapper--open":"",g==="opening"?"entity-info-drawer-wrapper--opening":"",j?"entity-info-drawer-wrapper--closing":""].filter(Boolean).join(" "),k=()=>{C&&h(`/entities/${C}`)},B=!!C&&!O&&!E;return a.jsxs("div",{className:U,role:"presentation",children:[a.jsx("div",{className:"entity-info-drawer__overlay",onClick:r,role:"presentation"}),a.jsxs("aside",{className:"entity-info-drawer",role:"complementary","aria-label":"Entity details",children:[a.jsxs("header",{className:"entity-info-drawer__header",children:[a.jsxs("div",{className:"entity-info-drawer__header-top",children:[a.jsx("p",{className:"entity-info-drawer__type",title:F,children:F}),a.jsxs("div",{className:"entity-info-drawer__actions",children:[a.jsx("button",{type:"button",className:"entity-info-drawer__link",onClick:k,disabled:!B,children:"Go to Record"}),a.jsx("button",{type:"button",className:"entity-info-drawer__close",onClick:r,"aria-label":"Close entity details",children:""})]})]}),a.jsx("h2",{className:"entity-info-drawer__title",title:I,children:I})]}),D&&!O&&!E?a.jsx("div",{className:"entity-info-drawer__image",children:a.jsx("img",{src:D,alt:`Portrait of ${I}`,loading:"lazy"})}):null,_?.summary&&!O&&!E&&a.jsx("p",{className:"entity-info-drawer__summary",children:_.summary}),!_?.summary&&_?.description&&!O&&!E&&a.jsx("p",{className:"entity-info-drawer__summary",children:_.description}),O&&a.jsx("p",{className:"entity-info-drawer__status","aria-live":"polite",children:"Loading entity information"}),!!E&&!O&&a.jsx("p",{className:"entity-info-drawer__status entity-info-drawer__status--error","aria-live":"assertive",children:E}),!O&&!E&&V&&a.jsx("dl",{className:"entity-info-drawer__metadata",children:Y.map(R=>a.jsxs("div",{className:"entity-info-drawer__metadata-item",children:[a.jsx("dt",{children:R.label}),a.jsx("dd",{children:R.value})]},R.key))}),!O&&!E&&!V&&a.jsx("p",{className:"entity-info-drawer__status",children:"No additional metadata available."})]})]})}Ky.propTypes={entityId:rn.string,onClose:rn.func.isRequired,isLoading:rn.bool,error:rn.string,fallbackName:rn.string,fieldOrder:rn.arrayOf(rn.object),fieldRules:rn.arrayOf(rn.object)};function Is({entityId:e,entityName:t="entity",className:r=""}){const[i,l]=u.useState(!1),[c,f]=u.useState(!1),[m,h]=u.useState(null),[p,y]=u.useState(""),[g,v]=u.useState([]),[S,w]=u.useState([]),N=u.useRef(null),j=u.useMemo(()=>e==null?null:String(e),[e]);u.useEffect(()=>(N.current||(N.current=document.createElement("div"),document.body.appendChild(N.current)),()=>{N.current&&N.current.parentNode&&(N.current.parentNode.removeChild(N.current),N.current=null)}),[]);const _=u.useCallback(()=>{l(!1),y(""),h(null),f(!1)},[]),C=T=>{if(T.preventDefault(),T.stopPropagation(),e==null)return;const M=typeof t=="string"?t.trim():"";j&&M&&h(A=>A&&A.id===j?A.name||!M?A:{...A,name:M}:{id:j,name:M}),l(!0)};u.useEffect(()=>{if(!j)return;const T=typeof t=="string"?t.trim():"";T&&h(M=>!M||M.id!==j||M.name===T||M.name&&M.name!==T?M:{...M,name:T})},[j,t]),u.useEffect(()=>{if(!i||!j)return;let T=!1;return(async()=>{f(!0),y("");try{const A=await rr(j);if(T)return;const z=Pa(A);if(!z){h(null),y("Entity not found");return}h(z)}catch(A){if(T)return;console.error(" Failed to load entity preview",A),h(null),y(A.message||"Failed to load entity information")}finally{T||f(!1)}})(),()=>{T=!0}},[i,j]);const O=u.useMemo(()=>m&&(m.entity_type_id||m.entityType?.id||m.entity_type?.id)||null,[m]);u.useEffect(()=>{if(!O){v([]),w([]);return}if(!i)return;let T=!1;return(async()=>{try{const[A,z]=await Promise.all([of(O).catch(P=>(console.error(" Failed to load preview field order",P),null)),cf(O).catch(P=>(console.error(" Failed to load preview field rules",P),null))]);if(T)return;v(Gr(A)),w(Gr(z))}catch(A){if(T)return;console.error(" Failed to load preview field layout",A),v([]),w([])}})(),()=>{T=!0}},[i,O]),u.useEffect(()=>{if(!i)return;const T=M=>{M.key==="Escape"&&(M.preventDefault(),_())};return window.addEventListener("keydown",T),()=>{window.removeEventListener("keydown",T)}},[i,_]);const E=i&&N.current?a.jsx(Ky,{entityId:j,entity:m,isLoading:c,error:p,fallbackName:t,onClose:_,fieldOrder:g,fieldRules:S}):null;return a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:`entity-info-trigger ${r}`.trim(),onClick:C,"aria-label":`View details for ${t}`,children:a.jsx(Oy,{size:16,"aria-hidden":"true"})}),N.current&&Wd.createPortal(E,N.current)]})}Is.propTypes={entityId:rn.oneOfType([rn.string,rn.number]).isRequired,entityName:rn.string,className:rn.string};function ff({field:e,data:t,onChange:r,mode:i="edit"}){const l=e.key||e.name||e.field||"",[c,f]=u.useState([]),[m,h]=u.useState(!e.optionsSource),[p,y]=u.useState(()=>JSON.stringify(e.optionsCriteria??null)),[g,v]=u.useState(()=>({selectedLabel:e?.selectedLabel?String(e.selectedLabel):"",selectedValue:null})),S=i==="view";async function w(k=5,B=200){for(let R=0;R<k;R++){const q=Zr();if(q)return q;await new Promise(G=>setTimeout(G,B))}return null}const N=u.useCallback(k=>{if(k==null)return"null";try{return JSON.stringify(k)}catch(B){return console.warn(" Unable to serialise options criteria",B),String(k)}},[]);u.useEffect(()=>{const k=N(e.optionsCriteria??null);y(B=>B===k?B:k)},[e.optionsCriteria,N]),u.useEffect(()=>{let k=!0;return(async()=>{if(!e.optionsSource){k&&(f([]),h(!0));return}const{API_BASE:R}=await Q1(async()=>{const{API_BASE:oe}=await Promise.resolve().then(()=>kM);return{API_BASE:oe}},[]);let q=null;const G=new URLSearchParams;let J=null;const ie=oe=>{if(oe==null)return null;if(typeof oe=="string"){const ne=new URLSearchParams(oe);return ne.get("world_id")||ne.get("worldId")}if(Array.isArray(oe)){for(const ne of oe)if(Array.isArray(ne)&&ne.length>=2){const[we,ke]=ne;if(we==="world_id"||we==="worldId")return ke}else if(ne&&typeof ne=="object"){const we=ie(ne);if(we)return we}return null}return typeof oe=="object"&&(oe.world_id||oe.worldId)||null},Z=oe=>{if(oe==null)return null;if(typeof oe=="string"){const ne=new URLSearchParams(oe);ne.delete("world_id"),ne.delete("worldId");const we=ne.toString();return we||null}if(Array.isArray(oe)){const ne=oe.map(we=>{if(Array.isArray(we)&&we.length>=2){const[ke,Re]=we;return ke==="world_id"||ke==="worldId"?null:[ke,Re]}if(we&&typeof we=="object"){const ke=Z(we);return ke||null}return we}).filter(we=>we==null?!1:Array.isArray(we)?!0:typeof we=="object"?Object.keys(we).length>0:!0);return ne.length>0?ne:null}if(typeof oe=="object"){const ne={...oe};return delete ne.world_id,delete ne.worldId,Object.keys(ne).length>0?ne:null}return oe};switch(e.optionsSource){case"worlds":q="/worlds";break;case"campaigns":q="/campaigns";break;case"entities":{const oe=ie(e.optionsCriteria),ne=e.worldId||e.world_id||t?.world_id||t?.worldId||null,we=oe||ne;if(!we){console.warn(" Unable to resolve world id for entity options"),q=null;break}q=`/worlds/${we}/entities`,J=Z(e.optionsCriteria);break}case"users":q="/users";break;case"players":{q="/users";const oe=e.roles||"player,user";G.set("roles",oe);break}default:q=null}if(!q){k&&(f([]),h(!0));return}const Q=(()=>{try{let oe;if(q.startsWith("http"))oe=new URL(q);else{const ke=R.replace(/\/$/,""),Re=q.startsWith("/")?q:`/${q}`;oe=new URL(`${ke}${Re}`)}G.forEach((ke,Re)=>{ke!=null&&oe.searchParams.append(Re,ke)});const ne=J??e.optionsCriteria,we=ke=>{if(!(!ke&&ke!==0)){if(typeof ke=="string"){new URLSearchParams(ke).forEach((Te,rt)=>{oe.searchParams.append(rt,Te)});return}if(Array.isArray(ke)){ke.forEach(Re=>{if(Array.isArray(Re)&&Re.length>=2){const[Te,rt]=Re;if(rt==null)return;Array.isArray(rt)?rt.forEach(He=>{He!=null&&oe.searchParams.append(Te,He)}):oe.searchParams.append(Te,rt);return}typeof Re=="object"&&Re!==null&&we(Re)});return}typeof ke=="object"&&Object.entries(ke).forEach(([Re,Te])=>{Te!=null&&(Array.isArray(Te)?Te.forEach(rt=>{rt!=null&&oe.searchParams.append(Re,rt)}):oe.searchParams.append(Re,Te))})}};return we(ne),oe}catch(oe){return console.error(" Failed to construct options endpoint URL",oe),null}})();if(!Q){k&&(f([]),h(!0));return}k&&h(!1);try{const oe=await w();if(!oe){console.warn(" No auth token available when loading options"),k&&h(!0);return}const ne=await fetch(Q,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${oe}`}}),we=ne.headers.get("content-type");if(!we||!we.includes("application/json")){const He=await ne.text();console.error(` ${e.optionsSource} returned non-JSON response:`,{status:ne.status,statusText:ne.statusText,contentType:we,url:Q.toString(),preview:He.substring(0,200)}),k&&h(!0);return}const ke=await ne.json();if(!ne.ok){console.warn(` ${e.optionsSource} fetch failed`,ke),k&&h(!0);return}e.optionsSource==="worlds"&&console.log(" Worlds response:",ke);const Re=He=>{if(!He||typeof He!="object")return null;const tt=e.optionValueKey||"id",Ie=e.optionLabelKey||"name",vt=He?.[tt]??He?.id??null;if(!vt)return null;let Ct=He?.[Ie];if(!Ct){const At=["name","title","username"];for(const _t of At)if(He?.[_t]){Ct=He[_t];break}}return Ct||(Ct=String(vt)),{value:vt,label:Ct}},rt=(Array.isArray(ke?.data)?ke.data:Array.isArray(ke)?ke:[]).map(Re).filter(Boolean);k&&(f(rt),h(!0),rt.length===0&&console.warn(` ${e.optionsSource} returned no data`,ke))}catch(oe){console.error(` Failed to load ${e.optionsSource}:`,oe),k&&h(!0)}})(),()=>{k=!1}},[e.optionsSource,e.optionLabelKey,e.optionValueKey,p,e.roles,e.worldId,e.world_id,t?.world_id,t?.worldId]),u.useEffect(()=>{e?.selectedLabel&&v(k=>k.selectedLabel===String(e.selectedLabel)?k:{...k,selectedLabel:String(e.selectedLabel)})},[e?.selectedLabel]);const j=e.label||l,_=(e.type||"text").toLowerCase(),C=e.referenceTypeId??e.reference_type_id??e.referenceType?.id??null,O=e.referenceTypeName??e.reference_type_name??e.referenceType?.name??"",E=l.includes(".")?l.split(".").reduce((k,B)=>k?k[B]:void 0,t):t?.[l],T=["checkbox","boolean"].includes(_)?!!E:_==="multiselect"?Array.isArray(E)?E.map(k=>{if(k==null)return null;if(typeof k=="object"){const B=e.optionValueKey||"id",R=k?.[B]??k?.id??k?.value??k?.key??null;return R==null?null:String(R)}return String(k)}).filter(k=>k!=null):typeof E=="string"&&E.length>0?E.split(",").map(k=>k.trim()).filter(Boolean):[]:E??"",M=e.readonly||e.disabled,A=S||M,z=k=>k==null||k===""?"":Array.isArray(k)?k.length>0?k.join(", "):"":typeof k=="boolean"?k?"Yes":"No":String(k),P=z(T),X=k=>r?.(l,k.target.value),H=k=>r?.(l,k.target.checked),Y=u.useCallback((k,B)=>{if(!(!B||typeof B!="string")&&!(!k||typeof k!="object"))return B.includes(".")?B.split(".").filter(R=>R.length>0).reduce((R,q)=>{if(R!=null&&typeof R=="object")return R[q]},k):k?.[B]},[]),V=u.useCallback(()=>{const k=[e.worldId,e.world_id,t?.worldId,t?.world_id];e.world&&typeof e.world=="object"&&k.push(e.world.id,e.world.world_id),t?.world&&typeof t.world=="object"&&k.push(t.world.id,t.world.world_id),t?.metadata&&typeof t.metadata=="object"&&k.push(t.metadata.worldId,t.metadata.world_id);for(const B of k){if(B==null)continue;const R=String(B).trim();if(R)return R}return""},[e.worldId,e.world_id,e.world,t?.worldId,t?.world_id,t?.world,t?.metadata]),I=_==="reference"&&T!==void 0&&T!==null?String(T):"",F=u.useMemo(()=>{if(_!=="reference")return[];const k=e.options?.choices;return Array.isArray(k)?k.map((B,R)=>{if(B==null)return null;if(typeof B=="object"){const G=B.value??B.id??B.key??B.slug??`choice-${R}`;if(G==null)return null;const J=B.label??B.name??B.title??B.display??B.displayName??G;return{value:String(G),label:String(J)}}const q=String(B);return{value:q,label:q}}).filter(Boolean):[]},[_,e.options?.choices]);if(u.useEffect(()=>{_==="reference"&&(I||v(k=>!k.selectedLabel&&!k.selectedValue?k:{...k,selectedLabel:"",selectedValue:null}))},[_,I]),u.useEffect(()=>{if(_!=="reference"||!I)return;const k=F.find(R=>R.value===I),B=(()=>{if(typeof e.value=="object"&&e.value!==null){const R=e.value.label??e.value.name??e.value.title??e.value.display??e.value.displayName??e.value.text??e.value.value??e.value.id??null;if(R!=null){const q=String(R).trim();if(q)return q}}return k?.label?String(k.label):""})();if(!B){v(R=>R.selectedValue===I?R:{...R,selectedValue:I});return}v(R=>R.selectedValue===I&&R.selectedLabel===B?R:{...R,selectedLabel:B,selectedValue:I})},[_,I,e.value,F]),!l)return console.warn(" Field without key/name skipped:",e),null;const D=k=>{const B=[];return e.helpText&&B.push(a.jsx("p",{className:"help-text",children:e.helpText},"help")),k&&B.push(a.jsx("p",{className:"help-text warning",children:e.noOptionsMessage||"No options available."},"empty")),B};if(_==="reference"){const k=V(),B=typeof O=="string"&&O.trim()?O.trim():"entities",R=F.length>0,G=!!!(C&&k)&&!R;if(A){let Q=(e.displayKey&&Y(t,e.displayKey)?Y(t,e.displayKey):null)??g.selectedLabel??F.find(we=>we.value===I)?.label??"";!Q&&I&&(Q=I);const oe=Gy(E||e.value||I),ne=Xy(E||e.value)||Q||I;return a.jsxs("div",{className:`form-group ${A?"readonly":""}`,children:[a.jsx("label",{children:j}),a.jsxs("div",{style:{position:"relative",display:"inline-block",width:"100%"},children:[a.jsx("input",{type:"text",value:z(Q),disabled:!0,className:"readonly-control",style:{paddingRight:oe?"2.5rem":"0.8rem",width:"100%"}}),oe&&a.jsx("div",{style:{position:"absolute",right:"0.5rem",top:"50%",transform:"translateY(-50%)",zIndex:1},children:a.jsx(Is,{entityId:oe,entityName:ne,className:"entity-info-trigger--field-button"})})]}),D(!1)]})}const J=me=>{if(!me){r?.(l,""),v(we=>({...we,selectedLabel:"",selectedValue:null}));return}const Q=me.id??me.value??me.key??me.slug??me.uuid??null;if(Q==null){r?.(l,"");return}const oe=String(Q),ne=me.name??me.label??me.title??me.display??me.displayName??"";r?.(l,oe),v(we=>({...we,selectedLabel:ne||we.selectedLabel||oe,selectedValue:oe}))},ie=me=>{if(!me){v(we=>({...we,selectedLabel:"",selectedValue:null}));return}const Q=me.id??me.value??me.key??me.slug??me.uuid??null;if(Q==null)return;const oe=String(Q),ne=me.name??me.label??me.title??me.display??me.displayName??"";v(we=>we.selectedValue===oe&&we.selectedLabel===ne?we:{...we,selectedLabel:ne||we.selectedLabel||oe,selectedValue:oe})},Z=I&&g.selectedLabel?{id:I,name:g.selectedLabel}:I;return a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:j}),a.jsx(oc,{worldId:k,value:Z,allowedTypeIds:C?[C]:[],disabled:G,placeholder:`Search ${B.toLowerCase()}...`,staticOptions:F,onChange:J,onResolved:ie,required:!!e.required}),!C&&a.jsx("p",{className:"help-text warning",children:"Reference type configuration is missing."}),C&&!k&&a.jsx("p",{className:"help-text warning",children:"Select a world to search for entities."}),D(!1)]})}if(["select","dropdown"].includes(_)){const k=[...e.options||[],...c],B=T??"",R=m&&e.optionsSource&&k.length===0;if(A){const q=k.find(ie=>ie?typeof ie=="object"?String(ie.value)===String(B):String(ie)===String(B):!1),G=e.displayKey&&Y(t,e.displayKey)?Y(t,e.displayKey):null,J=z(G||(q?typeof q=="object"?q.label??q.value:q:B));return a.jsxs("div",{className:`form-group ${A?"readonly":""}`,children:[a.jsx("label",{children:j}),a.jsx("input",{type:"text",value:J,disabled:!0,className:"readonly-control"}),D(!1)]})}return a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:j}),a.jsx("div",{className:"select-wrapper",children:a.jsxs("select",{value:B,onChange:X,disabled:R,children:[a.jsx("option",{value:"",children:"Select..."}),k.map((q,G)=>{const J=typeof q=="object"?q.value:q,ie=typeof q=="object"?q.label:q;return a.jsx("option",{value:J,children:ie},J||G)})]})}),D(R)]})}if(_==="multiselect"){const k=[...Array.isArray(e.selectedOptions)?e.selectedOptions:[],...Array.isArray(e.prefillOptions)?e.prefillOptions:[]],B=[...e.options||[],...c,...k].map((ie,Z)=>{const me=J1(ie);if(me)return me;if(typeof ie=="object"&&ie!==null){const oe=ie.value??ie.id??ie.key??ie.slug??`opt-${Z}`,ne=ie.label??ie.name??ie.title??ie.username??ie.email??oe;return oe==null?null:{value:String(oe),label:String(ne)}}if(ie==null)return null;const Q=String(ie);return{value:Q,label:Q}}).filter(Boolean),R=new Map,q=B.filter(ie=>{const Z=String(ie.value);return R.has(Z)?!1:(R.set(Z,ie),!0)}),G=Array.isArray(T)?T.map(ie=>String(ie)).filter(Boolean):[],J=m&&e.optionsSource&&q.length===0;if(A){const ie=G.map(Z=>{const me=R.get(String(Z));return me?me.label??me.value??String(Z):String(Z)}).filter(Boolean);return a.jsxs("div",{className:`form-group ${A?"readonly":""}`,children:[a.jsx("label",{children:j}),a.jsx("textarea",{className:"textarea-field",value:ie.length?ie.join(`
`):"",readOnly:!0}),D(!1)]})}return a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:j}),a.jsx(Ms,{selected:G,options:q,onChange:ie=>r?.(l,ie),placeholder:e.placeholder||"Search and select...",noOptionsMessage:e.noOptionsMessage||"No options available.",loading:!m&&!!e.optionsSource}),D(J)]})}if(["textarea","multiline"].includes(_))return a.jsxs("div",{className:`form-group ${A?"readonly":""}`,children:[a.jsx("label",{children:j}),a.jsx("textarea",{className:"textarea-field",rows:e.rows||4,value:A?P:T,onChange:X,disabled:A}),D(!1)]});if(["checkbox","boolean"].includes(_))return a.jsxs("div",{className:"form-group checkbox",children:[a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:!!T,onChange:H,disabled:A}),j]}),D(!1)]});if(_==="readonly"){const k=T?.username||T?.name||T||"-";return a.jsxs("div",{className:"form-group readonly",children:[a.jsx("label",{children:j}),a.jsx("div",{className:"readonly-value",children:k}),D(!1)]})}const L=(A?"text":e.inputType)||"text",U=(()=>{if(T==null)return"";if(new Set(["number","date","datetime-local","month","time","week","range"]).has(L)&&typeof T=="string"){const B=T.trim();if(!B||B==="")return""}return T})();return A?a.jsxs("div",{className:"form-group readonly",children:[a.jsx("label",{children:j}),a.jsx("div",{className:"readonly-value",children:P}),D(!1)]}):a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:j}),a.jsx("input",{type:L,value:U,onChange:X,placeholder:e.placeholder||"",className:A?"readonly-control":void 0}),D(!1)]})}const aN="You have unsaved changes. Select Cancel to stay here and save, or OK to leave without saving.";function Yk(e,t=aN,r){const i=u.useCallback(({currentLocation:l,nextLocation:c})=>!e||r?.current?!1:!(l.pathname===c.pathname&&l.search===c.search&&l.hash===c.hash),[e,r]);q2({when:i,message:t}),h1(u.useCallback(l=>{!e||r?.current||(l.preventDefault(),l.returnValue="")},[e,r]),{capture:!0})}function Gk({schema:e,initialData:t={},onSubmit:r,onCancel:i,onDelete:l,hideActions:c=!1,enableUnsavedPrompt:f=!0,onStateChange:m,fieldRules:h},p){const[y,g]=u.useState(()=>t?{...t}:{}),[v,S]=u.useState(()=>JSON.stringify(t??{})),[w,N]=u.useState(""),[j,_]=u.useState("success"),[C,O]=u.useState(!1),[E,T]=u.useState(()=>({actionsByField:{},showRuleTargets:new Set})),M=u.useMemo(()=>{if(!e)return[];const q=Array.isArray(e.fields)?e.fields.filter(J=>J&&typeof J=="object"):[],G=Array.isArray(e.sections)?e.sections.flatMap(J=>Array.isArray(J?.fields)?J.fields:[]).filter(J=>J&&typeof J=="object"):[];return q.length===0&&G.length===0?[]:[...G,...q]},[e]),A=u.useMemo(()=>{const q=Array.isArray(h)?h:[];return Vy(q,M)},[h,M]);u.useEffect(()=>{const q=t?{...t}:{};g(q),S(JSON.stringify(t??{})),N(""),_("success")},[t]),u.useEffect(()=>{if(!A.length){T({actionsByField:{},showRuleTargets:new Set});return}const q=Yy(A,y);T(q)},[A,y]);const z=u.useMemo(()=>Array.isArray(e?.sections)&&e.sections.length>0?e.sections:Array.isArray(e?.fields)?[{title:e.title,columns:e.columns||1,fields:e.fields}]:[],[e]),P=(q,G,J)=>{if(!G||G.length===0)return q;const ie={...q||{}};let Z=ie;for(let me=0;me<G.length;me+=1){const Q=G[me];if(me===G.length-1)Z[Q]=J;else{const ne=Z[Q],we=ne&&typeof ne=="object"&&!Array.isArray(ne)?{...ne}:{};Z[Q]=we,Z=we}}return ie},X=(q,G)=>{if(!(!G||typeof G!="string")&&!(!q||typeof q!="object"))return G.includes(".")?G.split(".").filter(J=>J.length>0).reduce((J,ie)=>{if(J!=null&&typeof J=="object")return J[ie]},q):q?.[G]},H=(q,G)=>{!q||typeof q!="string"||g(J=>{if(!q.includes("."))return{...J||{},[q]:G};const ie=q.split(".").filter(Z=>Z.length>0);return ie.length===0?{...J||{}}:P(J,ie,G)})},Y=u.useMemo(()=>JSON.stringify(y??{}),[y]),V=u.useMemo(()=>Y!==v,[Y,v]),I=u.useRef(!1);u.useEffect(()=>{V||(I.current=!1)},[V]),u.useEffect(()=>{V&&w&&(N(""),_("success"))},[V,w]),u.useEffect(()=>{typeof m=="function"&&m({isDirty:V,isSubmitting:C})},[V,C,m]),Yk(f&&V,void 0,I);const D=u.useCallback(()=>{if(!z.length)return!0;const q=[];return z.forEach(G=>{(Array.isArray(G.fields)?G.fields:[]).forEach(ie=>{const Z=ie?.key||ie?.name||ie?.field;if(!Z)return;const me=E.actionsByField[Z],Q=ie?.visibleByDefault!==void 0?!!ie.visibleByDefault:ie?.visible_by_default!==void 0?!!ie.visible_by_default:!0;if(cc(Z,me,E.showRuleTargets,Q)||!(!!ie?.required||me==="require"))return;const ne=X(y,Z);(Array.isArray(ne)?ne.length>0:ne!=null&&ne!=="")||q.push(ie.label||ie.name||Z)})}),q.length>0?(_("error"),N(`Please complete required fields: ${q.join(", ")}`),!1):!0},[z,y,E]),L=u.useCallback(async()=>{if(!r)return!0;if(!D())return!1;const q=JSON.stringify(y??{});O(!0),_("success"),N(""),I.current=!0;try{const G=await r(y);if(G===!1)return I.current=!1,!1;const J=G&&typeof G=="object"&&!Array.isArray(G)?G:{};S(q);const ie=typeof G=="string"?G:J.message||e?.saveSuccessMessage||"";if(ie){const Z=J.status==="error"?"error":"success";_(Z),N(ie)}return I.current=!1,J}catch(G){return console.error("Failed to submit form:",G),_("error"),N(G.message||"Failed to save changes."),I.current=!1,!1}finally{O(!1)}},[y,r,e,D]),U=async q=>{q.preventDefault(),await L()},k=()=>{i&&(!V||window.confirm(aN))&&(S(Y),I.current=!0,i())},B=async()=>{if(l)try{await l(y)&&(S(Y),I.current=!0)}catch(q){console.error("Failed to delete record:",q)}},R=u.useCallback((q=t)=>{const G=q?{...q}:{};g(G),S(JSON.stringify(q??{})),N(""),_("success"),I.current=!1},[t]);return u.useImperativeHandle(p,()=>({submit:L,reset:R,isDirty:()=>V,isSubmitting:()=>C}),[L,R,V,C]),a.jsxs("form",{className:"record-form",onSubmit:U,children:[a.jsx("h2",{className:"form-title",children:e?.title||"Record"}),z.map((q,G)=>a.jsxs("div",{className:"form-section",children:[q.title?a.jsx("h3",{children:q.title}):null,a.jsx("div",{className:`form-grid cols-${q.columns||1} ${(q.columns||1)>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":""}`,children:(q.fields||[]).map((J,ie)=>{if(!J||typeof J!="object")return console.warn(" Skipping invalid field in schema:",J),null;const Z=J.key||J.name||J.field||`field-${ie}`,me=E.actionsByField[Z],Q=J.visibleByDefault!==void 0?!!J.visibleByDefault:J.visible_by_default!==void 0?!!J.visible_by_default:!0;if(cc(Z,me,E.showRuleTargets,Q))return null;const oe={...J};me==="disable"&&(oe.disabled=!0),me==="require"&&(oe.required=!0);const ne=J.span||J.colSpan||null,we=a.jsx(ff,{field:oe,data:y,onChange:H,mode:"edit"},`${Z}-${ie}`);return ne&&Number.isFinite(ne)&&ne>1?a.jsx("div",{style:{gridColumn:`span ${ne}`},children:we},`${Z}-${ie}-wrapper`):we})})]},G)),w?a.jsx("div",{className:`form-feedback ${j}`,role:j==="error"?"alert":"status",children:w}):null,c?null:a.jsxs("div",{className:"form-actions sticky-actions",role:"toolbar",children:[a.jsx("div",{className:"left-actions",children:l?a.jsx("button",{type:"button",className:"btn delete",onClick:B,disabled:C,children:e?.deleteLabel||"Delete"}):null}),a.jsxs("div",{className:"right-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:k,disabled:C,children:e?.cancelLabel||"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:C,children:e?.saveLabel||"Save"})]})]})]})}const ys=u.forwardRef(Gk),Xk="Create New World",Kk=[{title:"General",columns:2,fields:[{key:"name",label:"Name",type:"text"},{key:"system",label:"System",type:"text"}]},{title:"Entity Creation",columns:1,fields:[{key:"entity_creation_scope",label:"Who can create entities?",type:"select",options:[{value:"owner_dm",label:"World Owner & DMs"},{value:"all_players",label:"All Players (campaign scoped)"}],helpText:"When set to All Players, campaign members can only create entities scoped to their campaign."}]},{title:"Description",columns:1,fields:[{key:"description",label:"Description",type:"textarea"}]}],Wk={title:Xk,sections:Kk},uc={OWNER_DMS:"owner_dm",ALL_PLAYERS:"all_players"},Bh=[{value:uc.OWNER_DMS,label:"World Owner / DMs"},{value:uc.ALL_PLAYERS,label:"All Players (campaign scoped)"}],sN=e=>{if(!e)return Bh[0].label;const t=String(e).trim().toLowerCase(),r=Bh.find(i=>i.value===t);return r?r.label:Bh[0].label};function Zk(){const e=$n(),{token:t,sessionReady:r}=En(),[i,l]=u.useState([]),[c,f]=u.useState(!1),[m,h]=u.useState(null),[p,y]=u.useState(!1),g=u.useCallback(async()=>{if(t){f(!0),h(null);try{const j=await $l();l(j?.data||j||[])}catch(j){console.error(" Failed to load worlds:",j),h(j.message)}finally{f(!1)}}},[t]);u.useEffect(()=>{r&&t&&g()},[r,t,g]);const v=[{key:"name",label:"Name"},{key:"system",label:"System"},{key:"status",label:"Status"},{key:"entity_creation_scope",label:"Entity Creation",render:j=>sN(j.entity_creation_scope)},{key:"description",label:"Description"},{key:"createdAt",label:"Created"}],S=()=>y(!0),w=()=>y(!1),N=async j=>{try{return(await PM(j)).success?(await g(),y(!1),!0):!1}catch(_){return alert(`Failed to create world: ${_.message}`),!1}};return r?t?c?a.jsx("p",{children:"Loading worlds..."}):m?a.jsxs("p",{className:"error",children:["Error: ",m]}):p?a.jsx(ys,{schema:Wk,initialData:{entity_creation_scope:uc.OWNER_DMS},onSubmit:N,onCancel:w,showUpdateAction:!1}):a.jsx(uf,{data:i,columns:v,title:"Worlds",extraActions:a.jsx("button",{type:"button",className:"btn submit",onClick:S,children:"+ New"}),onRowClick:j=>e(`/worlds/${j.id}`)}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}function rN({schema:e,data:t={},onClose:r,closeLabel:i="Back",infoMessage:l}){const c=u.useMemo(()=>Array.isArray(e?.sections)&&e.sections.length>0?e.sections:Array.isArray(e?.fields)?[{title:e.title,columns:e.columns||1,fields:e.fields}]:[],[e]);return a.jsxs("div",{className:"record-form record-view",children:[a.jsx("h2",{className:"form-title",children:e?.title||"Details"}),c.map((f,m)=>a.jsxs("div",{className:"form-section",children:[f.title?a.jsx("h3",{children:f.title}):null,a.jsx("div",{className:`form-grid cols-${f.columns||1}`,children:(f.fields||[]).map((h,p)=>!h||typeof h!="object"?(console.warn(" Skipping invalid field in schema:",h),null):a.jsx(ff,{field:h,data:t,mode:"view"},`${h.key||h.name||h.field||"field"}-${p}`))})]},m)),l?a.jsx("p",{className:"record-info",children:l}):null,r?a.jsxs("div",{className:"form-actions sticky-actions view-actions",role:"toolbar",children:[a.jsx("div",{className:"left-actions","aria-hidden":"true"}),a.jsx("div",{className:"right-actions",children:a.jsx("button",{type:"button",className:"btn cancel",onClick:r,children:i})})]}):null]})}const Qk="Edit World",Jk=[{title:"General",columns:2,fields:[{key:"name",label:"Name",type:"text"},{key:"system",label:"System",type:"text"},{key:"status",label:"Status",type:"select",options:[{value:"active",label:"Active"},{value:"archived",label:"Archived"}]}]},{title:"Entity Creation",columns:1,fields:[{key:"entity_creation_scope",label:"Who can create entities?",type:"select",options:[{value:"owner_dm",label:"World Owner & DMs"},{value:"all_players",label:"All Players (campaign scoped)"}],helpText:"When set to All Players, campaign members can only create entities scoped to their campaign."}]},{title:"Description",columns:1,fields:[{key:"description",label:"Description",type:"textarea"}]},{title:"Metadata",columns:2,fields:[{key:"created_by",label:"Created By",type:"readonly"},{key:"createdAt",label:"Created Date",type:"readonly"},{key:"updatedAt",label:"Updated Date",type:"readonly"}]}],e3={title:Qk,sections:Jk},t3="World Details",n3=[{title:"General",columns:2,fields:[{name:"name",label:"Name",type:"text"},{name:"system",label:"System",type:"text"},{name:"statusLabel",label:"Status",type:"text"},{name:"entityCreationScopeLabel",label:"Entity Creation",type:"text"}]},{title:"Description",columns:1,fields:[{name:"description",label:"Description",type:"textarea"}]},{title:"Metadata",columns:2,fields:[{name:"ownerName",label:"Created By",type:"text"},{name:"createdAt",label:"Created",type:"text"},{name:"updatedAt",label:"Updated",type:"text"}]}],a3={title:t3,sections:n3},Hr=e=>{if(!e)return"";const t=e instanceof Date?e:new Date(e);if(Number.isNaN(t.getTime()))return typeof e=="string"?e:"";const r=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+1).padStart(2,"0"),l=t.getFullYear(),c=String(t.getHours()).padStart(2,"0"),f=String(t.getMinutes()).padStart(2,"0");return`${r}/${i}/${l} ${c}:${f}`};function s3(){const{id:e}=xs(),t=$n(),{user:r,token:i,sessionReady:l}=En(),[c,f]=u.useState(null),[m,h]=u.useState(!0),[p,y]=u.useState(null),g=u.useCallback(async()=>{try{const _=await $l(),C=(_?.data||_||[]).find(O=>O.id===e);f(C),C||y("World not found")}catch(_){console.error(" Failed to load world:",_),y(_.message)}finally{h(!1)}},[e]);u.useEffect(()=>{l&&i&&g()},[l,i,g]);const v=async(_,C={})=>{const{stayOnPage:O=!1}=C;try{const E={name:_?.name,description:_?.description,system:_?.system,status:_?.status,entity_creation_scope:_?.entity_creation_scope},T=await VM(e,E);if(T.success){const M=T.data||{...c,...E};return f(M),O?{message:"World updated successfully."}:(t("/worlds"),!0)}return!1}catch(E){return alert(`Failed to update world: ${E.message}`),!1}},S=async()=>{if(!confirm("Delete this world?"))return!1;try{return(await YM(e)).success?(t("/worlds"),!0):!1}catch(_){return alert(`Failed to delete world: ${_.message}`),!1}},w=u.useMemo(()=>!c||!r?!1:r.role==="system_admin"?!0:c.created_by===r.id,[r,c]),N=u.useMemo(()=>c?{...c,created_by:c.creator||c.created_by}:null,[c]),j=u.useMemo(()=>{if(!c)return null;const _=c.status||"",C=_.length>0?_.charAt(0).toUpperCase()+_.slice(1):"",O=sN(c.entity_creation_scope),E=c.creator?.username||c.creator?.name||c.created_by||"";return{name:c.name||"",system:c.system||"",statusLabel:C,entityCreationScopeLabel:O,description:c.description||"",ownerName:E,createdAt:Hr(c.createdAt),updatedAt:Hr(c.updatedAt)}},[c]);return l?i?m?a.jsx("p",{children:"Loading world..."}):p?a.jsxs("p",{className:"error",children:["Error: ",p]}):c?w?a.jsx(ys,{schema:e3,initialData:N||c,onSubmit:v,onDelete:S,onCancel:()=>t("/worlds")}):a.jsx(rN,{schema:a3,data:j||{},onClose:()=>t("/worlds"),closeLabel:"Back to worlds",infoMessage:"You can view this world but only the creator or a system admin can make changes."}):a.jsx("p",{children:"World not found"}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}async function r3(e=5,t=200){for(let r=0;r<e;r++){const i=Zr();if(i)return i;await new Promise(l=>setTimeout(l,t))}return null}async function Wy(){const e=await r3();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function Zy(e,t="request"){if(e.status===401)throw new Error("Unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${e.status} ${r}`)}return e.json()}async function i3(e){if(!e)throw new Error("campaignId is required");const t=await Wy(),r=new URL(`${Cn}/user-campaign-roles`);r.searchParams.set("campaign_id",e);const i=await fetch(r.toString(),{headers:t});return Zy(i,"load campaign members")}async function l3(e,t){const r=await Wy(),i=await fetch(`${Cn}/user-campaign-roles/${e}`,{method:"PUT",headers:r,body:JSON.stringify(t)});return Zy(i,"update campaign assignment")}async function o3(e){const t=await Wy(),r=await fetch(`${Cn}/user-campaign-roles/${e}`,{method:"DELETE",headers:t});return Zy(r,"remove user from campaign")}const c3=[{label:"Dungeon Master",value:"dm"},{label:"Player",value:"player"},{label:"Observer",value:"observer"}];function u3({campaignId:e,canManage:t,onMembersChanged:r}){const[i,l]=u.useState([]),[c,f]=u.useState(!0),[m,h]=u.useState(null),p=u.useCallback(async()=>{if(e){h(null),f(!0);try{const S=(await i3(e))?.data||[];l(S)}catch(v){h(v.message)}finally{f(!1)}}},[e]);u.useEffect(()=>{p()},[p]);const y=async(v,S)=>{h(null);try{const N=(await l3(v,{role:S}))?.data;N&&l(j=>{const _=j.map(C=>C.id===N.id?N:C);return typeof r=="function"&&r(_),_})}catch(w){h(w.message)}},g=async v=>{if(confirm("Remove this user from the campaign?")){h(null);try{await o3(v),l(S=>{const w=S.filter(N=>N.id!==v);return typeof r=="function"&&r(w),w})}catch(S){h(S.message)}}};return e?a.jsx(a.Fragment,{children:a.jsxs("div",{className:"panel",children:[a.jsx("div",{className:"panel-header",children:a.jsx("h3",{children:"Campaign Members"})}),m&&a.jsx("p",{className:"error",children:m}),c?a.jsx("p",{children:"Loading members"}):i.length===0?a.jsx("p",{children:"No users associated with this campaign yet."}):a.jsxs("table",{className:"compact-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"User"}),a.jsx("th",{children:"Role"}),a.jsx("th",{children:"Added"}),t?a.jsx("th",{children:"Actions"}):null]})}),a.jsx("tbody",{children:i.map(v=>a.jsxs("tr",{children:[a.jsx("td",{children:v.user?.username||v.user?.email||v.user_id}),a.jsx("td",{children:t?a.jsx("select",{value:v.role,onChange:S=>y(v.id,S.target.value),children:c3.map(S=>a.jsx("option",{value:S.value,children:S.label},S.value))}):v.role}),a.jsx("td",{children:v.createdAt?new Date(v.createdAt).toLocaleString():""}),t?a.jsx("td",{children:a.jsx("button",{type:"button",className:"btn danger",onClick:()=>g(v.id),children:"Remove"})}):null]},v.id))})]}),t?a.jsx("p",{className:"help-text",children:"Manage who can participate through the Players list. Update roles here to promote Dungeon Masters or set observers."}):null]})}):null}const d3="New Campaign",f3=[{name:"world_id",label:"World",type:"select",optionsSource:"worlds",optionsCriteria:{owned_only:!0},required:!0},{name:"name",label:"Name",type:"text",required:!0,placeholder:"Enter campaign name"},{name:"description",label:"Description",type:"textarea",placeholder:"Brief description of the campaign world"},{name:"status",label:"Status",type:"select",options:[{label:"Draft",value:"draft"},{label:"Active",value:"active"},{label:"Completed",value:"completed"},{label:"Archived",value:"archived"}],default:"draft"}],m3="Create Campaign",h3={title:d3,fields:f3,submitLabel:m3},p3="Edit Campaign",y3=[{name:"world_id",label:"World",type:"select",optionsSource:"worlds",required:!0,readonly:!0},{name:"name",label:"Name",type:"text",required:!0},{name:"description",label:"Description",type:"textarea"},{name:"status",label:"Status",type:"select",options:[{label:"Draft",value:"draft"},{label:"Active",value:"active"},{label:"Completed",value:"completed"},{label:"Archived",value:"archived"}]},{name:"player_ids",label:"Players",type:"multiselect",optionsSource:"players",optionLabelKey:"username",optionValueKey:"id",helpText:"Players selected here can create characters in this campaign.",noOptionsMessage:"No eligible players are currently available."}],g3="Save Changes",b3="Delete Campaign",V0={title:p3,fields:y3,submitLabel:g3,deleteLabel:b3},v3="Campaign Details",x3=[{title:"Overview",columns:2,fields:[{name:"name",label:"Name",type:"text"},{name:"statusLabel",label:"Status",type:"text"},{name:"worldName",label:"World",type:"text"},{name:"ownerName",label:"Owner",type:"text"}]},{title:"Description",columns:1,fields:[{name:"description",label:"Description",type:"textarea"}]},{title:"Metadata",columns:2,fields:[{name:"createdAt",label:"Created",type:"text"},{name:"updatedAt",label:"Updated",type:"text"}]}],S3={title:v3,sections:x3};function qu({scope:e="all"}){const t=$n(),{id:r}=xs(),{user:i,token:l,sessionReady:c}=En(),[f,m]=u.useState([]),[h,p]=u.useState(!1),[y,g]=u.useState("list"),[v,S]=u.useState(null),[w,N]=u.useState(null),[j,_]=u.useState("details"),C=u.useMemo(()=>`/campaigns/${e}`,[e]),O=u.useCallback(Q=>{if(!Q)return Q;const oe=Array.isArray(Q.members)?Q.members.filter(ne=>ne.role==="player"):[];return{...Q,ownerName:Q.owner?.username||"",worldName:Q.world?.name||"",player_ids:oe.map(ne=>ne.user_id)}},[]),E=u.useCallback(async()=>{if(l){p(!0),N(null);try{const Q=await jc(),ne=(Q?.data||Q||[]).map(we=>O(we));m(ne)}catch(Q){N(Q.message)}finally{p(!1)}}},[l,O]);u.useEffect(()=>{c&&l&&E()},[c,l,E]),u.useEffect(()=>{g("list"),S(null),_("details")},[e]),u.useEffect(()=>{if(!r){y!=="new"&&g("list"),S(null);return}const Q=f.find(ne=>String(ne.id)===r);if(!Q){h||t(C,{replace:!0});return}const oe=!!i&&(i.role==="system_admin"||Q.created_by===i.id);S(Q),g(oe?"edit":"view")},[r,f,t,C,h,y,i]),u.useEffect(()=>{_("details")},[v?.id]);const T=u.useMemo(()=>[{key:"name",label:"Name"},{key:"worldName",label:"World"},{key:"ownerName",label:"Owner"},{key:"status",label:"Status"},{key:"description",label:"Description"},{key:"createdAt",label:"Created"}],[]),M=Q=>!Q||!i?!1:i.role==="system_admin"||Q.created_by===i.id,A=u.useMemo(()=>{if(i?.role!=="system_admin")return V0;const Q=JSON.parse(JSON.stringify(V0)),oe={name:"created_by",label:"Owner",type:"select",optionsSource:"users",optionLabelKey:"username",optionValueKey:"id"};if(Array.isArray(Q.fields)){const ne=Q.fields.findIndex(we=>we?.name==="created_by");if(ne>=0)Q.fields[ne]={...Q.fields[ne],...oe};else{const we=Math.min(2,Q.fields.length);Q.fields.splice(we,0,oe)}}return Q},[i]),z=()=>{t(C),g("new"),S(null)},P=()=>{g("list"),S(null),t(C)},X=async Q=>{try{return(await LM(Q)).success?(await E(),t(C),g("list"),S(null),!0):!1}catch(oe){return alert(`Failed to create campaign: ${oe.message}`),!1}},H=async(Q,oe={})=>{const{stayOnPage:ne=!1}=oe;if(!M(v))return alert("You do not have permission to update this campaign."),!1;const we={...Q};Object.prototype.hasOwnProperty.call(Q,"player_ids")&&(Array.isArray(Q.player_ids)?we.player_ids=Q.player_ids.filter(ke=>ke!=null&&ke!==""):typeof Q.player_ids=="string"&&Q.player_ids!==""?we.player_ids=[Q.player_ids]:we.player_ids=[]);try{const ke=await OM(v.id,we);if(ke.success){const Re=O(ke.data);return m(Te=>Te.map(rt=>rt.id===Re.id?Re:rt)),S(Te=>!Te||Te.id!==Re.id?Te:Re),ne?{message:"Campaign updated successfully."}:(g("list"),S(null),t(C),!0)}return!1}catch(ke){return alert(`Failed to update campaign: ${ke.message}`),!1}},Y=u.useCallback((Q,oe)=>{const ne=we=>{if(!Array.isArray(we))return{members:[],playerIds:[]};const ke=we.filter(Re=>Re.role==="player");return{members:we,playerIds:ke.map(Re=>Re.user_id)}};m(we=>we.map(ke=>{if(ke.id!==Q)return ke;const{members:Re,playerIds:Te}=ne(oe);return{...ke,members:Re,player_ids:Te}})),S(we=>{if(!we||we.id!==Q)return we;const{members:ke,playerIds:Re}=ne(oe);return{...we,members:ke,player_ids:Re}})},[]),V=async Q=>{const oe=Q||v,ne=oe?.id;if(!ne)return!1;if(!M(oe))return alert("You do not have permission to delete this campaign."),!1;if(!confirm("Delete this campaign?"))return!1;try{return(await zM(ne)).success?(await E(),g("list"),S(null),t(C),!0):!1}catch(we){return alert(we.message),!1}},I=()=>{g("list"),S(null),t(C)},F=u.useMemo(()=>{if(!v)return null;const Q=v.created_by??v.owner?.id??"",oe=Array.isArray(v.members)?v.members.filter(ne=>ne.role==="player"):[];return{...v,created_by:Q,player_ids:oe.map(ne=>ne.user_id)}},[v]),D=u.useMemo(()=>{const Q=JSON.parse(JSON.stringify(A));return Array.isArray(Q.fields)?Q.fields=Q.fields.filter(oe=>oe?.name!=="player_ids"):Array.isArray(Q.sections)&&(Q.sections=Q.sections.map(oe=>({...oe,fields:(oe.fields||[]).filter(ne=>ne?.name!=="player_ids")})).filter(oe=>oe.fields&&oe.fields.length>0)),Q.title="Campaign Details",Q},[A]),L=u.useMemo(()=>{if(!v||!Array.isArray(v.members))return[];const Q=new Set;return v.members.map(oe=>{const ne=oe?.user_id??oe?.user?.id;if(!ne)return null;const we=String(ne);if(Q.has(we))return null;Q.add(we);const ke=oe?.user?.username||oe?.user?.displayName||oe?.user?.display_name||oe?.user?.name||oe?.user?.email||oe?.display_name||we;return{value:we,label:ke}}).filter(Boolean)},[v]),U=u.useMemo(()=>{const Q={title:"Campaign Membership",fields:[]},oe=we=>{if(!we)return null;if(Array.isArray(we.fields)){for(const ke of we.fields)if(ke?.name==="player_ids")return ke}return null};let ne=null;if(Array.isArray(A.fields))ne=oe(A);else if(Array.isArray(A.sections)){for(const we of A.sections)if(ne=oe(we),ne)break}if(ne){const we=JSON.parse(JSON.stringify(ne));L.length>0&&(we.selectedOptions=L),Q.fields=[we]}return Q},[A,L]),k=u.useMemo(()=>F?{player_ids:F.player_ids??[]}:null,[F]),B=u.useMemo(()=>{if(!v)return null;const Q=v.status||"",oe=Q?Q.charAt(0).toUpperCase()+Q.slice(1):"";return{...v,statusLabel:oe,createdAt:Hr(v.createdAt),updatedAt:Hr(v.updatedAt)}},[v]),R=u.useMemo(()=>e==="my"?i?.id?f.filter(Q=>Q.created_by===i.id):[]:f,[f,e,i]),q=e==="my"?"My Campaigns":"All Campaigns",G=e==="my"?"Back to my campaigns":"Back to all campaigns",J=u.useMemo(()=>!v||!Array.isArray(v.members)||!i?.id?!1:v.members.some(Q=>Q?.user_id===i.id&&Q?.role==="dm"),[v,i]),ie=v?`/campaigns/${v.id}/access/bulk`:"",me=e!=="my"&&!!(v&&J)&&ie?a.jsxs("div",{className:"campaign-access-cta",children:[a.jsxs("div",{children:[a.jsx("p",{className:"campaign-access-eyebrow",children:"Campaign Tools"}),a.jsxs("h3",{children:["Manage entity access for ",v.name]}),a.jsx("p",{className:"campaign-access-copy",children:"The Campaign Access Editor keeps changes scoped to this campaigns members."})]}),a.jsx("div",{className:"campaign-access-actions",children:a.jsx(Jt,{to:ie,className:"btn outline",children:"Open Access Editor"})})]}):null;return c?l?h?a.jsx("p",{children:"Loading campaigns..."}):w?a.jsxs("p",{className:"error",children:["Error: ",w]}):y==="new"?a.jsx(ys,{schema:h3,initialData:{},onSubmit:X,onCancel:P,showUpdateAction:!1}):y==="edit"&&v&&F?a.jsxs("div",{className:"campaign-editor",children:[me,a.jsxs("div",{className:"campaign-tabs",role:"tablist","aria-label":"Campaign editor tabs",children:[a.jsx("button",{type:"button",role:"tab","aria-selected":j==="details",className:`campaign-tab${j==="details"?" is-active":""}`,onClick:()=>_("details"),children:"Details"}),a.jsx("button",{type:"button",role:"tab","aria-selected":j==="membership",className:`campaign-tab${j==="membership"?" is-active":""}`,onClick:()=>_("membership"),children:"Membership"})]}),a.jsx("div",{className:"campaign-tab-panel",role:"tabpanel",children:j==="details"?a.jsx(ys,{schema:D,initialData:F,onSubmit:H,onDelete:V,onCancel:P}):a.jsxs("div",{className:"campaign-membership",children:[a.jsx(ys,{schema:U,initialData:k,onSubmit:H,onCancel:P}),a.jsx(u3,{campaignId:v.id,canManage:M(v),onMembersChanged:Q=>Y(v.id,Q)})]})})]}):y==="view"&&v?a.jsxs("div",{className:"campaign-view-wrapper",children:[me,a.jsx(rN,{schema:S3,data:B||{},onClose:I,closeLabel:G,infoMessage:"You can view this campaign but only the owner or a system admin can make changes."})]}):a.jsx(uf,{data:R,columns:T,title:q,extraActions:a.jsx("button",{type:"button",className:"btn submit",onClick:z,children:"+ New"}),onRowClick:Q=>{S(Q),g(M(Q)?"edit":"view"),t(`${C}/${Q.id}`)}}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const w3="New Character",N3=[{title:"Associations",columns:2,fields:[{key:"campaign_id",label:"Campaign",type:"select",optionsSource:"campaigns",required:!0,noOptionsMessage:"You do not have any campaigns available for character creation.",helpText:"Only campaigns you own or have been added to as a player are listed here."},{key:"user_id",label:"Player",type:"select",optionsSource:"users",optionLabelKey:"username",required:!0}]},{title:"Character Details",columns:2,fields:[{key:"name",label:"Name",type:"text",placeholder:"Character name",required:!0},{key:"level",label:"Level",type:"text",inputType:"number",placeholder:"1"},{key:"class",label:"Class",type:"text",placeholder:"Fighter, Wizard..."},{key:"race",label:"Race",type:"text",placeholder:"Elf, Human..."},{key:"alignment",label:"Alignment",type:"text",placeholder:"Neutral Good"},{key:"is_active",label:"Active Character",type:"checkbox"}]},{title:"Notes",columns:1,fields:[{key:"notes",label:"Notes",type:"textarea",rows:6,placeholder:"Backstory, hooks, etc."}]}],E3={title:w3,sections:N3},j3="Edit Character",_3=[{title:"Associations",columns:2,fields:[{key:"campaign_id",label:"Campaign",type:"select",optionsSource:"campaigns",required:!0},{key:"user_id",label:"Player",type:"select",optionsSource:"users",optionLabelKey:"username",required:!0}]},{title:"Character Details",columns:2,fields:[{key:"name",label:"Name",type:"text",required:!0},{key:"level",label:"Level",type:"text",inputType:"number"},{key:"class",label:"Class",type:"text"},{key:"race",label:"Race",type:"text"},{key:"alignment",label:"Alignment",type:"text"},{key:"is_active",label:"Active Character",type:"checkbox"}]},{title:"Notes",columns:1,fields:[{key:"notes",label:"Notes",type:"textarea",rows:6}]}],C3={title:j3,sections:_3},Lo=(e={})=>({id:e.id,name:e.name||"",race:e.race||"",class:e.class||"",level:e.level??1,alignment:e.alignment||"",notes:e.notes||"",is_active:e.is_active??!0,campaign_id:e.campaign_id||"",user_id:e.user_id||""}),Y0=(e={})=>{const t=Number(e.level);return{name:e.name,race:e.race||null,class:e.class||null,level:Number.isNaN(t)?1:t,alignment:e.alignment||null,notes:e.notes||null,is_active:!!e.is_active,campaign_id:e.campaign_id||null,user_id:e.user_id||null}};function Dr({scope:e="my"}){const t=$n(),{id:r}=xs(),{token:i,sessionReady:l,user:c}=En(),{selectedCampaign:f,selectedCampaignId:m,setSelectedCampaignId:h}=Bn(),[p,y]=u.useState([]),[g,v]=u.useState(!1),[S,w]=u.useState(null),[N,j]=u.useState("list"),[_,C]=u.useState(null),[O,E]=u.useState(null),[T,M]=u.useState(""),A=u.useMemo(()=>`/characters/${e}`,[e]),z=u.useMemo(()=>!f||!Array.isArray(f.members)||!c?.id?!1:f.members.some(R=>R?.user_id===c.id&&R?.role==="player"),[f,c]),P=u.useMemo(()=>!f||!Array.isArray(f.members)||!c?.id?!1:f.members.some(R=>R?.user_id===c.id&&R?.role==="dm"),[f,c]),X=u.useMemo(()=>{switch(e){case"my":return"My Characters";case"others":return f?.name?`All Characters  ${f.name}`:"All Characters";case"all":return"All Characters";case"companions":return f?.name?`My Companions  ${f.name}`:"My Companions";default:return"Characters"}},[e,f]),H=e==="my"||c?.role==="system_admin";u.useEffect(()=>{e==="all"&&c&&c.role!=="system_admin"&&t("/characters/my",{replace:!0})},[e,c,t]),u.useEffect(()=>{j("list"),C(null),E(null),M("")},[e]),u.useEffect(()=>{if(!r){N!=="new"&&j("list"),C(null),E(null);return}const R=p.find(G=>String(G.id)===r);if(!R){g||t(A,{replace:!0});return}if(!(R.isOwned||c?.role==="system_admin")){t(A,{replace:!0});return}C(R.formValues||Lo(R)),E(R.id),j("edit")},[r,p,c,t,A,g,N]);const Y=u.useCallback(async()=>{if(i&&!(e==="all"&&c&&c.role!=="system_admin")){if(w(null),e==="companions"){if(!m){y([]),M("Select a campaign to view your companions. Use Go to Campaign from My Characters to set one."),v(!1);return}if(!z){y([]),M("You must be a player in the selected campaign to view companions."),v(!1);return}}if(e==="others"){if(!m){y([]),M("Select a campaign to view all characters. Use Go to Campaign from My Characters to set one."),v(!1);return}if(!P){y([]),M("You must be a DM in the selected campaign to view all characters."),v(!1);return}}M(""),v(!0);try{const R={scope:e};(e==="companions"||e==="others"||e==="my"&&m)&&(R.campaign_id=m);const q=await Ds(R),G=(q?.data||q||[]).map(J=>({...J,playerName:J.player?.username||"",campaignName:J.campaign?.name||"",status:J.is_active?"Active":"Inactive",formValues:Lo(J),isOwned:J.user_id===c?.id}));y(G)}catch(R){console.error(" Failed to load characters:",R),w(R.message)}finally{v(!1)}}},[i,e,c,m,z,P]);u.useEffect(()=>{l&&i&&Y()},[l,i,Y]);const V=e==="my"&&!m,I=u.useMemo(()=>[{key:"name",label:"Name"},{key:"class",label:"Class"},{key:"level",label:"Level"},{key:"race",label:"Race"},{key:"alignment",label:"Alignment"},{key:"playerName",label:"Player"},{key:"campaignName",label:"Campaign"},{key:"status",label:"Status"}],[]),F=u.useMemo(()=>V?[...I,{key:"campaignAction",label:"Actions",render:R=>R.campaign_id?a.jsx("button",{type:"button",className:"btn secondary compact",onClick:q=>{q.stopPropagation(),h(String(R.campaign_id))},children:"Go to Campaign"}):"No campaign"}]:I,[I,V,h]),D=()=>{H&&(t(A),j("new"),C(null),E(null))},L=()=>{j("list"),C(null),E(null),t(A)},U=async R=>{try{return await nR(Y0(R)),j("list"),C(null),t(A),await Y(),!0}catch(q){return alert(`Error creating character: ${q.message}`),!1}},k=async(R,q={})=>{const{stayOnPage:G=!1}=q;if(!O)return!1;try{const J=await aR(O,Y0(R)),ie=J?.data||J||{id:O};if(await Y(),G){const Z=Lo(ie&&typeof ie=="object"?ie:{...R,id:O});return C(Z),{message:"Character updated successfully."}}return j("list"),C(null),E(null),t(A),!0}catch(J){return alert(`Error updating character: ${J.message}`),!1}},B=async()=>{if(!O||!confirm("Delete this character?"))return!1;try{return await sR(O),j("list"),C(null),E(null),t(A),await Y(),!0}catch(R){return alert(`Error deleting character: ${R.message}`),!1}};return l?i?g?a.jsx("p",{children:"Loading characters..."}):S?a.jsx("p",{className:"error",children:S}):N==="new"?a.jsx(ys,{schema:E3,initialData:{level:1,is_active:!0,user_id:c?.role==="system_admin"?"":c?.id||""},onSubmit:U,onCancel:L,showUpdateAction:!1}):N==="edit"?a.jsx(ys,{schema:C3,initialData:_||{},onSubmit:k,onCancel:L,onDelete:B}):N==="list"&&T?a.jsx("div",{className:"empty-state",children:a.jsx("p",{children:T})}):a.jsx(uf,{data:p,columns:F,title:X,extraActions:H?a.jsx("button",{type:"button",className:"btn submit",onClick:D,children:"+ New"}):null,onRowClick:R=>{(R.isOwned||c?.role==="system_admin")&&(t(`${A}/${R.id}`),C(R.formValues||Lo(R)),E(R.id),j("edit"))}}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}function mf(){const e=Zr();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function hf(e,t="request"){if(e.status===401)throw new Error("Unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${r}`)}return e.json()}async function Qy(){const e=await fetch(`${Cn}/users`,{headers:mf()});return hf(e,"fetch users")}async function A3(e){const t=await fetch(`${Cn}/users`,{method:"POST",headers:mf(),body:JSON.stringify(e)});return hf(t,"create user")}async function T3(e,t){const r=await fetch(`${Cn}/users/${e}`,{method:"PUT",headers:mf(),body:JSON.stringify(t)});return hf(r,"update user")}async function M3(e){const t=await fetch(`${Cn}/users/${e}`,{method:"DELETE",headers:mf()});return hf(t,"delete user")}const R3="Create New User",k3=[{title:"Account Details",columns:2,fields:[{key:"username",label:"Username",type:"text",placeholder:"Enter username"},{key:"email",label:"Email",type:"text",inputType:"email",placeholder:"user@example.com"},{key:"password",label:"Password",type:"text",inputType:"password",placeholder:"Choose a secure password"},{key:"role",label:"Role",type:"select",options:[{value:"user",label:"User"},{value:"system_admin",label:"System Admin"}],default:"user"}]}],D3={title:R3,sections:k3},I3="Edit User",L3=[{title:"Account Details",columns:2,fields:[{key:"username",label:"Username",type:"text"},{key:"email",label:"Email",type:"text",inputType:"email"},{key:"role",label:"Role",type:"select",options:[{value:"user",label:"User"},{value:"system_admin",label:"System Admin"}]},{key:"password",label:"New Password",type:"text",inputType:"password",placeholder:"Leave blank to keep current password"}]}],O3={title:I3,sections:L3};function z3(){const{user:e,token:t,sessionReady:r}=En(),[i,l]=u.useState([]),[c,f]=u.useState(!1),[m,h]=u.useState(null),[p,y]=u.useState("list"),[g,v]=u.useState(null),S=u.useCallback(async()=>{if(!(!t||e?.role!=="system_admin")){f(!0),h(null);try{const E=await Qy();l(E?.data||E||[])}catch(E){console.error(" Failed to load users:",E),h(E.message)}finally{f(!1)}}},[t,e?.role]);u.useEffect(()=>{r&&t&&e?.role==="system_admin"&&S()},[r,t,e?.role,S]);const w=[{key:"username",label:"Username"},{key:"email",label:"Email"},{key:"role",label:"Role"},{key:"createdAt",label:"Created"}],N=()=>{v(null),y("new")},j=()=>{y("list"),v(null)},_=async E=>{try{const T={username:E.username,email:E.email,password:E.password,role:E.role||"user"};return await A3(T),y("list"),v(null),await S(),!0}catch(T){return alert(`Error creating user: ${T.message}`),!1}},C=async(E,T={})=>{const{stayOnPage:M=!1}=T;if(!g?.id)return!1;try{const A={username:E.username,email:E.email,role:E.role};E.password&&(A.password=E.password);const P=(await T3(g.id,A))?.data||{...g,...A};return await S(),M?(v(P),{message:"User updated successfully."}):(y("list"),v(null),!0)}catch(A){return alert(`Error updating user: ${A.message}`),!1}},O=async()=>{if(!g?.id||!confirm(`Delete user "${g.username}"?`))return!1;try{return await M3(g.id),y("list"),v(null),await S(),!0}catch(E){return alert(`Error deleting user: ${E.message}`),!1}};return r?t?!e||e.role!=="system_admin"?a.jsx("p",{className:"error",children:"Access denied. Admins only."}):c?a.jsx("p",{children:"Loading users..."}):m?a.jsxs("p",{className:"error",children:["Error: ",m]}):p==="new"?a.jsx(ys,{schema:D3,initialData:{},onSubmit:_,onCancel:j,showUpdateAction:!1}):p==="edit"?a.jsx(ys,{schema:O3,initialData:g||{},onSubmit:C,onCancel:j,onDelete:O}):a.jsx(uf,{data:i,columns:w,title:"Users",extraActions:a.jsx("button",{type:"button",className:"btn submit",onClick:N,children:"+ New"}),onRowClick:E=>{v(E),y("edit")}}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}function $3(){const{login:e}=En(),t=$n(),[r,i]=u.useState(""),[l,c]=u.useState(""),[f,m]=u.useState(""),[h,p]=u.useState(!1),y=async g=>{g.preventDefault(),m(""),p(!0);try{await e(r,l)?t("/"):m("Invalid username or password")}catch{m("Login failed. Please try again.")}finally{p(!1)}};return a.jsx("div",{className:"login-page",children:a.jsxs("div",{className:"login-card",children:[a.jsx("h1",{className:"login-title",children:"GameDB"}),a.jsx("p",{className:"login-subtitle",children:"Sign in to your account"}),a.jsxs("form",{onSubmit:y,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Username"}),a.jsx("input",{type:"text",value:r,onChange:g=>i(g.target.value),placeholder:"Enter username",required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Password"}),a.jsx("input",{type:"password",value:l,onChange:g=>c(g.target.value),placeholder:"Enter password",required:!0})]}),f&&a.jsx("p",{className:"error-msg",children:f}),a.jsx("button",{type:"submit",disabled:h,children:h?"Signing in...":"Sign In"})]})]})})}const iN=e=>Tt.get(`/entity-types/${e}/fields`),F3=(e,t)=>Tt.post(`/entity-types/${e}/fields`,t),U3=(e,t)=>Tt.patch(`/entity-type-fields/${e}`,t),B3=e=>Tt.delete(`/entity-type-fields/${e}`),q3=[{value:"global",label:"Global"},{value:"selective",label:"Selective"},{value:"hidden",label:"Hidden"}],H3=[{value:"global",label:"Global"},{value:"selective",label:"Selective"},{value:"hidden",label:"Hidden"},{value:"owner_only",label:"Owner only"}],bi=(e,t)=>`${e}-${t}`;function lN({canEdit:e,accessSettings:t,accessOptions:r,accessOptionsLoading:i,accessSaving:l,onSettingChange:c,idPrefix:f="entity-access"}){const m=!e||l,h=bi(f,"read-mode"),p=bi(f,"read-campaigns"),y=bi(f,"read-users"),g=bi(f,"read-characters"),v=bi(f,"write-mode"),S=bi(f,"write-campaigns"),w=bi(f,"write-users");return a.jsxs("div",{className:"entity-access-columns",children:[a.jsxs("div",{className:"entity-access-column",children:[a.jsx("h3",{children:"Read access"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:h,children:"Visibility"}),a.jsx("select",{id:h,value:t.readMode,onChange:N=>c("readMode",N.target.value),disabled:m,children:q3.map(N=>a.jsx("option",{value:N.value,children:N.label},N.value))})]}),t.readMode==="selective"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:p,children:"Campaigns"}),a.jsx(Ms,{inputId:p,selected:t.readCampaigns,options:r.campaigns||[],onChange:N=>c("readCampaigns",N),placeholder:"Select campaigns...",noOptionsMessage:i?"Loading campaigns...":"No campaigns available for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Members of selected campaigns can view this entity."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:y,children:"Users"}),a.jsx(Ms,{inputId:y,selected:t.readUsers,options:r.users||[],onChange:N=>c("readUsers",N),placeholder:"Select users...",noOptionsMessage:i?"Loading users...":"No eligible users found for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Choose players who have characters in this world."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:g,children:"Characters"}),a.jsx(Ms,{inputId:g,selected:t.readCharacters,options:r.characters||[],onChange:N=>c("readCharacters",N),placeholder:"Select characters...",noOptionsMessage:i?"Loading characters...":"No characters available for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Grant visibility to specific characters regardless of campaign."})]})]})]}),a.jsxs("div",{className:"entity-access-column",children:[a.jsx("h3",{children:"Write access"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:v,children:"Write"}),a.jsx("select",{id:v,value:t.writeMode,onChange:N=>c("writeMode",N.target.value),disabled:m,children:H3.map(N=>a.jsx("option",{value:N.value,children:N.label},N.value))})]}),t.writeMode==="selective"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:S,children:"Campaigns"}),a.jsx(Ms,{inputId:S,selected:t.writeCampaigns,options:r.campaigns||[],onChange:N=>c("writeCampaigns",N),placeholder:"Select campaigns...",noOptionsMessage:i?"Loading campaigns...":"No campaigns available for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Dungeon Masters of these campaigns can edit this entity."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:w,children:"Users"}),a.jsx(Ms,{inputId:w,selected:t.writeUsers,options:r.users||[],onChange:N=>c("writeUsers",N),placeholder:"Select users...",noOptionsMessage:i?"Loading users...":"No eligible users found for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Grant edit access to specific players with characters here."})]})]})]})]})}const Hu=e=>!e||typeof e!="string"?"":e.trim(),G0=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[];async function oN(e){if(!e)return{campaigns:[],users:[],characters:[]};const[t,r]=await Promise.all([jc({world_id:e}),Ds({world_id:e})]),l=G0(t).map(h=>({value:String(h.id),label:h.name||"Untitled campaign"})),c=G0(r),f=new Map,m=new Map;return c.forEach(h=>{const p=h?.user_id||h?.player?.id;if(!p)return;const y=String(p);if(f.has(y))return;const g=h?.player||{},v=Hu(g.username),S=Hu(g.email);let w=v||S||`User ${y.slice(0,8)}`;v&&S&&v!==S&&(w=`${v} (${S})`),f.set(y,{value:y,label:w});const N=h?.id||h?.character_id;if(!N)return;const j=Hu(h.name)||"Unnamed character",_=Hu(h?.campaign?.name||h?.campaign_name||""),C=_?`${j}  ${_}`:j;m.set(String(N),{value:String(N),label:C})}),{campaigns:l,users:Array.from(f.values()),characters:Array.from(m.values())}}const qh=(e,t,r)=>Number.isNaN(e)?t:Math.min(Math.max(e,t),r),P3=220,V3=3;function cN({src:e,size:t=P3,onCropChange:r,className:i="",zoomLabel:l="Zoom"}){const[c,f]=u.useState({width:0,height:0}),[m,h]=u.useState(1),[p,y]=u.useState({x:0,y:0}),[g,v]=u.useState(!1),S=u.useRef({x:0,y:0}),w=u.useRef(null),N=u.useRef(null);u.useEffect(()=>{if(!e){f({width:0,height:0});return}let H=!1;const Y=new Image;return Y.onload=()=>{H||f({width:Y.naturalWidth,height:Y.naturalHeight})},Y.onerror=()=>{H||f({width:0,height:0})},Y.src=e,()=>{H=!0}},[e]);const j=u.useMemo(()=>{if(!c.width||!c.height)return 1;const H=t/c.width,Y=t/c.height;return Math.max(H,Y)},[c,t]);u.useEffect(()=>{if(!c.width||!c.height)return;h(j);const H=c.width*j,Y=c.height*j;y({x:(t-H)/2,y:(t-Y)/2})},[c,j,t]);const _=u.useCallback((H,Y=m)=>{if(!c.width||!c.height)return H;const V=c.width*Y,I=c.height*Y,F=Math.min(0,t-V),D=Math.max(0,t-V),L=Math.min(0,t-I),U=Math.max(0,t-I);return{x:qh(H.x,F,D),y:qh(H.y,L,U)}},[c,m,t]),C=H=>{if(!e)return;H.preventDefault(),N.current?.setPointerCapture?.(H.pointerId),w.current=H.pointerId,S.current={x:H.clientX,y:H.clientY},v(!0)},O=H=>{if(!g)return;H.preventDefault();const Y=H.clientX-S.current.x,V=H.clientY-S.current.y;S.current={x:H.clientX,y:H.clientY},y(I=>_({x:I.x+Y,y:I.y+V}))},E=u.useCallback(()=>{const H=N.current;w.current!==null&&(H?.releasePointerCapture?.(w.current),w.current=null),v(!1)},[]),T=j*V3,M=Math.max(j/50,.01),A=T-j>.001,z=H=>{const Y=qh(Number(H.target.value),j,T);h(Y),y(V=>_(V,Y))};u.useEffect(()=>{typeof r=="function"&&(!c.width||!c.height||!e||r({offset:p,scale:m,containerSize:t,naturalWidth:c.width,naturalHeight:c.height}))},[p,m,t,c,r,e]),u.useEffect(()=>{const H=N.current;if(!H)return;const Y=()=>E(),V=()=>E();return H.addEventListener("pointerup",Y),H.addEventListener("pointerleave",V),H.addEventListener("pointercancel",V),()=>{H.removeEventListener("pointerup",Y),H.removeEventListener("pointerleave",V),H.removeEventListener("pointercancel",V)}},[E]);const P=c.width*m,X=c.height*m;return a.jsxs("div",{className:`image-cropper ${i}`.trim(),children:[a.jsxs("div",{className:`image-cropper__frame${g?" is-dragging":""}`,ref:N,style:{width:t,height:t},onPointerDown:C,onPointerMove:O,role:"presentation",children:[e?a.jsx("img",{src:e,alt:"Selected artwork preview",draggable:!1,style:{width:P,height:X,transform:`translate(${p.x}px, ${p.y}px)`}}):a.jsx("div",{className:"image-cropper__empty",children:"Unable to preview image"}),a.jsx("div",{className:"image-cropper__outline","aria-hidden":"true"}),a.jsx("div",{className:"image-cropper__instructions","aria-hidden":"true",children:"Drag to reposition"})]}),A?a.jsxs("label",{className:"image-cropper__zoom",children:[a.jsx("span",{children:l}),a.jsx("input",{type:"range",min:j,max:T,step:M,value:m,onChange:z})]}):a.jsx("p",{className:"image-cropper__zoom image-cropper__zoom--disabled",children:"Zoom unavailable for this image"})]})}const uN=async(e,t,r={})=>{if(!e||!t)return e;const{offset:i,scale:l,containerSize:c,naturalWidth:f,naturalHeight:m}=t;if(!i||!l||!c||!f||!m||typeof createImageBitmap!="function")return e;try{const h=await createImageBitmap(e),p=f?h.width/f:1,y=m?h.height/m:1,g=(p+y)/2||1,v=l*g,S=c/v,w=c/v,N=(0-i.x)/l*g,j=(0-i.y)/l*g,_=Math.min(Math.max(S,1),h.width),C=Math.min(Math.max(w,1),h.height),O=h.width-_,E=h.height-C,T=Math.min(Math.max(N,0),Math.max(O,0)),M=Math.min(Math.max(j,0),Math.max(E,0)),A=document.createElement("canvas");A.width=Math.round(_),A.height=Math.round(C),A.getContext("2d").drawImage(h,T,M,_,C,0,0,A.width,A.height),h.close?.();const P=r.mimeType||e.type||"image/jpeg",X=r.quality||(P==="image/png"?void 0:.92),H=await new Promise((V,I)=>{A.toBlob(F=>{F?V(F):I(new Error("Unable to crop image"))},P,X)}),Y=(()=>{if(!e.name)return"cropped-image";const V=P==="image/png"?".png":".jpg";return e.name.toLowerCase().endsWith(V)?e.name:`${e.name.includes(".")?e.name.slice(0,e.name.lastIndexOf(".")):e.name}${V}`})();return new File([H],Y,{type:P})}catch(h){return console.warn(" Unable to crop image, using original selection",h),e}},Y3=[{value:"hidden",label:"Hidden"},{value:"partial",label:"Partial"},{value:"visible",label:"Visible"}],G3=new Set(["image/png","image/jpeg","image/jpg"]),X3=2*1024*1024,K3=new Set(["global","selective","hidden"]),W3=new Set(["global","selective","hidden","owner_only"]),Pu=()=>({campaigns:[],users:[],characters:[]}),Hh=(e="")=>{const t=String(e||"").trim();return t?{readMode:"selective",readCampaigns:[t],readUsers:[],readCharacters:[],writeMode:"selective",writeCampaigns:[t],writeUsers:[]}:{readMode:"global",readCampaigns:[],readUsers:[],readCharacters:[],writeMode:"global",writeCampaigns:[],writeUsers:[]}},Z3=e=>Number.isFinite(e)?e>=1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:e>=1024?`${(e/1024).toFixed(1)} KB`:`${e} bytes`:"",Q3=e=>{const t=e?.options?.choices;return!Array.isArray(t)||t.length===0?[]:t.map((r,i)=>{if(r==null)return null;if(typeof r=="object"){const c=r.value??r.id??r.key??r.slug??`choice-${i}`,f=r.label??r.name??r.title??r.display??c;return c==null?null:{value:c,label:String(f??c)}}const l=String(r);return{value:l,label:l}}).filter(Boolean)},J3=e=>{if(!e)return"";if(e instanceof Date)return e.toISOString().slice(0,10);if(typeof e=="string"){const r=e.trim();if(!r)return"";if(/^\d{4}-\d{2}-\d{2}/.test(r))return r.slice(0,10);const i=new Date(r);return Number.isNaN(i.getTime())?"":i.toISOString().slice(0,10)}const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toISOString().slice(0,10)},e4=(e,t)=>{if(e==null)return"";switch(t?.dataType||t?.data_type){case"boolean":{if(typeof e=="boolean")return e?"true":"false";if(typeof e=="number")return e!==0?"true":"false";if(typeof e=="string"){const i=e.trim().toLowerCase();if(i==="true"||i==="false")return i}return""}case"number":return e===""?"":String(e);case"date":return J3(e);case"reference":{if(typeof e=="object"&&e!==null){const i=e.id??e.value??e.entity_id??e.entityId??null;if(i!=null)return String(i)}return String(e)}default:return String(e)}},t4=(e,t)=>{const r=t?.dataType||t?.data_type;if(e!=null){if(typeof e=="string"){const i=e.trim();if(r!=="boolean"&&i==="")return"";e=i}switch(r){case"number":{if(e==="")return"";const i=Number(e);return Number.isNaN(i)?e:i}case"boolean":{if(typeof e=="boolean")return e;if(typeof e=="number")return e!==0;if(typeof e=="string"){const i=e.toLowerCase();if(i==="true")return!0;if(i==="false")return!1}return e}case"reference":return typeof e=="string"?e.trim():e;default:return e}}},X0="entity-form-advanced-open",n4=e=>{if(e==null)return"";if(typeof e=="object")try{return JSON.stringify(e)}catch{return""}return String(e)},a4=e=>{const t=e.trim();if(t.length===0)return"";if(t==="true")return!0;if(t==="false")return!1;const r=t[0],i=t[t.length-1];if(r==="{"&&i==="}"||r==="["&&i==="]")try{return JSON.parse(t)}catch{return e}return e};function dN({worldId:e,entityId:t,onCancel:r,onSaved:i,formId:l="entity-form",onStateChange:c,hideActions:f=!1,selectedEntityTypeId:m="",activeView:h="details",onViewChange:p,defaultCampaignId:y=""}){const g=!!t,v=u.useRef(0),S=u.useRef(null),w=u.useRef(null),N=u.useRef(null),j=u.useRef(String(y??"")),_=u.useCallback((ue="",qe="")=>(v.current+=1,{id:v.current,key:ue,value:qe}),[v]),[C,O]=u.useState([]),[E,T]=u.useState(!1),[M,A]=u.useState(!1),[z,P]=u.useState(!1),[X,H]=u.useState(!1),[Y,V]=u.useState(""),[I,F]=u.useState({name:"",description:"",entityTypeId:m||"",visibility:"visible"}),[D,L]=u.useState(()=>(v.current=0,[_()])),[U,k]=u.useState([]),[B,R]=u.useState({}),[q,G]=u.useState({}),[J,ie]=u.useState(()=>Hh(y)),[Z,me]=u.useState(()=>Pu()),[Q,oe]=u.useState(!1),[ne,we]=u.useState(""),ke=u.useRef(!1),[Re,Te]=u.useState(null),[rt,He]=u.useState(null),[tt,Ie]=u.useState(null),[vt,Ct]=u.useState(""),[At,_t]=u.useState(""),[Pe,Ze]=u.useState(!1),[W,ee]=u.useState(!1),[te,ve]=u.useState(()=>{if(typeof window>"u")return!1;try{return window.sessionStorage?.getItem(X0)==="true"}catch(ue){return console.warn(" Unable to read advanced options preference",ue),!1}}),le=u.useMemo(()=>D.some(ue=>ue.key.trim()!==""||ue.value.trim()!==""),[D]),Se=u.useCallback(ue=>{if(ue&&typeof URL<"u")try{URL.revokeObjectURL(ue)}catch(qe){console.warn("Unable to revoke preview URL",qe)}},[]),Ee=u.useCallback(()=>{He(null),Ie(null),_t(""),Ct(ue=>(Se(ue),"")),w.current&&(w.current.value=""),N.current&&(N.current.value="")},[Se]);u.useEffect(()=>()=>{Se(vt)},[Se,vt]);const ge=u.useCallback(ue=>{const qe=ue.target.files?.[0];if(qe){if(!G3.has(qe.type)){_t("Only PNG or JPG images are allowed."),ue.target.value="";return}if(qe.size>X3){_t("Image must be smaller than 2 MB."),ue.target.value="";return}_t(""),He(qe),Ie(null),Ct(Ge=>(Se(Ge),URL.createObjectURL(qe)))}},[Se]),at=u.useCallback(()=>{!t||Pe||W||M||w.current?.click()},[t,W,Pe,M]),st=u.useCallback(ue=>{if(!ue){Te(null);return}const qe=ue.imageData??ue.image_data??null,Ge=ue.imageMimeType??ue.image_mime_type??null;Te(qe&&Ge?{imageData:qe,imageMimeType:Ge}:null)},[]),nt=u.useCallback(async()=>{if(!t)return null;const ue=await rr(t),qe=Pa(ue);return qe&&st(qe),qe},[st,t]),$e=u.useCallback(async()=>{if(!(!t||!rt)){Ze(!0),_t("");try{const ue=tt?await uN(rt,tt):rt;await U1(t,ue),await nt(),Ee()}catch(ue){_t(ue.message||"Failed to upload image")}finally{Ze(!1)}}},[t,rt,tt,nt,Ee]),ft=u.useCallback(async()=>{if(!(!t||Pe||W)){_t(""),ee(!0);try{await B1(t),await nt(),Ee()}catch(ue){_t(ue.message||"Failed to remove image")}finally{ee(!1)}}},[t,W,Pe,nt,Ee]),zt=u.useMemo(()=>{const ue="PNG or JPG up to 2 MB.";return rt?`${ue} Selected: ${rt.name} (${Z3(rt.size)})`:ue},[rt]),Rt=rt?a.jsxs("div",{className:"entity-image-actions",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:$e,disabled:Pe,children:Pe?"Uploading":"Save Image"}),a.jsx("button",{type:"button",className:"btn secondary",onClick:Ee,disabled:Pe,children:"Cancel"})]}):null,pt=u.useCallback(ue=>ue.length>0?ue:[_()],[_]),ct=u.useCallback(ue=>{if(v.current=0,!ue||typeof ue!="object"||Array.isArray(ue))return[_()];const qe=Object.entries(ue);return qe.length===0?[_()]:qe.map(([Ge,ut])=>_(Ge,n4(ut)))},[_]);u.useEffect(()=>{let ue=!1;return(async()=>{if(ue||V(""),!e){O([]),T(!1);return}T(!0);try{const Ge=await Qr({worldId:e}),ut=Array.isArray(Ge)?Ge:Array.isArray(Ge?.data)?Ge.data:[];if(!ue){const ae=ut.map(Xe=>{const Fe=Xe?.id||Xe?.entity_type_id||Xe?.entityTypeId||"";return Fe?{id:Fe,name:Xe?.name||Xe?.label||Xe?.title||"Untitled"}:null}).filter(Boolean);O(ae)}}catch(Ge){ue||(V(Ge.message||"Failed to load entity types"),O([]))}finally{ue||T(!1)}})(),()=>{ue=!0}},[e]),u.useEffect(()=>{if(!e){F(ue=>({...ue,entityTypeId:""}));return}F(ue=>!ue.entityTypeId||C.some(Ge=>Ge.id===ue.entityTypeId)?ue:{...ue,entityTypeId:""})},[e,C]),u.useEffect(()=>{let ue=!1;const qe=()=>{v.current=0,F({name:"",description:"",entityTypeId:m||"",visibility:"visible"}),L([_()]),k([]),R({}),V(""),p?.("details");const ut=Hh(j.current);ie(ut),ke.current=!1,me(Pu()),we(""),Te(null),Ee()};if(!g)return qe(),A(!1),S.current=null,()=>{};const Ge=async()=>{A(!0),V(""),_t("");try{const ut=await rr(t),ae=Pa(ut);if(!ae)throw new Error("Entity not found");if(!ue){const Xe=ct(ae.metadata);F({name:ae.name||"",description:ae.description||"",entityTypeId:ae.entity_type_id||ae.entityType?.id||"",visibility:ae.visibility||"visible"}),L(pt(Xe)),st(ae),Ee()}}catch(ut){ue||V(ut.message||"Failed to load entity")}finally{ue||A(!1)}};return S.current!==t&&(Te(null),Ee(),S.current=t),Ge(),()=>{ue=!0}},[t,g,pt,_,ct,m,p,st,Ee]);const yt=ue=>qe=>{const{value:Ge}=qe.target;F(ut=>({...ut,[ue]:Ge}))},Mt=(ue,qe)=>Ge=>{const{value:ut}=Ge.target;L(ae=>ae.map(Xe=>Xe.id===ue?{...Xe,[qe]:ut}:Xe))},Ft=()=>{L(ue=>[...ue,_()])},kt=ue=>{L(qe=>pt(qe.filter(Ge=>Ge.id!==ue)))},Zt=ue=>qe=>{const{value:Ge}=qe.target;R(ut=>({...ut,[ue]:Ge}))},Lt=u.useCallback((ue,qe)=>{we(""),ie(Ge=>{const ut={...Ge};if(ue==="readMode"||ue==="writeMode"){const ae=typeof qe=="string"?qe.trim().toLowerCase():"global";return ue==="readMode"?(ut.readMode=K3.has(ae)?ae:"global",ut.readMode!=="selective"&&(ut.readCampaigns=[],ut.readUsers=[],ut.readCharacters=[])):(ut.writeMode=W3.has(ae)?ae:"global",ut.writeMode!=="selective"&&(ut.writeCampaigns=[],ut.writeUsers=[])),ut}return["readCampaigns","readUsers","readCharacters","writeCampaigns","writeUsers"].includes(ue)?(ut[ue]=Array.isArray(qe)?qe.map(ae=>String(ae).trim()).filter(Boolean):[],ut):(ut[ue]=qe,ut)})},[]);u.useEffect(()=>{ke.current=!1,me(Pu()),we("")},[e]),u.useEffect(()=>{if(g)return;const ue=String(y??"");if(ue===j.current)return;const qe=Hh(ue);j.current=ue,ie(qe)},[y,g]),u.useEffect(()=>{if(h!=="access"||!e||ke.current)return;let ue=!1;return oe(!0),we(""),(async()=>{try{const Ge=await oN(e);if(ue)return;me({campaigns:Ge.campaigns??[],users:Ge.users??[],characters:Ge.characters??[]}),ke.current=!0}catch(Ge){if(ue)return;me(Pu()),we(Ge.message||"Failed to load access options"),ke.current=!1}finally{ue||oe(!1)}})(),()=>{ue=!0}},[h,e]);const Kt=u.useCallback(()=>{ve(ue=>{const qe=!ue;try{typeof window<"u"&&window.sessionStorage?.setItem(X0,qe?"true":"false")}catch(Ge){console.warn(" Unable to persist advanced options preference",Ge)}return qe})},[]),se=async ue=>{if(ue.preventDefault(),!e&&!g){V("A world must be selected before creating an entity.");return}const qe=I.name.trim();if(!qe){V("Name is required.");return}const Ge=I.entityTypeId||m||"";if(!Ge){V("Entity type is required.");return}const ut=g&&I.visibility||"visible";if(g&&!Y3.some(Qe=>Qe.value===ut)){V("Invalid visibility selected.");return}let ae={};if(g)D.forEach(({key:Qe,value:bt})=>{const St=Qe.trim();St&&(ae[St]=a4(bt))});else if(U.length>0){const Qe={};for(const bt of U){const St=bt.name,_e=B[St],et=_e!=null&&(typeof _e!="string"||_e.trim()!=="");if(bt.required&&!et){const mt=bt.label||bt.name;V(`${mt} is required.`);return}et&&(Qe[St]=t4(_e,bt))}ae=Qe}const Xe=I.description?I.description.trim():"",Fe={name:qe,description:Xe,visibility:ut,metadata:ae,entity_type_id:Ge};try{if(H(!0),V(""),g)await By(t,Fe);else{const Qe={read_access:J.readMode,write_access:J.writeMode,read_campaign_ids:J.readMode==="selective"?J.readCampaigns:[],read_user_ids:J.readMode==="selective"?J.readUsers:[],read_character_ids:J.readMode==="selective"?J.readCharacters:[],write_campaign_ids:J.writeMode==="selective"?J.writeCampaigns:[],write_user_ids:J.writeMode==="selective"?J.writeUsers:[]};await Uy({...Fe,...Qe,world_id:e})}i?.(g?"edit":"create")}catch(Qe){V(Qe.message||"Failed to save entity")}finally{H(!1)}},be=E||M||z,je=!g,We=je&&h==="access";u.useEffect(()=>{if(p){if(!je&&h!=="details"){p("details");return}We&&!e&&p("details")}},[h,je,We,p,e]),u.useEffect(()=>{if(!c)return;c({mode:g?"edit":"create",saving:X,isBusy:be,submitLabel:X?"Saving...":g?"Save Changes":"Create Entity",submitDisabled:X||be,cancelDisabled:X,accessButtonVisible:je,accessButtonDisabled:X||be||!e&&!We})},[c,g,X,be,je,We,e]),u.useEffect(()=>{g||F(ue=>({...ue,entityTypeId:m||""}))},[g,m]);const dt=u.useMemo(()=>g?"":I.entityTypeId?I.entityTypeId:m||"",[g,m,I.entityTypeId]);u.useEffect(()=>{if(g){k([]),R({}),G({});return}if(!dt){k([]),R({}),G({});return}let ue=!1;return(async()=>{P(!0);try{const Ge=await iN(dt),ut=Array.isArray(Ge)?Ge:Array.isArray(Ge?.data)?Ge.data:[];if(ue)return;const ae=ut.map(Fe=>{if(!Fe)return null;const Qe=Fe.name||Fe.field_name;if(!Qe)return null;const bt=Fe.data_type||Fe.dataType||"text",St=Fe.reference_type_id??Fe.referenceTypeId??Fe.referenceType?.id??null,_e=Fe.reference_type_name??Fe.referenceTypeName??Fe.referenceType?.name??"",et=Fe.reference_filter??Fe.referenceFilter??Fe.referenceFilterJson??{};return{id:Fe.id||Qe,name:Qe,label:Fe.label||Fe.name||Qe,dataType:bt,required:!!Fe.required,options:Fe.options||{},defaultValue:Fe.default_value??Fe.defaultValue??null,referenceTypeId:St,referenceTypeName:_e,referenceFilter:et}}).filter(Boolean);k(ae),G({});const Xe={};ae.forEach(Fe=>{const Qe=Fe.defaultValue;Qe!=null&&Qe!==""?Xe[Fe.name]=e4(Qe,Fe):Xe[Fe.name]=""}),R(Xe)}catch(Ge){ue||(V(Ge.message||"Failed to load metadata fields"),k([]),R({}),G({}))}finally{ue||P(!1)}})(),()=>{ue=!0}},[dt,g]);const gt=u.useMemo(()=>{const ue=I.entityTypeId||m||"";return ue&&C.find(qe=>qe.id===ue)||null},[C,I.entityTypeId,m]),ce=ue=>{const qe=`metadata-field-${ue.id}`,Ge=B[ue.name]??"",ut=!!ue.required;switch(ue.dataType){case"boolean":return a.jsxs("select",{id:qe,value:Ge,onChange:Zt(ue.name),disabled:X||z,required:ut,children:[a.jsx("option",{value:"",children:"Select..."}),a.jsx("option",{value:"true",children:"True"}),a.jsx("option",{value:"false",children:"False"})]});case"enum":{const ae=Q3(ue);return a.jsxs("select",{id:qe,value:Ge,onChange:Zt(ue.name),disabled:X||z,required:ut,children:[a.jsx("option",{value:"",children:"Select..."}),ae.map(Xe=>a.jsx("option",{value:Xe.value,children:Xe.label},Xe.value))]})}case"reference":{const ae=ue.referenceTypeId??ue.reference_type_id??null,Xe=ae?String(ae).trim():null,Fe=ue.referenceTypeName||"entities",Qe=typeof Fe=="string"&&Fe.trim()?Fe.trim():"entities",bt=Array.isArray(ue.options?.choices)?ue.options.choices.map((jt,Wt)=>{if(jt==null)return null;if(typeof jt=="object"){const dn=jt.value??jt.id??jt.key??jt.slug??`choice-${Wt}`;if(dn==null)return null;const Qt=jt.label??jt.name??jt.title??jt.display??jt.displayName??dn;return{value:String(dn),label:String(Qt)}}const ln=String(jt);return{value:ln,label:ln}}).filter(Boolean):[],St=bt.length>0,et=X||z||!St&&!!!(e&&Xe),mt=q[ue.name]||"",fe=!mt&&Ge&&bt.find(jt=>String(jt.value)===String(Ge))?.label||"",he=Ge&&(mt||fe)?{id:Ge,name:mt||fe}:Ge,Ve=Ge?String(Ge):"",xt=q[ue.name]||fe||Qe,Nt=jt=>{if(!jt){R(Qt=>({...Qt,[ue.name]:""})),G(Qt=>{if(!Qt[ue.name])return Qt;const pa={...Qt};return delete pa[ue.name],pa});return}const Wt=jt.id??jt.value??jt.key??jt.slug??jt.uuid??null;if(Wt==null){R(Qt=>({...Qt,[ue.name]:""}));return}const ln=String(Wt),dn=jt.name??jt.label??jt.title??jt.display??jt.displayName??"";R(Qt=>({...Qt,[ue.name]:ln})),G(Qt=>({...Qt,[ue.name]:dn||ln}))},Et=jt=>{if(!jt){G(Qt=>{if(!Qt[ue.name])return Qt;const pa={...Qt};return delete pa[ue.name],pa});return}const Wt=jt.id??jt.value??jt.key??jt.slug??jt.uuid??null;if(Wt==null)return;const ln=String(Wt),dn=jt.name??jt.label??jt.title??jt.display??jt.displayName??"";G(Qt=>Qt[ue.name]===(dn||ln)?Qt:{...Qt,[ue.name]:dn||ln})};return a.jsxs("div",{className:"reference-field-control",children:[a.jsxs("div",{className:"reference-field-input-row",children:[a.jsx(oc,{worldId:e,value:he,allowedTypeIds:Xe&&Xe.length>0?[Xe]:[],placeholder:`Search ${Qe.toLowerCase()}...`,disabled:et,staticOptions:bt,onChange:Nt,onResolved:Et,required:ut}),Ve&&a.jsx(Is,{entityId:Ve,entityName:xt,className:"reference-field-info-btn"})]}),!Xe&&a.jsx("p",{className:"field-hint warning",children:"Reference type configuration is missing."}),Xe&&!e&&a.jsx("p",{className:"field-hint warning",children:"Select a world to search for entities."})]})}case"number":return a.jsx("input",{id:qe,type:"number",value:Ge,onChange:Zt(ue.name),disabled:X||z,required:ut});case"text":return a.jsx("textarea",{id:qe,value:Ge,onChange:Zt(ue.name),disabled:X||z,rows:4,required:ut});case"date":return a.jsx("input",{id:qe,type:"date",value:Ge,onChange:Zt(ue.name),disabled:X||z,required:ut});default:return a.jsx("input",{id:qe,type:"text",value:Ge,onChange:Zt(ue.name),disabled:X||z,required:ut})}},re=!g&&!!m,Ne=!g&&U.length>0,Be=()=>a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-type",children:"Type *"}),re?a.jsx("input",{id:"entity-type",type:"text",value:gt?.name||"",readOnly:!0,disabled:!0}):a.jsxs("select",{id:"entity-type",value:I.entityTypeId,onChange:yt("entityTypeId"),disabled:X||E,required:!0,children:[a.jsx("option",{value:"",children:"Select type..."}),C.map(ue=>a.jsx("option",{value:ue.id,children:ue.name},ue.id))]})]}),Ke=vt||Ul(Re),ot=I.name?`${I.name} artwork`:"Entity artwork",ze=()=>a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-name",children:"Name *"}),a.jsx("input",{id:"entity-name",type:"text",value:I.name,onChange:yt("name"),placeholder:"e.g. Waterdeep",disabled:X,required:!0,"data-autofocus":!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-description",children:"Description"}),a.jsx("textarea",{id:"entity-description",value:I.description,onChange:yt("description"),placeholder:"Optional summary of the entity",rows:4,disabled:X})]})]});return a.jsxs("form",{id:l,className:"entity-form",onSubmit:se,children:[be?a.jsx("div",{className:"form-loading",children:"Loading..."}):a.jsx(a.Fragment,{children:We?a.jsxs("section",{className:"entity-card entity-access-card drawer-access-card",children:[a.jsx("h3",{className:"entity-card-title",children:"Manage access"}),a.jsx("p",{className:"entity-access-note help-text",children:"Configure who can view and edit this entity. Users with write access will automatically receive read access."}),ne&&a.jsx("div",{className:"alert error",role:"alert",children:ne}),e?a.jsx(lN,{canEdit:!X,accessSettings:J,accessOptions:Z,accessOptionsLoading:Q,accessSaving:X,onSettingChange:Lt,idPrefix:"entity-create-access"}):a.jsx("p",{className:"entity-empty-state",children:"Assign this entity to a world to configure access settings."})]}):a.jsxs(a.Fragment,{children:[g&&Re?a.jsxs("div",{className:"entity-form-image-wrapper",children:[a.jsxs("div",{className:"entity-form-image-panel","aria-live":"polite",children:[a.jsx("div",{className:`entity-image-preview ${Ke?"has-image":""}`.trim(),children:Ke?a.jsx("img",{src:Ke,alt:ot,loading:"lazy"}):a.jsx("div",{className:"entity-image-placeholder",children:a.jsx("p",{children:"No image"})})}),a.jsxs("div",{className:"entity-form-image-panel-actions",children:[a.jsx("button",{type:"button",className:"btn secondary",onClick:at,disabled:!t||Pe||W||M,children:Pe?"Uploading":"Replace Image"}),a.jsx("button",{type:"button",className:"btn secondary",onClick:ft,disabled:!t||W||Pe,children:W?"Removing":"Remove Image"})]}),Rt,a.jsx("input",{type:"file",ref:w,accept:"image/png,image/jpeg",onChange:ge,hidden:!0,disabled:!t||Pe||W}),a.jsx("p",{className:"entity-image-helper",children:zt}),At?a.jsx("p",{className:"entity-image-status entity-image-status--error",children:At}):null,!At&&Pe?a.jsx("p",{className:"entity-image-status",children:"Uploading image"}):null,!At&&W?a.jsx("p",{className:"entity-image-status",children:"Removing image"}):null]}),a.jsx("div",{className:"entity-form-image-fields",children:ze()})]}):ze(),!g&&Be(),g&&!Re?a.jsxs("div",{className:"form-group entity-form-upload-section",children:[a.jsx("label",{htmlFor:"entity-image-upload",children:"Upload image"}),a.jsx("input",{id:"entity-image-upload",type:"file",accept:"image/png,image/jpeg",ref:N,onChange:ge,disabled:!t||Pe||W}),rt&&vt?a.jsx("div",{className:"entity-form-upload-preview",children:a.jsx(cN,{src:vt,size:220,zoomLabel:"Zoom to crop",onCropChange:Ie})}):null,Rt,a.jsx("p",{className:"entity-image-helper",children:zt}),At?a.jsx("p",{className:"entity-image-status entity-image-status--error",children:At}):null,!At&&Pe?a.jsx("p",{className:"entity-image-status",children:"Uploading image"}):null,!At&&W?a.jsx("p",{className:"entity-image-status",children:"Removing image"}):null]}):null,Ne&&a.jsxs("div",{className:"metadata-field-section",children:[a.jsx("h3",{children:"Information"}),U.map(ue=>a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`metadata-field-${ue.id}`,children:[ue.label,ue.required?" *":""]}),ce(ue)]},ue.id))]}),je&&!e&&a.jsx("p",{className:"help-text",children:"Assign a world to configure access controls."}),g&&a.jsx("div",{className:"form-two-column",children:Be()}),g&&a.jsxs("div",{className:"advanced-options",children:[a.jsxs("button",{type:"button",className:"advanced-options-toggle",onClick:Kt,"aria-expanded":te,children:[a.jsx("span",{children:"Advanced options"}),le?a.jsx("span",{className:"advanced-indicator",children:"Metadata added"}):null,a.jsx("span",{className:"advanced-chevron","aria-hidden":"true",children:te?"":""})]}),te&&a.jsx("div",{className:"advanced-options-body",children:a.jsxs("div",{className:"metadata-editor",children:[a.jsxs("div",{className:"metadata-header",children:[a.jsxs("h3",{children:["Metadata ",le?"":"(optional)"]}),a.jsx("button",{type:"button",className:"btn neutral",onClick:Ft,disabled:X,children:"Add field"})]}),a.jsx("div",{className:"metadata-list",children:D.map((ue,qe)=>a.jsxs("div",{className:"metadata-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`metadata-key-${ue.id}`,className:"sr-only",children:["Metadata key ",qe+1]}),a.jsx("input",{id:`metadata-key-${ue.id}`,type:"text",placeholder:"Key",value:ue.key,onChange:Mt(ue.id,"key"),disabled:X})]}),a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`metadata-value-${ue.id}`,className:"sr-only",children:["Metadata value ",qe+1]}),a.jsx("input",{id:`metadata-value-${ue.id}`,type:"text",placeholder:"Value",value:ue.value,onChange:Mt(ue.id,"value"),disabled:X})]}),a.jsx("div",{className:"metadata-actions",children:a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>kt(ue.id),disabled:X||D.length===1,title:"Remove field",children:""})})]},ue.id))})]})})]})]})}),Y&&a.jsx("div",{className:"form-error",role:"alert",children:Y}),!f&&a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:r,disabled:X,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:X||be,children:X?"Saving...":g?"Save Changes":"Create Entity"})]})]})}const s4={visible:"badge-visible",partial:"badge-partial",hidden:"badge-hidden"},r4=new Set(["system_admin"]),K0="entityType",as=["name","type","visibility","createdAt"],Vu=[{key:"name",label:"Name",type:"core"},{key:"type",label:"Type",type:"core"},{key:"importance",label:"Importance",type:"core"},{key:"visibility",label:"Visibility",type:"core"},{key:"createdAt",label:"Created",type:"core"},{key:"description",label:"Description",type:"core"}],Ph="user",W0="system",pl=(e="create")=>({mode:e,submitLabel:e==="edit"?"Save Changes":"Create Entity",submitDisabled:!1,cancelDisabled:!1,accessButtonVisible:!1,accessButtonDisabled:!1}),Vh=(e=[],t=[])=>e.length!==t.length?!1:e.every((r,i)=>r===t[i]),Yh=(e,t,r)=>{const i=new Set(r),l=[];if(Array.isArray(e)&&e.forEach(f=>{if(typeof f!="string")return;const m=f.trim();!m||!i.has(m)||l.includes(m)||l.push(m)}),l.length>0)return l;const c=Array.isArray(t)?t.filter(f=>typeof f=="string"&&i.has(f)):[];return c.length>0?[...c]:i.size>0?[i.values().next().value]:[]},i4=e=>{if(!e||typeof e!="object")return"";const t=e.displayValue??e.display??e.label??e.displayName??e.text??e.name??e.title??e.value??e.id??null;return t!=null?String(t).trim():""},Jy=e=>!e||typeof e!="object"?!1:Array.isArray(e)?e.some(t=>Jy(t)):Object.prototype.hasOwnProperty.call(e,"displayValue")||Object.prototype.hasOwnProperty.call(e,"display")||Object.prototype.hasOwnProperty.call(e,"label"),fN=e=>{if(e==null)return"";if(Array.isArray(e)){const t=e.map(r=>fN(r)).filter(r=>!!r);return t.length?t.join(", "):""}return typeof e=="object"?i4(e):String(e).trim()},Gh=(e,t=null)=>{if(e==null)return"";const r=t?.dataType||t?.data_type||"";if(r==="reference"||Jy(e))return fN(e)||"";if(typeof e=="boolean")return e?"Yes":"No";if(typeof e=="number")return Number.isFinite(e)?String(e):"";if(r==="number"){const c=Number(e);return Number.isFinite(c)?String(c):""}if(e instanceof Date)return e.toLocaleDateString();if(r==="date"||typeof e=="string"&&r==="text"){const c=new Date(e);if(!Number.isNaN(c.getTime()))return c.toLocaleDateString()}if(Array.isArray(e))return e.length===0?"":e.filter(c=>c!=null&&String(c).trim()!=="").map(c=>typeof c=="string"?c.trim():String(c)).join(", ");if(typeof e=="object")try{return JSON.stringify(e)}catch(c){return console.warn(" Failed to stringify metadata value",c),""}return String(e).trim()||""};function l4(){const{user:e,token:t,sessionReady:r}=En(),{selectedCampaign:i,selectedCampaignId:l,activeWorld:c,activeWorldId:f,selectedContextType:m,viewAsCharacterId:h,contextKey:p}=Bn(),[y,g]=z2(),v=$y(),[S,w]=u.useState([]),[N,j]=u.useState(!1),[_,C]=u.useState(""),[O,E]=u.useState(!1),[T,M]=u.useState(null),[A,z]=u.useState(""),[P,X]=u.useState(""),[H,Y]=u.useState(null),[V,I]=u.useState(null),[F,D]=u.useState(!1),[L,U]=u.useState(""),[k,B]=u.useState(null),[R,q]=u.useState(null),[G,J]=u.useState(()=>[...as]),[ie,Z]=u.useState(()=>[...as]),[me,Q]=u.useState(!1),[oe,ne]=u.useState(""),[we,ke]=u.useState(""),[Re,Te]=u.useState(""),[rt,He]=u.useState(""),[tt,Ie]=u.useState(()=>pl("create")),[vt,Ct]=u.useState("details"),[At,_t]=u.useState(!1),[Pe,Ze]=u.useState({open:!1,columnKey:"",columnLabel:"",x:0,y:0}),[W,ee]=u.useState(!1),[te,ve]=u.useState([]),le=y.toString(),Se=f||"",Ee=!!Se,ge=y.get(K0)??"",at=!!ge,st=u.useRef(`entity-form-${Math.random().toString(36).slice(2)}`),nt=u.useRef(`${Se}:${p}`),$e=u.useCallback((de,Ce="info")=>{Y({message:de,tone:Ce})},[]);u.useEffect(()=>{!v||!me||Q(!1)},[v,me]),u.useEffect(()=>{tt.accessButtonVisible||vt!=="details"&&Ct("details")},[tt.accessButtonVisible,vt]),u.useEffect(()=>{if(!Pe.open)return;const de=()=>Ze({open:!1,columnKey:"",columnLabel:"",x:0,y:0});return window.addEventListener("click",de),window.addEventListener("contextmenu",de),()=>{window.removeEventListener("click",de),window.removeEventListener("contextmenu",de)}},[Pe.open]),u.useEffect(()=>{if(!H)return;const de=setTimeout(()=>Y(null),3500);return()=>clearTimeout(de)},[H]);const ft=u.useCallback(de=>{if(!de)return"";const Ce=new Date(de);return Number.isNaN(Ce.getTime())?"":Ce.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},[]),zt=u.useMemo(()=>!i||!e?"":i.members?.find(Ce=>Ce.user_id===e.id)?.role||"",[i,e]),Rt=u.useMemo(()=>{if(!c||!e?.id)return!1;const de=c.created_by||c.creator?.id||c.owner_id||c.owner?.id||"";return de?String(de)===String(e.id):!1},[c,e?.id]),pt=u.useMemo(()=>e?r4.has(e.role)?!0:Se?m==="world"?Rt:!!(i&&(zt==="dm"||Rt)):!1:!1,[e,Se,m,i,zt,Rt]),ct=c?.entity_creation_scope??"",yt=u.useMemo(()=>!l||!i||!e||ct!==uc.ALL_PLAYERS?!1:zt==="player",[l,i,e,ct,zt]),Mt=pt||yt,Ft=e?.role==="system_admin",kt=u.useCallback(async(de,Ce={})=>{if(!t)return w([]),[];const{useUnassigned:Bt=!1,viewAsCharacterId:pn=""}=Ce;if(Bt){if(!Ft)return w([]),C("Only system administrators can view unassigned entities"),[];j(!0),C("");try{const qt=await IR(),jn=Array.isArray(qt)?qt:Array.isArray(qt?.data)?qt.data:[];return w(jn),jn}catch(qt){return console.error(" Failed to load unassigned entities",qt),C(qt.message||"Failed to load unassigned entities"),w([]),[]}finally{j(!1)}}const fn=de??Se;if(!fn)return w([]),[];j(!0),C("");try{const qt=await lc(fn,{viewAsCharacterId:pn,importance:te.length>0?te:void 0}),jn=Array.isArray(qt)?qt:Array.isArray(qt?.data)?qt.data:[];return w(jn),jn}catch(qt){return console.error(" Failed to load entities",qt),C(qt.message||"Failed to load entities"),w([]),[]}finally{j(!1)}},[t,Se,Ft,p]);u.useEffect(()=>{if(!t){w([]);return}if(W){kt(null,{useUnassigned:!0});return}if(!Se){w([]);return}kt(Se,{viewAsCharacterId:h})},[Se,t,W,kt,p,h,te]),u.useEffect(()=>{if(W){nt.current=`${Se}:${p}`;return}const de=`${Se}:${p}`;nt.current!==de&&(O&&(E(!1),M(null)),z(""),Ie(pl("create")),C(""),Y(null),nt.current=de)},[Se,p,O,W]),u.useEffect(()=>{!Ft&&W&&ee(!1)},[Ft,W]),u.useEffect(()=>{W&&O&&(E(!1),M(null),z(""),Ie(pl("create")))},[W,O]),u.useEffect(()=>{if(Q(!1),ne(""),!ge||!t||!r){I(null),U(""),B(null),q(null),J([...as]),Z([...as]),D(!1);return}let de=!1;return(async()=>{D(!0),U("");try{const Bt=await nk(ge);if(de)return;const pn=Bt?.data??Bt??{},fn=pn.data??pn,qt=Array.isArray(fn.coreColumns)&&fn.coreColumns.length?fn.coreColumns:Vu,jn=new Map(Vu.map(Pt=>[Pt.key,Pt])),Hn=qt.map(Pt=>{const Wn=jn.get(Pt.key)??{};return{...Wn,...Pt,type:"core",label:Pt.label||Wn.label||Pt.key}}),Un=Vu.filter(Pt=>!Hn.some(Wn=>Wn.key===Pt.key)),la=[...Hn,...Un],Me=(Array.isArray(fn.metadataColumns)?fn.metadataColumns:[]).filter(Pt=>typeof Pt?.key=="string").map(Pt=>({key:Pt.key,name:Pt.name||Pt.key.replace(/^metadata\./,""),label:Pt.label||Pt.name||Pt.key.replace(/^metadata\./,""),dataType:Pt.dataType||Pt.data_type||"",required:!!Pt.required,options:Pt.options||Pt.choices||{},referenceTypeId:Pt.referenceTypeId||Pt.reference_type_id||null,referenceTypeName:Pt.referenceTypeName||Pt.reference_type_name||"",referenceFilter:Pt.referenceFilter||Pt.reference_filter||Pt.referenceFilterJson||{}})).sort((Pt,Wn)=>Pt.label.localeCompare(Wn.label,void 0,{sensitivity:"base"})),ht=new Set([...la.map(Pt=>Pt.key),...Me.map(Pt=>Pt.key)]);as.forEach(Pt=>ht.add(Pt));const Dt=Yh(as,as,ht),Vt=fn.systemDefault?.columns,nn=Array.isArray(Vt)&&Vt.length?Yh(Vt,Dt,ht):[...Dt],xn=fn.userPreference?.columns,Gt=Array.isArray(xn)&&xn.length>0,vn=Gt?Yh(xn,nn,ht):[],oa=Gt&&vn.length?vn:nn;I({coreColumns:la,metadataColumns:Me}),q(nn.length?{columns:[...nn],updatedAt:fn.systemDefault?.updatedAt??null}:null),B(Gt&&vn.length?{columns:[...vn],updatedAt:fn.userPreference?.updatedAt??null}:null),J([...oa]),Z([...oa])}catch(Bt){if(de)return;console.error(" Failed to load column configuration",Bt),U(Bt.message||"Failed to load column configuration"),I(null),B(null),q(null),J([...as]),Z([...as])}finally{de||D(!1)}})(),()=>{de=!0}},[ge,t,r]);const Zt=u.useMemo(()=>{let de=S;return ge&&(de=de.filter(Ce=>(Ce.entity_type_id||Ce.entityType?.id||Ce.entity_type?.id||"")===ge)),te.length>0&&l&&(de=de.filter(Ce=>{const Bt=Ce.importance||null;return te.includes(Bt)})),de},[S,ge,te,l]),Lt=u.useMemo(()=>{if(!ge)return"";const de=S.find(Ce=>(Ce.entity_type_id||Ce.entityType?.id||Ce.entity_type?.id||"")===ge);return de?.entityType?.name||de?.entity_type?.name||""},[S,ge]),Kt=u.useMemo(()=>{const de=[],Ce=new Set,Bt=(qt,jn)=>{if(!qt||typeof qt!="object")return;const Hn=typeof qt.key=="string"?qt.key.trim():"";if(!Hn||Ce.has(Hn))return;const Un=qt.label||qt.name||(typeof qt.title=="string"?qt.title:""),la=typeof Un=="string"&&Un.trim()?Un.trim():Hn;de.push({...qt,key:Hn,label:la,type:qt.type||jn}),Ce.add(Hn)};return(V?.coreColumns??Vu).forEach(qt=>Bt(qt,"core")),(V?.metadataColumns??[]).forEach(qt=>Bt(qt,"metadata")),de},[V]),se=u.useMemo(()=>{const de=new Map;return Kt.forEach(Ce=>{de.set(Ce.key,{...Ce,type:Ce.type==="metadata"?"metadata":"core"})}),de},[Kt]),be=u.useMemo(()=>Array.from(se.keys()),[se]),je=u.useMemo(()=>{const de=as.filter(Ce=>se.has(Ce));return de.length>0?de:be.length>0?[be[0]]:[...as]},[be,se]),We=u.useMemo(()=>{if(v){const de=[];return se.has("name")&&de.push("name"),se.has("description")&&de.push("description"),de.length>0?de:je.filter(Ce=>se.has(Ce))}return ge?G:as},[v,se,je,ge,G]);u.useEffect(()=>{ge&&J(de=>{const Ce=de.filter(Bt=>se.has(Bt));return Ce.length>0?Ce:je})},[ge,se,je]),u.useEffect(()=>{Z([...G])},[G]);const dt=u.useMemo(()=>{const de=We.map(Ce=>se.get(Ce)).filter(Boolean);return de.length>0?de:je.map(Ce=>se.get(Ce)).filter(Boolean)},[We,se,je]),gt=R?.columns??je,ce=k?.columns??gt,re=!!ge&&!Vh(ie,ce),Ne=!!ge&&!Vh(ie,gt),Be=we===Ph,Ke=we===W0,ot=Vh(ie,gt),ze=()=>{Z([...gt]),ne(""),Te(""),He("")},ue=de=>{ge&&Z(Ce=>Ce.includes(de)?Ce.length===1?(ne("You must keep at least one column selected."),Ce):(ne(""),Re===de&&(Te(""),He("")),Ce.filter(Bt=>Bt!==de)):se.has(de)?(ne(""),[...Ce,de]):Ce)},qe=(de,Ce)=>{ge&&ie.includes(de)&&(Te(de),He(""),Ce?.dataTransfer&&(Ce.dataTransfer.effectAllowed="move",Ce.dataTransfer.setData("text/plain",de)))},Ge=(de,Ce)=>{!Re||Re===de||ie.includes(de)&&(Ce&&(Ce.preventDefault(),Ce.dataTransfer&&(Ce.dataTransfer.dropEffect="move")),He(de))},ut=de=>{ge&&(Z(Ce=>{if(!Re||Re===de)return Ce;const Bt=Ce.indexOf(Re),pn=Ce.indexOf(de);if(Bt===-1||pn===-1)return Ce;const fn=[...Ce],[qt]=fn.splice(Bt,1),jn=Bt<pn?Math.max(pn-1,0):pn;return fn.splice(jn,0,qt),fn}),He(""),Te(""))},ae=()=>{ge&&(Z(de=>{if(!Re||!de.includes(Re))return de;const Ce=de.filter(Bt=>Bt!==Re);return Ce.push(Re),Ce}),He(""),Te(""))},Xe=()=>{He(""),Te("")},Fe=()=>{ge&&(ne(""),Q(de=>{const Ce=!de;return!de&&Ce&&(Z([...G]),Te(""),He("")),de&&!Ce&&(Te(""),He("")),Ce}))},Qe=()=>{Q(!1),He(""),Te("")},bt=async de=>{if(ge){if(ie.length===0){ne("Please select at least one column.");return}ke(de),ne("");try{await ak(ge,{scope:de,columns:ie}),de===Ph?(B({columns:[...ie],updatedAt:new Date().toISOString()}),J([...ie]),Qe(),$e("Column preference saved","success")):(q({columns:[...ie],updatedAt:new Date().toISOString()}),J([...ie]),$e("System default updated","success"))}catch(Ce){console.error(" Failed to save column selection",Ce),ne(Ce.message||"Failed to save column settings")}finally{ke("")}}},St=u.useCallback(de=>de?.entityType?.name||de?.entity_type?.name||"",[]),_e=u.useCallback((de,Ce)=>{if(!de)return"";switch(Ce){case"name":return de.name||"";case"type":return St(de);case"visibility":return de.visibility||"visible";case"createdAt":return de.createdAt||de.created_at||"";case"description":return de.description||"";default:{if(Ce.startsWith("metadata.")){const Bt=de.metadata&&typeof de.metadata=="object"?de.metadata:{},pn=Ce.replace(/^metadata\./,"");return Bt?.[pn]}return de[Ce]}}},[St]),et=u.useCallback(de=>{if(de==null||de==="")return null;if(typeof de=="string"){const Ce=de.trim();return Ce.length>0?Ce:null}if(typeof de=="object"&&!Array.isArray(de)){const Ce=de.id??de.value??de.key??de.slug??de.uuid??null;return Ce!=null?String(Ce).trim():null}if(Array.isArray(de)){for(const Ce of de){const Bt=et(Ce);if(Bt)return Bt}return null}return null},[]),mt=u.useMemo(()=>{const de=[];return se.forEach(Ce=>{const pn=(Ce.type==="metadata"?Ce.dataType||Ce.data_type||"string":Ce.dataType)||(Ce.key==="createdAt"?"date":"string"),fn=pn==="reference"||Ce.dataType&&String(Ce.dataType).toLowerCase()==="reference"||Ce.data_type&&String(Ce.data_type).toLowerCase()==="reference",qt=jn=>{const Hn=_e(jn,Ce.key);if(fn){const Un=et(Hn);return Un!==null?Un:Hn}return Hn};de.push({key:Ce.key,label:Ce.label||Ce.name||Ce.key,dataType:pn,accessor:qt})}),de},[se,_e,et]),fe=u.useMemo(()=>new Map(mt.map(de=>[de.key,de])),[mt]),he=K1(Zt,{columns:mt}),Ve=u.useCallback(de=>{const Ce=he.groupBy?se.get(he.groupBy):null;if(!Ce)return Gh(de);if(Ce.key==="visibility"){const Bt=typeof de=="string"?de:"";return Bt?Bt.charAt(0).toUpperCase()+Bt.slice(1):"Hidden"}return Ce.key==="createdAt"?ft(de):Ce.key==="type"?de||"Unassigned":Ce.key.startsWith("metadata.")?Gh(de,Ce):Ce.key==="name"||Ce.key==="description"?de?String(de):"":de?String(de):"Unassigned"},[se,he.groupBy,ft]),xt=u.useMemo(()=>mt.map(de=>{const Ce=se.get(de.key),Bt=Ce?.data_type||Ce?.dataType||de.dataType,pn={key:de.key,label:fe.get(de.key)?.label||de.label||de.key,dataType:de.dataType,originalDataType:Bt};Ce?.options&&(pn.options=Ce.options);const fn=Ce?.referenceTypeId||Ce?.reference_type_id;fn&&(pn.referenceTypeId=fn);const qt=Ce?.referenceTypeName||Ce?.referenceType?.name;qt&&(pn.referenceTypeName=qt);const jn=Ce?.referenceFilter||Ce?.reference_filter;return jn&&(pn.referenceFilter=jn),pn}),[mt,fe,se]),Nt=de=>{de&&he.toggleSort(de)},Et=(de,Ce)=>{de.preventDefault(),Ze({open:!0,columnKey:Ce.key,columnLabel:Ce.label||Ce.name||Ce.key,x:de.clientX,y:de.clientY})},jt=de=>{he.setGroupBy(de),Ze({open:!1,columnKey:"",columnLabel:"",x:0,y:0})},Wt=(de,Ce)=>{const Bt=Ce.metadata&&typeof Ce.metadata=="object"?Ce.metadata:{};switch(de.key){case"name":const pn=l?Ce.importance:null,fn={critical:"",important:"",medium:""};return a.jsxs(a.Fragment,{children:[a.jsx(Jt,{to:`/entities/${Ce.id}`,state:{fromEntities:{search:le}},className:"entity-name-link",children:Ce.name}),Ce.id?a.jsxs(a.Fragment,{children:["",a.jsx(Is,{entityId:Ce.id,entityName:Ce.name||"entity"})]}):null,pn&&a.jsxs(a.Fragment,{children:["",a.jsx("span",{className:"entity-importance-indicator",title:`Importance: ${pn}`,children:fn[pn]||""})]})]});case"type":return St(Ce);case"visibility":{const qt=Ce.visibility||"visible",jn=s4[qt]||"badge-hidden";return a.jsx("span",{className:`visibility-badge ${jn}`,children:qt.charAt(0).toUpperCase()+qt.slice(1)})}case"createdAt":return ft(Ce.createdAt||Ce.created_at);case"description":return Ce.description?Ce.description:"";case"importance":{if(!l)return"";const qt=Ce.importance;if(!qt)return"";const jn={critical:"Critical",important:"Important",medium:"Medium"},Hn={critical:"#dc2626",important:"#ea580c",medium:"#6b7280"};return a.jsx("span",{className:"importance-badge",style:{"--importance-color":Hn[qt]},children:jn[qt]||qt})}default:{if(de.key.startsWith("metadata.")){const qt=de.key.replace(/^metadata\./,""),jn=Bt?.[qt],Hn=Gh(jn,de);if(((de?.dataType||de?.data_type||"")==="reference"||Jy(jn))&&jn!==null&&jn!==void 0){const ye=Gy(jn),Me=Xy(jn)||Hn||"entity";if(ye)return a.jsxs(a.Fragment,{children:[Hn,"",a.jsx(Is,{entityId:ye,entityName:Me})]})}return Hn}return""}}},ln=()=>{E(!1),M(null),z(""),Ie(pl("create")),Ct("details")},dn=async de=>{ln(),W?await kt(null,{useUnassigned:!0}):Se&&await kt(Se,{viewAsCharacterId:h}),$e(de==="create"?"Entity created":"Entity updated","success")},Qt=async de=>{if(!(!pt||!de?.id||!window.confirm(`Delete entity "${de.name}"? This action cannot be undone.`)))try{X(de.id),await zR(de.id),$e("Entity deleted","success"),W?await kt(null,{useUnassigned:!0}):Se&&await kt(Se,{viewAsCharacterId:h})}catch(Bt){console.error(" Failed to delete entity",Bt),$e(Bt.message||"Failed to delete entity","error")}finally{X("")}},pa=()=>{if(W){kt(null,{useUnassigned:!0});return}Se&&kt(Se,{viewAsCharacterId:h})},Da=()=>{!Mt||!Se||W||(M(null),z(""),Ie(pl("create")),Ct("details"),E(!0))},Jr=de=>{if(!pt||!de?.id)return;const Ce=typeof de.name=="string"?de.name.trim():"";M(de.id),z(Ce),Ie(pl("edit")),Ct("details"),E(!0)},ur=u.useCallback(de=>{de&&Ie(Ce=>({...Ce,...de}))},[]),Os=u.useMemo(()=>{if(!T)return"";const de=S.find(Bt=>Bt.id===T);return typeof de?.name=="string"&&de.name.trim()||typeof A=="string"&&A.trim()||""||"Untitled entity"},[S,T,A]),ia=T?`Edit Entity: ${Os}`:"Add Entity",ei=u.useCallback(()=>{g(de=>{const Ce=new URLSearchParams(de);return Ce.delete(K0),Ce})},[g]);if(!r)return a.jsx("p",{children:"Restoring session..."});if(!t)return a.jsx("p",{children:"Authenticating..."});const ti=Zt.length>0,qn=he.groupBy?he.groups.some(de=>de.items.length>0):he.data.length>0,Ia=`entities-page${v?" entities-page--mobile":""}`,ws=i?`${i.name}${c?.name?`  ${c.name}`:""}`:Ee?`World  ${c?.name||"Untitled world"}`:"";return a.jsxs("section",{className:Ia,children:[a.jsx("div",{className:"entities-header",children:a.jsxs("div",{className:"entities-header-top",children:[a.jsxs("div",{className:"entities-header-left",children:[a.jsx("h1",{children:"Entities"}),W?a.jsx("p",{className:"entities-subtitle",children:"Showing entities without a world assignment."}):Ee?a.jsx("p",{className:"entities-subtitle",children:ws}):a.jsx("p",{className:"entities-subtitle",children:"Select a campaign or world you own to choose a world context."})]}),a.jsxs("div",{className:"entities-header-controls-row",children:[a.jsx(qy,{value:he.searchTerm,onChange:he.setSearchTerm,placeholder:"Search entities...",ariaLabel:"Search entities"}),a.jsxs("div",{className:"entities-controls",children:[Ft&&a.jsx("button",{type:"button",className:`btn secondary compact${W?" is-active":""}`,onClick:()=>ee(de=>!de),"aria-pressed":W,title:W?"Show entities for the selected world":"Show entities that do not have a world assigned",children:"No World"}),l&&a.jsxs("div",{className:"entities-importance-filters",children:[["critical","important","medium"].map(de=>{const Ce=te.includes(de);return a.jsx("button",{type:"button",className:`btn secondary compact importance-filter importance-${de}${Ce?" is-active":""}`,onClick:()=>{ve(Bt=>Ce?Bt.filter(pn=>pn!==de):[...Bt,de])},title:`Filter by ${de} importance`,children:de.charAt(0).toUpperCase()+de.slice(1)},de)}),te.length>0&&a.jsx("button",{type:"button",className:"btn secondary compact importance-filter-clear",onClick:()=>ve([]),title:"Clear importance filters",children:a.jsx(ka,{size:14})})]}),a.jsxs("div",{className:"entities-filters-refresh-group",children:[a.jsxs("button",{type:"button",className:`btn secondary compact${he.filterActive?" is-active":""}`,onClick:()=>_t(!0),children:[a.jsx(Qd,{size:16})," Filters"]}),a.jsx("button",{type:"button",className:"icon-btn",title:"Refresh entities",onClick:pa,disabled:N||!W&&!Se,children:a.jsx(zl,{size:16})})]}),!v&&at&&a.jsxs("div",{className:"entities-column-menu-wrapper",children:[a.jsxs("button",{type:"button",className:"btn secondary compact","aria-haspopup":"dialog",onClick:Fe,children:[a.jsx(pM,{size:16})," Columns"]}),me&&a.jsx("div",{className:"entities-column-drawer-overlay",role:"presentation",onClick:Qe,children:a.jsxs("div",{className:"entities-column-drawer",role:"dialog","aria-modal":"true","aria-labelledby":"column-drawer-title",onClick:de=>de.stopPropagation(),children:[a.jsxs("div",{className:"entities-column-drawer-header",children:[a.jsxs("div",{children:[a.jsxs("h3",{id:"column-drawer-title",children:["Columns for ",Lt||"selected type"]}),a.jsx("p",{className:"entities-column-info",children:"Choose which fields are visible in this list. Drag the handle to reorder selected columns and save to keep your personal preference."})]}),a.jsx("button",{type:"button",className:"icon-btn",onClick:Qe,title:"Close column settings",children:a.jsx(ka,{size:16})})]}),a.jsx("div",{className:"entities-column-drawer-body",children:F?a.jsx("p",{className:"entities-column-info",children:"Loading columns"}):L?a.jsx("div",{className:"alert error",role:"alert",children:L}):a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"entities-column-hint",children:"Checked columns appear in the table. Drag the grip icon to adjust their display order."}),a.jsxs("ul",{className:"entities-column-list",children:[ie.map(de=>{const Ce=Kt.find(fn=>fn.key===de);if(!Ce)return null;const Bt=Re===de,pn=Ce.type==="metadata"?"Metadata":"Core";return a.jsxs(u.Fragment,{children:[rt===de&&a.jsx("div",{className:"drop-indicator"}),a.jsxs("li",{className:`entities-column-item${Bt?" is-dragging":""}`,draggable:!0,onDragStart:fn=>qe(de,fn),onDragOver:fn=>Ge(de,fn),onDrop:()=>ut(de),onDragEnd:Xe,children:[a.jsxs("div",{className:"entities-column-item-main",children:[a.jsx("input",{type:"checkbox",checked:!0,onChange:()=>ue(de)}),a.jsx("label",{className:"entities-column-name",children:Ce.label}),a.jsx("span",{className:"entities-column-type-badge",children:pn})]}),a.jsx("button",{type:"button",className:"entities-column-handle",draggable:!0,onDragStart:fn=>qe(de,fn),children:a.jsx(_T,{size:18})})]})]},de)}),Re&&rt==="__end"&&a.jsx("div",{className:"drop-indicator end"}),Kt.filter(de=>!ie.includes(de.key)).map(de=>{const Ce=de.type==="metadata"?"Metadata":"Core";return a.jsxs("li",{className:"entities-column-item inactive",children:[a.jsxs("div",{className:"entities-column-item-main",children:[a.jsx("input",{type:"checkbox",checked:!1,onChange:()=>ue(de.key)}),a.jsx("label",{className:"entities-column-name",children:de.label}),a.jsx("span",{className:"entities-column-type-badge",children:Ce})]}),a.jsx("div",{className:"entities-column-handle-placeholder"})]},de.key)})]}),Re&&a.jsx("div",{className:`entities-column-dropzone${rt==="__end"?" is-active":""}`,onDragOver:de=>{Re&&(de.preventDefault(),de.dataTransfer&&(de.dataTransfer.dropEffect="move"),He("__end"))},onDragLeave:()=>{rt==="__end"&&He("")},onDrop:de=>{de.preventDefault(),ae()},children:"Drop here to move column to the end"}),Kt.every(de=>de.type!=="metadata")&&a.jsx("p",{className:"entities-column-empty",children:"This entity type does not have metadata fields yet."}),oe&&a.jsx("p",{className:"entities-column-error",children:oe})]})}),a.jsxs("div",{className:"entities-column-drawer-footer",children:[a.jsx("div",{className:"entities-column-footer-left",children:a.jsx("button",{type:"button",className:"btn secondary",onClick:ze,disabled:F||ot,children:"Use system default"})}),a.jsxs("div",{className:"entities-column-footer-right",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:()=>bt(Ph),disabled:F||Be||!re,children:Be?"Saving":"Save for me"}),Ft&&a.jsxs("div",{className:"entities-column-admin",children:[a.jsx("span",{className:"entities-column-admin-label",children:"System settings (admin only)"}),a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>bt(W0),disabled:F||Ke||!Ne,title:"Set these columns as the default for all users",children:Ke?"Saving":"Set as system default"})]})]})]})]})})]})]}),a.jsxs("button",{type:"button",className:"btn submit",onClick:Da,disabled:!Mt||!Se||N||W,children:[a.jsx(Va,{size:18})," Add Entity"]})]})]})}),W&&a.jsx("div",{className:"alert info",role:"status",children:"Entities listed here do not have a world assigned. Open an entity to update its world from the entity detail view."}),H&&a.jsx("div",{className:`toast-banner ${H.tone}`,role:"status",children:H.message}),_&&a.jsx("div",{className:"alert error",role:"alert",children:_}),N?a.jsx("div",{className:"empty-state",children:"Loading entities..."}):!Se&&!W?a.jsx("div",{className:"empty-state",children:"Select a campaign to view its entities."}):ti?qn?a.jsx("div",{className:"entities-table-wrapper",children:a.jsxs("table",{className:"entities-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[dt.map(de=>{const Ce=he.sortState.key===de.key,Bt=he.groupBy===de.key;return a.jsx("th",{onClick:()=>Nt(de.key),onContextMenu:pn=>Et(pn,de),className:"sortable-header",children:a.jsxs("span",{className:"header-label",children:[de.label,Ce&&a.jsx("span",{className:"sort-indicator",children:he.sortState.direction==="asc"?"":""}),Bt&&a.jsx("span",{className:"group-indicator",children:"Grouped"})]})},de.key)}),pt&&a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:he.groupBy?he.groups.map(de=>a.jsxs(u.Fragment,{children:[a.jsx("tr",{className:"entities-group-row",children:a.jsxs("td",{colSpan:dt.length+(pt?1:0),children:[a.jsx("button",{type:"button",className:"group-toggle",onClick:()=>he.toggleGroupCollapse(de.id),"aria-label":`Toggle group ${Ve(de.value)}`,children:he.isGroupCollapsed(de.id)?a.jsx(Iy,{size:14}):a.jsx(Br,{size:14})}),a.jsxs("span",{className:"entities-group-label",children:[Ve(de.value)," ",a.jsxs("span",{className:"entities-group-count",children:["(",de.items.length,")"]})]})]})}),!he.isGroupCollapsed(de.id)&&de.items.map(Ce=>a.jsxs("tr",{children:[dt.map(Bt=>a.jsx("td",{children:Wt(Bt,Ce)},Bt.key)),pt&&a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Jr(Ce),title:"Edit entity",disabled:N,children:a.jsx(ar,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>Qt(Ce),title:"Delete entity",disabled:P===Ce.id,children:a.jsx(ma,{size:16})})]})})]},Ce.id))]},de.id)):he.data.map(de=>a.jsxs("tr",{children:[dt.map(Ce=>a.jsx("td",{children:Wt(Ce,de)},Ce.key)),pt&&a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Jr(de),title:"Edit entity",disabled:N,children:a.jsx(ar,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>Qt(de),title:"Delete entity",disabled:P===de.id,children:a.jsx(ma,{size:16})})]})})]},de.id))})]})}):a.jsxs("div",{className:"empty-state",children:[a.jsx("p",{className:"empty-title",children:"No entities match your filters."}),a.jsx("div",{className:"empty-actions",children:(he.filterActive||he.searchTerm)&&a.jsxs("div",{className:"empty-action-buttons",children:[he.filterActive&&a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>he.clearFilters(),children:"Clear filters"}),he.searchTerm&&a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>he.setSearchTerm(""),children:"Reset search"})]})})]}):a.jsx("div",{className:"empty-state",children:at?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"empty-title",children:"No entities of this type yet."}),a.jsx("button",{type:"button",className:"btn secondary",onClick:ei,children:"View all entities"})]}):Mt?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"empty-title",children:"No entities yet."}),a.jsxs("p",{children:["Click ",a.jsx("strong",{children:"Add Entity"})," to create your first entity."]})]}):a.jsx("p",{children:"Nothing to show right now."})}),Pe.open&&a.jsxs("div",{className:"column-context-menu",style:{top:Pe.y,left:Pe.x},role:"menu",children:[a.jsx("button",{type:"button",onClick:()=>jt(Pe.columnKey),children:he.groupBy===Pe.columnKey?"Remove grouping":`Group by ${Pe.columnLabel}`}),he.groupBy&&he.groupBy!==Pe.columnKey&&a.jsx("button",{type:"button",onClick:()=>jt(""),children:"Clear grouping"})]}),a.jsx(Z1,{open:At,onClose:()=>_t(!1),fields:xt,value:he.filters,worldId:Se,onApply:de=>{he.setFilters(de),_t(!1)}}),a.jsx(Yr,{isOpen:O,onClose:ln,title:ia,width:420,footerActions:a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:ln,disabled:tt.cancelDisabled,children:"Cancel"}),tt.accessButtonVisible&&a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>Ct(de=>de==="access"?"details":"access"),disabled:tt.accessButtonDisabled,children:vt==="access"?"Details":"Access"}),a.jsx("button",{type:"submit",className:"btn submit",form:st.current,disabled:tt.submitDisabled,children:tt.submitLabel})]}),children:a.jsx(dN,{worldId:W?"":Se,entityId:T,onCancel:ln,onSaved:dn,formId:st.current,onStateChange:ur,hideActions:!0,selectedEntityTypeId:at?ge:"",activeView:vt,onViewChange:Ct,defaultCampaignId:i?.id||""})})]})}function o4({tabs:e=[],activeTab:t,onChange:r}){if(!Array.isArray(e)||e.length===0)return null;const i=l=>{typeof r=="function"&&r(l)};return a.jsx("nav",{className:"tab-nav flex flex-wrap gap-2",role:"tablist",children:e.map(l=>{const{id:c,label:f}=l,m=c===t;return a.jsx("button",{type:"button",role:"tab","aria-selected":m,className:`tab-nav-button whitespace-nowrap px-3 py-2 ${m?"is-active":""}`,onClick:()=>i(c),children:f},c)})})}const c4=(e,t)=>{const r=new URLSearchParams;t&&r.set("campaignId",t);const i=r.toString(),l=i?`/entities/${e}/follow?${i}`:`/entities/${e}/follow`;return Tt.post(l)},mN=(e,t)=>{const r=new URLSearchParams;t&&r.set("campaignId",t);const i=r.toString(),l=i?`/entities/${e}/follow?${i}`:`/entities/${e}/follow`;return Tt.delete(l)},u4=e=>{const t=new URLSearchParams;e&&t.set("campaignId",e);const r=t.toString(),i=r?`/entities/followed?${r}`:"/entities/followed";return Tt.get(i)},d4=(e,t)=>{const r=new URLSearchParams;t&&r.set("campaignId",t);const i=r.toString(),l=i?`/entities/${e}/follow-status?${i}`:`/entities/${e}/follow-status`;return Tt.get(l)};function f4({entityId:e}){const{user:t}=En(),{selectedCampaignId:r}=Bn(),[i,l]=u.useState(!1),[c,f]=u.useState(!1),[m,h]=u.useState(!0);u.useEffect(()=>{if(!e||!r||!t?.id){h(!1);return}(async()=>{try{h(!0);const g=await d4(e,r);l(g?.following??!1)}catch(g){console.error("Failed to check follow status",g),l(!1)}finally{h(!1)}})()},[e,r,t?.id]);const p=async()=>{if(!e||!r||c||m)return;const y=!i;f(!0);try{y?await c4(e,r):await mN(e,r),l(y)}catch(g){console.error("Failed to toggle follow",g),l(!y)}finally{f(!1)}};return r?m?a.jsx("button",{type:"button",className:"entity-follow-button",disabled:!0,title:"Checking follow status...",children:a.jsx(Td,{size:18})}):a.jsx("button",{type:"button",className:`entity-follow-button ${i?"following":""}`,onClick:p,disabled:c,title:i?"Unfollow entity":"Follow entity",children:i?a.jsx(ky,{size:18}):a.jsx(Td,{size:18})}):null}function m4({entityId:e,name:t,canEdit:r,isEditing:i,onToggleEdit:l,onSave:c,isSaving:f=!1,isSaveDisabled:m=!1}){const h=t||"Untitled entity",p=()=>{typeof l=="function"&&l()},y=()=>{typeof c=="function"&&c()};return a.jsxs("div",{className:"entity-header flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 sm:gap-2",role:"banner",children:[a.jsx("div",{className:"entity-header-center",children:a.jsx("h1",{children:h})}),a.jsxs("div",{className:"entity-header-right",children:[e&&a.jsx(f4,{entityId:e}),r?a.jsxs("div",{className:"entity-header-actions",children:[i&&typeof c=="function"?a.jsx("button",{type:"button",className:"btn submit",onClick:y,disabled:m||f,children:f?"Saving":"Save"}):null,a.jsxs("button",{type:"button",className:`edit-mode-toggle ${i?"is-active":""}`,role:"switch","aria-checked":i,onClick:p,children:[a.jsx("span",{className:"edit-mode-toggle-track","aria-hidden":"true",children:a.jsx("span",{className:"edit-mode-toggle-thumb"})}),a.jsx("span",{className:"edit-mode-toggle-text",children:"Edit"})]})]}):null]})]})}const h4=[{value:"critical",label:"Critical",icon:Ha,color:"#dc2626"},{value:"important",label:"Important",icon:Oy,color:"#ea580c"},{value:"medium",label:"Medium",icon:N1,color:"#6b7280"},{value:null,label:"None",icon:ka,color:"#9ca3af"}];function p4({entityId:e,importance:t,onUpdate:r}){const{selectedCampaignId:i}=Bn(),[l,c]=u.useState(!1);if(!i)return null;const f=async m=>{if(!(l||m===t)){c(!0);try{await OR(e,m),r?.(m)}catch(h){console.error("Failed to update entity importance",h)}finally{c(!1)}}};return a.jsxs("div",{className:"entity-importance-selector",children:[a.jsx("span",{className:"entity-importance-label",children:"Importance:"}),a.jsx("div",{className:"entity-importance-buttons",children:h4.map(m=>{const h=m.icon,p=t===m.value;return a.jsxs("button",{type:"button",className:`entity-importance-button ${p?"selected":""}`,onClick:()=>f(m.value),disabled:l,title:m.label,style:p?{"--importance-color":m.color}:{},children:[a.jsx(h,{size:16}),a.jsx("span",{className:"entity-importance-button-label",children:m.label})]},m.value||"none")})})]})}var Xh={exports:{}},Kh,Z0;function y4(){if(Z0)return Kh;Z0=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Kh=e,Kh}var Wh,Q0;function g4(){if(Q0)return Wh;Q0=1;var e=y4();function t(){}function r(){}return r.resetWarningCache=t,Wh=function(){function i(f,m,h,p,y,g){if(g!==e){var v=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw v.name="Invariant Violation",v}}i.isRequired=i;function l(){return i}var c={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:l,element:i,elementType:i,instanceOf:l,node:i,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:r,resetWarningCache:t};return c.PropTypes=c,c},Wh}var J0;function b4(){return J0||(J0=1,Xh.exports=g4()()),Xh.exports}var v4=b4();const wt=ki(v4);function hN({maxWidth:e=1280,className:t="",children:r}){const l={"--entity-page-max-width":typeof e=="number"?`${e}px`:e},c=["entity-page-layout",t].filter(Boolean).join(" ");return a.jsx("div",{className:c,style:l,children:a.jsx("div",{className:"entity-page-layout__inner",children:r})})}hN.propTypes={maxWidth:wt.oneOfType([wt.number,wt.string]),className:wt.string,children:wt.node};const x4=new Set(["image/png","image/jpeg","image/jpg"]),S4=2*1024*1024,w4=e=>Number.isFinite(e)?e>=1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:e>=1024?`${(e/1024).toFixed(1)} KB`:`${e} bytes`:"";function N4({entity:e,canEdit:t,isEditing:r,onEntityUpdate:i,variant:l="card"}){const[c,f]=u.useState(null),[m,h]=u.useState(""),[p,y]=u.useState(""),[g,v]=u.useState(!1),[S,w]=u.useState(!1),N=u.useRef(null),[j,_]=u.useState(null),C=!!e?.id,O=!!(e?.imageData&&e?.imageMimeType),E=u.useMemo(()=>Ul(e),[e]),T=m||E,M=e?.name?`${e.name} artwork`:"Entity artwork",A=l==="compact",z=u.useCallback(()=>{f(null),h(U=>(U&&URL.revokeObjectURL(U),"")),_(null),y(""),N.current&&(N.current.value="")},[]);u.useEffect(()=>()=>{m&&URL.revokeObjectURL(m)},[m]),u.useEffect(()=>{!r&&c&&z()},[r,c,z]);const P=()=>{!t||!r||g||S||N.current?.click()},X=U=>{const k=U.target.files?.[0];if(k){if(!x4.has(k.type)){y("Only PNG or JPG images are allowed."),U.target.value="";return}if(k.size>S4){y("Image must be smaller than 2 MB."),U.target.value="";return}y(""),f(k),_(null),h(B=>(B&&URL.revokeObjectURL(B),URL.createObjectURL(k)))}},H=u.useCallback(U=>{U&&typeof i=="function"&&i(U)},[i]),Y=async()=>{if(!(!c||!C)){v(!0),y("");try{const U=j?await uN(c,j):c,k=await U1(e.id,U),B=Pa(k);if(!B)throw new Error("Failed to upload image");H(B),z()}catch(U){y(U.message||"Failed to upload image")}finally{v(!1)}}},V=async()=>{if(C){w(!0),y("");try{const U=await B1(e.id),k=Pa(U);if(k)H(k);else{const B=W1({...e||{},imageData:null,imageMimeType:null,image_data:null,image_mime_type:null});H(B)}z()}catch(U){y(U.message||"Failed to delete image")}finally{w(!1)}}},I=u.useMemo(()=>{const U=["PNG or JPG up to 2 MB.","Uploads are resized to 256256 JPG (~70% quality, ~150 KB)."];return c&&U.push(`Selected: ${c.name} (${w4(c.size)})`),U.join(" ")},[c]),F=A?"div":"section",D=A?"entity-image-card entity-image-card--compact":"entity-card entity-image-card",L=u.useCallback(U=>{_(U)},[]);return u.useEffect(()=>{c||_(null)},[c]),a.jsxs(F,{className:D,children:[a.jsxs("div",{className:"entity-card-header",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"entity-card-title",children:"Image"}),a.jsx("p",{children:A?"Shown in the dossier summary.":"Displayed on the dossier tab."})]}),t&&r?a.jsxs("div",{className:"entity-card-actions",children:[O&&!c?a.jsx("button",{type:"button",className:"btn secondary",onClick:V,disabled:S,children:S?"Removing":a.jsxs("span",{className:"entity-image-action-label",children:[a.jsx(ma,{size:16,"aria-hidden":"true"})," Remove image"]})}):null,a.jsx("button",{type:"button",className:"btn secondary",onClick:P,disabled:g||S,children:a.jsxs("span",{className:"entity-image-action-label",children:[a.jsx(jM,{size:16,"aria-hidden":"true"})," Choose image"]})})]}):null]}),a.jsxs("div",{className:"entity-card-body",children:[a.jsxs("div",{className:`entity-image-preview ${T&&!c?"has-image":""}`.trim(),children:[c&&m?a.jsx(cN,{src:m,size:220,onCropChange:L}):T?a.jsx("img",{src:T,alt:M,loading:"lazy"}):a.jsxs("div",{className:"entity-image-placeholder",children:[a.jsx(TT,{size:32,"aria-hidden":"true"}),a.jsx("p",{children:"No image uploaded"})]}),c?a.jsx("button",{type:"button",className:"entity-image-preview-clear",onClick:z,disabled:g,"aria-label":"Clear selected image",children:a.jsx(ka,{size:16,"aria-hidden":"true"})}):null]}),c&&t&&r?a.jsxs("div",{className:"entity-image-actions",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:Y,disabled:g,children:g?"Uploading":"Save Image"}),a.jsx("button",{type:"button",className:"btn secondary",onClick:z,disabled:g,children:"Cancel"})]}):null,a.jsx("input",{type:"file",ref:N,accept:"image/png,image/jpeg",onChange:X,hidden:!0}),a.jsx("p",{className:"entity-image-helper",children:I}),p?a.jsx("p",{className:"entity-image-status entity-image-status--error",children:p}):null,!p&&g?a.jsx("p",{className:"entity-image-status",children:"Uploading image"}):null,!p&&S?a.jsx("p",{className:"entity-image-status",children:"Removing image"}):null]})]})}function pN({open:e,eyebrowLabel:t="Heads up",title:r="Unsaved changes",description:i="You have unsaved changes on this record.",destinationLabel:l="",saving:c=!1,onSaveAndContinue:f,onContinueWithoutSaving:m,onStay:h}){if(!e)return null;const p=l?` before continuing to ${l}`:"";return a.jsx("div",{className:"unsaved-dialog-backdrop",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"unsaved-dialog",role:"document",children:[a.jsxs("div",{className:"unsaved-dialog-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"unsaved-dialog-label",children:t}),a.jsx("h2",{children:r})]}),a.jsx("button",{type:"button",className:"icon-btn","aria-label":"Close dialog",onClick:h,children:a.jsx(ka,{size:18})})]}),a.jsxs("div",{className:"unsaved-dialog-body",children:[a.jsxs("p",{children:[i,p,"."]}),a.jsx("p",{className:"unsaved-dialog-help",children:"Choose an option below to continue."})]}),a.jsxs("div",{className:"unsaved-dialog-actions",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:f,disabled:c,children:c?"Saving":"Save and continue"}),a.jsx("button",{type:"button",className:"btn ghost",onClick:m,disabled:c,children:"Continue without saving"}),a.jsx("button",{type:"button",className:"btn cancel",onClick:h,disabled:c,children:"Stay here"})]})]})})}const Zh=()=>({relationshipTypes:{mode:"all",values:[]},relatedEntityTypes:{mode:"all",values:[]}}),E4=e=>Tt.get(`/entity-relationships?worldId=${e}`),j4=e=>Tt.get(`/entity-relationships/${e}`),_4=e=>Tt.get(`/entity-relationships/entity/${e}`),yN=e=>Tt.post("/entity-relationships",e),C4=(e,t)=>Tt.patch(`/entity-relationships/${e}`,t),A4=e=>Tt.delete(`/entity-relationships/${e}`),T4=e=>e==null?"":String(e).trim(),pf=e=>{let t={};typeof e=="string"?t={worldId:e}:e&&typeof e=="object"&&!Array.isArray(e)&&(t={...e});const r=new URLSearchParams,i=T4(t.worldId??t.world_id);i&&r.set("worldId",i);const l=r.toString(),c=l?`?${l}`:"";return Tt.get(`/entity-relationship-types${c}`)},M4=e=>Tt.get(`/entity-relationship-types/${e}`),R4=e=>Tt.post("/entity-relationship-types",e),k4=(e,t)=>Tt.patch(`/entity-relationship-types/${e}`,t),D4=e=>Tt.delete(`/entity-relationship-types/${e}`);function I4({worldId:e,onCreated:t}){const[r,i]=u.useState(""),[l,c]=u.useState(""),[f,m]=u.useState(""),[h,p]=u.useState(!1),[y,g]=u.useState(""),[v,S]=u.useState([]);u.useEffect(()=>{let N=!1;return(async()=>{if(!e){S([]);return}try{const _=await Qr({worldId:e});if(!N){const C=Array.isArray(_?.data)?_.data:_;S(Array.isArray(C)?C:[])}}catch(_){N||(console.error(" Failed to load entity types",_),S([]))}})(),()=>{N=!0}},[e]);const w=async N=>{if(N.preventDefault(),!r||!l){g("Name and type are required.");return}try{p(!0),g("");const _=await Uy({world_id:e,name:r,description:f,entity_type_id:l,visibility:"visible"}),C=_?.data||_;t(C),i(""),c(""),m("")}catch(j){console.error(" Failed to create entity inline",j),g(j.message||"Failed to create entity")}finally{p(!1)}};return a.jsxs("form",{className:"inline-entity-creator",onSubmit:w,children:[a.jsx("h4",{children:"Create New Entity"}),y&&a.jsx("div",{className:"alert error",children:y}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Name"}),a.jsx("input",{type:"text",value:r,onChange:N=>i(N.target.value),placeholder:"Entity name..."})]}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Type"}),a.jsxs("select",{value:l,onChange:N=>c(N.target.value),children:[a.jsx("option",{value:"",children:"Select type..."}),v.map(N=>a.jsx("option",{value:N.id,children:N.name},N.id))]})]}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Description"}),a.jsx("textarea",{rows:"2",value:f,onChange:N=>m(N.target.value),placeholder:"Optional..."})]}),a.jsx("div",{className:"form-actions",children:a.jsx("button",{type:"submit",className:"btn primary",disabled:h||!e,children:h?"Creating":"Create Entity"})})]})}function gN({worldId:e,fromEntity:t=null,onCreated:r,onCancel:i,existingRelationships:l=[]}){const[c,f]=u.useState([]),[m,h]=u.useState(!0),[p,y]=u.useState(""),[g,v]=u.useState(null),[S,w]=u.useState(null),[N,j]=u.useState(""),[_,C]=u.useState(null),[O,E]=u.useState(!1);u.useEffect(()=>{e&&(h(!0),pf({worldId:e}).then(L=>{const U=Array.isArray(L?.data)?L.data:L?.data||[];f(U||[])}).catch(L=>y(L.message||"Failed to load data")).finally(()=>h(!1)))},[e]),u.useEffect(()=>{if(!t||g||!t.id||!t.name)return;const L={id:t.id,name:t.name,entity_type_id:t.entity_type_id||t.entityType?.id||t.entity_type?.id,entityType:t.entityType||t.entity_type||null,typeName:t.typeName||t.entityType?.name||t.entity_type?.name};v(L)},[t]);const T=L=>{if(!L)return null;const U=L.entity_type_id||L.typeId||L.entityType?.id||L.entity_type?.id,k=L.typeName||L.entityType?.name||L.entity_type?.name;return{...L,entity_type_id:U,typeName:k}},M=L=>L?.name||L?.title||L?.displayName||"Unnamed entity",A=u.useMemo(()=>{const L=T(g),U=T(S);if(!L||!U)return[];const k=L.entity_type_id,B=U.entity_type_id;if(!k||!B)return[];const R=(q=[])=>q.map(G=>G.id||G.entity_type_id||G.entityTypeId||G.type_id||G.typeId||G).map(String);return c.map(q=>{const G=R(q.from_entity_types),J=R(q.to_entity_types),ie=G.includes(String(k))&&J.includes(String(B)),Z=G.includes(String(B))&&J.includes(String(k));return ie||Z?{...q,_supportsDirect:ie,_supportsReverse:Z}:null}).filter(Boolean)},[c,g,S]),z=u.useMemo(()=>A.find(L=>String(L.id)===String(N)),[N,A]),P=u.useMemo(()=>z?_==="reverse"&&z._supportsReverse?"reverse":_==="direct"&&z._supportsDirect||z._supportsDirect?"direct":z._supportsReverse?"reverse":null:null,[_,z]);u.useEffect(()=>{if(!z){_!==null&&C(null);return}if(P===null){_!==null&&C(null);return}if(_===null){C(P);return}_!==P&&C(P)},[z,P,_]),u.useEffect(()=>{if(!N)return;A.some(U=>String(U.id)===String(N))||(j(""),C(null))},[A,N]);const X=P==="direct"?g:S,H=P==="direct"?S:g,Y=M(X),V=M(H),I=z?.from_name||z?.fromName||z?.name||"relates to",F=z?.to_name||z?.toName||z?.name||"relates to",D=async()=>{if(y(""),!g||!S||!N)return y("Please select both entities and a relationship type.");if(g.id===S.id)return y("Cannot create self-relationships.");if(l.find(R=>(R.from_entity_id===g.id&&R.to_entity_id===S.id||R.from_entity_id===S.id&&R.to_entity_id===g.id)&&R.relationship_type_id===N)){y("This relationship already exists.");return}const U=P;if(!z||!U){y("Please select a valid relationship type.");return}const k=U==="direct"?g.id:S.id,B=U==="direct"?S.id:g.id;try{await yN({from_entity_id:k,to_entity_id:B,relationship_type_id:N}),r?.({from_entity_id:k,to_entity_id:B,relationship_type_id:N,__direction:U})}catch(R){R.response?.status===409||R.response?.data?.message?.toLowerCase?.().includes("duplicate")||R.message?.toLowerCase?.().includes("duplicate")||R.message?.toLowerCase?.().includes("conflict")?y("This relationship already exists."):R.response?.data?.message?y(R.response.data.message):y("Failed to create relationship."),console.warn(" Relationship create error:",R)}};return m?a.jsx("p",{children:"Loading relationship data"}):a.jsxs("div",{className:"relationship-builder-v3",children:[a.jsx("h2",{children:"Add Relationship"}),p&&a.jsx("div",{className:"alert error",children:p}),a.jsx("div",{className:"form-row",children:a.jsx(oc,{worldId:e,label:"Entity 1",value:g?.id||"",onChange:L=>{t||(v(L),j(""),C(null))},disabled:!!t})}),a.jsxs("div",{className:"form-row entity2-section",children:[a.jsx(oc,{worldId:e,label:"Entity 2",value:S?.id||"",onChange:L=>w(L)}),!O&&a.jsx("button",{type:"button",className:"btn small tertiary",onClick:()=>E(!0),style:{alignSelf:"flex-start",marginTop:"0.4rem"},children:"+ Create new entity"}),O&&a.jsx(I4,{worldId:e,onCreated:async L=>{try{const U=await rr(L.id),k=Pa(U)||L;w(k)}catch{w(L)}E(!1)}})]}),g&&S&&a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Relationship Type"}),a.jsxs("select",{value:N,onChange:L=>{const U=L.target.value;if(j(U),!U){C(null);return}const k=A.find(B=>String(B.id)===String(U));k?._supportsDirect?C("direct"):k?._supportsReverse?C("reverse"):C(null)},children:[a.jsx("option",{value:"",children:"Select relationship type"}),A.length>0?A.map(L=>a.jsxs("option",{value:L.id,children:[L.name," (",L.from_name,"  ",L.to_name,")"]},L.id)):a.jsx("option",{disabled:!0,children:"No valid relationship types"})]})]}),g&&S&&z&&P&&a.jsxs("div",{className:"relationship-preview",children:[a.jsxs("div",{className:"preview-header",children:[a.jsx("h3",{children:"Relationship preview"}),z._supportsDirect&&z._supportsReverse&&a.jsx("button",{type:"button",className:"btn small secondary",onClick:()=>C(L=>L==="reverse"?"direct":"reverse"),children:"Swap entities"})]}),a.jsxs("p",{children:[a.jsx("strong",{children:Y})," ",I," ",a.jsx("strong",{children:V})]}),a.jsxs("p",{children:[a.jsx("strong",{children:V})," ",F," ",a.jsx("strong",{children:Y})]})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{className:"btn primary",disabled:!g||!S||!N,onClick:D,children:"Create Relationship"}),a.jsx("button",{className:"btn secondary",onClick:i,children:"Cancel"})]})]})}const bN=["global","selective","hidden"],L4=[...bN,"owner_only"],eS=new Set(bN),tS=new Set(L4),Qh=(e,t)=>{if(typeof e!="string")return"global";const r=e.toLowerCase();return t.has(r)?r:"global"},Oo=e=>e?Array.isArray(e)?e.map(t=>t==null?"":String(t).trim()).filter(Boolean):typeof e=="string"?e.split(",").map(t=>t.trim()).filter(Boolean):[]:[],Jh=()=>({campaigns:[],users:[],characters:[]});function O4(e,t,r){const i=e?.id,l=e?.world?.id||e?.world_id||"",c=u.useMemo(()=>e?{readMode:Qh(e.read_access||e.readAccess,eS),readCampaigns:Oo(e.read_campaign_ids||e.readCampaignIds),readUsers:Oo(e.read_user_ids||e.readUserIds),readCharacters:Oo(e.read_character_ids||e.readCharacterIds),writeMode:Qh(e.write_access||e.writeAccess,tS),writeCampaigns:Oo(e.write_campaign_ids||e.writeCampaignIds),writeUsers:Oo(e.write_user_ids||e.writeUserIds)}:{readMode:"global",readCampaigns:[],readUsers:[],readCharacters:[],writeMode:"global",writeCampaigns:[],writeUsers:[]},[e]),[f,m]=u.useState(c),[h,p]=u.useState(()=>Jh()),[y,g]=u.useState(!1),[v,S]=u.useState(""),[w,N]=u.useState(!1),[j,_]=u.useState(""),[C,O]=u.useState("");u.useEffect(()=>{m(c)},[c]);const E=u.useCallback(async()=>{if(t){if(!l){p(Jh()),S(""),g(!1);return}g(!0),S("");try{const P=await oN(l);p({campaigns:P.campaigns??[],users:P.users??[],characters:P.characters??[]})}catch(P){console.error(" Failed to load access options",P),p(Jh()),S(P.message||"Failed to load access options")}finally{g(!1)}}},[t,l]);u.useEffect(()=>{E()},[E]);const T=u.useMemo(()=>{const P=["readMode","readCampaigns","readUsers","readCharacters","writeMode","writeCampaigns","writeUsers"],X=H=>Array.isArray(H)?H.map(Y=>String(Y).trim()).filter(Boolean).sort():[];return P.some(H=>{const Y=f[H],V=c[H];if(Array.isArray(Y)||Array.isArray(V)){const I=X(Y),F=X(V);return I.length!==F.length?!0:I.some((D,L)=>D!==F[L])}return Y!==V})},[f,c]),M=u.useCallback((P,X)=>{_(""),O(""),m(H=>{const Y={...H};if(P==="readMode"||P==="writeMode"){const I=Qh(X,P==="readMode"?eS:tS);return Y[P]=I,P==="readMode"&&I!=="selective"&&(Y.readCampaigns=[],Y.readUsers=[],Y.readCharacters=[]),P==="writeMode"&&I!=="selective"&&(Y.writeCampaigns=[],Y.writeUsers=[]),Y}return["readCampaigns","readUsers","readCharacters","writeCampaigns","writeUsers"].includes(P)?(Y[P]=Array.isArray(X)?X.map(V=>String(V).trim()).filter(Boolean):[],Y):(Y[P]=X,Y)})},[]),A=u.useCallback(()=>{m(c),_(""),O("")},[c]),z=u.useCallback(async()=>{if(!r||!i)return!1;if(!T)return!0;_(""),O(""),N(!0);try{const P={read_access:f.readMode,write_access:f.writeMode,read_campaign_ids:f.readMode==="selective"?f.readCampaigns:[],read_user_ids:f.readMode==="selective"?f.readUsers:[],read_character_ids:f.readMode==="selective"?f.readCharacters:[],write_campaign_ids:f.writeMode==="selective"?f.writeCampaigns:[],write_user_ids:f.writeMode==="selective"?f.writeUsers:[]},X=await By(i,P);if(!(X?.data||X))throw new Error("Failed to save access settings");return O("Access settings saved."),!0}catch(P){return console.error(" Failed to save access settings",P),_(P.message||"Failed to save access settings"),!1}finally{N(!1)}},[r,i,f,T]);return{accessSettings:f,accessOptions:h,accessOptionsError:v,accessOptionsLoading:y,accessSaving:w,accessSaveError:j,accessSaveSuccess:C,isAccessDirty:T,handleAccessSettingChange:M,resetAccessSettings:A,handleAccessSave:z}}function z4(e){const t=u.useMemo(()=>typeof e=="function"?e:()=>!1,[e]);return l1(t)||wi}function $4({isEditing:e,canEdit:t,formError:r,formRef:i,editSchema:l,editInitialData:c,handleUpdate:f,handleFormStateChange:m,dossierSchema:h,viewData:p,featuredImageSrc:y,renderSchemaSections:g,imageSection:v,fieldRules:S,viewRuleContext:w}){const N=Array.isArray(h?.sections)?h.sections:[],j=N[0]||null,_=N[1]||null,C=N.slice(2),O=w?.actionsByField??{},E=w?.showRuleTargets??new Set,T=(X,H)=>{if(!X)return null;const Y=Number.isFinite(X.columns)?Math.max(1,Number(X.columns)):1,V=Array.isArray(X.fields)?X.fields:[];return V.length?a.jsx("div",{className:`entity-field-grid ${Y>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":""}`,style:{"--entity-field-columns":Y},children:V.map((I,F)=>{const D=I?.key||I?.name||I?.field||`${H}-${F}`,L=O[D],U=I.visibleByDefault!==void 0?!!I.visibleByDefault:I.visible_by_default!==void 0?!!I.visible_by_default:!0;return cc(D,L,E,U)?null:a.jsx(ff,{field:{...I},data:p,mode:"view"},`${H}-${D}`)})}):a.jsx("p",{className:"entity-empty-state",children:"No fields available."})},M=!!y&&!e,A=p?.name||"Entity",z=!!v&&e&&t,P=()=>{if(!M)return g(h,p,"dossier",w);const X={...h||{},sections:C};return a.jsxs(a.Fragment,{children:[a.jsx("section",{className:"entity-card entity-dossier-header-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:a.jsxs("div",{className:"entity-dossier-header",children:[a.jsxs("div",{className:"entity-dossier-header-content",children:[j?.title?a.jsx("h2",{className:"entity-card-title",children:j.title}):null,T(j,"dossier-summary"),_?a.jsx("div",{className:"entity-dossier-description",children:T(_,"dossier-description")}):null]}),a.jsx("div",{className:"entity-dossier-header-image sm:ml-6 sm:w-64 w-full mt-4 sm:mt-0",children:a.jsx("img",{src:y,alt:`${A} artwork`,loading:"lazy"})})]})}),g(X,p,"dossier",w)]})};return a.jsxs("div",{className:"entity-tab-content",children:[r&&a.jsx("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:a.jsx("div",{className:"alert error",role:"alert",children:r})}),e&&t?a.jsx("section",{className:"entity-card entity-card--form entity-edit-form-wrapper bg-white rounded-lg border p-4 sm:p-6 w-full",children:a.jsxs("div",{className:"entity-edit-form-container",children:[a.jsx("div",{className:"entity-edit-form-content",children:a.jsx(ys,{ref:i,schema:l,initialData:c||{},onSubmit:f,onStateChange:m,hideActions:!0,enableUnsavedPrompt:!1,fieldRules:S})}),z?a.jsx("div",{className:"entity-edit-form-image sm:ml-6 sm:w-64 w-full mt-4 sm:mt-0",children:v}):null]})}):P()]})}function F4({entity:e,toast:t,onExplore:r,canEdit:i,relationshipsLoading:l,relationshipsError:c,filteredRelationships:f,sortedRelationships:m,relationshipsEmptyMessage:h,relationshipFilters:p,relationshipFilterOptions:y,filterButtonDisabled:g,handleRelationshipFiltersChange:v,handleRelationshipFiltersReset:S,showRelationshipForm:w,setShowRelationshipForm:N,worldId:j,loadRelationships:_}){const[C,O]=u.useState(!1),E=w!==void 0?w:C,[T,M]=u.useState(!1),A=u.useRef(null);u.useEffect(()=>{if(!T)return;const L=k=>{A.current&&(A.current.contains(k.target)||M(!1))},U=k=>{k.key==="Escape"&&M(!1)};return document.addEventListener("mousedown",L),document.addEventListener("touchstart",L),document.addEventListener("keydown",U),()=>{document.removeEventListener("mousedown",L),document.removeEventListener("touchstart",L),document.removeEventListener("keydown",U)}},[T]);const z=Array.isArray(y?.relationshipTypes)?y.relationshipTypes:[],P=Array.isArray(y?.relatedEntityTypes)?y.relatedEntityTypes:[],X=p?.relationshipTypes?.values||[],H=p?.relatedEntityTypes?.values||[],Y=L=>{const U=Array.from(L.target.selectedOptions,k=>k.value);v&&v({relationshipTypes:{mode:U.length>0?"include":"all",values:U},relatedEntityTypes:p?.relatedEntityTypes||{mode:"all",values:[]}})},V=L=>{const U=Array.from(L.target.selectedOptions,k=>k.value);v&&v({relationshipTypes:p?.relationshipTypes||{mode:"all",values:[]},relatedEntityTypes:{mode:U.length>0?"include":"all",values:U}})},I=()=>{S&&S(),M(!1)},F=()=>{M(!1)},D=X.length>0||H.length>0;return a.jsxs(a.Fragment,{children:[t&&a.jsxs("div",{className:`toast-banner ${t.tone}`,role:"status",children:[a.jsx("span",{children:t.message}),t.link?a.jsx(Jt,{to:t.link.to,className:"toast-banner-link",children:t.link.label}):null]}),a.jsxs("div",{className:"bg-white border border-neutral-200 rounded-xl shadow-sm p-6 mb-6 w-full",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Relationships"}),a.jsxs("div",{className:"flex items-center gap-2",children:[typeof r=="function"?a.jsx("button",{type:"button",className:"btn-secondary",onClick:r,children:"Explore"}):null,a.jsxs("div",{className:"relative",ref:A,children:[a.jsx("button",{id:"filterButton",type:"button",className:`btn-secondary${D?" is-active":""}`,onClick:()=>M(L=>!L),disabled:g,children:"Filter"}),T&&!g?a.jsxs("div",{className:"bg-white border border-neutral-200 rounded-lg shadow-lg p-4 w-[260px] absolute top-full mt-2 right-0 z-10",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"text-sm font-medium text-neutral-700 mb-1 block",children:"Relationship Types"}),a.jsx("select",{className:"w-full border border-neutral-300 rounded-md px-3 py-1 text-sm",multiple:!0,size:5,value:X,onChange:Y,children:z.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"text-sm font-medium text-neutral-700 mb-1 block",children:"Related Entity Types"}),a.jsx("select",{className:"w-full border border-neutral-300 rounded-md px-3 py-1 text-sm",multiple:!0,size:5,value:H,onChange:V,children:P.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))})]}),a.jsxs("div",{className:"flex items-center justify-between mt-2",children:[a.jsx("button",{type:"button",className:"text-sm text-neutral-600 hover:text-neutral-900",onClick:I,children:"Clear filters"}),a.jsx("button",{type:"button",className:"btn-secondary text-sm",onClick:F,children:"Done"})]})]}):null]}),i&&a.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{N&&N(!0),w===void 0&&O(!0)},children:"Add relationship"})]})]}),l?a.jsx("p",{children:"Loading relationships..."}):c?a.jsx("div",{className:"alert error",role:"alert",children:c}):m.length===0?a.jsx("p",{className:"text-sm text-neutral-500",children:h}):f.length===0?a.jsx("p",{className:"text-sm text-neutral-500",children:"No relationships match your filters."}):a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-left text-neutral-600 border-b border-neutral-200",children:[a.jsx("th",{className:"py-2 font-medium",children:"Relationship"}),a.jsx("th",{className:"py-2 font-medium",children:"Type"}),a.jsx("th",{className:"py-2 font-medium",children:"Direction"})]})}),a.jsx("tbody",{children:f.map(L=>{const U=String(L.fromId)===String(e.id),k=U?L.toName:L.fromName,B=U?L.toId:L.fromId,R=L.sourceLabel||L.source_relationship_label||"",q=L.targetLabel||L.target_relationship_label||"";return a.jsxs("tr",{className:"border-b border-neutral-100 last:border-0",children:[a.jsxs("td",{className:"py-3",children:[a.jsx("strong",{children:e.name})," ",U?R:q," ",a.jsx(Jt,{to:`/entities/${B}`,className:"text-blue-600 hover:underline",children:k||""}),B?a.jsx(Is,{entityId:B,entityName:k}):null]}),a.jsx("td",{className:"py-3",children:L.typeName||""}),a.jsx("td",{className:"py-3",children:U?"Outgoing":"Incoming"})]},L.id)})})]})]}),j&&e?a.jsx(Yr,{isOpen:E,onClose:()=>{N?N(!1):O(!1)},title:"Add relationship",description:"Link this entity to others without leaving the page.",size:"md",children:a.jsx(gN,{worldId:j,fromEntity:e,onCreated:()=>{N?N(!1):O(!1),_&&_()},onCancel:()=>{N?N(!1):O(!1)}})}):null]})}function U4({canEdit:e,worldId:t,accessSettings:r,accessOptions:i,accessOptionsError:l,accessOptionsLoading:c,accessSaving:f,accessSaveError:m,accessSaveSuccess:h,handleAccessSettingChange:p}){return a.jsx("div",{className:"entity-tab-content",children:a.jsxs("section",{className:"entity-card entity-access-card",children:[a.jsx("h2",{className:"entity-card-title",children:"Access controls"}),a.jsx("p",{className:"entity-access-note help-text",children:"Configure who can view and edit this entity. Users with write access will automatically receive read access. Changes are saved along with the rest of the record."}),l&&a.jsx("div",{className:"alert error",role:"alert",children:l}),t?a.jsxs(a.Fragment,{children:[a.jsx(lN,{canEdit:e,accessSettings:r,accessOptions:i,accessOptionsLoading:c,accessSaving:f,onSettingChange:p}),a.jsxs("div",{className:"entity-access-actions",children:[m&&a.jsx("div",{className:"alert error",role:"alert",children:m}),h&&a.jsx("div",{className:"alert success",role:"status",children:h})]})]}):a.jsx("p",{className:"entity-empty-state",children:"Assign this entity to a world to configure access settings."})]})})}function B4({renderSchemaSections:e,systemSchema:t,viewData:r}){return a.jsx("div",{className:"entity-tab-content",children:e(t,r,"system")})}const nS=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})},Yu=e=>{if(!e)return"";const t=e.username?.trim?.()||"",r=e.email?.trim?.()||"";return t&&r&&t!==r?`${t} (${r})`:t||r||"Unknown user"},q4=e=>Array.isArray(e)?e.filter(t=>t&&typeof t=="object").map(t=>({...t})):[],ep=(e,t)=>{const r=new Set,i=[];return e.forEach(l=>{if(!l)return;let c=l[t];if(c||(t==="user_id"?c=l.user?.id:t==="campaign_id"&&(c=l.campaign?.id)),!c)return;const f=String(c);r.has(f)||(r.add(f),i.push(l))}),i},aS=(e,t)=>{if(!e)return[];const r=Array.isArray(e.permissions)?e.permissions:[],i=new Set,l=[];return r.forEach(c=>{if(!c)return;let f=c[t];if(f||(t==="user_id"?f=c.user?.id:t==="campaign_id"&&(f=c.campaign?.id)),!f)return;const m=String(f);i.has(m)||(i.add(m),l.push(m))}),l};function H4({entity:e,secrets:t,worldId:r,canManageSecrets:i,onSecretCreated:l,onSecretUpdated:c}){const[f,m]=u.useState(""),[h,p]=u.useState(""),[y,g]=u.useState([]),[v,S]=u.useState([]),[w,N]=u.useState({campaigns:[],users:[]}),[j,_]=u.useState(!1),[C,O]=u.useState(""),[E,T]=u.useState(!1),[M,A]=u.useState(!1),[z,P]=u.useState(""),[X,H]=u.useState(""),[Y,V]=u.useState(!1),[I,F]=u.useState(null),D=u.useMemo(()=>!!I?.id,[I?.id]),L=u.useMemo(()=>`entity-secret-create-${e?.id||"new"}`,[e?.id]),U=u.useMemo(()=>q4(t),[t]),k=u.useCallback(()=>{m(""),p(""),g([]),S([])},[]),B=u.useCallback(()=>{M||(F(null),k(),P(""),H(""),V(!0))},[k,M]),R=u.useCallback(ne=>{if(!i||M||!ne)return;const we=ne.title??"",ke=ne.content??"";m(we?String(we):""),p(ke?String(ke):""),g(aS(ne,"campaign_id")),S(aS(ne,"user_id")),N(Re=>{const Te=Array.isArray(Re?.campaigns)?[...Re.campaigns]:[],rt=Array.isArray(Re?.users)?[...Re.users]:[],He=(Ie,vt,Ct)=>{if(!vt)return;const At=String(vt);Ie.some(_t=>_t?.value===At)||Ie.push({value:At,label:Ct})};return(Array.isArray(ne.permissions)?ne.permissions:[]).forEach(Ie=>{if(!Ie)return;const vt=Ie.user_id??Ie.user?.id;if(vt){const At=Ie.user?Yu(Ie.user):`User ${String(vt).slice(0,8)}`;He(rt,vt,At)}const Ct=Ie.campaign_id??Ie.campaign?.id;if(Ct){const At=Ie.campaign?.name?Ie.campaign.name:`Campaign ${String(Ct).slice(0,8)}`;He(Te,Ct,At)}}),{campaigns:Te,users:rt}}),F(ne),P(""),H(""),V(!0)},[i,M]),q=u.useCallback(()=>{M||(V(!1),P(""),F(null),k())},[k,M]),G=u.useCallback(async()=>{if(!i||!r){N({campaigns:[],users:[]}),O(""),_(!1),T(!0);return}_(!0),O("");try{const[ne,we]=await Promise.all([jc({world_id:r}),Ds({world_id:r})]),Re=(Array.isArray(ne?.data)?ne.data:Array.isArray(ne)?ne:[]).map(tt=>({value:String(tt.id),label:tt.name||"Untitled campaign"})),Te=Array.isArray(we?.data)?we.data:Array.isArray(we)?we:[],rt=[];Te.forEach(tt=>{const Ie=tt?.player||{},vt=Ie.id||tt?.user_id;vt&&rt.push({value:String(vt),label:Yu(Ie)})});const He=ep(rt,"value");N({campaigns:Re,users:He}),T(!0)}catch(ne){console.error(" Failed to load secret visibility options",ne),N({campaigns:[],users:[]}),O(ne.message||"Failed to load share options"),T(!0)}finally{_(!1)}},[i,r]);u.useEffect(()=>{T(!1),N({campaigns:[],users:[]}),O("")},[r,i]),u.useEffect(()=>{!Y||E||G()},[Y,E,G]);const J=async ne=>{if(ne.preventDefault(),!e?.id||M)return;const we=h.trim();if(!we){P("Description is required."),H("");return}A(!0),P(""),H("");try{const ke={summary:f.trim()||void 0,description:we,campaign_ids:y,user_ids:v};let Re;D&&I?.id?Re=await FR(e.id,I.id,ke):Re=await $R(e.id,ke);const Te=Re?.data||Re;D&&I?.id?(c?.(Te),H("Secret updated successfully.")):(l?.(Te),H("Secret created successfully.")),k(),F(null),V(!1)}catch(ke){P(ke.message||"Failed to save secret")}finally{A(!1)}},ie=ne=>{if(!i||!Array.isArray(ne?.permissions))return null;const we=ne.permissions.map(Te=>({...Te})).filter(Te=>Te);if(we.length===0)return a.jsx("p",{className:"entity-secret-shared",children:"Not shared with any campaigns or users."});const ke=ep(we.filter(Te=>Te.user_id||Te.user),"user_id"),Re=ep(we.filter(Te=>Te.campaign_id||Te.campaign),"campaign_id");return a.jsxs("div",{className:"entity-secret-shared",children:[ke.length>0&&a.jsxs("div",{children:[a.jsx("strong",{children:"Shared with players:"}),a.jsx("ul",{className:"entity-secret-share-list",children:ke.map(Te=>{const rt=Te.user?Yu(Te.user):`User ${String(Te.user_id).slice(0,8)}`,He=Te.user_id||rt;return a.jsx("li",{className:"entity-secret-share-pill",children:rt},He)})})]}),Re.length>0&&a.jsxs("div",{children:[a.jsx("strong",{children:"Shared with campaigns:"}),a.jsx("ul",{className:"entity-secret-share-list",children:Re.map(Te=>{const rt=Te.campaign?.name||`Campaign ${String(Te.campaign_id).slice(0,8)}`,He=Te.campaign_id||rt;return a.jsx("li",{className:"entity-secret-share-pill",children:rt},He)})})]})]})},Z=D?"Edit secret":"Create a secret",me=D?"Update the secret content or who can access it.":"Secrets are hidden notes that are only visible to selected campaigns or players.",Q=D?"Update secret":"Save secret",oe=D?"Updating secret...":"Creating secret...";return a.jsxs("div",{className:"entity-tab-content",children:[i&&a.jsx(Yr,{isOpen:Y,onClose:q,title:Z,description:me,size:"lg",footerActions:a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{type:"button",className:"border border-neutral-300 bg-white px-4 py-2 rounded-md text-sm hover:bg-neutral-100 text-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",onClick:q,disabled:M,children:"Cancel"}),a.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-md text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",form:L,disabled:M,children:M?oe:Q})]}),children:a.jsxs("form",{id:L,className:"entity-secret-form-body",onSubmit:J,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-secret-summary",className:"text-sm font-medium text-neutral-700",children:"Summary"}),a.jsx("input",{id:"entity-secret-summary",type:"text",value:f,onChange:ne=>m(ne.target.value),placeholder:"Short label for this secret (optional)",disabled:M,"data-autofocus":"true",className:"w-full border rounded-md px-3 py-2 text-sm"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-secret-description",className:"text-sm font-medium text-neutral-700",children:"Description"}),a.jsx("textarea",{id:"entity-secret-description",value:h,onChange:ne=>p(ne.target.value),rows:4,placeholder:"Detail the secret information...",disabled:M,required:!0,className:"w-full border rounded-md px-3 py-2 text-sm min-h-[120px]"})]}),a.jsxs("div",{className:"entity-secret-share-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-secret-campaigns",className:"text-sm font-medium text-neutral-700",children:"Share with campaigns"}),a.jsx(Ms,{inputId:"entity-secret-campaigns",selected:y,options:w.campaigns,onChange:g,placeholder:"Select campaigns...",disabled:M||j,loading:j,noOptionsMessage:j?"Loading campaigns...":"No campaigns available in this world."}),a.jsx("p",{className:"help-text",children:"Dungeon Masters of selected campaigns will be able to read this secret."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-secret-users",className:"text-sm font-medium text-neutral-700",children:"Share with players"}),a.jsx(Ms,{inputId:"entity-secret-users",selected:v,options:w.users,onChange:S,placeholder:"Select users...",disabled:M||j,loading:j,noOptionsMessage:j?"Loading users...":"No eligible players found for this world."}),a.jsx("p",{className:"help-text",children:"Choose specific players who should see this information."})]})]}),C&&a.jsx("div",{className:"alert error",role:"alert",children:C}),z&&a.jsx("div",{className:"alert error",role:"alert",children:z})]})}),a.jsxs("section",{className:"entity-card entity-secret-list-card",children:[a.jsxs("div",{className:"entity-card-header entity-card-header--subtle",children:[a.jsxs("h2",{className:"entity-card-title",children:["Secrets for ",e?.name||"this entity"]}),i&&a.jsx("div",{className:"entity-card-actions",children:a.jsx("button",{type:"button",className:"btn submit",onClick:B,disabled:M,children:"New secret"})})]}),X&&a.jsx("div",{className:"alert success",role:"status",children:X}),U.length===0?a.jsx("p",{className:"entity-empty-state",children:"No secrets available for this entity yet."}):a.jsx("ul",{className:"entity-secret-list",children:U.map(ne=>{const we=ne.createdAt||ne.created_at,ke=ne.updatedAt||ne.updated_at,Re=Yu(ne.creator);return a.jsxs("li",{className:"entity-secret-item",children:[a.jsxs("div",{className:"entity-secret-header",children:[a.jsx("h3",{children:ne.title||"Untitled secret"}),a.jsxs("div",{className:"entity-secret-meta",children:[Re&&a.jsxs("span",{children:["Created by ",Re]}),we&&a.jsxs("span",{children:["Created ",nS(we)]}),ke&&ke!==we&&a.jsxs("span",{children:["Updated ",nS(ke)]})]})]}),i&&a.jsx("div",{className:"entity-secret-actions",children:a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>R(ne),disabled:M,children:"Edit secret"})}),ne.content?a.jsx("p",{className:"entity-secret-content",children:ne.content}):null,ie(ne)]},ne.id||ne.createdAt)})})]})]})}function P4(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function V4(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function Y4(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function kd(e){return P4(e)||V4(e)||Y4()}function ls(){return ls=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},ls.apply(this,arguments)}function G4(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function X4(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function K4(e,t,r){return t&&X4(e.prototype,t),e}function un(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Kp(e,t){return Kp=Object.setPrototypeOf||function(i,l){return i.__proto__=l,i},Kp(e,t)}function W4(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kp(e,t)}function jl(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?jl=function(r){return typeof r}:jl=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},jl(e)}function bd(e){return typeof Symbol=="function"&&jl(Symbol.iterator)==="symbol"?bd=function(r){return jl(r)}:bd=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":jl(r)},bd(e)}function Z4(e,t){return t&&(bd(t)==="object"||typeof t=="function")?t:un(e)}function Dd(e){return Dd=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},Dd(e)}function on(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var tp,sS;function Q4(){if(sS)return tp;sS=1;var e=function(t,r,i,l,c,f,m,h){if(!t){var p;if(r===void 0)p=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var y=[i,l,c,f,m,h],g=0;p=new Error(r.replace(/%s/g,function(){return y[g++]})),p.name="Invariant Violation"}throw p.framesToPop=1,p}};return tp=e,tp}var J4=Q4();const Ml=ki(J4);function eD(e){if(Array.isArray(e))return e}function tD(e,t){var r=[],i=!0,l=!1,c=void 0;try{for(var f=e[Symbol.iterator](),m;!(i=(m=f.next()).done)&&(r.push(m.value),!(t&&r.length===t));i=!0);}catch(h){l=!0,c=h}finally{try{!i&&f.return!=null&&f.return()}finally{if(l)throw c}}return r}function nD(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function Id(e,t){return eD(e)||tD(e,t)||nD()}function aD(e,t){if(e==null)return{};var r={},i=Object.keys(e),l,c;for(c=0;c<i.length;c++)l=i[c],!(t.indexOf(l)>=0)&&(r[l]=e[l]);return r}function sD(e,t){if(e==null)return{};var r=aD(e,t),i,l;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(l=0;l<c.length;l++)i=c[l],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}var np,rS;function rD(){if(rS)return np;rS=1;function e(t,r,i){return r in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}return np=e,np}var iD=rD();const dc=ki(iD);var ap,iS;function lD(){if(iS)return ap;iS=1;function e(t){if(Array.isArray(t)){for(var r=0,i=new Array(t.length);r<t.length;r++)i[r]=t[r];return i}}return ap=e,ap}var sp,lS;function oD(){if(lS)return sp;lS=1;function e(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}return sp=e,sp}var rp,oS;function cD(){if(oS)return rp;oS=1;function e(){throw new TypeError("Invalid attempt to spread non-iterable instance")}return rp=e,rp}var ip,cS;function uD(){if(cS)return ip;cS=1;var e=lD(),t=oD(),r=cD();function i(l){return e(l)||t(l)||r()}return ip=i,ip}var dD=uD();const tr=ki(dD);var Bl=function(t){return t===Object(t)?Object.keys(t):[]},vN=function(t){return t===Object(t)?Object.values(t):[]};function xN(e,t){var r=Object.assign({},e);return vd(e)&&vd(t)&&Bl(t).forEach(function(i){vd(t[i])?i in e?r[i]=xN(e[i],t[i]):Object.assign(r,dc({},i,t[i])):Object.assign(r,dc({},i,t[i]))}),r}var Wp=function(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),l=1;l<r;l++)i[l-1]=arguments[l];return i.reduce(function(c,f){return xN(c,f)},t)},fD=function(t,r){var i=Object.assign({},t);if(r)for(var l=0;l<r.length;l++)delete i[r[l]];return i},vd=function(t){return t===Object(t)&&!(t instanceof Date)&&!Array.isArray(t)},mD=function(t){return(t||[]).filter(Boolean)},eg=function(t){return t[0]==="&"},hD=function(t){return!eg(t)},uS=function(t){return t.replace(/-(\w)/g,function(r,i){return i.toUpperCase()})},pD=function(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=Bl(t),l={},c=0,f=i.length;c<f;c+=1){var m=i[c],h=Object.prototype.toString.call(t[m])!=="[object Object]"||m[0]===":"||m[0]==="@"||r.indexOf(m)>=0;h&&(l[m]=t[m])}return l},SN=function(t,r){for(var i=r.map(uS),l=Bl(t),c={},f=0,m=l.length;f<m;f+=1){var h=l[f];(r.indexOf(h)>=0||i.indexOf(uS(h))>=0)&&(c[h]=t[h])}return c},yD=function e(t,r){for(var i=Wp.apply(void 0,[{},fD(t,r)].concat(tr(vN(SN(t,r))))),l=Bl(i).filter(eg),c=0,f=l.length;c<f;c+=1){var m=l[c],h=e(i[m],r);r.indexOf(m)>=0?(delete i[m],i=Wp({},i,h)):i[m]=h}return i};function dS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function fS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?dS(Object(r),!0).forEach(function(i){dc(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var gD=["animationName"],wN=function(t){var r=t.style,i=t.className;return fS(fS({},r?{style:pD(r,gD)}:{}),i?{className:i}:{})},NN=u.createContext(wN);NN.Provider;var EN=function(t){if(t){if(typeof t=="string")return[t];if(!Array.isArray(t)){var r=t;return Bl(t).reduce(function(i,l){return i.concat(r[l]?[l]:[])},[])}}else return[];return t},bD={},vD=function(t){return function(r,i){var l=i||bD;t.memoize=t.memoize||new WeakMap;var c;t.memoize.has(l)?c=t.memoize.get(l):(c={},t.memoize.set(l,c));var f=EN(r).join(" ");return f in c?c[f]:c[f]=t(r||[],i)}};function mS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function yl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mS(Object(r),!0).forEach(function(i){dc(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var xD=function(t){var r=t&&Bl(t)[0];return r&&r.split("__")[0].split("--")[0]},SD=function(t,r,i){if(t){var l=t.split(" ")[0],c=[].concat(tr(r.length===0?i.map(function(f){return"".concat(l,"--").concat(f.substring(1))}):[]),tr(r.map(function(f){return"".concat(l,"__").concat(f)})));return r.length===0?[t].concat(tr(c)):c}};function jN(e){var t=e.style,r=e.className,i=e.classNames,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:wN,c=r||xD(i)||t?.className,f=typeof t=="function"?t:vD(function(g,v){var S=EN(g);Ml(Array.isArray(S),"First parameter must be a string, an array of strings, a plain object with boolean values, or a falsy value."),Ml(!v||vd(v),"Optional second parameter must be a plain object.");var w=S.filter(eg),N=S.filter(hD),j=N.length>0?function(O){return vN(SN(O,N))}:function(O){return[O]},_=function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return j(yD(E,w))},C=SD(c,N,w);return jN(yl(yl(yl({},(t||v)&&{style:Wp.apply(void 0,[{}].concat(tr(_(v)),tr(_(t))))}),C&&{className:C.join(" ")}),i&&{classNames:i}),l)}),m=yl({},typeof t=="function"?t:{style:t}),h=tr(new Set([].concat(tr(m.className?m.className.split(" "):[]),tr(c?c.split(" "):[])))),p=i?mD(h.map(function(g){return i[g]})):h,y=l(yl(yl({},m),p.length>0?{className:p.join(" ")}:{}));return Object.assign(f,y),f}function hS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function zo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hS(Object(r),!0).forEach(function(i){dc(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var wD=function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return r.reduce(function(l,c){return zo(zo(zo({},l),typeof c=="function"?c:{}),{},{style:zo(zo({},l.style),typeof c=="function"?c.style:c)})},{})},tg=function(t,r,i){var l=r.style,c=r.className,f=r.classNames,m=u.useContext(NN),h=u.useMemo(function(){return jN({style:l,className:c,classNames:f},m)},[l,c,f,m]);return h(i,t)},xd=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},Ts={id:"__id__",display:"__display__"},pS=function(t,r){Ml(r==="id"||r==="display",'Second arg must be either "id" or "display", got: "'.concat(r,'"'));var i=t.indexOf(Ts.display),l=t.indexOf(Ts.id);return i<0&&(i=null),l<0&&(l=null),Ml(i!==null||l!==null,"The markup '".concat(t,"' does not contain either of the placeholders '__id__' or '__display__'")),i!==null&&l!==null?r==="id"&&l<=i||r==="display"&&i<=l?0:1:0},ND=function(t){var r=/^\/(.+)\/(\w+)?$/;return new RegExp(t.map(function(i){var l=r.exec(i.toString()),c=Id(l,3),f=c[1],m=c[2];return Ml(!m,"RegExp flags are not supported. Change /".concat(f,"/").concat(m," into /").concat(f,"/")),"(".concat(f,")")}).join("|"),"g")},_N=function(t){var r=0;return t.indexOf("__id__")>=0&&r++,t.indexOf("__display__")>=0&&r++,r},ED=function(){},_c=function(t,r,i){for(var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:ED,c=ND(r.map(function(T){return T.regex})),f=2,m=r.map(function(T){var M=T.markup,A=f;return f+=_N(M)+1,A}),h,p=0,y=0;(h=c.exec(t))!==null;){var g=m.find(function(T){return!!h[T]}),v=m.indexOf(g),S=r[v],w=S.markup,N=S.displayTransform,j=g+pS(w,"id"),_=g+pS(w,"display"),C=h[j],O=N(C,h[_]),E=t.substring(p,h.index);l(E,p,y),y+=E.length,i(h[0],h.index,y,C,O,v,p),y+=O.length,p=c.lastIndex}p<t.length&&l(t.substring(p),p,y)},Ni=function(t,r){var i="";return _c(t,r,function(l,c,f,m,h){i+=h},function(l){i+=l}),i},Sa=function(t,r,i){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"START";if(typeof i!="number")return i;var c,f=function(p,y,g){c===void 0&&g+p.length>=i&&(c=y+i-g)},m=function(p,y,g,v,S,w,N){c===void 0&&g+S.length>i&&(l==="NULL"?c=null:c=y+(l==="END"?p.length:0))};return _c(t,r,m,f),c===void 0?t.length:c},tc=function(t,r,i,l){return t.substring(0,r)+l+t.substring(i)},jD=function(t,r,i,l){var c=i.selectionStartBefore,f=i.selectionEndBefore,m=i.selectionEndAfter,h=Ni(t,l),p=h.length-r.length;c==="undefined"&&(c=m+p),f==="undefined"&&(f=c),c===f&&f===m&&h.length===r.length&&(c=c-1);var y=r.slice(c,m),g=Math.min(c,m),v=f;c===m&&(v=Math.max(f,c+p));var S=Sa(t,l,g,"START"),w=Sa(t,l,v,"END"),N=Sa(t,l,g,"NULL"),j=Sa(t,l,v,"NULL"),_=N===null||j===null,C=tc(t,S,w,y);if(!_){var O=Ni(C,l);if(O!==r){for(g=0;r[g]===O[g];)g++;y=r.slice(g,m),v=h.lastIndexOf(r.substring(m)),S=Sa(t,l,g,"START"),w=Sa(t,l,v,"END"),C=tc(t,S,w,y)}}return C},yS=function(t,r,i){var l=i,c=!1,f=function(h,p,y,g,v,S,w){y<=i&&y+v.length>i&&(l=y,c=!0)};if(_c(t,r,f),c)return l},Ko=function(t,r){var i=[];return _c(t,r,function(l,c,f,m,h,p,y){i.push({id:m,display:h,childIndex:p,index:c,plainTextIndex:f})}),i},CN=function(t,r){return"".concat(t,"-").concat(r)},Gu=function(t){return Object.values(t).reduce(function(r,i){var l=i.results;return r+l.length},0)},_D=function(t,r){var i=Ko(t,r),l=i[i.length-1];return l?l.plainTextIndex+l.display.length:0},CD=function(t){var r=xd(t),i=t[t.indexOf(Ts.display)+Ts.display.length],l=t[t.indexOf(Ts.id)+Ts.id.length];return new RegExp(r.replace(Ts.display,"([^".concat(xd(i||""),"]+?)")).replace(Ts.id,"([^".concat(xd(l||""),"]+?)")))},Or=function(t){return u.Children.toArray(t).map(function(r){var i=r.props,l=i.markup,c=i.regex,f=i.displayTransform;return{markup:l,regex:c?AD(c,l):CD(l),displayTransform:f||function(m,h){return h||m}}})},AD=function(t,r){var i=new RegExp(t.toString()+"|").exec("").length-1,l=_N(r);return Ml(i===l,"Number of capturing groups in RegExp ".concat(t.toString()," (").concat(i,") does not match the number of placeholders in the markup '").concat(r,"' (").concat(l,")")),t},TD=function(t,r,i){return t.replace(Ts.id,r).replace(Ts.display,i)},MD=[{base:"A",letters:/(&#65;|&#9398;|&#65313;|&#192;|&#193;|&#194;|&#7846;|&#7844;|&#7850;|&#7848;|&#195;|&#256;|&#258;|&#7856;|&#7854;|&#7860;|&#7858;|&#550;|&#480;|&#196;|&#478;|&#7842;|&#197;|&#506;|&#461;|&#512;|&#514;|&#7840;|&#7852;|&#7862;|&#7680;|&#260;|&#570;|&#11375;|[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F])/g},{base:"AA",letters:/(&#42802;|[\uA732])/g},{base:"AE",letters:/(&#198;|&#508;|&#482;|[\u00C6\u01FC\u01E2])/g},{base:"AO",letters:/(&#42804;|[\uA734])/g},{base:"AU",letters:/(&#42806;|[\uA736])/g},{base:"AV",letters:/(&#42808;|&#42810;|[\uA738\uA73A])/g},{base:"AY",letters:/(&#42812;|[\uA73C])/g},{base:"B",letters:/(&#66;|&#9399;|&#65314;|&#7682;|&#7684;|&#7686;|&#579;|&#386;|&#385;|[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181])/g},{base:"C",letters:/(&#67;|&#9400;|&#65315;|&#262;|&#264;|&#266;|&#268;|&#199;|&#7688;|&#391;|&#571;|&#42814;|[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E])/g},{base:"D",letters:/(&#68;|&#9401;|&#65316;|&#7690;|&#270;|&#7692;|&#7696;|&#7698;|&#7694;|&#272;|&#395;|&#394;|&#393;|&#42873;|&#208;|[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779\u00D0])/g},{base:"DZ",letters:/(&#497;|&#452;|[\u01F1\u01C4])/g},{base:"Dz",letters:/(&#498;|&#453;|[\u01F2\u01C5])/g},{base:"E",letters:/(&#69;|&#9402;|&#65317;|&#200;|&#201;|&#202;|&#7872;|&#7870;|&#7876;|&#7874;|&#7868;|&#274;|&#7700;|&#7702;|&#276;|&#278;|&#203;|&#7866;|&#282;|&#516;|&#518;|&#7864;|&#7878;|&#552;|&#7708;|&#280;|&#7704;|&#7706;|&#400;|&#398;|[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E])/g},{base:"F",letters:/(&#70;|&#9403;|&#65318;|&#7710;|&#401;|&#42875;|[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B])/g},{base:"G",letters:/(&#71;|&#9404;|&#65319;|&#500;|&#284;|&#7712;|&#286;|&#288;|&#486;|&#290;|&#484;|&#403;|&#42912;|&#42877;|&#42878;|[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E])/g},{base:"H",letters:/(&#72;|&#9405;|&#65320;|&#292;|&#7714;|&#7718;|&#542;|&#7716;|&#7720;|&#7722;|&#294;|&#11367;|&#11381;|&#42893;|[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D])/g},{base:"I",letters:/(&#73;|&#9406;|&#65321;|&#204;|&#205;|&#206;|&#296;|&#298;|&#300;|&#304;|&#207;|&#7726;|&#7880;|&#463;|&#520;|&#522;|&#7882;|&#302;|&#7724;|&#407;|[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197])/g},{base:"J",letters:/(&#74;|&#9407;|&#65322;|&#308;|&#584;|[\u004A\u24BF\uFF2A\u0134\u0248])/g},{base:"K",letters:/(&#75;|&#9408;|&#65323;|&#7728;|&#488;|&#7730;|&#310;|&#7732;|&#408;|&#11369;|&#42816;|&#42818;|&#42820;|&#42914;|[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2])/g},{base:"L",letters:/(&#76;|&#9409;|&#65324;|&#319;|&#313;|&#317;|&#7734;|&#7736;|&#315;|&#7740;|&#7738;|&#321;|&#573;|&#11362;|&#11360;|&#42824;|&#42822;|&#42880;|[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780])/g},{base:"LJ",letters:/(&#455;|[\u01C7])/g},{base:"Lj",letters:/(&#456;|[\u01C8])/g},{base:"M",letters:/(&#77;|&#9410;|&#65325;|&#7742;|&#7744;|&#7746;|&#11374;|&#412;|[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C])/g},{base:"N",letters:/(&#78;|&#9411;|&#65326;|&#504;|&#323;|&#209;|&#7748;|&#327;|&#7750;|&#325;|&#7754;|&#7752;|&#544;|&#413;|&#42896;|&#42916;|&#330;|[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4\u014A])/g},{base:"NJ",letters:/(&#458;|[\u01CA])/g},{base:"Nj",letters:/(&#459;|[\u01CB])/g},{base:"O",letters:/(&#79;|&#9412;|&#65327;|&#210;|&#211;|&#212;|&#7890;|&#7888;|&#7894;|&#7892;|&#213;|&#7756;|&#556;|&#7758;|&#332;|&#7760;|&#7762;|&#334;|&#558;|&#560;|&#214;|&#554;|&#7886;|&#336;|&#465;|&#524;|&#526;|&#416;|&#7900;|&#7898;|&#7904;|&#7902;|&#7906;|&#7884;|&#7896;|&#490;|&#492;|&#216;|&#510;|&#390;|&#415;|&#42826;|&#42828;|[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C])/g},{base:"OE",letters:/(&#338;|[\u0152])/g},{base:"OI",letters:/(&#418;|[\u01A2])/g},{base:"OO",letters:/(&#42830;|[\uA74E])/g},{base:"OU",letters:/(&#546;|[\u0222])/g},{base:"P",letters:/(&#80;|&#9413;|&#65328;|&#7764;|&#7766;|&#420;|&#11363;|&#42832;|&#42834;|&#42836;|[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754])/g},{base:"Q",letters:/(&#81;|&#9414;|&#65329;|&#42838;|&#42840;|&#586;|[\u0051\u24C6\uFF31\uA756\uA758\u024A])/g},{base:"R",letters:/(&#82;|&#9415;|&#65330;|&#340;|&#7768;|&#344;|&#528;|&#530;|&#7770;|&#7772;|&#342;|&#7774;|&#588;|&#11364;|&#42842;|&#42918;|&#42882;|[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782])/g},{base:"S",letters:/(&#83;|&#9416;|&#65331;|&#7838;|&#346;|&#7780;|&#348;|&#7776;|&#352;|&#7782;|&#7778;|&#7784;|&#536;|&#350;|&#11390;|&#42920;|&#42884;|[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784])/g},{base:"T",letters:/(&#84;|&#9417;|&#65332;|&#7786;|&#356;|&#7788;|&#538;|&#354;|&#7792;|&#7790;|&#358;|&#428;|&#430;|&#574;|&#42886;|[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786])/g},{base:"TH",letters:/(&#222;|[\u00DE])/g},{base:"TZ",letters:/(&#42792;|[\uA728])/g},{base:"U",letters:/(&#85;|&#9418;|&#65333;|&#217;|&#218;|&#219;|&#360;|&#7800;|&#362;|&#7802;|&#364;|&#220;|&#475;|&#471;|&#469;|&#473;|&#7910;|&#366;|&#368;|&#467;|&#532;|&#534;|&#431;|&#7914;|&#7912;|&#7918;|&#7916;|&#7920;|&#7908;|&#7794;|&#370;|&#7798;|&#7796;|&#580;|[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244])/g},{base:"V",letters:/(&#86;|&#9419;|&#65334;|&#7804;|&#7806;|&#434;|&#42846;|&#581;|[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245])/g},{base:"VY",letters:/(&#42848;|[\uA760])/g},{base:"W",letters:/(&#87;|&#9420;|&#65335;|&#7808;|&#7810;|&#372;|&#7814;|&#7812;|&#7816;|&#11378;|[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72])/g},{base:"X",letters:/(&#88;|&#9421;|&#65336;|&#7818;|&#7820;|[\u0058\u24CD\uFF38\u1E8A\u1E8C])/g},{base:"Y",letters:/(&#89;|&#9422;|&#65337;|&#7922;|&#221;|&#374;|&#7928;|&#562;|&#7822;|&#376;|&#7926;|&#7924;|&#435;|&#590;|&#7934;|[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE])/g},{base:"Z",letters:/(&#90;|&#9423;|&#65338;|&#377;|&#7824;|&#379;|&#381;|&#7826;|&#7828;|&#437;|&#548;|&#11391;|&#11371;|&#42850;|[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762])/g},{base:"a",letters:/(&#97;|&#9424;|&#65345;|&#7834;|&#224;|&#225;|&#226;|&#7847;|&#7845;|&#7851;|&#7849;|&#227;|&#257;|&#259;|&#7857;|&#7855;|&#7861;|&#7859;|&#551;|&#481;|&#228;|&#479;|&#7843;|&#229;|&#507;|&#462;|&#513;|&#515;|&#7841;|&#7853;|&#7863;|&#7681;|&#261;|&#11365;|&#592;|[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250])/g},{base:"aa",letters:/(&#42803;|[\uA733])/g},{base:"ae",letters:/(&#230;|&#509;|&#483;|[\u00E6\u01FD\u01E3])/g},{base:"ao",letters:/(&#42805;|[\uA735])/g},{base:"au",letters:/(&#42807;|[\uA737])/g},{base:"av",letters:/(&#42809;|&#42811;|[\uA739\uA73B])/g},{base:"ay",letters:/(&#42813;|[\uA73D])/g},{base:"b",letters:/(&#98;|&#9425;|&#65346;|&#7683;|&#7685;|&#7687;|&#384;|&#387;|&#595;|[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253])/g},{base:"c",letters:/(&#99;|&#9426;|&#65347;|&#263;|&#265;|&#267;|&#269;|&#231;|&#7689;|&#392;|&#572;|&#42815;|&#8580;|[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184])/g},{base:"d",letters:/(&#100;|&#9427;|&#65348;|&#7691;|&#271;|&#7693;|&#7697;|&#7699;|&#7695;|&#273;|&#396;|&#598;|&#599;|&#42874;|&#240;|[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A\u00F0])/g},{base:"dz",letters:/(&#499;|&#454;|[\u01F3\u01C6])/g},{base:"e",letters:/(&#101;|&#9428;|&#65349;|&#232;|&#233;|&#234;|&#7873;|&#7871;|&#7877;|&#7875;|&#7869;|&#275;|&#7701;|&#7703;|&#277;|&#279;|&#235;|&#7867;|&#283;|&#517;|&#519;|&#7865;|&#7879;|&#553;|&#7709;|&#281;|&#7705;|&#7707;|&#583;|&#603;|&#477;|[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD])/g},{base:"f",letters:/(&#102;|&#9429;|&#65350;|&#7711;|&#402;|&#42876;|[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C])/g},{base:"g",letters:/(&#103;|&#9430;|&#65351;|&#501;|&#285;|&#7713;|&#287;|&#289;|&#487;|&#291;|&#485;|&#608;|&#42913;|&#7545;|&#42879;|[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F])/g},{base:"h",letters:/(&#104;|&#9431;|&#65352;|&#293;|&#7715;|&#7719;|&#543;|&#7717;|&#7721;|&#7723;|&#7830;|&#295;|&#11368;|&#11382;|&#613;|[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265])/g},{base:"hv",letters:/(&#405;|[\u0195])/g},{base:"i",letters:/(&#105;|&#9432;|&#65353;|&#236;|&#237;|&#238;|&#297;|&#299;|&#301;|&#239;|&#7727;|&#7881;|&#464;|&#521;|&#523;|&#7883;|&#303;|&#7725;|&#616;|&#305;|[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131])/g},{base:"ij",letters:/(&#307;|[\u0133])/g},{base:"j",letters:/(&#106;|&#9433;|&#65354;|&#309;|&#496;|&#585;|[\u006A\u24D9\uFF4A\u0135\u01F0\u0249])/g},{base:"k",letters:/(&#107;|&#9434;|&#65355;|&#7729;|&#489;|&#7731;|&#311;|&#7733;|&#409;|&#11370;|&#42817;|&#42819;|&#42821;|&#42915;|[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3])/g},{base:"l",letters:/(&#108;|&#9435;|&#65356;|&#320;|&#314;|&#318;|&#7735;|&#7737;|&#316;|&#7741;|&#7739;|&#322;|&#410;|&#619;|&#11361;|&#42825;|&#42881;|&#42823;|[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u0142\u019A\u026B\u2C61\uA749\uA781\uA747])/g},{base:"lj",letters:/(&#457;|[\u01C9])/g},{base:"m",letters:/(&#109;|&#9436;|&#65357;|&#7743;|&#7745;|&#7747;|&#625;|&#623;|[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F])/g},{base:"n",letters:/(&#110;|&#9437;|&#65358;|&#505;|&#324;|&#241;|&#7749;|&#328;|&#7751;|&#326;|&#7755;|&#7753;|&#414;|&#626;|&#329;|&#42897;|&#42917;|&#331;|[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5\u014B])/g},{base:"nj",letters:/(&#460;|[\u01CC])/g},{base:"o",letters:/(&#111;|&#9438;|&#65359;|&#242;|&#243;|&#244;|&#7891;|&#7889;|&#7895;|&#7893;|&#245;|&#7757;|&#557;|&#7759;|&#333;|&#7761;|&#7763;|&#335;|&#559;|&#561;|&#246;|&#555;|&#7887;|&#337;|&#466;|&#525;|&#527;|&#417;|&#7901;|&#7899;|&#7905;|&#7903;|&#7907;|&#7885;|&#7897;|&#491;|&#493;|&#248;|&#511;|&#596;|&#42827;|&#42829;|&#629;|[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275])/g},{base:"oe",letters:/(&#339;|[\u0153])/g},{base:"oi",letters:/(&#419;|[\u01A3])/g},{base:"ou",letters:/(&#547;|[\u0223])/g},{base:"oo",letters:/(&#42831;|[\uA74F])/g},{base:"p",letters:/(&#112;|&#9439;|&#65360;|&#7765;|&#7767;|&#421;|&#7549;|&#42833;|&#42835;|&#42837;|[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755])/g},{base:"q",letters:/(&#113;|&#9440;|&#65361;|&#587;|&#42839;|&#42841;|[\u0071\u24E0\uFF51\u024B\uA757\uA759])/g},{base:"r",letters:/(&#114;|&#9441;|&#65362;|&#341;|&#7769;|&#345;|&#529;|&#531;|&#7771;|&#7773;|&#343;|&#7775;|&#589;|&#637;|&#42843;|&#42919;|&#42883;|[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783])/g},{base:"s",letters:/(&#115;|&#9442;|&#65363;|&#347;|&#7781;|&#349;|&#7777;|&#353;|&#7783;|&#7779;|&#7785;|&#537;|&#351;|&#575;|&#42921;|&#42885;|&#7835;|&#383;|[\u0073\u24E2\uFF53\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B\u017F])/g},{base:"ss",letters:/(&#223;|[\u00DF])/g},{base:"t",letters:/(&#116;|&#9443;|&#65364;|&#7787;|&#7831;|&#357;|&#7789;|&#539;|&#355;|&#7793;|&#7791;|&#359;|&#429;|&#648;|&#11366;|&#42887;|[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787])/g},{base:"th",letters:/(&#254;|[\u00FE])/g},{base:"tz",letters:/(&#42793;|[\uA729])/g},{base:"u",letters:/(&#117;|&#9444;|&#65365;|&#249;|&#250;|&#251;|&#361;|&#7801;|&#363;|&#7803;|&#365;|&#252;|&#476;|&#472;|&#470;|&#474;|&#7911;|&#367;|&#369;|&#468;|&#533;|&#535;|&#432;|&#7915;|&#7913;|&#7919;|&#7917;|&#7921;|&#7909;|&#7795;|&#371;|&#7799;|&#7797;|&#649;|[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289])/g},{base:"v",letters:/(&#118;|&#9445;|&#65366;|&#7805;|&#7807;|&#651;|&#42847;|&#652;|[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C])/g},{base:"vy",letters:/(&#42849;|[\uA761])/g},{base:"w",letters:/(&#119;|&#9446;|&#65367;|&#7809;|&#7811;|&#373;|&#7815;|&#7813;|&#7832;|&#7817;|&#11379;|[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73])/g},{base:"x",letters:/(&#120;|&#9447;|&#65368;|&#7819;|&#7821;|[\u0078\u24E7\uFF58\u1E8B\u1E8D])/g},{base:"y",letters:/(&#121;|&#9448;|&#65369;|&#7923;|&#253;|&#375;|&#7929;|&#563;|&#7823;|&#255;|&#7927;|&#7833;|&#7925;|&#436;|&#591;|&#7935;|[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF])/g},{base:"z",letters:/(&#122;|&#9449;|&#65370;|&#378;|&#7825;|&#380;|&#382;|&#7827;|&#7829;|&#438;|&#549;|&#576;|&#11372;|&#42851;|[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763])/g}],RD=function(t){var r=t;return MD.forEach(function(i){r=r.replace(i.letters,i.base)}),r},gS=function(t){return RD(t).toLowerCase()},AN=function(t,r,i){return i?gS(t).indexOf(gS(r)):t.toLowerCase().indexOf(r.toLowerCase())},kD=function(){return!!document.documentMode},Zp=function(t){return typeof t=="number"},DD=function(t){return t===Object(t)?Object.keys(t):[]},ID=function(t){for(var r,i=arguments.length,l=new Array(i>1?i-1:0),c=1;c<i;c++)l[c-1]=arguments[c];var f=(r=[]).concat.apply(r,l);return Object.keys(t).reduce(function(m,h){return t.hasOwnProperty(h)&&!f.includes(h)&&t[h]!==void 0&&(m[h]=t[h]),m},{})},LD=["style","className","classNames"];function bS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function vS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?bS(Object(r),!0).forEach(function(i){on(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function yf(e,t){var r=function(l){var c=function(h){var p=h.style,y=h.className,g=h.classNames,v=sD(h,LD),S=t?t(v):void 0,w=tg(e,{style:p,className:y,classNames:g},S);return De.createElement(l,ls({},v,{style:w}))},f=l.displayName||l.name||"Component";return c.displayName="defaultStyle(".concat(f,")"),De.forwardRef(function(m,h){return c(vS(vS({},m),{},{ref:h}))})};return r}var OD=function(t,r){return t.hasOwnProperty(r)?t[r]++:t[r]=0,r+"_"+t[r]};function TN(e){var t=e.selectionStart,r=e.selectionEnd,i=e.value,l=i===void 0?"":i,c=e.onCaretPositionChange,f=e.containerRef,m=e.children;e.singleLine;var h=e.style,p=u.useState({left:void 0,top:void 0}),y=Id(p,2),g=y[0],v=y[1],S=u.useState(),w=Id(S,2),N=w[0],j=w[1];u.useEffect(function(){_()});var _=function(){if(N){var I=N.offsetLeft,F=N.offsetTop;if(!(g.left===I&&g.top===F)){var D={left:I,top:F};v(D),c(D)}}},C=Or(m),O;r===t&&(O=Sa(l,C,t,"START"));var E=[],T={},M=E,A=0,z=function(I,F,D){if(Zp(O)&&O>=F&&O<=F+I.length){var L=O-F;M.push(X(I.substring(0,L),A)),M=[X(I.substring(L),A)]}else M.push(X(I,A));A++},P=function(I,F,D,L,U,k,B){var R=OD(T,L);M.push(H(L,U,k,R))},X=function(I,F){return De.createElement("span",ls({},h("substring"),{key:F}),I)},H=function(I,F,D,L){var U={id:I,display:F,key:L},k=u.Children.toArray(m)[D];return De.cloneElement(k,U)},Y=function(I){return De.createElement("span",ls({},h("caret"),{ref:j,key:"caret"}),I)};return _c(l,C,P,z),M.push(" "),M!==E&&E.push(Y(M)),De.createElement("div",ls({},h,{ref:f}),E)}TN.propTypes={selectionStart:wt.number,selectionEnd:wt.number,value:wt.string.isRequired,onCaretPositionChange:wt.func.isRequired,containerRef:wt.oneOfType([wt.func,wt.shape({current:typeof Element>"u"?wt.any:wt.instanceOf(Element)})]),children:wt.oneOfType([wt.element,wt.arrayOf(wt.element)]).isRequired};var zD=yf({position:"relative",boxSizing:"border-box",width:"100%",color:"transparent",overflow:"hidden",whiteSpace:"pre-wrap",wordWrap:"break-word",border:"1px solid transparent",textAlign:"start","&singleLine":{whiteSpace:"pre",wordWrap:null},substring:{visibility:"hidden"}},function(e){return{"&singleLine":e.singleLine}}),$D=zD(TN);function MN(e){var t=e.id,r=e.focused,i=e.ignoreAccents,l=e.index,c=e.onClick,f=e.onMouseEnter,m=e.query,h=e.renderSuggestion,p=e.suggestion,y=e.style;e.className,e.classNames;var g={onClick:c,onMouseEnter:f},v=function(){var j=S(),_=w(j);return h?h(p,m,_,l,r):_},S=function(){if(typeof p=="string")return p;var j=p.id,_=p.display;return j===void 0||!_?j:_},w=function(j){var _=AN(j,m,i);return _===-1?De.createElement("span",y("display"),j):De.createElement("span",y("display"),j.substring(0,_),De.createElement("b",y("highlight"),j.substring(_,_+m.length)),j.substring(_+m.length))};return De.createElement("li",ls({id:t,role:"option","aria-selected":r},g,y),v())}MN.propTypes={id:wt.string.isRequired,query:wt.string.isRequired,index:wt.number.isRequired,ignoreAccents:wt.bool,suggestion:wt.oneOfType([wt.string,wt.shape({id:wt.oneOfType([wt.string,wt.number]).isRequired,display:wt.string})]).isRequired,renderSuggestion:wt.func,focused:wt.bool};var FD=yf({cursor:"pointer"},function(e){return{"&focused":e.focused}}),UD=FD(MN);function BD(e){var t=e.style,r=e.className,i=e.classNames,l=tg(qD,{style:t,className:r,classNames:i}),c=l("spinner");return De.createElement("div",l,De.createElement("div",c,De.createElement("div",c(["element","element1"])),De.createElement("div",c(["element","element2"])),De.createElement("div",c(["element","element3"])),De.createElement("div",c(["element","element4"])),De.createElement("div",c(["element","element5"]))))}var qD={};function RN(e){var t=e.id,r=e.suggestions,i=r===void 0?{}:r,l=e.a11ySuggestionsListLabel,c=e.focusIndex,f=e.position,m=e.left,h=e.right,p=e.top,y=e.scrollFocusedIntoView,g=e.isLoading,v=e.isOpened,S=e.onSelect,w=S===void 0?function(){return null}:S,N=e.ignoreAccents,j=e.containerRef,_=e.children,C=e.style,O=e.customSuggestionsContainer,E=e.onMouseDown,T=e.onMouseEnter,M=u.useState(void 0),A=Id(M,2),z=A[0],P=A[1];u.useEffect(function(){if(!(!z||z.offsetHeight>=z.scrollHeight||!y)){var D=z.scrollTop,L=z.children[c].getBoundingClientRect(),U=L.top,k=L.bottom,B=z.getBoundingClientRect(),R=B.top;U=U-R+D,k=k-R+D,U<D?z.scrollTop=U:k>z.offsetHeight&&(z.scrollTop=k-z.offsetHeight)}},[c,y,z]);var X=function(){var L=De.createElement("ul",ls({ref:P,id:t,role:"listbox","aria-label":l},C("list")),Object.values(i).reduce(function(U,k){var B=k.results,R=k.queryInfo;return[].concat(kd(U),kd(B.map(function(q,G){return H(q,R,U.length+G)})))},[]));return O?O(L):L},H=function(L,U,k){var B=k===c,R=U.childIndex,q=U.query,G=u.Children.toArray(_)[R].props.renderSuggestion;return De.createElement(UD,{style:C("item"),key:"".concat(R,"-").concat(F(L)),id:CN(t,k),query:q,index:k,ignoreAccents:N,renderSuggestion:G,suggestion:L,focused:B,onClick:function(){return I(L,U)},onMouseEnter:function(){return V(k)}})},Y=function(){if(g)return De.createElement(BD,{style:C("loadingIndicator")})},V=function(L,U){T&&T(L)},I=function(L,U){w(L,U)},F=function(L){return typeof L=="string"?L:L.id};return v?De.createElement("div",ls({},wD({position:f||"absolute",left:m,right:h,top:p},C),{onMouseDown:E,ref:j}),X(),Y()):null}RN.propTypes={id:wt.string.isRequired,suggestions:wt.object.isRequired,a11ySuggestionsListLabel:wt.string,focusIndex:wt.number,position:wt.string,left:wt.number,right:wt.number,top:wt.number,scrollFocusedIntoView:wt.bool,isLoading:wt.bool,isOpened:wt.bool.isRequired,onSelect:wt.func,ignoreAccents:wt.bool,customSuggestionsContainer:wt.func,containerRef:wt.oneOfType([wt.func,wt.shape({current:typeof Element>"u"?wt.any:wt.instanceOf(Element)})])};var HD=yf({zIndex:1,backgroundColor:"white",marginTop:14,minWidth:100,list:{margin:0,padding:0,listStyleType:"none"}}),PD=HD(RN);function xS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function fs(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xS(Object(r),!0).forEach(function(i){on(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function VD(e){var t=YD();return function(){var i=Dd(e),l;if(t){var c=Dd(this).constructor;l=Reflect.construct(i,arguments,c)}else l=i.apply(this,arguments);return Z4(this,l)}}function YD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var GD=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t instanceof RegExp)return t;var i=r.allowSpaceInQuery,l=xd(t);return new RegExp("(?:^|\\s)(".concat(l,"([^").concat(i?"":"\\s").concat(l,"]*))$"))},XD=function(t,r){return t instanceof Array?function(i,l){for(var c=[],f=0,m=t.length;f<m;++f){var h=t[f].display||t[f].id;AN(h,i,r)>=0&&c.push(t[f])}return c}:t},gl={TAB:9,RETURN:13,ESC:27,UP:38,DOWN:40},Xu=!1,kN={singleLine:wt.bool,allowSpaceInQuery:wt.bool,allowSuggestionsAboveCursor:wt.bool,forceSuggestionsAboveCursor:wt.bool,ignoreAccents:wt.bool,a11ySuggestionsListLabel:wt.string,value:wt.string,onKeyDown:wt.func,customSuggestionsContainer:wt.func,onSelect:wt.func,onBlur:wt.func,onChange:wt.func,suggestionsPortalHost:typeof Element>"u"?wt.any:wt.PropTypes.instanceOf(Element),inputRef:wt.oneOfType([wt.func,wt.shape({current:typeof Element>"u"?wt.any:wt.instanceOf(Element)})]),children:wt.oneOfType([wt.element,wt.arrayOf(wt.element)]).isRequired},ng=(function(e){W4(r,e);var t=VD(r);function r(i){var l;return G4(this,r),l=t.call(this,i),on(un(l),"setContainerElement",function(c){l.containerElement=c}),on(un(l),"getInputProps",function(){var c=l.props,f=c.readOnly,m=c.disabled,h=c.style,p=ID(l.props,["style","classNames","className"],DD(kN));return fs(fs(fs(fs({},p),h("input")),{},{value:l.getPlainText(),onScroll:l.updateHighlighterScroll},!f&&!m&&{onChange:l.handleChange,onSelect:l.handleSelect,onKeyDown:l.handleKeyDown,onBlur:l.handleBlur,onCompositionStart:l.handleCompositionStart,onCompositionEnd:l.handleCompositionEnd}),l.isOpened()&&{role:"combobox","aria-controls":l.uuidSuggestionsOverlay,"aria-expanded":!0,"aria-autocomplete":"list","aria-haspopup":"listbox","aria-activedescendant":CN(l.uuidSuggestionsOverlay,l.state.focusIndex)})}),on(un(l),"renderControl",function(){var c=l.props,f=c.singleLine,m=c.style,h=l.getInputProps();return De.createElement("div",m("control"),l.renderHighlighter(),f?l.renderInput(h):l.renderTextarea(h))}),on(un(l),"renderInput",function(c){return De.createElement("input",ls({type:"text",ref:l.setInputRef},c))}),on(un(l),"renderTextarea",function(c){return De.createElement("textarea",ls({ref:l.setInputRef},c))}),on(un(l),"setInputRef",function(c){l.inputElement=c;var f=l.props.inputRef;typeof f=="function"?f(c):f&&(f.current=c)}),on(un(l),"setSuggestionsElement",function(c){l.suggestionsElement=c}),on(un(l),"renderSuggestionsOverlay",function(){if(!Zp(l.state.selectionStart))return null;var c=l.state.suggestionsPosition,f=c.position,m=c.left,h=c.top,p=c.right,y=De.createElement(PD,{id:l.uuidSuggestionsOverlay,style:l.props.style("suggestions"),position:f,left:m,top:h,right:p,focusIndex:l.state.focusIndex,scrollFocusedIntoView:l.state.scrollFocusedIntoView,containerRef:l.setSuggestionsElement,suggestions:l.state.suggestions,customSuggestionsContainer:l.props.customSuggestionsContainer,onSelect:l.addMention,onMouseDown:l.handleSuggestionsMouseDown,onMouseEnter:l.handleSuggestionsMouseEnter,isLoading:l.isLoading(),isOpened:l.isOpened(),ignoreAccents:l.props.ignoreAccents,a11ySuggestionsListLabel:l.props.a11ySuggestionsListLabel},l.props.children);return l.props.suggestionsPortalHost?p1.createPortal(y,l.props.suggestionsPortalHost):y}),on(un(l),"renderHighlighter",function(){var c=l.state,f=c.selectionStart,m=c.selectionEnd,h=l.props,p=h.singleLine,y=h.children,g=h.value,v=h.style;return De.createElement($D,{containerRef:l.setHighlighterElement,style:v("highlighter"),value:g,singleLine:p,selectionStart:f,selectionEnd:m,onCaretPositionChange:l.handleCaretPositionChange},y)}),on(un(l),"setHighlighterElement",function(c){l.highlighterElement=c}),on(un(l),"handleCaretPositionChange",function(c){l.setState({caretPosition:c})}),on(un(l),"getPlainText",function(){return Ni(l.props.value||"",Or(l.props.children))}),on(un(l),"executeOnChange",function(c){for(var f=arguments.length,m=new Array(f>1?f-1:0),h=1;h<f;h++)m[h-1]=arguments[h];if(l.props.onChange){var p;return(p=l.props).onChange.apply(p,[c].concat(m))}if(l.props.valueLink){var y;return(y=l.props.valueLink).requestChange.apply(y,[c.target.value].concat(m))}}),on(un(l),"handleChange",function(c){if(Xu=!1,kD()){var f=document.activeElement&&document.activeElement.contentDocument||document;if(f.activeElement!==c.target)return}var m=l.props.value||"",h=Or(l.props.children),p=c.target.value,y=l.state.selectionStart;y==null&&(y=c.target.selectionStart);var g=l.state.selectionEnd;g==null&&(g=c.target.selectionEnd);var v=jD(m,p,{selectionStartBefore:y,selectionEndBefore:g,selectionEndAfter:c.target.selectionEnd},h);p=Ni(v,h);var S=c.target.selectionStart,w=c.target.selectionEnd,N=!1,j=yS(m,h,S);j!==void 0&&l.state.selectionEnd>j&&(S=j+(c.nativeEvent.data?c.nativeEvent.data.length:0),w=S,N=!0),l.setState({selectionStart:S,selectionEnd:w,setSelectionAfterMentionChange:N});var _=Ko(v,h);c.nativeEvent.isComposing&&S===w&&l.updateMentionsQueries(l.inputElement.value,S);var C={target:{value:v}};l.executeOnChange(C,v,p,_)}),on(un(l),"handleSelect",function(c){if(l.setState({selectionStart:c.target.selectionStart,selectionEnd:c.target.selectionEnd}),!Xu){var f=l.inputElement;c.target.selectionStart===c.target.selectionEnd?l.updateMentionsQueries(f.value,c.target.selectionStart):l.clearSuggestions(),l.updateHighlighterScroll(),l.props.onSelect(c)}}),on(un(l),"handleKeyDown",function(c){var f=Gu(l.state.suggestions);if(f===0||!l.suggestionsElement){l.props.onKeyDown(c);return}switch(Object.values(gl).indexOf(c.keyCode)>=0&&(c.preventDefault(),c.stopPropagation()),c.keyCode){case gl.ESC:{l.clearSuggestions();return}case gl.DOWN:{l.shiftFocus(1);return}case gl.UP:{l.shiftFocus(-1);return}case gl.RETURN:{l.selectFocused();return}case gl.TAB:{l.selectFocused();return}default:return}}),on(un(l),"shiftFocus",function(c){var f=Gu(l.state.suggestions);l.setState({focusIndex:(f+l.state.focusIndex+c)%f,scrollFocusedIntoView:!0})}),on(un(l),"selectFocused",function(){var c=l.state,f=c.suggestions,m=c.focusIndex,h=Object.values(f).reduce(function(g,v){var S=v.results,w=v.queryInfo;return[].concat(kd(g),kd(S.map(function(N){return{result:N,queryInfo:w}})))},[])[m],p=h.result,y=h.queryInfo;l.addMention(p,y),l.setState({focusIndex:0})}),on(un(l),"handleBlur",function(c){var f=l._suggestionsMouseDown;l._suggestionsMouseDown=!1,f||l.setState({selectionStart:null,selectionEnd:null}),window.setTimeout(function(){l.updateHighlighterScroll()},1),l.props.onBlur(c,f)}),on(un(l),"handleSuggestionsMouseDown",function(c){l._suggestionsMouseDown=!0}),on(un(l),"handleSuggestionsMouseEnter",function(c){l.setState({focusIndex:c,scrollFocusedIntoView:!1})}),on(un(l),"updateSuggestionsPosition",function(){var c=l.state.caretPosition,f=l.props,m=f.suggestionsPortalHost,h=f.allowSuggestionsAboveCursor,p=f.forceSuggestionsAboveCursor;if(!(!c||!l.suggestionsElement)){var y=l.suggestionsElement,g=l.highlighterElement,v=g.getBoundingClientRect(),S=lp(g,"font-size"),w={left:v.left+c.left,top:v.top+c.top+S},N=Math.max(document.documentElement.clientHeight,window.innerHeight||0);if(y){var j={};if(m){j.position="fixed";var _=w.left,C=w.top;_-=lp(y,"margin-left"),C-=lp(y,"margin-top"),_-=g.scrollLeft,C-=g.scrollTop;var O=Math.max(document.documentElement.clientWidth,window.innerWidth||0);_+y.offsetWidth>O?j.left=Math.max(0,O-y.offsetWidth):j.left=_,h&&C+y.offsetHeight>N&&y.offsetHeight<C-S||p?j.top=Math.max(0,C-y.offsetHeight-S):j.top=C}else{var E=c.left-g.scrollLeft,T=c.top-g.scrollTop;E+y.offsetWidth>l.containerElement.offsetWidth?j.right=0:j.left=E,h&&w.top-g.scrollTop+y.offsetHeight>N&&y.offsetHeight<v.top-S-g.scrollTop||p?j.top=T-y.offsetHeight-S:j.top=T}j.left===l.state.suggestionsPosition.left&&j.top===l.state.suggestionsPosition.top&&j.position===l.state.suggestionsPosition.position||l.setState({suggestionsPosition:j})}}}),on(un(l),"updateHighlighterScroll",function(){var c=l.inputElement,f=l.highlighterElement;!c||!f||(f.scrollLeft=c.scrollLeft,f.scrollTop=c.scrollTop,f.height=c.height)}),on(un(l),"handleCompositionStart",function(){Xu=!0}),on(un(l),"handleCompositionEnd",function(){Xu=!1}),on(un(l),"setSelection",function(c,f){if(!(c===null||f===null)){var m=l.inputElement;if(m.setSelectionRange)m.setSelectionRange(c,f);else if(m.createTextRange){var h=m.createTextRange();h.collapse(!0),h.moveEnd("character",f),h.moveStart("character",c),h.select()}}}),on(un(l),"updateMentionsQueries",function(c,f){l._queryId++,l.suggestions={},l.setState({suggestions:{}});var m=l.props.value||"",h=l.props.children,p=Or(h),y=Sa(m,p,f,"NULL");if(y!==null){var g=_D(m.substring(0,y),p),v=c.substring(g,f);De.Children.forEach(h,function(S,w){if(S){var N=GD(S.props.trigger,l.props),j=v.match(N);if(j){var _=g+v.indexOf(j[1],j.index);l.queryData(j[2],w,_,_+j[1].length,c)}}})}}),on(un(l),"clearSuggestions",function(){l._queryId++,l.suggestions={},l.setState({suggestions:{},focusIndex:0})}),on(un(l),"queryData",function(c,f,m,h,p){var y=l.props,g=y.children,v=y.ignoreAccents,S=u.Children.toArray(g)[f],w=XD(S.props.data,v),N=w(c,l.updateSuggestions.bind(null,l._queryId,f,c,m,h,p));N instanceof Array&&l.updateSuggestions(l._queryId,f,c,m,h,p,N)}),on(un(l),"updateSuggestions",function(c,f,m,h,p,y,g){if(c===l._queryId){l.suggestions=fs(fs({},l.suggestions),{},on({},f,{queryInfo:{childIndex:f,query:m,querySequenceStart:h,querySequenceEnd:p,plainTextValue:y},results:g}));var v=l.state.focusIndex,S=Gu(l.suggestions);l.setState({suggestions:l.suggestions,focusIndex:v>=S?Math.max(S-1,0):v})}}),on(un(l),"addMention",function(c,f){var m=c.id,h=c.display,p=f.childIndex,y=f.querySequenceStart,g=f.querySequenceEnd,v=f.plainTextValue,S=l.props.value||"",w=Or(l.props.children),N=u.Children.toArray(l.props.children)[p],j=N.props,_=j.markup,C=j.displayTransform,O=j.appendSpaceOnAdd,E=j.onAdd,T=Sa(S,w,y,"START"),M=T+g-y,A=TD(_,m,h);O&&(A+=" ");var z=tc(S,T,M,A);l.inputElement.focus();var P=C(m,h);O&&(P+=" ");var X=y+P.length;l.setState({selectionStart:X,selectionEnd:X,setSelectionAfterMentionChange:!0});var H={target:{value:z}},Y=Ko(z,w),V=tc(v,y,g,P);l.executeOnChange(H,z,V,Y),E&&E(m,h,T,M),l.clearSuggestions()}),on(un(l),"isLoading",function(){var c=!1;return De.Children.forEach(l.props.children,function(f){c=c||f&&f.props.isLoading}),c}),on(un(l),"isOpened",function(){return Zp(l.state.selectionStart)&&(Gu(l.state.suggestions)!==0||l.isLoading())}),on(un(l),"_queryId",0),l.suggestions={},l.uuidSuggestionsOverlay=Math.random().toString(16).substring(2),l.handleCopy=l.handleCopy.bind(un(l)),l.handleCut=l.handleCut.bind(un(l)),l.handlePaste=l.handlePaste.bind(un(l)),l.state={focusIndex:0,selectionStart:null,selectionEnd:null,suggestions:{},caretPosition:null,suggestionsPosition:{},setSelectionAfterHandlePaste:!1},l}return K4(r,[{key:"componentDidMount",value:function(){document.addEventListener("copy",this.handleCopy),document.addEventListener("cut",this.handleCut),document.addEventListener("paste",this.handlePaste),this.updateSuggestionsPosition()}},{key:"componentDidUpdate",value:function(l,c){c.suggestionsPosition===this.state.suggestionsPosition&&this.updateSuggestionsPosition(),this.state.setSelectionAfterMentionChange&&(this.setState({setSelectionAfterMentionChange:!1}),this.setSelection(this.state.selectionStart,this.state.selectionEnd)),this.state.setSelectionAfterHandlePaste&&(this.setState({setSelectionAfterHandlePaste:!1}),this.setSelection(this.state.selectionStart,this.state.selectionEnd))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("copy",this.handleCopy),document.removeEventListener("cut",this.handleCut),document.removeEventListener("paste",this.handlePaste)}},{key:"render",value:function(){return De.createElement("div",ls({ref:this.setContainerElement},this.props.style),this.renderControl(),this.renderSuggestionsOverlay())}},{key:"handlePaste",value:function(l){if(l.target===this.inputElement&&this.supportsClipboardActions(l)){l.preventDefault();var c=this.state,f=c.selectionStart,m=c.selectionEnd,h=this.props,p=h.value,y=h.children,g=Or(y),v=Sa(p,g,f,"START"),S=Sa(p,g,m,"END"),w=l.clipboardData.getData("text/react-mentions"),N=l.clipboardData.getData("text/plain"),j=tc(p,v,S,w||N).replace(/\r/g,""),_=Ni(j,g),C={target:fs(fs({},l.target),{},{value:j})};this.executeOnChange(C,j,_,Ko(j,g));var O=yS(p,g,f),E=(O||f)+Ni(w||N,g).length;this.setState({selectionStart:E,selectionEnd:E,setSelectionAfterHandlePaste:!0})}}},{key:"saveSelectionToClipboard",value:function(l){var c=this.inputElement.selectionStart,f=this.inputElement.selectionEnd,m=this.props,h=m.children,p=m.value,y=Or(h),g=Sa(p,y,c,"START"),v=Sa(p,y,f,"END");l.clipboardData.setData("text/plain",l.target.value.slice(c,f)),l.clipboardData.setData("text/react-mentions",p.slice(g,v))}},{key:"supportsClipboardActions",value:function(l){return!!l.clipboardData}},{key:"handleCopy",value:function(l){l.target===this.inputElement&&this.supportsClipboardActions(l)&&(l.preventDefault(),this.saveSelectionToClipboard(l))}},{key:"handleCut",value:function(l){if(l.target===this.inputElement&&this.supportsClipboardActions(l)){l.preventDefault(),this.saveSelectionToClipboard(l);var c=this.state,f=c.selectionStart,m=c.selectionEnd,h=this.props,p=h.children,y=h.value,g=Or(p),v=Sa(y,g,f,"START"),S=Sa(y,g,m,"END"),w=[y.slice(0,v),y.slice(S)].join(""),N=Ni(w,g),j={target:fs(fs({},l.target),{},{value:N})};this.executeOnChange(j,w,N,Ko(y,g))}}}]),r})(De.Component);on(ng,"propTypes",kN);on(ng,"defaultProps",{ignoreAccents:!1,singleLine:!1,allowSuggestionsAboveCursor:!1,onKeyDown:function(){return null},onSelect:function(){return null},onBlur:function(){return null}});var lp=function(t,r){var i=parseFloat(window.getComputedStyle(t,null).getPropertyValue(r));return isFinite(i)?i:0},KD=typeof navigator<"u"&&/iPhone|iPad|iPod/i.test(navigator.userAgent),WD=yf({position:"relative",overflowY:"visible",input:{display:"block",width:"100%",position:"absolute",margin:0,top:0,left:0,boxSizing:"border-box",backgroundColor:"transparent",fontFamily:"inherit",fontSize:"inherit",letterSpacing:"inherit"},"&multiLine":{input:fs({height:"100%",bottom:0,overflow:"hidden",resize:"none"},KD?{marginTop:1,marginLeft:-3}:null)}},function(e){var t=e.singleLine;return{"&singleLine":t,"&multiLine":!t}}),ZD=WD(ng),QD={fontWeight:"inherit"},Rl=function(t){var r=t.display,i=t.style,l=t.className,c=t.classNames,f=tg(QD,{style:i,className:l,classNames:c});return De.createElement("strong",f,r)};Rl.propTypes={onAdd:wt.func,onRemove:wt.func,renderSuggestion:wt.func,trigger:wt.oneOfType([wt.string,wt.instanceOf(RegExp)]),markup:wt.string,displayTransform:wt.func,allowSpaceInQuery:wt.bool,isLoading:wt.bool};Rl.defaultProps={trigger:"@",markup:"@[__display__](__id__)",displayTransform:function(t,r){return r||t},onAdd:function(){return null},onRemove:function(){return null},renderSuggestion:null,isLoading:!1,appendSpaceOnAdd:!1};function Ld({inputProps:e,...t}){const r=u.useRef(null);return u.useEffect(()=>{if(!r.current||!e)return;const i=()=>{const l=r.current?.querySelector("textarea");return l?(Object.entries(e).forEach(([c,f])=>{if(f!=null)if(c==="className"){const m=l.className||"";l.className=m?`${m} ${f}`.trim():f}else if(c.startsWith("data-")||c.startsWith("aria-"))l.setAttribute(c,String(f));else if(c==="rows")l.setAttribute("rows",String(f));else if(c==="required")l.required=!!f;else if(c==="id")l.id=String(f);else try{typeof f=="boolean"?f?l.setAttribute(c,""):l.removeAttribute(c):l[c]=f}catch{try{l.setAttribute(c,String(f))}catch{}}}),!0):!1};if(!i()){const l=setTimeout(()=>{i()},10);return()=>clearTimeout(l)}},[e]),a.jsx("div",{ref:r,children:a.jsx(ZD,{...t})})}const JD=/\s*\(([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\)$/i,eI=/\(([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\)/gi,kl=e=>{if(!e)return"";let t=String(e).trim();return t=t.replace(JD,"").trim(),t=t.replace(eI,"").trim(),t},fc=(e="",t=[])=>{const r=typeof e=="string"?e:"";if(!r)return[];const i=Array.isArray(t)?t:[],l=new Map;i.forEach(p=>{if(!p)return;const y=p.entityId??p.entity_id??p.id??p.entityID??null;if(!y)return;const g=String(y);if(l.has(g))return;const v=p.entityName??p.entity_name??p.label??p.name,S=v?kl(v):"";l.set(g,{entityId:g,entityName:S})});const c=[],f=/@\[(.+?)]\(([^)]+)\)/g;let m=0,h;for(;(h=f.exec(r))!==null;){h.index>m&&c.push({type:"text",text:r.slice(m,h.index)});const p=String(h[2]),y=h[1],g=kl(y)||String(y??""),v=l.get(p)||{entityId:p,entityName:g};c.push({type:"mention",...v}),m=f.lastIndex}return m<r.length&&c.push({type:"text",text:r.slice(m)}),c},tI={private:"Private",companions:"Shared with companions",dm:"Shared with DM",party:"Share with Party"},nI=[{value:"private",label:"Private"},{value:"companions",label:"My Companions"}],aI=[{value:"private",label:"Private"},{value:"party",label:"Share with Party"}],op=e=>{if(!e)return"";if(e instanceof Date){if(Number.isNaN(e.getTime()))return"";try{return e.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.warn("Unable to format Date object",t,e),""}}if(typeof e=="string"||typeof e=="number")try{const t=new Date(e);return Number.isNaN(t.getTime())?(console.warn("Invalid date value:",e),""):t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.warn("Unable to parse date value",t,e),""}return console.warn("Unexpected date value type:",typeof e,e),""},cp=e=>e?.author?.username||e?.author?.name||e?.author?.email||e?.author_name||e?.author_email||"Unknown adventurer",SS=e=>{const t=e?.author||{},r=t?.id??t?.authorId??e?.authorId??e?.author_id??e?.authorID;if(r!=null)return`id:${String(r)}`;const i=t?.email??e?.author_email;if(i)return`email:${String(i).toLowerCase()}`;const l=t?.username??t?.name??e?.author_username??e?.author_name;return l?`name:${String(l).toLowerCase()}`:"unknown"},va=Object.freeze([]),wS="What do you want to remember?";function DN({entity:e,worldId:t,selectedCampaign:r,selectedCampaignId:i,isCampaignDm:l,isCampaignPlayer:c,canCreateNote:f,notes:m=va,loading:h,error:p,onCreateNote:y,creating:g,campaignMatchesEntityWorld:v,onNoteUpdate:S,onNoteDelete:w}){const{user:N}=En(),[j,_]=u.useState(""),[C,O]=u.useState("private"),[E,T]=u.useState(""),[M,A]=u.useState(va),[z,P]=u.useState(!1),[X,H]=u.useState(""),[Y,V]=u.useState(""),[I,F]=u.useState(""),[D,L]=u.useState(!1),[U,k]=u.useState("all"),[B,R]=u.useState("notes"),[q,G]=u.useState("entity"),[J,ie]=u.useState(null),[Z,me]=u.useState(""),[Q,oe]=u.useState("private"),[ne,we]=u.useState(""),[ke,Re]=u.useState(!1),[Te,rt]=u.useState(null),[He,tt]=u.useState({items:va,loading:!1,error:"",loaded:!1}),[Ie,vt]=u.useState({items:va,loading:!1,error:"",loaded:!1}),[Ct,At]=u.useState(()=>new Set),_t=!!i&&!!f&&!!v,Pe=u.useMemo(()=>l?aI:nI,[l]),Ze=u.useMemo(()=>t||e&&typeof e=="object"&&((e.world||{}).id||e.world_id)||"",[e,t]),W=u.useCallback(ae=>{if(!N||!ae)return!1;const Xe=ae?.author?.id??ae?.createdBy??ae?.created_by??ae?.authorId??ae?.author_id??null;return Xe?String(Xe)===String(N.id):!1},[N]),ee=u.useCallback((ae,Xe)=>{const Fe=typeof Xe=="string"?Xe:typeof ae?.target?.value=="string"?ae.target.value:"";_(Fe),V("")},[]),te=u.useCallback(async(ae,Xe)=>{const Fe=ae?.trim()??"";if(typeof Xe=="function"){if(!Ze||Fe.length===0){Xe([]);return}try{const Qe=await rf({worldId:Ze,query:Fe,limit:8}),bt=Array.isArray(Qe?.data)?Qe.data:Qe,St=Array.isArray(bt)?bt.map(_e=>{const et=_e?.id??_e?.entity?.id;if(!et)return null;const mt=_e?.name||_e?.displayName||_e?.entity?.name||"Unnamed entity",fe=kl(mt)||"Unnamed entity";return{id:et,display:fe}}).filter(Boolean):[];Xe(St)}catch(Qe){console.error("Failed to search entities for mentions",Qe),Xe([])}}},[Ze]),ve=u.useCallback(()=>{L(!1),V(""),F("")},[]),le=u.useCallback(()=>{_t&&(V(""),F(""),L(!0))},[_t]),Se=u.useCallback(async ae=>{if(ae.preventDefault(),!_t||!y)return;const Xe=j.trim();if(!Xe){V("Please enter a note before saving");return}if(c&&!E){V("Select which character this note is for");return}V(""),F("");try{const Fe={content:Xe,shareType:C,campaignId:i};c&&(Fe.characterId=E);const Qe=await y(Fe);if(!Qe||Qe.success!==!0){V(Qe?.message||"Failed to save note");return}_(""),c||T(""),ve()}catch(Fe){console.error("Failed to submit note",Fe),V(Fe.message||"Failed to save note")}},[_t,j,y,C,i,c,E,ve]),Ee=u.useCallback(ae=>{if(!ae||!e?.id)return;const Xe=ae?.characterId??ae?.character_id??"";ie(ae.id),me(ae?.content??""),oe(ae?.shareType??ae?.share_type??"private"),we(Xe),V("")},[e?.id]),ge=u.useCallback(()=>{ie(null),me(""),oe("private"),we(""),V("")},[]),at=u.useCallback((ae,Xe)=>{const Fe=typeof Xe=="string"?Xe:typeof ae?.target?.value=="string"?ae.target.value:"";me(Fe),V("")},[]),st=u.useCallback(async ae=>{if(!ae||!e?.id||!i)return;const Xe=Z.trim();if(!Xe){V("Please enter a note before saving");return}const Fe=ae?.characterId??ae?.character_id??"";if(c&&Fe&&!ne){V("Select which character this note is for");return}Re(!0),V("");try{const Qe={content:Xe,shareType:Q,campaignId:i};c&&ne&&(Qe.characterId=ne);const bt=await q1(e.id,ae.id,Qe),St=bt?.data||bt;if(!St)throw new Error("Note could not be updated");S&&await S(St),ge()}catch(Qe){console.error("Failed to update note",Qe),V(Qe.message||"Failed to update note")}finally{Re(!1)}},[e?.id,i,Z,Q,ne,c,S,ge]),nt=u.useCallback(async ae=>{if(!(!ae?.id||!e?.id||!i||!window.confirm("Are you sure you want to delete this note? This action cannot be undone."))){rt(ae.id),V("");try{await H1(e.id,ae.id,{campaignId:i}),w&&await w(ae.id)}catch(Fe){console.error("Failed to delete note",Fe),V(Fe.message||"Failed to delete note")}finally{rt(null)}}},[e?.id,i,w]),$e=u.useMemo(()=>{const ae=Array.isArray(m)?m:va;return ae.length<=1?ae:[...ae].sort((Xe,Fe)=>{const Qe=new Date(Xe?.createdAt??Xe?.created_at??0).getTime(),bt=new Date(Fe?.createdAt??Fe?.created_at??0).getTime();return Number.isNaN(Qe)||Number.isNaN(bt)?0:bt-Qe})},[m]),ft=u.useMemo(()=>{const ae=[{value:"all",label:"All notes"}],Xe=new Set(["all"]);return $e.forEach(Fe=>{const Qe=SS(Fe);!Qe||Xe.has(Qe)||(Xe.add(Qe),ae.push({value:Qe,label:cp(Fe)}))}),ae},[$e]),zt=u.useMemo(()=>U==="all"?$e:$e.filter(ae=>SS(ae)===U),[U,$e]),Rt=u.useMemo(()=>Array.isArray(He.items)?He.items:va,[He.items]),pt=u.useMemo(()=>Array.isArray(Ie.items)?Ie.items:va,[Ie.items]);u.useEffect(()=>{O("private")},[l,i]),u.useEffect(()=>{ft.some(ae=>ae.value===U)||k("all")},[ft,U]),u.useEffect(()=>{tt({items:va,loading:!1,error:"",loaded:!1}),vt({items:va,loading:!1,error:"",loaded:!1}),At(new Set),G("entity")},[i,e?.id,v]),u.useEffect(()=>{let ae=!1;return!c||!i?(A(va),P(!1),H(""),T(""),()=>{ae=!0}):((async()=>{P(!0),H("");try{const Fe=await Ds({scope:"my",campaign_id:i});if(ae)return;const bt=(Array.isArray(Fe?.data)?Fe.data:Array.isArray(Fe)?Fe:[]).map(St=>({id:St?.id?String(St.id):"",name:St?.name||"Unnamed character"})).filter(St=>St.id);A(bt),bt.length===1?T(bt[0].id):bt.some(St=>St.id===E)||T("")}catch(Fe){if(ae)return;console.error("Failed to load characters for notes",Fe),A(va),T(""),H(Fe.message||"Failed to load characters")}finally{ae||P(!1)}})(),()=>{ae=!0})},[c,i,E]);const ct=u.useCallback(async()=>{if(!(!e?.id||!i||!v)){tt(ae=>({...ae,loading:!0,error:""}));try{const ae=await BR(e.id,{campaignId:i}),Xe=Array.isArray(ae?.data)?ae.data:Array.isArray(ae)?ae:va;tt({items:Xe,loading:!1,error:"",loaded:!0})}catch(ae){tt({items:va,loading:!1,error:ae?.message||"Failed to load mentions",loaded:!0})}}},[v,e?.id,i]),yt=u.useCallback(async()=>{if(!(!e?.id||!i||!v)){vt(ae=>({...ae,loading:!0,error:""}));try{const ae=await qR(e.id,{campaignId:i}),Xe=Array.isArray(ae?.data)?ae.data:Array.isArray(ae)?ae:va;vt({items:Xe,loading:!1,error:"",loaded:!0})}catch(ae){vt({items:va,loading:!1,error:ae?.message||"Failed to load mentions",loaded:!0})}}},[v,e?.id,i]);u.useEffect(()=>{B==="mentions"&&(!He.loading&&!He.loaded&&ct(),!Ie.loading&&!Ie.loaded&&yt())},[B,He.loading,He.loaded,Ie.loading,Ie.loaded,ct,yt]);const Mt=u.useCallback(ae=>{const Xe=fc(ae?.content,ae?.mentions);if(!Xe.length)return"";const Fe=Xe.map(Qe=>Qe.type==="mention"?`@${Qe.entityName||"entity"}`:Qe.text||"").join("").replace(/\s+/g," ").trim();return Fe.length<=180?Fe:`${Fe.slice(0,177)}`},[]),Ft=u.useCallback(ae=>{const Xe=ae?.sessionDate??ae?.session_date;if(!Xe)return"";try{const Fe=new Date(Xe);if(!Number.isNaN(Fe.getTime()))return Fe.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch(Fe){return console.warn("Unable to format session date",Fe),Xe}return Xe},[]),kt=u.useCallback(ae=>{const Xe=String(ae);At(Fe=>{const Qe=new Set(Fe);return Qe.has(Xe)?Qe.delete(Xe):Qe.add(Xe),Qe})},[]),Zt=u.useCallback(ae=>Ct.has(String(ae)),[Ct]),Lt=u.useCallback(()=>{!e?.id||!i||!v||(q==="entity"?ct():yt())},[v,e?.id,ct,yt,q,i]),Kt=u.useCallback(ae=>{const Xe=fc(ae?.content,ae?.mentions);return Xe.length?Xe.map((Fe,Qe)=>{if(Fe.type==="mention"&&Fe.entityId){const bt=`${ae?.id||"note"}-mention-${Qe}`,St=Fe.entityName||"entity";return a.jsxs("span",{className:"entity-note-mention",children:["@",St,a.jsx(Is,{entityId:Fe.entityId,entityName:St})]},bt)}return a.jsx("span",{className:"entity-note-text",children:Fe.text},`${ae?.id||"note"}-text-${Qe}`)}):null},[]);u.useCallback(ae=>`entity-note-share entity-note-share-${ae}`,[]);const se=Rt.length,be=pt.length,je=He.loading,We=Ie.loading,dt=He.error,gt=Ie.error,ce=He.loaded,re=Ie.loaded,Ne=!i||!v||(q==="entity"?je:We),Be=c&&_t,Ke=Be&&M.length===1,ot=g,ze=g||!j.trim()||c&&!E,ue=$e.length===0||ft.length<=1;u.useEffect(()=>{(B!=="notes"||!_t)&&D&&ve()},[B,_t,D,ve]);const qe=r?.name||"",Ge=u.useCallback(ae=>{const Xe=cp(ae),Fe=ae?.character?.name||"";return Fe?`${Xe} (as ${Fe})`:Xe},[]),ut=u.useCallback(ae=>{const Xe=String(ae?.shareType??ae?.share_type??"private");return tI[Xe]||"Private"},[]);return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"entity-notes-card-strict",children:[a.jsxs("div",{className:"entity-notes-header-row",children:[a.jsx("h2",{className:"entity-notes-title",children:"Notes"}),B==="notes"&&_t?a.jsx("button",{type:"button",className:"btn-primary",onClick:le,disabled:g,children:"+ Create note"}):null]}),r?.name?a.jsxs("p",{className:"entity-notes-campaign-line",children:["Campaign: ",qe]}):null,a.jsxs("div",{className:"entity-notes-tabs-row",children:[a.jsx("button",{type:"button",className:`entity-notes-strict-tab-button${B==="notes"?" active":""}`,onClick:()=>R("notes"),children:"Notes"}),a.jsx("button",{type:"button",className:`entity-notes-strict-tab-button${B==="mentions"?" active":""}`,onClick:()=>R("mentions"),children:"@Mentions"})]}),B==="notes"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"entity-notes-strict-filter",children:[a.jsx("span",{className:"entity-notes-strict-filter-label",children:"Show notes from"}),a.jsx("select",{className:"entity-notes-strict-filter-select",value:U,onChange:ae=>k(ae.target.value),disabled:ue,children:ft.map(ae=>a.jsx("option",{value:ae.value,children:ae.label},ae.value))})]}),p?a.jsxs("div",{className:"entity-notes-strict-alert error",children:[a.jsx(Ha,{size:16}),a.jsx("p",{children:p})]}):null,h?a.jsxs("div",{className:"entity-notes-strict-loading",children:[a.jsx(Nn,{className:"spin",size:20}),a.jsx("span",{children:"Loading notes"})]}):null,!h&&zt.length===0?a.jsx("p",{className:"entity-notes-strict-empty",children:"No notes yet."}):null,!h&&zt.length>0?a.jsx("div",{className:"entity-notes-strict-list",children:zt.map(ae=>{const Xe=ae?.createdAt??ae?.created_at??ae?.timestamp??null,Fe=op(Xe);String(ae?.shareType??ae?.share_type??"private");const Qe=J===ae?.id,bt=W(ae);return ae?.characterId??ae?.character_id,a.jsx("div",{className:"entity-notes-strict-note-item",children:Qe?a.jsxs("div",{className:"entity-notes-strict-edit-panel",children:[a.jsx(Ld,{value:Z,onChange:at,markup:"@[__display__](__id__)",placeholder:wS,className:"entity-note-mentions",inputProps:{className:"entity-notes-strict-textarea","aria-label":"Edit note content",rows:5,required:!0},children:a.jsx(Rl,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(St,_e)=>`@${_e}`,data:te,appendSpaceOnAdd:!0})}),a.jsx("p",{className:"entity-notes-strict-share-label",children:"Share with"}),a.jsx("div",{className:"entity-notes-strict-share-options",children:Pe.map(St=>a.jsxs("label",{className:"entity-notes-strict-share-option",children:[a.jsx("input",{type:"radio",name:`entity-note-share-edit-${ae.id}`,value:St.value,checked:Q===St.value,onChange:()=>oe(St.value),disabled:ke}),St.value==="private"?"Private":St.value==="party"?"Share with Party":St.label]},St.value))}),Y?a.jsxs("div",{className:"entity-notes-strict-alert error",children:[a.jsx(Ha,{size:16}),a.jsx("p",{children:Y})]}):null,a.jsxs("div",{className:"entity-notes-strict-edit-actions",children:[a.jsx("button",{type:"button",className:"btn-primary",onClick:()=>st(ae),disabled:ke||!Z.trim(),children:ke?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:16})," Saving"]}):"Save"}),a.jsx("button",{type:"button",className:"btn-secondary",onClick:ge,disabled:ke,children:"Cancel"})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"entity-notes-strict-note-header",children:[a.jsxs("div",{className:"entity-notes-strict-note-title-row",children:[a.jsx("span",{className:"entity-notes-strict-note-title",children:Ge(ae)}),a.jsx("span",{className:"entity-notes-strict-note-visibility",children:ut(ae)})]}),a.jsx("span",{className:"entity-notes-strict-note-timestamp",children:Fe||""})]}),a.jsx("p",{className:"entity-notes-strict-note-body",children:Kt(ae)}),bt?a.jsxs("div",{className:"entity-notes-strict-note-actions",children:[a.jsx("button",{type:"button",className:"entity-notes-strict-edit-button",onClick:()=>Ee(ae),children:"Edit"}),a.jsx("button",{type:"button",className:"entity-notes-strict-delete-button",onClick:()=>nt(ae),disabled:Te===ae.id,children:Te===ae.id?a.jsx(Nn,{className:"spin",size:14}):"Delete"})]}):null]})},ae?.id)})}):null]}):a.jsxs("div",{className:"entity-notes-strict-mentions",children:[a.jsxs("div",{className:"entity-notes-strict-mentions-header",children:[a.jsxs("div",{className:"entity-notes-strict-mention-toggle",children:[a.jsxs("button",{type:"button",className:`entity-notes-strict-mention-toggle-button${q==="entity"?" active":""}`,onClick:()=>G("entity"),children:["Entity Notes",ce?a.jsx("span",{className:"entity-notes-strict-mention-count",children:se}):null]}),a.jsxs("button",{type:"button",className:`entity-notes-strict-mention-toggle-button${q==="session"?" active":""}`,onClick:()=>G("session"),children:["Session Notes",re?a.jsx("span",{className:"entity-notes-strict-mention-count",children:be}):null]})]}),a.jsx("button",{type:"button",className:"btn-secondary",onClick:Lt,disabled:Ne,children:(q==="entity"?je:We)?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:16})," Refreshing"]}):"Refresh"})]}),q==="entity"?a.jsxs(a.Fragment,{children:[dt?a.jsxs("div",{className:"entity-notes-strict-alert error",children:[a.jsx(Ha,{size:16}),a.jsx("p",{children:dt})]}):null,je?a.jsxs("div",{className:"entity-notes-strict-loading",children:[a.jsx(Nn,{className:"spin",size:20}),a.jsx("span",{children:"Loading mentions"})]}):null,!je&&ce&&se===0?a.jsx("p",{className:"entity-notes-strict-empty",children:"This entity hasn't been mentioned in other entity notes yet."}):null,!je&&ce&&se>0?a.jsx("div",{className:"entity-notes-strict-list",children:Rt.map((ae,Xe)=>{const Fe=ae?.id??ae?.entityNoteId??ae?.entity_note_id??`entity-mention-${Xe}`,Qe=String(Fe),bt=ae?.createdAt??ae?.created_at,St=bt?new Date(bt):null,_e=op(St);return String(ae?.shareType??ae?.share_type??"private"),St&&!Number.isNaN(St.getTime())&&St.toISOString(),ae?.entity?.name??ae?.entityName,ae?.entity?.id??ae?.entityId??ae?.entity_id,a.jsxs("div",{className:"entity-notes-strict-note-item",children:[a.jsxs("div",{className:"entity-notes-strict-note-header",children:[a.jsxs("div",{className:"entity-notes-strict-note-title-row",children:[a.jsx("span",{className:"entity-notes-strict-note-title",children:Ge(ae)}),a.jsx("span",{className:"entity-notes-strict-note-visibility",children:ut(ae)})]}),a.jsx("span",{className:"entity-notes-strict-note-timestamp",children:_e||""})]}),a.jsx("p",{className:"entity-notes-strict-note-body",children:Kt(ae)})]},`entity-mention-${Qe}`)})}):null]}):a.jsxs(a.Fragment,{children:[gt?a.jsxs("div",{className:"entity-notes-strict-alert error",children:[a.jsx(Ha,{size:16}),a.jsx("p",{children:gt})]}):null,We?a.jsxs("div",{className:"entity-notes-strict-loading",children:[a.jsx(Nn,{className:"spin",size:20}),a.jsx("span",{children:"Loading session mentions"})]}):null,!We&&re&&be===0?a.jsx("p",{className:"entity-notes-strict-empty",children:"This entity hasn't been mentioned in session notes yet."}):null,!We&&re&&be>0?a.jsx("div",{className:"entity-notes-strict-list",children:pt.map((ae,Xe)=>{const Fe=ae?.id??ae?.noteId??ae?.note_id??`session-mention-${Xe}`,Qe=String(Fe),bt=Zt(Qe),St=Mt(ae),_e=ae?.sessionTitle??ae?.session_title??"Session note";Ft(ae),cp(ae);const et=ae?.updatedAt??ae?.updated_at??ae?.createdAt??ae?.created_at,mt=et?new Date(et):null,fe=op(mt),he=St||"This session note does not include any text.";return a.jsxs("div",{className:"entity-notes-strict-note-item",children:[a.jsxs("div",{className:"entity-notes-strict-note-header",children:[a.jsx("div",{className:"entity-notes-strict-note-title-row",children:a.jsx("span",{className:"entity-notes-strict-note-title",children:_e})}),a.jsx("span",{className:"entity-notes-strict-note-timestamp",children:fe||""})]}),bt?a.jsx("p",{className:"entity-notes-strict-note-body",children:Kt(ae)}):a.jsx("p",{className:"entity-notes-strict-note-body",children:he}),a.jsx("div",{className:"entity-notes-strict-note-actions",children:a.jsx("button",{type:"button",className:"entity-notes-strict-action-button",onClick:()=>kt(Qe),children:bt?"Hide note":"View note"})})]},`session-mention-${Qe}`)})}):null]})]})]}),a.jsx(Yr,{isOpen:D&&_t,onClose:ve,title:"Create note",children:a.jsx("div",{className:"entity-notes-form",children:a.jsxs("form",{onSubmit:Se,className:"entity-notes-form-body",children:[a.jsx("label",{className:"entity-notes-label",htmlFor:"entity-note-content",children:"Note"}),a.jsx("div",{className:"entity-note-editor-field",children:a.jsx(Ld,{value:j,onChange:ee,markup:"@[__display__](__id__)",placeholder:wS,className:"entity-note-mentions",inputProps:{id:"entity-note-content",className:"entity-note-textarea","aria-label":"Entity note content",rows:5,required:!0,"data-autofocus":!0},children:a.jsx(Rl,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(ae,Xe)=>`@${Xe}`,data:te,appendSpaceOnAdd:!0})})}),a.jsxs("fieldset",{className:"entity-notes-share",children:[a.jsx("legend",{children:"Share with"}),Pe.map(ae=>a.jsxs("label",{className:"entity-notes-share-option",children:[a.jsx("input",{type:"radio",name:"entity-note-share",value:ae.value,checked:C===ae.value,onChange:()=>O(ae.value),disabled:ot}),a.jsx("span",{children:ae.label})]},ae.value))]}),Be?a.jsxs("div",{className:"entity-notes-character",children:[a.jsx("label",{htmlFor:"entity-note-character",children:"Character"}),a.jsxs("select",{id:"entity-note-character",value:E,onChange:ae=>T(ae.target.value),disabled:z||Ke,required:!0,children:[a.jsx("option",{value:"",disabled:!0,children:z?"Loading characters":"Select character"}),M.map(ae=>a.jsx("option",{value:ae.id,children:ae.name},ae.id))]}),Ke?a.jsxs("p",{className:"entity-notes-hint",children:["Notes will be associated with your character ",M[0]?.name,"."]}):null,X?a.jsxs("div",{className:"entity-notes-alert error",children:[a.jsx(Ha,{size:16}),a.jsx("p",{children:X})]}):null,!z&&!X&&M.length===0?a.jsx("p",{className:"entity-notes-hint",children:"You need an active character in this campaign to attach notes."}):null]}):null,Y?a.jsxs("div",{className:"entity-notes-alert error",children:[a.jsx(Ha,{size:16}),a.jsx("p",{children:Y})]}):null,I?a.jsx("div",{className:"entity-notes-alert success",children:a.jsx("p",{children:I})}):null,a.jsx("div",{className:"entity-notes-actions",children:a.jsx("button",{type:"submit",className:"primary",disabled:ze,children:g?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:16})," Saving"]}):"Save note"})})]})})})]})}DN.propTypes={entity:rn.object,worldId:rn.oneOfType([rn.string,rn.number]),selectedCampaign:rn.object,selectedCampaignId:rn.oneOfType([rn.string,rn.number]),isCampaignDm:rn.bool,isCampaignPlayer:rn.bool,canCreateNote:rn.bool,notes:rn.arrayOf(rn.object),loading:rn.bool,error:rn.string,onCreateNote:rn.func,creating:rn.bool,campaignMatchesEntityWorld:rn.bool,onNoteUpdate:rn.func,onNoteDelete:rn.func};const sI=e=>{const t=e?.options?.choices;return!Array.isArray(t)||t.length===0?[]:t.map((r,i)=>{if(r==null)return null;if(typeof r=="object"){const c=r.value??r.id??r.key??r.slug??`choice-${i}`,f=r.label??r.name??r.title??r.display??c;return c==null?null:{value:c,label:String(f??c)}}const l=String(r);return{value:l,label:l}}).filter(Boolean)},rI=e=>{if(!e?.name)return null;const t=`metadata.${e.name}`,r=e.visibleByDefault!==void 0?!!e.visibleByDefault:e.visible_by_default!==void 0?!!e.visible_by_default:!0,i={key:t,name:t,label:e.label||e.name,metadataField:e.name,dataType:e.dataType,visibleByDefault:r};switch(e.dataType){case"text":return{...i,type:"textarea",rows:3};case"boolean":return{...i,type:"boolean"};case"enum":return{...i,type:"select",options:sI(e)};case"number":return{...i,type:"text",inputType:"number"};case"date":return{...i,type:"text"};case"reference":{const l=e.referenceTypeId??e.reference_type_id??e.referenceType?.id??null,c=e.referenceTypeName??e.reference_type_name??e.referenceType?.name??"",f=e.referenceFilter??e.reference_filter??e.referenceFilterJson??{},m=(()=>{if(e.displayValue)return String(e.displayValue);if(e.display)return String(e.display);if(e.selectedLabel)return String(e.selectedLabel);const h=e.value;if(!h||typeof h!="object")return"";const p=h.label??h.name??h.title??h.display??h.displayName??h.text??h.value;return p!=null?String(p):""})();return{...i,type:"reference",referenceTypeId:l,referenceTypeName:c,referenceFilter:f,displayKey:`metadataDisplay.${e.name}`,selectedLabel:m}}default:return{...i,type:"text"}}},Ku=(e,t,r="")=>{if(e!=null){const i=String(e).trim();if(i)return i}if(t!=null){const i=String(t).trim();if(i)return`name:${i.toLowerCase()}`}if(r){const i=String(r).trim();if(i)return`label:${i.toLowerCase().normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"fallback"}`}return""};function iI(){const{id:e}=xs(),t=$n(),r=Ga(),{user:i,token:l,sessionReady:c}=En(),{selectedCampaign:f,selectedCampaignId:m,setSelectedCampaignId:h}=Bn(),p=$y(),[y,g]=u.useState(null),v=u.useCallback(ye=>{const Me=Pa(ye);Me&&g(ht=>ht?!Me.permissions&&ht.permissions?{...Me,permissions:ht.permissions}:(Me.permissions,Me):Me)},[]),[S,w]=u.useState(!0),[N,j]=u.useState(""),[_,C]=u.useState(""),[O,E]=u.useState("dossier"),[T,M]=u.useState(!1),[A,z]=u.useState(!1),[P,X]=u.useState(null),[H,Y]=u.useState({items:[],loading:!1,error:""}),[V,I]=u.useState(!1),F=u.useRef(null),[D,L]=u.useState({isDirty:!1,isSubmitting:!1}),[U,k]=u.useState(!1),[B,R]=u.useState(null),q=u.useRef(null),[G,J]=u.useState(!1),[ie,Z]=u.useState([]),[me,Q]=u.useState(""),[oe,ne]=u.useState(!1),[we,ke]=u.useState([]),[Re,Te]=u.useState([]),[rt,He]=u.useState(()=>Zh()),tt=u.useRef(r),Ie=u.useRef(null),Ct=u.useMemo(()=>!f||!i?.id?null:(Array.isArray(f.members)?f.members:[]).find(ht=>{if(!ht)return!1;const Dt=ht.user_id??ht.userId??ht.user?.id??ht.id??null;return Dt?String(Dt)===String(i.id):!1})||null,[f,i?.id])?.role??null,At=u.useMemo(()=>i?.role==="system_admin"?!0:Ct==="dm",[Ct,i?.role]),_t=u.useMemo(()=>Ct==="player",[Ct]),Pe=u.useMemo(()=>!!(At||_t),[At,_t]),Ze=u.useMemo(()=>y?y.world?.id?String(y.world.id):y.world_id?String(y.world_id):y.worldId?String(y.worldId):"":"",[y]),W=u.useMemo(()=>f?f.world?.id?String(f.world.id):f.world_id?String(f.world_id):"":"",[f]),ee=u.useMemo(()=>!m||!Ze||!W?!0:String(Ze)===String(W),[m,Ze,W]),te=r.state?.fromEntities?.search||"",ve=u.useMemo(()=>te?te.startsWith("?")?`/entities${te}`:`/entities?${te}`:"/entities",[te]),le=u.useCallback(ye=>{if(!ye)return"the next page";const Me=ye.pathname||"",ht=ye.search||"",Dt=`${Me}${ht}`;return Dt?Dt===ve?"the previous page":Dt:"the next page"},[ve]),Se=u.useCallback(ye=>{if(!ye)return"";const Me=ye.pathname||"",ht=ye.search||"",Dt=ye.hash||"";return`${Me}${ht}${Dt}`},[]),Ee=u.useCallback(ye=>{if(!ye||typeof ye!="string")return null;const Me=ye.indexOf("#"),ht=ye.indexOf("?");let Dt=ye.length;Me>=0&&(Dt=Me),ht>=0&&ht<Dt&&(Dt=ht);const Vt=ye.slice(0,Dt)||"",nn=ht>=0?ye.slice(ht,Me>=0?Me:void 0):"",xn=Me>=0?ye.slice(Me):"";return{pathname:Vt,search:nn,hash:xn}},[]),ge=u.useCallback(ye=>{if(ye){if(ye.externalUrl){typeof window<"u"&&window.location.assign(ye.externalUrl);return}if(ye.to!==void 0&&ye.to!==null){const Me=ye.to;if(typeof Me=="string"){Ie.current=Me,t(Me,{replace:ye.replace,state:ye.state});return}const ht=Se(Me);ht&&(Ie.current=ht),t(Me,{replace:ye.replace,state:ye.state})}}},[Se,t]),at=u.useCallback(ye=>{ye&&g(Me=>{if(!Me)return Me;const ht=Array.isArray(Me.secrets)?Me.secrets:[],Dt=ht.findIndex(Gt=>!Gt||!ye||!Gt.id||!ye.id?!1:String(Gt.id)===String(ye.id)),Vt=Dt>=0?ht.map((Gt,vn)=>vn===Dt?ye:Gt):[...ht,ye],nn=Gt=>{if(!Gt)return 0;const vn=new Date(Gt).getTime();return Number.isNaN(vn)?0:vn},xn=Vt.slice().sort((Gt,vn)=>nn(Gt?.created_at||Gt?.createdAt)-nn(vn?.created_at||vn?.createdAt));return{...Me,secrets:xn}})},[]),st=u.useCallback(async()=>{const ye=await UR(e,{campaignId:m});return Array.isArray(ye?.data)?ye.data:Array.isArray(ye)?ye:[]},[e,m]);u.useEffect(()=>{let ye=!1;return!e||!m||!ee?(Y({items:[],loading:!1,error:""}),()=>{ye=!0}):(Y(ht=>({...ht,loading:!0,error:""})),(async()=>{try{const ht=await st();ye||Y({items:ht,loading:!1,error:""})}catch(ht){if(!ye){const nn=(ht.status===403||ht.status==="403"||ht.message==="Forbidden")&&!!m?"CAMPAIGN_CONTEXT_ACCESS_DENIED":ht.message||"Failed to load notes";Y(xn=>({...xn,loading:!1,error:nn}))}}})(),()=>{ye=!0})},[e,m,ee,st]);const nt=u.useCallback(async()=>{if(!e||!m||!ee){Y({items:[],loading:!1,error:""});return}Y(ye=>({...ye,loading:!0,error:""}));try{const ye=await st();Y({items:ye,loading:!1,error:""})}catch(ye){Y(Me=>({...Me,loading:!1,error:ye.message||"Failed to load notes"}))}},[e,m,ee,st]),$e=u.useCallback(async ye=>{if(!e)return{success:!1,message:"Entity not found"};if(!m)return{success:!1,message:"Select a campaign first"};I(!0);try{const Me={...ye,campaignId:ye?.campaignId??m},ht=await HR(e,Me),Dt=ht?.data||ht;if(!Dt)throw new Error("Note could not be created");const Vt=Dt?.createdAt??Dt?.created_at??new Date().toISOString(),nn=Dt?.createdAt&&Dt?.created_at?Dt:{...Dt,...Dt?.createdAt?{}:{createdAt:Vt},...Dt?.created_at?{}:{created_at:Vt}};return Y(xn=>{const Gt=Array.isArray(xn?.items)?xn.items.slice():[],vn=Dt?.id,oa=vn?Gt.filter(Pt=>Pt?.id!==vn):Gt;return{items:[nn,...oa],loading:!1,error:""}}),{success:!0,note:nn}}catch(Me){return{success:!1,message:Me.message||"Failed to create note"}}finally{I(!1)}},[e,m]),ft=u.useCallback(async ye=>{if(!ye?.id)return;const Me=ye?.updatedAt??ye?.updated_at??ye?.createdAt??ye?.created_at??new Date().toISOString(),ht=ye?.updatedAt&&ye?.updated_at?ye:{...ye,...ye?.updatedAt?{}:{updatedAt:Me},...ye?.updated_at?{}:{updated_at:Me}};Y(Dt=>{const Vt=Array.isArray(Dt?.items)?Dt.items.slice():[],nn=ht?.id;if(!nn)return Dt;const xn=Vt.findIndex(Gt=>Gt?.id===nn);if(xn>=0){const Gt=[...Vt];return Gt[xn]=ht,{items:Gt,loading:!1,error:""}}return{items:[ht,...Vt],loading:!1,error:""}})},[]),zt=u.useCallback(async ye=>{ye&&Y(Me=>({items:(Array.isArray(Me?.items)?Me.items.slice():[]).filter(Vt=>Vt?.id!==ye),loading:!1,error:""}))},[]),Rt=u.useMemo(()=>y?.permissions&&typeof y.permissions.canEdit=="boolean"?y.permissions.canEdit:!y||!i?!1:!!(i.role==="system_admin"||y.world?.created_by&&y.world.created_by===i.id||y.created_by&&y.created_by===i.id),[y,i]),pt=u.useMemo(()=>Array.isArray(y?.secrets)?y.secrets:[],[y?.secrets]),ct=u.useMemo(()=>!!y?.permissions?.canManageSecrets,[y?.permissions?.canManageSecrets]),yt=ct||pt.length>0,Mt=u.useMemo(()=>{const ye=[{id:"dossier",label:"Dossier"},{id:"notes",label:"Notes"},{id:"relationships",label:"Relationships"}];return yt&&ye.push({id:"secrets",label:"Secrets"}),Rt&&T&&ye.push({id:"access",label:"Access"}),ye.push({id:"system",label:"System"}),ye},[yt,Rt,T]);u.useEffect(()=>{new Set(Mt.map(Me=>Me.id)).has(O)||E("dossier")},[Mt,O]);const Ft=u.useCallback((ye,Me,ht,Dt=null)=>{if(!ye)return null;const Vt=Array.isArray(ye.sections)?ye.sections:[],nn=Dt?.actionsByField??{},xn=Dt?.showRuleTargets??new Set;return Vt.map((Gt,vn)=>{const oa=`${ht||"section"}-${Gt.title||vn}`,Pt=Number.isFinite(Gt.columns)?Math.max(1,Number(Gt.columns)):1,Wn=Array.isArray(Gt.fields)?Gt.fields:[];return a.jsxs("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:[Gt.title?a.jsx("h2",{className:"entity-card-title",children:Gt.title}):null,a.jsx("div",{className:`entity-field-grid ${Pt>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":""}`,style:{"--entity-field-columns":Pt},children:Wn.length>0?Wn.map((Xa,Li)=>{const Oi=Xa?.key||Xa?.name||Xa?.field||`${oa}-field-${Li}`,zi=nn[Oi],$i=Xa.visibleByDefault!==void 0?!!Xa.visibleByDefault:Xa.visible_by_default!==void 0?!!Xa.visible_by_default:!0;return cc(Oi,zi,xn,$i)?null:a.jsx(ff,{field:{...Xa},data:Me,mode:"view"},Oi)}):a.jsx("p",{className:"entity-empty-state",children:"No fields available."})})]},oa)})},[]);u.useEffect(()=>{if(!P)return;const ye=setTimeout(()=>X(null),4e3);return()=>clearTimeout(ye)},[P]);const kt=u.useCallback(async()=>{if(e){w(!0),j(""),C("");try{const ye=await rr(e),Me=Pa(ye);if(!Me){g(null),j("Entity not found");return}v(Me)}catch(ye){const Me=ye.status===403||ye.status==="403"||ye.message==="Forbidden";j(Me&&!!m?"CAMPAIGN_CONTEXT_ACCESS_DENIED":ye.message||"Failed to load entity"),g(null)}finally{w(!1)}}},[e,v,m]),Zt=u.useCallback(async ye=>{if(!ye){ke([]),Te([]);return}try{const[Me,ht]=await Promise.all([of(ye).catch(()=>null),cf(ye).catch(()=>null)]);ke(Gr(Me)),Te(Gr(ht))}catch{ke([]),Te([])}},[]);u.useEffect(()=>{c&&l&&kt()},[c,l,kt]),u.useEffect(()=>{const ye=y?.entity_type_id||y?.entityType?.id||y?.entity_type?.id||null;if(!ye){ke([]),Te([]);return}Zt(ye)},[y?.entity_type_id,y?.entityType?.id,y?.entity_type?.id,Zt]);const Lt=u.useMemo(()=>Array.isArray(y?.fields)?Hy(y.fields,we).map(Me=>rI(Me)).filter(Boolean):[],[y?.fields,we]),Kt=u.useMemo(()=>!y?.fields||y.fields.length===0?{__placeholder:"No metadata defined for this entity type."}:tN(y.fields),[y]),se=y?.fields,be=u.useMemo(()=>Vy(Re,se),[Re,se]),je=u.useMemo(()=>!y?.fields||y.fields.length===0?{}:qk(y.fields),[y]),We=u.useMemo(()=>!y?.fields||y.fields.length===0?{}:Bk(y.fields),[y]),dt=u.useMemo(()=>{if(!y?.id)return null;const ye=y?.entityType?.name||y?.entity_type?.name||y?.entityTypeName||"entity";return{id:y.id,type:`entity:${ye}`,title:y.name||"Untitled entity",worldId:Ze,worldName:y?.world?.name||y?.world_name||""}},[y?.id,y?.name,y?.entityType?.name,y?.entity_type?.name,y?.entityTypeName,Ze,y?.world?.name,y?.world_name]);I1(dt);const gt=u.useRef(null),ce=u.useRef(!1),re=u.useRef(!1);u.useEffect(()=>{const ye=y?.id,Me=gt.current;ye!==Me&&Me!==null&&!re.current&&(M(!1),ce.current=!1),gt.current=ye},[y?.id,T]);const Ne=y?.createdAt||y?.created_at,Be=y?.updatedAt||y?.updated_at,Ke=u.useMemo(()=>y?{name:y.name||"",description:y.description||"",typeName:y.entityType?.name||y.entity_type?.name||"",worldName:y.world?.name||y.world_name||"",worldId:Ze,createdAt:Hr(Ne),updatedAt:Hr(Be),metadata:Kt,metadataDisplay:je,createdBy:y.creator?.username||y.creator?.email||y.created_by||"",updatedBy:y.updated_by||""}:null,[y,Kt,je,Ze,Ne,Be]),ot=u.useMemo(()=>Yy(be,Ke||{}),[be,Ke]),ze=u.useMemo(()=>y?{name:y.name||"",description:y.description||"",visibility:y.visibility||"visible",entityTypeName:y.entityType?.name||y.entity_type?.name||"",worldName:y.world?.name||y.world_name||"",worldId:Ze,createdAt:Hr(Ne),updatedAt:Hr(Be),metadata:We}:null,[y,Ze,Ne,Be,We]);u.useEffect(()=>{if(!T||!y||!ze||!F.current?.reset||!ce.current)return;const ye=setTimeout(()=>{F.current?.reset&&ze&&F.current.reset(ze),ce.current=!1},150);return()=>clearTimeout(ye)},[T,y,ze]);const ue=u.useMemo(()=>{if(!y)return"";const ye=y.imageMimeType||y.image_mime_type||"",Me=y.imageData||y.image_data||"";return!ye||!Me?"":`data:${ye};base64,${Me}`},[y]),qe=u.useMemo(()=>!y||!Rt?null:a.jsx(N4,{entity:y,canEdit:Rt,isEditing:T,onEntityUpdate:v,variant:T?"compact":"card"}),[y,Rt,T,v]),Ge="Information",ut=u.useMemo(()=>{const ye=Lt.length>0;return{title:"Edit Entity",sections:[{title:"Edit Entity",columns:2,fields:[{key:"name",label:"Name",type:"text"},{key:"entityTypeName",label:"Type",type:"readonly"},{key:"description",label:"Description",type:"textarea",rows:4,span:2}]},{title:Ge,columns:ye?2:1,fields:ye?Lt:[{key:"metadata.__placeholder",name:"metadata.__placeholder",label:"Information",type:"readonly"}]}]}},[Lt,Ge]),ae=u.useMemo(()=>{const ye=Lt.length>0?Lt:[{key:"metadata.__placeholder",name:"metadata.__placeholder",label:"Information",type:"readonly"}];return{title:"Entity Overview",sections:[{title:"Summary",columns:2,fields:[{key:"name",label:"Name",type:"readonly"},{key:"typeName",label:"Type",type:"readonly"}]},{title:"Description",columns:1,fields:[{key:"description",label:"Description",type:"textarea",rows:4}]},{title:Ge,columns:Lt.length>0?2:1,fields:ye}]}},[Lt,Ge]),Xe=u.useMemo(()=>({sections:[{title:"System",columns:2,fields:[{key:"worldName",label:"World",type:"readonly"},{key:"createdAt",label:"Created",type:"readonly"},{key:"createdBy",label:"Created by",type:"readonly"},{key:"updatedAt",label:"Updated",type:"readonly"},{key:"updatedBy",label:"Updated by",type:"readonly"}]}]}),[]),{accessSettings:Fe,accessOptions:Qe,accessOptionsError:bt,accessOptionsLoading:St,accessSaving:_e,accessSaveError:et,accessSaveSuccess:mt,isAccessDirty:fe,handleAccessSettingChange:he,resetAccessSettings:Ve,handleAccessSave:xt}=O4(y,l,Rt),Nt=u.useMemo(()=>y?.world?.id||y?.world_id||"",[y]),Et=y?.id?String(y.id):"",jt=u.useCallback(async()=>{if(!Et||!l){Z([]),Q(""),ne(!1);return}ne(!0),Q("");try{const ye=await _4(Et),Me=Array.isArray(ye)?ye:Array.isArray(ye?.data)?ye.data:[];Z(Me)}catch(ye){Z([]),Q(ye.message||"Failed to load relationships")}finally{ne(!1)}},[Et,l]);u.useEffect(()=>{jt()},[jt]);const Wt=u.useMemo(()=>{if(!Array.isArray(ie))return[];const ye=Me=>Me?typeof Me=="string"||typeof Me=="number"?String(Me).trim():typeof Me=="object"?String(Me.id||Me.entity_id||Me.entityId||"").trim():"":"";return ie.map(Me=>{const ht=Me.relationshipType||Me.relationship_type||Me.type||Me.relationshipTypeId||{},Dt=ht?.from_name||ht?.fromName||Me.source_relationship_label||Me.sourceLabel||"",Vt=ht?.to_name||ht?.toName||Me.target_relationship_label||Me.targetLabel||"";return{id:Me.id,typeId:ye(Me.relationship_type_id||Me.relationshipTypeId||Me.typeId||Me.type),typeName:Me.relationshipType?.name||Me.type?.name||"",fromId:ye(Me.from_entity_id||Me.fromEntityId||Me.from),toId:ye(Me.to_entity_id||Me.toEntityId||Me.to),fromName:Me.from_entity?.name||Me.from?.name||"",toName:Me.to_entity?.name||Me.to?.name||"",fromEntityTypeName:Me.from_entity_type?.name||Me.fromEntityTypeName||"",toEntityTypeName:Me.to_entity_type?.name||Me.toEntityTypeName||"",direction:Me.context?.__direction==="reverse"?"reverse":"forward",sourceLabel:Dt||"",targetLabel:Vt||""}})},[ie]),ln=u.useMemo(()=>Wt.filter(ye=>ye.fromId===Et||ye.toId===Et).sort((ye,Me)=>{const ht=ye.fromId===Et?ye.toName:ye.fromName,Dt=Me.fromId===Et?Me.toName:Me.fromName;return ht.localeCompare(Dt,void 0,{sensitivity:"base"})}),[Wt,Et]),dn=u.useMemo(()=>{const ye=new Map,Me=new Map;ln.forEach(Vt=>{const nn=Vt.typeName||"Unknown type",xn=Ku(Vt.typeId,Vt.typeName,nn);xn&&!ye.has(xn)&&ye.set(xn,nn);const vn=Vt.fromId===Et?Vt.toEntityTypeName:Vt.fromEntityTypeName,oa=Ku(null,vn,vn);oa&&!Me.has(oa)&&Me.set(oa,vn)});const ht=Array.from(ye.entries()).map(([Vt,nn])=>({value:Vt,label:nn})),Dt=Array.from(Me.entries()).map(([Vt,nn])=>({value:Vt,label:nn}));return{relationshipTypes:ht,relatedEntityTypes:Dt}},[ln,Et]),Qt=u.useMemo(()=>{const ye=rt.relationshipTypes||{mode:"all",values:[]},Me=rt.relatedEntityTypes||{mode:"all",values:[]};return ln.filter(ht=>{const Dt=Ku(ht.typeId,ht.typeName,ht.typeName);if(ye.mode!=="all"&&ye.values.length){const Vt=Dt&&ye.values.includes(Dt);if(ye.mode==="include"&&!Vt||ye.mode==="exclude"&&Vt)return!1}if(Me.mode!=="all"&&Me.values.length){const nn=ht.fromId===Et?ht.toEntityTypeName:ht.fromEntityTypeName,xn=Ku(null,nn,nn),Gt=xn&&Me.values.includes(xn);if(Me.mode==="include"&&!Gt||Me.mode==="exclude"&&Gt)return!1}return!0})},[ln,rt,Et]),pa=u.useCallback(ye=>{He(!ye||typeof ye!="object"?Zh():ye)},[]),Da=u.useCallback(()=>{He(Zh())},[]),Jr=oe,ur=u.useMemo(()=>`No relationships found for ${y?.name||"this entity"}.`,[y?.name]),Os=u.useCallback(async()=>{if(!Rt)return!1;re.current=!0;let ye=!0,Me=!1;try{if(D.isDirty&&F.current?.submit&&await F.current.submit()===!1&&(ye=!1),ye&&fe&&(await xt()?Me=!0:ye=!1),ye&&Me&&y?.id)try{const ht=await rr(y.id),Dt=Pa(ht);Dt&&v(Dt)}catch{}return ye}finally{setTimeout(()=>{re.current=!1},200)}},[Rt,D.isDirty,fe,xt,y?.id,v,T]),ia=u.useCallback(()=>{const ye=q.current;R(null),ye?.proceed?.()},[]),ei=u.useCallback(async()=>{J(!0);try{if(await Os()){k(!1);const Me=q.current;Me?.type!=="exit-edit"?ia():(R(null),Me?.proceed?.())}}finally{J(!1)}},[Os,ia]),ti=u.useCallback(()=>{F.current?.reset?.(ze||{}),Ve()},[ze,Ve]),qn=u.useMemo(()=>T&&(D.isDirty||fe),[T,D.isDirty,fe]),Ia=u.useCallback(()=>{M(!1),E("dossier")},[E,y?.id,Rt,qn]),ws=u.useCallback(ye=>{if(!ye)return;const Me=()=>{if(ye.label)return ye.label;if(ye.externalUrl)return ye.externalLabel||ye.externalUrl;if(typeof ye.to=="string"){const ht=ye.location||Ee(ye.to);return le(ht)}return le(ye.location||ye.to)};if(!qn){ge(ye);return}R({type:"navigation",label:Me(),proceed:()=>ge(ye),discard:()=>ge(ye),stay:()=>{}}),k(!0)},[le,qn,Ee,ge,R,k]);u.useEffect(()=>{if(typeof document>"u"||!qn)return;const ye=Me=>{if(!qn||Me.defaultPrevented||Me.button!==0||Me.metaKey||Me.ctrlKey||Me.shiftKey||Me.altKey)return;const ht=Me.target,Dt=ht instanceof Element?ht:ht&&"parentElement"in ht?ht.parentElement:null;if(!Dt||typeof Dt.closest!="function")return;const Vt=Dt.closest("a[href]");if(!Vt||Vt.hasAttribute("data-ignore-unsaved-warning"))return;const nn=Vt.getAttribute("href");if(!nn||nn.startsWith("#")||nn.startsWith("javascript:"))return;const xn=Vt.getAttribute("target");if(xn&&xn.toLowerCase()!=="_self")return;let Gt;try{Gt=new URL(nn,window.location.href)}catch{return}const vn=Vt.getAttribute("data-navigation-label")||Vt.getAttribute("aria-label")||Vt.title||Vt.textContent?.trim()||"",oa=Gt.origin!==window.location.origin;if(Me.preventDefault(),Me.stopPropagation(),oa){ws({externalUrl:Gt.href,label:vn||Gt.href});return}const Pt=`${Gt.pathname}${Gt.search}${Gt.hash}`,Wn=`${window.location.pathname}${window.location.search}${window.location.hash}`;!Pt||Pt===Wn||ws({to:Pt,location:Ee(Pt),label:vn||le({pathname:Gt.pathname,search:Gt.search})})};return document.addEventListener("click",ye,!0),()=>{document.removeEventListener("click",ye,!0)}},[le,qn,Ee,ws]);const de=u.useCallback(()=>{const ye=`/entities/${e}/relationship-viewer`;ws({to:ye,location:Ee(ye)})},[e,Ee,ws]),Ce=u.useCallback(()=>{if(Rt){if(C(""),!T){M(!0);return}if(qn){R({type:"exit-edit",label:"view mode",proceed:async()=>{await Os()&&Ia()},discard:()=>{ti(),Ia()}}),k(!0);return}Ia()}},[Rt,Ia,qn,T,ti,Os]),Bt=u.useCallback(async ye=>{if(!y?.id)return!1;C("");try{const Me={name:ye?.name,description:ye?.description,metadata:ye?.metadata||{}};y?.visibility&&(Me.visibility=y.visibility);const ht=await By(y.id,Me),Dt=Pa(ht);if(!Dt)throw new Error("Failed to update entity");return v(Dt),ce.current=!0,{message:"Entity updated successfully."}}catch(Me){return C(Me.message||"Failed to update entity"),ce.current=!1,!1}},[y?.id,y?.visibility,v,T]),pn=u.useCallback(ye=>{L(Me=>{const ht={isDirty:!!ye?.isDirty,isSubmitting:!!ye?.isSubmitting};return Me.isDirty===ht.isDirty&&Me.isSubmitting===ht.isSubmitting?Me:ht})},[y?.id,T]),fn=u.useCallback(ye=>{!ye||ye===O||E(ye)},[O,E]),qt=u.useCallback(()=>{k(!1);const ye=q.current;R(null),ye?.discard?.()},[]),jn=u.useCallback(()=>{k(!1);const ye=q.current;R(null),ye?.stay?.()},[]);h1(u.useCallback(ye=>{qn&&(ye.preventDefault(),ye.returnValue="")},[qn]),{capture:!0});const Hn=u.useCallback(({currentLocation:ye,nextLocation:Me})=>!qn||!Me?!1:!(ye.pathname===Me.pathname&&ye.search===Me.search&&ye.hash===Me.hash),[qn]),Un=z4(Hn);if(u.useEffect(()=>{q.current=B},[B]),u.useEffect(()=>{if(Un.state==="blocked"){if(!qn){Un.reset?.();return}if(B){if(B.type==="navigation")return;Un.reset?.();return}R({type:"navigation",label:le(Un.location),proceed:()=>Un.proceed?.(),discard:()=>Un.proceed?.(),stay:()=>Un.reset?.()}),k(!0)}},[Un,qn,B,le]),u.useEffect(()=>{const ye=tt.current,Me=Se(ye),ht=Se(r);if(Me===ht){tt.current=r;return}if(!qn){tt.current=r,Ie.current=null;return}if(Ie.current&&Ie.current===ht){Ie.current=null,tt.current=r;return}if(!ye||B){tt.current=ye||r;return}const Dt=ht||"/",Vt=Me||"/",nn=()=>{Ie.current=Dt,t(Dt)},xn=()=>{Ie.current=Vt,t(Vt)};R({type:"navigation",label:le(r),proceed:nn,discard:nn,stay:xn}),k(!0),Ie.current=Vt,t(Vt,{replace:!0})},[Se,le,qn,r,t,B]),!c)return a.jsx("p",{children:"Restoring session..."});if(!l)return a.jsx("p",{children:"Authenticating..."});if(S)return a.jsx("p",{children:"Loading entity..."});if(N==="CAMPAIGN_CONTEXT_ACCESS_DENIED")return a.jsxs("div",{className:"alert error",style:{padding:"1.5rem",maxWidth:"600px",margin:"2rem auto"},children:[a.jsx("h2",{style:{marginTop:0,marginBottom:"1rem"},children:"Access Restricted by Campaign Context"}),a.jsx("p",{style:{marginBottom:"1rem"},children:"You don't have access to this entity with your current campaign context selected. This entity may belong to a different campaign or world, or your current campaign context doesn't have permission to view it."}),a.jsx("p",{style:{marginBottom:"1.5rem"},children:"To view this entity, please change your campaign context using the selector in the header to a campaign that has access to this entity."}),a.jsx("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap"},children:a.jsx("button",{type:"button",onClick:()=>t("/entities"),style:{padding:"0.5rem 1rem",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Go to Entities"})})]});if(N)return a.jsx("div",{className:"alert error",children:N});if(!y||!Ke)return a.jsx("p",{children:"Entity not found"});const la=`entity-detail-page${p?" entity-detail-page--mobile":""}`;return a.jsxs(a.Fragment,{children:[a.jsx(hN,{maxWidth:1280,className:la,children:a.jsxs("div",{className:"w-full max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 overflow-x-hidden",children:[a.jsx("header",{className:"entity-page-header",children:a.jsxs("div",{className:"entity-page-header__inner",children:[a.jsx(m4,{entityId:e,name:y.name,canEdit:Rt,isEditing:T,onToggleEdit:Ce,onSave:Os,isSaving:D.isSubmitting||_e,isSaveDisabled:!D.isDirty&&!fe}),a.jsxs("div",{className:"entity-page-header__tabs flex flex-wrap items-center justify-between gap-4 mt-4",children:[a.jsx(o4,{tabs:Mt,activeTab:O,onChange:fn}),e&&a.jsx(p4,{entityId:e,importance:y.importance,onUpdate:ye=>{g(Me=>Me?{...Me,importance:ye}:null)}})]})]})}),a.jsx("div",{className:"entity-detail-shell",children:a.jsxs("div",{className:"entity-detail-body",children:[a.jsx("div",{className:"entity-tab-panel",role:"tabpanel",hidden:O!=="dossier",children:a.jsx($4,{isEditing:T,canEdit:Rt,formError:_,formRef:F,editSchema:ut,editInitialData:ze,handleUpdate:Bt,handleFormStateChange:pn,dossierSchema:ae,viewData:Ke,featuredImageSrc:ue,renderSchemaSections:Ft,imageSection:qe,fieldRules:be,viewRuleContext:ot})}),O==="notes"&&a.jsx(DN,{entity:y,worldId:Ze,selectedCampaign:f,selectedCampaignId:m,isCampaignDm:At,isCampaignPlayer:_t,canCreateNote:Pe,notes:H.items,loading:H.loading,error:H.error,onReload:nt,onCreateNote:$e,onNoteUpdate:ft,onNoteDelete:zt,creating:V,campaignMatchesEntityWorld:ee}),O==="relationships"&&a.jsx(F4,{entity:y,toast:P,onExplore:de,canEdit:Rt,relationshipsLoading:oe,relationshipsError:me,sortedRelationships:ln,filteredRelationships:Qt,relationshipsEmptyMessage:ur,relationshipFilters:rt,relationshipFilterOptions:dn,filterButtonDisabled:Jr,handleRelationshipFiltersChange:pa,handleRelationshipFiltersReset:Da,showRelationshipForm:A,setShowRelationshipForm:z,worldId:Nt,loadRelationships:jt}),O==="secrets"&&yt&&a.jsx(H4,{entity:y,secrets:pt,worldId:Nt,canManageSecrets:ct,onSecretCreated:at,onSecretUpdated:at}),O==="access"&&T&&Rt&&a.jsx(U4,{canEdit:Rt,worldId:Nt,accessSettings:Fe,accessOptions:Qe,accessOptionsError:bt,accessOptionsLoading:St,accessSaving:_e,accessSaveError:et,accessSaveSuccess:mt,handleAccessSettingChange:he}),O==="system"&&a.jsx(B4,{renderSchemaSections:Ft,systemSchema:Xe,viewData:Ke})]})})]})}),a.jsx(pN,{open:U,destinationLabel:B?.label||"",saving:G,onSaveAndContinue:ei,onContinueWithoutSaving:qt,onStay:jn})]})}function lI({initialData:e={},onSubmit:t,onCancel:r,submitting:i=!1,errorMessage:l,worlds:c=[]}){const[f,m]=u.useState({name:"",description:"",worldId:""}),[h,p]=u.useState("");u.useEffect(()=>{const S=e?.world_id||e?.worldId||e?.world?.id||"";m({name:e?.name||"",description:e?.description||"",worldId:S?String(S):""}),p("")},[e]);const y=u.useMemo(()=>f.name!==(e?.name||"")||f.description!==(e?.description||"")||f.worldId!==(e?.world_id||e?.worldId||e?.world?.id||""),[e,f.description,f.name,f.worldId]);u.useEffect(()=>{p(l||"")},[l]);const g=S=>w=>{const{value:N}=w.target;m(j=>({...j,[S]:N}))},v=async S=>{S.preventDefault();const w=f.name.trim();if(!w){p("Name is required.");return}const N=f.worldId.trim();if(!N){p("Select a world for this entity type.");return}p("");const j={name:w,description:f.description?.trim()||"",world_id:N};try{if(await t?.(j)===!1)return}catch(_){p(_.message||"Failed to save entity type")}};return a.jsxs("form",{className:"entity-type-form",onSubmit:v,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-type-name",children:"Name *"}),a.jsx("input",{id:"entity-type-name",type:"text",value:f.name,onChange:g("name"),placeholder:"e.g. Faction",disabled:i,autoFocus:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-type-world",children:"World *"}),a.jsxs("select",{id:"entity-type-world",value:f.worldId,onChange:g("worldId"),disabled:i,required:!0,children:[a.jsx("option",{value:"",children:"Select world..."}),c.map(S=>a.jsx("option",{value:S.id,children:S.name},S.id))]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-type-description",children:"Description"}),a.jsx("textarea",{id:"entity-type-description",value:f.description,onChange:g("description"),placeholder:"Optional description for this entity type",rows:5,disabled:i,className:"textarea-field"})]}),h&&a.jsx("div",{className:"form-error",role:"alert",children:h}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:r,disabled:i,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:i||!y,children:i?"Saving...":"Save"})]})]})}const oI=new Set(["system_admin"]);function cI(){const e=$n(),{user:t,token:r,sessionReady:i}=En(),{selectedCampaign:l,activeWorld:c,activeWorldId:f,contextKey:m}=Bn(),[h,p]=u.useState([]),[y,g]=u.useState(!1),[v,S]=u.useState(""),[w,N]=u.useState(!1),[j,_]=u.useState(null),[C,O]=u.useState(!1),[E,T]=u.useState(""),[M,A]=u.useState(""),[z,P]=u.useState(null),X=f||l?.world?.id||"",H=u.useRef(`${X}:${m}`),Y=!!X,V=u.useMemo(()=>X?[{id:X,name:c?.name||l?.world?.name||"Untitled world"}]:[],[X,c?.name,l?.world?.name]),I=u.useMemo(()=>{const Q=l?.world||c;return Q&&(Q.created_by||Q.creator?.id||Q.owner_id||Q.owner?.id)||""},[l,c]),F=!!(t?.id&&I===t.id),D=u.useMemo(()=>t?t.role&&oI.has(t.role)?!0:F:!1,[t,F]),L=u.useMemo(()=>{if(l){const Q=l.name||"Selected campaign",oe=l.world?.name||c?.name;return oe?`${Q}  ${oe}`:Q}return c?c.name||"Selected world":""},[l,c]),U=u.useCallback((Q,oe="info")=>{P({message:Q,tone:oe})},[]);u.useEffect(()=>{if(!z)return;const Q=setTimeout(()=>P(null),3500);return()=>clearTimeout(Q)},[z]);const k=u.useCallback(async()=>{if(!r||!X)return g(!1),p([]),[];g(!0),S("");try{const Q=await Qr({worldId:X}),oe=Array.isArray(Q)?Q:Array.isArray(Q?.data)?Q.data:[];return p(oe),oe}catch(Q){return console.error(" Failed to load entity types",Q),S(Q.message||"Failed to load entity types"),p([]),[]}finally{g(!1)}},[r,X]);u.useEffect(()=>{if(!(!i||!r)){if(!X){p([]),S(""),g(!1);return}k()}},[i,r,X,k,m]),u.useEffect(()=>{const Q=`${X}:${m}`;H.current!==Q&&(N(!1),_(null),A(""),P(null),p([]),S(""),O(!1),T(""),H.current=Q)},[X,m]);const B=()=>{!D||!Y||e("/entity-types/new")},R=Q=>{D&&(_(Q),A(""),N(!0))},q=Q=>{Q?.id&&e(`/entity-types/${Q.id}/fields`)},G=()=>{N(!1),_(null),A("")},J=async Q=>{if(!j?.id)return A("No entity type selected for editing."),!1;try{O(!0),A(""),await ZR(j.id,Q),U("Entity type updated","success"),G(),await k()}catch(oe){console.error(" Failed to save entity type",oe);const ne=oe.message||"Failed to save entity type";return A(ne),U(ne,"error"),!1}finally{O(!1)}return!0},ie=async Q=>{if(!(!D||!Q?.id||!window.confirm(`Delete entity type "${Q.name}"? This action cannot be undone.`)))try{T(Q.id),await QR(Q.id),U("Entity type deleted","success"),j?.id===Q.id&&G(),await k()}catch(ne){console.error(" Failed to delete entity type",ne),U(ne.message||"Failed to delete entity type","error")}finally{T("")}},Z=Q=>{if(!Q)return"";const oe=new Date(Q);return Number.isNaN(oe.getTime())?"":oe.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},me=h.length;return i?r?a.jsxs("section",{className:"entity-types-page",children:[a.jsxs("div",{className:"entity-types-header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Entity Types"}),l?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"entity-types-subtitle",children:L}),a.jsxs("p",{className:"entity-types-subtitle",children:[me," types defined"]})]}):a.jsx("p",{className:"entity-types-subtitle",children:"Select a campaign or world you own to choose a world context."})]}),a.jsxs("button",{type:"button",className:"btn submit",onClick:B,disabled:!D||C||E||!Y,children:[a.jsx(Va,{size:18})," Add Entity Type"]})]}),!D&&a.jsx("div",{className:"alert info",role:"status",children:"You can view the existing entity types, but only system administrators or the world owner can make changes."}),z&&a.jsx("div",{className:`toast-banner ${z.tone}`,role:"status",children:z.message}),v&&a.jsx("div",{className:"alert error",role:"alert",children:v}),a.jsx("div",{className:"entity-types-table-wrapper",children:Y?y?a.jsx("div",{className:"empty-state",children:"Loading entity types..."}):h.length===0?a.jsx("div",{className:"empty-state",children:"No entity types defined yet."}):a.jsxs("table",{className:"entity-types-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Name"}),a.jsx("th",{children:"Description"}),a.jsx("th",{children:"World"}),a.jsx("th",{children:"Created"}),a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:h.map(Q=>{const oe=Q.createdAt||Q.created_at,ne=Q?.world?.name||Q?.world_name||Q?.worldName||"";return a.jsxs("tr",{children:[a.jsx("td",{children:Q.name}),a.jsx("td",{className:"description-cell",children:Q.description?Q.description:""}),a.jsx("td",{children:ne}),a.jsx("td",{children:Z(oe)}),a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-type-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Manage fields",onClick:()=>q(Q),children:a.jsx(I0,{size:16})}),D&&a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Edit entity type",onClick:()=>R(Q),disabled:C||E===Q.id,children:a.jsx(ar,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete entity type",onClick:()=>ie(Q),disabled:E===Q.id||C,children:a.jsx(ma,{size:16})})]})]})})]},Q.id)})})]}):a.jsx("div",{className:"empty-state",children:"Select a campaign or world you own to view entity types."})}),a.jsx("div",{className:"entity-type-cards",children:Y?y?a.jsx("div",{className:"card-placeholder",children:"Loading entity types..."}):h.length===0?a.jsx("div",{className:"card-placeholder",children:"No entity types defined yet."}):h.map(Q=>{const oe=Q.createdAt||Q.created_at;return a.jsxs("div",{className:"entity-type-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsx("h3",{children:Q.name}),a.jsxs("div",{className:"entity-type-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Manage fields",onClick:()=>q(Q),children:a.jsx(I0,{size:16})}),D&&a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Edit entity type",onClick:()=>R(Q),disabled:C||E===Q.id,children:a.jsx(ar,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete entity type",onClick:()=>ie(Q),disabled:E===Q.id||C,children:a.jsx(ma,{size:16})})]})]})]}),a.jsx("p",{className:"card-description",children:Q.description?Q.description:"No description"}),a.jsxs("p",{className:"card-meta",children:["World: ",Q?.world?.name||Q?.world_name||""]}),a.jsxs("p",{className:"card-meta",children:["Created ",Z(oe)]})]},`card-${Q.id}`)}):a.jsx("div",{className:"card-placeholder",children:"Select a campaign or world you own to view entity types."})}),w&&a.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"side-panel",children:[a.jsxs("div",{className:"side-panel-header",children:[a.jsx("h2",{children:j?"Edit Entity Type":"Add Entity Type"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:G,title:"Close form",disabled:C,children:a.jsx(ka,{size:18})})]}),a.jsx("div",{className:"side-panel-content",children:a.jsx(lI,{initialData:j,onSubmit:J,onCancel:G,submitting:C,errorMessage:M,worlds:V})})]})})]}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const uI=[{value:"text",label:"Text"},{value:"number",label:"Number"},{value:"boolean",label:"Boolean"},{value:"date",label:"Date"},{value:"enum",label:"Enum"},{value:"reference",label:"Reference"}];function dI({initialData:e={},referenceTypes:t=[],onSubmit:r,onCancel:i,submitting:l=!1,errorMessage:c}){const[f,m]=u.useState({name:"",label:"",data_type:"text",required:!1,visibleByDefault:!0,enumChoices:"",reference_type_id:"",reference_filter:""}),[h,p]=u.useState("");u.useEffect(()=>{if(!e){m({name:"",label:"",data_type:"text",required:!1,visibleByDefault:!0,enumChoices:"",reference_type_id:"",reference_filter:""}),p("");return}const N=Array.isArray(e.options?.choices)?e.options.choices.join(", "):typeof e.options=="string"?e.options:"",j=e.reference_filter?typeof e.reference_filter=="string"?e.reference_filter:JSON.stringify(e.reference_filter,null,2):"";m({name:e.name||"",label:e.label||"",data_type:e.data_type||"text",required:!!e.required,visibleByDefault:e.visibleByDefault!==void 0?!!e.visibleByDefault:e.visible_by_default!==void 0?!!e.visible_by_default:!0,enumChoices:N,reference_type_id:e.reference_type_id||"",reference_filter:j}),p("")},[e]),u.useEffect(()=>{p(c||"")},[c]);const y=f.data_type==="enum",g=f.data_type==="reference",v=u.useMemo(()=>t.map(N=>({value:N.id,label:N.name})),[t]),S=N=>j=>{const{value:_,type:C,checked:O}=j.target;m(E=>({...E,[N]:C==="checkbox"?O:_}))},w=async N=>{N.preventDefault();const j=f.name.trim(),_=f.label.trim();if(!j){p("Field name is required.");return}if(!_){p("Field label is required.");return}if(!f.data_type){p("Data type is required.");return}let C={};if(g){if(!f.reference_type_id){p("Reference type is required for reference fields.");return}const E=f.reference_filter.trim();if(E)try{if(C=JSON.parse(E),typeof C!="object"||Array.isArray(C))throw new Error("Reference filter must be a JSON object.")}catch(T){p(T.message||"Reference filter must be valid JSON.");return}}const O={name:j,label:_,data_type:f.data_type,required:!!f.required,visible_by_default:!!f.visibleByDefault};if(y){const E=f.enumChoices.split(",").map(T=>T.trim()).filter(Boolean);if(!E.length){p("Enum options are required for enum fields.");return}O.options={choices:E}}else O.options={};g?(O.reference_type_id=f.reference_type_id,O.reference_filter=C):(O.reference_type_id=null,O.reference_filter={});try{if(await r?.(O)===!1)return;p("")}catch(E){p(E.message||"Failed to save field")}};return a.jsxs("form",{className:"entity-type-field-form",onSubmit:w,children:[a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-field-name",children:"Field Name *"}),a.jsx("input",{id:"entity-field-name",type:"text",value:f.name,onChange:S("name"),placeholder:"e.g. alignment",disabled:l})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-field-label",children:"Label *"}),a.jsx("input",{id:"entity-field-label",type:"text",value:f.label,onChange:S("label"),placeholder:"e.g. Alignment",disabled:l})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-field-data-type",children:"Data Type *"}),a.jsx("select",{id:"entity-field-data-type",value:f.data_type,onChange:S("data_type"),disabled:l,children:uI.map(N=>a.jsx("option",{value:N.value,children:N.label},N.value))}),a.jsx("p",{className:"field-hint",children:"Determines how the value is stored and rendered in entity forms."})]}),a.jsxs("div",{className:"form-group checkbox-group",children:[a.jsxs("div",{className:"checkbox-control",children:[a.jsx("input",{id:"entity-field-required",type:"checkbox",checked:f.required,onChange:S("required"),disabled:l}),a.jsx("label",{htmlFor:"entity-field-required",children:"Required"})]}),a.jsx("span",{className:"field-hint",children:"Mark as required on entity forms."})]}),a.jsxs("div",{className:"form-group checkbox-group",children:[a.jsxs("div",{className:"checkbox-control",children:[a.jsx("input",{id:"entity-field-visible-default",type:"checkbox",checked:f.visibleByDefault,onChange:S("visibleByDefault"),disabled:l}),a.jsx("label",{htmlFor:"entity-field-visible-default",children:"Visible by default"})]}),a.jsx("span",{className:"field-hint",children:"Uncheck to hide this field unless a rule explicitly shows it."})]}),y&&a.jsxs("div",{className:"form-group form-group-full",children:[a.jsx("label",{htmlFor:"entity-field-options",children:"Enum Options *"}),a.jsx("textarea",{id:"entity-field-options",value:f.enumChoices,onChange:S("enumChoices"),placeholder:"Comma separated values, e.g. Lawful Good, Neutral, Chaotic Evil",rows:3,disabled:l}),a.jsx("p",{className:"field-hint",children:"Comma-separated list of allowed values."})]}),g&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group form-group-full",children:[a.jsx("label",{htmlFor:"entity-field-reference-type",children:"Reference Type *"}),a.jsxs("select",{id:"entity-field-reference-type",value:f.reference_type_id,onChange:S("reference_type_id"),disabled:l,children:[a.jsx("option",{value:"",children:"Select entity type"}),v.map(N=>a.jsx("option",{value:N.value,children:N.label},N.value))]}),a.jsx("p",{className:"field-hint",children:"Choose which entity type this field should reference."})]}),a.jsxs("div",{className:"form-group form-group-full",children:[a.jsx("label",{htmlFor:"entity-field-reference-filter",children:"Reference Filter"}),a.jsx("textarea",{id:"entity-field-reference-filter",value:f.reference_filter,onChange:S("reference_filter"),placeholder:'Optional JSON filter, e.g. {"metadata.subtype": "Town"}',rows:4,disabled:l}),a.jsx("p",{className:"field-hint",children:"Limit selectable entities by filter criteria."})]})]})]}),h&&a.jsx("div",{className:"form-error",role:"alert",children:h}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:i,disabled:l,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:l,children:l?"Saving...":"Save Field"})]})]})}const fI=[{value:"equals",label:"Equals"},{value:"not_equals",label:"Does not equal"},{value:"contains",label:"Contains"},{value:"not_contains",label:"Does not contain"},{value:"in",label:"Is one of"},{value:"not_in",label:"Is not one of"},{value:"gt",label:"Greater than"},{value:"gte",label:"Greater than or equal"},{value:"lt",label:"Less than"},{value:"lte",label:"Less than or equal"},{value:"is_set",label:"Has a value"},{value:"is_not_set",label:"Is empty"}],mI=[{value:"show",label:"Show field"},{value:"hide",label:"Hide field"}],hI=[{value:"all",label:"All conditions must match"},{value:"any",label:"Any condition can match"},{value:"none",label:"None of the conditions can match"}],pI=new Set(["is_set","is_not_set"]),Qp=()=>({field:"",operator:"equals",valuesText:""}),Jp=()=>({target:"",action:"show"}),yI=(e=[])=>Array.isArray(e)?e.map((t,r)=>{if(t==null)return null;if(typeof t=="object"){const l=t.value??t.id??t.key??t.slug??`choice-${r}`;if(l==null)return null;const c=t.label??t.name??t.title??t.display??l;return{value:String(l),label:String(c??l)}}const i=String(t);return{value:i,label:i}}).filter(Boolean):[],gI=(e=[])=>!Array.isArray(e)||!e.length?[Qp()]:e.map(t=>({field:t.field||t.fieldKey||"",operator:t.operator||"equals",valuesText:Array.isArray(t.values)?t.values.join(", "):""})),bI=(e=[])=>!Array.isArray(e)||!e.length?[Jp()]:e.map(t=>({target:t.target||t.field||"",action:t.action||"show"})),up=e=>e.split(",").map(t=>t.trim()).filter(t=>t.length>0);function vI({fields:e=[],initialData:t=null,onSubmit:r,onCancel:i,submitting:l=!1,errorMessage:c=""}){const[f,m]=u.useState(""),[h,p]=u.useState("all"),[y,g]=u.useState([Qp()]),[v,S]=u.useState([Jp()]),[w,N]=u.useState("");u.useEffect(()=>{m(t?.name||""),p(t?.match_mode||t?.matchMode||"all"),g(gI(t?.conditions)),S(bI(t?.actions))},[t]),u.useEffect(()=>{N(c||"")},[c]);const j=u.useMemo(()=>e.map(H=>({value:H.id||H.name,label:H.label||H.name})),[e]),_=u.useMemo(()=>{const H=new Map;return e.forEach(Y=>{if(!Y)return;const V=I=>{if(I==null)return;const F=String(I);F&&(H.set(F,Y),H.set(F.toLowerCase(),Y))};V(Y.id),V(Y.field_id),V(Y.fieldId),V(Y.name),V(Y.key)}),H},[e]),C=u.useCallback(H=>{if(H==null)return null;const Y=String(H);return _.get(Y)||_.get(Y.toLowerCase())||null},[_]),O=(H,Y,V)=>{g(I=>{const F=I.slice();return F[H]={...F[H],[Y]:V},F})},E=(H,Y,V)=>{S(I=>{const F=I.slice();return F[H]={...F[H],[Y]:V},F})},T=()=>g(H=>[...H,Qp()]),M=H=>g(Y=>Y.length===1?Y:Y.filter((V,I)=>I!==H)),A=()=>S(H=>[...H,Jp()]),z=H=>S(Y=>Y.length===1?Y:Y.filter((V,I)=>I!==H)),P=u.useCallback((H,Y)=>{g(V=>{if(!Array.isArray(V)||H<0||H>=V.length)return V;const I=V.slice(),F=I[H];if(!F)return V;const D=up(F.valuesText||""),L=String(Y);let U;return D.includes(L)?U=D.filter(k=>k!==L):U=[...D,L],I[H]={...F,valuesText:U.join(", ")},I})},[]),X=async H=>{if(H.preventDefault(),!y.length){N("Add at least one condition.");return}if(!v.length){N("Add at least one action.");return}const Y=y.map(F=>({field:F.field,operator:F.operator,values:up(F.valuesText||"")})).filter(F=>F.field&&F.operator);if(!Y.length){N("Each condition needs a field and operator.");return}const V=v.map(F=>({target:F.target,action:F.action})).filter(F=>F.target&&F.action);if(!V.length){N("Each action needs a target and action type.");return}const I={name:f.trim(),match_mode:h,conditions:Y,actions:V};try{if(await r?.(I)===!1)return;N("")}catch(F){N(F.message||"Failed to save rule")}};return a.jsxs("form",{className:"field-rule-form",onSubmit:X,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"field-rule-name",children:"Rule Name"}),a.jsx("input",{id:"field-rule-name",type:"text",value:f,onChange:H=>m(H.target.value),placeholder:"e.g. Show hometown when origin is set",disabled:l})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"field-rule-match-mode",children:"When should this rule run?"}),a.jsx("select",{id:"field-rule-match-mode",value:h,onChange:H=>p(H.target.value),disabled:l,children:hI.map(H=>a.jsx("option",{value:H.value,children:H.label},H.value))})]}),a.jsxs("div",{className:"field-rule-editor-section",children:[a.jsxs("div",{className:"field-rule-editor-heading",children:[a.jsx("h3",{children:"Conditions"}),a.jsx("button",{type:"button",className:"btn ghost",onClick:T,disabled:l,children:"Add condition"})]}),a.jsx("p",{className:"field-hint",children:"Fields to watch before applying the actions."}),a.jsx("div",{className:"field-rule-list",role:"list",children:y.map((H,Y)=>a.jsxs("div",{className:"field-rule-row",role:"listitem",children:[a.jsxs("select",{value:H.field,onChange:V=>O(Y,"field",V.target.value),disabled:l,children:[a.jsx("option",{value:"",children:"Choose field"}),j.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))]}),a.jsx("select",{value:H.operator,onChange:V=>O(Y,"operator",V.target.value),disabled:l,children:fI.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))}),(()=>{const V=C(H.field),F=(V?.data_type||V?.dataType)==="enum"?yI(V?.options?.choices):[],D=pI.has(H.operator);if(!D&&F.length>0){const U=new Set(up(H.valuesText||""));return a.jsx("div",{className:"field-rule-enum-values",role:"group","aria-label":"Enum choices",children:F.map(k=>a.jsxs("label",{className:"field-rule-enum-option",children:[a.jsx("input",{type:"checkbox",checked:U.has(k.value),onChange:()=>P(Y,k.value),disabled:l}),a.jsx("span",{children:k.label})]},`${k.value}-${Y}`))})}return a.jsx("input",{type:"text",value:H.valuesText,onChange:U=>O(Y,"valuesText",U.target.value),placeholder:"Comma separated values",disabled:l||D})})(),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>M(Y),disabled:y.length===1||l,title:"Remove condition",children:""})]},`condition-${Y}`))})]}),a.jsxs("div",{className:"field-rule-editor-section",children:[a.jsxs("div",{className:"field-rule-editor-heading",children:[a.jsx("h3",{children:"Actions"}),a.jsx("button",{type:"button",className:"btn ghost",onClick:A,disabled:l,children:"Add action"})]}),a.jsx("p",{className:"field-hint",children:"Choose what should happen when the conditions above match."}),a.jsx("div",{className:"field-rule-list",role:"list",children:v.map((H,Y)=>a.jsxs("div",{className:"field-rule-row",role:"listitem",children:[a.jsxs("select",{value:H.target,onChange:V=>E(Y,"target",V.target.value),disabled:l,children:[a.jsx("option",{value:"",children:"Choose field"}),j.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))]}),a.jsx("select",{value:H.action,onChange:V=>E(Y,"action",V.target.value),disabled:l,children:mI.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>z(Y),disabled:v.length===1||l,title:"Remove action",children:""})]},`action-${Y}`))})]}),w&&a.jsx("div",{className:"form-error",role:"alert",children:w}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:i,disabled:l,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:l,children:l?"Saving":"Save Rule"})]})]})}const xI=new Set(["system_admin"]),dp={text:"Text",number:"Number",boolean:"Boolean",date:"Date",enum:"Enum",reference:"Reference"},SI={equals:"equals",not_equals:"does not equal",contains:"contains",not_contains:"does not contain",in:"is one of",not_in:"is not one of",gt:"is greater than",gte:"is greater than or equal to",lt:"is less than",lte:"is less than or equal to",is_set:"is set",is_not_set:"is empty"},wI={show:"Show",hide:"Hide"},NS={all:"All conditions must match",any:"Any condition can match",none:"No conditions can match"};function NI(){const{id:e}=xs(),t=$n(),{user:r,token:i,sessionReady:l}=En(),[c,f]=u.useState(null),[m,h]=u.useState([]),[p,y]=u.useState([]),[g,v]=u.useState(!1),[S,w]=u.useState(!1),[N,j]=u.useState(""),[_,C]=u.useState(""),[O,E]=u.useState(!1),[T,M]=u.useState(null),[A,z]=u.useState(!1),[P,X]=u.useState(""),[H,Y]=u.useState(""),[V,I]=u.useState(null),[F,D]=u.useState([]),[L,U]=u.useState([]),[k,B]=u.useState([]),[R,q]=u.useState(!1),[G,J]=u.useState(!1),[ie,Z]=u.useState(""),[me,Q]=u.useState(!1),[oe,ne]=u.useState(!1),[we,ke]=u.useState(""),[Re,Te]=u.useState(!1),[rt,He]=u.useState(null),[tt,Ie]=u.useState(!1),[vt,Ct]=u.useState(""),[At,_t]=u.useState(""),[Pe,Ze]=u.useState(""),W=c?.name||"Entity Type",ee=u.useMemo(()=>!c||!r?!1:xI.has(r.role)||c.world_owner_id&&c.world_owner_id===r.id||c.created_by&&c.created_by===r.id?!0:Array.isArray(c.managers)?c.managers.some(ce=>ce===r.id):!1,[c,r]),te=ce=>{if(!ce)return"";const{options:re}=ce;return re?Array.isArray(re.choices)&&re.choices.length>0?re.choices.join(", "):typeof re=="string"&&re.trim()?re:"":""},ve=u.useCallback((ce,re="info")=>{I({message:ce,tone:re})},[]);u.useEffect(()=>{if(!V)return;const ce=setTimeout(()=>I(null),3500);return()=>clearTimeout(ce)},[V]);const le=ce=>ce?Array.isArray(ce)?ce:ce?.data?ce.data:ce:null,Se=u.useCallback(async()=>{if(e){v(!0),j("");try{const ce=await WR(e),re=le(ce);f(re)}catch(ce){console.error(" Failed to load entity type details",ce),j(ce.message||"Failed to load entity type")}finally{v(!1)}}},[e]),Ee=u.useCallback(async ce=>{const re=typeof ce=="string"?ce.trim():ce||"";if(!re){h([]);return}try{const Ne=await Qr({worldId:re}),Be=le(Ne);Array.isArray(Be)?h(Be):h([])}catch(Ne){console.error(" Failed to load reference types",Ne),h([])}},[]),ge=u.useCallback(async()=>{if(e){w(!0),C("");try{const ce=await iN(e),re=le(ce);y(Array.isArray(re)?re:[])}catch(ce){console.error(" Failed to load fields",ce),C(ce.message||"Failed to load fields"),y([])}finally{w(!1)}}},[e]),at=u.useCallback(async()=>{if(e){Q(!0),ne(!0),Z(""),ke("");try{const[ce,re]=await Promise.all([of(e).catch(Ne=>(console.error(" Failed to load field order",Ne),Z(Ne.message||"Failed to load field order"),null)),cf(e).catch(Ne=>(console.error(" Failed to load field rules",Ne),ke(Ne.message||"Failed to load conditional rules"),null))]);D(Gr(ce)),U(Gr(re))}catch(ce){Z(ce.message||"Failed to load field order"),ke(ce.message||"Failed to load conditional rules"),D([]),U([])}finally{Q(!1),ne(!1)}}},[e]);u.useEffect(()=>{!l||!i||(Se(),ge(),at())},[l,i,Se,ge,at]),u.useEffect(()=>{if(!c){h([]);return}const ce=c?.world_id||c?.worldId||c?.world?.id||"";Ee(ce)},[c,c?.world_id,c?.worldId,c?.world?.id,Ee]),u.useEffect(()=>{l&&(i||t("/login"))},[l,i,t]);const st=u.useCallback(()=>!Array.isArray(p)||p.length===0?[]:Hy(p,F).map((re,Ne)=>({id:re.id,name:re.name,label:re.label||re.name,data_type:re.data_type,required:re.required,order:Ne})),[p,F]);u.useEffect(()=>{R||B(st())},[st,R]);const nt=u.useCallback(()=>{q(!1),B(st())},[st]),$e=u.useMemo(()=>{const ce=new Map;return p.forEach(re=>{if(!re)return;const Ne=re.label||re.name||"Field";re.id&&(ce.set(re.id,Ne),ce.set(String(re.id).toLowerCase(),Ne)),re.name&&(ce.set(re.name,Ne),ce.set(re.name.toLowerCase(),Ne))}),ce},[p]),ft=u.useCallback(ce=>{if(!ce)return"";const re=$e.get(ce.field)||ce.field,Ne=SI[ce.operator]||ce.operator,Be=Array.isArray(ce.values)?ce.values.filter(Boolean):[];return!Be.length||["is_set","is_not_set"].includes(ce.operator)?`${re} ${Ne}`:`${re} ${Ne} ${Be.join(", ")}`},[$e]),zt=u.useCallback(ce=>{if(!ce)return"";const re=$e.get(ce.target)||ce.target;return`${wI[ce.action]||ce.action} ${re}`},[$e]),Rt=()=>{ee&&(M(null),Y(""),E(!0))},pt=ce=>{ee&&(M(ce),Y(""),E(!0))},ct=()=>{E(!1),M(null),Y("")},yt=async ce=>{if(!ee)return!1;try{z(!0),Y(""),T?.id?(await U3(T.id,ce),ve("Field updated","success")):(await F3(e,ce),ve("Field created","success")),ct(),await ge(),await at()}catch(re){console.error(" Failed to save field",re);const Ne=re.message||"Failed to save field";return Y(Ne),ve(Ne,"error"),!1}finally{z(!1)}return!0},Mt=async ce=>{if(!(!ee||!ce?.id||!window.confirm(`Delete field "${ce.label||ce.name}"? This action cannot be undone.`)))try{X(ce.id),await B3(ce.id),ve("Field deleted","success"),await ge(),await at()}catch(Ne){console.error(" Failed to delete field",Ne),ve(Ne.message||"Failed to delete field","error")}finally{X("")}},Ft=(ce,re)=>{B(Ne=>{const Be=ce+re;if(Be<0||Be>=Ne.length)return Ne;const Ke=Ne.slice(),[ot]=Ke.splice(ce,1);return Ke.splice(Be,0,ot),Ke.map((ze,ue)=>({...ze,order:ue}))}),q(!0)},kt=async()=>{if(!(!ee||!R)){J(!0);try{const ce=k.map((re,Ne)=>({field_id:re.id,section_order:0,column_order:0,field_order:Ne,priority:Ne}));await JR(e,{entries:ce}),ve("Field order updated","success"),q(!1),await at()}catch(ce){const re=ce.message||"Failed to update field order";Z(re),ve(re,"error")}finally{J(!1)}}},Zt=(ce=null)=>{ee&&(He(ce),Ct(""),Te(!0))},Lt=()=>{Te(!1),He(null),Ct("")},Kt=async ce=>{if(!ee)return!1;try{Ie(!0),Ct(""),rt?.id?(await zh(rt.id,ce),ve("Rule updated","success")):(await ek(e,ce),ve("Rule created","success")),Lt(),await at()}catch(re){const Ne=re.message||"Failed to save rule";return Ct(Ne),ve(Ne,"error"),!1}finally{Ie(!1)}return!0},se=async ce=>{if(!(!ee||!ce?.id||!window.confirm(`Delete the rule "${ce.name||"Untitled rule"}"?`)))try{_t(ce.id),await tk(ce.id),ve("Rule deleted","success"),await at()}catch(Ne){ve(Ne.message||"Failed to delete rule","error")}finally{_t("")}},be=async(ce,re)=>{if(!ee||!ce?.id)return;const Ne=L.findIndex(ot=>ot.id===ce.id),Be=Ne+re;if(Ne===-1||Be<0||Be>=L.length)return;const Ke=L[Be];try{Ze(ce.id),await Promise.all([zh(ce.id,{priority:Be}),zh(Ke.id,{priority:Ne})]),ve("Rule order updated","success"),await at()}catch(ot){ve(ot.message||"Failed to reorder rule","error")}finally{Ze("")}},je=ce=>{if(!ce)return"";const re=new Date(ce);return Number.isNaN(re.getTime())?"":re.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},We=u.useMemo(()=>{const ce=new Map;return m.forEach(re=>{re?.id&&ce.set(re.id,re.name)}),ce},[m]),dt=u.useMemo(()=>!Array.isArray(m)||!m.length?[]:c?.world_id?m.filter(ce=>{if(!ce)return!1;if(!c.world_id)return!0;const re=ce.world_id??ce.worldId??ce.world?.id;return re?re===c.world_id:!0}):m,[c,m]),gt=N||_;return l?i?a.jsxs("section",{className:"entity-type-fields-page",children:[a.jsxs("div",{className:"entity-type-fields-header",children:[a.jsxs("div",{className:"entity-type-fields-heading",children:[a.jsxs("button",{type:"button",className:"link-button",onClick:()=>t("/entity-types"),children:[a.jsx(Ry,{size:16})," Back to Entity Types"]}),a.jsxs("h1",{children:["Fields for ",W]}),c?.world_name&&a.jsxs("p",{className:"entity-type-fields-subtitle",children:["World: ",c.world_name]})]}),ee&&a.jsxs("button",{type:"button",className:"btn submit",onClick:Rt,disabled:A||P,children:[a.jsx(Va,{size:18})," Add Field"]})]}),!ee&&a.jsx("div",{className:"alert info",role:"status",children:"You can view these fields, but only the world owner or system administrators can make changes."}),V&&a.jsx("div",{className:`toast-banner ${V.tone}`,role:"status",children:V.message}),gt&&a.jsx("div",{className:"alert error",role:"alert",children:gt}),a.jsx("div",{className:"entity-types-table-wrapper",children:g||S?a.jsx("div",{className:"empty-state",children:"Loading fields..."}):p.length===0?a.jsx("div",{className:"empty-state",children:"No custom fields defined yet."}):a.jsxs("table",{className:"entity-types-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Field Name"}),a.jsx("th",{children:"Label"}),a.jsx("th",{children:"Data Type"}),a.jsx("th",{children:"Reference Type"}),a.jsx("th",{children:"Required"}),a.jsx("th",{children:"Created"}),ee&&a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:p.map(ce=>{const re=ce.createdAt||ce.created_at,Ne=ce.reference_type_name||We.get(ce.reference_type_id),Be=dp[ce.data_type]||ce.data_type;return a.jsxs("tr",{children:[a.jsx("td",{children:ce.name}),a.jsx("td",{children:ce.label||""}),a.jsx("td",{children:Be}),a.jsx("td",{children:Ne||(ce.data_type==="reference"?"":"N/A")}),a.jsx("td",{children:ce.required?"Yes":"No"}),a.jsx("td",{children:je(re)}),ee&&a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-type-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Edit field",onClick:()=>pt(ce),disabled:A||P===ce.id,children:a.jsx(ar,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete field",onClick:()=>Mt(ce),disabled:P===ce.id||A,children:a.jsx(ma,{size:16})})]})})]},ce.id)})})]})}),a.jsxs("section",{className:"field-layout-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsxs("h2",{children:[a.jsx(w1,{size:18})," Field order"]}),ee&&a.jsxs("div",{className:"layout-card-actions",children:[a.jsx("button",{type:"button",className:"btn ghost",onClick:nt,disabled:G||!R,children:"Reset"}),a.jsx("button",{type:"button",className:"btn submit",onClick:kt,disabled:G||!R||k.length===0,children:G?"Saving":"Save order"})]})]}),a.jsx("p",{className:"card-description",children:"Use this list to control how the metadata fields appear on entity forms and detail pages."}),ie&&a.jsx("div",{className:"alert error",role:"alert",children:ie}),me?a.jsx("div",{className:"card-placeholder",children:"Loading layout"}):k.length===0?a.jsx("div",{className:"card-placeholder",children:"No fields available to order yet."}):a.jsx("ol",{className:"field-layout-list",children:k.map((ce,re)=>a.jsxs("li",{className:"field-layout-row",children:[a.jsxs("div",{className:"field-layout-info",children:[a.jsx("span",{className:"field-layout-index",children:re+1}),a.jsxs("div",{className:"field-layout-details",children:[a.jsx("span",{className:"field-layout-name",children:ce.label||ce.name}),a.jsx("span",{className:"field-layout-meta",children:dp[ce.data_type]||ce.data_type})]})]}),ee&&a.jsxs("div",{className:"layout-controls",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Ft(re,-1),disabled:re===0||G,title:"Move up",children:a.jsx(T0,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Ft(re,1),disabled:re===k.length-1||G,title:"Move down",children:a.jsx(A0,{size:16})})]})]},ce.id||ce.name||re))})]}),a.jsxs("section",{className:"field-rules-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsxs("h2",{children:[a.jsx(Ii,{size:18})," Conditional rules"]}),ee&&a.jsxs("button",{type:"button",className:"btn submit",onClick:()=>Zt(null),disabled:tt,children:[a.jsx(Va,{size:16})," Add rule"]})]}),a.jsx("p",{className:"card-description",children:"Automatically show or hide fields when other metadata matches specific conditions."}),we&&a.jsx("div",{className:"alert error",role:"alert",children:we}),oe?a.jsx("div",{className:"card-placeholder",children:"Loading rules"}):L.length===0?a.jsx("div",{className:"card-placeholder",children:"No conditional rules have been configured."}):a.jsx("div",{className:"field-rules-list",children:L.map((ce,re)=>a.jsxs("article",{className:"field-rule-card",children:[a.jsxs("div",{className:"field-rule-content",children:[a.jsx("h3",{children:ce.name||`Rule ${re+1}`}),a.jsx("p",{className:"field-rule-match",children:NS[ce.match_mode]||NS.all}),a.jsx("ul",{className:"field-rule-condition-list",children:Array.isArray(ce.conditions)&&ce.conditions.map((Ne,Be)=>a.jsx("li",{children:ft(Ne)},`condition-${ce.id}-${Be}`))}),a.jsx("div",{className:"field-rule-action-list",children:Array.isArray(ce.actions)&&ce.actions.map((Ne,Be)=>a.jsx("span",{children:zt(Ne)},`action-${ce.id}-${Be}`))})]}),ee&&a.jsxs("div",{className:"field-rule-controls",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>be(ce,-1),disabled:re===0||Pe===ce.id,title:"Move rule up",children:a.jsx(T0,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>be(ce,1),disabled:re===L.length-1||Pe===ce.id,title:"Move rule down",children:a.jsx(A0,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Zt(ce),title:"Edit rule",disabled:tt||At===ce.id,children:a.jsx(ar,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>se(ce),title:"Delete rule",disabled:At===ce.id||tt,children:a.jsx(ma,{size:16})})]})]},ce.id))})]}),a.jsx("div",{className:"entity-type-cards",children:g||S?a.jsx("div",{className:"card-placeholder",children:"Loading fields..."}):p.length===0?a.jsx("div",{className:"card-placeholder",children:"No custom fields defined yet."}):p.map(ce=>{const re=ce.createdAt||ce.created_at,Ne=ce.reference_type_name||We.get(ce.reference_type_id),Be=dp[ce.data_type]||ce.data_type;return a.jsxs("div",{className:"entity-type-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsx("h3",{children:ce.label||ce.name}),ee&&a.jsxs("div",{className:"entity-type-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Edit field",onClick:()=>pt(ce),disabled:A||P===ce.id,children:a.jsx(ar,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete field",onClick:()=>Mt(ce),disabled:P===ce.id||A,children:a.jsx(ma,{size:16})})]})]}),a.jsxs("dl",{className:"field-card-metadata",children:[a.jsxs("div",{children:[a.jsx("dt",{children:"Field Name"}),a.jsx("dd",{children:ce.name})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Data Type"}),a.jsx("dd",{children:Be})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Required"}),a.jsx("dd",{children:ce.required?"Yes":"No"})]}),ce.data_type==="enum"&&a.jsxs("div",{children:[a.jsx("dt",{children:"Options"}),a.jsx("dd",{children:te(ce)})]}),ce.data_type==="reference"&&a.jsxs("div",{children:[a.jsx("dt",{children:"Reference Type"}),a.jsx("dd",{children:Ne||""})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Created"}),a.jsx("dd",{children:je(re)})]})]})]},`field-card-${ce.id}`)})}),O&&a.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"side-panel",children:[a.jsxs("div",{className:"side-panel-header",children:[a.jsx("h2",{children:T?"Edit Field":"Add Field"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:ct,title:"Close form",disabled:A,children:a.jsx(ka,{size:18})})]}),a.jsx("div",{className:"side-panel-content",children:a.jsx(dI,{initialData:T,referenceTypes:dt,onSubmit:yt,onCancel:ct,submitting:A,errorMessage:H})})]})}),Re&&a.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"side-panel",children:[a.jsxs("div",{className:"side-panel-header",children:[a.jsx("h2",{children:rt?"Edit conditional rule":"Add conditional rule"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:Lt,title:"Close form",disabled:tt,children:a.jsx(ka,{size:18})})]}),a.jsx("div",{className:"side-panel-content",children:a.jsx(vI,{fields:p,initialData:rt,onSubmit:Kt,onCancel:Lt,submitting:tt,errorMessage:vt})})]})})]}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const EI="Create Entity Type",jI=[{title:"Details",columns:1,fields:[{key:"name",label:"Name",type:"text",placeholder:"e.g. Faction"},{key:"world_id",label:"World",type:"select",optionsSource:"worlds",placeholder:"Select the world this type belongs to",required:!0},{key:"description",label:"Description",type:"textarea",placeholder:"Optional description for this entity type"}]}],_I={title:EI,sections:jI};function CI(){const e=$n(),{user:t,token:r,sessionReady:i}=En(),{selectedCampaign:l}=Bn(),[c,f]=u.useState(!1),m=u.useMemo(()=>{if(!l?.world)return"";const w=l.world;return w.created_by||w.creator?.id||w.owner_id||w.owner?.id||""},[l]),h=!!(t?.id&&m===t.id),p=u.useMemo(()=>t?t.role==="system_admin"?!0:h:!1,[t,h]),y=l?.world?.id??"",g=l?.world?.name??"";if(!i)return a.jsx("p",{children:"Restoring session..."});if(!r)return a.jsx("p",{children:"Authenticating..."});if(!p)return a.jsxs("section",{className:"page limited-access",children:[a.jsx("h1",{children:"Create Entity Type"}),a.jsx("p",{children:"Only system administrators or the world owner can create entity types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/entity-types"),children:"Back to Entity Types"})]});if(!y)return a.jsxs("section",{className:"page create-entity-type",children:[a.jsx("h1",{children:"Create Entity Type"}),a.jsx("p",{children:"Select a campaign from the header to choose a world context before creating entity types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/entity-types"),children:"Back to Entity Types"})]});const v=()=>{e("/entity-types")},S=async w=>{if(c)return!1;const N=typeof w?.name=="string"?w.name.trim():"",j=typeof w?.description=="string"?w.description.trim():"",C=(typeof w?.world_id=="string"&&w.world_id||typeof w?.worldId=="string"&&w.worldId||w?.world&&typeof w.world.id=="string"&&w.world.id||y||"").trim();if(!N)return alert("Name is required"),!1;if(!C)return alert("Select a world before creating the entity type"),!1;f(!0);try{const E=await KR({name:N,description:j,world_id:C}),T=E?.data??E;return!T||!T.id?(alert("Failed to create entity type"),!1):(e(`/entity-types/${T.id}/fields`),!0)}catch(O){return alert(`Failed to create entity type: ${O.message}`),!1}finally{f(!1)}};return a.jsxs("section",{className:"page create-entity-type",children:[c&&a.jsx("div",{className:"form-status",role:"status","aria-live":"polite",children:"Saving entity type..."}),a.jsx(ys,{schema:_I,initialData:{world_id:y,world:y?{id:y,name:g||"Selected world"}:void 0},onSubmit:S,onCancel:v,showUpdateAction:!1})]})}const IN=u.createContext({}),AI=new Set(["true","1","yes","on"]),ES=e=>{if(e==null)return;if(typeof e=="boolean")return e;const t=String(e).trim().toLowerCase();if(t!=="")return AI.has(t)},TI=e=>{const t=ES(e);if(t!==void 0)return t;const r=ES(void 0);return r!==void 0?r:!1};function MI({children:e,initialFeatures:t={}}){const r=TI(t.rel_builder_v2),i=u.useMemo(()=>({...t,rel_builder_v2:r}),[t,r]);return a.jsx(IN.Provider,{value:i,children:e})}const RI=()=>u.useContext(IN),kI=e=>!!RI()?.[e],DI="visible",II=e=>{if(!e)return null;const t=e.id??e.value??e.entity_type_id??e.entityTypeId??(typeof e=="string"||typeof e=="number"?e:null);if(t==null||t==="")return null;const r=e.name||e.label||e.title||e.display||e.slug||(typeof e=="string"||typeof e=="number"?String(e):"Untitled type");return{id:String(t),name:String(r)}};function jS({allowedTypeIds:e=[],defaultTypeId:t="",worldId:r,onCreated:i,onCancel:l,entityTypes:c=[],onToast:f}){const[m,h]=u.useState({name:"",entityTypeId:"",summary:""}),[p,y]=u.useState(!1),[g,v]=u.useState(""),[S,w]=u.useState(""),N=u.useRef(!1),j=u.useMemo(()=>new Set((e||[]).map(A=>String(A))),[e]),_=u.useMemo(()=>{const A=(Array.isArray(c)?c:[]).map(z=>II(z)).filter(Boolean);return j.size===0?A:A.filter(z=>j.has(z.id))},[c,j]),C=u.useMemo(()=>t&&j.size>0&&j.has(String(t))?String(t):_.length>0?_[0].id:t?String(t):"",[t,j,_]);u.useEffect(()=>{h(A=>({...A,entityTypeId:C}))},[C]);const O=u.useCallback(()=>{h({name:"",entityTypeId:C,summary:""}),v(""),w(""),N.current=!1},[C]),E=A=>z=>{const{value:P}=z.target;h(X=>({...X,[A]:P}))};u.useEffect(()=>{if(!m.entityTypeId){w("");return}j.size>0&&!j.has(String(m.entityTypeId))?(w("This type is not allowed for the selected relationship."),N.current||(f?.("This entity type is not allowed for this relationship.","warning"),N.current=!0)):(w(""),N.current=!1)},[m.entityTypeId,j,f]);const T=async A=>{if(A.preventDefault(),!r){v("Select a world before creating entities.");return}const z=m.name.trim();if(!z){v("Name is required.");return}const P=m.entityTypeId;if(!P){v("Entity type is required.");return}if(j.size>0&&!j.has(String(P))){w("This type is not allowed for the selected relationship."),N.current||(f?.("This entity type is not allowed for this relationship.","warning"),N.current=!0);return}try{y(!0),v("");const X={world_id:r,name:z,entity_type_id:P,visibility:DI},H=m.summary.trim();H&&(X.description=H);const Y=await Uy(X),V=Y?.data?.data??Y?.data??Y;if(!V||V.id===void 0||V.id===null)throw new Error("Failed to create entity");i?.(V),O()}catch(X){v(X.message||"Could not create entity. Please try again."),f?.("Could not create entity. Please try again.","error")}finally{y(!1)}},M=p||!m.name.trim()||!m.entityTypeId||j.size>0&&!j.has(String(m.entityTypeId))||_.length===0;return a.jsxs("div",{className:"entity-mini-create-inline",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-mini-name",children:"Name *"}),a.jsx("input",{id:"entity-mini-name",type:"text",value:m.name,onChange:E("name"),disabled:p,required:!0})]}),a.jsxs("div",{className:"form-two-column",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-mini-type",children:"Type *"}),a.jsxs("select",{id:"entity-mini-type",value:m.entityTypeId,onChange:E("entityTypeId"),disabled:p||_.length===0,required:!0,children:[a.jsx("option",{value:"",children:"Select type..."}),_.map(A=>a.jsx("option",{value:A.id,children:A.name},A.id))]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-mini-summary",children:"Summary"}),a.jsx("input",{id:"entity-mini-summary",type:"text",value:m.summary,onChange:E("summary"),placeholder:"Optional short summary",disabled:p})]})]}),(g||S)&&a.jsx("div",{className:`form-error${S?" warning":""}`,role:"alert",children:S||g}),a.jsxs("div",{className:"inline-actions",children:[a.jsx("button",{type:"button",className:"btn secondary",onClick:l,disabled:p,children:"Cancel"}),a.jsx("button",{type:"button",className:"btn",disabled:M,onClick:T,children:p?"Creating":"Save"})]})]})}const LI=[{value:"source",label:"This entity is the source"},{value:"target",label:"This entity is the target"}];function OI({value:e,onChange:t,disabled:r=!1}){const i=l=>{const c=l.target.value==="target"?"target":"source";c!==e&&t?.(c)};return a.jsxs("fieldset",{className:"perspective-toggle",disabled:r,children:[a.jsx("legend",{children:"Relationship Perspective"}),a.jsx("div",{role:"radiogroup","aria-label":"Relationship perspective",className:"perspective-toggle-options",children:LI.map(l=>{const c=["perspective-toggle-option"];return l.value===e&&c.push("active"),r&&c.push("disabled"),a.jsxs("label",{className:c.join(" "),children:[a.jsx("input",{type:"radio",name:"relationship-perspective",value:l.value,checked:e===l.value,onChange:i,disabled:r}),a.jsx("span",{children:l.label})]},l.value)})})]})}const Wu=e=>e==null?"":String(e).trim(),zI=e=>{if(e==null)return"";if(typeof e=="object")try{return JSON.stringify(e)}catch{return""}return String(e)},$I=e=>{const t=e.trim();if(!t)return"";if(t==="true")return!0;if(t==="false")return!1;const r=t[0],i=t[t.length-1];if(r==="{"&&i==="}"||r==="["&&i==="]")try{return JSON.parse(t)}catch{return e}const l=Number(t);return!Number.isNaN(l)&&t!==""?l:e},Zu=e=>{if(!Array.isArray(e)||e.length===0)return"";if(e.length===1)return e[0];if(e.length===2)return`${e[0]} or ${e[1]}`;const t=e.slice(0,-1),r=e[e.length-1];return`${t.join(", ")}, or ${r}`},FI=e=>{if(!e||e.id===void 0||e.id===null)return null;const t=e.entity_type_id??e.entityTypeId??e.entity_type?.id??e.entityType?.id??null,r=e.entityType||e.entity_type||(t&&e.entity_type_name?{id:t,name:e.entity_type_name}:null);return{...e,id:e.id,name:e.name||"Untitled entity",entity_type_id:t,entityType:r}},_S=e=>e?.name||e?.entityType?.name||e?.entity_type?.name||"",Wo=(e,t)=>{if(!e)return[];const r=t==="from"?e?.from_entity_types??e?.fromEntityTypes??e?.fromTypes??[]:e?.to_entity_types??e?.toEntityTypes??e?.toTypes??[];return Array.isArray(r)?r:[]},UI=e=>{if(!e)return"";if(typeof e=="string"||typeof e=="number")return String(e).trim();if(typeof e=="object"){if(e.id!==void 0&&e.id!==null)return String(e.id);if(e.entity_type_id!==void 0&&e.entity_type_id!==null)return String(e.entity_type_id);if(e.entityTypeId!==void 0&&e.entityTypeId!==null)return String(e.entityTypeId);if(e.entityType?.id!==void 0&&e.entityType?.id!==null)return String(e.entityType.id);if(e.entity_type?.id!==void 0&&e.entity_type?.id!==null)return String(e.entity_type.id)}return""},$o=(e,t)=>Wo(e,t).map(r=>UI(r)).filter(r=>r!=="");function BI({worldId:e,relationshipId:t,onCancel:r,onSaved:i,onToast:l,defaultFromEntityId:c,lockFromEntity:f=!1,defaultToEntityId:m,lockToEntity:h=!1,defaultPerspective:p="source",currentEntityId:y,currentEntityTypeId:g,formId:v="relationship-form",onStateChange:S,hideActions:w=!1}){const N=!!t,j=N,_=N,C=u.useRef(0),O=u.useCallback((fe="",he="")=>(C.current+=1,{id:C.current,key:fe,value:he}),[]),E=u.useCallback(fe=>fe.length>0?fe:[O()],[O]),T=u.useCallback(fe=>{if(!fe||typeof fe!="object"||Array.isArray(fe))return"";const he=fe.__direction||fe.direction;return he?String(he):""},[]),M=u.useCallback(fe=>{if(C.current=0,!fe||typeof fe!="object"||Array.isArray(fe))return[O()];const he=Object.entries(fe).filter(([Ve])=>typeof Ve!="string"?!0:!Ve.startsWith("__"));return he.length===0?[O()]:he.map(([Ve,xt])=>O(Ve,zI(xt)))},[O]),A=Wu(c),z=Wu(m),P=Wu(y),X=Wu(g),H=p==="target"?"reverse":"forward",Y=H==="forward"?A:"",V=H==="reverse"?z:"",[I,F]=u.useState([]),[D,L]=u.useState([]),[U,k]=u.useState([]),[B,R]=u.useState({fromEntityId:Y,toEntityId:V,relationshipTypeId:""}),[q,G]=u.useState(()=>(C.current=0,[O()])),[J,ie]=u.useState(H),[Z,me]=u.useState(!1),[Q,oe]=u.useState(!1),[ne,we]=u.useState(!1),[ke,Re]=u.useState(!1),[Te,rt]=u.useState(!1),[He,tt]=u.useState(""),[Ie,vt]=u.useState(""),[Ct,At]=u.useState(null),_t=u.useRef({from:null,to:null}),[Pe,Ze]=u.useState({from:"",to:""}),W=J==="reverse"?"target":"source",ee=W==="source",te=u.useMemo(()=>W==="target"?h?"to":f?"from":"":f?"from":h?"to":"",[f,h,W]),ve=te==="from"?"to":te==="to"?"from":"",le=u.useMemo(()=>q.some(fe=>fe.key.trim()!==""||fe.value.trim()!==""),[q]);u.useEffect(()=>{let fe=!1;return e?((async()=>{me(!0);try{const Ve=await lc(e),xt=Array.isArray(Ve)?Ve:Array.isArray(Ve?.data)?Ve.data:[];fe||F(xt)}catch(Ve){fe||(F([]),tt(Ve.message||"Failed to load entities"))}finally{fe||me(!1)}})(),()=>{fe=!0}):(F([]),()=>{})},[e]),u.useEffect(()=>{let fe=!1;return e?((async()=>{oe(!0);try{const Ve=await pf({worldId:e}),xt=Array.isArray(Ve)?Ve:Array.isArray(Ve?.data)?Ve.data:[];fe||L(xt)}catch(Ve){fe||(L([]),tt(Ve.message||"Failed to load relationship types"))}finally{fe||oe(!1)}})(),()=>{fe=!0}):(L([]),oe(!1),()=>{})},[e]),u.useEffect(()=>{let fe=!1;return(async()=>{if(!e){k([]),we(!1);return}we(!0);try{const Ve=await Qr({worldId:e}),xt=Array.isArray(Ve)?Ve:Array.isArray(Ve?.data)?Ve.data:[];fe||k(xt)}catch(Ve){fe||(k([]),tt(xt=>xt||Ve.message||"Failed to load entity types"))}finally{fe||we(!1)}})(),()=>{fe=!0}},[e]);const Se=fe=>{if(!fe)return"";const he=fe.entity_type_id??fe.entityTypeId??fe.entityType?.id??fe.entity_type?.id??"";return he?String(he):""},Ee=u.useMemo(()=>B.fromEntityId&&I.find(fe=>String(fe.id)===String(B.fromEntityId))||null,[I,B.fromEntityId]),ge=u.useMemo(()=>Se(Ee),[Ee]),at=u.useMemo(()=>B.toEntityId&&I.find(fe=>String(fe.id)===String(B.toEntityId))||null,[I,B.toEntityId]),st=u.useMemo(()=>Se(at),[at]),nt=u.useMemo(()=>te==="from"?ge||(P&&B.fromEntityId===P&&X||A&&B.fromEntityId===A&&X?X:""):te==="to"?st||(P&&B.toEntityId===P&&X||z&&B.toEntityId===z&&X?X:""):"",[te,ge,st,B.fromEntityId,B.toEntityId,P,X,A,z]),$e=u.useMemo(()=>J==="reverse"?te==="to"?"from":"to":"from",[J,te]),ft=u.useMemo(()=>J==="reverse"?te==="to"?"to":"from":"to",[J,te]),zt=u.useMemo(()=>{const fe=nt?String(nt):"";if(fe){if(te==="from")return{typeId:fe,role:$e};if(te==="to")return{typeId:fe,role:ft}}return ge?{typeId:String(ge),role:$e}:st?{typeId:String(st),role:ft}:null},[nt,te,ge,st,$e,ft]),Rt=u.useMemo(()=>{if(!D?.length)return[];const fe=(Ve,xt,Nt)=>{if(!Nt)return Ve;const Et=String(Nt);return Ve.filter(jt=>{const Wt=$o(jt,xt);return Wt.length===0?!0:Wt.includes(Et)})};let he=D;if(zt){const{typeId:Ve,role:xt}=zt;he=fe(he,xt,Ve)}return he=fe(he,$e,ge),he=fe(he,ft,st),he},[D,zt,$e,ft,ge,st]),pt=u.useMemo(()=>B.relationshipTypeId?D.find(fe=>String(fe.id)===String(B.relationshipTypeId)):null,[D,B.relationshipTypeId]),ct=u.useMemo(()=>pt?$o(pt,$e):[],[pt,$e]),yt=u.useMemo(()=>pt?$o(pt,ft):[],[pt,ft]),Mt=u.useMemo(()=>ct.length>0?String(ct[0]):"",[ct]),Ft=u.useMemo(()=>yt.length>0?String(yt[0]):"",[yt]),kt=fe=>{const he=fe==="target"?"reverse":"forward";vt(""),J!==he&&R(Ve=>{const xt={...Ve,relationshipTypeId:""};if(!N){const Nt=P||"";if(he==="reverse"){const Et=z||Nt;Et&&(xt.toEntityId=Et,f&&Ve.fromEntityId===Et&&(xt.fromEntityId=""))}else{const Et=A||Nt;Et&&(xt.fromEntityId=Et,h&&Ve.toEntityId===Et&&(xt.toEntityId=""))}}return xt}),ie(Ve=>Ve===he?Ve:he)},Zt=u.useCallback(fe=>{if(fe==="from"){if(te==="from")return;if(!ct.length){l?.("This entity type is not allowed for this relationship.","warning");return}}else{if(te==="to")return;if(!yt.length){l?.("This entity type is not allowed for this relationship.","warning");return}}At(fe)},[ct.length,yt.length,te,l]);u.useEffect(()=>{(Ct==="from"&&ct.length===0||Ct==="to"&&yt.length===0)&&At(null)},[Ct,ct.length,yt.length]);const Lt=u.useMemo(()=>{if(!ct.length)return I;const fe=new Set(ct);return I.filter(he=>fe.has(Se(he)))},[I,ct]),Kt=u.useMemo(()=>{if(!yt.length)return I;const fe=new Set(yt);return I.filter(he=>fe.has(Se(he)))},[I,yt]);u.useEffect(()=>{if(!B.relationshipTypeId)return;Rt.some(he=>String(he.id)===String(B.relationshipTypeId))||R(he=>({...he,relationshipTypeId:""}))},[Rt,B.relationshipTypeId]),u.useEffect(()=>{if(!B.relationshipTypeId||!ge)return;if(f||h||P){vt("");return}const fe=String(ge),he=D.find(jt=>String(jt.id)===String(B.relationshipTypeId));if(!he)return;const Ve=$o(he,"from"),xt=$o(he,"to"),Nt=Ve.includes(fe),Et=xt.includes(fe);if(Nt&&Et){vt("");return}if(Nt&&J!=="forward"){ie("forward"),vt("");return}if(!Nt&&Et){const jt="Direction auto-corrected because this entity is only allowed as a target.";J!=="reverse"?(ie("reverse"),vt(jt)):vt(Wt=>Wt||jt);return}!Nt&&!Et&&(vt(""),R(jt=>({...jt,relationshipTypeId:""})))},[B.relationshipTypeId,ge,D,J,f,h,P]),u.useEffect(()=>{if(!B.fromEntityId||!ct.length)return;const fe=new Set(ct),he=I.find(xt=>String(xt.id)===String(B.fromEntityId));if(!he)return;const Ve=Se(he);(!Ve||!fe.has(Ve))&&R(xt=>({...xt,fromEntityId:""}))},[ct,I,B.fromEntityId]),u.useEffect(()=>{if(!B.toEntityId||!yt.length)return;const fe=new Set(yt),he=I.find(xt=>String(xt.id)===String(B.toEntityId));if(!he)return;const Ve=Se(he);(!Ve||!fe.has(Ve))&&R(xt=>({...xt,toEntityId:""}))},[yt,I,B.toEntityId]);const se=u.useMemo(()=>{if(!pt)return"";const fe=Wo(pt,$e);return fe.length?fe.map(he=>he?.name||he?.entityType?.name||he?.entity_type?.name||"Unknown type").join(", "):""},[pt,$e]),be=u.useMemo(()=>{if(!pt)return"";const fe=Wo(pt,ft);return fe.length?fe.map(he=>he?.name||he?.entityType?.name||he?.entity_type?.name||"Unknown type").join(", "):""},[pt,ft]),je=$e==="from"?"source":"target",We=ft==="from"?"source":"target",dt=`Allowed ${je}s`,gt=`Allowed ${We}s`,ce=u.useMemo(()=>pt&&(J==="reverse"?pt.to_name||pt.toName:pt.from_name||pt.fromName)||"",[pt,J]),re=u.useMemo(()=>pt&&(J==="reverse"?pt.from_name||pt.fromName:pt.to_name||pt.toName)||"",[pt,J]),Ne=u.useMemo(()=>pt?Wo(pt,$e).map(fe=>_S(fe)).filter(fe=>fe&&fe.trim()):[],[pt,$e]),Be=u.useMemo(()=>pt?Wo(pt,ft).map(fe=>_S(fe)).filter(fe=>fe&&fe.trim()):[],[pt,ft]),Ke=u.useMemo(()=>!pt||!Ne.length&&!Be.length?"":Ne.length&&Be.length?`This relationship can only be initiated from ${Zu(Ne)} and targets ${Zu(Be)}.`:Ne.length?`This relationship can only be initiated from ${Zu(Ne)}.`:`This relationship targets ${Zu(Be)}.`,[pt,Ne,Be]),ot=u.useMemo(()=>{if(!te||!pt)return"";const fe=nt?String(nt):"";if(!fe)return"";if(te==="from"){if(ct.length>0&&!ct.includes(fe))return ee?"This entity is not an allowed source for the selected relationship type. Try switching perspective.":"This entity is not an allowed target for the selected relationship type. Try switching perspective."}else if(te==="to"&&yt.length>0&&!yt.includes(fe))return ee?"This entity is not an allowed target for the selected relationship type. Try switching perspective.":"This entity is not an allowed source for the selected relationship type. Try switching perspective.";return""},[te,pt,nt,ct,yt,ee]),ze=u.useMemo(()=>te?te==="from"?ee?"This entity is fixed as the source for this relationship.":"This field is locked to the current entity.":te==="to"?ee?"This field is locked to the current entity.":"This entity is fixed as the target for this relationship.":"":"",[te,ee]),ue=!!ot;u.useEffect(()=>{let fe=!1;const he=()=>{C.current=0,R({fromEntityId:H==="forward"?A:"",toEntityId:H==="reverse"?z:"",relationshipTypeId:""}),G([O()]),ie(H),tt(""),At(null)};return!N||!t?(he(),Re(!1),()=>{}):((async()=>{Re(!0),tt("");try{const xt=await j4(t),Nt=xt?.data||xt;if(!Nt)throw new Error("Relationship not found");if(!fe){const Et=Nt.from_entity_id||Nt.fromEntityId||Nt.from_entity?.id||Nt.fromEntity?.id||"",jt=Nt.to_entity_id||Nt.toEntityId||Nt.to_entity?.id||Nt.toEntity?.id||"",Wt=Nt.entity_relationship_type_id||Nt.relationship_type_id||Nt.relationshipType?.id||Nt.relationship_type?.id||"";R({fromEntityId:Et?String(Et):"",toEntityId:jt?String(jt):"",relationshipTypeId:Wt?String(Wt):""}),ie(T(Nt.context)||"forward"),G(E(M(Nt.context)))}}catch(xt){fe||tt(xt.message||"Failed to load relationship")}finally{fe||Re(!1)}})(),()=>{fe=!0})},[t,N,E,M,O,T,H,A,z]),u.useEffect(()=>{if(N)return;const fe=p==="target"?"reverse":"forward";ie(he=>he===fe?he:fe)},[p,N]),u.useEffect(()=>{if(N||!te)return;const fe=P||"",he=te==="from"?A||fe:z||fe;he&&R(Ve=>{const xt=te==="from"?"fromEntityId":"toEntityId";if(Ve[xt]===he)return Ve;const Nt={...Ve,[xt]:he};return te==="from"&&h&&Ve.toEntityId===he&&(Nt.toEntityId=""),te==="to"&&f&&Ve.fromEntityId===he&&(Nt.fromEntityId=""),Nt})},[N,te,f,h,A,z,P]);const qe=fe=>he=>{const{value:Ve}=he.target;R(xt=>{if(N)return{...xt,[fe]:Ve};const Nt={...xt,relationshipTypeId:Ve};return te==="from"?Nt.toEntityId="":te==="to"&&(Nt.fromEntityId=""),Nt}),At(null)},Ge=fe=>{const{value:he}=fe.target;At(Ve=>Ve==="from"?null:Ve),R(Ve=>({...Ve,fromEntityId:he}))},ut=fe=>{const{value:he}=fe.target;At(Ve=>Ve==="to"?null:Ve),R(Ve=>({...Ve,toEntityId:he}))},ae=u.useCallback(()=>{At(null)},[]),Xe=u.useCallback((fe,he)=>{const Ve=fe==="to"?"to":"from",xt=he?String(he):"";Ze(Nt=>({...Nt,[Ve]:xt})),_t.current[Ve]&&clearTimeout(_t.current[Ve]),_t.current[Ve]=setTimeout(()=>{Ze(Nt=>({...Nt,[Ve]:""})),_t.current[Ve]=null},2e3)},[]),Fe=u.useCallback((fe,he)=>{const Ve=FI(he);if(!Ve)return;const xt=String(Ve.id);F(Wt=>{const ln={...Ve,id:xt},dn=Wt.findIndex(Qt=>String(Qt.id)===xt);if(dn>=0){const Qt=[...Wt];return Qt[dn]={...Qt[dn],...ln},Qt}return[ln,...Wt]}),fe==="from"?R(Wt=>({...Wt,fromEntityId:xt})):fe==="to"&&R(Wt=>({...Wt,toEntityId:xt})),Xe(fe,xt),At(null);const Nt=fe==="from"?je:We,Et=`${Nt[0].toUpperCase()}${Nt.slice(1)}`,jt=Et?`New ${Et} entity added and selected.`:"New entity added and selected.";l?.(jt,"success")},[Xe,je,We,l]);u.useEffect(()=>{const fe=_t.current;return()=>{Object.values(fe).forEach(he=>{he&&clearTimeout(he)})}},[]);const Qe=(fe,he)=>Ve=>{const{value:xt}=Ve.target;G(Nt=>Nt.map(Et=>Et.id===fe?{...Et,[he]:xt}:Et))},bt=()=>{G(fe=>[...fe,O()])},St=fe=>{G(he=>E(he.filter(Ve=>Ve.id!==fe)))},_e=async fe=>{if(fe.preventDefault(),!e){tt("Select a world before creating relationships.");return}const he=B.fromEntityId.trim(),Ve=B.toEntityId.trim(),xt=B.relationshipTypeId.trim();if(!he||!Ve){tt("Both entities are required.");return}if(!xt){tt("Relationship type is required.");return}const Nt={};q.forEach(({key:Qt,value:pa})=>{const Da=Qt.trim();Da&&(Da.startsWith("__")||(Nt[Da]=$I(pa)))});const Et=J==="reverse"?"reverse":"forward";Nt.__direction=Et;let jt=he,Wt=Ve;Et==="reverse"&&(!P||B.fromEntityId===P)&&(jt=Ve,Wt=he);const dn={world_id:e,from_entity_id:jt,to_entity_id:Wt,relationship_type_id:xt,bidirectional:!0,context:Nt};try{if(rt(!0),tt(""),N)await C4(t,dn),i?.("edit");else{const Qt=await yN(dn),pa=Qt?.data??Qt,Da=pa?.data??pa;i?.("create",Da)}}catch(Qt){tt(Qt.message||"Failed to save relationship")}finally{rt(!1)}},et=Z||Q||ke||ne,mt=!!zt?.typeId&&Rt.length===0;return u.useEffect(()=>{if(!S)return;S({mode:N?"edit":"create",saving:Te,isBusy:et,submitLabel:Te?"Saving...":N?"Save Changes":"Create Relationship",submitDisabled:Te||et||ue,cancelDisabled:Te})},[S,N,Te,et,ue]),a.jsxs("form",{id:v,className:"entity-form relationship-form",onSubmit:_e,children:[a.jsx(OI,{value:W,onChange:kt,disabled:Te||et}),ot&&a.jsx("div",{className:"alert warning",role:"alert",children:ot}),Ie&&a.jsx("div",{className:"alert warning",role:"status",children:Ie}),a.jsxs("div",{className:"form-two-column",children:[a.jsxs("div",{className:`form-group${Pe.from&&Pe.from===B.fromEntityId?" entity-select-highlight":""}`,children:[a.jsx("label",{htmlFor:"relationship-from-entity",children:"From Entity *"}),a.jsxs("select",{id:"relationship-from-entity",value:B.fromEntityId,onChange:Ge,disabled:Te||et||te==="from",required:!0,"data-autofocus":ve==="from"?!0:void 0,children:[a.jsx("option",{value:"",children:"Select entity..."}),Lt.map(fe=>a.jsx("option",{value:fe.id,children:fe.name},fe.id))]}),te==="from"&&ze&&a.jsx("p",{className:"field-hint",children:ze}),j&&ce&&a.jsxs("p",{className:"field-hint",children:["Displayed label: ",ce]}),j&&pt&&se&&a.jsxs("p",{className:"field-hint",children:[dt,": ",se]}),te!=="from"&&a.jsx("div",{className:"inline-create-trigger",children:ct.length>0?a.jsx("button",{type:"button",className:"link-button",onClick:()=>Zt("from"),disabled:Ct==="from",children:"+ Create new"}):a.jsx("button",{type:"button",className:"link-button disabled",disabled:!0,children:"+ Create new"})}),te!=="from"&&ct.length===0&&a.jsx("p",{className:"inline-create-hint disabled",children:"Inline creation isnt available for this relationship."}),pt&&ct.length>0&&Lt.length===0&&a.jsxs("p",{className:"field-hint",children:["No entities match the allowed ",je," types yet. Use + Create new to add one without leaving this page."]}),te!=="from"&&Ct==="from"&&a.jsx(jS,{allowedTypeIds:ct,defaultTypeId:Mt,worldId:e,entityTypes:U,onCreated:fe=>Fe("from",fe),onCancel:ae,onToast:l},`inline-from-${B.relationshipTypeId}`)]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type",children:"Relationship Type *"}),a.jsxs("select",{id:"relationship-type",value:B.relationshipTypeId,onChange:qe("relationshipTypeId"),disabled:Te||et||!Rt.length,required:!0,children:[a.jsx("option",{value:"",children:"Select type..."}),Rt.map(fe=>{const he=fe.from_name||fe.fromName||fe.name,Ve=fe.to_name||fe.toName||fe.name,xt=he===Ve?he:`${he}  ${Ve}`;return a.jsxs("option",{value:fe.id,children:[fe.name,"  ",xt]},fe.id)})]}),mt&&a.jsx("p",{className:"field-hint",children:"No relationship types include the selected entity type."}),Ke&&a.jsx("p",{className:"helper-hint",children:Ke})]})]}),a.jsx("div",{className:"form-two-column",children:a.jsxs("div",{className:`form-group${Pe.to&&Pe.to===B.toEntityId?" entity-select-highlight":""}`,children:[a.jsx("label",{htmlFor:"relationship-to-entity",children:"To Entity *"}),a.jsxs("select",{id:"relationship-to-entity",value:B.toEntityId,onChange:ut,disabled:Te||et||te==="to",required:!0,"data-autofocus":ve==="to"?!0:void 0,children:[a.jsx("option",{value:"",children:"Select entity..."}),Kt.map(fe=>a.jsx("option",{value:fe.id,children:fe.name},fe.id))]}),te==="to"&&ze&&a.jsx("p",{className:"field-hint",children:ze}),j&&re&&a.jsxs("p",{className:"field-hint",children:["Displayed label: ",re]}),j&&pt&&be&&a.jsxs("p",{className:"field-hint",children:[gt,": ",be]}),te!=="to"&&a.jsx("div",{className:"inline-create-trigger",children:yt.length>0?a.jsx("button",{type:"button",className:"link-button",onClick:()=>Zt("to"),disabled:Ct==="to",children:"+ Create new"}):a.jsx("button",{type:"button",className:"link-button disabled",disabled:!0,children:"+ Create new"})}),te!=="to"&&yt.length===0&&a.jsx("p",{className:"inline-create-hint disabled",children:"Inline creation isnt available for this relationship."}),pt&&yt.length>0&&Kt.length===0&&a.jsxs("p",{className:"field-hint",children:["No entities match the allowed ",We," types yet. Use + Create new to add one without losing your place."]}),te!=="to"&&Ct==="to"&&a.jsx(jS,{allowedTypeIds:yt,defaultTypeId:Ft,worldId:e,entityTypes:U,onCreated:fe=>Fe("to",fe),onCancel:ae,onToast:l},`inline-to-${B.relationshipTypeId}`)]})}),_&&a.jsxs("div",{className:"metadata-editor",children:[a.jsxs("div",{className:"metadata-header",children:[a.jsxs("h3",{children:["Context ",le?"":"(optional)"]}),a.jsx("button",{type:"button",className:"btn neutral",onClick:bt,disabled:Te||et,children:"Add field"})]}),a.jsx("div",{className:"metadata-list",children:q.map((fe,he)=>a.jsxs("div",{className:"metadata-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`context-key-${fe.id}`,className:"sr-only",children:["Context key ",he+1]}),a.jsx("input",{id:`context-key-${fe.id}`,type:"text",placeholder:"Key",value:fe.key,onChange:Qe(fe.id,"key"),disabled:Te||et})]}),a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`context-value-${fe.id}`,className:"sr-only",children:["Context value ",he+1]}),a.jsx("input",{id:`context-value-${fe.id}`,type:"text",placeholder:"Value",value:fe.value,onChange:Qe(fe.id,"value"),disabled:Te||et})]}),a.jsx("div",{className:"metadata-actions",children:a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>St(fe.id),disabled:Te||et||q.length===1,title:"Remove field",children:""})})]},fe.id))})]}),et&&a.jsx("div",{className:"form-loading",role:"status",children:"Loading data..."}),He&&a.jsx("div",{className:"form-error",role:"alert",children:He}),!w&&a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:r,disabled:Te,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:Te||et||ue,children:Te?"Saving...":N?"Save Changes":"Create Relationship"})]})]})}function qI(e){return a.jsx(BI,{...e})}const HI=new Set(["system_admin"]),CS=(e="create")=>({mode:e,submitLabel:e==="edit"?"Save Changes":"Create Relationship",submitDisabled:!1,cancelDisabled:!1,saving:!1,isBusy:!1});function PI(){const{user:e,token:t,sessionReady:r}=En(),{selectedCampaign:i,activeWorld:l,activeWorldId:c,selectedContextType:f,contextKey:m}=Bn(),h=kI("rel_builder_v2"),[p,y]=u.useState(!1),[g,v]=u.useState(!1),[S,w]=u.useState([]),[N,j]=u.useState([]),[_,C]=u.useState({}),O=u.useRef({}),[E,T]=u.useState(!1),[M,A]=u.useState(!1),[z,P]=u.useState(""),[X,H]=u.useState(null),[Y,V]=u.useState(""),[I,F]=u.useState(null),[D,L]=u.useState(()=>CS("create")),[U,k]=u.useState(""),[B,R]=u.useState(""),q=c||"",G=!!q,J=u.useRef(`${q}:${m}`),ie=u.useRef(`relationship-form-${Math.random().toString(36).slice(2)}`),Z=(le="create")=>{L(CS(le))},me=u.useCallback((le,Se="info")=>{F({message:le,tone:Se})},[]);u.useEffect(()=>{if(!I)return;const le=setTimeout(()=>F(null),3500);return()=>clearTimeout(le)},[I]);const Q=u.useMemo(()=>!i||!e?"":i.members?.find(Se=>Se.user_id===e.id)?.role||"",[i,e]),oe=u.useMemo(()=>{const le=i?.world||l;if(!le||!e?.id)return!1;const Se=le.created_by||le.creator?.id||le.owner_id||le.owner?.id||"";return Se?String(Se)===String(e.id):!1},[i,l,e?.id]),ne=u.useMemo(()=>!e||!q?!1:HI.has(e.role)?!0:f==="world"?oe:!!(i&&(Q==="dm"||oe)),[e,q,f,i,Q,oe]),we=u.useCallback(async le=>{const Se=Array.from(new Set(le.map(nt=>nt==null?"":String(nt)).filter(Boolean)));if(Se.length===0)return;const Ee=O.current,ge=Se.filter(nt=>!Ee[nt]);if(ge.length===0)return;const at=await Promise.all(ge.map(async nt=>{try{const $e=await rr(nt),ft=Pa($e);return{id:nt,data:ft}}catch($e){return console.error(" Failed to resolve entity",$e),{id:nt,data:null}}})),st={};at.forEach(({id:nt,data:$e})=>{$e?st[nt]={id:$e.id||nt,name:$e.name||`Entity ${nt}`,typeName:$e.entityType?.name||$e.entity_type?.name||""}:st[nt]={id:nt,name:`Entity #${nt}`,typeName:""}}),O.current={...O.current,...st},C(nt=>({...nt,...st}))},[]),ke=u.useCallback(async le=>{const Se=le?{worldId:le}:{};A(!0);try{const Ee=await pf(Se),ge=Array.isArray(Ee)?Ee:Array.isArray(Ee?.data)?Ee.data:[];j(ge)}catch(Ee){console.error(" Failed to load relationship types",Ee),me(Ee.message||"Failed to load relationship types","error"),j([])}finally{A(!1)}},[me]);u.useEffect(()=>{if(!q){j([]);return}ke(q)},[ke,q,m]);const Re=u.useCallback(async le=>{const Se=le??q;if(!Se||!t)return w([]),[];T(!0),P("");try{const Ee=await E4(Se),ge=Array.isArray(Ee)?Ee:Array.isArray(Ee?.data)?Ee.data:[];w(ge);const at=[];return ge.forEach(st=>{const nt=st.from_entity_id||st.fromEntityId||st.from_entity?.id||st.fromEntity?.id||"",$e=st.to_entity_id||st.toEntityId||st.to_entity?.id||st.toEntity?.id||"";nt&&at.push(nt),$e&&at.push($e)}),await we(at),ge}catch(Ee){return console.error(" Failed to load relationships",Ee),w([]),P(Ee.message||"Failed to load relationships"),[]}finally{T(!1)}},[q,t,we,m]);u.useEffect(()=>{if(!q||!t){w([]),O.current={},C({});return}Re(q)},[q,t,Re,m]),u.useEffect(()=>{const le=`${q}:${m}`;J.current!==le&&(p&&y(!1),g&&v(!1),H(null),F(null),k(""),R(""),P(""),O.current={},C({}),J.current=le)},[q,m,p,g]);const Te=u.useMemo(()=>{const le=new Map;return N.forEach(Se=>{Se?.id&&le.set(String(Se.id),Se)}),le},[N]),rt=le=>{if(!le)return"";if(typeof le=="object"&&le!==null&&!Array.isArray(le)){const Se=le.__direction||le.direction;return Se?String(Se):""}return""},He=u.useMemo(()=>S.map(le=>{const Se=le.from_entity_id||le.fromEntityId||le.from_entity?.id||le.fromEntity?.id||"",Ee=le.to_entity_id||le.toEntityId||le.to_entity?.id||le.toEntity?.id||"",ge=le.entity_relationship_type_id||le.relationship_type_id||le.relationshipType?.id||le.relationship_type?.id||"",at=le.relationshipType||le.relationship_type||Te.get(String(ge))||{},st=at.name||le.relationshipTypeName||Te.get(String(ge))?.name||"",nt=at.from_name||at.fromName||Te.get(String(ge))?.from_name||Te.get(String(ge))?.fromName||st,$e=at.to_name||at.toName||Te.get(String(ge))?.to_name||Te.get(String(ge))?.toName||st,ft=rt(le.context),zt=ft==="reverse"?$e:nt,Rt=!!(le.bidirectional??le.is_bidirectional??le.two_way??!1);return{...le,fromEntityId:Se?String(Se):"",toEntityId:Ee?String(Ee):"",relationshipTypeId:ge?String(ge):"",typeName:zt,direction:ft,typeFromName:nt,typeToName:$e,bidirectional:Rt,fromEntityName:le.fromEntity?.name||le.from_entity?.name||le.fromEntityName||"",toEntityName:le.toEntity?.name||le.to_entity?.name||le.toEntityName||"",fromEntityTypeName:le.fromEntity?.entityType?.name||le.from_entity?.entity_type?.name||"",toEntityTypeName:le.toEntity?.entityType?.name||le.to_entity?.entity_type?.name||""}}),[S,Te]),tt=i?`${i.name}${l?.name?`  ${l.name}`:""}`:G?`World  ${l?.name||"Untitled world"}`:"",Ie=u.useCallback((le,Se="",Ee="")=>{if(!le)return"";const ge=_[le],at=ge?.name||Se||`Entity #${le}`,st=ge?.typeName||Ee;return st?`${at} (${st})`:at},[_]),vt=u.useMemo(()=>{const le=B.trim().toLowerCase();return He.filter(Se=>{if(U&&Se.relationshipTypeId!==U)return!1;if(!le)return!0;const Ee=Ie(Se.fromEntityId,Se.fromEntityName,Se.fromEntityTypeName).toLowerCase(),ge=Ie(Se.toEntityId,Se.toEntityName,Se.toEntityTypeName).toLowerCase();return Ee.includes(le)||ge.includes(le)})},[He,U,B,Ie]);if(!r)return a.jsx("p",{children:"Restoring session..."});if(!t)return a.jsx("p",{children:"Authenticating..."});const Ct=vt.length>0,At=X?"Edit Relationship":"Add Relationship",_t=()=>{q&&Re(q)},Pe=()=>{if(!(!ne||!q)){if(h){y(!0);return}H(null),Z("create"),v(!0)}},Ze=le=>{!ne||!le?.id||(H(le.id),Z("edit"),v(!0))},W=()=>{v(!1),H(null),Z("create")},ee=(le={})=>{L(Se=>({...Se,...le}))},te=async(le,Se)=>{if(W(),!!q){if(await Re(q),le==="create"&&Se){const Ee=Ie(Se.from_entity_id,Se?.from_entity?.name,Se?.from_entity?.entityType?.name||Se?.from_entity?.entity_type?.name),ge=Ie(Se.to_entity_id,Se?.to_entity?.name,Se?.to_entity?.entityType?.name||Se?.to_entity?.entity_type?.name),at=Se?.relationshipType?.name||"relationship";me(`Added ${Ee}  ${ge} (${at}).`,"success");return}me(le==="create"?"Relationship created":"Relationship updated","success")}},ve=async le=>{if(!ne||!le?.id)return;const Se=Ie(le.fromEntityId,le.fromEntityName,le.fromEntityTypeName),Ee=Ie(le.toEntityId,le.toEntityName,le.toEntityTypeName);if(window.confirm(`Delete relationship "${Se}"  "${Ee}"? This action cannot be undone.`))try{V(le.id),await A4(le.id),me("Relationship deleted","success"),q&&await Re(q)}catch(at){console.error(" Failed to delete relationship",at),me(at.message||"Failed to delete relationship","error")}finally{V("")}};return a.jsxs("section",{className:"entities-page relationships-page",children:[a.jsxs("div",{className:"entities-header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Entity Relationships"}),G?a.jsx("p",{className:"entities-subtitle",children:tt}):a.jsx("p",{className:"entities-subtitle",children:"Select a campaign or world you own to choose a world context."})]}),a.jsxs("div",{className:"entities-controls",children:[a.jsxs("select",{value:U,onChange:le=>k(le.target.value),disabled:M||N.length===0,title:"Filter by relationship type",children:[a.jsx("option",{value:"",children:"All types"}),N.map(le=>a.jsx("option",{value:String(le.id),children:le.name},le.id))]}),a.jsx(qy,{value:B,onChange:R}),a.jsx("button",{type:"button",className:"icon-btn",title:"Refresh relationships",onClick:_t,disabled:!q||E,children:a.jsx(zl,{size:16})}),a.jsxs("button",{type:"button",className:"btn submit",onClick:Pe,disabled:!ne||!q||E,children:[a.jsx(Va,{size:16})," Add Relationship"]})]})]}),i&&G&&!ne&&a.jsx("div",{className:"alert info",role:"status",children:"You can view existing relationships, but only the world owner, a campaign DM, or a system administrator can create or edit them."}),I&&a.jsx("div",{className:`toast-banner ${I.tone}`,role:"status",children:I.message}),z&&a.jsx("div",{className:"alert error",role:"alert",children:z}),E?a.jsx("div",{className:"empty-state",children:"Loading relationships..."}):q?Ct?a.jsx("div",{className:"entities-table-wrapper",children:a.jsxs("table",{className:"entities-table relationships-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"From Entity"}),a.jsx("th",{children:"Relationship Type"}),a.jsx("th",{children:"To Entity"}),a.jsx("th",{children:"Bidirectional"}),ne&&a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:vt.map(le=>{const Se=Ie(le.fromEntityId,le.fromEntityName,le.fromEntityTypeName),Ee=Ie(le.toEntityId,le.toEntityName,le.toEntityTypeName);return a.jsxs("tr",{children:[a.jsx("td",{children:Se}),a.jsx("td",{children:le.typeName||""}),a.jsx("td",{children:Ee}),a.jsx("td",{children:a.jsx("span",{className:`visibility-badge ${le.bidirectional?"badge-visible":"badge-hidden"}`,children:le.bidirectional?"Yes":"No"})}),ne&&a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Ze(le),title:"Edit relationship",disabled:E,children:a.jsx(ar,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>ve(le),title:"Delete relationship",disabled:Y===le.id,children:a.jsx(ma,{size:16})})]})})]},le.id)})})]})}):a.jsx("div",{className:"empty-state",children:U||B?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"empty-title",children:"No relationships match your filters."}),a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>{k(""),R("")},children:"Clear filters"})]}):ne?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"empty-title",children:"No relationships yet."}),a.jsxs("button",{type:"button",className:"btn submit",onClick:Pe,disabled:!q,children:[a.jsx(Va,{size:16})," Add your first relationship"]})]}):a.jsx("p",{className:"empty-title",children:"No relationships to display."})}):a.jsx("div",{className:"empty-state",children:"Select a campaign or world you own to view its relationships."}),h&&a.jsx(Yr,{isOpen:p,onClose:()=>y(!1),title:"Add Relationship",description:"Link two entities in this world.",size:"lg",children:a.jsx(gN,{worldId:q,existingRelationships:S||[],onCreated:()=>{y(!1),Re(q),me("Relationship created","success")},onCancel:()=>y(!1)})}),a.jsx(Yr,{isOpen:g,onClose:W,title:At,size:"lg",footerActions:a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:W,disabled:D.cancelDisabled,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",form:ie.current,disabled:D.submitDisabled,children:D.submitLabel})]}),children:a.jsx(qI,{worldId:q,relationshipId:X,onCancel:W,onSaved:te,onStateChange:ee,formId:ie.current,hideActions:!0})})]})}const VI=new Set(["system_admin"]),YI=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},AS=(e=[])=>!Array.isArray(e)||e.length===0?"":e.map(t=>t?.name||t?.label||"Unknown").filter(Boolean).join(", "),GI=e=>{if(!e)return"";const t=e.from_name||e.fromName||e.name||"",r=e.to_name||e.toName||e.name||"";return`${t}  ${r}`};function XI(){const e=$n(),t=Ga(),{user:r,token:i,sessionReady:l}=En(),{selectedCampaign:c}=Bn(),[f,m]=u.useState([]),[h,p]=u.useState(!1),[y,g]=u.useState(""),[v,S]=u.useState(null),[w,N]=u.useState(""),j=u.useMemo(()=>{if(!c?.world)return"";const I=c.world;return I.created_by||I.creator?.id||I.owner_id||I.owner?.id||""},[c]),_=!!(r?.id&&j===r.id),C=u.useMemo(()=>r?r.role&&VI.has(r.role)?!0:_:!1,[r,_]),O=c?.world?.id??"",E=!!O,T=u.useRef(O),M=u.useMemo(()=>{if(!c)return"";const I=c.name||"Selected campaign",F=c.world?.name;return F?`${I}  ${F}`:I},[c]);u.useEffect(()=>{if(!v)return;const I=setTimeout(()=>S(null),3500);return()=>clearTimeout(I)},[v]);const A=u.useCallback((I,F="info")=>{S({message:I,tone:F})},[]),z=u.useCallback(()=>{e(t.pathname,{replace:!0,state:{}})},[t.pathname,e]);u.useEffect(()=>{if(t.state?.toast){const{message:I,tone:F}=t.state.toast;A(I,F),z()}},[t.state,A,z]),u.useEffect(()=>{T.current!==O&&(T.current=O,m([]),g(""),p(!1),S(null),N(""))},[O]);const P=u.useCallback(async()=>{if(!(!i||!C)){if(!O){m([]),g("");return}p(!0),g("");try{const I=await pf({worldId:O}),F=Array.isArray(I)?I:Array.isArray(I?.data)?I.data:[];m(F)}catch(I){console.error(" Failed to load relationship types",I),m([]),g(I.message||"Failed to load relationship types")}finally{p(!1)}}},[i,C,O]);u.useEffect(()=>{if(!(!l||!i||!C)){if(!O){m([]),p(!1),g("");return}P()}},[l,i,C,O,P]);const X=()=>{!i||h||!E||!C||P()},H=()=>{!C||!E||e("/relationship-types/new")},Y=I=>{!C||!I?.id||e(`/relationship-types/${I.id}/edit`)},V=async I=>{if(!(!C||!E||!I?.id||!window.confirm(`Delete relationship type "${I.name}"? This cannot be undone.`)))try{N(I.id),await D4(I.id),A("Relationship type deleted","success"),await P()}catch(D){console.error(" Failed to delete relationship type",D),A(D.message||"Failed to delete relationship type","error")}finally{N("")}};return l?i?C?a.jsxs("section",{className:"entity-types-page relationship-types-page",children:[a.jsxs("div",{className:"entity-types-header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Relationship Types"}),c?a.jsxs("p",{className:"entity-types-subtitle",children:[M,E?`  ${f.length} types defined`:""]}):a.jsx("p",{className:"entity-types-subtitle",children:"Select a campaign from the header to choose a world context."})]}),a.jsxs("div",{className:"entity-types-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Refresh",onClick:X,disabled:h||!E,children:a.jsx(zl,{size:16})}),a.jsxs("button",{type:"button",className:"btn submit",onClick:H,disabled:h||!E,children:[a.jsx(Va,{size:18})," Add Relationship Type"]})]})]}),v&&a.jsx("div",{className:`toast-banner ${v.tone}`,children:v.message}),y&&a.jsx("div",{className:"alert error",children:y}),a.jsx("div",{className:"entity-types-table-wrapper",children:E?h?a.jsx("div",{className:"empty-state",children:"Loading relationship types..."}):f.length===0?a.jsx("div",{className:"empty-state",children:"No relationship types defined yet."}):a.jsxs("table",{className:"entity-types-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Name"}),a.jsx("th",{children:"Directional Labels"}),a.jsx("th",{children:"World"}),a.jsx("th",{children:"Allowed Sources"}),a.jsx("th",{children:"Allowed Targets"}),a.jsx("th",{children:"Created"}),a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:f.map(I=>{const F=I.createdAt||I.created_at;return a.jsxs("tr",{children:[a.jsx("td",{children:I.name}),a.jsx("td",{children:GI(I)}),a.jsx("td",{children:I.world?.name||""}),a.jsx("td",{children:AS(I.from_entity_types)}),a.jsx("td",{children:AS(I.to_entity_types)}),a.jsx("td",{children:YI(F)}),a.jsxs("td",{className:"actions-column",children:[a.jsx("button",{className:"icon-btn",title:"Edit",onClick:()=>Y(I),disabled:h||w===I.id,children:a.jsx(ar,{size:16})}),a.jsx("button",{className:"icon-btn danger",title:"Delete",onClick:()=>V(I),disabled:w===I.id,children:a.jsx(ma,{size:16})})]})]},I.id)})})]}):a.jsx("div",{className:"empty-state",children:"Select a campaign from the header to view relationship types."})})]}):a.jsxs("section",{className:"entity-types-page relationship-types-page",children:[a.jsx("div",{className:"entity-types-header",children:a.jsx("h1",{children:"Relationship Types"})}),a.jsx("div",{className:"alert info",children:"Only system administrators or the world owner can manage relationship types."})]}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const TS=e=>Array.isArray(e)?[...new Set(e.map(t=>t?String(t):"").filter(Boolean))]:[],MS=(e={})=>({name:e?.name||"",fromName:e?.from_name||e?.fromName||"",toName:e?.to_name||e?.toName||"",description:e?.description||"",worldId:e?.world?.id||e?.world_id||"",fromEntityTypeIds:TS((e?.from_entity_types||[]).map(t=>t?.id||t?.entity_type_id)),toEntityTypeIds:TS((e?.to_entity_types||[]).map(t=>t?.id||t?.entity_type_id))}),RS=(e=[],t=[])=>{if(e.length!==t.length)return!1;const r=[...e].sort(),i=[...t].sort();return r.every((l,c)=>l===i[c])};function LN({initialValues:e={},entityTypes:t=[],worlds:r=[],saving:i=!1,optionsLoading:l=!1,errorMessage:c="",onSubmit:f,onCancel:m}){const h=u.useMemo(()=>MS(e),[e]),[p,y]=u.useState(h),[g,v]=u.useState("");u.useEffect(()=>{y(MS(e)),v("")},[e]),u.useEffect(()=>{v(c||"")},[c]);const S=u.useMemo(()=>p.name!==h.name||p.fromName!==h.fromName||p.toName!==h.toName||p.description!==h.description||p.worldId!==h.worldId||!RS(p.fromEntityTypeIds,h.fromEntityTypeIds)||!RS(p.toEntityTypeIds,h.toEntityTypeIds),[h,p]),w=u.useMemo(()=>Array.isArray(t)?t.map(O=>{const E=O?.id||O?.entity_type_id||O?.entityTypeId||O?.value||"";if(!E)return null;const T=O?.world_id||O?.worldId||O?.world?.id||"";return{value:String(E),label:O?.name||O?.label||"Untitled type",worldId:T?String(T):""}}).filter(Boolean):[],[t]),N=u.useMemo(()=>{const O=p.worldId?String(p.worldId):"";return O?w.filter(E=>E.worldId===O):[]},[w,p.worldId]);u.useEffect(()=>{if(!(p.worldId?String(p.worldId):"")){y(T=>T.fromEntityTypeIds.length===0&&T.toEntityTypeIds.length===0?T:{...T,fromEntityTypeIds:[],toEntityTypeIds:[]});return}const E=new Set(N.map(T=>T.value));y(T=>{const M=T.fromEntityTypeIds.filter(z=>E.has(String(z))),A=T.toEntityTypeIds.filter(z=>E.has(String(z)));return M.length===T.fromEntityTypeIds.length&&A.length===T.toEntityTypeIds.length?T:{...T,fromEntityTypeIds:M,toEntityTypeIds:A}})},[N,p.worldId]);const j=O=>E=>{const{value:T}=E.target;y(M=>({...M,[O]:T}))},_=O=>(E=[])=>{const T=Array.isArray(E)?E:[];y(M=>({...M,[O]:T}))},C=async O=>{O.preventDefault();const E=p.name.trim(),T=p.fromName.trim(),M=p.toName.trim();if(!E)return v("Name is required.");if(!T)return v("Provide a label for the source direction.");if(!M)return v("Provide a label for the target direction.");if(!p.worldId)return v("Select a world for this relationship type.");if(!p.fromEntityTypeIds.length)return v("Select at least one allowed source entity type.");if(!p.toEntityTypeIds.length)return v("Select at least one allowed target entity type.");v("");const A={name:E,from_name:T,to_name:M,description:p.description?.trim()||"",world_id:p.worldId,from_entity_type_ids:p.fromEntityTypeIds,to_entity_type_ids:p.toEntityTypeIds};try{if(await f?.(A)===!1)return}catch(z){v(z.message||"Failed to save relationship type")}};return a.jsxs("form",{className:"relationship-type-form",onSubmit:C,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-name",children:"Name *"}),a.jsx("input",{id:"relationship-type-name",type:"text",value:p.name,onChange:j("name"),placeholder:"e.g. Enemy",disabled:i||l,autoFocus:!0})]}),a.jsxs("div",{className:"form-two-column",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-from-name",children:"Source relationship label *"}),a.jsx("input",{id:"relationship-type-from-name",type:"text",value:p.fromName,onChange:j("fromName"),placeholder:"e.g. Parent of",disabled:i||l})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-to-name",children:"Target relationship label *"}),a.jsx("input",{id:"relationship-type-to-name",type:"text",value:p.toName,onChange:j("toName"),placeholder:"e.g. Child of",disabled:i||l})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-description",children:"Description"}),a.jsx("textarea",{id:"relationship-type-description",value:p.description,onChange:j("description"),placeholder:"Optional description",rows:4,disabled:i||l,className:"textarea-field"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-world",children:"World *"}),a.jsxs("select",{id:"relationship-type-world",value:p.worldId,onChange:j("worldId"),disabled:i||l,required:!0,children:[a.jsx("option",{value:"",children:"Select world..."}),r.map(O=>a.jsx("option",{value:O.id,children:O.name},O.id))]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-from-entities",children:"Allowed source entity types *"}),a.jsx(Ms,{selected:p.fromEntityTypeIds,options:N,onChange:_("fromEntityTypeIds"),placeholder:"Search entity types...",disabled:i||l,loading:l,noOptionsMessage:p.worldId?"No entity types available for this world.":"Select a world to choose entity types."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-to-entities",children:"Allowed target entity types *"}),a.jsx(Ms,{selected:p.toEntityTypeIds,options:N,onChange:_("toEntityTypeIds"),placeholder:"Search entity types...",disabled:i||l,loading:l,noOptionsMessage:p.worldId?"No entity types available for this world.":"Select a world to choose entity types."})]}),g&&a.jsx("div",{className:"form-error",children:g}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:m,disabled:i,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:i||l||!S,children:i?"Saving...":"Save"})]})]})}function KI(){const e=$n(),{user:t,token:r,sessionReady:i}=En(),{selectedCampaign:l}=Bn(),[c,f]=u.useState([]),[m,h]=u.useState(!1),[p,y]=u.useState(""),[g,v]=u.useState(""),[S,w]=u.useState(!1),N=u.useMemo(()=>{if(!l?.world)return"";const A=l.world;return A.created_by||A.creator?.id||A.owner_id||A.owner?.id||""},[l]),j=!!(t?.id&&N===t.id),_=u.useMemo(()=>t?t.role==="system_admin"?!0:j:!1,[t,j]),C=l?.world?.id??"",O=u.useMemo(()=>{if(!l?.world?.id)return[];const A=l.world;return[{id:A.id,name:A.name||"Untitled world"}]},[l]),E=u.useCallback(async()=>{if(!r||!C){f([]),y("Select a campaign to choose a world context before creating relationship types.");return}h(!0),y("");try{const A=await Qr({worldId:C}),z=Array.isArray(A?.data)?A.data:Array.isArray(A)?A:[];f(z)}catch(A){console.error(" Failed to load relationship type options",A),f([]),y(A.message||"Failed to load supporting data")}finally{h(!1)}},[r,C]);if(u.useEffect(()=>{!i||!r||E()},[i,r,E]),!i)return a.jsx("p",{children:"Restoring session..."});if(!r)return a.jsx("p",{children:"Authenticating..."});if(!_)return a.jsxs("section",{className:"page relationship-type-form-page limited-access",children:[a.jsx("h1",{children:"Create Relationship Type"}),a.jsx("p",{children:"Only system administrators or the world owner can create relationship types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]});if(!C)return a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Create Relationship Type"}),a.jsx("p",{children:"Select a campaign from the header to choose a world context before creating relationship types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]});const T=()=>e("/relationship-types"),M=async A=>{if(S)return!1;v(""),w(!0);try{const z={...A,world_id:A.world_id??A.worldId??A.world?.id??C};if(!z.world_id)throw new Error("A world must be selected before creating a relationship type");console.log(" Final payload being sent:",z);const P=await R4(z),X=P?.data??P;if(!X||!X.id)throw new Error("Failed to create relationship type");return e("/relationship-types",{state:{toast:{message:"Relationship type created",tone:"success"}}}),!0}catch(z){return console.error(" Failed to create relationship type",z),v(z.message||"Failed to create relationship type"),!1}finally{w(!1)}};return a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Create Relationship Type"}),a.jsx("p",{className:"page-subtitle",children:"Define the directional names and allowed entity types for this relationship."}),p&&a.jsx("div",{className:"alert error",children:p}),a.jsx(LN,{initialValues:{world_id:C},entityTypes:c,worlds:O,saving:S,optionsLoading:m,errorMessage:g,onSubmit:M,onCancel:T})]})}function WI(){const e=$n(),{id:t}=xs(),{user:r,token:i,sessionReady:l}=En(),{selectedCampaign:c}=Bn(),[f,m]=u.useState([]),[h,p]=u.useState(!1),[y,g]=u.useState(""),[v,S]=u.useState(""),[w,N]=u.useState(null),[j,_]=u.useState(!0),[C,O]=u.useState(""),[E,T]=u.useState(!1),M=r?.role==="system_admin",A=u.useMemo(()=>{if(!c||!r)return!1;const U=c.world?.created_by??c.world?.creator?.id??c.world?.owner_id??c.world?.owner?.id??"";return U?U===r.id:!1},[c,r]),z=u.useMemo(()=>!!(M||A),[M,A]),P=c?.world?.id??"",X=c?.world?.name??"",H=u.useMemo(()=>{if(!w)return null;const U=w?.world?.id||w?.world_id||w?.worldId||"";if(!U)return null;const k=w?.world?.name||w?.world_name||w?.worldName||"";return{id:U,name:k||"Untitled world"}},[w]),[Y,V]=u.useState([]);u.useEffect(()=>{const U=[];P&&U.push({id:P,name:X||"Untitled world"}),H&&!U.some(k=>k.id===H.id)&&U.push(H),V(U)},[P,X,H]);const I=u.useCallback(async()=>{if(i){p(!0),g("");try{const U=P||H?.id||w?.world?.id||w?.world_id||"";if(!U){m([]),g("Select a campaign to choose a world context before editing relationship types.");return}const k=await Qr({worldId:U}),B=Array.isArray(k?.data)?k.data:Array.isArray(k)?k:[];m(B)}catch(U){console.error(" Failed to load relationship type options",U),m([]),g(U.message||"Failed to load supporting data")}finally{p(!1)}}},[i,P,H,w]),F=u.useCallback(async()=>{if(!(!i||!t)){_(!0),O("");try{const U=await M4(t),k=U?.data??U;if(!k)throw new Error("Relationship type not found");N(k)}catch(U){console.error(" Failed to load relationship type",U),O(U.message||"Failed to load relationship type"),N(null)}finally{_(!1)}}},[t,i]);if(u.useEffect(()=>{!l||!i||F()},[l,i,F]),u.useEffect(()=>{!l||!i||j||I()},[l,i,j,I]),!l)return a.jsx("p",{children:"Restoring session..."});if(!i)return a.jsx("p",{children:"Authenticating..."});if(!z)return a.jsxs("section",{className:"page relationship-type-form-page limited-access",children:[a.jsx("h1",{children:"Edit Relationship Type"}),a.jsx("p",{children:"Only system administrators can edit relationship types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]});const D=()=>e("/relationship-types"),L=async U=>{if(E||!t)return!1;S(""),T(!0);try{const k={...U,world_id:U.world_id||U.worldId||U.selectedWorldId||U.world?.id||P||w?.world_id};if(!k.world_id)throw new Error("A world must be selected before saving changes");const B=await k4(t,k),R=B?.data??B;if(!R||!R.id)throw new Error("Failed to update relationship type");return e("/relationship-types",{state:{toast:{message:"Relationship type updated",tone:"success"}}}),!0}catch(k){return console.error(" Failed to update relationship type",k),S(k.message||"Failed to update relationship type"),!1}finally{T(!1)}};return j?a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Edit Relationship Type"}),a.jsx("div",{className:"form-status",children:"Loading relationship type..."})]}):C||!w?a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Edit Relationship Type"}),a.jsx("div",{className:"alert error",children:C||"Relationship type not found."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]}):a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Edit Relationship Type"}),a.jsx("p",{className:"page-subtitle",children:"Update the directional labels or allowed entity types for this relationship."}),y&&a.jsx("div",{className:"alert error",children:y}),a.jsx(LN,{initialValues:w,entityTypes:f,worlds:Y,saving:E,optionsLoading:h,errorMessage:v,onSubmit:L,onCancel:D})]})}function ZI(){return a.jsx("section",{className:"page-placeholder",children:a.jsx("h1",{children:"Entity Secrets Page  Coming Soon"})})}function QI({children:e}){const{token:t,sessionReady:r}=En();return r?t?e:a.jsx(Xo,{to:"/login",replace:!0}):a.jsx("p",{children:"Restoring session..."})}function ha(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let r=0,i;r<e.length;r++)(i=ha(e[r]))!==""&&(t+=(t&&" ")+i);else for(let r in e)e[r]&&(t+=(t&&" ")+r);return t}var fp={exports:{}},mp={},hp={exports:{}},pp={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kS;function JI(){if(kS)return pp;kS=1;var e=wc();function t(g,v){return g===v&&(g!==0||1/g===1/v)||g!==g&&v!==v}var r=typeof Object.is=="function"?Object.is:t,i=e.useState,l=e.useEffect,c=e.useLayoutEffect,f=e.useDebugValue;function m(g,v){var S=v(),w=i({inst:{value:S,getSnapshot:v}}),N=w[0].inst,j=w[1];return c(function(){N.value=S,N.getSnapshot=v,h(N)&&j({inst:N})},[g,S,v]),l(function(){return h(N)&&j({inst:N}),g(function(){h(N)&&j({inst:N})})},[g]),f(S),S}function h(g){var v=g.getSnapshot;g=g.value;try{var S=v();return!r(g,S)}catch{return!0}}function p(g,v){return v()}var y=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?p:m;return pp.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:y,pp}var DS;function eL(){return DS||(DS=1,hp.exports=JI()),hp.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var IS;function tL(){if(IS)return mp;IS=1;var e=wc(),t=eL();function r(p,y){return p===y&&(p!==0||1/p===1/y)||p!==p&&y!==y}var i=typeof Object.is=="function"?Object.is:r,l=t.useSyncExternalStore,c=e.useRef,f=e.useEffect,m=e.useMemo,h=e.useDebugValue;return mp.useSyncExternalStoreWithSelector=function(p,y,g,v,S){var w=c(null);if(w.current===null){var N={hasValue:!1,value:null};w.current=N}else N=w.current;w=m(function(){function _(M){if(!C){if(C=!0,O=M,M=v(M),S!==void 0&&N.hasValue){var A=N.value;if(S(A,M))return E=A}return E=M}if(A=E,i(O,M))return A;var z=v(M);return S!==void 0&&S(A,z)?(O=M,A):(O=M,E=z)}var C=!1,O,E,T=g===void 0?null:g;return[function(){return _(y())},T===null?void 0:function(){return _(T())}]},[y,g,v,S]);var j=l(p,w[0],w[1]);return f(function(){N.hasValue=!0,N.value=j},[j]),h(j),j},mp}var LS;function nL(){return LS||(LS=1,fp.exports=tL()),fp.exports}var aL=nL();const sL=ki(aL),rL={},OS=e=>{let t;const r=new Set,i=(y,g)=>{const v=typeof y=="function"?y(t):y;if(!Object.is(v,t)){const S=t;t=g??(typeof v!="object"||v===null)?v:Object.assign({},t,v),r.forEach(w=>w(t,S))}},l=()=>t,h={setState:i,getState:l,getInitialState:()=>p,subscribe:y=>(r.add(y),()=>r.delete(y)),destroy:()=>{(rL?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},p=t=e(i,l,h);return h},iL=e=>e?OS(e):OS,{useDebugValue:lL}=De,{useSyncExternalStoreWithSelector:oL}=sL,cL=e=>e;function ON(e,t=cL,r){const i=oL(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return lL(i),i}const zS=(e,t)=>{const r=iL(e),i=(l,c=t)=>ON(r,l,c);return Object.assign(i,r),i},uL=(e,t)=>e?zS(e,t):zS;function ra(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[i,l]of e)if(!Object.is(l,t.get(i)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(const i of r)if(!Object.prototype.hasOwnProperty.call(t,i)||!Object.is(e[i],t[i]))return!1;return!0}var dL={value:()=>{}};function gf(){for(var e=0,t=arguments.length,r={},i;e<t;++e){if(!(i=arguments[e]+"")||i in r||/[\s.]/.test(i))throw new Error("illegal type: "+i);r[i]=[]}return new Sd(r)}function Sd(e){this._=e}function fL(e,t){return e.trim().split(/^|\s+/).map(function(r){var i="",l=r.indexOf(".");if(l>=0&&(i=r.slice(l+1),r=r.slice(0,l)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:i}})}Sd.prototype=gf.prototype={constructor:Sd,on:function(e,t){var r=this._,i=fL(e+"",r),l,c=-1,f=i.length;if(arguments.length<2){for(;++c<f;)if((l=(e=i[c]).type)&&(l=mL(r[l],e.name)))return l;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++c<f;)if(l=(e=i[c]).type)r[l]=$S(r[l],e.name,t);else if(t==null)for(l in r)r[l]=$S(r[l],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new Sd(e)},call:function(e,t){if((l=arguments.length-2)>0)for(var r=new Array(l),i=0,l,c;i<l;++i)r[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(c=this._[e],i=0,l=c.length;i<l;++i)c[i].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],l=0,c=i.length;l<c;++l)i[l].value.apply(t,r)}};function mL(e,t){for(var r=0,i=e.length,l;r<i;++r)if((l=e[r]).name===t)return l.value}function $S(e,t,r){for(var i=0,l=e.length;i<l;++i)if(e[i].name===t){e[i]=dL,e=e.slice(0,i).concat(e.slice(i+1));break}return r!=null&&e.push({name:t,value:r}),e}var ey="http://www.w3.org/1999/xhtml";const FS={svg:"http://www.w3.org/2000/svg",xhtml:ey,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function bf(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),FS.hasOwnProperty(t)?{space:FS[t],local:e}:e}function hL(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===ey&&t.documentElement.namespaceURI===ey?t.createElement(e):t.createElementNS(r,e)}}function pL(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function zN(e){var t=bf(e);return(t.local?pL:hL)(t)}function yL(){}function ag(e){return e==null?yL:function(){return this.querySelector(e)}}function gL(e){typeof e!="function"&&(e=ag(e));for(var t=this._groups,r=t.length,i=new Array(r),l=0;l<r;++l)for(var c=t[l],f=c.length,m=i[l]=new Array(f),h,p,y=0;y<f;++y)(h=c[y])&&(p=e.call(h,h.__data__,y,c))&&("__data__"in h&&(p.__data__=h.__data__),m[y]=p);return new Ya(i,this._parents)}function bL(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function vL(){return[]}function $N(e){return e==null?vL:function(){return this.querySelectorAll(e)}}function xL(e){return function(){return bL(e.apply(this,arguments))}}function SL(e){typeof e=="function"?e=xL(e):e=$N(e);for(var t=this._groups,r=t.length,i=[],l=[],c=0;c<r;++c)for(var f=t[c],m=f.length,h,p=0;p<m;++p)(h=f[p])&&(i.push(e.call(h,h.__data__,p,f)),l.push(h));return new Ya(i,l)}function FN(e){return function(){return this.matches(e)}}function UN(e){return function(t){return t.matches(e)}}var wL=Array.prototype.find;function NL(e){return function(){return wL.call(this.children,e)}}function EL(){return this.firstElementChild}function jL(e){return this.select(e==null?EL:NL(typeof e=="function"?e:UN(e)))}var _L=Array.prototype.filter;function CL(){return Array.from(this.children)}function AL(e){return function(){return _L.call(this.children,e)}}function TL(e){return this.selectAll(e==null?CL:AL(typeof e=="function"?e:UN(e)))}function ML(e){typeof e!="function"&&(e=FN(e));for(var t=this._groups,r=t.length,i=new Array(r),l=0;l<r;++l)for(var c=t[l],f=c.length,m=i[l]=[],h,p=0;p<f;++p)(h=c[p])&&e.call(h,h.__data__,p,c)&&m.push(h);return new Ya(i,this._parents)}function BN(e){return new Array(e.length)}function RL(){return new Ya(this._enter||this._groups.map(BN),this._parents)}function Od(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Od.prototype={constructor:Od,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function kL(e){return function(){return e}}function DL(e,t,r,i,l,c){for(var f=0,m,h=t.length,p=c.length;f<p;++f)(m=t[f])?(m.__data__=c[f],i[f]=m):r[f]=new Od(e,c[f]);for(;f<h;++f)(m=t[f])&&(l[f]=m)}function IL(e,t,r,i,l,c,f){var m,h,p=new Map,y=t.length,g=c.length,v=new Array(y),S;for(m=0;m<y;++m)(h=t[m])&&(v[m]=S=f.call(h,h.__data__,m,t)+"",p.has(S)?l[m]=h:p.set(S,h));for(m=0;m<g;++m)S=f.call(e,c[m],m,c)+"",(h=p.get(S))?(i[m]=h,h.__data__=c[m],p.delete(S)):r[m]=new Od(e,c[m]);for(m=0;m<y;++m)(h=t[m])&&p.get(v[m])===h&&(l[m]=h)}function LL(e){return e.__data__}function OL(e,t){if(!arguments.length)return Array.from(this,LL);var r=t?IL:DL,i=this._parents,l=this._groups;typeof e!="function"&&(e=kL(e));for(var c=l.length,f=new Array(c),m=new Array(c),h=new Array(c),p=0;p<c;++p){var y=i[p],g=l[p],v=g.length,S=zL(e.call(y,y&&y.__data__,p,i)),w=S.length,N=m[p]=new Array(w),j=f[p]=new Array(w),_=h[p]=new Array(v);r(y,g,N,j,_,S,t);for(var C=0,O=0,E,T;C<w;++C)if(E=N[C]){for(C>=O&&(O=C+1);!(T=j[O])&&++O<w;);E._next=T||null}}return f=new Ya(f,i),f._enter=m,f._exit=h,f}function zL(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function $L(){return new Ya(this._exit||this._groups.map(BN),this._parents)}function FL(e,t,r){var i=this.enter(),l=this,c=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),t!=null&&(l=t(l),l&&(l=l.selection())),r==null?c.remove():r(c),i&&l?i.merge(l).order():l}function UL(e){for(var t=e.selection?e.selection():e,r=this._groups,i=t._groups,l=r.length,c=i.length,f=Math.min(l,c),m=new Array(l),h=0;h<f;++h)for(var p=r[h],y=i[h],g=p.length,v=m[h]=new Array(g),S,w=0;w<g;++w)(S=p[w]||y[w])&&(v[w]=S);for(;h<l;++h)m[h]=r[h];return new Ya(m,this._parents)}function BL(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var i=e[t],l=i.length-1,c=i[l],f;--l>=0;)(f=i[l])&&(c&&f.compareDocumentPosition(c)^4&&c.parentNode.insertBefore(f,c),c=f);return this}function qL(e){e||(e=HL);function t(g,v){return g&&v?e(g.__data__,v.__data__):!g-!v}for(var r=this._groups,i=r.length,l=new Array(i),c=0;c<i;++c){for(var f=r[c],m=f.length,h=l[c]=new Array(m),p,y=0;y<m;++y)(p=f[y])&&(h[y]=p);h.sort(t)}return new Ya(l,this._parents).order()}function HL(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function PL(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function VL(){return Array.from(this)}function YL(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],l=0,c=i.length;l<c;++l){var f=i[l];if(f)return f}return null}function GL(){let e=0;for(const t of this)++e;return e}function XL(){return!this.node()}function KL(e){for(var t=this._groups,r=0,i=t.length;r<i;++r)for(var l=t[r],c=0,f=l.length,m;c<f;++c)(m=l[c])&&e.call(m,m.__data__,c,l);return this}function WL(e){return function(){this.removeAttribute(e)}}function ZL(e){return function(){this.removeAttributeNS(e.space,e.local)}}function QL(e,t){return function(){this.setAttribute(e,t)}}function JL(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function e5(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function t5(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function n5(e,t){var r=bf(e);if(arguments.length<2){var i=this.node();return r.local?i.getAttributeNS(r.space,r.local):i.getAttribute(r)}return this.each((t==null?r.local?ZL:WL:typeof t=="function"?r.local?t5:e5:r.local?JL:QL)(r,t))}function qN(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function a5(e){return function(){this.style.removeProperty(e)}}function s5(e,t,r){return function(){this.style.setProperty(e,t,r)}}function r5(e,t,r){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,r)}}function i5(e,t,r){return arguments.length>1?this.each((t==null?a5:typeof t=="function"?r5:s5)(e,t,r??"")):Dl(this.node(),e)}function Dl(e,t){return e.style.getPropertyValue(t)||qN(e).getComputedStyle(e,null).getPropertyValue(t)}function l5(e){return function(){delete this[e]}}function o5(e,t){return function(){this[e]=t}}function c5(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function u5(e,t){return arguments.length>1?this.each((t==null?l5:typeof t=="function"?c5:o5)(e,t)):this.node()[e]}function HN(e){return e.trim().split(/^|\s+/)}function sg(e){return e.classList||new PN(e)}function PN(e){this._node=e,this._names=HN(e.getAttribute("class")||"")}PN.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function VN(e,t){for(var r=sg(e),i=-1,l=t.length;++i<l;)r.add(t[i])}function YN(e,t){for(var r=sg(e),i=-1,l=t.length;++i<l;)r.remove(t[i])}function d5(e){return function(){VN(this,e)}}function f5(e){return function(){YN(this,e)}}function m5(e,t){return function(){(t.apply(this,arguments)?VN:YN)(this,e)}}function h5(e,t){var r=HN(e+"");if(arguments.length<2){for(var i=sg(this.node()),l=-1,c=r.length;++l<c;)if(!i.contains(r[l]))return!1;return!0}return this.each((typeof t=="function"?m5:t?d5:f5)(r,t))}function p5(){this.textContent=""}function y5(e){return function(){this.textContent=e}}function g5(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function b5(e){return arguments.length?this.each(e==null?p5:(typeof e=="function"?g5:y5)(e)):this.node().textContent}function v5(){this.innerHTML=""}function x5(e){return function(){this.innerHTML=e}}function S5(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function w5(e){return arguments.length?this.each(e==null?v5:(typeof e=="function"?S5:x5)(e)):this.node().innerHTML}function N5(){this.nextSibling&&this.parentNode.appendChild(this)}function E5(){return this.each(N5)}function j5(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function _5(){return this.each(j5)}function C5(e){var t=typeof e=="function"?e:zN(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function A5(){return null}function T5(e,t){var r=typeof e=="function"?e:zN(e),i=t==null?A5:typeof t=="function"?t:ag(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),i.apply(this,arguments)||null)})}function M5(){var e=this.parentNode;e&&e.removeChild(this)}function R5(){return this.each(M5)}function k5(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function D5(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function I5(e){return this.select(e?D5:k5)}function L5(e){return arguments.length?this.property("__data__",e):this.node().__data__}function O5(e){return function(t){e.call(this,t,this.__data__)}}function z5(e){return e.trim().split(/^|\s+/).map(function(t){var r="",i=t.indexOf(".");return i>=0&&(r=t.slice(i+1),t=t.slice(0,i)),{type:t,name:r}})}function $5(e){return function(){var t=this.__on;if(t){for(var r=0,i=-1,l=t.length,c;r<l;++r)c=t[r],(!e.type||c.type===e.type)&&c.name===e.name?this.removeEventListener(c.type,c.listener,c.options):t[++i]=c;++i?t.length=i:delete this.__on}}}function F5(e,t,r){return function(){var i=this.__on,l,c=O5(t);if(i){for(var f=0,m=i.length;f<m;++f)if((l=i[f]).type===e.type&&l.name===e.name){this.removeEventListener(l.type,l.listener,l.options),this.addEventListener(l.type,l.listener=c,l.options=r),l.value=t;return}}this.addEventListener(e.type,c,r),l={type:e.type,name:e.name,value:t,listener:c,options:r},i?i.push(l):this.__on=[l]}}function U5(e,t,r){var i=z5(e+""),l,c=i.length,f;if(arguments.length<2){var m=this.node().__on;if(m){for(var h=0,p=m.length,y;h<p;++h)for(l=0,y=m[h];l<c;++l)if((f=i[l]).type===y.type&&f.name===y.name)return y.value}return}for(m=t?F5:$5,l=0;l<c;++l)this.each(m(i[l],t,r));return this}function GN(e,t,r){var i=qN(e),l=i.CustomEvent;typeof l=="function"?l=new l(t,r):(l=i.document.createEvent("Event"),r?(l.initEvent(t,r.bubbles,r.cancelable),l.detail=r.detail):l.initEvent(t,!1,!1)),e.dispatchEvent(l)}function B5(e,t){return function(){return GN(this,e,t)}}function q5(e,t){return function(){return GN(this,e,t.apply(this,arguments))}}function H5(e,t){return this.each((typeof t=="function"?q5:B5)(e,t))}function*P5(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],l=0,c=i.length,f;l<c;++l)(f=i[l])&&(yield f)}var XN=[null];function Ya(e,t){this._groups=e,this._parents=t}function Cc(){return new Ya([[document.documentElement]],XN)}function V5(){return this}Ya.prototype=Cc.prototype={constructor:Ya,select:gL,selectAll:SL,selectChild:jL,selectChildren:TL,filter:ML,data:OL,enter:RL,exit:$L,join:FL,merge:UL,selection:V5,order:BL,sort:qL,call:PL,nodes:VL,node:YL,size:GL,empty:XL,each:KL,attr:n5,style:i5,property:u5,classed:h5,text:b5,html:w5,raise:E5,lower:_5,append:C5,insert:T5,remove:R5,clone:I5,datum:L5,on:U5,dispatch:H5,[Symbol.iterator]:P5};function rs(e){return typeof e=="string"?new Ya([[document.querySelector(e)]],[document.documentElement]):new Ya([[e]],XN)}function Y5(e){let t;for(;t=e.sourceEvent;)e=t;return e}function hs(e,t){if(e=Y5(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var i=r.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}if(t.getBoundingClientRect){var l=t.getBoundingClientRect();return[e.clientX-l.left-t.clientLeft,e.clientY-l.top-t.clientTop]}}return[e.pageX,e.pageY]}const G5={passive:!1},mc={capture:!0,passive:!1};function yp(e){e.stopImmediatePropagation()}function _l(e){e.preventDefault(),e.stopImmediatePropagation()}function KN(e){var t=e.document.documentElement,r=rs(e).on("dragstart.drag",_l,mc);"onselectstart"in t?r.on("selectstart.drag",_l,mc):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function WN(e,t){var r=e.document.documentElement,i=rs(e).on("dragstart.drag",null);t&&(i.on("click.drag",_l,mc),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in r?i.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}const Qu=e=>()=>e;function ty(e,{sourceEvent:t,subject:r,target:i,identifier:l,active:c,x:f,y:m,dx:h,dy:p,dispatch:y}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:l,enumerable:!0,configurable:!0},active:{value:c,enumerable:!0,configurable:!0},x:{value:f,enumerable:!0,configurable:!0},y:{value:m,enumerable:!0,configurable:!0},dx:{value:h,enumerable:!0,configurable:!0},dy:{value:p,enumerable:!0,configurable:!0},_:{value:y}})}ty.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function X5(e){return!e.ctrlKey&&!e.button}function K5(){return this.parentNode}function W5(e,t){return t??{x:e.x,y:e.y}}function Z5(){return navigator.maxTouchPoints||"ontouchstart"in this}function Q5(){var e=X5,t=K5,r=W5,i=Z5,l={},c=gf("start","drag","end"),f=0,m,h,p,y,g=0;function v(E){E.on("mousedown.drag",S).filter(i).on("touchstart.drag",j).on("touchmove.drag",_,G5).on("touchend.drag touchcancel.drag",C).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function S(E,T){if(!(y||!e.call(this,E,T))){var M=O(this,t.call(this,E,T),E,T,"mouse");M&&(rs(E.view).on("mousemove.drag",w,mc).on("mouseup.drag",N,mc),KN(E.view),yp(E),p=!1,m=E.clientX,h=E.clientY,M("start",E))}}function w(E){if(_l(E),!p){var T=E.clientX-m,M=E.clientY-h;p=T*T+M*M>g}l.mouse("drag",E)}function N(E){rs(E.view).on("mousemove.drag mouseup.drag",null),WN(E.view,p),_l(E),l.mouse("end",E)}function j(E,T){if(e.call(this,E,T)){var M=E.changedTouches,A=t.call(this,E,T),z=M.length,P,X;for(P=0;P<z;++P)(X=O(this,A,E,T,M[P].identifier,M[P]))&&(yp(E),X("start",E,M[P]))}}function _(E){var T=E.changedTouches,M=T.length,A,z;for(A=0;A<M;++A)(z=l[T[A].identifier])&&(_l(E),z("drag",E,T[A]))}function C(E){var T=E.changedTouches,M=T.length,A,z;for(y&&clearTimeout(y),y=setTimeout(function(){y=null},500),A=0;A<M;++A)(z=l[T[A].identifier])&&(yp(E),z("end",E,T[A]))}function O(E,T,M,A,z,P){var X=c.copy(),H=hs(P||M,T),Y,V,I;if((I=r.call(E,new ty("beforestart",{sourceEvent:M,target:v,identifier:z,active:f,x:H[0],y:H[1],dx:0,dy:0,dispatch:X}),A))!=null)return Y=I.x-H[0]||0,V=I.y-H[1]||0,function F(D,L,U){var k=H,B;switch(D){case"start":l[z]=F,B=f++;break;case"end":delete l[z],--f;case"drag":H=hs(U||L,T),B=f;break}X.call(D,E,new ty(D,{sourceEvent:L,subject:I,target:v,identifier:z,active:B,x:H[0]+Y,y:H[1]+V,dx:H[0]-k[0],dy:H[1]-k[1],dispatch:X}),A)}}return v.filter=function(E){return arguments.length?(e=typeof E=="function"?E:Qu(!!E),v):e},v.container=function(E){return arguments.length?(t=typeof E=="function"?E:Qu(E),v):t},v.subject=function(E){return arguments.length?(r=typeof E=="function"?E:Qu(E),v):r},v.touchable=function(E){return arguments.length?(i=typeof E=="function"?E:Qu(!!E),v):i},v.on=function(){var E=c.on.apply(c,arguments);return E===c?v:E},v.clickDistance=function(E){return arguments.length?(g=(E=+E)*E,v):Math.sqrt(g)},v}function rg(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function ZN(e,t){var r=Object.create(e.prototype);for(var i in t)r[i]=t[i];return r}function Ac(){}var hc=.7,zd=1/hc,Cl="\\s*([+-]?\\d+)\\s*",pc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ks="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",J5=/^#([0-9a-f]{3,8})$/,eO=new RegExp(`^rgb\\(${Cl},${Cl},${Cl}\\)$`),tO=new RegExp(`^rgb\\(${ks},${ks},${ks}\\)$`),nO=new RegExp(`^rgba\\(${Cl},${Cl},${Cl},${pc}\\)$`),aO=new RegExp(`^rgba\\(${ks},${ks},${ks},${pc}\\)$`),sO=new RegExp(`^hsl\\(${pc},${ks},${ks}\\)$`),rO=new RegExp(`^hsla\\(${pc},${ks},${ks},${pc}\\)$`),US={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};rg(Ac,yc,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:BS,formatHex:BS,formatHex8:iO,formatHsl:lO,formatRgb:qS,toString:qS});function BS(){return this.rgb().formatHex()}function iO(){return this.rgb().formatHex8()}function lO(){return QN(this).formatHsl()}function qS(){return this.rgb().formatRgb()}function yc(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=J5.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?HS(t):r===3?new Ma(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?Ju(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?Ju(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=eO.exec(e))?new Ma(t[1],t[2],t[3],1):(t=tO.exec(e))?new Ma(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=nO.exec(e))?Ju(t[1],t[2],t[3],t[4]):(t=aO.exec(e))?Ju(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=sO.exec(e))?YS(t[1],t[2]/100,t[3]/100,1):(t=rO.exec(e))?YS(t[1],t[2]/100,t[3]/100,t[4]):US.hasOwnProperty(e)?HS(US[e]):e==="transparent"?new Ma(NaN,NaN,NaN,0):null}function HS(e){return new Ma(e>>16&255,e>>8&255,e&255,1)}function Ju(e,t,r,i){return i<=0&&(e=t=r=NaN),new Ma(e,t,r,i)}function oO(e){return e instanceof Ac||(e=yc(e)),e?(e=e.rgb(),new Ma(e.r,e.g,e.b,e.opacity)):new Ma}function ny(e,t,r,i){return arguments.length===1?oO(e):new Ma(e,t,r,i??1)}function Ma(e,t,r,i){this.r=+e,this.g=+t,this.b=+r,this.opacity=+i}rg(Ma,ny,ZN(Ac,{brighter(e){return e=e==null?zd:Math.pow(zd,e),new Ma(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?hc:Math.pow(hc,e),new Ma(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ma(Ai(this.r),Ai(this.g),Ai(this.b),$d(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:PS,formatHex:PS,formatHex8:cO,formatRgb:VS,toString:VS}));function PS(){return`#${_i(this.r)}${_i(this.g)}${_i(this.b)}`}function cO(){return`#${_i(this.r)}${_i(this.g)}${_i(this.b)}${_i((isNaN(this.opacity)?1:this.opacity)*255)}`}function VS(){const e=$d(this.opacity);return`${e===1?"rgb(":"rgba("}${Ai(this.r)}, ${Ai(this.g)}, ${Ai(this.b)}${e===1?")":`, ${e})`}`}function $d(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ai(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function _i(e){return e=Ai(e),(e<16?"0":"")+e.toString(16)}function YS(e,t,r,i){return i<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new ps(e,t,r,i)}function QN(e){if(e instanceof ps)return new ps(e.h,e.s,e.l,e.opacity);if(e instanceof Ac||(e=yc(e)),!e)return new ps;if(e instanceof ps)return e;e=e.rgb();var t=e.r/255,r=e.g/255,i=e.b/255,l=Math.min(t,r,i),c=Math.max(t,r,i),f=NaN,m=c-l,h=(c+l)/2;return m?(t===c?f=(r-i)/m+(r<i)*6:r===c?f=(i-t)/m+2:f=(t-r)/m+4,m/=h<.5?c+l:2-c-l,f*=60):m=h>0&&h<1?0:f,new ps(f,m,h,e.opacity)}function uO(e,t,r,i){return arguments.length===1?QN(e):new ps(e,t,r,i??1)}function ps(e,t,r,i){this.h=+e,this.s=+t,this.l=+r,this.opacity=+i}rg(ps,uO,ZN(Ac,{brighter(e){return e=e==null?zd:Math.pow(zd,e),new ps(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?hc:Math.pow(hc,e),new ps(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*t,l=2*r-i;return new Ma(gp(e>=240?e-240:e+120,l,i),gp(e,l,i),gp(e<120?e+240:e-120,l,i),this.opacity)},clamp(){return new ps(GS(this.h),ed(this.s),ed(this.l),$d(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=$d(this.opacity);return`${e===1?"hsl(":"hsla("}${GS(this.h)}, ${ed(this.s)*100}%, ${ed(this.l)*100}%${e===1?")":`, ${e})`}`}}));function GS(e){return e=(e||0)%360,e<0?e+360:e}function ed(e){return Math.max(0,Math.min(1,e||0))}function gp(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const JN=e=>()=>e;function dO(e,t){return function(r){return e+r*t}}function fO(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(i){return Math.pow(e+i*t,r)}}function mO(e){return(e=+e)==1?eE:function(t,r){return r-t?fO(t,r,e):JN(isNaN(t)?r:t)}}function eE(e,t){var r=t-e;return r?dO(e,r):JN(isNaN(e)?t:e)}const XS=(function e(t){var r=mO(t);function i(l,c){var f=r((l=ny(l)).r,(c=ny(c)).r),m=r(l.g,c.g),h=r(l.b,c.b),p=eE(l.opacity,c.opacity);return function(y){return l.r=f(y),l.g=m(y),l.b=h(y),l.opacity=p(y),l+""}}return i.gamma=e,i})(1);function zr(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}var ay=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,bp=new RegExp(ay.source,"g");function hO(e){return function(){return e}}function pO(e){return function(t){return e(t)+""}}function yO(e,t){var r=ay.lastIndex=bp.lastIndex=0,i,l,c,f=-1,m=[],h=[];for(e=e+"",t=t+"";(i=ay.exec(e))&&(l=bp.exec(t));)(c=l.index)>r&&(c=t.slice(r,c),m[f]?m[f]+=c:m[++f]=c),(i=i[0])===(l=l[0])?m[f]?m[f]+=l:m[++f]=l:(m[++f]=null,h.push({i:f,x:zr(i,l)})),r=bp.lastIndex;return r<t.length&&(c=t.slice(r),m[f]?m[f]+=c:m[++f]=c),m.length<2?h[0]?pO(h[0].x):hO(t):(t=h.length,function(p){for(var y=0,g;y<t;++y)m[(g=h[y]).i]=g.x(p);return m.join("")})}var KS=180/Math.PI,sy={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function tE(e,t,r,i,l,c){var f,m,h;return(f=Math.sqrt(e*e+t*t))&&(e/=f,t/=f),(h=e*r+t*i)&&(r-=e*h,i-=t*h),(m=Math.sqrt(r*r+i*i))&&(r/=m,i/=m,h/=m),e*i<t*r&&(e=-e,t=-t,h=-h,f=-f),{translateX:l,translateY:c,rotate:Math.atan2(t,e)*KS,skewX:Math.atan(h)*KS,scaleX:f,scaleY:m}}var td;function gO(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?sy:tE(t.a,t.b,t.c,t.d,t.e,t.f)}function bO(e){return e==null||(td||(td=document.createElementNS("http://www.w3.org/2000/svg","g")),td.setAttribute("transform",e),!(e=td.transform.baseVal.consolidate()))?sy:(e=e.matrix,tE(e.a,e.b,e.c,e.d,e.e,e.f))}function nE(e,t,r,i){function l(p){return p.length?p.pop()+" ":""}function c(p,y,g,v,S,w){if(p!==g||y!==v){var N=S.push("translate(",null,t,null,r);w.push({i:N-4,x:zr(p,g)},{i:N-2,x:zr(y,v)})}else(g||v)&&S.push("translate("+g+t+v+r)}function f(p,y,g,v){p!==y?(p-y>180?y+=360:y-p>180&&(p+=360),v.push({i:g.push(l(g)+"rotate(",null,i)-2,x:zr(p,y)})):y&&g.push(l(g)+"rotate("+y+i)}function m(p,y,g,v){p!==y?v.push({i:g.push(l(g)+"skewX(",null,i)-2,x:zr(p,y)}):y&&g.push(l(g)+"skewX("+y+i)}function h(p,y,g,v,S,w){if(p!==g||y!==v){var N=S.push(l(S)+"scale(",null,",",null,")");w.push({i:N-4,x:zr(p,g)},{i:N-2,x:zr(y,v)})}else(g!==1||v!==1)&&S.push(l(S)+"scale("+g+","+v+")")}return function(p,y){var g=[],v=[];return p=e(p),y=e(y),c(p.translateX,p.translateY,y.translateX,y.translateY,g,v),f(p.rotate,y.rotate,g,v),m(p.skewX,y.skewX,g,v),h(p.scaleX,p.scaleY,y.scaleX,y.scaleY,g,v),p=y=null,function(S){for(var w=-1,N=v.length,j;++w<N;)g[(j=v[w]).i]=j.x(S);return g.join("")}}}var vO=nE(gO,"px, ","px)","deg)"),xO=nE(bO,", ",")",")"),SO=1e-12;function WS(e){return((e=Math.exp(e))+1/e)/2}function wO(e){return((e=Math.exp(e))-1/e)/2}function NO(e){return((e=Math.exp(2*e))-1)/(e+1)}const EO=(function e(t,r,i){function l(c,f){var m=c[0],h=c[1],p=c[2],y=f[0],g=f[1],v=f[2],S=y-m,w=g-h,N=S*S+w*w,j,_;if(N<SO)_=Math.log(v/p)/t,j=function(A){return[m+A*S,h+A*w,p*Math.exp(t*A*_)]};else{var C=Math.sqrt(N),O=(v*v-p*p+i*N)/(2*p*r*C),E=(v*v-p*p-i*N)/(2*v*r*C),T=Math.log(Math.sqrt(O*O+1)-O),M=Math.log(Math.sqrt(E*E+1)-E);_=(M-T)/t,j=function(A){var z=A*_,P=WS(T),X=p/(r*C)*(P*NO(t*z+T)-wO(T));return[m+X*S,h+X*w,p*P/WS(t*z+T)]}}return j.duration=_*1e3*t/Math.SQRT2,j}return l.rho=function(c){var f=Math.max(.001,+c),m=f*f,h=m*m;return e(f,m,h)},l})(Math.SQRT2,2,4);var Il=0,Zo=0,Fo=0,aE=1e3,Fd,Qo,Ud=0,Mi=0,vf=0,gc=typeof performance=="object"&&performance.now?performance:Date,sE=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function ig(){return Mi||(sE(jO),Mi=gc.now()+vf)}function jO(){Mi=0}function Bd(){this._call=this._time=this._next=null}Bd.prototype=rE.prototype={constructor:Bd,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?ig():+r)+(t==null?0:+t),!this._next&&Qo!==this&&(Qo?Qo._next=this:Fd=this,Qo=this),this._call=e,this._time=r,ry()},stop:function(){this._call&&(this._call=null,this._time=1/0,ry())}};function rE(e,t,r){var i=new Bd;return i.restart(e,t,r),i}function _O(){ig(),++Il;for(var e=Fd,t;e;)(t=Mi-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Il}function ZS(){Mi=(Ud=gc.now())+vf,Il=Zo=0;try{_O()}finally{Il=0,AO(),Mi=0}}function CO(){var e=gc.now(),t=e-Ud;t>aE&&(vf-=t,Ud=e)}function AO(){for(var e,t=Fd,r,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:Fd=r);Qo=e,ry(i)}function ry(e){if(!Il){Zo&&(Zo=clearTimeout(Zo));var t=e-Mi;t>24?(e<1/0&&(Zo=setTimeout(ZS,e-gc.now()-vf)),Fo&&(Fo=clearInterval(Fo))):(Fo||(Ud=gc.now(),Fo=setInterval(CO,aE)),Il=1,sE(ZS))}}function QS(e,t,r){var i=new Bd;return t=t==null?0:+t,i.restart(l=>{i.stop(),e(l+t)},t,r),i}var TO=gf("start","end","cancel","interrupt"),MO=[],iE=0,JS=1,iy=2,wd=3,ew=4,ly=5,Nd=6;function xf(e,t,r,i,l,c){var f=e.__transition;if(!f)e.__transition={};else if(r in f)return;RO(e,r,{name:t,index:i,group:l,on:TO,tween:MO,time:c.time,delay:c.delay,duration:c.duration,ease:c.ease,timer:null,state:iE})}function lg(e,t){var r=Ss(e,t);if(r.state>iE)throw new Error("too late; already scheduled");return r}function Ls(e,t){var r=Ss(e,t);if(r.state>wd)throw new Error("too late; already running");return r}function Ss(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function RO(e,t,r){var i=e.__transition,l;i[t]=r,r.timer=rE(c,0,r.time);function c(p){r.state=JS,r.timer.restart(f,r.delay,r.time),r.delay<=p&&f(p-r.delay)}function f(p){var y,g,v,S;if(r.state!==JS)return h();for(y in i)if(S=i[y],S.name===r.name){if(S.state===wd)return QS(f);S.state===ew?(S.state=Nd,S.timer.stop(),S.on.call("interrupt",e,e.__data__,S.index,S.group),delete i[y]):+y<t&&(S.state=Nd,S.timer.stop(),S.on.call("cancel",e,e.__data__,S.index,S.group),delete i[y])}if(QS(function(){r.state===wd&&(r.state=ew,r.timer.restart(m,r.delay,r.time),m(p))}),r.state=iy,r.on.call("start",e,e.__data__,r.index,r.group),r.state===iy){for(r.state=wd,l=new Array(v=r.tween.length),y=0,g=-1;y<v;++y)(S=r.tween[y].value.call(e,e.__data__,r.index,r.group))&&(l[++g]=S);l.length=g+1}}function m(p){for(var y=p<r.duration?r.ease.call(null,p/r.duration):(r.timer.restart(h),r.state=ly,1),g=-1,v=l.length;++g<v;)l[g].call(e,y);r.state===ly&&(r.on.call("end",e,e.__data__,r.index,r.group),h())}function h(){r.state=Nd,r.timer.stop(),delete i[t];for(var p in i)return;delete e.__transition}}function Ed(e,t){var r=e.__transition,i,l,c=!0,f;if(r){t=t==null?null:t+"";for(f in r){if((i=r[f]).name!==t){c=!1;continue}l=i.state>iy&&i.state<ly,i.state=Nd,i.timer.stop(),i.on.call(l?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete r[f]}c&&delete e.__transition}}function kO(e){return this.each(function(){Ed(this,e)})}function DO(e,t){var r,i;return function(){var l=Ls(this,e),c=l.tween;if(c!==r){i=r=c;for(var f=0,m=i.length;f<m;++f)if(i[f].name===t){i=i.slice(),i.splice(f,1);break}}l.tween=i}}function IO(e,t,r){var i,l;if(typeof r!="function")throw new Error;return function(){var c=Ls(this,e),f=c.tween;if(f!==i){l=(i=f).slice();for(var m={name:t,value:r},h=0,p=l.length;h<p;++h)if(l[h].name===t){l[h]=m;break}h===p&&l.push(m)}c.tween=l}}function LO(e,t){var r=this._id;if(e+="",arguments.length<2){for(var i=Ss(this.node(),r).tween,l=0,c=i.length,f;l<c;++l)if((f=i[l]).name===e)return f.value;return null}return this.each((t==null?DO:IO)(r,e,t))}function og(e,t,r){var i=e._id;return e.each(function(){var l=Ls(this,i);(l.value||(l.value={}))[t]=r.apply(this,arguments)}),function(l){return Ss(l,i).value[t]}}function lE(e,t){var r;return(typeof t=="number"?zr:t instanceof yc?XS:(r=yc(t))?(t=r,XS):yO)(e,t)}function OO(e){return function(){this.removeAttribute(e)}}function zO(e){return function(){this.removeAttributeNS(e.space,e.local)}}function $O(e,t,r){var i,l=r+"",c;return function(){var f=this.getAttribute(e);return f===l?null:f===i?c:c=t(i=f,r)}}function FO(e,t,r){var i,l=r+"",c;return function(){var f=this.getAttributeNS(e.space,e.local);return f===l?null:f===i?c:c=t(i=f,r)}}function UO(e,t,r){var i,l,c;return function(){var f,m=r(this),h;return m==null?void this.removeAttribute(e):(f=this.getAttribute(e),h=m+"",f===h?null:f===i&&h===l?c:(l=h,c=t(i=f,m)))}}function BO(e,t,r){var i,l,c;return function(){var f,m=r(this),h;return m==null?void this.removeAttributeNS(e.space,e.local):(f=this.getAttributeNS(e.space,e.local),h=m+"",f===h?null:f===i&&h===l?c:(l=h,c=t(i=f,m)))}}function qO(e,t){var r=bf(e),i=r==="transform"?xO:lE;return this.attrTween(e,typeof t=="function"?(r.local?BO:UO)(r,i,og(this,"attr."+e,t)):t==null?(r.local?zO:OO)(r):(r.local?FO:$O)(r,i,t))}function HO(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function PO(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function VO(e,t){var r,i;function l(){var c=t.apply(this,arguments);return c!==i&&(r=(i=c)&&PO(e,c)),r}return l._value=t,l}function YO(e,t){var r,i;function l(){var c=t.apply(this,arguments);return c!==i&&(r=(i=c)&&HO(e,c)),r}return l._value=t,l}function GO(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var i=bf(e);return this.tween(r,(i.local?VO:YO)(i,t))}function XO(e,t){return function(){lg(this,e).delay=+t.apply(this,arguments)}}function KO(e,t){return t=+t,function(){lg(this,e).delay=t}}function WO(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?XO:KO)(t,e)):Ss(this.node(),t).delay}function ZO(e,t){return function(){Ls(this,e).duration=+t.apply(this,arguments)}}function QO(e,t){return t=+t,function(){Ls(this,e).duration=t}}function JO(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?ZO:QO)(t,e)):Ss(this.node(),t).duration}function e7(e,t){if(typeof t!="function")throw new Error;return function(){Ls(this,e).ease=t}}function t7(e){var t=this._id;return arguments.length?this.each(e7(t,e)):Ss(this.node(),t).ease}function n7(e,t){return function(){var r=t.apply(this,arguments);if(typeof r!="function")throw new Error;Ls(this,e).ease=r}}function a7(e){if(typeof e!="function")throw new Error;return this.each(n7(this._id,e))}function s7(e){typeof e!="function"&&(e=FN(e));for(var t=this._groups,r=t.length,i=new Array(r),l=0;l<r;++l)for(var c=t[l],f=c.length,m=i[l]=[],h,p=0;p<f;++p)(h=c[p])&&e.call(h,h.__data__,p,c)&&m.push(h);return new ir(i,this._parents,this._name,this._id)}function r7(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,i=t.length,l=r.length,c=Math.min(i,l),f=new Array(i),m=0;m<c;++m)for(var h=t[m],p=r[m],y=h.length,g=f[m]=new Array(y),v,S=0;S<y;++S)(v=h[S]||p[S])&&(g[S]=v);for(;m<i;++m)f[m]=t[m];return new ir(f,this._parents,this._name,this._id)}function i7(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function l7(e,t,r){var i,l,c=i7(t)?lg:Ls;return function(){var f=c(this,e),m=f.on;m!==i&&(l=(i=m).copy()).on(t,r),f.on=l}}function o7(e,t){var r=this._id;return arguments.length<2?Ss(this.node(),r).on.on(e):this.each(l7(r,e,t))}function c7(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function u7(){return this.on("end.remove",c7(this._id))}function d7(e){var t=this._name,r=this._id;typeof e!="function"&&(e=ag(e));for(var i=this._groups,l=i.length,c=new Array(l),f=0;f<l;++f)for(var m=i[f],h=m.length,p=c[f]=new Array(h),y,g,v=0;v<h;++v)(y=m[v])&&(g=e.call(y,y.__data__,v,m))&&("__data__"in y&&(g.__data__=y.__data__),p[v]=g,xf(p[v],t,r,v,p,Ss(y,r)));return new ir(c,this._parents,t,r)}function f7(e){var t=this._name,r=this._id;typeof e!="function"&&(e=$N(e));for(var i=this._groups,l=i.length,c=[],f=[],m=0;m<l;++m)for(var h=i[m],p=h.length,y,g=0;g<p;++g)if(y=h[g]){for(var v=e.call(y,y.__data__,g,h),S,w=Ss(y,r),N=0,j=v.length;N<j;++N)(S=v[N])&&xf(S,t,r,N,v,w);c.push(v),f.push(y)}return new ir(c,f,t,r)}var m7=Cc.prototype.constructor;function h7(){return new m7(this._groups,this._parents)}function p7(e,t){var r,i,l;return function(){var c=Dl(this,e),f=(this.style.removeProperty(e),Dl(this,e));return c===f?null:c===r&&f===i?l:l=t(r=c,i=f)}}function oE(e){return function(){this.style.removeProperty(e)}}function y7(e,t,r){var i,l=r+"",c;return function(){var f=Dl(this,e);return f===l?null:f===i?c:c=t(i=f,r)}}function g7(e,t,r){var i,l,c;return function(){var f=Dl(this,e),m=r(this),h=m+"";return m==null&&(h=m=(this.style.removeProperty(e),Dl(this,e))),f===h?null:f===i&&h===l?c:(l=h,c=t(i=f,m))}}function b7(e,t){var r,i,l,c="style."+t,f="end."+c,m;return function(){var h=Ls(this,e),p=h.on,y=h.value[c]==null?m||(m=oE(t)):void 0;(p!==r||l!==y)&&(i=(r=p).copy()).on(f,l=y),h.on=i}}function v7(e,t,r){var i=(e+="")=="transform"?vO:lE;return t==null?this.styleTween(e,p7(e,i)).on("end.style."+e,oE(e)):typeof t=="function"?this.styleTween(e,g7(e,i,og(this,"style."+e,t))).each(b7(this._id,e)):this.styleTween(e,y7(e,i,t),r).on("end.style."+e,null)}function x7(e,t,r){return function(i){this.style.setProperty(e,t.call(this,i),r)}}function S7(e,t,r){var i,l;function c(){var f=t.apply(this,arguments);return f!==l&&(i=(l=f)&&x7(e,f,r)),i}return c._value=t,c}function w7(e,t,r){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,S7(e,t,r??""))}function N7(e){return function(){this.textContent=e}}function E7(e){return function(){var t=e(this);this.textContent=t??""}}function j7(e){return this.tween("text",typeof e=="function"?E7(og(this,"text",e)):N7(e==null?"":e+""))}function _7(e){return function(t){this.textContent=e.call(this,t)}}function C7(e){var t,r;function i(){var l=e.apply(this,arguments);return l!==r&&(t=(r=l)&&_7(l)),t}return i._value=e,i}function A7(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,C7(e))}function T7(){for(var e=this._name,t=this._id,r=cE(),i=this._groups,l=i.length,c=0;c<l;++c)for(var f=i[c],m=f.length,h,p=0;p<m;++p)if(h=f[p]){var y=Ss(h,t);xf(h,e,r,p,f,{time:y.time+y.delay+y.duration,delay:0,duration:y.duration,ease:y.ease})}return new ir(i,this._parents,e,r)}function M7(){var e,t,r=this,i=r._id,l=r.size();return new Promise(function(c,f){var m={value:f},h={value:function(){--l===0&&c()}};r.each(function(){var p=Ls(this,i),y=p.on;y!==e&&(t=(e=y).copy(),t._.cancel.push(m),t._.interrupt.push(m),t._.end.push(h)),p.on=t}),l===0&&c()})}var R7=0;function ir(e,t,r,i){this._groups=e,this._parents=t,this._name=r,this._id=i}function cE(){return++R7}var Qs=Cc.prototype;ir.prototype={constructor:ir,select:d7,selectAll:f7,selectChild:Qs.selectChild,selectChildren:Qs.selectChildren,filter:s7,merge:r7,selection:h7,transition:T7,call:Qs.call,nodes:Qs.nodes,node:Qs.node,size:Qs.size,empty:Qs.empty,each:Qs.each,on:o7,attr:qO,attrTween:GO,style:v7,styleTween:w7,text:j7,textTween:A7,remove:u7,tween:LO,delay:WO,duration:JO,ease:t7,easeVarying:a7,end:M7,[Symbol.iterator]:Qs[Symbol.iterator]};function k7(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var D7={time:null,delay:0,duration:250,ease:k7};function I7(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}function L7(e){var t,r;e instanceof ir?(t=e._id,e=e._name):(t=cE(),(r=D7).time=ig(),e=e==null?null:e+"");for(var i=this._groups,l=i.length,c=0;c<l;++c)for(var f=i[c],m=f.length,h,p=0;p<m;++p)(h=f[p])&&xf(h,e,t,p,f,r||I7(h,t));return new ir(i,this._parents,e,t)}Cc.prototype.interrupt=kO;Cc.prototype.transition=L7;const nd=e=>()=>e;function O7(e,{sourceEvent:t,target:r,transform:i,dispatch:l}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:l}})}function nr(e,t,r){this.k=e,this.x=t,this.y=r}nr.prototype={constructor:nr,scale:function(e){return e===1?this:new nr(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new nr(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var sr=new nr(1,0,0);nr.prototype;function vp(e){e.stopImmediatePropagation()}function Uo(e){e.preventDefault(),e.stopImmediatePropagation()}function z7(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function $7(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function tw(){return this.__zoom||sr}function F7(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function U7(){return navigator.maxTouchPoints||"ontouchstart"in this}function B7(e,t,r){var i=e.invertX(t[0][0])-r[0][0],l=e.invertX(t[1][0])-r[1][0],c=e.invertY(t[0][1])-r[0][1],f=e.invertY(t[1][1])-r[1][1];return e.translate(l>i?(i+l)/2:Math.min(0,i)||Math.max(0,l),f>c?(c+f)/2:Math.min(0,c)||Math.max(0,f))}function uE(){var e=z7,t=$7,r=B7,i=F7,l=U7,c=[0,1/0],f=[[-1/0,-1/0],[1/0,1/0]],m=250,h=EO,p=gf("start","zoom","end"),y,g,v,S=500,w=150,N=0,j=10;function _(I){I.property("__zoom",tw).on("wheel.zoom",z,{passive:!1}).on("mousedown.zoom",P).on("dblclick.zoom",X).filter(l).on("touchstart.zoom",H).on("touchmove.zoom",Y).on("touchend.zoom touchcancel.zoom",V).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}_.transform=function(I,F,D,L){var U=I.selection?I.selection():I;U.property("__zoom",tw),I!==U?T(I,F,D,L):U.interrupt().each(function(){M(this,arguments).event(L).start().zoom(null,typeof F=="function"?F.apply(this,arguments):F).end()})},_.scaleBy=function(I,F,D,L){_.scaleTo(I,function(){var U=this.__zoom.k,k=typeof F=="function"?F.apply(this,arguments):F;return U*k},D,L)},_.scaleTo=function(I,F,D,L){_.transform(I,function(){var U=t.apply(this,arguments),k=this.__zoom,B=D==null?E(U):typeof D=="function"?D.apply(this,arguments):D,R=k.invert(B),q=typeof F=="function"?F.apply(this,arguments):F;return r(O(C(k,q),B,R),U,f)},D,L)},_.translateBy=function(I,F,D,L){_.transform(I,function(){return r(this.__zoom.translate(typeof F=="function"?F.apply(this,arguments):F,typeof D=="function"?D.apply(this,arguments):D),t.apply(this,arguments),f)},null,L)},_.translateTo=function(I,F,D,L,U){_.transform(I,function(){var k=t.apply(this,arguments),B=this.__zoom,R=L==null?E(k):typeof L=="function"?L.apply(this,arguments):L;return r(sr.translate(R[0],R[1]).scale(B.k).translate(typeof F=="function"?-F.apply(this,arguments):-F,typeof D=="function"?-D.apply(this,arguments):-D),k,f)},L,U)};function C(I,F){return F=Math.max(c[0],Math.min(c[1],F)),F===I.k?I:new nr(F,I.x,I.y)}function O(I,F,D){var L=F[0]-D[0]*I.k,U=F[1]-D[1]*I.k;return L===I.x&&U===I.y?I:new nr(I.k,L,U)}function E(I){return[(+I[0][0]+ +I[1][0])/2,(+I[0][1]+ +I[1][1])/2]}function T(I,F,D,L){I.on("start.zoom",function(){M(this,arguments).event(L).start()}).on("interrupt.zoom end.zoom",function(){M(this,arguments).event(L).end()}).tween("zoom",function(){var U=this,k=arguments,B=M(U,k).event(L),R=t.apply(U,k),q=D==null?E(R):typeof D=="function"?D.apply(U,k):D,G=Math.max(R[1][0]-R[0][0],R[1][1]-R[0][1]),J=U.__zoom,ie=typeof F=="function"?F.apply(U,k):F,Z=h(J.invert(q).concat(G/J.k),ie.invert(q).concat(G/ie.k));return function(me){if(me===1)me=ie;else{var Q=Z(me),oe=G/Q[2];me=new nr(oe,q[0]-Q[0]*oe,q[1]-Q[1]*oe)}B.zoom(null,me)}})}function M(I,F,D){return!D&&I.__zooming||new A(I,F)}function A(I,F){this.that=I,this.args=F,this.active=0,this.sourceEvent=null,this.extent=t.apply(I,F),this.taps=0}A.prototype={event:function(I){return I&&(this.sourceEvent=I),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(I,F){return this.mouse&&I!=="mouse"&&(this.mouse[1]=F.invert(this.mouse[0])),this.touch0&&I!=="touch"&&(this.touch0[1]=F.invert(this.touch0[0])),this.touch1&&I!=="touch"&&(this.touch1[1]=F.invert(this.touch1[0])),this.that.__zoom=F,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(I){var F=rs(this.that).datum();p.call(I,this.that,new O7(I,{sourceEvent:this.sourceEvent,target:_,transform:this.that.__zoom,dispatch:p}),F)}};function z(I,...F){if(!e.apply(this,arguments))return;var D=M(this,F).event(I),L=this.__zoom,U=Math.max(c[0],Math.min(c[1],L.k*Math.pow(2,i.apply(this,arguments)))),k=hs(I);if(D.wheel)(D.mouse[0][0]!==k[0]||D.mouse[0][1]!==k[1])&&(D.mouse[1]=L.invert(D.mouse[0]=k)),clearTimeout(D.wheel);else{if(L.k===U)return;D.mouse=[k,L.invert(k)],Ed(this),D.start()}Uo(I),D.wheel=setTimeout(B,w),D.zoom("mouse",r(O(C(L,U),D.mouse[0],D.mouse[1]),D.extent,f));function B(){D.wheel=null,D.end()}}function P(I,...F){if(v||!e.apply(this,arguments))return;var D=I.currentTarget,L=M(this,F,!0).event(I),U=rs(I.view).on("mousemove.zoom",q,!0).on("mouseup.zoom",G,!0),k=hs(I,D),B=I.clientX,R=I.clientY;KN(I.view),vp(I),L.mouse=[k,this.__zoom.invert(k)],Ed(this),L.start();function q(J){if(Uo(J),!L.moved){var ie=J.clientX-B,Z=J.clientY-R;L.moved=ie*ie+Z*Z>N}L.event(J).zoom("mouse",r(O(L.that.__zoom,L.mouse[0]=hs(J,D),L.mouse[1]),L.extent,f))}function G(J){U.on("mousemove.zoom mouseup.zoom",null),WN(J.view,L.moved),Uo(J),L.event(J).end()}}function X(I,...F){if(e.apply(this,arguments)){var D=this.__zoom,L=hs(I.changedTouches?I.changedTouches[0]:I,this),U=D.invert(L),k=D.k*(I.shiftKey?.5:2),B=r(O(C(D,k),L,U),t.apply(this,F),f);Uo(I),m>0?rs(this).transition().duration(m).call(T,B,L,I):rs(this).call(_.transform,B,L,I)}}function H(I,...F){if(e.apply(this,arguments)){var D=I.touches,L=D.length,U=M(this,F,I.changedTouches.length===L).event(I),k,B,R,q;for(vp(I),B=0;B<L;++B)R=D[B],q=hs(R,this),q=[q,this.__zoom.invert(q),R.identifier],U.touch0?!U.touch1&&U.touch0[2]!==q[2]&&(U.touch1=q,U.taps=0):(U.touch0=q,k=!0,U.taps=1+!!y);y&&(y=clearTimeout(y)),k&&(U.taps<2&&(g=q[0],y=setTimeout(function(){y=null},S)),Ed(this),U.start())}}function Y(I,...F){if(this.__zooming){var D=M(this,F).event(I),L=I.changedTouches,U=L.length,k,B,R,q;for(Uo(I),k=0;k<U;++k)B=L[k],R=hs(B,this),D.touch0&&D.touch0[2]===B.identifier?D.touch0[0]=R:D.touch1&&D.touch1[2]===B.identifier&&(D.touch1[0]=R);if(B=D.that.__zoom,D.touch1){var G=D.touch0[0],J=D.touch0[1],ie=D.touch1[0],Z=D.touch1[1],me=(me=ie[0]-G[0])*me+(me=ie[1]-G[1])*me,Q=(Q=Z[0]-J[0])*Q+(Q=Z[1]-J[1])*Q;B=C(B,Math.sqrt(me/Q)),R=[(G[0]+ie[0])/2,(G[1]+ie[1])/2],q=[(J[0]+Z[0])/2,(J[1]+Z[1])/2]}else if(D.touch0)R=D.touch0[0],q=D.touch0[1];else return;D.zoom("touch",r(O(B,R,q),D.extent,f))}}function V(I,...F){if(this.__zooming){var D=M(this,F).event(I),L=I.changedTouches,U=L.length,k,B;for(vp(I),v&&clearTimeout(v),v=setTimeout(function(){v=null},S),k=0;k<U;++k)B=L[k],D.touch0&&D.touch0[2]===B.identifier?delete D.touch0:D.touch1&&D.touch1[2]===B.identifier&&delete D.touch1;if(D.touch1&&!D.touch0&&(D.touch0=D.touch1,delete D.touch1),D.touch0)D.touch0[1]=this.__zoom.invert(D.touch0[0]);else if(D.end(),D.taps===2&&(B=hs(B,this),Math.hypot(g[0]-B[0],g[1]-B[1])<j)){var R=rs(this).on("dblclick.zoom");R&&R.apply(this,arguments)}}}return _.wheelDelta=function(I){return arguments.length?(i=typeof I=="function"?I:nd(+I),_):i},_.filter=function(I){return arguments.length?(e=typeof I=="function"?I:nd(!!I),_):e},_.touchable=function(I){return arguments.length?(l=typeof I=="function"?I:nd(!!I),_):l},_.extent=function(I){return arguments.length?(t=typeof I=="function"?I:nd([[+I[0][0],+I[0][1]],[+I[1][0],+I[1][1]]]),_):t},_.scaleExtent=function(I){return arguments.length?(c[0]=+I[0],c[1]=+I[1],_):[c[0],c[1]]},_.translateExtent=function(I){return arguments.length?(f[0][0]=+I[0][0],f[1][0]=+I[1][0],f[0][1]=+I[0][1],f[1][1]=+I[1][1],_):[[f[0][0],f[0][1]],[f[1][0],f[1][1]]]},_.constrain=function(I){return arguments.length?(r=I,_):r},_.duration=function(I){return arguments.length?(m=+I,_):m},_.interpolate=function(I){return arguments.length?(h=I,_):h},_.on=function(){var I=p.on.apply(p,arguments);return I===p?_:I},_.clickDistance=function(I){return arguments.length?(N=(I=+I)*I,_):Math.sqrt(N)},_.tapDistance=function(I){return arguments.length?(j=+I,_):j},_}const Sf=u.createContext(null),q7=Sf.Provider,lr={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,t)=>`Couldn't create edge for ${e?"target":"source"} handle id: "${e?t.targetHandle:t.sourceHandle}", edge id: ${t.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},dE=lr.error001();function Ln(e,t){const r=u.useContext(Sf);if(r===null)throw new Error(dE);return ON(r,e,t)}const aa=()=>{const e=u.useContext(Sf);if(e===null)throw new Error(dE);return u.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy}),[e])},H7=e=>e.userSelectionActive?"none":"all";function cg({position:e,children:t,className:r,style:i,...l}){const c=Ln(H7),f=`${e}`.split("-");return De.createElement("div",{className:ha(["react-flow__panel",r,...f]),style:{...i,pointerEvents:c},...l},t)}function P7({proOptions:e,position:t="bottom-right"}){return e?.hideAttribution?null:De.createElement(cg,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},De.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}const V7=({x:e,y:t,label:r,labelStyle:i={},labelShowBg:l=!0,labelBgStyle:c={},labelBgPadding:f=[2,4],labelBgBorderRadius:m=2,children:h,className:p,...y})=>{const g=u.useRef(null),[v,S]=u.useState({x:0,y:0,width:0,height:0}),w=ha(["react-flow__edge-textwrapper",p]);return u.useEffect(()=>{if(g.current){const N=g.current.getBBox();S({x:N.x,y:N.y,width:N.width,height:N.height})}},[r]),typeof r>"u"||!r?null:De.createElement("g",{transform:`translate(${e-v.width/2} ${t-v.height/2})`,className:w,visibility:v.width?"visible":"hidden",...y},l&&De.createElement("rect",{width:v.width+2*f[0],x:-f[0],y:-f[1],height:v.height+2*f[1],className:"react-flow__edge-textbg",style:c,rx:m,ry:m}),De.createElement("text",{className:"react-flow__edge-text",y:v.height/2,dy:"0.3em",ref:g,style:i},r),h)};var Y7=u.memo(V7);const ug=e=>({width:e.offsetWidth,height:e.offsetHeight}),Ll=(e,t=0,r=1)=>Math.min(Math.max(e,t),r),dg=(e={x:0,y:0},t)=>({x:Ll(e.x,t[0][0],t[1][0]),y:Ll(e.y,t[0][1],t[1][1])}),nw=(e,t,r)=>e<t?Ll(Math.abs(e-t),1,50)/50:e>r?-Ll(Math.abs(e-r),1,50)/50:0,fE=(e,t)=>{const r=nw(e.x,35,t.width-35)*20,i=nw(e.y,35,t.height-35)*20;return[r,i]},mE=e=>e.getRootNode?.()||window?.document,hE=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),bc=({x:e,y:t,width:r,height:i})=>({x:e,y:t,x2:e+r,y2:t+i}),pE=({x:e,y:t,x2:r,y2:i})=>({x:e,y:t,width:r-e,height:i-t}),aw=e=>({...e.positionAbsolute||{x:0,y:0},width:e.width||0,height:e.height||0}),G7=(e,t)=>pE(hE(bc(e),bc(t))),oy=(e,t)=>{const r=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),i=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(r*i)},X7=e=>is(e.width)&&is(e.height)&&is(e.x)&&is(e.y),is=e=>!isNaN(e)&&isFinite(e),Yn=Symbol.for("internals"),yE=["Enter"," ","Escape"],K7=(e,t)=>{},W7=e=>"nativeEvent"in e;function cy(e){const r=(W7(e)?e.nativeEvent:e).composedPath?.()?.[0]||e.target;return["INPUT","SELECT","TEXTAREA"].includes(r?.nodeName)||r?.hasAttribute("contenteditable")||!!r?.closest(".nokey")}const gE=e=>"clientX"in e,Pr=(e,t)=>{const r=gE(e),i=r?e.clientX:e.touches?.[0].clientX,l=r?e.clientY:e.touches?.[0].clientY;return{x:i-(t?.left??0),y:l-(t?.top??0)}},qd=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0,Tc=({id:e,path:t,labelX:r,labelY:i,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:g,markerStart:v,interactionWidth:S=20})=>De.createElement(De.Fragment,null,De.createElement("path",{id:e,style:y,d:t,fill:"none",className:"react-flow__edge-path",markerEnd:g,markerStart:v}),S&&De.createElement("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:S,className:"react-flow__edge-interaction"}),l&&is(r)&&is(i)?De.createElement(Y7,{x:r,y:i,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p}):null);Tc.displayName="BaseEdge";function Bo(e,t,r){return r===void 0?r:i=>{const l=t().edges.find(c=>c.id===e);l&&r(i,{...l})}}function bE({sourceX:e,sourceY:t,targetX:r,targetY:i}){const l=Math.abs(r-e)/2,c=r<e?r+l:r-l,f=Math.abs(i-t)/2,m=i<t?i+f:i-f;return[c,m,l,f]}function vE({sourceX:e,sourceY:t,targetX:r,targetY:i,sourceControlX:l,sourceControlY:c,targetControlX:f,targetControlY:m}){const h=e*.125+l*.375+f*.375+r*.125,p=t*.125+c*.375+m*.375+i*.125,y=Math.abs(h-e),g=Math.abs(p-t);return[h,p,y,g]}var Ri;(function(e){e.Strict="strict",e.Loose="loose"})(Ri||(Ri={}));var Ci;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(Ci||(Ci={}));var vc;(function(e){e.Partial="partial",e.Full="full"})(vc||(vc={}));var qr;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(qr||(qr={}));var Hd;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Hd||(Hd={}));var Ut;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(Ut||(Ut={}));function sw({pos:e,x1:t,y1:r,x2:i,y2:l}){return e===Ut.Left||e===Ut.Right?[.5*(t+i),r]:[t,.5*(r+l)]}function xE({sourceX:e,sourceY:t,sourcePosition:r=Ut.Bottom,targetX:i,targetY:l,targetPosition:c=Ut.Top}){const[f,m]=sw({pos:r,x1:e,y1:t,x2:i,y2:l}),[h,p]=sw({pos:c,x1:i,y1:l,x2:e,y2:t}),[y,g,v,S]=vE({sourceX:e,sourceY:t,targetX:i,targetY:l,sourceControlX:f,sourceControlY:m,targetControlX:h,targetControlY:p});return[`M${e},${t} C${f},${m} ${h},${p} ${i},${l}`,y,g,v,S]}const fg=u.memo(({sourceX:e,sourceY:t,targetX:r,targetY:i,sourcePosition:l=Ut.Bottom,targetPosition:c=Ut.Top,label:f,labelStyle:m,labelShowBg:h,labelBgStyle:p,labelBgPadding:y,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:w,interactionWidth:N})=>{const[j,_,C]=xE({sourceX:e,sourceY:t,sourcePosition:l,targetX:r,targetY:i,targetPosition:c});return De.createElement(Tc,{path:j,labelX:_,labelY:C,label:f,labelStyle:m,labelShowBg:h,labelBgStyle:p,labelBgPadding:y,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:w,interactionWidth:N})});fg.displayName="SimpleBezierEdge";const rw={[Ut.Left]:{x:-1,y:0},[Ut.Right]:{x:1,y:0},[Ut.Top]:{x:0,y:-1},[Ut.Bottom]:{x:0,y:1}},Z7=({source:e,sourcePosition:t=Ut.Bottom,target:r})=>t===Ut.Left||t===Ut.Right?e.x<r.x?{x:1,y:0}:{x:-1,y:0}:e.y<r.y?{x:0,y:1}:{x:0,y:-1},iw=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Q7({source:e,sourcePosition:t=Ut.Bottom,target:r,targetPosition:i=Ut.Top,center:l,offset:c}){const f=rw[t],m=rw[i],h={x:e.x+f.x*c,y:e.y+f.y*c},p={x:r.x+m.x*c,y:r.y+m.y*c},y=Z7({source:h,sourcePosition:t,target:p}),g=y.x!==0?"x":"y",v=y[g];let S=[],w,N;const j={x:0,y:0},_={x:0,y:0},[C,O,E,T]=bE({sourceX:e.x,sourceY:e.y,targetX:r.x,targetY:r.y});if(f[g]*m[g]===-1){w=l.x??C,N=l.y??O;const A=[{x:w,y:h.y},{x:w,y:p.y}],z=[{x:h.x,y:N},{x:p.x,y:N}];f[g]===v?S=g==="x"?A:z:S=g==="x"?z:A}else{const A=[{x:h.x,y:p.y}],z=[{x:p.x,y:h.y}];if(g==="x"?S=f.x===v?z:A:S=f.y===v?A:z,t===i){const V=Math.abs(e[g]-r[g]);if(V<=c){const I=Math.min(c-1,c-V);f[g]===v?j[g]=(h[g]>e[g]?-1:1)*I:_[g]=(p[g]>r[g]?-1:1)*I}}if(t!==i){const V=g==="x"?"y":"x",I=f[g]===m[V],F=h[V]>p[V],D=h[V]<p[V];(f[g]===1&&(!I&&F||I&&D)||f[g]!==1&&(!I&&D||I&&F))&&(S=g==="x"?A:z)}const P={x:h.x+j.x,y:h.y+j.y},X={x:p.x+_.x,y:p.y+_.y},H=Math.max(Math.abs(P.x-S[0].x),Math.abs(X.x-S[0].x)),Y=Math.max(Math.abs(P.y-S[0].y),Math.abs(X.y-S[0].y));H>=Y?(w=(P.x+X.x)/2,N=S[0].y):(w=S[0].x,N=(P.y+X.y)/2)}return[[e,{x:h.x+j.x,y:h.y+j.y},...S,{x:p.x+_.x,y:p.y+_.y},r],w,N,E,T]}function J7(e,t,r,i){const l=Math.min(iw(e,t)/2,iw(t,r)/2,i),{x:c,y:f}=t;if(e.x===c&&c===r.x||e.y===f&&f===r.y)return`L${c} ${f}`;if(e.y===f){const p=e.x<r.x?-1:1,y=e.y<r.y?1:-1;return`L ${c+l*p},${f}Q ${c},${f} ${c},${f+l*y}`}const m=e.x<r.x?1:-1,h=e.y<r.y?-1:1;return`L ${c},${f+l*h}Q ${c},${f} ${c+l*m},${f}`}function uy({sourceX:e,sourceY:t,sourcePosition:r=Ut.Bottom,targetX:i,targetY:l,targetPosition:c=Ut.Top,borderRadius:f=5,centerX:m,centerY:h,offset:p=20}){const[y,g,v,S,w]=Q7({source:{x:e,y:t},sourcePosition:r,target:{x:i,y:l},targetPosition:c,center:{x:m,y:h},offset:p});return[y.reduce((j,_,C)=>{let O="";return C>0&&C<y.length-1?O=J7(y[C-1],_,y[C+1],f):O=`${C===0?"M":"L"}${_.x} ${_.y}`,j+=O,j},""),g,v,S,w]}const wf=u.memo(({sourceX:e,sourceY:t,targetX:r,targetY:i,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,sourcePosition:g=Ut.Bottom,targetPosition:v=Ut.Top,markerEnd:S,markerStart:w,pathOptions:N,interactionWidth:j})=>{const[_,C,O]=uy({sourceX:e,sourceY:t,sourcePosition:g,targetX:r,targetY:i,targetPosition:v,borderRadius:N?.borderRadius,offset:N?.offset});return De.createElement(Tc,{path:_,labelX:C,labelY:O,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:S,markerStart:w,interactionWidth:j})});wf.displayName="SmoothStepEdge";const mg=u.memo(e=>De.createElement(wf,{...e,pathOptions:u.useMemo(()=>({borderRadius:0,offset:e.pathOptions?.offset}),[e.pathOptions?.offset])}));mg.displayName="StepEdge";function e6({sourceX:e,sourceY:t,targetX:r,targetY:i}){const[l,c,f,m]=bE({sourceX:e,sourceY:t,targetX:r,targetY:i});return[`M ${e},${t}L ${r},${i}`,l,c,f,m]}const hg=u.memo(({sourceX:e,sourceY:t,targetX:r,targetY:i,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:g,markerStart:v,interactionWidth:S})=>{const[w,N,j]=e6({sourceX:e,sourceY:t,targetX:r,targetY:i});return De.createElement(Tc,{path:w,labelX:N,labelY:j,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:g,markerStart:v,interactionWidth:S})});hg.displayName="StraightEdge";function ad(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function lw({pos:e,x1:t,y1:r,x2:i,y2:l,c}){switch(e){case Ut.Left:return[t-ad(t-i,c),r];case Ut.Right:return[t+ad(i-t,c),r];case Ut.Top:return[t,r-ad(r-l,c)];case Ut.Bottom:return[t,r+ad(l-r,c)]}}function SE({sourceX:e,sourceY:t,sourcePosition:r=Ut.Bottom,targetX:i,targetY:l,targetPosition:c=Ut.Top,curvature:f=.25}){const[m,h]=lw({pos:r,x1:e,y1:t,x2:i,y2:l,c:f}),[p,y]=lw({pos:c,x1:i,y1:l,x2:e,y2:t,c:f}),[g,v,S,w]=vE({sourceX:e,sourceY:t,targetX:i,targetY:l,sourceControlX:m,sourceControlY:h,targetControlX:p,targetControlY:y});return[`M${e},${t} C${m},${h} ${p},${y} ${i},${l}`,g,v,S,w]}const Pd=u.memo(({sourceX:e,sourceY:t,targetX:r,targetY:i,sourcePosition:l=Ut.Bottom,targetPosition:c=Ut.Top,label:f,labelStyle:m,labelShowBg:h,labelBgStyle:p,labelBgPadding:y,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:w,pathOptions:N,interactionWidth:j})=>{const[_,C,O]=SE({sourceX:e,sourceY:t,sourcePosition:l,targetX:r,targetY:i,targetPosition:c,curvature:N?.curvature});return De.createElement(Tc,{path:_,labelX:C,labelY:O,label:f,labelStyle:m,labelShowBg:h,labelBgStyle:p,labelBgPadding:y,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:w,interactionWidth:j})});Pd.displayName="BezierEdge";const pg=u.createContext(null),t6=pg.Provider;pg.Consumer;const n6=()=>u.useContext(pg),a6=e=>"id"in e&&"source"in e&&"target"in e,s6=({source:e,sourceHandle:t,target:r,targetHandle:i})=>`reactflow__edge-${e}${t||""}-${r}${i||""}`,dy=(e,t)=>typeof e>"u"?"":typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(i=>`${i}=${e[i]}`).join("&")}`,r6=(e,t)=>t.some(r=>r.source===e.source&&r.target===e.target&&(r.sourceHandle===e.sourceHandle||!r.sourceHandle&&!e.sourceHandle)&&(r.targetHandle===e.targetHandle||!r.targetHandle&&!e.targetHandle)),i6=(e,t)=>{if(!e.source||!e.target)return t;let r;return a6(e)?r={...e}:r={...e,id:s6(e)},r6(r,t)?t:t.concat(r)},fy=({x:e,y:t},[r,i,l],c,[f,m])=>{const h={x:(e-r)/l,y:(t-i)/l};return c?{x:f*Math.round(h.x/f),y:m*Math.round(h.y/m)}:h},wE=({x:e,y:t},[r,i,l])=>({x:e*l+r,y:t*l+i}),Ti=(e,t=[0,0])=>{if(!e)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const r=(e.width??0)*t[0],i=(e.height??0)*t[1],l={x:e.position.x-r,y:e.position.y-i};return{...l,positionAbsolute:e.positionAbsolute?{x:e.positionAbsolute.x-r,y:e.positionAbsolute.y-i}:l}},Nf=(e,t=[0,0])=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const r=e.reduce((i,l)=>{const{x:c,y:f}=Ti(l,t).positionAbsolute;return hE(i,bc({x:c,y:f,width:l.width||0,height:l.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return pE(r)},NE=(e,t,[r,i,l]=[0,0,1],c=!1,f=!1,m=[0,0])=>{const h={x:(t.x-r)/l,y:(t.y-i)/l,width:t.width/l,height:t.height/l},p=[];return e.forEach(y=>{const{width:g,height:v,selectable:S=!0,hidden:w=!1}=y;if(f&&!S||w)return!1;const{positionAbsolute:N}=Ti(y,m),j={x:N.x,y:N.y,width:g||0,height:v||0},_=oy(h,j),C=typeof g>"u"||typeof v>"u"||g===null||v===null,O=c&&_>0,E=(g||0)*(v||0);(C||O||_>=E||y.dragging)&&p.push(y)}),p},EE=(e,t)=>{const r=e.map(i=>i.id);return t.filter(i=>r.includes(i.source)||r.includes(i.target))},jE=(e,t,r,i,l,c=.1)=>{const f=t/(e.width*(1+c)),m=r/(e.height*(1+c)),h=Math.min(f,m),p=Ll(h,i,l),y=e.x+e.width/2,g=e.y+e.height/2,v=t/2-y*p,S=r/2-g*p;return{x:v,y:S,zoom:p}},xi=(e,t=0)=>e.transition().duration(t);function ow(e,t,r,i){return(t[r]||[]).reduce((l,c)=>(`${e.id}-${c.id}-${r}`!==i&&l.push({id:c.id||null,type:r,nodeId:e.id,x:(e.positionAbsolute?.x??0)+c.x+c.width/2,y:(e.positionAbsolute?.y??0)+c.y+c.height/2}),l),[])}function l6(e,t,r,i,l,c){const{x:f,y:m}=Pr(e),p=t.elementsFromPoint(f,m).find(w=>w.classList.contains("react-flow__handle"));if(p){const w=p.getAttribute("data-nodeid");if(w){const N=yg(void 0,p),j=p.getAttribute("data-handleid"),_=c({nodeId:w,id:j,type:N});if(_){const C=l.find(O=>O.nodeId===w&&O.type===N&&O.id===j);return{handle:{id:j,type:N,nodeId:w,x:C?.x||r.x,y:C?.y||r.y},validHandleResult:_}}}}let y=[],g=1/0;if(l.forEach(w=>{const N=Math.sqrt((w.x-r.x)**2+(w.y-r.y)**2);if(N<=i){const j=c(w);N<=g&&(N<g?y=[{handle:w,validHandleResult:j}]:N===g&&y.push({handle:w,validHandleResult:j}),g=N)}}),!y.length)return{handle:null,validHandleResult:_E()};if(y.length===1)return y[0];const v=y.some(({validHandleResult:w})=>w.isValid),S=y.some(({handle:w})=>w.type==="target");return y.find(({handle:w,validHandleResult:N})=>S?w.type==="target":v?N.isValid:!0)||y[0]}const o6={source:null,target:null,sourceHandle:null,targetHandle:null},_E=()=>({handleDomNode:null,isValid:!1,connection:o6,endHandle:null});function CE(e,t,r,i,l,c,f){const m=l==="target",h=f.querySelector(`.react-flow__handle[data-id="${e?.nodeId}-${e?.id}-${e?.type}"]`),p={..._E(),handleDomNode:h};if(h){const y=yg(void 0,h),g=h.getAttribute("data-nodeid"),v=h.getAttribute("data-handleid"),S=h.classList.contains("connectable"),w=h.classList.contains("connectableend"),N={source:m?g:r,sourceHandle:m?v:i,target:m?r:g,targetHandle:m?i:v};p.connection=N,S&&w&&(t===Ri.Strict?m&&y==="source"||!m&&y==="target":g!==r||v!==i)&&(p.endHandle={nodeId:g,handleId:v,type:y},p.isValid=c(N))}return p}function c6({nodes:e,nodeId:t,handleId:r,handleType:i}){return e.reduce((l,c)=>{if(c[Yn]){const{handleBounds:f}=c[Yn];let m=[],h=[];f&&(m=ow(c,f,"source",`${t}-${r}-${i}`),h=ow(c,f,"target",`${t}-${r}-${i}`)),l.push(...m,...h)}return l},[])}function yg(e,t){return e||(t?.classList.contains("target")?"target":t?.classList.contains("source")?"source":null)}function xp(e){e?.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function u6(e,t){let r=null;return t?r="valid":e&&!t&&(r="invalid"),r}function AE({event:e,handleId:t,nodeId:r,onConnect:i,isTarget:l,getState:c,setState:f,isValidConnection:m,edgeUpdaterType:h,onReconnectEnd:p}){const y=mE(e.target),{connectionMode:g,domNode:v,autoPanOnConnect:S,connectionRadius:w,onConnectStart:N,panBy:j,getNodes:_,cancelConnection:C}=c();let O=0,E;const{x:T,y:M}=Pr(e),A=y?.elementFromPoint(T,M),z=yg(h,A),P=v?.getBoundingClientRect();if(!P||!z)return;let X,H=Pr(e,P),Y=!1,V=null,I=!1,F=null;const D=c6({nodes:_(),nodeId:r,handleId:t,handleType:z}),L=()=>{if(!S)return;const[B,R]=fE(H,P);j({x:B,y:R}),O=requestAnimationFrame(L)};f({connectionPosition:H,connectionStatus:null,connectionNodeId:r,connectionHandleId:t,connectionHandleType:z,connectionStartHandle:{nodeId:r,handleId:t,type:z},connectionEndHandle:null}),N?.(e,{nodeId:r,handleId:t,handleType:z});function U(B){const{transform:R}=c();H=Pr(B,P);const{handle:q,validHandleResult:G}=l6(B,y,fy(H,R,!1,[1,1]),w,D,J=>CE(J,g,r,t,l?"target":"source",m,y));if(E=q,Y||(L(),Y=!0),F=G.handleDomNode,V=G.connection,I=G.isValid,f({connectionPosition:E&&I?wE({x:E.x,y:E.y},R):H,connectionStatus:u6(!!E,I),connectionEndHandle:G.endHandle}),!E&&!I&&!F)return xp(X);V.source!==V.target&&F&&(xp(X),X=F,F.classList.add("connecting","react-flow__handle-connecting"),F.classList.toggle("valid",I),F.classList.toggle("react-flow__handle-valid",I))}function k(B){(E||F)&&V&&I&&i?.(V),c().onConnectEnd?.(B),h&&p?.(B),xp(X),C(),cancelAnimationFrame(O),Y=!1,I=!1,V=null,F=null,y.removeEventListener("mousemove",U),y.removeEventListener("mouseup",k),y.removeEventListener("touchmove",U),y.removeEventListener("touchend",k)}y.addEventListener("mousemove",U),y.addEventListener("mouseup",k),y.addEventListener("touchmove",U),y.addEventListener("touchend",k)}const cw=()=>!0,d6=e=>({connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName}),f6=(e,t,r)=>i=>{const{connectionStartHandle:l,connectionEndHandle:c,connectionClickStartHandle:f}=i;return{connecting:l?.nodeId===e&&l?.handleId===t&&l?.type===r||c?.nodeId===e&&c?.handleId===t&&c?.type===r,clickConnecting:f?.nodeId===e&&f?.handleId===t&&f?.type===r}},TE=u.forwardRef(({type:e="source",position:t=Ut.Top,isValidConnection:r,isConnectable:i=!0,isConnectableStart:l=!0,isConnectableEnd:c=!0,id:f,onConnect:m,children:h,className:p,onMouseDown:y,onTouchStart:g,...v},S)=>{const w=f||null,N=e==="target",j=aa(),_=n6(),{connectOnClick:C,noPanClassName:O}=Ln(d6,ra),{connecting:E,clickConnecting:T}=Ln(f6(_,w,e),ra);_||j.getState().onError?.("010",lr.error010());const M=P=>{const{defaultEdgeOptions:X,onConnect:H,hasDefaultEdges:Y}=j.getState(),V={...X,...P};if(Y){const{edges:I,setEdges:F}=j.getState();F(i6(V,I))}H?.(V),m?.(V)},A=P=>{if(!_)return;const X=gE(P);l&&(X&&P.button===0||!X)&&AE({event:P,handleId:w,nodeId:_,onConnect:M,isTarget:N,getState:j.getState,setState:j.setState,isValidConnection:r||j.getState().isValidConnection||cw}),X?y?.(P):g?.(P)},z=P=>{const{onClickConnectStart:X,onClickConnectEnd:H,connectionClickStartHandle:Y,connectionMode:V,isValidConnection:I}=j.getState();if(!_||!Y&&!l)return;if(!Y){X?.(P,{nodeId:_,handleId:w,handleType:e}),j.setState({connectionClickStartHandle:{nodeId:_,type:e,handleId:w}});return}const F=mE(P.target),D=r||I||cw,{connection:L,isValid:U}=CE({nodeId:_,id:w,type:e},V,Y.nodeId,Y.handleId||null,Y.type,D,F);U&&M(L),H?.(P),j.setState({connectionClickStartHandle:null})};return De.createElement("div",{"data-handleid":w,"data-nodeid":_,"data-handlepos":t,"data-id":`${_}-${w}-${e}`,className:ha(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",O,p,{source:!N,target:N,connectable:i,connectablestart:l,connectableend:c,connecting:T,connectionindicator:i&&(l&&!E||c&&E)}]),onMouseDown:A,onTouchStart:A,onClick:C?z:void 0,ref:S,...v},h)});TE.displayName="Handle";var Xr=u.memo(TE);const ME=({data:e,isConnectable:t,targetPosition:r=Ut.Top,sourcePosition:i=Ut.Bottom})=>De.createElement(De.Fragment,null,De.createElement(Xr,{type:"target",position:r,isConnectable:t}),e?.label,De.createElement(Xr,{type:"source",position:i,isConnectable:t}));ME.displayName="DefaultNode";var my=u.memo(ME);const RE=({data:e,isConnectable:t,sourcePosition:r=Ut.Bottom})=>De.createElement(De.Fragment,null,e?.label,De.createElement(Xr,{type:"source",position:r,isConnectable:t}));RE.displayName="InputNode";var kE=u.memo(RE);const DE=({data:e,isConnectable:t,targetPosition:r=Ut.Top})=>De.createElement(De.Fragment,null,De.createElement(Xr,{type:"target",position:r,isConnectable:t}),e?.label);DE.displayName="OutputNode";var IE=u.memo(DE);const gg=()=>null;gg.displayName="GroupNode";const m6=e=>({selectedNodes:e.getNodes().filter(t=>t.selected),selectedEdges:e.edges.filter(t=>t.selected).map(t=>({...t}))}),sd=e=>e.id;function h6(e,t){return ra(e.selectedNodes.map(sd),t.selectedNodes.map(sd))&&ra(e.selectedEdges.map(sd),t.selectedEdges.map(sd))}const LE=u.memo(({onSelectionChange:e})=>{const t=aa(),{selectedNodes:r,selectedEdges:i}=Ln(m6,h6);return u.useEffect(()=>{const l={nodes:r,edges:i};e?.(l),t.getState().onSelectionChange.forEach(c=>c(l))},[r,i,e]),null});LE.displayName="SelectionListener";const p6=e=>!!e.onSelectionChange;function y6({onSelectionChange:e}){const t=Ln(p6);return e||t?De.createElement(LE,{onSelectionChange:e}):null}const g6=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset});function bl(e,t){u.useEffect(()=>{typeof e<"u"&&t(e)},[e])}function cn(e,t,r){u.useEffect(()=>{typeof t<"u"&&r({[e]:t})},[t])}const b6=({nodes:e,edges:t,defaultNodes:r,defaultEdges:i,onConnect:l,onConnectStart:c,onConnectEnd:f,onClickConnectStart:m,onClickConnectEnd:h,nodesDraggable:p,nodesConnectable:y,nodesFocusable:g,edgesFocusable:v,edgesUpdatable:S,elevateNodesOnSelect:w,minZoom:N,maxZoom:j,nodeExtent:_,onNodesChange:C,onEdgesChange:O,elementsSelectable:E,connectionMode:T,snapGrid:M,snapToGrid:A,translateExtent:z,connectOnClick:P,defaultEdgeOptions:X,fitView:H,fitViewOptions:Y,onNodesDelete:V,onEdgesDelete:I,onNodeDrag:F,onNodeDragStart:D,onNodeDragStop:L,onSelectionDrag:U,onSelectionDragStart:k,onSelectionDragStop:B,noPanClassName:R,nodeOrigin:q,rfId:G,autoPanOnConnect:J,autoPanOnNodeDrag:ie,onError:Z,connectionRadius:me,isValidConnection:Q,nodeDragThreshold:oe})=>{const{setNodes:ne,setEdges:we,setDefaultNodesAndEdges:ke,setMinZoom:Re,setMaxZoom:Te,setTranslateExtent:rt,setNodeExtent:He,reset:tt}=Ln(g6,ra),Ie=aa();return u.useEffect(()=>{const vt=i?.map(Ct=>({...Ct,...X}));return ke(r,vt),()=>{tt()}},[]),cn("defaultEdgeOptions",X,Ie.setState),cn("connectionMode",T,Ie.setState),cn("onConnect",l,Ie.setState),cn("onConnectStart",c,Ie.setState),cn("onConnectEnd",f,Ie.setState),cn("onClickConnectStart",m,Ie.setState),cn("onClickConnectEnd",h,Ie.setState),cn("nodesDraggable",p,Ie.setState),cn("nodesConnectable",y,Ie.setState),cn("nodesFocusable",g,Ie.setState),cn("edgesFocusable",v,Ie.setState),cn("edgesUpdatable",S,Ie.setState),cn("elementsSelectable",E,Ie.setState),cn("elevateNodesOnSelect",w,Ie.setState),cn("snapToGrid",A,Ie.setState),cn("snapGrid",M,Ie.setState),cn("onNodesChange",C,Ie.setState),cn("onEdgesChange",O,Ie.setState),cn("connectOnClick",P,Ie.setState),cn("fitViewOnInit",H,Ie.setState),cn("fitViewOnInitOptions",Y,Ie.setState),cn("onNodesDelete",V,Ie.setState),cn("onEdgesDelete",I,Ie.setState),cn("onNodeDrag",F,Ie.setState),cn("onNodeDragStart",D,Ie.setState),cn("onNodeDragStop",L,Ie.setState),cn("onSelectionDrag",U,Ie.setState),cn("onSelectionDragStart",k,Ie.setState),cn("onSelectionDragStop",B,Ie.setState),cn("noPanClassName",R,Ie.setState),cn("nodeOrigin",q,Ie.setState),cn("rfId",G,Ie.setState),cn("autoPanOnConnect",J,Ie.setState),cn("autoPanOnNodeDrag",ie,Ie.setState),cn("onError",Z,Ie.setState),cn("connectionRadius",me,Ie.setState),cn("isValidConnection",Q,Ie.setState),cn("nodeDragThreshold",oe,Ie.setState),bl(e,ne),bl(t,we),bl(N,Re),bl(j,Te),bl(z,rt),bl(_,He),null},uw={display:"none"},v6={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},OE="react-flow__node-desc",zE="react-flow__edge-desc",x6="react-flow__aria-live",S6=e=>e.ariaLiveMessage;function w6({rfId:e}){const t=Ln(S6);return De.createElement("div",{id:`${x6}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:v6},t)}function N6({rfId:e,disableKeyboardA11y:t}){return De.createElement(De.Fragment,null,De.createElement("div",{id:`${OE}-${e}`,style:uw},"Press enter or space to select a node.",!t&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),De.createElement("div",{id:`${zE}-${e}`,style:uw},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!t&&De.createElement(w6,{rfId:e}))}var xc=(e=null,t={actInsideInputWithModifier:!0})=>{const[r,i]=u.useState(!1),l=u.useRef(!1),c=u.useRef(new Set([])),[f,m]=u.useMemo(()=>{if(e!==null){const p=(Array.isArray(e)?e:[e]).filter(g=>typeof g=="string").map(g=>g.split("+")),y=p.reduce((g,v)=>g.concat(...v),[]);return[p,y]}return[[],[]]},[e]);return u.useEffect(()=>{const h=typeof document<"u"?document:null,p=t?.target||h;if(e!==null){const y=S=>{if(l.current=S.ctrlKey||S.metaKey||S.shiftKey,(!l.current||l.current&&!t.actInsideInputWithModifier)&&cy(S))return!1;const N=fw(S.code,m);c.current.add(S[N]),dw(f,c.current,!1)&&(S.preventDefault(),i(!0))},g=S=>{if((!l.current||l.current&&!t.actInsideInputWithModifier)&&cy(S))return!1;const N=fw(S.code,m);dw(f,c.current,!0)?(i(!1),c.current.clear()):c.current.delete(S[N]),S.key==="Meta"&&c.current.clear(),l.current=!1},v=()=>{c.current.clear(),i(!1)};return p?.addEventListener("keydown",y),p?.addEventListener("keyup",g),window.addEventListener("blur",v),()=>{p?.removeEventListener("keydown",y),p?.removeEventListener("keyup",g),window.removeEventListener("blur",v)}}},[e,i]),r};function dw(e,t,r){return e.filter(i=>r||i.length===t.size).some(i=>i.every(l=>t.has(l)))}function fw(e,t){return t.includes(e)?"code":"key"}function $E(e,t,r,i){const l=e.parentNode||e.parentId;if(!l)return r;const c=t.get(l),f=Ti(c,i);return $E(c,t,{x:(r.x??0)+f.x,y:(r.y??0)+f.y,z:(c[Yn]?.z??0)>(r.z??0)?c[Yn]?.z??0:r.z??0},i)}function FE(e,t,r){e.forEach(i=>{const l=i.parentNode||i.parentId;if(l&&!e.has(l))throw new Error(`Parent node ${l} not found`);if(l||r?.[i.id]){const{x:c,y:f,z:m}=$E(i,e,{...i.position,z:i[Yn]?.z??0},t);i.positionAbsolute={x:c,y:f},i[Yn].z=m,r?.[i.id]&&(i[Yn].isParent=!0)}})}function Sp(e,t,r,i){const l=new Map,c={},f=i?1e3:0;return e.forEach(m=>{const h=(is(m.zIndex)?m.zIndex:0)+(m.selected?f:0),p=t.get(m.id),y={...m,positionAbsolute:{x:m.position.x,y:m.position.y}},g=m.parentNode||m.parentId;g&&(c[g]=!0);const v=p?.type&&p?.type!==m.type;Object.defineProperty(y,Yn,{enumerable:!1,value:{handleBounds:v?void 0:p?.[Yn]?.handleBounds,z:h}}),l.set(m.id,y)}),FE(l,r,c),l}function UE(e,t={}){const{getNodes:r,width:i,height:l,minZoom:c,maxZoom:f,d3Zoom:m,d3Selection:h,fitViewOnInitDone:p,fitViewOnInit:y,nodeOrigin:g}=e(),v=t.initial&&!p&&y;if(m&&h&&(v||!t.initial)){const w=r().filter(j=>{const _=t.includeHiddenNodes?j.width&&j.height:!j.hidden;return t.nodes?.length?_&&t.nodes.some(C=>C.id===j.id):_}),N=w.every(j=>j.width&&j.height);if(w.length>0&&N){const j=Nf(w,g),{x:_,y:C,zoom:O}=jE(j,i,l,t.minZoom??c,t.maxZoom??f,t.padding??.1),E=sr.translate(_,C).scale(O);return typeof t.duration=="number"&&t.duration>0?m.transform(xi(h,t.duration),E):m.transform(h,E),!0}}return!1}function E6(e,t){return e.forEach(r=>{const i=t.get(r.id);i&&t.set(i.id,{...i,[Yn]:i[Yn],selected:r.selected})}),new Map(t)}function j6(e,t){return t.map(r=>{const i=e.find(l=>l.id===r.id);return i&&(r.selected=i.selected),r})}function rd({changedNodes:e,changedEdges:t,get:r,set:i}){const{nodeInternals:l,edges:c,onNodesChange:f,onEdgesChange:m,hasDefaultNodes:h,hasDefaultEdges:p}=r();e?.length&&(h&&i({nodeInternals:E6(e,l)}),f?.(e)),t?.length&&(p&&i({edges:j6(t,c)}),m?.(t))}const vl=()=>{},_6={zoomIn:vl,zoomOut:vl,zoomTo:vl,getZoom:()=>1,setViewport:vl,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:vl,fitBounds:vl,project:e=>e,screenToFlowPosition:e=>e,flowToScreenPosition:e=>e,viewportInitialized:!1},C6=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection}),A6=()=>{const e=aa(),{d3Zoom:t,d3Selection:r}=Ln(C6,ra);return u.useMemo(()=>r&&t?{zoomIn:l=>t.scaleBy(xi(r,l?.duration),1.2),zoomOut:l=>t.scaleBy(xi(r,l?.duration),1/1.2),zoomTo:(l,c)=>t.scaleTo(xi(r,c?.duration),l),getZoom:()=>e.getState().transform[2],setViewport:(l,c)=>{const[f,m,h]=e.getState().transform,p=sr.translate(l.x??f,l.y??m).scale(l.zoom??h);t.transform(xi(r,c?.duration),p)},getViewport:()=>{const[l,c,f]=e.getState().transform;return{x:l,y:c,zoom:f}},fitView:l=>UE(e.getState,l),setCenter:(l,c,f)=>{const{width:m,height:h,maxZoom:p}=e.getState(),y=typeof f?.zoom<"u"?f.zoom:p,g=m/2-l*y,v=h/2-c*y,S=sr.translate(g,v).scale(y);t.transform(xi(r,f?.duration),S)},fitBounds:(l,c)=>{const{width:f,height:m,minZoom:h,maxZoom:p}=e.getState(),{x:y,y:g,zoom:v}=jE(l,f,m,h,p,c?.padding??.1),S=sr.translate(y,g).scale(v);t.transform(xi(r,c?.duration),S)},project:l=>{const{transform:c,snapToGrid:f,snapGrid:m}=e.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),fy(l,c,f,m)},screenToFlowPosition:l=>{const{transform:c,snapToGrid:f,snapGrid:m,domNode:h}=e.getState();if(!h)return l;const{x:p,y}=h.getBoundingClientRect(),g={x:l.x-p,y:l.y-y};return fy(g,c,f,m)},flowToScreenPosition:l=>{const{transform:c,domNode:f}=e.getState();if(!f)return l;const{x:m,y:h}=f.getBoundingClientRect(),p=wE(l,c);return{x:p.x+m,y:p.y+h}},viewportInitialized:!0}:_6,[t,r])};function bg(){const e=A6(),t=aa(),r=u.useCallback(()=>t.getState().getNodes().map(N=>({...N})),[]),i=u.useCallback(N=>t.getState().nodeInternals.get(N),[]),l=u.useCallback(()=>{const{edges:N=[]}=t.getState();return N.map(j=>({...j}))},[]),c=u.useCallback(N=>{const{edges:j=[]}=t.getState();return j.find(_=>_.id===N)},[]),f=u.useCallback(N=>{const{getNodes:j,setNodes:_,hasDefaultNodes:C,onNodesChange:O}=t.getState(),E=j(),T=typeof N=="function"?N(E):N;if(C)_(T);else if(O){const M=T.length===0?E.map(A=>({type:"remove",id:A.id})):T.map(A=>({item:A,type:"reset"}));O(M)}},[]),m=u.useCallback(N=>{const{edges:j=[],setEdges:_,hasDefaultEdges:C,onEdgesChange:O}=t.getState(),E=typeof N=="function"?N(j):N;if(C)_(E);else if(O){const T=E.length===0?j.map(M=>({type:"remove",id:M.id})):E.map(M=>({item:M,type:"reset"}));O(T)}},[]),h=u.useCallback(N=>{const j=Array.isArray(N)?N:[N],{getNodes:_,setNodes:C,hasDefaultNodes:O,onNodesChange:E}=t.getState();if(O){const M=[..._(),...j];C(M)}else if(E){const T=j.map(M=>({item:M,type:"add"}));E(T)}},[]),p=u.useCallback(N=>{const j=Array.isArray(N)?N:[N],{edges:_=[],setEdges:C,hasDefaultEdges:O,onEdgesChange:E}=t.getState();if(O)C([..._,...j]);else if(E){const T=j.map(M=>({item:M,type:"add"}));E(T)}},[]),y=u.useCallback(()=>{const{getNodes:N,edges:j=[],transform:_}=t.getState(),[C,O,E]=_;return{nodes:N().map(T=>({...T})),edges:j.map(T=>({...T})),viewport:{x:C,y:O,zoom:E}}},[]),g=u.useCallback(({nodes:N,edges:j})=>{const{nodeInternals:_,getNodes:C,edges:O,hasDefaultNodes:E,hasDefaultEdges:T,onNodesDelete:M,onEdgesDelete:A,onNodesChange:z,onEdgesChange:P}=t.getState(),X=(N||[]).map(F=>F.id),H=(j||[]).map(F=>F.id),Y=C().reduce((F,D)=>{const L=D.parentNode||D.parentId,U=!X.includes(D.id)&&L&&F.find(B=>B.id===L);return(typeof D.deletable=="boolean"?D.deletable:!0)&&(X.includes(D.id)||U)&&F.push(D),F},[]),V=O.filter(F=>typeof F.deletable=="boolean"?F.deletable:!0),I=V.filter(F=>H.includes(F.id));if(Y||I){const F=EE(Y,V),D=[...I,...F],L=D.reduce((U,k)=>(U.includes(k.id)||U.push(k.id),U),[]);if((T||E)&&(T&&t.setState({edges:O.filter(U=>!L.includes(U.id))}),E&&(Y.forEach(U=>{_.delete(U.id)}),t.setState({nodeInternals:new Map(_)}))),L.length>0&&(A?.(D),P&&P(L.map(U=>({id:U,type:"remove"})))),Y.length>0&&(M?.(Y),z)){const U=Y.map(k=>({id:k.id,type:"remove"}));z(U)}}},[]),v=u.useCallback(N=>{const j=X7(N),_=j?null:t.getState().nodeInternals.get(N.id);return!j&&!_?[null,null,j]:[j?N:aw(_),_,j]},[]),S=u.useCallback((N,j=!0,_)=>{const[C,O,E]=v(N);return C?(_||t.getState().getNodes()).filter(T=>{if(!E&&(T.id===O.id||!T.positionAbsolute))return!1;const M=aw(T),A=oy(M,C);return j&&A>0||A>=C.width*C.height}):[]},[]),w=u.useCallback((N,j,_=!0)=>{const[C]=v(N);if(!C)return!1;const O=oy(C,j);return _&&O>0||O>=C.width*C.height},[]);return u.useMemo(()=>({...e,getNodes:r,getNode:i,getEdges:l,getEdge:c,setNodes:f,setEdges:m,addNodes:h,addEdges:p,toObject:y,deleteElements:g,getIntersectingNodes:S,isNodeIntersecting:w}),[e,r,i,l,c,f,m,h,p,y,g,S,w])}const T6={actInsideInputWithModifier:!1};var M6=({deleteKeyCode:e,multiSelectionKeyCode:t})=>{const r=aa(),{deleteElements:i}=bg(),l=xc(e,T6),c=xc(t);u.useEffect(()=>{if(l){const{edges:f,getNodes:m}=r.getState(),h=m().filter(y=>y.selected),p=f.filter(y=>y.selected);i({nodes:h,edges:p}),r.setState({nodesSelectionActive:!1})}},[l]),u.useEffect(()=>{r.setState({multiSelectionActive:c})},[c])};function R6(e){const t=aa();u.useEffect(()=>{let r;const i=()=>{if(!e.current)return;const l=ug(e.current);(l.height===0||l.width===0)&&t.getState().onError?.("004",lr.error004()),t.setState({width:l.width||500,height:l.height||500})};return i(),window.addEventListener("resize",i),e.current&&(r=new ResizeObserver(()=>i()),r.observe(e.current)),()=>{window.removeEventListener("resize",i),r&&e.current&&r.unobserve(e.current)}},[])}const vg={position:"absolute",width:"100%",height:"100%",top:0,left:0},k6=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,id=e=>({x:e.x,y:e.y,zoom:e.k}),xl=(e,t)=>e.target.closest(`.${t}`),mw=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),hw=e=>{const t=e.ctrlKey&&qd()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t},D6=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler,userSelectionActive:e.userSelectionActive}),I6=({onMove:e,onMoveStart:t,onMoveEnd:r,onPaneContextMenu:i,zoomOnScroll:l=!0,zoomOnPinch:c=!0,panOnScroll:f=!1,panOnScrollSpeed:m=.5,panOnScrollMode:h=Ci.Free,zoomOnDoubleClick:p=!0,elementsSelectable:y,panOnDrag:g=!0,defaultViewport:v,translateExtent:S,minZoom:w,maxZoom:N,zoomActivationKeyCode:j,preventScrolling:_=!0,children:C,noWheelClassName:O,noPanClassName:E})=>{const T=u.useRef(),M=aa(),A=u.useRef(!1),z=u.useRef(!1),P=u.useRef(null),X=u.useRef({x:0,y:0,zoom:0}),{d3Zoom:H,d3Selection:Y,d3ZoomHandler:V,userSelectionActive:I}=Ln(D6,ra),F=xc(j),D=u.useRef(0),L=u.useRef(!1),U=u.useRef();return R6(P),u.useEffect(()=>{if(P.current){const k=P.current.getBoundingClientRect(),B=uE().scaleExtent([w,N]).translateExtent(S),R=rs(P.current).call(B),q=sr.translate(v.x,v.y).scale(Ll(v.zoom,w,N)),G=[[0,0],[k.width,k.height]],J=B.constrain()(q,G,S);B.transform(R,J),B.wheelDelta(hw),M.setState({d3Zoom:B,d3Selection:R,d3ZoomHandler:R.on("wheel.zoom"),transform:[J.x,J.y,J.k],domNode:P.current.closest(".react-flow")})}},[]),u.useEffect(()=>{Y&&H&&(f&&!F&&!I?Y.on("wheel.zoom",k=>{if(xl(k,O))return!1;k.preventDefault(),k.stopImmediatePropagation();const B=Y.property("__zoom").k||1;if(k.ctrlKey&&c){const Q=hs(k),oe=hw(k),ne=B*Math.pow(2,oe);H.scaleTo(Y,ne,Q,k);return}const R=k.deltaMode===1?20:1;let q=h===Ci.Vertical?0:k.deltaX*R,G=h===Ci.Horizontal?0:k.deltaY*R;!qd()&&k.shiftKey&&h!==Ci.Vertical&&(q=k.deltaY*R,G=0),H.translateBy(Y,-(q/B)*m,-(G/B)*m,{internal:!0});const J=id(Y.property("__zoom")),{onViewportChangeStart:ie,onViewportChange:Z,onViewportChangeEnd:me}=M.getState();clearTimeout(U.current),L.current||(L.current=!0,t?.(k,J),ie?.(J)),L.current&&(e?.(k,J),Z?.(J),U.current=setTimeout(()=>{r?.(k,J),me?.(J),L.current=!1},150))},{passive:!1}):typeof V<"u"&&Y.on("wheel.zoom",function(k,B){if(!_&&k.type==="wheel"&&!k.ctrlKey||xl(k,O))return null;k.preventDefault(),V.call(this,k,B)},{passive:!1}))},[I,f,h,Y,H,V,F,c,_,O,t,e,r]),u.useEffect(()=>{H&&H.on("start",k=>{if(!k.sourceEvent||k.sourceEvent.internal)return null;D.current=k.sourceEvent?.button;const{onViewportChangeStart:B}=M.getState(),R=id(k.transform);A.current=!0,X.current=R,k.sourceEvent?.type==="mousedown"&&M.setState({paneDragging:!0}),B?.(R),t?.(k.sourceEvent,R)})},[H,t]),u.useEffect(()=>{H&&(I&&!A.current?H.on("zoom",null):I||H.on("zoom",k=>{const{onViewportChange:B}=M.getState();if(M.setState({transform:[k.transform.x,k.transform.y,k.transform.k]}),z.current=!!(i&&mw(g,D.current??0)),(e||B)&&!k.sourceEvent?.internal){const R=id(k.transform);B?.(R),e?.(k.sourceEvent,R)}}))},[I,H,e,g,i]),u.useEffect(()=>{H&&H.on("end",k=>{if(!k.sourceEvent||k.sourceEvent.internal)return null;const{onViewportChangeEnd:B}=M.getState();if(A.current=!1,M.setState({paneDragging:!1}),i&&mw(g,D.current??0)&&!z.current&&i(k.sourceEvent),z.current=!1,(r||B)&&k6(X.current,k.transform)){const R=id(k.transform);X.current=R,clearTimeout(T.current),T.current=setTimeout(()=>{B?.(R),r?.(k.sourceEvent,R)},f?150:0)}})},[H,f,g,r,i]),u.useEffect(()=>{H&&H.filter(k=>{const B=F||l,R=c&&k.ctrlKey;if((g===!0||Array.isArray(g)&&g.includes(1))&&k.button===1&&k.type==="mousedown"&&(xl(k,"react-flow__node")||xl(k,"react-flow__edge")))return!0;if(!g&&!B&&!f&&!p&&!c||I||!p&&k.type==="dblclick"||xl(k,O)&&k.type==="wheel"||xl(k,E)&&(k.type!=="wheel"||f&&k.type==="wheel"&&!F)||!c&&k.ctrlKey&&k.type==="wheel"||!B&&!f&&!R&&k.type==="wheel"||!g&&(k.type==="mousedown"||k.type==="touchstart")||Array.isArray(g)&&!g.includes(k.button)&&k.type==="mousedown")return!1;const q=Array.isArray(g)&&g.includes(k.button)||!k.button||k.button<=1;return(!k.ctrlKey||k.type==="wheel")&&q})},[I,H,l,c,f,p,g,y,F]),De.createElement("div",{className:"react-flow__renderer",ref:P,style:vg},C)},L6=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function O6(){const{userSelectionActive:e,userSelectionRect:t}=Ln(L6,ra);return e&&t?De.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}function pw(e,t){const r=t.parentNode||t.parentId,i=e.find(l=>l.id===r);if(i){const l=t.position.x+t.width-i.width,c=t.position.y+t.height-i.height;if(l>0||c>0||t.position.x<0||t.position.y<0){if(i.style={...i.style},i.style.width=i.style.width??i.width,i.style.height=i.style.height??i.height,l>0&&(i.style.width+=l),c>0&&(i.style.height+=c),t.position.x<0){const f=Math.abs(t.position.x);i.position.x=i.position.x-f,i.style.width+=f,t.position.x=0}if(t.position.y<0){const f=Math.abs(t.position.y);i.position.y=i.position.y-f,i.style.height+=f,t.position.y=0}i.width=i.style.width,i.height=i.style.height}}}function BE(e,t){if(e.some(i=>i.type==="reset"))return e.filter(i=>i.type==="reset").map(i=>i.item);const r=e.filter(i=>i.type==="add").map(i=>i.item);return t.reduce((i,l)=>{const c=e.filter(m=>m.id===l.id);if(c.length===0)return i.push(l),i;const f={...l};for(const m of c)if(m)switch(m.type){case"select":{f.selected=m.selected;break}case"position":{typeof m.position<"u"&&(f.position=m.position),typeof m.positionAbsolute<"u"&&(f.positionAbsolute=m.positionAbsolute),typeof m.dragging<"u"&&(f.dragging=m.dragging),f.expandParent&&pw(i,f);break}case"dimensions":{typeof m.dimensions<"u"&&(f.width=m.dimensions.width,f.height=m.dimensions.height),typeof m.updateStyle<"u"&&(f.style={...f.style||{},...m.dimensions}),typeof m.resizing=="boolean"&&(f.resizing=m.resizing),f.expandParent&&pw(i,f);break}case"remove":return i}return i.push(f),i},r)}function qE(e,t){return BE(e,t)}function z6(e,t){return BE(e,t)}const $r=(e,t)=>({id:e,type:"select",selected:t});function Nl(e,t){return e.reduce((r,i)=>{const l=t.includes(i.id);return!i.selected&&l?(i.selected=!0,r.push($r(i.id,!0))):i.selected&&!l&&(i.selected=!1,r.push($r(i.id,!1))),r},[])}const wp=(e,t)=>r=>{r.target===t.current&&e?.(r)},$6=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging}),HE=u.memo(({isSelecting:e,selectionMode:t=vc.Full,panOnDrag:r,onSelectionStart:i,onSelectionEnd:l,onPaneClick:c,onPaneContextMenu:f,onPaneScroll:m,onPaneMouseEnter:h,onPaneMouseMove:p,onPaneMouseLeave:y,children:g})=>{const v=u.useRef(null),S=aa(),w=u.useRef(0),N=u.useRef(0),j=u.useRef(),{userSelectionActive:_,elementsSelectable:C,dragging:O}=Ln($6,ra),E=()=>{S.setState({userSelectionActive:!1,userSelectionRect:null}),w.current=0,N.current=0},T=V=>{c?.(V),S.getState().resetSelectedElements(),S.setState({nodesSelectionActive:!1})},M=V=>{if(Array.isArray(r)&&r?.includes(2)){V.preventDefault();return}f?.(V)},A=m?V=>m(V):void 0,z=V=>{const{resetSelectedElements:I,domNode:F}=S.getState();if(j.current=F?.getBoundingClientRect(),!C||!e||V.button!==0||V.target!==v.current||!j.current)return;const{x:D,y:L}=Pr(V,j.current);I(),S.setState({userSelectionRect:{width:0,height:0,startX:D,startY:L,x:D,y:L}}),i?.(V)},P=V=>{const{userSelectionRect:I,nodeInternals:F,edges:D,transform:L,onNodesChange:U,onEdgesChange:k,nodeOrigin:B,getNodes:R}=S.getState();if(!e||!j.current||!I)return;S.setState({userSelectionActive:!0,nodesSelectionActive:!1});const q=Pr(V,j.current),G=I.startX??0,J=I.startY??0,ie={...I,x:q.x<G?q.x:G,y:q.y<J?q.y:J,width:Math.abs(q.x-G),height:Math.abs(q.y-J)},Z=R(),me=NE(F,ie,L,t===vc.Partial,!0,B),Q=EE(me,D).map(ne=>ne.id),oe=me.map(ne=>ne.id);if(w.current!==oe.length){w.current=oe.length;const ne=Nl(Z,oe);ne.length&&U?.(ne)}if(N.current!==Q.length){N.current=Q.length;const ne=Nl(D,Q);ne.length&&k?.(ne)}S.setState({userSelectionRect:ie})},X=V=>{if(V.button!==0)return;const{userSelectionRect:I}=S.getState();!_&&I&&V.target===v.current&&T?.(V),S.setState({nodesSelectionActive:w.current>0}),E(),l?.(V)},H=V=>{_&&(S.setState({nodesSelectionActive:w.current>0}),l?.(V)),E()},Y=C&&(e||_);return De.createElement("div",{className:ha(["react-flow__pane",{dragging:O,selection:e}]),onClick:Y?void 0:wp(T,v),onContextMenu:wp(M,v),onWheel:wp(A,v),onMouseEnter:Y?void 0:h,onMouseDown:Y?z:void 0,onMouseMove:Y?P:p,onMouseUp:Y?X:void 0,onMouseLeave:Y?H:y,ref:v,style:vg},g,De.createElement(O6,null))});HE.displayName="Pane";function PE(e,t){const r=e.parentNode||e.parentId;if(!r)return!1;const i=t.get(r);return i?i.selected?!0:PE(i,t):!1}function yw(e,t,r){let i=e;do{if(i?.matches(t))return!0;if(i===r.current)return!1;i=i.parentElement}while(i);return!1}function F6(e,t,r,i){return Array.from(e.values()).filter(l=>(l.selected||l.id===i)&&(!l.parentNode||l.parentId||!PE(l,e))&&(l.draggable||t&&typeof l.draggable>"u")).map(l=>({id:l.id,position:l.position||{x:0,y:0},positionAbsolute:l.positionAbsolute||{x:0,y:0},distance:{x:r.x-(l.positionAbsolute?.x??0),y:r.y-(l.positionAbsolute?.y??0)},delta:{x:0,y:0},extent:l.extent,parentNode:l.parentNode||l.parentId,parentId:l.parentNode||l.parentId,width:l.width,height:l.height,expandParent:l.expandParent}))}function U6(e,t){return!t||t==="parent"?t:[t[0],[t[1][0]-(e.width||0),t[1][1]-(e.height||0)]]}function VE(e,t,r,i,l=[0,0],c){const f=U6(e,e.extent||i);let m=f;const h=e.parentNode||e.parentId;if(e.extent==="parent"&&!e.expandParent)if(h&&e.width&&e.height){const g=r.get(h),{x:v,y:S}=Ti(g,l).positionAbsolute;m=g&&is(v)&&is(S)&&is(g.width)&&is(g.height)?[[v+e.width*l[0],S+e.height*l[1]],[v+g.width-e.width+e.width*l[0],S+g.height-e.height+e.height*l[1]]]:m}else c?.("005",lr.error005()),m=f;else if(e.extent&&h&&e.extent!=="parent"){const g=r.get(h),{x:v,y:S}=Ti(g,l).positionAbsolute;m=[[e.extent[0][0]+v,e.extent[0][1]+S],[e.extent[1][0]+v,e.extent[1][1]+S]]}let p={x:0,y:0};if(h){const g=r.get(h);p=Ti(g,l).positionAbsolute}const y=m&&m!=="parent"?dg(t,m):t;return{position:{x:y.x-p.x,y:y.y-p.y},positionAbsolute:y}}function Np({nodeId:e,dragItems:t,nodeInternals:r}){const i=t.map(l=>({...r.get(l.id),position:l.position,positionAbsolute:l.positionAbsolute}));return[e?i.find(l=>l.id===e):i[0],i]}const gw=(e,t,r,i)=>{const l=t.querySelectorAll(e);if(!l||!l.length)return null;const c=Array.from(l),f=t.getBoundingClientRect(),m={x:f.width*i[0],y:f.height*i[1]};return c.map(h=>{const p=h.getBoundingClientRect();return{id:h.getAttribute("data-handleid"),position:h.getAttribute("data-handlepos"),x:(p.left-f.left-m.x)/r,y:(p.top-f.top-m.y)/r,...ug(h)}})};function qo(e,t,r){return r===void 0?r:i=>{const l=t().nodeInternals.get(e);l&&r(i,{...l})}}function hy({id:e,store:t,unselect:r=!1,nodeRef:i}){const{addSelectedNodes:l,unselectNodesAndEdges:c,multiSelectionActive:f,nodeInternals:m,onError:h}=t.getState(),p=m.get(e);if(!p){h?.("012",lr.error012(e));return}t.setState({nodesSelectionActive:!1}),p.selected?(r||p.selected&&f)&&(c({nodes:[p],edges:[]}),requestAnimationFrame(()=>i?.current?.blur())):l([e])}function B6(){const e=aa();return u.useCallback(({sourceEvent:r})=>{const{transform:i,snapGrid:l,snapToGrid:c}=e.getState(),f=r.touches?r.touches[0].clientX:r.clientX,m=r.touches?r.touches[0].clientY:r.clientY,h={x:(f-i[0])/i[2],y:(m-i[1])/i[2]};return{xSnapped:c?l[0]*Math.round(h.x/l[0]):h.x,ySnapped:c?l[1]*Math.round(h.y/l[1]):h.y,...h}},[])}function Ep(e){return(t,r,i)=>e?.(t,i)}function YE({nodeRef:e,disabled:t=!1,noDragClassName:r,handleSelector:i,nodeId:l,isSelectable:c,selectNodesOnDrag:f}){const m=aa(),[h,p]=u.useState(!1),y=u.useRef([]),g=u.useRef({x:null,y:null}),v=u.useRef(0),S=u.useRef(null),w=u.useRef({x:0,y:0}),N=u.useRef(null),j=u.useRef(!1),_=u.useRef(!1),C=u.useRef(!1),O=B6();return u.useEffect(()=>{if(e?.current){const E=rs(e.current),T=({x:z,y:P})=>{const{nodeInternals:X,onNodeDrag:H,onSelectionDrag:Y,updateNodePositions:V,nodeExtent:I,snapGrid:F,snapToGrid:D,nodeOrigin:L,onError:U}=m.getState();g.current={x:z,y:P};let k=!1,B={x:0,y:0,x2:0,y2:0};if(y.current.length>1&&I){const q=Nf(y.current,L);B=bc(q)}if(y.current=y.current.map(q=>{const G={x:z-q.distance.x,y:P-q.distance.y};D&&(G.x=F[0]*Math.round(G.x/F[0]),G.y=F[1]*Math.round(G.y/F[1]));const J=[[I[0][0],I[0][1]],[I[1][0],I[1][1]]];y.current.length>1&&I&&!q.extent&&(J[0][0]=q.positionAbsolute.x-B.x+I[0][0],J[1][0]=q.positionAbsolute.x+(q.width??0)-B.x2+I[1][0],J[0][1]=q.positionAbsolute.y-B.y+I[0][1],J[1][1]=q.positionAbsolute.y+(q.height??0)-B.y2+I[1][1]);const ie=VE(q,G,X,J,L,U);return k=k||q.position.x!==ie.position.x||q.position.y!==ie.position.y,q.position=ie.position,q.positionAbsolute=ie.positionAbsolute,q}),!k)return;V(y.current,!0,!0),p(!0);const R=l?H:Ep(Y);if(R&&N.current){const[q,G]=Np({nodeId:l,dragItems:y.current,nodeInternals:X});R(N.current,q,G)}},M=()=>{if(!S.current)return;const[z,P]=fE(w.current,S.current);if(z!==0||P!==0){const{transform:X,panBy:H}=m.getState();g.current.x=(g.current.x??0)-z/X[2],g.current.y=(g.current.y??0)-P/X[2],H({x:z,y:P})&&T(g.current)}v.current=requestAnimationFrame(M)},A=z=>{const{nodeInternals:P,multiSelectionActive:X,nodesDraggable:H,unselectNodesAndEdges:Y,onNodeDragStart:V,onSelectionDragStart:I}=m.getState();_.current=!0;const F=l?V:Ep(I);(!f||!c)&&!X&&l&&(P.get(l)?.selected||Y()),l&&c&&f&&hy({id:l,store:m,nodeRef:e});const D=O(z);if(g.current=D,y.current=F6(P,H,D,l),F&&y.current){const[L,U]=Np({nodeId:l,dragItems:y.current,nodeInternals:P});F(z.sourceEvent,L,U)}};if(t)E.on(".drag",null);else{const z=Q5().on("start",P=>{const{domNode:X,nodeDragThreshold:H}=m.getState();H===0&&A(P),C.current=!1;const Y=O(P);g.current=Y,S.current=X?.getBoundingClientRect()||null,w.current=Pr(P.sourceEvent,S.current)}).on("drag",P=>{const X=O(P),{autoPanOnNodeDrag:H,nodeDragThreshold:Y}=m.getState();if(P.sourceEvent.type==="touchmove"&&P.sourceEvent.touches.length>1&&(C.current=!0),!C.current){if(!j.current&&_.current&&H&&(j.current=!0,M()),!_.current){const V=X.xSnapped-(g?.current?.x??0),I=X.ySnapped-(g?.current?.y??0);Math.sqrt(V*V+I*I)>Y&&A(P)}(g.current.x!==X.xSnapped||g.current.y!==X.ySnapped)&&y.current&&_.current&&(N.current=P.sourceEvent,w.current=Pr(P.sourceEvent,S.current),T(X))}}).on("end",P=>{if(!(!_.current||C.current)&&(p(!1),j.current=!1,_.current=!1,cancelAnimationFrame(v.current),y.current)){const{updateNodePositions:X,nodeInternals:H,onNodeDragStop:Y,onSelectionDragStop:V}=m.getState(),I=l?Y:Ep(V);if(X(y.current,!1,!1),I){const[F,D]=Np({nodeId:l,dragItems:y.current,nodeInternals:H});I(P.sourceEvent,F,D)}}}).filter(P=>{const X=P.target;return!P.button&&(!r||!yw(X,`.${r}`,e))&&(!i||yw(X,i,e))});return E.call(z),()=>{E.on(".drag",null)}}}},[e,t,r,i,c,m,l,f,O]),h}function GE(){const e=aa();return u.useCallback(r=>{const{nodeInternals:i,nodeExtent:l,updateNodePositions:c,getNodes:f,snapToGrid:m,snapGrid:h,onError:p,nodesDraggable:y}=e.getState(),g=f().filter(C=>C.selected&&(C.draggable||y&&typeof C.draggable>"u")),v=m?h[0]:5,S=m?h[1]:5,w=r.isShiftPressed?4:1,N=r.x*v*w,j=r.y*S*w,_=g.map(C=>{if(C.positionAbsolute){const O={x:C.positionAbsolute.x+N,y:C.positionAbsolute.y+j};m&&(O.x=h[0]*Math.round(O.x/h[0]),O.y=h[1]*Math.round(O.y/h[1]));const{positionAbsolute:E,position:T}=VE(C,O,i,l,void 0,p);C.position=T,C.positionAbsolute=E}return C});c(_,!0,!1)},[])}const Al={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var Ho=e=>{const t=({id:r,type:i,data:l,xPos:c,yPos:f,xPosOrigin:m,yPosOrigin:h,selected:p,onClick:y,onMouseEnter:g,onMouseMove:v,onMouseLeave:S,onContextMenu:w,onDoubleClick:N,style:j,className:_,isDraggable:C,isSelectable:O,isConnectable:E,isFocusable:T,selectNodesOnDrag:M,sourcePosition:A,targetPosition:z,hidden:P,resizeObserver:X,dragHandle:H,zIndex:Y,isParent:V,noDragClassName:I,noPanClassName:F,initialized:D,disableKeyboardA11y:L,ariaLabel:U,rfId:k,hasHandleBounds:B})=>{const R=aa(),q=u.useRef(null),G=u.useRef(null),J=u.useRef(A),ie=u.useRef(z),Z=u.useRef(i),me=O||C||y||g||v||S,Q=GE(),oe=qo(r,R.getState,g),ne=qo(r,R.getState,v),we=qo(r,R.getState,S),ke=qo(r,R.getState,w),Re=qo(r,R.getState,N),Te=tt=>{const{nodeDragThreshold:Ie}=R.getState();if(O&&(!M||!C||Ie>0)&&hy({id:r,store:R,nodeRef:q}),y){const vt=R.getState().nodeInternals.get(r);vt&&y(tt,{...vt})}},rt=tt=>{if(!cy(tt)&&!L)if(yE.includes(tt.key)&&O){const Ie=tt.key==="Escape";hy({id:r,store:R,unselect:Ie,nodeRef:q})}else C&&p&&Object.prototype.hasOwnProperty.call(Al,tt.key)&&(R.setState({ariaLiveMessage:`Moved selected node ${tt.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~c}, y: ${~~f}`}),Q({x:Al[tt.key].x,y:Al[tt.key].y,isShiftPressed:tt.shiftKey}))};u.useEffect(()=>()=>{G.current&&(X?.unobserve(G.current),G.current=null)},[]),u.useEffect(()=>{if(q.current&&!P){const tt=q.current;(!D||!B||G.current!==tt)&&(G.current&&X?.unobserve(G.current),X?.observe(tt),G.current=tt)}},[P,D,B]),u.useEffect(()=>{const tt=Z.current!==i,Ie=J.current!==A,vt=ie.current!==z;q.current&&(tt||Ie||vt)&&(tt&&(Z.current=i),Ie&&(J.current=A),vt&&(ie.current=z),R.getState().updateNodeDimensions([{id:r,nodeElement:q.current,forceUpdate:!0}]))},[r,i,A,z]);const He=YE({nodeRef:q,disabled:P||!C,noDragClassName:I,handleSelector:H,nodeId:r,isSelectable:O,selectNodesOnDrag:M});return P?null:De.createElement("div",{className:ha(["react-flow__node",`react-flow__node-${i}`,{[F]:C},_,{selected:p,selectable:O,parent:V,dragging:He}]),ref:q,style:{zIndex:Y,transform:`translate(${m}px,${h}px)`,pointerEvents:me?"all":"none",visibility:D?"visible":"hidden",...j},"data-id":r,"data-testid":`rf__node-${r}`,onMouseEnter:oe,onMouseMove:ne,onMouseLeave:we,onContextMenu:ke,onClick:Te,onDoubleClick:Re,onKeyDown:T?rt:void 0,tabIndex:T?0:void 0,role:T?"button":void 0,"aria-describedby":L?void 0:`${OE}-${k}`,"aria-label":U},De.createElement(t6,{value:r},De.createElement(e,{id:r,data:l,type:i,xPos:c,yPos:f,selected:p,isConnectable:E,sourcePosition:A,targetPosition:z,dragging:He,dragHandle:H,zIndex:Y})))};return t.displayName="NodeWrapper",u.memo(t)};const q6=e=>{const t=e.getNodes().filter(r=>r.selected);return{...Nf(t,e.nodeOrigin),transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`,userSelectionActive:e.userSelectionActive}};function H6({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:r}){const i=aa(),{width:l,height:c,x:f,y:m,transformString:h,userSelectionActive:p}=Ln(q6,ra),y=GE(),g=u.useRef(null);if(u.useEffect(()=>{r||g.current?.focus({preventScroll:!0})},[r]),YE({nodeRef:g}),p||!l||!c)return null;const v=e?w=>{const N=i.getState().getNodes().filter(j=>j.selected);e(w,N)}:void 0,S=w=>{Object.prototype.hasOwnProperty.call(Al,w.key)&&y({x:Al[w.key].x,y:Al[w.key].y,isShiftPressed:w.shiftKey})};return De.createElement("div",{className:ha(["react-flow__nodesselection","react-flow__container",t]),style:{transform:h}},De.createElement("div",{ref:g,className:"react-flow__nodesselection-rect",onContextMenu:v,tabIndex:r?void 0:-1,onKeyDown:r?void 0:S,style:{width:l,height:c,top:m,left:f}}))}var P6=u.memo(H6);const V6=e=>e.nodesSelectionActive,XE=({children:e,onPaneClick:t,onPaneMouseEnter:r,onPaneMouseMove:i,onPaneMouseLeave:l,onPaneContextMenu:c,onPaneScroll:f,deleteKeyCode:m,onMove:h,onMoveStart:p,onMoveEnd:y,selectionKeyCode:g,selectionOnDrag:v,selectionMode:S,onSelectionStart:w,onSelectionEnd:N,multiSelectionKeyCode:j,panActivationKeyCode:_,zoomActivationKeyCode:C,elementsSelectable:O,zoomOnScroll:E,zoomOnPinch:T,panOnScroll:M,panOnScrollSpeed:A,panOnScrollMode:z,zoomOnDoubleClick:P,panOnDrag:X,defaultViewport:H,translateExtent:Y,minZoom:V,maxZoom:I,preventScrolling:F,onSelectionContextMenu:D,noWheelClassName:L,noPanClassName:U,disableKeyboardA11y:k})=>{const B=Ln(V6),R=xc(g),q=xc(_),G=q||X,J=q||M,ie=R||v&&G!==!0;return M6({deleteKeyCode:m,multiSelectionKeyCode:j}),De.createElement(I6,{onMove:h,onMoveStart:p,onMoveEnd:y,onPaneContextMenu:c,elementsSelectable:O,zoomOnScroll:E,zoomOnPinch:T,panOnScroll:J,panOnScrollSpeed:A,panOnScrollMode:z,zoomOnDoubleClick:P,panOnDrag:!R&&G,defaultViewport:H,translateExtent:Y,minZoom:V,maxZoom:I,zoomActivationKeyCode:C,preventScrolling:F,noWheelClassName:L,noPanClassName:U},De.createElement(HE,{onSelectionStart:w,onSelectionEnd:N,onPaneClick:t,onPaneMouseEnter:r,onPaneMouseMove:i,onPaneMouseLeave:l,onPaneContextMenu:c,onPaneScroll:f,panOnDrag:G,isSelecting:!!ie,selectionMode:S},e,B&&De.createElement(P6,{onSelectionContextMenu:D,noPanClassName:U,disableKeyboardA11y:k})))};XE.displayName="FlowRenderer";var Y6=u.memo(XE);function G6(e){return Ln(u.useCallback(r=>e?NE(r.nodeInternals,{x:0,y:0,width:r.width,height:r.height},r.transform,!0):r.getNodes(),[e]))}function X6(e){const t={input:Ho(e.input||kE),default:Ho(e.default||my),output:Ho(e.output||IE),group:Ho(e.group||gg)},r={},i=Object.keys(e).filter(l=>!["input","default","output","group"].includes(l)).reduce((l,c)=>(l[c]=Ho(e[c]||my),l),r);return{...t,...i}}const K6=({x:e,y:t,width:r,height:i,origin:l})=>!r||!i?{x:e,y:t}:l[0]<0||l[1]<0||l[0]>1||l[1]>1?{x:e,y:t}:{x:e-r*l[0],y:t-i*l[1]},W6=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions,onError:e.onError}),KE=e=>{const{nodesDraggable:t,nodesConnectable:r,nodesFocusable:i,elementsSelectable:l,updateNodeDimensions:c,onError:f}=Ln(W6,ra),m=G6(e.onlyRenderVisibleElements),h=u.useRef(),p=u.useMemo(()=>{if(typeof ResizeObserver>"u")return null;const y=new ResizeObserver(g=>{const v=g.map(S=>({id:S.target.getAttribute("data-id"),nodeElement:S.target,forceUpdate:!0}));c(v)});return h.current=y,y},[]);return u.useEffect(()=>()=>{h?.current?.disconnect()},[]),De.createElement("div",{className:"react-flow__nodes",style:vg},m.map(y=>{let g=y.type||"default";e.nodeTypes[g]||(f?.("003",lr.error003(g)),g="default");const v=e.nodeTypes[g]||e.nodeTypes.default,S=!!(y.draggable||t&&typeof y.draggable>"u"),w=!!(y.selectable||l&&typeof y.selectable>"u"),N=!!(y.connectable||r&&typeof y.connectable>"u"),j=!!(y.focusable||i&&typeof y.focusable>"u"),_=e.nodeExtent?dg(y.positionAbsolute,e.nodeExtent):y.positionAbsolute,C=_?.x??0,O=_?.y??0,E=K6({x:C,y:O,width:y.width??0,height:y.height??0,origin:e.nodeOrigin});return De.createElement(v,{key:y.id,id:y.id,className:y.className,style:y.style,type:g,data:y.data,sourcePosition:y.sourcePosition||Ut.Bottom,targetPosition:y.targetPosition||Ut.Top,hidden:y.hidden,xPos:C,yPos:O,xPosOrigin:E.x,yPosOrigin:E.y,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!y.selected,isDraggable:S,isSelectable:w,isConnectable:N,isFocusable:j,resizeObserver:p,dragHandle:y.dragHandle,zIndex:y[Yn]?.z??0,isParent:!!y[Yn]?.isParent,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!y.width&&!!y.height,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,ariaLabel:y.ariaLabel,hasHandleBounds:!!y[Yn]?.handleBounds})}))};KE.displayName="NodeRenderer";var Z6=u.memo(KE);const Q6=(e,t,r)=>r===Ut.Left?e-t:r===Ut.Right?e+t:e,J6=(e,t,r)=>r===Ut.Top?e-t:r===Ut.Bottom?e+t:e,bw="react-flow__edgeupdater",vw=({position:e,centerX:t,centerY:r,radius:i=10,onMouseDown:l,onMouseEnter:c,onMouseOut:f,type:m})=>De.createElement("circle",{onMouseDown:l,onMouseEnter:c,onMouseOut:f,className:ha([bw,`${bw}-${m}`]),cx:Q6(t,i,e),cy:J6(r,i,e),r:i,stroke:"transparent",fill:"transparent"}),e8=()=>!0;var Sl=e=>{const t=({id:r,className:i,type:l,data:c,onClick:f,onEdgeDoubleClick:m,selected:h,animated:p,label:y,labelStyle:g,labelShowBg:v,labelBgStyle:S,labelBgPadding:w,labelBgBorderRadius:N,style:j,source:_,target:C,sourceX:O,sourceY:E,targetX:T,targetY:M,sourcePosition:A,targetPosition:z,elementsSelectable:P,hidden:X,sourceHandleId:H,targetHandleId:Y,onContextMenu:V,onMouseEnter:I,onMouseMove:F,onMouseLeave:D,reconnectRadius:L,onReconnect:U,onReconnectStart:k,onReconnectEnd:B,markerEnd:R,markerStart:q,rfId:G,ariaLabel:J,isFocusable:ie,isReconnectable:Z,pathOptions:me,interactionWidth:Q,disableKeyboardA11y:oe})=>{const ne=u.useRef(null),[we,ke]=u.useState(!1),[Re,Te]=u.useState(!1),rt=aa(),He=u.useMemo(()=>`url('#${dy(q,G)}')`,[q,G]),tt=u.useMemo(()=>`url('#${dy(R,G)}')`,[R,G]);if(X)return null;const Ie=Ee=>{const{edges:ge,addSelectedEdges:at,unselectNodesAndEdges:st,multiSelectionActive:nt}=rt.getState(),$e=ge.find(ft=>ft.id===r);$e&&(P&&(rt.setState({nodesSelectionActive:!1}),$e.selected&&nt?(st({nodes:[],edges:[$e]}),ne.current?.blur()):at([r])),f&&f(Ee,$e))},vt=Bo(r,rt.getState,m),Ct=Bo(r,rt.getState,V),At=Bo(r,rt.getState,I),_t=Bo(r,rt.getState,F),Pe=Bo(r,rt.getState,D),Ze=(Ee,ge)=>{if(Ee.button!==0)return;const{edges:at,isValidConnection:st}=rt.getState(),nt=ge?C:_,$e=(ge?Y:H)||null,ft=ge?"target":"source",zt=st||e8,Rt=ge,pt=at.find(Mt=>Mt.id===r);Te(!0),k?.(Ee,pt,ft);const ct=Mt=>{Te(!1),B?.(Mt,pt,ft)};AE({event:Ee,handleId:$e,nodeId:nt,onConnect:Mt=>U?.(pt,Mt),isTarget:Rt,getState:rt.getState,setState:rt.setState,isValidConnection:zt,edgeUpdaterType:ft,onReconnectEnd:ct})},W=Ee=>Ze(Ee,!0),ee=Ee=>Ze(Ee,!1),te=()=>ke(!0),ve=()=>ke(!1),le=!P&&!f,Se=Ee=>{if(!oe&&yE.includes(Ee.key)&&P){const{unselectNodesAndEdges:ge,addSelectedEdges:at,edges:st}=rt.getState();Ee.key==="Escape"?(ne.current?.blur(),ge({edges:[st.find($e=>$e.id===r)]})):at([r])}};return De.createElement("g",{className:ha(["react-flow__edge",`react-flow__edge-${l}`,i,{selected:h,animated:p,inactive:le,updating:we}]),onClick:Ie,onDoubleClick:vt,onContextMenu:Ct,onMouseEnter:At,onMouseMove:_t,onMouseLeave:Pe,onKeyDown:ie?Se:void 0,tabIndex:ie?0:void 0,role:ie?"button":"img","data-testid":`rf__edge-${r}`,"aria-label":J===null?void 0:J||`Edge from ${_} to ${C}`,"aria-describedby":ie?`${zE}-${G}`:void 0,ref:ne},!Re&&De.createElement(e,{id:r,source:_,target:C,selected:h,animated:p,label:y,labelStyle:g,labelShowBg:v,labelBgStyle:S,labelBgPadding:w,labelBgBorderRadius:N,data:c,style:j,sourceX:O,sourceY:E,targetX:T,targetY:M,sourcePosition:A,targetPosition:z,sourceHandleId:H,targetHandleId:Y,markerStart:He,markerEnd:tt,pathOptions:me,interactionWidth:Q}),Z&&De.createElement(De.Fragment,null,(Z==="source"||Z===!0)&&De.createElement(vw,{position:A,centerX:O,centerY:E,radius:L,onMouseDown:W,onMouseEnter:te,onMouseOut:ve,type:"source"}),(Z==="target"||Z===!0)&&De.createElement(vw,{position:z,centerX:T,centerY:M,radius:L,onMouseDown:ee,onMouseEnter:te,onMouseOut:ve,type:"target"})))};return t.displayName="EdgeWrapper",u.memo(t)};function t8(e){const t={default:Sl(e.default||Pd),straight:Sl(e.bezier||hg),step:Sl(e.step||mg),smoothstep:Sl(e.step||wf),simplebezier:Sl(e.simplebezier||fg)},r={},i=Object.keys(e).filter(l=>!["default","bezier"].includes(l)).reduce((l,c)=>(l[c]=Sl(e[c]||Pd),l),r);return{...t,...i}}function xw(e,t,r=null){const i=(r?.x||0)+t.x,l=(r?.y||0)+t.y,c=r?.width||t.width,f=r?.height||t.height;switch(e){case Ut.Top:return{x:i+c/2,y:l};case Ut.Right:return{x:i+c,y:l+f/2};case Ut.Bottom:return{x:i+c/2,y:l+f};case Ut.Left:return{x:i,y:l+f/2}}}function Sw(e,t){return e?e.length===1||!t?e[0]:t&&e.find(r=>r.id===t)||null:null}const n8=(e,t,r,i,l,c)=>{const f=xw(r,e,t),m=xw(c,i,l);return{sourceX:f.x,sourceY:f.y,targetX:m.x,targetY:m.y}};function a8({sourcePos:e,targetPos:t,sourceWidth:r,sourceHeight:i,targetWidth:l,targetHeight:c,width:f,height:m,transform:h}){const p={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x+r,t.x+l),y2:Math.max(e.y+i,t.y+c)};p.x===p.x2&&(p.x2+=1),p.y===p.y2&&(p.y2+=1);const y=bc({x:(0-h[0])/h[2],y:(0-h[1])/h[2],width:f/h[2],height:m/h[2]}),g=Math.max(0,Math.min(y.x2,p.x2)-Math.max(y.x,p.x)),v=Math.max(0,Math.min(y.y2,p.y2)-Math.max(y.y,p.y));return Math.ceil(g*v)>0}function ww(e){const t=e?.[Yn]?.handleBounds||null,r=t&&e?.width&&e?.height&&typeof e?.positionAbsolute?.x<"u"&&typeof e?.positionAbsolute?.y<"u";return[{x:e?.positionAbsolute?.x||0,y:e?.positionAbsolute?.y||0,width:e?.width||0,height:e?.height||0},t,!!r]}const s8=[{level:0,isMaxLevel:!0,edges:[]}];function r8(e,t,r=!1){let i=-1;const l=e.reduce((f,m)=>{const h=is(m.zIndex);let p=h?m.zIndex:0;if(r){const y=t.get(m.target),g=t.get(m.source),v=m.selected||y?.selected||g?.selected,S=Math.max(g?.[Yn]?.z||0,y?.[Yn]?.z||0,1e3);p=(h?m.zIndex:0)+(v?S:0)}return f[p]?f[p].push(m):f[p]=[m],i=p>i?p:i,f},{}),c=Object.entries(l).map(([f,m])=>{const h=+f;return{edges:m,level:h,isMaxLevel:h===i}});return c.length===0?s8:c}function i8(e,t,r){const i=Ln(u.useCallback(l=>e?l.edges.filter(c=>{const f=t.get(c.source),m=t.get(c.target);return f?.width&&f?.height&&m?.width&&m?.height&&a8({sourcePos:f.positionAbsolute||{x:0,y:0},targetPos:m.positionAbsolute||{x:0,y:0},sourceWidth:f.width,sourceHeight:f.height,targetWidth:m.width,targetHeight:m.height,width:l.width,height:l.height,transform:l.transform})}):l.edges,[e,t]));return r8(i,t,r)}const l8=({color:e="none",strokeWidth:t=1})=>De.createElement("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),o8=({color:e="none",strokeWidth:t=1})=>De.createElement("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),Nw={[Hd.Arrow]:l8,[Hd.ArrowClosed]:o8};function c8(e){const t=aa();return u.useMemo(()=>Object.prototype.hasOwnProperty.call(Nw,e)?Nw[e]:(t.getState().onError?.("009",lr.error009(e)),null),[e])}const u8=({id:e,type:t,color:r,width:i=12.5,height:l=12.5,markerUnits:c="strokeWidth",strokeWidth:f,orient:m="auto-start-reverse"})=>{const h=c8(t);return h?De.createElement("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${i}`,markerHeight:`${l}`,viewBox:"-10 -10 20 20",markerUnits:c,orient:m,refX:"0",refY:"0"},De.createElement(h,{color:r,strokeWidth:f})):null},d8=({defaultColor:e,rfId:t})=>r=>{const i=[];return r.edges.reduce((l,c)=>([c.markerStart,c.markerEnd].forEach(f=>{if(f&&typeof f=="object"){const m=dy(f,t);i.includes(m)||(l.push({id:m,color:f.color||e,...f}),i.push(m))}}),l),[]).sort((l,c)=>l.id.localeCompare(c.id))},WE=({defaultColor:e,rfId:t})=>{const r=Ln(u.useCallback(d8({defaultColor:e,rfId:t}),[e,t]),(i,l)=>!(i.length!==l.length||i.some((c,f)=>c.id!==l[f].id)));return De.createElement("defs",null,r.map(i=>De.createElement(u8,{id:i.id,key:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient})))};WE.displayName="MarkerDefinitions";var f8=u.memo(WE);const m8=e=>({nodesConnectable:e.nodesConnectable,edgesFocusable:e.edgesFocusable,edgesUpdatable:e.edgesUpdatable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals,onError:e.onError}),ZE=({defaultMarkerColor:e,onlyRenderVisibleElements:t,elevateEdgesOnSelect:r,rfId:i,edgeTypes:l,noPanClassName:c,onEdgeContextMenu:f,onEdgeMouseEnter:m,onEdgeMouseMove:h,onEdgeMouseLeave:p,onEdgeClick:y,onEdgeDoubleClick:g,onReconnect:v,onReconnectStart:S,onReconnectEnd:w,reconnectRadius:N,children:j,disableKeyboardA11y:_})=>{const{edgesFocusable:C,edgesUpdatable:O,elementsSelectable:E,width:T,height:M,connectionMode:A,nodeInternals:z,onError:P}=Ln(m8,ra),X=i8(t,z,r);return T?De.createElement(De.Fragment,null,X.map(({level:H,edges:Y,isMaxLevel:V})=>De.createElement("svg",{key:H,style:{zIndex:H},width:T,height:M,className:"react-flow__edges react-flow__container"},V&&De.createElement(f8,{defaultColor:e,rfId:i}),De.createElement("g",null,Y.map(I=>{const[F,D,L]=ww(z.get(I.source)),[U,k,B]=ww(z.get(I.target));if(!L||!B)return null;let R=I.type||"default";l[R]||(P?.("011",lr.error011(R)),R="default");const q=l[R]||l.default,G=A===Ri.Strict?k.target:(k.target??[]).concat(k.source??[]),J=Sw(D.source,I.sourceHandle),ie=Sw(G,I.targetHandle),Z=J?.position||Ut.Bottom,me=ie?.position||Ut.Top,Q=!!(I.focusable||C&&typeof I.focusable>"u"),oe=I.reconnectable||I.updatable,ne=typeof v<"u"&&(oe||O&&typeof oe>"u");if(!J||!ie)return P?.("008",lr.error008(J,I)),null;const{sourceX:we,sourceY:ke,targetX:Re,targetY:Te}=n8(F,J,Z,U,ie,me);return De.createElement(q,{key:I.id,id:I.id,className:ha([I.className,c]),type:R,data:I.data,selected:!!I.selected,animated:!!I.animated,hidden:!!I.hidden,label:I.label,labelStyle:I.labelStyle,labelShowBg:I.labelShowBg,labelBgStyle:I.labelBgStyle,labelBgPadding:I.labelBgPadding,labelBgBorderRadius:I.labelBgBorderRadius,style:I.style,source:I.source,target:I.target,sourceHandleId:I.sourceHandle,targetHandleId:I.targetHandle,markerEnd:I.markerEnd,markerStart:I.markerStart,sourceX:we,sourceY:ke,targetX:Re,targetY:Te,sourcePosition:Z,targetPosition:me,elementsSelectable:E,onContextMenu:f,onMouseEnter:m,onMouseMove:h,onMouseLeave:p,onClick:y,onEdgeDoubleClick:g,onReconnect:v,onReconnectStart:S,onReconnectEnd:w,reconnectRadius:N,rfId:i,ariaLabel:I.ariaLabel,isFocusable:Q,isReconnectable:ne,pathOptions:"pathOptions"in I?I.pathOptions:void 0,interactionWidth:I.interactionWidth,disableKeyboardA11y:_})})))),j):null};ZE.displayName="EdgeRenderer";var h8=u.memo(ZE);const p8=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function y8({children:e}){const t=Ln(p8);return De.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:t}},e)}function g8(e){const t=bg(),r=u.useRef(!1);u.useEffect(()=>{!r.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),r.current=!0)},[e,t.viewportInitialized])}const b8={[Ut.Left]:Ut.Right,[Ut.Right]:Ut.Left,[Ut.Top]:Ut.Bottom,[Ut.Bottom]:Ut.Top},QE=({nodeId:e,handleType:t,style:r,type:i=qr.Bezier,CustomComponent:l,connectionStatus:c})=>{const{fromNode:f,handleId:m,toX:h,toY:p,connectionMode:y}=Ln(u.useCallback(M=>({fromNode:M.nodeInternals.get(e),handleId:M.connectionHandleId,toX:(M.connectionPosition.x-M.transform[0])/M.transform[2],toY:(M.connectionPosition.y-M.transform[1])/M.transform[2],connectionMode:M.connectionMode}),[e]),ra),g=f?.[Yn]?.handleBounds;let v=g?.[t];if(y===Ri.Loose&&(v=v||g?.[t==="source"?"target":"source"]),!f||!v)return null;const S=m?v.find(M=>M.id===m):v[0],w=S?S.x+S.width/2:(f.width??0)/2,N=S?S.y+S.height/2:f.height??0,j=(f.positionAbsolute?.x??0)+w,_=(f.positionAbsolute?.y??0)+N,C=S?.position,O=C?b8[C]:null;if(!C||!O)return null;if(l)return De.createElement(l,{connectionLineType:i,connectionLineStyle:r,fromNode:f,fromHandle:S,fromX:j,fromY:_,toX:h,toY:p,fromPosition:C,toPosition:O,connectionStatus:c});let E="";const T={sourceX:j,sourceY:_,sourcePosition:C,targetX:h,targetY:p,targetPosition:O};return i===qr.Bezier?[E]=SE(T):i===qr.Step?[E]=uy({...T,borderRadius:0}):i===qr.SmoothStep?[E]=uy(T):i===qr.SimpleBezier?[E]=xE(T):E=`M${j},${_} ${h},${p}`,De.createElement("path",{d:E,fill:"none",className:"react-flow__connection-path",style:r})};QE.displayName="ConnectionLine";const v8=e=>({nodeId:e.connectionNodeId,handleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,connectionStatus:e.connectionStatus,width:e.width,height:e.height});function x8({containerStyle:e,style:t,type:r,component:i}){const{nodeId:l,handleType:c,nodesConnectable:f,width:m,height:h,connectionStatus:p}=Ln(v8,ra);return!(l&&c&&m&&f)?null:De.createElement("svg",{style:e,width:m,height:h,className:"react-flow__edges react-flow__connectionline react-flow__container"},De.createElement("g",{className:ha(["react-flow__connection",p])},De.createElement(QE,{nodeId:l,handleType:c,style:t,type:r,CustomComponent:i,connectionStatus:p})))}function Ew(e,t){return u.useRef(null),aa(),u.useMemo(()=>t(e),[e])}const JE=({nodeTypes:e,edgeTypes:t,onMove:r,onMoveStart:i,onMoveEnd:l,onInit:c,onNodeClick:f,onEdgeClick:m,onNodeDoubleClick:h,onEdgeDoubleClick:p,onNodeMouseEnter:y,onNodeMouseMove:g,onNodeMouseLeave:v,onNodeContextMenu:S,onSelectionContextMenu:w,onSelectionStart:N,onSelectionEnd:j,connectionLineType:_,connectionLineStyle:C,connectionLineComponent:O,connectionLineContainerStyle:E,selectionKeyCode:T,selectionOnDrag:M,selectionMode:A,multiSelectionKeyCode:z,panActivationKeyCode:P,zoomActivationKeyCode:X,deleteKeyCode:H,onlyRenderVisibleElements:Y,elementsSelectable:V,selectNodesOnDrag:I,defaultViewport:F,translateExtent:D,minZoom:L,maxZoom:U,preventScrolling:k,defaultMarkerColor:B,zoomOnScroll:R,zoomOnPinch:q,panOnScroll:G,panOnScrollSpeed:J,panOnScrollMode:ie,zoomOnDoubleClick:Z,panOnDrag:me,onPaneClick:Q,onPaneMouseEnter:oe,onPaneMouseMove:ne,onPaneMouseLeave:we,onPaneScroll:ke,onPaneContextMenu:Re,onEdgeContextMenu:Te,onEdgeMouseEnter:rt,onEdgeMouseMove:He,onEdgeMouseLeave:tt,onReconnect:Ie,onReconnectStart:vt,onReconnectEnd:Ct,reconnectRadius:At,noDragClassName:_t,noWheelClassName:Pe,noPanClassName:Ze,elevateEdgesOnSelect:W,disableKeyboardA11y:ee,nodeOrigin:te,nodeExtent:ve,rfId:le})=>{const Se=Ew(e,X6),Ee=Ew(t,t8);return g8(c),De.createElement(Y6,{onPaneClick:Q,onPaneMouseEnter:oe,onPaneMouseMove:ne,onPaneMouseLeave:we,onPaneContextMenu:Re,onPaneScroll:ke,deleteKeyCode:H,selectionKeyCode:T,selectionOnDrag:M,selectionMode:A,onSelectionStart:N,onSelectionEnd:j,multiSelectionKeyCode:z,panActivationKeyCode:P,zoomActivationKeyCode:X,elementsSelectable:V,onMove:r,onMoveStart:i,onMoveEnd:l,zoomOnScroll:R,zoomOnPinch:q,zoomOnDoubleClick:Z,panOnScroll:G,panOnScrollSpeed:J,panOnScrollMode:ie,panOnDrag:me,defaultViewport:F,translateExtent:D,minZoom:L,maxZoom:U,onSelectionContextMenu:w,preventScrolling:k,noDragClassName:_t,noWheelClassName:Pe,noPanClassName:Ze,disableKeyboardA11y:ee},De.createElement(y8,null,De.createElement(h8,{edgeTypes:Ee,onEdgeClick:m,onEdgeDoubleClick:p,onlyRenderVisibleElements:Y,onEdgeContextMenu:Te,onEdgeMouseEnter:rt,onEdgeMouseMove:He,onEdgeMouseLeave:tt,onReconnect:Ie,onReconnectStart:vt,onReconnectEnd:Ct,reconnectRadius:At,defaultMarkerColor:B,noPanClassName:Ze,elevateEdgesOnSelect:!!W,disableKeyboardA11y:ee,rfId:le},De.createElement(x8,{style:C,type:_,component:O,containerStyle:E})),De.createElement("div",{className:"react-flow__edgelabel-renderer"}),De.createElement(Z6,{nodeTypes:Se,onNodeClick:f,onNodeDoubleClick:h,onNodeMouseEnter:y,onNodeMouseMove:g,onNodeMouseLeave:v,onNodeContextMenu:S,selectNodesOnDrag:I,onlyRenderVisibleElements:Y,noPanClassName:Ze,noDragClassName:_t,disableKeyboardA11y:ee,nodeOrigin:te,nodeExtent:ve,rfId:le})))};JE.displayName="GraphView";var S8=u.memo(JE);const py=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Ir={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:py,nodeExtent:py,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:Ri.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:K7,isValidConnection:void 0},w8=()=>uL((e,t)=>({...Ir,setNodes:r=>{const{nodeInternals:i,nodeOrigin:l,elevateNodesOnSelect:c}=t();e({nodeInternals:Sp(r,i,l,c)})},getNodes:()=>Array.from(t().nodeInternals.values()),setEdges:r=>{const{defaultEdgeOptions:i={}}=t();e({edges:r.map(l=>({...i,...l}))})},setDefaultNodesAndEdges:(r,i)=>{const l=typeof r<"u",c=typeof i<"u",f=l?Sp(r,new Map,t().nodeOrigin,t().elevateNodesOnSelect):new Map;e({nodeInternals:f,edges:c?i:[],hasDefaultNodes:l,hasDefaultEdges:c})},updateNodeDimensions:r=>{const{onNodesChange:i,nodeInternals:l,fitViewOnInit:c,fitViewOnInitDone:f,fitViewOnInitOptions:m,domNode:h,nodeOrigin:p}=t(),y=h?.querySelector(".react-flow__viewport");if(!y)return;const g=window.getComputedStyle(y),{m22:v}=new window.DOMMatrixReadOnly(g.transform),S=r.reduce((N,j)=>{const _=l.get(j.id);if(_?.hidden)l.set(_.id,{..._,[Yn]:{..._[Yn],handleBounds:void 0}});else if(_){const C=ug(j.nodeElement);!!(C.width&&C.height&&(_.width!==C.width||_.height!==C.height||j.forceUpdate))&&(l.set(_.id,{..._,[Yn]:{..._[Yn],handleBounds:{source:gw(".source",j.nodeElement,v,p),target:gw(".target",j.nodeElement,v,p)}},...C}),N.push({id:_.id,type:"dimensions",dimensions:C}))}return N},[]);FE(l,p);const w=f||c&&!f&&UE(t,{initial:!0,...m});e({nodeInternals:new Map(l),fitViewOnInitDone:w}),S?.length>0&&i?.(S)},updateNodePositions:(r,i=!0,l=!1)=>{const{triggerNodeChanges:c}=t(),f=r.map(m=>{const h={id:m.id,type:"position",dragging:l};return i&&(h.positionAbsolute=m.positionAbsolute,h.position=m.position),h});c(f)},triggerNodeChanges:r=>{const{onNodesChange:i,nodeInternals:l,hasDefaultNodes:c,nodeOrigin:f,getNodes:m,elevateNodesOnSelect:h}=t();if(r?.length){if(c){const p=qE(r,m()),y=Sp(p,l,f,h);e({nodeInternals:y})}i?.(r)}},addSelectedNodes:r=>{const{multiSelectionActive:i,edges:l,getNodes:c}=t();let f,m=null;i?f=r.map(h=>$r(h,!0)):(f=Nl(c(),r),m=Nl(l,[])),rd({changedNodes:f,changedEdges:m,get:t,set:e})},addSelectedEdges:r=>{const{multiSelectionActive:i,edges:l,getNodes:c}=t();let f,m=null;i?f=r.map(h=>$r(h,!0)):(f=Nl(l,r),m=Nl(c(),[])),rd({changedNodes:m,changedEdges:f,get:t,set:e})},unselectNodesAndEdges:({nodes:r,edges:i}={})=>{const{edges:l,getNodes:c}=t(),f=r||c(),m=i||l,h=f.map(y=>(y.selected=!1,$r(y.id,!1))),p=m.map(y=>$r(y.id,!1));rd({changedNodes:h,changedEdges:p,get:t,set:e})},setMinZoom:r=>{const{d3Zoom:i,maxZoom:l}=t();i?.scaleExtent([r,l]),e({minZoom:r})},setMaxZoom:r=>{const{d3Zoom:i,minZoom:l}=t();i?.scaleExtent([l,r]),e({maxZoom:r})},setTranslateExtent:r=>{t().d3Zoom?.translateExtent(r),e({translateExtent:r})},resetSelectedElements:()=>{const{edges:r,getNodes:i}=t(),c=i().filter(m=>m.selected).map(m=>$r(m.id,!1)),f=r.filter(m=>m.selected).map(m=>$r(m.id,!1));rd({changedNodes:c,changedEdges:f,get:t,set:e})},setNodeExtent:r=>{const{nodeInternals:i}=t();i.forEach(l=>{l.positionAbsolute=dg(l.position,r)}),e({nodeExtent:r,nodeInternals:new Map(i)})},panBy:r=>{const{transform:i,width:l,height:c,d3Zoom:f,d3Selection:m,translateExtent:h}=t();if(!f||!m||!r.x&&!r.y)return!1;const p=sr.translate(i[0]+r.x,i[1]+r.y).scale(i[2]),y=[[0,0],[l,c]],g=f?.constrain()(p,y,h);return f.transform(m,g),i[0]!==g.x||i[1]!==g.y||i[2]!==g.k},cancelConnection:()=>e({connectionNodeId:Ir.connectionNodeId,connectionHandleId:Ir.connectionHandleId,connectionHandleType:Ir.connectionHandleType,connectionStatus:Ir.connectionStatus,connectionStartHandle:Ir.connectionStartHandle,connectionEndHandle:Ir.connectionEndHandle}),reset:()=>e({...Ir})}),Object.is),ej=({children:e})=>{const t=u.useRef(null);return t.current||(t.current=w8()),De.createElement(q7,{value:t.current},e)};ej.displayName="ReactFlowProvider";const tj=({children:e})=>u.useContext(Sf)?De.createElement(De.Fragment,null,e):De.createElement(ej,null,e);tj.displayName="ReactFlowWrapper";const N8={input:kE,default:my,output:IE,group:gg},E8={default:Pd,straight:hg,step:mg,smoothstep:wf,simplebezier:fg},j8=[0,0],_8=[15,15],C8={x:0,y:0,zoom:1},A8={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},nj=u.forwardRef(({nodes:e,edges:t,defaultNodes:r,defaultEdges:i,className:l,nodeTypes:c=N8,edgeTypes:f=E8,onNodeClick:m,onEdgeClick:h,onInit:p,onMove:y,onMoveStart:g,onMoveEnd:v,onConnect:S,onConnectStart:w,onConnectEnd:N,onClickConnectStart:j,onClickConnectEnd:_,onNodeMouseEnter:C,onNodeMouseMove:O,onNodeMouseLeave:E,onNodeContextMenu:T,onNodeDoubleClick:M,onNodeDragStart:A,onNodeDrag:z,onNodeDragStop:P,onNodesDelete:X,onEdgesDelete:H,onSelectionChange:Y,onSelectionDragStart:V,onSelectionDrag:I,onSelectionDragStop:F,onSelectionContextMenu:D,onSelectionStart:L,onSelectionEnd:U,connectionMode:k=Ri.Strict,connectionLineType:B=qr.Bezier,connectionLineStyle:R,connectionLineComponent:q,connectionLineContainerStyle:G,deleteKeyCode:J="Backspace",selectionKeyCode:ie="Shift",selectionOnDrag:Z=!1,selectionMode:me=vc.Full,panActivationKeyCode:Q="Space",multiSelectionKeyCode:oe=qd()?"Meta":"Control",zoomActivationKeyCode:ne=qd()?"Meta":"Control",snapToGrid:we=!1,snapGrid:ke=_8,onlyRenderVisibleElements:Re=!1,selectNodesOnDrag:Te=!0,nodesDraggable:rt,nodesConnectable:He,nodesFocusable:tt,nodeOrigin:Ie=j8,edgesFocusable:vt,edgesUpdatable:Ct,elementsSelectable:At,defaultViewport:_t=C8,minZoom:Pe=.5,maxZoom:Ze=2,translateExtent:W=py,preventScrolling:ee=!0,nodeExtent:te,defaultMarkerColor:ve="#b1b1b7",zoomOnScroll:le=!0,zoomOnPinch:Se=!0,panOnScroll:Ee=!1,panOnScrollSpeed:ge=.5,panOnScrollMode:at=Ci.Free,zoomOnDoubleClick:st=!0,panOnDrag:nt=!0,onPaneClick:$e,onPaneMouseEnter:ft,onPaneMouseMove:zt,onPaneMouseLeave:Rt,onPaneScroll:pt,onPaneContextMenu:ct,children:yt,onEdgeContextMenu:Mt,onEdgeDoubleClick:Ft,onEdgeMouseEnter:kt,onEdgeMouseMove:Zt,onEdgeMouseLeave:Lt,onEdgeUpdate:Kt,onEdgeUpdateStart:se,onEdgeUpdateEnd:be,onReconnect:je,onReconnectStart:We,onReconnectEnd:dt,reconnectRadius:gt=10,edgeUpdaterRadius:ce=10,onNodesChange:re,onEdgesChange:Ne,noDragClassName:Be="nodrag",noWheelClassName:Ke="nowheel",noPanClassName:ot="nopan",fitView:ze=!1,fitViewOptions:ue,connectOnClick:qe=!0,attributionPosition:Ge,proOptions:ut,defaultEdgeOptions:ae,elevateNodesOnSelect:Xe=!0,elevateEdgesOnSelect:Fe=!1,disableKeyboardA11y:Qe=!1,autoPanOnConnect:bt=!0,autoPanOnNodeDrag:St=!0,connectionRadius:_e=20,isValidConnection:et,onError:mt,style:fe,id:he,nodeDragThreshold:Ve,...xt},Nt)=>{const Et=he||"1";return De.createElement("div",{...xt,style:{...fe,...A8},ref:Nt,className:ha(["react-flow",l]),"data-testid":"rf__wrapper",id:he},De.createElement(tj,null,De.createElement(S8,{onInit:p,onMove:y,onMoveStart:g,onMoveEnd:v,onNodeClick:m,onEdgeClick:h,onNodeMouseEnter:C,onNodeMouseMove:O,onNodeMouseLeave:E,onNodeContextMenu:T,onNodeDoubleClick:M,nodeTypes:c,edgeTypes:f,connectionLineType:B,connectionLineStyle:R,connectionLineComponent:q,connectionLineContainerStyle:G,selectionKeyCode:ie,selectionOnDrag:Z,selectionMode:me,deleteKeyCode:J,multiSelectionKeyCode:oe,panActivationKeyCode:Q,zoomActivationKeyCode:ne,onlyRenderVisibleElements:Re,selectNodesOnDrag:Te,defaultViewport:_t,translateExtent:W,minZoom:Pe,maxZoom:Ze,preventScrolling:ee,zoomOnScroll:le,zoomOnPinch:Se,zoomOnDoubleClick:st,panOnScroll:Ee,panOnScrollSpeed:ge,panOnScrollMode:at,panOnDrag:nt,onPaneClick:$e,onPaneMouseEnter:ft,onPaneMouseMove:zt,onPaneMouseLeave:Rt,onPaneScroll:pt,onPaneContextMenu:ct,onSelectionContextMenu:D,onSelectionStart:L,onSelectionEnd:U,onEdgeContextMenu:Mt,onEdgeDoubleClick:Ft,onEdgeMouseEnter:kt,onEdgeMouseMove:Zt,onEdgeMouseLeave:Lt,onReconnect:je??Kt,onReconnectStart:We??se,onReconnectEnd:dt??be,reconnectRadius:gt??ce,defaultMarkerColor:ve,noDragClassName:Be,noWheelClassName:Ke,noPanClassName:ot,elevateEdgesOnSelect:Fe,rfId:Et,disableKeyboardA11y:Qe,nodeOrigin:Ie,nodeExtent:te}),De.createElement(b6,{nodes:e,edges:t,defaultNodes:r,defaultEdges:i,onConnect:S,onConnectStart:w,onConnectEnd:N,onClickConnectStart:j,onClickConnectEnd:_,nodesDraggable:rt,nodesConnectable:He,nodesFocusable:tt,edgesFocusable:vt,edgesUpdatable:Ct,elementsSelectable:At,elevateNodesOnSelect:Xe,minZoom:Pe,maxZoom:Ze,nodeExtent:te,onNodesChange:re,onEdgesChange:Ne,snapToGrid:we,snapGrid:ke,connectionMode:k,translateExtent:W,connectOnClick:qe,defaultEdgeOptions:ae,fitView:ze,fitViewOptions:ue,onNodesDelete:X,onEdgesDelete:H,onNodeDragStart:A,onNodeDrag:z,onNodeDragStop:P,onSelectionDrag:I,onSelectionDragStart:V,onSelectionDragStop:F,noPanClassName:ot,nodeOrigin:Ie,rfId:Et,autoPanOnConnect:bt,autoPanOnNodeDrag:St,onError:mt,connectionRadius:_e,isValidConnection:et,nodeDragThreshold:Ve}),De.createElement(y6,{onSelectionChange:Y}),yt,De.createElement(P7,{proOptions:ut,position:Ge}),De.createElement(N6,{rfId:Et,disableKeyboardA11y:Qe})))});nj.displayName="ReactFlow";const aj=({id:e,x:t,y:r,width:i,height:l,style:c,color:f,strokeColor:m,strokeWidth:h,className:p,borderRadius:y,shapeRendering:g,onClick:v,selected:S})=>{const{background:w,backgroundColor:N}=c||{},j=f||w||N;return De.createElement("rect",{className:ha(["react-flow__minimap-node",{selected:S},p]),x:t,y:r,rx:y,ry:y,width:i,height:l,fill:j,stroke:m,strokeWidth:h,shapeRendering:g,onClick:v?_=>v(_,e):void 0})};aj.displayName="MiniMapNode";var T8=u.memo(aj);const M8=e=>e.nodeOrigin,R8=e=>e.getNodes().filter(t=>!t.hidden&&t.width&&t.height),jp=e=>e instanceof Function?e:()=>e;function k8({nodeStrokeColor:e="transparent",nodeColor:t="#e2e2e2",nodeClassName:r="",nodeBorderRadius:i=5,nodeStrokeWidth:l=2,nodeComponent:c=T8,onClick:f}){const m=Ln(R8,ra),h=Ln(M8),p=jp(t),y=jp(e),g=jp(r),v=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return De.createElement(De.Fragment,null,m.map(S=>{const{x:w,y:N}=Ti(S,h).positionAbsolute;return De.createElement(c,{key:S.id,x:w,y:N,width:S.width,height:S.height,style:S.style,selected:S.selected,className:g(S),color:p(S),borderRadius:i,strokeColor:y(S),strokeWidth:l,shapeRendering:v,onClick:f,id:S.id})}))}var D8=u.memo(k8);const I8=200,L8=150,O8=e=>{const t=e.getNodes(),r={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:r,boundingRect:t.length>0?G7(Nf(t,e.nodeOrigin),r):r,rfId:e.rfId}},z8="react-flow__minimap-desc";function sj({style:e,className:t,nodeStrokeColor:r="transparent",nodeColor:i="#e2e2e2",nodeClassName:l="",nodeBorderRadius:c=5,nodeStrokeWidth:f=2,nodeComponent:m,maskColor:h="rgb(240, 240, 240, 0.6)",maskStrokeColor:p="none",maskStrokeWidth:y=1,position:g="bottom-right",onClick:v,onNodeClick:S,pannable:w=!1,zoomable:N=!1,ariaLabel:j="React Flow mini map",inversePan:_=!1,zoomStep:C=10,offsetScale:O=5}){const E=aa(),T=u.useRef(null),{boundingRect:M,viewBB:A,rfId:z}=Ln(O8,ra),P=e?.width??I8,X=e?.height??L8,H=M.width/P,Y=M.height/X,V=Math.max(H,Y),I=V*P,F=V*X,D=O*V,L=M.x-(I-M.width)/2-D,U=M.y-(F-M.height)/2-D,k=I+D*2,B=F+D*2,R=`${z8}-${z}`,q=u.useRef(0);q.current=V,u.useEffect(()=>{if(T.current){const ie=rs(T.current),Z=oe=>{const{transform:ne,d3Selection:we,d3Zoom:ke}=E.getState();if(oe.sourceEvent.type!=="wheel"||!we||!ke)return;const Re=-oe.sourceEvent.deltaY*(oe.sourceEvent.deltaMode===1?.05:oe.sourceEvent.deltaMode?1:.002)*C,Te=ne[2]*Math.pow(2,Re);ke.scaleTo(we,Te)},me=oe=>{const{transform:ne,d3Selection:we,d3Zoom:ke,translateExtent:Re,width:Te,height:rt}=E.getState();if(oe.sourceEvent.type!=="mousemove"||!we||!ke)return;const He=q.current*Math.max(1,ne[2])*(_?-1:1),tt={x:ne[0]-oe.sourceEvent.movementX*He,y:ne[1]-oe.sourceEvent.movementY*He},Ie=[[0,0],[Te,rt]],vt=sr.translate(tt.x,tt.y).scale(ne[2]),Ct=ke.constrain()(vt,Ie,Re);ke.transform(we,Ct)},Q=uE().on("zoom",w?me:null).on("zoom.wheel",N?Z:null);return ie.call(Q),()=>{ie.on("zoom",null)}}},[w,N,_,C]);const G=v?ie=>{const Z=hs(ie);v(ie,{x:Z[0],y:Z[1]})}:void 0,J=S?(ie,Z)=>{const me=E.getState().nodeInternals.get(Z);S(ie,me)}:void 0;return De.createElement(cg,{position:g,style:e,className:ha(["react-flow__minimap",t]),"data-testid":"rf__minimap"},De.createElement("svg",{width:P,height:X,viewBox:`${L} ${U} ${k} ${B}`,role:"img","aria-labelledby":R,ref:T,onClick:G},j&&De.createElement("title",{id:R},j),De.createElement(D8,{onClick:J,nodeColor:i,nodeStrokeColor:r,nodeBorderRadius:c,nodeClassName:l,nodeStrokeWidth:f,nodeComponent:m}),De.createElement("path",{className:"react-flow__minimap-mask",d:`M${L-D},${U-D}h${k+D*2}v${B+D*2}h${-k-D*2}z
        M${A.x},${A.y}h${A.width}v${A.height}h${-A.width}z`,fill:h,fillRule:"evenodd",stroke:p,strokeWidth:y,pointerEvents:"none"})))}sj.displayName="MiniMap";var $8=u.memo(sj);function F8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},De.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function U8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},De.createElement("path",{d:"M0 0h32v4.2H0z"}))}function B8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},De.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function q8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},De.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function H8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},De.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const Jo=({children:e,className:t,...r})=>De.createElement("button",{type:"button",className:ha(["react-flow__controls-button",t]),...r},e);Jo.displayName="ControlButton";const P8=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),rj=({style:e,showZoom:t=!0,showFitView:r=!0,showInteractive:i=!0,fitViewOptions:l,onZoomIn:c,onZoomOut:f,onFitView:m,onInteractiveChange:h,className:p,children:y,position:g="bottom-left"})=>{const v=aa(),[S,w]=u.useState(!1),{isInteractive:N,minZoomReached:j,maxZoomReached:_}=Ln(P8,ra),{zoomIn:C,zoomOut:O,fitView:E}=bg();if(u.useEffect(()=>{w(!0)},[]),!S)return null;const T=()=>{C(),c?.()},M=()=>{O(),f?.()},A=()=>{E(l),m?.()},z=()=>{v.setState({nodesDraggable:!N,nodesConnectable:!N,elementsSelectable:!N}),h?.(!N)};return De.createElement(cg,{className:ha(["react-flow__controls",p]),position:g,style:e,"data-testid":"rf__controls"},t&&De.createElement(De.Fragment,null,De.createElement(Jo,{onClick:T,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:_},De.createElement(F8,null)),De.createElement(Jo,{onClick:M,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:j},De.createElement(U8,null))),r&&De.createElement(Jo,{className:"react-flow__controls-fitview",onClick:A,title:"fit view","aria-label":"fit view"},De.createElement(B8,null)),i&&De.createElement(Jo,{className:"react-flow__controls-interactive",onClick:z,title:"toggle interactivity","aria-label":"toggle interactivity"},N?De.createElement(H8,null):De.createElement(q8,null)),y)};rj.displayName="Controls";var V8=u.memo(rj),gs;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(gs||(gs={}));function Y8({color:e,dimensions:t,lineWidth:r}){return De.createElement("path",{stroke:e,strokeWidth:r,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`})}function G8({color:e,radius:t}){return De.createElement("circle",{cx:t,cy:t,r:t,fill:e})}const X8={[gs.Dots]:"#91919a",[gs.Lines]:"#eee",[gs.Cross]:"#e2e2e2"},K8={[gs.Dots]:1,[gs.Lines]:1,[gs.Cross]:6},W8=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function ij({id:e,variant:t=gs.Dots,gap:r=20,size:i,lineWidth:l=1,offset:c=2,color:f,style:m,className:h}){const p=u.useRef(null),{transform:y,patternId:g}=Ln(W8,ra),v=f||X8[t],S=i||K8[t],w=t===gs.Dots,N=t===gs.Cross,j=Array.isArray(r)?r:[r,r],_=[j[0]*y[2]||1,j[1]*y[2]||1],C=S*y[2],O=N?[C,C]:_,E=w?[C/c,C/c]:[O[0]/c,O[1]/c];return De.createElement("svg",{className:ha(["react-flow__background",h]),style:{...m,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:p,"data-testid":"rf__background"},De.createElement("pattern",{id:g+e,x:y[0]%_[0],y:y[1]%_[1],width:_[0],height:_[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${E[0]},-${E[1]})`},w?De.createElement(G8,{color:v,radius:C/c}):De.createElement(Y8,{dimensions:O,color:v,lineWidth:l})),De.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${g+e})`}))}ij.displayName="Background";var Z8=u.memo(ij);const Q8=420,J8=520,ez=16,ld=(e,t,r)=>Math.min(Math.max(e,t),r),jw=e=>e?.type?.name||e?.typeName||"Entity";function tz({position:e,cluster:t,onClose:r,onAddToBoard:i,onReturnToGroup:l,onSetTargetEntity:c,onOpenEntityInfo:f,releasedEntityIds:m=[]}){const{label:h,relationshipType:p,entities:y=[],placedEntityIds:g=[],sourceId:v}=t||{},[S,w]=u.useState(null),[N,j]=u.useState(null),[_,C]=u.useState({x:e?.x??100,y:e?.y??100}),O=u.useRef(null),E=u.useRef(null),T=u.useCallback(()=>{const U=S?.parentElement;if(U){const k=U.getBoundingClientRect();return{left:k.left,top:k.top,width:k.width,height:k.height}}return{left:0,top:0,width:window.innerWidth,height:window.innerHeight}},[S]),M=u.useMemo(()=>new Set((Array.isArray(g)?g:[]).map(String)),[g]),A=u.useMemo(()=>new Set((Array.isArray(m)?m:[]).map(String)),[m]),z=u.useMemo(()=>Array.isArray(y)?y.filter(U=>!A.has(String(U.id))):[],[y,A]),P=z.length,X=u.useMemo(()=>{const U=T(),k=O.current?.offsetWidth??Q8,B=O.current?.offsetHeight??Math.min(U.height*.7,J8),R=ez;return{minX:R,minY:R,maxX:Math.max(R,U.width-k-R),maxY:Math.max(R,U.height-B-R),containerRect:U,entityCount:P}},[P,T]);u.useEffect(()=>{const U=document.querySelector(".react-flow__renderer")||document.querySelector(".react-flow")||document.body,k=document.createElement("div");return k.style.position=U===document.body?"fixed":"absolute",k.style.top="0",k.style.left="0",k.style.right="0",k.style.bottom="0",k.style.zIndex="2500",k.style.pointerEvents="auto",U.appendChild(k),w(k),()=>U.removeChild(k)},[]),u.useEffect(()=>{C({x:ld(e?.x??100,X.minX,X.maxX),y:ld(e?.y??100,X.minY,X.maxY)})},[X,e?.x,e?.y]);const H=u.useCallback(U=>{if(!E.current)return;const{offsetX:k,offsetY:B,bounds:R,containerRect:q}=E.current,G=ld(U.clientX-q.left-k,R.minX,R.maxX),J=ld(U.clientY-q.top-B,R.minY,R.maxY);C({x:G,y:J})},[]),Y=u.useCallback(()=>{E.current=null,window.removeEventListener("pointermove",H),window.removeEventListener("pointerup",Y),window.removeEventListener("pointercancel",Y)},[H]),V=U=>{if(U.button!==0||U.target.closest("button")||U.target.closest(".cluster-popup-entity"))return;U.preventDefault(),U.stopPropagation();const k=X,B=k.containerRect||T(),R=U.clientX-B.left-(_?.x??k.minX),q=U.clientY-B.top-(_?.y??k.minY);E.current={offsetX:R,offsetY:q,bounds:k,containerRect:B},window.addEventListener("pointermove",H),window.addEventListener("pointerup",Y),window.addEventListener("pointercancel",Y)};u.useEffect(()=>()=>Y(),[Y]);const I=u.useCallback(()=>{Y(),r?.()},[Y,r]);u.useEffect(()=>{const U=k=>k.key==="Escape"&&I();return document.addEventListener("keydown",U),()=>document.removeEventListener("keydown",U)},[I]),u.useEffect(()=>{j(null)},[t?.id]);const F=u.useCallback((U,k)=>{k||j(B=>B===U?null:U)},[]),D=u.useCallback(U=>{U&&(A.has(String(U))||(i?.(t,U),j(null)))},[t,i,A]),L=u.useCallback(U=>{U&&(l?.(t,U),j(null))},[t,l]);return S?p1.createPortal(a.jsx("div",{className:"cluster-popup-overlay",children:a.jsxs("div",{ref:O,className:"cluster-popup-panel",style:{top:`${_?.y??100}px`,left:`${_?.x??100}px`},children:[a.jsxs("div",{className:"cluster-popup-header",onPointerDown:V,children:[a.jsxs("div",{className:"cluster-popup-title",children:[a.jsx("div",{className:"cluster-popup-relationship",children:p||"Cluster"}),a.jsx("div",{className:"cluster-popup-label",children:h||"Entities"})]}),a.jsx("button",{onClick:I,className:"cluster-popup-close","aria-label":"Close cluster",children:a.jsx("span",{"aria-hidden":"true",children:""})})]}),a.jsx("div",{className:"cluster-popup-instructions",children:"Use the action icons to set a relationship target, open entity details, or add and manage entities on the board."}),a.jsx("div",{className:"cluster-popup-entities",children:z.length?z.map(U=>{const k=String(U.id),B=M.has(k)||A.has(k),R=N===k,q=v!=null&&k===String(v);return a.jsxs("div",{className:`cluster-popup-entity ${B?"is-placed":""} ${R?"is-selected":""}`,title:U.name||`Entity ${U.id}`,onClick:()=>F(k,B),children:[a.jsx("div",{className:"cluster-popup-entity-header",children:a.jsx("div",{className:"cluster-popup-entity-name",children:U.name||`Entity ${U.id}`})}),a.jsx("div",{className:"cluster-popup-entity-meta",title:jw(U),children:jw(U)}),a.jsxs("div",{className:"cluster-popup-entity-actions",role:"group","aria-label":"Entity actions",children:[B?a.jsx("button",{type:"button",className:"cluster-popup-entity-action",onClick:G=>{G.stopPropagation(),L(U)},onPointerDown:G=>G.stopPropagation(),"aria-label":"Recall entity to cluster",title:"Recall to cluster",disabled:!l,children:a.jsx(zl,{size:16,"aria-hidden":"true"})}):a.jsx("button",{type:"button",className:"cluster-popup-entity-action is-primary",onClick:G=>{G.stopPropagation(),D(k)},onPointerDown:G=>G.stopPropagation(),"aria-label":"Add entity to board",title:"Add to board",disabled:!i,children:a.jsx(Va,{size:16,"aria-hidden":"true"})}),a.jsx("button",{type:"button",className:"cluster-popup-entity-action",onClick:G=>{G.stopPropagation(),f?.(k)},onPointerDown:G=>G.stopPropagation(),"aria-label":"Open entity details",title:"Open details",disabled:!f,children:a.jsx(v1,{size:16,"aria-hidden":"true"})}),!q&&a.jsx("button",{type:"button",className:"cluster-popup-entity-action",onClick:G=>{G.stopPropagation(),c?.(k)},onPointerDown:G=>G.stopPropagation(),"aria-label":"Use as relationship source",title:"Set as source",disabled:!c,children:a.jsx(zy,{size:16,"aria-hidden":"true"})})]})]},U.id)}):a.jsx("div",{className:"cluster-popup-empty",children:"No entities in this cluster."})})]})}),S):null}function nz({id:e,data:t}){const[r,i]=u.useState(!1),[l,c]=u.useState({x:0,y:0}),[f,m]=u.useState([]);u.useEffect(()=>{const j=t?.containedIds||t?.data?.containedIds||[],_=t?.allNodes||t?.data?.allNodes||[];if(j.length&&_.length){const C=_.filter(O=>j.includes(O.id));m(C)}else m([])},[t]);const h=j=>{j.stopPropagation();const C=(document.querySelector(".react-flow__renderer")||document.querySelector(".react-flow"))?.getBoundingClientRect(),O=C?.width??window.innerWidth,E=C?.height??window.innerHeight,T=420,M=Math.min(E*.7,520),A=16,z=j.clientX-(C?.left??0),P=j.clientY-(C?.top??0);let X=z+A,H=P-M/2;const Y=O-T-A,V=A;X>Y&&(X=Math.max(V,z-T-A)),X=Math.max(V,Math.min(X,Y));const I=E-M-A,F=A;H<F?H=F:H>I&&(H=I),c({x:X,y:H}),i(!0)},p=()=>i(!1),y=u.useMemo(()=>new Set((t?.placedEntityIds||[]).map(j=>String(j))),[t?.placedEntityIds]),g=f.length,v=t?.count??g+y.size,S=g,w=v?`contains ${S} of ${v}`:"contains 0 of 0",N=t?.relationshipType||t?.label||"Cluster";return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"cluster-node",onClick:h,children:[a.jsx(Xr,{id:"top",type:"target",position:Ut.Top,style:{width:12,height:12,background:"#fcd34d",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(120, 53, 15, 0.2)"}}),a.jsx("div",{className:"cluster-node__header",children:a.jsx("div",{className:"cluster-node__badge",children:S})}),a.jsx("div",{className:"cluster-node__label",children:N}),a.jsx("div",{className:"cluster-node__count",children:w}),a.jsx(Xr,{id:"bottom",type:"source",position:Ut.Bottom,style:{width:12,height:12,background:"#fcd34d",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(120, 53, 15, 0.2)"}})]}),r&&a.jsx(tz,{position:l,cluster:{id:e,label:t?.label,entities:f,relationshipType:t?.relationshipType,sourceId:t?.sourceId,placedEntityIds:t?.placedEntityIds||[]},onClose:p,onAddToBoard:t?.onAddToBoard,onReturnToGroup:t?.onReturnToGroup,onSetTargetEntity:t?.onSetTargetEntity,onOpenEntityInfo:t?.onOpenEntityInfo,releasedEntityIds:t?.manuallyReleasedIds||[]})]})}function az({data:e}){const t=!!e?.isCenter,r=e?.label||"Entity",i=e?.typeName||"Entity",l=e?.style||{},c=e?.entityId||e?.id,f=e?.imageUrl||Ul(e?.entity),m=p=>{p?.preventDefault(),p?.stopPropagation(),!(!e?.onSetTarget||!c||t)&&e.onSetTarget(String(c))},h=p=>{p?.preventDefault(),p?.stopPropagation(),!(!e?.onOpenInfo||!c)&&e.onOpenInfo(String(c))};return a.jsxs("div",{className:`entity-node ${t?"entity-node--center":"entity-node--standard"}`,style:{...l},children:[a.jsx(Xr,{id:"top",type:"target",position:Ut.Top,style:{width:12,height:12,background:"#cbd5f5",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(15, 23, 42, 0.25)"}}),t&&a.jsx("span",{className:"entity-node__center-indicator"}),a.jsxs("div",{className:"entity-node__content",children:[a.jsxs("div",{className:"entity-node__row entity-node__row--title",children:[f?a.jsx("div",{className:"entity-node__avatar","aria-hidden":"true",children:a.jsx("img",{src:f,alt:"",loading:"lazy"})}):null,a.jsx("div",{className:"entity-node__label",title:r,children:r})]}),a.jsxs("div",{className:"entity-node__row entity-node__row--meta",children:[a.jsx("div",{className:`entity-node__type-pill ${t?"is-center":""}`,children:i}),a.jsxs("div",{className:"entity-node__actions","aria-hidden":!e?.onSetTarget&&!e?.onOpenInfo,children:[a.jsx("button",{type:"button",className:"entity-node__action",onClick:m,onPointerDown:p=>p.stopPropagation(),"aria-label":"Use as relationship source",disabled:t||!e?.onSetTarget,children:a.jsx(zy,{size:16,strokeWidth:2.25,absoluteStrokeWidth:!0,"aria-hidden":"true"})}),a.jsx("button",{type:"button",className:"entity-node__action",onClick:h,onPointerDown:p=>p.stopPropagation(),"aria-label":"Open entity in new window",disabled:!e?.onOpenInfo,children:a.jsx(Oy,{size:16,strokeWidth:2.25,absoluteStrokeWidth:!0,"aria-hidden":"true"})})]})]})]}),a.jsx(Xr,{id:"bottom",type:"source",position:Ut.Bottom,style:{width:12,height:12,background:"#cbd5f5",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(15, 23, 42, 0.25)"}})]})}const Mc=220,Ef=160,Kr=220,Sc=120,xg=40,lj=5,na="Related",sz=40,rz=120,_p=Math.max(Kr,Mc)+sz,oj=Sc+rz,Vd=Kr+xg,iz=Kr+40,yy=/(part of|owned by|managed by|works for|reports to|child of|belongs to|member of|subsidiary of|division of|child)/i,_w=/(owns|manages|contains|has member|employs|parent of|parent|oversees|supervises|leads)/i,cj=/(owns|contains|parent|manages|supervises|leads|employs|has member|has child)/i,lz=/(child of|belongs to|part of|owned by|managed by|reports to|works for)/i,oz=/\s*\(linked to source\)/gi;function xa(e,t){if(typeof e=="string"){const r=e.replace(oz,"").trim();if(r)return r}return t}function Tl(e){if(!e)return!1;const t=e?.type;return t==="cluster"||t==="clusterNode"}function cz(e){if(!e)return{width:Kr,height:Sc};const t=Number(e?.width),r=Number(e?.height),i=Number.isFinite(t)?t:Tl(e)?Mc:Kr,l=Number.isFinite(r)?r:Tl(e)?Ef:Sc;return{width:i,height:l}}function uz(e,t,r){if(!e||!t||!(r instanceof Map))return!1;let i=String(t);const l=String(e),c=new Set;for(;i&&!c.has(i);){if(c.add(i),i===l)return!0;const f=r.get(i)?.parentId;i=f!=null?String(f):null}return!1}function Cw(e){if(!e)return null;const t=String(e.id??"");if(!t)return null;const r=xa(e?.name,`Entity ${t}`),i=e?.type?.name||e?.typeName||"Entity";return{...e,id:t,name:r,typeName:i}}function dz(e,t){if(!e)return{parentId:null,childId:null};const r=e?.fromEntityId!=null?String(e.fromEntityId):null,i=e?.toEntityId!=null?String(e.toEntityId):null,l=e?.relationshipType;let c=r&&i?r:null,f=r&&i?i:null;const m=l&&typeof l=="object"?l:null,h=(...C)=>{for(const O of C)if(O!=null&&O!=="")return O;return null},p=h(m?.from_label,m?.fromLabel,m?.from_name,m?.fromName),y=h(m?.to_label,m?.toLabel,m?.to_name,m?.toName),g=C=>typeof C=="string"&&yy.test(C),v=C=>typeof C=="string"&&_w.test(C),S=g(p),w=g(y),N=v(p),j=v(y);w&&!S?(c=i,f=r):S&&!w?(c=r,f=i):N&&!j?(c=i,f=r):j&&!N&&(c=r,f=i);const _=(()=>{if(!l)return"";if(typeof l=="string")return l.toLowerCase();const C=l?.label||l?.name||l?.from_label||l?.to_label||"";return String(C).toLowerCase()})();if(r&&i&&_){const C=/(parent|owns|contains)/.test(_);if(/(child|belongs to|part of)/.test(_)&&!C){const E=c;c=f,f=E}}return!c&&!f&&r&&i&&_&&(yy.test(_)?(c=i,f=r):_w.test(_)&&(c=r,f=i)),{parentId:c,childId:f}}function uj(e,t){if(!e)return null;const r=e?.from_entity??e?.fromEntityId??e?.from??e?.source??e?.sourceId??null,i=e?.to_entity??e?.toEntityId??e?.to??e?.target??e?.targetId??null,l=r!=null?String(r):null,c=i!=null?String(i):null;if(!l||!c||l===c)return null;const f=e?.id!=null&&e.id!==""?String(e.id):`edge-${l}-${c}`,m=e?.relationshipType??e?.type??e?.data?.relationshipType??null,h={fromEntityId:l,toEntityId:c,relationshipType:m},{parentId:p,childId:y}=dz(h),g=m&&typeof m=="object"?{id:m?.id??null,name:m?.name||m?.label||m?.from_label||m?.to_label||null,label:m?.label??null,from_label:m?.from_label??null,to_label:m?.to_label??null}:m,v=(()=>{if(!g)return e?.label||e?.typeName||e?.data?.typeName||na;if(typeof g=="string")return g||na;const{from_label:j,to_label:_,label:C,name:O}=g;return t!=null&&String(t)===l?j||C||O||na:t!=null&&String(t)===c?_||C||O||na:C||O||j||_||na})(),S=String(v||na).trim()||na,w=!g||typeof g=="string"?(typeof g=="string"?g:null)||na:g?.name||g?.label||g?.from_label||g?.to_label||na,N=g&&typeof g=="object"?g?.id??null:null;return{id:f,source:p??l,target:y??c,parentId:p,childId:y,label:S,typeName:w??na,typeId:N??null,fromEntityId:l,toEntityId:c,relationshipType:g??null,relationshipLabel:S,raw:e}}function fz(e,t,r=lj,i=null,l=1){const c=[],f=new Map,m=[],h=new Set,p=i!=null?String(i):null;if(!Array.isArray(t)||!t.length)return{clusters:c,suppressedNodes:f,edges:t||[]};const y=new Map((Array.isArray(e)?e:[]).map(E=>[String(E?.id??""),E])),g=new Map;p&&g.set(p,0),y.forEach((E,T)=>{const M=typeof E?.data?.level=="number"?E.data.level:typeof E?.level=="number"?E.level:null;M!=null&&Number.isFinite(M)&&g.set(T,M)});const v=new Map,S=new Map;t.forEach(E=>{if(!E)return;const T=E.parentId||E.source||null,M=E.childId||E.target||null;if(!T||!M)return;const A=String(T),z=String(M),P=y.get(A)||e.find(H=>String(H?.id??"")===A);!P||P.inCluster||(y.get(z)||e.find(H=>String(H?.id??"")===z))?.inCluster||(v.has(A)||v.set(A,new Set),v.get(A).add(z),S.has(z)||S.set(z,new Set),S.get(z).add(A))});const w=new Map;if(p){w.set(p,{parentId:null});const E=new Set,T=[p];for(;T.length;){const M=T.pop();if(!M||E.has(M))continue;E.add(M),w.has(M)||w.set(M,{parentId:null});const A=S.get(M);if(A&&A.size){const[z]=Array.from(A),P=z!=null?String(z):null;if(P){const X=w.get(M)||{};X.parentId?w.set(M,{...X}):w.set(M,{...X,parentId:P}),A.forEach(H=>{const Y=H!=null?String(H):null;Y&&(w.has(Y)||w.set(Y,{parentId:null}),E.has(Y)||T.push(Y))})}}}}const N=new Set(g.keys());if(p){N.add(p);const E=S.get(p);E&&E.forEach(T=>{g.has(T)||g.set(T,0),N.add(T)})}const j=Array.from(N);for(;j.length;){const E=j.shift();if(!E)continue;const T=g.get(E);if(T==null||!Number.isFinite(T))continue;const M=v.get(E);M&&M.forEach(A=>{const z=T+1,P=g.get(A);(P==null||z<P)&&(g.set(A,z),j.push(A))})}const _=new Map;if(t.forEach(E=>{if(!E)return;const T=E.parentId||E.source||null,M=E.childId||E.target||null;if(!T||!M)return;const A=String(T),z=String(M);if(!A||!z||A===z)return;const P=y.get(A),X=y.get(z);if(P?.inCluster||X?.inCluster)return;const H=g.get(A)??0,Y=g.get(z)??H+1;if(H>=l||Y>l)return;const V=String(E.relationshipLabel||E.label||na).trim()||na,I=E.typeName&&String(E.typeName).trim()||(typeof E.relationshipType=="object"?String(E.relationshipType?.name||E.relationshipType?.label||E.relationshipType?.from_label||E.relationshipType?.to_label||"").trim():null)||null,F=E.typeId!=null?String(E.typeId):E.relationshipType&&typeof E.relationshipType=="object"&&E.relationshipType?.id!=null?String(E.relationshipType.id):null,D=I||F||"unknown-type",L=`${A}-${D}`;_.has(L)||_.set(L,{parentId:A,typeName:I,typeId:F,typeKey:D,relationshipLabel:V,childMap:new Map});const U=_.get(L);U.childMap.has(z)||U.childMap.set(z,[]),U.childMap.get(z).push(E)}),_.forEach(E=>{if(y.get(E.parentId)?.inCluster||e.find(F=>String(F?.id??"")===E.parentId)?.inCluster)return;const M=Array.from(E.childMap.keys()).filter(F=>!y.get(F)?.inCluster);if(M.length<r)return;const A=Nz(E.typeName||E.typeKey),z=`cluster-${E.parentId}-${A}`,P=g.get(E.parentId)??0,X=E.typeName||E.relationshipLabel||na,H=M.filter(F=>!y.get(F)?.inCluster);if(!H.length)return;const Y={id:z,parentId:E.parentId,relationshipType:X,typeName:E.typeName,typeId:E.typeId,containedIds:[...H],label:"",count:0,parentLevel:P},V=p&&Y.containedIds.length?Y.containedIds.filter(F=>uz(F,p,w)):[],I=new Set(V);V.length&&(Y.containedIds=Y.containedIds.filter(F=>!I.has(F)),V.forEach(F=>{const D=y.get(F)||null;D&&(D.isExpandedProtected=!0,D.inCluster&&(D.inCluster=!1));const L=e.find(U=>String(U?.id??"")===F);L&&L!==D&&(L.isExpandedProtected=!0,L.inCluster&&(L.inCluster=!1))})),Y.containedIds.length&&(Y.containedIds.forEach(F=>{const D=e.find(L=>String(L?.id??"")===F)||y.get(F);D&&(D.inCluster=!0)}),Y.count=Y.containedIds.length,Y.label=`${X} (${Y.count})`,c.push(Y),H.forEach(F=>{if(I.has(F))return;const D=y.get(F)||e.find(U=>String(U?.id??"")===F)||null;if(D?.isExpandedProtected){D.inCluster=!1;return}f.set(F,{clusterId:Y.id,parentId:E.parentId,relationshipType:X,typeName:E.typeName,typeId:E.typeId,entity:D}),D&&(D.inCluster=!0),(E.childMap.get(F)||[]).forEach(U=>h.add(U.id))}),m.push({id:`edge-${E.parentId}-${Y.id}`,source:E.parentId,target:Y.id,label:Y.label,parentId:E.parentId,childId:Y.id,relationshipLabel:X,relationshipType:X,typeName:E.typeName,typeId:E.typeId,isClusterEdge:!0}))}),!c.length)return{clusters:c,suppressedNodes:f,edges:t};const O=[...t.filter(E=>{if(!E||h.has(E.id))return!1;const T=String(E.target??E.childId??"");if(T&&f.has(T))return!1;const M=String(E.source??E.parentId??"");return!(M&&f.has(M))}),...m];return{clusters:c,suppressedNodes:f,edges:O}}function mz(e,{isCenter:t=!1}={}){const r=String(e.id),i=xa(e?.name,`Entity ${r}`),l=e?.typeName||"Entity",c=!!e?.isExpandedProtected,f=Ul(e);return{id:r,type:"entity",width:Kr,height:Sc,isExpandedProtected:c,position:{x:0,y:0},data:{label:i,typeName:l,entityId:r,isCenter:t,isExpandedProtected:c,imageUrl:f}}}function hz(e,t){const r=e.relationshipType||na,i=e.label||r,l=e.count??(Array.isArray(e.containedIds)?e.containedIds.length:0),c=typeof e.parentLevel=="number"&&Number.isFinite(e.parentLevel)?e.parentLevel:null;return{id:e.id,type:"cluster",width:Mc,height:Ef,position:{x:0,y:0},data:{label:i,relationshipType:r,containedIds:e.containedIds,count:l,sourceId:e.parentId,placedEntityIds:[],allNodes:t,parentLevel:c}}}function pz(e,t,r){const i=r!=null?String(r):null;t.forEach(l=>{if(!l)return;const c=String(l.id);e.has(c)||e.set(c,c===i?0:1)}),i&&e.set(i,0),e.forEach((l,c)=>{(typeof l!="number"||!Number.isFinite(l))&&e.set(c,c===i?0:1)})}function yz(e,t){let r=1/0;t.forEach(m=>{if(!m)return;const h=e.get(m.id);typeof h=="number"&&Number.isFinite(h)&&h<r&&(r=h)}),Number.isFinite(r)||(r=0);const i=new Map,l=new Map;t.forEach(m=>{if(!m)return;const p=(e.get(m.id)??0)-r;l.set(m.id,p),i.has(p)||i.set(p,[]),i.get(p).push(m)});const c=Array.from(i.keys()).sort((m,h)=>m-h),f=new Map;return c.forEach(m=>{const h=i.get(m)||[];h.sort((p,y)=>{const g=p?.data?.label||p.id,v=y?.data?.label||y.id;return g.localeCompare(v)}),f.set(m,h)}),{groups:f,visualLevels:l}}function gy(e){if(!e)return"";const t=typeof e?.data?.label=="string"?e.data.label.trim():"";if(t)return t;const r=typeof e?.name=="string"?e.name.trim():"";return r||(e?.id!=null?String(e.id):"")}function dj(e,t){const r=gy(e),i=gy(t);return r.localeCompare(i)}function gz(e,t,r,i={}){const{centerId:l=null}=i,c=l!=null?String(l):null,f=new Map;e.forEach(h=>{if(!h)return;const p=h?.parentId??h?.data?.parentId??h?.source??h?.data?.source??null,y=h?.childId??h?.data?.childId??h?.target??h?.data?.target??null,g=p!=null?String(p):null,v=y!=null?String(y):null;if(!g||!v||g===v)return;const S=fj(h),w=Sz(h),N=Si(S)||Si(w),j=!!S&&(xz(S)||cj.test(S)),_={parentId:g,relationshipKey:N,relationshipName:w,indicatesParental:j};f.has(v)||f.set(v,[]),f.get(v).push(_)});const m=new Map;return f.forEach((h,p)=>{let y=null,g=1/0,v="",S=null,w="",N="";h.forEach(j=>{if(!j)return;const _=j.parentId,C=t.get(_);if(typeof C!="number"||!Number.isFinite(C))return;const O=r.get(_),E=gy(O);if(y==null||C<g){y=_,g=C,v=E,S=j,w=Si(j?.relationshipKey),N=j?.relationshipName??"";return}if(C===g){const T=!!S?.indicatesParental;if(!!j?.indicatesParental&&!T){y=_,v=E,S=j,w=Si(j?.relationshipKey),N=j?.relationshipName??"";return}E.localeCompare(v)<0&&(y=_,v=E,S=j,w=Si(j?.relationshipKey),N=j?.relationshipName??"")}}),y!=null&&m.set(p,{parentId:y,relationshipKey:w,relationshipName:N,indicatesParental:!!S?.indicatesParental})}),r.forEach((h,p)=>{if(!h)return;const y=String(p);if(!y||m.has(y)||!Tl(h))return;const g=[h.parentId,h.data?.parentId,h.data?.sourceId,h.data?.source].map(w=>w!=null?String(w):null).filter(Boolean);let v=g.find(w=>r.has(w));!v&&g.length&&(v=g[0]);const S=t.get(y)??1/0;if(!v){const w=Array.isArray(h?.data?.containedIds)?h.data.containedIds.map(N=>N!=null?String(N):null).filter(N=>{if(!N||!r.has(N))return!1;const j=t.get(N);return typeof j=="number"&&Number.isFinite(j)&&j<S}):[];w.length&&(w.sort((N,j)=>{const _=t.get(N)??1/0,C=t.get(j)??1/0;return _===C?N.localeCompare(j):_-C}),v=w[0])}if(!v&&c&&r.has(c)&&(v=c===y?null:c),v){const w=[typeof h?.data?.relationshipType=="string"?h.data.relationshipType:null,typeof h?.relationshipType=="string"?h.relationshipType:null].filter(_=>typeof _=="string"&&_.trim()),N=w.length?w[0].trim():"",j=Si(N);m.set(y,{parentId:v,relationshipKey:j,relationshipName:N})}}),m}function by(e,t){if(!e||!t)return null;const r=e.get(t);return r?typeof r=="string"?{parentId:r,relationshipKey:"",relationshipName:""}:typeof r=="object"?{parentId:r?.parentId!=null?String(r.parentId):r?.sourceId!=null?String(r.sourceId):null,relationshipKey:Si(r?.relationshipKey),relationshipName:typeof r?.relationshipName=="string"?r.relationshipName:""}:null:null}function bz(e){return(t,r)=>{if(!t&&!r)return 0;if(!t)return 1;if(!r)return-1;const i=by(e,t.id),l=by(e,r.id),c=i?.relationshipKey||"",f=l?.relationshipKey||"";if(c&&f){const m=c.localeCompare(f);if(m!==0)return m}else{if(c)return-1;if(f)return 1}return dj(t,r)}}function vz(e,t=new Map){const r=new Map;let i=1/0;const l=0,c=Array.from(e.keys()).sort((y,g)=>y-g);c.forEach(y=>{const g=e.get(y)||[];if(!g.length)return;const v=new Map,S=[],w=new Set;g.forEach(E=>{const M=by(t,E.id)?.parentId??null,A=M?r.get(M):null;if(M&&A){v.has(M)||v.set(M,[]),v.get(M).push(E);return}S.push(E)});const N=[],j=bz(t);if(v.forEach((E,T)=>{const M=r.get(T);if(!M){E.forEach(z=>S.push(z));return}const A=[...E].sort(j);N.push({anchorX:M.x,nodes:A,parentId:T})}),S.length){const E=[...S].sort(dj);N.push({anchorX:null,nodes:E,parentId:null})}N.sort((E,T)=>E.anchorX!=null&&T.anchorX!=null?E.anchorX-T.anchorX:E.anchorX!=null?-1:T.anchorX!=null?1:0);let _=!1,C=-1/0,O=0;N.forEach(E=>{const T=(E.nodes.length-1)*_p;let M;E.anchorX!=null?M=E.anchorX-T/2:M=_&&Number.isFinite(C)?C+_p:-T/2;const A=l+y*oj,z=[];if(E.nodes.forEach((P,X)=>{const H=_p;let Y=M+X*H;E.anchorX==null&&_&&Number.isFinite(C)&&Y<=C&&(Y=C+H);let V=0,I=`${Math.round(Y*100)}`;for(;w.has(I)&&V<100;)Y+=H,V+=1,I=`${Math.round(Y*100)}`;w.add(I),z.push(Y),r.set(P.id,{x:Y,y:A,level:y,levelIndex:O}),O+=1,Y<i&&(i=Y),Y>C&&(C=Y)}),z.length){const P=Math.max(...z);P>C&&(C=P)}_=!0})});const f=[];c.forEach(y=>{(e.get(y)||[]).forEach(v=>{if(!v)return;const S=v?.id!=null?String(v.id):null;S&&r.has(S)&&f.push({id:S,node:v})})});const m=[];f.forEach(({id:y,node:g})=>{const v=r.get(y);if(!v)return;const{width:S,height:w}=cz(g),N=v.level??null,j={width:S,height:w,level:N,position:{...v}};!!(g?.data&&g.data.isUserPlaced||g?.isUserPlaced)||m.forEach(C=>{if(!(j.level!=null&&C.level!=null&&j.level===C.level||Math.abs(j.position.y-C.position.y)<Math.max(j.height,C.height,Sc)))return;const E=C.position.x+C.width,T=Math.max(C.position.x+iz,E+40);j.position.x<T&&(j.position.x=T)}),r.set(y,{...v,x:j.position.x}),m.push({id:y,width:j.width,height:j.height,level:j.level,position:{...j.position}})}),i=1/0,r.forEach(y=>{y.x<i&&(i=y.x)});const h=Number.isFinite(i)&&i<0?-i:0,p=new Map;return r.forEach((y,g)=>{p.set(g,{x:y.x+h,y:y.y,level:y.level,levelIndex:y.levelIndex})}),p}function xz(e){return e?yy.test(String(e)):!1}function fj(e){if(!e)return"";const t=e?.data?.relationshipType??e?.relationshipType??e?.label??e?.relationshipLabel??"";if(typeof t=="string")return t.toLowerCase();if(t&&typeof t=="object"){const r=t?.label??t?.name??t?.from_label??t?.to_label??"";if(typeof r=="string")return r.toLowerCase()}return""}function Sz(e){if(!e)return"";const t=e?.data?.relationshipType??e?.relationshipType??e?.label??e?.relationshipLabel??"";if(typeof t=="string")return t.trim();if(t&&typeof t=="object"){const r=t?.label??t?.name??t?.from_label??t?.to_label??"";if(typeof r=="string")return r.trim()}return""}function Si(e){if(typeof e=="string"){const t=e.trim();return t?t.toLowerCase():""}return""}function wz(e,t){const r=new Map;if(!e)return r;const i=String(e);r.set(i,0);const l=new Map,c=new Map;t.forEach(m=>{if(!m)return;const h=m?.parentId??m?.data?.parentId??m?.source??null,p=m?.childId??m?.data?.childId??m?.target??null,y=h!=null?String(h):null,g=p!=null?String(p):null;!y||!g||y===g||(l.has(y)||l.set(y,new Set),l.get(y).add(g),c.has(g)||c.set(g,new Set),c.get(g).add(y))});const f=[i];for(;f.length;){const m=f.shift();if(!m)continue;const h=r.get(m)??0,p=c.get(m);p&&p.forEach(g=>{const v=g!=null?String(g):null;if(!v)return;const S=h-1,w=r.get(v);(w==null||S<w)&&(r.set(v,S),f.push(v))});const y=l.get(m);y&&y.forEach(g=>{const v=g!=null?String(g):null;if(!v)return;const S=h+1,w=r.get(v);(w==null||S<w)&&(r.set(v,S),f.push(v))})}return r}function ec(e,t,r){const i=Array.isArray(e)?e.map(E=>({...E,id:String(E.id),data:{...E.data}})):[];if(!i.length)return e;const l=i.filter(E=>Tl(E)),c=i.filter(E=>!Tl(E)),f=c.filter(E=>!E.inCluster),m=f.length?f:c,h=new Map;m.forEach(E=>h.set(E.id,E)),l.forEach(E=>h.set(E.id,E));const p=Array.from(h.values());if(!p.length)return e;const y=r!=null?String(r):p[0]?.id??null;if(!y)return e;const g=new Set(p.map(E=>E.id)),S=(Array.isArray(t)?t.map((E,T)=>{if(!E)return null;const M=E?.source!=null?String(E.source):"",A=E?.target!=null?String(E.target):"";if(!M||!A||M===A)return null;const z=E?.data?.relationshipType||E?.data?.typeName||E?.label||"",P=E?.data?.parentId??E?.parentId??E?.data?.parent??null,X=E?.data?.childId??E?.childId??null,H=P!=null?String(P):null,Y=X!=null?String(X):null;return{id:E?.id!=null?String(E.id):`edge-${T}`,source:M,target:A,label:E?.label||z||na,data:{relationshipType:z||na,parentId:H,childId:Y},parentId:H,childId:Y}}).filter(Boolean):[]).map(E=>{if(!E)return null;const T={...E,data:{...E.data||{}}},M=T.source||"",A=T.target||"";if(!M||!A||M===A)return null;let z=T.parentId!=null?String(T.parentId):null,P=T.childId!=null?String(T.childId):null;if(!z||!P){let X=M,H=A;const Y=fj(T),V=Y&&cj.test(Y);if(Y&&lz.test(Y)&&!V){const F=X;X=H,H=F}z=z??X,P=P??H}return(!z||!P||z===P)&&(z=M,P=A),T.source=z,T.target=P,T.parentId=z,T.childId=P,T.data={...T.data,parentId:z,childId:P},T}).filter(Boolean).filter(E=>g.has(E.source)&&g.has(E.target)),w=wz(y,S);pz(w,p,y),p.forEach(E=>{if(!E||!Tl(E))return;const T=E.parentId??E.data?.parentId??E.data?.sourceId??E.data?.source??null;if(!T)return;const M=String(T),A=w.get(M)??0;w.set(E.id,A+1)});const{groups:N,visualLevels:j}=yz(w,p),_=new Map(p.map(E=>[E.id,E])),C=gz(S,w,_,{centerId:y}),O=vz(N,C);return i.map(E=>{const T=w.get(E.id)??0,M=j.get(E.id)??T,A={x:E?.position?.x??0,y:M*oj,level:M,levelIndex:E?.data?.levelIndex??0},z=O.get(E.id)||A;return{...E,position:{x:z.x,y:z.y},data:{...E.data,level:T,visualLevel:z.level??M,levelIndex:z.levelIndex}}})}function Nz(e){return String(e??"group").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function Ez(e){return Array.from(e.values()).map(t=>({id:t.id,name:t.name,typeName:t.typeName,isExpandedProtected:!!t.isExpandedProtected}))}function jz(e){const t=new Map;return Array.isArray(e)&&e.forEach(r=>{if(!r||r.isClusterEdge||r?.data?.isClusterEdge||r?.data?.isClusterChildEdge)return;const i=r?.parentId??r?.source??null,l=r?.childId??r?.target??null;if(i==null||l==null)return;const c=String(i),f=String(l);f&&(t.has(f)||t.set(f,new Set),t.get(f).add(c))}),t}function _z({centerId:e=null,parentLookup:t=new Map,suppressedIds:r=new Set,candidateIds:i=new Set,alwaysIncludeIds:l=new Set}){const c=new Map,f=e!=null?String(e):null,m=new Set(l instanceof Set?Array.from(l).map(String):Array.isArray(l)?l.map(p=>String(p)):[]);function h(p,y=new Set){const g=String(p);if(!g)return!1;if(c.has(g))return c.get(g);if(r.has(g)||!i.has(g)&&!m.has(g))return c.set(g,!1),!1;if(f&&g===f||m.has(g))return c.set(g,!0),!0;const v=t.get(g);if(!v||v.size===0)return c.set(g,!0),!0;if(y.has(g))return c.set(g,!1),!1;y.add(g);let S=!1;for(const w of v){const N=String(w);if(N&&!r.has(N)){if(!i.has(N)&&!m.has(N)){S=!0;continue}if(m.has(N)){S=!0;continue}h(N,y)&&(S=!0)}}return y.delete(g),S?(c.set(g,!0),!0):(c.set(g,!1),!1)}return h}function Cz(e,t,r=lj,i={}){const l=t!=null?String(t):null,c=Array.isArray(e?.nodes)?e.nodes:[],f=Array.isArray(e?.edges)?e.edges:[],m=new Map;if(c.forEach(Z=>{const me=Cw(Z);me&&m.set(me.id,me)}),!l)return{nodes:[],edges:[],suppressedNodes:new Map,clusters:[]};if(!m.has(l)){const Z=Cw(c[0]);Z?m.set(l,{...Z,id:l}):m.set(l,{id:l,name:`Entity ${l}`,typeName:"Entity"})}const h=f.map(Z=>uj(Z,l)).filter(Boolean),p=Array.from(m.values()),y=i?.alwaysIncludeIds,g=new Set(y instanceof Set?Array.from(y).map(String):Array.isArray(y)?y.map(Z=>String(Z)):y&&typeof y=="object"?Object.values(y).map(Z=>String(Z)):[]),{clusters:v,suppressedNodes:S,edges:w}=fz(p,h,r,l),N=Ez(m),j=S instanceof Map?S:new Map(Object.entries(S||{}).map(([Z,me])=>[String(Z),me])),_=new Map;j.forEach((Z,me)=>{const Q=String(me),oe=Z?.clusterId!=null?String(Z.clusterId):null,ne=Z?.parentId!=null?String(Z.parentId):null,we=Z?.relationshipType||na,ke=Z?.entity||m.get(Q)||null;_.set(Q,{clusterId:oe,parentId:ne,relationshipType:we,entity:ke?{...ke,id:Q,name:xa(ke?.name,`Entity ${Q}`),typeName:ke?.typeName||ke?.type?.name||"Entity",isExpandedProtected:!!ke?.isExpandedProtected}:null})}),g.forEach(Z=>{_.delete(String(Z))});const C=new Set(Array.from(_.keys())),O=(Array.isArray(v)?v:[]).map(Z=>hz(Z,N)),T=p.map(Z=>mz(Z,{isCenter:Z.id===l})).filter(Z=>!C.has(String(Z.id))),M=new Set(T.map(Z=>String(Z.id)));l!=null&&M.add(String(l)),g.forEach(Z=>{M.add(String(Z))});const A=jz(h),z=_z({centerId:l,parentLookup:A,suppressedIds:C,candidateIds:M,alwaysIncludeIds:g}),P=T.filter(Z=>z(String(Z.id))),X=new Set(P.map(Z=>String(Z.id))),Y=[...P.filter(Z=>{const me=String(Z.id);if(!me)return!1;const Q=A.get(me);if(!Q||!Q.size)return!0;for(const oe of Q){const ne=oe!=null?String(oe):"";if(ne&&X.has(ne))return!0}return!1}),...O],V=new Set(Y.map(Z=>String(Z.id))),I=h.filter(Z=>{if(!Z)return!1;const me=Z.parentId!=null?Z.parentId:Z.source!=null?Z.source:null;if(me==null)return!0;const Q=String(me);return!(!V.has(Q)||C.has(Q))}),D=(Array.isArray(w)&&w.length?w:I).filter(Z=>{if(!Z)return!1;if(Z.isClusterEdge)return!0;const me=Z.parentId!=null?Z.parentId:Z.source!=null?Z.source:null;if(me!=null){const ke=String(me);if(!V.has(ke)||C.has(ke))return!1}const Q=Z.source!=null?Z.source:Z.parentId!=null?Z.parentId:null,oe=Z.target!=null?Z.target:Z.childId!=null?Z.childId:null,ne=Q!=null?String(Q):"",we=oe!=null?String(oe):"";return!(ne&&C.has(ne)||we&&C.has(we))}),L=new Set;D.forEach(Z=>{const me=Z.source!=null?String(Z.source):Z.parentId!=null?String(Z.parentId):null,Q=Z.target!=null?String(Z.target):Z.childId!=null?String(Z.childId):null;me&&L.add(me),Q&&L.add(Q)}),l&&L.add(l);const U=Y.filter(Z=>L.has(String(Z.id))),k=new Set(l!=null?[String(l)]:[]);let B=!0;for(;B;){B=!1;for(const Z of D){if(!Z)continue;const me=Z.parentId!=null?Z.parentId:Z.source!=null?Z.source:null,Q=Z.childId!=null?Z.childId:Z.target!=null?Z.target:null,oe=me!=null?String(me):"",ne=Q!=null?String(Q):"",we=!!oe,ke=!!ne;we&&k.has(oe)&&ke&&!k.has(ne)&&(k.add(ne),B=!0),ke&&k.has(ne)&&we&&!k.has(oe)&&(k.add(oe),B=!0)}}const R=U.filter(Z=>k.has(String(Z.id))),G=D.filter(Z=>{const me=Z.parentId!=null?String(Z.parentId):String(Z.source??""),Q=Z.childId!=null?String(Z.childId):String(Z.target??"");return me&&Q&&k.has(me)&&k.has(Q)}).map(Z=>({id:Z.id,source:Z.source,target:Z.target,type:"smoothstep",animated:!Z.isClusterEdge,label:Z.label||Z.relationshipLabel||na,data:{relationshipType:Z.relationshipLabel||Z.label||na,parentId:Z.parentId??null,childId:Z.childId??null,isClusterEdge:!!Z.isClusterEdge},parentId:Z.parentId??null,childId:Z.childId??null,sourceHandle:"bottom",targetHandle:"top"})),J=ec(R,G,l),ie=J.filter(Z=>Z.type==="cluster");return{nodes:J,edges:G,suppressedNodes:_,clusters:ie}}function Az(e,t,r=[]){if(!e||!t)return null;const i=e?.position?.x??0,l=e?.position?.y??0,c=e?.width??Mc,f=e?.height??Ef,m=String(t.id),h=Ul(t),p=Array.isArray(r)?r.map(_=>String(_)):[],y=p.indexOf(m),g=Math.max(p.length-1,0)*Vd,v=i+c/2,S=v-g/2,w=Kr,N=y>=0?S+y*Vd-w/2:v-w/2,j=l+f+xg;return{id:m,type:"entity",position:{x:N,y:j},data:{label:xa(t.name,`Entity ${m}`),typeName:t?.type?.name||t?.typeName||"Entity",isCenter:!1,isAdHoc:!0,entityId:m,imageUrl:h}}}function od(e,t,r=[]){if(!t||!Array.isArray(r)||r.length===0)return e;const i=r.map(N=>String(N)),l=new Map(i.map((N,j)=>[N,j])),c=t?.position?.x??0,f=t?.position?.y??0,m=t?.width??Mc,h=t?.height??Ef,p=f+h+xg,y=(i.length-1)*Vd,v=c+m/2-y/2;let S=!1;const w=e.map(N=>{if(N.type!=="entity"||!N.data?.isAdHoc)return N;const j=l.get(String(N.id));if(j==null)return N;const _=N?.width??Kr,C=v+j*Vd-_/2,O=p;return N?.position?.x===C&&N?.position?.y===O?N:(S=!0,{...N,position:{x:C,y:O}})});return S?w:e}function Tz(e,t){return uj(e,t)}function mj({onRefocus:e,onZoomToFit:t,onAutoArrange:r,depth:i,onIncreaseDepth:l,onDecreaseDepth:c}){return a.jsxs("div",{className:"relationship-toolbar",role:"toolbar","aria-label":"Relationship viewer controls",children:[a.jsxs("div",{className:"relationship-toolbar__actions",children:[a.jsxs("button",{type:"button",className:"relationship-toolbar__button",onClick:e,children:[a.jsx(zy,{"aria-hidden":"true"}),a.jsx("span",{children:"Refocus"})]}),a.jsxs("button",{type:"button",className:"relationship-toolbar__button",onClick:t,children:[a.jsx(BT,{"aria-hidden":"true"}),a.jsx("span",{children:"Zoom to fit"})]}),a.jsxs("button",{type:"button",className:"relationship-toolbar__button",onClick:r,children:[a.jsx(MM,{"aria-hidden":"true"}),a.jsx("span",{children:"Auto arrange"})]})]}),a.jsxs("div",{className:"relationship-toolbar__levels","aria-label":"Relationship depth controls",children:[a.jsx("span",{className:"relationship-toolbar__levels-label",children:"Levels"}),a.jsxs("div",{className:"relationship-toolbar__levels-controls",children:[a.jsx("button",{type:"button",className:"relationship-toolbar__levels-button",onClick:l,disabled:i>=3,"aria-label":"Increase relationship depth",children:a.jsx(Va,{"aria-hidden":"true"})}),a.jsx("span",{className:"relationship-toolbar__levels-value","aria-live":"polite",children:i}),a.jsx("button",{type:"button",className:"relationship-toolbar__levels-button",onClick:c,disabled:i<=1,"aria-label":"Decrease relationship depth",children:a.jsx(N1,{"aria-hidden":"true"})})]})]})]})}mj.propTypes={onRefocus:rn.func.isRequired,onZoomToFit:rn.func.isRequired,onAutoArrange:rn.func.isRequired,depth:rn.number.isRequired,onIncreaseDepth:rn.func.isRequired,onDecreaseDepth:rn.func.isRequired};const Mz={cluster:nz,entity:az},Rz={},kz="Related";function Dz(e){const t=new Map;return Array.isArray(e)&&e.forEach(r=>{if(!r)return;const i=r?.parentId!=null?r.parentId:r?.source!=null?r.source:null,l=r?.childId!=null?r.childId:r?.target!=null?r.target:null;if(i==null||l==null)return;const c=String(i),f=String(l);!c||!f||c===f||(t.has(c)||t.set(c,[]),t.get(c).push(r))}),t}function Iz(e,t){const r=new Map;if(!e)return r;const i=String(e);if(!i)return r;r.set(i,0);const l=[i],c=new Set([i]);for(;l.length;){const f=l.shift();if(!f)continue;const m=r.get(f)??0,h=t.get(f);!h||!h.length||h.forEach(p=>{if(!p)return;const y=p?.childId!=null?p.childId:p?.target!=null?p.target:null,g=y!=null?String(y):null;!g||c.has(g)||g===f||(r.set(g,m+1),c.add(g),l.push(g))})}return r}function Lz(e){const t=new Map;return Array.isArray(e)&&e.forEach(r=>{if(!r)return;const i=r?.parentId!=null?r.parentId:r?.source!=null?r.source:null,l=r?.childId!=null?r.childId:r?.target!=null?r.target:null;if(i==null||l==null)return;const c=String(i),f=String(l);!c||!f||c===f||(t.has(f)||t.set(f,new Set),t.get(f).add(c))}),t}function Oz(e,t,r=null){const i=e!=null?String(e):null;if(!i)return new Set;const l=Lz(t);if(!l.size)return new Set;const c=new Set,f=[],m=new Map,h=l.get(i);for(h&&h.size&&h.forEach(p=>{const y=String(p);y&&(c.add(y),f.push(y),m.set(y,1))});f.length;){const p=f.shift();if(!p)continue;const y=m.get(p)??1;if(r!=null&&y>=r)continue;const g=l.get(p);!g||!g.size||g.forEach(v=>{const S=String(v);if(!S||S===p||c.has(S))return;const w=y+1;r!=null&&w>r||(c.add(S),m.set(S,w),f.push(S))})}return c}function Aw(e){if(!e)return null;const t=e?.parentId!=null?e.parentId:e?.source!=null?e.source:null,r=e?.childId!=null?e.childId:e?.target!=null?e.target:null,i=t!=null?String(t):null,l=r!=null?String(r):null;if(!i||!l||i===l)return null;const c=e?.relationshipLabel||e?.label||e?.typeName||kz;return{id:e?.id!=null&&e.id!==""?String(e.id):`edge-${i}-${l}`,source:i,target:l,type:"smoothstep",animated:!e?.isClusterEdge,label:c,data:{relationshipType:c,parentId:i,childId:l,isClusterEdge:!!e?.isClusterEdge},parentId:i,childId:l,sourceHandle:"bottom",targetHandle:"top"}}function zz(){const{entityId:e}=xs(),t=$n(),[r,i]=u.useState(!0),[l,c]=u.useState(null),[f,m]=u.useState([]),[h,p]=u.useState([]),[y,g]=u.useState({}),[v,S]=u.useState(null),[w,N]=u.useState(1),[j,_]=u.useState(null),[C,O]=u.useState(null),[E,T]=u.useState(null),[M,A]=u.useState(!1),[z,P]=u.useState([]),[X,H]=u.useState([]),Y=u.useRef(new Map),V=u.useRef(new Map),I=u.useRef(new Map),F=u.useRef(new Set),D=u.useRef([]),L=u.useRef([]),U=u.useRef([]),k=u.useRef(new Map),B=u.useRef(new Set),R=u.useRef(null),q=u.useRef(new Map),G=u.useRef(new Map),J=u.useRef(null),ie=u.useCallback(W=>{if(!Array.isArray(W)||!W.length)return W;const ee=k.current;if(!(ee instanceof Map)||!ee.size)return W;let te=!1;const ve=W.map(le=>{if(!le||!(le.type==="entity"||le.type==="cluster"))return le;const Ee=ee.get(String(le.id));return Ee?(te=!0,{...le,position:{x:Ee.x,y:Ee.y},positionAbsolute:{x:Ee.x,y:Ee.y}}):le});return te?ve:W},[]);u.useEffect(()=>{D.current=f},[f]),u.useEffect(()=>{L.current=h},[h]),u.useEffect(()=>()=>{J.current!=null&&(clearTimeout(J.current),J.current=null)},[]),u.useEffect(()=>{const W=e!=null?String(e):null;if(W&&R.current!==W){R.current=W,k.current=new Map,B.current=new Set,g({});return}W||(R.current=null,k.current=new Map,B.current=new Set,g({}))},[e]),u.useEffect(()=>{if(!j){O(null),T(null),A(!1),P([]),H([]);return}let W=!1;return(async()=>{A(!0),T(null),O(null);try{const te=await rr(j);if(W)return;const ve=Pa(te);O(ve||null)}catch(te){if(W)return;console.error("Failed to load entity info:",te),O(null),T(te.message||"Failed to load entity info")}finally{W||A(!1)}})(),()=>{W=!0}},[j]);const Z=u.useMemo(()=>C&&(C.entity_type_id||C.entityType?.id||C.entity_type?.id)||null,[C]);u.useEffect(()=>{if(!Z){P([]),H([]);return}let W=!1;return(async()=>{try{const[te,ve]=await Promise.all([of(Z).catch(le=>(console.error(" Failed to load drawer field order",le),null)),cf(Z).catch(le=>(console.error(" Failed to load drawer field rules",le),null))]);if(W)return;P(Gr(te)),H(Gr(ve))}catch(te){if(W)return;console.error(" Failed to load drawer field layout",te),P([]),H([])}})(),()=>{W=!0}},[Z]);const me=u.useCallback(W=>m(ee=>qE(W,ee)),[]),Q=u.useCallback(W=>p(ee=>z6(W,ee)),[]),oe=u.useCallback(W=>{W&&t(`/entities/${W}/relationship-viewer`)},[t]),ne=u.useCallback(W=>{if(!W)return;const ee=String(W);_(te=>te===ee?te:ee)},[]),we=u.useCallback(()=>{_(null),O(null),T(null),A(!1)},[]),ke=u.useCallback(W=>{W&&F.current.delete(String(W))},[]),Re=u.useCallback(W=>{W&&F.current.add(String(W))},[]),Te=u.useCallback(W=>{if(!W)return new Map;const ee=String(W),te=Array.isArray(L.current)?L.current:[],ve=new Map,le=[ee],Se=new Set;for(;le.length;){const Ee=le.pop();!Ee||Se.has(Ee)||(Se.add(Ee),te.forEach(ge=>{if(!ge||ge?.data?.isClusterEdge||ge?.data?.isClusterChildEdge)return;const at=ge?.parentId??ge?.data?.parentId??ge?.source??null,st=ge?.childId??ge?.data?.childId??ge?.target??null;if(at==null||st==null)return;const nt=String(at);if(nt!==Ee)return;const $e=String(st);if(!(!$e||$e===ee)){if(!ve.has($e)){const ft=ge?.data?.relationshipType||ge?.relationshipLabel||ge?.label||"Related";ve.set($e,{parentId:nt,relationshipType:ft})}Se.has($e)||le.push($e)}}))}return ve},[]),rt=u.useCallback((W,ee)=>{if(W==null||ee==null)return;const te=String(W);if(!te)return;const ve=G.current instanceof Map?G.current:null;!ve||B.current.has(te)&&ve.has(te)||ve.set(te,ee)},[]),He=u.useCallback((W,ee)=>{if(!W)return;const te=String(typeof W=="string"?W:W?.id??W?.data?.id??W);if(!te)return;const ve=D.current.find(re=>String(re.id)===te&&re.type==="cluster");if(!ve)return;const le=B.current,Ee=U.current.find(re=>String(re.id)===te)||{id:te,relationshipType:ve?.data?.relationshipType||ve?.data?.label||"Related",label:ve?.data?.label||ve?.data?.relationshipType||"Related",containedIds:(ve?.data?.containedIds||[]).map(re=>String(re)).filter(re=>!le.has(re)),parentId:ve?.data?.sourceId!=null?String(ve.data.sourceId):null},ge=Y.current,at=I.current,st=V.current;if(!(ge instanceof Map)||!(at instanceof Map))return;const nt=ee??(typeof W=="object"&&W?.entityId!=null?W.entityId:null),$e=nt!=null?String(nt):null;if($e&&le.has($e))return;const ft=new Map;Array.isArray(D.current)&&D.current.forEach(re=>{if(!re||re.type&&re.type!=="entity")return;const Ne=String(re.id);Ne&&ft.set(Ne,re)}),at instanceof Map&&at.forEach((re,Ne)=>{if(!re)return;const Be=String(Ne);Be&&ft.set(Be,re)}),(Array.isArray(ve?.data?.allNodes)?ve.data.allNodes:[]).forEach(re=>{if(!re||re?.type&&re.type!=="entity")return;const Ne=re?.id!=null?String(re.id):null;if(!Ne||ft.has(Ne))return;const Be=re?.data||{},Ke=Be?.label||re?.name||Be?.name||`Entity ${Ne}`,ot={id:Ne,type:re?.type||"entity",position:re?.position||{x:0,y:0},data:{...Be,label:xa(Ke,`Entity ${Ne}`),typeName:Be?.typeName||Be?.type?.name||re?.typeName||re?.type&&re?.type.name||"Entity",entityId:Be?.entityId!=null?String(Be.entityId):Ne,isAdHoc:Be?.isAdHoc!=null?!!Be.isAdHoc:!0,isExpandedProtected:!!Be?.isExpandedProtected}};ft.set(Ne,ot)});let Rt=$e?[$e].filter(re=>ge.has(re)):[];if(Rt.length===0&&$e&&(Rt=[String($e)]),!Rt.length)if($e){const re=String($e);ge.delete(re),at.delete(re),st instanceof Map&&st.delete(re),B.current.add(re)}else{ke(te);return}const pt=Rt.map(re=>{const Ne=String(re);return{id:Ne,definition:at.get(Ne)||ft.get(Ne)||null,meta:st.get(Ne)||ge.get(Ne)||null}}).filter(re=>{if(!re?.definition)return!1;const Ne=re?.id!=null?String(re.id):null;return Ne?!le.has(Ne):!1});if(!pt.length){$e||ke(te);return}const ct=Ee.parentId!=null?String(Ee.parentId):null,yt=new Set(D.current.map(re=>String(re.id))),Mt=pt.filter(({id:re,meta:Ne})=>{const Be=re!=null?String(re):null;if(Be&&le.has(Be))return!1;const Ke=Ne?.parentId!=null?String(Ne.parentId):ct;return ct&&Ke!==ct?!1:Ke?ge.has(Ke)?!1:yt.has(Ke):!0});if(!Mt.length)return;Mt.forEach(({id:re})=>{const Ne=String(re);Ne&&le.add(Ne)});const Ft=Ee.relationshipType||Ee.label||"Related",kt=[...L.current];Mt.forEach(({id:re})=>{ge.delete(String(re))});const Zt=[],Lt=[],Kt=q.current instanceof Map?q.current:new Map,se=G.current instanceof Map?G.current:new Map,be=Number.isFinite(Number(w))?Number(w):null;if(Kt.size){const re=V.current instanceof Map?V.current:new Map,Ne=new Set(Array.isArray(D.current)?D.current.map(qe=>String(qe.id)):[]),Be=new Set,Ke=new Set;Mt.forEach(({id:qe})=>{if(!qe)return;const Ge=String(qe);Ne.add(Ge),Be.add(Ge)});const ot=Mt.map(({id:qe})=>String(qe)),ze=new Set,ue=new Set;for(;ot.length;){const qe=ot.shift();if(!qe||ze.has(qe))continue;ze.add(qe);const Ge=se.get(qe)??0;if(be!=null&&Ge!=null&&Ge>=be)continue;const ut=Kt.get(qe);!ut||!ut.length||ut.forEach(ae=>{if(!ae)return;const Xe=ae?.childId!=null?ae.childId:ae?.target!=null?ae.target:null,Fe=Xe!=null?String(Xe):null;if(!Fe||Fe===qe)return;const Qe=Ge+1;if(be!=null&&Number.isFinite(be)&&Qe>be)return;if(Ne.has(Fe))rt(Fe,Qe),Be.has(Fe)&&ot.push(Fe);else if(!Ke.has(Fe)){let St=null;if(ge.has(Fe)){const _e=at.get(Fe);if(!_e)return;ge.delete(Fe),at.delete(Fe),re.delete(Fe),le.add(Fe),St=_e}else{const _e=ft.get(Fe);if(!_e)return;const et=_e?.data?.label||_e?.data?.name||`Entity ${Fe}`;St={..._e,id:String(Fe),type:_e.type||"entity",position:_e.position||{x:0,y:0},data:{..._e?.data,label:xa(et,`Entity ${Fe}`),typeName:_e?.data?.typeName||_e?.data?.type?.name||"Entity",entityId:_e?.data?.entityId!=null?String(_e.data.entityId):String(Fe),isAdHoc:_e?.data?.isAdHoc!=null?!!_e.data.isAdHoc:!0,isExpandedProtected:!!_e?.data?.isExpandedProtected}}}St&&(Zt.push({id:Fe,definition:St}),Ke.add(Fe),Ne.add(Fe),Be.add(Fe),ot.push(Fe),rt(Fe,Qe),ft.set(Fe,St))}rt(Fe,Qe);const bt=Aw(ae);bt&&!ue.has(bt.id)&&(ue.add(bt.id),Lt.push(bt))})}if(Lt.length){const qe=new Set(kt.map(Ge=>Ge.id));Lt.forEach(Ge=>{!Ge||qe.has(Ge.id)||(qe.add(Ge.id),kt.push(Ge))})}}const je=Ee.containedIds.filter(re=>{const Ne=String(re);return le.has(Ne)?!1:ge.has(Ne)});g(re=>{const Ne={...re};let Be=!1;return Mt.forEach(({id:Ke})=>{Ne[Ke]||(Ne[Ke]={clusterId:Ee.id,relationshipType:Ee.relationshipType||null,sourceId:Ee.parentId||null},Be=!0)}),Be?Ne:re}),Lt.length&&p(re=>{const Ne=new Set(re.map(Ke=>Ke.id)),Be=Lt.filter(Ke=>!Ne.has(Ke.id));return Be.length?[...re,...Be]:re}),m(re=>{const Ne=re.find(ae=>String(ae.id)===te&&ae.type==="cluster");if(!Ne)return re;const Be=new Set(re.map(ae=>String(ae.id)));let Ke=re,ot=!1;const ze=new Set((Ne.data?.placedEntityIds||[]).map(ae=>String(ae)));Mt.forEach(({id:ae,definition:Xe,meta:Fe})=>{const Qe=String(ae);if(ze.add(Qe),Be.has(Qe))return;const bt=Fe?.entity||{id:ae,name:Xe?.data?.label||`Entity ${ae}`,typeName:Xe?.data?.typeName||Xe?.data?.type?.name||"Entity",isExpandedProtected:!!Xe?.data?.isExpandedProtected},St=Az(Ne,bt,Array.from(ze))||Xe;if(!St)return;const _e=xa(St.data?.label,`Entity ${ae}`),et=xa(bt?.name,_e),mt={...St,id:String(ae),type:"entity",data:{...St.data,label:et,typeName:bt?.typeName||St.data?.typeName||"Entity",entityId:String(ae),isAdHoc:!0,onSetTarget:oe,onOpenInfo:ne,isExpandedProtected:!!bt?.isExpandedProtected}};Be.add(Qe),ot=!0,Ke=[...Ke,mt];const fe=`cluster-context-${te}-${Qe}`;if(!L.current.find(Ve=>Ve.id===fe)){const Ve={id:fe,source:te,target:Qe,type:"smoothstep",animated:!1,label:"",style:{stroke:"#bbb",strokeDasharray:"4 2"},data:{isClusterContext:!0,parentId:te,childId:Qe},sourceHandle:"bottom",targetHandle:"top"};L.current.push(Ve),p(xt=>[...xt,Ve])}}),Zt.forEach(({id:ae,definition:Xe})=>{if(!ae||Be.has(String(ae)))return;const Fe={...Xe,id:String(ae),type:"entity",data:{...Xe?.data,label:Xe?.data?.label||Xe?.data?.name||`Entity ${ae}`,typeName:Xe?.data?.typeName||Xe?.data?.type?.name||"Entity",entityId:String(ae),isAdHoc:!0,onSetTarget:oe,onOpenInfo:ne,isExpandedProtected:!!Xe?.data?.isExpandedProtected}};Be.add(String(ae)),ot=!0,Ke=[...Ke,Fe]});const ue=Array.from(ze),qe=`${Ft} (${je.length})`;let Ge=Ke.map(ae=>String(ae.id)!==te||ae.type!=="cluster"?ae:{...ae,data:{...ae.data,placedEntityIds:ue,manuallyReleasedIds:ue,label:qe}});const ut=Ge.find(ae=>String(ae.id)===te&&ae.type==="cluster")||Ne;return Ge=od(Ge,ut,ue),!ot&&!re.some(Xe=>String(Xe.id)!==te||Xe.type!=="cluster"?!1:Xe.data?.label!==qe)?re:ie(ec(Ge,kt))});const We=`${Ft} (${je.length})`;Ee.label=We,U.current=U.current.map(re=>String(re.id)===te?{...re,label:We}:re);const dt=re=>{if(!Array.isArray(re)||!re.length)return[];const Ne=q.current instanceof Map?q.current:new Map,Be=G.current instanceof Map?G.current:new Map,Ke=B.current,ot=Y.current instanceof Map?Y.current:null,ze=I.current instanceof Map?I.current:null,ue=V.current instanceof Map?V.current:null;if(!ze)return[];const qe=Number.isFinite(Number(w))?Number(w):null,Ge=new Set(L.current.map(Qe=>String(Qe.id))),ut=[],ae=[],Xe=new Map,Fe=new Set;if(re.forEach(Qe=>{const bt=Qe!=null?String(Qe):null;if(!bt)return;const St=Ne.get(bt)||[],_e=Be.get(bt),et=Number.isFinite(_e)?_e+1:null;St.forEach(mt=>{if(!mt)return;const fe=mt?.childId!=null?mt.childId:mt?.target!=null?mt.target:null,he=fe!=null?String(fe):null;if(!he||he===bt||Ke.has(he))return;const Ve=Aw(mt);if(Ve&&!Ge.has(Ve.id)&&(Ge.add(Ve.id),ut.push(Ve)),!(qe==null||et!=null&&et<=qe)||!ze.has(he))return;const Nt=ze.get(he);if(!Nt)return;const Et=ue&&ue.get(he)||ot&&ot.get(he)||null;ze.delete(he),ot&&ot.delete(he),ue&&ue.delete(he);const jt=Ke.has(he);Ke.add(he),et!=null&&(!jt||!Be.has(he))&&rt(he,et);const Wt=Et?.entity||null,ln=xa(Nt?.data?.label,xa(Nt?.data?.name,`Entity ${he}`)),dn=xa(Wt?.name,ln),Qt={...Nt,id:he,type:"entity",data:{...Nt?.data,label:dn,typeName:Wt?.typeName||Nt?.data?.typeName||Nt?.data?.type?.name||"Entity",entityId:he,isAdHoc:!0,onSetTarget:oe,onOpenInfo:ne,isExpandedProtected:!!(Wt?.isExpandedProtected??Nt?.data?.isExpandedProtected)}};ae.push(Qt),Fe.add(he),Et?.clusterId&&Xe.set(he,{clusterId:String(Et.clusterId),relationshipType:Et?.relationshipType||null,sourceId:Et?.parentId!=null?String(Et.parentId):null})})}),ut.length){const Qe=ut.filter(Boolean);Qe.length&&(L.current=[...L.current,...Qe],p(bt=>[...bt,...Qe]))}return ae.length&&m(Qe=>{const bt=new Set(Qe.map(mt=>String(mt.id))),St=ae.filter(mt=>{const fe=mt?.id!=null?String(mt.id):null;return!fe||bt.has(fe)?!1:(bt.add(fe),!0)});if(!St.length)return Qe;const _e=[...Qe,...St],et=ec(_e,L.current);return ie(et)}),Xe.size&&g(Qe=>{const bt={...Qe};let St=!1;return Xe.forEach((_e,et)=>{const mt=bt[et];(!mt||mt.clusterId!==_e.clusterId||mt.relationshipType!==_e.relationshipType||mt.sourceId!==_e.sourceId)&&(bt[et]=_e,St=!0)}),St?bt:Qe}),Array.from(Fe)},gt=new Set,ce=[...Mt.map(({id:re})=>String(re)),...Zt.map(({id:re})=>String(re))].filter(Boolean);for(;ce.length;){const re=[];for(;ce.length;){const Be=ce.shift();!Be||gt.has(Be)||re.push(Be)}if(!re.length)break;const Ne=dt(re);re.forEach(Be=>gt.add(Be)),Ne.forEach(Be=>{gt.has(Be)||ce.push(Be)})}},[ie,ne,oe,rt,ke,w]),tt=u.useCallback((W,ee)=>{if(!W||!ee)return;const te=String(ee.id),ve=String(W.id);if(ee?.isExpandedProtected||D.current.some(ct=>String(ct?.id)===te&&ct?.data?.isExpandedProtected))return;const Se=new Map(D.current.map(ct=>[String(ct.id),ct])),Ee=Te(te),at=Array.from(Ee.entries()).map(([ct])=>String(ct)).filter(ct=>{if(ct===te)return!1;const yt=Se.get(ct);return!(!yt||yt?.data?.isExpandedProtected)}),st=new Set(at);B.current.delete(te),k.current.delete(te),at.forEach(ct=>{B.current.delete(String(ct)),k.current.delete(String(ct))}),g(ct=>{const yt={...ct};let Mt=!1;return yt[te]&&(delete yt[te],Mt=!0),at.forEach(Ft=>{yt[Ft]&&(delete yt[Ft],Mt=!0)}),Mt?yt:ct});let nt=[];m(ct=>{const yt=ct.find(Lt=>Lt.id===W.id);let Ft=ct.filter(Lt=>{const Kt=String(Lt.id);return Kt===te&&Lt.type==="entity"?!Lt.data?.isAdHoc:st.has(Kt)&&Lt.type==="entity"?!!Lt.data?.isExpandedProtected:!0}).map(Lt=>{if(Lt.id!==W.id||Lt.type!=="cluster")return Lt;const Kt=new Set((Lt.data?.placedEntityIds||[]).map(String));return Kt.has(te)?(Kt.delete(te),{...Lt,data:{...Lt.data,placedEntityIds:Array.from(Kt),manuallyReleasedIds:Array.from(Kt)}}):Lt});const kt=Ft.find(Lt=>Lt.id===W.id&&Lt.type==="cluster"),Zt=kt?.data?.placedEntityIds?.map(Lt=>String(Lt))||[];return nt=Zt,ie(od(Ft,kt||yt,Zt))}),p(ct=>{const yt=new Set([te,...at]);return ct.filter(Mt=>{const Ft=Mt?.source!=null?String(Mt.source):Mt?.parentId!=null?String(Mt.parentId):null,kt=Mt?.target!=null?String(Mt.target):Mt?.childId!=null?String(Mt.childId):null;return!(Ft&&yt.has(Ft)||kt&&yt.has(kt))})});const $e=W.relationshipType||W.label||"Related",ft=xa(ee?.name,`Entity ${te}`),zt={clusterId:ve,parentId:W.sourceId?String(W.sourceId):null,relationshipType:$e,entity:{id:te,name:ft,typeName:ee?.typeName||ee?.type?.name||"Entity",type:ee?.type}};Y.current.set(te,zt),V.current.set(te,zt),I.current.set(te,{id:te,type:"entity",position:{x:0,y:0},data:{label:ft,typeName:ee?.typeName||ee?.type?.name||"Entity",entityId:te,isAdHoc:!0,isExpandedProtected:!!ee?.isExpandedProtected}});const Rt=U.current.find(ct=>ct.id===ve);if(Rt){const ct=B.current,yt=W.containedIds.filter(Ft=>{const kt=String(Ft);return ct.has(kt)?!1:Y.current.has(kt)}),Mt=`${Rt.relationshipType||W.relationshipType||"Related"} (${yt.length})`;Rt.label=Mt,U.current=U.current.map(Ft=>Ft.id===ve?{...Ft,label:Mt}:Ft),m(Ft=>Ft.map(kt=>String(kt.id)!==ve||kt.type!=="cluster"?kt:{...kt,data:{...kt.data,label:Mt}}))}nt.length?ke(ve):Re(ve);const pt=Array.isArray(U.current)?U.current:[];at.forEach(ct=>{const yt=Se.get(ct);if(!yt)return;const Mt=Ee.get(ct)||{},Ft=Mt?.parentId!=null?String(Mt.parentId):null,kt=Mt?.relationshipType||"Related",Zt=pt.find(Kt=>{if(!Kt)return!1;const se=Kt?.parentId!=null?String(Kt.parentId):null;return se&&Ft&&se!==Ft?!1:Array.isArray(Kt?.containedIds)?Kt.containedIds.some(be=>String(be)===String(ct)):!1}),Lt={clusterId:Zt?String(Zt.id):null,parentId:Ft,relationshipType:kt,entity:{id:String(ct),name:yt?.data?.label||`Entity ${ct}`,typeName:yt?.data?.typeName||yt?.data?.type?.name||"Entity",type:yt?.data?.type||null,isExpandedProtected:!!yt?.data?.isExpandedProtected}};Y.current.set(String(ct),Lt),V.current.set(String(ct),Lt),I.current.set(String(ct),{id:String(ct),type:"entity",position:{x:0,y:0},data:{label:yt?.data?.label||`Entity ${ct}`,typeName:yt?.data?.typeName||yt?.data?.type?.name||"Entity",entityId:String(ct),isAdHoc:!0,isExpandedProtected:!!yt?.data?.isExpandedProtected}})})},[ie,Te,Re,ke]),Ie=u.useCallback(W=>{if(!W)return;const ee=String(typeof W=="string"?W:W?.id??W?.data?.id??W);if(!ee)return;const te=U.current.find(nt=>String(nt.id)===ee);if(!te)return;const ve=Y.current,le=V.current,Se=te.containedIds.filter(nt=>D.current.some($e=>String($e.id)===String(nt)));if(!Se.length){Re(ee);return}Se.forEach(nt=>{const $e=String(nt);B.current.delete($e),k.current.delete($e);const ft=D.current.find(Rt=>String(Rt.id)===$e);ft?.type==="entity"&&I.current.set($e,{id:$e,type:"entity",position:{x:0,y:0},data:{label:ft.data?.label||`Entity ${$e}`,typeName:ft.data?.typeName||"Entity",entityId:$e,isAdHoc:!0,isExpandedProtected:!!ft.data?.isExpandedProtected}});const zt=le.get($e)||{clusterId:ee,parentId:te.parentId||null,relationshipType:te.relationshipType||te.label||"Related",entity:ft?.data?{id:$e,name:ft.data?.label||`Entity ${$e}`,typeName:ft.data?.typeName||"Entity",isExpandedProtected:!!ft.data?.isExpandedProtected}:I.current.get($e)?.data?{id:$e,name:I.current.get($e)?.data?.label||`Entity ${$e}`,typeName:I.current.get($e)?.data?.typeName||"Entity",isExpandedProtected:!!I.current.get($e)?.data?.isExpandedProtected}:null};ve.set($e,zt),le.set($e,zt)});const Ee=L.current.filter(nt=>{const $e=String(nt.source),ft=String(nt.target);return!Se.includes($e)&&!Se.includes(ft)});p(Ee),g(nt=>{const $e={...nt};let ft=!1;return Se.forEach(zt=>{$e[zt]&&(delete $e[zt],ft=!0)}),ft?$e:nt});const ge=B.current,at=te.containedIds.filter(nt=>{const $e=String(nt);return ge.has($e)?!1:ve.has($e)}),st=`${te.relationshipType||te.label||"Related"} (${at.length})`;te.label=st,U.current=U.current.map(nt=>String(nt.id)===ee?{...nt,label:st}:nt),m(nt=>{const ft=nt.filter(zt=>!Se.includes(String(zt.id))).map(zt=>String(zt.id)!==ee||zt.type!=="cluster"?zt:{...zt,data:{...zt.data,placedEntityIds:te.containedIds.filter(Rt=>{const pt=String(Rt);return ge.has(pt)?!1:!ve.has(pt)}).map(Rt=>String(Rt)),manuallyReleasedIds:te.containedIds.filter(Rt=>{const pt=String(Rt);return ge.has(pt)?!1:!ve.has(pt)}).map(Rt=>String(Rt)),label:st}});return ie(ec(ft,Ee))}),Re(ee)},[ie,Re]),vt=u.useCallback((W,ee)=>{if(!ee||ee.type!=="entity"&&ee.type!=="cluster")return;const te=String(ee.id);if(k.current.set(te,{x:ee?.position?.x??0,y:ee?.position?.y??0}),ee.type!=="entity")return;const ve=te,le=y[ve];if(!le?.clusterId)return;const Se=document.querySelector(`[data-id="${le.clusterId}"]`),Ee=document.querySelector(`[data-id="${ve}"]`);if(!Se||!Ee)return;const ge=Se.getBoundingClientRect(),at=Ee.getBoundingClientRect(),st=at.left+at.width/2,nt=at.top+at.height/2;if(!(st>=ge.left&&st<=ge.right&&nt>=ge.top&&nt<=ge.bottom))return;const ft=f.find(zt=>zt.id===le.clusterId);ft&&(ee?.data?.isExpandedProtected||tt({id:ft.id,relationshipType:ft.data?.relationshipType,sourceId:ft.data?.sourceId,placedEntityIds:ft.data?.placedEntityIds||[]},{id:ve,name:ee?.data?.label,typeName:ee?.data?.typeName,isExpandedProtected:!!ee?.data?.isExpandedProtected}))},[y,tt,f]);u.useEffect(()=>{m(W=>{const ee=Object.entries(y).reduce((ve,[le,Se])=>{const Ee=Se?.clusterId;if(!Ee)return ve;const ge=String(Ee);return ve[ge]||(ve[ge]=[]),ve[ge].push(String(le)),ve},{});let te=W.map(ve=>{if(ve.type!=="cluster")return ve;const le=ee[ve.id]||[],Se=(ve.data?.placedEntityIds||[]).map(ge=>String(ge));return le.length!==Se.length||le.some((ge,at)=>ge!==Se[at])?{...ve,data:{...ve.data,placedEntityIds:le,manuallyReleasedIds:le}}:ve});for(const[ve,le]of Object.entries(ee)){const Se=te.find(Ee=>Ee.id===ve&&Ee.type==="cluster");Se&&(te=od(te,Se,le))}return ie(te)})},[ie,y]),u.useEffect(()=>{if(!e)return;let W=!0;async function ee(){i(!0),c(null);try{const te=Y.current instanceof Map?Array.from(Y.current.entries()):[],ve=new Map(te.map(([ct,yt])=>[String(ct),yt])),le=new Set(ve.keys()),Ee=await PR(e,w)??{};let ge=Array.isArray(Ee.edges)?Ee.edges:[];le.size&&Array.isArray(Ee.edges)&&(ge=Ee.edges.filter(ct=>{const yt=ct?.from_entity??ct?.fromEntityId??ct?.from??ct?.source??ct?.sourceId??null,Mt=ct?.to_entity??ct?.toEntityId??ct?.to??ct?.target??ct?.targetId??null,Ft=yt!=null?String(yt):null,kt=Mt!=null?String(Mt):null,Zt=Ft?le.has(Ft):!1,Lt=kt?le.has(kt):!1;return!Zt&&!Lt?!0:!(Zt&&Lt)}));const at=ge.map(ct=>Tz(ct,e)).filter(Boolean),st=Dz(at);q.current=st,G.current=Iz(e,st);const nt=Number.isFinite(Number(w))?Number(w):null,$e=Oz(e,at,nt),{nodes:ft,edges:zt,suppressedNodes:Rt,clusters:pt}=Cz({...Ee,edges:ge},e,void 0,{alwaysIncludeIds:$e});if(W){const ct=ze=>ze?ze.type==="cluster"?{...ze,data:{...ze.data,onAddToBoard:(ue,qe)=>He(ue,qe),onReturnToGroup:tt,onCollapseCluster:Ie,onSetTargetEntity:oe,onOpenEntityInfo:ne,placedEntityIds:[]}}:ze.type==="entity"?{...ze,data:{...ze.data,onSetTarget:oe,onOpenInfo:ne}}:{...ze}:null,yt=B.current,Mt=ft.map(ct),Ft=Object.entries(y).reduce((ze,[ue,qe])=>{const Ge=qe?.clusterId!=null?String(qe.clusterId):null;return Ge&&(ze.has(Ge)||ze.set(Ge,[]),ze.get(Ge).push(String(ue))),ze},new Map),kt=ze=>{const ue=Array.isArray(ze)?ze.map(qe=>String(qe)):[];return yt.size?ue.filter(qe=>!yt.has(qe)):ue},Zt=ze=>{if(!ze)return ze;const ue=ze?.id!=null?String(ze.id):null,qe=kt(ze?.data?.containedIds||[]),Ge=ue&&Ft.has(ue)?Ft.get(ue):[],ut=Array.isArray(Ge)?Ge.map(ae=>String(ae)):[];return{...ze,data:{...ze?.data,containedIds:qe,count:qe.length+ut.length,placedEntityIds:ut,manuallyReleasedIds:ut}}},Lt=Mt.map(ze=>ze?.type==="cluster"?Zt(ze):ze),Kt=new Map,se=Rt,be=(ze,ue)=>{if(yt.has(ze))return;const qe=xa(ue?.entity?.name,`Entity ${ze}`);Kt.set(ze,{clusterId:ue?.clusterId!=null?String(ue.clusterId):null,parentId:ue?.parentId!=null?String(ue.parentId):null,relationshipType:ue?.relationshipType||"Related",entity:ue?.entity?{...ue.entity,id:String(ue.entity.id??ze),name:qe,typeName:ue.entity?.typeName||ue.entity?.type?.name||"Entity",isExpandedProtected:!!ue.entity?.isExpandedProtected}:null})};se instanceof Map?se.forEach((ze,ue)=>{const qe=String(ue);be(qe,ze)}):Object.entries(se||{}).forEach(([ze,ue])=>{const qe=String(ze);be(qe,ue)}),Y.current=Kt,V.current=new Map(Kt);const je=new Map;se instanceof Map?se.forEach((ze,ue)=>{const qe=String(ue),Ge=ze?.entity||null,ut=xa(Ge?.name,`Entity ${qe}`);je.set(qe,{id:qe,type:"entity",position:{x:0,y:0},data:{label:ut,typeName:Ge?.typeName||Ge?.type?.name||"Entity",entityId:qe,isAdHoc:!0,isExpandedProtected:!!Ge?.isExpandedProtected}})}):Object.entries(se||{}).forEach(([ze,ue])=>{const qe=String(ze),Ge=ue?.entity||null,ut=xa(Ge?.name,`Entity ${qe}`);je.set(qe,{id:qe,type:"entity",position:{x:0,y:0},data:{label:ut,typeName:Ge?.typeName||Ge?.type?.name||"Entity",entityId:qe,isAdHoc:!0,isExpandedProtected:!!Ge?.isExpandedProtected}})}),I.current=je;const We=new Set,gt=(Array.isArray(pt)?pt:Lt.filter(ze=>ze.type==="cluster")).map(ze=>Zt(ze));gt.forEach(ze=>{We.add(String(ze.id))}),F.current=We;const ce=gt.map(ze=>({id:String(ze.id),relationshipType:ze?.data?.relationshipType||ze?.data?.label||"Related",label:ze?.data?.label||ze?.data?.relationshipType||"Related",containedIds:(ze?.data?.containedIds||[]).map(ue=>String(ue)),parentId:ze?.data?.sourceId!=null?String(ze.data.sourceId):null}));U.current=ce;const re=new Map(Array.isArray(D.current)?D.current.map(ze=>[String(ze.id),ze]):[]),Ne=[...Lt];yt.forEach(ze=>{const ue=String(ze);if(Ne.some(ut=>String(ut.id)===ue))return;const qe=re.get(ue);if(qe){Ne.push(qe);return}const Ge=je.get(ue);if(Ge){const ut=ct(Ge);ut&&Ne.push({...ut,id:ue,type:"entity"})}});const Be=new Set(Array.isArray(zt)?zt.map(ze=>ze.id):[]),Ke=(Array.isArray(L.current)?L.current:[]).filter(ze=>{if(!ze||Be.has(ze.id))return!1;const ue=ze?.data?.childId??ze?.target??ze?.data?.targetId??null,qe=ze?.data?.parentId??ze?.source??ze?.data?.sourceId??null,Ge=ue!=null?String(ue):null,ut=qe!=null?String(qe):null;return!!(Ge&&yt.has(Ge)||ut&&yt.has(ut))}),ot=Array.isArray(zt)?[...zt,...Ke]:Ke;m(ie(Ne)),p(ot)}}catch(te){W&&c(te.message||"Failed to load graph")}finally{W&&i(!1)}}return ee(),()=>{W=!1}},[ie,e,w,He,Ie,ne,tt,oe]);const Ct=u.useCallback(()=>{if(!v||!e)return;const W=String(e),ee=v.getNode(W);if(!ee)return;const te=ee.width??0,ve=ee.height??0,le=ee.position.x+te/2,Se=ee.position.y+ve/2;v.setCenter(le,Se,{zoom:Math.max(1,v.getZoom()),duration:500})},[e,v]),At=u.useCallback(()=>{!v||!f.length||v.fitView({padding:.2,duration:500})},[f.length,v]),_t=u.useCallback(()=>{e&&(m(W=>{if(!W?.length)return W;const ee=ec(W,h,e),te=new Map(ee.map(ge=>[String(ge.id),{...ge.position}])),ve=W.map(ge=>{const at=te.get(String(ge.id));return!at||ge?.position?.x===at.x&&ge?.position?.y===at.y?ge:{...ge,position:{...at}}}),le=Object.entries(y).reduce((ge,[at,st])=>{const nt=st?.clusterId;if(!nt)return ge;const $e=String(nt);return ge[$e]||(ge[$e]=[]),ge[$e].push(String(at)),ge},{});if(!Object.keys(le).length)return ve;let Se=ve.map(ge=>{if(ge.type!=="cluster")return ge;const at=le[ge.id]||[],st=(ge.data?.placedEntityIds||[]).map(String);return at.length!==st.length||at.some(($e,ft)=>$e!==st[ft])?{...ge,data:{...ge.data,placedEntityIds:at,manuallyReleasedIds:at}}:ge});for(const[ge,at]of Object.entries(le)){const st=Se.find(nt=>nt.id===ge&&nt.type==="cluster");st&&(Se=od(Se,st,at))}const Ee=k.current;return Ee instanceof Map&&Ee.size&&Se.forEach(ge=>{if(!ge||!(ge.type==="entity"||ge.type==="cluster"))return;const st=String(ge.id);Ee.has(st)&&Ee.set(st,{x:ge.position?.x??0,y:ge.position?.y??0})}),ie(Se)}),v&&requestAnimationFrame(()=>{v.fitView({padding:.2,duration:400})}))},[ie,y,h,e,v]),Pe=u.useCallback(()=>{N(W=>Math.min(3,W+1))},[]),Ze=u.useCallback(()=>{N(W=>Math.max(1,W-1))},[]);return r?a.jsx("p",{className:"p-4",children:"Loading graph..."}):l?a.jsxs("p",{className:"p-4 text-red-500",children:["Error: ",l]}):f.length?a.jsxs("div",{className:"flex flex-col h-screen w-full bg-gray-100",children:[a.jsx("header",{className:"p-4 border-b bg-white shadow-sm",children:a.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Relationship Explorer"})}),a.jsxs("div",{className:"flex-1 min-h-0 flex flex-col bg-slate-100",children:[a.jsx(mj,{onRefocus:Ct,onZoomToFit:At,onAutoArrange:_t,depth:w,onIncreaseDepth:Pe,onDecreaseDepth:Ze}),a.jsx("div",{className:"flex-1 min-h-0 relative",children:a.jsx("div",{className:"w-full h-full relative",style:{height:"calc(100vh - 80px)"},children:a.jsxs(nj,{nodes:f,edges:h,onNodesChange:me,onEdgesChange:Q,onNodeDragStop:vt,nodeTypes:Mz,edgeTypes:Rz,fitView:!0,onInit:S,children:[a.jsx($8,{}),a.jsx(V8,{}),a.jsx(Z8,{gap:16})]})})})]}),a.jsx(Ky,{entityId:j,entity:C,isLoading:M,error:E,onClose:we,fieldOrder:z,fieldRules:X})]}):a.jsx("p",{className:"p-4",children:"No relationships found for this entity."})}function Po({step:e,title:t,subtitle:r,children:i,disabled:l=!1}){return a.jsxs("section",{className:`step-card${l?" step-card--disabled":""}`,"aria-disabled":l,children:[a.jsxs("header",{className:"step-card__header",children:[a.jsx("span",{className:"step-card__badge",children:e}),a.jsxs("div",{children:[a.jsx("h3",{className:"step-card__title",children:t}),r&&a.jsx("p",{className:"step-card__subtitle",children:r})]})]}),a.jsx("div",{className:"step-card__body",children:i})]})}const Tw=["B","KB","MB","GB"];function $z(e){if(!Number.isFinite(e)||e<=0)return"0 B";const t=Math.min(Math.floor(Math.log(e)/Math.log(1024)),Tw.length-1),r=e/1024**t;return`${r.toFixed(r>=10||t===0?0:1)} ${Tw[t]}`}function Fz({files:e=[],selectedId:t,onSelect:r,onDelete:i}){return e.length?a.jsx("ul",{className:"uploaded-file-list",children:e.map(l=>{const c=l.id===t;return a.jsxs("li",{className:`uploaded-file-list__item${c?" is-selected":""}`,children:[a.jsxs("button",{type:"button",className:"uploaded-file-list__select",onClick:()=>r(c?null:l.id),children:[a.jsx(Fp,{size:16}),a.jsx("span",{className:"uploaded-file-list__name",children:l.file_name}),a.jsx("span",{className:"uploaded-file-list__meta",children:$z(l.size_bytes)})]}),a.jsx("button",{type:"button",className:"uploaded-file-list__delete",onClick:()=>i(l.id),"aria-label":`Delete ${l.file_name}`,children:a.jsx(ma,{size:16})})]},l.id)})}):a.jsx("p",{className:"uploaded-file-list__empty",children:"No files uploaded yet."})}function Uz({isOpen:e,onClose:t,preview:r,previewing:i,importing:l,onImport:c,error:f}){if(!e)return null;const m=!!(r&&!i&&!l);return a.jsxs("div",{className:"preview-popout",role:"dialog","aria-modal":"true",children:[a.jsx("div",{className:"preview-popout__overlay",onClick:t}),a.jsxs("div",{className:"preview-popout__panel",children:[a.jsxs("header",{className:"preview-popout__header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"Import Preview"}),a.jsx("p",{children:"Review the summary before running the upload."})]}),a.jsx("button",{type:"button",onClick:t,"aria-label":"Close preview",className:"preview-popout__close",children:a.jsx(ka,{size:20})})]}),a.jsxs("div",{className:"preview-popout__content",children:[i&&a.jsxs("div",{className:"preview-popout__state",children:[a.jsx(Nn,{className:"spin",size:28}),a.jsx("p",{children:"Generating preview"})]}),!i&&f&&a.jsxs("div",{className:"preview-popout__alert preview-popout__alert--error",children:[a.jsx(Ta,{size:18}),a.jsx("span",{children:f})]}),!i&&r&&a.jsxs("div",{className:"preview-popout__summary",children:[a.jsxs("div",{className:"preview-popout__summary-grid",children:[a.jsx(cd,{label:"Total rows",value:r.total}),a.jsx(cd,{label:"To create",value:r.createCount,tone:"success"}),a.jsx(cd,{label:"Duplicates",value:r.duplicateCount,tone:"warn"}),a.jsx(cd,{label:"Invalid",value:r.invalidCount,tone:"error"})]}),r.duplicateCount>0&&Array.isArray(r.duplicates)&&a.jsxs("div",{className:"preview-popout__list",children:[a.jsx("h3",{children:"Duplicate rows"}),a.jsx("ul",{children:r.duplicates.map(h=>a.jsxs("li",{children:[a.jsxs("span",{children:["Row ",h.row]}),a.jsx("span",{className:"preview-popout__list-name",children:h.name})]},h.row))})]}),r.invalidCount>0&&Array.isArray(r.invalidRows)&&a.jsxs("div",{className:"preview-popout__list",children:[a.jsx("h3",{children:"Invalid rows"}),a.jsx("ul",{children:r.invalidRows.map(h=>a.jsxs("li",{children:[a.jsxs("span",{children:["Row ",h.row]}),a.jsx("span",{className:"preview-popout__list-name",children:h.reason})]},h.row))})]})]})]}),a.jsxs("footer",{className:"preview-popout__footer",children:[a.jsx("button",{type:"button",className:"preview-popout__dismiss",onClick:t,children:"Cancel"}),a.jsxs("button",{type:"button",className:"preview-popout__confirm",disabled:!m,onClick:c,children:[l?a.jsx(Nn,{className:"spin",size:18}):a.jsx(fT,{size:18}),"Run upload"]})]})]})]})}function cd({label:e,value:t,tone:r}){return a.jsxs("div",{className:`summary-metric${r?` summary-metric--${r}`:""}`,children:[a.jsx("span",{className:"summary-metric__label",children:e}),a.jsx("span",{className:"summary-metric__value",children:t}),r==="success"&&a.jsx("span",{className:"summary-metric__icon",children:a.jsx(Zd,{size:18})}),r==="warn"&&a.jsx("span",{className:"summary-metric__icon",children:a.jsx(Ta,{size:18})}),r==="error"&&a.jsx("span",{className:"summary-metric__icon",children:a.jsx(Ta,{size:18})})]})}function Bz(){const{token:e}=En(),{activeWorldId:t,contextKey:r}=Bn(),i=t||"",[l,c]=u.useState(null),[f,m]=u.useState(!1),[h,p]=u.useState(""),[y,g]=u.useState(""),[v,S]=u.useState([]),[w,N]=u.useState([]),[j,_]=u.useState(""),[C,O]=u.useState(null),[E,T]=u.useState(!1),[M,A]=u.useState(!1),[z,P]=u.useState(!1),[X,H]=u.useState(null),[Y,V]=u.useState(!1),[I,F]=u.useState(""),D=u.useRef(null);u.useEffect(()=>{(async()=>{if(!i){N([]);return}T(!0);try{const Q=await V1(i),oe=Array.isArray(Q?.data)?Q.data:Array.isArray(Q)?Q:[];N(oe)}catch(Q){console.warn(" Failed to load entity types",Q),N([])}finally{T(!1)}})()},[i,r]);const L=async()=>{try{const me=await fetch("/api/entities/upload",{headers:{Authorization:`Bearer ${e}`}});if(!me.ok)throw new Error("Failed to fetch uploads");const Q=await me.json();S(Q.files||[])}catch(me){console.warn(" Could not fetch uploads",me)}};u.useEffect(()=>{e&&L()},[e]);const U=me=>{const Q=me.target.files?.[0]??null;c(Q),p(""),g("")},k=async()=>{if(!l)return g("Please select a file to upload.");const me=new FormData;me.append("file",l),m(!0),p(""),g("");try{const Q=await fetch("/api/entities/upload",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:me}),oe=await Q.json();if(!Q.ok)throw new Error(oe.message||"Upload failed");p("File uploaded successfully."),c(null),D.current&&(D.current.value=""),await L()}catch(Q){console.error("Upload error:",Q),g(Q.message)}finally{m(!1)}},B=async me=>{if(window.confirm("Delete this upload?"))try{const Q=await fetch(`/api/entities/upload/${me}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),oe=await Q.json();if(!Q.ok)throw new Error(oe.message||"Failed to delete file");p("File deleted."),C===me&&(O(null),H(null)),await L()}catch(Q){console.error(" Delete error:",Q),g(Q.message)}},R=async()=>{if(j){g(""),p("");try{const me=await fetch(`/api/entities/template/${j}`,{headers:{Authorization:`Bearer ${e}`}});if(!me.ok)throw new Error("Failed to generate template");const Q=await me.blob(),oe=window.URL.createObjectURL(Q),ne=document.createElement("a");ne.href=oe,ne.download="Entity_Template.xlsx",document.body.appendChild(ne),ne.click(),ne.remove(),window.URL.revokeObjectURL(oe),p("Template generated successfully.")}catch(me){console.error(" Template generation failed",me),g("Failed to generate template")}}},q=async()=>{if(!j)return g("Select an Entity Type first.");if(!C)return g("Select an uploaded file to preview.");if(!i)return g("Select a world context before previewing.");P(!0),V(!0),H(null),F(""),p(""),g("");try{const me=await fetch(`/api/entities/preview/${j}`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({fileId:C,worldId:i})}),Q=await me.json();if(!me.ok||!Q.success)throw new Error(Q.message||"Preview failed");H(Q.summary)}catch(me){console.error(" Preview failed:",me),F(me.message)}finally{P(!1)}},G=async()=>{if(!j)return g("Select an Entity Type first.");if(!C)return g("Select an uploaded file to import.");if(!i)return g("Select a world context before importing.");A(!0),p(""),g("");try{const me=await fetch(`/api/entities/import/${j}`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({fileId:C,worldId:i})}),Q=await me.json();if(!me.ok)throw new Error(Q.message||"Import failed");p(Q.message||"Import completed successfully."),V(!1),H(null),await L()}catch(me){console.error(" Import error:",me),F(me.message)}finally{A(!1)}},J=()=>{M||z||(V(!1),F(""))},ie=u.useMemo(()=>w.find(me=>String(me.id)===String(j))?.name??"",[w,j]),Z=u.useMemo(()=>v.find(me=>me.id===C)??null,[v,C]);return u.useEffect(()=>{O(null),H(null),V(!1),c(null),D.current&&(D.current.value=""),p(""),g(""),F("")},[j]),a.jsxs("div",{className:"bulk-upload-page",children:[a.jsxs("div",{className:"bulk-upload-page__header",children:[a.jsx("h1",{className:"bulk-upload-page__title",children:"Bulk Entity Upload"}),a.jsx("p",{className:"bulk-upload-page__subtitle",children:"Follow the guided steps to prepare your template, upload a data file, preview the import, and launch the upload from a dedicated review panel."})]}),h&&a.jsxs("div",{className:"bulk-upload-page__status",children:[a.jsx(Zd,{size:18}),a.jsx("span",{children:h})]}),y&&a.jsxs("div",{className:"bulk-upload-page__status bulk-upload-page__status--error",children:[a.jsx(Ta,{size:18}),a.jsx("span",{children:y})]}),a.jsxs("div",{className:"bulk-upload-page__grid",children:[a.jsx(Po,{step:"Select",title:"Choose an entity type",subtitle:E?"Loading entity types for this world...":"Pick which entity type you want to work with. Steps unlock after choosing.",children:a.jsxs("select",{value:j,onChange:me=>_(me.target.value),className:"entity-type-select",children:[a.jsx("option",{value:"",children:E?"Loading":"Select Entity Type"}),w.map(me=>a.jsx("option",{value:me.id,children:me.name},me.id))]})}),j&&a.jsxs(a.Fragment,{children:[a.jsx(Po,{step:1,title:"Generate a template",subtitle:"Download a spreadsheet tailored to the selected entity type.",children:a.jsxs("div",{className:"step-actions",children:[a.jsxs("button",{type:"button",className:"primary-action",onClick:R,children:[a.jsx(vT,{size:18}),"Download template"]}),ie&&a.jsxs("span",{className:"selected-file-banner",children:[a.jsx(Ii,{size:16})," Template matches ",ie]})]})}),a.jsxs(Po,{step:2,title:"Upload your file",subtitle:"Upload the filled spreadsheet and pick which file to preview.",children:[a.jsxs("div",{className:"file-input",children:[a.jsxs("label",{htmlFor:"bulk-upload-file",children:[a.jsx(R0,{size:20}),a.jsxs("div",{children:[a.jsx("div",{className:"file-input__name",children:l?l.name:"Select a file to upload"}),a.jsx("small",{children:"Supported format: Excel (.xlsx)"})]})]}),a.jsx("input",{ref:D,id:"bulk-upload-file",type:"file",hidden:!0,onChange:U}),a.jsxs("button",{type:"button",className:"secondary-action",onClick:k,disabled:!l||f,children:[f?a.jsx(Nn,{className:"spin",size:18}):a.jsx(R0,{size:18}),"Upload file"]})]}),Z&&a.jsxs("div",{className:"selected-file-banner",children:[a.jsx(wT,{size:16})," Selected file: ",Z.file_name]}),a.jsx(Fz,{files:v,selectedId:C,onSelect:me=>{O(me),H(null)},onDelete:B})]}),a.jsx(Po,{step:3,title:"Run a preview",subtitle:"Review potential changes in the popout before committing to an upload.",children:a.jsxs("div",{className:"step-actions",children:[a.jsxs("button",{type:"button",className:"primary-action",onClick:q,disabled:!C||z,children:[z?a.jsx(Nn,{className:"spin",size:18}):a.jsx(w1,{size:18}),"Preview import"]}),a.jsx("span",{className:"bulk-upload-page__empty-state",children:"The upload can only be launched from the preview popout."})]})}),a.jsx(Po,{step:4,title:"Launch the upload",subtitle:"Confirm the summary inside the popout, then run the upload from there.",children:a.jsxs("div",{className:"step-actions",children:[a.jsxs("span",{className:"bulk-upload-page__empty-state",children:["After reviewing the preview, use the ",a.jsx("strong",{children:"Run upload"})," button in the panel to finish."]}),a.jsxs("span",{className:"selected-file-banner",children:[a.jsx(g1,{size:16})," Preview popout controls the final import."]})]})})]})]}),a.jsx(Uz,{isOpen:Y,onClose:J,preview:X,previewing:z,importing:M,onImport:G,error:I})]})}function vy({content:e="",mentions:t=[],segments:r=null,noteId:i="note",textClassName:l="note-text",mentionClassName:c="note-mention",renderEmpty:f=null}){const m=u.useMemo(()=>Array.isArray(r)?r:fc(e,t),[e,t,r]);return!m||m.length===0?typeof f=="function"?f():null:m.map((h,p)=>{if(h.type==="mention"&&h.entityId){const y=h.entityName||"entity";return a.jsxs("span",{className:c,children:["@",y,a.jsx(Is,{entityId:h.entityId,entityName:y})]},`${i}-mention-${p}`)}return a.jsx("span",{className:l,children:h.text},`${i}-text-${p}`)})}const qz=2500,As=Object.freeze([]),Hz="Use @ to tag entities mentioned in this session.",Cp=(e="create")=>({mode:e,submitLabel:e==="edit"?"Save Changes":"Create Entity",submitDisabled:!1,cancelDisabled:!1,accessButtonVisible:!1,accessButtonDisabled:!1}),Ap=e=>{if(!e)return{id:"",sessionDate:"",sessionTitle:"Session note",content:"",mentions:As,createdAt:null,updatedAt:null,author:null,lastEditor:null};const t=e.sessionDate??e.session_date??"",r=e.sessionTitle??e.session_title??"Session note",i=typeof e.content=="string"?e.content:"",l=Array.isArray(e.mentions)?e.mentions.filter(Boolean).map(c=>{const f=c?.entityName??c?.entity_name??c?.label??c?.name??"",m=kl(f);return{...c,entityName:m}}):As;return{id:e.id??"",sessionDate:t,sessionTitle:r,content:i,mentions:l,createdAt:e.createdAt??e.created_at??null,updatedAt:e.updatedAt??e.updated_at??null,author:e.author??null,lastEditor:e.lastEditor??null}},ud=()=>new Date().toISOString().slice(0,10),dd=e=>{if(!e)return"Undated session";const t=/^\d{4}-\d{2}-\d{2}$/.test(e)?`${e}T00:00:00Z`:e,r=new Date(t);return Number.isNaN(r.getTime())?e:r.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},Pz=e=>{if(!e)return"";const t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};function Vz(){const{user:e}=En(),{selectedCampaign:t,selectedCampaignId:r}=Bn(),[i,l]=u.useState({items:As,loading:!1,error:""}),[c,f]=u.useState(""),[m,h]=u.useState(null),[p,y]=u.useState(!1),[g,v]=u.useState({status:"idle",lastSaved:"",error:""}),[S,w]=u.useState(""),[N,j]=u.useState(!1),[_,C]=u.useState(!1),[O,E]=u.useState(""),T=u.useRef(null),M=u.useRef(""),A=u.useRef(null),z=u.useRef(!1),P=u.useRef(""),[X,H]=u.useState(!1),[Y,V]=u.useState(()=>Cp("create")),[I,F]=u.useState("details"),D=u.useRef(`entity-form-${Math.random().toString(36).slice(2)}`),L=u.useMemo(()=>t?.world?.id?t.world.id:t?.world_id?t.world_id:"",[t]),U=u.useMemo(()=>!t||!Array.isArray(t.members)||!e?null:t.members.find(Ze=>Ze?.user_id===e.id)?.role??null,[t,e]),k=u.useMemo(()=>e?.role==="system_admin"?!0:U==="dm",[U,e]),B=u.useMemo(()=>e?.role==="system_admin"||U==="dm"?!0:U==="player"?(t?.world?.entity_creation_scope??"")===uc.ALL_PLAYERS:!1,[U,e,t]),R=u.useCallback(async()=>{if(r){l(Pe=>({...Pe,loading:!0,error:""}));try{const Pe=await FM(r),Ze=Array.isArray(Pe?.data)?Pe.data:Array.isArray(Pe)?Pe:[];l({items:Ze,loading:!1,error:""})}catch(Pe){console.error(" Failed to load session notes",Pe),l({items:As,loading:!1,error:Pe?.message||"Failed to load session notes"})}}},[r]);u.useEffect(()=>{if(!r){l({items:As,loading:!1,error:""}),f(""),h(null),A.current=null;return}R()},[r,R]),u.useEffect(()=>{T.current=m},[m]),u.useEffect(()=>{M.current=c},[c]);const q=u.useMemo(()=>Array.isArray(i.items)?[...i.items].sort((Pe,Ze)=>{const W=(Pe?.session_date??Pe?.sessionDate??"")||"",ee=(Ze?.session_date??Ze?.sessionDate??"")||"";if(W&&ee&&W!==ee)return ee.localeCompare(W);const te=new Date(Pe?.updated_at??Pe?.updatedAt??Pe?.created_at??Pe?.createdAt??0).getTime();return new Date(Ze?.updated_at??Ze?.updatedAt??Ze?.created_at??Ze?.createdAt??0).getTime()-te}):As,[i.items]),G=u.useMemo(()=>{const Pe=S.trim().toLowerCase();return Pe?q.filter(Ze=>{if(!Ze)return!1;const W=String(Ze?.session_title??Ze?.sessionTitle??"Session note").toLowerCase(),ee=String(Ze?.content??"").toLowerCase(),te=dd(Ze?.session_date??Ze?.sessionDate??"").toString().toLowerCase();return W.includes(Pe)||ee.includes(Pe)||te.includes(Pe)}):q},[S,q]),J=u.useMemo(()=>c&&q.find(Pe=>Pe?.id===c)||null,[q,c]),ie=u.useMemo(()=>m?.sessionDate?dd(m.sessionDate):"Undated session",[m?.sessionDate]),Z=u.useMemo(()=>m?.updatedAt?Pz(m.updatedAt):"",[m?.updatedAt]),me=u.useMemo(()=>m?.content?fc(m.content,m.mentions):As,[m?.content,m?.mentions]);u.useEffect(()=>{const Pe=S.trim().length>0,Ze=G.length>0?G:q;if(!c&&Ze.length>0){f(Ze[0].id);return}if(Pe&&G.length===0){c&&f(""),h(null),A.current=null;return}if(c&&G.length>0&&!G.some(te=>te?.id===c)){f(G[0].id);return}if(!c){h(null),A.current=null;return}if(!J){f(""),h(null),A.current=null;return}const W=Ap(J);h(W),A.current=W,v(ee=>({...ee,status:"idle",error:""}))},[G,S,J,c,q]),u.useEffect(()=>{if(!c){j(!1);return}if(P.current&&P.current===c){j(!0),P.current="";return}j(!1)},[c]),u.useEffect(()=>{E("")},[c]),u.useEffect(()=>{w("")},[r]);const Q=u.useCallback((Pe,Ze)=>{const W=typeof Ze=="string"?Ze:typeof Pe?.target?.value=="string"?Pe.target.value:"";h(ee=>ee&&{...ee,content:W})},[]),oe=u.useCallback(async(Pe,Ze)=>{const W=Pe?.trim()??"";if(typeof Ze=="function"){if(!L||W.length===0){Ze([]);return}try{const ee=await rf({worldId:L,query:W,limit:8}),te=Array.isArray(ee?.data)?ee.data:ee,ve=Array.isArray(te)?te.map(le=>{const Se=le?.id??le?.entity?.id;if(!Se)return null;const Ee=le?.name||le?.displayName||le?.entity?.name||"Unnamed entity",ge=kl(Ee)||"Unnamed entity";return{id:Se,display:ge}}).filter(Boolean):[];Ze(ve)}catch(ee){console.error(" Failed to search entities for mentions",ee),Ze([])}}},[L]),ne=u.useCallback((Pe,Ze)=>{h(W=>W&&{...W,[Pe]:Ze})},[]),we=u.useMemo(()=>{if(!m?.id)return!1;const Pe={sessionTitle:(m.sessionTitle||"").trim(),sessionDate:m.sessionDate||"",content:m.content||""},Ze=A.current||{},W={sessionTitle:(Ze.sessionTitle||"").trim(),sessionDate:Ze.sessionDate||"",content:Ze.content||""};return JSON.stringify(Pe)!==JSON.stringify(W)},[m]),ke=u.useCallback(async()=>{const Pe=r,Ze=M.current,W=T.current;if(!Pe||!Ze||!W||z.current)return;const ee={sessionTitle:W.sessionTitle?.trim()||"Session note",sessionDate:W.sessionDate||ud(),content:W.content||""},te=A.current||{},ve={sessionTitle:te.sessionTitle?.trim()||"Session note",sessionDate:te.sessionDate||ud(),content:te.content||""};if(JSON.stringify(ee)!==JSON.stringify(ve))try{z.current=!0,v(ge=>({...ge,status:"saving",error:""}));const le=await BM(Pe,Ze,ee),Se=le?.data??le,Ee=Ap(Se);A.current=Ee,h(Ee),l(ge=>{const at=Array.isArray(ge.items)?ge.items:As,st=at.some(nt=>nt?.id===Se?.id)?at.map(nt=>nt?.id===Se?.id?{...nt,...Se}:nt):[Se,...at];return{...ge,items:st}}),v({status:"saved",lastSaved:new Date().toISOString(),error:""})}catch(le){console.error(" Failed to save session note",le),v(Se=>({...Se,status:"error",error:le?.message||"Failed to save session note"}))}finally{z.current=!1}},[r]);u.useEffect(()=>{if(!r||!m?.id||!we||z.current)return;const Pe=setTimeout(()=>{ke()},qz);return()=>clearTimeout(Pe)},[m,we,ke,r]);const Re=u.useCallback(()=>{ke()},[ke]),Te=u.useCallback(async()=>{const Pe=r,Ze=M.current;if(!(!Pe||!Ze)){C(!0),E("");try{await qM(Pe,Ze),l(W=>{const te=(Array.isArray(W.items)?W.items:As).filter(ve=>String(ve?.id)!==String(Ze));return{...W,items:te}}),M.current="",f(""),h(null),A.current=null,v({status:"idle",lastSaved:"",error:""})}catch(W){console.error(" Failed to delete session note",W),E(W?.message||"Failed to delete session note")}finally{C(!1)}}},[r]),rt=u.useCallback(async()=>{if(r){y(!0),v(Pe=>({...Pe,error:""}));try{const Pe=await UM(r,{sessionTitle:`Session on ${dd(ud())}`,sessionDate:ud()}),Ze=Pe?.data??Pe,W=Ap(Ze);l(ee=>{const ve=(Array.isArray(ee.items)?ee.items:As).filter(le=>le?.id!==Ze?.id);return{...ee,items:[Ze,...ve],error:""}}),w(""),P.current=Ze.id,f(Ze.id),h(W),A.current=W,j(!0),v({status:"idle",lastSaved:"",error:""})}catch(Pe){console.error(" Failed to create session note",Pe),v(Ze=>({...Ze,status:"error",error:Pe?.message||"Failed to create session note"}))}finally{y(!1)}}},[r]),He=u.useCallback(()=>{L&&(V(Cp("create")),F("details"),H(!0))},[L]),tt=u.useCallback(()=>{H(!1),V(Cp("create")),F("details")},[]),Ie=u.useCallback(Pe=>{Pe&&V(Ze=>({...Ze,...Pe}))},[]),vt=u.useCallback(async Pe=>{tt()},[tt]),Ct=t?.name??"",At=q.length,_t=u.useMemo(()=>{if(g.status==="saving")return"Saving";if(g.status==="error")return"Changes not saved";if(g.status==="saved"&&g.lastSaved){const Pe=new Date(g.lastSaved);return Number.isNaN(Pe.getTime())?"Saved":`Saved ${Pe.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})}`}return we?"Unsaved changes":""},[we,g]);return r?a.jsxs("div",{className:"notes-page",children:[a.jsx("div",{className:"notes-header",children:a.jsxs("div",{className:"notes-title",children:[a.jsx("h1",{children:"Session Notes"}),a.jsxs("p",{children:["Chronicle every game night for the ",a.jsx("strong",{children:Ct})," campaign, @mention key entities, and keep everyone aligned with auto-saving notes."]})]})}),a.jsxs("div",{className:"session-notes-meta",children:[a.jsxs("span",{children:[a.jsx(C1,{size:16})," Players and DMs can add or update notes."," ",a.jsx(M0,{size:16})," ",At," ",At===1?"session":"sessions"," tracked."]}),_t?a.jsxs("span",{className:`session-notes-autosave status-${g.status}`,children:[g.status==="saving"?a.jsx(Nn,{size:14,className:"spinner"}):g.status==="saved"?a.jsx(b1,{size:14}):g.status==="error"?a.jsx(Ha,{size:14}):we?a.jsx(L0,{size:14}):null,a.jsx("span",{children:_t})]}):null]}),i.error&&a.jsxs("div",{className:"notes-error",role:"alert",children:[a.jsxs("strong",{children:[a.jsx(Ha,{size:18})," Unable to load session notes"]}),a.jsx("span",{children:i.error})]}),a.jsxs("div",{className:"session-notes-layout",children:[a.jsxs("aside",{className:"session-notes-sidebar",children:[a.jsxs("label",{className:"session-notes-search",htmlFor:"session-notes-search-input",children:[a.jsx(ic,{size:16}),a.jsx("input",{id:"session-notes-search-input",type:"search",placeholder:"Search session notes",value:S,onChange:Pe=>w(Pe.target.value)})]}),a.jsxs("button",{type:"button",className:"session-notes-item-button session-notes-new-button",onClick:rt,disabled:p||i.loading,children:[p?a.jsx(Nn,{size:16,className:"spinner"}):a.jsx(Va,{size:16}),a.jsx("span",{children:p?"Creating":"New Session"})]}),a.jsx("div",{className:"session-notes-list-container",children:i.loading?a.jsxs("div",{className:"session-notes-loading",children:[a.jsx(Nn,{size:18,className:"spinner"}),a.jsx("span",{children:"Loading session notes"})]}):G.length===0?q.length===0?a.jsxs("div",{className:"notes-empty",children:[a.jsx(Ii,{size:20}),a.jsx("strong",{children:"No session notes yet"}),a.jsx("span",{children:"Create the first note to kick off your campaign journal."})]}):a.jsxs("div",{className:"notes-empty",children:[a.jsx(ic,{size:18}),a.jsx("strong",{children:"No matches"}),a.jsxs("span",{children:["No session notes include ",S.trim(),"."]})]}):a.jsx("ul",{className:"session-notes-list",role:"list",children:G.map(Pe=>{const Ze=Pe?.id,W=Ze===c,ee=Pe?.session_title??Pe?.sessionTitle??"Session note",te=dd(Pe?.session_date??Pe?.sessionDate);return a.jsx("li",{className:`session-notes-item ${W?"active":""}`,children:a.jsxs("button",{type:"button",className:"session-notes-item-button",onClick:()=>f(Ze),children:[a.jsx("span",{className:"session-note-card-title",children:ee}),a.jsx("span",{className:"session-note-card-date",children:te})]})},Ze)})})})]}),a.jsx("section",{className:"session-notes-panel",children:m?.id?a.jsxs("div",{className:"session-note-shell",children:[a.jsxs("header",{className:"session-note-header",children:[a.jsx("div",{className:"session-note-heading",children:a.jsx("h2",{children:m.sessionTitle||"Session note"})}),a.jsxs("div",{className:"session-note-toolbar",children:[k?a.jsxs("button",{type:"button",className:"session-note-action danger",onClick:Te,disabled:_,children:[_?a.jsx(Nn,{size:16,className:"spinner"}):a.jsx(ma,{size:16}),a.jsx("span",{children:_?"Deleting":"Delete"})]}):null,a.jsxs("button",{type:"button",className:"session-note-action",onClick:()=>j(Pe=>!Pe),children:[N?a.jsx(v1,{size:16}):a.jsx(ZT,{size:16}),a.jsx("span",{children:N?"View note":"Edit note"})]}),N&&B?a.jsxs("button",{type:"button",className:"session-note-action primary",onClick:He,children:[a.jsx(Va,{size:16}),a.jsx("span",{children:"Create Entity"})]}):null]})]}),O?a.jsxs("div",{className:"session-note-error",role:"alert",children:[a.jsx(Ha,{size:16}),a.jsx("span",{children:O})]}):null,N?a.jsxs("div",{className:"session-note-form",children:[a.jsxs("div",{className:"session-note-fields session-note-fields-row",children:[a.jsxs("div",{className:"session-note-field",children:[a.jsx("label",{htmlFor:"session-note-title",children:"Title"}),a.jsx("input",{id:"session-note-title",type:"text",value:m.sessionTitle||"",onChange:Pe=>ne("sessionTitle",Pe.target.value),placeholder:"The mystery of the Violet Spire"})]}),a.jsxs("div",{className:"session-note-field",children:[a.jsx("label",{htmlFor:"session-note-date",children:"Session date"}),a.jsx("input",{id:"session-note-date",type:"date",value:m.sessionDate||"",onChange:Pe=>ne("sessionDate",Pe.target.value),max:"9999-12-31"})]})]}),a.jsxs("div",{className:"session-note-fields",children:[a.jsx("label",{htmlFor:"session-note-content",children:"Notes"}),a.jsx("div",{className:"session-note-editor-field",children:a.jsx(Ld,{value:m.content||"",onChange:Q,markup:"@[__display__](__id__)",placeholder:Hz,className:"session-note-mentions",inputProps:{id:"session-note-content",className:"session-note-textarea","aria-label":"Session note content",rows:14},children:a.jsx(Rl,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(Pe,Ze)=>`@${Ze}`,data:oe,appendSpaceOnAdd:!0})})}),a.jsx("div",{className:"session-note-save-button",children:a.jsxs("button",{type:"button",className:"session-note-action primary",onClick:Re,disabled:g.status==="saving"||!we,children:[g.status==="saving"?a.jsx(Nn,{size:16,className:"spinner"}):a.jsx(L0,{size:16}),a.jsx("span",{children:g.status==="saving"?"Saving":"Save now"})]})}),me.length>0?a.jsxs("div",{className:"session-note-preview","aria-live":"polite",children:[a.jsx("h3",{children:"Preview"}),a.jsx("div",{className:"session-note-preview-content",children:a.jsx(vy,{segments:me,noteId:`${m?.id||"note"}-preview`,textClassName:"session-note-text",mentionClassName:"session-note-mention"})})]}):null]}),a.jsx("div",{className:"session-note-actions",children:m.author?.username?a.jsxs("span",{className:"session-note-meta",children:["Created by ",m.author.username,m.lastEditor?.username&&m.lastEditor.username!==m.author.username?`  Last updated by ${m.lastEditor.username}`:""]}):null})]}):a.jsxs("article",{className:"session-note-view","aria-live":"polite",children:[a.jsxs("div",{className:"session-note-view-meta",children:[a.jsxs("span",{children:[a.jsx(M0,{size:16})," ",ie]}),Z?a.jsxs("span",{children:["Updated ",Z]}):null]}),a.jsx("div",{className:"session-note-view-body",children:a.jsx(vy,{segments:me,noteId:`${m?.id||"note"}-view`,textClassName:"session-note-text",mentionClassName:"session-note-mention",renderEmpty:()=>a.jsx("p",{className:"session-note-view-empty",children:"No notes captured yet."})})}),m.author?.username?a.jsxs("div",{className:"session-note-view-meta session-note-view-authors",children:[a.jsxs("span",{children:["Created by ",m.author.username]}),m.lastEditor?.username&&m.lastEditor.username!==m.author.username?a.jsxs("span",{children:["Last updated by ",m.lastEditor.username]}):null]}):null]})]}):a.jsxs("div",{className:"notes-helper",children:[a.jsx(Up,{size:28}),a.jsx("strong",{children:"Select a session to get started"}),a.jsx("span",{children:"Create a new note or choose one from the list to see its details."})]})})]}),a.jsx(Yr,{isOpen:X,onClose:tt,title:"Create Entity",width:420,footerActions:a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:tt,disabled:Y.cancelDisabled,children:"Cancel"}),Y.accessButtonVisible&&a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>F(Pe=>Pe==="access"?"details":"access"),disabled:Y.accessButtonDisabled,children:I==="access"?"Details":"Access"}),a.jsx("button",{type:"submit",className:"btn submit",form:D.current,disabled:Y.submitDisabled,children:Y.submitLabel})]}),children:a.jsx(dN,{worldId:L,entityId:null,onCancel:tt,onSaved:vt,formId:D.current,onStateChange:Ie,hideActions:!0,activeView:I,onViewChange:F,defaultCampaignId:r||""})})]}):a.jsxs("div",{className:"notes-page",children:[a.jsx("div",{className:"notes-header",children:a.jsxs("div",{className:"notes-title",children:[a.jsx("h1",{children:"Session Notes"}),a.jsx("p",{children:"Select a campaign from the header to start collecting your notes."})]})}),a.jsxs("div",{className:"notes-helper",children:[a.jsx(Up,{size:28}),a.jsx("strong",{children:"No campaign selected"}),a.jsx("span",{children:"Pick a campaign to unlock collaborative session notes."})]})]})}const Yz={private:"Private",party:"Party",companions:"Companions",dm:"DM"},Gz=[{value:"private",label:"Private"},{value:"companions",label:"My Companions"}],Xz=[{value:"private",label:"Private"},{value:"party",label:"Share with Party"}],Kz="What do you want to remember?",Wz=e=>{if(!e)return"";const t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})},vi=e=>{const t=[e?.entityId,e?.entity_id,e?.entity?.id];for(const r of t)if(r)return String(r);return""},Tp=e=>{const t=[e?.author?.id,e?.createdBy,e?.created_by];for(const r of t)if(r)return String(r);return""},Mw=e=>{const t=e?.author;return t?.username?t.username:t?.email?t.email:e?.character?.name?`${e.character.name} (Character)`:(e?.created_by,"Unknown author")},Rw=e=>e?.entity?.name?e.entity.name:typeof e?.entityName=="string"&&e.entityName.trim()?e.entityName:"Unnamed entity",xy=e=>{const t=[e?.entity?.entityTypeId,e?.entity?.entity_type_id,e?.entity?.entityType?.id,e?.entity?.entityType?.entity_type_id];for(const r of t)if(r)return String(r);return""},Zz=(e,t=new Map)=>{if(e?.entity?.entityType?.name)return e.entity.entityType.name;const r=xy(e);return r&&t.has(r)?t.get(r):""};function Qz(){const{selectedCampaign:e,selectedCampaignId:t}=Bn(),{user:r}=En(),[i,l]=u.useState({items:[],loading:!1,error:""}),[c,f]=u.useState(""),[m,h]=u.useState(""),[p,y]=u.useState(""),[g,v]=u.useState(null),[S,w]=u.useState(""),[N,j]=u.useState("private"),[_,C]=u.useState(""),[O,E]=u.useState(!1),[T,M]=u.useState(null),[A,z]=u.useState(""),[P,X]=u.useState([]),[H,Y]=u.useState(!1),[V,I]=u.useState(""),[F,D]=u.useState([]),[L,U]=u.useState(!1),k=u.useCallback(async()=>{if(t){l(W=>({...W,loading:!0,error:""}));try{const W=await $M(t),ee=Array.isArray(W?.data)?W.data:Array.isArray(W)?W:[];l({items:ee,loading:!1,error:""})}catch(W){console.error(" Failed to load campaign entity notes",W),l({items:[],loading:!1,error:W?.message||"Failed to load entity notes"})}}},[t]);u.useEffect(()=>{if(!t){l({items:[],loading:!1,error:""});return}k()},[t,k]),u.useEffect(()=>{f(""),h(""),y(""),v(null),w(""),j("private"),C(""),z("")},[t]);const R=u.useMemo(()=>!e||!r?.id?null:(Array.isArray(e.members)?e.members:[]).find(te=>{if(!te)return!1;const ve=te.user_id??te.userId??te.user?.id??te.id??null;return ve?String(ve)===String(r.id):!1})||null,[e,r?.id])?.role??null,q=u.useMemo(()=>r?.role==="system_admin"?!0:R==="dm",[R,r?.role]),G=u.useMemo(()=>R==="player",[R]),J=u.useMemo(()=>e?.world?.id?e.world.id:e?.world_id?e.world_id:"",[e]);u.useEffect(()=>{let W=!1;return J?((async()=>{U(!0);try{const te=await Qr({worldId:J});if(W)return;const le=(Array.isArray(te?.data)?te.data:Array.isArray(te)?te:[]).map(Se=>({id:Se?.id?String(Se.id):"",name:Se?.name||"Unnamed type"})).filter(Se=>Se.id);D(le)}catch(te){if(W)return;console.error("Failed to load entity types",te),D([])}finally{W||U(!1)}})(),()=>{W=!0}):(D([]),U(!1),()=>{W=!0})},[J]);const ie=u.useMemo(()=>q?Xz:Gz,[q]),Z=u.useCallback(W=>{if(!r||!W)return!1;const ee=W?.author?.id??W?.createdBy??W?.created_by??W?.authorId??W?.author_id??null;return ee?String(ee)===String(r.id):!1},[r]);u.useEffect(()=>{let W=!1;return!G||!t?(X([]),Y(!1),I(""),C(""),()=>{W=!0}):((async()=>{Y(!0),I("");try{const te=await Ds({scope:"my",campaign_id:t});if(W)return;const le=(Array.isArray(te?.data)?te.data:Array.isArray(te)?te:[]).map(Se=>({id:Se?.id?String(Se.id):"",name:Se?.name||"Unnamed character"})).filter(Se=>Se.id);X(le),le.length===1?C(le[0].id):le.some(Se=>Se.id===_)||C("")}catch(te){if(W)return;console.error("Failed to load characters for notes",te),X([]),C(""),I(te.message||"Failed to load characters")}finally{W||Y(!1)}})(),()=>{W=!0})},[G,t,_]);const me=u.useCallback(async(W,ee)=>{const te=W?.trim()??"";if(typeof ee!="function")return;if(te.length===0){ee([]);return}let ve="";if(g){const Ee=i.items.find(ge=>ge?.id===g);Ee&&(ve=vi(Ee))}if(ve||(ve=c||""),!ve){ee([]);return}const le=i.items.find(Ee=>vi(Ee)===ve),Se=le?.entity?.world_id??le?.entity?.world?.id??"";if(!Se){ee([]);return}try{const Ee=await rf({worldId:Se,query:te,limit:8}),ge=Array.isArray(Ee?.data)?Ee.data:Ee,at=Array.isArray(ge)?ge.map(st=>{const nt=st?.id??st?.entity?.id;if(!nt)return null;const $e=st?.name||st?.displayName||st?.entity?.name||"Unnamed entity",ft=kl($e)||"Unnamed entity";return{id:nt,display:ft}}).filter(Boolean):[];ee(at)}catch(Ee){console.error("Failed to search entities for mentions",Ee),ee([])}},[c,i.items,g]),Q=u.useCallback(W=>{if(!W)return;const ee=W?.characterId??W?.character_id??"";v(W.id),w(W?.content??""),j(W?.shareType??W?.share_type??"private"),C(ee),z("")},[]),oe=u.useCallback(()=>{v(null),w(""),j("private"),C(""),z("")},[]),ne=u.useCallback((W,ee)=>{const te=typeof ee=="string"?ee:typeof W?.target?.value=="string"?W.target.value:"";w(te),z("")},[]),we=u.useCallback(async W=>{if(!W||!t)return;const ee=S.trim();if(!ee){z("Please enter a note before saving");return}const te=vi(W);if(!te){z("Unable to determine entity for this note");return}const ve=W?.characterId??W?.character_id??"";if(G&&ve&&!_){z("Select which character this note is for");return}E(!0),z("");try{const le={content:ee,shareType:N,campaignId:t};G&&_&&(le.characterId=_);const Se=await q1(te,W.id,le),Ee=Se?.data||Se;if(!Ee)throw new Error("Note could not be updated");l(ge=>{const at=Array.isArray(ge?.items)?ge.items.slice():[],st=Ee?.id;if(!st)return ge;const nt=at.findIndex($e=>$e?.id===st);if(nt>=0){const $e=[...at];return $e[nt]=Ee,{items:$e,loading:!1,error:""}}return ge}),oe()}catch(le){console.error("Failed to update note",le),z(le.message||"Failed to update note")}finally{E(!1)}},[t,S,N,_,G,oe]),ke=u.useCallback(async W=>{if(!W?.id||!t||!window.confirm("Are you sure you want to delete this note? This action cannot be undone."))return;const te=vi(W);if(!te){z("Unable to determine entity for this note");return}M(W.id),z("");try{await H1(te,W.id,{campaignId:t}),l(ve=>({items:(Array.isArray(ve?.items)?ve.items.slice():[]).filter(Ee=>Ee?.id!==W.id),loading:!1,error:""}))}catch(ve){console.error("Failed to delete note",ve),z(ve.message||"Failed to delete note")}finally{M(null)}},[t]),Re=u.useCallback(W=>{const ee=fc(W?.content,W?.mentions);return ee.length?ee.map((te,ve)=>{if(te.type==="mention"&&te.entityId){const le=`${W?.id||"note"}-mention-${ve}`,Se=te.entityName||"entity";return a.jsxs("span",{className:"note-mention",children:["@",Se]},le)}return a.jsx("span",{className:"note-text",children:te.text},`${W?.id||"note"}-text-${ve}`)}):null},[]),Te=u.useMemo(()=>Array.isArray(i.items)?[...i.items].sort((W,ee)=>{const te=new Date(W?.created_at||W?.createdAt||0).getTime(),ve=new Date(ee?.created_at||ee?.createdAt||0).getTime();return Number.isNaN(ve)?-1:Number.isNaN(te)?1:ve-te}):[],[i.items]),rt=u.useMemo(()=>{const W=new Map;return Te.forEach(ee=>{const te=vi(ee);if(!te)return;const ve=Rw(ee);W.has(te)||W.set(te,ve)}),Array.from(W.entries()).map(([ee,te])=>({id:ee,name:te})).sort((ee,te)=>ee.name.localeCompare(te.name,void 0,{sensitivity:"base"}))},[Te]),He=u.useMemo(()=>{const W=new Map;return Te.forEach(ee=>{const te=Tp(ee);if(!te)return;const ve=Mw(ee);W.has(te)||W.set(te,ve)}),Array.from(W.entries()).map(([ee,te])=>({id:ee,name:te})).sort((ee,te)=>ee.name.localeCompare(te.name,void 0,{sensitivity:"base"}))},[Te]),tt=u.useMemo(()=>{const W=new Map;return F.forEach(ee=>{ee.id&&W.set(ee.id,ee.name)}),W},[F]),Ie=u.useMemo(()=>{const W=new Map;return Te.forEach(ee=>{const te=xy(ee);if(!te)return;const ve=Zz(ee,tt)||`Type ${te.slice(0,8)}`;W.has(te)||W.set(te,ve)}),Array.from(W.entries()).map(([ee,te])=>({id:ee,name:te})).sort((ee,te)=>ee.name.localeCompare(te.name,void 0,{sensitivity:"base"}))},[Te,tt]),vt=u.useMemo(()=>Te.filter(W=>{const ee=vi(W),te=Tp(W),ve=xy(W);return!(c&&ee!==c||m&&te!==m||p&&ve!==p)}),[Te,c,m,p]),Ct=u.useCallback(()=>{if(!r?.id)return;const W=String(r.id),ee=He.find(te=>Te.find(le=>Tp(le)===te.id&&Z(le))!==void 0);ee?(h(ee.id),f("")):He.some(te=>te.id===W)&&(h(W),f(""))},[r?.id,He,Te,Z]),At=e?.name??"",_t=vt.length,Pe=Te.length,Ze=!!(c||m||p);return t?a.jsxs("div",{className:"notes-page",children:[a.jsxs("div",{className:"notes-header",children:[a.jsxs("div",{className:"notes-title",children:[a.jsx("h1",{children:"Entity Notes"}),a.jsxs("p",{children:["Browse the notes created for entities in the"," ",a.jsx("strong",{children:At})," campaign, filter by entity or author, and jump back into the context of your adventures."]})]}),a.jsx("div",{className:"notes-actions",children:a.jsxs("button",{type:"button",className:"notes-action-button",onClick:k,disabled:i.loading,title:"Reload notes",children:[a.jsx(zl,{size:16}),a.jsx("span",{children:i.loading?"Loading":"Reload"})]})})]}),a.jsxs("div",{className:"notes-filters",children:[a.jsxs("div",{className:"notes-filter-group",children:[a.jsx("label",{htmlFor:"entity-filter",children:"Entity"}),a.jsxs("select",{id:"entity-filter",value:c,onChange:W=>f(W.target.value),disabled:i.loading||rt.length===0,children:[a.jsx("option",{value:"",children:"All entities"}),rt.map(W=>a.jsx("option",{value:W.id,children:W.name},W.id))]})]}),a.jsxs("div",{className:"notes-filter-group",children:[a.jsx("label",{htmlFor:"author-filter",children:"Author"}),a.jsxs("select",{id:"author-filter",value:m,onChange:W=>h(W.target.value),disabled:i.loading||He.length===0,children:[a.jsx("option",{value:"",children:"All authors"}),He.map(W=>a.jsx("option",{value:W.id,children:W.name},W.id))]})]}),a.jsxs("div",{className:"notes-filter-group",children:[a.jsx("label",{htmlFor:"entity-type-filter",children:"Entity type"}),a.jsxs("select",{id:"entity-type-filter",value:p,onChange:W=>y(W.target.value),disabled:i.loading||Ie.length===0,children:[a.jsx("option",{value:"",children:"All entity types"}),Ie.map(W=>a.jsx("option",{value:W.id,children:W.name},W.id))]})]}),a.jsxs("button",{type:"button",className:"notes-action-button",onClick:()=>{f(""),h(""),y("")},disabled:!Ze,children:[a.jsx(Qd,{size:16}),a.jsx("span",{children:"Reset filters"})]}),r?.id&&a.jsx("button",{type:"button",className:"notes-action-button",onClick:Ct,title:"Show only my notes",children:a.jsx("span",{children:"My notes"})})]}),a.jsxs("div",{className:"notes-meta",children:[a.jsxs("span",{children:["Showing ",a.jsx("strong",{children:_t})," of ",a.jsx("strong",{children:Pe})," ",Pe===1?"note":"notes",Ze?" (filtered)":""]}),i.loading&&a.jsx("span",{children:"Loading latest notes"})]}),i.error&&a.jsxs("div",{className:"notes-error",role:"alert",children:[a.jsxs("strong",{children:[a.jsx(Ha,{size:18})," Unable to load entity notes"]}),a.jsx("span",{children:i.error})]}),!i.loading&&!i.error&&vt.length===0&&a.jsxs("div",{className:"notes-empty",children:[a.jsx("strong",{children:"No notes to show"}),a.jsx("span",{children:Pe===0?"No entity notes have been shared in this campaign yet.":"Adjust your filters to see more notes."})]}),A&&a.jsxs("div",{className:"notes-error",role:"alert",children:[a.jsxs("strong",{children:[a.jsx(Ha,{size:18})," Error"]}),a.jsx("span",{children:A})]}),vt.length>0&&a.jsx("div",{className:"notes-list",children:vt.map(W=>{const ee=vi(W),te=String(W?.shareType||W?.share_type||"private"),ve=W?.created_at||W?.createdAt,le=ve?new Date(ve):null,Se=Wz(le),Ee=le&&!Number.isNaN(le.getTime())?le.toISOString():"",ge=Mw(W),at=W?.character?.name??"",st=Rw(W),nt=g===W?.id,$e=Z(W);return a.jsx("article",{className:"note-card",children:nt?a.jsxs("div",{className:"entity-notes-strict-edit-panel",style:{padding:"1rem"},children:[a.jsx(Ld,{value:S,onChange:ne,markup:"@[__display__](__id__)",placeholder:Kz,className:"entity-note-mentions",inputProps:{className:"entity-notes-strict-textarea","aria-label":"Edit note content",rows:5,required:!0},children:a.jsx(Rl,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(ft,zt)=>`@${zt}`,data:me,appendSpaceOnAdd:!0})}),a.jsx("p",{style:{marginTop:"0.75rem",marginBottom:"0.5rem",fontWeight:600},children:"Share with"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"0.75rem"},children:ie.map(ft=>a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx("input",{type:"radio",name:`entity-note-share-edit-${W.id}`,value:ft.value,checked:N===ft.value,onChange:()=>j(ft.value),disabled:O}),ft.value==="private"?"Private":ft.value==="party"?"Share with Party":ft.label]},ft.value))}),G&&P.length>0&&a.jsxs("div",{style:{marginBottom:"0.75rem"},children:[a.jsx("label",{htmlFor:`edit-character-${W.id}`,style:{display:"block",marginBottom:"0.25rem",fontWeight:600},children:"Character"}),a.jsx("select",{id:`edit-character-${W.id}`,value:_,onChange:ft=>C(ft.target.value),disabled:H||P.length===1,style:{width:"100%",padding:"0.5rem",borderRadius:"8px",border:"1px solid #cbd5f5"},children:P.map(ft=>a.jsx("option",{value:ft.id,children:ft.name},ft.id))})]}),A?a.jsxs("div",{className:"notes-error",style:{marginTop:"0.75rem",marginBottom:"0.75rem"},children:[a.jsx(Ha,{size:16}),a.jsx("span",{children:A})]}):null,a.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.75rem"},children:[a.jsx("button",{type:"button",className:"notes-action-button",onClick:()=>we(W),disabled:O||!S.trim(),children:O?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:16,style:{animation:"spinner-rotate 1s linear infinite"}}),"Saving"]}):"Save"}),a.jsx("button",{type:"button",className:"notes-action-button",onClick:oe,disabled:O,style:{background:"#64748b"},children:"Cancel"})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("header",{className:"note-card-header",children:[a.jsx("div",{className:"note-entity-meta",children:a.jsx("h2",{children:ee?a.jsxs("span",{className:"entity-link-with-preview",children:[a.jsx(Jt,{to:`/entities/${ee}`,className:"entity-name-link",children:st}),a.jsx(Is,{entityId:ee,entityName:st})]}):st})}),a.jsx("div",{className:"note-tags",children:a.jsx("span",{className:`note-tag share-${te}`,children:Yz[te]??te})})]}),a.jsxs("div",{className:"note-details",children:[a.jsxs("span",{children:["Author: ",ge]}),at?a.jsxs("span",{children:["Character: ",at]}):null,Se?a.jsxs("span",{children:["Created:"," ",a.jsx("time",{dateTime:Ee||void 0,children:Se})]}):null]}),a.jsx("div",{className:"note-content",children:Re(W)||a.jsx(vy,{content:W?.content,mentions:W?.mentions,noteId:W?.id||ee||"note",textClassName:"note-text",mentionClassName:"note-mention"})}),$e&&a.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",paddingTop:"0.75rem",borderTop:"1px solid rgba(15, 23, 42, 0.1)"},children:[a.jsxs("button",{type:"button",className:"notes-action-button",onClick:()=>Q(W),style:{background:"#1e40af",color:"#fff"},children:[a.jsx(E1,{size:14}),a.jsx("span",{children:"Edit"})]}),a.jsxs("button",{type:"button",className:"notes-action-button",onClick:()=>ke(W),disabled:T===W.id,style:{background:"#dc2626",color:"#fff"},children:[T===W.id?a.jsx(Nn,{size:14,className:"spin",style:{animation:"spinner-rotate 1s linear infinite"}}):a.jsx(ma,{size:14}),a.jsx("span",{children:T===W.id?"Deleting":"Delete"})]})]})]})},W.id??`${ee}-${Ee||"unknown"}`)})})]}):a.jsxs("div",{className:"notes-page",children:[a.jsx("div",{className:"notes-header",children:a.jsxs("div",{className:"notes-title",children:[a.jsx("h1",{children:"Entity Notes"}),a.jsx("p",{children:"Select a campaign from the header to view entity notes."})]})}),a.jsxs("div",{className:"notes-empty",children:[a.jsx("strong",{children:"No campaign selected"}),a.jsx("span",{children:"Pick a campaign to explore its shared entity notes."})]})]})}const Jz=(e,t)=>Tt.post("/access/bulk/apply",e,t),e$=({worldId:e})=>{if(!e)return Promise.reject(new Error("worldId is required"));const t=new URLSearchParams({worldId:e});return Tt.get(`/access/bulk/runs?${t.toString()}`)},t$=e=>e?Tt.get(`/access/bulk/runs/${e}`):Promise.reject(new Error("runId is required")),n$=e=>e?Tt.post(`/access/bulk/runs/${e}/revert`):Promise.reject(new Error("runId is required")),hj=e=>{if(!e)return Promise.reject(new Error("worldId is required"));const t=new URLSearchParams({worldId:e});return Tt.get(`/access/collections?${t.toString()}`)},a$=e=>Tt.post("/access/collections",e),s$=(e,t)=>e?Tt.put(`/access/collections/${e}`,t):Promise.reject(new Error("Collection id is required")),r$=e=>e?Tt.delete(`/access/collections/${e}`):Promise.reject(new Error("Collection id is required")),i$=e=>e?Tt.get(`/access/collections/${e}/entities`):Promise.reject(new Error("Collection id is required")),Js=1e3,ga={NAME:"name",NAME_DESCRIPTION:"nameDescription",ALL_DATA:"allData",ALL_DATA_RELATIONSHIPS:"allDataRelationships"},jd=[{value:ga.NAME,label:"Name only",description:"Matches entity names only."},{value:ga.NAME_DESCRIPTION,label:"Name & description",description:"Matches entity names and their descriptions."},{value:ga.ALL_DATA,label:"All data",description:"Matches names, descriptions, and visible data fields."},{value:ga.ALL_DATA_RELATIONSHIPS,label:"All data & relationships",description:"Matches every field plus reference values, ideal for relationship lookups."}],kw={[ga.NAME]:"Filter entities by name",[ga.NAME_DESCRIPTION]:"Search names or descriptions",[ga.ALL_DATA]:"Search names, descriptions, and data fields",[ga.ALL_DATA_RELATIONSHIPS]:"Search across data and related entities"},Dw=140,nc=(e,t)=>{if(t==null||typeof t=="number"&&!Number.isFinite(t))return;const i=(t instanceof Date?t.toISOString():String(t)).trim().toLowerCase();i&&e.add(i)},Sy=(e,t,r)=>{if(e!=null){if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"){nc(r,e);return}if(e instanceof Date){nc(r,e);return}if(Array.isArray(e)){e.forEach(i=>Sy(i,t,r));return}t&&typeof e=="object"&&Object.values(e).forEach(i=>Sy(i,t,r))}},l$=(e,t)=>{if(!e)return[];const r=t&&jd.some(l=>l.value===t)?t:ga.NAME,i=new Set;return nc(i,e.name),r!==ga.NAME&&nc(i,e.description),(r===ga.ALL_DATA||r===ga.ALL_DATA_RELATIONSHIPS)&&(nc(i,e.entityType?.name),e.metadata&&typeof e.metadata=="object"&&Sy(e.metadata,r===ga.ALL_DATA_RELATIONSHIPS,i)),Array.from(i)},Iw=(e,t="start")=>{if(!e)return null;const r=new Date(e);return Number.isNaN(r.getTime())?null:(t==="end"?r.setHours(23,59,59,999):r.setHours(0,0,0,0),r.getTime())},Lw=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})},o$=e=>{if(!e)return"";const t=Lw(e.updatedAt||e.updated_at);if(t)return`Updated ${t}`;const r=Lw(e.createdAt||e.created_at);return r?`Created ${r}`:""},c$=e=>{if(!e)return"";const t=e.summary||e.summary_text||e.description||e.system_prompt||e.notes||"",r=typeof t=="string"?t.replace(/\s+/g," ").trim():"";return r?r.length<=Dw?r:`${r.slice(0,Dw-1).trim()}`:""},Vo=({label:e,count:t,options:r=[],selectedValues:i=[],onToggle:l,disabled:c})=>{const f=m=>{c||l(String(m))};return a.jsxs("div",{className:"token-selector",children:[a.jsxs("div",{className:"token-selector__label-row",children:[a.jsx("span",{children:e}),a.jsxs("span",{className:"token-selector__count",children:["(",t,")"]})]}),a.jsx("div",{className:"token-selector__chips",role:"listbox","aria-multiselectable":!0,children:r.length===0?a.jsx("p",{className:"token-selector__empty",children:"No options available."}):r.map(m=>{const h=String(m.id),p=i.includes(h);return a.jsx("button",{type:"button",className:`token-selector__chip ${p?"selected":""}`,onClick:()=>f(h),"aria-pressed":p,disabled:c,children:m.label},h)})})]})},Lr=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],Mp=(e,t="name")=>e.map(r=>({id:String(r.id??r.value??r),label:r[t]||r.name||r.email||r.id})),Ow=e=>{const t=e.filter(r=>r.count>0).map(r=>`${r.count} ${r.label}${r.count===1?"":"s"}`);return t.length===0?"":t.length===1?t[0]:t.length===2?`${t[0]} and ${t[1]}`:`${t.slice(0,-1).join(", ")}, and ${t[t.length-1]}`};function zw(){const{worldId:e,campaignId:t}=xs(),r=$n(),{user:i}=En(),{selectedCampaign:l,selectedCampaignId:c,setSelectedCampaignId:f,loading:m}=Bn(),[h,p]=u.useState(null),[y,g]=u.useState(""),[v,S]=u.useState(!0),[w,N]=u.useState([]),[j,_]=u.useState([]),[C,O]=u.useState([]),[E,T]=u.useState([]),[M,A]=u.useState(!1),[z,P]=u.useState(""),[X,H]=u.useState(""),[Y,V]=u.useState(ga.NAME),[I,F]=u.useState(""),[D,L]=u.useState(""),[U,k]=u.useState([]),[B,R]=u.useState(!1),[q,G]=u.useState(""),[J,ie]=u.useState(null),[Z,me]=u.useState({readCampaignIds:[],readUserIds:[],readCharacterIds:[],writeCampaignIds:[],writeUserIds:[],description:""}),[Q,oe]=u.useState("unchanged"),[ne,we]=u.useState("unchanged"),[ke,Re]=u.useState(!1),[Te,rt]=u.useState("manual"),[He,tt]=u.useState([]),[Ie,vt]=u.useState(!1),[Ct,At]=u.useState(""),[_t,Pe]=u.useState(""),[Ze,W]=u.useState(null),[ee,te]=u.useState(!1),ve=!!t,le=t?String(t):"",Se=u.useMemo(()=>!ve||!le||!c?!1:String(c)===le,[ve,le,c]),Ee=ve&&Se?l:null,ge=e||Ee?.world?.id||"";u.useEffect(()=>{!ve||!le||String(c||"")!==le&&f(le)},[ve,le,c,f]);const at=u.useMemo(()=>ve||!h||!i?!1:String(h.created_by)===String(i.id),[ve,h,i]),st=u.useMemo(()=>!ve||!Ee||!i?.id||!Array.isArray(Ee.members)?!1:Ee.members.some(_e=>_e?.user_id===i.id&&_e?.role==="dm"),[Ee,ve,i]),nt=!!(ve&&Ee&&st),$e=at||nt;u.useEffect(()=>{if(!ge||!$e){tt([]),At(""),Pe(""),W(null);return}let _e=!1;return(async()=>{vt(!0),At("");try{const mt=await hj(ge),fe=Lr(mt);_e||tt(fe)}catch(mt){_e||(console.error("Failed to load collections",mt),tt([]),At(mt.message||"Failed to load collections"))}finally{_e||vt(!1)}})(),()=>{_e=!0}},[ge,$e]),u.useEffect(()=>{if(ve){if(!le){g("Campaign id is required to use this tool."),S(!1);return}if(!Ee){if(m){S(!0);return}g("Campaign not found or unavailable for your account."),S(!1);return}p(Ee.world||null),g(""),S(!1);return}if(!e){g("A world id is required to use the bulk access tool."),S(!1);return}(async()=>{S(!0),g("");try{const et=await $l(),fe=Lr(et).find(he=>String(he.id)===String(e));if(!fe){g("World not found or unavailable."),p(null);return}p(fe)}catch(et){console.error("Failed to load worlds",et),g(et.message||"Failed to load world data"),p(null)}finally{S(!1)}})()},[Ee,m,ve,le,e]);const ft=u.useCallback(async()=>{if(!(!ge||!$e)){A(!0),P("");try{if(ve&&Ee){const[_e,et]=await Promise.all([lc(ge),Ds({campaign_id:Ee.id})]);N(Lr(_e)),_([Ee]),O(Lr(et));const mt=Array.isArray(Ee.members)?Ee.members.map(fe=>({id:String(fe.user_id),username:fe.user?.username||fe.user?.email||fe.user_id})):[];T(mt)}else{const[_e,et,mt,fe]=await Promise.all([lc(ge),jc({world_id:ge}),Ds({world_id:ge}),Qy()]);N(Lr(_e)),_(Lr(et)),O(Lr(mt)),T(Lr(fe))}}catch(_e){console.error("Failed to load bulk access data",_e),P(_e.message||"Unable to load world data")}finally{A(!1)}}},[Ee,$e,ve,ge]);u.useEffect(()=>{ft()},[ft]);const zt=u.useMemo(()=>ve?new Set((C||[]).map(_e=>String(_e.id))):new Set,[C,ve]),Rt=u.useMemo(()=>{if(!ve)return w;if(!Ee)return[];const _e=String(Ee.id);return w.filter(et=>(et.read_access??"global")==="global"||(Array.isArray(et.read_campaign_ids)?et.read_campaign_ids.map(Ve=>String(Ve)):[]).includes(_e)?!0:(Array.isArray(et.read_character_ids)?et.read_character_ids.map(Ve=>String(Ve)):[]).some(Ve=>zt.has(Ve)))},[Ee,zt,w,ve]);u.useEffect(()=>{const _e=new Set(Rt.map(et=>et.id));k(et=>{const mt=et.filter(fe=>_e.has(fe));return mt.length===et.length?et:mt})},[Rt]);const pt=u.useMemo(()=>{const _e=X.trim().toLowerCase(),et=Iw(I,"start"),mt=Iw(D,"end");return Rt.filter(fe=>{const he=fe.createdAt??fe.created_at??null;if(et!==null||mt!==null){if(!he)return!1;const xt=new Date(he).getTime();if(Number.isNaN(xt)||et!==null&&xt<et||mt!==null&&xt>mt)return!1}if(!_e)return!0;const Ve=l$(fe,Y);return Ve.length?Ve.some(xt=>xt.includes(_e)):!1})},[Rt,X,Y,I,D]),ct=u.useMemo(()=>jd.find(_e=>_e.value===Y),[Y]),yt=kw[Y]||kw[ga.NAME],Mt=_e=>{const et=_e.target.value,mt=jd.some(fe=>fe.value===et);V(mt?et:ga.NAME)},Ft=()=>{F(""),L("")};u.useEffect(()=>{if(!ve||!Ee)return;const _e=String(Ee.id),et=new Set([_e]),mt=new Set((E||[]).map(he=>String(he.id))),fe=new Set((C||[]).map(he=>String(he.id)));me(he=>{const Ve=(ln,dn)=>ln.filter(Qt=>dn.has(String(Qt))),xt=Ve(he.readCampaignIds,et),Nt=Ve(he.writeCampaignIds,et),Et=Ve(he.readUserIds,mt),jt=Ve(he.writeUserIds,mt),Wt=Ve(he.readCharacterIds,fe);return xt.length===he.readCampaignIds.length&&Nt.length===he.writeCampaignIds.length&&Et.length===he.readUserIds.length&&jt.length===he.writeUserIds.length&&Wt.length===he.readCharacterIds.length?he:{...he,readCampaignIds:xt,writeCampaignIds:Nt,readUserIds:Et,writeUserIds:jt,readCharacterIds:Wt}})},[Ee,C,ve,E]);const kt=U.length,Zt=kt>=Js,Lt=kt>0;u.useEffect(()=>{kt===0&&Re(!1)},[kt]);const Kt=_e=>{G(""),k(et=>et.includes(_e)?et.filter(mt=>mt!==_e):et.length>=Js?(G(`You can only select ${Js} entities at a time.`),et):[...et,_e])},se=()=>{G(""),k(_e=>{const et=new Set(_e);for(const mt of pt){if(et.size>=Js)break;et.add(mt.id)}return et.size>Js&&G(`Selection capped at ${Js} entities.`),Array.from(et)})},be=()=>{k([]),G(""),Te==="collection"&&(Pe(""),W(null))},je=_e=>{const et=_e.target.value;rt(et),G(""),et==="manual"?(Pe(""),W(null)):k([])},We=async _e=>{const et=_e.target.value;if(Pe(et),W(null),G(""),!et){k([]);return}te(!0);try{const mt=await i$(et),fe=mt?.data||mt,he=Array.isArray(fe?.entityIds)?fe.entityIds:[];k(he),W({entityIds:he,entityCount:fe?.entityCount??he.length,totalCount:fe?.totalCount??he.length,truncated:!!fe?.truncated}),fe?.truncated&&G(`Only the first ${Js} entities were loaded from this collection.`)}catch(mt){console.error("Failed to resolve collection entities",mt),G(mt.message||"Failed to load collection entities"),k([]),W(null)}finally{te(!1)}},dt=_e=>{const{value:et}=_e.target;me(mt=>({...mt,description:et}))},gt=_e=>et=>{const mt=et.target.value;_e==="read"?(oe(mt),mt==="unchanged"&&me(fe=>({...fe,readCampaignIds:[],readUserIds:[],readCharacterIds:[]}))):(we(mt),mt==="unchanged"&&me(fe=>({...fe,writeCampaignIds:[],writeUserIds:[]})))},ce=_e=>et=>{const mt=String(et);me(fe=>{const he=fe[_e]||[],xt=he.includes(mt)?he.filter(Nt=>Nt!==mt):[...he,mt];return{...fe,[_e]:xt}})},re=Q==="activated",Ne=ne==="activated",Be=u.useMemo(()=>re?Z.readCampaignIds.length+Z.readUserIds.length+Z.readCharacterIds.length>0:!1,[Z,re]),Ke=u.useMemo(()=>Ne?Z.writeCampaignIds.length+Z.writeUserIds.length>0:!1,[Z,Ne]),ot=re||Ne,ze=u.useMemo(()=>{if(!re)return"";const _e=Ow([{label:"campaign",count:Z.readCampaignIds.length},{label:"user",count:Z.readUserIds.length},{label:"character",count:Z.readCharacterIds.length}]);return _e?`You will add read access for ${_e}.`:""},[Z,re]),ue=u.useMemo(()=>{if(!Ne)return"";const _e=Ow([{label:"campaign",count:Z.writeCampaignIds.length},{label:"user",count:Z.writeUserIds.length}]);return _e?`You will add write access for ${_e}.`:""},[Z,Ne]),qe=$e&&U.length>0&&ot&&!B,Ge=async _e=>{if(_e.preventDefault(),!$e){G("You do not have permission to apply bulk access updates.");return}if(!U.length){G("Select at least one entity to continue.");return}if(!ot){G("Select at least one access type to update.");return}if(re&&!Be){G("Add at least one read campaign, character, or user.");return}if(Ne&&!Ke){G("Add at least one campaign or user to grant write access.");return}const et={entityIds:U,readAccess:re?"selective":"unchanged",writeAccess:Ne?"selective":"unchanged",readCampaignIds:re?Z.readCampaignIds:[],readUserIds:re?Z.readUserIds:[],readCharacterIds:re?Z.readCharacterIds:[],writeCampaignIds:Ne?Z.writeCampaignIds:[],writeUserIds:Ne?Z.writeUserIds:[],description:Z.description};R(!0),G(""),ie(null);try{const mt=await Jz(et,{includeCampaignContext:!!(ve&&Ee)}),fe=mt?.data||mt;ie({runId:fe.runId,count:fe.count})}catch(mt){console.error("Failed to apply bulk access",mt),G(mt.message||"Unable to apply bulk access update")}finally{R(!1)}},ut=u.useMemo(()=>ve&&Ee?[{id:String(Ee.id),label:Ee.name}]:Mp(j),[Ee,j,ve]),ae=u.useMemo(()=>Mp(E,"username"),[E]),Xe=u.useMemo(()=>Mp(C),[C]),Fe=u.useMemo(()=>{const _e=new Map;return w.forEach(et=>{_e.set(et.id,et)}),_e},[w]),Qe=u.useMemo(()=>!Ze||!Array.isArray(Ze.entityIds)?[]:Ze.entityIds.slice(0,10).map(_e=>Fe.get(_e)?.name||_e),[Ze,Fe]);if(v)return a.jsx("div",{className:"bulk-access-page",children:a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading world context"]})});if(y)return a.jsxs("div",{className:"bulk-access-page",children:[a.jsxs("div",{className:"bulk-access-alert error",children:[a.jsx(Ta,{size:16})," ",y]}),a.jsx("button",{type:"button",className:"link-button",onClick:()=>r(-1),children:"Go back"})]});if(!$e){const _e=ve?"Only a DM for this campaign can access this tool.":"Only the world owner can access this tool.";return a.jsx("div",{className:"bulk-access-page",children:a.jsxs("div",{className:"bulk-access-alert warning",children:[a.jsx(Ta,{size:16})," ",_e]})})}const bt=ve?"Campaign Admin  Access":"World Admin  Manual Access",St=ve?Ee?.name:h?.name;return a.jsxs("div",{className:"bulk-access-page",children:[a.jsxs("div",{className:"bulk-access-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"bulk-access-eyebrow",children:bt}),a.jsxs("h1",{children:["Bulk Access Editor  ",St||""]})]}),at&&a.jsx("div",{className:"bulk-access-header-actions",children:a.jsx(Jt,{to:`/worlds/${e}/access/audit`,className:"ghost-button",children:"View audit log"})})]}),a.jsx("p",{className:"bulk-access-helper bulk-access-topline",children:"This tool adds access to selected entities. It does not remove current access."}),nt&&Ee&&a.jsxs("div",{className:"bulk-access-context-banner",children:["You are updating access in Campaign: ",a.jsx("strong",{children:Ee.name})]}),z&&a.jsxs("div",{className:"bulk-access-alert warning",children:[a.jsx(Ta,{size:16})," ",z]}),J&&a.jsxs("div",{className:"bulk-access-alert success",children:[a.jsx(Zd,{size:16})," Applied access updates to ",J.count," entities  Run ",J.runId,at&&a.jsx(Jt,{to:`/worlds/${e}/access/audit`,className:"inline-link",children:"Review run"})]}),q&&a.jsxs("div",{className:"bulk-access-alert error",children:[a.jsx(Ta,{size:16})," ",q]}),a.jsxs("div",{className:"bulk-access-grid",children:[a.jsxs("section",{className:"bulk-access-card",children:[a.jsxs("header",{children:[a.jsxs("h2",{children:[a.jsx(mM,{size:18})," Choose entities (",kt,"/",Js,")"]}),a.jsxs("div",{className:"bulk-access-entity-actions",children:[!ke&&a.jsx("button",{type:"button",className:"ghost-button",onClick:se,disabled:Zt||Te!=="manual",children:"Select filtered"}),a.jsx("button",{type:"button",className:"ghost-button",onClick:be,children:"Clear selection"}),Lt&&a.jsx("button",{type:"button",className:"ghost-button",onClick:()=>Re(_e=>!_e),children:ke?"Expand":"Collapse"})]})]}),ke?a.jsx("div",{className:"bulk-access-entity-collapsed-summary",children:a.jsxs("p",{children:[a.jsx("strong",{children:kt})," ",kt===1?"entity":"entities"," selected."]})}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"bulk-access-selection-mode",children:[a.jsxs("label",{children:[a.jsx("input",{type:"radio",value:"manual",checked:Te==="manual",onChange:je}),"Select manually"]}),a.jsxs("label",{children:[a.jsx("input",{type:"radio",value:"collection",checked:Te==="collection",onChange:je}),"Use collection"]})]}),Te==="collection"?a.jsxs("div",{className:"bulk-access-collection-panel",children:[Ie&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading collections"]}),!Ie&&Ct&&a.jsx("p",{className:"bulk-access-helper warning",children:Ct}),!Ie&&!Ct&&He.length===0&&a.jsxs("p",{className:"bulk-access-helper",children:["No collections available.",at&&!ve&&e&&a.jsxs(a.Fragment,{children:[" ",a.jsx(Jt,{to:`/worlds/${e}/collections`,className:"inline-link",children:"Create one in the collections manager"}),"."]})]}),He.length>0&&a.jsxs("select",{value:_t,onChange:We,children:[a.jsx("option",{value:"",children:"Select a collection"}),He.map(_e=>a.jsxs("option",{value:_e.id,children:[_e.name,"  ",_e.entityCount??_e.entity_ids?.length??0," entities"]},_e.id))]}),ee&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Resolving collection"]}),Ze&&a.jsxs("div",{className:"bulk-access-collection-preview",children:[a.jsxs("p",{children:[a.jsx("strong",{children:Ze.entityCount})," entities selected from this collection."]}),Ze.truncated&&a.jsxs("p",{className:"bulk-access-helper warning",children:["Only the first ",Js," entities can be updated at a time."]}),Qe.length>0&&a.jsx("ul",{children:Qe.map((_e,et)=>a.jsx("li",{children:_e},`${_e}-${et}`))})]}),Te==="collection"&&at&&!ve&&e&&a.jsx(Jt,{to:`/worlds/${e}/collections`,className:"inline-link",children:"Manage collections"})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"entity-filter",children:[a.jsxs("div",{className:"entity-filter__row entity-filter__row--search",children:[a.jsxs("div",{className:"entity-filter__input",children:[a.jsx("label",{htmlFor:"bulk-access-entity-search",children:"Search"}),a.jsx("input",{id:"bulk-access-entity-search",type:"text",placeholder:yt,value:X,onChange:_e=>H(_e.target.value)})]}),a.jsxs("div",{className:"entity-filter__scope",children:[a.jsx("label",{htmlFor:"bulk-access-entity-scope",children:"Search scope"}),a.jsx("select",{id:"bulk-access-entity-scope",value:Y,onChange:Mt,children:jd.map(_e=>a.jsx("option",{value:_e.value,children:_e.label},_e.value))})]})]}),a.jsxs("div",{className:"entity-filter__row entity-filter__dates",children:[a.jsxs("div",{className:"entity-filter__date-field",children:[a.jsx("label",{htmlFor:"bulk-access-created-after",children:"Created after"}),a.jsx("input",{id:"bulk-access-created-after",type:"date",value:I,onChange:_e=>F(_e.target.value)})]}),a.jsxs("div",{className:"entity-filter__date-field",children:[a.jsx("label",{htmlFor:"bulk-access-created-before",children:"Created before"}),a.jsx("input",{id:"bulk-access-created-before",type:"date",value:D,onChange:_e=>L(_e.target.value)})]}),(I||D)&&a.jsx("button",{type:"button",className:"ghost-button entity-filter__clear-dates",onClick:Ft,children:"Clear dates"})]}),ct?.description&&a.jsx("p",{className:"bulk-access-helper",children:ct.description})]}),a.jsxs("div",{className:"entity-selector-list",children:[M&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading entities"]}),!M&&pt.length===0&&a.jsx("p",{className:"bulk-access-helper",children:ve?"No entities are visible within this campaign context.":"No entities match the current filter."}),!M&&pt.map(_e=>{const et=o$(_e),mt=c$(_e);return a.jsxs("label",{className:"entity-row",children:[a.jsx("input",{type:"checkbox",checked:U.includes(_e.id),onChange:()=>Kt(_e.id),disabled:Zt&&!U.includes(_e.id)}),a.jsxs("div",{className:"entity-row__main",children:[a.jsx("span",{className:"entity-name",children:_e.name}),a.jsxs("div",{className:"entity-row__meta",children:[_e.entityType?.name&&a.jsx("span",{className:"entity-type",children:_e.entityType.name}),et&&a.jsx("span",{className:"entity-row__meta-text",children:et})]}),mt&&a.jsx("p",{className:"entity-row__summary",children:mt})]}),a.jsx(Is,{entityId:_e.id,entityName:_e.name,className:"entity-row__preview"})]},_e.id)})]})]})]})]}),a.jsxs("section",{className:"bulk-access-card bulk-access-card--form",children:[a.jsx("header",{children:a.jsx("h2",{children:"Access configuration"})}),a.jsxs("form",{className:"bulk-access-form",onSubmit:Ge,children:[a.jsxs("div",{className:"access-section",children:[a.jsxs("div",{className:"access-section__header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"access-section__eyebrow",children:"Step 1"}),a.jsx("h3",{children:"Read access"})]}),a.jsxs("label",{className:"access-mode-select",children:[a.jsx("span",{children:"Mode"}),a.jsxs("select",{value:Q,onChange:gt("read"),children:[a.jsx("option",{value:"unchanged",children:"Unchanged"}),a.jsx("option",{value:"activated",children:"Activated"})]})]})]}),a.jsx("p",{className:"bulk-access-helper access-helper-text",children:"This adds new access. It does not remove current access."}),re&&a.jsxs("div",{className:"access-section__content",children:[a.jsxs("div",{className:"access-section__grid",children:[a.jsx(Vo,{label:"Read campaigns",count:Z.readCampaignIds.length,options:ut,selectedValues:Z.readCampaignIds,onToggle:ce("readCampaignIds")}),a.jsx(Vo,{label:"Read users",count:Z.readUserIds.length,options:ae,selectedValues:Z.readUserIds,onToggle:ce("readUserIds")})]}),a.jsx(Vo,{label:"Read characters",count:Z.readCharacterIds.length,options:Xe,selectedValues:Z.readCharacterIds,onToggle:ce("readCharacterIds")})]})]}),a.jsxs("div",{className:"access-section",children:[a.jsxs("div",{className:"access-section__header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"access-section__eyebrow",children:"Step 2"}),a.jsx("h3",{children:"Write access"})]}),a.jsxs("label",{className:"access-mode-select",children:[a.jsx("span",{children:"Mode"}),a.jsxs("select",{value:ne,onChange:gt("write"),children:[a.jsx("option",{value:"unchanged",children:"Unchanged"}),a.jsx("option",{value:"activated",children:"Activated"})]})]})]}),a.jsx("p",{className:"bulk-access-helper access-helper-text",children:"This adds new access. It does not remove current access."}),Ne&&a.jsx("div",{className:"access-section__content",children:a.jsxs("div",{className:"access-section__grid",children:[a.jsx(Vo,{label:"Write campaigns",count:Z.writeCampaignIds.length,options:ut,selectedValues:Z.writeCampaignIds,onToggle:ce("writeCampaignIds")}),a.jsx(Vo,{label:"Write users",count:Z.writeUserIds.length,options:ae,selectedValues:Z.writeUserIds,onToggle:ce("writeUserIds")})]})})]}),a.jsxs("label",{className:"bulk-access-description",children:["Description (optional)",a.jsx("textarea",{name:"description",value:Z.description,onChange:dt,rows:1,placeholder:"Explain why this access change was applied"})]}),a.jsxs("div",{className:"bulk-access-summary",children:[ze&&a.jsx("p",{children:ze}),ue&&a.jsx("p",{children:ue}),!ze&&!ue&&a.jsx("p",{className:"bulk-access-helper",children:"No access changes selected yet."}),!ot&&a.jsx("p",{className:"bulk-access-helper warning",children:"Select at least one access type to update."}),re&&!Be&&a.jsx("p",{className:"bulk-access-helper warning",children:"Add at least one read audience."}),Ne&&!Ke&&a.jsx("p",{className:"bulk-access-helper warning",children:"Add at least one write audience."})]}),a.jsxs("div",{className:"bulk-access-footer",children:[a.jsxs("div",{className:"bulk-access-footer__selection-info",children:[a.jsx("strong",{children:kt})," ",kt===1?"entity":"entities"," selected"]}),a.jsx("button",{type:"submit",className:"primary-button",disabled:!qe||B,children:B?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:16})," Applying"]}):"Confirm and Apply"})]})]})]})]})]})}const $w=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],Fw=e=>{if(!e)return"";try{return new Date(e).toLocaleString()}catch{return e}},Cs=(e=[])=>!Array.isArray(e)||e.length===0?"":e.join(", ");function u$(){const{worldId:e}=xs(),t=$n(),{user:r}=En(),[i,l]=u.useState(null),[c,f]=u.useState(""),[m,h]=u.useState(!0),[p,y]=u.useState([]),[g,v]=u.useState(!1),[S,w]=u.useState(""),[N,j]=u.useState(null),[_,C]=u.useState(!1),[O,E]=u.useState(""),[T,M]=u.useState(!1),[A,z]=u.useState(""),P=u.useMemo(()=>!i||!r?!1:String(i.created_by)===String(r.id),[i,r]);u.useEffect(()=>{if(!e){f("Missing world id"),h(!1);return}(async()=>{h(!0),f("");try{const D=await $l(),U=$w(D).find(k=>String(k.id)===String(e));if(!U){f("World not found or unavailable"),l(null);return}l(U)}catch(D){console.error("Failed to load worlds",D),f(D.message||"Unable to load world data"),l(null)}finally{h(!1)}})()},[e]);const X=u.useCallback(async F=>{if(F){w(F),C(!0),E("");try{const D=await t$(F),L=D?.data||D;j(L)}catch(D){console.error("Failed to load run detail",D),E(D.message||"Unable to load run details"),j(null)}finally{C(!1)}}},[]),H=u.useCallback(async()=>{if(!(!e||!P)){v(!0),E("");try{const F=await e$({worldId:e}),D=$w(F);if(y(D),D.length===0){j(null),w("");return}(!S||!D.some(L=>L.id===S))&&await X(D[0].id)}catch(F){console.error("Failed to load bulk runs",F),E(F.message||"Unable to load audit runs"),y([])}finally{v(!1)}}},[X,P,S,e]);u.useEffect(()=>{H()},[H]);const Y=async()=>{if(!(!S||!window.confirm("Revert this entire run? This cannot be undone."))){M(!0),E(""),z("");try{const F=await n$(S),D=F?.data||F;z(`Run ${D.runId} reverted successfully.`),await H(),await X(S)}catch(F){console.error("Failed to revert run",F),E(F.message||"Unable to revert run")}finally{M(!1)}}},V=F=>F?.reverted?"Reverted":"Active",I=(F,D,L)=>a.jsxs("div",{className:"audit-diff-row",children:[a.jsx("span",{className:"audit-diff-label",children:F}),a.jsxs("div",{className:"audit-diff-values",children:[a.jsx("span",{className:"old",children:D}),a.jsx(g1,{size:14}),a.jsx("span",{className:"new",children:L})]})]},F);return m?a.jsx("div",{className:"bulk-audit-page",children:a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading world context"]})}):c?a.jsxs("div",{className:"bulk-audit-page",children:[a.jsxs("div",{className:"bulk-access-alert error",children:[a.jsx(Ta,{size:16})," ",c]}),a.jsx("button",{type:"button",className:"link-button",onClick:()=>t(-1),children:"Go back"})]}):P?a.jsxs("div",{className:"bulk-audit-page",children:[a.jsxs("div",{className:"bulk-access-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"bulk-access-eyebrow",children:"World Admin  Access Audit"}),a.jsxs("h1",{children:["Bulk Access Runs  ",i?.name]})]}),a.jsx("div",{className:"bulk-access-header-actions",children:a.jsx(Jt,{to:`/worlds/${e}/access/bulk`,className:"ghost-button",children:"Back to editor"})})]}),O&&a.jsxs("div",{className:"bulk-access-alert error",children:[a.jsx(Ta,{size:16})," ",O]}),A&&a.jsxs("div",{className:"bulk-access-alert success",children:[a.jsx(_1,{size:16})," ",A]}),a.jsxs("div",{className:"bulk-audit-grid",children:[a.jsxs("section",{className:"bulk-access-card",children:[a.jsxs("header",{children:[a.jsxs("h2",{children:[a.jsx(x1,{size:18})," Audit runs (",p.length,")"]}),a.jsx("button",{type:"button",className:"ghost-button",onClick:H,disabled:g,children:g?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:14})," Refreshing"]}):"Refresh"})]}),a.jsxs("div",{className:"audit-run-list",children:[g&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading runs"]}),!g&&p.length===0&&a.jsx("p",{className:"bulk-access-helper",children:"No bulk access runs have been recorded for this world."}),!g&&p.map(F=>a.jsxs("button",{type:"button",className:`audit-run-row ${S===F.id?"active":""}`,onClick:()=>X(F.id),children:[a.jsxs("div",{children:[a.jsxs("p",{className:"audit-run-title",children:["Run ",F.id]}),a.jsxs("p",{className:"audit-run-meta",children:[Fw(F.createdAt||F.created_at),"  ",F.change_count||F.entity_count||0," entities"]}),a.jsxs("p",{className:"audit-run-meta",children:[F.campaignContext?.name?`Campaign  ${F.campaignContext.name}`:"Scope  World"," ",F.role_used==="dm"?" DM run":" Owner run"]})]}),a.jsx("span",{className:`status-pill ${F.reverted?"reverted":"active"}`,children:V(F)})]},F.id))]})]}),a.jsxs("section",{className:"bulk-access-card",children:[a.jsxs("header",{children:[a.jsx("h2",{children:"Run details"}),N&&a.jsx("button",{type:"button",className:"ghost-button",onClick:Y,disabled:N.reverted||T,children:T?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:14})," Reverting"]}):a.jsxs(a.Fragment,{children:[a.jsx(zl,{size:14})," Revert run"]})})]}),!N&&a.jsx("p",{className:"bulk-access-helper",children:"Select a run to see the access changes."}),_&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading details"]}),N&&!_&&a.jsxs("div",{className:"audit-detail",children:[a.jsxs("div",{className:"audit-detail-meta",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Status:"})," ",N.reverted?"Reverted":"Active"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"User:"})," ",N.actor?.username||"Unknown user"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"User role:"})," ",N.role_used==="dm"?"Campaign DM":"World owner"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Scope:"})," ",N.campaignContext?.name||"World-wide"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Created:"})," ",Fw(N.createdAt||N.created_at)]}),N.description&&a.jsxs("p",{children:[a.jsx("strong",{children:"Description:"})," ",N.description]})]}),a.jsx("div",{className:"audit-changes",children:N.changes?.map(F=>{const D=F.entity?.name||F.entity_id;return a.jsxs("div",{className:"audit-change-card",children:[a.jsxs("div",{className:"audit-change-header",children:[a.jsx("p",{className:"audit-change-title",children:D}),a.jsxs("span",{className:"audit-change-subtitle",children:["Entity ",F.entity_id]})]}),a.jsxs("div",{className:"audit-change-body",children:[I("Read access",F.old_read_access,F.entity?.read_access||""),I("Write access",F.old_write_access,F.entity?.write_access||""),I("Read campaigns",Cs(F.old_read_campaign_names!==void 0?F.old_read_campaign_names:F.old_read_campaign_ids),Cs(F.entity?.read_campaign_names!==void 0?F.entity.read_campaign_names:F.entity?.read_campaign_ids)),I("Read users",Cs(F.old_read_user_names!==void 0?F.old_read_user_names:F.old_read_user_ids),Cs(F.entity?.read_user_names!==void 0?F.entity.read_user_names:F.entity?.read_user_ids)),I("Read characters",Cs(F.old_read_character_ids),Cs(F.entity?.read_character_ids)),I("Write campaigns",Cs(F.old_write_campaign_names!==void 0?F.old_write_campaign_names:F.old_write_campaign_ids),Cs(F.entity?.write_campaign_names!==void 0?F.entity.write_campaign_names:F.entity?.write_campaign_ids)),I("Write users",Cs(F.old_write_user_names!==void 0?F.old_write_user_names:F.old_write_user_ids),Cs(F.entity?.write_user_names!==void 0?F.entity.write_user_names:F.entity?.write_user_ids))]})]},F.id)})})]})]})]})]}):a.jsx("div",{className:"bulk-audit-page",children:a.jsxs("div",{className:"bulk-access-alert warning",children:[a.jsx(Ta,{size:16})," Only the world owner can view audit runs."]})})}const Yo=1e3,Rp=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],kp={name:"",description:"",shared:!1,entityIds:[]};function d$(){const{worldId:e}=xs(),t=$n(),{user:r,sessionReady:i}=En(),[l,c]=u.useState(null),[f,m]=u.useState(!0),[h,p]=u.useState(""),[y,g]=u.useState(!1),[v,S]=u.useState([]),[w,N]=u.useState([]),[j,_]=u.useState(""),[C,O]=u.useState("view"),[E,T]=u.useState(""),[M,A]=u.useState(kp),[z,P]=u.useState(!1),[X,H]=u.useState(""),[Y,V]=u.useState(""),[I,F]=u.useState(!1),[D,L]=u.useState(!1),[U,k]=u.useState(!1),[B,R]=u.useState(null),[q,G]=u.useState(!1),J=u.useMemo(()=>{if(!l||!r)return!1;const ee=l.created_by||l.creator?.id||l.owner?.id||l.owner_id||null;return ee&&r.id&&String(ee)===String(r.id)},[l,r]),ie=u.useCallback(async()=>{if(e)try{const ee=await hj(e),te=Rp(ee);S(te)}catch(ee){console.error("Failed to load collections",ee),p(ee.message||"Failed to load collections")}},[e]),Z=u.useCallback(async()=>{if(e)try{const ee=await lc(e),te=Rp(ee);N(te)}catch(ee){console.error("Failed to load entities for world",ee),p(ee.message||"Failed to load entities for this world")}},[e]);u.useEffect(()=>{if(!i||!e)return;(async()=>{m(!0),p(""),g(!1),c(null);try{const te=await $l(),le=Rp(te).find(Ee=>String(Ee.id)===String(e));if(!le){p("World not found or unavailable");return}c(le);const Se=le.created_by||le.creator?.id||le.owner?.id||le.owner_id||null;if(!r||!Se||String(Se)!==String(r.id)){g(!0);return}await Promise.all([ie(),Z()])}catch(te){console.error("Failed to load collections manager",te),p(te.message||"Failed to load collections manager")}finally{m(!1)}})()},[ie,Z,i,r,e]);const me=ee=>te=>{const ve=ee==="shared"?te.target.checked:te.target.value;A(le=>({...le,[ee]:ve})),P(!0),H(""),V("")},Q=ee=>{H(""),V(""),A(te=>{const ve=new Set(te.entityIds||[]);if(ve.has(ee))ve.delete(ee);else{if(ve.size>=Yo)return H(`Collections can include up to ${Yo} entities.`),te;ve.add(ee)}return P(!0),{...te,entityIds:Array.from(ve)}})},oe=u.useMemo(()=>{if(!j)return w;const ee=j.toLowerCase();return w.filter(te=>(te.name||"").toLowerCase().includes(ee))},[w,j]),ne=u.useMemo(()=>[...v].sort((ee,te)=>ee.shared&&!te.shared?-1:te.shared&&!ee.shared?1:(ee.name||"").localeCompare(te.name||"",void 0,{sensitivity:"base"})),[v]),we=u.useCallback(()=>{T(""),A(kp),O("view"),P(!1),H(""),V("")},[]),ke=u.useCallback(ee=>{ee&&(T(ee.id),A({name:ee.name||"",description:ee.description||"",shared:!!ee.shared,entityIds:Array.isArray(ee.entityIds)?ee.entityIds:[]}),O("edit"),P(!1),H(""),V(""))},[]),Re=ee=>{if(z){R(ee),k(!0);return}Te(ee)},Te=ee=>{k(!1),R(null),ee&&(ee.type==="select"?ke(ee.payload):ee.type==="create"?(O("create"),T(""),A(kp),P(!1),H(""),V("")):ee.type==="close"&&we())},rt=ee=>{Re({type:"select",payload:ee,label:ee.name})},He=()=>{Re({type:"create",label:"start a new collection"})},tt=()=>{Re({type:"close",label:"leave this editor"})},Ie=()=>{k(!1),R(null)},vt=()=>{Te(B)},Ct=u.useCallback(async()=>{if(!e)return H("A world id is required to save this collection."),!1;if(!M.name.trim())return H("Name is required."),!1;if(M.entityIds.length>Yo)return H(`Collections can include up to ${Yo} entities.`),!1;const ee={worldId:e,name:M.name.trim(),description:M.description,shared:M.shared,entityIds:M.entityIds};F(!0),H(""),V("");try{let te;C==="edit"&&E?te=await s$(E,ee):te=await a$(ee);const ve=te?.data||te;return ve?(S(le=>{const Se=le.findIndex(Ee=>Ee.id===ve.id);if(Se>=0){const Ee=[...le];return Ee[Se]=ve,Ee}return[...le,ve]}),ke(ve),O("edit"),V("Collection saved successfully."),P(!1)):await ie(),!0}catch(te){return console.error("Failed to save collection",te),H(te.message||"Failed to save collection"),!1}finally{F(!1)}},[ke,M,ie,C,E,e]),At=async ee=>{ee.preventDefault(),await Ct()},_t=async()=>{if(E&&confirm("Delete this collection? This cannot be undone.")){L(!0),H(""),V("");try{await r$(E),S(ee=>ee.filter(te=>te.id!==E)),we(),V("Collection deleted.")}catch(ee){console.error("Failed to delete collection",ee),H(ee.message||"Failed to delete collection")}finally{L(!1)}}},Pe=async()=>{G(!0);const ee=await Ct();G(!1),ee&&Te(B)};if(u.useEffect(()=>{const ee=te=>{z&&(te.preventDefault(),te.returnValue="")};return window.addEventListener("beforeunload",ee),()=>window.removeEventListener("beforeunload",ee)},[z]),!i)return a.jsx("p",{className:"collections-helper",children:"Restoring session"});if(!e)return a.jsx("p",{className:"collections-helper",children:"World id is required."});if(f)return a.jsx("div",{className:"collections-page",children:a.jsxs("p",{className:"collections-helper",children:[a.jsx(Nn,{size:16,className:"spin"})," Loading collections"]})});if(h)return a.jsxs("div",{className:"collections-page",children:[a.jsxs("div",{className:"collections-alert error",children:[a.jsx(Ta,{size:16})," ",h]}),a.jsx("button",{type:"button",className:"link-button",onClick:()=>t(-1),children:"Go back"})]});if(y||!J)return a.jsx("div",{className:"collections-page",children:a.jsxs("div",{className:"collections-alert warning",children:[a.jsx(Ta,{size:16})," Only the world owner can manage collections."]})});const Ze=l?.name||"",W=M.entityIds.length;return a.jsxs("div",{className:"collections-page",children:[a.jsxs("div",{className:"collections-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"collections-eyebrow",children:"World Admin  Collections"}),a.jsx("h1",{children:Ze})]}),a.jsx("div",{className:"collections-header-actions",children:a.jsx("button",{type:"button",className:"primary-button",onClick:He,children:"New collection"})})]}),Y&&a.jsxs("div",{className:"collections-alert success",children:[a.jsx(Zd,{size:16})," ",Y]}),X&&a.jsxs("div",{className:"collections-alert error",children:[a.jsx(Ta,{size:16})," ",X]}),a.jsxs("div",{className:"collections-grid",children:[a.jsxs("section",{className:"collections-card",children:[a.jsxs("header",{children:[a.jsx("h2",{children:"Collections"}),a.jsxs("p",{className:"collections-helper",children:[v.length," saved  Shared sets are available to campaign DMs"]})]}),a.jsx("div",{className:"collections-table-wrapper",children:ne.length===0?a.jsx("p",{className:"collections-helper",children:"No collections yet. Create one to get started."}):a.jsxs("table",{className:"collections-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Name"}),a.jsx("th",{children:"Shared"}),a.jsx("th",{children:"Entities"}),a.jsx("th",{children:"Updated"})]})}),a.jsx("tbody",{children:ne.map(ee=>{const te=E===ee.id;return a.jsxs("tr",{className:te?"active":"",onClick:()=>rt(ee),children:[a.jsxs("td",{children:[a.jsx("span",{className:"collection-name",children:ee.name}),ee.description&&a.jsx("span",{className:"collection-description",children:ee.description})]}),a.jsx("td",{children:ee.shared?a.jsxs("span",{className:"shared-chip",children:[a.jsx(C1,{size:14})," Shared"]}):a.jsx("span",{className:"shared-chip private",children:"Owner only"})}),a.jsx("td",{children:ee.entityCount??ee.entity_ids?.length??0}),a.jsx("td",{children:ee.updatedAt?new Date(ee.updatedAt).toLocaleString():""})]},ee.id)})})]})})]}),a.jsx("section",{className:"collections-card",children:C==="view"&&!E?a.jsx("div",{className:"collections-placeholder",children:a.jsx("p",{children:"Select a collection to edit or create a new one."})}):a.jsxs("form",{className:"collections-form",onSubmit:At,children:[a.jsxs("header",{children:[a.jsx("h2",{children:C==="edit"?"Edit collection":"New collection"}),a.jsxs("p",{className:"collections-helper",children:[W,"/",Yo," entities selected"]})]}),a.jsxs("label",{children:["Name",a.jsx("input",{type:"text",value:M.name,onChange:me("name"),required:!0})]}),a.jsxs("label",{children:["Description (optional)",a.jsx("textarea",{value:M.description,onChange:me("description"),rows:3})]}),a.jsxs("label",{className:"checkbox-label",children:[a.jsx("input",{type:"checkbox",checked:M.shared,onChange:me("shared")}),"Share with DMs in this world"]}),a.jsxs("div",{className:"collections-entity-picker",children:[a.jsxs("div",{className:"collections-entity-toolbar",children:[a.jsx("span",{children:"Entities"}),a.jsx("input",{type:"text",placeholder:"Filter by name",value:j,onChange:ee=>_(ee.target.value)})]}),a.jsx("div",{className:"collections-entity-list",children:oe.length===0?a.jsx("p",{className:"collections-helper",children:"No entities match this filter."}):a.jsx("ul",{children:oe.map(ee=>{const te=M.entityIds.includes(ee.id);return a.jsx("li",{children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:te,onChange:()=>Q(ee.id)}),a.jsx("span",{className:"entity-name",children:ee.name}),a.jsx("span",{className:"entity-type",children:ee.entityType?.name||""})]})},ee.id)})})})]}),a.jsxs("div",{className:"collections-form-actions",children:[a.jsx("button",{type:"submit",className:"primary-button",disabled:I,children:I?"Saving":"Save collection"}),C==="edit"&&a.jsx("button",{type:"button",className:"ghost-button",onClick:_t,disabled:D,children:D?"Deleting":"Delete"}),a.jsx("button",{type:"button",className:"ghost-button",onClick:tt,children:"Close"})]})]})})]}),a.jsx(pN,{open:U,destinationLabel:B?.label||"",saving:q,onSaveAndContinue:Pe,onContinueWithoutSaving:vt,onStay:Ie})]})}function f$(){const e=Zr();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function m$(e,t="request"){if(e.status===401)throw new Error("Unauthorized");if(!e.ok){const r=await e.json().catch(()=>({message:"Unknown error"}));throw new Error(r.message||`Failed to ${t}`)}return e.json()}async function h$(e,t){const r=await fetch(`${Cn}/auth/change-password`,{method:"POST",headers:f$(),body:JSON.stringify({currentPassword:e,newPassword:t})});return m$(r,"change password")}function p$(){const[e,t]=u.useState(""),[r,i]=u.useState(""),[l,c]=u.useState(""),[f,m]=u.useState(""),[h,p]=u.useState(""),[y,g]=u.useState(!1),v=async S=>{S.preventDefault(),m(""),p(""),g(!0);try{if(!e||!r||!l){m("All fields are required"),g(!1);return}if(r.length<6){m("New password must be at least 6 characters long"),g(!1);return}if(r!==l){m("New password and confirmation do not match"),g(!1);return}await h$(e,r),p("Password changed successfully"),t(""),i(""),c("")}catch(w){m(w.message||"Failed to change password. Please try again.")}finally{g(!1)}};return a.jsx("div",{className:"settings-page",children:a.jsxs("div",{className:"settings-container",children:[a.jsxs("div",{className:"settings-header",children:[a.jsx("h1",{className:"settings-title",children:"Security"}),a.jsx("p",{className:"settings-subtitle",children:"Manage your account security"})]}),a.jsxs("div",{className:"settings-section",children:[a.jsx("h2",{className:"settings-section-title",children:"Change Password"}),a.jsx("p",{className:"settings-section-description",children:"Enter your current password and choose a new password to update your account security."}),a.jsxs("form",{onSubmit:v,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"current-password",children:"Current Password"}),a.jsx("input",{id:"current-password",type:"password",value:e,onChange:S=>t(S.target.value),placeholder:"Enter current password",required:!0,disabled:y})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"new-password",children:"New Password"}),a.jsx("input",{id:"new-password",type:"password",value:r,onChange:S=>i(S.target.value),placeholder:"Enter new password (minimum 6 characters)",required:!0,minLength:6,disabled:y})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"confirm-password",children:"Confirm New Password"}),a.jsx("input",{id:"confirm-password",type:"password",value:l,onChange:S=>c(S.target.value),placeholder:"Confirm new password",required:!0,disabled:y})]}),f&&a.jsx("p",{className:"error-msg",children:f}),h&&a.jsx("p",{className:"success-msg",children:h}),a.jsx("button",{type:"submit",disabled:y,className:"settings-submit-btn",children:y?"Changing password...":"Change Password"})]})]})]})})}const y$=[{value:"",label:"All types"},{value:"entity_comment",label:"Entity comments"},{value:"entity_mention_entity_note",label:"Entity mentions (notes)"},{value:"entity_mention_session_note",label:"Entity mentions (sessions)"},{value:"session_note_added",label:"Session notes"},{value:"session_note_updated",label:"Session notes"},{value:"request_note_added",label:"Feature/Bug notes"},{value:"request_status_changed",label:"Feature/Bug status"},{value:"request_assigned",label:"Feature/Bug assignments"}],g$=e=>{const{type:t,metadata:r={}}=e;switch(t){case"entity_comment":return`${r.author_name||"Someone"} commented on ${r.entity_name||"an entity"}`;case"entity_mention_entity_note":return`${r.author_name||"Someone"} mentioned ${r.related_entity_name||"an entity"} in a note`;case"entity_mention_session_note":return`${r.author_name||"Someone"} mentioned ${r.related_entity_name||"an entity"} in a session note`;case"session_note_added":return`${r.author_name||"Someone"} created a session note${r.campaign_name?` for ${r.campaign_name}`:""}: ${r.session_title||"Untitled"}`;case"session_note_updated":return`${r.author_name||"Someone"} updated a session note${r.campaign_name?` for ${r.campaign_name}`:""}: ${r.session_title||"Untitled"}`;case"request_note_added":return`${r.author_name||"Someone"} added a note to "${r.request_title||"a feature/bug"}"`;case"request_status_changed":return`Status changed for "${r.request_title||"a feature/bug"}"`;case"request_assigned":return`You were assigned to "${r.request_title||"a feature/bug"}"`;default:return"New notification"}},b$=e=>{if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const i=new Date-t,l=Math.floor(i/6e4),c=Math.floor(i/36e5),f=Math.floor(i/864e5);return l<1?"Just now":l<60?`${l}m ago`:c<24?`${c}h ago`:f<7?`${f}d ago`:t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})};function v$(){const{notifications:e,markRead:t,markAllRead:r,refresh:i}=$1(),{selectedCampaignId:l,campaigns:c,setSelectedCampaignId:f}=Bn(),m=$n(),[h,p]=u.useState(!1),[y,g]=u.useState([]),[v,S]=u.useState(1),[w,N]=u.useState(!0),[j,_]=u.useState(""),[C,O]=u.useState(""),[E,T]=u.useState(l||""),[M,A]=u.useState({open:!1,notification:null}),z=async(L=1,U=!1)=>{p(!0);try{const k={page:L,limit:50};j==="unread"?k.read="false":j==="read"&&(k.read="true"),C&&(k.type=C),E&&(k.campaignId=E);const B=await O1(k),R=Array.isArray(B?.data)?B.data:[],q=B?.pagination||{};g(U?G=>[...G,...R]:R),N(q.page<q.pages)}catch(k){console.error("Failed to load notifications",k)}finally{p(!1)}};u.useEffect(()=>{z(1,!1)},[j,C,E]);const P=async L=>{try{await t(L.id),g(U=>U.map(k=>k.id===L.id?{...k,read:!0,readAt:new Date().toISOString()}:k))}catch(U){console.error("Failed to mark notification read",U)}},X=async()=>{try{const L={};E&&(L.campaignId=E),C&&(L.type=C),await r(L),i(),z(v,!1)}catch(L){console.error("Failed to mark all notifications read",L)}},H=L=>{if(L.actionUrl)m(L.actionUrl);else{const{type:U,metadata:k={}}=L;if(U==="entity_comment"||U==="entity_mention_entity_note"){const B=k.entity_id||k.related_entity_id,R=L.campaignId||L.campaign?.id||E;B&&m(`/entities/${B}${R?`?campaignId=${R}`:""}#notes`)}else if(U==="session_note_added"||U==="session_note_updated"||U==="entity_mention_session_note"){const B=L.campaignId||L.campaign?.id||k.target_id||E;m(`/notes/session${B?`?campaignId=${B}`:""}`)}else if(U==="request_note_added"||U==="request_status_changed"||U==="request_assigned"){const B=k.request_id||k.requestId;m(B?`/requests/${B}`:"/requests")}}},Y=async L=>{L.read||await P(L);const U=L.campaignId||L.campaign?.id||"";if(U&&U!==(l||"")){A({open:!0,notification:L});return}H(L)},V=()=>{const{notification:L}=M;if(!L)return;const U=L.campaignId||L.campaign?.id||"";U&&f(U),A({open:!1,notification:null}),setTimeout(()=>{H(L)},100)},I=()=>{A({open:!1,notification:null})},F=y.filter(L=>!L.read).length,D=u.useMemo(()=>[{value:"",label:"All campaigns"},...(c||[]).map(L=>({value:L.id,label:L.name}))],[c]);return a.jsxs("div",{className:"notification-list-page",children:[a.jsxs("div",{className:"notification-list-header",children:[a.jsx("h1",{children:"Notifications"}),a.jsx("div",{className:"notification-list-actions",children:F>0&&a.jsxs("button",{type:"button",className:"notification-list-mark-all-read",onClick:X,disabled:h,children:[a.jsx(rT,{size:18}),"Mark all read"]})})]}),a.jsxs("div",{className:"notification-list-filters",children:[a.jsxs("select",{className:"notification-list-filter",value:j,onChange:L=>{_(L.target.value),S(1)},children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"unread",children:"Unread"}),a.jsx("option",{value:"read",children:"Read"})]}),a.jsx("select",{className:"notification-list-filter",value:C,onChange:L=>{O(L.target.value),S(1)},children:y$.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))}),a.jsx("select",{className:"notification-list-filter",value:E,onChange:L=>{T(L.target.value),S(1)},children:D.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))})]}),a.jsxs("div",{className:"notification-list-content",children:[h&&y.length===0?a.jsx("div",{className:"notification-list-empty",children:"Loading..."}):y.length===0?a.jsxs("div",{className:"notification-list-empty",children:[a.jsx("p",{children:"No notifications found."}),a.jsx("p",{className:"notification-list-empty-hint",children:"You're all caught up!"})]}):a.jsx("div",{className:"notification-list-items",children:y.map(L=>a.jsxs("div",{className:`notification-list-item ${L.read?"read":"unread"}`,onClick:()=>Y(L),children:[a.jsxs("div",{className:"notification-list-item-content",children:[a.jsxs("div",{className:"notification-list-item-header",children:[a.jsx("p",{className:"notification-list-item-message",children:g$(L)}),!L.read&&a.jsx("div",{className:"notification-list-item-dot"})]}),a.jsxs("div",{className:"notification-list-item-meta",children:[a.jsx("span",{className:"notification-list-item-time",children:b$(L.createdAt)}),L.campaign&&a.jsx("span",{className:"notification-list-item-campaign",children:L.campaign.name})]})]}),!L.read&&a.jsx("button",{type:"button",className:"notification-list-item-mark-read",onClick:U=>{U.stopPropagation(),P(L)},title:"Mark as read",children:a.jsx(b1,{size:16})})]},L.id))}),w&&a.jsx("div",{className:"notification-list-load-more",children:a.jsx("button",{type:"button",onClick:()=>{const L=v+1;S(L),z(L,!0)},disabled:h,children:h?"Loading...":"Load more"})})]}),a.jsx(F1,{open:M.open,campaignName:M.notification?.campaign?.name||"",onSwitch:V,onCancel:I})]})}function x$(){const{selectedCampaignId:e,campaigns:t}=Bn(),[r,i]=u.useState([]),[l,c]=u.useState(!1),[f,m]=u.useState(e||""),[h,p]=u.useState(null),y=async()=>{c(!0);try{const w=await u4(f||void 0),N=Array.isArray(w?.data)?w.data:[];i(N)}catch(w){console.error("Failed to load followed entities",w)}finally{c(!1)}};u.useEffect(()=>{y()},[f]);const g=async(w,N)=>{if(!(!w||!N||h===w)){p(w);try{await mN(w,N),i(j=>j.filter(_=>!(_.entityId===w&&_.campaignId===N)))}catch(j){console.error("Failed to unfollow entity",j)}finally{p(null)}}},v=u.useMemo(()=>[{value:"",label:"All campaigns"},...(t||[]).map(w=>({value:w.id,label:w.name}))],[t]),S=u.useMemo(()=>{const w={};return r.forEach(N=>{const j=N.campaignId||"no-campaign";w[j]||(w[j]={campaign:N.campaign,entities:[]}),w[j].entities.push(N)}),w},[r]);return a.jsxs("div",{className:"followed-entities-page",children:[a.jsxs("div",{className:"followed-entities-header",children:[a.jsx("h1",{children:"Followed Entities"}),a.jsx("div",{className:"followed-entities-actions",children:a.jsx("select",{className:"followed-entities-filter",value:f,onChange:w=>m(w.target.value),children:v.map(w=>a.jsx("option",{value:w.value,children:w.label},w.value))})})]}),a.jsx("div",{className:"followed-entities-content",children:l?a.jsx("div",{className:"followed-entities-empty",children:"Loading..."}):r.length===0?a.jsxs("div",{className:"followed-entities-empty",children:[a.jsx("p",{children:"No followed entities found."}),a.jsx("p",{className:"followed-entities-empty-hint",children:"Follow entities from their detail pages to receive notifications when they're commented on or mentioned."})]}):a.jsx("div",{className:"followed-entities-list",children:Object.entries(S).map(([w,N])=>a.jsxs("div",{className:"followed-entities-group",children:[a.jsx("h2",{className:"followed-entities-group-title",children:N.campaign?.name||"No campaign context"}),a.jsx("div",{className:"followed-entities-items",children:N.entities.map(j=>a.jsxs("div",{className:"followed-entities-item",children:[a.jsx(Jt,{to:`/entities/${j.entityId}${j.campaignId?`?campaignId=${j.campaignId}`:""}`,className:"followed-entities-item-link",children:a.jsxs("div",{className:"followed-entities-item-content",children:[a.jsx("h3",{className:"followed-entities-item-name",children:j.entity?.name||"Unnamed entity"}),j.entity?.entityType&&a.jsx("span",{className:"followed-entities-item-type",children:j.entity.entityType.name})]})}),a.jsx("button",{type:"button",className:"followed-entities-item-unfollow",onClick:()=>g(j.entityId,j.campaignId),disabled:h===j.entityId,title:"Unfollow",children:h===j.entityId?a.jsx(Td,{size:18}):a.jsx(ky,{size:18})})]},`${j.entityId}-${j.campaignId}`))})]},w))})})]})}const S$=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([l,c])=>{c!=null&&c!==""&&t.set(l,c)});const r=t.toString(),i=r?`/requests?${r}`:"/requests";return Tt.get(i)},w$=e=>Tt.get(`/requests/${e}`),N$=e=>Tt.post("/requests",e),E$=(e,t)=>Tt.patch(`/requests/${e}`,t),j$=e=>Tt.delete(`/requests/${e}`),_$={open:"blue",in_progress:"orange",testing:"yellow",resolved:"green",closed:"gray",backlog:"purple"};function pj({status:e}){const t=_$[e]||"gray",r=e?e.split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" "):"Unknown";return a.jsx("span",{className:`request-status-badge request-status-badge--${t}`,children:r})}function C$({request:e}){const t=r=>{if(!r)return"";const i=new Date(r);if(Number.isNaN(i.getTime()))return"";const c=new Date-i,f=Math.floor(c/6e4),m=Math.floor(c/36e5),h=Math.floor(c/864e5);return f<1?"Just now":f<60?`${f}m ago`:m<24?`${m}h ago`:h<7?`${h}d ago`:i.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})};return a.jsxs(Jt,{to:`/requests/${e.id}`,className:"request-card",children:[a.jsxs("div",{className:"request-card__header",children:[a.jsxs("div",{className:"request-card__type",children:[e.type==="bug"?a.jsx(Dy,{size:16,className:"request-card__type-icon"}):a.jsx(Ii,{size:16,className:"request-card__type-icon"}),a.jsx("span",{className:"request-card__type-label",children:e.type==="bug"?"Bug":"Feature"})]}),a.jsx(pj,{status:e.status})]}),a.jsx("h3",{className:"request-card__title",children:e.title}),a.jsx("p",{className:"request-card__description",children:e.description.length>150?`${e.description.substring(0,150)}...`:e.description}),a.jsxs("div",{className:"request-card__footer",children:[a.jsxs("div",{className:"request-card__meta",children:[a.jsxs("span",{className:"request-card__creator",children:["by ",e.creator?.username||"Unknown"]}),e.assignee&&a.jsxs("span",{className:"request-card__assignee",children:[" ",e.assignee.username]})]}),a.jsxs("div",{className:"request-card__time",children:[a.jsx(Ly,{size:14}),a.jsx("span",{children:t(e.createdAt)})]})]})]})}function A$(){const{user:e}=En(),t=e?.role==="system_admin",[r,i]=u.useState([]),[l,c]=u.useState(!1),[f,m]=u.useState({type:"",status:"",isInBacklog:""}),[h,p]=u.useState({page:1,limit:20,total:0,pages:0}),y=async(w=1)=>{c(!0);try{const N={page:w,limit:h.limit,...f};Object.keys(N).forEach(_=>{(N[_]===""||N[_]===null||N[_]===void 0)&&delete N[_]});const j=await S$(N);i(Array.isArray(j?.data)?j.data:[]),p(j?.pagination||h)}catch(N){console.error("Failed to load requests",N),alert("Failed to load requests")}finally{c(!1)}};u.useEffect(()=>{y(1)},[f]);const g=(w,N)=>{m(j=>({...j,[w]:N}))},v=()=>{m({type:"",status:"",isInBacklog:""})},S=Object.values(f).some(w=>w!=="");return a.jsxs("div",{className:"request-list-page",children:[a.jsxs("div",{className:"request-list-page__header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Feature/Bugs"}),a.jsxs("div",{className:"request-list-page__subtitle-wrapper",children:[a.jsx("p",{className:"request-list-page__subtitle",children:t?"All bug reports and feature requests":"Your bug reports and feature requests"}),t&&a.jsx("span",{className:"request-list-page__admin-badge",children:"Admin View"})]})]}),a.jsxs(Jt,{to:"/requests/new",className:"request-list-page__create-button",children:[a.jsx(Va,{size:20}),"New Request"]})]}),a.jsxs("div",{className:"request-list-page__filters",children:[a.jsxs("div",{className:"request-list-page__filter-group",children:[a.jsx(Qd,{size:16}),a.jsx("label",{htmlFor:"filter-type",children:"Type:"}),a.jsxs("select",{id:"filter-type",value:f.type,onChange:w=>g("type",w.target.value),className:"request-list-page__filter-select",children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"bug",children:"Bug"}),a.jsx("option",{value:"feature",children:"Feature"})]})]}),a.jsxs("div",{className:"request-list-page__filter-group",children:[a.jsx("label",{htmlFor:"filter-status",children:"Status:"}),a.jsxs("select",{id:"filter-status",value:f.status,onChange:w=>g("status",w.target.value),className:"request-list-page__filter-select",children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"open",children:"Open"}),a.jsx("option",{value:"in_progress",children:"In Progress"}),a.jsx("option",{value:"testing",children:"Testing"}),a.jsx("option",{value:"resolved",children:"Resolved"}),a.jsx("option",{value:"closed",children:"Closed"}),a.jsx("option",{value:"backlog",children:"Backlog"})]})]}),t&&a.jsxs("div",{className:"request-list-page__filter-group",children:[a.jsx("label",{htmlFor:"filter-backlog",children:"Backlog:"}),a.jsxs("select",{id:"filter-backlog",value:f.isInBacklog,onChange:w=>g("isInBacklog",w.target.value),className:"request-list-page__filter-select",children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"true",children:"In Backlog"}),a.jsx("option",{value:"false",children:"Not in Backlog"})]})]}),S&&a.jsx("button",{onClick:v,className:"request-list-page__clear-filters",children:"Clear Filters"})]}),l?a.jsx("div",{className:"request-list-page__loading",children:"Loading requests..."}):r.length===0?a.jsxs("div",{className:"request-list-page__empty",children:[a.jsx("p",{children:"No requests found"}),a.jsx(Jt,{to:"/requests/new",className:"request-list-page__empty-link",children:"Create your first request"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"request-list-page__grid",children:r.map(w=>a.jsx(C$,{request:w},w.id))}),h.pages>1&&a.jsxs("div",{className:"request-list-page__pagination",children:[a.jsx("button",{onClick:()=>y(h.page-1),disabled:h.page<=1,className:"request-list-page__pagination-button",children:"Previous"}),a.jsxs("span",{className:"request-list-page__pagination-info",children:["Page ",h.page," of ",h.pages," (",h.total," total)"]}),a.jsx("button",{onClick:()=>y(h.page+1),disabled:h.page>=h.pages,className:"request-list-page__pagination-button",children:"Next"})]})]})]})}const yj=e=>Tt.get(`/requests/${e}/notes`),gj=(e,t)=>Tt.post(`/requests/${e}/notes`,t),T$=(e,t,r)=>Tt.patch(`/requests/${e}/notes/${t}`,r),bj=(e,t)=>Tt.delete(`/requests/${e}/notes/${t}`),M$=Object.freeze(Object.defineProperty({__proto__:null,createRequestNote:gj,deleteRequestNote:bj,fetchRequestNotes:yj,updateRequestNote:T$},Symbol.toStringTag,{value:"Module"}));function R$({onSubmit:e,loading:t=!1}){const[r,i]=u.useState(""),l=c=>{c.preventDefault(),r.trim()&&(e(r.trim()),i(""))};return a.jsxs("form",{onSubmit:l,className:"request-note-form",children:[a.jsx("textarea",{value:r,onChange:c=>i(c.target.value),placeholder:"Add a note...",className:"request-note-form__textarea",rows:3,disabled:t}),a.jsx("div",{className:"request-note-form__actions",children:a.jsxs("button",{type:"submit",disabled:!r.trim()||t,className:"request-note-form__submit",children:[a.jsx(lM,{size:16}),t?"Adding...":"Add Note"]})})]})}function k$({requestId:e,canAddNote:t}){const{user:r}=En(),[i,l]=u.useState([]),[c,f]=u.useState(!1),[m,h]=u.useState(!1),[p,y]=u.useState(null),[g,v]=u.useState(""),S=async()=>{f(!0);try{const E=await yj(e);l(Array.isArray(E?.data)?E.data:[])}catch(E){console.error("Failed to load notes",E)}finally{f(!1)}};u.useEffect(()=>{e&&S()},[e]);const w=async E=>{h(!0);try{await gj(e,{content:E}),await S()}catch(T){console.error("Failed to add note",T),alert("Failed to add note")}finally{h(!1)}},N=async E=>{if(confirm("Are you sure you want to delete this note?"))try{await bj(e,E),await S()}catch(T){console.error("Failed to delete note",T),alert("Failed to delete note")}},j=E=>{y(E.id),v(E.content)},_=()=>{y(null),v("")},C=async E=>{try{const{updateRequestNote:T}=await Q1(async()=>{const{updateRequestNote:M}=await Promise.resolve().then(()=>M$);return{updateRequestNote:M}},void 0);await T(e,E,{content:g}),y(null),v(""),await S()}catch(T){console.error("Failed to update note",T),alert("Failed to update note")}},O=E=>{if(!E)return"";const T=new Date(E);if(Number.isNaN(T.getTime()))return"";const A=new Date-T,z=Math.floor(A/6e4),P=Math.floor(A/36e5),X=Math.floor(A/864e5);return z<1?"Just now":z<60?`${z}m ago`:P<24?`${P}h ago`:X<7?`${X}d ago`:T.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})};return c?a.jsx("div",{className:"request-notes__loading",children:"Loading notes..."}):a.jsxs("div",{className:"request-notes",children:[a.jsxs("div",{className:"request-notes__header",children:[a.jsx(VT,{size:20}),a.jsxs("h3",{children:["Notes (",i.length,")"]})]}),t&&a.jsx(R$,{onSubmit:w,loading:m}),a.jsx("div",{className:"request-notes__list",children:i.length===0?a.jsx("div",{className:"request-notes__empty",children:"No notes yet"}):i.map(E=>a.jsx("div",{className:"request-note",children:p===E.id?a.jsxs("div",{className:"request-note__edit",children:[a.jsx("textarea",{value:g,onChange:T=>v(T.target.value),className:"request-note__edit-textarea",rows:3}),a.jsxs("div",{className:"request-note__edit-actions",children:[a.jsx("button",{onClick:()=>C(E.id),className:"request-note__edit-save",children:"Save"}),a.jsx("button",{onClick:_,className:"request-note__edit-cancel",children:"Cancel"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"request-note__content",children:E.content}),a.jsxs("div",{className:"request-note__footer",children:[a.jsxs("div",{className:"request-note__meta",children:[a.jsx("span",{className:"request-note__author",children:E.author?.username||"Unknown"}),a.jsx("span",{className:"request-note__time",children:O(E.createdAt)})]}),r?.id===E.createdBy&&a.jsxs("div",{className:"request-note__actions",children:[a.jsx("button",{onClick:()=>j(E),className:"request-note__action",title:"Edit note",children:a.jsx(E1,{size:14})}),a.jsx("button",{onClick:()=>N(E.id),className:"request-note__action",title:"Delete note",children:a.jsx(ma,{size:14})})]})]})]})},E.id))})]})}function D$(){const{id:e}=xs(),t=$n(),{user:r}=En(),i=r?.role==="system_admin",[l,c]=u.useState(null),[f,m]=u.useState(!1),[h,p]=u.useState(!1),[y,g]=u.useState([]),[v,S]=u.useState(!1),[w,N]=u.useState(!1),[j,_]=u.useState({status:"",assignedTo:"",testerId:"",priority:"",isInBacklog:!1}),C=async()=>{m(!0);try{const A=await w$(e);if(A?.success&&A?.data){const z=A.data;c(z),_({status:z.status||"",assignedTo:z.assignedTo||"",testerId:z.testerId||"",priority:z.priority||"",isInBacklog:z.isInBacklog||!1})}else throw new Error("Request not found")}catch(A){console.error("Failed to load request",A),alert(A.message||"Failed to load request"),t("/requests")}finally{m(!1)}};u.useEffect(()=>{e&&C()},[e]),u.useEffect(()=>{i&&w&&O()},[i,w]);const O=async()=>{S(!0);try{const A=await Qy();g(Array.isArray(A?.data)?A.data:[])}catch(A){console.error("Failed to load users",A)}finally{S(!1)}},E=async()=>{p(!0);try{const A={};if(j.status&&j.status!==l.status&&(A.status=j.status),j.assignedTo!==l.assignedTo&&(A.assignedTo=j.assignedTo||null),j.testerId!==l.testerId&&(A.testerId=j.testerId||null),j.priority!==l.priority&&(A.priority=j.priority||null),j.isInBacklog!==l.isInBacklog&&(A.isInBacklog=j.isInBacklog),Object.keys(A).length===0){N(!1);return}await E$(e,A),await C(),N(!1)}catch(A){console.error("Failed to update request",A),alert("Failed to update request")}finally{p(!1)}},T=async()=>{if(confirm("Are you sure you want to delete this request? This action cannot be undone."))try{await j$(e),t("/requests")}catch(A){console.error("Failed to delete request",A),alert("Failed to delete request")}},M=l&&(i||String(l.createdBy)===String(r?.id)||String(l.testerId)===String(r?.id));return f?a.jsx("div",{className:"request-detail-page__loading",children:"Loading request..."}):l?a.jsxs("div",{className:"request-detail-page",children:[a.jsxs("div",{className:"request-detail-page__header",children:[a.jsxs(Jt,{to:"/requests",className:"request-detail-page__back",children:[a.jsx(Ry,{size:20}),"Back to Feature/Bugs"]}),a.jsxs("div",{className:"request-detail-page__title-section",children:[a.jsxs("div",{className:"request-detail-page__type-badge",children:[l.type==="bug"?a.jsx(Dy,{size:20,className:"request-detail-page__type-icon"}):a.jsx(Ii,{size:20,className:"request-detail-page__type-icon"}),a.jsx("span",{children:l.type==="bug"?"Bug":"Feature"})]}),a.jsx("h1",{children:l.title}),a.jsxs("div",{className:"request-detail-page__meta",children:[a.jsx(pj,{status:l.status}),l.priority&&a.jsxs("span",{className:"request-detail-page__priority",children:["Priority: ",l.priority]}),l.isInBacklog&&a.jsx("span",{className:"request-detail-page__backlog-badge",children:"In Backlog"})]})]})]}),a.jsx("div",{className:"request-detail-page__content",children:a.jsxs("div",{className:"request-detail-page__main",children:[a.jsxs("div",{className:"request-detail-page__section",children:[a.jsx("h2",{children:"Description"}),a.jsx("div",{className:"request-detail-page__description",children:l.description.split(`
`).map((A,z)=>a.jsx("p",{children:A},z))})]}),a.jsxs("div",{className:"request-detail-page__section",children:[a.jsx("h2",{children:"Details"}),a.jsxs("dl",{className:"request-detail-page__details",children:[a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Created by:"}),a.jsx("dd",{children:l.creator?.username||"Unknown"})]}),a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Created:"}),a.jsx("dd",{children:new Date(l.createdAt).toLocaleString()})]}),l.assignee&&a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Assigned to:"}),a.jsx("dd",{children:l.assignee.username})]}),l.tester&&a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Tester:"}),a.jsx("dd",{children:l.tester.username})]}),l.updatedAt!==l.createdAt&&a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Last updated:"}),a.jsx("dd",{children:new Date(l.updatedAt).toLocaleString()})]})]})]}),i&&a.jsxs("div",{className:"request-detail-page__section",children:[a.jsxs("div",{className:"request-detail-page__admin-header",children:[a.jsx("h2",{children:"Admin Controls"}),a.jsxs("button",{onClick:()=>N(!w),className:`request-detail-page__admin-toggle ${w?"request-detail-page__admin-toggle--active":""}`,type:"button",children:[a.jsx(j1,{size:18}),a.jsx("span",{children:w?"Hide Controls":"Show Controls"}),a.jsx(Br,{size:16,className:`request-detail-page__admin-toggle-icon ${w?"request-detail-page__admin-toggle-icon--rotated":""}`})]})]}),w&&a.jsxs("div",{className:"request-detail-page__admin-form",children:[a.jsxs("div",{className:"request-detail-page__admin-field",children:[a.jsx("label",{children:"Status:"}),a.jsxs("select",{value:j.status,onChange:A=>_(z=>({...z,status:A.target.value})),className:"request-detail-page__admin-select",children:[a.jsx("option",{value:"open",children:"Open"}),a.jsx("option",{value:"in_progress",children:"In Progress"}),a.jsx("option",{value:"testing",children:"Testing"}),a.jsx("option",{value:"resolved",children:"Resolved"}),a.jsx("option",{value:"closed",children:"Closed"}),a.jsx("option",{value:"backlog",children:"Backlog"})]})]}),a.jsxs("div",{className:"request-detail-page__admin-field",children:[a.jsx("label",{children:"Tester:"}),a.jsxs("select",{value:j.testerId,onChange:A=>_(z=>({...z,testerId:A.target.value})),className:"request-detail-page__admin-select",disabled:v,children:[a.jsx("option",{value:"",children:"None"}),y.map(A=>a.jsxs("option",{value:A.id,children:[A.username," ",A.email?`(${A.email})`:""]},A.id))]})]}),a.jsxs("div",{className:"request-detail-page__admin-field",children:[a.jsx("label",{children:"Priority:"}),a.jsxs("select",{value:j.priority,onChange:A=>_(z=>({...z,priority:A.target.value})),className:"request-detail-page__admin-select",children:[a.jsx("option",{value:"",children:"None"}),a.jsx("option",{value:"low",children:"Low"}),a.jsx("option",{value:"medium",children:"Medium"}),a.jsx("option",{value:"high",children:"High"})]})]}),a.jsx("div",{className:"request-detail-page__admin-field",children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:j.isInBacklog,onChange:A=>_(z=>({...z,isInBacklog:A.target.checked}))}),"In Backlog"]})}),a.jsxs("div",{className:"request-detail-page__admin-actions",children:[a.jsx("button",{onClick:E,disabled:h,className:"request-detail-page__admin-save",children:h?"Saving...":"Save Changes"}),a.jsxs("button",{onClick:T,className:"request-detail-page__admin-delete",children:[a.jsx(ma,{size:16}),"Delete Request"]})]})]})]}),a.jsx(k$,{requestId:e,canAddNote:M})]})})]}):null}function I$(){const e=$n(),[t,r]=u.useState(!1),[i,l]=u.useState({type:"bug",title:"",description:"",priority:""}),[c,f]=u.useState({}),m=y=>{const{name:g,value:v}=y.target;l(S=>({...S,[g]:v})),c[g]&&f(S=>({...S,[g]:""}))},h=()=>{const y={};return i.title.trim()||(y.title="Title is required"),i.description.trim()||(y.description="Description is required"),f(y),Object.keys(y).length===0},p=async y=>{if(y.preventDefault(),!!h()){r(!0);try{const g={type:i.type,title:i.title.trim(),description:i.description.trim(),priority:i.priority||null},v=await N$(g);if(v?.success&&v?.data?.id)e(`/requests/${v.data.id}`);else throw new Error("Failed to create request")}catch(g){console.error("Failed to create request",g),alert(g.message||"Failed to create request")}finally{r(!1)}}};return a.jsxs("div",{className:"create-request-page",children:[a.jsxs("div",{className:"create-request-page__header",children:[a.jsxs("button",{onClick:()=>e("/requests"),className:"create-request-page__back",children:[a.jsx(Ry,{size:20}),"Back to Feature/Bugs"]}),a.jsx("h1",{children:"Create Feature/Bug Request"})]}),a.jsxs("form",{onSubmit:p,className:"create-request-form",children:[a.jsxs("div",{className:"create-request-form__section",children:[a.jsx("label",{className:"create-request-form__label",children:"Type"}),a.jsxs("div",{className:"create-request-form__type-options",children:[a.jsxs("label",{className:"create-request-form__type-option",children:[a.jsx("input",{type:"radio",name:"type",value:"bug",checked:i.type==="bug",onChange:m}),a.jsx(Dy,{size:20}),a.jsx("span",{children:"Bug"})]}),a.jsxs("label",{className:"create-request-form__type-option",children:[a.jsx("input",{type:"radio",name:"type",value:"feature",checked:i.type==="feature",onChange:m}),a.jsx(Ii,{size:20}),a.jsx("span",{children:"Feature"})]})]})]}),a.jsxs("div",{className:"create-request-form__section",children:[a.jsxs("label",{htmlFor:"title",className:"create-request-form__label",children:["Title ",a.jsx("span",{className:"create-request-form__required",children:"*"})]}),a.jsx("input",{id:"title",name:"title",type:"text",value:i.title,onChange:m,className:`create-request-form__input ${c.title?"create-request-form__input--error":""}`,placeholder:"Brief description of the issue or feature",disabled:t}),c.title&&a.jsx("div",{className:"create-request-form__error",children:c.title})]}),a.jsxs("div",{className:"create-request-form__section",children:[a.jsxs("label",{htmlFor:"description",className:"create-request-form__label",children:["Description ",a.jsx("span",{className:"create-request-form__required",children:"*"})]}),a.jsx("textarea",{id:"description",name:"description",value:i.description,onChange:m,className:`create-request-form__textarea ${c.description?"create-request-form__textarea--error":""}`,placeholder:"Provide detailed information about the bug or feature request...",rows:8,disabled:t}),c.description&&a.jsx("div",{className:"create-request-form__error",children:c.description})]}),a.jsxs("div",{className:"create-request-form__section",children:[a.jsx("label",{htmlFor:"priority",className:"create-request-form__label",children:"Priority (optional)"}),a.jsxs("select",{id:"priority",name:"priority",value:i.priority,onChange:m,className:"create-request-form__select",disabled:t,children:[a.jsx("option",{value:"",children:"None"}),a.jsx("option",{value:"low",children:"Low"}),a.jsx("option",{value:"medium",children:"Medium"}),a.jsx("option",{value:"high",children:"High"})]})]}),a.jsxs("div",{className:"create-request-form__actions",children:[a.jsx("button",{type:"button",onClick:()=>e("/requests"),className:"create-request-form__cancel",disabled:t,children:"Cancel"}),a.jsx("button",{type:"submit",className:"create-request-form__submit",disabled:t,children:t?"Creating...":"Submit Request"})]})]})]})}const L$=M2(i2(a.jsxs(a.Fragment,{children:[a.jsx(Yt,{path:"/login",element:a.jsx($3,{})}),a.jsxs(Yt,{path:"/",element:a.jsx(QI,{children:a.jsx(rk,{})}),children:[a.jsx(Yt,{index:!0,element:a.jsx(lk,{})}),a.jsx(Yt,{path:"worlds",element:a.jsx(Zk,{})}),a.jsx(Yt,{path:"worlds/:id",element:a.jsx(s3,{})}),a.jsx(Yt,{path:"worlds/:worldId/access/bulk",element:a.jsx(zw,{})}),a.jsx(Yt,{path:"worlds/:worldId/access/audit",element:a.jsx(u$,{})}),a.jsx(Yt,{path:"worlds/:worldId/collections",element:a.jsx(d$,{})}),a.jsx(Yt,{path:"campaigns/:campaignId/access/bulk",element:a.jsx(zw,{})}),a.jsxs(Yt,{path:"campaigns",children:[a.jsx(Yt,{index:!0,element:a.jsx(Xo,{to:"/campaigns/my",replace:!0})}),a.jsx(Yt,{path:"my",element:a.jsx(qu,{scope:"my"})}),a.jsx(Yt,{path:"my/:id",element:a.jsx(qu,{scope:"my"})}),a.jsx(Yt,{path:"all",element:a.jsx(qu,{scope:"all"})}),a.jsx(Yt,{path:"all/:id",element:a.jsx(qu,{scope:"all"})})]}),a.jsx(Yt,{path:"entities",element:a.jsx(l4,{})}),a.jsx(Yt,{path:"entities/bulk-upload",element:a.jsx(Bz,{})}),a.jsx(Yt,{path:"entities/followed",element:a.jsx(x$,{})}),a.jsx(Yt,{path:"entities/:entityId/relationship-viewer",element:a.jsx(zz,{})}),a.jsx(Yt,{path:"entities/:id",element:a.jsx(iI,{})}),a.jsxs(Yt,{path:"entity-types",children:[a.jsx(Yt,{index:!0,element:a.jsx(cI,{})}),a.jsx(Yt,{path:"new",element:a.jsx(CI,{})}),a.jsx(Yt,{path:":id/fields",element:a.jsx(NI,{})})]}),a.jsxs(Yt,{path:"relationship-types",children:[a.jsx(Yt,{index:!0,element:a.jsx(XI,{})}),a.jsx(Yt,{path:"new",element:a.jsx(KI,{})}),a.jsx(Yt,{path:":id/edit",element:a.jsx(WI,{})})]}),a.jsx(Yt,{path:"entity-relationships",element:a.jsx(PI,{})}),a.jsx(Yt,{path:"entity-secrets",element:a.jsx(ZI,{})}),a.jsxs(Yt,{path:"notes",children:[a.jsx(Yt,{index:!0,element:a.jsx(Xo,{to:"/notes/session",replace:!0})}),a.jsx(Yt,{path:"session",element:a.jsx(Vz,{})}),a.jsx(Yt,{path:"entities",element:a.jsx(Qz,{})})]}),a.jsxs(Yt,{path:"characters",children:[a.jsx(Yt,{index:!0,element:a.jsx(Xo,{to:"/characters/my",replace:!0})}),a.jsx(Yt,{path:"my",element:a.jsx(Dr,{scope:"my"})}),a.jsx(Yt,{path:"my/:id",element:a.jsx(Dr,{scope:"my"})}),a.jsx(Yt,{path:"others",element:a.jsx(Dr,{scope:"others"})}),a.jsx(Yt,{path:"others/:id",element:a.jsx(Dr,{scope:"others"})}),a.jsx(Yt,{path:"companions",element:a.jsx(Dr,{scope:"companions"})}),a.jsx(Yt,{path:"companions/:id",element:a.jsx(Dr,{scope:"companions"})}),a.jsx(Yt,{path:"all",element:a.jsx(Dr,{scope:"all"})}),a.jsx(Yt,{path:"all/:id",element:a.jsx(Dr,{scope:"all"})})]}),a.jsx(Yt,{path:"users",element:a.jsx(z3,{})}),a.jsx(Yt,{path:"security",element:a.jsx(p$,{})}),a.jsx(Yt,{path:"notifications",element:a.jsx(v$,{})}),a.jsxs(Yt,{path:"requests",children:[a.jsx(Yt,{index:!0,element:a.jsx(A$,{})}),a.jsx(Yt,{path:"new",element:a.jsx(I$,{})}),a.jsx(Yt,{path:":id",element:a.jsx(D$,{})})]})]}),a.jsx(Yt,{path:"*",element:a.jsx(Xo,{to:"/",replace:!0})})]})));function O$(){return a.jsx(P2,{router:L$})}TC.createRoot(document.getElementById("root")).render(a.jsx(u.StrictMode,{children:a.jsx(QM,{children:a.jsx(MI,{children:a.jsx(DM,{children:a.jsx(WM,{children:a.jsx(AR,{children:a.jsx(O$,{})})})})})})}));

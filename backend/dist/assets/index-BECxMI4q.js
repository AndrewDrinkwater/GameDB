(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function r(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(l){if(l.ep)return;l.ep=!0;const c=r(l);fetch(l.href,c)}})();function ki(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var _h={exports:{}},Ao={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var e0;function jC(){if(e0)return Ao;e0=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function r(i,l,c){var f=null;if(c!==void 0&&(f=""+c),l.key!==void 0&&(f=""+l.key),"key"in l){c={};for(var m in l)m!=="key"&&(c[m]=l[m])}else c=l;return l=c.ref,{$$typeof:e,type:i,key:f,ref:l!==void 0?l:null,props:c}}return Ao.Fragment=t,Ao.jsx=r,Ao.jsxs=r,Ao}var t0;function _C(){return t0||(t0=1,_h.exports=jC()),_h.exports}var a=_C(),Ch={exports:{}},en={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n0;function CC(){if(n0)return en;n0=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),f=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),v=Symbol.iterator;function S(R){return R===null||typeof R!="object"?null:(R=v&&R[v]||R["@@iterator"],typeof R=="function"?R:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N=Object.assign,j={};function _(R,q,G){this.props=R,this.context=q,this.refs=j,this.updater=G||w}_.prototype.isReactComponent={},_.prototype.setState=function(R,q){if(typeof R!="object"&&typeof R!="function"&&R!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,R,q,"setState")},_.prototype.forceUpdate=function(R){this.updater.enqueueForceUpdate(this,R,"forceUpdate")};function C(){}C.prototype=_.prototype;function O(R,q,G){this.props=R,this.context=q,this.refs=j,this.updater=G||w}var E=O.prototype=new C;E.constructor=O,N(E,_.prototype),E.isPureReactComponent=!0;var T=Array.isArray;function M(){}var A={H:null,A:null,T:null,S:null},z=Object.prototype.hasOwnProperty;function P(R,q,G){var J=G.ref;return{$$typeof:e,type:R,key:q,ref:J!==void 0?J:null,props:G}}function X(R,q){return P(R.type,q,R.props)}function H(R){return typeof R=="object"&&R!==null&&R.$$typeof===e}function Y(R){var q={"=":"=0",":":"=2"};return"$"+R.replace(/[=:]/g,function(G){return q[G]})}var V=/\/+/g;function I(R,q){return typeof R=="object"&&R!==null&&R.key!=null?Y(""+R.key):q.toString(36)}function F(R){switch(R.status){case"fulfilled":return R.value;case"rejected":throw R.reason;default:switch(typeof R.status=="string"?R.then(M,M):(R.status="pending",R.then(function(q){R.status==="pending"&&(R.status="fulfilled",R.value=q)},function(q){R.status==="pending"&&(R.status="rejected",R.reason=q)})),R.status){case"fulfilled":return R.value;case"rejected":throw R.reason}}throw R}function D(R,q,G,J,ie){var Z=typeof R;(Z==="undefined"||Z==="boolean")&&(R=null);var me=!1;if(R===null)me=!0;else switch(Z){case"bigint":case"string":case"number":me=!0;break;case"object":switch(R.$$typeof){case e:case t:me=!0;break;case y:return me=R._init,D(me(R._payload),q,G,J,ie)}}if(me)return ie=ie(R),me=J===""?"."+I(R,0):J,T(ie)?(G="",me!=null&&(G=me.replace(V,"$&/")+"/"),D(ie,q,G,"",function(ne){return ne})):ie!=null&&(H(ie)&&(ie=X(ie,G+(ie.key==null||R&&R.key===ie.key?"":(""+ie.key).replace(V,"$&/")+"/")+me)),q.push(ie)),1;me=0;var Q=J===""?".":J+":";if(T(R))for(var ue=0;ue<R.length;ue++)J=R[ue],Z=Q+I(J,ue),me+=D(J,q,G,Z,ie);else if(ue=S(R),typeof ue=="function")for(R=ue.call(R),ue=0;!(J=R.next()).done;)J=J.value,Z=Q+I(J,ue++),me+=D(J,q,G,Z,ie);else if(Z==="object"){if(typeof R.then=="function")return D(F(R),q,G,J,ie);throw q=String(R),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(R).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return me}function L(R,q,G){if(R==null)return R;var J=[],ie=0;return D(R,J,"","",function(Z){return q.call(G,Z,ie++)}),J}function B(R){if(R._status===-1){var q=R._result;q=q(),q.then(function(G){(R._status===0||R._status===-1)&&(R._status=1,R._result=G)},function(G){(R._status===0||R._status===-1)&&(R._status=2,R._result=G)}),R._status===-1&&(R._status=0,R._result=q)}if(R._status===1)return R._result.default;throw R._result}var k=typeof reportError=="function"?reportError:function(R){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof R=="object"&&R!==null&&typeof R.message=="string"?String(R.message):String(R),error:R});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",R);return}console.error(R)},U={map:L,forEach:function(R,q,G){L(R,function(){q.apply(this,arguments)},G)},count:function(R){var q=0;return L(R,function(){q++}),q},toArray:function(R){return L(R,function(q){return q})||[]},only:function(R){if(!H(R))throw Error("React.Children.only expected to receive a single React element child.");return R}};return en.Activity=g,en.Children=U,en.Component=_,en.Fragment=r,en.Profiler=l,en.PureComponent=O,en.StrictMode=i,en.Suspense=h,en.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,en.__COMPILER_RUNTIME={__proto__:null,c:function(R){return A.H.useMemoCache(R)}},en.cache=function(R){return function(){return R.apply(null,arguments)}},en.cacheSignal=function(){return null},en.cloneElement=function(R,q,G){if(R==null)throw Error("The argument must be a React element, but you passed "+R+".");var J=N({},R.props),ie=R.key;if(q!=null)for(Z in q.key!==void 0&&(ie=""+q.key),q)!z.call(q,Z)||Z==="key"||Z==="__self"||Z==="__source"||Z==="ref"&&q.ref===void 0||(J[Z]=q[Z]);var Z=arguments.length-2;if(Z===1)J.children=G;else if(1<Z){for(var me=Array(Z),Q=0;Q<Z;Q++)me[Q]=arguments[Q+2];J.children=me}return P(R.type,ie,J)},en.createContext=function(R){return R={$$typeof:f,_currentValue:R,_currentValue2:R,_threadCount:0,Provider:null,Consumer:null},R.Provider=R,R.Consumer={$$typeof:c,_context:R},R},en.createElement=function(R,q,G){var J,ie={},Z=null;if(q!=null)for(J in q.key!==void 0&&(Z=""+q.key),q)z.call(q,J)&&J!=="key"&&J!=="__self"&&J!=="__source"&&(ie[J]=q[J]);var me=arguments.length-2;if(me===1)ie.children=G;else if(1<me){for(var Q=Array(me),ue=0;ue<me;ue++)Q[ue]=arguments[ue+2];ie.children=Q}if(R&&R.defaultProps)for(J in me=R.defaultProps,me)ie[J]===void 0&&(ie[J]=me[J]);return P(R,Z,ie)},en.createRef=function(){return{current:null}},en.forwardRef=function(R){return{$$typeof:m,render:R}},en.isValidElement=H,en.lazy=function(R){return{$$typeof:y,_payload:{_status:-1,_result:R},_init:B}},en.memo=function(R,q){return{$$typeof:p,type:R,compare:q===void 0?null:q}},en.startTransition=function(R){var q=A.T,G={};A.T=G;try{var J=R(),ie=A.S;ie!==null&&ie(G,J),typeof J=="object"&&J!==null&&typeof J.then=="function"&&J.then(M,k)}catch(Z){k(Z)}finally{q!==null&&G.types!==null&&(q.types=G.types),A.T=q}},en.unstable_useCacheRefresh=function(){return A.H.useCacheRefresh()},en.use=function(R){return A.H.use(R)},en.useActionState=function(R,q,G){return A.H.useActionState(R,q,G)},en.useCallback=function(R,q){return A.H.useCallback(R,q)},en.useContext=function(R){return A.H.useContext(R)},en.useDebugValue=function(){},en.useDeferredValue=function(R,q){return A.H.useDeferredValue(R,q)},en.useEffect=function(R,q){return A.H.useEffect(R,q)},en.useEffectEvent=function(R){return A.H.useEffectEvent(R)},en.useId=function(){return A.H.useId()},en.useImperativeHandle=function(R,q,G){return A.H.useImperativeHandle(R,q,G)},en.useInsertionEffect=function(R,q){return A.H.useInsertionEffect(R,q)},en.useLayoutEffect=function(R,q){return A.H.useLayoutEffect(R,q)},en.useMemo=function(R,q){return A.H.useMemo(R,q)},en.useOptimistic=function(R,q){return A.H.useOptimistic(R,q)},en.useReducer=function(R,q,G){return A.H.useReducer(R,q,G)},en.useRef=function(R){return A.H.useRef(R)},en.useState=function(R){return A.H.useState(R)},en.useSyncExternalStore=function(R,q,G){return A.H.useSyncExternalStore(R,q,G)},en.useTransition=function(){return A.H.useTransition()},en.version="19.2.0",en}var a0;function Nc(){return a0||(a0=1,Ch.exports=CC()),Ch.exports}var u=Nc();const De=ki(u);var Ah={exports:{}},To={},Th={exports:{}},Mh={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s0;function AC(){return s0||(s0=1,(function(e){function t(D,L){var B=D.length;D.push(L);e:for(;0<B;){var k=B-1>>>1,U=D[k];if(0<l(U,L))D[k]=L,D[B]=U,B=k;else break e}}function r(D){return D.length===0?null:D[0]}function i(D){if(D.length===0)return null;var L=D[0],B=D.pop();if(B!==L){D[0]=B;e:for(var k=0,U=D.length,R=U>>>1;k<R;){var q=2*(k+1)-1,G=D[q],J=q+1,ie=D[J];if(0>l(G,B))J<U&&0>l(ie,G)?(D[k]=ie,D[J]=B,k=J):(D[k]=G,D[q]=B,k=q);else if(J<U&&0>l(ie,B))D[k]=ie,D[J]=B,k=J;else break e}}return L}function l(D,L){var B=D.sortIndex-L.sortIndex;return B!==0?B:D.id-L.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;e.unstable_now=function(){return c.now()}}else{var f=Date,m=f.now();e.unstable_now=function(){return f.now()-m}}var h=[],p=[],y=1,g=null,v=3,S=!1,w=!1,N=!1,j=!1,_=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;function E(D){for(var L=r(p);L!==null;){if(L.callback===null)i(p);else if(L.startTime<=D)i(p),L.sortIndex=L.expirationTime,t(h,L);else break;L=r(p)}}function T(D){if(N=!1,E(D),!w)if(r(h)!==null)w=!0,M||(M=!0,Y());else{var L=r(p);L!==null&&F(T,L.startTime-D)}}var M=!1,A=-1,z=5,P=-1;function X(){return j?!0:!(e.unstable_now()-P<z)}function H(){if(j=!1,M){var D=e.unstable_now();P=D;var L=!0;try{e:{w=!1,N&&(N=!1,C(A),A=-1),S=!0;var B=v;try{t:{for(E(D),g=r(h);g!==null&&!(g.expirationTime>D&&X());){var k=g.callback;if(typeof k=="function"){g.callback=null,v=g.priorityLevel;var U=k(g.expirationTime<=D);if(D=e.unstable_now(),typeof U=="function"){g.callback=U,E(D),L=!0;break t}g===r(h)&&i(h),E(D)}else i(h);g=r(h)}if(g!==null)L=!0;else{var R=r(p);R!==null&&F(T,R.startTime-D),L=!1}}break e}finally{g=null,v=B,S=!1}L=void 0}}finally{L?Y():M=!1}}}var Y;if(typeof O=="function")Y=function(){O(H)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,I=V.port2;V.port1.onmessage=H,Y=function(){I.postMessage(null)}}else Y=function(){_(H,0)};function F(D,L){A=_(function(){D(e.unstable_now())},L)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(D){D.callback=null},e.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):z=0<D?Math.floor(1e3/D):5},e.unstable_getCurrentPriorityLevel=function(){return v},e.unstable_next=function(D){switch(v){case 1:case 2:case 3:var L=3;break;default:L=v}var B=v;v=L;try{return D()}finally{v=B}},e.unstable_requestPaint=function(){j=!0},e.unstable_runWithPriority=function(D,L){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var B=v;v=D;try{return L()}finally{v=B}},e.unstable_scheduleCallback=function(D,L,B){var k=e.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?k+B:k):B=k,D){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=B+U,D={id:y++,callback:L,priorityLevel:D,startTime:B,expirationTime:U,sortIndex:-1},B>k?(D.sortIndex=B,t(p,D),r(h)===null&&D===r(p)&&(N?(C(A),A=-1):N=!0,F(T,B-k))):(D.sortIndex=U,t(h,D),w||S||(w=!0,M||(M=!0,Y()))),D},e.unstable_shouldYield=X,e.unstable_wrapCallback=function(D){var L=v;return function(){var B=v;v=L;try{return D.apply(this,arguments)}finally{v=B}}}})(Mh)),Mh}var r0;function TC(){return r0||(r0=1,Th.exports=AC()),Th.exports}var Rh={exports:{}},pa={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i0;function MC(){if(i0)return pa;i0=1;var e=Nc();function t(h){var p="https://react.dev/errors/"+h;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)p+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+h+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var i={d:{f:r,r:function(){throw Error(t(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},l=Symbol.for("react.portal");function c(h,p,y){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:g==null?null:""+g,children:h,containerInfo:p,implementation:y}}var f=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function m(h,p){if(h==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return pa.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,pa.createPortal=function(h,p){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(t(299));return c(h,p,null,y)},pa.flushSync=function(h){var p=f.T,y=i.p;try{if(f.T=null,i.p=2,h)return h()}finally{f.T=p,i.p=y,i.d.f()}},pa.preconnect=function(h,p){typeof h=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,i.d.C(h,p))},pa.prefetchDNS=function(h){typeof h=="string"&&i.d.D(h)},pa.preinit=function(h,p){if(typeof h=="string"&&p&&typeof p.as=="string"){var y=p.as,g=m(y,p.crossOrigin),v=typeof p.integrity=="string"?p.integrity:void 0,S=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;y==="style"?i.d.S(h,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:g,integrity:v,fetchPriority:S}):y==="script"&&i.d.X(h,{crossOrigin:g,integrity:v,fetchPriority:S,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},pa.preinitModule=function(h,p){if(typeof h=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var y=m(p.as,p.crossOrigin);i.d.M(h,{crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&i.d.M(h)},pa.preload=function(h,p){if(typeof h=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var y=p.as,g=m(y,p.crossOrigin);i.d.L(h,y,{crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},pa.preloadModule=function(h,p){if(typeof h=="string")if(p){var y=m(p.as,p.crossOrigin);i.d.m(h,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else i.d.m(h)},pa.requestFormReset=function(h){i.d.r(h)},pa.unstable_batchedUpdates=function(h,p){return h(p)},pa.useFormState=function(h,p,y){return f.H.useFormState(h,p,y)},pa.useFormStatus=function(){return f.H.useHostTransitionStatus()},pa.version="19.2.0",pa}var l0;function Vw(){if(l0)return Rh.exports;l0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Rh.exports=MC(),Rh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o0;function RC(){if(o0)return To;o0=1;var e=TC(),t=Nc(),r=Vw();function i(n){var s="https://react.dev/errors/"+n;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)s+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+n+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function c(n){var s=n,o=n;if(n.alternate)for(;s.return;)s=s.return;else{n=s;do s=n,(s.flags&4098)!==0&&(o=s.return),n=s.return;while(n)}return s.tag===3?o:null}function f(n){if(n.tag===13){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function m(n){if(n.tag===31){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function h(n){if(c(n)!==n)throw Error(i(188))}function p(n){var s=n.alternate;if(!s){if(s=c(n),s===null)throw Error(i(188));return s!==n?null:n}for(var o=n,d=s;;){var b=o.return;if(b===null)break;var x=b.alternate;if(x===null){if(d=b.return,d!==null){o=d;continue}break}if(b.child===x.child){for(x=b.child;x;){if(x===o)return h(b),n;if(x===d)return h(b),s;x=x.sibling}throw Error(i(188))}if(o.return!==d.return)o=b,d=x;else{for(var $=!1,K=b.child;K;){if(K===o){$=!0,o=b,d=x;break}if(K===d){$=!0,d=b,o=x;break}K=K.sibling}if(!$){for(K=x.child;K;){if(K===o){$=!0,o=x,d=b;break}if(K===d){$=!0,d=x,o=b;break}K=K.sibling}if(!$)throw Error(i(189))}}if(o.alternate!==d)throw Error(i(190))}if(o.tag!==3)throw Error(i(188));return o.stateNode.current===o?n:s}function y(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n;for(n=n.child;n!==null;){if(s=y(n),s!==null)return s;n=n.sibling}return null}var g=Object.assign,v=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),O=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),z=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),X=Symbol.for("react.memo_cache_sentinel"),H=Symbol.iterator;function Y(n){return n===null||typeof n!="object"?null:(n=H&&n[H]||n["@@iterator"],typeof n=="function"?n:null)}var V=Symbol.for("react.client.reference");function I(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===V?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case N:return"Fragment";case _:return"Profiler";case j:return"StrictMode";case T:return"Suspense";case M:return"SuspenseList";case P:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case w:return"Portal";case O:return n.displayName||"Context";case C:return(n._context.displayName||"Context")+".Consumer";case E:var s=n.render;return n=n.displayName,n||(n=s.displayName||s.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case A:return s=n.displayName||null,s!==null?s:I(n.type)||"Memo";case z:s=n._payload,n=n._init;try{return I(n(s))}catch{}}return null}var F=Array.isArray,D=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B={pending:!1,data:null,method:null,action:null},k=[],U=-1;function R(n){return{current:n}}function q(n){0>U||(n.current=k[U],k[U]=null,U--)}function G(n,s){U++,k[U]=n.current,n.current=s}var J=R(null),ie=R(null),Z=R(null),me=R(null);function Q(n,s){switch(G(Z,s),G(ie,n),G(J,null),s.nodeType){case 9:case 11:n=(n=s.documentElement)&&(n=n.namespaceURI)?Nx(n):0;break;default:if(n=s.tagName,s=s.namespaceURI)s=Nx(s),n=Ex(s,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}q(J),G(J,n)}function ue(){q(J),q(ie),q(Z)}function ne(n){n.memoizedState!==null&&G(me,n);var s=J.current,o=Ex(s,n.type);s!==o&&(G(ie,n),G(J,o))}function we(n){ie.current===n&&(q(J),q(ie)),me.current===n&&(q(me),Eo._currentValue=B)}var Pe,Re;function Ce(n){if(Pe===void 0)try{throw Error()}catch(o){var s=o.stack.trim().match(/\n( *(at )?)/);Pe=s&&s[1]||"",Re=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Pe+n+Re}var it=!1;function qe(n,s){if(!n||it)return"";it=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(s){var lt=function(){throw Error()};if(Object.defineProperty(lt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(lt,[])}catch(Ye){var Fe=Ye}Reflect.construct(n,[],lt)}else{try{lt.call()}catch(Ye){Fe=Ye}n.call(lt.prototype)}}else{try{throw Error()}catch(Ye){Fe=Ye}(lt=n())&&typeof lt.catch=="function"&&lt.catch(function(){})}}catch(Ye){if(Ye&&Fe&&typeof Ye.stack=="string")return[Ye.stack,Fe.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=d.DetermineComponentFrameRoot(),$=x[0],K=x[1];if($&&K){var pe=$.split(`
`),Le=K.split(`
`);for(b=d=0;d<pe.length&&!pe[d].includes("DetermineComponentFrameRoot");)d++;for(;b<Le.length&&!Le[b].includes("DetermineComponentFrameRoot");)b++;if(d===pe.length||b===Le.length)for(d=pe.length-1,b=Le.length-1;1<=d&&0<=b&&pe[d]!==Le[b];)b--;for(;1<=d&&0<=b;d--,b--)if(pe[d]!==Le[b]){if(d!==1||b!==1)do if(d--,b--,0>b||pe[d]!==Le[b]){var et=`
`+pe[d].replace(" at new "," at ");return n.displayName&&et.includes("<anonymous>")&&(et=et.replace("<anonymous>",n.displayName)),et}while(1<=d&&0<=b);break}}}finally{it=!1,Error.prepareStackTrace=o}return(o=n?n.displayName||n.name:"")?Ce(o):""}function We(n,s){switch(n.tag){case 26:case 27:case 5:return Ce(n.type);case 16:return Ce("Lazy");case 13:return n.child!==s&&s!==null?Ce("Suspense Fallback"):Ce("Suspense");case 19:return Ce("SuspenseList");case 0:case 15:return qe(n.type,!1);case 11:return qe(n.type.render,!1);case 1:return qe(n.type,!0);case 31:return Ce("Activity");default:return""}}function ke(n){try{var s="",o=null;do s+=We(n,o),o=n,n=n.return;while(n);return s}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var xt=Object.prototype.hasOwnProperty,Mt=e.unstable_scheduleCallback,Ct=e.unstable_cancelCallback,At=e.unstable_shouldYield,He=e.unstable_requestPaint,Qe=e.unstable_now,W=e.unstable_getCurrentPriorityLevel,ee=e.unstable_ImmediatePriority,te=e.unstable_UserBlockingPriority,ve=e.unstable_NormalPriority,le=e.unstable_LowPriority,Se=e.unstable_IdlePriority,Ee=e.log,ge=e.unstable_setDisableYieldValue,at=null,st=null;function nt(n){if(typeof Ee=="function"&&ge(n),st&&typeof st.setStrictMode=="function")try{st.setStrictMode(at,n)}catch{}}var ze=Math.clz32?Math.clz32:Rt,ft=Math.log,zt=Math.LN2;function Rt(n){return n>>>=0,n===0?32:31-(ft(n)/zt|0)|0}var pt=256,ct=262144,yt=4194304;function Tt(n){var s=n&42;if(s!==0)return s;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return n&261888;case 262144:case 524288:case 1048576:case 2097152:return n&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function Ft(n,s,o){var d=n.pendingLanes;if(d===0)return 0;var b=0,x=n.suspendedLanes,$=n.pingedLanes;n=n.warmLanes;var K=d&134217727;return K!==0?(d=K&~x,d!==0?b=Tt(d):($&=K,$!==0?b=Tt($):o||(o=K&~n,o!==0&&(b=Tt(o))))):(K=d&~x,K!==0?b=Tt(K):$!==0?b=Tt($):o||(o=d&~n,o!==0&&(b=Tt(o)))),b===0?0:s!==0&&s!==b&&(s&x)===0&&(x=b&-b,o=s&-s,x>=o||x===32&&(o&4194048)!==0)?s:b}function kt(n,s){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&s)===0}function Zt(n,s){switch(n){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Lt(){var n=yt;return yt<<=1,(yt&62914560)===0&&(yt=4194304),n}function Kt(n){for(var s=[],o=0;31>o;o++)s.push(n);return s}function se(n,s){n.pendingLanes|=s,s!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function be(n,s,o,d,b,x){var $=n.pendingLanes;n.pendingLanes=o,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=o,n.entangledLanes&=o,n.errorRecoveryDisabledLanes&=o,n.shellSuspendCounter=0;var K=n.entanglements,pe=n.expirationTimes,Le=n.hiddenUpdates;for(o=$&~o;0<o;){var et=31-ze(o),lt=1<<et;K[et]=0,pe[et]=-1;var Fe=Le[et];if(Fe!==null)for(Le[et]=null,et=0;et<Fe.length;et++){var Ye=Fe[et];Ye!==null&&(Ye.lane&=-536870913)}o&=~lt}d!==0&&je(n,d,0),x!==0&&b===0&&n.tag!==0&&(n.suspendedLanes|=x&~($&~s))}function je(n,s,o){n.pendingLanes|=s,n.suspendedLanes&=~s;var d=31-ze(s);n.entangledLanes|=s,n.entanglements[d]=n.entanglements[d]|1073741824|o&261930}function Ze(n,s){var o=n.entangledLanes|=s;for(n=n.entanglements;o;){var d=31-ze(o),b=1<<d;b&s|n[d]&s&&(n[d]|=s),o&=~b}}function dt(n,s){var o=s&-s;return o=(o&42)!==0?1:gt(o),(o&(n.suspendedLanes|s))!==0?0:o}function gt(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function oe(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function re(){var n=L.p;return n!==0?n:(n=window.event,n===void 0?32:Gx(n.type))}function Ne(n,s){var o=L.p;try{return L.p=n,s()}finally{L.p=o}}var Be=Math.random().toString(36).slice(2),Ke="__reactFiber$"+Be,ot="__reactProps$"+Be,Oe="__reactContainer$"+Be,ce="__reactEvents$"+Be,Ue="__reactListeners$"+Be,Ge="__reactHandles$"+Be,ut="__reactResources$"+Be,ae="__reactMarker$"+Be;function Xe(n){delete n[Ke],delete n[ot],delete n[ce],delete n[Ue],delete n[Ge]}function $e(n){var s=n[Ke];if(s)return s;for(var o=n.parentNode;o;){if(s=o[Oe]||o[Ke]){if(o=s.alternate,s.child!==null||o!==null&&o.child!==null)for(n=Rx(n);n!==null;){if(o=n[Ke])return o;n=Rx(n)}return s}n=o,o=n.parentNode}return null}function Je(n){if(n=n[Ke]||n[Oe]){var s=n.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return n}return null}function bt(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n.stateNode;throw Error(i(33))}function St(n){var s=n[ut];return s||(s=n[ut]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function _e(n){n[ae]=!0}var tt=new Set,mt={};function fe(n,s){he(n,s),he(n+"Capture",s)}function he(n,s){for(mt[n]=s,n=0;n<s.length;n++)tt.add(s[n])}var Ve=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),vt={},Nt={};function Et(n){return xt.call(Nt,n)?!0:xt.call(vt,n)?!1:Ve.test(n)?Nt[n]=!0:(vt[n]=!0,!1)}function jt(n,s,o){if(Et(s))if(o===null)n.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":n.removeAttribute(s);return;case"boolean":var d=s.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){n.removeAttribute(s);return}}n.setAttribute(s,""+o)}}function Wt(n,s,o){if(o===null)n.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(s);return}n.setAttribute(s,""+o)}}function ln(n,s,o,d){if(d===null)n.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(o);return}n.setAttributeNS(s,o,""+d)}}function dn(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Qt(n){var s=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function ha(n,s,o){var d=Object.getOwnPropertyDescriptor(n.constructor.prototype,s);if(!n.hasOwnProperty(s)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var b=d.get,x=d.set;return Object.defineProperty(n,s,{configurable:!0,get:function(){return b.call(this)},set:function($){o=""+$,x.call(this,$)}}),Object.defineProperty(n,s,{enumerable:d.enumerable}),{getValue:function(){return o},setValue:function($){o=""+$},stopTracking:function(){n._valueTracker=null,delete n[s]}}}}function ka(n){if(!n._valueTracker){var s=Qt(n)?"checked":"value";n._valueTracker=ha(n,s,""+n[s])}}function Jr(n){if(!n)return!1;var s=n._valueTracker;if(!s)return!0;var o=s.getValue(),d="";return n&&(d=Qt(n)?n.checked?"true":"false":n.value),n=d,n!==o?(s.setValue(n),!0):!1}function ur(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var Os=/[\n"\\]/g;function ra(n){return n.replace(Os,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function ei(n,s,o,d,b,x,$,K){n.name="",$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"?n.type=$:n.removeAttribute("type"),s!=null?$==="number"?(s===0&&n.value===""||n.value!=s)&&(n.value=""+dn(s)):n.value!==""+dn(s)&&(n.value=""+dn(s)):$!=="submit"&&$!=="reset"||n.removeAttribute("value"),s!=null?Un(n,$,dn(s)):o!=null?Un(n,$,dn(o)):d!=null&&n.removeAttribute("value"),b==null&&x!=null&&(n.defaultChecked=!!x),b!=null&&(n.checked=b&&typeof b!="function"&&typeof b!="symbol"),K!=null&&typeof K!="function"&&typeof K!="symbol"&&typeof K!="boolean"?n.name=""+dn(K):n.removeAttribute("name")}function ti(n,s,o,d,b,x,$,K){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(n.type=x),s!=null||o!=null){if(!(x!=="submit"&&x!=="reset"||s!=null)){ka(n);return}o=o!=null?""+dn(o):"",s=s!=null?""+dn(s):o,K||s===n.value||(n.value=s),n.defaultValue=s}d=d??b,d=typeof d!="function"&&typeof d!="symbol"&&!!d,n.checked=K?n.checked:!!d,n.defaultChecked=!!d,$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"&&(n.name=$),ka(n)}function Un(n,s,o){s==="number"&&ur(n.ownerDocument)===n||n.defaultValue===""+o||(n.defaultValue=""+o)}function Da(n,s,o,d){if(n=n.options,s){s={};for(var b=0;b<o.length;b++)s["$"+o[b]]=!0;for(o=0;o<n.length;o++)b=s.hasOwnProperty("$"+n[o].value),n[o].selected!==b&&(n[o].selected=b),b&&d&&(n[o].defaultSelected=!0)}else{for(o=""+dn(o),s=null,b=0;b<n.length;b++){if(n[b].value===o){n[b].selected=!0,d&&(n[b].defaultSelected=!0);return}s!==null||n[b].disabled||(s=n[b])}s!==null&&(s.selected=!0)}}function Ss(n,s,o){if(s!=null&&(s=""+dn(s),s!==n.value&&(n.value=s),o==null)){n.defaultValue!==s&&(n.defaultValue=s);return}n.defaultValue=o!=null?""+dn(o):""}function de(n,s,o,d){if(s==null){if(d!=null){if(o!=null)throw Error(i(92));if(F(d)){if(1<d.length)throw Error(i(93));d=d[0]}o=d}o==null&&(o=""),s=o}o=dn(s),n.defaultValue=o,d=n.textContent,d===o&&d!==""&&d!==null&&(n.value=d),ka(n)}function Ae(n,s){if(s){var o=n.firstChild;if(o&&o===n.lastChild&&o.nodeType===3){o.nodeValue=s;return}}n.textContent=s}var Ut=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function pn(n,s,o){var d=s.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?d?n.setProperty(s,""):s==="float"?n.cssFloat="":n[s]="":d?n.setProperty(s,o):typeof o!="number"||o===0||Ut.has(s)?s==="float"?n.cssFloat=o:n[s]=(""+o).trim():n[s]=o+"px"}function fn(n,s,o){if(s!=null&&typeof s!="object")throw Error(i(62));if(n=n.style,o!=null){for(var d in o)!o.hasOwnProperty(d)||s!=null&&s.hasOwnProperty(d)||(d.indexOf("--")===0?n.setProperty(d,""):d==="float"?n.cssFloat="":n[d]="");for(var b in s)d=s[b],s.hasOwnProperty(b)&&o[b]!==d&&pn(n,b,d)}else for(var x in s)s.hasOwnProperty(x)&&pn(n,x,s[x])}function qt(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jn=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),qn=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Fn(n){return qn.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}function ia(){}var ye=null;function Me(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var ht=null,Dt=null;function Vt(n){var s=Je(n);if(s&&(n=s.stateNode)){var o=n[ot]||null;e:switch(n=s.stateNode,s.type){case"input":if(ei(n,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),s=o.name,o.type==="radio"&&s!=null){for(o=n;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+ra(""+s)+'"][type="radio"]'),s=0;s<o.length;s++){var d=o[s];if(d!==n&&d.form===n.form){var b=d[ot]||null;if(!b)throw Error(i(90));ei(d,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(s=0;s<o.length;s++)d=o[s],d.form===n.form&&Jr(d)}break e;case"textarea":Ss(n,o.value,o.defaultValue);break e;case"select":s=o.value,s!=null&&Da(n,!!o.multiple,s,!1)}}}var nn=!1;function xn(n,s,o){if(nn)return n(s,o);nn=!0;try{var d=n(s);return d}finally{if(nn=!1,(ht!==null||Dt!==null)&&(pu(),ht&&(s=ht,n=Dt,Dt=ht=null,Vt(s),n)))for(s=0;s<n.length;s++)Vt(n[s])}}function Gt(n,s){var o=n.stateNode;if(o===null)return null;var d=o[ot]||null;if(d===null)return null;o=d[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(n=n.type,d=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!d;break e;default:n=!1}if(n)return null;if(o&&typeof o!="function")throw Error(i(231,s,typeof o));return o}var vn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),la=!1;if(vn)try{var Pt={};Object.defineProperty(Pt,"passive",{get:function(){la=!0}}),window.addEventListener("test",Pt,Pt),window.removeEventListener("test",Pt,Pt)}catch{la=!1}var Kn=null,Ga=null,Li=null;function Oi(){if(Li)return Li;var n,s=Ga,o=s.length,d,b="value"in Kn?Kn.value:Kn.textContent,x=b.length;for(n=0;n<o&&s[n]===b[n];n++);var $=o-n;for(d=1;d<=$&&s[o-d]===b[x-d];d++);return Li=b.slice(n,1<d?1-d:void 0)}function zi(n){var s=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&s===13&&(n=13)):n=s,n===10&&(n=13),32<=n||n===13?n:0}function $i(){return!0}function jg(){return!1}function Sa(n){function s(o,d,b,x,$){this._reactName=o,this._targetInst=b,this.type=d,this.nativeEvent=x,this.target=$,this.currentTarget=null;for(var K in n)n.hasOwnProperty(K)&&(o=n[K],this[K]=o?o(x):x[K]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?$i:jg,this.isPropagationStopped=jg,this}return g(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=$i)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=$i)},persist:function(){},isPersistent:$i}),s}var ni={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},kc=Sa(ni),ql=g({},ni,{view:0,detail:0}),Nj=Sa(ql),Af,Tf,Hl,Dc=g({},ql,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Rf,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Hl&&(Hl&&n.type==="mousemove"?(Af=n.screenX-Hl.screenX,Tf=n.screenY-Hl.screenY):Tf=Af=0,Hl=n),Af)},movementY:function(n){return"movementY"in n?n.movementY:Tf}}),_g=Sa(Dc),Ej=g({},Dc,{dataTransfer:0}),jj=Sa(Ej),_j=g({},ql,{relatedTarget:0}),Mf=Sa(_j),Cj=g({},ni,{animationName:0,elapsedTime:0,pseudoElement:0}),Aj=Sa(Cj),Tj=g({},ni,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Mj=Sa(Tj),Rj=g({},ni,{data:0}),Cg=Sa(Rj),kj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Dj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ij={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Lj(n){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(n):(n=Ij[n])?!!s[n]:!1}function Rf(){return Lj}var Oj=g({},ql,{key:function(n){if(n.key){var s=kj[n.key]||n.key;if(s!=="Unidentified")return s}return n.type==="keypress"?(n=zi(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Dj[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Rf,charCode:function(n){return n.type==="keypress"?zi(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?zi(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),zj=Sa(Oj),$j=g({},Dc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ag=Sa($j),Fj=g({},ql,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Rf}),Bj=Sa(Fj),Uj=g({},ni,{propertyName:0,elapsedTime:0,pseudoElement:0}),qj=Sa(Uj),Hj=g({},Dc,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Pj=Sa(Hj),Vj=g({},ni,{newState:0,oldState:0}),Yj=Sa(Vj),Gj=[9,13,27,32],kf=vn&&"CompositionEvent"in window,Pl=null;vn&&"documentMode"in document&&(Pl=document.documentMode);var Xj=vn&&"TextEvent"in window&&!Pl,Tg=vn&&(!kf||Pl&&8<Pl&&11>=Pl),Mg=" ",Rg=!1;function kg(n,s){switch(n){case"keyup":return Gj.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Dg(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Fi=!1;function Kj(n,s){switch(n){case"compositionend":return Dg(s);case"keypress":return s.which!==32?null:(Rg=!0,Mg);case"textInput":return n=s.data,n===Mg&&Rg?null:n;default:return null}}function Wj(n,s){if(Fi)return n==="compositionend"||!kf&&kg(n,s)?(n=Oi(),Li=Ga=Kn=null,Fi=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Tg&&s.locale!=="ko"?null:s.data;default:return null}}var Zj={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ig(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s==="input"?!!Zj[n.type]:s==="textarea"}function Lg(n,s,o,d){ht?Dt?Dt.push(d):Dt=[d]:ht=d,s=wu(s,"onChange"),0<s.length&&(o=new kc("onChange","change",null,o,d),n.push({event:o,listeners:s}))}var Vl=null,Yl=null;function Qj(n){gx(n,0)}function Ic(n){var s=bt(n);if(Jr(s))return n}function Og(n,s){if(n==="change")return s}var zg=!1;if(vn){var Df;if(vn){var If="oninput"in document;if(!If){var $g=document.createElement("div");$g.setAttribute("oninput","return;"),If=typeof $g.oninput=="function"}Df=If}else Df=!1;zg=Df&&(!document.documentMode||9<document.documentMode)}function Fg(){Vl&&(Vl.detachEvent("onpropertychange",Bg),Yl=Vl=null)}function Bg(n){if(n.propertyName==="value"&&Ic(Yl)){var s=[];Lg(s,Yl,n,Me(n)),xn(Qj,s)}}function Jj(n,s,o){n==="focusin"?(Fg(),Vl=s,Yl=o,Vl.attachEvent("onpropertychange",Bg)):n==="focusout"&&Fg()}function e_(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Ic(Yl)}function t_(n,s){if(n==="click")return Ic(s)}function n_(n,s){if(n==="input"||n==="change")return Ic(s)}function a_(n,s){return n===s&&(n!==0||1/n===1/s)||n!==n&&s!==s}var Ia=typeof Object.is=="function"?Object.is:a_;function Gl(n,s){if(Ia(n,s))return!0;if(typeof n!="object"||n===null||typeof s!="object"||s===null)return!1;var o=Object.keys(n),d=Object.keys(s);if(o.length!==d.length)return!1;for(d=0;d<o.length;d++){var b=o[d];if(!xt.call(s,b)||!Ia(n[b],s[b]))return!1}return!0}function Ug(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function qg(n,s){var o=Ug(n);n=0;for(var d;o;){if(o.nodeType===3){if(d=n+o.textContent.length,n<=s&&d>=s)return{node:o,offset:s-n};n=d}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Ug(o)}}function Hg(n,s){return n&&s?n===s?!0:n&&n.nodeType===3?!1:s&&s.nodeType===3?Hg(n,s.parentNode):"contains"in n?n.contains(s):n.compareDocumentPosition?!!(n.compareDocumentPosition(s)&16):!1:!1}function Pg(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var s=ur(n.document);s instanceof n.HTMLIFrameElement;){try{var o=typeof s.contentWindow.location.href=="string"}catch{o=!1}if(o)n=s.contentWindow;else break;s=ur(n.document)}return s}function Lf(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s&&(s==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||s==="textarea"||n.contentEditable==="true")}var s_=vn&&"documentMode"in document&&11>=document.documentMode,Bi=null,Of=null,Xl=null,zf=!1;function Vg(n,s,o){var d=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;zf||Bi==null||Bi!==ur(d)||(d=Bi,"selectionStart"in d&&Lf(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Xl&&Gl(Xl,d)||(Xl=d,d=wu(Of,"onSelect"),0<d.length&&(s=new kc("onSelect","select",null,s,o),n.push({event:s,listeners:d}),s.target=Bi)))}function ai(n,s){var o={};return o[n.toLowerCase()]=s.toLowerCase(),o["Webkit"+n]="webkit"+s,o["Moz"+n]="moz"+s,o}var Ui={animationend:ai("Animation","AnimationEnd"),animationiteration:ai("Animation","AnimationIteration"),animationstart:ai("Animation","AnimationStart"),transitionrun:ai("Transition","TransitionRun"),transitionstart:ai("Transition","TransitionStart"),transitioncancel:ai("Transition","TransitionCancel"),transitionend:ai("Transition","TransitionEnd")},$f={},Yg={};vn&&(Yg=document.createElement("div").style,"AnimationEvent"in window||(delete Ui.animationend.animation,delete Ui.animationiteration.animation,delete Ui.animationstart.animation),"TransitionEvent"in window||delete Ui.transitionend.transition);function si(n){if($f[n])return $f[n];if(!Ui[n])return n;var s=Ui[n],o;for(o in s)if(s.hasOwnProperty(o)&&o in Yg)return $f[n]=s[o];return n}var Gg=si("animationend"),Xg=si("animationiteration"),Kg=si("animationstart"),r_=si("transitionrun"),i_=si("transitionstart"),l_=si("transitioncancel"),Wg=si("transitionend"),Zg=new Map,Ff="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ff.push("scrollEnd");function os(n,s){Zg.set(n,s),fe(s,[n])}var Lc=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)},Xa=[],qi=0,Bf=0;function Oc(){for(var n=qi,s=Bf=qi=0;s<n;){var o=Xa[s];Xa[s++]=null;var d=Xa[s];Xa[s++]=null;var b=Xa[s];Xa[s++]=null;var x=Xa[s];if(Xa[s++]=null,d!==null&&b!==null){var $=d.pending;$===null?b.next=b:(b.next=$.next,$.next=b),d.pending=b}x!==0&&Qg(o,b,x)}}function zc(n,s,o,d){Xa[qi++]=n,Xa[qi++]=s,Xa[qi++]=o,Xa[qi++]=d,Bf|=d,n.lanes|=d,n=n.alternate,n!==null&&(n.lanes|=d)}function Uf(n,s,o,d){return zc(n,s,o,d),$c(n)}function ri(n,s){return zc(n,null,null,s),$c(n)}function Qg(n,s,o){n.lanes|=o;var d=n.alternate;d!==null&&(d.lanes|=o);for(var b=!1,x=n.return;x!==null;)x.childLanes|=o,d=x.alternate,d!==null&&(d.childLanes|=o),x.tag===22&&(n=x.stateNode,n===null||n._visibility&1||(b=!0)),n=x,x=x.return;return n.tag===3?(x=n.stateNode,b&&s!==null&&(b=31-ze(o),n=x.hiddenUpdates,d=n[b],d===null?n[b]=[s]:d.push(s),s.lane=o|536870912),x):null}function $c(n){if(50<go)throw go=0,Wm=null,Error(i(185));for(var s=n.return;s!==null;)n=s,s=n.return;return n.tag===3?n.stateNode:null}var Hi={};function o_(n,s,o,d){this.tag=n,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function La(n,s,o,d){return new o_(n,s,o,d)}function qf(n){return n=n.prototype,!(!n||!n.isReactComponent)}function zs(n,s){var o=n.alternate;return o===null?(o=La(n.tag,s,n.key,n.mode),o.elementType=n.elementType,o.type=n.type,o.stateNode=n.stateNode,o.alternate=n,n.alternate=o):(o.pendingProps=s,o.type=n.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=n.flags&65011712,o.childLanes=n.childLanes,o.lanes=n.lanes,o.child=n.child,o.memoizedProps=n.memoizedProps,o.memoizedState=n.memoizedState,o.updateQueue=n.updateQueue,s=n.dependencies,o.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},o.sibling=n.sibling,o.index=n.index,o.ref=n.ref,o.refCleanup=n.refCleanup,o}function Jg(n,s){n.flags&=65011714;var o=n.alternate;return o===null?(n.childLanes=0,n.lanes=s,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=o.childLanes,n.lanes=o.lanes,n.child=o.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=o.memoizedProps,n.memoizedState=o.memoizedState,n.updateQueue=o.updateQueue,n.type=o.type,s=o.dependencies,n.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),n}function Fc(n,s,o,d,b,x){var $=0;if(d=n,typeof n=="function")qf(n)&&($=1);else if(typeof n=="string")$=mC(n,o,J.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case P:return n=La(31,o,s,b),n.elementType=P,n.lanes=x,n;case N:return ii(o.children,b,x,s);case j:$=8,b|=24;break;case _:return n=La(12,o,s,b|2),n.elementType=_,n.lanes=x,n;case T:return n=La(13,o,s,b),n.elementType=T,n.lanes=x,n;case M:return n=La(19,o,s,b),n.elementType=M,n.lanes=x,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case O:$=10;break e;case C:$=9;break e;case E:$=11;break e;case A:$=14;break e;case z:$=16,d=null;break e}$=29,o=Error(i(130,n===null?"null":typeof n,"")),d=null}return s=La($,o,s,b),s.elementType=n,s.type=d,s.lanes=x,s}function ii(n,s,o,d){return n=La(7,n,d,s),n.lanes=o,n}function Hf(n,s,o){return n=La(6,n,null,s),n.lanes=o,n}function eb(n){var s=La(18,null,null,0);return s.stateNode=n,s}function Pf(n,s,o){return s=La(4,n.children!==null?n.children:[],n.key,s),s.lanes=o,s.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},s}var tb=new WeakMap;function Ka(n,s){if(typeof n=="object"&&n!==null){var o=tb.get(n);return o!==void 0?o:(s={value:n,source:s,stack:ke(s)},tb.set(n,s),s)}return{value:n,source:s,stack:ke(s)}}var Pi=[],Vi=0,Bc=null,Kl=0,Wa=[],Za=0,dr=null,ws=1,Ns="";function $s(n,s){Pi[Vi++]=Kl,Pi[Vi++]=Bc,Bc=n,Kl=s}function nb(n,s,o){Wa[Za++]=ws,Wa[Za++]=Ns,Wa[Za++]=dr,dr=n;var d=ws;n=Ns;var b=32-ze(d)-1;d&=~(1<<b),o+=1;var x=32-ze(s)+b;if(30<x){var $=b-b%5;x=(d&(1<<$)-1).toString(32),d>>=$,b-=$,ws=1<<32-ze(s)+b|o<<b|d,Ns=x+n}else ws=1<<x|o<<b|d,Ns=n}function Vf(n){n.return!==null&&($s(n,1),nb(n,1,0))}function Yf(n){for(;n===Bc;)Bc=Pi[--Vi],Pi[Vi]=null,Kl=Pi[--Vi],Pi[Vi]=null;for(;n===dr;)dr=Wa[--Za],Wa[Za]=null,Ns=Wa[--Za],Wa[Za]=null,ws=Wa[--Za],Wa[Za]=null}function ab(n,s){Wa[Za++]=ws,Wa[Za++]=Ns,Wa[Za++]=dr,ws=s.id,Ns=s.overflow,dr=n}var oa=null,Ln=null,bn=!1,fr=null,Qa=!1,Gf=Error(i(519));function mr(n){var s=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Wl(Ka(s,n)),Gf}function sb(n){var s=n.stateNode,o=n.type,d=n.memoizedProps;switch(s[Ke]=n,s[ot]=d,o){case"dialog":hn("cancel",s),hn("close",s);break;case"iframe":case"object":case"embed":hn("load",s);break;case"video":case"audio":for(o=0;o<vo.length;o++)hn(vo[o],s);break;case"source":hn("error",s);break;case"img":case"image":case"link":hn("error",s),hn("load",s);break;case"details":hn("toggle",s);break;case"input":hn("invalid",s),ti(s,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":hn("invalid",s);break;case"textarea":hn("invalid",s),de(s,d.value,d.defaultValue,d.children)}o=d.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||s.textContent===""+o||d.suppressHydrationWarning===!0||Sx(s.textContent,o)?(d.popover!=null&&(hn("beforetoggle",s),hn("toggle",s)),d.onScroll!=null&&hn("scroll",s),d.onScrollEnd!=null&&hn("scrollend",s),d.onClick!=null&&(s.onclick=ia),s=!0):s=!1,s||mr(n,!0)}function rb(n){for(oa=n.return;oa;)switch(oa.tag){case 5:case 31:case 13:Qa=!1;return;case 27:case 3:Qa=!0;return;default:oa=oa.return}}function Yi(n){if(n!==oa)return!1;if(!bn)return rb(n),bn=!0,!1;var s=n.tag,o;if((o=s!==3&&s!==27)&&((o=s===5)&&(o=n.type,o=!(o!=="form"&&o!=="button")||dh(n.type,n.memoizedProps)),o=!o),o&&Ln&&mr(n),rb(n),s===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));Ln=Mx(n)}else if(s===31){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));Ln=Mx(n)}else s===27?(s=Ln,Cr(n.type)?(n=yh,yh=null,Ln=n):Ln=s):Ln=oa?es(n.stateNode.nextSibling):null;return!0}function li(){Ln=oa=null,bn=!1}function Xf(){var n=fr;return n!==null&&(ja===null?ja=n:ja.push.apply(ja,n),fr=null),n}function Wl(n){fr===null?fr=[n]:fr.push(n)}var Kf=R(null),oi=null,Fs=null;function hr(n,s,o){G(Kf,s._currentValue),s._currentValue=o}function Bs(n){n._currentValue=Kf.current,q(Kf)}function Wf(n,s,o){for(;n!==null;){var d=n.alternate;if((n.childLanes&s)!==s?(n.childLanes|=s,d!==null&&(d.childLanes|=s)):d!==null&&(d.childLanes&s)!==s&&(d.childLanes|=s),n===o)break;n=n.return}}function Zf(n,s,o,d){var b=n.child;for(b!==null&&(b.return=n);b!==null;){var x=b.dependencies;if(x!==null){var $=b.child;x=x.firstContext;e:for(;x!==null;){var K=x;x=b;for(var pe=0;pe<s.length;pe++)if(K.context===s[pe]){x.lanes|=o,K=x.alternate,K!==null&&(K.lanes|=o),Wf(x.return,o,n),d||($=null);break e}x=K.next}}else if(b.tag===18){if($=b.return,$===null)throw Error(i(341));$.lanes|=o,x=$.alternate,x!==null&&(x.lanes|=o),Wf($,o,n),$=null}else $=b.child;if($!==null)$.return=b;else for($=b;$!==null;){if($===n){$=null;break}if(b=$.sibling,b!==null){b.return=$.return,$=b;break}$=$.return}b=$}}function Gi(n,s,o,d){n=null;for(var b=s,x=!1;b!==null;){if(!x){if((b.flags&524288)!==0)x=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var $=b.alternate;if($===null)throw Error(i(387));if($=$.memoizedProps,$!==null){var K=b.type;Ia(b.pendingProps.value,$.value)||(n!==null?n.push(K):n=[K])}}else if(b===me.current){if($=b.alternate,$===null)throw Error(i(387));$.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(n!==null?n.push(Eo):n=[Eo])}b=b.return}n!==null&&Zf(s,n,o,d),s.flags|=262144}function Uc(n){for(n=n.firstContext;n!==null;){if(!Ia(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function ci(n){oi=n,Fs=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function ca(n){return ib(oi,n)}function qc(n,s){return oi===null&&ci(n),ib(n,s)}function ib(n,s){var o=s._currentValue;if(s={context:s,memoizedValue:o,next:null},Fs===null){if(n===null)throw Error(i(308));Fs=s,n.dependencies={lanes:0,firstContext:s},n.flags|=524288}else Fs=Fs.next=s;return o}var c_=typeof AbortController<"u"?AbortController:function(){var n=[],s=this.signal={aborted:!1,addEventListener:function(o,d){n.push(d)}};this.abort=function(){s.aborted=!0,n.forEach(function(o){return o()})}},u_=e.unstable_scheduleCallback,d_=e.unstable_NormalPriority,Wn={$$typeof:O,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Qf(){return{controller:new c_,data:new Map,refCount:0}}function Zl(n){n.refCount--,n.refCount===0&&u_(d_,function(){n.controller.abort()})}var Ql=null,Jf=0,Xi=0,Ki=null;function f_(n,s){if(Ql===null){var o=Ql=[];Jf=0,Xi=nh(),Ki={status:"pending",value:void 0,then:function(d){o.push(d)}}}return Jf++,s.then(lb,lb),s}function lb(){if(--Jf===0&&Ql!==null){Ki!==null&&(Ki.status="fulfilled");var n=Ql;Ql=null,Xi=0,Ki=null;for(var s=0;s<n.length;s++)(0,n[s])()}}function m_(n,s){var o=[],d={status:"pending",value:null,reason:null,then:function(b){o.push(b)}};return n.then(function(){d.status="fulfilled",d.value=s;for(var b=0;b<o.length;b++)(0,o[b])(s)},function(b){for(d.status="rejected",d.reason=b,b=0;b<o.length;b++)(0,o[b])(void 0)}),d}var ob=D.S;D.S=function(n,s){Vv=Qe(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&f_(n,s),ob!==null&&ob(n,s)};var ui=R(null);function em(){var n=ui.current;return n!==null?n:Dn.pooledCache}function Hc(n,s){s===null?G(ui,ui.current):G(ui,s.pool)}function cb(){var n=em();return n===null?null:{parent:Wn._currentValue,pool:n}}var Wi=Error(i(460)),tm=Error(i(474)),Pc=Error(i(542)),Vc={then:function(){}};function ub(n){return n=n.status,n==="fulfilled"||n==="rejected"}function db(n,s,o){switch(o=n[o],o===void 0?n.push(s):o!==s&&(s.then(ia,ia),s=o),s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,mb(n),n;default:if(typeof s.status=="string")s.then(ia,ia);else{if(n=Dn,n!==null&&100<n.shellSuspendCounter)throw Error(i(482));n=s,n.status="pending",n.then(function(d){if(s.status==="pending"){var b=s;b.status="fulfilled",b.value=d}},function(d){if(s.status==="pending"){var b=s;b.status="rejected",b.reason=d}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,mb(n),n}throw fi=s,Wi}}function di(n){try{var s=n._init;return s(n._payload)}catch(o){throw o!==null&&typeof o=="object"&&typeof o.then=="function"?(fi=o,Wi):o}}var fi=null;function fb(){if(fi===null)throw Error(i(459));var n=fi;return fi=null,n}function mb(n){if(n===Wi||n===Pc)throw Error(i(483))}var Zi=null,Jl=0;function Yc(n){var s=Jl;return Jl+=1,Zi===null&&(Zi=[]),db(Zi,n,s)}function eo(n,s){s=s.props.ref,n.ref=s!==void 0?s:null}function Gc(n,s){throw s.$$typeof===v?Error(i(525)):(n=Object.prototype.toString.call(s),Error(i(31,n==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":n)))}function hb(n){function s(Te,xe){if(n){var Ie=Te.deletions;Ie===null?(Te.deletions=[xe],Te.flags|=16):Ie.push(xe)}}function o(Te,xe){if(!n)return null;for(;xe!==null;)s(Te,xe),xe=xe.sibling;return null}function d(Te){for(var xe=new Map;Te!==null;)Te.key!==null?xe.set(Te.key,Te):xe.set(Te.index,Te),Te=Te.sibling;return xe}function b(Te,xe){return Te=zs(Te,xe),Te.index=0,Te.sibling=null,Te}function x(Te,xe,Ie){return Te.index=Ie,n?(Ie=Te.alternate,Ie!==null?(Ie=Ie.index,Ie<xe?(Te.flags|=67108866,xe):Ie):(Te.flags|=67108866,xe)):(Te.flags|=1048576,xe)}function $(Te){return n&&Te.alternate===null&&(Te.flags|=67108866),Te}function K(Te,xe,Ie,rt){return xe===null||xe.tag!==6?(xe=Hf(Ie,Te.mode,rt),xe.return=Te,xe):(xe=b(xe,Ie),xe.return=Te,xe)}function pe(Te,xe,Ie,rt){var Ht=Ie.type;return Ht===N?et(Te,xe,Ie.props.children,rt,Ie.key):xe!==null&&(xe.elementType===Ht||typeof Ht=="object"&&Ht!==null&&Ht.$$typeof===z&&di(Ht)===xe.type)?(xe=b(xe,Ie.props),eo(xe,Ie),xe.return=Te,xe):(xe=Fc(Ie.type,Ie.key,Ie.props,null,Te.mode,rt),eo(xe,Ie),xe.return=Te,xe)}function Le(Te,xe,Ie,rt){return xe===null||xe.tag!==4||xe.stateNode.containerInfo!==Ie.containerInfo||xe.stateNode.implementation!==Ie.implementation?(xe=Pf(Ie,Te.mode,rt),xe.return=Te,xe):(xe=b(xe,Ie.children||[]),xe.return=Te,xe)}function et(Te,xe,Ie,rt,Ht){return xe===null||xe.tag!==7?(xe=ii(Ie,Te.mode,rt,Ht),xe.return=Te,xe):(xe=b(xe,Ie),xe.return=Te,xe)}function lt(Te,xe,Ie){if(typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint")return xe=Hf(""+xe,Te.mode,Ie),xe.return=Te,xe;if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case S:return Ie=Fc(xe.type,xe.key,xe.props,null,Te.mode,Ie),eo(Ie,xe),Ie.return=Te,Ie;case w:return xe=Pf(xe,Te.mode,Ie),xe.return=Te,xe;case z:return xe=di(xe),lt(Te,xe,Ie)}if(F(xe)||Y(xe))return xe=ii(xe,Te.mode,Ie,null),xe.return=Te,xe;if(typeof xe.then=="function")return lt(Te,Yc(xe),Ie);if(xe.$$typeof===O)return lt(Te,qc(Te,xe),Ie);Gc(Te,xe)}return null}function Fe(Te,xe,Ie,rt){var Ht=xe!==null?xe.key:null;if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint")return Ht!==null?null:K(Te,xe,""+Ie,rt);if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case S:return Ie.key===Ht?pe(Te,xe,Ie,rt):null;case w:return Ie.key===Ht?Le(Te,xe,Ie,rt):null;case z:return Ie=di(Ie),Fe(Te,xe,Ie,rt)}if(F(Ie)||Y(Ie))return Ht!==null?null:et(Te,xe,Ie,rt,null);if(typeof Ie.then=="function")return Fe(Te,xe,Yc(Ie),rt);if(Ie.$$typeof===O)return Fe(Te,xe,qc(Te,Ie),rt);Gc(Te,Ie)}return null}function Ye(Te,xe,Ie,rt,Ht){if(typeof rt=="string"&&rt!==""||typeof rt=="number"||typeof rt=="bigint")return Te=Te.get(Ie)||null,K(xe,Te,""+rt,Ht);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case S:return Te=Te.get(rt.key===null?Ie:rt.key)||null,pe(xe,Te,rt,Ht);case w:return Te=Te.get(rt.key===null?Ie:rt.key)||null,Le(xe,Te,rt,Ht);case z:return rt=di(rt),Ye(Te,xe,Ie,rt,Ht)}if(F(rt)||Y(rt))return Te=Te.get(Ie)||null,et(xe,Te,rt,Ht,null);if(typeof rt.then=="function")return Ye(Te,xe,Ie,Yc(rt),Ht);if(rt.$$typeof===O)return Ye(Te,xe,Ie,qc(xe,rt),Ht);Gc(xe,rt)}return null}function Ot(Te,xe,Ie,rt){for(var Ht=null,Sn=null,$t=xe,an=xe=0,gn=null;$t!==null&&an<Ie.length;an++){$t.index>an?(gn=$t,$t=null):gn=$t.sibling;var wn=Fe(Te,$t,Ie[an],rt);if(wn===null){$t===null&&($t=gn);break}n&&$t&&wn.alternate===null&&s(Te,$t),xe=x(wn,xe,an),Sn===null?Ht=wn:Sn.sibling=wn,Sn=wn,$t=gn}if(an===Ie.length)return o(Te,$t),bn&&$s(Te,an),Ht;if($t===null){for(;an<Ie.length;an++)$t=lt(Te,Ie[an],rt),$t!==null&&(xe=x($t,xe,an),Sn===null?Ht=$t:Sn.sibling=$t,Sn=$t);return bn&&$s(Te,an),Ht}for($t=d($t);an<Ie.length;an++)gn=Ye($t,Te,an,Ie[an],rt),gn!==null&&(n&&gn.alternate!==null&&$t.delete(gn.key===null?an:gn.key),xe=x(gn,xe,an),Sn===null?Ht=gn:Sn.sibling=gn,Sn=gn);return n&&$t.forEach(function(kr){return s(Te,kr)}),bn&&$s(Te,an),Ht}function Xt(Te,xe,Ie,rt){if(Ie==null)throw Error(i(151));for(var Ht=null,Sn=null,$t=xe,an=xe=0,gn=null,wn=Ie.next();$t!==null&&!wn.done;an++,wn=Ie.next()){$t.index>an?(gn=$t,$t=null):gn=$t.sibling;var kr=Fe(Te,$t,wn.value,rt);if(kr===null){$t===null&&($t=gn);break}n&&$t&&kr.alternate===null&&s(Te,$t),xe=x(kr,xe,an),Sn===null?Ht=kr:Sn.sibling=kr,Sn=kr,$t=gn}if(wn.done)return o(Te,$t),bn&&$s(Te,an),Ht;if($t===null){for(;!wn.done;an++,wn=Ie.next())wn=lt(Te,wn.value,rt),wn!==null&&(xe=x(wn,xe,an),Sn===null?Ht=wn:Sn.sibling=wn,Sn=wn);return bn&&$s(Te,an),Ht}for($t=d($t);!wn.done;an++,wn=Ie.next())wn=Ye($t,Te,an,wn.value,rt),wn!==null&&(n&&wn.alternate!==null&&$t.delete(wn.key===null?an:wn.key),xe=x(wn,xe,an),Sn===null?Ht=wn:Sn.sibling=wn,Sn=wn);return n&&$t.forEach(function(EC){return s(Te,EC)}),bn&&$s(Te,an),Ht}function kn(Te,xe,Ie,rt){if(typeof Ie=="object"&&Ie!==null&&Ie.type===N&&Ie.key===null&&(Ie=Ie.props.children),typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case S:e:{for(var Ht=Ie.key;xe!==null;){if(xe.key===Ht){if(Ht=Ie.type,Ht===N){if(xe.tag===7){o(Te,xe.sibling),rt=b(xe,Ie.props.children),rt.return=Te,Te=rt;break e}}else if(xe.elementType===Ht||typeof Ht=="object"&&Ht!==null&&Ht.$$typeof===z&&di(Ht)===xe.type){o(Te,xe.sibling),rt=b(xe,Ie.props),eo(rt,Ie),rt.return=Te,Te=rt;break e}o(Te,xe);break}else s(Te,xe);xe=xe.sibling}Ie.type===N?(rt=ii(Ie.props.children,Te.mode,rt,Ie.key),rt.return=Te,Te=rt):(rt=Fc(Ie.type,Ie.key,Ie.props,null,Te.mode,rt),eo(rt,Ie),rt.return=Te,Te=rt)}return $(Te);case w:e:{for(Ht=Ie.key;xe!==null;){if(xe.key===Ht)if(xe.tag===4&&xe.stateNode.containerInfo===Ie.containerInfo&&xe.stateNode.implementation===Ie.implementation){o(Te,xe.sibling),rt=b(xe,Ie.children||[]),rt.return=Te,Te=rt;break e}else{o(Te,xe);break}else s(Te,xe);xe=xe.sibling}rt=Pf(Ie,Te.mode,rt),rt.return=Te,Te=rt}return $(Te);case z:return Ie=di(Ie),kn(Te,xe,Ie,rt)}if(F(Ie))return Ot(Te,xe,Ie,rt);if(Y(Ie)){if(Ht=Y(Ie),typeof Ht!="function")throw Error(i(150));return Ie=Ht.call(Ie),Xt(Te,xe,Ie,rt)}if(typeof Ie.then=="function")return kn(Te,xe,Yc(Ie),rt);if(Ie.$$typeof===O)return kn(Te,xe,qc(Te,Ie),rt);Gc(Te,Ie)}return typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint"?(Ie=""+Ie,xe!==null&&xe.tag===6?(o(Te,xe.sibling),rt=b(xe,Ie),rt.return=Te,Te=rt):(o(Te,xe),rt=Hf(Ie,Te.mode,rt),rt.return=Te,Te=rt),$(Te)):o(Te,xe)}return function(Te,xe,Ie,rt){try{Jl=0;var Ht=kn(Te,xe,Ie,rt);return Zi=null,Ht}catch($t){if($t===Wi||$t===Pc)throw $t;var Sn=La(29,$t,null,Te.mode);return Sn.lanes=rt,Sn.return=Te,Sn}finally{}}}var mi=hb(!0),pb=hb(!1),pr=!1;function nm(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function am(n,s){n=n.updateQueue,s.updateQueue===n&&(s.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function yr(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function gr(n,s,o){var d=n.updateQueue;if(d===null)return null;if(d=d.shared,(_n&2)!==0){var b=d.pending;return b===null?s.next=s:(s.next=b.next,b.next=s),d.pending=s,s=$c(n),Qg(n,null,o),s}return zc(n,d,s,o),$c(n)}function to(n,s,o){if(s=s.updateQueue,s!==null&&(s=s.shared,(o&4194048)!==0)){var d=s.lanes;d&=n.pendingLanes,o|=d,s.lanes=o,Ze(n,o)}}function sm(n,s){var o=n.updateQueue,d=n.alternate;if(d!==null&&(d=d.updateQueue,o===d)){var b=null,x=null;if(o=o.firstBaseUpdate,o!==null){do{var $={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};x===null?b=x=$:x=x.next=$,o=o.next}while(o!==null);x===null?b=x=s:x=x.next=s}else b=x=s;o={baseState:d.baseState,firstBaseUpdate:b,lastBaseUpdate:x,shared:d.shared,callbacks:d.callbacks},n.updateQueue=o;return}n=o.lastBaseUpdate,n===null?o.firstBaseUpdate=s:n.next=s,o.lastBaseUpdate=s}var rm=!1;function no(){if(rm){var n=Ki;if(n!==null)throw n}}function ao(n,s,o,d){rm=!1;var b=n.updateQueue;pr=!1;var x=b.firstBaseUpdate,$=b.lastBaseUpdate,K=b.shared.pending;if(K!==null){b.shared.pending=null;var pe=K,Le=pe.next;pe.next=null,$===null?x=Le:$.next=Le,$=pe;var et=n.alternate;et!==null&&(et=et.updateQueue,K=et.lastBaseUpdate,K!==$&&(K===null?et.firstBaseUpdate=Le:K.next=Le,et.lastBaseUpdate=pe))}if(x!==null){var lt=b.baseState;$=0,et=Le=pe=null,K=x;do{var Fe=K.lane&-536870913,Ye=Fe!==K.lane;if(Ye?(yn&Fe)===Fe:(d&Fe)===Fe){Fe!==0&&Fe===Xi&&(rm=!0),et!==null&&(et=et.next={lane:0,tag:K.tag,payload:K.payload,callback:null,next:null});e:{var Ot=n,Xt=K;Fe=s;var kn=o;switch(Xt.tag){case 1:if(Ot=Xt.payload,typeof Ot=="function"){lt=Ot.call(kn,lt,Fe);break e}lt=Ot;break e;case 3:Ot.flags=Ot.flags&-65537|128;case 0:if(Ot=Xt.payload,Fe=typeof Ot=="function"?Ot.call(kn,lt,Fe):Ot,Fe==null)break e;lt=g({},lt,Fe);break e;case 2:pr=!0}}Fe=K.callback,Fe!==null&&(n.flags|=64,Ye&&(n.flags|=8192),Ye=b.callbacks,Ye===null?b.callbacks=[Fe]:Ye.push(Fe))}else Ye={lane:Fe,tag:K.tag,payload:K.payload,callback:K.callback,next:null},et===null?(Le=et=Ye,pe=lt):et=et.next=Ye,$|=Fe;if(K=K.next,K===null){if(K=b.shared.pending,K===null)break;Ye=K,K=Ye.next,Ye.next=null,b.lastBaseUpdate=Ye,b.shared.pending=null}}while(!0);et===null&&(pe=lt),b.baseState=pe,b.firstBaseUpdate=Le,b.lastBaseUpdate=et,x===null&&(b.shared.lanes=0),wr|=$,n.lanes=$,n.memoizedState=lt}}function yb(n,s){if(typeof n!="function")throw Error(i(191,n));n.call(s)}function gb(n,s){var o=n.callbacks;if(o!==null)for(n.callbacks=null,n=0;n<o.length;n++)yb(o[n],s)}var Qi=R(null),Xc=R(0);function bb(n,s){n=Ks,G(Xc,n),G(Qi,s),Ks=n|s.baseLanes}function im(){G(Xc,Ks),G(Qi,Qi.current)}function lm(){Ks=Xc.current,q(Qi),q(Xc)}var Oa=R(null),Ja=null;function br(n){var s=n.alternate;G(Gn,Gn.current&1),G(Oa,n),Ja===null&&(s===null||Qi.current!==null||s.memoizedState!==null)&&(Ja=n)}function om(n){G(Gn,Gn.current),G(Oa,n),Ja===null&&(Ja=n)}function vb(n){n.tag===22?(G(Gn,Gn.current),G(Oa,n),Ja===null&&(Ja=n)):vr()}function vr(){G(Gn,Gn.current),G(Oa,Oa.current)}function za(n){q(Oa),Ja===n&&(Ja=null),q(Gn)}var Gn=R(0);function Kc(n){for(var s=n;s!==null;){if(s.tag===13){var o=s.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||hh(o)||ph(o)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Us=0,tn=null,Mn=null,Zn=null,Wc=!1,Ji=!1,hi=!1,Zc=0,so=0,el=null,h_=0;function Hn(){throw Error(i(321))}function cm(n,s){if(s===null)return!1;for(var o=0;o<s.length&&o<n.length;o++)if(!Ia(n[o],s[o]))return!1;return!0}function um(n,s,o,d,b,x){return Us=x,tn=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,D.H=n===null||n.memoizedState===null?nv:jm,hi=!1,x=o(d,b),hi=!1,Ji&&(x=Sb(s,o,d,b)),xb(n),x}function xb(n){D.H=lo;var s=Mn!==null&&Mn.next!==null;if(Us=0,Zn=Mn=tn=null,Wc=!1,so=0,el=null,s)throw Error(i(300));n===null||Qn||(n=n.dependencies,n!==null&&Uc(n)&&(Qn=!0))}function Sb(n,s,o,d){tn=n;var b=0;do{if(Ji&&(el=null),so=0,Ji=!1,25<=b)throw Error(i(301));if(b+=1,Zn=Mn=null,n.updateQueue!=null){var x=n.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}D.H=av,x=s(o,d)}while(Ji);return x}function p_(){var n=D.H,s=n.useState()[0];return s=typeof s.then=="function"?ro(s):s,n=n.useState()[0],(Mn!==null?Mn.memoizedState:null)!==n&&(tn.flags|=1024),s}function dm(){var n=Zc!==0;return Zc=0,n}function fm(n,s,o){s.updateQueue=n.updateQueue,s.flags&=-2053,n.lanes&=~o}function mm(n){if(Wc){for(n=n.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}Wc=!1}Us=0,Zn=Mn=tn=null,Ji=!1,so=Zc=0,el=null}function ga(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Zn===null?tn.memoizedState=Zn=n:Zn=Zn.next=n,Zn}function Xn(){if(Mn===null){var n=tn.alternate;n=n!==null?n.memoizedState:null}else n=Mn.next;var s=Zn===null?tn.memoizedState:Zn.next;if(s!==null)Zn=s,Mn=n;else{if(n===null)throw tn.alternate===null?Error(i(467)):Error(i(310));Mn=n,n={memoizedState:Mn.memoizedState,baseState:Mn.baseState,baseQueue:Mn.baseQueue,queue:Mn.queue,next:null},Zn===null?tn.memoizedState=Zn=n:Zn=Zn.next=n}return Zn}function Qc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ro(n){var s=so;return so+=1,el===null&&(el=[]),n=db(el,n,s),s=tn,(Zn===null?s.memoizedState:Zn.next)===null&&(s=s.alternate,D.H=s===null||s.memoizedState===null?nv:jm),n}function Jc(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return ro(n);if(n.$$typeof===O)return ca(n)}throw Error(i(438,String(n)))}function hm(n){var s=null,o=tn.updateQueue;if(o!==null&&(s=o.memoCache),s==null){var d=tn.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(s={data:d.data.map(function(b){return b.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),o===null&&(o=Qc(),tn.updateQueue=o),o.memoCache=s,o=s.data[s.index],o===void 0)for(o=s.data[s.index]=Array(n),d=0;d<n;d++)o[d]=X;return s.index++,o}function qs(n,s){return typeof s=="function"?s(n):s}function eu(n){var s=Xn();return pm(s,Mn,n)}function pm(n,s,o){var d=n.queue;if(d===null)throw Error(i(311));d.lastRenderedReducer=o;var b=n.baseQueue,x=d.pending;if(x!==null){if(b!==null){var $=b.next;b.next=x.next,x.next=$}s.baseQueue=b=x,d.pending=null}if(x=n.baseState,b===null)n.memoizedState=x;else{s=b.next;var K=$=null,pe=null,Le=s,et=!1;do{var lt=Le.lane&-536870913;if(lt!==Le.lane?(yn&lt)===lt:(Us&lt)===lt){var Fe=Le.revertLane;if(Fe===0)pe!==null&&(pe=pe.next={lane:0,revertLane:0,gesture:null,action:Le.action,hasEagerState:Le.hasEagerState,eagerState:Le.eagerState,next:null}),lt===Xi&&(et=!0);else if((Us&Fe)===Fe){Le=Le.next,Fe===Xi&&(et=!0);continue}else lt={lane:0,revertLane:Le.revertLane,gesture:null,action:Le.action,hasEagerState:Le.hasEagerState,eagerState:Le.eagerState,next:null},pe===null?(K=pe=lt,$=x):pe=pe.next=lt,tn.lanes|=Fe,wr|=Fe;lt=Le.action,hi&&o(x,lt),x=Le.hasEagerState?Le.eagerState:o(x,lt)}else Fe={lane:lt,revertLane:Le.revertLane,gesture:Le.gesture,action:Le.action,hasEagerState:Le.hasEagerState,eagerState:Le.eagerState,next:null},pe===null?(K=pe=Fe,$=x):pe=pe.next=Fe,tn.lanes|=lt,wr|=lt;Le=Le.next}while(Le!==null&&Le!==s);if(pe===null?$=x:pe.next=K,!Ia(x,n.memoizedState)&&(Qn=!0,et&&(o=Ki,o!==null)))throw o;n.memoizedState=x,n.baseState=$,n.baseQueue=pe,d.lastRenderedState=x}return b===null&&(d.lanes=0),[n.memoizedState,d.dispatch]}function ym(n){var s=Xn(),o=s.queue;if(o===null)throw Error(i(311));o.lastRenderedReducer=n;var d=o.dispatch,b=o.pending,x=s.memoizedState;if(b!==null){o.pending=null;var $=b=b.next;do x=n(x,$.action),$=$.next;while($!==b);Ia(x,s.memoizedState)||(Qn=!0),s.memoizedState=x,s.baseQueue===null&&(s.baseState=x),o.lastRenderedState=x}return[x,d]}function wb(n,s,o){var d=tn,b=Xn(),x=bn;if(x){if(o===void 0)throw Error(i(407));o=o()}else o=s();var $=!Ia((Mn||b).memoizedState,o);if($&&(b.memoizedState=o,Qn=!0),b=b.queue,vm(jb.bind(null,d,b,n),[n]),b.getSnapshot!==s||$||Zn!==null&&Zn.memoizedState.tag&1){if(d.flags|=2048,tl(9,{destroy:void 0},Eb.bind(null,d,b,o,s),null),Dn===null)throw Error(i(349));x||(Us&127)!==0||Nb(d,s,o)}return o}function Nb(n,s,o){n.flags|=16384,n={getSnapshot:s,value:o},s=tn.updateQueue,s===null?(s=Qc(),tn.updateQueue=s,s.stores=[n]):(o=s.stores,o===null?s.stores=[n]:o.push(n))}function Eb(n,s,o,d){s.value=o,s.getSnapshot=d,_b(s)&&Cb(n)}function jb(n,s,o){return o(function(){_b(s)&&Cb(n)})}function _b(n){var s=n.getSnapshot;n=n.value;try{var o=s();return!Ia(n,o)}catch{return!0}}function Cb(n){var s=ri(n,2);s!==null&&_a(s,n,2)}function gm(n){var s=ga();if(typeof n=="function"){var o=n;if(n=o(),hi){nt(!0);try{o()}finally{nt(!1)}}}return s.memoizedState=s.baseState=n,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:qs,lastRenderedState:n},s}function Ab(n,s,o,d){return n.baseState=o,pm(n,Mn,typeof d=="function"?d:qs)}function y_(n,s,o,d,b){if(au(n))throw Error(i(485));if(n=s.action,n!==null){var x={payload:b,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function($){x.listeners.push($)}};D.T!==null?o(!0):x.isTransition=!1,d(x),o=s.pending,o===null?(x.next=s.pending=x,Tb(s,x)):(x.next=o.next,s.pending=o.next=x)}}function Tb(n,s){var o=s.action,d=s.payload,b=n.state;if(s.isTransition){var x=D.T,$={};D.T=$;try{var K=o(b,d),pe=D.S;pe!==null&&pe($,K),Mb(n,s,K)}catch(Le){bm(n,s,Le)}finally{x!==null&&$.types!==null&&(x.types=$.types),D.T=x}}else try{x=o(b,d),Mb(n,s,x)}catch(Le){bm(n,s,Le)}}function Mb(n,s,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(d){Rb(n,s,d)},function(d){return bm(n,s,d)}):Rb(n,s,o)}function Rb(n,s,o){s.status="fulfilled",s.value=o,kb(s),n.state=o,s=n.pending,s!==null&&(o=s.next,o===s?n.pending=null:(o=o.next,s.next=o,Tb(n,o)))}function bm(n,s,o){var d=n.pending;if(n.pending=null,d!==null){d=d.next;do s.status="rejected",s.reason=o,kb(s),s=s.next;while(s!==d)}n.action=null}function kb(n){n=n.listeners;for(var s=0;s<n.length;s++)(0,n[s])()}function Db(n,s){return s}function Ib(n,s){if(bn){var o=Dn.formState;if(o!==null){e:{var d=tn;if(bn){if(Ln){t:{for(var b=Ln,x=Qa;b.nodeType!==8;){if(!x){b=null;break t}if(b=es(b.nextSibling),b===null){b=null;break t}}x=b.data,b=x==="F!"||x==="F"?b:null}if(b){Ln=es(b.nextSibling),d=b.data==="F!";break e}}mr(d)}d=!1}d&&(s=o[0])}}return o=ga(),o.memoizedState=o.baseState=s,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Db,lastRenderedState:s},o.queue=d,o=Jb.bind(null,tn,d),d.dispatch=o,d=gm(!1),x=Em.bind(null,tn,!1,d.queue),d=ga(),b={state:s,dispatch:null,action:n,pending:null},d.queue=b,o=y_.bind(null,tn,b,x,o),b.dispatch=o,d.memoizedState=n,[s,o,!1]}function Lb(n){var s=Xn();return Ob(s,Mn,n)}function Ob(n,s,o){if(s=pm(n,s,Db)[0],n=eu(qs)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var d=ro(s)}catch($){throw $===Wi?Pc:$}else d=s;s=Xn();var b=s.queue,x=b.dispatch;return o!==s.memoizedState&&(tn.flags|=2048,tl(9,{destroy:void 0},g_.bind(null,b,o),null)),[d,x,n]}function g_(n,s){n.action=s}function zb(n){var s=Xn(),o=Mn;if(o!==null)return Ob(s,o,n);Xn(),s=s.memoizedState,o=Xn();var d=o.queue.dispatch;return o.memoizedState=n,[s,d,!1]}function tl(n,s,o,d){return n={tag:n,create:o,deps:d,inst:s,next:null},s=tn.updateQueue,s===null&&(s=Qc(),tn.updateQueue=s),o=s.lastEffect,o===null?s.lastEffect=n.next=n:(d=o.next,o.next=n,n.next=d,s.lastEffect=n),n}function $b(){return Xn().memoizedState}function tu(n,s,o,d){var b=ga();tn.flags|=n,b.memoizedState=tl(1|s,{destroy:void 0},o,d===void 0?null:d)}function nu(n,s,o,d){var b=Xn();d=d===void 0?null:d;var x=b.memoizedState.inst;Mn!==null&&d!==null&&cm(d,Mn.memoizedState.deps)?b.memoizedState=tl(s,x,o,d):(tn.flags|=n,b.memoizedState=tl(1|s,x,o,d))}function Fb(n,s){tu(8390656,8,n,s)}function vm(n,s){nu(2048,8,n,s)}function b_(n){tn.flags|=4;var s=tn.updateQueue;if(s===null)s=Qc(),tn.updateQueue=s,s.events=[n];else{var o=s.events;o===null?s.events=[n]:o.push(n)}}function Bb(n){var s=Xn().memoizedState;return b_({ref:s,nextImpl:n}),function(){if((_n&2)!==0)throw Error(i(440));return s.impl.apply(void 0,arguments)}}function Ub(n,s){return nu(4,2,n,s)}function qb(n,s){return nu(4,4,n,s)}function Hb(n,s){if(typeof s=="function"){n=n();var o=s(n);return function(){typeof o=="function"?o():s(null)}}if(s!=null)return n=n(),s.current=n,function(){s.current=null}}function Pb(n,s,o){o=o!=null?o.concat([n]):null,nu(4,4,Hb.bind(null,s,n),o)}function xm(){}function Vb(n,s){var o=Xn();s=s===void 0?null:s;var d=o.memoizedState;return s!==null&&cm(s,d[1])?d[0]:(o.memoizedState=[n,s],n)}function Yb(n,s){var o=Xn();s=s===void 0?null:s;var d=o.memoizedState;if(s!==null&&cm(s,d[1]))return d[0];if(d=n(),hi){nt(!0);try{n()}finally{nt(!1)}}return o.memoizedState=[d,s],d}function Sm(n,s,o){return o===void 0||(Us&1073741824)!==0&&(yn&261930)===0?n.memoizedState=s:(n.memoizedState=o,n=Gv(),tn.lanes|=n,wr|=n,o)}function Gb(n,s,o,d){return Ia(o,s)?o:Qi.current!==null?(n=Sm(n,o,d),Ia(n,s)||(Qn=!0),n):(Us&42)===0||(Us&1073741824)!==0&&(yn&261930)===0?(Qn=!0,n.memoizedState=o):(n=Gv(),tn.lanes|=n,wr|=n,s)}function Xb(n,s,o,d,b){var x=L.p;L.p=x!==0&&8>x?x:8;var $=D.T,K={};D.T=K,Em(n,!1,s,o);try{var pe=b(),Le=D.S;if(Le!==null&&Le(K,pe),pe!==null&&typeof pe=="object"&&typeof pe.then=="function"){var et=m_(pe,d);io(n,s,et,Ba(n))}else io(n,s,d,Ba(n))}catch(lt){io(n,s,{then:function(){},status:"rejected",reason:lt},Ba())}finally{L.p=x,$!==null&&K.types!==null&&($.types=K.types),D.T=$}}function v_(){}function wm(n,s,o,d){if(n.tag!==5)throw Error(i(476));var b=Kb(n).queue;Xb(n,b,s,B,o===null?v_:function(){return Wb(n),o(d)})}function Kb(n){var s=n.memoizedState;if(s!==null)return s;s={memoizedState:B,baseState:B,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qs,lastRenderedState:B},next:null};var o={};return s.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qs,lastRenderedState:o},next:null},n.memoizedState=s,n=n.alternate,n!==null&&(n.memoizedState=s),s}function Wb(n){var s=Kb(n);s.next===null&&(s=n.alternate.memoizedState),io(n,s.next.queue,{},Ba())}function Nm(){return ca(Eo)}function Zb(){return Xn().memoizedState}function Qb(){return Xn().memoizedState}function x_(n){for(var s=n.return;s!==null;){switch(s.tag){case 24:case 3:var o=Ba();n=yr(o);var d=gr(s,n,o);d!==null&&(_a(d,s,o),to(d,s,o)),s={cache:Qf()},n.payload=s;return}s=s.return}}function S_(n,s,o){var d=Ba();o={lane:d,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},au(n)?ev(s,o):(o=Uf(n,s,o,d),o!==null&&(_a(o,n,d),tv(o,s,d)))}function Jb(n,s,o){var d=Ba();io(n,s,o,d)}function io(n,s,o,d){var b={lane:d,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null};if(au(n))ev(s,b);else{var x=n.alternate;if(n.lanes===0&&(x===null||x.lanes===0)&&(x=s.lastRenderedReducer,x!==null))try{var $=s.lastRenderedState,K=x($,o);if(b.hasEagerState=!0,b.eagerState=K,Ia(K,$))return zc(n,s,b,0),Dn===null&&Oc(),!1}catch{}finally{}if(o=Uf(n,s,b,d),o!==null)return _a(o,n,d),tv(o,s,d),!0}return!1}function Em(n,s,o,d){if(d={lane:2,revertLane:nh(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},au(n)){if(s)throw Error(i(479))}else s=Uf(n,o,d,2),s!==null&&_a(s,n,2)}function au(n){var s=n.alternate;return n===tn||s!==null&&s===tn}function ev(n,s){Ji=Wc=!0;var o=n.pending;o===null?s.next=s:(s.next=o.next,o.next=s),n.pending=s}function tv(n,s,o){if((o&4194048)!==0){var d=s.lanes;d&=n.pendingLanes,o|=d,s.lanes=o,Ze(n,o)}}var lo={readContext:ca,use:Jc,useCallback:Hn,useContext:Hn,useEffect:Hn,useImperativeHandle:Hn,useLayoutEffect:Hn,useInsertionEffect:Hn,useMemo:Hn,useReducer:Hn,useRef:Hn,useState:Hn,useDebugValue:Hn,useDeferredValue:Hn,useTransition:Hn,useSyncExternalStore:Hn,useId:Hn,useHostTransitionStatus:Hn,useFormState:Hn,useActionState:Hn,useOptimistic:Hn,useMemoCache:Hn,useCacheRefresh:Hn};lo.useEffectEvent=Hn;var nv={readContext:ca,use:Jc,useCallback:function(n,s){return ga().memoizedState=[n,s===void 0?null:s],n},useContext:ca,useEffect:Fb,useImperativeHandle:function(n,s,o){o=o!=null?o.concat([n]):null,tu(4194308,4,Hb.bind(null,s,n),o)},useLayoutEffect:function(n,s){return tu(4194308,4,n,s)},useInsertionEffect:function(n,s){tu(4,2,n,s)},useMemo:function(n,s){var o=ga();s=s===void 0?null:s;var d=n();if(hi){nt(!0);try{n()}finally{nt(!1)}}return o.memoizedState=[d,s],d},useReducer:function(n,s,o){var d=ga();if(o!==void 0){var b=o(s);if(hi){nt(!0);try{o(s)}finally{nt(!1)}}}else b=s;return d.memoizedState=d.baseState=b,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:b},d.queue=n,n=n.dispatch=S_.bind(null,tn,n),[d.memoizedState,n]},useRef:function(n){var s=ga();return n={current:n},s.memoizedState=n},useState:function(n){n=gm(n);var s=n.queue,o=Jb.bind(null,tn,s);return s.dispatch=o,[n.memoizedState,o]},useDebugValue:xm,useDeferredValue:function(n,s){var o=ga();return Sm(o,n,s)},useTransition:function(){var n=gm(!1);return n=Xb.bind(null,tn,n.queue,!0,!1),ga().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,s,o){var d=tn,b=ga();if(bn){if(o===void 0)throw Error(i(407));o=o()}else{if(o=s(),Dn===null)throw Error(i(349));(yn&127)!==0||Nb(d,s,o)}b.memoizedState=o;var x={value:o,getSnapshot:s};return b.queue=x,Fb(jb.bind(null,d,x,n),[n]),d.flags|=2048,tl(9,{destroy:void 0},Eb.bind(null,d,x,o,s),null),o},useId:function(){var n=ga(),s=Dn.identifierPrefix;if(bn){var o=Ns,d=ws;o=(d&~(1<<32-ze(d)-1)).toString(32)+o,s="_"+s+"R_"+o,o=Zc++,0<o&&(s+="H"+o.toString(32)),s+="_"}else o=h_++,s="_"+s+"r_"+o.toString(32)+"_";return n.memoizedState=s},useHostTransitionStatus:Nm,useFormState:Ib,useActionState:Ib,useOptimistic:function(n){var s=ga();s.memoizedState=s.baseState=n;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=o,s=Em.bind(null,tn,!0,o),o.dispatch=s,[n,s]},useMemoCache:hm,useCacheRefresh:function(){return ga().memoizedState=x_.bind(null,tn)},useEffectEvent:function(n){var s=ga(),o={impl:n};return s.memoizedState=o,function(){if((_n&2)!==0)throw Error(i(440));return o.impl.apply(void 0,arguments)}}},jm={readContext:ca,use:Jc,useCallback:Vb,useContext:ca,useEffect:vm,useImperativeHandle:Pb,useInsertionEffect:Ub,useLayoutEffect:qb,useMemo:Yb,useReducer:eu,useRef:$b,useState:function(){return eu(qs)},useDebugValue:xm,useDeferredValue:function(n,s){var o=Xn();return Gb(o,Mn.memoizedState,n,s)},useTransition:function(){var n=eu(qs)[0],s=Xn().memoizedState;return[typeof n=="boolean"?n:ro(n),s]},useSyncExternalStore:wb,useId:Zb,useHostTransitionStatus:Nm,useFormState:Lb,useActionState:Lb,useOptimistic:function(n,s){var o=Xn();return Ab(o,Mn,n,s)},useMemoCache:hm,useCacheRefresh:Qb};jm.useEffectEvent=Bb;var av={readContext:ca,use:Jc,useCallback:Vb,useContext:ca,useEffect:vm,useImperativeHandle:Pb,useInsertionEffect:Ub,useLayoutEffect:qb,useMemo:Yb,useReducer:ym,useRef:$b,useState:function(){return ym(qs)},useDebugValue:xm,useDeferredValue:function(n,s){var o=Xn();return Mn===null?Sm(o,n,s):Gb(o,Mn.memoizedState,n,s)},useTransition:function(){var n=ym(qs)[0],s=Xn().memoizedState;return[typeof n=="boolean"?n:ro(n),s]},useSyncExternalStore:wb,useId:Zb,useHostTransitionStatus:Nm,useFormState:zb,useActionState:zb,useOptimistic:function(n,s){var o=Xn();return Mn!==null?Ab(o,Mn,n,s):(o.baseState=n,[n,o.queue.dispatch])},useMemoCache:hm,useCacheRefresh:Qb};av.useEffectEvent=Bb;function _m(n,s,o,d){s=n.memoizedState,o=o(d,s),o=o==null?s:g({},s,o),n.memoizedState=o,n.lanes===0&&(n.updateQueue.baseState=o)}var Cm={enqueueSetState:function(n,s,o){n=n._reactInternals;var d=Ba(),b=yr(d);b.payload=s,o!=null&&(b.callback=o),s=gr(n,b,d),s!==null&&(_a(s,n,d),to(s,n,d))},enqueueReplaceState:function(n,s,o){n=n._reactInternals;var d=Ba(),b=yr(d);b.tag=1,b.payload=s,o!=null&&(b.callback=o),s=gr(n,b,d),s!==null&&(_a(s,n,d),to(s,n,d))},enqueueForceUpdate:function(n,s){n=n._reactInternals;var o=Ba(),d=yr(o);d.tag=2,s!=null&&(d.callback=s),s=gr(n,d,o),s!==null&&(_a(s,n,o),to(s,n,o))}};function sv(n,s,o,d,b,x,$){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(d,x,$):s.prototype&&s.prototype.isPureReactComponent?!Gl(o,d)||!Gl(b,x):!0}function rv(n,s,o,d){n=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(o,d),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(o,d),s.state!==n&&Cm.enqueueReplaceState(s,s.state,null)}function pi(n,s){var o=s;if("ref"in s){o={};for(var d in s)d!=="ref"&&(o[d]=s[d])}if(n=n.defaultProps){o===s&&(o=g({},o));for(var b in n)o[b]===void 0&&(o[b]=n[b])}return o}function iv(n){Lc(n)}function lv(n){console.error(n)}function ov(n){Lc(n)}function su(n,s){try{var o=n.onUncaughtError;o(s.value,{componentStack:s.stack})}catch(d){setTimeout(function(){throw d})}}function cv(n,s,o){try{var d=n.onCaughtError;d(o.value,{componentStack:o.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function Am(n,s,o){return o=yr(o),o.tag=3,o.payload={element:null},o.callback=function(){su(n,s)},o}function uv(n){return n=yr(n),n.tag=3,n}function dv(n,s,o,d){var b=o.type.getDerivedStateFromError;if(typeof b=="function"){var x=d.value;n.payload=function(){return b(x)},n.callback=function(){cv(s,o,d)}}var $=o.stateNode;$!==null&&typeof $.componentDidCatch=="function"&&(n.callback=function(){cv(s,o,d),typeof b!="function"&&(Nr===null?Nr=new Set([this]):Nr.add(this));var K=d.stack;this.componentDidCatch(d.value,{componentStack:K!==null?K:""})})}function w_(n,s,o,d,b){if(o.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(s=o.alternate,s!==null&&Gi(s,o,b,!0),o=Oa.current,o!==null){switch(o.tag){case 31:case 13:return Ja===null?yu():o.alternate===null&&Pn===0&&(Pn=3),o.flags&=-257,o.flags|=65536,o.lanes=b,d===Vc?o.flags|=16384:(s=o.updateQueue,s===null?o.updateQueue=new Set([d]):s.add(d),Jm(n,d,b)),!1;case 22:return o.flags|=65536,d===Vc?o.flags|=16384:(s=o.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([d])},o.updateQueue=s):(o=s.retryQueue,o===null?s.retryQueue=new Set([d]):o.add(d)),Jm(n,d,b)),!1}throw Error(i(435,o.tag))}return Jm(n,d,b),yu(),!1}if(bn)return s=Oa.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=b,d!==Gf&&(n=Error(i(422),{cause:d}),Wl(Ka(n,o)))):(d!==Gf&&(s=Error(i(423),{cause:d}),Wl(Ka(s,o))),n=n.current.alternate,n.flags|=65536,b&=-b,n.lanes|=b,d=Ka(d,o),b=Am(n.stateNode,d,b),sm(n,b),Pn!==4&&(Pn=2)),!1;var x=Error(i(520),{cause:d});if(x=Ka(x,o),yo===null?yo=[x]:yo.push(x),Pn!==4&&(Pn=2),s===null)return!0;d=Ka(d,o),o=s;do{switch(o.tag){case 3:return o.flags|=65536,n=b&-b,o.lanes|=n,n=Am(o.stateNode,d,n),sm(o,n),!1;case 1:if(s=o.type,x=o.stateNode,(o.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Nr===null||!Nr.has(x))))return o.flags|=65536,b&=-b,o.lanes|=b,b=uv(b),dv(b,n,o,d),sm(o,b),!1}o=o.return}while(o!==null);return!1}var Tm=Error(i(461)),Qn=!1;function ua(n,s,o,d){s.child=n===null?pb(s,null,o,d):mi(s,n.child,o,d)}function fv(n,s,o,d,b){o=o.render;var x=s.ref;if("ref"in d){var $={};for(var K in d)K!=="ref"&&($[K]=d[K])}else $=d;return ci(s),d=um(n,s,o,$,x,b),K=dm(),n!==null&&!Qn?(fm(n,s,b),Hs(n,s,b)):(bn&&K&&Vf(s),s.flags|=1,ua(n,s,d,b),s.child)}function mv(n,s,o,d,b){if(n===null){var x=o.type;return typeof x=="function"&&!qf(x)&&x.defaultProps===void 0&&o.compare===null?(s.tag=15,s.type=x,hv(n,s,x,d,b)):(n=Fc(o.type,null,d,s,s.mode,b),n.ref=s.ref,n.return=s,s.child=n)}if(x=n.child,!zm(n,b)){var $=x.memoizedProps;if(o=o.compare,o=o!==null?o:Gl,o($,d)&&n.ref===s.ref)return Hs(n,s,b)}return s.flags|=1,n=zs(x,d),n.ref=s.ref,n.return=s,s.child=n}function hv(n,s,o,d,b){if(n!==null){var x=n.memoizedProps;if(Gl(x,d)&&n.ref===s.ref)if(Qn=!1,s.pendingProps=d=x,zm(n,b))(n.flags&131072)!==0&&(Qn=!0);else return s.lanes=n.lanes,Hs(n,s,b)}return Mm(n,s,o,d,b)}function pv(n,s,o,d){var b=d.children,x=n!==null?n.memoizedState:null;if(n===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((s.flags&128)!==0){if(x=x!==null?x.baseLanes|o:o,n!==null){for(d=s.child=n.child,b=0;d!==null;)b=b|d.lanes|d.childLanes,d=d.sibling;d=b&~x}else d=0,s.child=null;return yv(n,s,x,o,d)}if((o&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},n!==null&&Hc(s,x!==null?x.cachePool:null),x!==null?bb(s,x):im(),vb(s);else return d=s.lanes=536870912,yv(n,s,x!==null?x.baseLanes|o:o,o,d)}else x!==null?(Hc(s,x.cachePool),bb(s,x),vr(),s.memoizedState=null):(n!==null&&Hc(s,null),im(),vr());return ua(n,s,b,o),s.child}function oo(n,s){return n!==null&&n.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function yv(n,s,o,d,b){var x=em();return x=x===null?null:{parent:Wn._currentValue,pool:x},s.memoizedState={baseLanes:o,cachePool:x},n!==null&&Hc(s,null),im(),vb(s),n!==null&&Gi(n,s,d,!0),s.childLanes=b,null}function ru(n,s){return s=lu({mode:s.mode,children:s.children},n.mode),s.ref=n.ref,n.child=s,s.return=n,s}function gv(n,s,o){return mi(s,n.child,null,o),n=ru(s,s.pendingProps),n.flags|=2,za(s),s.memoizedState=null,n}function N_(n,s,o){var d=s.pendingProps,b=(s.flags&128)!==0;if(s.flags&=-129,n===null){if(bn){if(d.mode==="hidden")return n=ru(s,d),s.lanes=536870912,oo(null,n);if(om(s),(n=Ln)?(n=Tx(n,Qa),n=n!==null&&n.data==="&"?n:null,n!==null&&(s.memoizedState={dehydrated:n,treeContext:dr!==null?{id:ws,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},o=eb(n),o.return=s,s.child=o,oa=s,Ln=null)):n=null,n===null)throw mr(s);return s.lanes=536870912,null}return ru(s,d)}var x=n.memoizedState;if(x!==null){var $=x.dehydrated;if(om(s),b)if(s.flags&256)s.flags&=-257,s=gv(n,s,o);else if(s.memoizedState!==null)s.child=n.child,s.flags|=128,s=null;else throw Error(i(558));else if(Qn||Gi(n,s,o,!1),b=(o&n.childLanes)!==0,Qn||b){if(d=Dn,d!==null&&($=dt(d,o),$!==0&&$!==x.retryLane))throw x.retryLane=$,ri(n,$),_a(d,n,$),Tm;yu(),s=gv(n,s,o)}else n=x.treeContext,Ln=es($.nextSibling),oa=s,bn=!0,fr=null,Qa=!1,n!==null&&ab(s,n),s=ru(s,d),s.flags|=4096;return s}return n=zs(n.child,{mode:d.mode,children:d.children}),n.ref=s.ref,s.child=n,n.return=s,n}function iu(n,s){var o=s.ref;if(o===null)n!==null&&n.ref!==null&&(s.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(i(284));(n===null||n.ref!==o)&&(s.flags|=4194816)}}function Mm(n,s,o,d,b){return ci(s),o=um(n,s,o,d,void 0,b),d=dm(),n!==null&&!Qn?(fm(n,s,b),Hs(n,s,b)):(bn&&d&&Vf(s),s.flags|=1,ua(n,s,o,b),s.child)}function bv(n,s,o,d,b,x){return ci(s),s.updateQueue=null,o=Sb(s,d,o,b),xb(n),d=dm(),n!==null&&!Qn?(fm(n,s,x),Hs(n,s,x)):(bn&&d&&Vf(s),s.flags|=1,ua(n,s,o,x),s.child)}function vv(n,s,o,d,b){if(ci(s),s.stateNode===null){var x=Hi,$=o.contextType;typeof $=="object"&&$!==null&&(x=ca($)),x=new o(d,x),s.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=Cm,s.stateNode=x,x._reactInternals=s,x=s.stateNode,x.props=d,x.state=s.memoizedState,x.refs={},nm(s),$=o.contextType,x.context=typeof $=="object"&&$!==null?ca($):Hi,x.state=s.memoizedState,$=o.getDerivedStateFromProps,typeof $=="function"&&(_m(s,o,$,d),x.state=s.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||($=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),$!==x.state&&Cm.enqueueReplaceState(x,x.state,null),ao(s,d,x,b),no(),x.state=s.memoizedState),typeof x.componentDidMount=="function"&&(s.flags|=4194308),d=!0}else if(n===null){x=s.stateNode;var K=s.memoizedProps,pe=pi(o,K);x.props=pe;var Le=x.context,et=o.contextType;$=Hi,typeof et=="object"&&et!==null&&($=ca(et));var lt=o.getDerivedStateFromProps;et=typeof lt=="function"||typeof x.getSnapshotBeforeUpdate=="function",K=s.pendingProps!==K,et||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(K||Le!==$)&&rv(s,x,d,$),pr=!1;var Fe=s.memoizedState;x.state=Fe,ao(s,d,x,b),no(),Le=s.memoizedState,K||Fe!==Le||pr?(typeof lt=="function"&&(_m(s,o,lt,d),Le=s.memoizedState),(pe=pr||sv(s,o,pe,d,Fe,Le,$))?(et||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(s.flags|=4194308)):(typeof x.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=d,s.memoizedState=Le),x.props=d,x.state=Le,x.context=$,d=pe):(typeof x.componentDidMount=="function"&&(s.flags|=4194308),d=!1)}else{x=s.stateNode,am(n,s),$=s.memoizedProps,et=pi(o,$),x.props=et,lt=s.pendingProps,Fe=x.context,Le=o.contextType,pe=Hi,typeof Le=="object"&&Le!==null&&(pe=ca(Le)),K=o.getDerivedStateFromProps,(Le=typeof K=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||($!==lt||Fe!==pe)&&rv(s,x,d,pe),pr=!1,Fe=s.memoizedState,x.state=Fe,ao(s,d,x,b),no();var Ye=s.memoizedState;$!==lt||Fe!==Ye||pr||n!==null&&n.dependencies!==null&&Uc(n.dependencies)?(typeof K=="function"&&(_m(s,o,K,d),Ye=s.memoizedState),(et=pr||sv(s,o,et,d,Fe,Ye,pe)||n!==null&&n.dependencies!==null&&Uc(n.dependencies))?(Le||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(d,Ye,pe),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(d,Ye,pe)),typeof x.componentDidUpdate=="function"&&(s.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof x.componentDidUpdate!="function"||$===n.memoizedProps&&Fe===n.memoizedState||(s.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||$===n.memoizedProps&&Fe===n.memoizedState||(s.flags|=1024),s.memoizedProps=d,s.memoizedState=Ye),x.props=d,x.state=Ye,x.context=pe,d=et):(typeof x.componentDidUpdate!="function"||$===n.memoizedProps&&Fe===n.memoizedState||(s.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||$===n.memoizedProps&&Fe===n.memoizedState||(s.flags|=1024),d=!1)}return x=d,iu(n,s),d=(s.flags&128)!==0,x||d?(x=s.stateNode,o=d&&typeof o.getDerivedStateFromError!="function"?null:x.render(),s.flags|=1,n!==null&&d?(s.child=mi(s,n.child,null,b),s.child=mi(s,null,o,b)):ua(n,s,o,b),s.memoizedState=x.state,n=s.child):n=Hs(n,s,b),n}function xv(n,s,o,d){return li(),s.flags|=256,ua(n,s,o,d),s.child}var Rm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function km(n){return{baseLanes:n,cachePool:cb()}}function Dm(n,s,o){return n=n!==null?n.childLanes&~o:0,s&&(n|=Fa),n}function Sv(n,s,o){var d=s.pendingProps,b=!1,x=(s.flags&128)!==0,$;if(($=x)||($=n!==null&&n.memoizedState===null?!1:(Gn.current&2)!==0),$&&(b=!0,s.flags&=-129),$=(s.flags&32)!==0,s.flags&=-33,n===null){if(bn){if(b?br(s):vr(),(n=Ln)?(n=Tx(n,Qa),n=n!==null&&n.data!=="&"?n:null,n!==null&&(s.memoizedState={dehydrated:n,treeContext:dr!==null?{id:ws,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},o=eb(n),o.return=s,s.child=o,oa=s,Ln=null)):n=null,n===null)throw mr(s);return ph(n)?s.lanes=32:s.lanes=536870912,null}var K=d.children;return d=d.fallback,b?(vr(),b=s.mode,K=lu({mode:"hidden",children:K},b),d=ii(d,b,o,null),K.return=s,d.return=s,K.sibling=d,s.child=K,d=s.child,d.memoizedState=km(o),d.childLanes=Dm(n,$,o),s.memoizedState=Rm,oo(null,d)):(br(s),Im(s,K))}var pe=n.memoizedState;if(pe!==null&&(K=pe.dehydrated,K!==null)){if(x)s.flags&256?(br(s),s.flags&=-257,s=Lm(n,s,o)):s.memoizedState!==null?(vr(),s.child=n.child,s.flags|=128,s=null):(vr(),K=d.fallback,b=s.mode,d=lu({mode:"visible",children:d.children},b),K=ii(K,b,o,null),K.flags|=2,d.return=s,K.return=s,d.sibling=K,s.child=d,mi(s,n.child,null,o),d=s.child,d.memoizedState=km(o),d.childLanes=Dm(n,$,o),s.memoizedState=Rm,s=oo(null,d));else if(br(s),ph(K)){if($=K.nextSibling&&K.nextSibling.dataset,$)var Le=$.dgst;$=Le,d=Error(i(419)),d.stack="",d.digest=$,Wl({value:d,source:null,stack:null}),s=Lm(n,s,o)}else if(Qn||Gi(n,s,o,!1),$=(o&n.childLanes)!==0,Qn||$){if($=Dn,$!==null&&(d=dt($,o),d!==0&&d!==pe.retryLane))throw pe.retryLane=d,ri(n,d),_a($,n,d),Tm;hh(K)||yu(),s=Lm(n,s,o)}else hh(K)?(s.flags|=192,s.child=n.child,s=null):(n=pe.treeContext,Ln=es(K.nextSibling),oa=s,bn=!0,fr=null,Qa=!1,n!==null&&ab(s,n),s=Im(s,d.children),s.flags|=4096);return s}return b?(vr(),K=d.fallback,b=s.mode,pe=n.child,Le=pe.sibling,d=zs(pe,{mode:"hidden",children:d.children}),d.subtreeFlags=pe.subtreeFlags&65011712,Le!==null?K=zs(Le,K):(K=ii(K,b,o,null),K.flags|=2),K.return=s,d.return=s,d.sibling=K,s.child=d,oo(null,d),d=s.child,K=n.child.memoizedState,K===null?K=km(o):(b=K.cachePool,b!==null?(pe=Wn._currentValue,b=b.parent!==pe?{parent:pe,pool:pe}:b):b=cb(),K={baseLanes:K.baseLanes|o,cachePool:b}),d.memoizedState=K,d.childLanes=Dm(n,$,o),s.memoizedState=Rm,oo(n.child,d)):(br(s),o=n.child,n=o.sibling,o=zs(o,{mode:"visible",children:d.children}),o.return=s,o.sibling=null,n!==null&&($=s.deletions,$===null?(s.deletions=[n],s.flags|=16):$.push(n)),s.child=o,s.memoizedState=null,o)}function Im(n,s){return s=lu({mode:"visible",children:s},n.mode),s.return=n,n.child=s}function lu(n,s){return n=La(22,n,null,s),n.lanes=0,n}function Lm(n,s,o){return mi(s,n.child,null,o),n=Im(s,s.pendingProps.children),n.flags|=2,s.memoizedState=null,n}function wv(n,s,o){n.lanes|=s;var d=n.alternate;d!==null&&(d.lanes|=s),Wf(n.return,s,o)}function Om(n,s,o,d,b,x){var $=n.memoizedState;$===null?n.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:d,tail:o,tailMode:b,treeForkCount:x}:($.isBackwards=s,$.rendering=null,$.renderingStartTime=0,$.last=d,$.tail=o,$.tailMode=b,$.treeForkCount=x)}function Nv(n,s,o){var d=s.pendingProps,b=d.revealOrder,x=d.tail;d=d.children;var $=Gn.current,K=($&2)!==0;if(K?($=$&1|2,s.flags|=128):$&=1,G(Gn,$),ua(n,s,d,o),d=bn?Kl:0,!K&&n!==null&&(n.flags&128)!==0)e:for(n=s.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&wv(n,o,s);else if(n.tag===19)wv(n,o,s);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break e;for(;n.sibling===null;){if(n.return===null||n.return===s)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}switch(b){case"forwards":for(o=s.child,b=null;o!==null;)n=o.alternate,n!==null&&Kc(n)===null&&(b=o),o=o.sibling;o=b,o===null?(b=s.child,s.child=null):(b=o.sibling,o.sibling=null),Om(s,!1,b,o,x,d);break;case"backwards":case"unstable_legacy-backwards":for(o=null,b=s.child,s.child=null;b!==null;){if(n=b.alternate,n!==null&&Kc(n)===null){s.child=b;break}n=b.sibling,b.sibling=o,o=b,b=n}Om(s,!0,o,null,x,d);break;case"together":Om(s,!1,null,null,void 0,d);break;default:s.memoizedState=null}return s.child}function Hs(n,s,o){if(n!==null&&(s.dependencies=n.dependencies),wr|=s.lanes,(o&s.childLanes)===0)if(n!==null){if(Gi(n,s,o,!1),(o&s.childLanes)===0)return null}else return null;if(n!==null&&s.child!==n.child)throw Error(i(153));if(s.child!==null){for(n=s.child,o=zs(n,n.pendingProps),s.child=o,o.return=s;n.sibling!==null;)n=n.sibling,o=o.sibling=zs(n,n.pendingProps),o.return=s;o.sibling=null}return s.child}function zm(n,s){return(n.lanes&s)!==0?!0:(n=n.dependencies,!!(n!==null&&Uc(n)))}function E_(n,s,o){switch(s.tag){case 3:Q(s,s.stateNode.containerInfo),hr(s,Wn,n.memoizedState.cache),li();break;case 27:case 5:ne(s);break;case 4:Q(s,s.stateNode.containerInfo);break;case 10:hr(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,om(s),null;break;case 13:var d=s.memoizedState;if(d!==null)return d.dehydrated!==null?(br(s),s.flags|=128,null):(o&s.child.childLanes)!==0?Sv(n,s,o):(br(s),n=Hs(n,s,o),n!==null?n.sibling:null);br(s);break;case 19:var b=(n.flags&128)!==0;if(d=(o&s.childLanes)!==0,d||(Gi(n,s,o,!1),d=(o&s.childLanes)!==0),b){if(d)return Nv(n,s,o);s.flags|=128}if(b=s.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),G(Gn,Gn.current),d)break;return null;case 22:return s.lanes=0,pv(n,s,o,s.pendingProps);case 24:hr(s,Wn,n.memoizedState.cache)}return Hs(n,s,o)}function Ev(n,s,o){if(n!==null)if(n.memoizedProps!==s.pendingProps)Qn=!0;else{if(!zm(n,o)&&(s.flags&128)===0)return Qn=!1,E_(n,s,o);Qn=(n.flags&131072)!==0}else Qn=!1,bn&&(s.flags&1048576)!==0&&nb(s,Kl,s.index);switch(s.lanes=0,s.tag){case 16:e:{var d=s.pendingProps;if(n=di(s.elementType),s.type=n,typeof n=="function")qf(n)?(d=pi(n,d),s.tag=1,s=vv(null,s,n,d,o)):(s.tag=0,s=Mm(null,s,n,d,o));else{if(n!=null){var b=n.$$typeof;if(b===E){s.tag=11,s=fv(null,s,n,d,o);break e}else if(b===A){s.tag=14,s=mv(null,s,n,d,o);break e}}throw s=I(n)||n,Error(i(306,s,""))}}return s;case 0:return Mm(n,s,s.type,s.pendingProps,o);case 1:return d=s.type,b=pi(d,s.pendingProps),vv(n,s,d,b,o);case 3:e:{if(Q(s,s.stateNode.containerInfo),n===null)throw Error(i(387));d=s.pendingProps;var x=s.memoizedState;b=x.element,am(n,s),ao(s,d,null,o);var $=s.memoizedState;if(d=$.cache,hr(s,Wn,d),d!==x.cache&&Zf(s,[Wn],o,!0),no(),d=$.element,x.isDehydrated)if(x={element:d,isDehydrated:!1,cache:$.cache},s.updateQueue.baseState=x,s.memoizedState=x,s.flags&256){s=xv(n,s,d,o);break e}else if(d!==b){b=Ka(Error(i(424)),s),Wl(b),s=xv(n,s,d,o);break e}else{switch(n=s.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(Ln=es(n.firstChild),oa=s,bn=!0,fr=null,Qa=!0,o=pb(s,null,d,o),s.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling}else{if(li(),d===b){s=Hs(n,s,o);break e}ua(n,s,d,o)}s=s.child}return s;case 26:return iu(n,s),n===null?(o=Lx(s.type,null,s.pendingProps,null))?s.memoizedState=o:bn||(o=s.type,n=s.pendingProps,d=Nu(Z.current).createElement(o),d[Ke]=s,d[ot]=n,da(d,o,n),_e(d),s.stateNode=d):s.memoizedState=Lx(s.type,n.memoizedProps,s.pendingProps,n.memoizedState),null;case 27:return ne(s),n===null&&bn&&(d=s.stateNode=kx(s.type,s.pendingProps,Z.current),oa=s,Qa=!0,b=Ln,Cr(s.type)?(yh=b,Ln=es(d.firstChild)):Ln=b),ua(n,s,s.pendingProps.children,o),iu(n,s),n===null&&(s.flags|=4194304),s.child;case 5:return n===null&&bn&&((b=d=Ln)&&(d=eC(d,s.type,s.pendingProps,Qa),d!==null?(s.stateNode=d,oa=s,Ln=es(d.firstChild),Qa=!1,b=!0):b=!1),b||mr(s)),ne(s),b=s.type,x=s.pendingProps,$=n!==null?n.memoizedProps:null,d=x.children,dh(b,x)?d=null:$!==null&&dh(b,$)&&(s.flags|=32),s.memoizedState!==null&&(b=um(n,s,p_,null,null,o),Eo._currentValue=b),iu(n,s),ua(n,s,d,o),s.child;case 6:return n===null&&bn&&((n=o=Ln)&&(o=tC(o,s.pendingProps,Qa),o!==null?(s.stateNode=o,oa=s,Ln=null,n=!0):n=!1),n||mr(s)),null;case 13:return Sv(n,s,o);case 4:return Q(s,s.stateNode.containerInfo),d=s.pendingProps,n===null?s.child=mi(s,null,d,o):ua(n,s,d,o),s.child;case 11:return fv(n,s,s.type,s.pendingProps,o);case 7:return ua(n,s,s.pendingProps,o),s.child;case 8:return ua(n,s,s.pendingProps.children,o),s.child;case 12:return ua(n,s,s.pendingProps.children,o),s.child;case 10:return d=s.pendingProps,hr(s,s.type,d.value),ua(n,s,d.children,o),s.child;case 9:return b=s.type._context,d=s.pendingProps.children,ci(s),b=ca(b),d=d(b),s.flags|=1,ua(n,s,d,o),s.child;case 14:return mv(n,s,s.type,s.pendingProps,o);case 15:return hv(n,s,s.type,s.pendingProps,o);case 19:return Nv(n,s,o);case 31:return N_(n,s,o);case 22:return pv(n,s,o,s.pendingProps);case 24:return ci(s),d=ca(Wn),n===null?(b=em(),b===null&&(b=Dn,x=Qf(),b.pooledCache=x,x.refCount++,x!==null&&(b.pooledCacheLanes|=o),b=x),s.memoizedState={parent:d,cache:b},nm(s),hr(s,Wn,b)):((n.lanes&o)!==0&&(am(n,s),ao(s,null,null,o),no()),b=n.memoizedState,x=s.memoizedState,b.parent!==d?(b={parent:d,cache:d},s.memoizedState=b,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=b),hr(s,Wn,d)):(d=x.cache,hr(s,Wn,d),d!==b.cache&&Zf(s,[Wn],o,!0))),ua(n,s,s.pendingProps.children,o),s.child;case 29:throw s.pendingProps}throw Error(i(156,s.tag))}function Ps(n){n.flags|=4}function $m(n,s,o,d,b){if((s=(n.mode&32)!==0)&&(s=!1),s){if(n.flags|=16777216,(b&335544128)===b)if(n.stateNode.complete)n.flags|=8192;else if(Zv())n.flags|=8192;else throw fi=Vc,tm}else n.flags&=-16777217}function jv(n,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!Bx(s))if(Zv())n.flags|=8192;else throw fi=Vc,tm}function ou(n,s){s!==null&&(n.flags|=4),n.flags&16384&&(s=n.tag!==22?Lt():536870912,n.lanes|=s,rl|=s)}function co(n,s){if(!bn)switch(n.tailMode){case"hidden":s=n.tail;for(var o=null;s!==null;)s.alternate!==null&&(o=s),s=s.sibling;o===null?n.tail=null:o.sibling=null;break;case"collapsed":o=n.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?s||n.tail===null?n.tail=null:n.tail.sibling=null:d.sibling=null}}function On(n){var s=n.alternate!==null&&n.alternate.child===n.child,o=0,d=0;if(s)for(var b=n.child;b!==null;)o|=b.lanes|b.childLanes,d|=b.subtreeFlags&65011712,d|=b.flags&65011712,b.return=n,b=b.sibling;else for(b=n.child;b!==null;)o|=b.lanes|b.childLanes,d|=b.subtreeFlags,d|=b.flags,b.return=n,b=b.sibling;return n.subtreeFlags|=d,n.childLanes=o,s}function j_(n,s,o){var d=s.pendingProps;switch(Yf(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return On(s),null;case 1:return On(s),null;case 3:return o=s.stateNode,d=null,n!==null&&(d=n.memoizedState.cache),s.memoizedState.cache!==d&&(s.flags|=2048),Bs(Wn),ue(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(n===null||n.child===null)&&(Yi(s)?Ps(s):n===null||n.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Xf())),On(s),null;case 26:var b=s.type,x=s.memoizedState;return n===null?(Ps(s),x!==null?(On(s),jv(s,x)):(On(s),$m(s,b,null,d,o))):x?x!==n.memoizedState?(Ps(s),On(s),jv(s,x)):(On(s),s.flags&=-16777217):(n=n.memoizedProps,n!==d&&Ps(s),On(s),$m(s,b,n,d,o)),null;case 27:if(we(s),o=Z.current,b=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==d&&Ps(s);else{if(!d){if(s.stateNode===null)throw Error(i(166));return On(s),null}n=J.current,Yi(s)?sb(s):(n=kx(b,d,o),s.stateNode=n,Ps(s))}return On(s),null;case 5:if(we(s),b=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==d&&Ps(s);else{if(!d){if(s.stateNode===null)throw Error(i(166));return On(s),null}if(x=J.current,Yi(s))sb(s);else{var $=Nu(Z.current);switch(x){case 1:x=$.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:x=$.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":x=$.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":x=$.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":x=$.createElement("div"),x.innerHTML="<script><\/script>",x=x.removeChild(x.firstChild);break;case"select":x=typeof d.is=="string"?$.createElement("select",{is:d.is}):$.createElement("select"),d.multiple?x.multiple=!0:d.size&&(x.size=d.size);break;default:x=typeof d.is=="string"?$.createElement(b,{is:d.is}):$.createElement(b)}}x[Ke]=s,x[ot]=d;e:for($=s.child;$!==null;){if($.tag===5||$.tag===6)x.appendChild($.stateNode);else if($.tag!==4&&$.tag!==27&&$.child!==null){$.child.return=$,$=$.child;continue}if($===s)break e;for(;$.sibling===null;){if($.return===null||$.return===s)break e;$=$.return}$.sibling.return=$.return,$=$.sibling}s.stateNode=x;e:switch(da(x,b,d),b){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&Ps(s)}}return On(s),$m(s,s.type,n===null?null:n.memoizedProps,s.pendingProps,o),null;case 6:if(n&&s.stateNode!=null)n.memoizedProps!==d&&Ps(s);else{if(typeof d!="string"&&s.stateNode===null)throw Error(i(166));if(n=Z.current,Yi(s)){if(n=s.stateNode,o=s.memoizedProps,d=null,b=oa,b!==null)switch(b.tag){case 27:case 5:d=b.memoizedProps}n[Ke]=s,n=!!(n.nodeValue===o||d!==null&&d.suppressHydrationWarning===!0||Sx(n.nodeValue,o)),n||mr(s,!0)}else n=Nu(n).createTextNode(d),n[Ke]=s,s.stateNode=n}return On(s),null;case 31:if(o=s.memoizedState,n===null||n.memoizedState!==null){if(d=Yi(s),o!==null){if(n===null){if(!d)throw Error(i(318));if(n=s.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(557));n[Ke]=s}else li(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;On(s),n=!1}else o=Xf(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=o),n=!0;if(!n)return s.flags&256?(za(s),s):(za(s),null);if((s.flags&128)!==0)throw Error(i(558))}return On(s),null;case 13:if(d=s.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(b=Yi(s),d!==null&&d.dehydrated!==null){if(n===null){if(!b)throw Error(i(318));if(b=s.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(i(317));b[Ke]=s}else li(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;On(s),b=!1}else b=Xf(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=b),b=!0;if(!b)return s.flags&256?(za(s),s):(za(s),null)}return za(s),(s.flags&128)!==0?(s.lanes=o,s):(o=d!==null,n=n!==null&&n.memoizedState!==null,o&&(d=s.child,b=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(b=d.alternate.memoizedState.cachePool.pool),x=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(x=d.memoizedState.cachePool.pool),x!==b&&(d.flags|=2048)),o!==n&&o&&(s.child.flags|=8192),ou(s,s.updateQueue),On(s),null);case 4:return ue(),n===null&&ih(s.stateNode.containerInfo),On(s),null;case 10:return Bs(s.type),On(s),null;case 19:if(q(Gn),d=s.memoizedState,d===null)return On(s),null;if(b=(s.flags&128)!==0,x=d.rendering,x===null)if(b)co(d,!1);else{if(Pn!==0||n!==null&&(n.flags&128)!==0)for(n=s.child;n!==null;){if(x=Kc(n),x!==null){for(s.flags|=128,co(d,!1),n=x.updateQueue,s.updateQueue=n,ou(s,n),s.subtreeFlags=0,n=o,o=s.child;o!==null;)Jg(o,n),o=o.sibling;return G(Gn,Gn.current&1|2),bn&&$s(s,d.treeForkCount),s.child}n=n.sibling}d.tail!==null&&Qe()>mu&&(s.flags|=128,b=!0,co(d,!1),s.lanes=4194304)}else{if(!b)if(n=Kc(x),n!==null){if(s.flags|=128,b=!0,n=n.updateQueue,s.updateQueue=n,ou(s,n),co(d,!0),d.tail===null&&d.tailMode==="hidden"&&!x.alternate&&!bn)return On(s),null}else 2*Qe()-d.renderingStartTime>mu&&o!==536870912&&(s.flags|=128,b=!0,co(d,!1),s.lanes=4194304);d.isBackwards?(x.sibling=s.child,s.child=x):(n=d.last,n!==null?n.sibling=x:s.child=x,d.last=x)}return d.tail!==null?(n=d.tail,d.rendering=n,d.tail=n.sibling,d.renderingStartTime=Qe(),n.sibling=null,o=Gn.current,G(Gn,b?o&1|2:o&1),bn&&$s(s,d.treeForkCount),n):(On(s),null);case 22:case 23:return za(s),lm(),d=s.memoizedState!==null,n!==null?n.memoizedState!==null!==d&&(s.flags|=8192):d&&(s.flags|=8192),d?(o&536870912)!==0&&(s.flags&128)===0&&(On(s),s.subtreeFlags&6&&(s.flags|=8192)):On(s),o=s.updateQueue,o!==null&&ou(s,o.retryQueue),o=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),d=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(d=s.memoizedState.cachePool.pool),d!==o&&(s.flags|=2048),n!==null&&q(ui),null;case 24:return o=null,n!==null&&(o=n.memoizedState.cache),s.memoizedState.cache!==o&&(s.flags|=2048),Bs(Wn),On(s),null;case 25:return null;case 30:return null}throw Error(i(156,s.tag))}function __(n,s){switch(Yf(s),s.tag){case 1:return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 3:return Bs(Wn),ue(),n=s.flags,(n&65536)!==0&&(n&128)===0?(s.flags=n&-65537|128,s):null;case 26:case 27:case 5:return we(s),null;case 31:if(s.memoizedState!==null){if(za(s),s.alternate===null)throw Error(i(340));li()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 13:if(za(s),n=s.memoizedState,n!==null&&n.dehydrated!==null){if(s.alternate===null)throw Error(i(340));li()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 19:return q(Gn),null;case 4:return ue(),null;case 10:return Bs(s.type),null;case 22:case 23:return za(s),lm(),n!==null&&q(ui),n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 24:return Bs(Wn),null;case 25:return null;default:return null}}function _v(n,s){switch(Yf(s),s.tag){case 3:Bs(Wn),ue();break;case 26:case 27:case 5:we(s);break;case 4:ue();break;case 31:s.memoizedState!==null&&za(s);break;case 13:za(s);break;case 19:q(Gn);break;case 10:Bs(s.type);break;case 22:case 23:za(s),lm(),n!==null&&q(ui);break;case 24:Bs(Wn)}}function uo(n,s){try{var o=s.updateQueue,d=o!==null?o.lastEffect:null;if(d!==null){var b=d.next;o=b;do{if((o.tag&n)===n){d=void 0;var x=o.create,$=o.inst;d=x(),$.destroy=d}o=o.next}while(o!==b)}}catch(K){An(s,s.return,K)}}function xr(n,s,o){try{var d=s.updateQueue,b=d!==null?d.lastEffect:null;if(b!==null){var x=b.next;d=x;do{if((d.tag&n)===n){var $=d.inst,K=$.destroy;if(K!==void 0){$.destroy=void 0,b=s;var pe=o,Le=K;try{Le()}catch(et){An(b,pe,et)}}}d=d.next}while(d!==x)}}catch(et){An(s,s.return,et)}}function Cv(n){var s=n.updateQueue;if(s!==null){var o=n.stateNode;try{gb(s,o)}catch(d){An(n,n.return,d)}}}function Av(n,s,o){o.props=pi(n.type,n.memoizedProps),o.state=n.memoizedState;try{o.componentWillUnmount()}catch(d){An(n,s,d)}}function fo(n,s){try{var o=n.ref;if(o!==null){switch(n.tag){case 26:case 27:case 5:var d=n.stateNode;break;case 30:d=n.stateNode;break;default:d=n.stateNode}typeof o=="function"?n.refCleanup=o(d):o.current=d}}catch(b){An(n,s,b)}}function Es(n,s){var o=n.ref,d=n.refCleanup;if(o!==null)if(typeof d=="function")try{d()}catch(b){An(n,s,b)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(b){An(n,s,b)}else o.current=null}function Tv(n){var s=n.type,o=n.memoizedProps,d=n.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":o.autoFocus&&d.focus();break e;case"img":o.src?d.src=o.src:o.srcSet&&(d.srcset=o.srcSet)}}catch(b){An(n,n.return,b)}}function Fm(n,s,o){try{var d=n.stateNode;X_(d,n.type,o,s),d[ot]=s}catch(b){An(n,n.return,b)}}function Mv(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&Cr(n.type)||n.tag===4}function Bm(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Mv(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&Cr(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Um(n,s,o){var d=n.tag;if(d===5||d===6)n=n.stateNode,s?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(n,s):(s=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,s.appendChild(n),o=o._reactRootContainer,o!=null||s.onclick!==null||(s.onclick=ia));else if(d!==4&&(d===27&&Cr(n.type)&&(o=n.stateNode,s=null),n=n.child,n!==null))for(Um(n,s,o),n=n.sibling;n!==null;)Um(n,s,o),n=n.sibling}function cu(n,s,o){var d=n.tag;if(d===5||d===6)n=n.stateNode,s?o.insertBefore(n,s):o.appendChild(n);else if(d!==4&&(d===27&&Cr(n.type)&&(o=n.stateNode),n=n.child,n!==null))for(cu(n,s,o),n=n.sibling;n!==null;)cu(n,s,o),n=n.sibling}function Rv(n){var s=n.stateNode,o=n.memoizedProps;try{for(var d=n.type,b=s.attributes;b.length;)s.removeAttributeNode(b[0]);da(s,d,o),s[Ke]=n,s[ot]=o}catch(x){An(n,n.return,x)}}var Vs=!1,Jn=!1,qm=!1,kv=typeof WeakSet=="function"?WeakSet:Set,aa=null;function C_(n,s){if(n=n.containerInfo,ch=Mu,n=Pg(n),Lf(n)){if("selectionStart"in n)var o={start:n.selectionStart,end:n.selectionEnd};else e:{o=(o=n.ownerDocument)&&o.defaultView||window;var d=o.getSelection&&o.getSelection();if(d&&d.rangeCount!==0){o=d.anchorNode;var b=d.anchorOffset,x=d.focusNode;d=d.focusOffset;try{o.nodeType,x.nodeType}catch{o=null;break e}var $=0,K=-1,pe=-1,Le=0,et=0,lt=n,Fe=null;t:for(;;){for(var Ye;lt!==o||b!==0&&lt.nodeType!==3||(K=$+b),lt!==x||d!==0&&lt.nodeType!==3||(pe=$+d),lt.nodeType===3&&($+=lt.nodeValue.length),(Ye=lt.firstChild)!==null;)Fe=lt,lt=Ye;for(;;){if(lt===n)break t;if(Fe===o&&++Le===b&&(K=$),Fe===x&&++et===d&&(pe=$),(Ye=lt.nextSibling)!==null)break;lt=Fe,Fe=lt.parentNode}lt=Ye}o=K===-1||pe===-1?null:{start:K,end:pe}}else o=null}o=o||{start:0,end:0}}else o=null;for(uh={focusedElem:n,selectionRange:o},Mu=!1,aa=s;aa!==null;)if(s=aa,n=s.child,(s.subtreeFlags&1028)!==0&&n!==null)n.return=s,aa=n;else for(;aa!==null;){switch(s=aa,x=s.alternate,n=s.flags,s.tag){case 0:if((n&4)!==0&&(n=s.updateQueue,n=n!==null?n.events:null,n!==null))for(o=0;o<n.length;o++)b=n[o],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((n&1024)!==0&&x!==null){n=void 0,o=s,b=x.memoizedProps,x=x.memoizedState,d=o.stateNode;try{var Ot=pi(o.type,b);n=d.getSnapshotBeforeUpdate(Ot,x),d.__reactInternalSnapshotBeforeUpdate=n}catch(Xt){An(o,o.return,Xt)}}break;case 3:if((n&1024)!==0){if(n=s.stateNode.containerInfo,o=n.nodeType,o===9)mh(n);else if(o===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":mh(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(i(163))}if(n=s.sibling,n!==null){n.return=s.return,aa=n;break}aa=s.return}}function Dv(n,s,o){var d=o.flags;switch(o.tag){case 0:case 11:case 15:Gs(n,o),d&4&&uo(5,o);break;case 1:if(Gs(n,o),d&4)if(n=o.stateNode,s===null)try{n.componentDidMount()}catch($){An(o,o.return,$)}else{var b=pi(o.type,s.memoizedProps);s=s.memoizedState;try{n.componentDidUpdate(b,s,n.__reactInternalSnapshotBeforeUpdate)}catch($){An(o,o.return,$)}}d&64&&Cv(o),d&512&&fo(o,o.return);break;case 3:if(Gs(n,o),d&64&&(n=o.updateQueue,n!==null)){if(s=null,o.child!==null)switch(o.child.tag){case 27:case 5:s=o.child.stateNode;break;case 1:s=o.child.stateNode}try{gb(n,s)}catch($){An(o,o.return,$)}}break;case 27:s===null&&d&4&&Rv(o);case 26:case 5:Gs(n,o),s===null&&d&4&&Tv(o),d&512&&fo(o,o.return);break;case 12:Gs(n,o);break;case 31:Gs(n,o),d&4&&Ov(n,o);break;case 13:Gs(n,o),d&4&&zv(n,o),d&64&&(n=o.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(o=O_.bind(null,o),nC(n,o))));break;case 22:if(d=o.memoizedState!==null||Vs,!d){s=s!==null&&s.memoizedState!==null||Jn,b=Vs;var x=Jn;Vs=d,(Jn=s)&&!x?Xs(n,o,(o.subtreeFlags&8772)!==0):Gs(n,o),Vs=b,Jn=x}break;case 30:break;default:Gs(n,o)}}function Iv(n){var s=n.alternate;s!==null&&(n.alternate=null,Iv(s)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(s=n.stateNode,s!==null&&Xe(s)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var $n=null,wa=!1;function Ys(n,s,o){for(o=o.child;o!==null;)Lv(n,s,o),o=o.sibling}function Lv(n,s,o){if(st&&typeof st.onCommitFiberUnmount=="function")try{st.onCommitFiberUnmount(at,o)}catch{}switch(o.tag){case 26:Jn||Es(o,s),Ys(n,s,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:Jn||Es(o,s);var d=$n,b=wa;Cr(o.type)&&($n=o.stateNode,wa=!1),Ys(n,s,o),So(o.stateNode),$n=d,wa=b;break;case 5:Jn||Es(o,s);case 6:if(d=$n,b=wa,$n=null,Ys(n,s,o),$n=d,wa=b,$n!==null)if(wa)try{($n.nodeType===9?$n.body:$n.nodeName==="HTML"?$n.ownerDocument.body:$n).removeChild(o.stateNode)}catch(x){An(o,s,x)}else try{$n.removeChild(o.stateNode)}catch(x){An(o,s,x)}break;case 18:$n!==null&&(wa?(n=$n,Cx(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,o.stateNode),ml(n)):Cx($n,o.stateNode));break;case 4:d=$n,b=wa,$n=o.stateNode.containerInfo,wa=!0,Ys(n,s,o),$n=d,wa=b;break;case 0:case 11:case 14:case 15:xr(2,o,s),Jn||xr(4,o,s),Ys(n,s,o);break;case 1:Jn||(Es(o,s),d=o.stateNode,typeof d.componentWillUnmount=="function"&&Av(o,s,d)),Ys(n,s,o);break;case 21:Ys(n,s,o);break;case 22:Jn=(d=Jn)||o.memoizedState!==null,Ys(n,s,o),Jn=d;break;default:Ys(n,s,o)}}function Ov(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null))){n=n.dehydrated;try{ml(n)}catch(o){An(s,s.return,o)}}}function zv(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{ml(n)}catch(o){An(s,s.return,o)}}function A_(n){switch(n.tag){case 31:case 13:case 19:var s=n.stateNode;return s===null&&(s=n.stateNode=new kv),s;case 22:return n=n.stateNode,s=n._retryCache,s===null&&(s=n._retryCache=new kv),s;default:throw Error(i(435,n.tag))}}function uu(n,s){var o=A_(n);s.forEach(function(d){if(!o.has(d)){o.add(d);var b=z_.bind(null,n,d);d.then(b,b)}})}function Na(n,s){var o=s.deletions;if(o!==null)for(var d=0;d<o.length;d++){var b=o[d],x=n,$=s,K=$;e:for(;K!==null;){switch(K.tag){case 27:if(Cr(K.type)){$n=K.stateNode,wa=!1;break e}break;case 5:$n=K.stateNode,wa=!1;break e;case 3:case 4:$n=K.stateNode.containerInfo,wa=!0;break e}K=K.return}if($n===null)throw Error(i(160));Lv(x,$,b),$n=null,wa=!1,x=b.alternate,x!==null&&(x.return=null),b.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)$v(s,n),s=s.sibling}var cs=null;function $v(n,s){var o=n.alternate,d=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:Na(s,n),Ea(n),d&4&&(xr(3,n,n.return),uo(3,n),xr(5,n,n.return));break;case 1:Na(s,n),Ea(n),d&512&&(Jn||o===null||Es(o,o.return)),d&64&&Vs&&(n=n.updateQueue,n!==null&&(d=n.callbacks,d!==null&&(o=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=o===null?d:o.concat(d))));break;case 26:var b=cs;if(Na(s,n),Ea(n),d&512&&(Jn||o===null||Es(o,o.return)),d&4){var x=o!==null?o.memoizedState:null;if(d=n.memoizedState,o===null)if(d===null)if(n.stateNode===null){e:{d=n.type,o=n.memoizedProps,b=b.ownerDocument||b;t:switch(d){case"title":x=b.getElementsByTagName("title")[0],(!x||x[ae]||x[Ke]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=b.createElement(d),b.head.insertBefore(x,b.querySelector("head > title"))),da(x,d,o),x[Ke]=n,_e(x),d=x;break e;case"link":var $=$x("link","href",b).get(d+(o.href||""));if($){for(var K=0;K<$.length;K++)if(x=$[K],x.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&x.getAttribute("rel")===(o.rel==null?null:o.rel)&&x.getAttribute("title")===(o.title==null?null:o.title)&&x.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){$.splice(K,1);break t}}x=b.createElement(d),da(x,d,o),b.head.appendChild(x);break;case"meta":if($=$x("meta","content",b).get(d+(o.content||""))){for(K=0;K<$.length;K++)if(x=$[K],x.getAttribute("content")===(o.content==null?null:""+o.content)&&x.getAttribute("name")===(o.name==null?null:o.name)&&x.getAttribute("property")===(o.property==null?null:o.property)&&x.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&x.getAttribute("charset")===(o.charSet==null?null:o.charSet)){$.splice(K,1);break t}}x=b.createElement(d),da(x,d,o),b.head.appendChild(x);break;default:throw Error(i(468,d))}x[Ke]=n,_e(x),d=x}n.stateNode=d}else Fx(b,n.type,n.stateNode);else n.stateNode=zx(b,d,n.memoizedProps);else x!==d?(x===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):x.count--,d===null?Fx(b,n.type,n.stateNode):zx(b,d,n.memoizedProps)):d===null&&n.stateNode!==null&&Fm(n,n.memoizedProps,o.memoizedProps)}break;case 27:Na(s,n),Ea(n),d&512&&(Jn||o===null||Es(o,o.return)),o!==null&&d&4&&Fm(n,n.memoizedProps,o.memoizedProps);break;case 5:if(Na(s,n),Ea(n),d&512&&(Jn||o===null||Es(o,o.return)),n.flags&32){b=n.stateNode;try{Ae(b,"")}catch(Ot){An(n,n.return,Ot)}}d&4&&n.stateNode!=null&&(b=n.memoizedProps,Fm(n,b,o!==null?o.memoizedProps:b)),d&1024&&(qm=!0);break;case 6:if(Na(s,n),Ea(n),d&4){if(n.stateNode===null)throw Error(i(162));d=n.memoizedProps,o=n.stateNode;try{o.nodeValue=d}catch(Ot){An(n,n.return,Ot)}}break;case 3:if(_u=null,b=cs,cs=Eu(s.containerInfo),Na(s,n),cs=b,Ea(n),d&4&&o!==null&&o.memoizedState.isDehydrated)try{ml(s.containerInfo)}catch(Ot){An(n,n.return,Ot)}qm&&(qm=!1,Fv(n));break;case 4:d=cs,cs=Eu(n.stateNode.containerInfo),Na(s,n),Ea(n),cs=d;break;case 12:Na(s,n),Ea(n);break;case 31:Na(s,n),Ea(n),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,uu(n,d)));break;case 13:Na(s,n),Ea(n),n.child.flags&8192&&n.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(fu=Qe()),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,uu(n,d)));break;case 22:b=n.memoizedState!==null;var pe=o!==null&&o.memoizedState!==null,Le=Vs,et=Jn;if(Vs=Le||b,Jn=et||pe,Na(s,n),Jn=et,Vs=Le,Ea(n),d&8192)e:for(s=n.stateNode,s._visibility=b?s._visibility&-2:s._visibility|1,b&&(o===null||pe||Vs||Jn||yi(n)),o=null,s=n;;){if(s.tag===5||s.tag===26){if(o===null){pe=o=s;try{if(x=pe.stateNode,b)$=x.style,typeof $.setProperty=="function"?$.setProperty("display","none","important"):$.display="none";else{K=pe.stateNode;var lt=pe.memoizedProps.style,Fe=lt!=null&&lt.hasOwnProperty("display")?lt.display:null;K.style.display=Fe==null||typeof Fe=="boolean"?"":(""+Fe).trim()}}catch(Ot){An(pe,pe.return,Ot)}}}else if(s.tag===6){if(o===null){pe=s;try{pe.stateNode.nodeValue=b?"":pe.memoizedProps}catch(Ot){An(pe,pe.return,Ot)}}}else if(s.tag===18){if(o===null){pe=s;try{var Ye=pe.stateNode;b?Ax(Ye,!0):Ax(pe.stateNode,!1)}catch(Ot){An(pe,pe.return,Ot)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===n)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break e;for(;s.sibling===null;){if(s.return===null||s.return===n)break e;o===s&&(o=null),s=s.return}o===s&&(o=null),s.sibling.return=s.return,s=s.sibling}d&4&&(d=n.updateQueue,d!==null&&(o=d.retryQueue,o!==null&&(d.retryQueue=null,uu(n,o))));break;case 19:Na(s,n),Ea(n),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,uu(n,d)));break;case 30:break;case 21:break;default:Na(s,n),Ea(n)}}function Ea(n){var s=n.flags;if(s&2){try{for(var o,d=n.return;d!==null;){if(Mv(d)){o=d;break}d=d.return}if(o==null)throw Error(i(160));switch(o.tag){case 27:var b=o.stateNode,x=Bm(n);cu(n,x,b);break;case 5:var $=o.stateNode;o.flags&32&&(Ae($,""),o.flags&=-33);var K=Bm(n);cu(n,K,$);break;case 3:case 4:var pe=o.stateNode.containerInfo,Le=Bm(n);Um(n,Le,pe);break;default:throw Error(i(161))}}catch(et){An(n,n.return,et)}n.flags&=-3}s&4096&&(n.flags&=-4097)}function Fv(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var s=n;Fv(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),n=n.sibling}}function Gs(n,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)Dv(n,s.alternate,s),s=s.sibling}function yi(n){for(n=n.child;n!==null;){var s=n;switch(s.tag){case 0:case 11:case 14:case 15:xr(4,s,s.return),yi(s);break;case 1:Es(s,s.return);var o=s.stateNode;typeof o.componentWillUnmount=="function"&&Av(s,s.return,o),yi(s);break;case 27:So(s.stateNode);case 26:case 5:Es(s,s.return),yi(s);break;case 22:s.memoizedState===null&&yi(s);break;case 30:yi(s);break;default:yi(s)}n=n.sibling}}function Xs(n,s,o){for(o=o&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var d=s.alternate,b=n,x=s,$=x.flags;switch(x.tag){case 0:case 11:case 15:Xs(b,x,o),uo(4,x);break;case 1:if(Xs(b,x,o),d=x,b=d.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Le){An(d,d.return,Le)}if(d=x,b=d.updateQueue,b!==null){var K=d.stateNode;try{var pe=b.shared.hiddenCallbacks;if(pe!==null)for(b.shared.hiddenCallbacks=null,b=0;b<pe.length;b++)yb(pe[b],K)}catch(Le){An(d,d.return,Le)}}o&&$&64&&Cv(x),fo(x,x.return);break;case 27:Rv(x);case 26:case 5:Xs(b,x,o),o&&d===null&&$&4&&Tv(x),fo(x,x.return);break;case 12:Xs(b,x,o);break;case 31:Xs(b,x,o),o&&$&4&&Ov(b,x);break;case 13:Xs(b,x,o),o&&$&4&&zv(b,x);break;case 22:x.memoizedState===null&&Xs(b,x,o),fo(x,x.return);break;case 30:break;default:Xs(b,x,o)}s=s.sibling}}function Hm(n,s){var o=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),n=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(n=s.memoizedState.cachePool.pool),n!==o&&(n!=null&&n.refCount++,o!=null&&Zl(o))}function Pm(n,s){n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&Zl(n))}function us(n,s,o,d){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Bv(n,s,o,d),s=s.sibling}function Bv(n,s,o,d){var b=s.flags;switch(s.tag){case 0:case 11:case 15:us(n,s,o,d),b&2048&&uo(9,s);break;case 1:us(n,s,o,d);break;case 3:us(n,s,o,d),b&2048&&(n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&Zl(n)));break;case 12:if(b&2048){us(n,s,o,d),n=s.stateNode;try{var x=s.memoizedProps,$=x.id,K=x.onPostCommit;typeof K=="function"&&K($,s.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(pe){An(s,s.return,pe)}}else us(n,s,o,d);break;case 31:us(n,s,o,d);break;case 13:us(n,s,o,d);break;case 23:break;case 22:x=s.stateNode,$=s.alternate,s.memoizedState!==null?x._visibility&2?us(n,s,o,d):mo(n,s):x._visibility&2?us(n,s,o,d):(x._visibility|=2,nl(n,s,o,d,(s.subtreeFlags&10256)!==0||!1)),b&2048&&Hm($,s);break;case 24:us(n,s,o,d),b&2048&&Pm(s.alternate,s);break;default:us(n,s,o,d)}}function nl(n,s,o,d,b){for(b=b&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var x=n,$=s,K=o,pe=d,Le=$.flags;switch($.tag){case 0:case 11:case 15:nl(x,$,K,pe,b),uo(8,$);break;case 23:break;case 22:var et=$.stateNode;$.memoizedState!==null?et._visibility&2?nl(x,$,K,pe,b):mo(x,$):(et._visibility|=2,nl(x,$,K,pe,b)),b&&Le&2048&&Hm($.alternate,$);break;case 24:nl(x,$,K,pe,b),b&&Le&2048&&Pm($.alternate,$);break;default:nl(x,$,K,pe,b)}s=s.sibling}}function mo(n,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var o=n,d=s,b=d.flags;switch(d.tag){case 22:mo(o,d),b&2048&&Hm(d.alternate,d);break;case 24:mo(o,d),b&2048&&Pm(d.alternate,d);break;default:mo(o,d)}s=s.sibling}}var ho=8192;function al(n,s,o){if(n.subtreeFlags&ho)for(n=n.child;n!==null;)Uv(n,s,o),n=n.sibling}function Uv(n,s,o){switch(n.tag){case 26:al(n,s,o),n.flags&ho&&n.memoizedState!==null&&hC(o,cs,n.memoizedState,n.memoizedProps);break;case 5:al(n,s,o);break;case 3:case 4:var d=cs;cs=Eu(n.stateNode.containerInfo),al(n,s,o),cs=d;break;case 22:n.memoizedState===null&&(d=n.alternate,d!==null&&d.memoizedState!==null?(d=ho,ho=16777216,al(n,s,o),ho=d):al(n,s,o));break;default:al(n,s,o)}}function qv(n){var s=n.alternate;if(s!==null&&(n=s.child,n!==null)){s.child=null;do s=n.sibling,n.sibling=null,n=s;while(n!==null)}}function po(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var d=s[o];aa=d,Pv(d,n)}qv(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Hv(n),n=n.sibling}function Hv(n){switch(n.tag){case 0:case 11:case 15:po(n),n.flags&2048&&xr(9,n,n.return);break;case 3:po(n);break;case 12:po(n);break;case 22:var s=n.stateNode;n.memoizedState!==null&&s._visibility&2&&(n.return===null||n.return.tag!==13)?(s._visibility&=-3,du(n)):po(n);break;default:po(n)}}function du(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var d=s[o];aa=d,Pv(d,n)}qv(n)}for(n=n.child;n!==null;){switch(s=n,s.tag){case 0:case 11:case 15:xr(8,s,s.return),du(s);break;case 22:o=s.stateNode,o._visibility&2&&(o._visibility&=-3,du(s));break;default:du(s)}n=n.sibling}}function Pv(n,s){for(;aa!==null;){var o=aa;switch(o.tag){case 0:case 11:case 15:xr(8,o,s);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var d=o.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Zl(o.memoizedState.cache)}if(d=o.child,d!==null)d.return=o,aa=d;else e:for(o=n;aa!==null;){d=aa;var b=d.sibling,x=d.return;if(Iv(d),d===o){aa=null;break e}if(b!==null){b.return=x,aa=b;break e}aa=x}}}var T_={getCacheForType:function(n){var s=ca(Wn),o=s.data.get(n);return o===void 0&&(o=n(),s.data.set(n,o)),o},cacheSignal:function(){return ca(Wn).controller.signal}},M_=typeof WeakMap=="function"?WeakMap:Map,_n=0,Dn=null,mn=null,yn=0,Cn=0,$a=null,Sr=!1,sl=!1,Vm=!1,Ks=0,Pn=0,wr=0,gi=0,Ym=0,Fa=0,rl=0,yo=null,ja=null,Gm=!1,fu=0,Vv=0,mu=1/0,hu=null,Nr=null,ea=0,Er=null,il=null,Ws=0,Xm=0,Km=null,Yv=null,go=0,Wm=null;function Ba(){return(_n&2)!==0&&yn!==0?yn&-yn:D.T!==null?nh():re()}function Gv(){if(Fa===0)if((yn&536870912)===0||bn){var n=ct;ct<<=1,(ct&3932160)===0&&(ct=262144),Fa=n}else Fa=536870912;return n=Oa.current,n!==null&&(n.flags|=32),Fa}function _a(n,s,o){(n===Dn&&(Cn===2||Cn===9)||n.cancelPendingCommit!==null)&&(ll(n,0),jr(n,yn,Fa,!1)),se(n,o),((_n&2)===0||n!==Dn)&&(n===Dn&&((_n&2)===0&&(gi|=o),Pn===4&&jr(n,yn,Fa,!1)),js(n))}function Xv(n,s,o){if((_n&6)!==0)throw Error(i(327));var d=!o&&(s&127)===0&&(s&n.expiredLanes)===0||kt(n,s),b=d?D_(n,s):Qm(n,s,!0),x=d;do{if(b===0){sl&&!d&&jr(n,s,0,!1);break}else{if(o=n.current.alternate,x&&!R_(o)){b=Qm(n,s,!1),x=!1;continue}if(b===2){if(x=s,n.errorRecoveryDisabledLanes&x)var $=0;else $=n.pendingLanes&-536870913,$=$!==0?$:$&536870912?536870912:0;if($!==0){s=$;e:{var K=n;b=yo;var pe=K.current.memoizedState.isDehydrated;if(pe&&(ll(K,$).flags|=256),$=Qm(K,$,!1),$!==2){if(Vm&&!pe){K.errorRecoveryDisabledLanes|=x,gi|=x,b=4;break e}x=ja,ja=b,x!==null&&(ja===null?ja=x:ja.push.apply(ja,x))}b=$}if(x=!1,b!==2)continue}}if(b===1){ll(n,0),jr(n,s,0,!0);break}e:{switch(d=n,x=b,x){case 0:case 1:throw Error(i(345));case 4:if((s&4194048)!==s)break;case 6:jr(d,s,Fa,!Sr);break e;case 2:ja=null;break;case 3:case 5:break;default:throw Error(i(329))}if((s&62914560)===s&&(b=fu+300-Qe(),10<b)){if(jr(d,s,Fa,!Sr),Ft(d,0,!0)!==0)break e;Ws=s,d.timeoutHandle=jx(Kv.bind(null,d,o,ja,hu,Gm,s,Fa,gi,rl,Sr,x,"Throttled",-0,0),b);break e}Kv(d,o,ja,hu,Gm,s,Fa,gi,rl,Sr,x,null,-0,0)}}break}while(!0);js(n)}function Kv(n,s,o,d,b,x,$,K,pe,Le,et,lt,Fe,Ye){if(n.timeoutHandle=-1,lt=s.subtreeFlags,lt&8192||(lt&16785408)===16785408){lt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ia},Uv(s,x,lt);var Ot=(x&62914560)===x?fu-Qe():(x&4194048)===x?Vv-Qe():0;if(Ot=pC(lt,Ot),Ot!==null){Ws=x,n.cancelPendingCommit=Ot(ax.bind(null,n,s,x,o,d,b,$,K,pe,et,lt,null,Fe,Ye)),jr(n,x,$,!Le);return}}ax(n,s,x,o,d,b,$,K,pe)}function R_(n){for(var s=n;;){var o=s.tag;if((o===0||o===11||o===15)&&s.flags&16384&&(o=s.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var d=0;d<o.length;d++){var b=o[d],x=b.getSnapshot;b=b.value;try{if(!Ia(x(),b))return!1}catch{return!1}}if(o=s.child,s.subtreeFlags&16384&&o!==null)o.return=s,s=o;else{if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function jr(n,s,o,d){s&=~Ym,s&=~gi,n.suspendedLanes|=s,n.pingedLanes&=~s,d&&(n.warmLanes|=s),d=n.expirationTimes;for(var b=s;0<b;){var x=31-ze(b),$=1<<x;d[x]=-1,b&=~$}o!==0&&je(n,o,s)}function pu(){return(_n&6)===0?(bo(0),!1):!0}function Zm(){if(mn!==null){if(Cn===0)var n=mn.return;else n=mn,Fs=oi=null,mm(n),Zi=null,Jl=0,n=mn;for(;n!==null;)_v(n.alternate,n),n=n.return;mn=null}}function ll(n,s){var o=n.timeoutHandle;o!==-1&&(n.timeoutHandle=-1,Z_(o)),o=n.cancelPendingCommit,o!==null&&(n.cancelPendingCommit=null,o()),Ws=0,Zm(),Dn=n,mn=o=zs(n.current,null),yn=s,Cn=0,$a=null,Sr=!1,sl=kt(n,s),Vm=!1,rl=Fa=Ym=gi=wr=Pn=0,ja=yo=null,Gm=!1,(s&8)!==0&&(s|=s&32);var d=n.entangledLanes;if(d!==0)for(n=n.entanglements,d&=s;0<d;){var b=31-ze(d),x=1<<b;s|=n[b],d&=~x}return Ks=s,Oc(),o}function Wv(n,s){tn=null,D.H=lo,s===Wi||s===Pc?(s=fb(),Cn=3):s===tm?(s=fb(),Cn=4):Cn=s===Tm?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,$a=s,mn===null&&(Pn=1,su(n,Ka(s,n.current)))}function Zv(){var n=Oa.current;return n===null?!0:(yn&4194048)===yn?Ja===null:(yn&62914560)===yn||(yn&536870912)!==0?n===Ja:!1}function Qv(){var n=D.H;return D.H=lo,n===null?lo:n}function Jv(){var n=D.A;return D.A=T_,n}function yu(){Pn=4,Sr||(yn&4194048)!==yn&&Oa.current!==null||(sl=!0),(wr&134217727)===0&&(gi&134217727)===0||Dn===null||jr(Dn,yn,Fa,!1)}function Qm(n,s,o){var d=_n;_n|=2;var b=Qv(),x=Jv();(Dn!==n||yn!==s)&&(hu=null,ll(n,s)),s=!1;var $=Pn;e:do try{if(Cn!==0&&mn!==null){var K=mn,pe=$a;switch(Cn){case 8:Zm(),$=6;break e;case 3:case 2:case 9:case 6:Oa.current===null&&(s=!0);var Le=Cn;if(Cn=0,$a=null,ol(n,K,pe,Le),o&&sl){$=0;break e}break;default:Le=Cn,Cn=0,$a=null,ol(n,K,pe,Le)}}k_(),$=Pn;break}catch(et){Wv(n,et)}while(!0);return s&&n.shellSuspendCounter++,Fs=oi=null,_n=d,D.H=b,D.A=x,mn===null&&(Dn=null,yn=0,Oc()),$}function k_(){for(;mn!==null;)ex(mn)}function D_(n,s){var o=_n;_n|=2;var d=Qv(),b=Jv();Dn!==n||yn!==s?(hu=null,mu=Qe()+500,ll(n,s)):sl=kt(n,s);e:do try{if(Cn!==0&&mn!==null){s=mn;var x=$a;t:switch(Cn){case 1:Cn=0,$a=null,ol(n,s,x,1);break;case 2:case 9:if(ub(x)){Cn=0,$a=null,tx(s);break}s=function(){Cn!==2&&Cn!==9||Dn!==n||(Cn=7),js(n)},x.then(s,s);break e;case 3:Cn=7;break e;case 4:Cn=5;break e;case 7:ub(x)?(Cn=0,$a=null,tx(s)):(Cn=0,$a=null,ol(n,s,x,7));break;case 5:var $=null;switch(mn.tag){case 26:$=mn.memoizedState;case 5:case 27:var K=mn;if($?Bx($):K.stateNode.complete){Cn=0,$a=null;var pe=K.sibling;if(pe!==null)mn=pe;else{var Le=K.return;Le!==null?(mn=Le,gu(Le)):mn=null}break t}}Cn=0,$a=null,ol(n,s,x,5);break;case 6:Cn=0,$a=null,ol(n,s,x,6);break;case 8:Zm(),Pn=6;break e;default:throw Error(i(462))}}I_();break}catch(et){Wv(n,et)}while(!0);return Fs=oi=null,D.H=d,D.A=b,_n=o,mn!==null?0:(Dn=null,yn=0,Oc(),Pn)}function I_(){for(;mn!==null&&!At();)ex(mn)}function ex(n){var s=Ev(n.alternate,n,Ks);n.memoizedProps=n.pendingProps,s===null?gu(n):mn=s}function tx(n){var s=n,o=s.alternate;switch(s.tag){case 15:case 0:s=bv(o,s,s.pendingProps,s.type,void 0,yn);break;case 11:s=bv(o,s,s.pendingProps,s.type.render,s.ref,yn);break;case 5:mm(s);default:_v(o,s),s=mn=Jg(s,Ks),s=Ev(o,s,Ks)}n.memoizedProps=n.pendingProps,s===null?gu(n):mn=s}function ol(n,s,o,d){Fs=oi=null,mm(s),Zi=null,Jl=0;var b=s.return;try{if(w_(n,b,s,o,yn)){Pn=1,su(n,Ka(o,n.current)),mn=null;return}}catch(x){if(b!==null)throw mn=b,x;Pn=1,su(n,Ka(o,n.current)),mn=null;return}s.flags&32768?(bn||d===1?n=!0:sl||(yn&536870912)!==0?n=!1:(Sr=n=!0,(d===2||d===9||d===3||d===6)&&(d=Oa.current,d!==null&&d.tag===13&&(d.flags|=16384))),nx(s,n)):gu(s)}function gu(n){var s=n;do{if((s.flags&32768)!==0){nx(s,Sr);return}n=s.return;var o=j_(s.alternate,s,Ks);if(o!==null){mn=o;return}if(s=s.sibling,s!==null){mn=s;return}mn=s=n}while(s!==null);Pn===0&&(Pn=5)}function nx(n,s){do{var o=__(n.alternate,n);if(o!==null){o.flags&=32767,mn=o;return}if(o=n.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!s&&(n=n.sibling,n!==null)){mn=n;return}mn=n=o}while(n!==null);Pn=6,mn=null}function ax(n,s,o,d,b,x,$,K,pe){n.cancelPendingCommit=null;do bu();while(ea!==0);if((_n&6)!==0)throw Error(i(327));if(s!==null){if(s===n.current)throw Error(i(177));if(x=s.lanes|s.childLanes,x|=Bf,be(n,o,x,$,K,pe),n===Dn&&(mn=Dn=null,yn=0),il=s,Er=n,Ws=o,Xm=x,Km=b,Yv=d,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,$_(ve,function(){return ox(),null})):(n.callbackNode=null,n.callbackPriority=0),d=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||d){d=D.T,D.T=null,b=L.p,L.p=2,$=_n,_n|=4;try{C_(n,s,o)}finally{_n=$,L.p=b,D.T=d}}ea=1,sx(),rx(),ix()}}function sx(){if(ea===1){ea=0;var n=Er,s=il,o=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||o){o=D.T,D.T=null;var d=L.p;L.p=2;var b=_n;_n|=4;try{$v(s,n);var x=uh,$=Pg(n.containerInfo),K=x.focusedElem,pe=x.selectionRange;if($!==K&&K&&K.ownerDocument&&Hg(K.ownerDocument.documentElement,K)){if(pe!==null&&Lf(K)){var Le=pe.start,et=pe.end;if(et===void 0&&(et=Le),"selectionStart"in K)K.selectionStart=Le,K.selectionEnd=Math.min(et,K.value.length);else{var lt=K.ownerDocument||document,Fe=lt&&lt.defaultView||window;if(Fe.getSelection){var Ye=Fe.getSelection(),Ot=K.textContent.length,Xt=Math.min(pe.start,Ot),kn=pe.end===void 0?Xt:Math.min(pe.end,Ot);!Ye.extend&&Xt>kn&&($=kn,kn=Xt,Xt=$);var Te=qg(K,Xt),xe=qg(K,kn);if(Te&&xe&&(Ye.rangeCount!==1||Ye.anchorNode!==Te.node||Ye.anchorOffset!==Te.offset||Ye.focusNode!==xe.node||Ye.focusOffset!==xe.offset)){var Ie=lt.createRange();Ie.setStart(Te.node,Te.offset),Ye.removeAllRanges(),Xt>kn?(Ye.addRange(Ie),Ye.extend(xe.node,xe.offset)):(Ie.setEnd(xe.node,xe.offset),Ye.addRange(Ie))}}}}for(lt=[],Ye=K;Ye=Ye.parentNode;)Ye.nodeType===1&&lt.push({element:Ye,left:Ye.scrollLeft,top:Ye.scrollTop});for(typeof K.focus=="function"&&K.focus(),K=0;K<lt.length;K++){var rt=lt[K];rt.element.scrollLeft=rt.left,rt.element.scrollTop=rt.top}}Mu=!!ch,uh=ch=null}finally{_n=b,L.p=d,D.T=o}}n.current=s,ea=2}}function rx(){if(ea===2){ea=0;var n=Er,s=il,o=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||o){o=D.T,D.T=null;var d=L.p;L.p=2;var b=_n;_n|=4;try{Dv(n,s.alternate,s)}finally{_n=b,L.p=d,D.T=o}}ea=3}}function ix(){if(ea===4||ea===3){ea=0,He();var n=Er,s=il,o=Ws,d=Yv;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?ea=5:(ea=0,il=Er=null,lx(n,n.pendingLanes));var b=n.pendingLanes;if(b===0&&(Nr=null),oe(o),s=s.stateNode,st&&typeof st.onCommitFiberRoot=="function")try{st.onCommitFiberRoot(at,s,void 0,(s.current.flags&128)===128)}catch{}if(d!==null){s=D.T,b=L.p,L.p=2,D.T=null;try{for(var x=n.onRecoverableError,$=0;$<d.length;$++){var K=d[$];x(K.value,{componentStack:K.stack})}}finally{D.T=s,L.p=b}}(Ws&3)!==0&&bu(),js(n),b=n.pendingLanes,(o&261930)!==0&&(b&42)!==0?n===Wm?go++:(go=0,Wm=n):go=0,bo(0)}}function lx(n,s){(n.pooledCacheLanes&=s)===0&&(s=n.pooledCache,s!=null&&(n.pooledCache=null,Zl(s)))}function bu(){return sx(),rx(),ix(),ox()}function ox(){if(ea!==5)return!1;var n=Er,s=Xm;Xm=0;var o=oe(Ws),d=D.T,b=L.p;try{L.p=32>o?32:o,D.T=null,o=Km,Km=null;var x=Er,$=Ws;if(ea=0,il=Er=null,Ws=0,(_n&6)!==0)throw Error(i(331));var K=_n;if(_n|=4,Hv(x.current),Bv(x,x.current,$,o),_n=K,bo(0,!1),st&&typeof st.onPostCommitFiberRoot=="function")try{st.onPostCommitFiberRoot(at,x)}catch{}return!0}finally{L.p=b,D.T=d,lx(n,s)}}function cx(n,s,o){s=Ka(o,s),s=Am(n.stateNode,s,2),n=gr(n,s,2),n!==null&&(se(n,2),js(n))}function An(n,s,o){if(n.tag===3)cx(n,n,o);else for(;s!==null;){if(s.tag===3){cx(s,n,o);break}else if(s.tag===1){var d=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Nr===null||!Nr.has(d))){n=Ka(o,n),o=uv(2),d=gr(s,o,2),d!==null&&(dv(o,d,s,n),se(d,2),js(d));break}}s=s.return}}function Jm(n,s,o){var d=n.pingCache;if(d===null){d=n.pingCache=new M_;var b=new Set;d.set(s,b)}else b=d.get(s),b===void 0&&(b=new Set,d.set(s,b));b.has(o)||(Vm=!0,b.add(o),n=L_.bind(null,n,s,o),s.then(n,n))}function L_(n,s,o){var d=n.pingCache;d!==null&&d.delete(s),n.pingedLanes|=n.suspendedLanes&o,n.warmLanes&=~o,Dn===n&&(yn&o)===o&&(Pn===4||Pn===3&&(yn&62914560)===yn&&300>Qe()-fu?(_n&2)===0&&ll(n,0):Ym|=o,rl===yn&&(rl=0)),js(n)}function ux(n,s){s===0&&(s=Lt()),n=ri(n,s),n!==null&&(se(n,s),js(n))}function O_(n){var s=n.memoizedState,o=0;s!==null&&(o=s.retryLane),ux(n,o)}function z_(n,s){var o=0;switch(n.tag){case 31:case 13:var d=n.stateNode,b=n.memoizedState;b!==null&&(o=b.retryLane);break;case 19:d=n.stateNode;break;case 22:d=n.stateNode._retryCache;break;default:throw Error(i(314))}d!==null&&d.delete(s),ux(n,o)}function $_(n,s){return Mt(n,s)}var vu=null,cl=null,eh=!1,xu=!1,th=!1,_r=0;function js(n){n!==cl&&n.next===null&&(cl===null?vu=cl=n:cl=cl.next=n),xu=!0,eh||(eh=!0,B_())}function bo(n,s){if(!th&&xu){th=!0;do for(var o=!1,d=vu;d!==null;){if(n!==0){var b=d.pendingLanes;if(b===0)var x=0;else{var $=d.suspendedLanes,K=d.pingedLanes;x=(1<<31-ze(42|n)+1)-1,x&=b&~($&~K),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(o=!0,hx(d,x))}else x=yn,x=Ft(d,d===Dn?x:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(x&3)===0||kt(d,x)||(o=!0,hx(d,x));d=d.next}while(o);th=!1}}function F_(){dx()}function dx(){xu=eh=!1;var n=0;_r!==0&&W_()&&(n=_r);for(var s=Qe(),o=null,d=vu;d!==null;){var b=d.next,x=fx(d,s);x===0?(d.next=null,o===null?vu=b:o.next=b,b===null&&(cl=o)):(o=d,(n!==0||(x&3)!==0)&&(xu=!0)),d=b}ea!==0&&ea!==5||bo(n),_r!==0&&(_r=0)}function fx(n,s){for(var o=n.suspendedLanes,d=n.pingedLanes,b=n.expirationTimes,x=n.pendingLanes&-62914561;0<x;){var $=31-ze(x),K=1<<$,pe=b[$];pe===-1?((K&o)===0||(K&d)!==0)&&(b[$]=Zt(K,s)):pe<=s&&(n.expiredLanes|=K),x&=~K}if(s=Dn,o=yn,o=Ft(n,n===s?o:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),d=n.callbackNode,o===0||n===s&&(Cn===2||Cn===9)||n.cancelPendingCommit!==null)return d!==null&&d!==null&&Ct(d),n.callbackNode=null,n.callbackPriority=0;if((o&3)===0||kt(n,o)){if(s=o&-o,s===n.callbackPriority)return s;switch(d!==null&&Ct(d),oe(o)){case 2:case 8:o=te;break;case 32:o=ve;break;case 268435456:o=Se;break;default:o=ve}return d=mx.bind(null,n),o=Mt(o,d),n.callbackPriority=s,n.callbackNode=o,s}return d!==null&&d!==null&&Ct(d),n.callbackPriority=2,n.callbackNode=null,2}function mx(n,s){if(ea!==0&&ea!==5)return n.callbackNode=null,n.callbackPriority=0,null;var o=n.callbackNode;if(bu()&&n.callbackNode!==o)return null;var d=yn;return d=Ft(n,n===Dn?d:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),d===0?null:(Xv(n,d,s),fx(n,Qe()),n.callbackNode!=null&&n.callbackNode===o?mx.bind(null,n):null)}function hx(n,s){if(bu())return null;Xv(n,s,!0)}function B_(){Q_(function(){(_n&6)!==0?Mt(ee,F_):dx()})}function nh(){if(_r===0){var n=Xi;n===0&&(n=pt,pt<<=1,(pt&261888)===0&&(pt=256)),_r=n}return _r}function px(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:Fn(""+n)}function yx(n,s){var o=s.ownerDocument.createElement("input");return o.name=s.name,o.value=s.value,n.id&&o.setAttribute("form",n.id),s.parentNode.insertBefore(o,s),n=new FormData(n),o.parentNode.removeChild(o),n}function U_(n,s,o,d,b){if(s==="submit"&&o&&o.stateNode===b){var x=px((b[ot]||null).action),$=d.submitter;$&&(s=(s=$[ot]||null)?px(s.formAction):$.getAttribute("formAction"),s!==null&&(x=s,$=null));var K=new kc("action","action",null,d,b);n.push({event:K,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(_r!==0){var pe=$?yx(b,$):new FormData(b);wm(o,{pending:!0,data:pe,method:b.method,action:x},null,pe)}}else typeof x=="function"&&(K.preventDefault(),pe=$?yx(b,$):new FormData(b),wm(o,{pending:!0,data:pe,method:b.method,action:x},x,pe))},currentTarget:b}]})}}for(var ah=0;ah<Ff.length;ah++){var sh=Ff[ah],q_=sh.toLowerCase(),H_=sh[0].toUpperCase()+sh.slice(1);os(q_,"on"+H_)}os(Gg,"onAnimationEnd"),os(Xg,"onAnimationIteration"),os(Kg,"onAnimationStart"),os("dblclick","onDoubleClick"),os("focusin","onFocus"),os("focusout","onBlur"),os(r_,"onTransitionRun"),os(i_,"onTransitionStart"),os(l_,"onTransitionCancel"),os(Wg,"onTransitionEnd"),he("onMouseEnter",["mouseout","mouseover"]),he("onMouseLeave",["mouseout","mouseover"]),he("onPointerEnter",["pointerout","pointerover"]),he("onPointerLeave",["pointerout","pointerover"]),fe("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),fe("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),fe("onBeforeInput",["compositionend","keypress","textInput","paste"]),fe("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),fe("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),fe("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var vo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),P_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(vo));function gx(n,s){s=(s&4)!==0;for(var o=0;o<n.length;o++){var d=n[o],b=d.event;d=d.listeners;e:{var x=void 0;if(s)for(var $=d.length-1;0<=$;$--){var K=d[$],pe=K.instance,Le=K.currentTarget;if(K=K.listener,pe!==x&&b.isPropagationStopped())break e;x=K,b.currentTarget=Le;try{x(b)}catch(et){Lc(et)}b.currentTarget=null,x=pe}else for($=0;$<d.length;$++){if(K=d[$],pe=K.instance,Le=K.currentTarget,K=K.listener,pe!==x&&b.isPropagationStopped())break e;x=K,b.currentTarget=Le;try{x(b)}catch(et){Lc(et)}b.currentTarget=null,x=pe}}}}function hn(n,s){var o=s[ce];o===void 0&&(o=s[ce]=new Set);var d=n+"__bubble";o.has(d)||(bx(s,n,2,!1),o.add(d))}function rh(n,s,o){var d=0;s&&(d|=4),bx(o,n,d,s)}var Su="_reactListening"+Math.random().toString(36).slice(2);function ih(n){if(!n[Su]){n[Su]=!0,tt.forEach(function(o){o!=="selectionchange"&&(P_.has(o)||rh(o,!1,n),rh(o,!0,n))});var s=n.nodeType===9?n:n.ownerDocument;s===null||s[Su]||(s[Su]=!0,rh("selectionchange",!1,s))}}function bx(n,s,o,d){switch(Gx(s)){case 2:var b=bC;break;case 8:b=vC;break;default:b=Sh}o=b.bind(null,s,o,n),b=void 0,!la||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(b=!0),d?b!==void 0?n.addEventListener(s,o,{capture:!0,passive:b}):n.addEventListener(s,o,!0):b!==void 0?n.addEventListener(s,o,{passive:b}):n.addEventListener(s,o,!1)}function lh(n,s,o,d,b){var x=d;if((s&1)===0&&(s&2)===0&&d!==null)e:for(;;){if(d===null)return;var $=d.tag;if($===3||$===4){var K=d.stateNode.containerInfo;if(K===b)break;if($===4)for($=d.return;$!==null;){var pe=$.tag;if((pe===3||pe===4)&&$.stateNode.containerInfo===b)return;$=$.return}for(;K!==null;){if($=$e(K),$===null)return;if(pe=$.tag,pe===5||pe===6||pe===26||pe===27){d=x=$;continue e}K=K.parentNode}}d=d.return}xn(function(){var Le=x,et=Me(o),lt=[];e:{var Fe=Zg.get(n);if(Fe!==void 0){var Ye=kc,Ot=n;switch(n){case"keypress":if(zi(o)===0)break e;case"keydown":case"keyup":Ye=zj;break;case"focusin":Ot="focus",Ye=Mf;break;case"focusout":Ot="blur",Ye=Mf;break;case"beforeblur":case"afterblur":Ye=Mf;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ye=_g;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ye=jj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ye=Bj;break;case Gg:case Xg:case Kg:Ye=Aj;break;case Wg:Ye=qj;break;case"scroll":case"scrollend":Ye=Nj;break;case"wheel":Ye=Pj;break;case"copy":case"cut":case"paste":Ye=Mj;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ye=Ag;break;case"toggle":case"beforetoggle":Ye=Yj}var Xt=(s&4)!==0,kn=!Xt&&(n==="scroll"||n==="scrollend"),Te=Xt?Fe!==null?Fe+"Capture":null:Fe;Xt=[];for(var xe=Le,Ie;xe!==null;){var rt=xe;if(Ie=rt.stateNode,rt=rt.tag,rt!==5&&rt!==26&&rt!==27||Ie===null||Te===null||(rt=Gt(xe,Te),rt!=null&&Xt.push(xo(xe,rt,Ie))),kn)break;xe=xe.return}0<Xt.length&&(Fe=new Ye(Fe,Ot,null,o,et),lt.push({event:Fe,listeners:Xt}))}}if((s&7)===0){e:{if(Fe=n==="mouseover"||n==="pointerover",Ye=n==="mouseout"||n==="pointerout",Fe&&o!==ye&&(Ot=o.relatedTarget||o.fromElement)&&($e(Ot)||Ot[Oe]))break e;if((Ye||Fe)&&(Fe=et.window===et?et:(Fe=et.ownerDocument)?Fe.defaultView||Fe.parentWindow:window,Ye?(Ot=o.relatedTarget||o.toElement,Ye=Le,Ot=Ot?$e(Ot):null,Ot!==null&&(kn=c(Ot),Xt=Ot.tag,Ot!==kn||Xt!==5&&Xt!==27&&Xt!==6)&&(Ot=null)):(Ye=null,Ot=Le),Ye!==Ot)){if(Xt=_g,rt="onMouseLeave",Te="onMouseEnter",xe="mouse",(n==="pointerout"||n==="pointerover")&&(Xt=Ag,rt="onPointerLeave",Te="onPointerEnter",xe="pointer"),kn=Ye==null?Fe:bt(Ye),Ie=Ot==null?Fe:bt(Ot),Fe=new Xt(rt,xe+"leave",Ye,o,et),Fe.target=kn,Fe.relatedTarget=Ie,rt=null,$e(et)===Le&&(Xt=new Xt(Te,xe+"enter",Ot,o,et),Xt.target=Ie,Xt.relatedTarget=kn,rt=Xt),kn=rt,Ye&&Ot)t:{for(Xt=V_,Te=Ye,xe=Ot,Ie=0,rt=Te;rt;rt=Xt(rt))Ie++;rt=0;for(var Ht=xe;Ht;Ht=Xt(Ht))rt++;for(;0<Ie-rt;)Te=Xt(Te),Ie--;for(;0<rt-Ie;)xe=Xt(xe),rt--;for(;Ie--;){if(Te===xe||xe!==null&&Te===xe.alternate){Xt=Te;break t}Te=Xt(Te),xe=Xt(xe)}Xt=null}else Xt=null;Ye!==null&&vx(lt,Fe,Ye,Xt,!1),Ot!==null&&kn!==null&&vx(lt,kn,Ot,Xt,!0)}}e:{if(Fe=Le?bt(Le):window,Ye=Fe.nodeName&&Fe.nodeName.toLowerCase(),Ye==="select"||Ye==="input"&&Fe.type==="file")var Sn=Og;else if(Ig(Fe))if(zg)Sn=n_;else{Sn=e_;var $t=Jj}else Ye=Fe.nodeName,!Ye||Ye.toLowerCase()!=="input"||Fe.type!=="checkbox"&&Fe.type!=="radio"?Le&&qt(Le.elementType)&&(Sn=Og):Sn=t_;if(Sn&&(Sn=Sn(n,Le))){Lg(lt,Sn,o,et);break e}$t&&$t(n,Fe,Le),n==="focusout"&&Le&&Fe.type==="number"&&Le.memoizedProps.value!=null&&Un(Fe,"number",Fe.value)}switch($t=Le?bt(Le):window,n){case"focusin":(Ig($t)||$t.contentEditable==="true")&&(Bi=$t,Of=Le,Xl=null);break;case"focusout":Xl=Of=Bi=null;break;case"mousedown":zf=!0;break;case"contextmenu":case"mouseup":case"dragend":zf=!1,Vg(lt,o,et);break;case"selectionchange":if(s_)break;case"keydown":case"keyup":Vg(lt,o,et)}var an;if(kf)e:{switch(n){case"compositionstart":var gn="onCompositionStart";break e;case"compositionend":gn="onCompositionEnd";break e;case"compositionupdate":gn="onCompositionUpdate";break e}gn=void 0}else Fi?kg(n,o)&&(gn="onCompositionEnd"):n==="keydown"&&o.keyCode===229&&(gn="onCompositionStart");gn&&(Tg&&o.locale!=="ko"&&(Fi||gn!=="onCompositionStart"?gn==="onCompositionEnd"&&Fi&&(an=Oi()):(Kn=et,Ga="value"in Kn?Kn.value:Kn.textContent,Fi=!0)),$t=wu(Le,gn),0<$t.length&&(gn=new Cg(gn,n,null,o,et),lt.push({event:gn,listeners:$t}),an?gn.data=an:(an=Dg(o),an!==null&&(gn.data=an)))),(an=Xj?Kj(n,o):Wj(n,o))&&(gn=wu(Le,"onBeforeInput"),0<gn.length&&($t=new Cg("onBeforeInput","beforeinput",null,o,et),lt.push({event:$t,listeners:gn}),$t.data=an)),U_(lt,n,Le,o,et)}gx(lt,s)})}function xo(n,s,o){return{instance:n,listener:s,currentTarget:o}}function wu(n,s){for(var o=s+"Capture",d=[];n!==null;){var b=n,x=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||x===null||(b=Gt(n,o),b!=null&&d.unshift(xo(n,b,x)),b=Gt(n,s),b!=null&&d.push(xo(n,b,x))),n.tag===3)return d;n=n.return}return[]}function V_(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function vx(n,s,o,d,b){for(var x=s._reactName,$=[];o!==null&&o!==d;){var K=o,pe=K.alternate,Le=K.stateNode;if(K=K.tag,pe!==null&&pe===d)break;K!==5&&K!==26&&K!==27||Le===null||(pe=Le,b?(Le=Gt(o,x),Le!=null&&$.unshift(xo(o,Le,pe))):b||(Le=Gt(o,x),Le!=null&&$.push(xo(o,Le,pe)))),o=o.return}$.length!==0&&n.push({event:s,listeners:$})}var Y_=/\r\n?/g,G_=/\u0000|\uFFFD/g;function xx(n){return(typeof n=="string"?n:""+n).replace(Y_,`
`).replace(G_,"")}function Sx(n,s){return s=xx(s),xx(n)===s}function Rn(n,s,o,d,b,x){switch(o){case"children":typeof d=="string"?s==="body"||s==="textarea"&&d===""||Ae(n,d):(typeof d=="number"||typeof d=="bigint")&&s!=="body"&&Ae(n,""+d);break;case"className":Wt(n,"class",d);break;case"tabIndex":Wt(n,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":Wt(n,o,d);break;case"style":fn(n,d,x);break;case"data":if(s!=="object"){Wt(n,"data",d);break}case"src":case"href":if(d===""&&(s!=="a"||o!=="href")){n.removeAttribute(o);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){n.removeAttribute(o);break}d=Fn(""+d),n.setAttribute(o,d);break;case"action":case"formAction":if(typeof d=="function"){n.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(o==="formAction"?(s!=="input"&&Rn(n,s,"name",b.name,b,null),Rn(n,s,"formEncType",b.formEncType,b,null),Rn(n,s,"formMethod",b.formMethod,b,null),Rn(n,s,"formTarget",b.formTarget,b,null)):(Rn(n,s,"encType",b.encType,b,null),Rn(n,s,"method",b.method,b,null),Rn(n,s,"target",b.target,b,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){n.removeAttribute(o);break}d=Fn(""+d),n.setAttribute(o,d);break;case"onClick":d!=null&&(n.onclick=ia);break;case"onScroll":d!=null&&hn("scroll",n);break;case"onScrollEnd":d!=null&&hn("scrollend",n);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(o=d.__html,o!=null){if(b.children!=null)throw Error(i(60));n.innerHTML=o}}break;case"multiple":n.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":n.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){n.removeAttribute("xlink:href");break}o=Fn(""+d),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(o,""+d):n.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(o,""):n.removeAttribute(o);break;case"capture":case"download":d===!0?n.setAttribute(o,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(o,d):n.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?n.setAttribute(o,d):n.removeAttribute(o);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?n.removeAttribute(o):n.setAttribute(o,d);break;case"popover":hn("beforetoggle",n),hn("toggle",n),jt(n,"popover",d);break;case"xlinkActuate":ln(n,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":ln(n,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":ln(n,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":ln(n,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":ln(n,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":ln(n,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":ln(n,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":ln(n,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":ln(n,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":jt(n,"is",d);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=jn.get(o)||o,jt(n,o,d))}}function oh(n,s,o,d,b,x){switch(o){case"style":fn(n,d,x);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(o=d.__html,o!=null){if(b.children!=null)throw Error(i(60));n.innerHTML=o}}break;case"children":typeof d=="string"?Ae(n,d):(typeof d=="number"||typeof d=="bigint")&&Ae(n,""+d);break;case"onScroll":d!=null&&hn("scroll",n);break;case"onScrollEnd":d!=null&&hn("scrollend",n);break;case"onClick":d!=null&&(n.onclick=ia);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!mt.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(b=o.endsWith("Capture"),s=o.slice(2,b?o.length-7:void 0),x=n[ot]||null,x=x!=null?x[o]:null,typeof x=="function"&&n.removeEventListener(s,x,b),typeof d=="function")){typeof x!="function"&&x!==null&&(o in n?n[o]=null:n.hasAttribute(o)&&n.removeAttribute(o)),n.addEventListener(s,d,b);break e}o in n?n[o]=d:d===!0?n.setAttribute(o,""):jt(n,o,d)}}}function da(n,s,o){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":hn("error",n),hn("load",n);var d=!1,b=!1,x;for(x in o)if(o.hasOwnProperty(x)){var $=o[x];if($!=null)switch(x){case"src":d=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:Rn(n,s,x,$,o,null)}}b&&Rn(n,s,"srcSet",o.srcSet,o,null),d&&Rn(n,s,"src",o.src,o,null);return;case"input":hn("invalid",n);var K=x=$=b=null,pe=null,Le=null;for(d in o)if(o.hasOwnProperty(d)){var et=o[d];if(et!=null)switch(d){case"name":b=et;break;case"type":$=et;break;case"checked":pe=et;break;case"defaultChecked":Le=et;break;case"value":x=et;break;case"defaultValue":K=et;break;case"children":case"dangerouslySetInnerHTML":if(et!=null)throw Error(i(137,s));break;default:Rn(n,s,d,et,o,null)}}ti(n,x,K,pe,Le,$,b,!1);return;case"select":hn("invalid",n),d=$=x=null;for(b in o)if(o.hasOwnProperty(b)&&(K=o[b],K!=null))switch(b){case"value":x=K;break;case"defaultValue":$=K;break;case"multiple":d=K;default:Rn(n,s,b,K,o,null)}s=x,o=$,n.multiple=!!d,s!=null?Da(n,!!d,s,!1):o!=null&&Da(n,!!d,o,!0);return;case"textarea":hn("invalid",n),x=b=d=null;for($ in o)if(o.hasOwnProperty($)&&(K=o[$],K!=null))switch($){case"value":d=K;break;case"defaultValue":b=K;break;case"children":x=K;break;case"dangerouslySetInnerHTML":if(K!=null)throw Error(i(91));break;default:Rn(n,s,$,K,o,null)}de(n,d,b,x);return;case"option":for(pe in o)if(o.hasOwnProperty(pe)&&(d=o[pe],d!=null))switch(pe){case"selected":n.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:Rn(n,s,pe,d,o,null)}return;case"dialog":hn("beforetoggle",n),hn("toggle",n),hn("cancel",n),hn("close",n);break;case"iframe":case"object":hn("load",n);break;case"video":case"audio":for(d=0;d<vo.length;d++)hn(vo[d],n);break;case"image":hn("error",n),hn("load",n);break;case"details":hn("toggle",n);break;case"embed":case"source":case"link":hn("error",n),hn("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Le in o)if(o.hasOwnProperty(Le)&&(d=o[Le],d!=null))switch(Le){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:Rn(n,s,Le,d,o,null)}return;default:if(qt(s)){for(et in o)o.hasOwnProperty(et)&&(d=o[et],d!==void 0&&oh(n,s,et,d,o,void 0));return}}for(K in o)o.hasOwnProperty(K)&&(d=o[K],d!=null&&Rn(n,s,K,d,o,null))}function X_(n,s,o,d){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,x=null,$=null,K=null,pe=null,Le=null,et=null;for(Ye in o){var lt=o[Ye];if(o.hasOwnProperty(Ye)&&lt!=null)switch(Ye){case"checked":break;case"value":break;case"defaultValue":pe=lt;default:d.hasOwnProperty(Ye)||Rn(n,s,Ye,null,d,lt)}}for(var Fe in d){var Ye=d[Fe];if(lt=o[Fe],d.hasOwnProperty(Fe)&&(Ye!=null||lt!=null))switch(Fe){case"type":x=Ye;break;case"name":b=Ye;break;case"checked":Le=Ye;break;case"defaultChecked":et=Ye;break;case"value":$=Ye;break;case"defaultValue":K=Ye;break;case"children":case"dangerouslySetInnerHTML":if(Ye!=null)throw Error(i(137,s));break;default:Ye!==lt&&Rn(n,s,Fe,Ye,d,lt)}}ei(n,$,K,pe,Le,et,x,b);return;case"select":Ye=$=K=Fe=null;for(x in o)if(pe=o[x],o.hasOwnProperty(x)&&pe!=null)switch(x){case"value":break;case"multiple":Ye=pe;default:d.hasOwnProperty(x)||Rn(n,s,x,null,d,pe)}for(b in d)if(x=d[b],pe=o[b],d.hasOwnProperty(b)&&(x!=null||pe!=null))switch(b){case"value":Fe=x;break;case"defaultValue":K=x;break;case"multiple":$=x;default:x!==pe&&Rn(n,s,b,x,d,pe)}s=K,o=$,d=Ye,Fe!=null?Da(n,!!o,Fe,!1):!!d!=!!o&&(s!=null?Da(n,!!o,s,!0):Da(n,!!o,o?[]:"",!1));return;case"textarea":Ye=Fe=null;for(K in o)if(b=o[K],o.hasOwnProperty(K)&&b!=null&&!d.hasOwnProperty(K))switch(K){case"value":break;case"children":break;default:Rn(n,s,K,null,d,b)}for($ in d)if(b=d[$],x=o[$],d.hasOwnProperty($)&&(b!=null||x!=null))switch($){case"value":Fe=b;break;case"defaultValue":Ye=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(i(91));break;default:b!==x&&Rn(n,s,$,b,d,x)}Ss(n,Fe,Ye);return;case"option":for(var Ot in o)if(Fe=o[Ot],o.hasOwnProperty(Ot)&&Fe!=null&&!d.hasOwnProperty(Ot))switch(Ot){case"selected":n.selected=!1;break;default:Rn(n,s,Ot,null,d,Fe)}for(pe in d)if(Fe=d[pe],Ye=o[pe],d.hasOwnProperty(pe)&&Fe!==Ye&&(Fe!=null||Ye!=null))switch(pe){case"selected":n.selected=Fe&&typeof Fe!="function"&&typeof Fe!="symbol";break;default:Rn(n,s,pe,Fe,d,Ye)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Xt in o)Fe=o[Xt],o.hasOwnProperty(Xt)&&Fe!=null&&!d.hasOwnProperty(Xt)&&Rn(n,s,Xt,null,d,Fe);for(Le in d)if(Fe=d[Le],Ye=o[Le],d.hasOwnProperty(Le)&&Fe!==Ye&&(Fe!=null||Ye!=null))switch(Le){case"children":case"dangerouslySetInnerHTML":if(Fe!=null)throw Error(i(137,s));break;default:Rn(n,s,Le,Fe,d,Ye)}return;default:if(qt(s)){for(var kn in o)Fe=o[kn],o.hasOwnProperty(kn)&&Fe!==void 0&&!d.hasOwnProperty(kn)&&oh(n,s,kn,void 0,d,Fe);for(et in d)Fe=d[et],Ye=o[et],!d.hasOwnProperty(et)||Fe===Ye||Fe===void 0&&Ye===void 0||oh(n,s,et,Fe,d,Ye);return}}for(var Te in o)Fe=o[Te],o.hasOwnProperty(Te)&&Fe!=null&&!d.hasOwnProperty(Te)&&Rn(n,s,Te,null,d,Fe);for(lt in d)Fe=d[lt],Ye=o[lt],!d.hasOwnProperty(lt)||Fe===Ye||Fe==null&&Ye==null||Rn(n,s,lt,Fe,d,Ye)}function wx(n){switch(n){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function K_(){if(typeof performance.getEntriesByType=="function"){for(var n=0,s=0,o=performance.getEntriesByType("resource"),d=0;d<o.length;d++){var b=o[d],x=b.transferSize,$=b.initiatorType,K=b.duration;if(x&&K&&wx($)){for($=0,K=b.responseEnd,d+=1;d<o.length;d++){var pe=o[d],Le=pe.startTime;if(Le>K)break;var et=pe.transferSize,lt=pe.initiatorType;et&&wx(lt)&&(pe=pe.responseEnd,$+=et*(pe<K?1:(K-Le)/(pe-Le)))}if(--d,s+=8*(x+$)/(b.duration/1e3),n++,10<n)break}}if(0<n)return s/n/1e6}return navigator.connection&&(n=navigator.connection.downlink,typeof n=="number")?n:5}var ch=null,uh=null;function Nu(n){return n.nodeType===9?n:n.ownerDocument}function Nx(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ex(n,s){if(n===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&s==="foreignObject"?0:n}function dh(n,s){return n==="textarea"||n==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var fh=null;function W_(){var n=window.event;return n&&n.type==="popstate"?n===fh?!1:(fh=n,!0):(fh=null,!1)}var jx=typeof setTimeout=="function"?setTimeout:void 0,Z_=typeof clearTimeout=="function"?clearTimeout:void 0,_x=typeof Promise=="function"?Promise:void 0,Q_=typeof queueMicrotask=="function"?queueMicrotask:typeof _x<"u"?function(n){return _x.resolve(null).then(n).catch(J_)}:jx;function J_(n){setTimeout(function(){throw n})}function Cr(n){return n==="head"}function Cx(n,s){var o=s,d=0;do{var b=o.nextSibling;if(n.removeChild(o),b&&b.nodeType===8)if(o=b.data,o==="/$"||o==="/&"){if(d===0){n.removeChild(b),ml(s);return}d--}else if(o==="$"||o==="$?"||o==="$~"||o==="$!"||o==="&")d++;else if(o==="html")So(n.ownerDocument.documentElement);else if(o==="head"){o=n.ownerDocument.head,So(o);for(var x=o.firstChild;x;){var $=x.nextSibling,K=x.nodeName;x[ae]||K==="SCRIPT"||K==="STYLE"||K==="LINK"&&x.rel.toLowerCase()==="stylesheet"||o.removeChild(x),x=$}}else o==="body"&&So(n.ownerDocument.body);o=b}while(o);ml(s)}function Ax(n,s){var o=n;n=0;do{var d=o.nextSibling;if(o.nodeType===1?s?(o._stashedDisplay=o.style.display,o.style.display="none"):(o.style.display=o._stashedDisplay||"",o.getAttribute("style")===""&&o.removeAttribute("style")):o.nodeType===3&&(s?(o._stashedText=o.nodeValue,o.nodeValue=""):o.nodeValue=o._stashedText||""),d&&d.nodeType===8)if(o=d.data,o==="/$"){if(n===0)break;n--}else o!=="$"&&o!=="$?"&&o!=="$~"&&o!=="$!"||n++;o=d}while(o)}function mh(n){var s=n.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var o=s;switch(s=s.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":mh(o),Xe(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}n.removeChild(o)}}function eC(n,s,o,d){for(;n.nodeType===1;){var b=o;if(n.nodeName.toLowerCase()!==s.toLowerCase()){if(!d&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(d){if(!n[ae])switch(s){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(x=n.getAttribute("rel"),x==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(x!==b.rel||n.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||n.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||n.getAttribute("title")!==(b.title==null?null:b.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(x=n.getAttribute("src"),(x!==(b.src==null?null:b.src)||n.getAttribute("type")!==(b.type==null?null:b.type)||n.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&x&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(s==="input"&&n.type==="hidden"){var x=b.name==null?null:""+b.name;if(b.type==="hidden"&&n.getAttribute("name")===x)return n}else return n;if(n=es(n.nextSibling),n===null)break}return null}function tC(n,s,o){if(s==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!o||(n=es(n.nextSibling),n===null))return null;return n}function Tx(n,s){for(;n.nodeType!==8;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!s||(n=es(n.nextSibling),n===null))return null;return n}function hh(n){return n.data==="$?"||n.data==="$~"}function ph(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState!=="loading"}function nC(n,s){var o=n.ownerDocument;if(n.data==="$~")n._reactRetry=s;else if(n.data!=="$?"||o.readyState!=="loading")s();else{var d=function(){s(),o.removeEventListener("DOMContentLoaded",d)};o.addEventListener("DOMContentLoaded",d),n._reactRetry=d}}function es(n){for(;n!=null;n=n.nextSibling){var s=n.nodeType;if(s===1||s===3)break;if(s===8){if(s=n.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return n}var yh=null;function Mx(n){n=n.nextSibling;for(var s=0;n;){if(n.nodeType===8){var o=n.data;if(o==="/$"||o==="/&"){if(s===0)return es(n.nextSibling);s--}else o!=="$"&&o!=="$!"&&o!=="$?"&&o!=="$~"&&o!=="&"||s++}n=n.nextSibling}return null}function Rx(n){n=n.previousSibling;for(var s=0;n;){if(n.nodeType===8){var o=n.data;if(o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"){if(s===0)return n;s--}else o!=="/$"&&o!=="/&"||s++}n=n.previousSibling}return null}function kx(n,s,o){switch(s=Nu(o),n){case"html":if(n=s.documentElement,!n)throw Error(i(452));return n;case"head":if(n=s.head,!n)throw Error(i(453));return n;case"body":if(n=s.body,!n)throw Error(i(454));return n;default:throw Error(i(451))}}function So(n){for(var s=n.attributes;s.length;)n.removeAttributeNode(s[0]);Xe(n)}var ts=new Map,Dx=new Set;function Eu(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var Zs=L.d;L.d={f:aC,r:sC,D:rC,C:iC,L:lC,m:oC,X:uC,S:cC,M:dC};function aC(){var n=Zs.f(),s=pu();return n||s}function sC(n){var s=Je(n);s!==null&&s.tag===5&&s.type==="form"?Wb(s):Zs.r(n)}var ul=typeof document>"u"?null:document;function Ix(n,s,o){var d=ul;if(d&&typeof s=="string"&&s){var b=ra(s);b='link[rel="'+n+'"][href="'+b+'"]',typeof o=="string"&&(b+='[crossorigin="'+o+'"]'),Dx.has(b)||(Dx.add(b),n={rel:n,crossOrigin:o,href:s},d.querySelector(b)===null&&(s=d.createElement("link"),da(s,"link",n),_e(s),d.head.appendChild(s)))}}function rC(n){Zs.D(n),Ix("dns-prefetch",n,null)}function iC(n,s){Zs.C(n,s),Ix("preconnect",n,s)}function lC(n,s,o){Zs.L(n,s,o);var d=ul;if(d&&n&&s){var b='link[rel="preload"][as="'+ra(s)+'"]';s==="image"&&o&&o.imageSrcSet?(b+='[imagesrcset="'+ra(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(b+='[imagesizes="'+ra(o.imageSizes)+'"]')):b+='[href="'+ra(n)+'"]';var x=b;switch(s){case"style":x=dl(n);break;case"script":x=fl(n)}ts.has(x)||(n=g({rel:"preload",href:s==="image"&&o&&o.imageSrcSet?void 0:n,as:s},o),ts.set(x,n),d.querySelector(b)!==null||s==="style"&&d.querySelector(wo(x))||s==="script"&&d.querySelector(No(x))||(s=d.createElement("link"),da(s,"link",n),_e(s),d.head.appendChild(s)))}}function oC(n,s){Zs.m(n,s);var o=ul;if(o&&n){var d=s&&typeof s.as=="string"?s.as:"script",b='link[rel="modulepreload"][as="'+ra(d)+'"][href="'+ra(n)+'"]',x=b;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=fl(n)}if(!ts.has(x)&&(n=g({rel:"modulepreload",href:n},s),ts.set(x,n),o.querySelector(b)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(No(x)))return}d=o.createElement("link"),da(d,"link",n),_e(d),o.head.appendChild(d)}}}function cC(n,s,o){Zs.S(n,s,o);var d=ul;if(d&&n){var b=St(d).hoistableStyles,x=dl(n);s=s||"default";var $=b.get(x);if(!$){var K={loading:0,preload:null};if($=d.querySelector(wo(x)))K.loading=5;else{n=g({rel:"stylesheet",href:n,"data-precedence":s},o),(o=ts.get(x))&&gh(n,o);var pe=$=d.createElement("link");_e(pe),da(pe,"link",n),pe._p=new Promise(function(Le,et){pe.onload=Le,pe.onerror=et}),pe.addEventListener("load",function(){K.loading|=1}),pe.addEventListener("error",function(){K.loading|=2}),K.loading|=4,ju($,s,d)}$={type:"stylesheet",instance:$,count:1,state:K},b.set(x,$)}}}function uC(n,s){Zs.X(n,s);var o=ul;if(o&&n){var d=St(o).hoistableScripts,b=fl(n),x=d.get(b);x||(x=o.querySelector(No(b)),x||(n=g({src:n,async:!0},s),(s=ts.get(b))&&bh(n,s),x=o.createElement("script"),_e(x),da(x,"link",n),o.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},d.set(b,x))}}function dC(n,s){Zs.M(n,s);var o=ul;if(o&&n){var d=St(o).hoistableScripts,b=fl(n),x=d.get(b);x||(x=o.querySelector(No(b)),x||(n=g({src:n,async:!0,type:"module"},s),(s=ts.get(b))&&bh(n,s),x=o.createElement("script"),_e(x),da(x,"link",n),o.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},d.set(b,x))}}function Lx(n,s,o,d){var b=(b=Z.current)?Eu(b):null;if(!b)throw Error(i(446));switch(n){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(s=dl(o.href),o=St(b).hoistableStyles,d=o.get(s),d||(d={type:"style",instance:null,count:0,state:null},o.set(s,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){n=dl(o.href);var x=St(b).hoistableStyles,$=x.get(n);if($||(b=b.ownerDocument||b,$={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(n,$),(x=b.querySelector(wo(n)))&&!x._p&&($.instance=x,$.state.loading=5),ts.has(n)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},ts.set(n,o),x||fC(b,n,o,$.state))),s&&d===null)throw Error(i(528,""));return $}if(s&&d!==null)throw Error(i(529,""));return null;case"script":return s=o.async,o=o.src,typeof o=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=fl(o),o=St(b).hoistableScripts,d=o.get(s),d||(d={type:"script",instance:null,count:0,state:null},o.set(s,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,n))}}function dl(n){return'href="'+ra(n)+'"'}function wo(n){return'link[rel="stylesheet"]['+n+"]"}function Ox(n){return g({},n,{"data-precedence":n.precedence,precedence:null})}function fC(n,s,o,d){n.querySelector('link[rel="preload"][as="style"]['+s+"]")?d.loading=1:(s=n.createElement("link"),d.preload=s,s.addEventListener("load",function(){return d.loading|=1}),s.addEventListener("error",function(){return d.loading|=2}),da(s,"link",o),_e(s),n.head.appendChild(s))}function fl(n){return'[src="'+ra(n)+'"]'}function No(n){return"script[async]"+n}function zx(n,s,o){if(s.count++,s.instance===null)switch(s.type){case"style":var d=n.querySelector('style[data-href~="'+ra(o.href)+'"]');if(d)return s.instance=d,_e(d),d;var b=g({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return d=(n.ownerDocument||n).createElement("style"),_e(d),da(d,"style",b),ju(d,o.precedence,n),s.instance=d;case"stylesheet":b=dl(o.href);var x=n.querySelector(wo(b));if(x)return s.state.loading|=4,s.instance=x,_e(x),x;d=Ox(o),(b=ts.get(b))&&gh(d,b),x=(n.ownerDocument||n).createElement("link"),_e(x);var $=x;return $._p=new Promise(function(K,pe){$.onload=K,$.onerror=pe}),da(x,"link",d),s.state.loading|=4,ju(x,o.precedence,n),s.instance=x;case"script":return x=fl(o.src),(b=n.querySelector(No(x)))?(s.instance=b,_e(b),b):(d=o,(b=ts.get(x))&&(d=g({},o),bh(d,b)),n=n.ownerDocument||n,b=n.createElement("script"),_e(b),da(b,"link",d),n.head.appendChild(b),s.instance=b);case"void":return null;default:throw Error(i(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(d=s.instance,s.state.loading|=4,ju(d,o.precedence,n));return s.instance}function ju(n,s,o){for(var d=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=d.length?d[d.length-1]:null,x=b,$=0;$<d.length;$++){var K=d[$];if(K.dataset.precedence===s)x=K;else if(x!==b)break}x?x.parentNode.insertBefore(n,x.nextSibling):(s=o.nodeType===9?o.head:o,s.insertBefore(n,s.firstChild))}function gh(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.title==null&&(n.title=s.title)}function bh(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.integrity==null&&(n.integrity=s.integrity)}var _u=null;function $x(n,s,o){if(_u===null){var d=new Map,b=_u=new Map;b.set(o,d)}else b=_u,d=b.get(o),d||(d=new Map,b.set(o,d));if(d.has(n))return d;for(d.set(n,null),o=o.getElementsByTagName(n),b=0;b<o.length;b++){var x=o[b];if(!(x[ae]||x[Ke]||n==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var $=x.getAttribute(s)||"";$=n+$;var K=d.get($);K?K.push(x):d.set($,[x])}}return d}function Fx(n,s,o){n=n.ownerDocument||n,n.head.insertBefore(o,s==="title"?n.querySelector("head > title"):null)}function mC(n,s,o){if(o===1||s.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return n=s.disabled,typeof s.precedence=="string"&&n==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Bx(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}function hC(n,s,o,d){if(o.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var b=dl(d.href),x=s.querySelector(wo(b));if(x){s=x._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(n.count++,n=Cu.bind(n),s.then(n,n)),o.state.loading|=4,o.instance=x,_e(x);return}x=s.ownerDocument||s,d=Ox(d),(b=ts.get(b))&&gh(d,b),x=x.createElement("link"),_e(x);var $=x;$._p=new Promise(function(K,pe){$.onload=K,$.onerror=pe}),da(x,"link",d),o.instance=x}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(o,s),(s=o.state.preload)&&(o.state.loading&3)===0&&(n.count++,o=Cu.bind(n),s.addEventListener("load",o),s.addEventListener("error",o))}}var vh=0;function pC(n,s){return n.stylesheets&&n.count===0&&Tu(n,n.stylesheets),0<n.count||0<n.imgCount?function(o){var d=setTimeout(function(){if(n.stylesheets&&Tu(n,n.stylesheets),n.unsuspend){var x=n.unsuspend;n.unsuspend=null,x()}},6e4+s);0<n.imgBytes&&vh===0&&(vh=62500*K_());var b=setTimeout(function(){if(n.waitingForImages=!1,n.count===0&&(n.stylesheets&&Tu(n,n.stylesheets),n.unsuspend)){var x=n.unsuspend;n.unsuspend=null,x()}},(n.imgBytes>vh?50:800)+s);return n.unsuspend=o,function(){n.unsuspend=null,clearTimeout(d),clearTimeout(b)}}:null}function Cu(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Tu(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var Au=null;function Tu(n,s){n.stylesheets=null,n.unsuspend!==null&&(n.count++,Au=new Map,s.forEach(yC,n),Au=null,Cu.call(n))}function yC(n,s){if(!(s.state.loading&4)){var o=Au.get(n);if(o)var d=o.get(null);else{o=new Map,Au.set(n,o);for(var b=n.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<b.length;x++){var $=b[x];($.nodeName==="LINK"||$.getAttribute("media")!=="not all")&&(o.set($.dataset.precedence,$),d=$)}d&&o.set(null,d)}b=s.instance,$=b.getAttribute("data-precedence"),x=o.get($)||d,x===d&&o.set(null,b),o.set($,b),this.count++,d=Cu.bind(this),b.addEventListener("load",d),b.addEventListener("error",d),x?x.parentNode.insertBefore(b,x.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(b,n.firstChild)),s.state.loading|=4}}var Eo={$$typeof:O,Provider:null,Consumer:null,_currentValue:B,_currentValue2:B,_threadCount:0};function gC(n,s,o,d,b,x,$,K,pe){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Kt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Kt(0),this.hiddenUpdates=Kt(null),this.identifierPrefix=d,this.onUncaughtError=b,this.onCaughtError=x,this.onRecoverableError=$,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=pe,this.incompleteTransitions=new Map}function Ux(n,s,o,d,b,x,$,K,pe,Le,et,lt){return n=new gC(n,s,o,$,pe,Le,et,lt,K),s=1,x===!0&&(s|=24),x=La(3,null,null,s),n.current=x,x.stateNode=n,s=Qf(),s.refCount++,n.pooledCache=s,s.refCount++,x.memoizedState={element:d,isDehydrated:o,cache:s},nm(x),n}function qx(n){return n?(n=Hi,n):Hi}function Hx(n,s,o,d,b,x){b=qx(b),d.context===null?d.context=b:d.pendingContext=b,d=yr(s),d.payload={element:o},x=x===void 0?null:x,x!==null&&(d.callback=x),o=gr(n,d,s),o!==null&&(_a(o,n,s),to(o,n,s))}function Px(n,s){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var o=n.retryLane;n.retryLane=o!==0&&o<s?o:s}}function xh(n,s){Px(n,s),(n=n.alternate)&&Px(n,s)}function Vx(n){if(n.tag===13||n.tag===31){var s=ri(n,67108864);s!==null&&_a(s,n,67108864),xh(n,67108864)}}function Yx(n){if(n.tag===13||n.tag===31){var s=Ba();s=gt(s);var o=ri(n,s);o!==null&&_a(o,n,s),xh(n,s)}}var Mu=!0;function bC(n,s,o,d){var b=D.T;D.T=null;var x=L.p;try{L.p=2,Sh(n,s,o,d)}finally{L.p=x,D.T=b}}function vC(n,s,o,d){var b=D.T;D.T=null;var x=L.p;try{L.p=8,Sh(n,s,o,d)}finally{L.p=x,D.T=b}}function Sh(n,s,o,d){if(Mu){var b=wh(d);if(b===null)lh(n,s,d,Ru,o),Xx(n,d);else if(SC(b,n,s,o,d))d.stopPropagation();else if(Xx(n,d),s&4&&-1<xC.indexOf(n)){for(;b!==null;){var x=Je(b);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var $=Tt(x.pendingLanes);if($!==0){var K=x;for(K.pendingLanes|=2,K.entangledLanes|=2;$;){var pe=1<<31-ze($);K.entanglements[1]|=pe,$&=~pe}js(x),(_n&6)===0&&(mu=Qe()+500,bo(0))}}break;case 31:case 13:K=ri(x,2),K!==null&&_a(K,x,2),pu(),xh(x,2)}if(x=wh(d),x===null&&lh(n,s,d,Ru,o),x===b)break;b=x}b!==null&&d.stopPropagation()}else lh(n,s,d,null,o)}}function wh(n){return n=Me(n),Nh(n)}var Ru=null;function Nh(n){if(Ru=null,n=$e(n),n!==null){var s=c(n);if(s===null)n=null;else{var o=s.tag;if(o===13){if(n=f(s),n!==null)return n;n=null}else if(o===31){if(n=m(s),n!==null)return n;n=null}else if(o===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;n=null}else s!==n&&(n=null)}}return Ru=n,null}function Gx(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(W()){case ee:return 2;case te:return 8;case ve:case le:return 32;case Se:return 268435456;default:return 32}default:return 32}}var Eh=!1,Ar=null,Tr=null,Mr=null,jo=new Map,_o=new Map,Rr=[],xC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Xx(n,s){switch(n){case"focusin":case"focusout":Ar=null;break;case"dragenter":case"dragleave":Tr=null;break;case"mouseover":case"mouseout":Mr=null;break;case"pointerover":case"pointerout":jo.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":_o.delete(s.pointerId)}}function Co(n,s,o,d,b,x){return n===null||n.nativeEvent!==x?(n={blockedOn:s,domEventName:o,eventSystemFlags:d,nativeEvent:x,targetContainers:[b]},s!==null&&(s=Je(s),s!==null&&Vx(s)),n):(n.eventSystemFlags|=d,s=n.targetContainers,b!==null&&s.indexOf(b)===-1&&s.push(b),n)}function SC(n,s,o,d,b){switch(s){case"focusin":return Ar=Co(Ar,n,s,o,d,b),!0;case"dragenter":return Tr=Co(Tr,n,s,o,d,b),!0;case"mouseover":return Mr=Co(Mr,n,s,o,d,b),!0;case"pointerover":var x=b.pointerId;return jo.set(x,Co(jo.get(x)||null,n,s,o,d,b)),!0;case"gotpointercapture":return x=b.pointerId,_o.set(x,Co(_o.get(x)||null,n,s,o,d,b)),!0}return!1}function Kx(n){var s=$e(n.target);if(s!==null){var o=c(s);if(o!==null){if(s=o.tag,s===13){if(s=f(o),s!==null){n.blockedOn=s,Ne(n.priority,function(){Yx(o)});return}}else if(s===31){if(s=m(o),s!==null){n.blockedOn=s,Ne(n.priority,function(){Yx(o)});return}}else if(s===3&&o.stateNode.current.memoizedState.isDehydrated){n.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}n.blockedOn=null}function ku(n){if(n.blockedOn!==null)return!1;for(var s=n.targetContainers;0<s.length;){var o=wh(n.nativeEvent);if(o===null){o=n.nativeEvent;var d=new o.constructor(o.type,o);ye=d,o.target.dispatchEvent(d),ye=null}else return s=Je(o),s!==null&&Vx(s),n.blockedOn=o,!1;s.shift()}return!0}function Wx(n,s,o){ku(n)&&o.delete(s)}function wC(){Eh=!1,Ar!==null&&ku(Ar)&&(Ar=null),Tr!==null&&ku(Tr)&&(Tr=null),Mr!==null&&ku(Mr)&&(Mr=null),jo.forEach(Wx),_o.forEach(Wx)}function Du(n,s){n.blockedOn===s&&(n.blockedOn=null,Eh||(Eh=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,wC)))}var Iu=null;function Zx(n){Iu!==n&&(Iu=n,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Iu===n&&(Iu=null);for(var s=0;s<n.length;s+=3){var o=n[s],d=n[s+1],b=n[s+2];if(typeof d!="function"){if(Nh(d||o)===null)continue;break}var x=Je(o);x!==null&&(n.splice(s,3),s-=3,wm(x,{pending:!0,data:b,method:o.method,action:d},d,b))}}))}function ml(n){function s(pe){return Du(pe,n)}Ar!==null&&Du(Ar,n),Tr!==null&&Du(Tr,n),Mr!==null&&Du(Mr,n),jo.forEach(s),_o.forEach(s);for(var o=0;o<Rr.length;o++){var d=Rr[o];d.blockedOn===n&&(d.blockedOn=null)}for(;0<Rr.length&&(o=Rr[0],o.blockedOn===null);)Kx(o),o.blockedOn===null&&Rr.shift();if(o=(n.ownerDocument||n).$$reactFormReplay,o!=null)for(d=0;d<o.length;d+=3){var b=o[d],x=o[d+1],$=b[ot]||null;if(typeof x=="function")$||Zx(o);else if($){var K=null;if(x&&x.hasAttribute("formAction")){if(b=x,$=x[ot]||null)K=$.formAction;else if(Nh(b)!==null)continue}else K=$.action;typeof K=="function"?o[d+1]=K:(o.splice(d,3),d-=3),Zx(o)}}}function Qx(){function n(x){x.canIntercept&&x.info==="react-transition"&&x.intercept({handler:function(){return new Promise(function($){return b=$})},focusReset:"manual",scroll:"manual"})}function s(){b!==null&&(b(),b=null),d||setTimeout(o,20)}function o(){if(!d&&!navigation.transition){var x=navigation.currentEntry;x&&x.url!=null&&navigation.navigate(x.url,{state:x.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,b=null;return navigation.addEventListener("navigate",n),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(o,100),function(){d=!0,navigation.removeEventListener("navigate",n),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),b!==null&&(b(),b=null)}}}function jh(n){this._internalRoot=n}Lu.prototype.render=jh.prototype.render=function(n){var s=this._internalRoot;if(s===null)throw Error(i(409));var o=s.current,d=Ba();Hx(o,d,n,s,null,null)},Lu.prototype.unmount=jh.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var s=n.containerInfo;Hx(n.current,2,null,n,null,null),pu(),s[Oe]=null}};function Lu(n){this._internalRoot=n}Lu.prototype.unstable_scheduleHydration=function(n){if(n){var s=re();n={blockedOn:null,target:n,priority:s};for(var o=0;o<Rr.length&&s!==0&&s<Rr[o].priority;o++);Rr.splice(o,0,n),o===0&&Kx(n)}};var Jx=t.version;if(Jx!=="19.2.0")throw Error(i(527,Jx,"19.2.0"));L.findDOMNode=function(n){var s=n._reactInternals;if(s===void 0)throw typeof n.render=="function"?Error(i(188)):(n=Object.keys(n).join(","),Error(i(268,n)));return n=p(s),n=n!==null?y(n):null,n=n===null?null:n.stateNode,n};var NC={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:D,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ou=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ou.isDisabled&&Ou.supportsFiber)try{at=Ou.inject(NC),st=Ou}catch{}}return To.createRoot=function(n,s){if(!l(n))throw Error(i(299));var o=!1,d="",b=iv,x=lv,$=ov;return s!=null&&(s.unstable_strictMode===!0&&(o=!0),s.identifierPrefix!==void 0&&(d=s.identifierPrefix),s.onUncaughtError!==void 0&&(b=s.onUncaughtError),s.onCaughtError!==void 0&&(x=s.onCaughtError),s.onRecoverableError!==void 0&&($=s.onRecoverableError)),s=Ux(n,1,!1,null,null,o,d,null,b,x,$,Qx),n[Oe]=s.current,ih(n),new jh(s)},To.hydrateRoot=function(n,s,o){if(!l(n))throw Error(i(299));var d=!1,b="",x=iv,$=lv,K=ov,pe=null;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(b=o.identifierPrefix),o.onUncaughtError!==void 0&&(x=o.onUncaughtError),o.onCaughtError!==void 0&&($=o.onCaughtError),o.onRecoverableError!==void 0&&(K=o.onRecoverableError),o.formState!==void 0&&(pe=o.formState)),s=Ux(n,1,!0,s,o??null,d,b,pe,x,$,K,Qx),s.context=qx(null),o=s.current,d=Ba(),d=gt(d),b=yr(d),b.callback=null,gr(o,b,d),o=d,s.current.lanes=o,se(s,o),js(s),n[Oe]=s.current,ih(n),new Lu(s)},To.version="19.2.0",To}var c0;function kC(){if(c0)return Ah.exports;c0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Ah.exports=RC(),Ah.exports}var DC=kC();/**
 * react-router v7.9.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Yw=e=>{throw TypeError(e)},IC=(e,t,r)=>t.has(e)||Yw("Cannot "+r),kh=(e,t,r)=>(IC(e,t,"read from private field"),r?r.call(e):t.get(e)),LC=(e,t,r)=>t.has(e)?Yw("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),u0="popstate";function OC(e={}){function t(i,l){let{pathname:c,search:f,hash:m}=i.location;return ac("",{pathname:c,search:f,hash:m},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function r(i,l){return typeof l=="string"?l:Vr(l)}return $C(t,r,null,e)}function sn(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Yn(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function zC(){return Math.random().toString(36).substring(2,10)}function d0(e,t){return{usr:e.state,key:e.key,idx:t}}function ac(e,t,r=null,i){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof t=="string"?Wr(t):t,state:r,key:t&&t.key||i||zC()}}function Vr({pathname:e="/",search:t="",hash:r=""}){return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Wr(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substring(r),e=e.substring(0,r));let i=e.indexOf("?");i>=0&&(t.search=e.substring(i),e=e.substring(0,i)),e&&(t.pathname=e)}return t}function $C(e,t,r,i={}){let{window:l=document.defaultView,v5Compat:c=!1}=i,f=l.history,m="POP",h=null,p=y();p==null&&(p=0,f.replaceState({...f.state,idx:p},""));function y(){return(f.state||{idx:null}).idx}function g(){m="POP";let j=y(),_=j==null?null:j-p;p=j,h&&h({action:m,location:N.location,delta:_})}function v(j,_){m="PUSH";let C=ac(N.location,j,_);p=y()+1;let O=d0(C,p),E=N.createHref(C);try{f.pushState(O,"",E)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;l.location.assign(E)}c&&h&&h({action:m,location:N.location,delta:1})}function S(j,_){m="REPLACE";let C=ac(N.location,j,_);p=y();let O=d0(C,p),E=N.createHref(C);f.replaceState(O,"",E),c&&h&&h({action:m,location:N.location,delta:0})}function w(j){return Gw(j)}let N={get action(){return m},get location(){return e(l,f)},listen(j){if(h)throw new Error("A history only accepts one active listener");return l.addEventListener(u0,g),h=j,()=>{l.removeEventListener(u0,g),h=null}},createHref(j){return t(l,j)},createURL:w,encodeLocation(j){let _=w(j);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:v,replace:S,go(j){return f.go(j)}};return N}function Gw(e,t=!1){let r="http://localhost";typeof window<"u"&&(r=window.location.origin!=="null"?window.location.origin:window.location.href),sn(r,"No window.location.(origin|href) available to create URL");let i=typeof e=="string"?e:Vr(e);return i=i.replace(/ $/,"%20"),!t&&i.startsWith("//")&&(i=r+i),new URL(i,r)}var Go,f0=class{constructor(e){if(LC(this,Go,new Map),e)for(let[t,r]of e)this.set(t,r)}get(e){if(kh(this,Go).has(e))return kh(this,Go).get(e);if(e.defaultValue!==void 0)return e.defaultValue;throw new Error("No value found for context")}set(e,t){kh(this,Go).set(e,t)}};Go=new WeakMap;var FC=new Set(["lazy","caseSensitive","path","id","index","children"]);function BC(e){return FC.has(e)}var UC=new Set(["lazy","caseSensitive","path","id","index","middleware","children"]);function qC(e){return UC.has(e)}function HC(e){return e.index===!0}function sc(e,t,r=[],i={},l=!1){return e.map((c,f)=>{let m=[...r,String(f)],h=typeof c.id=="string"?c.id:m.join("-");if(sn(c.index!==!0||!c.children,"Cannot specify children on an index route"),sn(l||!i[h],`Found a route id collision on id "${h}".  Route id's must be globally unique within Data Router usages`),HC(c)){let p={...c,...t(c),id:h};return i[h]=p,p}else{let p={...c,...t(c),id:h,children:void 0};return i[h]=p,c.children&&(p.children=sc(c.children,t,m,i,l)),p}})}function Fr(e,t,r="/"){return md(e,t,r,!1)}function md(e,t,r,i){let l=typeof t=="string"?Wr(t):t,c=Ma(l.pathname||"/",r);if(c==null)return null;let f=Xw(e);VC(f);let m=null;for(let h=0;m==null&&h<f.length;++h){let p=nA(c);m=eA(f[h],p,i)}return m}function PC(e,t){let{route:r,pathname:i,params:l}=e;return{id:r.id,pathname:i,params:l,data:t[r.id],loaderData:t[r.id],handle:r.handle}}function Xw(e,t=[],r=[],i="",l=!1){let c=(f,m,h=l,p)=>{let y={relativePath:p===void 0?f.path||"":p,caseSensitive:f.caseSensitive===!0,childrenIndex:m,route:f};if(y.relativePath.startsWith("/")){if(!y.relativePath.startsWith(i)&&h)return;sn(y.relativePath.startsWith(i),`Absolute route path "${y.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),y.relativePath=y.relativePath.slice(i.length)}let g=Ms([i,y.relativePath]),v=r.concat(y);f.children&&f.children.length>0&&(sn(f.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),Xw(f.children,t,v,g,h)),!(f.path==null&&!f.index)&&t.push({path:g,score:QC(g,f.index),routesMeta:v})};return e.forEach((f,m)=>{if(f.path===""||!f.path?.includes("?"))c(f,m);else for(let h of Kw(f.path))c(f,m,!0,h)}),t}function Kw(e){let t=e.split("/");if(t.length===0)return[];let[r,...i]=t,l=r.endsWith("?"),c=r.replace(/\?$/,"");if(i.length===0)return l?[c,""]:[c];let f=Kw(i.join("/")),m=[];return m.push(...f.map(h=>h===""?c:[c,h].join("/"))),l&&m.push(...f),m.map(h=>e.startsWith("/")&&h===""?"/":h)}function VC(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:JC(t.routesMeta.map(i=>i.childrenIndex),r.routesMeta.map(i=>i.childrenIndex)))}var YC=/^:[\w-]+$/,GC=3,XC=2,KC=1,WC=10,ZC=-2,m0=e=>e==="*";function QC(e,t){let r=e.split("/"),i=r.length;return r.some(m0)&&(i+=ZC),t&&(i+=XC),r.filter(l=>!m0(l)).reduce((l,c)=>l+(YC.test(c)?GC:c===""?KC:WC),i)}function JC(e,t){return e.length===t.length&&e.slice(0,-1).every((i,l)=>i===t[l])?e[e.length-1]-t[t.length-1]:0}function eA(e,t,r=!1){let{routesMeta:i}=e,l={},c="/",f=[];for(let m=0;m<i.length;++m){let h=i[m],p=m===i.length-1,y=c==="/"?t:t.slice(c.length)||"/",g=Cd({path:h.relativePath,caseSensitive:h.caseSensitive,end:p},y),v=h.route;if(!g&&p&&r&&!i[i.length-1].route.index&&(g=Cd({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},y)),!g)return null;Object.assign(l,g.params),f.push({params:l,pathname:Ms([c,g.pathname]),pathnameBase:iA(Ms([c,g.pathnameBase])),route:v}),g.pathnameBase!=="/"&&(c=Ms([c,g.pathnameBase]))}return f}function Cd(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,i]=tA(e.path,e.caseSensitive,e.end),l=t.match(r);if(!l)return null;let c=l[0],f=c.replace(/(.)\/+$/,"$1"),m=l.slice(1);return{params:i.reduce((p,{paramName:y,isOptional:g},v)=>{if(y==="*"){let w=m[v]||"";f=c.slice(0,c.length-w.length).replace(/(.)\/+$/,"$1")}const S=m[v];return g&&!S?p[y]=void 0:p[y]=(S||"").replace(/%2F/g,"/"),p},{}),pathname:c,pathnameBase:f,pattern:e}}function tA(e,t=!1,r=!0){Yn(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let i=[],l="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,m,h)=>(i.push({paramName:m,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(i.push({paramName:"*"}),l+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?l+="\\/*$":e!==""&&e!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,t?void 0:"i"),i]}function nA(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Yn(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function Ma(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,i=e.charAt(r);return i&&i!=="/"?null:e.slice(r)||"/"}function aA({basename:e,pathname:t}){return t==="/"?e:Ms([e,t])}function sA(e,t="/"){let{pathname:r,search:i="",hash:l=""}=typeof e=="string"?Wr(e):e;return{pathname:r?r.startsWith("/")?r:rA(r,t):t,search:lA(i),hash:oA(l)}}function rA(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(l=>{l===".."?r.length>1&&r.pop():l!=="."&&r.push(l)}),r.length>1?r.join("/"):"/"}function Dh(e,t,r,i){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Ww(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function Gd(e){let t=Ww(e);return t.map((r,i)=>i===t.length-1?r.pathname:r.pathnameBase)}function Xd(e,t,r,i=!1){let l;typeof e=="string"?l=Wr(e):(l={...e},sn(!l.pathname||!l.pathname.includes("?"),Dh("?","pathname","search",l)),sn(!l.pathname||!l.pathname.includes("#"),Dh("#","pathname","hash",l)),sn(!l.search||!l.search.includes("#"),Dh("#","search","hash",l)));let c=e===""||l.pathname==="",f=c?"/":l.pathname,m;if(f==null)m=r;else{let g=t.length-1;if(!i&&f.startsWith("..")){let v=f.split("/");for(;v[0]==="..";)v.shift(),g-=1;l.pathname=v.join("/")}m=g>=0?t[g]:"/"}let h=sA(l,m),p=f&&f!=="/"&&f.endsWith("/"),y=(c||f===".")&&r.endsWith("/");return!h.pathname.endsWith("/")&&(p||y)&&(h.pathname+="/"),h}var Ms=e=>e.join("/").replace(/\/\/+/g,"/"),iA=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),lA=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,oA=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e,Ad=class{constructor(e,t,r,i=!1){this.status=e,this.statusText=t||"",this.internal=i,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}};function rc(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}var Zw=["POST","PUT","PATCH","DELETE"],cA=new Set(Zw),uA=["GET",...Zw],dA=new Set(uA),fA=new Set([301,302,303,307,308]),mA=new Set([307,308]),Ih={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},hA={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},wi={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},pA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,jy=e=>pA.test(e),yA=e=>({hasErrorBoundary:!!e.hasErrorBoundary}),Qw="remix-router-transitions",Jw=Symbol("ResetLoaderData");function gA(e){const t=e.window?e.window:typeof window<"u"?window:void 0,r=typeof t<"u"&&typeof t.document<"u"&&typeof t.document.createElement<"u";sn(e.routes.length>0,"You must provide a non-empty routes array to createRouter");let i=e.hydrationRouteProperties||[],l=e.mapRouteProperties||yA,c={},f=sc(e.routes,l,void 0,c),m,h=e.basename||"/";h.startsWith("/")||(h=`/${h}`);let p=e.dataStrategy||wA,y={...e.future},g=null,v=new Set,S=null,w=null,N=null,j=e.hydrationData!=null,_=Fr(f,e.history.location,h),C=!1,O=null,E;if(_==null&&!e.patchRoutesOnNavigation){let se=as(404,{pathname:e.history.location.pathname}),{matches:be,route:je}=zu(f);E=!0,_=be,O={[je.id]:se}}else if(_&&!e.hydrationData&&kt(_,f,e.history.location.pathname).active&&(_=null),_)if(_.some(se=>se.route.lazy))E=!1;else if(!_.some(se=>_y(se.route)))E=!0;else{let se=e.hydrationData?e.hydrationData.loaderData:null,be=e.hydrationData?e.hydrationData.errors:null;if(be){let je=_.findIndex(Ze=>be[Ze.route.id]!==void 0);E=_.slice(0,je+1).every(Ze=>!zp(Ze.route,se,be))}else E=_.every(je=>!zp(je.route,se,be))}else{E=!1,_=[];let se=kt(null,f,e.history.location.pathname);se.active&&se.matches&&(C=!0,_=se.matches)}let T,M={historyAction:e.history.action,location:e.history.location,matches:_,initialized:E,navigation:Ih,restoreScrollPosition:e.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:e.hydrationData&&e.hydrationData.loaderData||{},actionData:e.hydrationData&&e.hydrationData.actionData||null,errors:e.hydrationData&&e.hydrationData.errors||O,fetchers:new Map,blockers:new Map},A="POP",z=!1,P,X=!1,H=new Map,Y=null,V=!1,I=!1,F=new Set,D=new Map,L=0,B=-1,k=new Map,U=new Set,R=new Map,q=new Map,G=new Set,J=new Map,ie,Z=null;function me(){if(g=e.history.listen(({action:se,location:be,delta:je})=>{if(ie){ie(),ie=void 0;return}Yn(J.size===0||je!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let Ze=Rt({currentLocation:M.location,nextLocation:be,historyAction:se});if(Ze&&je!=null){let dt=new Promise(gt=>{ie=gt});e.history.go(je*-1),zt(Ze,{state:"blocked",location:be,proceed(){zt(Ze,{state:"proceeding",proceed:void 0,reset:void 0,location:be}),dt.then(()=>e.history.go(je))},reset(){let gt=new Map(M.blockers);gt.set(Ze,wi),ne({blockers:gt})}});return}return Ce(se,be)}),r){zA(t,H);let se=()=>$A(t,H);t.addEventListener("pagehide",se),Y=()=>t.removeEventListener("pagehide",se)}return M.initialized||Ce("POP",M.location,{initialHydration:!0}),T}function Q(){g&&g(),Y&&Y(),v.clear(),P&&P.abort(),M.fetchers.forEach((se,be)=>Se(be)),M.blockers.forEach((se,be)=>ft(be))}function ue(se){return v.add(se),()=>v.delete(se)}function ne(se,be={}){se.matches&&(se.matches=se.matches.map(dt=>{let gt=c[dt.route.id],oe=dt.route;return oe.element!==gt.element||oe.errorElement!==gt.errorElement||oe.hydrateFallbackElement!==gt.hydrateFallbackElement?{...dt,route:gt}:dt})),M={...M,...se};let je=[],Ze=[];M.fetchers.forEach((dt,gt)=>{dt.state==="idle"&&(G.has(gt)?je.push(gt):Ze.push(gt))}),G.forEach(dt=>{!M.fetchers.has(dt)&&!D.has(dt)&&je.push(dt)}),[...v].forEach(dt=>dt(M,{deletedFetchers:je,viewTransitionOpts:be.viewTransitionOpts,flushSync:be.flushSync===!0})),je.forEach(dt=>Se(dt)),Ze.forEach(dt=>M.fetchers.delete(dt))}function we(se,be,{flushSync:je}={}){let Ze=M.actionData!=null&&M.navigation.formMethod!=null&&Ca(M.navigation.formMethod)&&M.navigation.state==="loading"&&se.state?._isRedirect!==!0,dt;be.actionData?Object.keys(be.actionData).length>0?dt=be.actionData:dt=null:Ze?dt=M.actionData:dt=null;let gt=be.loaderData?N0(M.loaderData,be.loaderData,be.matches||[],be.errors):M.loaderData,oe=M.blockers;oe.size>0&&(oe=new Map(oe),oe.forEach((Ke,ot)=>oe.set(ot,wi)));let re=V?!1:Ft(se,be.matches||M.matches),Ne=z===!0||M.navigation.formMethod!=null&&Ca(M.navigation.formMethod)&&se.state?._isRedirect!==!0;m&&(f=m,m=void 0),V||A==="POP"||(A==="PUSH"?e.history.push(se,se.state):A==="REPLACE"&&e.history.replace(se,se.state));let Be;if(A==="POP"){let Ke=H.get(M.location.pathname);Ke&&Ke.has(se.pathname)?Be={currentLocation:M.location,nextLocation:se}:H.has(se.pathname)&&(Be={currentLocation:se,nextLocation:M.location})}else if(X){let Ke=H.get(M.location.pathname);Ke?Ke.add(se.pathname):(Ke=new Set([se.pathname]),H.set(M.location.pathname,Ke)),Be={currentLocation:M.location,nextLocation:se}}ne({...be,actionData:dt,loaderData:gt,historyAction:A,location:se,initialized:!0,navigation:Ih,revalidation:"idle",restoreScrollPosition:re,preventScrollReset:Ne,blockers:oe},{viewTransitionOpts:Be,flushSync:je===!0}),A="POP",z=!1,X=!1,V=!1,I=!1,Z?.resolve(),Z=null}async function Pe(se,be){if(typeof se=="number"){e.history.go(se);return}let je=Op(M.location,M.matches,h,se,be?.fromRouteId,be?.relative),{path:Ze,submission:dt,error:gt}=h0(!1,je,be),oe=M.location,re=ac(M.location,Ze,be&&be.state);re={...re,...e.history.encodeLocation(re)};let Ne=be&&be.replace!=null?be.replace:void 0,Be="PUSH";Ne===!0?Be="REPLACE":Ne===!1||dt!=null&&Ca(dt.formMethod)&&dt.formAction===M.location.pathname+M.location.search&&(Be="REPLACE");let Ke=be&&"preventScrollReset"in be?be.preventScrollReset===!0:void 0,ot=(be&&be.flushSync)===!0,Oe=Rt({currentLocation:oe,nextLocation:re,historyAction:Be});if(Oe){zt(Oe,{state:"blocked",location:re,proceed(){zt(Oe,{state:"proceeding",proceed:void 0,reset:void 0,location:re}),Pe(se,be)},reset(){let ce=new Map(M.blockers);ce.set(Oe,wi),ne({blockers:ce})}});return}await Ce(Be,re,{submission:dt,pendingError:gt,preventScrollReset:Ke,replace:be&&be.replace,enableViewTransition:be&&be.viewTransition,flushSync:ot})}function Re(){Z||(Z=FA()),W(),ne({revalidation:"loading"});let se=Z.promise;return M.navigation.state==="submitting"?se:M.navigation.state==="idle"?(Ce(M.historyAction,M.location,{startUninterruptedRevalidation:!0}),se):(Ce(A||M.historyAction,M.navigation.location,{overrideNavigation:M.navigation,enableViewTransition:X===!0}),se)}async function Ce(se,be,je){P&&P.abort(),P=null,A=se,V=(je&&je.startUninterruptedRevalidation)===!0,Tt(M.location,M.matches),z=(je&&je.preventScrollReset)===!0,X=(je&&je.enableViewTransition)===!0;let Ze=m||f,dt=je&&je.overrideNavigation,gt=je?.initialHydration&&M.matches&&M.matches.length>0&&!C?M.matches:Fr(Ze,be,h),oe=(je&&je.flushSync)===!0;if(gt&&M.initialized&&!I&&MA(M.location,be)&&!(je&&je.submission&&Ca(je.submission.formMethod))){we(be,{matches:gt},{flushSync:oe});return}let re=kt(gt,Ze,be.pathname);if(re.active&&re.matches&&(gt=re.matches),!gt){let{error:Ge,notFoundMatches:ut,route:ae}=pt(be.pathname);we(be,{matches:ut,loaderData:{},errors:{[ae.id]:Ge}},{flushSync:oe});return}P=new AbortController;let Ne=wl(e.history,be,P.signal,je&&je.submission),Be=e.getContext?await e.getContext():new f0,Ke;if(je&&je.pendingError)Ke=[Br(gt).route.id,{type:"error",error:je.pendingError}];else if(je&&je.submission&&Ca(je.submission.formMethod)){let Ge=await it(Ne,be,je.submission,gt,Be,re.active,je&&je.initialHydration===!0,{replace:je.replace,flushSync:oe});if(Ge.shortCircuited)return;if(Ge.pendingActionResult){let[ut,ae]=Ge.pendingActionResult;if(Ua(ae)&&rc(ae.error)&&ae.error.status===404){P=null,we(be,{matches:Ge.matches,loaderData:{},errors:{[ut]:ae.error}});return}}gt=Ge.matches||gt,Ke=Ge.pendingActionResult,dt=Lh(be,je.submission),oe=!1,re.active=!1,Ne=wl(e.history,Ne.url,Ne.signal)}let{shortCircuited:ot,matches:Oe,loaderData:ce,errors:Ue}=await qe(Ne,be,gt,Be,re.active,dt,je&&je.submission,je&&je.fetcherSubmission,je&&je.replace,je&&je.initialHydration===!0,oe,Ke);ot||(P=null,we(be,{matches:Oe||gt,...E0(Ke),loaderData:ce,errors:Ue}))}async function it(se,be,je,Ze,dt,gt,oe,re={}){W();let Ne=LA(be,je);if(ne({navigation:Ne},{flushSync:re.flushSync===!0}),gt){let ot=await Zt(Ze,be.pathname,se.signal);if(ot.type==="aborted")return{shortCircuited:!0};if(ot.type==="error"){if(ot.partialMatches.length===0){let{matches:ce,route:Ue}=zu(f);return{matches:ce,pendingActionResult:[Ue.id,{type:"error",error:ot.error}]}}let Oe=Br(ot.partialMatches).route.id;return{matches:ot.partialMatches,pendingActionResult:[Oe,{type:"error",error:ot.error}]}}else if(ot.matches)Ze=ot.matches;else{let{notFoundMatches:Oe,error:ce,route:Ue}=pt(be.pathname);return{matches:Oe,pendingActionResult:[Ue.id,{type:"error",error:ce}]}}}let Be,Ke=hd(Ze,be);if(!Ke.route.action&&!Ke.route.lazy)Be={type:"error",error:as(405,{method:se.method,pathname:be.pathname,routeId:Ke.route.id})};else{let ot=El(l,c,se,Ze,Ke,oe?[]:i,dt),Oe=await He(se,ot,dt,null);if(Be=Oe[Ke.route.id],!Be){for(let ce of Ze)if(Oe[ce.route.id]){Be=Oe[ce.route.id];break}}if(se.signal.aborted)return{shortCircuited:!0}}if(Ei(Be)){let ot;return re&&re.replace!=null?ot=re.replace:ot=x0(Be.response.headers.get("Location"),new URL(se.url),h)===M.location.pathname+M.location.search,await At(se,Be,!0,{submission:je,replace:ot}),{shortCircuited:!0}}if(Ua(Be)){let ot=Br(Ze,Ke.route.id);return(re&&re.replace)!==!0&&(A="PUSH"),{matches:Ze,pendingActionResult:[ot.route.id,Be,Ke.route.id]}}return{matches:Ze,pendingActionResult:[Ke.route.id,Be]}}async function qe(se,be,je,Ze,dt,gt,oe,re,Ne,Be,Ke,ot){let Oe=gt||Lh(be,oe),ce=oe||re||_0(Oe),Ue=!V&&!Be;if(dt){if(Ue){let Ve=We(ot);ne({navigation:Oe,...Ve!==void 0?{actionData:Ve}:{}},{flushSync:Ke})}let he=await Zt(je,be.pathname,se.signal);if(he.type==="aborted")return{shortCircuited:!0};if(he.type==="error"){if(he.partialMatches.length===0){let{matches:vt,route:Nt}=zu(f);return{matches:vt,loaderData:{},errors:{[Nt.id]:he.error}}}let Ve=Br(he.partialMatches).route.id;return{matches:he.partialMatches,loaderData:{},errors:{[Ve]:he.error}}}else if(he.matches)je=he.matches;else{let{error:Ve,notFoundMatches:vt,route:Nt}=pt(be.pathname);return{matches:vt,loaderData:{},errors:{[Nt.id]:Ve}}}}let Ge=m||f,{dsMatches:ut,revalidatingFetchers:ae}=p0(se,Ze,l,c,e.history,M,je,ce,be,Be?[]:i,Be===!0,I,F,G,R,U,Ge,h,e.patchRoutesOnNavigation!=null,ot);if(B=++L,!e.dataStrategy&&!ut.some(he=>he.shouldLoad)&&!ut.some(he=>he.route.middleware&&he.route.middleware.length>0)&&ae.length===0){let he=st();return we(be,{matches:je,loaderData:{},errors:ot&&Ua(ot[1])?{[ot[0]]:ot[1].error}:null,...E0(ot),...he?{fetchers:new Map(M.fetchers)}:{}},{flushSync:Ke}),{shortCircuited:!0}}if(Ue){let he={};if(!dt){he.navigation=Oe;let Ve=We(ot);Ve!==void 0&&(he.actionData=Ve)}ae.length>0&&(he.fetchers=ke(ae)),ne(he,{flushSync:Ke})}ae.forEach(he=>{ge(he.key),he.controller&&D.set(he.key,he.controller)});let Xe=()=>ae.forEach(he=>ge(he.key));P&&P.signal.addEventListener("abort",Xe);let{loaderResults:$e,fetcherResults:Je}=await Qe(ut,ae,se,Ze);if(se.signal.aborted)return{shortCircuited:!0};P&&P.signal.removeEventListener("abort",Xe),ae.forEach(he=>D.delete(he.key));let bt=$u($e);if(bt)return await At(se,bt.result,!0,{replace:Ne}),{shortCircuited:!0};if(bt=$u(Je),bt)return U.add(bt.key),await At(se,bt.result,!0,{replace:Ne}),{shortCircuited:!0};let{loaderData:St,errors:_e}=w0(M,je,$e,ot,ae,Je);Be&&M.errors&&(_e={...M.errors,..._e});let tt=st(),mt=nt(B),fe=tt||mt||ae.length>0;return{matches:je,loaderData:St,errors:_e,...fe?{fetchers:new Map(M.fetchers)}:{}}}function We(se){if(se&&!Ua(se[1]))return{[se[0]]:se[1].data};if(M.actionData)return Object.keys(M.actionData).length===0?null:M.actionData}function ke(se){return se.forEach(be=>{let je=M.fetchers.get(be.key),Ze=Mo(void 0,je?je.data:void 0);M.fetchers.set(be.key,Ze)}),new Map(M.fetchers)}async function xt(se,be,je,Ze){ge(se);let dt=(Ze&&Ze.flushSync)===!0,gt=m||f,oe=Op(M.location,M.matches,h,je,be,Ze?.relative),re=Fr(gt,oe,h),Ne=kt(re,gt,oe);if(Ne.active&&Ne.matches&&(re=Ne.matches),!re){te(se,be,as(404,{pathname:oe}),{flushSync:dt});return}let{path:Be,submission:Ke,error:ot}=h0(!0,oe,Ze);if(ot){te(se,be,ot,{flushSync:dt});return}let Oe=e.getContext?await e.getContext():new f0,ce=(Ze&&Ze.preventScrollReset)===!0;if(Ke&&Ca(Ke.formMethod)){await Mt(se,be,Be,re,Oe,Ne.active,dt,ce,Ke);return}R.set(se,{routeId:be,path:Be}),await Ct(se,be,Be,re,Oe,Ne.active,dt,ce,Ke)}async function Mt(se,be,je,Ze,dt,gt,oe,re,Ne){W(),R.delete(se);let Be=M.fetchers.get(se);ee(se,OA(Ne,Be),{flushSync:oe});let Ke=new AbortController,ot=wl(e.history,je,Ke.signal,Ne);if(gt){let Et=await Zt(Ze,new URL(ot.url).pathname,ot.signal,se);if(Et.type==="aborted")return;if(Et.type==="error"){te(se,be,Et.error,{flushSync:oe});return}else if(Et.matches)Ze=Et.matches;else{te(se,be,as(404,{pathname:je}),{flushSync:oe});return}}let Oe=hd(Ze,je);if(!Oe.route.action&&!Oe.route.lazy){let Et=as(405,{method:Ne.formMethod,pathname:je,routeId:be});te(se,be,Et,{flushSync:oe});return}D.set(se,Ke);let ce=L,Ue=El(l,c,ot,Ze,Oe,i,dt),ut=(await He(ot,Ue,dt,se))[Oe.route.id];if(ot.signal.aborted){D.get(se)===Ke&&D.delete(se);return}if(G.has(se)){if(Ei(ut)||Ua(ut)){ee(se,er(void 0));return}}else{if(Ei(ut))if(D.delete(se),B>ce){ee(se,er(void 0));return}else return U.add(se),ee(se,Mo(Ne)),At(ot,ut,!1,{fetcherSubmission:Ne,preventScrollReset:re});if(Ua(ut)){te(se,be,ut.error);return}}let ae=M.navigation.location||M.location,Xe=wl(e.history,ae,Ke.signal),$e=m||f,Je=M.navigation.state!=="idle"?Fr($e,M.navigation.location,h):M.matches;sn(Je,"Didn't find any matches after fetcher action");let bt=++L;k.set(se,bt);let St=Mo(Ne,ut.data);M.fetchers.set(se,St);let{dsMatches:_e,revalidatingFetchers:tt}=p0(Xe,dt,l,c,e.history,M,Je,Ne,ae,i,!1,I,F,G,R,U,$e,h,e.patchRoutesOnNavigation!=null,[Oe.route.id,ut]);tt.filter(Et=>Et.key!==se).forEach(Et=>{let jt=Et.key,Wt=M.fetchers.get(jt),ln=Mo(void 0,Wt?Wt.data:void 0);M.fetchers.set(jt,ln),ge(jt),Et.controller&&D.set(jt,Et.controller)}),ne({fetchers:new Map(M.fetchers)});let mt=()=>tt.forEach(Et=>ge(Et.key));Ke.signal.addEventListener("abort",mt);let{loaderResults:fe,fetcherResults:he}=await Qe(_e,tt,Xe,dt);if(Ke.signal.aborted)return;if(Ke.signal.removeEventListener("abort",mt),k.delete(se),D.delete(se),tt.forEach(Et=>D.delete(Et.key)),M.fetchers.has(se)){let Et=er(ut.data);M.fetchers.set(se,Et)}let Ve=$u(fe);if(Ve)return At(Xe,Ve.result,!1,{preventScrollReset:re});if(Ve=$u(he),Ve)return U.add(Ve.key),At(Xe,Ve.result,!1,{preventScrollReset:re});let{loaderData:vt,errors:Nt}=w0(M,Je,fe,void 0,tt,he);nt(bt),M.navigation.state==="loading"&&bt>B?(sn(A,"Expected pending action"),P&&P.abort(),we(M.navigation.location,{matches:Je,loaderData:vt,errors:Nt,fetchers:new Map(M.fetchers)})):(ne({errors:Nt,loaderData:N0(M.loaderData,vt,Je,Nt),fetchers:new Map(M.fetchers)}),I=!1)}async function Ct(se,be,je,Ze,dt,gt,oe,re,Ne){let Be=M.fetchers.get(se);ee(se,Mo(Ne,Be?Be.data:void 0),{flushSync:oe});let Ke=new AbortController,ot=wl(e.history,je,Ke.signal);if(gt){let ae=await Zt(Ze,new URL(ot.url).pathname,ot.signal,se);if(ae.type==="aborted")return;if(ae.type==="error"){te(se,be,ae.error,{flushSync:oe});return}else if(ae.matches)Ze=ae.matches;else{te(se,be,as(404,{pathname:je}),{flushSync:oe});return}}let Oe=hd(Ze,je);D.set(se,Ke);let ce=L,Ue=El(l,c,ot,Ze,Oe,i,dt),ut=(await He(ot,Ue,dt,se))[Oe.route.id];if(D.get(se)===Ke&&D.delete(se),!ot.signal.aborted){if(G.has(se)){ee(se,er(void 0));return}if(Ei(ut))if(B>ce){ee(se,er(void 0));return}else{U.add(se),await At(ot,ut,!1,{preventScrollReset:re});return}if(Ua(ut)){te(se,be,ut.error);return}ee(se,er(ut.data))}}async function At(se,be,je,{submission:Ze,fetcherSubmission:dt,preventScrollReset:gt,replace:oe}={}){be.response.headers.has("X-Remix-Revalidate")&&(I=!0);let re=be.response.headers.get("Location");sn(re,"Expected a Location header on the redirect Response"),re=x0(re,new URL(se.url),h);let Ne=ac(M.location,re,{_isRedirect:!0});if(r){let Ue=!1;if(be.response.headers.has("X-Remix-Reload-Document"))Ue=!0;else if(jy(re)){const Ge=Gw(re,!0);Ue=Ge.origin!==t.location.origin||Ma(Ge.pathname,h)==null}if(Ue){oe?t.location.replace(re):t.location.assign(re);return}}P=null;let Be=oe===!0||be.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:Ke,formAction:ot,formEncType:Oe}=M.navigation;!Ze&&!dt&&Ke&&ot&&Oe&&(Ze=_0(M.navigation));let ce=Ze||dt;if(mA.has(be.response.status)&&ce&&Ca(ce.formMethod))await Ce(Be,Ne,{submission:{...ce,formAction:re},preventScrollReset:gt||z,enableViewTransition:je?X:void 0});else{let Ue=Lh(Ne,Ze);await Ce(Be,Ne,{overrideNavigation:Ue,fetcherSubmission:dt,preventScrollReset:gt||z,enableViewTransition:je?X:void 0})}}async function He(se,be,je,Ze){let dt,gt={};try{dt=await EA(p,se,be,Ze,je,!1)}catch(oe){return be.filter(re=>re.shouldLoad).forEach(re=>{gt[re.route.id]={type:"error",error:oe}}),gt}if(se.signal.aborted)return gt;for(let[oe,re]of Object.entries(dt))if(DA(re)){let Ne=re.result;gt[oe]={type:"redirect",response:AA(Ne,se,oe,be,h)}}else gt[oe]=await CA(re);return gt}async function Qe(se,be,je,Ze){let dt=He(je,se,Ze,null),gt=Promise.all(be.map(async Ne=>{if(Ne.matches&&Ne.match&&Ne.request&&Ne.controller){let Ke=(await He(Ne.request,Ne.matches,Ze,Ne.key))[Ne.match.route.id];return{[Ne.key]:Ke}}else return Promise.resolve({[Ne.key]:{type:"error",error:as(404,{pathname:Ne.path})}})})),oe=await dt,re=(await gt).reduce((Ne,Be)=>Object.assign(Ne,Be),{});return{loaderResults:oe,fetcherResults:re}}function W(){I=!0,R.forEach((se,be)=>{D.has(be)&&F.add(be),ge(be)})}function ee(se,be,je={}){M.fetchers.set(se,be),ne({fetchers:new Map(M.fetchers)},{flushSync:(je&&je.flushSync)===!0})}function te(se,be,je,Ze={}){let dt=Br(M.matches,be);Se(se),ne({errors:{[dt.route.id]:je},fetchers:new Map(M.fetchers)},{flushSync:(Ze&&Ze.flushSync)===!0})}function ve(se){return q.set(se,(q.get(se)||0)+1),G.has(se)&&G.delete(se),M.fetchers.get(se)||hA}function le(se,be){ge(se,be?.reason),ee(se,er(null))}function Se(se){let be=M.fetchers.get(se);D.has(se)&&!(be&&be.state==="loading"&&k.has(se))&&ge(se),R.delete(se),k.delete(se),U.delete(se),G.delete(se),F.delete(se),M.fetchers.delete(se)}function Ee(se){let be=(q.get(se)||0)-1;be<=0?(q.delete(se),G.add(se)):q.set(se,be),ne({fetchers:new Map(M.fetchers)})}function ge(se,be){let je=D.get(se);je&&(je.abort(be),D.delete(se))}function at(se){for(let be of se){let je=ve(be),Ze=er(je.data);M.fetchers.set(be,Ze)}}function st(){let se=[],be=!1;for(let je of U){let Ze=M.fetchers.get(je);sn(Ze,`Expected fetcher: ${je}`),Ze.state==="loading"&&(U.delete(je),se.push(je),be=!0)}return at(se),be}function nt(se){let be=[];for(let[je,Ze]of k)if(Ze<se){let dt=M.fetchers.get(je);sn(dt,`Expected fetcher: ${je}`),dt.state==="loading"&&(ge(je),k.delete(je),be.push(je))}return at(be),be.length>0}function ze(se,be){let je=M.blockers.get(se)||wi;return J.get(se)!==be&&J.set(se,be),je}function ft(se){M.blockers.delete(se),J.delete(se)}function zt(se,be){let je=M.blockers.get(se)||wi;sn(je.state==="unblocked"&&be.state==="blocked"||je.state==="blocked"&&be.state==="blocked"||je.state==="blocked"&&be.state==="proceeding"||je.state==="blocked"&&be.state==="unblocked"||je.state==="proceeding"&&be.state==="unblocked",`Invalid blocker state transition: ${je.state} -> ${be.state}`);let Ze=new Map(M.blockers);Ze.set(se,be),ne({blockers:Ze})}function Rt({currentLocation:se,nextLocation:be,historyAction:je}){if(J.size===0)return;J.size>1&&Yn(!1,"A router only supports one blocker at a time");let Ze=Array.from(J.entries()),[dt,gt]=Ze[Ze.length-1],oe=M.blockers.get(dt);if(!(oe&&oe.state==="proceeding")&&gt({currentLocation:se,nextLocation:be,historyAction:je}))return dt}function pt(se){let be=as(404,{pathname:se}),je=m||f,{matches:Ze,route:dt}=zu(je);return{notFoundMatches:Ze,route:dt,error:be}}function ct(se,be,je){if(S=se,N=be,w=je||null,!j&&M.navigation===Ih){j=!0;let Ze=Ft(M.location,M.matches);Ze!=null&&ne({restoreScrollPosition:Ze})}return()=>{S=null,N=null,w=null}}function yt(se,be){return w&&w(se,be.map(Ze=>PC(Ze,M.loaderData)))||se.key}function Tt(se,be){if(S&&N){let je=yt(se,be);S[je]=N()}}function Ft(se,be){if(S){let je=yt(se,be),Ze=S[je];if(typeof Ze=="number")return Ze}return null}function kt(se,be,je){if(e.patchRoutesOnNavigation)if(se){if(Object.keys(se[0].params).length>0)return{active:!0,matches:md(be,je,h,!0)}}else return{active:!0,matches:md(be,je,h,!0)||[]};return{active:!1,matches:null}}async function Zt(se,be,je,Ze){if(!e.patchRoutesOnNavigation)return{type:"success",matches:se};let dt=se;for(;;){let gt=m==null,oe=m||f,re=c;try{await e.patchRoutesOnNavigation({signal:je,path:be,matches:dt,fetcherKey:Ze,patch:(Ke,ot)=>{je.aborted||y0(Ke,ot,oe,re,l,!1)}})}catch(Ke){return{type:"error",error:Ke,partialMatches:dt}}finally{gt&&!je.aborted&&(f=[...f])}if(je.aborted)return{type:"aborted"};let Ne=Fr(oe,be,h);if(Ne)return{type:"success",matches:Ne};let Be=md(oe,be,h,!0);if(!Be||dt.length===Be.length&&dt.every((Ke,ot)=>Ke.route.id===Be[ot].route.id))return{type:"success",matches:null};dt=Be}}function Lt(se){c={},m=sc(se,l,void 0,c)}function Kt(se,be,je=!1){let Ze=m==null;y0(se,be,m||f,c,l,je),Ze&&(f=[...f],ne({}))}return T={get basename(){return h},get future(){return y},get state(){return M},get routes(){return f},get window(){return t},initialize:me,subscribe:ue,enableScrollRestoration:ct,navigate:Pe,fetch:xt,revalidate:Re,createHref:se=>e.history.createHref(se),encodeLocation:se=>e.history.encodeLocation(se),getFetcher:ve,resetFetcher:le,deleteFetcher:Ee,dispose:Q,getBlocker:ze,deleteBlocker:ft,patchRoutes:Kt,_internalFetchControllers:D,_internalSetRoutes:Lt,_internalSetStateDoNotUseOrYouWillBreakYourApp(se){ne(se)}},T}function bA(e){return e!=null&&("formData"in e&&e.formData!=null||"body"in e&&e.body!==void 0)}function Op(e,t,r,i,l,c){let f,m;if(l){f=[];for(let p of t)if(f.push(p),p.route.id===l){m=p;break}}else f=t,m=t[t.length-1];let h=Xd(i||".",Gd(f),Ma(e.pathname,r)||e.pathname,c==="path");if(i==null&&(h.search=e.search,h.hash=e.hash),(i==null||i===""||i===".")&&m){let p=Cy(h.search);if(m.route.index&&!p)h.search=h.search?h.search.replace(/^\?/,"?index&"):"?index";else if(!m.route.index&&p){let y=new URLSearchParams(h.search),g=y.getAll("index");y.delete("index"),g.filter(S=>S).forEach(S=>y.append("index",S));let v=y.toString();h.search=v?`?${v}`:""}}return r!=="/"&&(h.pathname=aA({basename:r,pathname:h.pathname})),Vr(h)}function h0(e,t,r){if(!r||!bA(r))return{path:t};if(r.formMethod&&!IA(r.formMethod))return{path:t,error:as(405,{method:r.formMethod})};let i=()=>({path:t,error:as(400,{type:"invalid-body"})}),c=(r.formMethod||"get").toUpperCase(),f=r1(t);if(r.body!==void 0){if(r.formEncType==="text/plain"){if(!Ca(c))return i();let g=typeof r.body=="string"?r.body:r.body instanceof FormData||r.body instanceof URLSearchParams?Array.from(r.body.entries()).reduce((v,[S,w])=>`${v}${S}=${w}
`,""):String(r.body);return{path:t,submission:{formMethod:c,formAction:f,formEncType:r.formEncType,formData:void 0,json:void 0,text:g}}}else if(r.formEncType==="application/json"){if(!Ca(c))return i();try{let g=typeof r.body=="string"?JSON.parse(r.body):r.body;return{path:t,submission:{formMethod:c,formAction:f,formEncType:r.formEncType,formData:void 0,json:g,text:void 0}}}catch{return i()}}}sn(typeof FormData=="function","FormData is not available in this environment");let m,h;if(r.formData)m=Fp(r.formData),h=r.formData;else if(r.body instanceof FormData)m=Fp(r.body),h=r.body;else if(r.body instanceof URLSearchParams)m=r.body,h=S0(m);else if(r.body==null)m=new URLSearchParams,h=new FormData;else try{m=new URLSearchParams(r.body),h=S0(m)}catch{return i()}let p={formMethod:c,formAction:f,formEncType:r&&r.formEncType||"application/x-www-form-urlencoded",formData:h,json:void 0,text:void 0};if(Ca(p.formMethod))return{path:t,submission:p};let y=Wr(t);return e&&y.search&&Cy(y.search)&&m.append("index",""),y.search=`?${m}`,{path:Vr(y),submission:p}}function p0(e,t,r,i,l,c,f,m,h,p,y,g,v,S,w,N,j,_,C,O){let E=O?Ua(O[1])?O[1].error:O[1].data:void 0,T=l.createURL(c.location),M=l.createURL(h),A;if(y&&c.errors){let V=Object.keys(c.errors)[0];A=f.findIndex(I=>I.route.id===V)}else if(O&&Ua(O[1])){let V=O[0];A=f.findIndex(I=>I.route.id===V)-1}let z=O?O[1].statusCode:void 0,P=z&&z>=400,X={currentUrl:T,currentParams:c.matches[0]?.params||{},nextUrl:M,nextParams:f[0].params,...m,actionResult:E,actionStatus:z},H=f.map((V,I)=>{let{route:F}=V,D=null;if(A!=null&&I>A?D=!1:F.lazy?D=!0:_y(F)?y?D=zp(F,c.loaderData,c.errors):vA(c.loaderData,c.matches[I],V)&&(D=!0):D=!1,D!==null)return $p(r,i,e,V,p,t,D);let L=P?!1:g||T.pathname+T.search===M.pathname+M.search||T.search!==M.search||xA(c.matches[I],V),B={...X,defaultShouldRevalidate:L},k=Td(V,B);return $p(r,i,e,V,p,t,k,B)}),Y=[];return w.forEach((V,I)=>{if(y||!f.some(q=>q.route.id===V.routeId)||S.has(I))return;let F=c.fetchers.get(I),D=F&&F.state!=="idle"&&F.data===void 0,L=Fr(j,V.path,_);if(!L){if(C&&D)return;Y.push({key:I,routeId:V.routeId,path:V.path,matches:null,match:null,request:null,controller:null});return}if(N.has(I))return;let B=hd(L,V.path),k=new AbortController,U=wl(l,V.path,k.signal),R=null;if(v.has(I))v.delete(I),R=El(r,i,U,L,B,p,t);else if(D)g&&(R=El(r,i,U,L,B,p,t));else{let q={...X,defaultShouldRevalidate:P?!1:g};Td(B,q)&&(R=El(r,i,U,L,B,p,t,q))}R&&Y.push({key:I,routeId:V.routeId,path:V.path,matches:R,match:B,request:U,controller:k})}),{dsMatches:H,revalidatingFetchers:Y}}function _y(e){return e.loader!=null||e.middleware!=null&&e.middleware.length>0}function zp(e,t,r){if(e.lazy)return!0;if(!_y(e))return!1;let i=t!=null&&e.id in t,l=r!=null&&r[e.id]!==void 0;return!i&&l?!1:typeof e.loader=="function"&&e.loader.hydrate===!0?!0:!i&&!l}function vA(e,t,r){let i=!t||r.route.id!==t.route.id,l=!e.hasOwnProperty(r.route.id);return i||l}function xA(e,t){let r=e.route.path;return e.pathname!==t.pathname||r!=null&&r.endsWith("*")&&e.params["*"]!==t.params["*"]}function Td(e,t){if(e.route.shouldRevalidate){let r=e.route.shouldRevalidate(t);if(typeof r=="boolean")return r}return t.defaultShouldRevalidate}function y0(e,t,r,i,l,c){let f;if(e){let p=i[e];sn(p,`No route found to patch children into: routeId = ${e}`),p.children||(p.children=[]),f=p.children}else f=r;let m=[],h=[];if(t.forEach(p=>{let y=f.find(g=>e1(p,g));y?h.push({existingRoute:y,newRoute:p}):m.push(p)}),m.length>0){let p=sc(m,l,[e||"_","patch",String(f?.length||"0")],i);f.push(...p)}if(c&&h.length>0)for(let p=0;p<h.length;p++){let{existingRoute:y,newRoute:g}=h[p],v=y,[S]=sc([g],l,[],{},!0);Object.assign(v,{element:S.element?S.element:v.element,errorElement:S.errorElement?S.errorElement:v.errorElement,hydrateFallbackElement:S.hydrateFallbackElement?S.hydrateFallbackElement:v.hydrateFallbackElement})}}function e1(e,t){return"id"in e&&"id"in t&&e.id===t.id?!0:e.index===t.index&&e.path===t.path&&e.caseSensitive===t.caseSensitive?(!e.children||e.children.length===0)&&(!t.children||t.children.length===0)?!0:e.children.every((r,i)=>t.children?.some(l=>e1(r,l))):!1}var g0=new WeakMap,t1=({key:e,route:t,manifest:r,mapRouteProperties:i})=>{let l=r[t.id];if(sn(l,"No route found in manifest"),!l.lazy||typeof l.lazy!="object")return;let c=l.lazy[e];if(!c)return;let f=g0.get(l);f||(f={},g0.set(l,f));let m=f[e];if(m)return m;let h=(async()=>{let p=BC(e),g=l[e]!==void 0&&e!=="hasErrorBoundary";if(p)Yn(!p,"Route property "+e+" is not a supported lazy route property. This property will be ignored."),f[e]=Promise.resolve();else if(g)Yn(!1,`Route "${l.id}" has a static property "${e}" defined. The lazy property will be ignored.`);else{let v=await c();v!=null&&(Object.assign(l,{[e]:v}),Object.assign(l,i(l)))}typeof l.lazy=="object"&&(l.lazy[e]=void 0,Object.values(l.lazy).every(v=>v===void 0)&&(l.lazy=void 0))})();return f[e]=h,h},b0=new WeakMap;function SA(e,t,r,i,l){let c=r[e.id];if(sn(c,"No route found in manifest"),!e.lazy)return{lazyRoutePromise:void 0,lazyHandlerPromise:void 0};if(typeof e.lazy=="function"){let y=b0.get(c);if(y)return{lazyRoutePromise:y,lazyHandlerPromise:y};let g=(async()=>{sn(typeof e.lazy=="function","No lazy route function found");let v=await e.lazy(),S={};for(let w in v){let N=v[w];if(N===void 0)continue;let j=qC(w),C=c[w]!==void 0&&w!=="hasErrorBoundary";j?Yn(!j,"Route property "+w+" is not a supported property to be returned from a lazy route function. This property will be ignored."):C?Yn(!C,`Route "${c.id}" has a static property "${w}" defined but its lazy function is also returning a value for this property. The lazy route property "${w}" will be ignored.`):S[w]=N}Object.assign(c,S),Object.assign(c,{...i(c),lazy:void 0})})();return b0.set(c,g),g.catch(()=>{}),{lazyRoutePromise:g,lazyHandlerPromise:g}}let f=Object.keys(e.lazy),m=[],h;for(let y of f){if(l&&l.includes(y))continue;let g=t1({key:y,route:e,manifest:r,mapRouteProperties:i});g&&(m.push(g),y===t&&(h=g))}let p=m.length>0?Promise.all(m).then(()=>{}):void 0;return p?.catch(()=>{}),h?.catch(()=>{}),{lazyRoutePromise:p,lazyHandlerPromise:h}}async function v0(e){let t=e.matches.filter(l=>l.shouldLoad),r={};return(await Promise.all(t.map(l=>l.resolve()))).forEach((l,c)=>{r[t[c].route.id]=l}),r}async function wA(e){return e.matches.some(t=>t.route.middleware)?n1(e,()=>v0(e)):v0(e)}function n1(e,t){return NA(e,t,i=>i,RA,r);function r(i,l,c){if(c)return Promise.resolve(Object.assign(c.value,{[l]:{type:"error",result:i}}));{let{matches:f}=e,m=Math.min(Math.max(f.findIndex(p=>p.route.id===l),0),Math.max(f.findIndex(p=>p.unstable_shouldCallHandler()),0)),h=Br(f,f[m].route.id).route.id;return Promise.resolve({[h]:{type:"error",result:i}})}}}async function NA(e,t,r,i,l){let{matches:c,request:f,params:m,context:h}=e,p=c.flatMap(g=>g.route.middleware?g.route.middleware.map(v=>[g.route.id,v]):[]);return await a1({request:f,params:m,context:h},p,t,r,i,l)}async function a1(e,t,r,i,l,c,f=0){let{request:m}=e;if(m.signal.aborted)throw m.signal.reason??new Error(`Request aborted: ${m.method} ${m.url}`);let h=t[f];if(!h)return await r();let[p,y]=h,g,v=async()=>{if(g)throw new Error("You may only call `next()` once per middleware");try{return g={value:await a1(e,t,r,i,l,c,f+1)},g.value}catch(S){return g={value:await c(S,p,g)},g.value}};try{let S=await y(e,v),w=S!=null?i(S):void 0;return l(w)?w:g?w??g.value:(g={value:await v()},g.value)}catch(S){return await c(S,p,g)}}function s1(e,t,r,i,l){let c=t1({key:"middleware",route:i.route,manifest:t,mapRouteProperties:e}),f=SA(i.route,Ca(r.method)?"action":"loader",t,e,l);return{middleware:c,route:f.lazyRoutePromise,handler:f.lazyHandlerPromise}}function $p(e,t,r,i,l,c,f,m=null){let h=!1,p=s1(e,t,r,i,l);return{...i,_lazyPromises:p,shouldLoad:f,unstable_shouldRevalidateArgs:m,unstable_shouldCallHandler(y){return h=!0,m?typeof y=="boolean"?Td(i,{...m,defaultShouldRevalidate:y}):Td(i,m):f},resolve(y){let{lazy:g,loader:v,middleware:S}=i.route,w=h||f||y&&!Ca(r.method)&&(g||v),N=S&&S.length>0&&!v&&!g;return w&&!N?jA({request:r,match:i,lazyHandlerPromise:p?.handler,lazyRoutePromise:p?.route,handlerOverride:y,scopedContext:c}):Promise.resolve({type:"data",result:void 0})}}}function El(e,t,r,i,l,c,f,m=null){return i.map(h=>h.route.id!==l.route.id?{...h,shouldLoad:!1,unstable_shouldRevalidateArgs:m,unstable_shouldCallHandler:()=>!1,_lazyPromises:s1(e,t,r,h,c),resolve:()=>Promise.resolve({type:"data",result:void 0})}:$p(e,t,r,h,c,f,!0,m))}async function EA(e,t,r,i,l,c){r.some(p=>p._lazyPromises?.middleware)&&await Promise.all(r.map(p=>p._lazyPromises?.middleware));let f={request:t,params:r[0].params,context:l,matches:r},h=await e({...f,fetcherKey:i,runClientMiddleware:p=>{let y=f;return n1(y,()=>p({...y,fetcherKey:i,runClientMiddleware:()=>{throw new Error("Cannot call `runClientMiddleware()` from within an `runClientMiddleware` handler")}}))}});try{await Promise.all(r.flatMap(p=>[p._lazyPromises?.handler,p._lazyPromises?.route]))}catch{}return h}async function jA({request:e,match:t,lazyHandlerPromise:r,lazyRoutePromise:i,handlerOverride:l,scopedContext:c}){let f,m,h=Ca(e.method),p=h?"action":"loader",y=g=>{let v,S=new Promise((j,_)=>v=_);m=()=>v(),e.signal.addEventListener("abort",m);let w=j=>typeof g!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${p}" [routeId: ${t.route.id}]`)):g({request:e,params:t.params,context:c},...j!==void 0?[j]:[]),N=(async()=>{try{return{type:"data",result:await(l?l(_=>w(_)):w())}}catch(j){return{type:"error",result:j}}})();return Promise.race([N,S])};try{let g=h?t.route.action:t.route.loader;if(r||i)if(g){let v,[S]=await Promise.all([y(g).catch(w=>{v=w}),r,i]);if(v!==void 0)throw v;f=S}else{await r;let v=h?t.route.action:t.route.loader;if(v)[f]=await Promise.all([y(v),i]);else if(p==="action"){let S=new URL(e.url),w=S.pathname+S.search;throw as(405,{method:e.method,pathname:w,routeId:t.route.id})}else return{type:"data",result:void 0}}else if(g)f=await y(g);else{let v=new URL(e.url),S=v.pathname+v.search;throw as(404,{pathname:S})}}catch(g){return{type:"error",result:g}}finally{m&&e.signal.removeEventListener("abort",m)}return f}async function _A(e){let t=e.headers.get("Content-Type");return t&&/\bapplication\/json\b/.test(t)?e.body==null?null:e.json():e.text()}async function CA(e){let{result:t,type:r}=e;if(i1(t)){let i;try{i=await _A(t)}catch(l){return{type:"error",error:l}}return r==="error"?{type:"error",error:new Ad(t.status,t.statusText,i),statusCode:t.status,headers:t.headers}:{type:"data",data:i,statusCode:t.status,headers:t.headers}}return r==="error"?j0(t)?t.data instanceof Error?{type:"error",error:t.data,statusCode:t.init?.status,headers:t.init?.headers?new Headers(t.init.headers):void 0}:{type:"error",error:new Ad(t.init?.status||500,void 0,t.data),statusCode:rc(t)?t.status:void 0,headers:t.init?.headers?new Headers(t.init.headers):void 0}:{type:"error",error:t,statusCode:rc(t)?t.status:void 0}:j0(t)?{type:"data",data:t.data,statusCode:t.init?.status,headers:t.init?.headers?new Headers(t.init.headers):void 0}:{type:"data",data:t}}function AA(e,t,r,i,l){let c=e.headers.get("Location");if(sn(c,"Redirects returned/thrown from loaders/actions must have a Location header"),!jy(c)){let f=i.slice(0,i.findIndex(m=>m.route.id===r)+1);c=Op(new URL(t.url),f,l,c),e.headers.set("Location",c)}return e}function x0(e,t,r){if(jy(e)){let i=e,l=i.startsWith("//")?new URL(t.protocol+i):new URL(i),c=Ma(l.pathname,r)!=null;if(l.origin===t.origin&&c)return l.pathname+l.search+l.hash}return e}function wl(e,t,r,i){let l=e.createURL(r1(t)).toString(),c={signal:r};if(i&&Ca(i.formMethod)){let{formMethod:f,formEncType:m}=i;c.method=f.toUpperCase(),m==="application/json"?(c.headers=new Headers({"Content-Type":m}),c.body=JSON.stringify(i.json)):m==="text/plain"?c.body=i.text:m==="application/x-www-form-urlencoded"&&i.formData?c.body=Fp(i.formData):c.body=i.formData}return new Request(l,c)}function Fp(e){let t=new URLSearchParams;for(let[r,i]of e.entries())t.append(r,typeof i=="string"?i:i.name);return t}function S0(e){let t=new FormData;for(let[r,i]of e.entries())t.append(r,i);return t}function TA(e,t,r,i=!1,l=!1){let c={},f=null,m,h=!1,p={},y=r&&Ua(r[1])?r[1].error:void 0;return e.forEach(g=>{if(!(g.route.id in t))return;let v=g.route.id,S=t[v];if(sn(!Ei(S),"Cannot handle redirect results in processLoaderData"),Ua(S)){let w=S.error;if(y!==void 0&&(w=y,y=void 0),f=f||{},l)f[v]=w;else{let N=Br(e,v);f[N.route.id]==null&&(f[N.route.id]=w)}i||(c[v]=Jw),h||(h=!0,m=rc(S.error)?S.error.status:500),S.headers&&(p[v]=S.headers)}else c[v]=S.data,S.statusCode&&S.statusCode!==200&&!h&&(m=S.statusCode),S.headers&&(p[v]=S.headers)}),y!==void 0&&r&&(f={[r[0]]:y},r[2]&&(c[r[2]]=void 0)),{loaderData:c,errors:f,statusCode:m||200,loaderHeaders:p}}function w0(e,t,r,i,l,c){let{loaderData:f,errors:m}=TA(t,r,i);return l.filter(h=>!h.matches||h.matches.some(p=>p.shouldLoad)).forEach(h=>{let{key:p,match:y,controller:g}=h;if(g&&g.signal.aborted)return;let v=c[p];if(sn(v,"Did not find corresponding fetcher result"),Ua(v)){let S=Br(e.matches,y?.route.id);m&&m[S.route.id]||(m={...m,[S.route.id]:v.error}),e.fetchers.delete(p)}else if(Ei(v))sn(!1,"Unhandled fetcher revalidation redirect");else{let S=er(v.data);e.fetchers.set(p,S)}}),{loaderData:f,errors:m}}function N0(e,t,r,i){let l=Object.entries(t).filter(([,c])=>c!==Jw).reduce((c,[f,m])=>(c[f]=m,c),{});for(let c of r){let f=c.route.id;if(!t.hasOwnProperty(f)&&e.hasOwnProperty(f)&&c.route.loader&&(l[f]=e[f]),i&&i.hasOwnProperty(f))break}return l}function E0(e){return e?Ua(e[1])?{actionData:{}}:{actionData:{[e[0]]:e[1].data}}:{}}function Br(e,t){return(t?e.slice(0,e.findIndex(i=>i.route.id===t)+1):[...e]).reverse().find(i=>i.route.hasErrorBoundary===!0)||e[0]}function zu(e){let t=e.length===1?e[0]:e.find(r=>r.index||!r.path||r.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:t}],route:t}}function as(e,{pathname:t,routeId:r,method:i,type:l,message:c}={}){let f="Unknown Server Error",m="Unknown @remix-run/router error";return e===400?(f="Bad Request",i&&t&&r?m=`You made a ${i} request to "${t}" but did not provide a \`loader\` for route "${r}", so there is no way to handle the request.`:l==="invalid-body"&&(m="Unable to encode submission body")):e===403?(f="Forbidden",m=`Route "${r}" does not match URL "${t}"`):e===404?(f="Not Found",m=`No route matches URL "${t}"`):e===405&&(f="Method Not Allowed",i&&t&&r?m=`You made a ${i.toUpperCase()} request to "${t}" but did not provide an \`action\` for route "${r}", so there is no way to handle the request.`:i&&(m=`Invalid request method "${i.toUpperCase()}"`)),new Ad(e||500,f,new Error(m),!0)}function $u(e){let t=Object.entries(e);for(let r=t.length-1;r>=0;r--){let[i,l]=t[r];if(Ei(l))return{key:i,result:l}}}function r1(e){let t=typeof e=="string"?Wr(e):e;return Vr({...t,hash:""})}function MA(e,t){return e.pathname!==t.pathname||e.search!==t.search?!1:e.hash===""?t.hash!=="":e.hash===t.hash?!0:t.hash!==""}function RA(e){return e!=null&&typeof e=="object"&&Object.entries(e).every(([t,r])=>typeof t=="string"&&kA(r))}function kA(e){return e!=null&&typeof e=="object"&&"type"in e&&"result"in e&&(e.type==="data"||e.type==="error")}function DA(e){return i1(e.result)&&fA.has(e.result.status)}function Ua(e){return e.type==="error"}function Ei(e){return(e&&e.type)==="redirect"}function j0(e){return typeof e=="object"&&e!=null&&"type"in e&&"data"in e&&"init"in e&&e.type==="DataWithResponseInit"}function i1(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.headers=="object"&&typeof e.body<"u"}function IA(e){return dA.has(e.toUpperCase())}function Ca(e){return cA.has(e.toUpperCase())}function Cy(e){return new URLSearchParams(e).getAll("index").some(t=>t==="")}function hd(e,t){let r=typeof t=="string"?Wr(t).search:t.search;if(e[e.length-1].route.index&&Cy(r||""))return e[e.length-1];let i=Ww(e);return i[i.length-1]}function _0(e){let{formMethod:t,formAction:r,formEncType:i,text:l,formData:c,json:f}=e;if(!(!t||!r||!i)){if(l!=null)return{formMethod:t,formAction:r,formEncType:i,formData:void 0,json:void 0,text:l};if(c!=null)return{formMethod:t,formAction:r,formEncType:i,formData:c,json:void 0,text:void 0};if(f!==void 0)return{formMethod:t,formAction:r,formEncType:i,formData:void 0,json:f,text:void 0}}}function Lh(e,t){return t?{state:"loading",location:e,formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text}:{state:"loading",location:e,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function LA(e,t){return{state:"submitting",location:e,formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text}}function Mo(e,t){return e?{state:"loading",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:t}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function OA(e,t){return{state:"submitting",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:t?t.data:void 0}}function er(e){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function zA(e,t){try{let r=e.sessionStorage.getItem(Qw);if(r){let i=JSON.parse(r);for(let[l,c]of Object.entries(i||{}))c&&Array.isArray(c)&&t.set(l,new Set(c||[]))}}catch{}}function $A(e,t){if(t.size>0){let r={};for(let[i,l]of t)r[i]=[...l];try{e.sessionStorage.setItem(Qw,JSON.stringify(r))}catch(i){Yn(!1,`Failed to save applied view transitions in sessionStorage (${i}).`)}}}function FA(){let e,t,r=new Promise((i,l)=>{e=async c=>{i(c);try{await r}catch{}},t=async c=>{l(c);try{await r}catch{}}});return{promise:r,resolve:e,reject:t}}var Di=u.createContext(null);Di.displayName="DataRouter";var Ec=u.createContext(null);Ec.displayName="DataRouterState";u.createContext(!1);var Ay=u.createContext({isTransitioning:!1});Ay.displayName="ViewTransition";var l1=u.createContext(new Map);l1.displayName="Fetchers";var BA=u.createContext(null);BA.displayName="Await";var bs=u.createContext(null);bs.displayName="Navigation";var Kd=u.createContext(null);Kd.displayName="Location";var ls=u.createContext({outlet:null,matches:[],isDataRoute:!1});ls.displayName="Route";var Ty=u.createContext(null);Ty.displayName="RouteError";function UA(e,{relative:t}={}){sn(Ol(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:i}=u.useContext(bs),{hash:l,pathname:c,search:f}=jc(e,{relative:t}),m=c;return r!=="/"&&(m=c==="/"?r:Ms([r,c])),i.createHref({pathname:m,search:f,hash:l})}function Ol(){return u.useContext(Kd)!=null}function Ya(){return sn(Ol(),"useLocation() may be used only in the context of a <Router> component."),u.useContext(Kd).location}var o1="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function c1(e){u.useContext(bs).static||u.useLayoutEffect(e)}function zn(){let{isDataRoute:e}=u.useContext(ls);return e?t2():qA()}function qA(){sn(Ol(),"useNavigate() may be used only in the context of a <Router> component.");let e=u.useContext(Di),{basename:t,navigator:r}=u.useContext(bs),{matches:i}=u.useContext(ls),{pathname:l}=Ya(),c=JSON.stringify(Gd(i)),f=u.useRef(!1);return c1(()=>{f.current=!0}),u.useCallback((h,p={})=>{if(Yn(f.current,o1),!f.current)return;if(typeof h=="number"){r.go(h);return}let y=Xd(h,JSON.parse(c),l,p.relative==="path");e==null&&t!=="/"&&(y.pathname=y.pathname==="/"?t:Ms([t,y.pathname])),(p.replace?r.replace:r.push)(y,p.state,p)},[t,r,c,l,e])}var HA=u.createContext(null);function PA(e){let t=u.useContext(ls).outlet;return u.useMemo(()=>t&&u.createElement(HA.Provider,{value:e},t),[t,e])}function vs(){let{matches:e}=u.useContext(ls),t=e[e.length-1];return t?t.params:{}}function jc(e,{relative:t}={}){let{matches:r}=u.useContext(ls),{pathname:i}=Ya(),l=JSON.stringify(Gd(r));return u.useMemo(()=>Xd(e,JSON.parse(l),i,t==="path"),[e,l,i,t])}function VA(e,t,r,i,l){sn(Ol(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:c}=u.useContext(bs),{matches:f}=u.useContext(ls),m=f[f.length-1],h=m?m.params:{},p=m?m.pathname:"/",y=m?m.pathnameBase:"/",g=m&&m.route;{let C=g&&g.path||"";m1(p,!g||C.endsWith("*")||C.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${p}" (under <Route path="${C}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${C}"> to <Route path="${C==="/"?"*":`${C}/*`}">.`)}let v=Ya(),S;S=v;let w=S.pathname||"/",N=w;if(y!=="/"){let C=y.replace(/^\//,"").split("/");N="/"+w.replace(/^\//,"").split("/").slice(C.length).join("/")}let j=Fr(e,{pathname:N});return Yn(g||j!=null,`No routes matched location "${S.pathname}${S.search}${S.hash}" `),Yn(j==null||j[j.length-1].route.element!==void 0||j[j.length-1].route.Component!==void 0||j[j.length-1].route.lazy!==void 0,`Matched leaf route at location "${S.pathname}${S.search}${S.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),WA(j&&j.map(C=>Object.assign({},C,{params:Object.assign({},h,C.params),pathname:Ms([y,c.encodeLocation?c.encodeLocation(C.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:C.pathname]),pathnameBase:C.pathnameBase==="/"?y:Ms([y,c.encodeLocation?c.encodeLocation(C.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:C.pathnameBase])})),f,r,i,l)}function YA(){let e=JA(),t=rc(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",l={padding:"0.5rem",backgroundColor:i},c={padding:"2px 4px",backgroundColor:i},f=null;return console.error("Error handled by React Router default ErrorBoundary:",e),f=u.createElement(u.Fragment,null,u.createElement("p",null," Hey developer "),u.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",u.createElement("code",{style:c},"ErrorBoundary")," or"," ",u.createElement("code",{style:c},"errorElement")," prop on your route.")),u.createElement(u.Fragment,null,u.createElement("h2",null,"Unexpected Application Error!"),u.createElement("h3",{style:{fontStyle:"italic"}},t),r?u.createElement("pre",{style:l},r):null,f)}var GA=u.createElement(YA,null),XA=class extends u.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.unstable_onError?this.props.unstable_onError(e,t):console.error("React Router caught the following error during render",e)}render(){return this.state.error!==void 0?u.createElement(ls.Provider,{value:this.props.routeContext},u.createElement(Ty.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function KA({routeContext:e,match:t,children:r}){let i=u.useContext(Di);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),u.createElement(ls.Provider,{value:e},r)}function WA(e,t=[],r=null,i=null,l=null){if(e==null){if(!r)return null;if(r.errors)e=r.matches;else if(t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let c=e,f=r?.errors;if(f!=null){let p=c.findIndex(y=>y.route.id&&f?.[y.route.id]!==void 0);sn(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(f).join(",")}`),c=c.slice(0,Math.min(c.length,p+1))}let m=!1,h=-1;if(r)for(let p=0;p<c.length;p++){let y=c[p];if((y.route.HydrateFallback||y.route.hydrateFallbackElement)&&(h=p),y.route.id){let{loaderData:g,errors:v}=r,S=y.route.loader&&!g.hasOwnProperty(y.route.id)&&(!v||v[y.route.id]===void 0);if(y.route.lazy||S){m=!0,h>=0?c=c.slice(0,h+1):c=[c[0]];break}}}return c.reduceRight((p,y,g)=>{let v,S=!1,w=null,N=null;r&&(v=f&&y.route.id?f[y.route.id]:void 0,w=y.route.errorElement||GA,m&&(h<0&&g===0?(m1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),S=!0,N=null):h===g&&(S=!0,N=y.route.hydrateFallbackElement||null)));let j=t.concat(c.slice(0,g+1)),_=()=>{let C;return v?C=w:S?C=N:y.route.Component?C=u.createElement(y.route.Component,null):y.route.element?C=y.route.element:C=p,u.createElement(KA,{match:y,routeContext:{outlet:p,matches:j,isDataRoute:r!=null},children:C})};return r&&(y.route.ErrorBoundary||y.route.errorElement||g===0)?u.createElement(XA,{location:r.location,revalidation:r.revalidation,component:w,error:v,children:_(),routeContext:{outlet:null,matches:j,isDataRoute:!0},unstable_onError:i}):_()},null)}function My(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function u1(e){let t=u.useContext(Di);return sn(t,My(e)),t}function d1(e){let t=u.useContext(Ec);return sn(t,My(e)),t}function ZA(e){let t=u.useContext(ls);return sn(t,My(e)),t}function Ry(e){let t=ZA(e),r=t.matches[t.matches.length-1];return sn(r.route.id,`${e} can only be used on routes that contain a unique "id"`),r.route.id}function QA(){return Ry("useRouteId")}function JA(){let e=u.useContext(Ty),t=d1("useRouteError"),r=Ry("useRouteError");return e!==void 0?e:t.errors?.[r]}var e2=0;function f1(e){let{router:t,basename:r}=u1("useBlocker"),i=d1("useBlocker"),[l,c]=u.useState(""),f=u.useCallback(m=>{if(typeof e!="function")return!!e;if(r==="/")return e(m);let{currentLocation:h,nextLocation:p,historyAction:y}=m;return e({currentLocation:{...h,pathname:Ma(h.pathname,r)||h.pathname},nextLocation:{...p,pathname:Ma(p.pathname,r)||p.pathname},historyAction:y})},[r,e]);return u.useEffect(()=>{let m=String(++e2);return c(m),()=>t.deleteBlocker(m)},[t]),u.useEffect(()=>{l!==""&&t.getBlocker(l,f)},[t,l,f]),l&&i.blockers.has(l)?i.blockers.get(l):wi}function t2(){let{router:e}=u1("useNavigate"),t=Ry("useNavigate"),r=u.useRef(!1);return c1(()=>{r.current=!0}),u.useCallback(async(l,c={})=>{Yn(r.current,o1),r.current&&(typeof l=="number"?e.navigate(l):await e.navigate(l,{fromRouteId:t,...c}))},[e,t])}var C0={};function m1(e,t,r){!t&&!C0[e]&&(C0[e]=!0,Yn(!1,r))}var A0={};function T0(e,t){!e&&!A0[t]&&(A0[t]=!0,console.warn(t))}function n2(e){let t={hasErrorBoundary:e.hasErrorBoundary||e.ErrorBoundary!=null||e.errorElement!=null};return e.Component&&(e.element&&Yn(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(t,{element:u.createElement(e.Component),Component:void 0})),e.HydrateFallback&&(e.hydrateFallbackElement&&Yn(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(t,{hydrateFallbackElement:u.createElement(e.HydrateFallback),HydrateFallback:void 0})),e.ErrorBoundary&&(e.errorElement&&Yn(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(t,{errorElement:u.createElement(e.ErrorBoundary),ErrorBoundary:void 0})),t}var a2=["HydrateFallback","hydrateFallbackElement"],s2=class{constructor(){this.status="pending",this.promise=new Promise((e,t)=>{this.resolve=r=>{this.status==="pending"&&(this.status="resolved",e(r))},this.reject=r=>{this.status==="pending"&&(this.status="rejected",t(r))}})}};function r2({router:e,flushSync:t,unstable_onError:r}){let[i,l]=u.useState(e.state),[c,f]=u.useState(),[m,h]=u.useState({isTransitioning:!1}),[p,y]=u.useState(),[g,v]=u.useState(),[S,w]=u.useState(),N=u.useRef(new Map),j=u.useCallback(T=>{l(M=>(T.errors&&r&&Object.entries(T.errors).forEach(([A,z])=>{M.errors?.[A]!==z&&r(z)}),T))},[r]),_=u.useCallback((T,{deletedFetchers:M,flushSync:A,viewTransitionOpts:z})=>{T.fetchers.forEach((X,H)=>{X.data!==void 0&&N.current.set(H,X.data)}),M.forEach(X=>N.current.delete(X)),T0(A===!1||t!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let P=e.window!=null&&e.window.document!=null&&typeof e.window.document.startViewTransition=="function";if(T0(z==null||P,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!z||!P){t&&A?t(()=>j(T)):u.startTransition(()=>j(T));return}if(t&&A){t(()=>{g&&(p&&p.resolve(),g.skipTransition()),h({isTransitioning:!0,flushSync:!0,currentLocation:z.currentLocation,nextLocation:z.nextLocation})});let X=e.window.document.startViewTransition(()=>{t(()=>j(T))});X.finished.finally(()=>{t(()=>{y(void 0),v(void 0),f(void 0),h({isTransitioning:!1})})}),t(()=>v(X));return}g?(p&&p.resolve(),g.skipTransition(),w({state:T,currentLocation:z.currentLocation,nextLocation:z.nextLocation})):(f(T),h({isTransitioning:!0,flushSync:!1,currentLocation:z.currentLocation,nextLocation:z.nextLocation}))},[e.window,t,g,p,j]);u.useLayoutEffect(()=>e.subscribe(_),[e,_]),u.useEffect(()=>{m.isTransitioning&&!m.flushSync&&y(new s2)},[m]),u.useEffect(()=>{if(p&&c&&e.window){let T=c,M=p.promise,A=e.window.document.startViewTransition(async()=>{u.startTransition(()=>j(T)),await M});A.finished.finally(()=>{y(void 0),v(void 0),f(void 0),h({isTransitioning:!1})}),v(A)}},[c,p,e.window,j]),u.useEffect(()=>{p&&c&&i.location.key===c.location.key&&p.resolve()},[p,g,i.location,c]),u.useEffect(()=>{!m.isTransitioning&&S&&(f(S.state),h({isTransitioning:!0,flushSync:!1,currentLocation:S.currentLocation,nextLocation:S.nextLocation}),w(void 0))},[m.isTransitioning,S]);let C=u.useMemo(()=>({createHref:e.createHref,encodeLocation:e.encodeLocation,go:T=>e.navigate(T),push:(T,M,A)=>e.navigate(T,{state:M,preventScrollReset:A?.preventScrollReset}),replace:(T,M,A)=>e.navigate(T,{replace:!0,state:M,preventScrollReset:A?.preventScrollReset})}),[e]),O=e.basename||"/",E=u.useMemo(()=>({router:e,navigator:C,static:!1,basename:O,unstable_onError:r}),[e,C,O,r]);return u.createElement(u.Fragment,null,u.createElement(Di.Provider,{value:E},u.createElement(Ec.Provider,{value:i},u.createElement(l1.Provider,{value:N.current},u.createElement(Ay.Provider,{value:m},u.createElement(c2,{basename:O,location:i.location,navigationType:i.historyAction,navigator:C},u.createElement(i2,{routes:e.routes,future:e.future,state:i,unstable_onError:r})))))),null)}var i2=u.memo(l2);function l2({routes:e,future:t,state:r,unstable_onError:i}){return VA(e,void 0,r,i,t)}function Xo({to:e,replace:t,state:r,relative:i}){sn(Ol(),"<Navigate> may be used only in the context of a <Router> component.");let{static:l}=u.useContext(bs);Yn(!l,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:c}=u.useContext(ls),{pathname:f}=Ya(),m=zn(),h=Xd(e,Gd(c),f,i==="path"),p=JSON.stringify(h);return u.useEffect(()=>{m(JSON.parse(p),{replace:t,state:r,relative:i})},[m,p,i,t,r]),null}function o2(e){return PA(e.context)}function Yt(e){sn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function c2({basename:e="/",children:t=null,location:r,navigationType:i="POP",navigator:l,static:c=!1}){sn(!Ol(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let f=e.replace(/^\/*/,"/"),m=u.useMemo(()=>({basename:f,navigator:l,static:c,future:{}}),[f,l,c]);typeof r=="string"&&(r=Wr(r));let{pathname:h="/",search:p="",hash:y="",state:g=null,key:v="default"}=r,S=u.useMemo(()=>{let w=Ma(h,f);return w==null?null:{location:{pathname:w,search:p,hash:y,state:g,key:v},navigationType:i}},[f,h,p,y,g,v,i]);return Yn(S!=null,`<Router basename="${f}"> is not able to match the URL "${h}${p}${y}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:u.createElement(bs.Provider,{value:m},u.createElement(Kd.Provider,{children:t,value:S}))}function Bp(e,t=[]){let r=[];return u.Children.forEach(e,(i,l)=>{if(!u.isValidElement(i))return;let c=[...t,l];if(i.type===u.Fragment){r.push.apply(r,Bp(i.props.children,c));return}sn(i.type===Yt,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),sn(!i.props.index||!i.props.children,"An index route cannot have child routes.");let f={id:i.props.id||c.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(f.children=Bp(i.props.children,c)),r.push(f)}),r}var u2=Bp,pd="get",yd="application/x-www-form-urlencoded";function Wd(e){return e!=null&&typeof e.tagName=="string"}function d2(e){return Wd(e)&&e.tagName.toLowerCase()==="button"}function f2(e){return Wd(e)&&e.tagName.toLowerCase()==="form"}function m2(e){return Wd(e)&&e.tagName.toLowerCase()==="input"}function h2(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function p2(e,t){return e.button===0&&(!t||t==="_self")&&!h2(e)}function Up(e=""){return new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let i=e[r];return t.concat(Array.isArray(i)?i.map(l=>[r,l]):[[r,i]])},[]))}function y2(e,t){let r=Up(e);return t&&t.forEach((i,l)=>{r.has(l)||t.getAll(l).forEach(c=>{r.append(l,c)})}),r}var Fu=null;function g2(){if(Fu===null)try{new FormData(document.createElement("form"),0),Fu=!1}catch{Fu=!0}return Fu}var b2=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Oh(e){return e!=null&&!b2.has(e)?(Yn(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${yd}"`),null):e}function v2(e,t){let r,i,l,c,f;if(f2(e)){let m=e.getAttribute("action");i=m?Ma(m,t):null,r=e.getAttribute("method")||pd,l=Oh(e.getAttribute("enctype"))||yd,c=new FormData(e)}else if(d2(e)||m2(e)&&(e.type==="submit"||e.type==="image")){let m=e.form;if(m==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=e.getAttribute("formaction")||m.getAttribute("action");if(i=h?Ma(h,t):null,r=e.getAttribute("formmethod")||m.getAttribute("method")||pd,l=Oh(e.getAttribute("formenctype"))||Oh(m.getAttribute("enctype"))||yd,c=new FormData(m,e),!g2()){let{name:p,type:y,value:g}=e;if(y==="image"){let v=p?`${p}.`:"";c.append(`${v}x`,"0"),c.append(`${v}y`,"0")}else p&&c.append(p,g)}}else{if(Wd(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=pd,i=null,l=yd,f=e}return c&&l==="text/plain"&&(f=c,c=void 0),{action:i,method:r.toLowerCase(),encType:l,formData:c,body:f}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function ky(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function x2(e,t,r){let i=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return i.pathname==="/"?i.pathname=`_root.${r}`:t&&Ma(i.pathname,t)==="/"?i.pathname=`${t.replace(/\/$/,"")}/_root.${r}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${r}`,i}async function S2(e,t){if(e.id in t)return t[e.id];try{let r=await import(e.module);return t[e.id]=r,r}catch(r){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function w2(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function N2(e,t,r){let i=await Promise.all(e.map(async l=>{let c=t.routes[l.route.id];if(c){let f=await S2(c,r);return f.links?f.links():[]}return[]}));return C2(i.flat(1).filter(w2).filter(l=>l.rel==="stylesheet"||l.rel==="preload").map(l=>l.rel==="stylesheet"?{...l,rel:"prefetch",as:"style"}:{...l,rel:"prefetch"}))}function M0(e,t,r,i,l,c){let f=(h,p)=>r[p]?h.route.id!==r[p].route.id:!0,m=(h,p)=>r[p].pathname!==h.pathname||r[p].route.path?.endsWith("*")&&r[p].params["*"]!==h.params["*"];return c==="assets"?t.filter((h,p)=>f(h,p)||m(h,p)):c==="data"?t.filter((h,p)=>{let y=i.routes[h.route.id];if(!y||!y.hasLoader)return!1;if(f(h,p)||m(h,p))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(l.pathname+l.search+l.hash,window.origin),currentParams:r[0]?.params||{},nextUrl:new URL(e,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function E2(e,t,{includeHydrateFallback:r}={}){return j2(e.map(i=>{let l=t.routes[i.route.id];if(!l)return[];let c=[l.module];return l.clientActionModule&&(c=c.concat(l.clientActionModule)),l.clientLoaderModule&&(c=c.concat(l.clientLoaderModule)),r&&l.hydrateFallbackModule&&(c=c.concat(l.hydrateFallbackModule)),l.imports&&(c=c.concat(l.imports)),c}).flat(1))}function j2(e){return[...new Set(e)]}function _2(e){let t={},r=Object.keys(e).sort();for(let i of r)t[i]=e[i];return t}function C2(e,t){let r=new Set;return new Set(t),e.reduce((i,l)=>{let c=JSON.stringify(_2(l));return r.has(c)||(r.add(c),i.push({key:c,link:l})),i},[])}function h1(){let e=u.useContext(Di);return ky(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function A2(){let e=u.useContext(Ec);return ky(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var Dy=u.createContext(void 0);Dy.displayName="FrameworkContext";function p1(){let e=u.useContext(Dy);return ky(e,"You must render this element inside a <HydratedRouter> element"),e}function T2(e,t){let r=u.useContext(Dy),[i,l]=u.useState(!1),[c,f]=u.useState(!1),{onFocus:m,onBlur:h,onMouseEnter:p,onMouseLeave:y,onTouchStart:g}=t,v=u.useRef(null);u.useEffect(()=>{if(e==="render"&&f(!0),e==="viewport"){let N=_=>{_.forEach(C=>{f(C.isIntersecting)})},j=new IntersectionObserver(N,{threshold:.5});return v.current&&j.observe(v.current),()=>{j.disconnect()}}},[e]),u.useEffect(()=>{if(i){let N=setTimeout(()=>{f(!0)},100);return()=>{clearTimeout(N)}}},[i]);let S=()=>{l(!0)},w=()=>{l(!1),f(!1)};return r?e!=="intent"?[c,v,{}]:[c,v,{onFocus:Ro(m,S),onBlur:Ro(h,w),onMouseEnter:Ro(p,S),onMouseLeave:Ro(y,w),onTouchStart:Ro(g,S)}]:[!1,v,{}]}function Ro(e,t){return r=>{e&&e(r),r.defaultPrevented||t(r)}}function M2({page:e,...t}){let{router:r}=h1(),i=u.useMemo(()=>Fr(r.routes,e,r.basename),[r.routes,e,r.basename]);return i?u.createElement(k2,{page:e,matches:i,...t}):null}function R2(e){let{manifest:t,routeModules:r}=p1(),[i,l]=u.useState([]);return u.useEffect(()=>{let c=!1;return N2(e,t,r).then(f=>{c||l(f)}),()=>{c=!0}},[e,t,r]),i}function k2({page:e,matches:t,...r}){let i=Ya(),{manifest:l,routeModules:c}=p1(),{basename:f}=h1(),{loaderData:m,matches:h}=A2(),p=u.useMemo(()=>M0(e,t,h,l,i,"data"),[e,t,h,l,i]),y=u.useMemo(()=>M0(e,t,h,l,i,"assets"),[e,t,h,l,i]),g=u.useMemo(()=>{if(e===i.pathname+i.search+i.hash)return[];let w=new Set,N=!1;if(t.forEach(_=>{let C=l.routes[_.route.id];!C||!C.hasLoader||(!p.some(O=>O.route.id===_.route.id)&&_.route.id in m&&c[_.route.id]?.shouldRevalidate||C.hasClientLoader?N=!0:w.add(_.route.id))}),w.size===0)return[];let j=x2(e,f,"data");return N&&w.size>0&&j.searchParams.set("_routes",t.filter(_=>w.has(_.route.id)).map(_=>_.route.id).join(",")),[j.pathname+j.search]},[f,m,i,l,p,t,e,c]),v=u.useMemo(()=>E2(y,l),[y,l]),S=R2(y);return u.createElement(u.Fragment,null,g.map(w=>u.createElement("link",{key:w,rel:"prefetch",as:"fetch",href:w,...r})),v.map(w=>u.createElement("link",{key:w,rel:"modulepreload",href:w,...r})),S.map(({key:w,link:N})=>u.createElement("link",{key:w,nonce:r.nonce,...N})))}function D2(...e){return t=>{e.forEach(r=>{typeof r=="function"?r(t):r!=null&&(r.current=t)})}}var y1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{y1&&(window.__reactRouterVersion="7.9.3")}catch{}function I2(e,t){return gA({basename:t?.basename,getContext:t?.getContext,future:t?.future,history:OC({window:t?.window}),hydrationData:L2(),routes:e,mapRouteProperties:n2,hydrationRouteProperties:a2,dataStrategy:t?.dataStrategy,patchRoutesOnNavigation:t?.patchRoutesOnNavigation,window:t?.window}).initialize()}function L2(){let e=window?.__staticRouterHydrationData;return e&&e.errors&&(e={...e,errors:O2(e.errors)}),e}function O2(e){if(!e)return null;let t=Object.entries(e),r={};for(let[i,l]of t)if(l&&l.__type==="RouteErrorResponse")r[i]=new Ad(l.status,l.statusText,l.data,l.internal===!0);else if(l&&l.__type==="Error"){if(l.__subType){let c=window[l.__subType];if(typeof c=="function")try{let f=new c(l.message);f.stack="",r[i]=f}catch{}}if(r[i]==null){let c=new Error(l.message);c.stack="",r[i]=c}}else r[i]=l;return r}var g1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Jt=u.forwardRef(function({onClick:t,discover:r="render",prefetch:i="none",relative:l,reloadDocument:c,replace:f,state:m,target:h,to:p,preventScrollReset:y,viewTransition:g,...v},S){let{basename:w}=u.useContext(bs),N=typeof p=="string"&&g1.test(p),j,_=!1;if(typeof p=="string"&&N&&(j=p,y1))try{let P=new URL(window.location.href),X=p.startsWith("//")?new URL(P.protocol+p):new URL(p),H=Ma(X.pathname,w);X.origin===P.origin&&H!=null?p=H+X.search+X.hash:_=!0}catch{Yn(!1,`<Link to="${p}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let C=UA(p,{relative:l}),[O,E,T]=T2(i,v),M=B2(p,{replace:f,state:m,target:h,preventScrollReset:y,relative:l,viewTransition:g});function A(P){t&&t(P),P.defaultPrevented||M(P)}let z=u.createElement("a",{...v,...T,href:j||C,onClick:_||c?t:A,ref:D2(S,E),target:h,"data-discover":!N&&r==="render"?"true":void 0});return O&&!N?u.createElement(u.Fragment,null,z,u.createElement(M2,{page:C})):z});Jt.displayName="Link";var z2=u.forwardRef(function({"aria-current":t="page",caseSensitive:r=!1,className:i="",end:l=!1,style:c,to:f,viewTransition:m,children:h,...p},y){let g=jc(f,{relative:p.relative}),v=Ya(),S=u.useContext(Ec),{navigator:w,basename:N}=u.useContext(bs),j=S!=null&&G2(g)&&m===!0,_=w.encodeLocation?w.encodeLocation(g).pathname:g.pathname,C=v.pathname,O=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;r||(C=C.toLowerCase(),O=O?O.toLowerCase():null,_=_.toLowerCase()),O&&N&&(O=Ma(O,N)||O);const E=_!=="/"&&_.endsWith("/")?_.length-1:_.length;let T=C===_||!l&&C.startsWith(_)&&C.charAt(E)==="/",M=O!=null&&(O===_||!l&&O.startsWith(_)&&O.charAt(_.length)==="/"),A={isActive:T,isPending:M,isTransitioning:j},z=T?t:void 0,P;typeof i=="function"?P=i(A):P=[i,T?"active":null,M?"pending":null,j?"transitioning":null].filter(Boolean).join(" ");let X=typeof c=="function"?c(A):c;return u.createElement(Jt,{...p,"aria-current":z,className:P,ref:y,style:X,to:f,viewTransition:m},typeof h=="function"?h(A):h)});z2.displayName="NavLink";var $2=u.forwardRef(({discover:e="render",fetcherKey:t,navigate:r,reloadDocument:i,replace:l,state:c,method:f=pd,action:m,onSubmit:h,relative:p,preventScrollReset:y,viewTransition:g,...v},S)=>{let w=P2(),N=V2(m,{relative:p}),j=f.toLowerCase()==="get"?"get":"post",_=typeof m=="string"&&g1.test(m),C=O=>{if(h&&h(O),O.defaultPrevented)return;O.preventDefault();let E=O.nativeEvent.submitter,T=E?.getAttribute("formmethod")||f;w(E||O.currentTarget,{fetcherKey:t,method:T,navigate:r,replace:l,state:c,relative:p,preventScrollReset:y,viewTransition:g})};return u.createElement("form",{ref:S,method:j,action:N,onSubmit:i?h:C,...v,"data-discover":!_&&e==="render"?"true":void 0})});$2.displayName="Form";function F2(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function b1(e){let t=u.useContext(Di);return sn(t,F2(e)),t}function B2(e,{target:t,replace:r,state:i,preventScrollReset:l,relative:c,viewTransition:f}={}){let m=zn(),h=Ya(),p=jc(e,{relative:c});return u.useCallback(y=>{if(p2(y,t)){y.preventDefault();let g=r!==void 0?r:Vr(h)===Vr(p);m(e,{replace:g,state:i,preventScrollReset:l,relative:c,viewTransition:f})}},[h,m,p,r,i,t,e,l,c,f])}function U2(e){Yn(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=u.useRef(Up(e)),r=u.useRef(!1),i=Ya(),l=u.useMemo(()=>y2(i.search,r.current?null:t.current),[i.search]),c=zn(),f=u.useCallback((m,h)=>{const p=Up(typeof m=="function"?m(new URLSearchParams(l)):m);r.current=!0,c("?"+p,h)},[c,l]);return[l,f]}var q2=0,H2=()=>`__${String(++q2)}__`;function P2(){let{router:e}=b1("useSubmit"),{basename:t}=u.useContext(bs),r=QA();return u.useCallback(async(i,l={})=>{let{action:c,method:f,encType:m,formData:h,body:p}=v2(i,t);if(l.navigate===!1){let y=l.fetcherKey||H2();await e.fetch(y,r,l.action||c,{preventScrollReset:l.preventScrollReset,formData:h,body:p,formMethod:l.method||f,formEncType:l.encType||m,flushSync:l.flushSync})}else await e.navigate(l.action||c,{preventScrollReset:l.preventScrollReset,formData:h,body:p,formMethod:l.method||f,formEncType:l.encType||m,replace:l.replace,state:l.state,fromRouteId:r,flushSync:l.flushSync,viewTransition:l.viewTransition})},[e,t,r])}function V2(e,{relative:t}={}){let{basename:r}=u.useContext(bs),i=u.useContext(ls);sn(i,"useFormAction must be used inside a RouteContext");let[l]=i.matches.slice(-1),c={...jc(e||".",{relative:t})},f=Ya();if(e==null){c.search=f.search;let m=new URLSearchParams(c.search),h=m.getAll("index");if(h.some(y=>y==="")){m.delete("index"),h.filter(g=>g).forEach(g=>m.append("index",g));let y=m.toString();c.search=y?`?${y}`:""}}return(!e||e===".")&&l.route.index&&(c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(c.pathname=c.pathname==="/"?r:Ms([r,c.pathname])),Vr(c)}function v1(e,t){let{capture:r}=t||{};u.useEffect(()=>{let i=r!=null?{capture:r}:void 0;return window.addEventListener("beforeunload",e,i),()=>{window.removeEventListener("beforeunload",e,i)}},[e,r])}function Y2({when:e,message:t}){let r=f1(e);u.useEffect(()=>{r.state==="blocked"&&(window.confirm(t)?setTimeout(r.proceed,0):r.reset())},[r,t]),u.useEffect(()=>{r.state==="blocked"&&!e&&r.reset()},[r,e])}function G2(e,{relative:t}={}){let r=u.useContext(Ay);sn(r!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=b1("useViewTransitionState"),l=jc(e,{relative:t});if(!r.isTransitioning)return!1;let c=Ma(r.currentLocation.pathname,i)||r.currentLocation.pathname,f=Ma(r.nextLocation.pathname,i)||r.nextLocation.pathname;return Cd(l.pathname,f)!=null||Cd(l.pathname,c)!=null}var Zd=Vw();const x1=ki(Zd);function X2(e){return u.createElement(r2,{flushSync:Zd.flushSync,...e})}/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K2=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),W2=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,i)=>i?i.toUpperCase():r.toLowerCase()),R0=e=>{const t=W2(e);return t.charAt(0).toUpperCase()+t.slice(1)},S1=(...e)=>e.filter((t,r,i)=>!!t&&t.trim()!==""&&i.indexOf(t)===r).join(" ").trim(),Z2=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Q2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J2=u.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:i,className:l="",children:c,iconNode:f,...m},h)=>u.createElement("svg",{ref:h,...Q2,width:t,height:t,stroke:e,strokeWidth:i?Number(r)*24/Number(t):r,className:S1("lucide",l),...!c&&!Z2(m)&&{"aria-hidden":"true"},...m},[...f.map(([p,y])=>u.createElement(p,y)),...Array.isArray(c)?c:[c]]));/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=(e,t)=>{const r=u.forwardRef(({className:i,...l},c)=>u.createElement(J2,{ref:c,iconNode:t,className:S1(`lucide-${K2(R0(e))}`,`lucide-${e}`,i),...l}));return r.displayName=R0(e),r};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eT=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],k0=It("arrow-down",eT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tT=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Iy=It("arrow-left",tT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nT=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],w1=It("arrow-right",nT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aT=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],D0=It("arrow-up",aT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sT=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}]],Ly=It("bell-ring",sT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rT=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Md=It("bell",rT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iT=[["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M14 7a4 4 0 0 1 4 4v3a6 6 0 0 1-12 0v-3a4 4 0 0 1 4-4z",key:"uouzyp"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M21 21a4 4 0 0 0-3.81-4",key:"1b0z45"}],["path",{d:"M21 5a4 4 0 0 1-3.55 3.97",key:"5cxbf6"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M3 21a4 4 0 0 1 3.81-4",key:"1fjd4g"}],["path",{d:"M3 5a4 4 0 0 0 3.55 3.97",key:"1d7oge"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M9 7.13V6a3 3 0 1 1 6 0v1.13",key:"1vgav8"}]],Oy=It("bug",iT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lT=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],I0=It("calendar-days",lT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oT=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],cT=It("check-check",oT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uT=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],N1=It("check",uT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dT=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Ur=It("chevron-down",dT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fT=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],zy=It("chevron-right",fT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],qa=It("circle-alert",mT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Qd=It("circle-check",hT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pT=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],yT=It("circle-play",pT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gT=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],$y=It("clock",gT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bT=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],L0=It("cloud-upload",bT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vT=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],xT=It("crown",vT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ST=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],O0=It("database",ST);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wT=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],NT=It("download",wT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ET=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],E1=It("eye",ET);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jT=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],_T=It("file-check",jT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CT=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],qp=It("file-text",CT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AT=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Jd=It("funnel",AT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TT=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],MT=It("grip-vertical",TT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RT=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],j1=It("history",RT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kT=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],DT=It("image",kT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Fy=It("info",IT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LT=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],_1=It("layers",LT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OT=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],z0=It("link-2",OT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zT=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],C1=It("list-checks",zT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $T=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],$0=It("list",$T);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FT=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Nn=It("loader-circle",FT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BT=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],UT=It("log-out",BT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qT=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],HT=It("lock",qT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PT=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],VT=It("maximize-2",PT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YT=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],GT=It("menu",YT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XT=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],KT=It("message-square",XT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WT=[["path",{d:"M5 12h14",key:"1ays0h"}]],A1=It("minus",WT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZT=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],QT=It("moon",ZT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JT=[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]],Hp=It("notebook-pen",JT);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eM=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],tM=It("pen-line",eM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nM=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],T1=It("pen",nM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aM=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],ar=It("pencil",aM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sM=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],rM=It("pin",sM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iM=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Pa=It("plus",iM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lM=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],zl=It("rotate-ccw",lM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oM=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],F0=It("save",oM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cM=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],ic=It("search",cM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uM=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],dM=It("send",uM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fM=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],M1=It("settings",fM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mM=[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]],hM=It("shapes",mM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pM=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],R1=It("shield-check",pM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yM=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M9 12h6",key:"1c52cq"}],["path",{d:"M12 9v6",key:"199k2o"}]],gM=It("shield-plus",yM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bM=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],vM=It("sliders-horizontal",bM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xM=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Ii=It("sparkles",xM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SM=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],wM=It("sun",SM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NM=[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5",key:"hbey2j"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18",key:"1hf58s"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20",key:"pidxm4"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21",key:"1pehsh"}]],EM=It("swords",NM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],By=It("target",jM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _M=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],fa=It("trash-2",_M);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CM=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Aa=It("triangle-alert",CM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AM=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],TM=It("upload",AM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MM=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],k1=It("users",MM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RM=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],kM=It("user",RM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DM=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],IM=It("workflow",DM);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LM=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ra=It("x",LM),D1=u.createContext(null);function OM({children:e}){const[t,r]=u.useState(null),[i,l]=u.useState(null),[c,f]=u.useState(!1),m="http://localhost:3000/api";u.useEffect(()=>{try{const y=localStorage.getItem("gamedb_session");if(y){const g=JSON.parse(y);g?.user&&g?.token?(r(g.user),l(g.token)):(console.warn(" Incomplete session found, clearing..."),localStorage.removeItem("gamedb_session"))}}catch(y){console.warn(" Invalid stored session, clearing...",y),localStorage.removeItem("gamedb_session")}finally{f(!0)}},[]),u.useEffect(()=>{c&&(i&&t?localStorage.setItem("gamedb_session",JSON.stringify({user:t,token:i})):localStorage.removeItem("gamedb_session"))},[i,t,c]);const h=async(y,g)=>{try{const S=await(await fetch(`${m}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:y,password:g})})).json();if(console.log(" Raw login response:",S),!S.success||!S.token)throw new Error(S.message||"Invalid credentials");return r(S.user),l(S.token),localStorage.setItem("gamedb_session",JSON.stringify({user:S.user,token:S.token})),console.log(" Login successful:",S.user),!0}catch(v){return console.error(" Login error:",v.message),alert(`Login failed: ${v.message}`),!1}},p=()=>{r(null),l(null),localStorage.removeItem("gamedb_session")};return c?a.jsx(D1.Provider,{value:{user:t,token:i,sessionReady:c,login:h,logout:p},children:e}):a.jsx("div",{className:"loading-screen",children:"Loading session..."})}function En(){return u.useContext(D1)}function Zr(){try{return JSON.parse(localStorage.getItem("gamedb_session"))?.token||null}catch{return null}}const ks="http://localhost:3000/api/campaigns";async function zM(e=5,t=200){for(let r=0;r<e;r++){const i=Zr();if(i)return i;await new Promise(l=>setTimeout(l,t))}return null}async function or(){const e=await zM();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function cr(e,t="request"){if(e.status===401)throw console.warn(` Unauthorized during ${t}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${e.status} ${r}`)}return e.json()}async function _c(e={}){const t=await or(),r=new URLSearchParams;Object.entries(e).forEach(([f,m])=>{m!=null&&m!==""&&r.set(f,m)});const i=r.toString(),l=i?`${ks}?${i}`:ks,c=await fetch(l,{headers:t});return cr(c,"fetch campaigns")}async function $M(e){const t=await or(),r=await fetch(ks,{method:"POST",headers:t,body:JSON.stringify(e)});return cr(r,"create campaign")}async function FM(e,t){const r=await or(),i=await fetch(`${ks}/${e}`,{method:"PUT",headers:r,body:JSON.stringify(t)});return cr(i,"update campaign")}async function BM(e){const t=await or(),r=await fetch(`${ks}/${e}`,{method:"DELETE",headers:t});return cr(r,"delete campaign")}async function UM(e,t={}){if(!e)throw new Error("campaignId is required to fetch notes");const r=await or(),i=new URLSearchParams;Object.entries(t).forEach(([m,h])=>{if(!(h==null||h==="")){if(Array.isArray(h)){h.map(p=>p==null?"":String(p)).filter(p=>p.trim()!=="").forEach(p=>{i.append(`${m}[]`,p)});return}i.set(m,h)}});const l=i.toString(),c=`${ks}/${e}/entity-notes${l?`?${l}`:""}`,f=await fetch(c,{headers:r});return cr(f,"fetch campaign entity notes")}async function qM(e){if(!e)throw new Error("campaignId is required to fetch session notes");const t=await or(),r=`${ks}/${e}/session-notes`,i=await fetch(r,{headers:t});return cr(i,"fetch campaign session notes")}async function HM(e,t={}){if(!e)throw new Error("campaignId is required to create a session note");const r=await or(),i=await fetch(`${ks}/${e}/session-notes`,{method:"POST",headers:r,body:JSON.stringify(t)});return cr(i,"create session note")}async function PM(e,t,r={}){if(!e)throw new Error("campaignId is required to update a session note");if(!t)throw new Error("noteId is required to update a session note");const i=await or(),l=await fetch(`${ks}/${e}/session-notes/${t}`,{method:"PUT",headers:i,body:JSON.stringify(r)});return cr(l,"update session note")}async function VM(e,t){if(!e)throw new Error("campaignId is required to delete a session note");if(!t)throw new Error("noteId is required to delete a session note");const r=await or(),i=await fetch(`${ks}/${e}/session-notes/${t}`,{method:"DELETE",headers:r});return cr(i,"delete session note")}const ef="http://localhost:3000/api/worlds";async function YM(e=5,t=200){for(let r=0;r<e;r++){const i=Zr();if(i)return i;await new Promise(l=>setTimeout(l,t))}return null}async function tf(){const e=await YM();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function nf(e,t="request"){if(e.status===401)throw console.warn(` Unauthorized during ${t}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${e.status} ${r}`)}return e.json()}async function $l(){const e=await tf(),t=await fetch(ef,{headers:e});return nf(t,"fetch worlds")}async function GM(e){const t=await tf(),r=await fetch(ef,{method:"POST",headers:t,body:JSON.stringify(e)});return nf(r,"create world")}async function XM(e,t){const r=await tf(),i=await fetch(`${ef}/${e}`,{method:"PUT",headers:r,body:JSON.stringify(t)});return nf(i,"update world")}async function KM(e){const t=await tf(),r=await fetch(`${ef}/${e}`,{method:"DELETE",headers:t});return nf(r,"delete world")}const I1=u.createContext(null),gd="gamedb_campaign_context",WM=new Set(["dm","player"]),ko=(e,t)=>{if(typeof window>"u")return;const r=e?String(e):"",i=r?"":t?String(t):"";try{r?localStorage.setItem(gd,JSON.stringify({type:"campaign",id:r})):i?localStorage.setItem(gd,JSON.stringify({type:"world",id:i})):localStorage.removeItem(gd)}catch(l){console.warn(" Unable to persist campaign context",l)}},ZM=e=>{if(!e||typeof e!="string")return{type:"",id:""};try{const t=JSON.parse(e);if(t&&typeof t=="object"){const r=t.type==="world"?"world":"campaign",i=t.id?String(t.id):"";if(i)return{type:r,id:i}}}catch{if(e.trim())return{type:"campaign",id:e.trim()}}return e.trim()?{type:"campaign",id:e.trim()}:{type:"",id:""}},QM=(e,t)=>Array.isArray(e)?t?t.role==="system_admin"?e:e.filter(r=>Array.isArray(r?.members)&&r.members.some(i=>i?.user_id===t.id&&WM.has(i?.role))):[]:[];function JM({children:e}){const{user:t,sessionReady:r}=En(),[i,l]=u.useState([]),[c,f]=u.useState(!1),[m,h]=u.useState(""),[p,y]=u.useState(""),[g,v]=u.useState([]),[S,w]=u.useState(!1),[N,j]=u.useState(""),[_,C]=u.useState(""),[O,E]=u.useState(""),[T,M]=u.useState(!1);u.useEffect(()=>{if(r)try{const k=localStorage.getItem(gd);if(!k){y(""),C("");return}const{type:U,id:R}=ZM(k);U==="world"?(C(R),y("")):U==="campaign"?(y(R),C("")):(y(""),C(""))}catch(k){console.warn(" Unable to restore campaign context",k),y(""),C("")}finally{M(!0)}},[r]),u.useEffect(()=>{!r||!T||ko(p,_)},[p,_,r,T]);const A=u.useCallback(async()=>{if(!r||!t)return l([]),h(""),[];f(!0),h("");try{const k=await _c(),U=Array.isArray(k?.data)?k.data:Array.isArray(k)?k:[],R=QM(U,t);return l(R),y(q=>q&&R.some(J=>String(J.id)===String(q))?q:""),R}catch(k){return console.error(" Failed to load campaigns",k),h(k.message||"Failed to load campaigns"),l([]),[]}finally{f(!1)}},[r,t]),z=u.useCallback(async()=>{if(!r||!t)return v([]),j(""),[];w(!0),j("");try{const k=await $l(),U=Array.isArray(k?.data)?k.data:Array.isArray(k)?k:[];return v(U),C(R=>R&&U.some(G=>String(G.id)===String(R))?R:""),U}catch(k){return console.error(" Failed to load worlds",k),j(k.message||"Failed to load worlds"),v([]),[]}finally{w(!1)}},[r,t]);u.useEffect(()=>{if(!(!r||!T)){if(!t){l([]),y(""),h(""),f(!1),v([]),C(""),j(""),w(!1);return}A(),z()}},[r,T,t,A,z]);const P=u.useCallback(k=>{const U=k==null?"":String(k);y(U),U?(C(""),E(""),ko(U,"")):ko("","")},[]),X=u.useCallback(k=>{const U=k==null?"":String(k);C(U),U?(y(""),E(""),ko("",U)):ko("","")},[]);u.useEffect(()=>{E("")},[p]);const H=u.useCallback(k=>{const U=k==null?"":String(k);E(U)},[]),Y=u.useMemo(()=>p&&i.find(k=>String(k.id)===String(p))||null,[i,p]),V=u.useMemo(()=>_&&g.find(k=>String(k.id)===String(_))||null,[g,_]),I=u.useMemo(()=>p?"campaign":_?"world":"",[p,_]),F=u.useMemo(()=>I==="world"&&V?V:Y?.world?Y.world:V,[I,V,Y]),D=u.useMemo(()=>F?.id?String(F.id):"",[F]),L=u.useMemo(()=>`${I||"none"}:${p||_||""||"none"}:${D||"none"}:${O||"none"}`,[p,_,I,D,O]),B=u.useMemo(()=>({campaigns:i,selectedCampaign:Y,selectedCampaignId:p,setSelectedCampaignId:P,worlds:g,worldLoading:S,worldError:N,selectedWorld:V,selectedWorldId:_,setSelectedWorldId:X,viewAsCharacterId:O,setViewAsCharacterId:H,selectedContextType:I,activeWorld:F,activeWorldId:D,contextKey:L,loading:c,error:m,refreshCampaigns:A,refreshWorlds:z}),[i,Y,p,P,g,S,N,V,_,X,O,H,I,F,D,L,c,m,A,z]);return a.jsx(I1.Provider,{value:B,children:e})}function Bn(){const e=u.useContext(I1);if(!e)throw new Error("useCampaignContext must be used within a CampaignProvider");return e}const L1=u.createContext(null),eR=()=>{if(typeof window>"u")return"light";const e=window.localStorage.getItem("theme");return e==="light"||e==="dark"?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"};function tR({children:e}){const[t,r]=u.useState(eR);u.useEffect(()=>{typeof document>"u"||(document.body.classList.remove("theme-light","theme-dark"),document.body.classList.add(t==="dark"?"theme-dark":"theme-light"),document.documentElement.setAttribute("data-theme",t),window.localStorage.setItem("theme",t))},[t]),u.useEffect(()=>{if(typeof window>"u")return;const l=window.matchMedia("(prefers-color-scheme: dark)"),c=f=>{r(f.matches?"dark":"light")};if(!window.localStorage.getItem("theme"))return l.addEventListener("change",c),()=>l.removeEventListener("change",c)},[]);const i=u.useMemo(()=>({theme:t,setTheme:r,toggleTheme:()=>r(l=>l==="dark"?"light":"dark")}),[t]);return a.jsx(L1.Provider,{value:i,children:e})}function nR(){const e=u.useContext(L1);if(!e)throw new Error("useTheme must be used within a ThemeProvider");return e}const aR=768;function Uy(e=aR){const[t,r]=u.useState(()=>typeof window>"u"?!1:window.matchMedia(`(max-width: ${e}px)`).matches);return u.useEffect(()=>{if(typeof window>"u")return;const i=window.matchMedia(`(max-width: ${e}px)`),l=c=>{r(c.matches)};return r(i.matches),typeof i.addEventListener=="function"?(i.addEventListener("change",l),()=>i.removeEventListener("change",l)):(i.addListener(l),()=>i.removeListener(l))},[e]),t}const lc="http://localhost:3000/api/characters";async function sR(e=5,t=200){for(let r=0;r<e;r++){const i=Zr();if(i)return i;await new Promise(l=>setTimeout(l,t))}return null}async function af(){const e=await sR();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function sf(e,t="request"){if(e.status===401)throw console.warn(` Unauthorized during ${t}, clearing session`),localStorage.removeItem("gamedb_session"),window.location.reload(),new Error("Session expired or unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${e.status} ${r}`)}return e.json()}async function Ds(e={}){const t=await af(),r=new URLSearchParams;Object.entries(e).forEach(([f,m])=>{m!=null&&m!==""&&r.set(f,m)});const i=r.toString(),l=i?`${lc}?${i}`:lc,c=await fetch(l,{headers:t});return sf(c,"fetch characters")}async function rR(e){const t=await af(),r=await fetch(lc,{method:"POST",headers:t,body:JSON.stringify(e)});return sf(r,"create character")}async function iR(e,t){const r=await af(),i=await fetch(`${lc}/${e}`,{method:"PUT",headers:r,body:JSON.stringify(t)});return sf(i,"update character")}async function lR(e){const t=await af(),r=await fetch(`${lc}/${e}`,{method:"DELETE",headers:t});return sf(r,"delete character")}const B0="drawer-panel-open",oR=300,zh={sm:"360px",md:"420px",lg:"560px"},cR=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])",'[tabindex]:not([tabindex="-1"])'],uR=()=>{const e=document.createElement("div");return e.className="drawer-portal-container",e},dR=(e,t)=>e?typeof e=="number"?`${e}px`:String(e):t&&zh[t]?zh[t]:zh.md;function Yr({isOpen:e,onClose:t,title:r,description:i,children:l,footer:c,footerActions:f,width:m,size:h="md",labelledBy:p,closeLabel:y="Close panel",className:g="",mobileFull:v=!0}){const S=u.useRef(null),w=u.useRef(null),N=u.useRef(null),j=u.useRef(null),[_,C]=u.useState(e),[O,E]=u.useState(!1),T=u.useMemo(()=>p||`drawer-${Math.random().toString(36).slice(2)}`,[p]),M=i?`${T}-description`:void 0,A=dR(m,h);if(u.useEffect(()=>(S.current||(S.current=uR(),document.body.appendChild(S.current)),()=>{S.current&&S.current.parentNode&&S.current.parentNode.removeChild(S.current),S.current=null}),[]),u.useEffect(()=>e?(j.current&&(clearTimeout(j.current),j.current=null),C(!0),E(!1),()=>{}):_?(E(!0),j.current=setTimeout(()=>{C(!1),E(!1),j.current=null},oR),()=>{j.current&&(clearTimeout(j.current),j.current=null)}):()=>{},[e,_]),u.useEffect(()=>{if(!e)return;N.current=document.activeElement instanceof HTMLElement?document.activeElement:null,document.body.classList.add(B0);const H=()=>w.current?Array.from(w.current.querySelectorAll(cR.join(","))).filter(D=>D instanceof HTMLElement&&D.offsetParent!==null):[],Y=()=>{const L=H()[0];L?L.focus({preventScroll:!0}):w.current&&w.current.focus({preventScroll:!0})},V=D=>{if(D.key==="Escape"){D.preventDefault(),t?.();return}if(D.key!=="Tab")return;const L=H();if(L.length===0){D.preventDefault(),w.current?.focus({preventScroll:!0});return}const B=L[0],k=L[L.length-1],U=document.activeElement;if(D.shiftKey){(U===B||!w.current?.contains(U))&&(D.preventDefault(),k.focus({preventScroll:!0}));return}U===k&&(D.preventDefault(),B.focus({preventScroll:!0}))},I=D=>{w.current?.contains(D.target)||Y()},F=setTimeout(()=>{if(!w.current)return;const D=w.current.querySelector("[data-autofocus]");if(D instanceof HTMLElement){D.focus({preventScroll:!0});return}Y()},20);return document.addEventListener("keydown",V),document.addEventListener("focusin",I),()=>{clearTimeout(F),document.removeEventListener("keydown",V),document.removeEventListener("focusin",I),document.body.classList.remove(B0),N.current instanceof HTMLElement&&N.current.focus({preventScroll:!0})}},[e,t]),!_||!S.current)return null;const z=["drawer-panel-wrapper",e?"drawer-panel-wrapper--open":"",O?"drawer-panel-wrapper--closing":""].filter(Boolean).join(" "),P=["drawer-panel",h?`drawer-panel--${h}`:"",v?"drawer-panel--mobile-full":"",g].filter(Boolean).join(" "),X=f??c;return Zd.createPortal(a.jsxs("div",{className:z,role:"presentation",children:[a.jsx("div",{className:"drawer-panel-overlay",onClick:t,role:"presentation"}),a.jsxs("aside",{ref:w,className:P,role:"dialog","aria-modal":"true","aria-labelledby":T,"aria-describedby":M,tabIndex:-1,style:{"--drawer-panel-width":A},children:[a.jsxs("div",{className:"drawer-panel-header",children:[a.jsxs("div",{className:"drawer-panel-heading",children:[a.jsx("h2",{id:T,children:r}),i?a.jsx("p",{id:M,className:"drawer-panel-description",children:i}):null]}),a.jsx("button",{type:"button",className:"icon-btn",onClick:t,"aria-label":y,children:""})]}),a.jsx("div",{className:"drawer-panel-body",children:l}),X?a.jsx("div",{className:"drawer-panel-footer",children:X}):null]})]}),S.current)}const rf="app_history",O1=100,Pp="history:updated",z1=()=>typeof window<"u"?window:null,lf=()=>!!z1()?.localStorage,$1=e=>{const t=z1();if(t)try{t.dispatchEvent(new CustomEvent(Pp,{detail:Array.isArray(e)?e:[]}))}catch(r){console.warn(" Failed to broadcast history change",r)}},Vp=e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t},qy=e=>{if(!e||e.id===void 0||e.id===null||!e.type)return null;const t=Vp(e.viewedAt)||new Date,r=e.worldId??e.world_id??e.worldID??e.world?.id??e.world?.world_id??null,i=e.worldName??e.world_name??e.world?.name??null;return{id:String(e.id),type:String(e.type),title:e.title?String(e.title):"Untitled record",viewedAt:t.toISOString(),...r?{worldId:String(r)}:{},...i?{worldName:String(i)}:{}}},fR=e=>e.slice().sort((t,r)=>{const i=Vp(t?.viewedAt),l=Vp(r?.viewedAt),c=i?i.getTime():0;return(l?l.getTime():0)-c}),Yp=()=>{if(!lf())return[];try{const e=window.localStorage.getItem(rf);if(!e)return[];const t=JSON.parse(e);if(!Array.isArray(t))return[];const r=t.map(qy).filter(Boolean);return fR(r)}catch(e){return console.warn(" Failed to parse stored history",e),[]}},mR=e=>{if(!lf())return[];if(!Array.isArray(e))return[];const t=e.map(qy).filter(Boolean).slice(0,O1);return window.localStorage.setItem(rf,JSON.stringify(t)),$1(t),t},hR=e=>{if(!lf())return[];const t=qy(e);if(!t)return Yp();const r=Yp().filter(l=>!(l.id===t.id&&l.type===t.type)),i=[t,...r].slice(0,O1);return mR(i),i},pR=()=>{lf()&&(window.localStorage.removeItem(rf),$1([]))},$h=()=>typeof window>"u"?[]:Yp();function F1(e=null){const[t,r]=u.useState(()=>$h()),i=u.useCallback(()=>{const m=$h();return r(m),m},[]),l=u.useCallback(m=>{if(!m)return $h();const h=hR(m);return r(h),h},[]),c=u.useCallback(()=>{pR(),r([])},[]);u.useEffect(()=>{i()},[i]);const f=u.useMemo(()=>{if(!e)return null;const{id:m,type:h,title:p,viewedAt:y}=e;if(m==null||!h)return null;const g={id:m,type:h,title:p,viewedAt:y},v=e.worldId??e.world_id??e.world?.id??e.world?.world_id??null,S=e.worldName??e.world_name??e.world?.name??null;return v!=null&&(g.worldId=v),S&&(g.worldName=S),g},[e]);return u.useEffect(()=>{f&&l(f)},[f,l]),u.useEffect(()=>{if(typeof window>"u")return;const m=p=>{p.key&&p.key!==rf||i()},h=()=>{i()};return window.addEventListener("storage",m),window.addEventListener(Pp,h),()=>{window.removeEventListener("storage",m),window.removeEventListener(Pp,h)}},[i]),{history:t,addEntry:l,refreshHistory:i,clearHistory:c}}const B1=3600*1e3,yR=24*B1,gR=e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t},Gp=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),bR=(e,t)=>{if(!e)return"older";const r=t.getTime()-e.getTime();if(r<B1)return"lastHour";if(Gp(e,t))return"today";const i=new Date(t);return i.setDate(t.getDate()-1),Gp(e,i)?"yesterday":r<7*yR?"lastSevenDays":"older"},vR=[{key:"lastHour",label:"Last hour"},{key:"today",label:"Today"},{key:"yesterday",label:"Yesterday"},{key:"lastSevenDays",label:"Last seven days"},{key:"older",label:"Older"}],xR=(e,t)=>{if(!e)return"";if(Gp(e,t)){const l=String(e.getHours()).padStart(2,"0"),c=String(e.getMinutes()).padStart(2,"0");return`${l}.${c}`}const r=String(e.getDate()).padStart(2,"0"),i=e.toLocaleString(void 0,{month:"short"});return`${r} ${i}`},SR=e=>{if(!e)return"record";const t=String(e);return t.includes(":")?t.split(":").pop().replace(/[-_]+/g," "):t.replace(/_/g," ")},wR=e=>!e?.type||!e?.id?null:String(e.type).toLowerCase().startsWith("entity")?`/entities/${e.id}`:null;function NR({isOpen:e,onClose:t}){const{history:r,clearHistory:i}=F1(),{campaigns:l,worlds:c,loading:f,worldLoading:m,selectedContextType:h,activeWorldId:p}=Bn(),y=new Date,g=u.useMemo(()=>!f&&!m,[f,m]),v=u.useMemo(()=>{const C=new Set,O=E=>{if(!E&&E!==0)return;const T=String(E);T&&C.add(T)};return Array.isArray(c)&&c.forEach(E=>{O(E?.id??E?.world_id)}),Array.isArray(l)&&l.forEach(E=>{O(E?.world?.id??E?.world_id)}),C},[l,c]),S=u.useMemo(()=>!h||!p?"":String(p),[h,p]),w=u.useMemo(()=>!Array.isArray(r)||r.length===0?[]:!g||!v.size?r:r.filter(C=>{if(!C)return!1;if(!String(C.type||"").toLowerCase().startsWith("entity"))return!0;const E=C.worldId??C.world_id??C.world?.id??C.world?.world_id??null;return S&&(!E||String(E)!==S)?!1:E?v.has(String(E)):!0}),[r,v,g,S]),N=g&&Array.isArray(r)&&r.length>0&&w.length<r.length,j=u.useMemo(()=>{if(!Array.isArray(w)||w.length===0)return[];const C=new Date,O=vR.map(T=>({...T,items:[]})),E=new Map(O.map(T=>[T.key,T]));return w.forEach(T=>{const M=gR(T?.viewedAt),A=bR(M,C),z=E.get(A);z&&z.items.push({...T,parsedDate:M})}),O.filter(T=>T.items.length>0)},[w]),_=()=>{i()};return a.jsx(Yr,{isOpen:e,onClose:t,title:"History",description:"Recently viewed records",size:"sm",children:a.jsxs("div",{className:"history-tab",children:[a.jsxs("div",{className:"history-tab-header",children:[a.jsxs("div",{className:"history-tab-title",children:[a.jsx($y,{size:18}),a.jsx("span",{children:"Recently viewed"})]}),a.jsxs("button",{type:"button",className:"history-clear-btn",onClick:_,disabled:!r.length,children:[a.jsx(fa,{size:14}),"Clear"]})]}),!w.length&&a.jsx("p",{className:"history-empty",children:N?"You do not currently have access to any records in your recent history.":"No records viewed yet. Start exploring to build a history."}),j.map(C=>a.jsxs("section",{className:"history-group",children:[a.jsx("h3",{className:"history-group-title",children:C.label}),a.jsx("ul",{className:"history-entry-list",children:C.items.map(O=>{const E=wR(O),T=a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"history-entry-title",children:O.title||"Untitled record"}),a.jsxs("div",{className:"history-entry-meta",children:[a.jsx("span",{className:"history-entry-type",children:SR(O.type)}),a.jsx("time",{className:"history-entry-time",children:xR(O.parsedDate,y)})]})]});return a.jsx("li",{children:E?a.jsx(Jt,{to:E,className:"history-entry history-entry-link",onClick:t,children:T}):a.jsx("div",{className:"history-entry",children:T})},`${O.type}-${O.id}`)})})]},C.key))]})})}const ER={VITE_API_BASE:"http://localhost:3000/api"},U0=typeof import.meta<"u"?ER:void 0,jR=U0?.VITE_API_URL||U0?.VITE_API_BASE;function _R(e){if(!e)return null;const t=e.replace(/\/+$/,"");return t.endsWith("/api")?t:`${t}/api`}const CR=_R(jR)||"http://localhost:3000/api",AR="gamedb_campaign_context",TR="X-Campaign-Context-Id",MR=e=>{if(!e||typeof e!="string")return null;try{const r=JSON.parse(e);if(r&&typeof r=="object"){const i=r.type==="world"?"world":"campaign",l=r.id?String(r.id):"";return l?{type:i,id:l}:null}}catch{const r=e.trim();if(r)return{type:"campaign",id:r}}const t=e.trim();return t?{type:"campaign",id:t}:null};async function Do(e,t,r,i={}){const{headers:l,includeCampaignContext:c=!0,...f}=i||{},m=typeof FormData<"u"&&r instanceof FormData,h={...m?{}:{"Content-Type":"application/json"},...l},p=Zr();if(p&&(h.Authorization=`Bearer ${p}`),c)try{const N=localStorage.getItem(AR);if(N){const j=MR(N);j?.type==="campaign"&&j.id&&(h[TR]=j.id)}}catch(N){console.warn(" Unable to include campaign context header",N)}const y=(()=>{if(r!==void 0)return m?r:JSON.stringify(r)})(),g=await fetch(`${CR}${t}`,{method:e,headers:h,body:y,...f}),S=(g.headers.get("content-type")||"").includes("application/json"),w=S?await g.json():await g.text();if(!g.ok){g.status===401&&(localStorage.removeItem("gamedb_session"),setTimeout(()=>{window.location.pathname!=="/login"&&(window.location.href="/login")},150));const N=S&&w?.message||(typeof w=="string"?w:"Request failed"),j=new Error(N);throw j.status=g.status,j}return w}const _t={get:(e,t)=>Do("GET",e,void 0,t),post:(e,t,r)=>Do("POST",e,t,r),put:(e,t,r)=>Do("PUT",e,t,r),patch:(e,t,r)=>Do("PATCH",e,t,r),delete:(e,t)=>Do("DELETE",e,void 0,t)},U1=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([l,c])=>{c!=null&&c!==""&&t.set(l,c)});const r=t.toString(),i=r?`/notifications?${r}`:"/notifications";return _t.get(i)},RR=e=>_t.patch(`/notifications/${e}/read`),kR=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([l,c])=>{c!=null&&c!==""&&t.set(l,c)});const r=t.toString(),i=r?`/notifications/read-all?${r}`:"/notifications/read-all";return _t.patch(i)},DR=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([l,c])=>{c!=null&&c!==""&&t.set(l,c)});const r=t.toString(),i=r?`/notifications/unread-count?${r}`:"/notifications/unread-count";return _t.get(i)},q1=u.createContext(null),Fh=3e4,IR=12e4;function LR({children:e}){const{user:t,sessionReady:r}=En(),[i,l]=u.useState([]),[c,f]=u.useState(0),[m,h]=u.useState(!1),[p,y]=u.useState(""),g=u.useRef(null),v=u.useRef(null),S=u.useRef(!0);u.useEffect(()=>{const E=()=>{S.current=!document.hidden,!document.hidden&&v.current&&Date.now()-v.current>Fh&&(w(),N())};return document.addEventListener("visibilitychange",E),()=>{document.removeEventListener("visibilitychange",E)}},[]);const w=u.useCallback(async()=>{if(!t?.id||!r){l([]),h(!1);return}h(!0),y("");try{const E=await U1({limit:50}),T=Array.isArray(E?.data)?E.data:[];l(T),v.current=Date.now()}catch(E){console.error(" Failed to load notifications",E),y(E.message||"Failed to load notifications")}finally{h(!1)}},[t?.id,r]),N=u.useCallback(async()=>{if(!t?.id||!r){f(0);return}try{const T=(await DR())?.count??0;f(T)}catch(E){console.error(" Failed to load unread count",E)}},[t?.id,r]),j=u.useCallback(()=>{w(),N()},[w,N]),_=u.useCallback(async E=>{if(E)try{await RR(E),l(T=>T.map(M=>M.id===E?{...M,read:!0,readAt:new Date().toISOString()}:M)),f(T=>Math.max(0,T-1))}catch(T){throw console.error(" Failed to mark notification read",T),T}},[]),C=u.useCallback(async(E={})=>{try{await kR(E),l(T=>T.map(M=>({...M,read:!0,readAt:new Date().toISOString()}))),f(0)}catch(T){throw console.error(" Failed to mark all notifications read",T),T}},[]);u.useEffect(()=>{if(!t?.id||!r){g.current&&(clearInterval(g.current),g.current=null),l([]),f(0);return}w(),N();const E=()=>{g.current&&clearInterval(g.current);const M=S.current?Fh:IR;g.current=setInterval(()=>{S.current?(N(),(!v.current||Date.now()-v.current>Fh*2)&&w()):N()},M)};E();const T=()=>{S.current=!document.hidden,E()};return document.addEventListener("visibilitychange",T),()=>{g.current&&(clearInterval(g.current),g.current=null),document.removeEventListener("visibilitychange",T)}},[t?.id,r,w,N]);const O=u.useMemo(()=>({notifications:i,unreadCount:c,loading:m,error:p,refresh:j,markRead:_,markAllRead:C}),[i,c,m,p,j,_,C]);return a.jsx(q1.Provider,{value:O,children:e})}function OR(){const e=u.useContext(q1);if(!e)throw new Error("useNotifications must be used within NotificationProvider");return e}function H1(){return OR()}function P1({open:e,campaignName:t,onSwitch:r,onCancel:i}){return e?a.jsx("div",{className:"unsaved-dialog-backdrop",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"unsaved-dialog",role:"document",children:[a.jsxs("div",{className:"unsaved-dialog-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"unsaved-dialog-label",children:"Campaign context"}),a.jsx("h2",{children:"Switch campaign context?"})]}),a.jsx("button",{type:"button",className:"icon-btn","aria-label":"Close dialog",onClick:i,children:a.jsx(Ra,{size:18})})]}),a.jsxs("div",{className:"unsaved-dialog-body",children:[a.jsxs("p",{children:["This notification is for the campaign ",a.jsx("strong",{children:t||"another campaign"}),". You're currently viewing a different campaign context."]}),a.jsx("p",{className:"unsaved-dialog-help",children:"Would you like to switch to the correct campaign context to view this notification?"})]}),a.jsxs("div",{className:"unsaved-dialog-actions",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:r,children:"Switch campaign context"}),a.jsx("button",{type:"button",className:"btn cancel",onClick:i,children:"Cancel"})]})]})}):null}const zR=e=>{if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const i=new Date-t,l=Math.floor(i/6e4),c=Math.floor(i/36e5),f=Math.floor(i/864e5);return l<1?"Just now":l<60?`${l}m ago`:c<24?`${c}h ago`:f<7?`${f}d ago`:t.toLocaleDateString(void 0,{month:"short",day:"numeric"})},$R=e=>{const{type:t,metadata:r={}}=e;switch(t){case"entity_comment":return`${r.author_name||"Someone"} commented on ${r.entity_name||"an entity"}`;case"entity_mention_entity_note":return`${r.author_name||"Someone"} mentioned ${r.related_entity_name||"an entity"} in a note`;case"entity_mention_session_note":return`${r.author_name||"Someone"} mentioned ${r.related_entity_name||"an entity"} in a session note`;case"session_note_added":return`${r.author_name||"Someone"} created a session note${r.campaign_name?` for ${r.campaign_name}`:""}`;case"session_note_updated":return`${r.author_name||"Someone"} updated a session note${r.campaign_name?` for ${r.campaign_name}`:""}`;case"request_note_added":return`${r.author_name||"Someone"} added a note to "${r.request_title||"a feature/bug"}"`;case"request_status_changed":return`Status changed for "${r.request_title||"a feature/bug"}"`;case"request_assigned":return`You were assigned to "${r.request_title||"a feature/bug"}"`;default:return"New notification"}};function FR(){const{notifications:e,unreadCount:t,loading:r,markRead:i}=H1(),{selectedCampaignId:l,setSelectedCampaignId:c}=Bn(),f=zn(),[m,h]=u.useState(!1),p=u.useRef(null),[y,g]=u.useState({open:!1,notification:null});u.useEffect(()=>{const C=O=>{p.current&&!p.current.contains(O.target)&&h(!1)};if(m)return document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[m]);const v=e.filter(C=>!C.read).slice(0,5),S=C=>{if(h(!1),C.actionUrl)f(C.actionUrl);else{const{type:O,metadata:E={}}=C;if(O==="entity_comment"||O==="entity_mention_entity_note"){const T=E.entity_id||E.related_entity_id,M=C.campaignId||C.campaign?.id||l;T&&f(`/entities/${T}${M?`?campaignId=${M}`:""}#notes`)}else if(O==="session_note_added"||O==="session_note_updated"||O==="entity_mention_session_note"){const T=C.campaignId||C.campaign?.id||E.target_id||l;f(`/notes/session${T?`?campaignId=${T}`:""}`)}else if(O==="request_note_added"||O==="request_status_changed"||O==="request_assigned"){const T=E.request_id||E.requestId;f(T?`/requests/${T}`:"/requests")}else f("/notifications")}},w=async C=>{if(!C.read)try{await i(C.id)}catch(T){console.error("Failed to mark notification read",T)}const O=C.campaignId||C.campaign?.id||"";if(O&&O!==(l||"")){g({open:!0,notification:C});return}S(C)},N=()=>{const{notification:C}=y;if(!C)return;const O=C.campaignId||C.campaign?.id||"";O&&c(O),g({open:!1,notification:null}),setTimeout(()=>{S(C)},100)},j=()=>{g({open:!1,notification:null})},_=v.length>0;return a.jsxs("div",{className:"notification-widget",ref:p,children:[a.jsxs("button",{type:"button",className:"notification-widget-button",onClick:()=>h(!m),title:"Notifications",children:[t>0?a.jsx(Ly,{size:20}):a.jsx(Md,{size:20}),t>0&&a.jsx("span",{className:"notification-widget-badge",children:t>99?"99+":t})]}),m&&a.jsxs("div",{className:"notification-widget-dropdown",children:[a.jsxs("div",{className:"notification-widget-header",children:[a.jsx("h3",{children:"Notifications"}),t>0&&a.jsxs("span",{className:"notification-widget-count",children:[t," unread"]})]}),r?a.jsx("div",{className:"notification-widget-loading",children:"Loading..."}):_?a.jsx("div",{className:"notification-widget-list",children:v.map(C=>a.jsxs("div",{className:`notification-widget-item ${C.read?"read":"unread"}`,onClick:()=>w(C),children:[a.jsxs("div",{className:"notification-widget-item-content",children:[a.jsx("p",{className:"notification-widget-item-message",children:$R(C)}),a.jsx("span",{className:"notification-widget-item-time",children:zR(C.createdAt)})]}),!C.read&&a.jsx("div",{className:"notification-widget-item-dot"})]},C.id))}):a.jsx("div",{className:"notification-widget-empty",children:"No new notifications"}),a.jsx("div",{className:"notification-widget-footer",children:a.jsxs(Jt,{to:"/notifications",className:"notification-widget-view-all",onClick:()=>h(!1),children:["View all notifications ",a.jsx(zy,{size:14})]})})]}),a.jsx(P1,{open:y.open,campaignName:y.notification?.campaign?.name||"",onSwitch:N,onCancel:j})]})}const BR=(e={})=>{const t=new URLSearchParams,r=e.viewAsCharacterId??e.characterId??e.character_id??e.viewAs;if(r!=null){const i=String(r).trim();i&&t.set("viewAsCharacterId",i)}return t.toString()},oc=(e,t={})=>{if(!e)return Promise.reject(new Error("worldId is required to load entities"));const r=new URLSearchParams,i=BR(t);i&&r.set("viewAsCharacterId",new URLSearchParams(i).get("viewAsCharacterId")),t.importance!==void 0&&t.importance!==null&&(Array.isArray(t.importance)?t.importance:[t.importance]).forEach(m=>{m!=null&&r.append("importance[]",m)});const l=r.toString(),c=l?`?${l}`:"";return _t.get(`/worlds/${e}/entities${c}`)},UR=()=>_t.get("/entities/unassigned"),rr=e=>_t.get(`/entities/${e}`),of=({worldId:e,query:t,typeIds:r=[],limit:i=20,offset:l=0})=>{if(!e)return Promise.reject(new Error("worldId is required"));const c=new URLSearchParams;c.set("worldId",e),t&&c.set("q",t),(Array.isArray(r)?r:[r]).map(h=>h==null?"":String(h).trim()).filter(Boolean).forEach(h=>{c.append("typeIds[]",h)}),i!=null&&c.set("limit",i),l!=null&&c.set("offset",l);const m=c.toString();return _t.get(`/entities/search${m?`?${m}`:""}`)},qR=({query:e,campaignId:t,worldId:r,limit:i=20,offset:l=0})=>{const c=new URLSearchParams;e&&c.set("q",e),t&&c.set("campaignId",t),r&&c.set("worldId",r),i!=null&&c.set("limit",i),l!=null&&c.set("offset",l);const f=c.toString();return _t.get(`/entities/global-search${f?`?${f}`:""}`)},Hy=e=>_t.post("/entities",e),Py=(e,t)=>_t.patch(`/entities/${e}`,t),HR=(e,t)=>_t.patch(`/entities/${e}/importance`,{importance:t}),PR=e=>_t.delete(`/entities/${e}`),V1=(e,t)=>{if(!e)return Promise.reject(new Error("entityId is required"));if(!t)return Promise.reject(new Error("file is required"));const r=new FormData;return r.append("file",t),_t.post(`/entities/${e}/image`,r)},Y1=e=>e?_t.delete(`/entities/${e}/image`):Promise.reject(new Error("entityId is required")),VR=(e,t)=>_t.post(`/entities/${e}/secrets`,t),YR=(e,t,r)=>_t.patch(`/entities/${e}/secrets/${t}`,r),GR=(e,t={})=>{const r=new URLSearchParams,i=t.campaignId??t.campaign_id;i&&r.set("campaignId",i);const l=r.toString();return _t.get(`/entities/${e}/notes${l?`?${l}`:""}`)},XR=(e,t={})=>{const r=new URLSearchParams,i=t.campaignId??t.campaign_id;i&&r.set("campaignId",i);const l=r.toString();return _t.get(`/entities/${e}/mentions/entity-notes${l?`?${l}`:""}`)},KR=(e,t={})=>{const r=new URLSearchParams,i=t.campaignId??t.campaign_id;i&&r.set("campaignId",i);const l=r.toString();return _t.get(`/entities/${e}/mentions/session-notes${l?`?${l}`:""}`)},WR=(e,t)=>_t.post(`/entities/${e}/notes`,t),G1=(e,t,r)=>_t.patch(`/entities/${e}/notes/${t}`,r),X1=(e,t,r={})=>{const i=new URLSearchParams,l=r.campaignId??r.campaign_id;l&&i.set("campaignId",l);const c=i.toString();return _t.delete(`/entities/${e}/notes/${t}${c?`?${c}`:""}`)},ZR=async(e,t=1)=>{const r=new URLSearchParams;if(t!=null){const c=Number(t);!Number.isNaN(c)&&c>0&&r.set("depth",String(c))}const i=r.toString(),l=await _t.get(`/entities/${e}/graph${i?`?${i}`:""}`,{credentials:"include"});if(!l?.success)throw new Error(l?.message||"Failed to load graph");return l.data},QR=300,JR=(e,t)=>{const[r,i]=u.useState(e);return u.useEffect(()=>{const l=setTimeout(()=>i(e),t);return()=>clearTimeout(l)},[e,t]),r},Bu=e=>({name:"Name",description:"Description",notes:"Notes",mentions:"Mentions",relationships:"Relationships",title:"Title",content:"Content"})[e]||e;function q0({isMobile:e,onClose:t}){const r=zn(),{selectedCampaignId:i,activeWorldId:l}=Bn(),[c,f]=u.useState(""),m=!!(i||l),[h,p]=u.useState({entities:[],sessionNotes:[]}),[y,g]=u.useState(!1),[v,S]=u.useState(""),[w,N]=u.useState(-1),[j,_]=u.useState(!1),C=JR(c,QR),O=u.useRef(null),E=u.useRef(null),T=u.useRef(0),M=u.useMemo(()=>{const F=[];return h.entities.forEach(D=>{F.push({type:"entity",data:D})}),h.sessionNotes.forEach(D=>{F.push({type:"sessionNote",data:D})}),F},[h]),A=M.length>0,z=j&&(c.trim().length>0||A),P=u.useCallback(async F=>{if(!F.trim()){p({entities:[],sessionNotes:[]}),g(!1);return}if(!m){S("Please select a campaign or world context to search"),p({entities:[],sessionNotes:[]}),g(!1);return}const D=++T.current;g(!0),S("");try{const L=await qR({query:F,campaignId:i,worldId:l,limit:20,offset:0});if(D!==T.current)return;const B=L?.data||{entities:[],sessionNotes:[]};p({entities:Array.isArray(B.entities)?B.entities:[],sessionNotes:Array.isArray(B.sessionNotes)?B.sessionNotes:[]})}catch(L){if(D!==T.current)return;S(L.message||"Failed to search"),p({entities:[],sessionNotes:[]})}finally{D===T.current&&g(!1)}},[l,i,m]);u.useEffect(()=>{C.trim().length>0?P(C):(p({entities:[],sessionNotes:[]}),g(!1))},[C,P]),u.useEffect(()=>{j&&E.current&&!e&&E.current.focus()},[j,e]),u.useEffect(()=>{const F=D=>{O.current&&!O.current.contains(D.target)&&(e||_(!1))};if(j)return document.addEventListener("mousedown",F),()=>document.removeEventListener("mousedown",F)},[j,e]),u.useEffect(()=>{const F=D=>{if(z)if(D.key==="ArrowDown")D.preventDefault(),N(L=>L<M.length-1?L+1:L);else if(D.key==="ArrowUp")D.preventDefault(),N(L=>L>0?L-1:-1);else if(D.key==="Enter"&&w>=0){D.preventDefault();const L=M[w];L&&Y(L)}else D.key==="Escape"&&(D.preventDefault(),_(!1),f(""),e&&t&&t())};if(z)return document.addEventListener("keydown",F),()=>document.removeEventListener("keydown",F)},[z,w,M,e,t]);const X=F=>{f(F.target.value),N(-1),j||_(!0)},H=()=>{_(!0)},Y=F=>{F.type==="entity"?r(`/entities/${F.data.id}`):F.type==="sessionNote"&&r(`/campaigns/${i}/session-notes`),_(!1),f(""),e&&t&&t()},V=()=>{f(""),p({entities:[],sessionNotes:[]}),N(-1),e&&t&&t()},I=F=>{if(!F)return"";try{return new Date(F).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return F}};return e?a.jsxs("div",{className:"global-search-mobile",children:[a.jsx("div",{className:"global-search-mobile-overlay",onClick:t}),a.jsxs("div",{className:"global-search-mobile-content",children:[a.jsxs("div",{className:`global-search-input-wrapper ${m?"":"disabled"}`,children:[a.jsx(ic,{size:20,className:"global-search-icon"}),a.jsx("input",{ref:E,type:"text",className:"global-search-input",placeholder:m?"Search entities and session notes...":"Select a campaign or world to search",value:c,onChange:X,onFocus:H,disabled:!m,autoFocus:!0}),c&&a.jsx("button",{type:"button",className:"global-search-clear",onClick:V,"aria-label":"Clear search",children:a.jsx(Ra,{size:16})})]}),z&&a.jsxs("div",{className:"global-search-results",children:[y&&a.jsx("div",{className:"global-search-loading",children:a.jsx("span",{children:"Searching..."})}),!y&&v&&a.jsx("div",{className:"global-search-error",children:a.jsx("span",{children:v})}),!y&&!v&&!A&&c.trim().length>0&&a.jsx("div",{className:"global-search-empty",children:a.jsx("span",{children:"No results found"})}),!y&&!v&&A&&a.jsx("div",{className:"global-search-results-list",children:M.map((F,D)=>a.jsx("button",{type:"button",className:`global-search-result-item ${D===w?"selected":""}`,onClick:()=>Y(F),children:F.type==="entity"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"global-search-result-header",children:[a.jsx("span",{className:"global-search-result-name",children:F.data.name}),F.data.typeName&&a.jsx("span",{className:"global-search-result-type",children:F.data.typeName})]}),a.jsx("div",{className:"global-search-result-meta",children:a.jsxs("span",{className:"global-search-match-type",children:["Matched in ",Bu(F.data.matchType)]})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"global-search-result-header",children:[a.jsx("span",{className:"global-search-result-name",children:F.data.session_title||"Session Note"}),a.jsx("span",{className:"global-search-result-type",children:"Session Note"})]}),a.jsx("div",{className:"global-search-result-meta",children:a.jsxs("span",{className:"global-search-match-type",children:[I(F.data.session_date),"  Matched in"," ",Bu(F.data.matchType)]})})]})},`${F.type}-${F.data.id}`))})]})]})]}):a.jsxs("div",{className:"global-search",ref:O,children:[a.jsxs("div",{className:`global-search-input-wrapper ${m?"":"disabled"}`,children:[a.jsx(ic,{size:18,className:"global-search-icon"}),a.jsx("input",{ref:E,type:"text",className:"global-search-input",placeholder:m?"Search entities and session notes...":"Select a campaign or world to search",value:c,onChange:X,onFocus:H,disabled:!m}),c&&a.jsx("button",{type:"button",className:"global-search-clear",onClick:V,"aria-label":"Clear search",children:a.jsx(Ra,{size:16})})]}),z&&a.jsxs("div",{className:"global-search-dropdown",children:[y&&a.jsx("div",{className:"global-search-loading",children:a.jsx("span",{children:"Searching..."})}),!y&&v&&a.jsx("div",{className:"global-search-error",children:a.jsx("span",{children:v})}),!y&&!v&&!A&&c.trim().length>0&&a.jsx("div",{className:"global-search-empty",children:a.jsx("span",{children:"No results found"})}),!y&&!v&&A&&a.jsx("div",{className:"global-search-results-list",children:M.map((F,D)=>a.jsx("button",{type:"button",className:`global-search-result-item ${D===w?"selected":""}`,onClick:()=>Y(F),children:F.type==="entity"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"global-search-result-header",children:[a.jsx("span",{className:"global-search-result-name",children:F.data.name}),F.data.typeName&&a.jsx("span",{className:"global-search-result-type",children:F.data.typeName})]}),a.jsx("div",{className:"global-search-result-meta",children:a.jsxs("span",{className:"global-search-match-type",children:["Matched in ",Bu(F.data.matchType)]})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"global-search-result-header",children:[a.jsx("span",{className:"global-search-result-name",children:F.data.session_title||"Session Note"}),a.jsx("span",{className:"global-search-result-type",children:"Session Note"})]}),a.jsx("div",{className:"global-search-result-meta",children:a.jsxs("span",{className:"global-search-match-type",children:[I(F.data.session_date),"  Matched in"," ",Bu(F.data.matchType)]})})]})},`${F.type}-${F.data.id}`))})]})]})}function ek({onMenuToggle:e}){const[t,r]=u.useState(!1),i=u.useRef(null),{user:l,logout:c}=En(),{theme:f,toggleTheme:m}=nR(),{campaigns:h,selectedCampaignId:p,setSelectedCampaignId:y,selectedCampaign:g,loading:v,error:S,worlds:w,selectedWorld:N,selectedWorldId:j,setSelectedWorldId:_,worldLoading:C,worldError:O,viewAsCharacterId:E,setViewAsCharacterId:T}=Bn();u.useEffect(()=>{const qe=We=>{i.current&&!i.current.contains(We.target)&&r(!1)};return document.addEventListener("mousedown",qe),()=>document.removeEventListener("mousedown",qe)},[]);const M=qe=>{y(qe.target.value)},A=qe=>{_(qe.target.value)},z=Uy(),[P,X]=u.useState([]),[H,Y]=u.useState(!1),[V,I]=u.useState(""),[F,D]=u.useState(!1),[L,B]=u.useState(!1),[k,U]=u.useState(!1),R=u.useMemo(()=>!g||!l?"":g.members?.find(We=>We?.user_id===l.id)?.role||"",[g,l]),q=u.useMemo(()=>{if(!g?.world)return"";const qe=g.world;return qe.created_by||qe.creator?.id||qe.owner_id||qe.owner?.id||""},[g]),G=u.useMemo(()=>!p||!l?!1:l.role==="system_admin"||R==="dm"?!0:q?String(q)===String(l.id):!1,[R,p,q,l]);u.useEffect(()=>{G||T("")},[G,T]),u.useEffect(()=>{let qe=!1;if(!G||!p){X([]),Y(!1),I("");return}return(async()=>{Y(!0),I("");try{const ke=await Ds({scope:"others",campaign_id:p}),xt=Array.isArray(ke?.data)?ke.data:Array.isArray(ke)?ke:[];if(qe)return;const Mt=xt.map(Ct=>{if(!Ct?.id)return null;const At=Ct.name||"Unnamed character",He=Ct.player?.username||Ct.player?.email||Ct.player?.name||"";return{id:String(Ct.id),label:He?`${At} (${He})`:At}}).filter(Boolean).sort((Ct,At)=>Ct.label.localeCompare(At.label,void 0,{sensitivity:"base"}));X(Mt)}catch(ke){qe||(console.error(" Failed to load characters for view-as context",ke),X([]),I(ke.message||"Unable to load characters"),T(""))}finally{qe||Y(!1)}})(),()=>{qe=!0}},[G,p,T]);const J=u.useMemo(()=>{if(H)return"Loading characters";if(V)return V;if(!E)return"Viewing entities as yourself (DM/owner)";const qe=P.find(We=>We.id===E);return qe?`Viewing as ${qe.label}`:"Viewing as selected character"},[E,P,V,H]),ie=u.useMemo(()=>v?"Loading campaigns":S?"Unable to load campaigns":h.length?g?`${g.name}${g.world?.name?`  ${g.world.name}`:""}`:"Select a campaign":"No eligible campaigns",[h,S,v,g]),Z=u.useMemo(()=>g?.world?g.world.name?`Campaign world  ${g.world.name}`:"Campaign world selected":C?"Loading worlds":O?"Unable to load worlds":w.length?N?N.name?`World  ${N.name}`:"Selected world":"Select a world":"No accessible worlds",[g,N,C,O,w.length]),me=u.useMemo(()=>{const qe=new Set,We=[];if(w.forEach(ke=>{if(!ke?.id)return;const xt=String(ke.id);qe.has(xt)||(We.push({id:xt,name:ke.name||`World #${xt}`}),qe.add(xt))}),g?.world?.id){const ke=String(g.world.id);qe.has(ke)||We.unshift({id:ke,name:g.world.name||"Campaign world"})}return We},[w,g]);u.useEffect(()=>{z||D(!1)},[z]);const Q=qe=>{if(!l)return"";const We=qe?.members?.find(ke=>ke.user_id===l.id);return We?We.role==="dm"?"DM":We.role==="player"?"Player":We.role||"":l.role==="system_admin"?"System Admin":""},ue=()=>D(!1),ne=a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"campaign-selector",title:ie,children:[a.jsx("label",{htmlFor:"campaign-context-select",children:"Campaign"}),a.jsxs("select",{id:"campaign-context-select",value:p,onChange:M,disabled:v||!h.length&&!p,children:[a.jsx("option",{value:"",children:v?"Loading campaigns":S?"Unable to load campaigns":h.length?"Select a campaign":"No campaigns available"}),h.map(qe=>{const We=Q(qe),ke=[We?`as ${We}`:null,qe.world?.name?`World: ${qe.world.name}`:null].filter(Boolean).join("  "),xt=ke?`${qe.name} (${ke})`:qe.name;return a.jsx("option",{value:qe.id,children:xt},qe.id)})]})]}),a.jsxs("div",{className:"campaign-selector",title:Z,children:[a.jsx("label",{htmlFor:"world-context-select",children:"World"}),a.jsxs("select",{id:"world-context-select",value:j,onChange:A,disabled:C,children:[a.jsx("option",{value:"",children:g?.world?g.world.name?`Using ${g.world.name}`:"Using campaign world":C?"Loading worlds":O?"Unable to load worlds":w.length?"Select a world":"No worlds available"}),me.map(qe=>a.jsx("option",{value:qe.id,children:qe.name},qe.id))]})]}),G&&a.jsxs("div",{className:"campaign-selector",title:J,children:[a.jsx("label",{htmlFor:"character-context-select",children:"View as"}),a.jsxs("select",{id:"character-context-select",value:E,onChange:qe=>T(qe.target.value),disabled:H||!!V,children:[a.jsx("option",{value:"",children:H?"Loading characters":V||"Entire campaign context"}),P.map(qe=>a.jsx("option",{value:qe.id,children:qe.label},qe.id))]})]})]}),we=a.jsx("button",{type:"button",className:`menu-btn ${z?"menu-btn-icon":"menu-btn-text"}`,onClick:e,"aria-label":z?"Toggle navigation menu":void 0,children:z?a.jsx(GT,{size:20}):"Menu"}),Pe=a.jsx("button",{type:"button",className:`history-btn ${z?"history-btn-icon":"history-btn-text"}`,title:"View recently viewed records","aria-label":z?"Open history":void 0,onClick:()=>B(!0),children:z?a.jsx($y,{size:20}):"History"}),Re=a.jsx("button",{type:"button",className:`context-btn ${z?"context-btn-icon":"context-btn-text"}`,onClick:()=>D(!0),"aria-label":z?"Change context":void 0,title:z?"Change context":void 0,disabled:!z,children:z?a.jsx(_1,{size:20}):"Context"}),Ce=!!(p||j),it=a.jsx("button",{type:"button",className:`search-btn ${z?"search-btn-icon":"search-btn-text"} ${Ce?"":"disabled"}`,onClick:()=>Ce&&U(!0),"aria-label":z?"Open search":void 0,title:z?Ce?"Open search":"Select a campaign or world to search":void 0,disabled:!Ce,children:z?a.jsx(ic,{size:20}):"Search"});return a.jsxs("header",{className:"app-header",children:[a.jsx("div",{className:"header-start",children:z?a.jsxs(a.Fragment,{children:[a.jsx("h1",{className:"title",children:a.jsx(Jt,{to:"/",className:"title-link",children:"GameDB"})}),we,Re,it,Pe]}):a.jsxs(a.Fragment,{children:[a.jsx("h1",{className:"title",children:a.jsx(Jt,{to:"/",className:"title-link",children:"GameDB"})}),we,Pe]})}),!z&&a.jsxs("div",{className:"header-center",children:[ne,(p||j)&&a.jsx(q0,{isMobile:!1})]}),a.jsx("div",{className:"header-end",children:a.jsx(FR,{})}),a.jsxs("div",{className:"user-menu",ref:i,children:[a.jsx("button",{className:"user-icon",onClick:()=>r(!t),title:"User Menu",children:a.jsx(kM,{size:20})}),t&&a.jsxs("div",{className:"user-dropdown",children:[a.jsxs("div",{className:"user-info",children:[a.jsx("strong",{children:l?.username||"User"}),a.jsx("br",{}),a.jsx("small",{children:l?.role||""})]}),a.jsxs("button",{className:"dropdown-action",onClick:m,children:[f==="dark"?a.jsx(wM,{size:16}):a.jsx(QT,{size:16}),f==="dark"?"Light mode":"Dark mode"]}),a.jsxs(Jt,{to:"/security",className:"dropdown-action",onClick:()=>r(!1),children:[a.jsx(HT,{size:16}),"Security"]}),a.jsxs("button",{className:"dropdown-action logout",onClick:c,children:[a.jsx(UT,{size:16}),"Logout"]})]})]}),z&&F&&a.jsxs("div",{className:"mobile-context-overlay",role:"dialog","aria-modal":"true",children:[a.jsx("button",{className:"mobile-context-overlay-close",onClick:ue,"aria-label":"Close context picker"}),a.jsxs("div",{className:"mobile-context-panel",children:[a.jsxs("div",{className:"mobile-context-header",children:[a.jsx("h2",{children:"Choose context"}),a.jsx("button",{type:"button",onClick:ue,"aria-label":"Close context picker",children:a.jsx(Ra,{size:20})})]}),a.jsx("div",{className:"mobile-context-body",children:ne})]})]}),a.jsx(NR,{isOpen:L,onClose:()=>B(!1)}),z&&k&&a.jsx(q0,{isMobile:!0,onClose:()=>U(!1)})]})}const tk=e=>e==null?"":String(e).trim(),Qr=e=>{let t={};typeof e=="string"?t={worldId:e}:e&&typeof e=="object"&&!Array.isArray(e)&&(t={...e});const r=new URLSearchParams,i=tk(t.worldId??t.world_id);if(!i)return Promise.reject(new Error("worldId is required to list entity types"));r.set("worldId",i);const l=r.toString(),c=l?`?${l}`:"";return _t.get(`/entity-types${c}`)},nk=e=>_t.post("/entity-types",e),ak=e=>_t.get(`/entity-types/${e}`),sk=(e,t)=>_t.patch(`/entity-types/${e}`,t),rk=e=>_t.delete(`/entity-types/${e}`),cf=(e,t="perform this action")=>e==null||e===""?Promise.reject(new Error(`Entity type id is required to ${t}`)):null,uf=e=>{const t=cf(e,"load entity type field order");return t||_t.get(`/entity-types/${e}/field-order`)},ik=(e,t)=>{const r=cf(e,"update entity type field order");return r||_t.put(`/entity-types/${e}/field-order`,t)},df=e=>{const t=cf(e,"load entity type field rules");return t||_t.get(`/entity-types/${e}/field-rules`)},lk=(e,t)=>{const r=cf(e,"create entity type field rule");return r||_t.post(`/entity-types/${e}/field-rules`,t)},K1=(e,t="perform this action")=>e==null||e===""?Promise.reject(new Error(`Field rule id is required to ${t}`)):null,Bh=(e,t)=>{const r=K1(e,"update this field rule");return r||_t.patch(`/entity-type-field-rules/${e}`,t)},ok=e=>{const t=K1(e,"delete this field rule");return t||_t.delete(`/entity-type-field-rules/${e}`)},W1=(e,t={})=>{if(!e)return Promise.reject(new Error("worldId is required to load entity type usage"));const r=new URLSearchParams,i=t.viewAsCharacterId??t.characterId??t.character_id??t.viewAs;if(i!=null){const f=String(i).trim();f&&r.set("viewAsCharacterId",f)}const l=r.toString(),c=l?`?${l}`:"";return _t.get(`/worlds/${e}/entity-types${c}`)},ck=e=>_t.get(`/entity-types/${e}/list-columns`),uk=(e,t)=>_t.patch(`/entity-types/${e}/list-columns`,t);function dk({open:e,pinned:t,allowPinning:r=!0,onPinToggle:i,onClose:l}){const c=Ya(),{user:f}=En(),{selectedCampaign:m,selectedCampaignId:h,activeWorld:p,activeWorldId:y,viewAsCharacterId:g,contextKey:v}=Bn(),[S,w]=u.useState(!1),[N,j]=u.useState(!1),[_,C]=u.useState(!1),[O,E]=u.useState(!1),[T,M]=u.useState(!1),[A,z]=u.useState([]),[P,X]=u.useState(!1),[H,Y]=u.useState("");u.useEffect(()=>{z([]),Y("")},[v]);const I=u.useMemo(()=>new URLSearchParams(c.search),[c.search]).get("entityType")??"",F=c.pathname==="/entities"||c.pathname.startsWith("/entities/"),D=y||"",L=f?.role==="system_admin",B=!!y,k=u.useMemo(()=>!m||!f?"":m.members?.find(Ce=>Ce?.user_id===f.id)?.role??"",[m,f]),U=u.useMemo(()=>{if(!p||!f?.id)return!1;const Re=p.created_by??p.creator?.id??p.owner_id??p.owner?.id??"";return Re?String(Re)===String(f.id):!1},[p,f?.id]),R=!!(B&&(L||k==="dm"||U)),q=!!(B&&(L||U)),G=!!(B&&(L||U)),J=!!(B&&(L||U)),ie=!!(B&&U),Z=u.useMemo(()=>!m||!Array.isArray(m.members)||!f?.id?!1:m.members.some(Re=>Re?.user_id===f.id&&Re?.role==="player"),[m,f]),me=u.useMemo(()=>!m||!Array.isArray(m.members)||!f?.id?!1:m.members.some(Re=>Re?.user_id===f.id&&Re?.role==="dm"),[m,f]),Q=!!(B&&(R||q||G||J||ie)),ue=u.useMemo(()=>h?L?!0:me||Z:!1,[L,me,Z,h]);u.useEffect(()=>{let Re=!1;if(!D){z([]),Y(""),X(!1);return}return(async()=>{X(!0),Y("");try{const it=await W1(D,{viewAsCharacterId:g}),qe=Array.isArray(it?.data)?it.data:Array.isArray(it)?it:[];Re||z(qe)}catch(it){Re||(console.error(" Failed to load entity types for world",it),z([]),Y("Unable to load entity types"))}finally{Re||X(!1)}})(),()=>{Re=!0}},[D,v,g]);const ne=u.useCallback(Re=>Re==="/"?c.pathname==="/":c.pathname===Re||c.pathname.startsWith(`${Re}/`),[c.pathname]),we=u.useCallback(Re=>{B||(Re.preventDefault(),alert("Please select a campaign or world context before viewing entities."))},[B]),Pe=u.useCallback(Re=>{if(t||Re.defaultPrevented)return;const Ce=Re.target,it=Ce instanceof Element?Ce:Ce?.parentElement;if(!it||typeof it.closest!="function")return;const qe=it.closest("a");qe&&Re.currentTarget.contains(qe)&&l()},[t,l]);return a.jsxs("aside",{className:`sidebar ${e?"open":"closed"}`,children:[a.jsxs("div",{className:"sidebar-header",children:[a.jsx("span",{children:"Navigation"}),r&&a.jsx("button",{type:"button",className:`pin-btn ${t?"pinned":""}`,title:t?"Unpin menu":"Pin menu","aria-pressed":t,onClick:i,children:a.jsx(rM,{size:16,className:"pin-icon"})})]}),a.jsxs("nav",{className:"nav-links",onClick:t?void 0:Pe,children:[a.jsx(Jt,{to:"/",className:ne("/")?"active":"",children:"Home"}),a.jsx(Jt,{to:"/worlds",className:ne("/worlds")?"active":"",children:"Worlds"}),Q&&a.jsxs("div",{className:`nav-group ${_?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>C(Re=>!Re),"aria-expanded":!_,"aria-controls":"world-admin-nav",children:[a.jsx("span",{className:"nav-heading",children:"World Admin"}),a.jsx(Ur,{size:14,className:`nav-heading-icon ${_?"collapsed":""}`})]}),a.jsxs("div",{id:"world-admin-nav",className:"nav-sub-links",children:[R&&a.jsxs(Jt,{to:"/entities",className:`nav-entity-link ${F&&!I?"active":""}`,onClick:we,children:[a.jsx(O0,{size:16,className:"nav-icon"}),a.jsx("span",{children:"All Entities"})]}),R&&a.jsxs(Jt,{to:"/entity-relationships",className:`nav-entity-link ${ne("/entity-relationships")?"active":""}`,children:[a.jsx(z0,{size:16,className:"nav-icon"}),a.jsx("span",{children:"All Relationships"})]}),q&&a.jsxs(Jt,{to:"/entity-types",className:`nav-entity-link ${ne("/entity-types")?"active":""}`,children:[a.jsx(hM,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Entity Types"})]}),G&&a.jsxs(Jt,{to:"/entities/bulk-upload",className:`nav-entity-link ${ne("/entities/bulk-upload")?"active":""}`,children:[a.jsx(O0,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Bulk Entity Upload"})]}),J&&a.jsxs(Jt,{to:"/relationship-types",className:`nav-entity-link ${ne("/relationship-types")?"active":""}`,children:[a.jsx(z0,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Relationship Types"})]}),ie&&D&&a.jsxs(Jt,{to:`/worlds/${D}/access/bulk`,className:`nav-entity-link ${ne(`/worlds/${D}/access/bulk`)?"active":""}`,children:[a.jsx(R1,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Bulk Access Editor"})]}),ie&&D&&a.jsxs(Jt,{to:`/worlds/${D}/collections`,className:`nav-entity-link ${ne(`/worlds/${D}/collections`)?"active":""}`,children:[a.jsx(_1,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Collections"})]}),ie&&D&&a.jsxs(Jt,{to:`/worlds/${D}/access/audit`,className:`nav-entity-link ${ne(`/worlds/${D}/access/audit`)?"active":""}`,children:[a.jsx(j1,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Access Audit Log"})]}),U&&!B&&a.jsx("span",{className:"nav-helper",children:"Select a world you own to use the bulk access tools"})]})]}),a.jsxs("div",{className:`nav-group ${S?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>w(Re=>!Re),"aria-expanded":!S,"aria-controls":"campaigns-nav",children:[a.jsx("span",{className:"nav-heading",children:"Campaigns"}),a.jsx(Ur,{size:14,className:`nav-heading-icon ${S?"collapsed":""}`})]}),a.jsxs("div",{id:"campaigns-nav",className:"nav-sub-links",children:[a.jsx(Jt,{to:"/campaigns/my",className:ne("/campaigns/my")?"active":"",children:"My Campaigns"}),a.jsx(Jt,{to:"/campaigns/all",className:ne("/campaigns/all")?"active":"",children:"All"})]})]}),a.jsxs("div",{className:`nav-group ${O?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>E(Re=>!Re),"aria-expanded":!O,"aria-controls":"entities-nav",children:[a.jsx("span",{className:"nav-heading",children:"Entities"}),a.jsx(Ur,{size:14,className:`nav-heading-icon ${O?"collapsed":""}`})]}),a.jsxs("div",{id:"entities-nav",className:"nav-sub-links",children:[P&&a.jsx("span",{className:"nav-helper",children:"Loading entity types"}),!P&&H&&a.jsx("span",{className:"nav-helper error",children:H}),!P&&!H&&A.length===0&&a.jsx("span",{className:"nav-helper",children:B?"No entities in this world yet":"Select a campaign or world context to see entity types"}),A.map(Re=>a.jsxs(Jt,{to:`/entities?entityType=${Re.id}`,className:`nav-entity-type ${F&&I===Re.id?"active":""}`,children:[a.jsx("span",{className:"nav-entity-label",children:Re.name}),a.jsx("span",{className:"nav-entity-count",children:Re.entityCount})]},Re.id))]})]}),a.jsxs("div",{className:`nav-group ${T?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>M(Re=>!Re),"aria-expanded":!T,"aria-controls":"notes-nav",children:[a.jsx("span",{className:"nav-heading",children:"Notes"}),a.jsx(Ur,{size:14,className:`nav-heading-icon ${T?"collapsed":""}`})]}),a.jsxs("div",{id:"notes-nav",className:"nav-sub-links",children:[!h&&a.jsx("span",{className:"nav-helper",children:"Select a campaign to view notes"}),h&&!ue&&a.jsx("span",{className:"nav-helper",children:"Notes are available to campaign members"}),ue&&a.jsxs(a.Fragment,{children:[a.jsxs(Jt,{to:"/notes/session",className:ne("/notes/session")?"active":"",children:[a.jsx(Hp,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Session Notes"})]}),a.jsxs(Jt,{to:"/notes/entities",className:ne("/notes/entities")?"active":"",children:[a.jsx(qp,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Entity Notes"})]})]})]})]}),a.jsxs("div",{className:`nav-group ${N?"collapsed":""}`,children:[a.jsxs("button",{type:"button",className:"nav-heading-btn",onClick:()=>j(Re=>!Re),"aria-expanded":!N,"aria-controls":"characters-nav",children:[a.jsx("span",{className:"nav-heading",children:"Characters"}),a.jsx(Ur,{size:14,className:`nav-heading-icon ${N?"collapsed":""}`})]}),a.jsxs("div",{id:"characters-nav",className:"nav-sub-links",children:[a.jsx(Jt,{to:"/characters/my",className:ne("/characters/my")?"active":"",children:"My Characters"}),h&&Z&&a.jsx(Jt,{to:"/characters/companions",className:ne("/characters/companions")?"active":"",children:"My Companions"}),h&&me&&a.jsx(Jt,{to:"/characters/others",className:ne("/characters/others")?"active":"",children:"All Characters"}),f?.role==="system_admin"&&a.jsx(Jt,{to:"/characters/all",className:ne("/characters/all")?"active admin-link":"admin-link",children:"All Characters"})]})]}),a.jsxs(Jt,{to:"/requests",className:ne("/requests")?"active":"",children:[a.jsx(qp,{size:16,className:"nav-icon"}),a.jsx("span",{children:"Feature/Bugs"})]}),f?.role==="system_admin"&&a.jsx(Jt,{to:"/users",className:c.pathname==="/users"?"active admin-link":"admin-link",title:"User Management (Admin Only)",children:"Users"})]})]})}function fk(){const e=()=>typeof window>"u"?!1:window.matchMedia("(max-width: 768px)").matches,[t,r]=u.useState(e),[i,l]=u.useState(()=>!e()),[c,f]=u.useState(!1),m=Ya(),h=u.useRef(i),p=u.useRef(!0);u.useEffect(()=>{if(typeof window>"u")return;const N=window.matchMedia("(max-width: 768px)"),j=_=>{r(_.matches)};return r(N.matches),typeof N.addEventListener=="function"?(N.addEventListener("change",j),()=>N.removeEventListener("change",j)):(N.addListener(j),()=>N.removeListener(j))},[]),u.useEffect(()=>{if(t)l(!1),f(!1);else{const N=p.current;l(N),f(j=>N?!1:j)}},[t]);const y=u.useCallback(()=>{f(N=>!N)},[]),g=u.useCallback(()=>{t||l(N=>{const j=!N;return p.current=j,f(!j),j})},[t]);u.useEffect(()=>{h.current=i},[i]),u.useEffect(()=>{if(i||!c)return;const N=j=>{const _=j.target;(_ instanceof Element?_:_&&"parentElement"in _?_.parentElement:null)?.closest?.(".sidebar")||f(!1)};return document.addEventListener("mousedown",N),()=>{document.removeEventListener("mousedown",N)}},[i,c]),u.useEffect(()=>{h.current||f(!1)},[m.pathname,m.search]);const v=(m.pathname||"").match(/^\/entities\/([^/]+)\/?$/),S=!!(v&&v[1]!=="bulk-upload"),w=["content",i?"pinned":"",S?"content--entity-detail":""].filter(Boolean).join(" ");return a.jsxs("div",{className:"app-shell",children:[a.jsx(ek,{onMenuToggle:y}),a.jsxs("div",{className:"app-body",children:[a.jsx(dk,{open:c||i,pinned:i,allowPinning:!t,onPinToggle:g,onClose:()=>f(!1)}),!i&&c&&a.jsx("button",{type:"button",className:"sidebar-overlay","aria-label":"Close navigation menu",onClick:()=>f(!1)}),a.jsxs("main",{className:w,children:[a.jsx(o2,{})," "]})]})]})}const Uu={dm:1,player:2,other:3},mk=(e,t)=>!e||!Array.isArray(e.members)||!t?null:e.members.find(r=>r?.user_id===t)??null;function hk(){const{user:e}=En(),{campaigns:t,loading:r,error:i,selectedCampaignId:l,setSelectedCampaignId:c,selectedCampaign:f,refreshCampaigns:m}=Bn(),h=e?.username||"Adventurer",[p,y]=u.useState([]),[g,v]=u.useState([]),[S,w]=u.useState(!1),[N,j]=u.useState(!1),[_,C]=u.useState(""),[O,E]=u.useState(""),T=u.useMemo(()=>Array.isArray(t)?[...t].map(H=>({campaign:H,membership:mk(H,e?.id)})).sort((H,Y)=>{const V=Uu[H.membership?.role]??Uu.other,I=Uu[Y.membership?.role]??Uu.other;return V!==I?V-I:H.campaign.name.localeCompare(Y.campaign.name)}):[],[t,e?.id]),M=H=>{H&&c(String(H))};u.useEffect(()=>{let H=!1;if(y([]),v([]),C(""),E(""),!l||!e?.id)return w(!1),j(!1),()=>{H=!0};const Y=I=>(Array.isArray(I?.data)?I.data:Array.isArray(I)?I:[]).map(D=>{const L=Number(D?.level);return{id:D?.id,name:D?.name||"Unnamed character",className:D?.class||"",level:Number.isNaN(L)?null:L,isActive:D?.is_active??!0,playerName:D?.player?.username||""}});return(async()=>{w(!0),j(!1);try{const I=await Ds({scope:"my",campaign_id:l});if(H)return;const F=Y(I);if(y(F),C(""),w(!1),F.length>0){j(!0);try{const D=await Ds({scope:"companions",campaign_id:l});if(H)return;const L=Y(D);v(L),E("")}catch(D){if(H)return;console.error(" Failed to load companions for home widgets",D),v([]),E(D.message||"Failed to load companions")}finally{H||j(!1)}}else v([]),E(""),j(!1)}catch(I){if(H)return;console.error(" Failed to load characters for home widgets",I),y([]),v([]),C(I.message||"Failed to load characters"),E(""),w(!1),j(!1)}})(),()=>{H=!0}},[l,e?.id]);const A=()=>r?a.jsxs("div",{className:"home-empty-state",children:[a.jsx(Nn,{className:"spin",size:24}),a.jsx("p",{children:"Loading your campaigns"})]}):i?a.jsxs("div",{className:"home-empty-state error",children:[a.jsx("p",{children:i}),a.jsx("button",{type:"button",className:"home-refresh",onClick:m,children:"Try again"})]}):T.length?a.jsx("div",{className:"campaign-grid",children:T.map(({campaign:H,membership:Y})=>{const V=String(H.id),I=l===V,F=Y?.role??"guest",D=F==="dm"?"Dungeon Master":F==="player"?"Player":"Observer";return a.jsxs("button",{type:"button",className:`campaign-card ${F} ${I?"active":""}`,onClick:()=>M(V),"aria-pressed":I,children:[a.jsxs("header",{children:[a.jsxs("span",{className:"campaign-role","aria-label":`Role: ${D}`,children:[F==="dm"?a.jsx(xT,{size:18}):a.jsx(EM,{size:18}),D]}),I&&a.jsx("span",{className:"campaign-pill",children:"Active"})]}),a.jsxs("div",{className:"campaign-body",children:[a.jsx("h3",{children:H.name}),H.world?.name&&a.jsxs("p",{className:"campaign-world",children:["World  ",H.world.name]})]}),a.jsx("footer",{children:a.jsx("span",{children:"Set campaign context"})})]},V)})}):a.jsxs("div",{className:"home-empty-state",children:[a.jsx(Ii,{size:24}),a.jsx("p",{children:"No campaigns yet. Join one to get started!"})]}),z=()=>S?a.jsxs("div",{className:"home-widget-empty",children:[a.jsx(Nn,{className:"spin",size:20}),a.jsx("p",{children:"Loading your characters"})]}):_?a.jsx("div",{className:"home-widget-error",children:a.jsx("p",{children:_})}):p.length?a.jsx("div",{className:"home-card-grid",children:p.map(H=>a.jsxs("article",{className:"home-card",children:[a.jsxs("header",{children:[a.jsx("h3",{children:H.name}),a.jsx("span",{className:`home-card-status ${H.isActive?"active":"inactive"}`,children:H.isActive?"Active":"Inactive"})]}),a.jsxs("div",{className:"home-card-meta",children:[H.className&&a.jsx("span",{children:H.className}),H.level!==null&&a.jsxs("span",{children:["Level ",H.level]})]})]},H.id))}):a.jsx("div",{className:"home-widget-empty",children:a.jsx("p",{children:"No characters in this campaign yet."})}),P=()=>N?a.jsxs("div",{className:"home-widget-empty",children:[a.jsx(Nn,{className:"spin",size:20}),a.jsx("p",{children:"Loading companions"})]}):O?a.jsx("div",{className:"home-widget-error",children:a.jsx("p",{children:O})}):g.length?a.jsx("div",{className:"home-card-grid",children:g.map(H=>a.jsxs("article",{className:"home-card",children:[a.jsxs("header",{children:[a.jsx("h3",{children:H.name}),a.jsx("span",{className:`home-card-status ${H.isActive?"active":"inactive"}`,children:H.isActive?"Active":"Inactive"})]}),a.jsxs("div",{className:"home-card-meta",children:[H.className&&a.jsx("span",{children:H.className}),H.level!==null&&a.jsxs("span",{children:["Level ",H.level]})]}),H.playerName&&a.jsxs("p",{className:"home-card-player",children:["Played by ",H.playerName]})]},H.id))}):a.jsx("div",{className:"home-widget-empty",children:a.jsx("p",{children:"No companions discovered in this campaign yet."})}),X=!!f&&p.length>0&&!_;return a.jsxs("div",{className:"home-page",children:[a.jsxs("section",{className:"home-hero",children:[a.jsxs("div",{className:"home-hero-text",children:[a.jsx("p",{className:"home-eyebrow",children:"Your Tabletop Worldbuilding Database"}),a.jsxs("h1",{children:["Welcome, ",h,"."]}),a.jsx("p",{className:"home-description",children:"Select a campaign to explore and build the world."})]}),f&&a.jsxs("div",{className:"home-active-campaign",children:[a.jsx("span",{className:"home-active-label",children:"Currently focused"}),a.jsx("h2",{children:f.name}),f.world?.name&&a.jsx("p",{children:f.world.name})]})]}),a.jsxs("section",{className:"home-section",children:[a.jsxs("div",{className:"home-section-header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"Your campaigns"}),a.jsx("p",{children:"Choose a tile below to update the active campaign context."})]}),a.jsx("button",{type:"button",className:"home-refresh",onClick:m,disabled:r,children:"Refresh"})]}),A()]}),X&&a.jsxs(a.Fragment,{children:[a.jsxs("section",{className:"home-section",children:[a.jsxs("div",{className:"home-section-header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"My Characters"}),a.jsxs("p",{children:["Quick access to your heroes in ",f.name,"."]})]}),a.jsx(Jt,{to:"/characters/my",className:"home-link",children:"Manage"})]}),z()]}),a.jsxs("section",{className:"home-section",children:[a.jsxs("div",{className:"home-section-header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"My Companions"}),a.jsxs("p",{children:["Meet the fellow adventurers journeying in ",f.name,"."]})]}),a.jsx(Jt,{to:"/characters/companions",className:"home-link",children:"View list"})]}),P()]})]})]})}function pk({columns:e,visibleCols:t,onChange:r,onClose:i}){const l=u.useRef(null);u.useEffect(()=>{const m=h=>{l.current&&!l.current.contains(h.target)&&i()};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[i]);const c=m=>{r(t.includes(m)?t.filter(h=>h!==m):[...t,m])},f=()=>{r(e.map(m=>m.key)),i()};return a.jsxs("div",{className:"column-picker",ref:l,children:[a.jsx("div",{className:"column-picker-list",children:e.map(m=>a.jsxs("label",{className:"column-option",children:[a.jsx("input",{type:"checkbox",checked:t.includes(m.key),onChange:()=>c(m.key)}),m.label]},m.key))}),a.jsx("button",{className:"reset-btn",onClick:f,children:"Reset Columns"})]})}function Vy({value:e,onChange:t,placeholder:r="Search...",ariaLabel:i}){return a.jsx("input",{className:"search-input compact",type:"text",placeholder:r,"aria-label":i||r,value:e,onChange:l=>t(l.target.value)})}const yk={text:"string",string:"string",varchar:"string",number:"number",integer:"number",float:"number",decimal:"number",numeric:"number",boolean:"boolean",bool:"boolean",checkbox:"boolean",date:"date",datetime:"date",timestamp:"date"},H0={string:[{value:"contains",label:"contains"},{value:"not_contains",label:"doesn't contain"},{value:"equals",label:"is exactly"},{value:"not_equals",label:"is not"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"}],number:[{value:"equals",label:"is"},{value:"not_equals",label:"is not"},{value:"greater_than",label:"is greater than"},{value:"less_than",label:"is less than"},{value:"greater_or_equal",label:"is on or above"},{value:"less_or_equal",label:"is on or below"}],boolean:[{value:"is_true",label:"is true"},{value:"is_false",label:"is false"}],date:[{value:"on",label:"is on"},{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"on_or_before",label:"is on or before"},{value:"on_or_after",label:"is on or after"}]},ji={logic:"AND",conditions:[]},Fl=e=>{if(!e)return"string";const t=String(e).toLowerCase();return yk[t]||"string"},Xp=e=>{const t=Fl(e);return H0[t]||H0.string},Z1=(e,t="string")=>{if(e==null||e==="")return"Unassigned";const r=Fl(t);if(Array.isArray(e))return e.length?e.map(i=>Z1(i,t)).join(", "):"Unassigned";if(r==="date"){const i=e instanceof Date?e:new Date(e);return Number.isNaN(i.getTime())?String(e):i.toLocaleDateString()}return r==="boolean"?e?"True":"False":String(e)},Rd=e=>{if(e==null||e==="")return null;const t=Number(e);return Number.isNaN(t)?null:t},kd=e=>{if(e==null||e==="")return null;const t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?null:t},Kp=e=>{if(e==null||e==="")return null;if(typeof e=="string"){const t=e.trim();return t.length>0?t:null}if(typeof e=="object"&&!Array.isArray(e)){const t=e.id??e.value??e.key??e.slug??e.uuid??null;return t!=null?String(t).trim():null}if(Array.isArray(e)){for(const t of e){const r=Kp(t);if(r)return r}return null}return null},Q1=e=>{if(e==null)return"";if(typeof e=="string")return e.toLowerCase();if(typeof e=="number")return String(e);if(typeof e=="boolean")return e?"true":"false";if(e instanceof Date)return e.toISOString().toLowerCase();if(Array.isArray(e))return e.map(t=>Q1(t)).filter(Boolean).join(" ");if(typeof e=="object")try{return JSON.stringify(e).toLowerCase()}catch{return""}return String(e).toLowerCase()},gk=e=>{const t=e.trim().toLowerCase();return t?r=>Q1(r).includes(t):()=>!0},bk=(e,t)=>e.localeCompare(t,void 0,{sensitivity:"base"}),vk=(e,t,r="string")=>{const i=Fl(r),l=e==null||e==="",c=t==null||t==="";if(l&&c)return 0;if(l)return 1;if(c)return-1;if(i==="number"){const f=Rd(e),m=Rd(t);return f===null&&m===null?0:f===null?1:m===null?-1:f-m}if(i==="date"){const f=kd(e),m=kd(t);return!f&&!m?0:f?m?f.getTime()-m.getTime():-1:1}if(i==="boolean"){const f=!!e;return f===!!t?0:f?-1:1}return bk(String(e),String(t))},xk=(e,t,r="string")=>{const{operator:i,value:l}=t,c=Fl(r),f=r&&String(r).toLowerCase()==="reference",m=h=>{if(f){const S=Kp(h),w=Kp(l)||String(l??"").trim(),N=S?String(S).toLowerCase():"",j=w?String(w).toLowerCase():"";switch(i){case"equals":return N===j&&N.length>0;case"not_equals":return N!==j||N.length===0;case"contains":return N.includes(j);case"not_contains":return!N.includes(j)}}if(c==="number"){const S=Rd(h),w=Rd(l);if(S===null&&w===null)return i==="equals";if(S===null||w===null)return!1;switch(i){case"equals":return S===w;case"not_equals":return S!==w;case"greater_than":return S>w;case"less_than":return S<w;case"greater_or_equal":return S>=w;case"less_or_equal":return S<=w;default:return!1}}if(c==="date"){const S=kd(h),w=kd(l);if(!S||!w)return!1;switch(i){case"on":return S.getFullYear()===w.getFullYear()&&S.getMonth()===w.getMonth()&&S.getDate()===w.getDate();case"before":return S.getTime()<w.getTime();case"after":return S.getTime()>w.getTime();case"on_or_before":return S.getTime()<=w.getTime();case"on_or_after":return S.getTime()>=w.getTime();default:return!1}}if(c==="boolean"){const S=!!h;return i==="is_true"?S===!0:i==="is_false"?S===!1:i==="equals"?S===(String(l).toLowerCase()==="true"):i==="not_equals"?S!==(String(l).toLowerCase()==="true"):!1}const p=String(h??""),y=String(l??""),g=p.toLowerCase(),v=y.toLowerCase();switch(i){case"contains":return g.includes(v);case"not_contains":return!g.includes(v);case"equals":return g===v;case"not_equals":return g!==v;case"starts_with":return g.startsWith(v);case"ends_with":return g.endsWith(v);default:return!1}};return Array.isArray(e)?e.length===0?m(""):i==="not_contains"?e.every(h=>!m(h)):e.some(h=>m(h)):m(e)},J1=e=>{if(!e||typeof e!="object")return!1;const{conditions:t}=e;return Array.isArray(t)?t.some(r=>r.field&&r.operator):!1},bd=(e="",t="string")=>({id:`condition-${Math.random().toString(36).slice(2)}`,field:e,operator:Xp(t)[0]?.value||"equals",value:""}),P0=(e,t)=>{if(!e||!t||typeof t!="string")return;const r=t.split(".");let i=e;for(const l of r){if(i==null)return;i=i[l]}return i},Io=e=>Array.isArray(e)?e:[],Sk=(e=[])=>e.map(t=>({...t,dataType:Fl(t.dataType||t.type)})),wk={};function eN(e,t=wk){const r=u.useMemo(()=>Sk(t.columns||[]),[t.columns]),i=u.useMemo(()=>new Map(r.map(L=>[L.key,L])),[r]),l=u.useCallback((L,B)=>{const k=i.get(B)||{};return typeof k.accessor=="function"?k.accessor(L):k.path?P0(L,k.path):P0(L,B)??L?.[B]},[i]),[c,f]=u.useState(""),[m,h]=u.useState({key:"",direction:"asc"}),[p,y]=u.useState(""),[g,v]=u.useState(ji),[S,w]=u.useState(new Set),N=u.useCallback(()=>{w(new Set)},[]),j=u.useCallback(L=>{L&&h(B=>{if(B.key===L){const k=B.direction==="asc"?"desc":"asc";return{key:L,direction:k}}return{key:L,direction:"asc"}})},[]),_=u.useCallback(L=>{y(B=>{const k=B===L?"":L;return k!==B&&N(),k})},[N]),C=u.useMemo(()=>gk(c),[c]),O=u.useMemo(()=>r.filter(L=>L.searchable!==!1),[r]),E=u.useMemo(()=>{if(!c)return Io(e);const L=C;return Io(e).filter(B=>O.some(k=>{const U=l(B,k.key);return L(U)}))},[e,C,l,O,c]),T=u.useMemo(()=>g||ji,[g]),M=u.useMemo(()=>Io(T.conditions),[T]),A=(T.logic||"AND").toUpperCase()==="OR"?"OR":"AND",z=J1(T),P=u.useMemo(()=>z?E.filter(L=>{const B=M.map(k=>{const U=i.get(k.field);if(!U||!k.operator)return!1;const R=l(L,k.field);return xk(R,k,U.dataType)});return A==="OR"?B.some(Boolean):B.every(Boolean)}):E,[E,M,i,l,A,z]),X=u.useMemo(()=>{const L=Io(P);if(!m.key)return L;const B=i.get(m.key);if(!B)return L;const k=[...L];return k.sort((U,R)=>{const q=l(U,m.key),G=l(R,m.key),J=vk(q,G,B.dataType);return m.direction==="asc"?J:-J}),k},[P,m,i,l]),H=u.useMemo(()=>{if(!p)return[];const L=i.get(p);if(!L)return[];const B=[],k=new Map;return X.forEach(U=>{const R=l(U,p),q=Z1(R,L.dataType),G=`${p}:${q}`;k.has(G)||(k.set(G,B.length),B.push({id:G,value:R,label:q,items:[]}));const J=k.get(G);B[J].items.push(U)}),B},[X,p,i,l]),Y=u.useCallback(L=>{L&&w(B=>{const k=new Set(B);return k.has(L)?k.delete(L):k.add(L),k})},[]),V=u.useCallback(L=>L?S.has(L):!1,[S]),I=u.useCallback(()=>{v(ji)},[]),F=u.useCallback(L=>{if(!L||typeof L!="object"){v(ji);return}const B=(L.logic||"AND").toUpperCase()==="OR"?"OR":"AND",k=Io(L.conditions).map(U=>{const R=i.get(U.field);return R?{...U,field:R.key,operator:U.operator||bd(R.key,R.dataType).operator,value:U.value??""}:null});v({logic:B,conditions:k.filter(Boolean)})},[i]);return{searchTerm:c,setSearchTerm:f,sortState:m,toggleSort:j,groupBy:p,setGroupBy:_,filters:T,setFilters:F,clearFilters:I,filterActive:z,data:X,groups:H,visibleData:p?H:X,getValue:l,toggleGroupCollapse:Y,isGroupCollapsed:V,columns:r}}const tN=e=>{if(!e||typeof e!="object")return e;const t=e.imageData!==void 0?e.imageData:e.image_data!==void 0?e.image_data:null,r=e.imageMimeType!==void 0?e.imageMimeType:e.image_mime_type!==void 0?e.image_mime_type:null;return e.imageData===t&&e.imageMimeType===r?e:{...e,imageData:t,imageMimeType:r}},Ha=e=>{if(!e||typeof e!="object")return null;const t=e.data&&typeof e.data=="object"&&"id"in e.data?e.data:e.entity&&typeof e.entity=="object"&&"id"in e.entity?e.entity:"id"in e?e:null;return t?tN(t):null},Bl=e=>{if(!e||typeof e!="object")return"";const t=e.imageData??e.image_data,r=e.imageMimeType??e.image_mime_type;return!t||!r?"":`data:${r};base64,${t}`},Nk=Object.freeze([]);function cc({worldId:e,label:t,value:r,onChange:i,allowedTypeIds:l=[],disabled:c=!1,placeholder:f="Search entities",staticOptions:m,minSearchLength:h=2,onResolved:p,required:y=!1}){const[g,v]=u.useState(""),[S,w]=u.useState([]),[N,j]=u.useState(!1),[_,C]=u.useState(!1),[O,E]=u.useState(null),[T,M]=u.useState(""),A=u.useRef(null),z=u.useRef(null),P=u.useRef(p),X=u.useMemo(()=>[...l],[JSON.stringify(l)]),H=Array.isArray(m)?m:Nk,Y=u.useMemo(()=>Array.isArray(H)?H.map((U,R)=>{if(U==null)return null;if(typeof U=="object"){const G=U.value??U.id??U.key??U.slug??`static-${R}`;if(G==null)return null;const J=U.label??U.name??U.title??U.display??U.displayName??G;return{id:String(G),name:String(J),entity_type:U.entity_type||U.entityType||null,typeName:U.typeName||null,_static:!0}}const q=String(U);return{id:q,name:q,_static:!0}}).filter(Boolean):[],[H]),V=U=>{if(!U)return"";const R=U.entity_type?.name||U.entityType?.name||U.typeName||U.type?.name||"";return R?`${U.name} (${R})`:U.name};u.useEffect(()=>{c&&C(!1)},[c]),u.useEffect(()=>()=>{z.current&&clearTimeout(z.current)},[]),u.useEffect(()=>{if(!r){E(null),v("");return}if(typeof r=="object"&&r.id){const G=V(r);(!O||O.id!==r.id)&&(E(r),v(G));return}if(typeof r!="string")return;const U=r;if(O?.id===U)return;const R=Y.find(G=>String(G.id)===String(U));if(R){E(R),v(V(R));return}let q=!1;return(async()=>{try{const G=await rr(U);if(q)return;const J=Ha(G);if(J?.id){E(J),v(V(J));return}}catch(G){q||console.warn("Entity lookup failed",G)}q||(E({id:U,name:U}),v(U))})(),()=>{q=!0}},[r,Y,O?.id]),u.useEffect(()=>{if(!g.trim()||O||c)return;const U=g.trim();if(U.length<h){w([]);return}return z.current&&clearTimeout(z.current),z.current=setTimeout(()=>{if(!e){w([]),j(!1);return}(async()=>{try{j(!0),M("");const R=await of({worldId:e,query:U,typeIds:X,limit:20}),q=Array.isArray(R?.data)?R.data:R;w(Array.isArray(q)?q:[])}catch(R){console.error("Entity search failed",R),w([]),M(R.message||"Failed to search entities.")}finally{j(!1)}})()},400),()=>{z.current&&clearTimeout(z.current)}},[g,e,O,X,c,h]),u.useEffect(()=>{const U=R=>{A.current&&!A.current.contains(R.target)&&C(!1)};return document.addEventListener("mousedown",U),()=>document.removeEventListener("mousedown",U)},[]),u.useEffect(()=>{P.current=p},[p]),u.useEffect(()=>{P.current?.(O||null)},[O]);const I=u.useMemo(()=>{if(!Y.length)return[];if(!g.trim())return Y;const U=g.trim().toLowerCase();return Y.filter(R=>V(R).toLowerCase().includes(U))},[Y,g]),F=u.useMemo(()=>{const U=new Map,R=[];return I.forEach(q=>{const G=q?.id;if(G==null)return;const J=String(G);U.has(J)||(U.set(J,!0),R.push(q))}),S.forEach(q=>{const G=q?.id;if(G==null)return;const J=String(G);U.has(J)||(U.set(J,!0),R.push(q))}),R},[I,S]),D=U=>{U&&(E(U),v(V(U)),C(!1),w([]),M(""),i?.(U))},L=()=>{E(null),v(""),w([]),M(""),C(!1),i?.(null)},B=_&&F.length>0,k=_&&!N&&!F.length&&g.trim().length>=h&&!O;return a.jsxs("div",{className:"entity-search-select",ref:A,children:[t&&a.jsx("label",{children:t}),a.jsxs("div",{className:"entity-search-wrapper",children:[a.jsx("input",{type:"text",value:g,required:y,onChange:U=>{const R=U.target.value;v(R),E(null),c||C(!0)},onFocus:()=>{c||C(!0)},disabled:c,placeholder:f,className:"entity-search-input"}),O&&!c&&a.jsx("button",{type:"button",className:"clear-btn",onClick:L,title:"Clear selection","aria-label":"Clear selection",children:""})]}),N&&a.jsx("div",{className:"small text-muted",children:"Searching"}),T&&a.jsx("div",{className:"small text-warning",children:T}),B&&a.jsx("ul",{className:"entity-results",children:F.map(U=>a.jsx("li",{onMouseDown:R=>R.preventDefault(),onClick:()=>D(U),className:O?.id===U.id?"selected":"",children:V(U)},U.id))}),k&&a.jsx("div",{className:"small text-muted",style:{marginTop:"0.25rem"},children:"No matches found."})]})}const V0=e=>Array.isArray(e)?e:[],Ek=e=>{const t=e?.options?.choices;return!Array.isArray(t)||t.length===0?[]:t.map((r,i)=>{if(r==null)return null;if(typeof r=="object"){const c=r.value??r.id??r.key??r.slug??`choice-${i}`,f=r.label??r.name??r.title??r.display??c;return c==null?null:{value:String(c),label:String(f??c)}}const l=String(r);return{value:l,label:l}}).filter(Boolean)};function nN({open:e,onClose:t,fields:r=[],value:i=ji,worldId:l,onApply:c}){const f=Array.isArray(r)?r:[],m=f[0]?.key||"",[h,p]=u.useState(i.logic||"AND"),[y,g]=u.useState(()=>{const M=V0(i.conditions);return M.length>0?M.map(A=>({...A})):[bd(m,f[0]?.dataType)]}),[v,S]=u.useState(new Map);u.useEffect(()=>{if(!e)return;p(i.logic||"AND");const M=V0(i.conditions);M.length>0?g(M.map(A=>({...A}))):g([bd(m,f[0]?.dataType)])},[e,i,m,f]);const w=()=>{const M=y[0]?.field||m,A=f.find(z=>z.key===M);g(z=>[...z,bd(M,A?.dataType)])},N=(M,A)=>{g(z=>{const P=[...z],X=f.find(H=>H.key===A);return P[M]={...P[M],field:A,operator:Xp(X?.dataType)[0]?.value||"equals",value:""},P})},j=(M,A)=>{g(z=>{const P=[...z];return P[M]={...P[M],operator:A},P})},_=(M,A)=>{g(z=>{const P=[...z];return P[M]={...P[M],value:A},P})},C=M=>{g(A=>{if(A.length===1)return A;const z=[...A];return z.splice(M,1),z})},O=()=>{const M=y.map(A=>({...A})).filter(A=>A.field&&A.operator);if(M.length===0){c?.(ji);return}c?.({logic:h,conditions:M})},E=u.useMemo(()=>(Array.isArray(r)?r:[]).map(A=>({...A,originalDataType:A.dataType||A.type||"string",dataType:Fl(A.dataType||A.type)})),[r]),T=u.useCallback((M,A)=>{if(!M){S(X=>{const H=new Map(X),Y=y[A];return Y?.value&&H.delete(String(Y.value)),H});return}const z=String(M.id),P=M.name||`Entity ${z}`;S(X=>{const H=new Map(X);return H.set(z,P),H})},[y]);return e?a.jsx("div",{className:"condition-modal-backdrop",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"condition-modal",children:[a.jsxs("div",{className:"condition-modal-header",children:[a.jsx("h2",{children:"Filters"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:t,"aria-label":"Close filters",children:a.jsx(Ra,{size:18})})]}),a.jsxs("div",{className:"condition-logic",children:[a.jsx("span",{children:"Match records where"}),a.jsxs("div",{className:"logic-toggle",role:"group","aria-label":"Filter logic",children:[a.jsx("button",{type:"button",className:`logic-btn${h==="AND"?" is-active":""}`,onClick:()=>p("AND"),children:"All conditions (AND)"}),a.jsx("button",{type:"button",className:`logic-btn${h==="OR"?" is-active":""}`,onClick:()=>p("OR"),children:"Any condition (OR)"})]})]}),a.jsx("div",{className:"condition-list",children:Array.isArray(y)&&y.map((M,A)=>{const z=E.find(V=>V.key===M.field)||E[0]||{dataType:"string",key:""},P=Xp(z.dataType),X=Array.isArray(P)?P:[],H=M.operator||X[0]?.value||"equals",Y=!["is_true","is_false"].includes(H);return a.jsxs("div",{className:"condition-row",children:[a.jsx("select",{className:"condition-field",value:M.field||z.key,onChange:V=>N(A,V.target.value),children:E.map(V=>a.jsx("option",{value:V.key,children:V.label},V.key))}),a.jsx("select",{className:"condition-operator",value:H,onChange:V=>j(A,V.target.value),children:X.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))}),Y?(()=>{const V=z.originalDataType||z.dataType,I=V==="boolean"||V==="bool",F=V==="enum",D=z.referenceTypeId||z.reference_type_id||z.referenceType?.id||null,L=(V==="reference"||z.dataType==="reference")&&D,B=(H==="equals"||H==="not_equals")&&(I||F||L);if(B&&I)return a.jsxs("select",{className:"condition-value",value:M.value??"",onChange:k=>_(A,k.target.value),children:[a.jsx("option",{value:"",children:"Select..."}),a.jsx("option",{value:"true",children:"True"}),a.jsx("option",{value:"false",children:"False"})]});if(B&&F){const k=Ek(z),U=Array.isArray(k)?k:[];return U.length===0?a.jsx("input",{className:"condition-value",type:"text",value:M.value??"",onChange:R=>_(A,R.target.value),placeholder:"Value"}):a.jsxs("select",{className:"condition-value",value:M.value??"",onChange:R=>_(A,R.target.value),children:[a.jsx("option",{value:"",children:"Select..."}),U.map(R=>a.jsx("option",{value:R.value,children:R.label},R.value))]})}if(B&&L){const k=z.referenceTypeId||z.reference_type_id||z.referenceType?.id||null,U=k?String(k).trim():null,R=z.referenceTypeName||z.reference_type_name||z.referenceType?.name||"entities",q=M.value,G=U&&U.length>0?[U]:[],J=q||null;return a.jsx("div",{className:"condition-value-reference",children:a.jsx(cc,{worldId:l,value:J,allowedTypeIds:G,placeholder:`Search ${R.toLowerCase()}...`,disabled:!l||!U,onChange:ie=>{if(!ie)_(A,""),T(null,A);else{const Z=String(ie.id);_(A,Z),T(ie,A)}},onResolved:ie=>T(ie,A),minSearchLength:2})})}return a.jsx("input",{className:"condition-value",type:z.dataType==="number"?"number":z.dataType==="date"?"date":"text",value:M.value??"",onChange:k=>_(A,k.target.value),placeholder:"Value"})})():a.jsx("span",{className:"condition-value placeholder",children:"No value"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>C(A),disabled:y.length===1,"aria-label":"Remove condition",children:a.jsx(fa,{size:16})})]},M.id||`${M.field}-${A}`)})}),a.jsxs("div",{className:"condition-actions",children:[a.jsxs("button",{type:"button",className:"btn secondary",onClick:w,children:[a.jsx(Pa,{size:16})," Add condition"]}),a.jsxs("div",{className:"condition-action-right",children:[J1(i)&&a.jsx("button",{type:"button",className:"btn ghost",onClick:()=>c?.(ji),children:"Clear filters"}),a.jsx("button",{type:"button",className:"btn submit",onClick:O,children:"Apply filters"})]})]})]})}):null}function ff({data:e,columns:t,title:r,extraActions:i,onRowClick:l}){const[c,f]=u.useState(t.map(T=>T.key)),[m,h]=u.useState(!1),[p,y]=u.useState(!1),[g,v]=u.useState({open:!1,column:null,x:0,y:0}),S=u.useMemo(()=>t.map(T=>({...T,dataType:T.dataType||T.type||"string"})),[t]),w=eN(e,{columns:S}),N=S.filter(T=>c.includes(T.key));u.useEffect(()=>{f(T=>{const M=S.map(z=>z.key),A=T.filter(z=>M.includes(z));return M.forEach(z=>{A.includes(z)||A.push(z)}),A.length===T.length&&A.every((z,P)=>z===T[P])?T:A})},[S]);const j=T=>{w.toggleSort(T.key)},_=(T,M)=>{T.preventDefault(),v({open:!0,column:M,x:T.clientX,y:T.clientY})};u.useEffect(()=>{if(!g.open)return;const T=()=>v({open:!1,column:null,x:0,y:0});return window.addEventListener("click",T),window.addEventListener("contextmenu",T),()=>{window.removeEventListener("click",T),window.removeEventListener("contextmenu",T)}},[g.open]);const C=T=>{w.setGroupBy(T.key),v({open:!1,column:null,x:0,y:0})},O=(T,M)=>{if(typeof M.render=="function")return M.render(T,w.getValue(T,M.key));const A=T[M.key];return A!==void 0?A:w.getValue(T,M.key)},E=w.groupBy?w.groups.some(T=>T.items.length>0):w.data.length>0;return a.jsxs("div",{className:"list-viewer",children:[a.jsxs("div",{className:"list-viewer-header",children:[a.jsx("h2",{children:r}),a.jsxs("div",{className:"list-controls",children:[i&&a.jsx("div",{className:"extra-actions",children:i}),a.jsx(Vy,{value:w.searchTerm,onChange:w.setSearchTerm,placeholder:`Search ${r.toLowerCase()}...`}),a.jsxs("button",{type:"button",className:`btn secondary compact${w.filterActive?" is-active":""}`,onClick:()=>y(!0),children:[a.jsx(Jd,{size:16})," Filters"]}),a.jsxs("div",{className:"column-picker-wrapper",children:[a.jsx("button",{className:"icon-btn",title:"Column settings",onClick:()=>h(T=>!T),children:a.jsx(M1,{size:18})}),m&&a.jsx("div",{className:"column-picker-popover",children:a.jsx(pk,{columns:S,visibleCols:c,onChange:f,onClose:()=>h(!1)})})]})]})]}),E?a.jsx("div",{className:"list-viewer-table-wrapper",children:a.jsxs("table",{children:[a.jsx("thead",{children:a.jsx("tr",{children:N.map(T=>{const M=w.sortState.key===T.key,A=w.sortState.direction,z=w.groupBy===T.key;return a.jsx("th",{onClick:()=>j(T),onContextMenu:P=>_(P,T),className:"sortable-header",role:"button",tabIndex:0,children:a.jsxs("span",{className:"header-label",children:[T.label,M&&a.jsx("span",{className:"sort-indicator",children:A==="asc"?"":""}),z&&a.jsx("span",{className:"group-indicator",children:"Grouped"})]})},T.key)})})}),a.jsx("tbody",{children:w.groupBy?w.groups.map(T=>a.jsxs(u.Fragment,{children:[a.jsx("tr",{className:"group-header-row",children:a.jsxs("td",{colSpan:N.length,children:[a.jsx("button",{type:"button",className:"group-toggle",onClick:()=>w.toggleGroupCollapse(T.id),children:w.isGroupCollapsed(T.id)?a.jsx(zy,{size:14}):a.jsx(Ur,{size:14})}),a.jsxs("span",{className:"group-label",children:[T.label," ",a.jsxs("span",{className:"group-count",children:["(",T.items.length,")"]})]})]})}),!w.isGroupCollapsed(T.id)&&T.items.map(M=>a.jsx("tr",{onClick:()=>l&&l(M),className:l?"clickable-row":"",children:N.map(A=>a.jsx("td",{"data-column":A.label||A.key,children:O(M,A)},A.key))},M.id))]},T.id)):w.data.map(T=>a.jsx("tr",{onClick:()=>l&&l(T),className:l?"clickable-row":"",children:N.map(M=>a.jsx("td",{"data-column":M.label||M.key,children:O(T,M)},M.key))},T.id))})]})}):a.jsx("div",{className:"empty-state",children:a.jsx("p",{children:"No results found."})}),g.open&&g.column&&a.jsxs("div",{className:"column-context-menu",style:{top:g.y,left:g.x},role:"menu",children:[a.jsx("button",{type:"button",onClick:()=>C(g.column),children:w.groupBy===g.column.key?"Remove grouping":`Group by ${g.column.label}`}),w.groupBy&&w.groupBy!==g.column.key&&a.jsx("button",{type:"button",onClick:()=>C({key:""}),children:"Clear grouping"})]}),a.jsx(nN,{open:p,onClose:()=>y(!1),fields:S.map(T=>({key:T.key,label:T.label,dataType:T.dataType})),value:w.filters,onApply:T=>{w.setFilters(T),y(!1)}})]})}function aN(e){if(!e&&e!==0)return null;if(typeof e=="object"&&e!==null){const r=e.value??e.id??e.key??e.slug??null;if(r==null)return null;const i=e.label??e.name??e.title??e.username??e.email??String(r);return{value:String(r),label:String(i),raw:e}}const t=String(e);return{value:t,label:t,raw:e}}function Ts({selected:e=[],options:t=[],onChange:r,placeholder:i="Search and select...",disabled:l=!1,noOptionsMessage:c="No options available.",loading:f=!1,inputId:m}){const[h,p]=u.useState(""),[y,g]=u.useState(!1),v=u.useRef(null),S=u.useMemo(()=>{const A=t.map(P=>aN(P)).filter(Boolean),z=new Set;return A.filter(P=>{const X=P.value;return z.has(X)?!1:(z.add(X),!0)})},[t]),w=u.useMemo(()=>{const A=new Set;return e.forEach(z=>{z!=null&&A.add(String(z))}),A},[e]),N=u.useMemo(()=>{const A=new Map(S.map(z=>[z.value,z]));return Array.from(w).map(z=>{const P=A.get(z);return P||{value:z,label:z}})},[S,w]),j=u.useMemo(()=>S.filter(A=>!w.has(A.value)),[S,w]),_=u.useMemo(()=>{if(!h)return j;const A=h.toLowerCase();return j.filter(z=>z.label.toLowerCase().includes(A))},[j,h]);u.useEffect(()=>{if(!y)return;const A=z=>{v.current&&(v.current.contains(z.target)||g(!1))};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[y]);const C=A=>{if(l)return;const z=[],P=new Set;A.forEach(X=>{if(X==null)return;const H=String(X);P.has(H)||(P.add(H),z.push(H))}),r?.(z)},O=A=>{if(!A)return;const z=[...w,A.value];C(z),p(""),g(!1)},E=A=>{const z=String(A),P=Array.from(w).filter(X=>X!==z);C(P)},T=y&&!l,M=()=>f?"Loading options...":j.length===0?w.size>0?"All options selected.":c:"No matches found.";return a.jsxs("div",{className:`list-collector ${l?"disabled":""}`,ref:v,children:[a.jsxs("div",{className:"list-collector-input-wrapper",children:[a.jsx("input",{id:m,type:"text",className:"list-collector-input",value:h,placeholder:i,disabled:l,onFocus:()=>!l&&g(!0),onChange:A=>{p(A.target.value),y||g(!0)},onKeyDown:A=>{A.key==="Enter"&&_.length>0&&(A.preventDefault(),O(_[0])),A.key==="Escape"&&(g(!1),A.currentTarget.blur())}}),a.jsx("span",{className:"list-collector-icon","aria-hidden":"true",children:""})]}),T&&a.jsx("div",{className:"list-collector-dropdown",children:_.length>0?a.jsx("ul",{children:_.map(A=>a.jsx("li",{children:a.jsx("button",{type:"button",onMouseDown:z=>z.preventDefault(),onClick:()=>O(A),className:"list-collector-option",children:A.label})},A.value))}):a.jsx("div",{className:"list-collector-empty",children:M()})}),N.length>0&&a.jsx("div",{className:"list-collector-pills",children:N.map(A=>a.jsxs("span",{className:"list-collector-pill",children:[a.jsx("span",{className:"pill-label",children:A.label}),!l&&a.jsx("button",{type:"button",className:"pill-remove",onClick:()=>E(A.value),"aria-label":`Remove ${A.label}`,children:""})]},A.value))})]})}const jk=e=>e===null?"null":e===void 0?"undefined":Array.isArray(e)?"array":e instanceof Date?"date":typeof e,mf=(e,t,r={})=>{const i=(c,f,m,h="<<anonymous>>")=>{const p=f[m];return p==null?(c&&console.warn(`[PropTypes] Prop "${m}" is marked as required in "${h}", but its value is ${String(p)}.`),null):e(p,f,m,h)?(r.afterValidate&&r.afterValidate(p,f,m,h),null):(console.warn(`[PropTypes] Invalid prop "${m}" supplied to "${h}". Expected ${t}, but received ${jk(p)}.`),null)},l=i.bind(null,!1);return l.isRequired=i.bind(null,!0),l._validate=c=>c==null||e(c),l._expectedDescription=t,l},qu=e=>mf(t=>typeof t===e,e),_k=()=>mf(e=>e!==null&&typeof e=="object"&&!Array.isArray(e)&&!(e instanceof Date),"object"),Ck=e=>{const t=c=>Array.isArray(c)?!e||typeof e!="function"?!0:c.every(f=>e._validate?e._validate(f):!0):!1,r=(c,f,m,h)=>{Array.isArray(c)&&(!e||typeof e!="function"||c.forEach((p,y)=>{try{e({[`${m}[${y}]`]:p},`${m}[${y}]`,h)}catch{}}))},i=`an array of ${e?._expectedDescription??"the specified type"}`,l=mf(t,i,{afterValidate:r});return l._validate=c=>c==null?!0:Array.isArray(c)?c.every(f=>e&&e._validate?e._validate(f):!0):!1,l},Ak=e=>{const t=Array.isArray(e)?e.filter(Boolean):[],r=c=>t.some(f=>f&&typeof f._validate=="function"?f._validate(c):!0),i=t.map(c=>c?._expectedDescription).filter(Boolean),l=i.length>0?i.join(", "):"one of the specified types";return mf(r,l)},rn={string:qu("string"),number:qu("number"),bool:qu("boolean"),func:qu("function"),object:_k(),arrayOf:e=>Ck(e),oneOfType:e=>Ak(e)},Gr=e=>e?Array.isArray(e)?e:Array.isArray(e.data)?e.data:[]:[],Wp=e=>{if(e==null)return null;if(typeof e=="string"){const t=e.trim();return t?t.toLowerCase():null}if(typeof e=="number")return String(e);if(typeof e=="object"){if(Array.isArray(e)){for(const t of e){const r=Wp(t);if(r)return r}return null}return Wp(e.fieldKey??e.field_key??e.key??e.name??e.id)??null}return null},Tn=(e,t)=>{const r=Wp(t);r&&e.add(r)},Tk=e=>{if(!e||typeof e!="object")return[];const t=new Set;return Tn(t,e.id),Tn(t,e.field_id),Tn(t,e.entity_type_field_id),Tn(t,e.fieldId),Tn(t,e.name),Tn(t,e.key),Tn(t,e.field),Tn(t,e.metadataField),Tn(t,e.metadata_field),e?.sourceField&&Tn(t,e.sourceField),e?.source_field&&Tn(t,e.source_field),Array.from(t)},Mk=e=>Array.isArray(e)?e.map((t,r)=>{if(!t||typeof t!="object")return null;const i=new Set;if(Tn(i,t.fieldKey),Tn(i,t.field_key),Tn(i,t.field),Tn(i,t.fieldName),Tn(i,t.field_name),Tn(i,t.fieldId),Tn(i,t.field_id),Tn(i,t.target),Tn(i,t.targetField),Tn(i,t.target_field),Tn(i,t.metadataField),Tn(i,t.metadata_field),Tn(i,t.entity_type_field_id),Tn(i,t.name),Tn(i,t.key),t.field&&typeof t.field=="object"&&(Tn(i,t.field.id),Tn(i,t.field.name),Tn(i,t.field.key)),!i.size)return null;const l=(y,g=0)=>{if(y==null||y==="")return g;const v=Number(y);return Number.isFinite(v)?v:g},c=l(t.sectionOrder??t.section_order??t.sectionIndex??t.section_index,0),f=l(t.column??t.columnOrder??t.column_index??t.columnIndex,0),m=l(t.fieldOrder??t.field_order??t.order??t.order_index??t.position??t.sortOrder??t.sort_order,r),h=l(t.priority??t.weight??t.rank,r),p=c*1e6+f*1e4+m*100+h;return{identifiers:Array.from(i),rank:p,sectionOrder:c,columnOrder:f,fieldPosition:m,priority:h}}).filter(Boolean):[],Yy=(e=[],t=[])=>{if(!Array.isArray(e)||e.length===0)return[];const r=Mk(t),i=new Map;r.length>0&&r.forEach(f=>{f.identifiers.forEach(m=>{i.has(m)||i.set(m,f.rank)})});const l=(f,m)=>{if(f==null||f==="")return m;const h=Number(f);return Number.isFinite(h)?h:m},c=e.map((f,m)=>{const h=Tk(f);let p=Number.POSITIVE_INFINITY;h.forEach(g=>{if(!g)return;const v=i.get(g);v!==void 0&&v<p&&(p=v)});const y=l(f?.sortOrder??f?.sort_order,m);return{field:f,rank:p,fallbackSort:y,index:m}});return c.sort((f,m)=>{const h=Number.isFinite(f.rank),p=Number.isFinite(m.rank);return h&&p&&f.rank!==m.rank?f.rank-m.rank:h&&!p?-1:!h&&p?1:f.fallbackSort!==m.fallbackSort?f.fallbackSort-m.fallbackSort:f.index-m.index}),c.map(f=>f.field)},Gy=e=>!!e&&typeof e=="object"&&!Array.isArray(e),Rk=e=>Array.isArray(e)?e:e==null?[]:[e],gs=e=>e==null?null:typeof e=="string"?e.trim()||null:typeof e=="number"?String(e):Gy(e)?gs(e.field??e.fieldKey??e.field_name??e.source??e.sourceField??e.source_field??e.key??e.name??e.target??e.targetField??e.target_field??e.metadataField??e.metadata_field??e.id)??null:null,kk=e=>{if(!e||typeof e!="object")return null;const t=l=>l==null?null:String(l).trim()||null,r=t(e.key??e.name??e.field);if(r&&r.startsWith("metadata."))return r;const i=t(e.metadataField??e.metadata_field)||(r&&!r.includes(".")?r:null)||t(e.name);return i?i.startsWith("metadata.")?i:`metadata.${i}`:r},Dk=(e=[])=>{const t=new Map,r=(i,l)=>{if(!i||!l)return;const c=gs(i),f=gs(l);!c||!f||(t.set(c,f),t.set(c.toLowerCase(),f))};return e.forEach(i=>{if(!i||typeof i!="object")return;const l=kk(i);if(!l)return;r(l,l),[i.id,i.field_id,i.fieldId,i.entity_type_field_id,i.field,i.name,i.key,i.metadataField,i.metadata_field,i.fieldKey,i.field_key,i.target,i.targetField,i.target_field,i.source,i.sourceField,i.source_field].forEach(f=>r(f,l))}),t},Ik={eq:"equals","=":"equals","==":"equals","===":"equals",equals:"equals",equal:"equals",match:"equals",matches:"equals",ne:"not_equals","!=":"not_equals","!==":"not_equals",not:"not_equals",notequals:"not_equals",not_equals:"not_equals",different:"not_equals",contains:"contains",includes:"contains",has:"contains",not_contains:"not_contains",excludes:"not_contains",notincludes:"not_contains",in:"in",any:"in",within:"in",not_in:"not_in",none:"not_in",outside:"not_in",gt:"gt",greater:"gt",greater_than:"gt",gte:"gte",ge:"gte",greater_or_equal:"gte",lt:"lt",less:"lt",less_than:"lt",lte:"lte",le:"lte",less_or_equal:"lte",is_set:"is_set",isset:"is_set",set:"is_set",exists:"is_set",present:"is_set",is_not_set:"is_not_set",notset:"is_not_set",missing:"is_not_set",empty:"is_empty",is_empty:"is_empty",not_empty:"is_not_empty",filled:"is_not_empty",truthy:"truthy",falsy:"falsy"},Lk=e=>{if(e==null)return"equals";const t=String(e).trim().toLowerCase();return Ik[t]??"equals"},Ok={all:"all",every:"all",and:"all",any:"any",some:"any",or:"any",either:"any",none:"none",not:"none"},zk=e=>{if(e==null)return"all";const t=String(e).trim().toLowerCase();return Ok[t]??"all"},$k={show:"show",display:"show",reveal:"show",visible:"show",enable:"show",hide:"hide",remove:"hide",conceal:"hide",hidden:"hide",disable:"hide",require:"require",required:"require",mandatory:"require",optional:"optional",option:"optional",allow:"optional"},Fk=e=>{if(e==null)return null;const t=String(e).trim().toLowerCase();return $k[t]??null},Y0=(e,t=0)=>{if(!e)return null;if(!Gy(e)){if(typeof e=="string"){const[f,...m]=e.split("="),h=gs(f);if(!h)return null;const p=m.join("=").trim();return{field:h,operator:"equals",values:p?[p]:[]}}return null}const r=gs(e.field??e.fieldKey??e.field_name??e.source??e.sourceField??e.source_field??e.input??e.left??e.property??e.key??e.name);if(!r)return null;const i=Lk(e.operator??e.comparator??e.condition??e.type),l=e.values??e.value??e.match??e.compareTo??e.matchValue??e.expected,c=Rk(l).filter(f=>f!==void 0);return{field:r,operator:i,values:c,id:e.id??`condition-${t}`}},Bk=e=>{const t=["conditions","criteria","when","rules","predicates","matchers"];for(const i of t)if(Array.isArray(e?.[i]))return e[i].map((l,c)=>Y0(l,c)).filter(Boolean);const r=Y0(e,0);return r?[r]:[]},Uh=(e,t=0)=>{if(!e||!Gy(e)&&typeof e!="string")return null;if(typeof e=="string"){const l=gs(e);return l?{target:l,action:"show",id:`action-${t}`}:null}const r=gs(e.target??e.targetField??e.target_field??e.field??e.fieldKey??e.field_name??e.path??e.name??e.key??e.metadataField??e.metadata_field),i=Fk(e.action??e.type??e.behavior??e.behaviour??e.effect??e.command);return!r||!i?null:{target:r,action:i,id:e.id??`action-${t}`}},Uk=e=>{const t=["actions","effects","apply","then","responses"];for(const i of t)if(Array.isArray(e?.[i]))return e[i].map((l,c)=>Uh(l,c)).filter(Boolean);if(Array.isArray(e?.targets)&&e.targets.length>0)return e.targets.map((i,l)=>Uh({target:i,action:e.action??e.effect??e.behavior??e.behaviour},l)).filter(Boolean);const r=e.target??e.targetField??e.target_field??e.actionTarget??e.fieldTarget??e.metadataField??e.metadata_field;return r&&(e.action||e.effect||e.behavior||e.behaviour)?[Uh({target:r,action:e.action??e.effect??e.behavior??e.behaviour})].filter(Boolean):[]},Zp=e=>{if(e==null)return"";if(typeof e=="number"&&Number.isFinite(e))return String(e);if(typeof e=="boolean")return e?"true":"false";if(e instanceof Date)return String(e.getTime());if(typeof e=="string")return e.trim().toLowerCase();if(Array.isArray(e))return e.map(t=>Zp(t));if(typeof e=="object")try{return JSON.stringify(e)}catch{return String(e)}return String(e)},fs=(e,t)=>{if(Array.isArray(e))return e.some(f=>fs(f,t));if(Array.isArray(t))return t.some(f=>fs(e,f));const r=Number(e),i=Number(t);if(!Number.isNaN(r)&&!Number.isNaN(i))return r===i;const l=Zp(e),c=Zp(t);return l===c},hl=e=>e==null?!1:typeof e=="string"?e.trim().length>0:Array.isArray(e)?e.length>0:e instanceof Date?!0:typeof e=="object"?Object.keys(e).length>0:!0,qk=(e,t)=>{if(t==null)return;let r=t;if(typeof r!="string"){const l=gs(r);if(!l)return;r=l}if(!r)return;const i=r.replace(/\[(.*?)\]/g,(l,c)=>`.${c.replace(/^['"]|['"]$/g,"")}`).split(".").map(l=>l.trim()).filter(l=>l.length>0);if(i.length)return i.reduce((l,c)=>{if(l!=null)return c==="*"?l:l[c]},e)},qh=(e,t)=>{if(!e)return!1;const{field:r,operator:i,values:l=[]}=e,c=qk(t,r);switch(i){case"equals":return l.length?l.some(f=>fs(c,f)):!1;case"not_equals":return l.length?l.every(f=>!fs(c,f)):hl(c);case"contains":return Array.isArray(c)?c.some(f=>l.some(m=>fs(f,m))):typeof c=="string"?l.some(f=>f==null?!1:c.toLowerCase().includes(String(f).toLowerCase())):!1;case"not_contains":return Array.isArray(c)?c.every(f=>l.every(m=>!fs(f,m))):typeof c=="string"?l.every(f=>f==null?!0:!c.toLowerCase().includes(String(f).toLowerCase())):!0;case"in":return l.length?Array.isArray(c)?c.some(f=>l.some(m=>fs(f,m))):l.some(f=>fs(c,f)):!1;case"not_in":return l.length?Array.isArray(c)?c.every(f=>l.every(m=>!fs(f,m))):l.every(f=>!fs(c,f)):!0;case"gt":case"gte":case"lt":case"lte":{const f=Number(c);if(Number.isNaN(f))return!1;const m=l.find(p=>p!=null),h=Number(m);return Number.isNaN(h)?!1:i==="gt"?f>h:i==="gte"?f>=h:i==="lt"?f<h:f<=h}case"is_set":return hl(c);case"is_not_set":return!hl(c);case"is_empty":return!hl(c);case"is_not_empty":return hl(c);case"truthy":return!!c;case"falsy":return!c;default:return l.length?l.some(f=>fs(c,f)):hl(c)}},Hk=(e,t)=>{const r=Array.isArray(e?.conditions)?e.conditions:[];if(r.length===0)return!0;switch(e?.matchMode){case"any":return r.some(i=>qh(i,t));case"none":return!r.some(i=>qh(i,t));case"all":default:return r.every(i=>qh(i,t))}},Xy=(e=[],t=[])=>{if(!Array.isArray(e))return[];const r=Dk(t),i=c=>{const f=gs(c);if(!f)return typeof c=="string"?c:null;if(r.size>0){const m=r.get(f)||r.get(f.toLowerCase());if(m)return m}return f},l=e.map((c,f)=>{if(!c||typeof c!="object"||c.disabled||c.enabled===!1)return null;const m=Array.isArray(c.conditions)&&Array.isArray(c.actions)&&c.conditions.every(w=>w?.field&&w?.operator)&&c.actions.every(w=>w?.target&&w?.action),h=m?c.conditions.map(w=>({...w})):Bk(c),p=m?c.actions.map(w=>({...w})):Uk(c);if(!h.length||!p.length)return null;const y=h.map(w=>{const N=i(w?.field);return N?{...w,field:N}:null}).filter(Boolean),g=p.map(w=>{const N=i(w?.target);return N?{...w,target:N}:null}).filter(Boolean);if(!y.length||!g.length)return null;const v=c.priority??c.order??c.sort??c.rank??f,S=Number.isFinite(Number(v))?Number(v):f;return{id:c.id??`field-rule-${f}`,name:c.name??c.label??"",matchMode:zk(c.matchMode??c.match_mode??c.matchType??c.logic??c.condition),conditions:y,actions:g,priority:S}}).filter(Boolean);return l.sort((c,f)=>c.priority-f.priority),l},Ky=(e,t={})=>{const r=Array.isArray(e)?e:[],i=t&&typeof t=="object"?t:{},l={},c=new Set;return r.forEach(f=>{!f||!Hk(f,i)||f.actions.forEach(h=>{if(!h?.target||!h?.action)return;const p=h.target,y=gs(p)?.toLowerCase()??null;l[p]=h.action,y&&l[y]===void 0&&(l[y]=h.action),h.action==="show"?(c.add(p),y&&c.add(y)):h.action==="hide"&&(c.delete(p),y&&c.delete(y))})}),{actionsByField:l,showRuleTargets:c}},uc=(e,t,r=new Set,i=!0)=>{if(!e)return!1;const l=typeof t=="string"?t.toLowerCase():"",c=gs(e)?.toLowerCase()??null;return r instanceof Set&&(r.has(e)||(c?r.has(c):!1))||l==="show"?!1:l==="hide"||l==="hidden"||i===!1},sN=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?typeof e=="string"?e:String(e):t.toLocaleString()},Pk=e=>{const t=e?.value;if(t==null)return"";switch(e?.dataType){case"boolean":return!!t;case"number":{const r=Number(t);return Number.isNaN(r)?t:r}case"enum":return typeof t=="object"&&t!==null?t.value??t.id??t.key??t.slug??t.name??"":t;case"date":return sN(t);case"reference":if(typeof t=="object"&&t!==null){const r=t.label??t.name??t.title??t.display??t.displayName??t.text??t.value??t.id;if(r==null)try{return JSON.stringify(t,null,2)}catch(i){return console.warn(" Failed to serialise reference metadata field",i),String(t)}return String(r)}return t;case"text":if(typeof t=="object")try{return JSON.stringify(t,null,2)}catch(r){return console.warn(" Failed to serialise text metadata field",r),String(t)}return t;default:if(typeof t=="object")try{return JSON.stringify(t,null,2)}catch(r){return console.warn(" Failed to serialise metadata field",r),String(t)}return t}},Vk=e=>{const t=e?.value;return t==null?e?.dataType==="boolean"?!1:"":e?.dataType==="boolean"?!!t:e?.dataType==="reference"&&typeof t=="object"&&t!==null?t.value??t.id??t.key??t.slug??t.uuid??"":t},rN=(e=[])=>!Array.isArray(e)||e.length===0?{}:e.reduce((t,r)=>(r?.name&&(t[r.name]=Pk(r)),t),{}),Yk=(e=[])=>!Array.isArray(e)||e.length===0?{}:e.reduce((t,r)=>(r?.name&&(t[r.name]=Vk(r)),t),{}),Gk=(e=[])=>!Array.isArray(e)||e.length===0?{}:e.reduce((t,r)=>{if(!r?.name||r.dataType!=="reference")return t;const i=(()=>{if(r.displayValue)return r.displayValue;if(r.display)return r.display;if(r.selectedLabel)return r.selectedLabel;const l=r.value;return!l||typeof l!="object"?null:l.label??l.name??l.title??l.display??l.displayName??l.text??l.value??l.id??null})();return i==null||(t[r.name]=String(i)),t},{}),Wy=e=>{if(e==null||e==="")return null;if(typeof e=="string"){const t=e.trim();return t.length>0?t:null}if(typeof e=="number"||typeof e=="bigint")return String(e);if(typeof e=="object"&&!Array.isArray(e)){const t=e.id??e.value??e.entity_id??e.entityId??e.key??e.slug??e.uuid??null;if(t!=null){const r=String(t).trim();return r.length>0?r:null}return null}if(Array.isArray(e)){for(const t of e){const r=Wy(t);if(r)return r}return null}return null},Zy=e=>{if(e==null)return null;if(typeof e=="object"&&!Array.isArray(e)){const t=e.displayValue??e.display??e.label??e.name??e.title??e.displayName??e.text??null;if(t!=null){const r=String(t).trim();return r.length>0?r:null}return null}if(Array.isArray(e)){for(const t of e){const r=Zy(t);if(r)return r}return null}return null},G0=450,Hh="preparing-open",iN=e=>{if(e==null)return"";if(Array.isArray(e)){const t=e.map(r=>r==null?null:typeof r=="object"?r.label||r.name||r.title||r.value||r.id||null:String(r)).filter(Boolean);return t.length>0?t.join(", "):""}if(typeof e=="object")try{return JSON.stringify(e,null,2)}catch(t){return console.warn(" Failed to serialise metadata value",t),String(e)}return typeof e=="boolean"?e?"Yes":"No":e===""?"":String(e)},X0=e=>{if(!e||typeof e!="object")return null;const t=e.displayValue??e.label??e.name??e.title??e.display??e.displayName??e.text??e.value??e.id;return t==null?null:String(t)},Xk=e=>{if(!e)return"";const{dataType:t,value:r}=e;if(r==null)return t==="boolean"?"No":"";switch(t){case"boolean":return r?"Yes":"No";case"number":{const i=Number(r);return Number.isNaN(i)?String(r):String(i)}case"enum":return typeof r=="object"&&r!==null?r.label||r.name||r.title||r.value||r.id||"":String(r);case"reference":{if(Array.isArray(r)){const i=r.map(c=>c==null?null:typeof c=="object"?X0(c)||null:String(c)).filter(Boolean);if(i.length>0)return i.join(", ");const l=e.displayValue||e.display||e.selectedLabel||e.referenceName||e.referenceLabel;return l?String(l):""}if(typeof r=="object"&&r!==null){const i=X0(r);if(i)return i;try{return JSON.stringify(r,null,2)}catch(l){return console.warn(" Failed to serialise reference metadata value",l),String(r)}}if(r==="")return"";if(e.displayValue||e.display||e.selectedLabel){const i=e.displayValue||e.display||e.selectedLabel;return i?String(i):""}return String(r)}case"date":return sN(r);case"text":default:return iN(r)}},Kk=(e,t)=>{if(!e)return[];const r=Array.isArray(e.fields)?e.fields:[];if(r.length>0)return Yy(r,t).filter(c=>c?.name||c?.label).map((c,f)=>{const m=c.name||c.label||`field-${f}`,h=c.label||c.name||`Field ${f+1}`,p=c?.name?`metadata.${c.name}`:c?.key||m,y=c.visibleByDefault!==void 0?!!c.visibleByDefault:c.visible_by_default!==void 0?!!c.visible_by_default:!0;return{key:m,label:h,value:Xk(c),fieldKey:p,visibleByDefault:y}});const i=e.metadata&&typeof e.metadata=="object"&&e.metadata||e.meta&&typeof e.meta=="object"&&e.meta||null;return i?Object.entries(i).map(([l,c])=>({key:l,label:l,value:iN(c),fieldKey:l&&`metadata.${l}`,visibleByDefault:!0})):[]},Wk=e=>{if(!e)return{};if(Array.isArray(e.fields)&&e.fields.length>0)return rN(e.fields);const t=e.metadata&&typeof e.metadata=="object"&&e.metadata||e.meta&&typeof e.meta=="object"&&e.meta||null;return t?{...t}:{}};function Qy({entity:e,entityId:t,onClose:r,isLoading:i=!1,error:l="",fallbackName:c="",fieldOrder:f=[],fieldRules:m=[]}){const h=zn(),[p,y]=u.useState(()=>t?{entity:e,entityId:t,isLoading:i,error:l,fallbackName:c}:null),[g,v]=u.useState(t?"open":"closed"),S=u.useRef(null),w=u.useRef(null);u.useEffect(()=>()=>{w.current&&(clearTimeout(w.current),w.current=null)},[]),u.useEffect(()=>{if(t&&S.current?.entityId===t&&(S.current={entity:e,entityId:t,isLoading:i,error:l,fallbackName:c}),t){if(!p){y({entity:e,entityId:t,isLoading:i,error:l,fallbackName:c}),v(Hh);return}if(p.entityId===t){y(R=>!R||R.entity===e&&R.isLoading===i&&R.error===l&&R.fallbackName===(c||R.fallbackName||"")?R:{...R,entity:e,isLoading:i,error:l,fallbackName:c||R.fallbackName||""}),g==="closing"&&w.current?(clearTimeout(w.current),w.current=null,S.current=null,v("opening")):g==="closed"&&v(Hh);return}S.current={entity:e,entityId:t,isLoading:i,error:l,fallbackName:c},g!=="closing"&&v("closing"),w.current||(w.current=setTimeout(()=>{y(S.current),S.current=null,v("opening"),w.current=null},G0));return}p&&(g!=="closing"&&v("closing"),w.current||(S.current=null,w.current=setTimeout(()=>{y(null),v("closed"),w.current=null},G0)))},[e,t,i,l,c,p,g]),u.useEffect(()=>{if(g!==Hh)return;const R=requestAnimationFrame(()=>{v("opening")});return()=>cancelAnimationFrame(R)},[g]),u.useEffect(()=>{if(g!=="opening")return;const R=requestAnimationFrame(()=>{v("open")});return()=>cancelAnimationFrame(R)},[g]);const N=!!p,j=g==="closing",_=p?.entity,C=p?.entityId,O=p?.isLoading??!1,E=p?.error??"",T=p?.fallbackName,M=_?.fields,A=u.useMemo(()=>Xy(m,M),[m,M]),z=u.useMemo(()=>Wk(_),[_]),P=u.useMemo(()=>({metadata:z}),[z]),X=u.useMemo(()=>Ky(A,P),[A,P]),H=u.useMemo(()=>Kk(_,f),[_,f]),Y=u.useMemo(()=>{if(!H.length)return[];const R=X?.actionsByField??{},q=X?.showRuleTargets??new Set;return H.filter(G=>{if(!G?.fieldKey)return!0;const J=R[G.fieldKey],ie=G.visibleByDefault!==void 0?!!G.visibleByDefault:G.visible_by_default!==void 0?!!G.visible_by_default:!0;return!uc(G.fieldKey,J,q,ie)})},[H,X]),V=Y.length>0,I=_?.name||T||(O?"Loading entity":"Unknown entity"),F=_?.type?.name||_?.typeName||"Entity",D=u.useMemo(()=>Bl(_),[_]);if(!N)return null;const B=["entity-info-drawer-wrapper",g==="open"?"entity-info-drawer-wrapper--open":"",g==="opening"?"entity-info-drawer-wrapper--opening":"",j?"entity-info-drawer-wrapper--closing":""].filter(Boolean).join(" "),k=()=>{C&&h(`/entities/${C}`)},U=!!C&&!O&&!E;return a.jsxs("div",{className:B,role:"presentation",children:[a.jsx("div",{className:"entity-info-drawer__overlay",onClick:r,role:"presentation"}),a.jsxs("aside",{className:"entity-info-drawer",role:"complementary","aria-label":"Entity details",children:[a.jsxs("header",{className:"entity-info-drawer__header",children:[a.jsxs("div",{className:"entity-info-drawer__header-top",children:[a.jsx("p",{className:"entity-info-drawer__type",title:F,children:F}),a.jsxs("div",{className:"entity-info-drawer__actions",children:[a.jsx("button",{type:"button",className:"entity-info-drawer__link",onClick:k,disabled:!U,children:"Go to Record"}),a.jsx("button",{type:"button",className:"entity-info-drawer__close",onClick:r,"aria-label":"Close entity details",children:""})]})]}),a.jsx("h2",{className:"entity-info-drawer__title",title:I,children:I})]}),D&&!O&&!E?a.jsx("div",{className:"entity-info-drawer__image",children:a.jsx("img",{src:D,alt:`Portrait of ${I}`,loading:"lazy"})}):null,_?.summary&&!O&&!E&&a.jsx("p",{className:"entity-info-drawer__summary",children:_.summary}),!_?.summary&&_?.description&&!O&&!E&&a.jsx("p",{className:"entity-info-drawer__summary",children:_.description}),O&&a.jsx("p",{className:"entity-info-drawer__status","aria-live":"polite",children:"Loading entity information"}),!!E&&!O&&a.jsx("p",{className:"entity-info-drawer__status entity-info-drawer__status--error","aria-live":"assertive",children:E}),!O&&!E&&V&&a.jsx("dl",{className:"entity-info-drawer__metadata",children:Y.map(R=>a.jsxs("div",{className:"entity-info-drawer__metadata-item",children:[a.jsx("dt",{children:R.label}),a.jsx("dd",{children:R.value})]},R.key))}),!O&&!E&&!V&&a.jsx("p",{className:"entity-info-drawer__status",children:"No additional metadata available."})]})]})}Qy.propTypes={entityId:rn.string,onClose:rn.func.isRequired,isLoading:rn.bool,error:rn.string,fallbackName:rn.string,fieldOrder:rn.arrayOf(rn.object),fieldRules:rn.arrayOf(rn.object)};function Is({entityId:e,entityName:t="entity",className:r=""}){const[i,l]=u.useState(!1),[c,f]=u.useState(!1),[m,h]=u.useState(null),[p,y]=u.useState(""),[g,v]=u.useState([]),[S,w]=u.useState([]),N=u.useRef(null),j=u.useMemo(()=>e==null?null:String(e),[e]);u.useEffect(()=>(N.current||(N.current=document.createElement("div"),document.body.appendChild(N.current)),()=>{N.current&&N.current.parentNode&&(N.current.parentNode.removeChild(N.current),N.current=null)}),[]);const _=u.useCallback(()=>{l(!1),y(""),h(null),f(!1)},[]),C=T=>{if(T.preventDefault(),T.stopPropagation(),e==null)return;const M=typeof t=="string"?t.trim():"";j&&M&&h(A=>A&&A.id===j?A.name||!M?A:{...A,name:M}:{id:j,name:M}),l(!0)};u.useEffect(()=>{if(!j)return;const T=typeof t=="string"?t.trim():"";T&&h(M=>!M||M.id!==j||M.name===T||M.name&&M.name!==T?M:{...M,name:T})},[j,t]),u.useEffect(()=>{if(!i||!j)return;let T=!1;return(async()=>{f(!0),y("");try{const A=await rr(j);if(T)return;const z=Ha(A);if(!z){h(null),y("Entity not found");return}h(z)}catch(A){if(T)return;console.error(" Failed to load entity preview",A),h(null),y(A.message||"Failed to load entity information")}finally{T||f(!1)}})(),()=>{T=!0}},[i,j]);const O=u.useMemo(()=>m&&(m.entity_type_id||m.entityType?.id||m.entity_type?.id)||null,[m]);u.useEffect(()=>{if(!O){v([]),w([]);return}if(!i)return;let T=!1;return(async()=>{try{const[A,z]=await Promise.all([uf(O).catch(P=>(console.error(" Failed to load preview field order",P),null)),df(O).catch(P=>(console.error(" Failed to load preview field rules",P),null))]);if(T)return;v(Gr(A)),w(Gr(z))}catch(A){if(T)return;console.error(" Failed to load preview field layout",A),v([]),w([])}})(),()=>{T=!0}},[i,O]),u.useEffect(()=>{if(!i)return;const T=M=>{M.key==="Escape"&&(M.preventDefault(),_())};return window.addEventListener("keydown",T),()=>{window.removeEventListener("keydown",T)}},[i,_]);const E=i&&N.current?a.jsx(Qy,{entityId:j,entity:m,isLoading:c,error:p,fallbackName:t,onClose:_,fieldOrder:g,fieldRules:S}):null;return a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:`entity-info-trigger ${r}`.trim(),onClick:C,"aria-label":`View details for ${t}`,children:a.jsx(Fy,{size:16,"aria-hidden":"true"})}),N.current&&Zd.createPortal(E,N.current)]})}Is.propTypes={entityId:rn.oneOfType([rn.string,rn.number]).isRequired,entityName:rn.string,className:rn.string};function hf({field:e,data:t,onChange:r,mode:i="edit"}){const l=e.key||e.name||e.field||"",[c,f]=u.useState([]),[m,h]=u.useState(!e.optionsSource),[p,y]=u.useState(()=>JSON.stringify(e.optionsCriteria??null)),[g,v]=u.useState(()=>({selectedLabel:e?.selectedLabel?String(e.selectedLabel):"",selectedValue:null})),S=i==="view";async function w(k=5,U=200){for(let R=0;R<k;R++){const q=Zr();if(q)return q;await new Promise(G=>setTimeout(G,U))}return null}const N=u.useCallback(k=>{if(k==null)return"null";try{return JSON.stringify(k)}catch(U){return console.warn(" Unable to serialise options criteria",U),String(k)}},[]);u.useEffect(()=>{const k=N(e.optionsCriteria??null);y(U=>U===k?U:k)},[e.optionsCriteria,N]),u.useEffect(()=>{let k=!0;return(async()=>{if(!e.optionsSource){k&&(f([]),h(!0));return}const R="http://localhost:3000";let q=null;const G=new URLSearchParams;let J=null;const ie=ue=>{if(ue==null)return null;if(typeof ue=="string"){const ne=new URLSearchParams(ue);return ne.get("world_id")||ne.get("worldId")}if(Array.isArray(ue)){for(const ne of ue)if(Array.isArray(ne)&&ne.length>=2){const[we,Pe]=ne;if(we==="world_id"||we==="worldId")return Pe}else if(ne&&typeof ne=="object"){const we=ie(ne);if(we)return we}return null}return typeof ue=="object"&&(ue.world_id||ue.worldId)||null},Z=ue=>{if(ue==null)return null;if(typeof ue=="string"){const ne=new URLSearchParams(ue);ne.delete("world_id"),ne.delete("worldId");const we=ne.toString();return we||null}if(Array.isArray(ue)){const ne=ue.map(we=>{if(Array.isArray(we)&&we.length>=2){const[Pe,Re]=we;return Pe==="world_id"||Pe==="worldId"?null:[Pe,Re]}if(we&&typeof we=="object"){const Pe=Z(we);return Pe||null}return we}).filter(we=>we==null?!1:Array.isArray(we)?!0:typeof we=="object"?Object.keys(we).length>0:!0);return ne.length>0?ne:null}if(typeof ue=="object"){const ne={...ue};return delete ne.world_id,delete ne.worldId,Object.keys(ne).length>0?ne:null}return ue};switch(e.optionsSource){case"worlds":q="/api/worlds";break;case"campaigns":q="/api/campaigns";break;case"entities":{const ue=ie(e.optionsCriteria),ne=e.worldId||e.world_id||t?.world_id||t?.worldId||null,we=ue||ne;if(!we){console.warn(" Unable to resolve world id for entity options"),q=null;break}q=`/api/worlds/${we}/entities`,J=Z(e.optionsCriteria);break}case"users":q="/api/users";break;case"players":{q="/api/users";const ue=e.roles||"player,user";G.set("roles",ue);break}default:q=null}if(!q){k&&(f([]),h(!0));return}const Q=(()=>{try{const ue=new URL(R),ne=q.startsWith("http")?new URL(q):new URL(q,ue);G.forEach((Re,Ce)=>{Re!=null&&ne.searchParams.append(Ce,Re)});const we=J??e.optionsCriteria,Pe=Re=>{if(!(!Re&&Re!==0)){if(typeof Re=="string"){new URLSearchParams(Re).forEach((it,qe)=>{ne.searchParams.append(qe,it)});return}if(Array.isArray(Re)){Re.forEach(Ce=>{if(Array.isArray(Ce)&&Ce.length>=2){const[it,qe]=Ce;if(qe==null)return;Array.isArray(qe)?qe.forEach(We=>{We!=null&&ne.searchParams.append(it,We)}):ne.searchParams.append(it,qe);return}typeof Ce=="object"&&Ce!==null&&Pe(Ce)});return}typeof Re=="object"&&Object.entries(Re).forEach(([Ce,it])=>{it!=null&&(Array.isArray(it)?it.forEach(qe=>{qe!=null&&ne.searchParams.append(Ce,qe)}):ne.searchParams.append(Ce,it))})}};return Pe(we),ne}catch(ue){return console.error(" Failed to construct options endpoint URL",ue),null}})();if(!Q){k&&(f([]),h(!0));return}k&&h(!1);try{const ue=await w();if(!ue){console.warn(" No auth token available when loading options"),k&&h(!0);return}const ne=await fetch(Q,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${ue}`}}),we=await ne.json();if(!ne.ok){console.warn(` ${e.optionsSource} fetch failed`,we),k&&h(!0);return}const Pe=Ce=>{if(!Ce||typeof Ce!="object")return null;const it=e.optionValueKey||"id",qe=e.optionLabelKey||"name",We=Ce?.[it]??Ce?.id??null;if(!We)return null;let ke=Ce?.[qe];if(!ke){const xt=["name","title","username"];for(const Mt of xt)if(Ce?.[Mt]){ke=Ce[Mt];break}}return ke||(ke=String(We)),{value:We,label:ke}},Re=Array.isArray(we?.data)?we.data.map(Pe).filter(Boolean):[];k&&(f(Re),h(!0),Re.length===0&&console.warn(` ${e.optionsSource} returned no data`,we))}catch(ue){console.error(` Failed to load ${e.optionsSource}:`,ue),k&&h(!0)}})(),()=>{k=!1}},[e.optionsSource,e.optionLabelKey,e.optionValueKey,p,e.roles,e.worldId,e.world_id,t?.world_id,t?.worldId]),u.useEffect(()=>{e?.selectedLabel&&v(k=>k.selectedLabel===String(e.selectedLabel)?k:{...k,selectedLabel:String(e.selectedLabel)})},[e?.selectedLabel]);const j=e.label||l,_=(e.type||"text").toLowerCase(),C=e.referenceTypeId??e.reference_type_id??e.referenceType?.id??null,O=e.referenceTypeName??e.reference_type_name??e.referenceType?.name??"",E=l.includes(".")?l.split(".").reduce((k,U)=>k?k[U]:void 0,t):t?.[l],T=["checkbox","boolean"].includes(_)?!!E:_==="multiselect"?Array.isArray(E)?E.map(k=>{if(k==null)return null;if(typeof k=="object"){const U=e.optionValueKey||"id",R=k?.[U]??k?.id??k?.value??k?.key??null;return R==null?null:String(R)}return String(k)}).filter(k=>k!=null):typeof E=="string"&&E.length>0?E.split(",").map(k=>k.trim()).filter(Boolean):[]:E??"",M=e.readonly||e.disabled,A=S||M,z=k=>k==null||k===""?"":Array.isArray(k)?k.length>0?k.join(", "):"":typeof k=="boolean"?k?"Yes":"No":String(k),P=z(T),X=k=>r?.(l,k.target.value),H=k=>r?.(l,k.target.checked),Y=u.useCallback((k,U)=>{if(!(!U||typeof U!="string")&&!(!k||typeof k!="object"))return U.includes(".")?U.split(".").filter(R=>R.length>0).reduce((R,q)=>{if(R!=null&&typeof R=="object")return R[q]},k):k?.[U]},[]),V=u.useCallback(()=>{const k=[e.worldId,e.world_id,t?.worldId,t?.world_id];e.world&&typeof e.world=="object"&&k.push(e.world.id,e.world.world_id),t?.world&&typeof t.world=="object"&&k.push(t.world.id,t.world.world_id),t?.metadata&&typeof t.metadata=="object"&&k.push(t.metadata.worldId,t.metadata.world_id);for(const U of k){if(U==null)continue;const R=String(U).trim();if(R)return R}return""},[e.worldId,e.world_id,e.world,t?.worldId,t?.world_id,t?.world,t?.metadata]),I=_==="reference"&&T!==void 0&&T!==null?String(T):"",F=u.useMemo(()=>{if(_!=="reference")return[];const k=e.options?.choices;return Array.isArray(k)?k.map((U,R)=>{if(U==null)return null;if(typeof U=="object"){const G=U.value??U.id??U.key??U.slug??`choice-${R}`;if(G==null)return null;const J=U.label??U.name??U.title??U.display??U.displayName??G;return{value:String(G),label:String(J)}}const q=String(U);return{value:q,label:q}}).filter(Boolean):[]},[_,e.options?.choices]);if(u.useEffect(()=>{_==="reference"&&(I||v(k=>!k.selectedLabel&&!k.selectedValue?k:{...k,selectedLabel:"",selectedValue:null}))},[_,I]),u.useEffect(()=>{if(_!=="reference"||!I)return;const k=F.find(R=>R.value===I),U=(()=>{if(typeof e.value=="object"&&e.value!==null){const R=e.value.label??e.value.name??e.value.title??e.value.display??e.value.displayName??e.value.text??e.value.value??e.value.id??null;if(R!=null){const q=String(R).trim();if(q)return q}}return k?.label?String(k.label):""})();if(!U){v(R=>R.selectedValue===I?R:{...R,selectedValue:I});return}v(R=>R.selectedValue===I&&R.selectedLabel===U?R:{...R,selectedLabel:U,selectedValue:I})},[_,I,e.value,F]),!l)return console.warn(" Field without key/name skipped:",e),null;const D=k=>{const U=[];return e.helpText&&U.push(a.jsx("p",{className:"help-text",children:e.helpText},"help")),k&&U.push(a.jsx("p",{className:"help-text warning",children:e.noOptionsMessage||"No options available."},"empty")),U};if(_==="reference"){const k=V(),U=typeof O=="string"&&O.trim()?O.trim():"entities",R=F.length>0,G=!!!(C&&k)&&!R;if(A){let Q=(e.displayKey&&Y(t,e.displayKey)?Y(t,e.displayKey):null)??g.selectedLabel??F.find(we=>we.value===I)?.label??"";!Q&&I&&(Q=I);const ue=Wy(E||e.value||I),ne=Zy(E||e.value)||Q||I;return a.jsxs("div",{className:`form-group ${A?"readonly":""}`,children:[a.jsx("label",{children:j}),a.jsxs("div",{style:{position:"relative",display:"inline-block",width:"100%"},children:[a.jsx("input",{type:"text",value:z(Q),disabled:!0,className:"readonly-control",style:{paddingRight:ue?"2.5rem":"0.8rem",width:"100%"}}),ue&&a.jsx("div",{style:{position:"absolute",right:"0.5rem",top:"50%",transform:"translateY(-50%)",zIndex:1},children:a.jsx(Is,{entityId:ue,entityName:ne,className:"entity-info-trigger--field-button"})})]}),D(!1)]})}const J=me=>{if(!me){r?.(l,""),v(we=>({...we,selectedLabel:"",selectedValue:null}));return}const Q=me.id??me.value??me.key??me.slug??me.uuid??null;if(Q==null){r?.(l,"");return}const ue=String(Q),ne=me.name??me.label??me.title??me.display??me.displayName??"";r?.(l,ue),v(we=>({...we,selectedLabel:ne||we.selectedLabel||ue,selectedValue:ue}))},ie=me=>{if(!me){v(we=>({...we,selectedLabel:"",selectedValue:null}));return}const Q=me.id??me.value??me.key??me.slug??me.uuid??null;if(Q==null)return;const ue=String(Q),ne=me.name??me.label??me.title??me.display??me.displayName??"";v(we=>we.selectedValue===ue&&we.selectedLabel===ne?we:{...we,selectedLabel:ne||we.selectedLabel||ue,selectedValue:ue})},Z=I&&g.selectedLabel?{id:I,name:g.selectedLabel}:I;return a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:j}),a.jsx(cc,{worldId:k,value:Z,allowedTypeIds:C?[C]:[],disabled:G,placeholder:`Search ${U.toLowerCase()}...`,staticOptions:F,onChange:J,onResolved:ie,required:!!e.required}),!C&&a.jsx("p",{className:"help-text warning",children:"Reference type configuration is missing."}),C&&!k&&a.jsx("p",{className:"help-text warning",children:"Select a world to search for entities."}),D(!1)]})}if(["select","dropdown"].includes(_)){const k=[...e.options||[],...c],U=T??"",R=m&&e.optionsSource&&k.length===0;if(A){const q=k.find(ie=>ie?typeof ie=="object"?String(ie.value)===String(U):String(ie)===String(U):!1),G=e.displayKey&&Y(t,e.displayKey)?Y(t,e.displayKey):null,J=z(G||(q?typeof q=="object"?q.label??q.value:q:U));return a.jsxs("div",{className:`form-group ${A?"readonly":""}`,children:[a.jsx("label",{children:j}),a.jsx("input",{type:"text",value:J,disabled:!0,className:"readonly-control"}),D(!1)]})}return a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:j}),a.jsx("div",{className:"select-wrapper",children:a.jsxs("select",{value:U,onChange:X,disabled:R,children:[a.jsx("option",{value:"",children:"Select..."}),k.map((q,G)=>{const J=typeof q=="object"?q.value:q,ie=typeof q=="object"?q.label:q;return a.jsx("option",{value:J,children:ie},J||G)})]})}),D(R)]})}if(_==="multiselect"){const k=[...Array.isArray(e.selectedOptions)?e.selectedOptions:[],...Array.isArray(e.prefillOptions)?e.prefillOptions:[]],U=[...e.options||[],...c,...k].map((ie,Z)=>{const me=aN(ie);if(me)return me;if(typeof ie=="object"&&ie!==null){const ue=ie.value??ie.id??ie.key??ie.slug??`opt-${Z}`,ne=ie.label??ie.name??ie.title??ie.username??ie.email??ue;return ue==null?null:{value:String(ue),label:String(ne)}}if(ie==null)return null;const Q=String(ie);return{value:Q,label:Q}}).filter(Boolean),R=new Map,q=U.filter(ie=>{const Z=String(ie.value);return R.has(Z)?!1:(R.set(Z,ie),!0)}),G=Array.isArray(T)?T.map(ie=>String(ie)).filter(Boolean):[],J=m&&e.optionsSource&&q.length===0;if(A){const ie=G.map(Z=>{const me=R.get(String(Z));return me?me.label??me.value??String(Z):String(Z)}).filter(Boolean);return a.jsxs("div",{className:`form-group ${A?"readonly":""}`,children:[a.jsx("label",{children:j}),a.jsx("textarea",{className:"textarea-field",value:ie.length?ie.join(`
`):"",readOnly:!0}),D(!1)]})}return a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:j}),a.jsx(Ts,{selected:G,options:q,onChange:ie=>r?.(l,ie),placeholder:e.placeholder||"Search and select...",noOptionsMessage:e.noOptionsMessage||"No options available.",loading:!m&&!!e.optionsSource}),D(J)]})}if(["textarea","multiline"].includes(_))return a.jsxs("div",{className:`form-group ${A?"readonly":""}`,children:[a.jsx("label",{children:j}),a.jsx("textarea",{className:"textarea-field",rows:e.rows||4,value:A?P:T,onChange:X,disabled:A}),D(!1)]});if(["checkbox","boolean"].includes(_))return a.jsxs("div",{className:"form-group checkbox",children:[a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:!!T,onChange:H,disabled:A}),j]}),D(!1)]});if(_==="readonly"){const k=T?.username||T?.name||T||"-";return a.jsxs("div",{className:"form-group readonly",children:[a.jsx("label",{children:j}),a.jsx("div",{className:"readonly-value",children:k}),D(!1)]})}const L=(A?"text":e.inputType)||"text",B=(()=>{if(T==null)return"";if(new Set(["number","date","datetime-local","month","time","week","range"]).has(L)&&typeof T=="string"){const U=T.trim();if(!U||U==="")return""}return T})();return A?a.jsxs("div",{className:"form-group readonly",children:[a.jsx("label",{children:j}),a.jsx("div",{className:"readonly-value",children:P}),D(!1)]}):a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:j}),a.jsx("input",{type:L,value:B,onChange:X,placeholder:e.placeholder||"",className:A?"readonly-control":void 0}),D(!1)]})}const lN="You have unsaved changes. Select Cancel to stay here and save, or OK to leave without saving.";function Zk(e,t=lN,r){const i=u.useCallback(({currentLocation:l,nextLocation:c})=>!e||r?.current?!1:!(l.pathname===c.pathname&&l.search===c.search&&l.hash===c.hash),[e,r]);Y2({when:i,message:t}),v1(u.useCallback(l=>{!e||r?.current||(l.preventDefault(),l.returnValue="")},[e,r]),{capture:!0})}function Qk({schema:e,initialData:t={},onSubmit:r,onCancel:i,onDelete:l,hideActions:c=!1,enableUnsavedPrompt:f=!0,onStateChange:m,fieldRules:h},p){const[y,g]=u.useState(()=>t?{...t}:{}),[v,S]=u.useState(()=>JSON.stringify(t??{})),[w,N]=u.useState(""),[j,_]=u.useState("success"),[C,O]=u.useState(!1),[E,T]=u.useState(()=>({actionsByField:{},showRuleTargets:new Set})),M=u.useMemo(()=>{if(!e)return[];const q=Array.isArray(e.fields)?e.fields.filter(J=>J&&typeof J=="object"):[],G=Array.isArray(e.sections)?e.sections.flatMap(J=>Array.isArray(J?.fields)?J.fields:[]).filter(J=>J&&typeof J=="object"):[];return q.length===0&&G.length===0?[]:[...G,...q]},[e]),A=u.useMemo(()=>{const q=Array.isArray(h)?h:[];return Xy(q,M)},[h,M]);u.useEffect(()=>{const q=t?{...t}:{};g(q),S(JSON.stringify(t??{})),N(""),_("success")},[t]),u.useEffect(()=>{if(!A.length){T({actionsByField:{},showRuleTargets:new Set});return}const q=Ky(A,y);T(q)},[A,y]);const z=u.useMemo(()=>Array.isArray(e?.sections)&&e.sections.length>0?e.sections:Array.isArray(e?.fields)?[{title:e.title,columns:e.columns||1,fields:e.fields}]:[],[e]),P=(q,G,J)=>{if(!G||G.length===0)return q;const ie={...q||{}};let Z=ie;for(let me=0;me<G.length;me+=1){const Q=G[me];if(me===G.length-1)Z[Q]=J;else{const ne=Z[Q],we=ne&&typeof ne=="object"&&!Array.isArray(ne)?{...ne}:{};Z[Q]=we,Z=we}}return ie},X=(q,G)=>{if(!(!G||typeof G!="string")&&!(!q||typeof q!="object"))return G.includes(".")?G.split(".").filter(J=>J.length>0).reduce((J,ie)=>{if(J!=null&&typeof J=="object")return J[ie]},q):q?.[G]},H=(q,G)=>{!q||typeof q!="string"||g(J=>{if(!q.includes("."))return{...J||{},[q]:G};const ie=q.split(".").filter(Z=>Z.length>0);return ie.length===0?{...J||{}}:P(J,ie,G)})},Y=u.useMemo(()=>JSON.stringify(y??{}),[y]),V=u.useMemo(()=>Y!==v,[Y,v]),I=u.useRef(!1);u.useEffect(()=>{V||(I.current=!1)},[V]),u.useEffect(()=>{V&&w&&(N(""),_("success"))},[V,w]),u.useEffect(()=>{typeof m=="function"&&m({isDirty:V,isSubmitting:C})},[V,C,m]),Zk(f&&V,void 0,I);const D=u.useCallback(()=>{if(!z.length)return!0;const q=[];return z.forEach(G=>{(Array.isArray(G.fields)?G.fields:[]).forEach(ie=>{const Z=ie?.key||ie?.name||ie?.field;if(!Z)return;const me=E.actionsByField[Z],Q=ie?.visibleByDefault!==void 0?!!ie.visibleByDefault:ie?.visible_by_default!==void 0?!!ie.visible_by_default:!0;if(uc(Z,me,E.showRuleTargets,Q)||!(!!ie?.required||me==="require"))return;const ne=X(y,Z);(Array.isArray(ne)?ne.length>0:ne!=null&&ne!=="")||q.push(ie.label||ie.name||Z)})}),q.length>0?(_("error"),N(`Please complete required fields: ${q.join(", ")}`),!1):!0},[z,y,E]),L=u.useCallback(async()=>{if(!r)return!0;if(!D())return!1;const q=JSON.stringify(y??{});O(!0),_("success"),N(""),I.current=!0;try{const G=await r(y);if(G===!1)return I.current=!1,!1;const J=G&&typeof G=="object"&&!Array.isArray(G)?G:{};S(q);const ie=typeof G=="string"?G:J.message||e?.saveSuccessMessage||"";if(ie){const Z=J.status==="error"?"error":"success";_(Z),N(ie)}return I.current=!1,J}catch(G){return console.error("Failed to submit form:",G),_("error"),N(G.message||"Failed to save changes."),I.current=!1,!1}finally{O(!1)}},[y,r,e,D]),B=async q=>{q.preventDefault(),await L()},k=()=>{i&&(!V||window.confirm(lN))&&(S(Y),I.current=!0,i())},U=async()=>{if(l)try{await l(y)&&(S(Y),I.current=!0)}catch(q){console.error("Failed to delete record:",q)}},R=u.useCallback((q=t)=>{const G=q?{...q}:{};g(G),S(JSON.stringify(q??{})),N(""),_("success"),I.current=!1},[t]);return u.useImperativeHandle(p,()=>({submit:L,reset:R,isDirty:()=>V,isSubmitting:()=>C}),[L,R,V,C]),a.jsxs("form",{className:"record-form",onSubmit:B,children:[a.jsx("h2",{className:"form-title",children:e?.title||"Record"}),z.map((q,G)=>a.jsxs("div",{className:"form-section",children:[q.title?a.jsx("h3",{children:q.title}):null,a.jsx("div",{className:`form-grid cols-${q.columns||1} ${(q.columns||1)>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":""}`,children:(q.fields||[]).map((J,ie)=>{if(!J||typeof J!="object")return console.warn(" Skipping invalid field in schema:",J),null;const Z=J.key||J.name||J.field||`field-${ie}`,me=E.actionsByField[Z],Q=J.visibleByDefault!==void 0?!!J.visibleByDefault:J.visible_by_default!==void 0?!!J.visible_by_default:!0;if(uc(Z,me,E.showRuleTargets,Q))return null;const ue={...J};me==="disable"&&(ue.disabled=!0),me==="require"&&(ue.required=!0);const ne=J.span||J.colSpan||null,we=a.jsx(hf,{field:ue,data:y,onChange:H,mode:"edit"},`${Z}-${ie}`);return ne&&Number.isFinite(ne)&&ne>1?a.jsx("div",{style:{gridColumn:`span ${ne}`},children:we},`${Z}-${ie}-wrapper`):we})})]},G)),w?a.jsx("div",{className:`form-feedback ${j}`,role:j==="error"?"alert":"status",children:w}):null,c?null:a.jsxs("div",{className:"form-actions sticky-actions",role:"toolbar",children:[a.jsx("div",{className:"left-actions",children:l?a.jsx("button",{type:"button",className:"btn delete",onClick:U,disabled:C,children:e?.deleteLabel||"Delete"}):null}),a.jsxs("div",{className:"right-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:k,disabled:C,children:e?.cancelLabel||"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:C,children:e?.saveLabel||"Save"})]})]})]})}const ps=u.forwardRef(Qk),Jk="Create New World",e3=[{title:"General",columns:2,fields:[{key:"name",label:"Name",type:"text"},{key:"system",label:"System",type:"text"}]},{title:"Entity Creation",columns:1,fields:[{key:"entity_creation_scope",label:"Who can create entities?",type:"select",options:[{value:"owner_dm",label:"World Owner & DMs"},{value:"all_players",label:"All Players (campaign scoped)"}],helpText:"When set to All Players, campaign members can only create entities scoped to their campaign."}]},{title:"Description",columns:1,fields:[{key:"description",label:"Description",type:"textarea"}]}],t3={title:Jk,sections:e3},dc={OWNER_DMS:"owner_dm",ALL_PLAYERS:"all_players"},Ph=[{value:dc.OWNER_DMS,label:"World Owner / DMs"},{value:dc.ALL_PLAYERS,label:"All Players (campaign scoped)"}],oN=e=>{if(!e)return Ph[0].label;const t=String(e).trim().toLowerCase(),r=Ph.find(i=>i.value===t);return r?r.label:Ph[0].label};function n3(){const e=zn(),{token:t,sessionReady:r}=En(),[i,l]=u.useState([]),[c,f]=u.useState(!1),[m,h]=u.useState(null),[p,y]=u.useState(!1),g=u.useCallback(async()=>{if(t){f(!0),h(null);try{const j=await $l();l(j?.data||j||[])}catch(j){console.error(" Failed to load worlds:",j),h(j.message)}finally{f(!1)}}},[t]);u.useEffect(()=>{r&&t&&g()},[r,t,g]);const v=[{key:"name",label:"Name"},{key:"system",label:"System"},{key:"status",label:"Status"},{key:"entity_creation_scope",label:"Entity Creation",render:j=>oN(j.entity_creation_scope)},{key:"description",label:"Description"},{key:"createdAt",label:"Created"}],S=()=>y(!0),w=()=>y(!1),N=async j=>{try{return(await GM(j)).success?(await g(),y(!1),!0):!1}catch(_){return alert(`Failed to create world: ${_.message}`),!1}};return r?t?c?a.jsx("p",{children:"Loading worlds..."}):m?a.jsxs("p",{className:"error",children:["Error: ",m]}):p?a.jsx(ps,{schema:t3,initialData:{entity_creation_scope:dc.OWNER_DMS},onSubmit:N,onCancel:w,showUpdateAction:!1}):a.jsx(ff,{data:i,columns:v,title:"Worlds",extraActions:a.jsx("button",{type:"button",className:"btn submit",onClick:S,children:"+ New"}),onRowClick:j=>e(`/worlds/${j.id}`)}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}function cN({schema:e,data:t={},onClose:r,closeLabel:i="Back",infoMessage:l}){const c=u.useMemo(()=>Array.isArray(e?.sections)&&e.sections.length>0?e.sections:Array.isArray(e?.fields)?[{title:e.title,columns:e.columns||1,fields:e.fields}]:[],[e]);return a.jsxs("div",{className:"record-form record-view",children:[a.jsx("h2",{className:"form-title",children:e?.title||"Details"}),c.map((f,m)=>a.jsxs("div",{className:"form-section",children:[f.title?a.jsx("h3",{children:f.title}):null,a.jsx("div",{className:`form-grid cols-${f.columns||1}`,children:(f.fields||[]).map((h,p)=>!h||typeof h!="object"?(console.warn(" Skipping invalid field in schema:",h),null):a.jsx(hf,{field:h,data:t,mode:"view"},`${h.key||h.name||h.field||"field"}-${p}`))})]},m)),l?a.jsx("p",{className:"record-info",children:l}):null,r?a.jsxs("div",{className:"form-actions sticky-actions view-actions",role:"toolbar",children:[a.jsx("div",{className:"left-actions","aria-hidden":"true"}),a.jsx("div",{className:"right-actions",children:a.jsx("button",{type:"button",className:"btn cancel",onClick:r,children:i})})]}):null]})}const a3="Edit World",s3=[{title:"General",columns:2,fields:[{key:"name",label:"Name",type:"text"},{key:"system",label:"System",type:"text"},{key:"status",label:"Status",type:"select",options:[{value:"active",label:"Active"},{value:"archived",label:"Archived"}]}]},{title:"Entity Creation",columns:1,fields:[{key:"entity_creation_scope",label:"Who can create entities?",type:"select",options:[{value:"owner_dm",label:"World Owner & DMs"},{value:"all_players",label:"All Players (campaign scoped)"}],helpText:"When set to All Players, campaign members can only create entities scoped to their campaign."}]},{title:"Description",columns:1,fields:[{key:"description",label:"Description",type:"textarea"}]},{title:"Metadata",columns:2,fields:[{key:"created_by",label:"Created By",type:"readonly"},{key:"createdAt",label:"Created Date",type:"readonly"},{key:"updatedAt",label:"Updated Date",type:"readonly"}]}],r3={title:a3,sections:s3},i3="World Details",l3=[{title:"General",columns:2,fields:[{name:"name",label:"Name",type:"text"},{name:"system",label:"System",type:"text"},{name:"statusLabel",label:"Status",type:"text"},{name:"entityCreationScopeLabel",label:"Entity Creation",type:"text"}]},{title:"Description",columns:1,fields:[{name:"description",label:"Description",type:"textarea"}]},{title:"Metadata",columns:2,fields:[{name:"ownerName",label:"Created By",type:"text"},{name:"createdAt",label:"Created",type:"text"},{name:"updatedAt",label:"Updated",type:"text"}]}],o3={title:i3,sections:l3},Hr=e=>{if(!e)return"";const t=e instanceof Date?e:new Date(e);if(Number.isNaN(t.getTime()))return typeof e=="string"?e:"";const r=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+1).padStart(2,"0"),l=t.getFullYear(),c=String(t.getHours()).padStart(2,"0"),f=String(t.getMinutes()).padStart(2,"0");return`${r}/${i}/${l} ${c}:${f}`};function c3(){const{id:e}=vs(),t=zn(),{user:r,token:i,sessionReady:l}=En(),[c,f]=u.useState(null),[m,h]=u.useState(!0),[p,y]=u.useState(null),g=u.useCallback(async()=>{try{const _=await $l(),C=(_?.data||_||[]).find(O=>O.id===e);f(C),C||y("World not found")}catch(_){console.error(" Failed to load world:",_),y(_.message)}finally{h(!1)}},[e]);u.useEffect(()=>{l&&i&&g()},[l,i,g]);const v=async(_,C={})=>{const{stayOnPage:O=!1}=C;try{const E={name:_?.name,description:_?.description,system:_?.system,status:_?.status,entity_creation_scope:_?.entity_creation_scope},T=await XM(e,E);if(T.success){const M=T.data||{...c,...E};return f(M),O?{message:"World updated successfully."}:(t("/worlds"),!0)}return!1}catch(E){return alert(`Failed to update world: ${E.message}`),!1}},S=async()=>{if(!confirm("Delete this world?"))return!1;try{return(await KM(e)).success?(t("/worlds"),!0):!1}catch(_){return alert(`Failed to delete world: ${_.message}`),!1}},w=u.useMemo(()=>!c||!r?!1:r.role==="system_admin"?!0:c.created_by===r.id,[r,c]),N=u.useMemo(()=>c?{...c,created_by:c.creator||c.created_by}:null,[c]),j=u.useMemo(()=>{if(!c)return null;const _=c.status||"",C=_.length>0?_.charAt(0).toUpperCase()+_.slice(1):"",O=oN(c.entity_creation_scope),E=c.creator?.username||c.creator?.name||c.created_by||"";return{name:c.name||"",system:c.system||"",statusLabel:C,entityCreationScopeLabel:O,description:c.description||"",ownerName:E,createdAt:Hr(c.createdAt),updatedAt:Hr(c.updatedAt)}},[c]);return l?i?m?a.jsx("p",{children:"Loading world..."}):p?a.jsxs("p",{className:"error",children:["Error: ",p]}):c?w?a.jsx(ps,{schema:r3,initialData:N||c,onSubmit:v,onDelete:S,onCancel:()=>t("/worlds")}):a.jsx(cN,{schema:o3,data:j||{},onClose:()=>t("/worlds"),closeLabel:"Back to worlds",infoMessage:"You can view this world but only the creator or a system admin can make changes."}):a.jsx("p",{children:"World not found"}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const Jy="http://localhost:3000/api/user-campaign-roles";async function u3(e=5,t=200){for(let r=0;r<e;r++){const i=Zr();if(i)return i;await new Promise(l=>setTimeout(l,t))}return null}async function eg(){const e=await u3();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function tg(e,t="request"){if(e.status===401)throw new Error("Unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${e.status} ${r}`)}return e.json()}async function d3(e){if(!e)throw new Error("campaignId is required");const t=await eg(),r=new URL(Jy);r.searchParams.set("campaign_id",e);const i=await fetch(r.toString(),{headers:t});return tg(i,"load campaign members")}async function f3(e,t){const r=await eg(),i=await fetch(`${Jy}/${e}`,{method:"PUT",headers:r,body:JSON.stringify(t)});return tg(i,"update campaign assignment")}async function m3(e){const t=await eg(),r=await fetch(`${Jy}/${e}`,{method:"DELETE",headers:t});return tg(r,"remove user from campaign")}const h3=[{label:"Dungeon Master",value:"dm"},{label:"Player",value:"player"},{label:"Observer",value:"observer"}];function p3({campaignId:e,canManage:t,onMembersChanged:r}){const[i,l]=u.useState([]),[c,f]=u.useState(!0),[m,h]=u.useState(null),p=u.useCallback(async()=>{if(e){h(null),f(!0);try{const S=(await d3(e))?.data||[];l(S)}catch(v){h(v.message)}finally{f(!1)}}},[e]);u.useEffect(()=>{p()},[p]);const y=async(v,S)=>{h(null);try{const N=(await f3(v,{role:S}))?.data;N&&l(j=>{const _=j.map(C=>C.id===N.id?N:C);return typeof r=="function"&&r(_),_})}catch(w){h(w.message)}},g=async v=>{if(confirm("Remove this user from the campaign?")){h(null);try{await m3(v),l(S=>{const w=S.filter(N=>N.id!==v);return typeof r=="function"&&r(w),w})}catch(S){h(S.message)}}};return e?a.jsx(a.Fragment,{children:a.jsxs("div",{className:"panel",children:[a.jsx("div",{className:"panel-header",children:a.jsx("h3",{children:"Campaign Members"})}),m&&a.jsx("p",{className:"error",children:m}),c?a.jsx("p",{children:"Loading members"}):i.length===0?a.jsx("p",{children:"No users associated with this campaign yet."}):a.jsxs("table",{className:"compact-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"User"}),a.jsx("th",{children:"Role"}),a.jsx("th",{children:"Added"}),t?a.jsx("th",{children:"Actions"}):null]})}),a.jsx("tbody",{children:i.map(v=>a.jsxs("tr",{children:[a.jsx("td",{children:v.user?.username||v.user?.email||v.user_id}),a.jsx("td",{children:t?a.jsx("select",{value:v.role,onChange:S=>y(v.id,S.target.value),children:h3.map(S=>a.jsx("option",{value:S.value,children:S.label},S.value))}):v.role}),a.jsx("td",{children:v.createdAt?new Date(v.createdAt).toLocaleString():""}),t?a.jsx("td",{children:a.jsx("button",{type:"button",className:"btn danger",onClick:()=>g(v.id),children:"Remove"})}):null]},v.id))})]}),t?a.jsx("p",{className:"help-text",children:"Manage who can participate through the Players list. Update roles here to promote Dungeon Masters or set observers."}):null]})}):null}const y3="New Campaign",g3=[{name:"world_id",label:"World",type:"select",optionsSource:"worlds",required:!0},{name:"name",label:"Name",type:"text",required:!0,placeholder:"Enter campaign name"},{name:"description",label:"Description",type:"textarea",placeholder:"Brief description of the campaign world"},{name:"status",label:"Status",type:"select",options:[{label:"Draft",value:"draft"},{label:"Active",value:"active"},{label:"Completed",value:"completed"},{label:"Archived",value:"archived"}],default:"draft"}],b3="Create Campaign",v3={title:y3,fields:g3,submitLabel:b3},x3="Edit Campaign",S3=[{name:"world_id",label:"World",type:"select",optionsSource:"worlds",required:!0,readonly:!0},{name:"name",label:"Name",type:"text",required:!0},{name:"description",label:"Description",type:"textarea"},{name:"status",label:"Status",type:"select",options:[{label:"Draft",value:"draft"},{label:"Active",value:"active"},{label:"Completed",value:"completed"},{label:"Archived",value:"archived"}]},{name:"player_ids",label:"Players",type:"multiselect",optionsSource:"players",optionLabelKey:"username",optionValueKey:"id",helpText:"Players selected here can create characters in this campaign.",noOptionsMessage:"No eligible players are currently available."}],w3="Save Changes",N3="Delete Campaign",K0={title:x3,fields:S3,submitLabel:w3,deleteLabel:N3},E3="Campaign Details",j3=[{title:"Overview",columns:2,fields:[{name:"name",label:"Name",type:"text"},{name:"statusLabel",label:"Status",type:"text"},{name:"worldName",label:"World",type:"text"},{name:"ownerName",label:"Owner",type:"text"}]},{title:"Description",columns:1,fields:[{name:"description",label:"Description",type:"textarea"}]},{title:"Metadata",columns:2,fields:[{name:"createdAt",label:"Created",type:"text"},{name:"updatedAt",label:"Updated",type:"text"}]}],_3={title:E3,sections:j3};function Hu({scope:e="all"}){const t=zn(),{id:r}=vs(),{user:i,token:l,sessionReady:c}=En(),[f,m]=u.useState([]),[h,p]=u.useState(!1),[y,g]=u.useState("list"),[v,S]=u.useState(null),[w,N]=u.useState(null),[j,_]=u.useState("details"),C=u.useMemo(()=>`/campaigns/${e}`,[e]),O=u.useCallback(Q=>{if(!Q)return Q;const ue=Array.isArray(Q.members)?Q.members.filter(ne=>ne.role==="player"):[];return{...Q,ownerName:Q.owner?.username||"",worldName:Q.world?.name||"",player_ids:ue.map(ne=>ne.user_id)}},[]),E=u.useCallback(async()=>{if(l){p(!0),N(null);try{const Q=await _c(),ne=(Q?.data||Q||[]).map(we=>O(we));m(ne)}catch(Q){N(Q.message)}finally{p(!1)}}},[l,O]);u.useEffect(()=>{c&&l&&E()},[c,l,E]),u.useEffect(()=>{g("list"),S(null),_("details")},[e]),u.useEffect(()=>{if(!r){y!=="new"&&g("list"),S(null);return}const Q=f.find(ne=>String(ne.id)===r);if(!Q){h||t(C,{replace:!0});return}const ue=!!i&&(i.role==="system_admin"||Q.created_by===i.id);S(Q),g(ue?"edit":"view")},[r,f,t,C,h,y,i]),u.useEffect(()=>{_("details")},[v?.id]);const T=u.useMemo(()=>[{key:"name",label:"Name"},{key:"worldName",label:"World"},{key:"ownerName",label:"Owner"},{key:"status",label:"Status"},{key:"description",label:"Description"},{key:"createdAt",label:"Created"}],[]),M=Q=>!Q||!i?!1:i.role==="system_admin"||Q.created_by===i.id,A=u.useMemo(()=>{if(i?.role!=="system_admin")return K0;const Q=JSON.parse(JSON.stringify(K0)),ue={name:"created_by",label:"Owner",type:"select",optionsSource:"users",optionLabelKey:"username",optionValueKey:"id"};if(Array.isArray(Q.fields)){const ne=Q.fields.findIndex(we=>we?.name==="created_by");if(ne>=0)Q.fields[ne]={...Q.fields[ne],...ue};else{const we=Math.min(2,Q.fields.length);Q.fields.splice(we,0,ue)}}return Q},[i]),z=()=>{t(C),g("new"),S(null)},P=()=>{g("list"),S(null),t(C)},X=async Q=>{try{return(await $M(Q)).success?(await E(),t(C),g("list"),S(null),!0):!1}catch(ue){return alert(`Failed to create campaign: ${ue.message}`),!1}},H=async(Q,ue={})=>{const{stayOnPage:ne=!1}=ue;if(!M(v))return alert("You do not have permission to update this campaign."),!1;const we={...Q};Object.prototype.hasOwnProperty.call(Q,"player_ids")&&(Array.isArray(Q.player_ids)?we.player_ids=Q.player_ids.filter(Pe=>Pe!=null&&Pe!==""):typeof Q.player_ids=="string"&&Q.player_ids!==""?we.player_ids=[Q.player_ids]:we.player_ids=[]);try{const Pe=await FM(v.id,we);if(Pe.success){const Re=O(Pe.data);return m(Ce=>Ce.map(it=>it.id===Re.id?Re:it)),S(Ce=>!Ce||Ce.id!==Re.id?Ce:Re),ne?{message:"Campaign updated successfully."}:(g("list"),S(null),t(C),!0)}return!1}catch(Pe){return alert(`Failed to update campaign: ${Pe.message}`),!1}},Y=u.useCallback((Q,ue)=>{const ne=we=>{if(!Array.isArray(we))return{members:[],playerIds:[]};const Pe=we.filter(Re=>Re.role==="player");return{members:we,playerIds:Pe.map(Re=>Re.user_id)}};m(we=>we.map(Pe=>{if(Pe.id!==Q)return Pe;const{members:Re,playerIds:Ce}=ne(ue);return{...Pe,members:Re,player_ids:Ce}})),S(we=>{if(!we||we.id!==Q)return we;const{members:Pe,playerIds:Re}=ne(ue);return{...we,members:Pe,player_ids:Re}})},[]),V=async Q=>{const ue=Q||v,ne=ue?.id;if(!ne)return!1;if(!M(ue))return alert("You do not have permission to delete this campaign."),!1;if(!confirm("Delete this campaign?"))return!1;try{return(await BM(ne)).success?(await E(),g("list"),S(null),t(C),!0):!1}catch(we){return alert(we.message),!1}},I=()=>{g("list"),S(null),t(C)},F=u.useMemo(()=>{if(!v)return null;const Q=v.created_by??v.owner?.id??"",ue=Array.isArray(v.members)?v.members.filter(ne=>ne.role==="player"):[];return{...v,created_by:Q,player_ids:ue.map(ne=>ne.user_id)}},[v]),D=u.useMemo(()=>{const Q=JSON.parse(JSON.stringify(A));return Array.isArray(Q.fields)?Q.fields=Q.fields.filter(ue=>ue?.name!=="player_ids"):Array.isArray(Q.sections)&&(Q.sections=Q.sections.map(ue=>({...ue,fields:(ue.fields||[]).filter(ne=>ne?.name!=="player_ids")})).filter(ue=>ue.fields&&ue.fields.length>0)),Q.title="Campaign Details",Q},[A]),L=u.useMemo(()=>{if(!v||!Array.isArray(v.members))return[];const Q=new Set;return v.members.map(ue=>{const ne=ue?.user_id??ue?.user?.id;if(!ne)return null;const we=String(ne);if(Q.has(we))return null;Q.add(we);const Pe=ue?.user?.username||ue?.user?.displayName||ue?.user?.display_name||ue?.user?.name||ue?.user?.email||ue?.display_name||we;return{value:we,label:Pe}}).filter(Boolean)},[v]),B=u.useMemo(()=>{const Q={title:"Campaign Membership",fields:[]},ue=we=>{if(!we)return null;if(Array.isArray(we.fields)){for(const Pe of we.fields)if(Pe?.name==="player_ids")return Pe}return null};let ne=null;if(Array.isArray(A.fields))ne=ue(A);else if(Array.isArray(A.sections)){for(const we of A.sections)if(ne=ue(we),ne)break}if(ne){const we=JSON.parse(JSON.stringify(ne));L.length>0&&(we.selectedOptions=L),Q.fields=[we]}return Q},[A,L]),k=u.useMemo(()=>F?{player_ids:F.player_ids??[]}:null,[F]),U=u.useMemo(()=>{if(!v)return null;const Q=v.status||"",ue=Q?Q.charAt(0).toUpperCase()+Q.slice(1):"";return{...v,statusLabel:ue,createdAt:Hr(v.createdAt),updatedAt:Hr(v.updatedAt)}},[v]),R=u.useMemo(()=>e==="my"?i?.id?f.filter(Q=>Q.created_by===i.id):[]:f,[f,e,i]),q=e==="my"?"My Campaigns":"All Campaigns",G=e==="my"?"Back to my campaigns":"Back to all campaigns",J=u.useMemo(()=>!v||!Array.isArray(v.members)||!i?.id?!1:v.members.some(Q=>Q?.user_id===i.id&&Q?.role==="dm"),[v,i]),ie=v?`/campaigns/${v.id}/access/bulk`:"",me=e!=="my"&&!!(v&&J)&&ie?a.jsxs("div",{className:"campaign-access-cta",children:[a.jsxs("div",{children:[a.jsx("p",{className:"campaign-access-eyebrow",children:"Campaign Tools"}),a.jsxs("h3",{children:["Manage entity access for ",v.name]}),a.jsx("p",{className:"campaign-access-copy",children:"The Campaign Access Editor keeps changes scoped to this campaigns members."})]}),a.jsx("div",{className:"campaign-access-actions",children:a.jsx(Jt,{to:ie,className:"btn outline",children:"Open Access Editor"})})]}):null;return c?l?h?a.jsx("p",{children:"Loading campaigns..."}):w?a.jsxs("p",{className:"error",children:["Error: ",w]}):y==="new"?a.jsx(ps,{schema:v3,initialData:{},onSubmit:X,onCancel:P,showUpdateAction:!1}):y==="edit"&&v&&F?a.jsxs("div",{className:"campaign-editor",children:[me,a.jsxs("div",{className:"campaign-tabs",role:"tablist","aria-label":"Campaign editor tabs",children:[a.jsx("button",{type:"button",role:"tab","aria-selected":j==="details",className:`campaign-tab${j==="details"?" is-active":""}`,onClick:()=>_("details"),children:"Details"}),a.jsx("button",{type:"button",role:"tab","aria-selected":j==="membership",className:`campaign-tab${j==="membership"?" is-active":""}`,onClick:()=>_("membership"),children:"Membership"})]}),a.jsx("div",{className:"campaign-tab-panel",role:"tabpanel",children:j==="details"?a.jsx(ps,{schema:D,initialData:F,onSubmit:H,onDelete:V,onCancel:P}):a.jsxs("div",{className:"campaign-membership",children:[a.jsx(ps,{schema:B,initialData:k,onSubmit:H,onCancel:P}),a.jsx(p3,{campaignId:v.id,canManage:M(v),onMembersChanged:Q=>Y(v.id,Q)})]})})]}):y==="view"&&v?a.jsxs("div",{className:"campaign-view-wrapper",children:[me,a.jsx(cN,{schema:_3,data:U||{},onClose:I,closeLabel:G,infoMessage:"You can view this campaign but only the owner or a system admin can make changes."})]}):a.jsx(ff,{data:R,columns:T,title:q,extraActions:a.jsx("button",{type:"button",className:"btn submit",onClick:z,children:"+ New"}),onRowClick:Q=>{S(Q),g(M(Q)?"edit":"view"),t(`${C}/${Q.id}`)}}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const C3="New Character",A3=[{title:"Associations",columns:2,fields:[{key:"campaign_id",label:"Campaign",type:"select",optionsSource:"campaigns",required:!0,noOptionsMessage:"You do not have any campaigns available for character creation.",helpText:"Only campaigns you own or have been added to as a player are listed here."},{key:"user_id",label:"Player",type:"select",optionsSource:"users",optionLabelKey:"username",required:!0}]},{title:"Character Details",columns:2,fields:[{key:"name",label:"Name",type:"text",placeholder:"Character name",required:!0},{key:"level",label:"Level",type:"text",inputType:"number",placeholder:"1"},{key:"class",label:"Class",type:"text",placeholder:"Fighter, Wizard..."},{key:"race",label:"Race",type:"text",placeholder:"Elf, Human..."},{key:"alignment",label:"Alignment",type:"text",placeholder:"Neutral Good"},{key:"is_active",label:"Active Character",type:"checkbox"}]},{title:"Notes",columns:1,fields:[{key:"notes",label:"Notes",type:"textarea",rows:6,placeholder:"Backstory, hooks, etc."}]}],T3={title:C3,sections:A3},M3="Edit Character",R3=[{title:"Associations",columns:2,fields:[{key:"campaign_id",label:"Campaign",type:"select",optionsSource:"campaigns",required:!0},{key:"user_id",label:"Player",type:"select",optionsSource:"users",optionLabelKey:"username",required:!0}]},{title:"Character Details",columns:2,fields:[{key:"name",label:"Name",type:"text",required:!0},{key:"level",label:"Level",type:"text",inputType:"number"},{key:"class",label:"Class",type:"text"},{key:"race",label:"Race",type:"text"},{key:"alignment",label:"Alignment",type:"text"},{key:"is_active",label:"Active Character",type:"checkbox"}]},{title:"Notes",columns:1,fields:[{key:"notes",label:"Notes",type:"textarea",rows:6}]}],k3={title:M3,sections:R3},Lo=(e={})=>({id:e.id,name:e.name||"",race:e.race||"",class:e.class||"",level:e.level??1,alignment:e.alignment||"",notes:e.notes||"",is_active:e.is_active??!0,campaign_id:e.campaign_id||"",user_id:e.user_id||""}),W0=(e={})=>{const t=Number(e.level);return{name:e.name,race:e.race||null,class:e.class||null,level:Number.isNaN(t)?1:t,alignment:e.alignment||null,notes:e.notes||null,is_active:!!e.is_active,campaign_id:e.campaign_id||null,user_id:e.user_id||null}};function Dr({scope:e="my"}){const t=zn(),{id:r}=vs(),{token:i,sessionReady:l,user:c}=En(),{selectedCampaign:f,selectedCampaignId:m,setSelectedCampaignId:h}=Bn(),[p,y]=u.useState([]),[g,v]=u.useState(!1),[S,w]=u.useState(null),[N,j]=u.useState("list"),[_,C]=u.useState(null),[O,E]=u.useState(null),[T,M]=u.useState(""),A=u.useMemo(()=>`/characters/${e}`,[e]),z=u.useMemo(()=>!f||!Array.isArray(f.members)||!c?.id?!1:f.members.some(R=>R?.user_id===c.id&&R?.role==="player"),[f,c]),P=u.useMemo(()=>!f||!Array.isArray(f.members)||!c?.id?!1:f.members.some(R=>R?.user_id===c.id&&R?.role==="dm"),[f,c]),X=u.useMemo(()=>{switch(e){case"my":return"My Characters";case"others":return f?.name?`All Characters  ${f.name}`:"All Characters";case"all":return"All Characters";case"companions":return f?.name?`My Companions  ${f.name}`:"My Companions";default:return"Characters"}},[e,f]),H=e==="my"||c?.role==="system_admin";u.useEffect(()=>{e==="all"&&c&&c.role!=="system_admin"&&t("/characters/my",{replace:!0})},[e,c,t]),u.useEffect(()=>{j("list"),C(null),E(null),M("")},[e]),u.useEffect(()=>{if(!r){N!=="new"&&j("list"),C(null),E(null);return}const R=p.find(G=>String(G.id)===r);if(!R){g||t(A,{replace:!0});return}if(!(R.isOwned||c?.role==="system_admin")){t(A,{replace:!0});return}C(R.formValues||Lo(R)),E(R.id),j("edit")},[r,p,c,t,A,g,N]);const Y=u.useCallback(async()=>{if(i&&!(e==="all"&&c&&c.role!=="system_admin")){if(w(null),e==="companions"){if(!m){y([]),M("Select a campaign to view your companions. Use Go to Campaign from My Characters to set one."),v(!1);return}if(!z){y([]),M("You must be a player in the selected campaign to view companions."),v(!1);return}}if(e==="others"){if(!m){y([]),M("Select a campaign to view all characters. Use Go to Campaign from My Characters to set one."),v(!1);return}if(!P){y([]),M("You must be a DM in the selected campaign to view all characters."),v(!1);return}}M(""),v(!0);try{const R={scope:e};(e==="companions"||e==="others"||e==="my"&&m)&&(R.campaign_id=m);const q=await Ds(R),G=(q?.data||q||[]).map(J=>({...J,playerName:J.player?.username||"",campaignName:J.campaign?.name||"",status:J.is_active?"Active":"Inactive",formValues:Lo(J),isOwned:J.user_id===c?.id}));y(G)}catch(R){console.error(" Failed to load characters:",R),w(R.message)}finally{v(!1)}}},[i,e,c,m,z,P]);u.useEffect(()=>{l&&i&&Y()},[l,i,Y]);const V=e==="my"&&!m,I=u.useMemo(()=>[{key:"name",label:"Name"},{key:"class",label:"Class"},{key:"level",label:"Level"},{key:"race",label:"Race"},{key:"alignment",label:"Alignment"},{key:"playerName",label:"Player"},{key:"campaignName",label:"Campaign"},{key:"status",label:"Status"}],[]),F=u.useMemo(()=>V?[...I,{key:"campaignAction",label:"Actions",render:R=>R.campaign_id?a.jsx("button",{type:"button",className:"btn secondary compact",onClick:q=>{q.stopPropagation(),h(String(R.campaign_id))},children:"Go to Campaign"}):"No campaign"}]:I,[I,V,h]),D=()=>{H&&(t(A),j("new"),C(null),E(null))},L=()=>{j("list"),C(null),E(null),t(A)},B=async R=>{try{return await rR(W0(R)),j("list"),C(null),t(A),await Y(),!0}catch(q){return alert(`Error creating character: ${q.message}`),!1}},k=async(R,q={})=>{const{stayOnPage:G=!1}=q;if(!O)return!1;try{const J=await iR(O,W0(R)),ie=J?.data||J||{id:O};if(await Y(),G){const Z=Lo(ie&&typeof ie=="object"?ie:{...R,id:O});return C(Z),{message:"Character updated successfully."}}return j("list"),C(null),E(null),t(A),!0}catch(J){return alert(`Error updating character: ${J.message}`),!1}},U=async()=>{if(!O||!confirm("Delete this character?"))return!1;try{return await lR(O),j("list"),C(null),E(null),t(A),await Y(),!0}catch(R){return alert(`Error deleting character: ${R.message}`),!1}};return l?i?g?a.jsx("p",{children:"Loading characters..."}):S?a.jsx("p",{className:"error",children:S}):N==="new"?a.jsx(ps,{schema:T3,initialData:{level:1,is_active:!0,user_id:c?.role==="system_admin"?"":c?.id||""},onSubmit:B,onCancel:L,showUpdateAction:!1}):N==="edit"?a.jsx(ps,{schema:k3,initialData:_||{},onSubmit:k,onCancel:L,onDelete:U}):N==="list"&&T?a.jsx("div",{className:"empty-state",children:a.jsx("p",{children:T})}):a.jsx(ff,{data:p,columns:F,title:X,extraActions:H?a.jsx("button",{type:"button",className:"btn submit",onClick:D,children:"+ New"}):null,onRowClick:R=>{(R.isOwned||c?.role==="system_admin")&&(t(`${A}/${R.id}`),C(R.formValues||Lo(R)),E(R.id),j("edit"))}}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const pf="http://localhost:3000/api/users";function yf(){const e=Zr();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function gf(e,t="request"){if(e.status===401)throw new Error("Unauthorized");if(!e.ok){const r=await e.text();throw new Error(`Failed to ${t}: ${r}`)}return e.json()}async function ng(){const e=await fetch(pf,{headers:yf()});return gf(e,"fetch users")}async function D3(e){const t=await fetch(pf,{method:"POST",headers:yf(),body:JSON.stringify(e)});return gf(t,"create user")}async function I3(e,t){const r=await fetch(`${pf}/${e}`,{method:"PUT",headers:yf(),body:JSON.stringify(t)});return gf(r,"update user")}async function L3(e){const t=await fetch(`${pf}/${e}`,{method:"DELETE",headers:yf()});return gf(t,"delete user")}const O3="Create New User",z3=[{title:"Account Details",columns:2,fields:[{key:"username",label:"Username",type:"text",placeholder:"Enter username"},{key:"email",label:"Email",type:"text",inputType:"email",placeholder:"user@example.com"},{key:"password",label:"Password",type:"text",inputType:"password",placeholder:"Choose a secure password"},{key:"role",label:"Role",type:"select",options:[{value:"user",label:"User"},{value:"system_admin",label:"System Admin"}],default:"user"}]}],$3={title:O3,sections:z3},F3="Edit User",B3=[{title:"Account Details",columns:2,fields:[{key:"username",label:"Username",type:"text"},{key:"email",label:"Email",type:"text",inputType:"email"},{key:"role",label:"Role",type:"select",options:[{value:"user",label:"User"},{value:"system_admin",label:"System Admin"}]},{key:"password",label:"New Password",type:"text",inputType:"password",placeholder:"Leave blank to keep current password"}]}],U3={title:F3,sections:B3};function q3(){const{user:e,token:t,sessionReady:r}=En(),[i,l]=u.useState([]),[c,f]=u.useState(!1),[m,h]=u.useState(null),[p,y]=u.useState("list"),[g,v]=u.useState(null),S=u.useCallback(async()=>{if(!(!t||e?.role!=="system_admin")){f(!0),h(null);try{const E=await ng();l(E?.data||E||[])}catch(E){console.error(" Failed to load users:",E),h(E.message)}finally{f(!1)}}},[t,e?.role]);u.useEffect(()=>{r&&t&&e?.role==="system_admin"&&S()},[r,t,e?.role,S]);const w=[{key:"username",label:"Username"},{key:"email",label:"Email"},{key:"role",label:"Role"},{key:"createdAt",label:"Created"}],N=()=>{v(null),y("new")},j=()=>{y("list"),v(null)},_=async E=>{try{const T={username:E.username,email:E.email,password:E.password,role:E.role||"user"};return await D3(T),y("list"),v(null),await S(),!0}catch(T){return alert(`Error creating user: ${T.message}`),!1}},C=async(E,T={})=>{const{stayOnPage:M=!1}=T;if(!g?.id)return!1;try{const A={username:E.username,email:E.email,role:E.role};E.password&&(A.password=E.password);const P=(await I3(g.id,A))?.data||{...g,...A};return await S(),M?(v(P),{message:"User updated successfully."}):(y("list"),v(null),!0)}catch(A){return alert(`Error updating user: ${A.message}`),!1}},O=async()=>{if(!g?.id||!confirm(`Delete user "${g.username}"?`))return!1;try{return await L3(g.id),y("list"),v(null),await S(),!0}catch(E){return alert(`Error deleting user: ${E.message}`),!1}};return r?t?!e||e.role!=="system_admin"?a.jsx("p",{className:"error",children:"Access denied. Admins only."}):c?a.jsx("p",{children:"Loading users..."}):m?a.jsxs("p",{className:"error",children:["Error: ",m]}):p==="new"?a.jsx(ps,{schema:$3,initialData:{},onSubmit:_,onCancel:j,showUpdateAction:!1}):p==="edit"?a.jsx(ps,{schema:U3,initialData:g||{},onSubmit:C,onCancel:j,onDelete:O}):a.jsx(ff,{data:i,columns:w,title:"Users",extraActions:a.jsx("button",{type:"button",className:"btn submit",onClick:N,children:"+ New"}),onRowClick:E=>{v(E),y("edit")}}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}function H3(){const{login:e}=En(),t=zn(),[r,i]=u.useState(""),[l,c]=u.useState(""),[f,m]=u.useState(""),[h,p]=u.useState(!1),y=async g=>{g.preventDefault(),m(""),p(!0);try{await e(r,l)?t("/"):m("Invalid username or password")}catch{m("Login failed. Please try again.")}finally{p(!1)}};return a.jsx("div",{className:"login-page",children:a.jsxs("div",{className:"login-card",children:[a.jsx("h1",{className:"login-title",children:"GameDB"}),a.jsx("p",{className:"login-subtitle",children:"Sign in to your account"}),a.jsxs("form",{onSubmit:y,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Username"}),a.jsx("input",{type:"text",value:r,onChange:g=>i(g.target.value),placeholder:"Enter username",required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Password"}),a.jsx("input",{type:"password",value:l,onChange:g=>c(g.target.value),placeholder:"Enter password",required:!0})]}),f&&a.jsx("p",{className:"error-msg",children:f}),a.jsx("button",{type:"submit",disabled:h,children:h?"Signing in...":"Sign In"})]})]})})}const uN=e=>_t.get(`/entity-types/${e}/fields`),P3=(e,t)=>_t.post(`/entity-types/${e}/fields`,t),V3=(e,t)=>_t.patch(`/entity-type-fields/${e}`,t),Y3=e=>_t.delete(`/entity-type-fields/${e}`),G3=[{value:"global",label:"Global"},{value:"selective",label:"Selective"},{value:"hidden",label:"Hidden"}],X3=[{value:"global",label:"Global"},{value:"selective",label:"Selective"},{value:"hidden",label:"Hidden"},{value:"owner_only",label:"Owner only"}],bi=(e,t)=>`${e}-${t}`;function dN({canEdit:e,accessSettings:t,accessOptions:r,accessOptionsLoading:i,accessSaving:l,onSettingChange:c,idPrefix:f="entity-access"}){const m=!e||l,h=bi(f,"read-mode"),p=bi(f,"read-campaigns"),y=bi(f,"read-users"),g=bi(f,"read-characters"),v=bi(f,"write-mode"),S=bi(f,"write-campaigns"),w=bi(f,"write-users");return a.jsxs("div",{className:"entity-access-columns",children:[a.jsxs("div",{className:"entity-access-column",children:[a.jsx("h3",{children:"Read access"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:h,children:"Visibility"}),a.jsx("select",{id:h,value:t.readMode,onChange:N=>c("readMode",N.target.value),disabled:m,children:G3.map(N=>a.jsx("option",{value:N.value,children:N.label},N.value))})]}),t.readMode==="selective"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:p,children:"Campaigns"}),a.jsx(Ts,{inputId:p,selected:t.readCampaigns,options:r.campaigns||[],onChange:N=>c("readCampaigns",N),placeholder:"Select campaigns...",noOptionsMessage:i?"Loading campaigns...":"No campaigns available for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Members of selected campaigns can view this entity."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:y,children:"Users"}),a.jsx(Ts,{inputId:y,selected:t.readUsers,options:r.users||[],onChange:N=>c("readUsers",N),placeholder:"Select users...",noOptionsMessage:i?"Loading users...":"No eligible users found for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Choose players who have characters in this world."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:g,children:"Characters"}),a.jsx(Ts,{inputId:g,selected:t.readCharacters,options:r.characters||[],onChange:N=>c("readCharacters",N),placeholder:"Select characters...",noOptionsMessage:i?"Loading characters...":"No characters available for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Grant visibility to specific characters regardless of campaign."})]})]})]}),a.jsxs("div",{className:"entity-access-column",children:[a.jsx("h3",{children:"Write access"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:v,children:"Write"}),a.jsx("select",{id:v,value:t.writeMode,onChange:N=>c("writeMode",N.target.value),disabled:m,children:X3.map(N=>a.jsx("option",{value:N.value,children:N.label},N.value))})]}),t.writeMode==="selective"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:S,children:"Campaigns"}),a.jsx(Ts,{inputId:S,selected:t.writeCampaigns,options:r.campaigns||[],onChange:N=>c("writeCampaigns",N),placeholder:"Select campaigns...",noOptionsMessage:i?"Loading campaigns...":"No campaigns available for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Dungeon Masters of these campaigns can edit this entity."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:w,children:"Users"}),a.jsx(Ts,{inputId:w,selected:t.writeUsers,options:r.users||[],onChange:N=>c("writeUsers",N),placeholder:"Select users...",noOptionsMessage:i?"Loading users...":"No eligible users found for this world.",loading:i,disabled:m}),a.jsx("p",{className:"help-text",children:"Grant edit access to specific players with characters here."})]})]})]})]})}const Pu=e=>!e||typeof e!="string"?"":e.trim(),Z0=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[];async function fN(e){if(!e)return{campaigns:[],users:[],characters:[]};const[t,r]=await Promise.all([_c({world_id:e}),Ds({world_id:e})]),l=Z0(t).map(h=>({value:String(h.id),label:h.name||"Untitled campaign"})),c=Z0(r),f=new Map,m=new Map;return c.forEach(h=>{const p=h?.user_id||h?.player?.id;if(!p)return;const y=String(p);if(f.has(y))return;const g=h?.player||{},v=Pu(g.username),S=Pu(g.email);let w=v||S||`User ${y.slice(0,8)}`;v&&S&&v!==S&&(w=`${v} (${S})`),f.set(y,{value:y,label:w});const N=h?.id||h?.character_id;if(!N)return;const j=Pu(h.name)||"Unnamed character",_=Pu(h?.campaign?.name||h?.campaign_name||""),C=_?`${j}  ${_}`:j;m.set(String(N),{value:String(N),label:C})}),{campaigns:l,users:Array.from(f.values()),characters:Array.from(m.values())}}const Vh=(e,t,r)=>Number.isNaN(e)?t:Math.min(Math.max(e,t),r),K3=220,W3=3;function mN({src:e,size:t=K3,onCropChange:r,className:i="",zoomLabel:l="Zoom"}){const[c,f]=u.useState({width:0,height:0}),[m,h]=u.useState(1),[p,y]=u.useState({x:0,y:0}),[g,v]=u.useState(!1),S=u.useRef({x:0,y:0}),w=u.useRef(null),N=u.useRef(null);u.useEffect(()=>{if(!e){f({width:0,height:0});return}let H=!1;const Y=new Image;return Y.onload=()=>{H||f({width:Y.naturalWidth,height:Y.naturalHeight})},Y.onerror=()=>{H||f({width:0,height:0})},Y.src=e,()=>{H=!0}},[e]);const j=u.useMemo(()=>{if(!c.width||!c.height)return 1;const H=t/c.width,Y=t/c.height;return Math.max(H,Y)},[c,t]);u.useEffect(()=>{if(!c.width||!c.height)return;h(j);const H=c.width*j,Y=c.height*j;y({x:(t-H)/2,y:(t-Y)/2})},[c,j,t]);const _=u.useCallback((H,Y=m)=>{if(!c.width||!c.height)return H;const V=c.width*Y,I=c.height*Y,F=Math.min(0,t-V),D=Math.max(0,t-V),L=Math.min(0,t-I),B=Math.max(0,t-I);return{x:Vh(H.x,F,D),y:Vh(H.y,L,B)}},[c,m,t]),C=H=>{if(!e)return;H.preventDefault(),N.current?.setPointerCapture?.(H.pointerId),w.current=H.pointerId,S.current={x:H.clientX,y:H.clientY},v(!0)},O=H=>{if(!g)return;H.preventDefault();const Y=H.clientX-S.current.x,V=H.clientY-S.current.y;S.current={x:H.clientX,y:H.clientY},y(I=>_({x:I.x+Y,y:I.y+V}))},E=u.useCallback(()=>{const H=N.current;w.current!==null&&(H?.releasePointerCapture?.(w.current),w.current=null),v(!1)},[]),T=j*W3,M=Math.max(j/50,.01),A=T-j>.001,z=H=>{const Y=Vh(Number(H.target.value),j,T);h(Y),y(V=>_(V,Y))};u.useEffect(()=>{typeof r=="function"&&(!c.width||!c.height||!e||r({offset:p,scale:m,containerSize:t,naturalWidth:c.width,naturalHeight:c.height}))},[p,m,t,c,r,e]),u.useEffect(()=>{const H=N.current;if(!H)return;const Y=()=>E(),V=()=>E();return H.addEventListener("pointerup",Y),H.addEventListener("pointerleave",V),H.addEventListener("pointercancel",V),()=>{H.removeEventListener("pointerup",Y),H.removeEventListener("pointerleave",V),H.removeEventListener("pointercancel",V)}},[E]);const P=c.width*m,X=c.height*m;return a.jsxs("div",{className:`image-cropper ${i}`.trim(),children:[a.jsxs("div",{className:`image-cropper__frame${g?" is-dragging":""}`,ref:N,style:{width:t,height:t},onPointerDown:C,onPointerMove:O,role:"presentation",children:[e?a.jsx("img",{src:e,alt:"Selected artwork preview",draggable:!1,style:{width:P,height:X,transform:`translate(${p.x}px, ${p.y}px)`}}):a.jsx("div",{className:"image-cropper__empty",children:"Unable to preview image"}),a.jsx("div",{className:"image-cropper__outline","aria-hidden":"true"}),a.jsx("div",{className:"image-cropper__instructions","aria-hidden":"true",children:"Drag to reposition"})]}),A?a.jsxs("label",{className:"image-cropper__zoom",children:[a.jsx("span",{children:l}),a.jsx("input",{type:"range",min:j,max:T,step:M,value:m,onChange:z})]}):a.jsx("p",{className:"image-cropper__zoom image-cropper__zoom--disabled",children:"Zoom unavailable for this image"})]})}const hN=async(e,t,r={})=>{if(!e||!t)return e;const{offset:i,scale:l,containerSize:c,naturalWidth:f,naturalHeight:m}=t;if(!i||!l||!c||!f||!m||typeof createImageBitmap!="function")return e;try{const h=await createImageBitmap(e),p=f?h.width/f:1,y=m?h.height/m:1,g=(p+y)/2||1,v=l*g,S=c/v,w=c/v,N=(0-i.x)/l*g,j=(0-i.y)/l*g,_=Math.min(Math.max(S,1),h.width),C=Math.min(Math.max(w,1),h.height),O=h.width-_,E=h.height-C,T=Math.min(Math.max(N,0),Math.max(O,0)),M=Math.min(Math.max(j,0),Math.max(E,0)),A=document.createElement("canvas");A.width=Math.round(_),A.height=Math.round(C),A.getContext("2d").drawImage(h,T,M,_,C,0,0,A.width,A.height),h.close?.();const P=r.mimeType||e.type||"image/jpeg",X=r.quality||(P==="image/png"?void 0:.92),H=await new Promise((V,I)=>{A.toBlob(F=>{F?V(F):I(new Error("Unable to crop image"))},P,X)}),Y=(()=>{if(!e.name)return"cropped-image";const V=P==="image/png"?".png":".jpg";return e.name.toLowerCase().endsWith(V)?e.name:`${e.name.includes(".")?e.name.slice(0,e.name.lastIndexOf(".")):e.name}${V}`})();return new File([H],Y,{type:P})}catch(h){return console.warn(" Unable to crop image, using original selection",h),e}},Z3=[{value:"hidden",label:"Hidden"},{value:"partial",label:"Partial"},{value:"visible",label:"Visible"}],Q3=new Set(["image/png","image/jpeg","image/jpg"]),J3=2*1024*1024,e4=new Set(["global","selective","hidden"]),t4=new Set(["global","selective","hidden","owner_only"]),Vu=()=>({campaigns:[],users:[],characters:[]}),Yh=(e="")=>{const t=String(e||"").trim();return t?{readMode:"selective",readCampaigns:[t],readUsers:[],readCharacters:[],writeMode:"selective",writeCampaigns:[t],writeUsers:[]}:{readMode:"global",readCampaigns:[],readUsers:[],readCharacters:[],writeMode:"global",writeCampaigns:[],writeUsers:[]}},n4=e=>Number.isFinite(e)?e>=1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:e>=1024?`${(e/1024).toFixed(1)} KB`:`${e} bytes`:"",a4=e=>{const t=e?.options?.choices;return!Array.isArray(t)||t.length===0?[]:t.map((r,i)=>{if(r==null)return null;if(typeof r=="object"){const c=r.value??r.id??r.key??r.slug??`choice-${i}`,f=r.label??r.name??r.title??r.display??c;return c==null?null:{value:c,label:String(f??c)}}const l=String(r);return{value:l,label:l}}).filter(Boolean)},s4=e=>{if(!e)return"";if(e instanceof Date)return e.toISOString().slice(0,10);if(typeof e=="string"){const r=e.trim();if(!r)return"";if(/^\d{4}-\d{2}-\d{2}/.test(r))return r.slice(0,10);const i=new Date(r);return Number.isNaN(i.getTime())?"":i.toISOString().slice(0,10)}const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toISOString().slice(0,10)},r4=(e,t)=>{if(e==null)return"";switch(t?.dataType||t?.data_type){case"boolean":{if(typeof e=="boolean")return e?"true":"false";if(typeof e=="number")return e!==0?"true":"false";if(typeof e=="string"){const i=e.trim().toLowerCase();if(i==="true"||i==="false")return i}return""}case"number":return e===""?"":String(e);case"date":return s4(e);case"reference":{if(typeof e=="object"&&e!==null){const i=e.id??e.value??e.entity_id??e.entityId??null;if(i!=null)return String(i)}return String(e)}default:return String(e)}},i4=(e,t)=>{const r=t?.dataType||t?.data_type;if(e!=null){if(typeof e=="string"){const i=e.trim();if(r!=="boolean"&&i==="")return"";e=i}switch(r){case"number":{if(e==="")return"";const i=Number(e);return Number.isNaN(i)?e:i}case"boolean":{if(typeof e=="boolean")return e;if(typeof e=="number")return e!==0;if(typeof e=="string"){const i=e.toLowerCase();if(i==="true")return!0;if(i==="false")return!1}return e}case"reference":return typeof e=="string"?e.trim():e;default:return e}}},Q0="entity-form-advanced-open",l4=e=>{if(e==null)return"";if(typeof e=="object")try{return JSON.stringify(e)}catch{return""}return String(e)},o4=e=>{const t=e.trim();if(t.length===0)return"";if(t==="true")return!0;if(t==="false")return!1;const r=t[0],i=t[t.length-1];if(r==="{"&&i==="}"||r==="["&&i==="]")try{return JSON.parse(t)}catch{return e}return e};function pN({worldId:e,entityId:t,onCancel:r,onSaved:i,formId:l="entity-form",onStateChange:c,hideActions:f=!1,selectedEntityTypeId:m="",activeView:h="details",onViewChange:p,defaultCampaignId:y=""}){const g=!!t,v=u.useRef(0),S=u.useRef(null),w=u.useRef(null),N=u.useRef(null),j=u.useRef(String(y??"")),_=u.useCallback((ce="",Ue="")=>(v.current+=1,{id:v.current,key:ce,value:Ue}),[v]),[C,O]=u.useState([]),[E,T]=u.useState(!1),[M,A]=u.useState(!1),[z,P]=u.useState(!1),[X,H]=u.useState(!1),[Y,V]=u.useState(""),[I,F]=u.useState({name:"",description:"",entityTypeId:m||"",visibility:"visible"}),[D,L]=u.useState(()=>(v.current=0,[_()])),[B,k]=u.useState([]),[U,R]=u.useState({}),[q,G]=u.useState({}),[J,ie]=u.useState(()=>Yh(y)),[Z,me]=u.useState(()=>Vu()),[Q,ue]=u.useState(!1),[ne,we]=u.useState(""),Pe=u.useRef(!1),[Re,Ce]=u.useState(null),[it,qe]=u.useState(null),[We,ke]=u.useState(null),[xt,Mt]=u.useState(""),[Ct,At]=u.useState(""),[He,Qe]=u.useState(!1),[W,ee]=u.useState(!1),[te,ve]=u.useState(()=>{if(typeof window>"u")return!1;try{return window.sessionStorage?.getItem(Q0)==="true"}catch(ce){return console.warn(" Unable to read advanced options preference",ce),!1}}),le=u.useMemo(()=>D.some(ce=>ce.key.trim()!==""||ce.value.trim()!==""),[D]),Se=u.useCallback(ce=>{if(ce&&typeof URL<"u")try{URL.revokeObjectURL(ce)}catch(Ue){console.warn("Unable to revoke preview URL",Ue)}},[]),Ee=u.useCallback(()=>{qe(null),ke(null),At(""),Mt(ce=>(Se(ce),"")),w.current&&(w.current.value=""),N.current&&(N.current.value="")},[Se]);u.useEffect(()=>()=>{Se(xt)},[Se,xt]);const ge=u.useCallback(ce=>{const Ue=ce.target.files?.[0];if(Ue){if(!Q3.has(Ue.type)){At("Only PNG or JPG images are allowed."),ce.target.value="";return}if(Ue.size>J3){At("Image must be smaller than 2 MB."),ce.target.value="";return}At(""),qe(Ue),ke(null),Mt(Ge=>(Se(Ge),URL.createObjectURL(Ue)))}},[Se]),at=u.useCallback(()=>{!t||He||W||M||w.current?.click()},[t,W,He,M]),st=u.useCallback(ce=>{if(!ce){Ce(null);return}const Ue=ce.imageData??ce.image_data??null,Ge=ce.imageMimeType??ce.image_mime_type??null;Ce(Ue&&Ge?{imageData:Ue,imageMimeType:Ge}:null)},[]),nt=u.useCallback(async()=>{if(!t)return null;const ce=await rr(t),Ue=Ha(ce);return Ue&&st(Ue),Ue},[st,t]),ze=u.useCallback(async()=>{if(!(!t||!it)){Qe(!0),At("");try{const ce=We?await hN(it,We):it;await V1(t,ce),await nt(),Ee()}catch(ce){At(ce.message||"Failed to upload image")}finally{Qe(!1)}}},[t,it,We,nt,Ee]),ft=u.useCallback(async()=>{if(!(!t||He||W)){At(""),ee(!0);try{await Y1(t),await nt(),Ee()}catch(ce){At(ce.message||"Failed to remove image")}finally{ee(!1)}}},[t,W,He,nt,Ee]),zt=u.useMemo(()=>{const ce="PNG or JPG up to 2 MB.";return it?`${ce} Selected: ${it.name} (${n4(it.size)})`:ce},[it]),Rt=it?a.jsxs("div",{className:"entity-image-actions",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:ze,disabled:He,children:He?"Uploading":"Save Image"}),a.jsx("button",{type:"button",className:"btn secondary",onClick:Ee,disabled:He,children:"Cancel"})]}):null,pt=u.useCallback(ce=>ce.length>0?ce:[_()],[_]),ct=u.useCallback(ce=>{if(v.current=0,!ce||typeof ce!="object"||Array.isArray(ce))return[_()];const Ue=Object.entries(ce);return Ue.length===0?[_()]:Ue.map(([Ge,ut])=>_(Ge,l4(ut)))},[_]);u.useEffect(()=>{let ce=!1;return(async()=>{if(ce||V(""),!e){O([]),T(!1);return}T(!0);try{const Ge=await Qr({worldId:e}),ut=Array.isArray(Ge)?Ge:Array.isArray(Ge?.data)?Ge.data:[];if(!ce){const ae=ut.map(Xe=>{const $e=Xe?.id||Xe?.entity_type_id||Xe?.entityTypeId||"";return $e?{id:$e,name:Xe?.name||Xe?.label||Xe?.title||"Untitled"}:null}).filter(Boolean);O(ae)}}catch(Ge){ce||(V(Ge.message||"Failed to load entity types"),O([]))}finally{ce||T(!1)}})(),()=>{ce=!0}},[e]),u.useEffect(()=>{if(!e){F(ce=>({...ce,entityTypeId:""}));return}F(ce=>!ce.entityTypeId||C.some(Ge=>Ge.id===ce.entityTypeId)?ce:{...ce,entityTypeId:""})},[e,C]),u.useEffect(()=>{let ce=!1;const Ue=()=>{v.current=0,F({name:"",description:"",entityTypeId:m||"",visibility:"visible"}),L([_()]),k([]),R({}),V(""),p?.("details");const ut=Yh(j.current);ie(ut),Pe.current=!1,me(Vu()),we(""),Ce(null),Ee()};if(!g)return Ue(),A(!1),S.current=null,()=>{};const Ge=async()=>{A(!0),V(""),At("");try{const ut=await rr(t),ae=Ha(ut);if(!ae)throw new Error("Entity not found");if(!ce){const Xe=ct(ae.metadata);F({name:ae.name||"",description:ae.description||"",entityTypeId:ae.entity_type_id||ae.entityType?.id||"",visibility:ae.visibility||"visible"}),L(pt(Xe)),st(ae),Ee()}}catch(ut){ce||V(ut.message||"Failed to load entity")}finally{ce||A(!1)}};return S.current!==t&&(Ce(null),Ee(),S.current=t),Ge(),()=>{ce=!0}},[t,g,pt,_,ct,m,p,st,Ee]);const yt=ce=>Ue=>{const{value:Ge}=Ue.target;F(ut=>({...ut,[ce]:Ge}))},Tt=(ce,Ue)=>Ge=>{const{value:ut}=Ge.target;L(ae=>ae.map(Xe=>Xe.id===ce?{...Xe,[Ue]:ut}:Xe))},Ft=()=>{L(ce=>[...ce,_()])},kt=ce=>{L(Ue=>pt(Ue.filter(Ge=>Ge.id!==ce)))},Zt=ce=>Ue=>{const{value:Ge}=Ue.target;R(ut=>({...ut,[ce]:Ge}))},Lt=u.useCallback((ce,Ue)=>{we(""),ie(Ge=>{const ut={...Ge};if(ce==="readMode"||ce==="writeMode"){const ae=typeof Ue=="string"?Ue.trim().toLowerCase():"global";return ce==="readMode"?(ut.readMode=e4.has(ae)?ae:"global",ut.readMode!=="selective"&&(ut.readCampaigns=[],ut.readUsers=[],ut.readCharacters=[])):(ut.writeMode=t4.has(ae)?ae:"global",ut.writeMode!=="selective"&&(ut.writeCampaigns=[],ut.writeUsers=[])),ut}return["readCampaigns","readUsers","readCharacters","writeCampaigns","writeUsers"].includes(ce)?(ut[ce]=Array.isArray(Ue)?Ue.map(ae=>String(ae).trim()).filter(Boolean):[],ut):(ut[ce]=Ue,ut)})},[]);u.useEffect(()=>{Pe.current=!1,me(Vu()),we("")},[e]),u.useEffect(()=>{if(g)return;const ce=String(y??"");if(ce===j.current)return;const Ue=Yh(ce);j.current=ce,ie(Ue)},[y,g]),u.useEffect(()=>{if(h!=="access"||!e||Pe.current)return;let ce=!1;return ue(!0),we(""),(async()=>{try{const Ge=await fN(e);if(ce)return;me({campaigns:Ge.campaigns??[],users:Ge.users??[],characters:Ge.characters??[]}),Pe.current=!0}catch(Ge){if(ce)return;me(Vu()),we(Ge.message||"Failed to load access options"),Pe.current=!1}finally{ce||ue(!1)}})(),()=>{ce=!0}},[h,e]);const Kt=u.useCallback(()=>{ve(ce=>{const Ue=!ce;try{typeof window<"u"&&window.sessionStorage?.setItem(Q0,Ue?"true":"false")}catch(Ge){console.warn(" Unable to persist advanced options preference",Ge)}return Ue})},[]),se=async ce=>{if(ce.preventDefault(),!e&&!g){V("A world must be selected before creating an entity.");return}const Ue=I.name.trim();if(!Ue){V("Name is required.");return}const Ge=I.entityTypeId||m||"";if(!Ge){V("Entity type is required.");return}const ut=g&&I.visibility||"visible";if(g&&!Z3.some(Je=>Je.value===ut)){V("Invalid visibility selected.");return}let ae={};if(g)D.forEach(({key:Je,value:bt})=>{const St=Je.trim();St&&(ae[St]=o4(bt))});else if(B.length>0){const Je={};for(const bt of B){const St=bt.name,_e=U[St],tt=_e!=null&&(typeof _e!="string"||_e.trim()!=="");if(bt.required&&!tt){const mt=bt.label||bt.name;V(`${mt} is required.`);return}tt&&(Je[St]=i4(_e,bt))}ae=Je}const Xe=I.description?I.description.trim():"",$e={name:Ue,description:Xe,visibility:ut,metadata:ae,entity_type_id:Ge};try{if(H(!0),V(""),g)await Py(t,$e);else{const Je={read_access:J.readMode,write_access:J.writeMode,read_campaign_ids:J.readMode==="selective"?J.readCampaigns:[],read_user_ids:J.readMode==="selective"?J.readUsers:[],read_character_ids:J.readMode==="selective"?J.readCharacters:[],write_campaign_ids:J.writeMode==="selective"?J.writeCampaigns:[],write_user_ids:J.writeMode==="selective"?J.writeUsers:[]};await Hy({...$e,...Je,world_id:e})}i?.(g?"edit":"create")}catch(Je){V(Je.message||"Failed to save entity")}finally{H(!1)}},be=E||M||z,je=!g,Ze=je&&h==="access";u.useEffect(()=>{if(p){if(!je&&h!=="details"){p("details");return}Ze&&!e&&p("details")}},[h,je,Ze,p,e]),u.useEffect(()=>{if(!c)return;c({mode:g?"edit":"create",saving:X,isBusy:be,submitLabel:X?"Saving...":g?"Save Changes":"Create Entity",submitDisabled:X||be,cancelDisabled:X,accessButtonVisible:je,accessButtonDisabled:X||be||!e&&!Ze})},[c,g,X,be,je,Ze,e]),u.useEffect(()=>{g||F(ce=>({...ce,entityTypeId:m||""}))},[g,m]);const dt=u.useMemo(()=>g?"":I.entityTypeId?I.entityTypeId:m||"",[g,m,I.entityTypeId]);u.useEffect(()=>{if(g){k([]),R({}),G({});return}if(!dt){k([]),R({}),G({});return}let ce=!1;return(async()=>{P(!0);try{const Ge=await uN(dt),ut=Array.isArray(Ge)?Ge:Array.isArray(Ge?.data)?Ge.data:[];if(ce)return;const ae=ut.map($e=>{if(!$e)return null;const Je=$e.name||$e.field_name;if(!Je)return null;const bt=$e.data_type||$e.dataType||"text",St=$e.reference_type_id??$e.referenceTypeId??$e.referenceType?.id??null,_e=$e.reference_type_name??$e.referenceTypeName??$e.referenceType?.name??"",tt=$e.reference_filter??$e.referenceFilter??$e.referenceFilterJson??{};return{id:$e.id||Je,name:Je,label:$e.label||$e.name||Je,dataType:bt,required:!!$e.required,options:$e.options||{},defaultValue:$e.default_value??$e.defaultValue??null,referenceTypeId:St,referenceTypeName:_e,referenceFilter:tt}}).filter(Boolean);k(ae),G({});const Xe={};ae.forEach($e=>{const Je=$e.defaultValue;Je!=null&&Je!==""?Xe[$e.name]=r4(Je,$e):Xe[$e.name]=""}),R(Xe)}catch(Ge){ce||(V(Ge.message||"Failed to load metadata fields"),k([]),R({}),G({}))}finally{ce||P(!1)}})(),()=>{ce=!0}},[dt,g]);const gt=u.useMemo(()=>{const ce=I.entityTypeId||m||"";return ce&&C.find(Ue=>Ue.id===ce)||null},[C,I.entityTypeId,m]),oe=ce=>{const Ue=`metadata-field-${ce.id}`,Ge=U[ce.name]??"",ut=!!ce.required;switch(ce.dataType){case"boolean":return a.jsxs("select",{id:Ue,value:Ge,onChange:Zt(ce.name),disabled:X||z,required:ut,children:[a.jsx("option",{value:"",children:"Select..."}),a.jsx("option",{value:"true",children:"True"}),a.jsx("option",{value:"false",children:"False"})]});case"enum":{const ae=a4(ce);return a.jsxs("select",{id:Ue,value:Ge,onChange:Zt(ce.name),disabled:X||z,required:ut,children:[a.jsx("option",{value:"",children:"Select..."}),ae.map(Xe=>a.jsx("option",{value:Xe.value,children:Xe.label},Xe.value))]})}case"reference":{const ae=ce.referenceTypeId??ce.reference_type_id??null,Xe=ae?String(ae).trim():null,$e=ce.referenceTypeName||"entities",Je=typeof $e=="string"&&$e.trim()?$e.trim():"entities",bt=Array.isArray(ce.options?.choices)?ce.options.choices.map((jt,Wt)=>{if(jt==null)return null;if(typeof jt=="object"){const dn=jt.value??jt.id??jt.key??jt.slug??`choice-${Wt}`;if(dn==null)return null;const Qt=jt.label??jt.name??jt.title??jt.display??jt.displayName??dn;return{value:String(dn),label:String(Qt)}}const ln=String(jt);return{value:ln,label:ln}}).filter(Boolean):[],St=bt.length>0,tt=X||z||!St&&!!!(e&&Xe),mt=q[ce.name]||"",fe=!mt&&Ge&&bt.find(jt=>String(jt.value)===String(Ge))?.label||"",he=Ge&&(mt||fe)?{id:Ge,name:mt||fe}:Ge,Ve=Ge?String(Ge):"",vt=q[ce.name]||fe||Je,Nt=jt=>{if(!jt){R(Qt=>({...Qt,[ce.name]:""})),G(Qt=>{if(!Qt[ce.name])return Qt;const ha={...Qt};return delete ha[ce.name],ha});return}const Wt=jt.id??jt.value??jt.key??jt.slug??jt.uuid??null;if(Wt==null){R(Qt=>({...Qt,[ce.name]:""}));return}const ln=String(Wt),dn=jt.name??jt.label??jt.title??jt.display??jt.displayName??"";R(Qt=>({...Qt,[ce.name]:ln})),G(Qt=>({...Qt,[ce.name]:dn||ln}))},Et=jt=>{if(!jt){G(Qt=>{if(!Qt[ce.name])return Qt;const ha={...Qt};return delete ha[ce.name],ha});return}const Wt=jt.id??jt.value??jt.key??jt.slug??jt.uuid??null;if(Wt==null)return;const ln=String(Wt),dn=jt.name??jt.label??jt.title??jt.display??jt.displayName??"";G(Qt=>Qt[ce.name]===(dn||ln)?Qt:{...Qt,[ce.name]:dn||ln})};return a.jsxs("div",{className:"reference-field-control",children:[a.jsxs("div",{className:"reference-field-input-row",children:[a.jsx(cc,{worldId:e,value:he,allowedTypeIds:Xe&&Xe.length>0?[Xe]:[],placeholder:`Search ${Je.toLowerCase()}...`,disabled:tt,staticOptions:bt,onChange:Nt,onResolved:Et,required:ut}),Ve&&a.jsx(Is,{entityId:Ve,entityName:vt,className:"reference-field-info-btn"})]}),!Xe&&a.jsx("p",{className:"field-hint warning",children:"Reference type configuration is missing."}),Xe&&!e&&a.jsx("p",{className:"field-hint warning",children:"Select a world to search for entities."})]})}case"number":return a.jsx("input",{id:Ue,type:"number",value:Ge,onChange:Zt(ce.name),disabled:X||z,required:ut});case"text":return a.jsx("textarea",{id:Ue,value:Ge,onChange:Zt(ce.name),disabled:X||z,rows:4,required:ut});case"date":return a.jsx("input",{id:Ue,type:"date",value:Ge,onChange:Zt(ce.name),disabled:X||z,required:ut});default:return a.jsx("input",{id:Ue,type:"text",value:Ge,onChange:Zt(ce.name),disabled:X||z,required:ut})}},re=!g&&!!m,Ne=!g&&B.length>0,Be=()=>a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-type",children:"Type *"}),re?a.jsx("input",{id:"entity-type",type:"text",value:gt?.name||"",readOnly:!0,disabled:!0}):a.jsxs("select",{id:"entity-type",value:I.entityTypeId,onChange:yt("entityTypeId"),disabled:X||E,required:!0,children:[a.jsx("option",{value:"",children:"Select type..."}),C.map(ce=>a.jsx("option",{value:ce.id,children:ce.name},ce.id))]})]}),Ke=xt||Bl(Re),ot=I.name?`${I.name} artwork`:"Entity artwork",Oe=()=>a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-name",children:"Name *"}),a.jsx("input",{id:"entity-name",type:"text",value:I.name,onChange:yt("name"),placeholder:"e.g. Waterdeep",disabled:X,required:!0,"data-autofocus":!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-description",children:"Description"}),a.jsx("textarea",{id:"entity-description",value:I.description,onChange:yt("description"),placeholder:"Optional summary of the entity",rows:4,disabled:X})]})]});return a.jsxs("form",{id:l,className:"entity-form",onSubmit:se,children:[be?a.jsx("div",{className:"form-loading",children:"Loading..."}):a.jsx(a.Fragment,{children:Ze?a.jsxs("section",{className:"entity-card entity-access-card drawer-access-card",children:[a.jsx("h3",{className:"entity-card-title",children:"Manage access"}),a.jsx("p",{className:"entity-access-note help-text",children:"Configure who can view and edit this entity. Users with write access will automatically receive read access."}),ne&&a.jsx("div",{className:"alert error",role:"alert",children:ne}),e?a.jsx(dN,{canEdit:!X,accessSettings:J,accessOptions:Z,accessOptionsLoading:Q,accessSaving:X,onSettingChange:Lt,idPrefix:"entity-create-access"}):a.jsx("p",{className:"entity-empty-state",children:"Assign this entity to a world to configure access settings."})]}):a.jsxs(a.Fragment,{children:[g&&Re?a.jsxs("div",{className:"entity-form-image-wrapper",children:[a.jsxs("div",{className:"entity-form-image-panel","aria-live":"polite",children:[a.jsx("div",{className:`entity-image-preview ${Ke?"has-image":""}`.trim(),children:Ke?a.jsx("img",{src:Ke,alt:ot,loading:"lazy"}):a.jsx("div",{className:"entity-image-placeholder",children:a.jsx("p",{children:"No image"})})}),a.jsxs("div",{className:"entity-form-image-panel-actions",children:[a.jsx("button",{type:"button",className:"btn secondary",onClick:at,disabled:!t||He||W||M,children:He?"Uploading":"Replace Image"}),a.jsx("button",{type:"button",className:"btn secondary",onClick:ft,disabled:!t||W||He,children:W?"Removing":"Remove Image"})]}),Rt,a.jsx("input",{type:"file",ref:w,accept:"image/png,image/jpeg",onChange:ge,hidden:!0,disabled:!t||He||W}),a.jsx("p",{className:"entity-image-helper",children:zt}),Ct?a.jsx("p",{className:"entity-image-status entity-image-status--error",children:Ct}):null,!Ct&&He?a.jsx("p",{className:"entity-image-status",children:"Uploading image"}):null,!Ct&&W?a.jsx("p",{className:"entity-image-status",children:"Removing image"}):null]}),a.jsx("div",{className:"entity-form-image-fields",children:Oe()})]}):Oe(),!g&&Be(),g&&!Re?a.jsxs("div",{className:"form-group entity-form-upload-section",children:[a.jsx("label",{htmlFor:"entity-image-upload",children:"Upload image"}),a.jsx("input",{id:"entity-image-upload",type:"file",accept:"image/png,image/jpeg",ref:N,onChange:ge,disabled:!t||He||W}),it&&xt?a.jsx("div",{className:"entity-form-upload-preview",children:a.jsx(mN,{src:xt,size:220,zoomLabel:"Zoom to crop",onCropChange:ke})}):null,Rt,a.jsx("p",{className:"entity-image-helper",children:zt}),Ct?a.jsx("p",{className:"entity-image-status entity-image-status--error",children:Ct}):null,!Ct&&He?a.jsx("p",{className:"entity-image-status",children:"Uploading image"}):null,!Ct&&W?a.jsx("p",{className:"entity-image-status",children:"Removing image"}):null]}):null,Ne&&a.jsxs("div",{className:"metadata-field-section",children:[a.jsx("h3",{children:"Information"}),B.map(ce=>a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`metadata-field-${ce.id}`,children:[ce.label,ce.required?" *":""]}),oe(ce)]},ce.id))]}),je&&!e&&a.jsx("p",{className:"help-text",children:"Assign a world to configure access controls."}),g&&a.jsx("div",{className:"form-two-column",children:Be()}),g&&a.jsxs("div",{className:"advanced-options",children:[a.jsxs("button",{type:"button",className:"advanced-options-toggle",onClick:Kt,"aria-expanded":te,children:[a.jsx("span",{children:"Advanced options"}),le?a.jsx("span",{className:"advanced-indicator",children:"Metadata added"}):null,a.jsx("span",{className:"advanced-chevron","aria-hidden":"true",children:te?"":""})]}),te&&a.jsx("div",{className:"advanced-options-body",children:a.jsxs("div",{className:"metadata-editor",children:[a.jsxs("div",{className:"metadata-header",children:[a.jsxs("h3",{children:["Metadata ",le?"":"(optional)"]}),a.jsx("button",{type:"button",className:"btn neutral",onClick:Ft,disabled:X,children:"Add field"})]}),a.jsx("div",{className:"metadata-list",children:D.map((ce,Ue)=>a.jsxs("div",{className:"metadata-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`metadata-key-${ce.id}`,className:"sr-only",children:["Metadata key ",Ue+1]}),a.jsx("input",{id:`metadata-key-${ce.id}`,type:"text",placeholder:"Key",value:ce.key,onChange:Tt(ce.id,"key"),disabled:X})]}),a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`metadata-value-${ce.id}`,className:"sr-only",children:["Metadata value ",Ue+1]}),a.jsx("input",{id:`metadata-value-${ce.id}`,type:"text",placeholder:"Value",value:ce.value,onChange:Tt(ce.id,"value"),disabled:X})]}),a.jsx("div",{className:"metadata-actions",children:a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>kt(ce.id),disabled:X||D.length===1,title:"Remove field",children:""})})]},ce.id))})]})})]})]})}),Y&&a.jsx("div",{className:"form-error",role:"alert",children:Y}),!f&&a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:r,disabled:X,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:X||be,children:X?"Saving...":g?"Save Changes":"Create Entity"})]})]})}const c4={visible:"badge-visible",partial:"badge-partial",hidden:"badge-hidden"},u4=new Set(["system_admin"]),J0="entityType",ns=["name","type","visibility","createdAt"],Yu=[{key:"name",label:"Name",type:"core"},{key:"type",label:"Type",type:"core"},{key:"importance",label:"Importance",type:"core"},{key:"visibility",label:"Visibility",type:"core"},{key:"createdAt",label:"Created",type:"core"},{key:"description",label:"Description",type:"core"}],Gh="user",eS="system",pl=(e="create")=>({mode:e,submitLabel:e==="edit"?"Save Changes":"Create Entity",submitDisabled:!1,cancelDisabled:!1,accessButtonVisible:!1,accessButtonDisabled:!1}),Xh=(e=[],t=[])=>e.length!==t.length?!1:e.every((r,i)=>r===t[i]),Kh=(e,t,r)=>{const i=new Set(r),l=[];if(Array.isArray(e)&&e.forEach(f=>{if(typeof f!="string")return;const m=f.trim();!m||!i.has(m)||l.includes(m)||l.push(m)}),l.length>0)return l;const c=Array.isArray(t)?t.filter(f=>typeof f=="string"&&i.has(f)):[];return c.length>0?[...c]:i.size>0?[i.values().next().value]:[]},d4=e=>{if(!e||typeof e!="object")return"";const t=e.displayValue??e.display??e.label??e.displayName??e.text??e.name??e.title??e.value??e.id??null;return t!=null?String(t).trim():""},ag=e=>!e||typeof e!="object"?!1:Array.isArray(e)?e.some(t=>ag(t)):Object.prototype.hasOwnProperty.call(e,"displayValue")||Object.prototype.hasOwnProperty.call(e,"display")||Object.prototype.hasOwnProperty.call(e,"label"),yN=e=>{if(e==null)return"";if(Array.isArray(e)){const t=e.map(r=>yN(r)).filter(r=>!!r);return t.length?t.join(", "):""}return typeof e=="object"?d4(e):String(e).trim()},Wh=(e,t=null)=>{if(e==null)return"";const r=t?.dataType||t?.data_type||"";if(r==="reference"||ag(e))return yN(e)||"";if(typeof e=="boolean")return e?"Yes":"No";if(typeof e=="number")return Number.isFinite(e)?String(e):"";if(r==="number"){const c=Number(e);return Number.isFinite(c)?String(c):""}if(e instanceof Date)return e.toLocaleDateString();if(r==="date"||typeof e=="string"&&r==="text"){const c=new Date(e);if(!Number.isNaN(c.getTime()))return c.toLocaleDateString()}if(Array.isArray(e))return e.length===0?"":e.filter(c=>c!=null&&String(c).trim()!=="").map(c=>typeof c=="string"?c.trim():String(c)).join(", ");if(typeof e=="object")try{return JSON.stringify(e)}catch(c){return console.warn(" Failed to stringify metadata value",c),""}return String(e).trim()||""};function f4(){const{user:e,token:t,sessionReady:r}=En(),{selectedCampaign:i,selectedCampaignId:l,activeWorld:c,activeWorldId:f,selectedContextType:m,viewAsCharacterId:h,contextKey:p}=Bn(),[y,g]=U2(),v=Uy(),[S,w]=u.useState([]),[N,j]=u.useState(!1),[_,C]=u.useState(""),[O,E]=u.useState(!1),[T,M]=u.useState(null),[A,z]=u.useState(""),[P,X]=u.useState(""),[H,Y]=u.useState(null),[V,I]=u.useState(null),[F,D]=u.useState(!1),[L,B]=u.useState(""),[k,U]=u.useState(null),[R,q]=u.useState(null),[G,J]=u.useState(()=>[...ns]),[ie,Z]=u.useState(()=>[...ns]),[me,Q]=u.useState(!1),[ue,ne]=u.useState(""),[we,Pe]=u.useState(""),[Re,Ce]=u.useState(""),[it,qe]=u.useState(""),[We,ke]=u.useState(()=>pl("create")),[xt,Mt]=u.useState("details"),[Ct,At]=u.useState(!1),[He,Qe]=u.useState({open:!1,columnKey:"",columnLabel:"",x:0,y:0}),[W,ee]=u.useState(!1),[te,ve]=u.useState([]),le=y.toString(),Se=f||"",Ee=!!Se,ge=y.get(J0)??"",at=!!ge,st=u.useRef(`entity-form-${Math.random().toString(36).slice(2)}`),nt=u.useRef(`${Se}:${p}`),ze=u.useCallback((de,Ae="info")=>{Y({message:de,tone:Ae})},[]);u.useEffect(()=>{!v||!me||Q(!1)},[v,me]),u.useEffect(()=>{We.accessButtonVisible||xt!=="details"&&Mt("details")},[We.accessButtonVisible,xt]),u.useEffect(()=>{if(!He.open)return;const de=()=>Qe({open:!1,columnKey:"",columnLabel:"",x:0,y:0});return window.addEventListener("click",de),window.addEventListener("contextmenu",de),()=>{window.removeEventListener("click",de),window.removeEventListener("contextmenu",de)}},[He.open]),u.useEffect(()=>{if(!H)return;const de=setTimeout(()=>Y(null),3500);return()=>clearTimeout(de)},[H]);const ft=u.useCallback(de=>{if(!de)return"";const Ae=new Date(de);return Number.isNaN(Ae.getTime())?"":Ae.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},[]),zt=u.useMemo(()=>!i||!e?"":i.members?.find(Ae=>Ae.user_id===e.id)?.role||"",[i,e]),Rt=u.useMemo(()=>{if(!c||!e?.id)return!1;const de=c.created_by||c.creator?.id||c.owner_id||c.owner?.id||"";return de?String(de)===String(e.id):!1},[c,e?.id]),pt=u.useMemo(()=>e?u4.has(e.role)?!0:Se?m==="world"?Rt:!!(i&&(zt==="dm"||Rt)):!1:!1,[e,Se,m,i,zt,Rt]),ct=c?.entity_creation_scope??"",yt=u.useMemo(()=>!l||!i||!e||ct!==dc.ALL_PLAYERS?!1:zt==="player",[l,i,e,ct,zt]),Tt=pt||yt,Ft=e?.role==="system_admin",kt=u.useCallback(async(de,Ae={})=>{if(!t)return w([]),[];const{useUnassigned:Ut=!1,viewAsCharacterId:pn=""}=Ae;if(Ut){if(!Ft)return w([]),C("Only system administrators can view unassigned entities"),[];j(!0),C("");try{const qt=await UR(),jn=Array.isArray(qt)?qt:Array.isArray(qt?.data)?qt.data:[];return w(jn),jn}catch(qt){return console.error(" Failed to load unassigned entities",qt),C(qt.message||"Failed to load unassigned entities"),w([]),[]}finally{j(!1)}}const fn=de??Se;if(!fn)return w([]),[];j(!0),C("");try{const qt=await oc(fn,{viewAsCharacterId:pn,importance:te.length>0?te:void 0}),jn=Array.isArray(qt)?qt:Array.isArray(qt?.data)?qt.data:[];return w(jn),jn}catch(qt){return console.error(" Failed to load entities",qt),C(qt.message||"Failed to load entities"),w([]),[]}finally{j(!1)}},[t,Se,Ft,p]);u.useEffect(()=>{if(!t){w([]);return}if(W){kt(null,{useUnassigned:!0});return}if(!Se){w([]);return}kt(Se,{viewAsCharacterId:h})},[Se,t,W,kt,p,h,te]),u.useEffect(()=>{if(W){nt.current=`${Se}:${p}`;return}const de=`${Se}:${p}`;nt.current!==de&&(O&&(E(!1),M(null)),z(""),ke(pl("create")),C(""),Y(null),nt.current=de)},[Se,p,O,W]),u.useEffect(()=>{!Ft&&W&&ee(!1)},[Ft,W]),u.useEffect(()=>{W&&O&&(E(!1),M(null),z(""),ke(pl("create")))},[W,O]),u.useEffect(()=>{if(Q(!1),ne(""),!ge||!t||!r){I(null),B(""),U(null),q(null),J([...ns]),Z([...ns]),D(!1);return}let de=!1;return(async()=>{D(!0),B("");try{const Ut=await ck(ge);if(de)return;const pn=Ut?.data??Ut??{},fn=pn.data??pn,qt=Array.isArray(fn.coreColumns)&&fn.coreColumns.length?fn.coreColumns:Yu,jn=new Map(Yu.map(Pt=>[Pt.key,Pt])),qn=qt.map(Pt=>{const Kn=jn.get(Pt.key)??{};return{...Kn,...Pt,type:"core",label:Pt.label||Kn.label||Pt.key}}),Fn=Yu.filter(Pt=>!qn.some(Kn=>Kn.key===Pt.key)),ia=[...qn,...Fn],Me=(Array.isArray(fn.metadataColumns)?fn.metadataColumns:[]).filter(Pt=>typeof Pt?.key=="string").map(Pt=>({key:Pt.key,name:Pt.name||Pt.key.replace(/^metadata\./,""),label:Pt.label||Pt.name||Pt.key.replace(/^metadata\./,""),dataType:Pt.dataType||Pt.data_type||"",required:!!Pt.required,options:Pt.options||Pt.choices||{},referenceTypeId:Pt.referenceTypeId||Pt.reference_type_id||null,referenceTypeName:Pt.referenceTypeName||Pt.reference_type_name||"",referenceFilter:Pt.referenceFilter||Pt.reference_filter||Pt.referenceFilterJson||{}})).sort((Pt,Kn)=>Pt.label.localeCompare(Kn.label,void 0,{sensitivity:"base"})),ht=new Set([...ia.map(Pt=>Pt.key),...Me.map(Pt=>Pt.key)]);ns.forEach(Pt=>ht.add(Pt));const Dt=Kh(ns,ns,ht),Vt=fn.systemDefault?.columns,nn=Array.isArray(Vt)&&Vt.length?Kh(Vt,Dt,ht):[...Dt],xn=fn.userPreference?.columns,Gt=Array.isArray(xn)&&xn.length>0,vn=Gt?Kh(xn,nn,ht):[],la=Gt&&vn.length?vn:nn;I({coreColumns:ia,metadataColumns:Me}),q(nn.length?{columns:[...nn],updatedAt:fn.systemDefault?.updatedAt??null}:null),U(Gt&&vn.length?{columns:[...vn],updatedAt:fn.userPreference?.updatedAt??null}:null),J([...la]),Z([...la])}catch(Ut){if(de)return;console.error(" Failed to load column configuration",Ut),B(Ut.message||"Failed to load column configuration"),I(null),U(null),q(null),J([...ns]),Z([...ns])}finally{de||D(!1)}})(),()=>{de=!0}},[ge,t,r]);const Zt=u.useMemo(()=>{let de=S;return ge&&(de=de.filter(Ae=>(Ae.entity_type_id||Ae.entityType?.id||Ae.entity_type?.id||"")===ge)),te.length>0&&l&&(de=de.filter(Ae=>{const Ut=Ae.importance||null;return te.includes(Ut)})),de},[S,ge,te,l]),Lt=u.useMemo(()=>{if(!ge)return"";const de=S.find(Ae=>(Ae.entity_type_id||Ae.entityType?.id||Ae.entity_type?.id||"")===ge);return de?.entityType?.name||de?.entity_type?.name||""},[S,ge]),Kt=u.useMemo(()=>{const de=[],Ae=new Set,Ut=(qt,jn)=>{if(!qt||typeof qt!="object")return;const qn=typeof qt.key=="string"?qt.key.trim():"";if(!qn||Ae.has(qn))return;const Fn=qt.label||qt.name||(typeof qt.title=="string"?qt.title:""),ia=typeof Fn=="string"&&Fn.trim()?Fn.trim():qn;de.push({...qt,key:qn,label:ia,type:qt.type||jn}),Ae.add(qn)};return(V?.coreColumns??Yu).forEach(qt=>Ut(qt,"core")),(V?.metadataColumns??[]).forEach(qt=>Ut(qt,"metadata")),de},[V]),se=u.useMemo(()=>{const de=new Map;return Kt.forEach(Ae=>{de.set(Ae.key,{...Ae,type:Ae.type==="metadata"?"metadata":"core"})}),de},[Kt]),be=u.useMemo(()=>Array.from(se.keys()),[se]),je=u.useMemo(()=>{const de=ns.filter(Ae=>se.has(Ae));return de.length>0?de:be.length>0?[be[0]]:[...ns]},[be,se]),Ze=u.useMemo(()=>{if(v){const de=[];return se.has("name")&&de.push("name"),se.has("description")&&de.push("description"),de.length>0?de:je.filter(Ae=>se.has(Ae))}return ge?G:ns},[v,se,je,ge,G]);u.useEffect(()=>{ge&&J(de=>{const Ae=de.filter(Ut=>se.has(Ut));return Ae.length>0?Ae:je})},[ge,se,je]),u.useEffect(()=>{Z([...G])},[G]);const dt=u.useMemo(()=>{const de=Ze.map(Ae=>se.get(Ae)).filter(Boolean);return de.length>0?de:je.map(Ae=>se.get(Ae)).filter(Boolean)},[Ze,se,je]),gt=R?.columns??je,oe=k?.columns??gt,re=!!ge&&!Xh(ie,oe),Ne=!!ge&&!Xh(ie,gt),Be=we===Gh,Ke=we===eS,ot=Xh(ie,gt),Oe=()=>{Z([...gt]),ne(""),Ce(""),qe("")},ce=de=>{ge&&Z(Ae=>Ae.includes(de)?Ae.length===1?(ne("You must keep at least one column selected."),Ae):(ne(""),Re===de&&(Ce(""),qe("")),Ae.filter(Ut=>Ut!==de)):se.has(de)?(ne(""),[...Ae,de]):Ae)},Ue=(de,Ae)=>{ge&&ie.includes(de)&&(Ce(de),qe(""),Ae?.dataTransfer&&(Ae.dataTransfer.effectAllowed="move",Ae.dataTransfer.setData("text/plain",de)))},Ge=(de,Ae)=>{!Re||Re===de||ie.includes(de)&&(Ae&&(Ae.preventDefault(),Ae.dataTransfer&&(Ae.dataTransfer.dropEffect="move")),qe(de))},ut=de=>{ge&&(Z(Ae=>{if(!Re||Re===de)return Ae;const Ut=Ae.indexOf(Re),pn=Ae.indexOf(de);if(Ut===-1||pn===-1)return Ae;const fn=[...Ae],[qt]=fn.splice(Ut,1),jn=Ut<pn?Math.max(pn-1,0):pn;return fn.splice(jn,0,qt),fn}),qe(""),Ce(""))},ae=()=>{ge&&(Z(de=>{if(!Re||!de.includes(Re))return de;const Ae=de.filter(Ut=>Ut!==Re);return Ae.push(Re),Ae}),qe(""),Ce(""))},Xe=()=>{qe(""),Ce("")},$e=()=>{ge&&(ne(""),Q(de=>{const Ae=!de;return!de&&Ae&&(Z([...G]),Ce(""),qe("")),de&&!Ae&&(Ce(""),qe("")),Ae}))},Je=()=>{Q(!1),qe(""),Ce("")},bt=async de=>{if(ge){if(ie.length===0){ne("Please select at least one column.");return}Pe(de),ne("");try{await uk(ge,{scope:de,columns:ie}),de===Gh?(U({columns:[...ie],updatedAt:new Date().toISOString()}),J([...ie]),Je(),ze("Column preference saved","success")):(q({columns:[...ie],updatedAt:new Date().toISOString()}),J([...ie]),ze("System default updated","success"))}catch(Ae){console.error(" Failed to save column selection",Ae),ne(Ae.message||"Failed to save column settings")}finally{Pe("")}}},St=u.useCallback(de=>de?.entityType?.name||de?.entity_type?.name||"",[]),_e=u.useCallback((de,Ae)=>{if(!de)return"";switch(Ae){case"name":return de.name||"";case"type":return St(de);case"visibility":return de.visibility||"visible";case"createdAt":return de.createdAt||de.created_at||"";case"description":return de.description||"";default:{if(Ae.startsWith("metadata.")){const Ut=de.metadata&&typeof de.metadata=="object"?de.metadata:{},pn=Ae.replace(/^metadata\./,"");return Ut?.[pn]}return de[Ae]}}},[St]),tt=u.useCallback(de=>{if(de==null||de==="")return null;if(typeof de=="string"){const Ae=de.trim();return Ae.length>0?Ae:null}if(typeof de=="object"&&!Array.isArray(de)){const Ae=de.id??de.value??de.key??de.slug??de.uuid??null;return Ae!=null?String(Ae).trim():null}if(Array.isArray(de)){for(const Ae of de){const Ut=tt(Ae);if(Ut)return Ut}return null}return null},[]),mt=u.useMemo(()=>{const de=[];return se.forEach(Ae=>{const pn=(Ae.type==="metadata"?Ae.dataType||Ae.data_type||"string":Ae.dataType)||(Ae.key==="createdAt"?"date":"string"),fn=pn==="reference"||Ae.dataType&&String(Ae.dataType).toLowerCase()==="reference"||Ae.data_type&&String(Ae.data_type).toLowerCase()==="reference",qt=jn=>{const qn=_e(jn,Ae.key);if(fn){const Fn=tt(qn);return Fn!==null?Fn:qn}return qn};de.push({key:Ae.key,label:Ae.label||Ae.name||Ae.key,dataType:pn,accessor:qt})}),de},[se,_e,tt]),fe=u.useMemo(()=>new Map(mt.map(de=>[de.key,de])),[mt]),he=eN(Zt,{columns:mt}),Ve=u.useCallback(de=>{const Ae=he.groupBy?se.get(he.groupBy):null;if(!Ae)return Wh(de);if(Ae.key==="visibility"){const Ut=typeof de=="string"?de:"";return Ut?Ut.charAt(0).toUpperCase()+Ut.slice(1):"Hidden"}return Ae.key==="createdAt"?ft(de):Ae.key==="type"?de||"Unassigned":Ae.key.startsWith("metadata.")?Wh(de,Ae):Ae.key==="name"||Ae.key==="description"?de?String(de):"":de?String(de):"Unassigned"},[se,he.groupBy,ft]),vt=u.useMemo(()=>mt.map(de=>{const Ae=se.get(de.key),Ut=Ae?.data_type||Ae?.dataType||de.dataType,pn={key:de.key,label:fe.get(de.key)?.label||de.label||de.key,dataType:de.dataType,originalDataType:Ut};Ae?.options&&(pn.options=Ae.options);const fn=Ae?.referenceTypeId||Ae?.reference_type_id;fn&&(pn.referenceTypeId=fn);const qt=Ae?.referenceTypeName||Ae?.referenceType?.name;qt&&(pn.referenceTypeName=qt);const jn=Ae?.referenceFilter||Ae?.reference_filter;return jn&&(pn.referenceFilter=jn),pn}),[mt,fe,se]),Nt=de=>{de&&he.toggleSort(de)},Et=(de,Ae)=>{de.preventDefault(),Qe({open:!0,columnKey:Ae.key,columnLabel:Ae.label||Ae.name||Ae.key,x:de.clientX,y:de.clientY})},jt=de=>{he.setGroupBy(de),Qe({open:!1,columnKey:"",columnLabel:"",x:0,y:0})},Wt=(de,Ae)=>{const Ut=Ae.metadata&&typeof Ae.metadata=="object"?Ae.metadata:{};switch(de.key){case"name":const pn=l?Ae.importance:null,fn={critical:"",important:"",medium:""};return a.jsxs(a.Fragment,{children:[a.jsx(Jt,{to:`/entities/${Ae.id}`,state:{fromEntities:{search:le}},className:"entity-name-link",children:Ae.name}),Ae.id?a.jsxs(a.Fragment,{children:["",a.jsx(Is,{entityId:Ae.id,entityName:Ae.name||"entity"})]}):null,pn&&a.jsxs(a.Fragment,{children:["",a.jsx("span",{className:"entity-importance-indicator",title:`Importance: ${pn}`,children:fn[pn]||""})]})]});case"type":return St(Ae);case"visibility":{const qt=Ae.visibility||"visible",jn=c4[qt]||"badge-hidden";return a.jsx("span",{className:`visibility-badge ${jn}`,children:qt.charAt(0).toUpperCase()+qt.slice(1)})}case"createdAt":return ft(Ae.createdAt||Ae.created_at);case"description":return Ae.description?Ae.description:"";case"importance":{if(!l)return"";const qt=Ae.importance;if(!qt)return"";const jn={critical:"Critical",important:"Important",medium:"Medium"},qn={critical:"#dc2626",important:"#ea580c",medium:"#6b7280"};return a.jsx("span",{className:"importance-badge",style:{"--importance-color":qn[qt]},children:jn[qt]||qt})}default:{if(de.key.startsWith("metadata.")){const qt=de.key.replace(/^metadata\./,""),jn=Ut?.[qt],qn=Wh(jn,de);if(((de?.dataType||de?.data_type||"")==="reference"||ag(jn))&&jn!==null&&jn!==void 0){const ye=Wy(jn),Me=Zy(jn)||qn||"entity";if(ye)return a.jsxs(a.Fragment,{children:[qn,"",a.jsx(Is,{entityId:ye,entityName:Me})]})}return qn}return""}}},ln=()=>{E(!1),M(null),z(""),ke(pl("create")),Mt("details")},dn=async de=>{ln(),W?await kt(null,{useUnassigned:!0}):Se&&await kt(Se,{viewAsCharacterId:h}),ze(de==="create"?"Entity created":"Entity updated","success")},Qt=async de=>{if(!(!pt||!de?.id||!window.confirm(`Delete entity "${de.name}"? This action cannot be undone.`)))try{X(de.id),await PR(de.id),ze("Entity deleted","success"),W?await kt(null,{useUnassigned:!0}):Se&&await kt(Se,{viewAsCharacterId:h})}catch(Ut){console.error(" Failed to delete entity",Ut),ze(Ut.message||"Failed to delete entity","error")}finally{X("")}},ha=()=>{if(W){kt(null,{useUnassigned:!0});return}Se&&kt(Se,{viewAsCharacterId:h})},ka=()=>{!Tt||!Se||W||(M(null),z(""),ke(pl("create")),Mt("details"),E(!0))},Jr=de=>{if(!pt||!de?.id)return;const Ae=typeof de.name=="string"?de.name.trim():"";M(de.id),z(Ae),ke(pl("edit")),Mt("details"),E(!0)},ur=u.useCallback(de=>{de&&ke(Ae=>({...Ae,...de}))},[]),Os=u.useMemo(()=>{if(!T)return"";const de=S.find(Ut=>Ut.id===T);return typeof de?.name=="string"&&de.name.trim()||typeof A=="string"&&A.trim()||""||"Untitled entity"},[S,T,A]),ra=T?`Edit Entity: ${Os}`:"Add Entity",ei=u.useCallback(()=>{g(de=>{const Ae=new URLSearchParams(de);return Ae.delete(J0),Ae})},[g]);if(!r)return a.jsx("p",{children:"Restoring session..."});if(!t)return a.jsx("p",{children:"Authenticating..."});const ti=Zt.length>0,Un=he.groupBy?he.groups.some(de=>de.items.length>0):he.data.length>0,Da=`entities-page${v?" entities-page--mobile":""}`,Ss=i?`${i.name}${c?.name?`  ${c.name}`:""}`:Ee?`World  ${c?.name||"Untitled world"}`:"";return a.jsxs("section",{className:Da,children:[a.jsx("div",{className:"entities-header",children:a.jsxs("div",{className:"entities-header-top",children:[a.jsxs("div",{className:"entities-header-left",children:[a.jsx("h1",{children:"Entities"}),W?a.jsx("p",{className:"entities-subtitle",children:"Showing entities without a world assignment."}):Ee?a.jsx("p",{className:"entities-subtitle",children:Ss}):a.jsx("p",{className:"entities-subtitle",children:"Select a campaign or world you own to choose a world context."})]}),a.jsxs("div",{className:"entities-header-controls-row",children:[a.jsx(Vy,{value:he.searchTerm,onChange:he.setSearchTerm,placeholder:"Search entities...",ariaLabel:"Search entities"}),a.jsxs("div",{className:"entities-controls",children:[Ft&&a.jsx("button",{type:"button",className:`btn secondary compact${W?" is-active":""}`,onClick:()=>ee(de=>!de),"aria-pressed":W,title:W?"Show entities for the selected world":"Show entities that do not have a world assigned",children:"No World"}),l&&a.jsxs("div",{className:"entities-importance-filters",children:[["critical","important","medium"].map(de=>{const Ae=te.includes(de);return a.jsx("button",{type:"button",className:`btn secondary compact importance-filter importance-${de}${Ae?" is-active":""}`,onClick:()=>{ve(Ut=>Ae?Ut.filter(pn=>pn!==de):[...Ut,de])},title:`Filter by ${de} importance`,children:de.charAt(0).toUpperCase()+de.slice(1)},de)}),te.length>0&&a.jsx("button",{type:"button",className:"btn secondary compact importance-filter-clear",onClick:()=>ve([]),title:"Clear importance filters",children:a.jsx(Ra,{size:14})})]}),a.jsxs("div",{className:"entities-filters-refresh-group",children:[a.jsxs("button",{type:"button",className:`btn secondary compact${he.filterActive?" is-active":""}`,onClick:()=>At(!0),children:[a.jsx(Jd,{size:16})," Filters"]}),a.jsx("button",{type:"button",className:"icon-btn",title:"Refresh entities",onClick:ha,disabled:N||!W&&!Se,children:a.jsx(zl,{size:16})})]}),!v&&at&&a.jsxs("div",{className:"entities-column-menu-wrapper",children:[a.jsxs("button",{type:"button",className:"btn secondary compact","aria-haspopup":"dialog",onClick:$e,children:[a.jsx(vM,{size:16})," Columns"]}),me&&a.jsx("div",{className:"entities-column-drawer-overlay",role:"presentation",onClick:Je,children:a.jsxs("div",{className:"entities-column-drawer",role:"dialog","aria-modal":"true","aria-labelledby":"column-drawer-title",onClick:de=>de.stopPropagation(),children:[a.jsxs("div",{className:"entities-column-drawer-header",children:[a.jsxs("div",{children:[a.jsxs("h3",{id:"column-drawer-title",children:["Columns for ",Lt||"selected type"]}),a.jsx("p",{className:"entities-column-info",children:"Choose which fields are visible in this list. Drag the handle to reorder selected columns and save to keep your personal preference."})]}),a.jsx("button",{type:"button",className:"icon-btn",onClick:Je,title:"Close column settings",children:a.jsx(Ra,{size:16})})]}),a.jsx("div",{className:"entities-column-drawer-body",children:F?a.jsx("p",{className:"entities-column-info",children:"Loading columns"}):L?a.jsx("div",{className:"alert error",role:"alert",children:L}):a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"entities-column-hint",children:"Checked columns appear in the table. Drag the grip icon to adjust their display order."}),a.jsxs("ul",{className:"entities-column-list",children:[ie.map(de=>{const Ae=Kt.find(fn=>fn.key===de);if(!Ae)return null;const Ut=Re===de,pn=Ae.type==="metadata"?"Metadata":"Core";return a.jsxs(u.Fragment,{children:[it===de&&a.jsx("div",{className:"drop-indicator"}),a.jsxs("li",{className:`entities-column-item${Ut?" is-dragging":""}`,draggable:!0,onDragStart:fn=>Ue(de,fn),onDragOver:fn=>Ge(de,fn),onDrop:()=>ut(de),onDragEnd:Xe,children:[a.jsxs("div",{className:"entities-column-item-main",children:[a.jsx("input",{type:"checkbox",checked:!0,onChange:()=>ce(de)}),a.jsx("label",{className:"entities-column-name",children:Ae.label}),a.jsx("span",{className:"entities-column-type-badge",children:pn})]}),a.jsx("button",{type:"button",className:"entities-column-handle",draggable:!0,onDragStart:fn=>Ue(de,fn),children:a.jsx(MT,{size:18})})]})]},de)}),Re&&it==="__end"&&a.jsx("div",{className:"drop-indicator end"}),Kt.filter(de=>!ie.includes(de.key)).map(de=>{const Ae=de.type==="metadata"?"Metadata":"Core";return a.jsxs("li",{className:"entities-column-item inactive",children:[a.jsxs("div",{className:"entities-column-item-main",children:[a.jsx("input",{type:"checkbox",checked:!1,onChange:()=>ce(de.key)}),a.jsx("label",{className:"entities-column-name",children:de.label}),a.jsx("span",{className:"entities-column-type-badge",children:Ae})]}),a.jsx("div",{className:"entities-column-handle-placeholder"})]},de.key)})]}),Re&&a.jsx("div",{className:`entities-column-dropzone${it==="__end"?" is-active":""}`,onDragOver:de=>{Re&&(de.preventDefault(),de.dataTransfer&&(de.dataTransfer.dropEffect="move"),qe("__end"))},onDragLeave:()=>{it==="__end"&&qe("")},onDrop:de=>{de.preventDefault(),ae()},children:"Drop here to move column to the end"}),Kt.every(de=>de.type!=="metadata")&&a.jsx("p",{className:"entities-column-empty",children:"This entity type does not have metadata fields yet."}),ue&&a.jsx("p",{className:"entities-column-error",children:ue})]})}),a.jsxs("div",{className:"entities-column-drawer-footer",children:[a.jsx("div",{className:"entities-column-footer-left",children:a.jsx("button",{type:"button",className:"btn secondary",onClick:Oe,disabled:F||ot,children:"Use system default"})}),a.jsxs("div",{className:"entities-column-footer-right",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:()=>bt(Gh),disabled:F||Be||!re,children:Be?"Saving":"Save for me"}),Ft&&a.jsxs("div",{className:"entities-column-admin",children:[a.jsx("span",{className:"entities-column-admin-label",children:"System settings (admin only)"}),a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>bt(eS),disabled:F||Ke||!Ne,title:"Set these columns as the default for all users",children:Ke?"Saving":"Set as system default"})]})]})]})]})})]})]}),a.jsxs("button",{type:"button",className:"btn submit",onClick:ka,disabled:!Tt||!Se||N||W,children:[a.jsx(Pa,{size:18})," Add Entity"]})]})]})}),W&&a.jsx("div",{className:"alert info",role:"status",children:"Entities listed here do not have a world assigned. Open an entity to update its world from the entity detail view."}),H&&a.jsx("div",{className:`toast-banner ${H.tone}`,role:"status",children:H.message}),_&&a.jsx("div",{className:"alert error",role:"alert",children:_}),N?a.jsx("div",{className:"empty-state",children:"Loading entities..."}):!Se&&!W?a.jsx("div",{className:"empty-state",children:"Select a campaign to view its entities."}):ti?Un?a.jsx("div",{className:"entities-table-wrapper",children:a.jsxs("table",{className:"entities-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[dt.map(de=>{const Ae=he.sortState.key===de.key,Ut=he.groupBy===de.key;return a.jsx("th",{onClick:()=>Nt(de.key),onContextMenu:pn=>Et(pn,de),className:"sortable-header",children:a.jsxs("span",{className:"header-label",children:[de.label,Ae&&a.jsx("span",{className:"sort-indicator",children:he.sortState.direction==="asc"?"":""}),Ut&&a.jsx("span",{className:"group-indicator",children:"Grouped"})]})},de.key)}),pt&&a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:he.groupBy?he.groups.map(de=>a.jsxs(u.Fragment,{children:[a.jsx("tr",{className:"entities-group-row",children:a.jsxs("td",{colSpan:dt.length+(pt?1:0),children:[a.jsx("button",{type:"button",className:"group-toggle",onClick:()=>he.toggleGroupCollapse(de.id),"aria-label":`Toggle group ${Ve(de.value)}`,children:he.isGroupCollapsed(de.id)?a.jsx(zy,{size:14}):a.jsx(Ur,{size:14})}),a.jsxs("span",{className:"entities-group-label",children:[Ve(de.value)," ",a.jsxs("span",{className:"entities-group-count",children:["(",de.items.length,")"]})]})]})}),!he.isGroupCollapsed(de.id)&&de.items.map(Ae=>a.jsxs("tr",{children:[dt.map(Ut=>a.jsx("td",{children:Wt(Ut,Ae)},Ut.key)),pt&&a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Jr(Ae),title:"Edit entity",disabled:N,children:a.jsx(ar,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>Qt(Ae),title:"Delete entity",disabled:P===Ae.id,children:a.jsx(fa,{size:16})})]})})]},Ae.id))]},de.id)):he.data.map(de=>a.jsxs("tr",{children:[dt.map(Ae=>a.jsx("td",{children:Wt(Ae,de)},Ae.key)),pt&&a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Jr(de),title:"Edit entity",disabled:N,children:a.jsx(ar,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>Qt(de),title:"Delete entity",disabled:P===de.id,children:a.jsx(fa,{size:16})})]})})]},de.id))})]})}):a.jsxs("div",{className:"empty-state",children:[a.jsx("p",{className:"empty-title",children:"No entities match your filters."}),a.jsx("div",{className:"empty-actions",children:(he.filterActive||he.searchTerm)&&a.jsxs("div",{className:"empty-action-buttons",children:[he.filterActive&&a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>he.clearFilters(),children:"Clear filters"}),he.searchTerm&&a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>he.setSearchTerm(""),children:"Reset search"})]})})]}):a.jsx("div",{className:"empty-state",children:at?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"empty-title",children:"No entities of this type yet."}),a.jsx("button",{type:"button",className:"btn secondary",onClick:ei,children:"View all entities"})]}):Tt?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"empty-title",children:"No entities yet."}),a.jsxs("p",{children:["Click ",a.jsx("strong",{children:"Add Entity"})," to create your first entity."]})]}):a.jsx("p",{children:"Nothing to show right now."})}),He.open&&a.jsxs("div",{className:"column-context-menu",style:{top:He.y,left:He.x},role:"menu",children:[a.jsx("button",{type:"button",onClick:()=>jt(He.columnKey),children:he.groupBy===He.columnKey?"Remove grouping":`Group by ${He.columnLabel}`}),he.groupBy&&he.groupBy!==He.columnKey&&a.jsx("button",{type:"button",onClick:()=>jt(""),children:"Clear grouping"})]}),a.jsx(nN,{open:Ct,onClose:()=>At(!1),fields:vt,value:he.filters,worldId:Se,onApply:de=>{he.setFilters(de),At(!1)}}),a.jsx(Yr,{isOpen:O,onClose:ln,title:ra,width:420,footerActions:a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:ln,disabled:We.cancelDisabled,children:"Cancel"}),We.accessButtonVisible&&a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>Mt(de=>de==="access"?"details":"access"),disabled:We.accessButtonDisabled,children:xt==="access"?"Details":"Access"}),a.jsx("button",{type:"submit",className:"btn submit",form:st.current,disabled:We.submitDisabled,children:We.submitLabel})]}),children:a.jsx(pN,{worldId:W?"":Se,entityId:T,onCancel:ln,onSaved:dn,formId:st.current,onStateChange:ur,hideActions:!0,selectedEntityTypeId:at?ge:"",activeView:xt,onViewChange:Mt,defaultCampaignId:i?.id||""})})]})}function m4({tabs:e=[],activeTab:t,onChange:r}){if(!Array.isArray(e)||e.length===0)return null;const i=l=>{typeof r=="function"&&r(l)};return a.jsx("nav",{className:"tab-nav flex flex-wrap gap-2",role:"tablist",children:e.map(l=>{const{id:c,label:f}=l,m=c===t;return a.jsx("button",{type:"button",role:"tab","aria-selected":m,className:`tab-nav-button whitespace-nowrap px-3 py-2 ${m?"is-active":""}`,onClick:()=>i(c),children:f},c)})})}const h4=(e,t)=>{const r=new URLSearchParams;t&&r.set("campaignId",t);const i=r.toString(),l=i?`/entities/${e}/follow?${i}`:`/entities/${e}/follow`;return _t.post(l)},gN=(e,t)=>{const r=new URLSearchParams;t&&r.set("campaignId",t);const i=r.toString(),l=i?`/entities/${e}/follow?${i}`:`/entities/${e}/follow`;return _t.delete(l)},p4=e=>{const t=new URLSearchParams;e&&t.set("campaignId",e);const r=t.toString(),i=r?`/entities/followed?${r}`:"/entities/followed";return _t.get(i)},y4=(e,t)=>{const r=new URLSearchParams;t&&r.set("campaignId",t);const i=r.toString(),l=i?`/entities/${e}/follow-status?${i}`:`/entities/${e}/follow-status`;return _t.get(l)};function g4({entityId:e}){const{user:t}=En(),{selectedCampaignId:r}=Bn(),[i,l]=u.useState(!1),[c,f]=u.useState(!1),[m,h]=u.useState(!0);u.useEffect(()=>{if(!e||!r||!t?.id){h(!1);return}(async()=>{try{h(!0);const g=await y4(e,r);l(g?.following??!1)}catch(g){console.error("Failed to check follow status",g),l(!1)}finally{h(!1)}})()},[e,r,t?.id]);const p=async()=>{if(!e||!r||c||m)return;const y=!i;f(!0);try{y?await h4(e,r):await gN(e,r),l(y)}catch(g){console.error("Failed to toggle follow",g),l(!y)}finally{f(!1)}};return r?m?a.jsx("button",{type:"button",className:"entity-follow-button",disabled:!0,title:"Checking follow status...",children:a.jsx(Md,{size:18})}):a.jsx("button",{type:"button",className:`entity-follow-button ${i?"following":""}`,onClick:p,disabled:c,title:i?"Unfollow entity":"Follow entity",children:i?a.jsx(Ly,{size:18}):a.jsx(Md,{size:18})}):null}function b4({entityId:e,name:t,canEdit:r,isEditing:i,onToggleEdit:l,onSave:c,isSaving:f=!1,isSaveDisabled:m=!1}){const h=t||"Untitled entity",p=()=>{typeof l=="function"&&l()},y=()=>{typeof c=="function"&&c()};return a.jsxs("div",{className:"entity-header flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 sm:gap-2",role:"banner",children:[a.jsx("div",{className:"entity-header-center",children:a.jsx("h1",{children:h})}),a.jsxs("div",{className:"entity-header-right",children:[e&&a.jsx(g4,{entityId:e}),r?a.jsxs("div",{className:"entity-header-actions",children:[i&&typeof c=="function"?a.jsx("button",{type:"button",className:"btn submit",onClick:y,disabled:m||f,children:f?"Saving":"Save"}):null,a.jsxs("button",{type:"button",className:`edit-mode-toggle ${i?"is-active":""}`,role:"switch","aria-checked":i,onClick:p,children:[a.jsx("span",{className:"edit-mode-toggle-track","aria-hidden":"true",children:a.jsx("span",{className:"edit-mode-toggle-thumb"})}),a.jsx("span",{className:"edit-mode-toggle-text",children:"Edit"})]})]}):null]})]})}const v4=[{value:"critical",label:"Critical",icon:qa,color:"#dc2626"},{value:"important",label:"Important",icon:Fy,color:"#ea580c"},{value:"medium",label:"Medium",icon:A1,color:"#6b7280"},{value:null,label:"None",icon:Ra,color:"#9ca3af"}];function x4({entityId:e,importance:t,onUpdate:r}){const{selectedCampaignId:i}=Bn(),[l,c]=u.useState(!1);if(!i)return null;const f=async m=>{if(!(l||m===t)){c(!0);try{await HR(e,m),r?.(m)}catch(h){console.error("Failed to update entity importance",h)}finally{c(!1)}}};return a.jsxs("div",{className:"entity-importance-selector",children:[a.jsx("span",{className:"entity-importance-label",children:"Importance:"}),a.jsx("div",{className:"entity-importance-buttons",children:v4.map(m=>{const h=m.icon,p=t===m.value;return a.jsxs("button",{type:"button",className:`entity-importance-button ${p?"selected":""}`,onClick:()=>f(m.value),disabled:l,title:m.label,style:p?{"--importance-color":m.color}:{},children:[a.jsx(h,{size:16}),a.jsx("span",{className:"entity-importance-button-label",children:m.label})]},m.value||"none")})})]})}var Zh={exports:{}},Qh,tS;function S4(){if(tS)return Qh;tS=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Qh=e,Qh}var Jh,nS;function w4(){if(nS)return Jh;nS=1;var e=S4();function t(){}function r(){}return r.resetWarningCache=t,Jh=function(){function i(f,m,h,p,y,g){if(g!==e){var v=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw v.name="Invariant Violation",v}}i.isRequired=i;function l(){return i}var c={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:l,element:i,elementType:i,instanceOf:l,node:i,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:r,resetWarningCache:t};return c.PropTypes=c,c},Jh}var aS;function N4(){return aS||(aS=1,Zh.exports=w4()()),Zh.exports}var E4=N4();const wt=ki(E4);function bN({maxWidth:e=1280,className:t="",children:r}){const l={"--entity-page-max-width":typeof e=="number"?`${e}px`:e},c=["entity-page-layout",t].filter(Boolean).join(" ");return a.jsx("div",{className:c,style:l,children:a.jsx("div",{className:"entity-page-layout__inner",children:r})})}bN.propTypes={maxWidth:wt.oneOfType([wt.number,wt.string]),className:wt.string,children:wt.node};const j4=new Set(["image/png","image/jpeg","image/jpg"]),_4=2*1024*1024,C4=e=>Number.isFinite(e)?e>=1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:e>=1024?`${(e/1024).toFixed(1)} KB`:`${e} bytes`:"";function A4({entity:e,canEdit:t,isEditing:r,onEntityUpdate:i,variant:l="card"}){const[c,f]=u.useState(null),[m,h]=u.useState(""),[p,y]=u.useState(""),[g,v]=u.useState(!1),[S,w]=u.useState(!1),N=u.useRef(null),[j,_]=u.useState(null),C=!!e?.id,O=!!(e?.imageData&&e?.imageMimeType),E=u.useMemo(()=>Bl(e),[e]),T=m||E,M=e?.name?`${e.name} artwork`:"Entity artwork",A=l==="compact",z=u.useCallback(()=>{f(null),h(B=>(B&&URL.revokeObjectURL(B),"")),_(null),y(""),N.current&&(N.current.value="")},[]);u.useEffect(()=>()=>{m&&URL.revokeObjectURL(m)},[m]),u.useEffect(()=>{!r&&c&&z()},[r,c,z]);const P=()=>{!t||!r||g||S||N.current?.click()},X=B=>{const k=B.target.files?.[0];if(k){if(!j4.has(k.type)){y("Only PNG or JPG images are allowed."),B.target.value="";return}if(k.size>_4){y("Image must be smaller than 2 MB."),B.target.value="";return}y(""),f(k),_(null),h(U=>(U&&URL.revokeObjectURL(U),URL.createObjectURL(k)))}},H=u.useCallback(B=>{B&&typeof i=="function"&&i(B)},[i]),Y=async()=>{if(!(!c||!C)){v(!0),y("");try{const B=j?await hN(c,j):c,k=await V1(e.id,B),U=Ha(k);if(!U)throw new Error("Failed to upload image");H(U),z()}catch(B){y(B.message||"Failed to upload image")}finally{v(!1)}}},V=async()=>{if(C){w(!0),y("");try{const B=await Y1(e.id),k=Ha(B);if(k)H(k);else{const U=tN({...e||{},imageData:null,imageMimeType:null,image_data:null,image_mime_type:null});H(U)}z()}catch(B){y(B.message||"Failed to delete image")}finally{w(!1)}}},I=u.useMemo(()=>{const B=["PNG or JPG up to 2 MB.","Uploads are resized to 256256 JPG (~70% quality, ~150 KB)."];return c&&B.push(`Selected: ${c.name} (${C4(c.size)})`),B.join(" ")},[c]),F=A?"div":"section",D=A?"entity-image-card entity-image-card--compact":"entity-card entity-image-card",L=u.useCallback(B=>{_(B)},[]);return u.useEffect(()=>{c||_(null)},[c]),a.jsxs(F,{className:D,children:[a.jsxs("div",{className:"entity-card-header",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"entity-card-title",children:"Image"}),a.jsx("p",{children:A?"Shown in the dossier summary.":"Displayed on the dossier tab."})]}),t&&r?a.jsxs("div",{className:"entity-card-actions",children:[O&&!c?a.jsx("button",{type:"button",className:"btn secondary",onClick:V,disabled:S,children:S?"Removing":a.jsxs("span",{className:"entity-image-action-label",children:[a.jsx(fa,{size:16,"aria-hidden":"true"})," Remove image"]})}):null,a.jsx("button",{type:"button",className:"btn secondary",onClick:P,disabled:g||S,children:a.jsxs("span",{className:"entity-image-action-label",children:[a.jsx(TM,{size:16,"aria-hidden":"true"})," Choose image"]})})]}):null]}),a.jsxs("div",{className:"entity-card-body",children:[a.jsxs("div",{className:`entity-image-preview ${T&&!c?"has-image":""}`.trim(),children:[c&&m?a.jsx(mN,{src:m,size:220,onCropChange:L}):T?a.jsx("img",{src:T,alt:M,loading:"lazy"}):a.jsxs("div",{className:"entity-image-placeholder",children:[a.jsx(DT,{size:32,"aria-hidden":"true"}),a.jsx("p",{children:"No image uploaded"})]}),c?a.jsx("button",{type:"button",className:"entity-image-preview-clear",onClick:z,disabled:g,"aria-label":"Clear selected image",children:a.jsx(Ra,{size:16,"aria-hidden":"true"})}):null]}),c&&t&&r?a.jsxs("div",{className:"entity-image-actions",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:Y,disabled:g,children:g?"Uploading":"Save Image"}),a.jsx("button",{type:"button",className:"btn secondary",onClick:z,disabled:g,children:"Cancel"})]}):null,a.jsx("input",{type:"file",ref:N,accept:"image/png,image/jpeg",onChange:X,hidden:!0}),a.jsx("p",{className:"entity-image-helper",children:I}),p?a.jsx("p",{className:"entity-image-status entity-image-status--error",children:p}):null,!p&&g?a.jsx("p",{className:"entity-image-status",children:"Uploading image"}):null,!p&&S?a.jsx("p",{className:"entity-image-status",children:"Removing image"}):null]})]})}function vN({open:e,eyebrowLabel:t="Heads up",title:r="Unsaved changes",description:i="You have unsaved changes on this record.",destinationLabel:l="",saving:c=!1,onSaveAndContinue:f,onContinueWithoutSaving:m,onStay:h}){if(!e)return null;const p=l?` before continuing to ${l}`:"";return a.jsx("div",{className:"unsaved-dialog-backdrop",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"unsaved-dialog",role:"document",children:[a.jsxs("div",{className:"unsaved-dialog-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"unsaved-dialog-label",children:t}),a.jsx("h2",{children:r})]}),a.jsx("button",{type:"button",className:"icon-btn","aria-label":"Close dialog",onClick:h,children:a.jsx(Ra,{size:18})})]}),a.jsxs("div",{className:"unsaved-dialog-body",children:[a.jsxs("p",{children:[i,p,"."]}),a.jsx("p",{className:"unsaved-dialog-help",children:"Choose an option below to continue."})]}),a.jsxs("div",{className:"unsaved-dialog-actions",children:[a.jsx("button",{type:"button",className:"btn submit",onClick:f,disabled:c,children:c?"Saving":"Save and continue"}),a.jsx("button",{type:"button",className:"btn ghost",onClick:m,disabled:c,children:"Continue without saving"}),a.jsx("button",{type:"button",className:"btn cancel",onClick:h,disabled:c,children:"Stay here"})]})]})})}const ep=()=>({relationshipTypes:{mode:"all",values:[]},relatedEntityTypes:{mode:"all",values:[]}}),T4=e=>_t.get(`/entity-relationships?worldId=${e}`),M4=e=>_t.get(`/entity-relationships/${e}`),R4=e=>_t.get(`/entity-relationships/entity/${e}`),xN=e=>_t.post("/entity-relationships",e),k4=(e,t)=>_t.patch(`/entity-relationships/${e}`,t),D4=e=>_t.delete(`/entity-relationships/${e}`),I4=e=>e==null?"":String(e).trim(),bf=e=>{let t={};typeof e=="string"?t={worldId:e}:e&&typeof e=="object"&&!Array.isArray(e)&&(t={...e});const r=new URLSearchParams,i=I4(t.worldId??t.world_id);i&&r.set("worldId",i);const l=r.toString(),c=l?`?${l}`:"";return _t.get(`/entity-relationship-types${c}`)},L4=e=>_t.get(`/entity-relationship-types/${e}`),O4=e=>_t.post("/entity-relationship-types",e),z4=(e,t)=>_t.patch(`/entity-relationship-types/${e}`,t),$4=e=>_t.delete(`/entity-relationship-types/${e}`);function F4({worldId:e,onCreated:t}){const[r,i]=u.useState(""),[l,c]=u.useState(""),[f,m]=u.useState(""),[h,p]=u.useState(!1),[y,g]=u.useState(""),[v,S]=u.useState([]);u.useEffect(()=>{let N=!1;return(async()=>{if(!e){S([]);return}try{const _=await Qr({worldId:e});if(!N){const C=Array.isArray(_?.data)?_.data:_;S(Array.isArray(C)?C:[])}}catch(_){N||(console.error(" Failed to load entity types",_),S([]))}})(),()=>{N=!0}},[e]);const w=async N=>{if(N.preventDefault(),!r||!l){g("Name and type are required.");return}try{p(!0),g("");const _=await Hy({world_id:e,name:r,description:f,entity_type_id:l,visibility:"visible"}),C=_?.data||_;t(C),i(""),c(""),m("")}catch(j){console.error(" Failed to create entity inline",j),g(j.message||"Failed to create entity")}finally{p(!1)}};return a.jsxs("form",{className:"inline-entity-creator",onSubmit:w,children:[a.jsx("h4",{children:"Create New Entity"}),y&&a.jsx("div",{className:"alert error",children:y}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Name"}),a.jsx("input",{type:"text",value:r,onChange:N=>i(N.target.value),placeholder:"Entity name..."})]}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Type"}),a.jsxs("select",{value:l,onChange:N=>c(N.target.value),children:[a.jsx("option",{value:"",children:"Select type..."}),v.map(N=>a.jsx("option",{value:N.id,children:N.name},N.id))]})]}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Description"}),a.jsx("textarea",{rows:"2",value:f,onChange:N=>m(N.target.value),placeholder:"Optional..."})]}),a.jsx("div",{className:"form-actions",children:a.jsx("button",{type:"submit",className:"btn primary",disabled:h||!e,children:h?"Creating":"Create Entity"})})]})}function SN({worldId:e,fromEntity:t=null,onCreated:r,onCancel:i,existingRelationships:l=[]}){const[c,f]=u.useState([]),[m,h]=u.useState(!0),[p,y]=u.useState(""),[g,v]=u.useState(null),[S,w]=u.useState(null),[N,j]=u.useState(""),[_,C]=u.useState(null),[O,E]=u.useState(!1);u.useEffect(()=>{e&&(h(!0),bf({worldId:e}).then(L=>{const B=Array.isArray(L?.data)?L.data:L?.data||[];f(B||[])}).catch(L=>y(L.message||"Failed to load data")).finally(()=>h(!1)))},[e]),u.useEffect(()=>{if(!t||g||!t.id||!t.name)return;const L={id:t.id,name:t.name,entity_type_id:t.entity_type_id||t.entityType?.id||t.entity_type?.id,entityType:t.entityType||t.entity_type||null,typeName:t.typeName||t.entityType?.name||t.entity_type?.name};v(L)},[t]);const T=L=>{if(!L)return null;const B=L.entity_type_id||L.typeId||L.entityType?.id||L.entity_type?.id,k=L.typeName||L.entityType?.name||L.entity_type?.name;return{...L,entity_type_id:B,typeName:k}},M=L=>L?.name||L?.title||L?.displayName||"Unnamed entity",A=u.useMemo(()=>{const L=T(g),B=T(S);if(!L||!B)return[];const k=L.entity_type_id,U=B.entity_type_id;if(!k||!U)return[];const R=(q=[])=>q.map(G=>G.id||G.entity_type_id||G.entityTypeId||G.type_id||G.typeId||G).map(String);return c.map(q=>{const G=R(q.from_entity_types),J=R(q.to_entity_types),ie=G.includes(String(k))&&J.includes(String(U)),Z=G.includes(String(U))&&J.includes(String(k));return ie||Z?{...q,_supportsDirect:ie,_supportsReverse:Z}:null}).filter(Boolean)},[c,g,S]),z=u.useMemo(()=>A.find(L=>String(L.id)===String(N)),[N,A]),P=u.useMemo(()=>z?_==="reverse"&&z._supportsReverse?"reverse":_==="direct"&&z._supportsDirect||z._supportsDirect?"direct":z._supportsReverse?"reverse":null:null,[_,z]);u.useEffect(()=>{if(!z){_!==null&&C(null);return}if(P===null){_!==null&&C(null);return}if(_===null){C(P);return}_!==P&&C(P)},[z,P,_]),u.useEffect(()=>{if(!N)return;A.some(B=>String(B.id)===String(N))||(j(""),C(null))},[A,N]);const X=P==="direct"?g:S,H=P==="direct"?S:g,Y=M(X),V=M(H),I=z?.from_name||z?.fromName||z?.name||"relates to",F=z?.to_name||z?.toName||z?.name||"relates to",D=async()=>{if(y(""),!g||!S||!N)return y("Please select both entities and a relationship type.");if(g.id===S.id)return y("Cannot create self-relationships.");if(l.find(R=>(R.from_entity_id===g.id&&R.to_entity_id===S.id||R.from_entity_id===S.id&&R.to_entity_id===g.id)&&R.relationship_type_id===N)){y("This relationship already exists.");return}const B=P;if(!z||!B){y("Please select a valid relationship type.");return}const k=B==="direct"?g.id:S.id,U=B==="direct"?S.id:g.id;try{await xN({from_entity_id:k,to_entity_id:U,relationship_type_id:N}),r?.({from_entity_id:k,to_entity_id:U,relationship_type_id:N,__direction:B})}catch(R){R.response?.status===409||R.response?.data?.message?.toLowerCase?.().includes("duplicate")||R.message?.toLowerCase?.().includes("duplicate")||R.message?.toLowerCase?.().includes("conflict")?y("This relationship already exists."):R.response?.data?.message?y(R.response.data.message):y("Failed to create relationship."),console.warn(" Relationship create error:",R)}};return m?a.jsx("p",{children:"Loading relationship data"}):a.jsxs("div",{className:"relationship-builder-v3",children:[a.jsx("h2",{children:"Add Relationship"}),p&&a.jsx("div",{className:"alert error",children:p}),a.jsx("div",{className:"form-row",children:a.jsx(cc,{worldId:e,label:"Entity 1",value:g?.id||"",onChange:L=>{t||(v(L),j(""),C(null))},disabled:!!t})}),a.jsxs("div",{className:"form-row entity2-section",children:[a.jsx(cc,{worldId:e,label:"Entity 2",value:S?.id||"",onChange:L=>w(L)}),!O&&a.jsx("button",{type:"button",className:"btn small tertiary",onClick:()=>E(!0),style:{alignSelf:"flex-start",marginTop:"0.4rem"},children:"+ Create new entity"}),O&&a.jsx(F4,{worldId:e,onCreated:async L=>{try{const B=await rr(L.id),k=Ha(B)||L;w(k)}catch{w(L)}E(!1)}})]}),g&&S&&a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Relationship Type"}),a.jsxs("select",{value:N,onChange:L=>{const B=L.target.value;if(j(B),!B){C(null);return}const k=A.find(U=>String(U.id)===String(B));k?._supportsDirect?C("direct"):k?._supportsReverse?C("reverse"):C(null)},children:[a.jsx("option",{value:"",children:"Select relationship type"}),A.length>0?A.map(L=>a.jsxs("option",{value:L.id,children:[L.name," (",L.from_name,"  ",L.to_name,")"]},L.id)):a.jsx("option",{disabled:!0,children:"No valid relationship types"})]})]}),g&&S&&z&&P&&a.jsxs("div",{className:"relationship-preview",children:[a.jsxs("div",{className:"preview-header",children:[a.jsx("h3",{children:"Relationship preview"}),z._supportsDirect&&z._supportsReverse&&a.jsx("button",{type:"button",className:"btn small secondary",onClick:()=>C(L=>L==="reverse"?"direct":"reverse"),children:"Swap entities"})]}),a.jsxs("p",{children:[a.jsx("strong",{children:Y})," ",I," ",a.jsx("strong",{children:V})]}),a.jsxs("p",{children:[a.jsx("strong",{children:V})," ",F," ",a.jsx("strong",{children:Y})]})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{className:"btn primary",disabled:!g||!S||!N,onClick:D,children:"Create Relationship"}),a.jsx("button",{className:"btn secondary",onClick:i,children:"Cancel"})]})]})}const wN=["global","selective","hidden"],B4=[...wN,"owner_only"],sS=new Set(wN),rS=new Set(B4),tp=(e,t)=>{if(typeof e!="string")return"global";const r=e.toLowerCase();return t.has(r)?r:"global"},Oo=e=>e?Array.isArray(e)?e.map(t=>t==null?"":String(t).trim()).filter(Boolean):typeof e=="string"?e.split(",").map(t=>t.trim()).filter(Boolean):[]:[],np=()=>({campaigns:[],users:[],characters:[]});function U4(e,t,r){const i=e?.id,l=e?.world?.id||e?.world_id||"",c=u.useMemo(()=>e?{readMode:tp(e.read_access||e.readAccess,sS),readCampaigns:Oo(e.read_campaign_ids||e.readCampaignIds),readUsers:Oo(e.read_user_ids||e.readUserIds),readCharacters:Oo(e.read_character_ids||e.readCharacterIds),writeMode:tp(e.write_access||e.writeAccess,rS),writeCampaigns:Oo(e.write_campaign_ids||e.writeCampaignIds),writeUsers:Oo(e.write_user_ids||e.writeUserIds)}:{readMode:"global",readCampaigns:[],readUsers:[],readCharacters:[],writeMode:"global",writeCampaigns:[],writeUsers:[]},[e]),[f,m]=u.useState(c),[h,p]=u.useState(()=>np()),[y,g]=u.useState(!1),[v,S]=u.useState(""),[w,N]=u.useState(!1),[j,_]=u.useState(""),[C,O]=u.useState("");u.useEffect(()=>{m(c)},[c]);const E=u.useCallback(async()=>{if(t){if(!l){p(np()),S(""),g(!1);return}g(!0),S("");try{const P=await fN(l);p({campaigns:P.campaigns??[],users:P.users??[],characters:P.characters??[]})}catch(P){console.error(" Failed to load access options",P),p(np()),S(P.message||"Failed to load access options")}finally{g(!1)}}},[t,l]);u.useEffect(()=>{E()},[E]);const T=u.useMemo(()=>{const P=["readMode","readCampaigns","readUsers","readCharacters","writeMode","writeCampaigns","writeUsers"],X=H=>Array.isArray(H)?H.map(Y=>String(Y).trim()).filter(Boolean).sort():[];return P.some(H=>{const Y=f[H],V=c[H];if(Array.isArray(Y)||Array.isArray(V)){const I=X(Y),F=X(V);return I.length!==F.length?!0:I.some((D,L)=>D!==F[L])}return Y!==V})},[f,c]),M=u.useCallback((P,X)=>{_(""),O(""),m(H=>{const Y={...H};if(P==="readMode"||P==="writeMode"){const I=tp(X,P==="readMode"?sS:rS);return Y[P]=I,P==="readMode"&&I!=="selective"&&(Y.readCampaigns=[],Y.readUsers=[],Y.readCharacters=[]),P==="writeMode"&&I!=="selective"&&(Y.writeCampaigns=[],Y.writeUsers=[]),Y}return["readCampaigns","readUsers","readCharacters","writeCampaigns","writeUsers"].includes(P)?(Y[P]=Array.isArray(X)?X.map(V=>String(V).trim()).filter(Boolean):[],Y):(Y[P]=X,Y)})},[]),A=u.useCallback(()=>{m(c),_(""),O("")},[c]),z=u.useCallback(async()=>{if(!r||!i)return!1;if(!T)return!0;_(""),O(""),N(!0);try{const P={read_access:f.readMode,write_access:f.writeMode,read_campaign_ids:f.readMode==="selective"?f.readCampaigns:[],read_user_ids:f.readMode==="selective"?f.readUsers:[],read_character_ids:f.readMode==="selective"?f.readCharacters:[],write_campaign_ids:f.writeMode==="selective"?f.writeCampaigns:[],write_user_ids:f.writeMode==="selective"?f.writeUsers:[]},X=await Py(i,P);if(!(X?.data||X))throw new Error("Failed to save access settings");return O("Access settings saved."),!0}catch(P){return console.error(" Failed to save access settings",P),_(P.message||"Failed to save access settings"),!1}finally{N(!1)}},[r,i,f,T]);return{accessSettings:f,accessOptions:h,accessOptionsError:v,accessOptionsLoading:y,accessSaving:w,accessSaveError:j,accessSaveSuccess:C,isAccessDirty:T,handleAccessSettingChange:M,resetAccessSettings:A,handleAccessSave:z}}function q4(e){const t=u.useMemo(()=>typeof e=="function"?e:()=>!1,[e]);return f1(t)||wi}function H4({isEditing:e,canEdit:t,formError:r,formRef:i,editSchema:l,editInitialData:c,handleUpdate:f,handleFormStateChange:m,dossierSchema:h,viewData:p,featuredImageSrc:y,renderSchemaSections:g,imageSection:v,fieldRules:S,viewRuleContext:w}){const N=Array.isArray(h?.sections)?h.sections:[],j=N[0]||null,_=N[1]||null,C=N.slice(2),O=w?.actionsByField??{},E=w?.showRuleTargets??new Set,T=(X,H)=>{if(!X)return null;const Y=Number.isFinite(X.columns)?Math.max(1,Number(X.columns)):1,V=Array.isArray(X.fields)?X.fields:[];return V.length?a.jsx("div",{className:`entity-field-grid ${Y>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":""}`,style:{"--entity-field-columns":Y},children:V.map((I,F)=>{const D=I?.key||I?.name||I?.field||`${H}-${F}`,L=O[D],B=I.visibleByDefault!==void 0?!!I.visibleByDefault:I.visible_by_default!==void 0?!!I.visible_by_default:!0;return uc(D,L,E,B)?null:a.jsx(hf,{field:{...I},data:p,mode:"view"},`${H}-${D}`)})}):a.jsx("p",{className:"entity-empty-state",children:"No fields available."})},M=!!y&&!e,A=p?.name||"Entity",z=!!v&&e&&t,P=()=>{if(!M)return g(h,p,"dossier",w);const X={...h||{},sections:C};return a.jsxs(a.Fragment,{children:[a.jsx("section",{className:"entity-card entity-dossier-header-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:a.jsxs("div",{className:"entity-dossier-header",children:[a.jsxs("div",{className:"entity-dossier-header-content",children:[j?.title?a.jsx("h2",{className:"entity-card-title",children:j.title}):null,T(j,"dossier-summary"),_?a.jsx("div",{className:"entity-dossier-description",children:T(_,"dossier-description")}):null]}),a.jsx("div",{className:"entity-dossier-header-image sm:ml-6 sm:w-64 w-full mt-4 sm:mt-0",children:a.jsx("img",{src:y,alt:`${A} artwork`,loading:"lazy"})})]})}),g(X,p,"dossier",w)]})};return a.jsxs("div",{className:"entity-tab-content",children:[r&&a.jsx("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:a.jsx("div",{className:"alert error",role:"alert",children:r})}),e&&t?a.jsx("section",{className:"entity-card entity-card--form entity-edit-form-wrapper bg-white rounded-lg border p-4 sm:p-6 w-full",children:a.jsxs("div",{className:"entity-edit-form-container",children:[a.jsx("div",{className:"entity-edit-form-content",children:a.jsx(ps,{ref:i,schema:l,initialData:c||{},onSubmit:f,onStateChange:m,hideActions:!0,enableUnsavedPrompt:!1,fieldRules:S})}),z?a.jsx("div",{className:"entity-edit-form-image sm:ml-6 sm:w-64 w-full mt-4 sm:mt-0",children:v}):null]})}):P()]})}function P4({entity:e,toast:t,onExplore:r,canEdit:i,relationshipsLoading:l,relationshipsError:c,filteredRelationships:f,sortedRelationships:m,relationshipsEmptyMessage:h,relationshipFilters:p,relationshipFilterOptions:y,filterButtonDisabled:g,handleRelationshipFiltersChange:v,handleRelationshipFiltersReset:S,showRelationshipForm:w,setShowRelationshipForm:N,worldId:j,loadRelationships:_}){const[C,O]=u.useState(!1),E=w!==void 0?w:C,[T,M]=u.useState(!1),A=u.useRef(null);u.useEffect(()=>{if(!T)return;const L=k=>{A.current&&(A.current.contains(k.target)||M(!1))},B=k=>{k.key==="Escape"&&M(!1)};return document.addEventListener("mousedown",L),document.addEventListener("touchstart",L),document.addEventListener("keydown",B),()=>{document.removeEventListener("mousedown",L),document.removeEventListener("touchstart",L),document.removeEventListener("keydown",B)}},[T]);const z=Array.isArray(y?.relationshipTypes)?y.relationshipTypes:[],P=Array.isArray(y?.relatedEntityTypes)?y.relatedEntityTypes:[],X=p?.relationshipTypes?.values||[],H=p?.relatedEntityTypes?.values||[],Y=L=>{const B=Array.from(L.target.selectedOptions,k=>k.value);v&&v({relationshipTypes:{mode:B.length>0?"include":"all",values:B},relatedEntityTypes:p?.relatedEntityTypes||{mode:"all",values:[]}})},V=L=>{const B=Array.from(L.target.selectedOptions,k=>k.value);v&&v({relationshipTypes:p?.relationshipTypes||{mode:"all",values:[]},relatedEntityTypes:{mode:B.length>0?"include":"all",values:B}})},I=()=>{S&&S(),M(!1)},F=()=>{M(!1)},D=X.length>0||H.length>0;return a.jsxs(a.Fragment,{children:[t&&a.jsxs("div",{className:`toast-banner ${t.tone}`,role:"status",children:[a.jsx("span",{children:t.message}),t.link?a.jsx(Jt,{to:t.link.to,className:"toast-banner-link",children:t.link.label}):null]}),a.jsxs("div",{className:"bg-white border border-neutral-200 rounded-xl shadow-sm p-6 mb-6 w-full",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Relationships"}),a.jsxs("div",{className:"flex items-center gap-2",children:[typeof r=="function"?a.jsx("button",{type:"button",className:"btn-secondary",onClick:r,children:"Explore"}):null,a.jsxs("div",{className:"relative",ref:A,children:[a.jsx("button",{id:"filterButton",type:"button",className:`btn-secondary${D?" is-active":""}`,onClick:()=>M(L=>!L),disabled:g,children:"Filter"}),T&&!g?a.jsxs("div",{className:"bg-white border border-neutral-200 rounded-lg shadow-lg p-4 w-[260px] absolute top-full mt-2 right-0 z-10",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"text-sm font-medium text-neutral-700 mb-1 block",children:"Relationship Types"}),a.jsx("select",{className:"w-full border border-neutral-300 rounded-md px-3 py-1 text-sm",multiple:!0,size:5,value:X,onChange:Y,children:z.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"text-sm font-medium text-neutral-700 mb-1 block",children:"Related Entity Types"}),a.jsx("select",{className:"w-full border border-neutral-300 rounded-md px-3 py-1 text-sm",multiple:!0,size:5,value:H,onChange:V,children:P.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))})]}),a.jsxs("div",{className:"flex items-center justify-between mt-2",children:[a.jsx("button",{type:"button",className:"text-sm text-neutral-600 hover:text-neutral-900",onClick:I,children:"Clear filters"}),a.jsx("button",{type:"button",className:"btn-secondary text-sm",onClick:F,children:"Done"})]})]}):null]}),i&&a.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{N&&N(!0),w===void 0&&O(!0)},children:"Add relationship"})]})]}),l?a.jsx("p",{children:"Loading relationships..."}):c?a.jsx("div",{className:"alert error",role:"alert",children:c}):m.length===0?a.jsx("p",{className:"text-sm text-neutral-500",children:h}):f.length===0?a.jsx("p",{className:"text-sm text-neutral-500",children:"No relationships match your filters."}):a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-left text-neutral-600 border-b border-neutral-200",children:[a.jsx("th",{className:"py-2 font-medium",children:"Relationship"}),a.jsx("th",{className:"py-2 font-medium",children:"Type"}),a.jsx("th",{className:"py-2 font-medium",children:"Direction"})]})}),a.jsx("tbody",{children:f.map(L=>{const B=String(L.fromId)===String(e.id),k=B?L.toName:L.fromName,U=B?L.toId:L.fromId,R=L.sourceLabel||L.source_relationship_label||"",q=L.targetLabel||L.target_relationship_label||"";return a.jsxs("tr",{className:"border-b border-neutral-100 last:border-0",children:[a.jsxs("td",{className:"py-3",children:[a.jsx("strong",{children:e.name})," ",B?R:q," ",a.jsx(Jt,{to:`/entities/${U}`,className:"text-blue-600 hover:underline",children:k||""}),U?a.jsx(Is,{entityId:U,entityName:k}):null]}),a.jsx("td",{className:"py-3",children:L.typeName||""}),a.jsx("td",{className:"py-3",children:B?"Outgoing":"Incoming"})]},L.id)})})]})]}),j&&e?a.jsx(Yr,{isOpen:E,onClose:()=>{N?N(!1):O(!1)},title:"Add relationship",description:"Link this entity to others without leaving the page.",size:"md",children:a.jsx(SN,{worldId:j,fromEntity:e,onCreated:()=>{N?N(!1):O(!1),_&&_()},onCancel:()=>{N?N(!1):O(!1)}})}):null]})}function V4({canEdit:e,worldId:t,accessSettings:r,accessOptions:i,accessOptionsError:l,accessOptionsLoading:c,accessSaving:f,accessSaveError:m,accessSaveSuccess:h,handleAccessSettingChange:p}){return a.jsx("div",{className:"entity-tab-content",children:a.jsxs("section",{className:"entity-card entity-access-card",children:[a.jsx("h2",{className:"entity-card-title",children:"Access controls"}),a.jsx("p",{className:"entity-access-note help-text",children:"Configure who can view and edit this entity. Users with write access will automatically receive read access. Changes are saved along with the rest of the record."}),l&&a.jsx("div",{className:"alert error",role:"alert",children:l}),t?a.jsxs(a.Fragment,{children:[a.jsx(dN,{canEdit:e,accessSettings:r,accessOptions:i,accessOptionsLoading:c,accessSaving:f,onSettingChange:p}),a.jsxs("div",{className:"entity-access-actions",children:[m&&a.jsx("div",{className:"alert error",role:"alert",children:m}),h&&a.jsx("div",{className:"alert success",role:"status",children:h})]})]}):a.jsx("p",{className:"entity-empty-state",children:"Assign this entity to a world to configure access settings."})]})})}function Y4({renderSchemaSections:e,systemSchema:t,viewData:r}){return a.jsx("div",{className:"entity-tab-content",children:e(t,r,"system")})}const iS=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})},Gu=e=>{if(!e)return"";const t=e.username?.trim?.()||"",r=e.email?.trim?.()||"";return t&&r&&t!==r?`${t} (${r})`:t||r||"Unknown user"},G4=e=>Array.isArray(e)?e.filter(t=>t&&typeof t=="object").map(t=>({...t})):[],ap=(e,t)=>{const r=new Set,i=[];return e.forEach(l=>{if(!l)return;let c=l[t];if(c||(t==="user_id"?c=l.user?.id:t==="campaign_id"&&(c=l.campaign?.id)),!c)return;const f=String(c);r.has(f)||(r.add(f),i.push(l))}),i},lS=(e,t)=>{if(!e)return[];const r=Array.isArray(e.permissions)?e.permissions:[],i=new Set,l=[];return r.forEach(c=>{if(!c)return;let f=c[t];if(f||(t==="user_id"?f=c.user?.id:t==="campaign_id"&&(f=c.campaign?.id)),!f)return;const m=String(f);i.has(m)||(i.add(m),l.push(m))}),l};function X4({entity:e,secrets:t,worldId:r,canManageSecrets:i,onSecretCreated:l,onSecretUpdated:c}){const[f,m]=u.useState(""),[h,p]=u.useState(""),[y,g]=u.useState([]),[v,S]=u.useState([]),[w,N]=u.useState({campaigns:[],users:[]}),[j,_]=u.useState(!1),[C,O]=u.useState(""),[E,T]=u.useState(!1),[M,A]=u.useState(!1),[z,P]=u.useState(""),[X,H]=u.useState(""),[Y,V]=u.useState(!1),[I,F]=u.useState(null),D=u.useMemo(()=>!!I?.id,[I?.id]),L=u.useMemo(()=>`entity-secret-create-${e?.id||"new"}`,[e?.id]),B=u.useMemo(()=>G4(t),[t]),k=u.useCallback(()=>{m(""),p(""),g([]),S([])},[]),U=u.useCallback(()=>{M||(F(null),k(),P(""),H(""),V(!0))},[k,M]),R=u.useCallback(ne=>{if(!i||M||!ne)return;const we=ne.title??"",Pe=ne.content??"";m(we?String(we):""),p(Pe?String(Pe):""),g(lS(ne,"campaign_id")),S(lS(ne,"user_id")),N(Re=>{const Ce=Array.isArray(Re?.campaigns)?[...Re.campaigns]:[],it=Array.isArray(Re?.users)?[...Re.users]:[],qe=(ke,xt,Mt)=>{if(!xt)return;const Ct=String(xt);ke.some(At=>At?.value===Ct)||ke.push({value:Ct,label:Mt})};return(Array.isArray(ne.permissions)?ne.permissions:[]).forEach(ke=>{if(!ke)return;const xt=ke.user_id??ke.user?.id;if(xt){const Ct=ke.user?Gu(ke.user):`User ${String(xt).slice(0,8)}`;qe(it,xt,Ct)}const Mt=ke.campaign_id??ke.campaign?.id;if(Mt){const Ct=ke.campaign?.name?ke.campaign.name:`Campaign ${String(Mt).slice(0,8)}`;qe(Ce,Mt,Ct)}}),{campaigns:Ce,users:it}}),F(ne),P(""),H(""),V(!0)},[i,M]),q=u.useCallback(()=>{M||(V(!1),P(""),F(null),k())},[k,M]),G=u.useCallback(async()=>{if(!i||!r){N({campaigns:[],users:[]}),O(""),_(!1),T(!0);return}_(!0),O("");try{const[ne,we]=await Promise.all([_c({world_id:r}),Ds({world_id:r})]),Re=(Array.isArray(ne?.data)?ne.data:Array.isArray(ne)?ne:[]).map(We=>({value:String(We.id),label:We.name||"Untitled campaign"})),Ce=Array.isArray(we?.data)?we.data:Array.isArray(we)?we:[],it=[];Ce.forEach(We=>{const ke=We?.player||{},xt=ke.id||We?.user_id;xt&&it.push({value:String(xt),label:Gu(ke)})});const qe=ap(it,"value");N({campaigns:Re,users:qe}),T(!0)}catch(ne){console.error(" Failed to load secret visibility options",ne),N({campaigns:[],users:[]}),O(ne.message||"Failed to load share options"),T(!0)}finally{_(!1)}},[i,r]);u.useEffect(()=>{T(!1),N({campaigns:[],users:[]}),O("")},[r,i]),u.useEffect(()=>{!Y||E||G()},[Y,E,G]);const J=async ne=>{if(ne.preventDefault(),!e?.id||M)return;const we=h.trim();if(!we){P("Description is required."),H("");return}A(!0),P(""),H("");try{const Pe={summary:f.trim()||void 0,description:we,campaign_ids:y,user_ids:v};let Re;D&&I?.id?Re=await YR(e.id,I.id,Pe):Re=await VR(e.id,Pe);const Ce=Re?.data||Re;D&&I?.id?(c?.(Ce),H("Secret updated successfully.")):(l?.(Ce),H("Secret created successfully.")),k(),F(null),V(!1)}catch(Pe){P(Pe.message||"Failed to save secret")}finally{A(!1)}},ie=ne=>{if(!i||!Array.isArray(ne?.permissions))return null;const we=ne.permissions.map(Ce=>({...Ce})).filter(Ce=>Ce);if(we.length===0)return a.jsx("p",{className:"entity-secret-shared",children:"Not shared with any campaigns or users."});const Pe=ap(we.filter(Ce=>Ce.user_id||Ce.user),"user_id"),Re=ap(we.filter(Ce=>Ce.campaign_id||Ce.campaign),"campaign_id");return a.jsxs("div",{className:"entity-secret-shared",children:[Pe.length>0&&a.jsxs("div",{children:[a.jsx("strong",{children:"Shared with players:"}),a.jsx("ul",{className:"entity-secret-share-list",children:Pe.map(Ce=>{const it=Ce.user?Gu(Ce.user):`User ${String(Ce.user_id).slice(0,8)}`,qe=Ce.user_id||it;return a.jsx("li",{className:"entity-secret-share-pill",children:it},qe)})})]}),Re.length>0&&a.jsxs("div",{children:[a.jsx("strong",{children:"Shared with campaigns:"}),a.jsx("ul",{className:"entity-secret-share-list",children:Re.map(Ce=>{const it=Ce.campaign?.name||`Campaign ${String(Ce.campaign_id).slice(0,8)}`,qe=Ce.campaign_id||it;return a.jsx("li",{className:"entity-secret-share-pill",children:it},qe)})})]})]})},Z=D?"Edit secret":"Create a secret",me=D?"Update the secret content or who can access it.":"Secrets are hidden notes that are only visible to selected campaigns or players.",Q=D?"Update secret":"Save secret",ue=D?"Updating secret...":"Creating secret...";return a.jsxs("div",{className:"entity-tab-content",children:[i&&a.jsx(Yr,{isOpen:Y,onClose:q,title:Z,description:me,size:"lg",footerActions:a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{type:"button",className:"border border-neutral-300 bg-white px-4 py-2 rounded-md text-sm hover:bg-neutral-100 text-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",onClick:q,disabled:M,children:"Cancel"}),a.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-md text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",form:L,disabled:M,children:M?ue:Q})]}),children:a.jsxs("form",{id:L,className:"entity-secret-form-body",onSubmit:J,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-secret-summary",className:"text-sm font-medium text-neutral-700",children:"Summary"}),a.jsx("input",{id:"entity-secret-summary",type:"text",value:f,onChange:ne=>m(ne.target.value),placeholder:"Short label for this secret (optional)",disabled:M,"data-autofocus":"true",className:"w-full border rounded-md px-3 py-2 text-sm"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-secret-description",className:"text-sm font-medium text-neutral-700",children:"Description"}),a.jsx("textarea",{id:"entity-secret-description",value:h,onChange:ne=>p(ne.target.value),rows:4,placeholder:"Detail the secret information...",disabled:M,required:!0,className:"w-full border rounded-md px-3 py-2 text-sm min-h-[120px]"})]}),a.jsxs("div",{className:"entity-secret-share-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-secret-campaigns",className:"text-sm font-medium text-neutral-700",children:"Share with campaigns"}),a.jsx(Ts,{inputId:"entity-secret-campaigns",selected:y,options:w.campaigns,onChange:g,placeholder:"Select campaigns...",disabled:M||j,loading:j,noOptionsMessage:j?"Loading campaigns...":"No campaigns available in this world."}),a.jsx("p",{className:"help-text",children:"Dungeon Masters of selected campaigns will be able to read this secret."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-secret-users",className:"text-sm font-medium text-neutral-700",children:"Share with players"}),a.jsx(Ts,{inputId:"entity-secret-users",selected:v,options:w.users,onChange:S,placeholder:"Select users...",disabled:M||j,loading:j,noOptionsMessage:j?"Loading users...":"No eligible players found for this world."}),a.jsx("p",{className:"help-text",children:"Choose specific players who should see this information."})]})]}),C&&a.jsx("div",{className:"alert error",role:"alert",children:C}),z&&a.jsx("div",{className:"alert error",role:"alert",children:z})]})}),a.jsxs("section",{className:"entity-card entity-secret-list-card",children:[a.jsxs("div",{className:"entity-card-header entity-card-header--subtle",children:[a.jsxs("h2",{className:"entity-card-title",children:["Secrets for ",e?.name||"this entity"]}),i&&a.jsx("div",{className:"entity-card-actions",children:a.jsx("button",{type:"button",className:"btn submit",onClick:U,disabled:M,children:"New secret"})})]}),X&&a.jsx("div",{className:"alert success",role:"status",children:X}),B.length===0?a.jsx("p",{className:"entity-empty-state",children:"No secrets available for this entity yet."}):a.jsx("ul",{className:"entity-secret-list",children:B.map(ne=>{const we=ne.createdAt||ne.created_at,Pe=ne.updatedAt||ne.updated_at,Re=Gu(ne.creator);return a.jsxs("li",{className:"entity-secret-item",children:[a.jsxs("div",{className:"entity-secret-header",children:[a.jsx("h3",{children:ne.title||"Untitled secret"}),a.jsxs("div",{className:"entity-secret-meta",children:[Re&&a.jsxs("span",{children:["Created by ",Re]}),we&&a.jsxs("span",{children:["Created ",iS(we)]}),Pe&&Pe!==we&&a.jsxs("span",{children:["Updated ",iS(Pe)]})]})]}),i&&a.jsx("div",{className:"entity-secret-actions",children:a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>R(ne),disabled:M,children:"Edit secret"})}),ne.content?a.jsx("p",{className:"entity-secret-content",children:ne.content}):null,ie(ne)]},ne.id||ne.createdAt)})})]})]})}function K4(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function W4(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function Z4(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function Dd(e){return K4(e)||W4(e)||Z4()}function is(){return is=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},is.apply(this,arguments)}function Q4(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function J4(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function eD(e,t,r){return t&&J4(e.prototype,t),e}function un(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qp(e,t){return Qp=Object.setPrototypeOf||function(i,l){return i.__proto__=l,i},Qp(e,t)}function tD(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qp(e,t)}function jl(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?jl=function(r){return typeof r}:jl=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},jl(e)}function vd(e){return typeof Symbol=="function"&&jl(Symbol.iterator)==="symbol"?vd=function(r){return jl(r)}:vd=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":jl(r)},vd(e)}function nD(e,t){return t&&(vd(t)==="object"||typeof t=="function")?t:un(e)}function Id(e){return Id=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},Id(e)}function on(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var sp,oS;function aD(){if(oS)return sp;oS=1;var e=function(t,r,i,l,c,f,m,h){if(!t){var p;if(r===void 0)p=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var y=[i,l,c,f,m,h],g=0;p=new Error(r.replace(/%s/g,function(){return y[g++]})),p.name="Invariant Violation"}throw p.framesToPop=1,p}};return sp=e,sp}var sD=aD();const Ml=ki(sD);function rD(e){if(Array.isArray(e))return e}function iD(e,t){var r=[],i=!0,l=!1,c=void 0;try{for(var f=e[Symbol.iterator](),m;!(i=(m=f.next()).done)&&(r.push(m.value),!(t&&r.length===t));i=!0);}catch(h){l=!0,c=h}finally{try{!i&&f.return!=null&&f.return()}finally{if(l)throw c}}return r}function lD(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function Ld(e,t){return rD(e)||iD(e,t)||lD()}function oD(e,t){if(e==null)return{};var r={},i=Object.keys(e),l,c;for(c=0;c<i.length;c++)l=i[c],!(t.indexOf(l)>=0)&&(r[l]=e[l]);return r}function cD(e,t){if(e==null)return{};var r=oD(e,t),i,l;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(l=0;l<c.length;l++)i=c[l],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}var rp,cS;function uD(){if(cS)return rp;cS=1;function e(t,r,i){return r in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}return rp=e,rp}var dD=uD();const fc=ki(dD);var ip,uS;function fD(){if(uS)return ip;uS=1;function e(t){if(Array.isArray(t)){for(var r=0,i=new Array(t.length);r<t.length;r++)i[r]=t[r];return i}}return ip=e,ip}var lp,dS;function mD(){if(dS)return lp;dS=1;function e(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}return lp=e,lp}var op,fS;function hD(){if(fS)return op;fS=1;function e(){throw new TypeError("Invalid attempt to spread non-iterable instance")}return op=e,op}var cp,mS;function pD(){if(mS)return cp;mS=1;var e=fD(),t=mD(),r=hD();function i(l){return e(l)||t(l)||r()}return cp=i,cp}var yD=pD();const tr=ki(yD);var Ul=function(t){return t===Object(t)?Object.keys(t):[]},NN=function(t){return t===Object(t)?Object.values(t):[]};function EN(e,t){var r=Object.assign({},e);return xd(e)&&xd(t)&&Ul(t).forEach(function(i){xd(t[i])?i in e?r[i]=EN(e[i],t[i]):Object.assign(r,fc({},i,t[i])):Object.assign(r,fc({},i,t[i]))}),r}var Jp=function(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),l=1;l<r;l++)i[l-1]=arguments[l];return i.reduce(function(c,f){return EN(c,f)},t)},gD=function(t,r){var i=Object.assign({},t);if(r)for(var l=0;l<r.length;l++)delete i[r[l]];return i},xd=function(t){return t===Object(t)&&!(t instanceof Date)&&!Array.isArray(t)},bD=function(t){return(t||[]).filter(Boolean)},sg=function(t){return t[0]==="&"},vD=function(t){return!sg(t)},hS=function(t){return t.replace(/-(\w)/g,function(r,i){return i.toUpperCase()})},xD=function(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=Ul(t),l={},c=0,f=i.length;c<f;c+=1){var m=i[c],h=Object.prototype.toString.call(t[m])!=="[object Object]"||m[0]===":"||m[0]==="@"||r.indexOf(m)>=0;h&&(l[m]=t[m])}return l},jN=function(t,r){for(var i=r.map(hS),l=Ul(t),c={},f=0,m=l.length;f<m;f+=1){var h=l[f];(r.indexOf(h)>=0||i.indexOf(hS(h))>=0)&&(c[h]=t[h])}return c},SD=function e(t,r){for(var i=Jp.apply(void 0,[{},gD(t,r)].concat(tr(NN(jN(t,r))))),l=Ul(i).filter(sg),c=0,f=l.length;c<f;c+=1){var m=l[c],h=e(i[m],r);r.indexOf(m)>=0?(delete i[m],i=Jp({},i,h)):i[m]=h}return i};function pS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function yS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?pS(Object(r),!0).forEach(function(i){fc(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var wD=["animationName"],_N=function(t){var r=t.style,i=t.className;return yS(yS({},r?{style:xD(r,wD)}:{}),i?{className:i}:{})},CN=u.createContext(_N);CN.Provider;var AN=function(t){if(t){if(typeof t=="string")return[t];if(!Array.isArray(t)){var r=t;return Ul(t).reduce(function(i,l){return i.concat(r[l]?[l]:[])},[])}}else return[];return t},ND={},ED=function(t){return function(r,i){var l=i||ND;t.memoize=t.memoize||new WeakMap;var c;t.memoize.has(l)?c=t.memoize.get(l):(c={},t.memoize.set(l,c));var f=AN(r).join(" ");return f in c?c[f]:c[f]=t(r||[],i)}};function gS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function yl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gS(Object(r),!0).forEach(function(i){fc(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var jD=function(t){var r=t&&Ul(t)[0];return r&&r.split("__")[0].split("--")[0]},_D=function(t,r,i){if(t){var l=t.split(" ")[0],c=[].concat(tr(r.length===0?i.map(function(f){return"".concat(l,"--").concat(f.substring(1))}):[]),tr(r.map(function(f){return"".concat(l,"__").concat(f)})));return r.length===0?[t].concat(tr(c)):c}};function TN(e){var t=e.style,r=e.className,i=e.classNames,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_N,c=r||jD(i)||t?.className,f=typeof t=="function"?t:ED(function(g,v){var S=AN(g);Ml(Array.isArray(S),"First parameter must be a string, an array of strings, a plain object with boolean values, or a falsy value."),Ml(!v||xd(v),"Optional second parameter must be a plain object.");var w=S.filter(sg),N=S.filter(vD),j=N.length>0?function(O){return NN(jN(O,N))}:function(O){return[O]},_=function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return j(SD(E,w))},C=_D(c,N,w);return TN(yl(yl(yl({},(t||v)&&{style:Jp.apply(void 0,[{}].concat(tr(_(v)),tr(_(t))))}),C&&{className:C.join(" ")}),i&&{classNames:i}),l)}),m=yl({},typeof t=="function"?t:{style:t}),h=tr(new Set([].concat(tr(m.className?m.className.split(" "):[]),tr(c?c.split(" "):[])))),p=i?bD(h.map(function(g){return i[g]})):h,y=l(yl(yl({},m),p.length>0?{className:p.join(" ")}:{}));return Object.assign(f,y),f}function bS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function zo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?bS(Object(r),!0).forEach(function(i){fc(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var CD=function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return r.reduce(function(l,c){return zo(zo(zo({},l),typeof c=="function"?c:{}),{},{style:zo(zo({},l.style),typeof c=="function"?c.style:c)})},{})},rg=function(t,r,i){var l=r.style,c=r.className,f=r.classNames,m=u.useContext(CN),h=u.useMemo(function(){return TN({style:l,className:c,classNames:f},m)},[l,c,f,m]);return h(i,t)},Sd=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},As={id:"__id__",display:"__display__"},vS=function(t,r){Ml(r==="id"||r==="display",'Second arg must be either "id" or "display", got: "'.concat(r,'"'));var i=t.indexOf(As.display),l=t.indexOf(As.id);return i<0&&(i=null),l<0&&(l=null),Ml(i!==null||l!==null,"The markup '".concat(t,"' does not contain either of the placeholders '__id__' or '__display__'")),i!==null&&l!==null?r==="id"&&l<=i||r==="display"&&i<=l?0:1:0},AD=function(t){var r=/^\/(.+)\/(\w+)?$/;return new RegExp(t.map(function(i){var l=r.exec(i.toString()),c=Ld(l,3),f=c[1],m=c[2];return Ml(!m,"RegExp flags are not supported. Change /".concat(f,"/").concat(m," into /").concat(f,"/")),"(".concat(f,")")}).join("|"),"g")},MN=function(t){var r=0;return t.indexOf("__id__")>=0&&r++,t.indexOf("__display__")>=0&&r++,r},TD=function(){},Cc=function(t,r,i){for(var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:TD,c=AD(r.map(function(T){return T.regex})),f=2,m=r.map(function(T){var M=T.markup,A=f;return f+=MN(M)+1,A}),h,p=0,y=0;(h=c.exec(t))!==null;){var g=m.find(function(T){return!!h[T]}),v=m.indexOf(g),S=r[v],w=S.markup,N=S.displayTransform,j=g+vS(w,"id"),_=g+vS(w,"display"),C=h[j],O=N(C,h[_]),E=t.substring(p,h.index);l(E,p,y),y+=E.length,i(h[0],h.index,y,C,O,v,p),y+=O.length,p=c.lastIndex}p<t.length&&l(t.substring(p),p,y)},Ni=function(t,r){var i="";return Cc(t,r,function(l,c,f,m,h){i+=h},function(l){i+=l}),i},xa=function(t,r,i){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"START";if(typeof i!="number")return i;var c,f=function(p,y,g){c===void 0&&g+p.length>=i&&(c=y+i-g)},m=function(p,y,g,v,S,w,N){c===void 0&&g+S.length>i&&(l==="NULL"?c=null:c=y+(l==="END"?p.length:0))};return Cc(t,r,m,f),c===void 0?t.length:c},tc=function(t,r,i,l){return t.substring(0,r)+l+t.substring(i)},MD=function(t,r,i,l){var c=i.selectionStartBefore,f=i.selectionEndBefore,m=i.selectionEndAfter,h=Ni(t,l),p=h.length-r.length;c==="undefined"&&(c=m+p),f==="undefined"&&(f=c),c===f&&f===m&&h.length===r.length&&(c=c-1);var y=r.slice(c,m),g=Math.min(c,m),v=f;c===m&&(v=Math.max(f,c+p));var S=xa(t,l,g,"START"),w=xa(t,l,v,"END"),N=xa(t,l,g,"NULL"),j=xa(t,l,v,"NULL"),_=N===null||j===null,C=tc(t,S,w,y);if(!_){var O=Ni(C,l);if(O!==r){for(g=0;r[g]===O[g];)g++;y=r.slice(g,m),v=h.lastIndexOf(r.substring(m)),S=xa(t,l,g,"START"),w=xa(t,l,v,"END"),C=tc(t,S,w,y)}}return C},xS=function(t,r,i){var l=i,c=!1,f=function(h,p,y,g,v,S,w){y<=i&&y+v.length>i&&(l=y,c=!0)};if(Cc(t,r,f),c)return l},Ko=function(t,r){var i=[];return Cc(t,r,function(l,c,f,m,h,p,y){i.push({id:m,display:h,childIndex:p,index:c,plainTextIndex:f})}),i},RN=function(t,r){return"".concat(t,"-").concat(r)},Xu=function(t){return Object.values(t).reduce(function(r,i){var l=i.results;return r+l.length},0)},RD=function(t,r){var i=Ko(t,r),l=i[i.length-1];return l?l.plainTextIndex+l.display.length:0},kD=function(t){var r=Sd(t),i=t[t.indexOf(As.display)+As.display.length],l=t[t.indexOf(As.id)+As.id.length];return new RegExp(r.replace(As.display,"([^".concat(Sd(i||""),"]+?)")).replace(As.id,"([^".concat(Sd(l||""),"]+?)")))},Or=function(t){return u.Children.toArray(t).map(function(r){var i=r.props,l=i.markup,c=i.regex,f=i.displayTransform;return{markup:l,regex:c?DD(c,l):kD(l),displayTransform:f||function(m,h){return h||m}}})},DD=function(t,r){var i=new RegExp(t.toString()+"|").exec("").length-1,l=MN(r);return Ml(i===l,"Number of capturing groups in RegExp ".concat(t.toString()," (").concat(i,") does not match the number of placeholders in the markup '").concat(r,"' (").concat(l,")")),t},ID=function(t,r,i){return t.replace(As.id,r).replace(As.display,i)},LD=[{base:"A",letters:/(&#65;|&#9398;|&#65313;|&#192;|&#193;|&#194;|&#7846;|&#7844;|&#7850;|&#7848;|&#195;|&#256;|&#258;|&#7856;|&#7854;|&#7860;|&#7858;|&#550;|&#480;|&#196;|&#478;|&#7842;|&#197;|&#506;|&#461;|&#512;|&#514;|&#7840;|&#7852;|&#7862;|&#7680;|&#260;|&#570;|&#11375;|[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F])/g},{base:"AA",letters:/(&#42802;|[\uA732])/g},{base:"AE",letters:/(&#198;|&#508;|&#482;|[\u00C6\u01FC\u01E2])/g},{base:"AO",letters:/(&#42804;|[\uA734])/g},{base:"AU",letters:/(&#42806;|[\uA736])/g},{base:"AV",letters:/(&#42808;|&#42810;|[\uA738\uA73A])/g},{base:"AY",letters:/(&#42812;|[\uA73C])/g},{base:"B",letters:/(&#66;|&#9399;|&#65314;|&#7682;|&#7684;|&#7686;|&#579;|&#386;|&#385;|[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181])/g},{base:"C",letters:/(&#67;|&#9400;|&#65315;|&#262;|&#264;|&#266;|&#268;|&#199;|&#7688;|&#391;|&#571;|&#42814;|[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E])/g},{base:"D",letters:/(&#68;|&#9401;|&#65316;|&#7690;|&#270;|&#7692;|&#7696;|&#7698;|&#7694;|&#272;|&#395;|&#394;|&#393;|&#42873;|&#208;|[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779\u00D0])/g},{base:"DZ",letters:/(&#497;|&#452;|[\u01F1\u01C4])/g},{base:"Dz",letters:/(&#498;|&#453;|[\u01F2\u01C5])/g},{base:"E",letters:/(&#69;|&#9402;|&#65317;|&#200;|&#201;|&#202;|&#7872;|&#7870;|&#7876;|&#7874;|&#7868;|&#274;|&#7700;|&#7702;|&#276;|&#278;|&#203;|&#7866;|&#282;|&#516;|&#518;|&#7864;|&#7878;|&#552;|&#7708;|&#280;|&#7704;|&#7706;|&#400;|&#398;|[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E])/g},{base:"F",letters:/(&#70;|&#9403;|&#65318;|&#7710;|&#401;|&#42875;|[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B])/g},{base:"G",letters:/(&#71;|&#9404;|&#65319;|&#500;|&#284;|&#7712;|&#286;|&#288;|&#486;|&#290;|&#484;|&#403;|&#42912;|&#42877;|&#42878;|[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E])/g},{base:"H",letters:/(&#72;|&#9405;|&#65320;|&#292;|&#7714;|&#7718;|&#542;|&#7716;|&#7720;|&#7722;|&#294;|&#11367;|&#11381;|&#42893;|[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D])/g},{base:"I",letters:/(&#73;|&#9406;|&#65321;|&#204;|&#205;|&#206;|&#296;|&#298;|&#300;|&#304;|&#207;|&#7726;|&#7880;|&#463;|&#520;|&#522;|&#7882;|&#302;|&#7724;|&#407;|[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197])/g},{base:"J",letters:/(&#74;|&#9407;|&#65322;|&#308;|&#584;|[\u004A\u24BF\uFF2A\u0134\u0248])/g},{base:"K",letters:/(&#75;|&#9408;|&#65323;|&#7728;|&#488;|&#7730;|&#310;|&#7732;|&#408;|&#11369;|&#42816;|&#42818;|&#42820;|&#42914;|[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2])/g},{base:"L",letters:/(&#76;|&#9409;|&#65324;|&#319;|&#313;|&#317;|&#7734;|&#7736;|&#315;|&#7740;|&#7738;|&#321;|&#573;|&#11362;|&#11360;|&#42824;|&#42822;|&#42880;|[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780])/g},{base:"LJ",letters:/(&#455;|[\u01C7])/g},{base:"Lj",letters:/(&#456;|[\u01C8])/g},{base:"M",letters:/(&#77;|&#9410;|&#65325;|&#7742;|&#7744;|&#7746;|&#11374;|&#412;|[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C])/g},{base:"N",letters:/(&#78;|&#9411;|&#65326;|&#504;|&#323;|&#209;|&#7748;|&#327;|&#7750;|&#325;|&#7754;|&#7752;|&#544;|&#413;|&#42896;|&#42916;|&#330;|[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4\u014A])/g},{base:"NJ",letters:/(&#458;|[\u01CA])/g},{base:"Nj",letters:/(&#459;|[\u01CB])/g},{base:"O",letters:/(&#79;|&#9412;|&#65327;|&#210;|&#211;|&#212;|&#7890;|&#7888;|&#7894;|&#7892;|&#213;|&#7756;|&#556;|&#7758;|&#332;|&#7760;|&#7762;|&#334;|&#558;|&#560;|&#214;|&#554;|&#7886;|&#336;|&#465;|&#524;|&#526;|&#416;|&#7900;|&#7898;|&#7904;|&#7902;|&#7906;|&#7884;|&#7896;|&#490;|&#492;|&#216;|&#510;|&#390;|&#415;|&#42826;|&#42828;|[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C])/g},{base:"OE",letters:/(&#338;|[\u0152])/g},{base:"OI",letters:/(&#418;|[\u01A2])/g},{base:"OO",letters:/(&#42830;|[\uA74E])/g},{base:"OU",letters:/(&#546;|[\u0222])/g},{base:"P",letters:/(&#80;|&#9413;|&#65328;|&#7764;|&#7766;|&#420;|&#11363;|&#42832;|&#42834;|&#42836;|[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754])/g},{base:"Q",letters:/(&#81;|&#9414;|&#65329;|&#42838;|&#42840;|&#586;|[\u0051\u24C6\uFF31\uA756\uA758\u024A])/g},{base:"R",letters:/(&#82;|&#9415;|&#65330;|&#340;|&#7768;|&#344;|&#528;|&#530;|&#7770;|&#7772;|&#342;|&#7774;|&#588;|&#11364;|&#42842;|&#42918;|&#42882;|[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782])/g},{base:"S",letters:/(&#83;|&#9416;|&#65331;|&#7838;|&#346;|&#7780;|&#348;|&#7776;|&#352;|&#7782;|&#7778;|&#7784;|&#536;|&#350;|&#11390;|&#42920;|&#42884;|[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784])/g},{base:"T",letters:/(&#84;|&#9417;|&#65332;|&#7786;|&#356;|&#7788;|&#538;|&#354;|&#7792;|&#7790;|&#358;|&#428;|&#430;|&#574;|&#42886;|[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786])/g},{base:"TH",letters:/(&#222;|[\u00DE])/g},{base:"TZ",letters:/(&#42792;|[\uA728])/g},{base:"U",letters:/(&#85;|&#9418;|&#65333;|&#217;|&#218;|&#219;|&#360;|&#7800;|&#362;|&#7802;|&#364;|&#220;|&#475;|&#471;|&#469;|&#473;|&#7910;|&#366;|&#368;|&#467;|&#532;|&#534;|&#431;|&#7914;|&#7912;|&#7918;|&#7916;|&#7920;|&#7908;|&#7794;|&#370;|&#7798;|&#7796;|&#580;|[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244])/g},{base:"V",letters:/(&#86;|&#9419;|&#65334;|&#7804;|&#7806;|&#434;|&#42846;|&#581;|[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245])/g},{base:"VY",letters:/(&#42848;|[\uA760])/g},{base:"W",letters:/(&#87;|&#9420;|&#65335;|&#7808;|&#7810;|&#372;|&#7814;|&#7812;|&#7816;|&#11378;|[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72])/g},{base:"X",letters:/(&#88;|&#9421;|&#65336;|&#7818;|&#7820;|[\u0058\u24CD\uFF38\u1E8A\u1E8C])/g},{base:"Y",letters:/(&#89;|&#9422;|&#65337;|&#7922;|&#221;|&#374;|&#7928;|&#562;|&#7822;|&#376;|&#7926;|&#7924;|&#435;|&#590;|&#7934;|[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE])/g},{base:"Z",letters:/(&#90;|&#9423;|&#65338;|&#377;|&#7824;|&#379;|&#381;|&#7826;|&#7828;|&#437;|&#548;|&#11391;|&#11371;|&#42850;|[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762])/g},{base:"a",letters:/(&#97;|&#9424;|&#65345;|&#7834;|&#224;|&#225;|&#226;|&#7847;|&#7845;|&#7851;|&#7849;|&#227;|&#257;|&#259;|&#7857;|&#7855;|&#7861;|&#7859;|&#551;|&#481;|&#228;|&#479;|&#7843;|&#229;|&#507;|&#462;|&#513;|&#515;|&#7841;|&#7853;|&#7863;|&#7681;|&#261;|&#11365;|&#592;|[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250])/g},{base:"aa",letters:/(&#42803;|[\uA733])/g},{base:"ae",letters:/(&#230;|&#509;|&#483;|[\u00E6\u01FD\u01E3])/g},{base:"ao",letters:/(&#42805;|[\uA735])/g},{base:"au",letters:/(&#42807;|[\uA737])/g},{base:"av",letters:/(&#42809;|&#42811;|[\uA739\uA73B])/g},{base:"ay",letters:/(&#42813;|[\uA73D])/g},{base:"b",letters:/(&#98;|&#9425;|&#65346;|&#7683;|&#7685;|&#7687;|&#384;|&#387;|&#595;|[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253])/g},{base:"c",letters:/(&#99;|&#9426;|&#65347;|&#263;|&#265;|&#267;|&#269;|&#231;|&#7689;|&#392;|&#572;|&#42815;|&#8580;|[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184])/g},{base:"d",letters:/(&#100;|&#9427;|&#65348;|&#7691;|&#271;|&#7693;|&#7697;|&#7699;|&#7695;|&#273;|&#396;|&#598;|&#599;|&#42874;|&#240;|[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A\u00F0])/g},{base:"dz",letters:/(&#499;|&#454;|[\u01F3\u01C6])/g},{base:"e",letters:/(&#101;|&#9428;|&#65349;|&#232;|&#233;|&#234;|&#7873;|&#7871;|&#7877;|&#7875;|&#7869;|&#275;|&#7701;|&#7703;|&#277;|&#279;|&#235;|&#7867;|&#283;|&#517;|&#519;|&#7865;|&#7879;|&#553;|&#7709;|&#281;|&#7705;|&#7707;|&#583;|&#603;|&#477;|[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD])/g},{base:"f",letters:/(&#102;|&#9429;|&#65350;|&#7711;|&#402;|&#42876;|[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C])/g},{base:"g",letters:/(&#103;|&#9430;|&#65351;|&#501;|&#285;|&#7713;|&#287;|&#289;|&#487;|&#291;|&#485;|&#608;|&#42913;|&#7545;|&#42879;|[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F])/g},{base:"h",letters:/(&#104;|&#9431;|&#65352;|&#293;|&#7715;|&#7719;|&#543;|&#7717;|&#7721;|&#7723;|&#7830;|&#295;|&#11368;|&#11382;|&#613;|[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265])/g},{base:"hv",letters:/(&#405;|[\u0195])/g},{base:"i",letters:/(&#105;|&#9432;|&#65353;|&#236;|&#237;|&#238;|&#297;|&#299;|&#301;|&#239;|&#7727;|&#7881;|&#464;|&#521;|&#523;|&#7883;|&#303;|&#7725;|&#616;|&#305;|[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131])/g},{base:"ij",letters:/(&#307;|[\u0133])/g},{base:"j",letters:/(&#106;|&#9433;|&#65354;|&#309;|&#496;|&#585;|[\u006A\u24D9\uFF4A\u0135\u01F0\u0249])/g},{base:"k",letters:/(&#107;|&#9434;|&#65355;|&#7729;|&#489;|&#7731;|&#311;|&#7733;|&#409;|&#11370;|&#42817;|&#42819;|&#42821;|&#42915;|[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3])/g},{base:"l",letters:/(&#108;|&#9435;|&#65356;|&#320;|&#314;|&#318;|&#7735;|&#7737;|&#316;|&#7741;|&#7739;|&#322;|&#410;|&#619;|&#11361;|&#42825;|&#42881;|&#42823;|[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u0142\u019A\u026B\u2C61\uA749\uA781\uA747])/g},{base:"lj",letters:/(&#457;|[\u01C9])/g},{base:"m",letters:/(&#109;|&#9436;|&#65357;|&#7743;|&#7745;|&#7747;|&#625;|&#623;|[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F])/g},{base:"n",letters:/(&#110;|&#9437;|&#65358;|&#505;|&#324;|&#241;|&#7749;|&#328;|&#7751;|&#326;|&#7755;|&#7753;|&#414;|&#626;|&#329;|&#42897;|&#42917;|&#331;|[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5\u014B])/g},{base:"nj",letters:/(&#460;|[\u01CC])/g},{base:"o",letters:/(&#111;|&#9438;|&#65359;|&#242;|&#243;|&#244;|&#7891;|&#7889;|&#7895;|&#7893;|&#245;|&#7757;|&#557;|&#7759;|&#333;|&#7761;|&#7763;|&#335;|&#559;|&#561;|&#246;|&#555;|&#7887;|&#337;|&#466;|&#525;|&#527;|&#417;|&#7901;|&#7899;|&#7905;|&#7903;|&#7907;|&#7885;|&#7897;|&#491;|&#493;|&#248;|&#511;|&#596;|&#42827;|&#42829;|&#629;|[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275])/g},{base:"oe",letters:/(&#339;|[\u0153])/g},{base:"oi",letters:/(&#419;|[\u01A3])/g},{base:"ou",letters:/(&#547;|[\u0223])/g},{base:"oo",letters:/(&#42831;|[\uA74F])/g},{base:"p",letters:/(&#112;|&#9439;|&#65360;|&#7765;|&#7767;|&#421;|&#7549;|&#42833;|&#42835;|&#42837;|[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755])/g},{base:"q",letters:/(&#113;|&#9440;|&#65361;|&#587;|&#42839;|&#42841;|[\u0071\u24E0\uFF51\u024B\uA757\uA759])/g},{base:"r",letters:/(&#114;|&#9441;|&#65362;|&#341;|&#7769;|&#345;|&#529;|&#531;|&#7771;|&#7773;|&#343;|&#7775;|&#589;|&#637;|&#42843;|&#42919;|&#42883;|[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783])/g},{base:"s",letters:/(&#115;|&#9442;|&#65363;|&#347;|&#7781;|&#349;|&#7777;|&#353;|&#7783;|&#7779;|&#7785;|&#537;|&#351;|&#575;|&#42921;|&#42885;|&#7835;|&#383;|[\u0073\u24E2\uFF53\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B\u017F])/g},{base:"ss",letters:/(&#223;|[\u00DF])/g},{base:"t",letters:/(&#116;|&#9443;|&#65364;|&#7787;|&#7831;|&#357;|&#7789;|&#539;|&#355;|&#7793;|&#7791;|&#359;|&#429;|&#648;|&#11366;|&#42887;|[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787])/g},{base:"th",letters:/(&#254;|[\u00FE])/g},{base:"tz",letters:/(&#42793;|[\uA729])/g},{base:"u",letters:/(&#117;|&#9444;|&#65365;|&#249;|&#250;|&#251;|&#361;|&#7801;|&#363;|&#7803;|&#365;|&#252;|&#476;|&#472;|&#470;|&#474;|&#7911;|&#367;|&#369;|&#468;|&#533;|&#535;|&#432;|&#7915;|&#7913;|&#7919;|&#7917;|&#7921;|&#7909;|&#7795;|&#371;|&#7799;|&#7797;|&#649;|[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289])/g},{base:"v",letters:/(&#118;|&#9445;|&#65366;|&#7805;|&#7807;|&#651;|&#42847;|&#652;|[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C])/g},{base:"vy",letters:/(&#42849;|[\uA761])/g},{base:"w",letters:/(&#119;|&#9446;|&#65367;|&#7809;|&#7811;|&#373;|&#7815;|&#7813;|&#7832;|&#7817;|&#11379;|[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73])/g},{base:"x",letters:/(&#120;|&#9447;|&#65368;|&#7819;|&#7821;|[\u0078\u24E7\uFF58\u1E8B\u1E8D])/g},{base:"y",letters:/(&#121;|&#9448;|&#65369;|&#7923;|&#253;|&#375;|&#7929;|&#563;|&#7823;|&#255;|&#7927;|&#7833;|&#7925;|&#436;|&#591;|&#7935;|[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF])/g},{base:"z",letters:/(&#122;|&#9449;|&#65370;|&#378;|&#7825;|&#380;|&#382;|&#7827;|&#7829;|&#438;|&#549;|&#576;|&#11372;|&#42851;|[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763])/g}],OD=function(t){var r=t;return LD.forEach(function(i){r=r.replace(i.letters,i.base)}),r},SS=function(t){return OD(t).toLowerCase()},kN=function(t,r,i){return i?SS(t).indexOf(SS(r)):t.toLowerCase().indexOf(r.toLowerCase())},zD=function(){return!!document.documentMode},ey=function(t){return typeof t=="number"},$D=function(t){return t===Object(t)?Object.keys(t):[]},FD=function(t){for(var r,i=arguments.length,l=new Array(i>1?i-1:0),c=1;c<i;c++)l[c-1]=arguments[c];var f=(r=[]).concat.apply(r,l);return Object.keys(t).reduce(function(m,h){return t.hasOwnProperty(h)&&!f.includes(h)&&t[h]!==void 0&&(m[h]=t[h]),m},{})},BD=["style","className","classNames"];function wS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function NS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wS(Object(r),!0).forEach(function(i){on(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wS(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function vf(e,t){var r=function(l){var c=function(h){var p=h.style,y=h.className,g=h.classNames,v=cD(h,BD),S=t?t(v):void 0,w=rg(e,{style:p,className:y,classNames:g},S);return De.createElement(l,is({},v,{style:w}))},f=l.displayName||l.name||"Component";return c.displayName="defaultStyle(".concat(f,")"),De.forwardRef(function(m,h){return c(NS(NS({},m),{},{ref:h}))})};return r}var UD=function(t,r){return t.hasOwnProperty(r)?t[r]++:t[r]=0,r+"_"+t[r]};function DN(e){var t=e.selectionStart,r=e.selectionEnd,i=e.value,l=i===void 0?"":i,c=e.onCaretPositionChange,f=e.containerRef,m=e.children;e.singleLine;var h=e.style,p=u.useState({left:void 0,top:void 0}),y=Ld(p,2),g=y[0],v=y[1],S=u.useState(),w=Ld(S,2),N=w[0],j=w[1];u.useEffect(function(){_()});var _=function(){if(N){var I=N.offsetLeft,F=N.offsetTop;if(!(g.left===I&&g.top===F)){var D={left:I,top:F};v(D),c(D)}}},C=Or(m),O;r===t&&(O=xa(l,C,t,"START"));var E=[],T={},M=E,A=0,z=function(I,F,D){if(ey(O)&&O>=F&&O<=F+I.length){var L=O-F;M.push(X(I.substring(0,L),A)),M=[X(I.substring(L),A)]}else M.push(X(I,A));A++},P=function(I,F,D,L,B,k,U){var R=UD(T,L);M.push(H(L,B,k,R))},X=function(I,F){return De.createElement("span",is({},h("substring"),{key:F}),I)},H=function(I,F,D,L){var B={id:I,display:F,key:L},k=u.Children.toArray(m)[D];return De.cloneElement(k,B)},Y=function(I){return De.createElement("span",is({},h("caret"),{ref:j,key:"caret"}),I)};return Cc(l,C,P,z),M.push(" "),M!==E&&E.push(Y(M)),De.createElement("div",is({},h,{ref:f}),E)}DN.propTypes={selectionStart:wt.number,selectionEnd:wt.number,value:wt.string.isRequired,onCaretPositionChange:wt.func.isRequired,containerRef:wt.oneOfType([wt.func,wt.shape({current:typeof Element>"u"?wt.any:wt.instanceOf(Element)})]),children:wt.oneOfType([wt.element,wt.arrayOf(wt.element)]).isRequired};var qD=vf({position:"relative",boxSizing:"border-box",width:"100%",color:"transparent",overflow:"hidden",whiteSpace:"pre-wrap",wordWrap:"break-word",border:"1px solid transparent",textAlign:"start","&singleLine":{whiteSpace:"pre",wordWrap:null},substring:{visibility:"hidden"}},function(e){return{"&singleLine":e.singleLine}}),HD=qD(DN);function IN(e){var t=e.id,r=e.focused,i=e.ignoreAccents,l=e.index,c=e.onClick,f=e.onMouseEnter,m=e.query,h=e.renderSuggestion,p=e.suggestion,y=e.style;e.className,e.classNames;var g={onClick:c,onMouseEnter:f},v=function(){var j=S(),_=w(j);return h?h(p,m,_,l,r):_},S=function(){if(typeof p=="string")return p;var j=p.id,_=p.display;return j===void 0||!_?j:_},w=function(j){var _=kN(j,m,i);return _===-1?De.createElement("span",y("display"),j):De.createElement("span",y("display"),j.substring(0,_),De.createElement("b",y("highlight"),j.substring(_,_+m.length)),j.substring(_+m.length))};return De.createElement("li",is({id:t,role:"option","aria-selected":r},g,y),v())}IN.propTypes={id:wt.string.isRequired,query:wt.string.isRequired,index:wt.number.isRequired,ignoreAccents:wt.bool,suggestion:wt.oneOfType([wt.string,wt.shape({id:wt.oneOfType([wt.string,wt.number]).isRequired,display:wt.string})]).isRequired,renderSuggestion:wt.func,focused:wt.bool};var PD=vf({cursor:"pointer"},function(e){return{"&focused":e.focused}}),VD=PD(IN);function YD(e){var t=e.style,r=e.className,i=e.classNames,l=rg(GD,{style:t,className:r,classNames:i}),c=l("spinner");return De.createElement("div",l,De.createElement("div",c,De.createElement("div",c(["element","element1"])),De.createElement("div",c(["element","element2"])),De.createElement("div",c(["element","element3"])),De.createElement("div",c(["element","element4"])),De.createElement("div",c(["element","element5"]))))}var GD={};function LN(e){var t=e.id,r=e.suggestions,i=r===void 0?{}:r,l=e.a11ySuggestionsListLabel,c=e.focusIndex,f=e.position,m=e.left,h=e.right,p=e.top,y=e.scrollFocusedIntoView,g=e.isLoading,v=e.isOpened,S=e.onSelect,w=S===void 0?function(){return null}:S,N=e.ignoreAccents,j=e.containerRef,_=e.children,C=e.style,O=e.customSuggestionsContainer,E=e.onMouseDown,T=e.onMouseEnter,M=u.useState(void 0),A=Ld(M,2),z=A[0],P=A[1];u.useEffect(function(){if(!(!z||z.offsetHeight>=z.scrollHeight||!y)){var D=z.scrollTop,L=z.children[c].getBoundingClientRect(),B=L.top,k=L.bottom,U=z.getBoundingClientRect(),R=U.top;B=B-R+D,k=k-R+D,B<D?z.scrollTop=B:k>z.offsetHeight&&(z.scrollTop=k-z.offsetHeight)}},[c,y,z]);var X=function(){var L=De.createElement("ul",is({ref:P,id:t,role:"listbox","aria-label":l},C("list")),Object.values(i).reduce(function(B,k){var U=k.results,R=k.queryInfo;return[].concat(Dd(B),Dd(U.map(function(q,G){return H(q,R,B.length+G)})))},[]));return O?O(L):L},H=function(L,B,k){var U=k===c,R=B.childIndex,q=B.query,G=u.Children.toArray(_)[R].props.renderSuggestion;return De.createElement(VD,{style:C("item"),key:"".concat(R,"-").concat(F(L)),id:RN(t,k),query:q,index:k,ignoreAccents:N,renderSuggestion:G,suggestion:L,focused:U,onClick:function(){return I(L,B)},onMouseEnter:function(){return V(k)}})},Y=function(){if(g)return De.createElement(YD,{style:C("loadingIndicator")})},V=function(L,B){T&&T(L)},I=function(L,B){w(L,B)},F=function(L){return typeof L=="string"?L:L.id};return v?De.createElement("div",is({},CD({position:f||"absolute",left:m,right:h,top:p},C),{onMouseDown:E,ref:j}),X(),Y()):null}LN.propTypes={id:wt.string.isRequired,suggestions:wt.object.isRequired,a11ySuggestionsListLabel:wt.string,focusIndex:wt.number,position:wt.string,left:wt.number,right:wt.number,top:wt.number,scrollFocusedIntoView:wt.bool,isLoading:wt.bool,isOpened:wt.bool.isRequired,onSelect:wt.func,ignoreAccents:wt.bool,customSuggestionsContainer:wt.func,containerRef:wt.oneOfType([wt.func,wt.shape({current:typeof Element>"u"?wt.any:wt.instanceOf(Element)})])};var XD=vf({zIndex:1,backgroundColor:"white",marginTop:14,minWidth:100,list:{margin:0,padding:0,listStyleType:"none"}}),KD=XD(LN);function ES(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,i)}return r}function ds(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ES(Object(r),!0).forEach(function(i){on(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ES(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function WD(e){var t=ZD();return function(){var i=Id(e),l;if(t){var c=Id(this).constructor;l=Reflect.construct(i,arguments,c)}else l=i.apply(this,arguments);return nD(this,l)}}function ZD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var QD=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t instanceof RegExp)return t;var i=r.allowSpaceInQuery,l=Sd(t);return new RegExp("(?:^|\\s)(".concat(l,"([^").concat(i?"":"\\s").concat(l,"]*))$"))},JD=function(t,r){return t instanceof Array?function(i,l){for(var c=[],f=0,m=t.length;f<m;++f){var h=t[f].display||t[f].id;kN(h,i,r)>=0&&c.push(t[f])}return c}:t},gl={TAB:9,RETURN:13,ESC:27,UP:38,DOWN:40},Ku=!1,ON={singleLine:wt.bool,allowSpaceInQuery:wt.bool,allowSuggestionsAboveCursor:wt.bool,forceSuggestionsAboveCursor:wt.bool,ignoreAccents:wt.bool,a11ySuggestionsListLabel:wt.string,value:wt.string,onKeyDown:wt.func,customSuggestionsContainer:wt.func,onSelect:wt.func,onBlur:wt.func,onChange:wt.func,suggestionsPortalHost:typeof Element>"u"?wt.any:wt.PropTypes.instanceOf(Element),inputRef:wt.oneOfType([wt.func,wt.shape({current:typeof Element>"u"?wt.any:wt.instanceOf(Element)})]),children:wt.oneOfType([wt.element,wt.arrayOf(wt.element)]).isRequired},ig=(function(e){tD(r,e);var t=WD(r);function r(i){var l;return Q4(this,r),l=t.call(this,i),on(un(l),"setContainerElement",function(c){l.containerElement=c}),on(un(l),"getInputProps",function(){var c=l.props,f=c.readOnly,m=c.disabled,h=c.style,p=FD(l.props,["style","classNames","className"],$D(ON));return ds(ds(ds(ds({},p),h("input")),{},{value:l.getPlainText(),onScroll:l.updateHighlighterScroll},!f&&!m&&{onChange:l.handleChange,onSelect:l.handleSelect,onKeyDown:l.handleKeyDown,onBlur:l.handleBlur,onCompositionStart:l.handleCompositionStart,onCompositionEnd:l.handleCompositionEnd}),l.isOpened()&&{role:"combobox","aria-controls":l.uuidSuggestionsOverlay,"aria-expanded":!0,"aria-autocomplete":"list","aria-haspopup":"listbox","aria-activedescendant":RN(l.uuidSuggestionsOverlay,l.state.focusIndex)})}),on(un(l),"renderControl",function(){var c=l.props,f=c.singleLine,m=c.style,h=l.getInputProps();return De.createElement("div",m("control"),l.renderHighlighter(),f?l.renderInput(h):l.renderTextarea(h))}),on(un(l),"renderInput",function(c){return De.createElement("input",is({type:"text",ref:l.setInputRef},c))}),on(un(l),"renderTextarea",function(c){return De.createElement("textarea",is({ref:l.setInputRef},c))}),on(un(l),"setInputRef",function(c){l.inputElement=c;var f=l.props.inputRef;typeof f=="function"?f(c):f&&(f.current=c)}),on(un(l),"setSuggestionsElement",function(c){l.suggestionsElement=c}),on(un(l),"renderSuggestionsOverlay",function(){if(!ey(l.state.selectionStart))return null;var c=l.state.suggestionsPosition,f=c.position,m=c.left,h=c.top,p=c.right,y=De.createElement(KD,{id:l.uuidSuggestionsOverlay,style:l.props.style("suggestions"),position:f,left:m,top:h,right:p,focusIndex:l.state.focusIndex,scrollFocusedIntoView:l.state.scrollFocusedIntoView,containerRef:l.setSuggestionsElement,suggestions:l.state.suggestions,customSuggestionsContainer:l.props.customSuggestionsContainer,onSelect:l.addMention,onMouseDown:l.handleSuggestionsMouseDown,onMouseEnter:l.handleSuggestionsMouseEnter,isLoading:l.isLoading(),isOpened:l.isOpened(),ignoreAccents:l.props.ignoreAccents,a11ySuggestionsListLabel:l.props.a11ySuggestionsListLabel},l.props.children);return l.props.suggestionsPortalHost?x1.createPortal(y,l.props.suggestionsPortalHost):y}),on(un(l),"renderHighlighter",function(){var c=l.state,f=c.selectionStart,m=c.selectionEnd,h=l.props,p=h.singleLine,y=h.children,g=h.value,v=h.style;return De.createElement(HD,{containerRef:l.setHighlighterElement,style:v("highlighter"),value:g,singleLine:p,selectionStart:f,selectionEnd:m,onCaretPositionChange:l.handleCaretPositionChange},y)}),on(un(l),"setHighlighterElement",function(c){l.highlighterElement=c}),on(un(l),"handleCaretPositionChange",function(c){l.setState({caretPosition:c})}),on(un(l),"getPlainText",function(){return Ni(l.props.value||"",Or(l.props.children))}),on(un(l),"executeOnChange",function(c){for(var f=arguments.length,m=new Array(f>1?f-1:0),h=1;h<f;h++)m[h-1]=arguments[h];if(l.props.onChange){var p;return(p=l.props).onChange.apply(p,[c].concat(m))}if(l.props.valueLink){var y;return(y=l.props.valueLink).requestChange.apply(y,[c.target.value].concat(m))}}),on(un(l),"handleChange",function(c){if(Ku=!1,zD()){var f=document.activeElement&&document.activeElement.contentDocument||document;if(f.activeElement!==c.target)return}var m=l.props.value||"",h=Or(l.props.children),p=c.target.value,y=l.state.selectionStart;y==null&&(y=c.target.selectionStart);var g=l.state.selectionEnd;g==null&&(g=c.target.selectionEnd);var v=MD(m,p,{selectionStartBefore:y,selectionEndBefore:g,selectionEndAfter:c.target.selectionEnd},h);p=Ni(v,h);var S=c.target.selectionStart,w=c.target.selectionEnd,N=!1,j=xS(m,h,S);j!==void 0&&l.state.selectionEnd>j&&(S=j+(c.nativeEvent.data?c.nativeEvent.data.length:0),w=S,N=!0),l.setState({selectionStart:S,selectionEnd:w,setSelectionAfterMentionChange:N});var _=Ko(v,h);c.nativeEvent.isComposing&&S===w&&l.updateMentionsQueries(l.inputElement.value,S);var C={target:{value:v}};l.executeOnChange(C,v,p,_)}),on(un(l),"handleSelect",function(c){if(l.setState({selectionStart:c.target.selectionStart,selectionEnd:c.target.selectionEnd}),!Ku){var f=l.inputElement;c.target.selectionStart===c.target.selectionEnd?l.updateMentionsQueries(f.value,c.target.selectionStart):l.clearSuggestions(),l.updateHighlighterScroll(),l.props.onSelect(c)}}),on(un(l),"handleKeyDown",function(c){var f=Xu(l.state.suggestions);if(f===0||!l.suggestionsElement){l.props.onKeyDown(c);return}switch(Object.values(gl).indexOf(c.keyCode)>=0&&(c.preventDefault(),c.stopPropagation()),c.keyCode){case gl.ESC:{l.clearSuggestions();return}case gl.DOWN:{l.shiftFocus(1);return}case gl.UP:{l.shiftFocus(-1);return}case gl.RETURN:{l.selectFocused();return}case gl.TAB:{l.selectFocused();return}default:return}}),on(un(l),"shiftFocus",function(c){var f=Xu(l.state.suggestions);l.setState({focusIndex:(f+l.state.focusIndex+c)%f,scrollFocusedIntoView:!0})}),on(un(l),"selectFocused",function(){var c=l.state,f=c.suggestions,m=c.focusIndex,h=Object.values(f).reduce(function(g,v){var S=v.results,w=v.queryInfo;return[].concat(Dd(g),Dd(S.map(function(N){return{result:N,queryInfo:w}})))},[])[m],p=h.result,y=h.queryInfo;l.addMention(p,y),l.setState({focusIndex:0})}),on(un(l),"handleBlur",function(c){var f=l._suggestionsMouseDown;l._suggestionsMouseDown=!1,f||l.setState({selectionStart:null,selectionEnd:null}),window.setTimeout(function(){l.updateHighlighterScroll()},1),l.props.onBlur(c,f)}),on(un(l),"handleSuggestionsMouseDown",function(c){l._suggestionsMouseDown=!0}),on(un(l),"handleSuggestionsMouseEnter",function(c){l.setState({focusIndex:c,scrollFocusedIntoView:!1})}),on(un(l),"updateSuggestionsPosition",function(){var c=l.state.caretPosition,f=l.props,m=f.suggestionsPortalHost,h=f.allowSuggestionsAboveCursor,p=f.forceSuggestionsAboveCursor;if(!(!c||!l.suggestionsElement)){var y=l.suggestionsElement,g=l.highlighterElement,v=g.getBoundingClientRect(),S=up(g,"font-size"),w={left:v.left+c.left,top:v.top+c.top+S},N=Math.max(document.documentElement.clientHeight,window.innerHeight||0);if(y){var j={};if(m){j.position="fixed";var _=w.left,C=w.top;_-=up(y,"margin-left"),C-=up(y,"margin-top"),_-=g.scrollLeft,C-=g.scrollTop;var O=Math.max(document.documentElement.clientWidth,window.innerWidth||0);_+y.offsetWidth>O?j.left=Math.max(0,O-y.offsetWidth):j.left=_,h&&C+y.offsetHeight>N&&y.offsetHeight<C-S||p?j.top=Math.max(0,C-y.offsetHeight-S):j.top=C}else{var E=c.left-g.scrollLeft,T=c.top-g.scrollTop;E+y.offsetWidth>l.containerElement.offsetWidth?j.right=0:j.left=E,h&&w.top-g.scrollTop+y.offsetHeight>N&&y.offsetHeight<v.top-S-g.scrollTop||p?j.top=T-y.offsetHeight-S:j.top=T}j.left===l.state.suggestionsPosition.left&&j.top===l.state.suggestionsPosition.top&&j.position===l.state.suggestionsPosition.position||l.setState({suggestionsPosition:j})}}}),on(un(l),"updateHighlighterScroll",function(){var c=l.inputElement,f=l.highlighterElement;!c||!f||(f.scrollLeft=c.scrollLeft,f.scrollTop=c.scrollTop,f.height=c.height)}),on(un(l),"handleCompositionStart",function(){Ku=!0}),on(un(l),"handleCompositionEnd",function(){Ku=!1}),on(un(l),"setSelection",function(c,f){if(!(c===null||f===null)){var m=l.inputElement;if(m.setSelectionRange)m.setSelectionRange(c,f);else if(m.createTextRange){var h=m.createTextRange();h.collapse(!0),h.moveEnd("character",f),h.moveStart("character",c),h.select()}}}),on(un(l),"updateMentionsQueries",function(c,f){l._queryId++,l.suggestions={},l.setState({suggestions:{}});var m=l.props.value||"",h=l.props.children,p=Or(h),y=xa(m,p,f,"NULL");if(y!==null){var g=RD(m.substring(0,y),p),v=c.substring(g,f);De.Children.forEach(h,function(S,w){if(S){var N=QD(S.props.trigger,l.props),j=v.match(N);if(j){var _=g+v.indexOf(j[1],j.index);l.queryData(j[2],w,_,_+j[1].length,c)}}})}}),on(un(l),"clearSuggestions",function(){l._queryId++,l.suggestions={},l.setState({suggestions:{},focusIndex:0})}),on(un(l),"queryData",function(c,f,m,h,p){var y=l.props,g=y.children,v=y.ignoreAccents,S=u.Children.toArray(g)[f],w=JD(S.props.data,v),N=w(c,l.updateSuggestions.bind(null,l._queryId,f,c,m,h,p));N instanceof Array&&l.updateSuggestions(l._queryId,f,c,m,h,p,N)}),on(un(l),"updateSuggestions",function(c,f,m,h,p,y,g){if(c===l._queryId){l.suggestions=ds(ds({},l.suggestions),{},on({},f,{queryInfo:{childIndex:f,query:m,querySequenceStart:h,querySequenceEnd:p,plainTextValue:y},results:g}));var v=l.state.focusIndex,S=Xu(l.suggestions);l.setState({suggestions:l.suggestions,focusIndex:v>=S?Math.max(S-1,0):v})}}),on(un(l),"addMention",function(c,f){var m=c.id,h=c.display,p=f.childIndex,y=f.querySequenceStart,g=f.querySequenceEnd,v=f.plainTextValue,S=l.props.value||"",w=Or(l.props.children),N=u.Children.toArray(l.props.children)[p],j=N.props,_=j.markup,C=j.displayTransform,O=j.appendSpaceOnAdd,E=j.onAdd,T=xa(S,w,y,"START"),M=T+g-y,A=ID(_,m,h);O&&(A+=" ");var z=tc(S,T,M,A);l.inputElement.focus();var P=C(m,h);O&&(P+=" ");var X=y+P.length;l.setState({selectionStart:X,selectionEnd:X,setSelectionAfterMentionChange:!0});var H={target:{value:z}},Y=Ko(z,w),V=tc(v,y,g,P);l.executeOnChange(H,z,V,Y),E&&E(m,h,T,M),l.clearSuggestions()}),on(un(l),"isLoading",function(){var c=!1;return De.Children.forEach(l.props.children,function(f){c=c||f&&f.props.isLoading}),c}),on(un(l),"isOpened",function(){return ey(l.state.selectionStart)&&(Xu(l.state.suggestions)!==0||l.isLoading())}),on(un(l),"_queryId",0),l.suggestions={},l.uuidSuggestionsOverlay=Math.random().toString(16).substring(2),l.handleCopy=l.handleCopy.bind(un(l)),l.handleCut=l.handleCut.bind(un(l)),l.handlePaste=l.handlePaste.bind(un(l)),l.state={focusIndex:0,selectionStart:null,selectionEnd:null,suggestions:{},caretPosition:null,suggestionsPosition:{},setSelectionAfterHandlePaste:!1},l}return eD(r,[{key:"componentDidMount",value:function(){document.addEventListener("copy",this.handleCopy),document.addEventListener("cut",this.handleCut),document.addEventListener("paste",this.handlePaste),this.updateSuggestionsPosition()}},{key:"componentDidUpdate",value:function(l,c){c.suggestionsPosition===this.state.suggestionsPosition&&this.updateSuggestionsPosition(),this.state.setSelectionAfterMentionChange&&(this.setState({setSelectionAfterMentionChange:!1}),this.setSelection(this.state.selectionStart,this.state.selectionEnd)),this.state.setSelectionAfterHandlePaste&&(this.setState({setSelectionAfterHandlePaste:!1}),this.setSelection(this.state.selectionStart,this.state.selectionEnd))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("copy",this.handleCopy),document.removeEventListener("cut",this.handleCut),document.removeEventListener("paste",this.handlePaste)}},{key:"render",value:function(){return De.createElement("div",is({ref:this.setContainerElement},this.props.style),this.renderControl(),this.renderSuggestionsOverlay())}},{key:"handlePaste",value:function(l){if(l.target===this.inputElement&&this.supportsClipboardActions(l)){l.preventDefault();var c=this.state,f=c.selectionStart,m=c.selectionEnd,h=this.props,p=h.value,y=h.children,g=Or(y),v=xa(p,g,f,"START"),S=xa(p,g,m,"END"),w=l.clipboardData.getData("text/react-mentions"),N=l.clipboardData.getData("text/plain"),j=tc(p,v,S,w||N).replace(/\r/g,""),_=Ni(j,g),C={target:ds(ds({},l.target),{},{value:j})};this.executeOnChange(C,j,_,Ko(j,g));var O=xS(p,g,f),E=(O||f)+Ni(w||N,g).length;this.setState({selectionStart:E,selectionEnd:E,setSelectionAfterHandlePaste:!0})}}},{key:"saveSelectionToClipboard",value:function(l){var c=this.inputElement.selectionStart,f=this.inputElement.selectionEnd,m=this.props,h=m.children,p=m.value,y=Or(h),g=xa(p,y,c,"START"),v=xa(p,y,f,"END");l.clipboardData.setData("text/plain",l.target.value.slice(c,f)),l.clipboardData.setData("text/react-mentions",p.slice(g,v))}},{key:"supportsClipboardActions",value:function(l){return!!l.clipboardData}},{key:"handleCopy",value:function(l){l.target===this.inputElement&&this.supportsClipboardActions(l)&&(l.preventDefault(),this.saveSelectionToClipboard(l))}},{key:"handleCut",value:function(l){if(l.target===this.inputElement&&this.supportsClipboardActions(l)){l.preventDefault(),this.saveSelectionToClipboard(l);var c=this.state,f=c.selectionStart,m=c.selectionEnd,h=this.props,p=h.children,y=h.value,g=Or(p),v=xa(y,g,f,"START"),S=xa(y,g,m,"END"),w=[y.slice(0,v),y.slice(S)].join(""),N=Ni(w,g),j={target:ds(ds({},l.target),{},{value:N})};this.executeOnChange(j,w,N,Ko(y,g))}}}]),r})(De.Component);on(ig,"propTypes",ON);on(ig,"defaultProps",{ignoreAccents:!1,singleLine:!1,allowSuggestionsAboveCursor:!1,onKeyDown:function(){return null},onSelect:function(){return null},onBlur:function(){return null}});var up=function(t,r){var i=parseFloat(window.getComputedStyle(t,null).getPropertyValue(r));return isFinite(i)?i:0},eI=typeof navigator<"u"&&/iPhone|iPad|iPod/i.test(navigator.userAgent),tI=vf({position:"relative",overflowY:"visible",input:{display:"block",width:"100%",position:"absolute",margin:0,top:0,left:0,boxSizing:"border-box",backgroundColor:"transparent",fontFamily:"inherit",fontSize:"inherit",letterSpacing:"inherit"},"&multiLine":{input:ds({height:"100%",bottom:0,overflow:"hidden",resize:"none"},eI?{marginTop:1,marginLeft:-3}:null)}},function(e){var t=e.singleLine;return{"&singleLine":t,"&multiLine":!t}}),nI=tI(ig),aI={fontWeight:"inherit"},Rl=function(t){var r=t.display,i=t.style,l=t.className,c=t.classNames,f=rg(aI,{style:i,className:l,classNames:c});return De.createElement("strong",f,r)};Rl.propTypes={onAdd:wt.func,onRemove:wt.func,renderSuggestion:wt.func,trigger:wt.oneOfType([wt.string,wt.instanceOf(RegExp)]),markup:wt.string,displayTransform:wt.func,allowSpaceInQuery:wt.bool,isLoading:wt.bool};Rl.defaultProps={trigger:"@",markup:"@[__display__](__id__)",displayTransform:function(t,r){return r||t},onAdd:function(){return null},onRemove:function(){return null},renderSuggestion:null,isLoading:!1,appendSpaceOnAdd:!1};function Od({inputProps:e,...t}){const r=u.useRef(null);return u.useEffect(()=>{if(!r.current||!e)return;const i=()=>{const l=r.current?.querySelector("textarea");return l?(Object.entries(e).forEach(([c,f])=>{if(f!=null)if(c==="className"){const m=l.className||"";l.className=m?`${m} ${f}`.trim():f}else if(c.startsWith("data-")||c.startsWith("aria-"))l.setAttribute(c,String(f));else if(c==="rows")l.setAttribute("rows",String(f));else if(c==="required")l.required=!!f;else if(c==="id")l.id=String(f);else try{typeof f=="boolean"?f?l.setAttribute(c,""):l.removeAttribute(c):l[c]=f}catch{try{l.setAttribute(c,String(f))}catch{}}}),!0):!1};if(!i()){const l=setTimeout(()=>{i()},10);return()=>clearTimeout(l)}},[e]),a.jsx("div",{ref:r,children:a.jsx(nI,{...t})})}const sI=/\s*\(([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\)$/i,rI=/\(([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\)/gi,kl=e=>{if(!e)return"";let t=String(e).trim();return t=t.replace(sI,"").trim(),t=t.replace(rI,"").trim(),t},mc=(e="",t=[])=>{const r=typeof e=="string"?e:"";if(!r)return[];const i=Array.isArray(t)?t:[],l=new Map;i.forEach(p=>{if(!p)return;const y=p.entityId??p.entity_id??p.id??p.entityID??null;if(!y)return;const g=String(y);if(l.has(g))return;const v=p.entityName??p.entity_name??p.label??p.name,S=v?kl(v):"";l.set(g,{entityId:g,entityName:S})});const c=[],f=/@\[(.+?)]\(([^)]+)\)/g;let m=0,h;for(;(h=f.exec(r))!==null;){h.index>m&&c.push({type:"text",text:r.slice(m,h.index)});const p=String(h[2]),y=h[1],g=kl(y)||String(y??""),v=l.get(p)||{entityId:p,entityName:g};c.push({type:"mention",...v}),m=f.lastIndex}return m<r.length&&c.push({type:"text",text:r.slice(m)}),c},iI={private:"Private",companions:"Shared with companions",dm:"Shared with DM",party:"Share with Party"},lI=[{value:"private",label:"Private"},{value:"companions",label:"My Companions"}],oI=[{value:"private",label:"Private"},{value:"party",label:"Share with Party"}],dp=e=>{if(!e)return"";if(e instanceof Date){if(Number.isNaN(e.getTime()))return"";try{return e.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.warn("Unable to format Date object",t,e),""}}if(typeof e=="string"||typeof e=="number")try{const t=new Date(e);return Number.isNaN(t.getTime())?(console.warn("Invalid date value:",e),""):t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.warn("Unable to parse date value",t,e),""}return console.warn("Unexpected date value type:",typeof e,e),""},fp=e=>e?.author?.username||e?.author?.name||e?.author?.email||e?.author_name||e?.author_email||"Unknown adventurer",jS=e=>{const t=e?.author||{},r=t?.id??t?.authorId??e?.authorId??e?.author_id??e?.authorID;if(r!=null)return`id:${String(r)}`;const i=t?.email??e?.author_email;if(i)return`email:${String(i).toLowerCase()}`;const l=t?.username??t?.name??e?.author_username??e?.author_name;return l?`name:${String(l).toLowerCase()}`:"unknown"},ba=Object.freeze([]),_S="What do you want to remember?";function zN({entity:e,worldId:t,selectedCampaign:r,selectedCampaignId:i,isCampaignDm:l,isCampaignPlayer:c,canCreateNote:f,notes:m=ba,loading:h,error:p,onCreateNote:y,creating:g,campaignMatchesEntityWorld:v,onNoteUpdate:S,onNoteDelete:w}){const{user:N}=En(),[j,_]=u.useState(""),[C,O]=u.useState("private"),[E,T]=u.useState(""),[M,A]=u.useState(ba),[z,P]=u.useState(!1),[X,H]=u.useState(""),[Y,V]=u.useState(""),[I,F]=u.useState(""),[D,L]=u.useState(!1),[B,k]=u.useState("all"),[U,R]=u.useState("notes"),[q,G]=u.useState("entity"),[J,ie]=u.useState(null),[Z,me]=u.useState(""),[Q,ue]=u.useState("private"),[ne,we]=u.useState(""),[Pe,Re]=u.useState(!1),[Ce,it]=u.useState(null),[qe,We]=u.useState({items:ba,loading:!1,error:"",loaded:!1}),[ke,xt]=u.useState({items:ba,loading:!1,error:"",loaded:!1}),[Mt,Ct]=u.useState(()=>new Set),At=!!i&&!!f&&!!v,He=u.useMemo(()=>l?oI:lI,[l]),Qe=u.useMemo(()=>t||e&&typeof e=="object"&&((e.world||{}).id||e.world_id)||"",[e,t]),W=u.useCallback(ae=>{if(!N||!ae)return!1;const Xe=ae?.author?.id??ae?.createdBy??ae?.created_by??ae?.authorId??ae?.author_id??null;return Xe?String(Xe)===String(N.id):!1},[N]),ee=u.useCallback((ae,Xe)=>{const $e=typeof Xe=="string"?Xe:typeof ae?.target?.value=="string"?ae.target.value:"";_($e),V("")},[]),te=u.useCallback(async(ae,Xe)=>{const $e=ae?.trim()??"";if(typeof Xe=="function"){if(!Qe||$e.length===0){Xe([]);return}try{const Je=await of({worldId:Qe,query:$e,limit:8}),bt=Array.isArray(Je?.data)?Je.data:Je,St=Array.isArray(bt)?bt.map(_e=>{const tt=_e?.id??_e?.entity?.id;if(!tt)return null;const mt=_e?.name||_e?.displayName||_e?.entity?.name||"Unnamed entity",fe=kl(mt)||"Unnamed entity";return{id:tt,display:fe}}).filter(Boolean):[];Xe(St)}catch(Je){console.error("Failed to search entities for mentions",Je),Xe([])}}},[Qe]),ve=u.useCallback(()=>{L(!1),V(""),F("")},[]),le=u.useCallback(()=>{At&&(V(""),F(""),L(!0))},[At]),Se=u.useCallback(async ae=>{if(ae.preventDefault(),!At||!y)return;const Xe=j.trim();if(!Xe){V("Please enter a note before saving");return}if(c&&!E){V("Select which character this note is for");return}V(""),F("");try{const $e={content:Xe,shareType:C,campaignId:i};c&&($e.characterId=E);const Je=await y($e);if(!Je||Je.success!==!0){V(Je?.message||"Failed to save note");return}_(""),c||T(""),ve()}catch($e){console.error("Failed to submit note",$e),V($e.message||"Failed to save note")}},[At,j,y,C,i,c,E,ve]),Ee=u.useCallback(ae=>{if(!ae||!e?.id)return;const Xe=ae?.characterId??ae?.character_id??"";ie(ae.id),me(ae?.content??""),ue(ae?.shareType??ae?.share_type??"private"),we(Xe),V("")},[e?.id]),ge=u.useCallback(()=>{ie(null),me(""),ue("private"),we(""),V("")},[]),at=u.useCallback((ae,Xe)=>{const $e=typeof Xe=="string"?Xe:typeof ae?.target?.value=="string"?ae.target.value:"";me($e),V("")},[]),st=u.useCallback(async ae=>{if(!ae||!e?.id||!i)return;const Xe=Z.trim();if(!Xe){V("Please enter a note before saving");return}const $e=ae?.characterId??ae?.character_id??"";if(c&&$e&&!ne){V("Select which character this note is for");return}Re(!0),V("");try{const Je={content:Xe,shareType:Q,campaignId:i};c&&ne&&(Je.characterId=ne);const bt=await G1(e.id,ae.id,Je),St=bt?.data||bt;if(!St)throw new Error("Note could not be updated");S&&await S(St),ge()}catch(Je){console.error("Failed to update note",Je),V(Je.message||"Failed to update note")}finally{Re(!1)}},[e?.id,i,Z,Q,ne,c,S,ge]),nt=u.useCallback(async ae=>{if(!(!ae?.id||!e?.id||!i||!window.confirm("Are you sure you want to delete this note? This action cannot be undone."))){it(ae.id),V("");try{await X1(e.id,ae.id,{campaignId:i}),w&&await w(ae.id)}catch($e){console.error("Failed to delete note",$e),V($e.message||"Failed to delete note")}finally{it(null)}}},[e?.id,i,w]),ze=u.useMemo(()=>{const ae=Array.isArray(m)?m:ba;return ae.length<=1?ae:[...ae].sort((Xe,$e)=>{const Je=new Date(Xe?.createdAt??Xe?.created_at??0).getTime(),bt=new Date($e?.createdAt??$e?.created_at??0).getTime();return Number.isNaN(Je)||Number.isNaN(bt)?0:bt-Je})},[m]),ft=u.useMemo(()=>{const ae=[{value:"all",label:"All notes"}],Xe=new Set(["all"]);return ze.forEach($e=>{const Je=jS($e);!Je||Xe.has(Je)||(Xe.add(Je),ae.push({value:Je,label:fp($e)}))}),ae},[ze]),zt=u.useMemo(()=>B==="all"?ze:ze.filter(ae=>jS(ae)===B),[B,ze]),Rt=u.useMemo(()=>Array.isArray(qe.items)?qe.items:ba,[qe.items]),pt=u.useMemo(()=>Array.isArray(ke.items)?ke.items:ba,[ke.items]);u.useEffect(()=>{O("private")},[l,i]),u.useEffect(()=>{ft.some(ae=>ae.value===B)||k("all")},[ft,B]),u.useEffect(()=>{We({items:ba,loading:!1,error:"",loaded:!1}),xt({items:ba,loading:!1,error:"",loaded:!1}),Ct(new Set),G("entity")},[i,e?.id,v]),u.useEffect(()=>{let ae=!1;return!c||!i?(A(ba),P(!1),H(""),T(""),()=>{ae=!0}):((async()=>{P(!0),H("");try{const $e=await Ds({scope:"my",campaign_id:i});if(ae)return;const bt=(Array.isArray($e?.data)?$e.data:Array.isArray($e)?$e:[]).map(St=>({id:St?.id?String(St.id):"",name:St?.name||"Unnamed character"})).filter(St=>St.id);A(bt),bt.length===1?T(bt[0].id):bt.some(St=>St.id===E)||T("")}catch($e){if(ae)return;console.error("Failed to load characters for notes",$e),A(ba),T(""),H($e.message||"Failed to load characters")}finally{ae||P(!1)}})(),()=>{ae=!0})},[c,i,E]);const ct=u.useCallback(async()=>{if(!(!e?.id||!i||!v)){We(ae=>({...ae,loading:!0,error:""}));try{const ae=await XR(e.id,{campaignId:i}),Xe=Array.isArray(ae?.data)?ae.data:Array.isArray(ae)?ae:ba;We({items:Xe,loading:!1,error:"",loaded:!0})}catch(ae){We({items:ba,loading:!1,error:ae?.message||"Failed to load mentions",loaded:!0})}}},[v,e?.id,i]),yt=u.useCallback(async()=>{if(!(!e?.id||!i||!v)){xt(ae=>({...ae,loading:!0,error:""}));try{const ae=await KR(e.id,{campaignId:i}),Xe=Array.isArray(ae?.data)?ae.data:Array.isArray(ae)?ae:ba;xt({items:Xe,loading:!1,error:"",loaded:!0})}catch(ae){xt({items:ba,loading:!1,error:ae?.message||"Failed to load mentions",loaded:!0})}}},[v,e?.id,i]);u.useEffect(()=>{U==="mentions"&&(!qe.loading&&!qe.loaded&&ct(),!ke.loading&&!ke.loaded&&yt())},[U,qe.loading,qe.loaded,ke.loading,ke.loaded,ct,yt]);const Tt=u.useCallback(ae=>{const Xe=mc(ae?.content,ae?.mentions);if(!Xe.length)return"";const $e=Xe.map(Je=>Je.type==="mention"?`@${Je.entityName||"entity"}`:Je.text||"").join("").replace(/\s+/g," ").trim();return $e.length<=180?$e:`${$e.slice(0,177)}`},[]),Ft=u.useCallback(ae=>{const Xe=ae?.sessionDate??ae?.session_date;if(!Xe)return"";try{const $e=new Date(Xe);if(!Number.isNaN($e.getTime()))return $e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch($e){return console.warn("Unable to format session date",$e),Xe}return Xe},[]),kt=u.useCallback(ae=>{const Xe=String(ae);Ct($e=>{const Je=new Set($e);return Je.has(Xe)?Je.delete(Xe):Je.add(Xe),Je})},[]),Zt=u.useCallback(ae=>Mt.has(String(ae)),[Mt]),Lt=u.useCallback(()=>{!e?.id||!i||!v||(q==="entity"?ct():yt())},[v,e?.id,ct,yt,q,i]),Kt=u.useCallback(ae=>{const Xe=mc(ae?.content,ae?.mentions);return Xe.length?Xe.map(($e,Je)=>{if($e.type==="mention"&&$e.entityId){const bt=`${ae?.id||"note"}-mention-${Je}`,St=$e.entityName||"entity";return a.jsxs("span",{className:"entity-note-mention",children:["@",St,a.jsx(Is,{entityId:$e.entityId,entityName:St})]},bt)}return a.jsx("span",{className:"entity-note-text",children:$e.text},`${ae?.id||"note"}-text-${Je}`)}):null},[]);u.useCallback(ae=>`entity-note-share entity-note-share-${ae}`,[]);const se=Rt.length,be=pt.length,je=qe.loading,Ze=ke.loading,dt=qe.error,gt=ke.error,oe=qe.loaded,re=ke.loaded,Ne=!i||!v||(q==="entity"?je:Ze),Be=c&&At,Ke=Be&&M.length===1,ot=g,Oe=g||!j.trim()||c&&!E,ce=ze.length===0||ft.length<=1;u.useEffect(()=>{(U!=="notes"||!At)&&D&&ve()},[U,At,D,ve]);const Ue=r?.name||"",Ge=u.useCallback(ae=>{const Xe=fp(ae),$e=ae?.character?.name||"";return $e?`${Xe} (as ${$e})`:Xe},[]),ut=u.useCallback(ae=>{const Xe=String(ae?.shareType??ae?.share_type??"private");return iI[Xe]||"Private"},[]);return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"entity-notes-card-strict",children:[a.jsxs("div",{className:"entity-notes-header-row",children:[a.jsx("h2",{className:"entity-notes-title",children:"Notes"}),U==="notes"&&At?a.jsx("button",{type:"button",className:"btn-primary",onClick:le,disabled:g,children:"+ Create note"}):null]}),r?.name?a.jsxs("p",{className:"entity-notes-campaign-line",children:["Campaign: ",Ue]}):null,a.jsxs("div",{className:"entity-notes-tabs-row",children:[a.jsx("button",{type:"button",className:`entity-notes-strict-tab-button${U==="notes"?" active":""}`,onClick:()=>R("notes"),children:"Notes"}),a.jsx("button",{type:"button",className:`entity-notes-strict-tab-button${U==="mentions"?" active":""}`,onClick:()=>R("mentions"),children:"@Mentions"})]}),U==="notes"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"entity-notes-strict-filter",children:[a.jsx("span",{className:"entity-notes-strict-filter-label",children:"Show notes from"}),a.jsx("select",{className:"entity-notes-strict-filter-select",value:B,onChange:ae=>k(ae.target.value),disabled:ce,children:ft.map(ae=>a.jsx("option",{value:ae.value,children:ae.label},ae.value))})]}),p?a.jsxs("div",{className:"entity-notes-strict-alert error",children:[a.jsx(qa,{size:16}),a.jsx("p",{children:p})]}):null,h?a.jsxs("div",{className:"entity-notes-strict-loading",children:[a.jsx(Nn,{className:"spin",size:20}),a.jsx("span",{children:"Loading notes"})]}):null,!h&&zt.length===0?a.jsx("p",{className:"entity-notes-strict-empty",children:"No notes yet."}):null,!h&&zt.length>0?a.jsx("div",{className:"entity-notes-strict-list",children:zt.map(ae=>{const Xe=ae?.createdAt??ae?.created_at??ae?.timestamp??null,$e=dp(Xe);String(ae?.shareType??ae?.share_type??"private");const Je=J===ae?.id,bt=W(ae);return ae?.characterId??ae?.character_id,a.jsx("div",{className:"entity-notes-strict-note-item",children:Je?a.jsxs("div",{className:"entity-notes-strict-edit-panel",children:[a.jsx(Od,{value:Z,onChange:at,markup:"@[__display__](__id__)",placeholder:_S,className:"entity-note-mentions",inputProps:{className:"entity-notes-strict-textarea","aria-label":"Edit note content",rows:5,required:!0},children:a.jsx(Rl,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(St,_e)=>`@${_e}`,data:te,appendSpaceOnAdd:!0})}),a.jsx("p",{className:"entity-notes-strict-share-label",children:"Share with"}),a.jsx("div",{className:"entity-notes-strict-share-options",children:He.map(St=>a.jsxs("label",{className:"entity-notes-strict-share-option",children:[a.jsx("input",{type:"radio",name:`entity-note-share-edit-${ae.id}`,value:St.value,checked:Q===St.value,onChange:()=>ue(St.value),disabled:Pe}),St.value==="private"?"Private":St.value==="party"?"Share with Party":St.label]},St.value))}),Y?a.jsxs("div",{className:"entity-notes-strict-alert error",children:[a.jsx(qa,{size:16}),a.jsx("p",{children:Y})]}):null,a.jsxs("div",{className:"entity-notes-strict-edit-actions",children:[a.jsx("button",{type:"button",className:"btn-primary",onClick:()=>st(ae),disabled:Pe||!Z.trim(),children:Pe?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:16})," Saving"]}):"Save"}),a.jsx("button",{type:"button",className:"btn-secondary",onClick:ge,disabled:Pe,children:"Cancel"})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"entity-notes-strict-note-header",children:[a.jsxs("div",{className:"entity-notes-strict-note-title-row",children:[a.jsx("span",{className:"entity-notes-strict-note-title",children:Ge(ae)}),a.jsx("span",{className:"entity-notes-strict-note-visibility",children:ut(ae)})]}),a.jsx("span",{className:"entity-notes-strict-note-timestamp",children:$e||""})]}),a.jsx("p",{className:"entity-notes-strict-note-body",children:Kt(ae)}),bt?a.jsxs("div",{className:"entity-notes-strict-note-actions",children:[a.jsx("button",{type:"button",className:"entity-notes-strict-edit-button",onClick:()=>Ee(ae),children:"Edit"}),a.jsx("button",{type:"button",className:"entity-notes-strict-delete-button",onClick:()=>nt(ae),disabled:Ce===ae.id,children:Ce===ae.id?a.jsx(Nn,{className:"spin",size:14}):"Delete"})]}):null]})},ae?.id)})}):null]}):a.jsxs("div",{className:"entity-notes-strict-mentions",children:[a.jsxs("div",{className:"entity-notes-strict-mentions-header",children:[a.jsxs("div",{className:"entity-notes-strict-mention-toggle",children:[a.jsxs("button",{type:"button",className:`entity-notes-strict-mention-toggle-button${q==="entity"?" active":""}`,onClick:()=>G("entity"),children:["Entity Notes",oe?a.jsx("span",{className:"entity-notes-strict-mention-count",children:se}):null]}),a.jsxs("button",{type:"button",className:`entity-notes-strict-mention-toggle-button${q==="session"?" active":""}`,onClick:()=>G("session"),children:["Session Notes",re?a.jsx("span",{className:"entity-notes-strict-mention-count",children:be}):null]})]}),a.jsx("button",{type:"button",className:"btn-secondary",onClick:Lt,disabled:Ne,children:(q==="entity"?je:Ze)?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:16})," Refreshing"]}):"Refresh"})]}),q==="entity"?a.jsxs(a.Fragment,{children:[dt?a.jsxs("div",{className:"entity-notes-strict-alert error",children:[a.jsx(qa,{size:16}),a.jsx("p",{children:dt})]}):null,je?a.jsxs("div",{className:"entity-notes-strict-loading",children:[a.jsx(Nn,{className:"spin",size:20}),a.jsx("span",{children:"Loading mentions"})]}):null,!je&&oe&&se===0?a.jsx("p",{className:"entity-notes-strict-empty",children:"This entity hasn't been mentioned in other entity notes yet."}):null,!je&&oe&&se>0?a.jsx("div",{className:"entity-notes-strict-list",children:Rt.map((ae,Xe)=>{const $e=ae?.id??ae?.entityNoteId??ae?.entity_note_id??`entity-mention-${Xe}`,Je=String($e),bt=ae?.createdAt??ae?.created_at,St=bt?new Date(bt):null,_e=dp(St);return String(ae?.shareType??ae?.share_type??"private"),St&&!Number.isNaN(St.getTime())&&St.toISOString(),ae?.entity?.name??ae?.entityName,ae?.entity?.id??ae?.entityId??ae?.entity_id,a.jsxs("div",{className:"entity-notes-strict-note-item",children:[a.jsxs("div",{className:"entity-notes-strict-note-header",children:[a.jsxs("div",{className:"entity-notes-strict-note-title-row",children:[a.jsx("span",{className:"entity-notes-strict-note-title",children:Ge(ae)}),a.jsx("span",{className:"entity-notes-strict-note-visibility",children:ut(ae)})]}),a.jsx("span",{className:"entity-notes-strict-note-timestamp",children:_e||""})]}),a.jsx("p",{className:"entity-notes-strict-note-body",children:Kt(ae)})]},`entity-mention-${Je}`)})}):null]}):a.jsxs(a.Fragment,{children:[gt?a.jsxs("div",{className:"entity-notes-strict-alert error",children:[a.jsx(qa,{size:16}),a.jsx("p",{children:gt})]}):null,Ze?a.jsxs("div",{className:"entity-notes-strict-loading",children:[a.jsx(Nn,{className:"spin",size:20}),a.jsx("span",{children:"Loading session mentions"})]}):null,!Ze&&re&&be===0?a.jsx("p",{className:"entity-notes-strict-empty",children:"This entity hasn't been mentioned in session notes yet."}):null,!Ze&&re&&be>0?a.jsx("div",{className:"entity-notes-strict-list",children:pt.map((ae,Xe)=>{const $e=ae?.id??ae?.noteId??ae?.note_id??`session-mention-${Xe}`,Je=String($e),bt=Zt(Je),St=Tt(ae),_e=ae?.sessionTitle??ae?.session_title??"Session note";Ft(ae),fp(ae);const tt=ae?.updatedAt??ae?.updated_at??ae?.createdAt??ae?.created_at,mt=tt?new Date(tt):null,fe=dp(mt),he=St||"This session note does not include any text.";return a.jsxs("div",{className:"entity-notes-strict-note-item",children:[a.jsxs("div",{className:"entity-notes-strict-note-header",children:[a.jsx("div",{className:"entity-notes-strict-note-title-row",children:a.jsx("span",{className:"entity-notes-strict-note-title",children:_e})}),a.jsx("span",{className:"entity-notes-strict-note-timestamp",children:fe||""})]}),bt?a.jsx("p",{className:"entity-notes-strict-note-body",children:Kt(ae)}):a.jsx("p",{className:"entity-notes-strict-note-body",children:he}),a.jsx("div",{className:"entity-notes-strict-note-actions",children:a.jsx("button",{type:"button",className:"entity-notes-strict-action-button",onClick:()=>kt(Je),children:bt?"Hide note":"View note"})})]},`session-mention-${Je}`)})}):null]})]})]}),a.jsx(Yr,{isOpen:D&&At,onClose:ve,title:"Create note",children:a.jsx("div",{className:"entity-notes-form",children:a.jsxs("form",{onSubmit:Se,className:"entity-notes-form-body",children:[a.jsx("label",{className:"entity-notes-label",htmlFor:"entity-note-content",children:"Note"}),a.jsx("div",{className:"entity-note-editor-field",children:a.jsx(Od,{value:j,onChange:ee,markup:"@[__display__](__id__)",placeholder:_S,className:"entity-note-mentions",inputProps:{id:"entity-note-content",className:"entity-note-textarea","aria-label":"Entity note content",rows:5,required:!0,"data-autofocus":!0},children:a.jsx(Rl,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(ae,Xe)=>`@${Xe}`,data:te,appendSpaceOnAdd:!0})})}),a.jsxs("fieldset",{className:"entity-notes-share",children:[a.jsx("legend",{children:"Share with"}),He.map(ae=>a.jsxs("label",{className:"entity-notes-share-option",children:[a.jsx("input",{type:"radio",name:"entity-note-share",value:ae.value,checked:C===ae.value,onChange:()=>O(ae.value),disabled:ot}),a.jsx("span",{children:ae.label})]},ae.value))]}),Be?a.jsxs("div",{className:"entity-notes-character",children:[a.jsx("label",{htmlFor:"entity-note-character",children:"Character"}),a.jsxs("select",{id:"entity-note-character",value:E,onChange:ae=>T(ae.target.value),disabled:z||Ke,required:!0,children:[a.jsx("option",{value:"",disabled:!0,children:z?"Loading characters":"Select character"}),M.map(ae=>a.jsx("option",{value:ae.id,children:ae.name},ae.id))]}),Ke?a.jsxs("p",{className:"entity-notes-hint",children:["Notes will be associated with your character ",M[0]?.name,"."]}):null,X?a.jsxs("div",{className:"entity-notes-alert error",children:[a.jsx(qa,{size:16}),a.jsx("p",{children:X})]}):null,!z&&!X&&M.length===0?a.jsx("p",{className:"entity-notes-hint",children:"You need an active character in this campaign to attach notes."}):null]}):null,Y?a.jsxs("div",{className:"entity-notes-alert error",children:[a.jsx(qa,{size:16}),a.jsx("p",{children:Y})]}):null,I?a.jsx("div",{className:"entity-notes-alert success",children:a.jsx("p",{children:I})}):null,a.jsx("div",{className:"entity-notes-actions",children:a.jsx("button",{type:"submit",className:"primary",disabled:Oe,children:g?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:16})," Saving"]}):"Save note"})})]})})})]})}zN.propTypes={entity:rn.object,worldId:rn.oneOfType([rn.string,rn.number]),selectedCampaign:rn.object,selectedCampaignId:rn.oneOfType([rn.string,rn.number]),isCampaignDm:rn.bool,isCampaignPlayer:rn.bool,canCreateNote:rn.bool,notes:rn.arrayOf(rn.object),loading:rn.bool,error:rn.string,onCreateNote:rn.func,creating:rn.bool,campaignMatchesEntityWorld:rn.bool,onNoteUpdate:rn.func,onNoteDelete:rn.func};const cI=e=>{const t=e?.options?.choices;return!Array.isArray(t)||t.length===0?[]:t.map((r,i)=>{if(r==null)return null;if(typeof r=="object"){const c=r.value??r.id??r.key??r.slug??`choice-${i}`,f=r.label??r.name??r.title??r.display??c;return c==null?null:{value:c,label:String(f??c)}}const l=String(r);return{value:l,label:l}}).filter(Boolean)},uI=e=>{if(!e?.name)return null;const t=`metadata.${e.name}`,r=e.visibleByDefault!==void 0?!!e.visibleByDefault:e.visible_by_default!==void 0?!!e.visible_by_default:!0,i={key:t,name:t,label:e.label||e.name,metadataField:e.name,dataType:e.dataType,visibleByDefault:r};switch(e.dataType){case"text":return{...i,type:"textarea",rows:3};case"boolean":return{...i,type:"boolean"};case"enum":return{...i,type:"select",options:cI(e)};case"number":return{...i,type:"text",inputType:"number"};case"date":return{...i,type:"text"};case"reference":{const l=e.referenceTypeId??e.reference_type_id??e.referenceType?.id??null,c=e.referenceTypeName??e.reference_type_name??e.referenceType?.name??"",f=e.referenceFilter??e.reference_filter??e.referenceFilterJson??{},m=(()=>{if(e.displayValue)return String(e.displayValue);if(e.display)return String(e.display);if(e.selectedLabel)return String(e.selectedLabel);const h=e.value;if(!h||typeof h!="object")return"";const p=h.label??h.name??h.title??h.display??h.displayName??h.text??h.value;return p!=null?String(p):""})();return{...i,type:"reference",referenceTypeId:l,referenceTypeName:c,referenceFilter:f,displayKey:`metadataDisplay.${e.name}`,selectedLabel:m}}default:return{...i,type:"text"}}},Wu=(e,t,r="")=>{if(e!=null){const i=String(e).trim();if(i)return i}if(t!=null){const i=String(t).trim();if(i)return`name:${i.toLowerCase()}`}if(r){const i=String(r).trim();if(i)return`label:${i.toLowerCase().normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"fallback"}`}return""};function dI(){const{id:e}=vs(),t=zn(),r=Ya(),{user:i,token:l,sessionReady:c}=En(),{selectedCampaign:f,selectedCampaignId:m,setSelectedCampaignId:h}=Bn(),p=Uy(),[y,g]=u.useState(null),v=u.useCallback(ye=>{const Me=Ha(ye);Me&&g(ht=>ht?!Me.permissions&&ht.permissions?{...Me,permissions:ht.permissions}:(Me.permissions,Me):Me)},[]),[S,w]=u.useState(!0),[N,j]=u.useState(""),[_,C]=u.useState(""),[O,E]=u.useState("dossier"),[T,M]=u.useState(!1),[A,z]=u.useState(!1),[P,X]=u.useState(null),[H,Y]=u.useState({items:[],loading:!1,error:""}),[V,I]=u.useState(!1),F=u.useRef(null),[D,L]=u.useState({isDirty:!1,isSubmitting:!1}),[B,k]=u.useState(!1),[U,R]=u.useState(null),q=u.useRef(null),[G,J]=u.useState(!1),[ie,Z]=u.useState([]),[me,Q]=u.useState(""),[ue,ne]=u.useState(!1),[we,Pe]=u.useState([]),[Re,Ce]=u.useState([]),[it,qe]=u.useState(()=>ep()),We=u.useRef(r),ke=u.useRef(null),Mt=u.useMemo(()=>!f||!i?.id?null:(Array.isArray(f.members)?f.members:[]).find(ht=>{if(!ht)return!1;const Dt=ht.user_id??ht.userId??ht.user?.id??ht.id??null;return Dt?String(Dt)===String(i.id):!1})||null,[f,i?.id])?.role??null,Ct=u.useMemo(()=>i?.role==="system_admin"?!0:Mt==="dm",[Mt,i?.role]),At=u.useMemo(()=>Mt==="player",[Mt]),He=u.useMemo(()=>!!(Ct||At),[Ct,At]),Qe=u.useMemo(()=>y?y.world?.id?String(y.world.id):y.world_id?String(y.world_id):y.worldId?String(y.worldId):"":"",[y]),W=u.useMemo(()=>f?f.world?.id?String(f.world.id):f.world_id?String(f.world_id):"":"",[f]),ee=u.useMemo(()=>!m||!Qe||!W?!0:String(Qe)===String(W),[m,Qe,W]),te=r.state?.fromEntities?.search||"",ve=u.useMemo(()=>te?te.startsWith("?")?`/entities${te}`:`/entities?${te}`:"/entities",[te]),le=u.useCallback(ye=>{if(!ye)return"the next page";const Me=ye.pathname||"",ht=ye.search||"",Dt=`${Me}${ht}`;return Dt?Dt===ve?"the previous page":Dt:"the next page"},[ve]),Se=u.useCallback(ye=>{if(!ye)return"";const Me=ye.pathname||"",ht=ye.search||"",Dt=ye.hash||"";return`${Me}${ht}${Dt}`},[]),Ee=u.useCallback(ye=>{if(!ye||typeof ye!="string")return null;const Me=ye.indexOf("#"),ht=ye.indexOf("?");let Dt=ye.length;Me>=0&&(Dt=Me),ht>=0&&ht<Dt&&(Dt=ht);const Vt=ye.slice(0,Dt)||"",nn=ht>=0?ye.slice(ht,Me>=0?Me:void 0):"",xn=Me>=0?ye.slice(Me):"";return{pathname:Vt,search:nn,hash:xn}},[]),ge=u.useCallback(ye=>{if(ye){if(ye.externalUrl){typeof window<"u"&&window.location.assign(ye.externalUrl);return}if(ye.to!==void 0&&ye.to!==null){const Me=ye.to;if(typeof Me=="string"){ke.current=Me,t(Me,{replace:ye.replace,state:ye.state});return}const ht=Se(Me);ht&&(ke.current=ht),t(Me,{replace:ye.replace,state:ye.state})}}},[Se,t]),at=u.useCallback(ye=>{ye&&g(Me=>{if(!Me)return Me;const ht=Array.isArray(Me.secrets)?Me.secrets:[],Dt=ht.findIndex(Gt=>!Gt||!ye||!Gt.id||!ye.id?!1:String(Gt.id)===String(ye.id)),Vt=Dt>=0?ht.map((Gt,vn)=>vn===Dt?ye:Gt):[...ht,ye],nn=Gt=>{if(!Gt)return 0;const vn=new Date(Gt).getTime();return Number.isNaN(vn)?0:vn},xn=Vt.slice().sort((Gt,vn)=>nn(Gt?.created_at||Gt?.createdAt)-nn(vn?.created_at||vn?.createdAt));return{...Me,secrets:xn}})},[]),st=u.useCallback(async()=>{const ye=await GR(e,{campaignId:m});return Array.isArray(ye?.data)?ye.data:Array.isArray(ye)?ye:[]},[e,m]);u.useEffect(()=>{let ye=!1;return!e||!m||!ee?(Y({items:[],loading:!1,error:""}),()=>{ye=!0}):(Y(ht=>({...ht,loading:!0,error:""})),(async()=>{try{const ht=await st();ye||Y({items:ht,loading:!1,error:""})}catch(ht){if(!ye){const nn=(ht.status===403||ht.status==="403"||ht.message==="Forbidden")&&!!m?"CAMPAIGN_CONTEXT_ACCESS_DENIED":ht.message||"Failed to load notes";Y(xn=>({...xn,loading:!1,error:nn}))}}})(),()=>{ye=!0})},[e,m,ee,st]);const nt=u.useCallback(async()=>{if(!e||!m||!ee){Y({items:[],loading:!1,error:""});return}Y(ye=>({...ye,loading:!0,error:""}));try{const ye=await st();Y({items:ye,loading:!1,error:""})}catch(ye){Y(Me=>({...Me,loading:!1,error:ye.message||"Failed to load notes"}))}},[e,m,ee,st]),ze=u.useCallback(async ye=>{if(!e)return{success:!1,message:"Entity not found"};if(!m)return{success:!1,message:"Select a campaign first"};I(!0);try{const Me={...ye,campaignId:ye?.campaignId??m},ht=await WR(e,Me),Dt=ht?.data||ht;if(!Dt)throw new Error("Note could not be created");const Vt=Dt?.createdAt??Dt?.created_at??new Date().toISOString(),nn=Dt?.createdAt&&Dt?.created_at?Dt:{...Dt,...Dt?.createdAt?{}:{createdAt:Vt},...Dt?.created_at?{}:{created_at:Vt}};return Y(xn=>{const Gt=Array.isArray(xn?.items)?xn.items.slice():[],vn=Dt?.id,la=vn?Gt.filter(Pt=>Pt?.id!==vn):Gt;return{items:[nn,...la],loading:!1,error:""}}),{success:!0,note:nn}}catch(Me){return{success:!1,message:Me.message||"Failed to create note"}}finally{I(!1)}},[e,m]),ft=u.useCallback(async ye=>{if(!ye?.id)return;const Me=ye?.updatedAt??ye?.updated_at??ye?.createdAt??ye?.created_at??new Date().toISOString(),ht=ye?.updatedAt&&ye?.updated_at?ye:{...ye,...ye?.updatedAt?{}:{updatedAt:Me},...ye?.updated_at?{}:{updated_at:Me}};Y(Dt=>{const Vt=Array.isArray(Dt?.items)?Dt.items.slice():[],nn=ht?.id;if(!nn)return Dt;const xn=Vt.findIndex(Gt=>Gt?.id===nn);if(xn>=0){const Gt=[...Vt];return Gt[xn]=ht,{items:Gt,loading:!1,error:""}}return{items:[ht,...Vt],loading:!1,error:""}})},[]),zt=u.useCallback(async ye=>{ye&&Y(Me=>({items:(Array.isArray(Me?.items)?Me.items.slice():[]).filter(Vt=>Vt?.id!==ye),loading:!1,error:""}))},[]),Rt=u.useMemo(()=>y?.permissions&&typeof y.permissions.canEdit=="boolean"?y.permissions.canEdit:!y||!i?!1:!!(i.role==="system_admin"||y.world?.created_by&&y.world.created_by===i.id||y.created_by&&y.created_by===i.id),[y,i]),pt=u.useMemo(()=>Array.isArray(y?.secrets)?y.secrets:[],[y?.secrets]),ct=u.useMemo(()=>!!y?.permissions?.canManageSecrets,[y?.permissions?.canManageSecrets]),yt=ct||pt.length>0,Tt=u.useMemo(()=>{const ye=[{id:"dossier",label:"Dossier"},{id:"notes",label:"Notes"},{id:"relationships",label:"Relationships"}];return yt&&ye.push({id:"secrets",label:"Secrets"}),Rt&&T&&ye.push({id:"access",label:"Access"}),ye.push({id:"system",label:"System"}),ye},[yt,Rt,T]);u.useEffect(()=>{new Set(Tt.map(Me=>Me.id)).has(O)||E("dossier")},[Tt,O]);const Ft=u.useCallback((ye,Me,ht,Dt=null)=>{if(!ye)return null;const Vt=Array.isArray(ye.sections)?ye.sections:[],nn=Dt?.actionsByField??{},xn=Dt?.showRuleTargets??new Set;return Vt.map((Gt,vn)=>{const la=`${ht||"section"}-${Gt.title||vn}`,Pt=Number.isFinite(Gt.columns)?Math.max(1,Number(Gt.columns)):1,Kn=Array.isArray(Gt.fields)?Gt.fields:[];return a.jsxs("section",{className:"entity-card bg-white rounded-lg border p-4 sm:p-6 w-full",children:[Gt.title?a.jsx("h2",{className:"entity-card-title",children:Gt.title}):null,a.jsx("div",{className:`entity-field-grid ${Pt>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":""}`,style:{"--entity-field-columns":Pt},children:Kn.length>0?Kn.map((Ga,Li)=>{const Oi=Ga?.key||Ga?.name||Ga?.field||`${la}-field-${Li}`,zi=nn[Oi],$i=Ga.visibleByDefault!==void 0?!!Ga.visibleByDefault:Ga.visible_by_default!==void 0?!!Ga.visible_by_default:!0;return uc(Oi,zi,xn,$i)?null:a.jsx(hf,{field:{...Ga},data:Me,mode:"view"},Oi)}):a.jsx("p",{className:"entity-empty-state",children:"No fields available."})})]},la)})},[]);u.useEffect(()=>{if(!P)return;const ye=setTimeout(()=>X(null),4e3);return()=>clearTimeout(ye)},[P]);const kt=u.useCallback(async()=>{if(e){w(!0),j(""),C("");try{const ye=await rr(e),Me=Ha(ye);if(!Me){g(null),j("Entity not found");return}v(Me)}catch(ye){const Me=ye.status===403||ye.status==="403"||ye.message==="Forbidden";j(Me&&!!m?"CAMPAIGN_CONTEXT_ACCESS_DENIED":ye.message||"Failed to load entity"),g(null)}finally{w(!1)}}},[e,v,m]),Zt=u.useCallback(async ye=>{if(!ye){Pe([]),Ce([]);return}try{const[Me,ht]=await Promise.all([uf(ye).catch(()=>null),df(ye).catch(()=>null)]);Pe(Gr(Me)),Ce(Gr(ht))}catch{Pe([]),Ce([])}},[]);u.useEffect(()=>{c&&l&&kt()},[c,l,kt]),u.useEffect(()=>{const ye=y?.entity_type_id||y?.entityType?.id||y?.entity_type?.id||null;if(!ye){Pe([]),Ce([]);return}Zt(ye)},[y?.entity_type_id,y?.entityType?.id,y?.entity_type?.id,Zt]);const Lt=u.useMemo(()=>Array.isArray(y?.fields)?Yy(y.fields,we).map(Me=>uI(Me)).filter(Boolean):[],[y?.fields,we]),Kt=u.useMemo(()=>!y?.fields||y.fields.length===0?{__placeholder:"No metadata defined for this entity type."}:rN(y.fields),[y]),se=y?.fields,be=u.useMemo(()=>Xy(Re,se),[Re,se]),je=u.useMemo(()=>!y?.fields||y.fields.length===0?{}:Gk(y.fields),[y]),Ze=u.useMemo(()=>!y?.fields||y.fields.length===0?{}:Yk(y.fields),[y]),dt=u.useMemo(()=>{if(!y?.id)return null;const ye=y?.entityType?.name||y?.entity_type?.name||y?.entityTypeName||"entity";return{id:y.id,type:`entity:${ye}`,title:y.name||"Untitled entity",worldId:Qe,worldName:y?.world?.name||y?.world_name||""}},[y?.id,y?.name,y?.entityType?.name,y?.entity_type?.name,y?.entityTypeName,Qe,y?.world?.name,y?.world_name]);F1(dt);const gt=u.useRef(null),oe=u.useRef(!1),re=u.useRef(!1);u.useEffect(()=>{const ye=y?.id,Me=gt.current;ye!==Me&&Me!==null&&!re.current&&(M(!1),oe.current=!1),gt.current=ye},[y?.id,T]);const Ne=y?.createdAt||y?.created_at,Be=y?.updatedAt||y?.updated_at,Ke=u.useMemo(()=>y?{name:y.name||"",description:y.description||"",typeName:y.entityType?.name||y.entity_type?.name||"",worldName:y.world?.name||y.world_name||"",worldId:Qe,createdAt:Hr(Ne),updatedAt:Hr(Be),metadata:Kt,metadataDisplay:je,createdBy:y.creator?.username||y.creator?.email||y.created_by||"",updatedBy:y.updated_by||""}:null,[y,Kt,je,Qe,Ne,Be]),ot=u.useMemo(()=>Ky(be,Ke||{}),[be,Ke]),Oe=u.useMemo(()=>y?{name:y.name||"",description:y.description||"",visibility:y.visibility||"visible",entityTypeName:y.entityType?.name||y.entity_type?.name||"",worldName:y.world?.name||y.world_name||"",worldId:Qe,createdAt:Hr(Ne),updatedAt:Hr(Be),metadata:Ze}:null,[y,Qe,Ne,Be,Ze]);u.useEffect(()=>{if(!T||!y||!Oe||!F.current?.reset||!oe.current)return;const ye=setTimeout(()=>{F.current?.reset&&Oe&&F.current.reset(Oe),oe.current=!1},150);return()=>clearTimeout(ye)},[T,y,Oe]);const ce=u.useMemo(()=>{if(!y)return"";const ye=y.imageMimeType||y.image_mime_type||"",Me=y.imageData||y.image_data||"";return!ye||!Me?"":`data:${ye};base64,${Me}`},[y]),Ue=u.useMemo(()=>!y||!Rt?null:a.jsx(A4,{entity:y,canEdit:Rt,isEditing:T,onEntityUpdate:v,variant:T?"compact":"card"}),[y,Rt,T,v]),Ge="Information",ut=u.useMemo(()=>{const ye=Lt.length>0;return{title:"Edit Entity",sections:[{title:"Edit Entity",columns:2,fields:[{key:"name",label:"Name",type:"text"},{key:"entityTypeName",label:"Type",type:"readonly"},{key:"description",label:"Description",type:"textarea",rows:4,span:2}]},{title:Ge,columns:ye?2:1,fields:ye?Lt:[{key:"metadata.__placeholder",name:"metadata.__placeholder",label:"Information",type:"readonly"}]}]}},[Lt,Ge]),ae=u.useMemo(()=>{const ye=Lt.length>0?Lt:[{key:"metadata.__placeholder",name:"metadata.__placeholder",label:"Information",type:"readonly"}];return{title:"Entity Overview",sections:[{title:"Summary",columns:2,fields:[{key:"name",label:"Name",type:"readonly"},{key:"typeName",label:"Type",type:"readonly"}]},{title:"Description",columns:1,fields:[{key:"description",label:"Description",type:"textarea",rows:4}]},{title:Ge,columns:Lt.length>0?2:1,fields:ye}]}},[Lt,Ge]),Xe=u.useMemo(()=>({sections:[{title:"System",columns:2,fields:[{key:"worldName",label:"World",type:"readonly"},{key:"createdAt",label:"Created",type:"readonly"},{key:"createdBy",label:"Created by",type:"readonly"},{key:"updatedAt",label:"Updated",type:"readonly"},{key:"updatedBy",label:"Updated by",type:"readonly"}]}]}),[]),{accessSettings:$e,accessOptions:Je,accessOptionsError:bt,accessOptionsLoading:St,accessSaving:_e,accessSaveError:tt,accessSaveSuccess:mt,isAccessDirty:fe,handleAccessSettingChange:he,resetAccessSettings:Ve,handleAccessSave:vt}=U4(y,l,Rt),Nt=u.useMemo(()=>y?.world?.id||y?.world_id||"",[y]),Et=y?.id?String(y.id):"",jt=u.useCallback(async()=>{if(!Et||!l){Z([]),Q(""),ne(!1);return}ne(!0),Q("");try{const ye=await R4(Et),Me=Array.isArray(ye)?ye:Array.isArray(ye?.data)?ye.data:[];Z(Me)}catch(ye){Z([]),Q(ye.message||"Failed to load relationships")}finally{ne(!1)}},[Et,l]);u.useEffect(()=>{jt()},[jt]);const Wt=u.useMemo(()=>{if(!Array.isArray(ie))return[];const ye=Me=>Me?typeof Me=="string"||typeof Me=="number"?String(Me).trim():typeof Me=="object"?String(Me.id||Me.entity_id||Me.entityId||"").trim():"":"";return ie.map(Me=>{const ht=Me.relationshipType||Me.relationship_type||Me.type||Me.relationshipTypeId||{},Dt=ht?.from_name||ht?.fromName||Me.source_relationship_label||Me.sourceLabel||"",Vt=ht?.to_name||ht?.toName||Me.target_relationship_label||Me.targetLabel||"";return{id:Me.id,typeId:ye(Me.relationship_type_id||Me.relationshipTypeId||Me.typeId||Me.type),typeName:Me.relationshipType?.name||Me.type?.name||"",fromId:ye(Me.from_entity_id||Me.fromEntityId||Me.from),toId:ye(Me.to_entity_id||Me.toEntityId||Me.to),fromName:Me.from_entity?.name||Me.from?.name||"",toName:Me.to_entity?.name||Me.to?.name||"",fromEntityTypeName:Me.from_entity_type?.name||Me.fromEntityTypeName||"",toEntityTypeName:Me.to_entity_type?.name||Me.toEntityTypeName||"",direction:Me.context?.__direction==="reverse"?"reverse":"forward",sourceLabel:Dt||"",targetLabel:Vt||""}})},[ie]),ln=u.useMemo(()=>Wt.filter(ye=>ye.fromId===Et||ye.toId===Et).sort((ye,Me)=>{const ht=ye.fromId===Et?ye.toName:ye.fromName,Dt=Me.fromId===Et?Me.toName:Me.fromName;return ht.localeCompare(Dt,void 0,{sensitivity:"base"})}),[Wt,Et]),dn=u.useMemo(()=>{const ye=new Map,Me=new Map;ln.forEach(Vt=>{const nn=Vt.typeName||"Unknown type",xn=Wu(Vt.typeId,Vt.typeName,nn);xn&&!ye.has(xn)&&ye.set(xn,nn);const vn=Vt.fromId===Et?Vt.toEntityTypeName:Vt.fromEntityTypeName,la=Wu(null,vn,vn);la&&!Me.has(la)&&Me.set(la,vn)});const ht=Array.from(ye.entries()).map(([Vt,nn])=>({value:Vt,label:nn})),Dt=Array.from(Me.entries()).map(([Vt,nn])=>({value:Vt,label:nn}));return{relationshipTypes:ht,relatedEntityTypes:Dt}},[ln,Et]),Qt=u.useMemo(()=>{const ye=it.relationshipTypes||{mode:"all",values:[]},Me=it.relatedEntityTypes||{mode:"all",values:[]};return ln.filter(ht=>{const Dt=Wu(ht.typeId,ht.typeName,ht.typeName);if(ye.mode!=="all"&&ye.values.length){const Vt=Dt&&ye.values.includes(Dt);if(ye.mode==="include"&&!Vt||ye.mode==="exclude"&&Vt)return!1}if(Me.mode!=="all"&&Me.values.length){const nn=ht.fromId===Et?ht.toEntityTypeName:ht.fromEntityTypeName,xn=Wu(null,nn,nn),Gt=xn&&Me.values.includes(xn);if(Me.mode==="include"&&!Gt||Me.mode==="exclude"&&Gt)return!1}return!0})},[ln,it,Et]),ha=u.useCallback(ye=>{qe(!ye||typeof ye!="object"?ep():ye)},[]),ka=u.useCallback(()=>{qe(ep())},[]),Jr=ue,ur=u.useMemo(()=>`No relationships found for ${y?.name||"this entity"}.`,[y?.name]),Os=u.useCallback(async()=>{if(!Rt)return!1;re.current=!0;let ye=!0,Me=!1;try{if(D.isDirty&&F.current?.submit&&await F.current.submit()===!1&&(ye=!1),ye&&fe&&(await vt()?Me=!0:ye=!1),ye&&Me&&y?.id)try{const ht=await rr(y.id),Dt=Ha(ht);Dt&&v(Dt)}catch{}return ye}finally{setTimeout(()=>{re.current=!1},200)}},[Rt,D.isDirty,fe,vt,y?.id,v,T]),ra=u.useCallback(()=>{const ye=q.current;R(null),ye?.proceed?.()},[]),ei=u.useCallback(async()=>{J(!0);try{if(await Os()){k(!1);const Me=q.current;Me?.type!=="exit-edit"?ra():(R(null),Me?.proceed?.())}}finally{J(!1)}},[Os,ra]),ti=u.useCallback(()=>{F.current?.reset?.(Oe||{}),Ve()},[Oe,Ve]),Un=u.useMemo(()=>T&&(D.isDirty||fe),[T,D.isDirty,fe]),Da=u.useCallback(()=>{M(!1),E("dossier")},[E,y?.id,Rt,Un]),Ss=u.useCallback(ye=>{if(!ye)return;const Me=()=>{if(ye.label)return ye.label;if(ye.externalUrl)return ye.externalLabel||ye.externalUrl;if(typeof ye.to=="string"){const ht=ye.location||Ee(ye.to);return le(ht)}return le(ye.location||ye.to)};if(!Un){ge(ye);return}R({type:"navigation",label:Me(),proceed:()=>ge(ye),discard:()=>ge(ye),stay:()=>{}}),k(!0)},[le,Un,Ee,ge,R,k]);u.useEffect(()=>{if(typeof document>"u"||!Un)return;const ye=Me=>{if(!Un||Me.defaultPrevented||Me.button!==0||Me.metaKey||Me.ctrlKey||Me.shiftKey||Me.altKey)return;const ht=Me.target,Dt=ht instanceof Element?ht:ht&&"parentElement"in ht?ht.parentElement:null;if(!Dt||typeof Dt.closest!="function")return;const Vt=Dt.closest("a[href]");if(!Vt||Vt.hasAttribute("data-ignore-unsaved-warning"))return;const nn=Vt.getAttribute("href");if(!nn||nn.startsWith("#")||nn.startsWith("javascript:"))return;const xn=Vt.getAttribute("target");if(xn&&xn.toLowerCase()!=="_self")return;let Gt;try{Gt=new URL(nn,window.location.href)}catch{return}const vn=Vt.getAttribute("data-navigation-label")||Vt.getAttribute("aria-label")||Vt.title||Vt.textContent?.trim()||"",la=Gt.origin!==window.location.origin;if(Me.preventDefault(),Me.stopPropagation(),la){Ss({externalUrl:Gt.href,label:vn||Gt.href});return}const Pt=`${Gt.pathname}${Gt.search}${Gt.hash}`,Kn=`${window.location.pathname}${window.location.search}${window.location.hash}`;!Pt||Pt===Kn||Ss({to:Pt,location:Ee(Pt),label:vn||le({pathname:Gt.pathname,search:Gt.search})})};return document.addEventListener("click",ye,!0),()=>{document.removeEventListener("click",ye,!0)}},[le,Un,Ee,Ss]);const de=u.useCallback(()=>{const ye=`/entities/${e}/relationship-viewer`;Ss({to:ye,location:Ee(ye)})},[e,Ee,Ss]),Ae=u.useCallback(()=>{if(Rt){if(C(""),!T){M(!0);return}if(Un){R({type:"exit-edit",label:"view mode",proceed:async()=>{await Os()&&Da()},discard:()=>{ti(),Da()}}),k(!0);return}Da()}},[Rt,Da,Un,T,ti,Os]),Ut=u.useCallback(async ye=>{if(!y?.id)return!1;C("");try{const Me={name:ye?.name,description:ye?.description,metadata:ye?.metadata||{}};y?.visibility&&(Me.visibility=y.visibility);const ht=await Py(y.id,Me),Dt=Ha(ht);if(!Dt)throw new Error("Failed to update entity");return v(Dt),oe.current=!0,{message:"Entity updated successfully."}}catch(Me){return C(Me.message||"Failed to update entity"),oe.current=!1,!1}},[y?.id,y?.visibility,v,T]),pn=u.useCallback(ye=>{L(Me=>{const ht={isDirty:!!ye?.isDirty,isSubmitting:!!ye?.isSubmitting};return Me.isDirty===ht.isDirty&&Me.isSubmitting===ht.isSubmitting?Me:ht})},[y?.id,T]),fn=u.useCallback(ye=>{!ye||ye===O||E(ye)},[O,E]),qt=u.useCallback(()=>{k(!1);const ye=q.current;R(null),ye?.discard?.()},[]),jn=u.useCallback(()=>{k(!1);const ye=q.current;R(null),ye?.stay?.()},[]);v1(u.useCallback(ye=>{Un&&(ye.preventDefault(),ye.returnValue="")},[Un]),{capture:!0});const qn=u.useCallback(({currentLocation:ye,nextLocation:Me})=>!Un||!Me?!1:!(ye.pathname===Me.pathname&&ye.search===Me.search&&ye.hash===Me.hash),[Un]),Fn=q4(qn);if(u.useEffect(()=>{q.current=U},[U]),u.useEffect(()=>{if(Fn.state==="blocked"){if(!Un){Fn.reset?.();return}if(U){if(U.type==="navigation")return;Fn.reset?.();return}R({type:"navigation",label:le(Fn.location),proceed:()=>Fn.proceed?.(),discard:()=>Fn.proceed?.(),stay:()=>Fn.reset?.()}),k(!0)}},[Fn,Un,U,le]),u.useEffect(()=>{const ye=We.current,Me=Se(ye),ht=Se(r);if(Me===ht){We.current=r;return}if(!Un){We.current=r,ke.current=null;return}if(ke.current&&ke.current===ht){ke.current=null,We.current=r;return}if(!ye||U){We.current=ye||r;return}const Dt=ht||"/",Vt=Me||"/",nn=()=>{ke.current=Dt,t(Dt)},xn=()=>{ke.current=Vt,t(Vt)};R({type:"navigation",label:le(r),proceed:nn,discard:nn,stay:xn}),k(!0),ke.current=Vt,t(Vt,{replace:!0})},[Se,le,Un,r,t,U]),!c)return a.jsx("p",{children:"Restoring session..."});if(!l)return a.jsx("p",{children:"Authenticating..."});if(S)return a.jsx("p",{children:"Loading entity..."});if(N==="CAMPAIGN_CONTEXT_ACCESS_DENIED")return a.jsxs("div",{className:"alert error",style:{padding:"1.5rem",maxWidth:"600px",margin:"2rem auto"},children:[a.jsx("h2",{style:{marginTop:0,marginBottom:"1rem"},children:"Access Restricted by Campaign Context"}),a.jsx("p",{style:{marginBottom:"1rem"},children:"You don't have access to this entity with your current campaign context selected. This entity may belong to a different campaign or world, or your current campaign context doesn't have permission to view it."}),a.jsx("p",{style:{marginBottom:"1.5rem"},children:"To view this entity, please change your campaign context using the selector in the header to a campaign that has access to this entity."}),a.jsx("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap"},children:a.jsx("button",{type:"button",onClick:()=>t("/entities"),style:{padding:"0.5rem 1rem",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Go to Entities"})})]});if(N)return a.jsx("div",{className:"alert error",children:N});if(!y||!Ke)return a.jsx("p",{children:"Entity not found"});const ia=`entity-detail-page${p?" entity-detail-page--mobile":""}`;return a.jsxs(a.Fragment,{children:[a.jsx(bN,{maxWidth:1280,className:ia,children:a.jsxs("div",{className:"w-full max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 overflow-x-hidden",children:[a.jsx("header",{className:"entity-page-header",children:a.jsxs("div",{className:"entity-page-header__inner",children:[a.jsx(b4,{entityId:e,name:y.name,canEdit:Rt,isEditing:T,onToggleEdit:Ae,onSave:Os,isSaving:D.isSubmitting||_e,isSaveDisabled:!D.isDirty&&!fe}),a.jsxs("div",{className:"entity-page-header__tabs flex flex-wrap items-center justify-between gap-4 mt-4",children:[a.jsx(m4,{tabs:Tt,activeTab:O,onChange:fn}),e&&a.jsx(x4,{entityId:e,importance:y.importance,onUpdate:ye=>{g(Me=>Me?{...Me,importance:ye}:null)}})]})]})}),a.jsx("div",{className:"entity-detail-shell",children:a.jsxs("div",{className:"entity-detail-body",children:[a.jsx("div",{className:"entity-tab-panel",role:"tabpanel",hidden:O!=="dossier",children:a.jsx(H4,{isEditing:T,canEdit:Rt,formError:_,formRef:F,editSchema:ut,editInitialData:Oe,handleUpdate:Ut,handleFormStateChange:pn,dossierSchema:ae,viewData:Ke,featuredImageSrc:ce,renderSchemaSections:Ft,imageSection:Ue,fieldRules:be,viewRuleContext:ot})}),O==="notes"&&a.jsx(zN,{entity:y,worldId:Qe,selectedCampaign:f,selectedCampaignId:m,isCampaignDm:Ct,isCampaignPlayer:At,canCreateNote:He,notes:H.items,loading:H.loading,error:H.error,onReload:nt,onCreateNote:ze,onNoteUpdate:ft,onNoteDelete:zt,creating:V,campaignMatchesEntityWorld:ee}),O==="relationships"&&a.jsx(P4,{entity:y,toast:P,onExplore:de,canEdit:Rt,relationshipsLoading:ue,relationshipsError:me,sortedRelationships:ln,filteredRelationships:Qt,relationshipsEmptyMessage:ur,relationshipFilters:it,relationshipFilterOptions:dn,filterButtonDisabled:Jr,handleRelationshipFiltersChange:ha,handleRelationshipFiltersReset:ka,showRelationshipForm:A,setShowRelationshipForm:z,worldId:Nt,loadRelationships:jt}),O==="secrets"&&yt&&a.jsx(X4,{entity:y,secrets:pt,worldId:Nt,canManageSecrets:ct,onSecretCreated:at,onSecretUpdated:at}),O==="access"&&T&&Rt&&a.jsx(V4,{canEdit:Rt,worldId:Nt,accessSettings:$e,accessOptions:Je,accessOptionsError:bt,accessOptionsLoading:St,accessSaving:_e,accessSaveError:tt,accessSaveSuccess:mt,handleAccessSettingChange:he}),O==="system"&&a.jsx(Y4,{renderSchemaSections:Ft,systemSchema:Xe,viewData:Ke})]})})]})}),a.jsx(vN,{open:B,destinationLabel:U?.label||"",saving:G,onSaveAndContinue:ei,onContinueWithoutSaving:qt,onStay:jn})]})}function fI({initialData:e={},onSubmit:t,onCancel:r,submitting:i=!1,errorMessage:l,worlds:c=[]}){const[f,m]=u.useState({name:"",description:"",worldId:""}),[h,p]=u.useState("");u.useEffect(()=>{const S=e?.world_id||e?.worldId||e?.world?.id||"";m({name:e?.name||"",description:e?.description||"",worldId:S?String(S):""}),p("")},[e]);const y=u.useMemo(()=>f.name!==(e?.name||"")||f.description!==(e?.description||"")||f.worldId!==(e?.world_id||e?.worldId||e?.world?.id||""),[e,f.description,f.name,f.worldId]);u.useEffect(()=>{p(l||"")},[l]);const g=S=>w=>{const{value:N}=w.target;m(j=>({...j,[S]:N}))},v=async S=>{S.preventDefault();const w=f.name.trim();if(!w){p("Name is required.");return}const N=f.worldId.trim();if(!N){p("Select a world for this entity type.");return}p("");const j={name:w,description:f.description?.trim()||"",world_id:N};try{if(await t?.(j)===!1)return}catch(_){p(_.message||"Failed to save entity type")}};return a.jsxs("form",{className:"entity-type-form",onSubmit:v,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-type-name",children:"Name *"}),a.jsx("input",{id:"entity-type-name",type:"text",value:f.name,onChange:g("name"),placeholder:"e.g. Faction",disabled:i,autoFocus:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-type-world",children:"World *"}),a.jsxs("select",{id:"entity-type-world",value:f.worldId,onChange:g("worldId"),disabled:i,required:!0,children:[a.jsx("option",{value:"",children:"Select world..."}),c.map(S=>a.jsx("option",{value:S.id,children:S.name},S.id))]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-type-description",children:"Description"}),a.jsx("textarea",{id:"entity-type-description",value:f.description,onChange:g("description"),placeholder:"Optional description for this entity type",rows:5,disabled:i,className:"textarea-field"})]}),h&&a.jsx("div",{className:"form-error",role:"alert",children:h}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:r,disabled:i,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:i||!y,children:i?"Saving...":"Save"})]})]})}const mI=new Set(["system_admin"]);function hI(){const e=zn(),{user:t,token:r,sessionReady:i}=En(),{selectedCampaign:l,activeWorld:c,activeWorldId:f,contextKey:m}=Bn(),[h,p]=u.useState([]),[y,g]=u.useState(!1),[v,S]=u.useState(""),[w,N]=u.useState(!1),[j,_]=u.useState(null),[C,O]=u.useState(!1),[E,T]=u.useState(""),[M,A]=u.useState(""),[z,P]=u.useState(null),X=f||l?.world?.id||"",H=u.useRef(`${X}:${m}`),Y=!!X,V=u.useMemo(()=>X?[{id:X,name:c?.name||l?.world?.name||"Untitled world"}]:[],[X,c?.name,l?.world?.name]),I=u.useMemo(()=>{const Q=l?.world||c;return Q&&(Q.created_by||Q.creator?.id||Q.owner_id||Q.owner?.id)||""},[l,c]),F=!!(t?.id&&I===t.id),D=u.useMemo(()=>t?t.role&&mI.has(t.role)?!0:F:!1,[t,F]),L=u.useMemo(()=>{if(l){const Q=l.name||"Selected campaign",ue=l.world?.name||c?.name;return ue?`${Q}  ${ue}`:Q}return c?c.name||"Selected world":""},[l,c]),B=u.useCallback((Q,ue="info")=>{P({message:Q,tone:ue})},[]);u.useEffect(()=>{if(!z)return;const Q=setTimeout(()=>P(null),3500);return()=>clearTimeout(Q)},[z]);const k=u.useCallback(async()=>{if(!r||!X)return g(!1),p([]),[];g(!0),S("");try{const Q=await Qr({worldId:X}),ue=Array.isArray(Q)?Q:Array.isArray(Q?.data)?Q.data:[];return p(ue),ue}catch(Q){return console.error(" Failed to load entity types",Q),S(Q.message||"Failed to load entity types"),p([]),[]}finally{g(!1)}},[r,X]);u.useEffect(()=>{if(!(!i||!r)){if(!X){p([]),S(""),g(!1);return}k()}},[i,r,X,k,m]),u.useEffect(()=>{const Q=`${X}:${m}`;H.current!==Q&&(N(!1),_(null),A(""),P(null),p([]),S(""),O(!1),T(""),H.current=Q)},[X,m]);const U=()=>{!D||!Y||e("/entity-types/new")},R=Q=>{D&&(_(Q),A(""),N(!0))},q=Q=>{Q?.id&&e(`/entity-types/${Q.id}/fields`)},G=()=>{N(!1),_(null),A("")},J=async Q=>{if(!j?.id)return A("No entity type selected for editing."),!1;try{O(!0),A(""),await sk(j.id,Q),B("Entity type updated","success"),G(),await k()}catch(ue){console.error(" Failed to save entity type",ue);const ne=ue.message||"Failed to save entity type";return A(ne),B(ne,"error"),!1}finally{O(!1)}return!0},ie=async Q=>{if(!(!D||!Q?.id||!window.confirm(`Delete entity type "${Q.name}"? This action cannot be undone.`)))try{T(Q.id),await rk(Q.id),B("Entity type deleted","success"),j?.id===Q.id&&G(),await k()}catch(ne){console.error(" Failed to delete entity type",ne),B(ne.message||"Failed to delete entity type","error")}finally{T("")}},Z=Q=>{if(!Q)return"";const ue=new Date(Q);return Number.isNaN(ue.getTime())?"":ue.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},me=h.length;return i?r?a.jsxs("section",{className:"entity-types-page",children:[a.jsxs("div",{className:"entity-types-header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Entity Types"}),l?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"entity-types-subtitle",children:L}),a.jsxs("p",{className:"entity-types-subtitle",children:[me," types defined"]})]}):a.jsx("p",{className:"entity-types-subtitle",children:"Select a campaign or world you own to choose a world context."})]}),a.jsxs("button",{type:"button",className:"btn submit",onClick:U,disabled:!D||C||E||!Y,children:[a.jsx(Pa,{size:18})," Add Entity Type"]})]}),!D&&a.jsx("div",{className:"alert info",role:"status",children:"You can view the existing entity types, but only system administrators or the world owner can make changes."}),z&&a.jsx("div",{className:`toast-banner ${z.tone}`,role:"status",children:z.message}),v&&a.jsx("div",{className:"alert error",role:"alert",children:v}),a.jsx("div",{className:"entity-types-table-wrapper",children:Y?y?a.jsx("div",{className:"empty-state",children:"Loading entity types..."}):h.length===0?a.jsx("div",{className:"empty-state",children:"No entity types defined yet."}):a.jsxs("table",{className:"entity-types-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Name"}),a.jsx("th",{children:"Description"}),a.jsx("th",{children:"World"}),a.jsx("th",{children:"Created"}),a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:h.map(Q=>{const ue=Q.createdAt||Q.created_at,ne=Q?.world?.name||Q?.world_name||Q?.worldName||"";return a.jsxs("tr",{children:[a.jsx("td",{children:Q.name}),a.jsx("td",{className:"description-cell",children:Q.description?Q.description:""}),a.jsx("td",{children:ne}),a.jsx("td",{children:Z(ue)}),a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-type-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Manage fields",onClick:()=>q(Q),children:a.jsx($0,{size:16})}),D&&a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Edit entity type",onClick:()=>R(Q),disabled:C||E===Q.id,children:a.jsx(ar,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete entity type",onClick:()=>ie(Q),disabled:E===Q.id||C,children:a.jsx(fa,{size:16})})]})]})})]},Q.id)})})]}):a.jsx("div",{className:"empty-state",children:"Select a campaign or world you own to view entity types."})}),a.jsx("div",{className:"entity-type-cards",children:Y?y?a.jsx("div",{className:"card-placeholder",children:"Loading entity types..."}):h.length===0?a.jsx("div",{className:"card-placeholder",children:"No entity types defined yet."}):h.map(Q=>{const ue=Q.createdAt||Q.created_at;return a.jsxs("div",{className:"entity-type-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsx("h3",{children:Q.name}),a.jsxs("div",{className:"entity-type-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Manage fields",onClick:()=>q(Q),children:a.jsx($0,{size:16})}),D&&a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Edit entity type",onClick:()=>R(Q),disabled:C||E===Q.id,children:a.jsx(ar,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete entity type",onClick:()=>ie(Q),disabled:E===Q.id||C,children:a.jsx(fa,{size:16})})]})]})]}),a.jsx("p",{className:"card-description",children:Q.description?Q.description:"No description"}),a.jsxs("p",{className:"card-meta",children:["World: ",Q?.world?.name||Q?.world_name||""]}),a.jsxs("p",{className:"card-meta",children:["Created ",Z(ue)]})]},`card-${Q.id}`)}):a.jsx("div",{className:"card-placeholder",children:"Select a campaign or world you own to view entity types."})}),w&&a.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"side-panel",children:[a.jsxs("div",{className:"side-panel-header",children:[a.jsx("h2",{children:j?"Edit Entity Type":"Add Entity Type"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:G,title:"Close form",disabled:C,children:a.jsx(Ra,{size:18})})]}),a.jsx("div",{className:"side-panel-content",children:a.jsx(fI,{initialData:j,onSubmit:J,onCancel:G,submitting:C,errorMessage:M,worlds:V})})]})})]}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const pI=[{value:"text",label:"Text"},{value:"number",label:"Number"},{value:"boolean",label:"Boolean"},{value:"date",label:"Date"},{value:"enum",label:"Enum"},{value:"reference",label:"Reference"}];function yI({initialData:e={},referenceTypes:t=[],onSubmit:r,onCancel:i,submitting:l=!1,errorMessage:c}){const[f,m]=u.useState({name:"",label:"",data_type:"text",required:!1,visibleByDefault:!0,enumChoices:"",reference_type_id:"",reference_filter:""}),[h,p]=u.useState("");u.useEffect(()=>{if(!e){m({name:"",label:"",data_type:"text",required:!1,visibleByDefault:!0,enumChoices:"",reference_type_id:"",reference_filter:""}),p("");return}const N=Array.isArray(e.options?.choices)?e.options.choices.join(", "):typeof e.options=="string"?e.options:"",j=e.reference_filter?typeof e.reference_filter=="string"?e.reference_filter:JSON.stringify(e.reference_filter,null,2):"";m({name:e.name||"",label:e.label||"",data_type:e.data_type||"text",required:!!e.required,visibleByDefault:e.visibleByDefault!==void 0?!!e.visibleByDefault:e.visible_by_default!==void 0?!!e.visible_by_default:!0,enumChoices:N,reference_type_id:e.reference_type_id||"",reference_filter:j}),p("")},[e]),u.useEffect(()=>{p(c||"")},[c]);const y=f.data_type==="enum",g=f.data_type==="reference",v=u.useMemo(()=>t.map(N=>({value:N.id,label:N.name})),[t]),S=N=>j=>{const{value:_,type:C,checked:O}=j.target;m(E=>({...E,[N]:C==="checkbox"?O:_}))},w=async N=>{N.preventDefault();const j=f.name.trim(),_=f.label.trim();if(!j){p("Field name is required.");return}if(!_){p("Field label is required.");return}if(!f.data_type){p("Data type is required.");return}let C={};if(g){if(!f.reference_type_id){p("Reference type is required for reference fields.");return}const E=f.reference_filter.trim();if(E)try{if(C=JSON.parse(E),typeof C!="object"||Array.isArray(C))throw new Error("Reference filter must be a JSON object.")}catch(T){p(T.message||"Reference filter must be valid JSON.");return}}const O={name:j,label:_,data_type:f.data_type,required:!!f.required,visible_by_default:!!f.visibleByDefault};if(y){const E=f.enumChoices.split(",").map(T=>T.trim()).filter(Boolean);if(!E.length){p("Enum options are required for enum fields.");return}O.options={choices:E}}else O.options={};g?(O.reference_type_id=f.reference_type_id,O.reference_filter=C):(O.reference_type_id=null,O.reference_filter={});try{if(await r?.(O)===!1)return;p("")}catch(E){p(E.message||"Failed to save field")}};return a.jsxs("form",{className:"entity-type-field-form",onSubmit:w,children:[a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-field-name",children:"Field Name *"}),a.jsx("input",{id:"entity-field-name",type:"text",value:f.name,onChange:S("name"),placeholder:"e.g. alignment",disabled:l})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-field-label",children:"Label *"}),a.jsx("input",{id:"entity-field-label",type:"text",value:f.label,onChange:S("label"),placeholder:"e.g. Alignment",disabled:l})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-field-data-type",children:"Data Type *"}),a.jsx("select",{id:"entity-field-data-type",value:f.data_type,onChange:S("data_type"),disabled:l,children:pI.map(N=>a.jsx("option",{value:N.value,children:N.label},N.value))}),a.jsx("p",{className:"field-hint",children:"Determines how the value is stored and rendered in entity forms."})]}),a.jsxs("div",{className:"form-group checkbox-group",children:[a.jsxs("div",{className:"checkbox-control",children:[a.jsx("input",{id:"entity-field-required",type:"checkbox",checked:f.required,onChange:S("required"),disabled:l}),a.jsx("label",{htmlFor:"entity-field-required",children:"Required"})]}),a.jsx("span",{className:"field-hint",children:"Mark as required on entity forms."})]}),a.jsxs("div",{className:"form-group checkbox-group",children:[a.jsxs("div",{className:"checkbox-control",children:[a.jsx("input",{id:"entity-field-visible-default",type:"checkbox",checked:f.visibleByDefault,onChange:S("visibleByDefault"),disabled:l}),a.jsx("label",{htmlFor:"entity-field-visible-default",children:"Visible by default"})]}),a.jsx("span",{className:"field-hint",children:"Uncheck to hide this field unless a rule explicitly shows it."})]}),y&&a.jsxs("div",{className:"form-group form-group-full",children:[a.jsx("label",{htmlFor:"entity-field-options",children:"Enum Options *"}),a.jsx("textarea",{id:"entity-field-options",value:f.enumChoices,onChange:S("enumChoices"),placeholder:"Comma separated values, e.g. Lawful Good, Neutral, Chaotic Evil",rows:3,disabled:l}),a.jsx("p",{className:"field-hint",children:"Comma-separated list of allowed values."})]}),g&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"form-group form-group-full",children:[a.jsx("label",{htmlFor:"entity-field-reference-type",children:"Reference Type *"}),a.jsxs("select",{id:"entity-field-reference-type",value:f.reference_type_id,onChange:S("reference_type_id"),disabled:l,children:[a.jsx("option",{value:"",children:"Select entity type"}),v.map(N=>a.jsx("option",{value:N.value,children:N.label},N.value))]}),a.jsx("p",{className:"field-hint",children:"Choose which entity type this field should reference."})]}),a.jsxs("div",{className:"form-group form-group-full",children:[a.jsx("label",{htmlFor:"entity-field-reference-filter",children:"Reference Filter"}),a.jsx("textarea",{id:"entity-field-reference-filter",value:f.reference_filter,onChange:S("reference_filter"),placeholder:'Optional JSON filter, e.g. {"metadata.subtype": "Town"}',rows:4,disabled:l}),a.jsx("p",{className:"field-hint",children:"Limit selectable entities by filter criteria."})]})]})]}),h&&a.jsx("div",{className:"form-error",role:"alert",children:h}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:i,disabled:l,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:l,children:l?"Saving...":"Save Field"})]})]})}const gI=[{value:"equals",label:"Equals"},{value:"not_equals",label:"Does not equal"},{value:"contains",label:"Contains"},{value:"not_contains",label:"Does not contain"},{value:"in",label:"Is one of"},{value:"not_in",label:"Is not one of"},{value:"gt",label:"Greater than"},{value:"gte",label:"Greater than or equal"},{value:"lt",label:"Less than"},{value:"lte",label:"Less than or equal"},{value:"is_set",label:"Has a value"},{value:"is_not_set",label:"Is empty"}],bI=[{value:"show",label:"Show field"},{value:"hide",label:"Hide field"}],vI=[{value:"all",label:"All conditions must match"},{value:"any",label:"Any condition can match"},{value:"none",label:"None of the conditions can match"}],xI=new Set(["is_set","is_not_set"]),ty=()=>({field:"",operator:"equals",valuesText:""}),ny=()=>({target:"",action:"show"}),SI=(e=[])=>Array.isArray(e)?e.map((t,r)=>{if(t==null)return null;if(typeof t=="object"){const l=t.value??t.id??t.key??t.slug??`choice-${r}`;if(l==null)return null;const c=t.label??t.name??t.title??t.display??l;return{value:String(l),label:String(c??l)}}const i=String(t);return{value:i,label:i}}).filter(Boolean):[],wI=(e=[])=>!Array.isArray(e)||!e.length?[ty()]:e.map(t=>({field:t.field||t.fieldKey||"",operator:t.operator||"equals",valuesText:Array.isArray(t.values)?t.values.join(", "):""})),NI=(e=[])=>!Array.isArray(e)||!e.length?[ny()]:e.map(t=>({target:t.target||t.field||"",action:t.action||"show"})),mp=e=>e.split(",").map(t=>t.trim()).filter(t=>t.length>0);function EI({fields:e=[],initialData:t=null,onSubmit:r,onCancel:i,submitting:l=!1,errorMessage:c=""}){const[f,m]=u.useState(""),[h,p]=u.useState("all"),[y,g]=u.useState([ty()]),[v,S]=u.useState([ny()]),[w,N]=u.useState("");u.useEffect(()=>{m(t?.name||""),p(t?.match_mode||t?.matchMode||"all"),g(wI(t?.conditions)),S(NI(t?.actions))},[t]),u.useEffect(()=>{N(c||"")},[c]);const j=u.useMemo(()=>e.map(H=>({value:H.id||H.name,label:H.label||H.name})),[e]),_=u.useMemo(()=>{const H=new Map;return e.forEach(Y=>{if(!Y)return;const V=I=>{if(I==null)return;const F=String(I);F&&(H.set(F,Y),H.set(F.toLowerCase(),Y))};V(Y.id),V(Y.field_id),V(Y.fieldId),V(Y.name),V(Y.key)}),H},[e]),C=u.useCallback(H=>{if(H==null)return null;const Y=String(H);return _.get(Y)||_.get(Y.toLowerCase())||null},[_]),O=(H,Y,V)=>{g(I=>{const F=I.slice();return F[H]={...F[H],[Y]:V},F})},E=(H,Y,V)=>{S(I=>{const F=I.slice();return F[H]={...F[H],[Y]:V},F})},T=()=>g(H=>[...H,ty()]),M=H=>g(Y=>Y.length===1?Y:Y.filter((V,I)=>I!==H)),A=()=>S(H=>[...H,ny()]),z=H=>S(Y=>Y.length===1?Y:Y.filter((V,I)=>I!==H)),P=u.useCallback((H,Y)=>{g(V=>{if(!Array.isArray(V)||H<0||H>=V.length)return V;const I=V.slice(),F=I[H];if(!F)return V;const D=mp(F.valuesText||""),L=String(Y);let B;return D.includes(L)?B=D.filter(k=>k!==L):B=[...D,L],I[H]={...F,valuesText:B.join(", ")},I})},[]),X=async H=>{if(H.preventDefault(),!y.length){N("Add at least one condition.");return}if(!v.length){N("Add at least one action.");return}const Y=y.map(F=>({field:F.field,operator:F.operator,values:mp(F.valuesText||"")})).filter(F=>F.field&&F.operator);if(!Y.length){N("Each condition needs a field and operator.");return}const V=v.map(F=>({target:F.target,action:F.action})).filter(F=>F.target&&F.action);if(!V.length){N("Each action needs a target and action type.");return}const I={name:f.trim(),match_mode:h,conditions:Y,actions:V};try{if(await r?.(I)===!1)return;N("")}catch(F){N(F.message||"Failed to save rule")}};return a.jsxs("form",{className:"field-rule-form",onSubmit:X,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"field-rule-name",children:"Rule Name"}),a.jsx("input",{id:"field-rule-name",type:"text",value:f,onChange:H=>m(H.target.value),placeholder:"e.g. Show hometown when origin is set",disabled:l})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"field-rule-match-mode",children:"When should this rule run?"}),a.jsx("select",{id:"field-rule-match-mode",value:h,onChange:H=>p(H.target.value),disabled:l,children:vI.map(H=>a.jsx("option",{value:H.value,children:H.label},H.value))})]}),a.jsxs("div",{className:"field-rule-editor-section",children:[a.jsxs("div",{className:"field-rule-editor-heading",children:[a.jsx("h3",{children:"Conditions"}),a.jsx("button",{type:"button",className:"btn ghost",onClick:T,disabled:l,children:"Add condition"})]}),a.jsx("p",{className:"field-hint",children:"Fields to watch before applying the actions."}),a.jsx("div",{className:"field-rule-list",role:"list",children:y.map((H,Y)=>a.jsxs("div",{className:"field-rule-row",role:"listitem",children:[a.jsxs("select",{value:H.field,onChange:V=>O(Y,"field",V.target.value),disabled:l,children:[a.jsx("option",{value:"",children:"Choose field"}),j.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))]}),a.jsx("select",{value:H.operator,onChange:V=>O(Y,"operator",V.target.value),disabled:l,children:gI.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))}),(()=>{const V=C(H.field),F=(V?.data_type||V?.dataType)==="enum"?SI(V?.options?.choices):[],D=xI.has(H.operator);if(!D&&F.length>0){const B=new Set(mp(H.valuesText||""));return a.jsx("div",{className:"field-rule-enum-values",role:"group","aria-label":"Enum choices",children:F.map(k=>a.jsxs("label",{className:"field-rule-enum-option",children:[a.jsx("input",{type:"checkbox",checked:B.has(k.value),onChange:()=>P(Y,k.value),disabled:l}),a.jsx("span",{children:k.label})]},`${k.value}-${Y}`))})}return a.jsx("input",{type:"text",value:H.valuesText,onChange:B=>O(Y,"valuesText",B.target.value),placeholder:"Comma separated values",disabled:l||D})})(),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>M(Y),disabled:y.length===1||l,title:"Remove condition",children:""})]},`condition-${Y}`))})]}),a.jsxs("div",{className:"field-rule-editor-section",children:[a.jsxs("div",{className:"field-rule-editor-heading",children:[a.jsx("h3",{children:"Actions"}),a.jsx("button",{type:"button",className:"btn ghost",onClick:A,disabled:l,children:"Add action"})]}),a.jsx("p",{className:"field-hint",children:"Choose what should happen when the conditions above match."}),a.jsx("div",{className:"field-rule-list",role:"list",children:v.map((H,Y)=>a.jsxs("div",{className:"field-rule-row",role:"listitem",children:[a.jsxs("select",{value:H.target,onChange:V=>E(Y,"target",V.target.value),disabled:l,children:[a.jsx("option",{value:"",children:"Choose field"}),j.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))]}),a.jsx("select",{value:H.action,onChange:V=>E(Y,"action",V.target.value),disabled:l,children:bI.map(V=>a.jsx("option",{value:V.value,children:V.label},V.value))}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>z(Y),disabled:v.length===1||l,title:"Remove action",children:""})]},`action-${Y}`))})]}),w&&a.jsx("div",{className:"form-error",role:"alert",children:w}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:i,disabled:l,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:l,children:l?"Saving":"Save Rule"})]})]})}const jI=new Set(["system_admin"]),hp={text:"Text",number:"Number",boolean:"Boolean",date:"Date",enum:"Enum",reference:"Reference"},_I={equals:"equals",not_equals:"does not equal",contains:"contains",not_contains:"does not contain",in:"is one of",not_in:"is not one of",gt:"is greater than",gte:"is greater than or equal to",lt:"is less than",lte:"is less than or equal to",is_set:"is set",is_not_set:"is empty"},CI={show:"Show",hide:"Hide"},CS={all:"All conditions must match",any:"Any condition can match",none:"No conditions can match"};function AI(){const{id:e}=vs(),t=zn(),{user:r,token:i,sessionReady:l}=En(),[c,f]=u.useState(null),[m,h]=u.useState([]),[p,y]=u.useState([]),[g,v]=u.useState(!1),[S,w]=u.useState(!1),[N,j]=u.useState(""),[_,C]=u.useState(""),[O,E]=u.useState(!1),[T,M]=u.useState(null),[A,z]=u.useState(!1),[P,X]=u.useState(""),[H,Y]=u.useState(""),[V,I]=u.useState(null),[F,D]=u.useState([]),[L,B]=u.useState([]),[k,U]=u.useState([]),[R,q]=u.useState(!1),[G,J]=u.useState(!1),[ie,Z]=u.useState(""),[me,Q]=u.useState(!1),[ue,ne]=u.useState(!1),[we,Pe]=u.useState(""),[Re,Ce]=u.useState(!1),[it,qe]=u.useState(null),[We,ke]=u.useState(!1),[xt,Mt]=u.useState(""),[Ct,At]=u.useState(""),[He,Qe]=u.useState(""),W=c?.name||"Entity Type",ee=u.useMemo(()=>!c||!r?!1:jI.has(r.role)||c.world_owner_id&&c.world_owner_id===r.id||c.created_by&&c.created_by===r.id?!0:Array.isArray(c.managers)?c.managers.some(oe=>oe===r.id):!1,[c,r]),te=oe=>{if(!oe)return"";const{options:re}=oe;return re?Array.isArray(re.choices)&&re.choices.length>0?re.choices.join(", "):typeof re=="string"&&re.trim()?re:"":""},ve=u.useCallback((oe,re="info")=>{I({message:oe,tone:re})},[]);u.useEffect(()=>{if(!V)return;const oe=setTimeout(()=>I(null),3500);return()=>clearTimeout(oe)},[V]);const le=oe=>oe?Array.isArray(oe)?oe:oe?.data?oe.data:oe:null,Se=u.useCallback(async()=>{if(e){v(!0),j("");try{const oe=await ak(e),re=le(oe);f(re)}catch(oe){console.error(" Failed to load entity type details",oe),j(oe.message||"Failed to load entity type")}finally{v(!1)}}},[e]),Ee=u.useCallback(async oe=>{const re=typeof oe=="string"?oe.trim():oe||"";if(!re){h([]);return}try{const Ne=await Qr({worldId:re}),Be=le(Ne);Array.isArray(Be)?h(Be):h([])}catch(Ne){console.error(" Failed to load reference types",Ne),h([])}},[]),ge=u.useCallback(async()=>{if(e){w(!0),C("");try{const oe=await uN(e),re=le(oe);y(Array.isArray(re)?re:[])}catch(oe){console.error(" Failed to load fields",oe),C(oe.message||"Failed to load fields"),y([])}finally{w(!1)}}},[e]),at=u.useCallback(async()=>{if(e){Q(!0),ne(!0),Z(""),Pe("");try{const[oe,re]=await Promise.all([uf(e).catch(Ne=>(console.error(" Failed to load field order",Ne),Z(Ne.message||"Failed to load field order"),null)),df(e).catch(Ne=>(console.error(" Failed to load field rules",Ne),Pe(Ne.message||"Failed to load conditional rules"),null))]);D(Gr(oe)),B(Gr(re))}catch(oe){Z(oe.message||"Failed to load field order"),Pe(oe.message||"Failed to load conditional rules"),D([]),B([])}finally{Q(!1),ne(!1)}}},[e]);u.useEffect(()=>{!l||!i||(Se(),ge(),at())},[l,i,Se,ge,at]),u.useEffect(()=>{if(!c){h([]);return}const oe=c?.world_id||c?.worldId||c?.world?.id||"";Ee(oe)},[c,c?.world_id,c?.worldId,c?.world?.id,Ee]),u.useEffect(()=>{l&&(i||t("/login"))},[l,i,t]);const st=u.useCallback(()=>!Array.isArray(p)||p.length===0?[]:Yy(p,F).map((re,Ne)=>({id:re.id,name:re.name,label:re.label||re.name,data_type:re.data_type,required:re.required,order:Ne})),[p,F]);u.useEffect(()=>{R||U(st())},[st,R]);const nt=u.useCallback(()=>{q(!1),U(st())},[st]),ze=u.useMemo(()=>{const oe=new Map;return p.forEach(re=>{if(!re)return;const Ne=re.label||re.name||"Field";re.id&&(oe.set(re.id,Ne),oe.set(String(re.id).toLowerCase(),Ne)),re.name&&(oe.set(re.name,Ne),oe.set(re.name.toLowerCase(),Ne))}),oe},[p]),ft=u.useCallback(oe=>{if(!oe)return"";const re=ze.get(oe.field)||oe.field,Ne=_I[oe.operator]||oe.operator,Be=Array.isArray(oe.values)?oe.values.filter(Boolean):[];return!Be.length||["is_set","is_not_set"].includes(oe.operator)?`${re} ${Ne}`:`${re} ${Ne} ${Be.join(", ")}`},[ze]),zt=u.useCallback(oe=>{if(!oe)return"";const re=ze.get(oe.target)||oe.target;return`${CI[oe.action]||oe.action} ${re}`},[ze]),Rt=()=>{ee&&(M(null),Y(""),E(!0))},pt=oe=>{ee&&(M(oe),Y(""),E(!0))},ct=()=>{E(!1),M(null),Y("")},yt=async oe=>{if(!ee)return!1;try{z(!0),Y(""),T?.id?(await V3(T.id,oe),ve("Field updated","success")):(await P3(e,oe),ve("Field created","success")),ct(),await ge(),await at()}catch(re){console.error(" Failed to save field",re);const Ne=re.message||"Failed to save field";return Y(Ne),ve(Ne,"error"),!1}finally{z(!1)}return!0},Tt=async oe=>{if(!(!ee||!oe?.id||!window.confirm(`Delete field "${oe.label||oe.name}"? This action cannot be undone.`)))try{X(oe.id),await Y3(oe.id),ve("Field deleted","success"),await ge(),await at()}catch(Ne){console.error(" Failed to delete field",Ne),ve(Ne.message||"Failed to delete field","error")}finally{X("")}},Ft=(oe,re)=>{U(Ne=>{const Be=oe+re;if(Be<0||Be>=Ne.length)return Ne;const Ke=Ne.slice(),[ot]=Ke.splice(oe,1);return Ke.splice(Be,0,ot),Ke.map((Oe,ce)=>({...Oe,order:ce}))}),q(!0)},kt=async()=>{if(!(!ee||!R)){J(!0);try{const oe=k.map((re,Ne)=>({field_id:re.id,section_order:0,column_order:0,field_order:Ne,priority:Ne}));await ik(e,{entries:oe}),ve("Field order updated","success"),q(!1),await at()}catch(oe){const re=oe.message||"Failed to update field order";Z(re),ve(re,"error")}finally{J(!1)}}},Zt=(oe=null)=>{ee&&(qe(oe),Mt(""),Ce(!0))},Lt=()=>{Ce(!1),qe(null),Mt("")},Kt=async oe=>{if(!ee)return!1;try{ke(!0),Mt(""),it?.id?(await Bh(it.id,oe),ve("Rule updated","success")):(await lk(e,oe),ve("Rule created","success")),Lt(),await at()}catch(re){const Ne=re.message||"Failed to save rule";return Mt(Ne),ve(Ne,"error"),!1}finally{ke(!1)}return!0},se=async oe=>{if(!(!ee||!oe?.id||!window.confirm(`Delete the rule "${oe.name||"Untitled rule"}"?`)))try{At(oe.id),await ok(oe.id),ve("Rule deleted","success"),await at()}catch(Ne){ve(Ne.message||"Failed to delete rule","error")}finally{At("")}},be=async(oe,re)=>{if(!ee||!oe?.id)return;const Ne=L.findIndex(ot=>ot.id===oe.id),Be=Ne+re;if(Ne===-1||Be<0||Be>=L.length)return;const Ke=L[Be];try{Qe(oe.id),await Promise.all([Bh(oe.id,{priority:Be}),Bh(Ke.id,{priority:Ne})]),ve("Rule order updated","success"),await at()}catch(ot){ve(ot.message||"Failed to reorder rule","error")}finally{Qe("")}},je=oe=>{if(!oe)return"";const re=new Date(oe);return Number.isNaN(re.getTime())?"":re.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},Ze=u.useMemo(()=>{const oe=new Map;return m.forEach(re=>{re?.id&&oe.set(re.id,re.name)}),oe},[m]),dt=u.useMemo(()=>!Array.isArray(m)||!m.length?[]:c?.world_id?m.filter(oe=>{if(!oe)return!1;if(!c.world_id)return!0;const re=oe.world_id??oe.worldId??oe.world?.id;return re?re===c.world_id:!0}):m,[c,m]),gt=N||_;return l?i?a.jsxs("section",{className:"entity-type-fields-page",children:[a.jsxs("div",{className:"entity-type-fields-header",children:[a.jsxs("div",{className:"entity-type-fields-heading",children:[a.jsxs("button",{type:"button",className:"link-button",onClick:()=>t("/entity-types"),children:[a.jsx(Iy,{size:16})," Back to Entity Types"]}),a.jsxs("h1",{children:["Fields for ",W]}),c?.world_name&&a.jsxs("p",{className:"entity-type-fields-subtitle",children:["World: ",c.world_name]})]}),ee&&a.jsxs("button",{type:"button",className:"btn submit",onClick:Rt,disabled:A||P,children:[a.jsx(Pa,{size:18})," Add Field"]})]}),!ee&&a.jsx("div",{className:"alert info",role:"status",children:"You can view these fields, but only the world owner or system administrators can make changes."}),V&&a.jsx("div",{className:`toast-banner ${V.tone}`,role:"status",children:V.message}),gt&&a.jsx("div",{className:"alert error",role:"alert",children:gt}),a.jsx("div",{className:"entity-types-table-wrapper",children:g||S?a.jsx("div",{className:"empty-state",children:"Loading fields..."}):p.length===0?a.jsx("div",{className:"empty-state",children:"No custom fields defined yet."}):a.jsxs("table",{className:"entity-types-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Field Name"}),a.jsx("th",{children:"Label"}),a.jsx("th",{children:"Data Type"}),a.jsx("th",{children:"Reference Type"}),a.jsx("th",{children:"Required"}),a.jsx("th",{children:"Created"}),ee&&a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:p.map(oe=>{const re=oe.createdAt||oe.created_at,Ne=oe.reference_type_name||Ze.get(oe.reference_type_id),Be=hp[oe.data_type]||oe.data_type;return a.jsxs("tr",{children:[a.jsx("td",{children:oe.name}),a.jsx("td",{children:oe.label||""}),a.jsx("td",{children:Be}),a.jsx("td",{children:Ne||(oe.data_type==="reference"?"":"N/A")}),a.jsx("td",{children:oe.required?"Yes":"No"}),a.jsx("td",{children:je(re)}),ee&&a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-type-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Edit field",onClick:()=>pt(oe),disabled:A||P===oe.id,children:a.jsx(ar,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete field",onClick:()=>Tt(oe),disabled:P===oe.id||A,children:a.jsx(fa,{size:16})})]})})]},oe.id)})})]})}),a.jsxs("section",{className:"field-layout-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsxs("h2",{children:[a.jsx(C1,{size:18})," Field order"]}),ee&&a.jsxs("div",{className:"layout-card-actions",children:[a.jsx("button",{type:"button",className:"btn ghost",onClick:nt,disabled:G||!R,children:"Reset"}),a.jsx("button",{type:"button",className:"btn submit",onClick:kt,disabled:G||!R||k.length===0,children:G?"Saving":"Save order"})]})]}),a.jsx("p",{className:"card-description",children:"Use this list to control how the metadata fields appear on entity forms and detail pages."}),ie&&a.jsx("div",{className:"alert error",role:"alert",children:ie}),me?a.jsx("div",{className:"card-placeholder",children:"Loading layout"}):k.length===0?a.jsx("div",{className:"card-placeholder",children:"No fields available to order yet."}):a.jsx("ol",{className:"field-layout-list",children:k.map((oe,re)=>a.jsxs("li",{className:"field-layout-row",children:[a.jsxs("div",{className:"field-layout-info",children:[a.jsx("span",{className:"field-layout-index",children:re+1}),a.jsxs("div",{className:"field-layout-details",children:[a.jsx("span",{className:"field-layout-name",children:oe.label||oe.name}),a.jsx("span",{className:"field-layout-meta",children:hp[oe.data_type]||oe.data_type})]})]}),ee&&a.jsxs("div",{className:"layout-controls",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Ft(re,-1),disabled:re===0||G,title:"Move up",children:a.jsx(D0,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Ft(re,1),disabled:re===k.length-1||G,title:"Move down",children:a.jsx(k0,{size:16})})]})]},oe.id||oe.name||re))})]}),a.jsxs("section",{className:"field-rules-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsxs("h2",{children:[a.jsx(Ii,{size:18})," Conditional rules"]}),ee&&a.jsxs("button",{type:"button",className:"btn submit",onClick:()=>Zt(null),disabled:We,children:[a.jsx(Pa,{size:16})," Add rule"]})]}),a.jsx("p",{className:"card-description",children:"Automatically show or hide fields when other metadata matches specific conditions."}),we&&a.jsx("div",{className:"alert error",role:"alert",children:we}),ue?a.jsx("div",{className:"card-placeholder",children:"Loading rules"}):L.length===0?a.jsx("div",{className:"card-placeholder",children:"No conditional rules have been configured."}):a.jsx("div",{className:"field-rules-list",children:L.map((oe,re)=>a.jsxs("article",{className:"field-rule-card",children:[a.jsxs("div",{className:"field-rule-content",children:[a.jsx("h3",{children:oe.name||`Rule ${re+1}`}),a.jsx("p",{className:"field-rule-match",children:CS[oe.match_mode]||CS.all}),a.jsx("ul",{className:"field-rule-condition-list",children:Array.isArray(oe.conditions)&&oe.conditions.map((Ne,Be)=>a.jsx("li",{children:ft(Ne)},`condition-${oe.id}-${Be}`))}),a.jsx("div",{className:"field-rule-action-list",children:Array.isArray(oe.actions)&&oe.actions.map((Ne,Be)=>a.jsx("span",{children:zt(Ne)},`action-${oe.id}-${Be}`))})]}),ee&&a.jsxs("div",{className:"field-rule-controls",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>be(oe,-1),disabled:re===0||He===oe.id,title:"Move rule up",children:a.jsx(D0,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>be(oe,1),disabled:re===L.length-1||He===oe.id,title:"Move rule down",children:a.jsx(k0,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Zt(oe),title:"Edit rule",disabled:We||Ct===oe.id,children:a.jsx(ar,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>se(oe),title:"Delete rule",disabled:Ct===oe.id||We,children:a.jsx(fa,{size:16})})]})]},oe.id))})]}),a.jsx("div",{className:"entity-type-cards",children:g||S?a.jsx("div",{className:"card-placeholder",children:"Loading fields..."}):p.length===0?a.jsx("div",{className:"card-placeholder",children:"No custom fields defined yet."}):p.map(oe=>{const re=oe.createdAt||oe.created_at,Ne=oe.reference_type_name||Ze.get(oe.reference_type_id),Be=hp[oe.data_type]||oe.data_type;return a.jsxs("div",{className:"entity-type-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsx("h3",{children:oe.label||oe.name}),ee&&a.jsxs("div",{className:"entity-type-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Edit field",onClick:()=>pt(oe),disabled:A||P===oe.id,children:a.jsx(ar,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",title:"Delete field",onClick:()=>Tt(oe),disabled:P===oe.id||A,children:a.jsx(fa,{size:16})})]})]}),a.jsxs("dl",{className:"field-card-metadata",children:[a.jsxs("div",{children:[a.jsx("dt",{children:"Field Name"}),a.jsx("dd",{children:oe.name})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Data Type"}),a.jsx("dd",{children:Be})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Required"}),a.jsx("dd",{children:oe.required?"Yes":"No"})]}),oe.data_type==="enum"&&a.jsxs("div",{children:[a.jsx("dt",{children:"Options"}),a.jsx("dd",{children:te(oe)})]}),oe.data_type==="reference"&&a.jsxs("div",{children:[a.jsx("dt",{children:"Reference Type"}),a.jsx("dd",{children:Ne||""})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Created"}),a.jsx("dd",{children:je(re)})]})]})]},`field-card-${oe.id}`)})}),O&&a.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"side-panel",children:[a.jsxs("div",{className:"side-panel-header",children:[a.jsx("h2",{children:T?"Edit Field":"Add Field"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:ct,title:"Close form",disabled:A,children:a.jsx(Ra,{size:18})})]}),a.jsx("div",{className:"side-panel-content",children:a.jsx(yI,{initialData:T,referenceTypes:dt,onSubmit:yt,onCancel:ct,submitting:A,errorMessage:H})})]})}),Re&&a.jsx("div",{className:"side-panel-overlay",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"side-panel",children:[a.jsxs("div",{className:"side-panel-header",children:[a.jsx("h2",{children:it?"Edit conditional rule":"Add conditional rule"}),a.jsx("button",{type:"button",className:"icon-btn",onClick:Lt,title:"Close form",disabled:We,children:a.jsx(Ra,{size:18})})]}),a.jsx("div",{className:"side-panel-content",children:a.jsx(EI,{fields:p,initialData:it,onSubmit:Kt,onCancel:Lt,submitting:We,errorMessage:xt})})]})})]}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const TI="Create Entity Type",MI=[{title:"Details",columns:1,fields:[{key:"name",label:"Name",type:"text",placeholder:"e.g. Faction"},{key:"world_id",label:"World",type:"select",optionsSource:"worlds",placeholder:"Select the world this type belongs to",required:!0},{key:"description",label:"Description",type:"textarea",placeholder:"Optional description for this entity type"}]}],RI={title:TI,sections:MI};function kI(){const e=zn(),{user:t,token:r,sessionReady:i}=En(),{selectedCampaign:l}=Bn(),[c,f]=u.useState(!1),m=u.useMemo(()=>{if(!l?.world)return"";const w=l.world;return w.created_by||w.creator?.id||w.owner_id||w.owner?.id||""},[l]),h=!!(t?.id&&m===t.id),p=u.useMemo(()=>t?t.role==="system_admin"?!0:h:!1,[t,h]),y=l?.world?.id??"",g=l?.world?.name??"";if(!i)return a.jsx("p",{children:"Restoring session..."});if(!r)return a.jsx("p",{children:"Authenticating..."});if(!p)return a.jsxs("section",{className:"page limited-access",children:[a.jsx("h1",{children:"Create Entity Type"}),a.jsx("p",{children:"Only system administrators or the world owner can create entity types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/entity-types"),children:"Back to Entity Types"})]});if(!y)return a.jsxs("section",{className:"page create-entity-type",children:[a.jsx("h1",{children:"Create Entity Type"}),a.jsx("p",{children:"Select a campaign from the header to choose a world context before creating entity types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/entity-types"),children:"Back to Entity Types"})]});const v=()=>{e("/entity-types")},S=async w=>{if(c)return!1;const N=typeof w?.name=="string"?w.name.trim():"",j=typeof w?.description=="string"?w.description.trim():"",C=(typeof w?.world_id=="string"&&w.world_id||typeof w?.worldId=="string"&&w.worldId||w?.world&&typeof w.world.id=="string"&&w.world.id||y||"").trim();if(!N)return alert("Name is required"),!1;if(!C)return alert("Select a world before creating the entity type"),!1;f(!0);try{const E=await nk({name:N,description:j,world_id:C}),T=E?.data??E;return!T||!T.id?(alert("Failed to create entity type"),!1):(e(`/entity-types/${T.id}/fields`),!0)}catch(O){return alert(`Failed to create entity type: ${O.message}`),!1}finally{f(!1)}};return a.jsxs("section",{className:"page create-entity-type",children:[c&&a.jsx("div",{className:"form-status",role:"status","aria-live":"polite",children:"Saving entity type..."}),a.jsx(ps,{schema:RI,initialData:{world_id:y,world:y?{id:y,name:g||"Selected world"}:void 0},onSubmit:S,onCancel:v,showUpdateAction:!1})]})}const $N=u.createContext({}),DI=new Set(["true","1","yes","on"]),AS=e=>{if(e==null)return;if(typeof e=="boolean")return e;const t=String(e).trim().toLowerCase();if(t!=="")return DI.has(t)},II=e=>{const t=AS(e);if(t!==void 0)return t;const r=AS("true");return r!==void 0?r:!1};function LI({children:e,initialFeatures:t={}}){const r=II(t.rel_builder_v2),i=u.useMemo(()=>({...t,rel_builder_v2:r}),[t,r]);return a.jsx($N.Provider,{value:i,children:e})}const OI=()=>u.useContext($N),zI=e=>!!OI()?.[e],$I="visible",FI=e=>{if(!e)return null;const t=e.id??e.value??e.entity_type_id??e.entityTypeId??(typeof e=="string"||typeof e=="number"?e:null);if(t==null||t==="")return null;const r=e.name||e.label||e.title||e.display||e.slug||(typeof e=="string"||typeof e=="number"?String(e):"Untitled type");return{id:String(t),name:String(r)}};function TS({allowedTypeIds:e=[],defaultTypeId:t="",worldId:r,onCreated:i,onCancel:l,entityTypes:c=[],onToast:f}){const[m,h]=u.useState({name:"",entityTypeId:"",summary:""}),[p,y]=u.useState(!1),[g,v]=u.useState(""),[S,w]=u.useState(""),N=u.useRef(!1),j=u.useMemo(()=>new Set((e||[]).map(A=>String(A))),[e]),_=u.useMemo(()=>{const A=(Array.isArray(c)?c:[]).map(z=>FI(z)).filter(Boolean);return j.size===0?A:A.filter(z=>j.has(z.id))},[c,j]),C=u.useMemo(()=>t&&j.size>0&&j.has(String(t))?String(t):_.length>0?_[0].id:t?String(t):"",[t,j,_]);u.useEffect(()=>{h(A=>({...A,entityTypeId:C}))},[C]);const O=u.useCallback(()=>{h({name:"",entityTypeId:C,summary:""}),v(""),w(""),N.current=!1},[C]),E=A=>z=>{const{value:P}=z.target;h(X=>({...X,[A]:P}))};u.useEffect(()=>{if(!m.entityTypeId){w("");return}j.size>0&&!j.has(String(m.entityTypeId))?(w("This type is not allowed for the selected relationship."),N.current||(f?.("This entity type is not allowed for this relationship.","warning"),N.current=!0)):(w(""),N.current=!1)},[m.entityTypeId,j,f]);const T=async A=>{if(A.preventDefault(),!r){v("Select a world before creating entities.");return}const z=m.name.trim();if(!z){v("Name is required.");return}const P=m.entityTypeId;if(!P){v("Entity type is required.");return}if(j.size>0&&!j.has(String(P))){w("This type is not allowed for the selected relationship."),N.current||(f?.("This entity type is not allowed for this relationship.","warning"),N.current=!0);return}try{y(!0),v("");const X={world_id:r,name:z,entity_type_id:P,visibility:$I},H=m.summary.trim();H&&(X.description=H);const Y=await Hy(X),V=Y?.data?.data??Y?.data??Y;if(!V||V.id===void 0||V.id===null)throw new Error("Failed to create entity");i?.(V),O()}catch(X){v(X.message||"Could not create entity. Please try again."),f?.("Could not create entity. Please try again.","error")}finally{y(!1)}},M=p||!m.name.trim()||!m.entityTypeId||j.size>0&&!j.has(String(m.entityTypeId))||_.length===0;return a.jsxs("div",{className:"entity-mini-create-inline",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-mini-name",children:"Name *"}),a.jsx("input",{id:"entity-mini-name",type:"text",value:m.name,onChange:E("name"),disabled:p,required:!0})]}),a.jsxs("div",{className:"form-two-column",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-mini-type",children:"Type *"}),a.jsxs("select",{id:"entity-mini-type",value:m.entityTypeId,onChange:E("entityTypeId"),disabled:p||_.length===0,required:!0,children:[a.jsx("option",{value:"",children:"Select type..."}),_.map(A=>a.jsx("option",{value:A.id,children:A.name},A.id))]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"entity-mini-summary",children:"Summary"}),a.jsx("input",{id:"entity-mini-summary",type:"text",value:m.summary,onChange:E("summary"),placeholder:"Optional short summary",disabled:p})]})]}),(g||S)&&a.jsx("div",{className:`form-error${S?" warning":""}`,role:"alert",children:S||g}),a.jsxs("div",{className:"inline-actions",children:[a.jsx("button",{type:"button",className:"btn secondary",onClick:l,disabled:p,children:"Cancel"}),a.jsx("button",{type:"button",className:"btn",disabled:M,onClick:T,children:p?"Creating":"Save"})]})]})}const BI=[{value:"source",label:"This entity is the source"},{value:"target",label:"This entity is the target"}];function UI({value:e,onChange:t,disabled:r=!1}){const i=l=>{const c=l.target.value==="target"?"target":"source";c!==e&&t?.(c)};return a.jsxs("fieldset",{className:"perspective-toggle",disabled:r,children:[a.jsx("legend",{children:"Relationship Perspective"}),a.jsx("div",{role:"radiogroup","aria-label":"Relationship perspective",className:"perspective-toggle-options",children:BI.map(l=>{const c=["perspective-toggle-option"];return l.value===e&&c.push("active"),r&&c.push("disabled"),a.jsxs("label",{className:c.join(" "),children:[a.jsx("input",{type:"radio",name:"relationship-perspective",value:l.value,checked:e===l.value,onChange:i,disabled:r}),a.jsx("span",{children:l.label})]},l.value)})})]})}const Zu=e=>e==null?"":String(e).trim(),qI=e=>{if(e==null)return"";if(typeof e=="object")try{return JSON.stringify(e)}catch{return""}return String(e)},HI=e=>{const t=e.trim();if(!t)return"";if(t==="true")return!0;if(t==="false")return!1;const r=t[0],i=t[t.length-1];if(r==="{"&&i==="}"||r==="["&&i==="]")try{return JSON.parse(t)}catch{return e}const l=Number(t);return!Number.isNaN(l)&&t!==""?l:e},Qu=e=>{if(!Array.isArray(e)||e.length===0)return"";if(e.length===1)return e[0];if(e.length===2)return`${e[0]} or ${e[1]}`;const t=e.slice(0,-1),r=e[e.length-1];return`${t.join(", ")}, or ${r}`},PI=e=>{if(!e||e.id===void 0||e.id===null)return null;const t=e.entity_type_id??e.entityTypeId??e.entity_type?.id??e.entityType?.id??null,r=e.entityType||e.entity_type||(t&&e.entity_type_name?{id:t,name:e.entity_type_name}:null);return{...e,id:e.id,name:e.name||"Untitled entity",entity_type_id:t,entityType:r}},MS=e=>e?.name||e?.entityType?.name||e?.entity_type?.name||"",Wo=(e,t)=>{if(!e)return[];const r=t==="from"?e?.from_entity_types??e?.fromEntityTypes??e?.fromTypes??[]:e?.to_entity_types??e?.toEntityTypes??e?.toTypes??[];return Array.isArray(r)?r:[]},VI=e=>{if(!e)return"";if(typeof e=="string"||typeof e=="number")return String(e).trim();if(typeof e=="object"){if(e.id!==void 0&&e.id!==null)return String(e.id);if(e.entity_type_id!==void 0&&e.entity_type_id!==null)return String(e.entity_type_id);if(e.entityTypeId!==void 0&&e.entityTypeId!==null)return String(e.entityTypeId);if(e.entityType?.id!==void 0&&e.entityType?.id!==null)return String(e.entityType.id);if(e.entity_type?.id!==void 0&&e.entity_type?.id!==null)return String(e.entity_type.id)}return""},$o=(e,t)=>Wo(e,t).map(r=>VI(r)).filter(r=>r!=="");function YI({worldId:e,relationshipId:t,onCancel:r,onSaved:i,onToast:l,defaultFromEntityId:c,lockFromEntity:f=!1,defaultToEntityId:m,lockToEntity:h=!1,defaultPerspective:p="source",currentEntityId:y,currentEntityTypeId:g,formId:v="relationship-form",onStateChange:S,hideActions:w=!1}){const N=!!t,j=N,_=N,C=u.useRef(0),O=u.useCallback((fe="",he="")=>(C.current+=1,{id:C.current,key:fe,value:he}),[]),E=u.useCallback(fe=>fe.length>0?fe:[O()],[O]),T=u.useCallback(fe=>{if(!fe||typeof fe!="object"||Array.isArray(fe))return"";const he=fe.__direction||fe.direction;return he?String(he):""},[]),M=u.useCallback(fe=>{if(C.current=0,!fe||typeof fe!="object"||Array.isArray(fe))return[O()];const he=Object.entries(fe).filter(([Ve])=>typeof Ve!="string"?!0:!Ve.startsWith("__"));return he.length===0?[O()]:he.map(([Ve,vt])=>O(Ve,qI(vt)))},[O]),A=Zu(c),z=Zu(m),P=Zu(y),X=Zu(g),H=p==="target"?"reverse":"forward",Y=H==="forward"?A:"",V=H==="reverse"?z:"",[I,F]=u.useState([]),[D,L]=u.useState([]),[B,k]=u.useState([]),[U,R]=u.useState({fromEntityId:Y,toEntityId:V,relationshipTypeId:""}),[q,G]=u.useState(()=>(C.current=0,[O()])),[J,ie]=u.useState(H),[Z,me]=u.useState(!1),[Q,ue]=u.useState(!1),[ne,we]=u.useState(!1),[Pe,Re]=u.useState(!1),[Ce,it]=u.useState(!1),[qe,We]=u.useState(""),[ke,xt]=u.useState(""),[Mt,Ct]=u.useState(null),At=u.useRef({from:null,to:null}),[He,Qe]=u.useState({from:"",to:""}),W=J==="reverse"?"target":"source",ee=W==="source",te=u.useMemo(()=>W==="target"?h?"to":f?"from":"":f?"from":h?"to":"",[f,h,W]),ve=te==="from"?"to":te==="to"?"from":"",le=u.useMemo(()=>q.some(fe=>fe.key.trim()!==""||fe.value.trim()!==""),[q]);u.useEffect(()=>{let fe=!1;return e?((async()=>{me(!0);try{const Ve=await oc(e),vt=Array.isArray(Ve)?Ve:Array.isArray(Ve?.data)?Ve.data:[];fe||F(vt)}catch(Ve){fe||(F([]),We(Ve.message||"Failed to load entities"))}finally{fe||me(!1)}})(),()=>{fe=!0}):(F([]),()=>{})},[e]),u.useEffect(()=>{let fe=!1;return e?((async()=>{ue(!0);try{const Ve=await bf({worldId:e}),vt=Array.isArray(Ve)?Ve:Array.isArray(Ve?.data)?Ve.data:[];fe||L(vt)}catch(Ve){fe||(L([]),We(Ve.message||"Failed to load relationship types"))}finally{fe||ue(!1)}})(),()=>{fe=!0}):(L([]),ue(!1),()=>{})},[e]),u.useEffect(()=>{let fe=!1;return(async()=>{if(!e){k([]),we(!1);return}we(!0);try{const Ve=await Qr({worldId:e}),vt=Array.isArray(Ve)?Ve:Array.isArray(Ve?.data)?Ve.data:[];fe||k(vt)}catch(Ve){fe||(k([]),We(vt=>vt||Ve.message||"Failed to load entity types"))}finally{fe||we(!1)}})(),()=>{fe=!0}},[e]);const Se=fe=>{if(!fe)return"";const he=fe.entity_type_id??fe.entityTypeId??fe.entityType?.id??fe.entity_type?.id??"";return he?String(he):""},Ee=u.useMemo(()=>U.fromEntityId&&I.find(fe=>String(fe.id)===String(U.fromEntityId))||null,[I,U.fromEntityId]),ge=u.useMemo(()=>Se(Ee),[Ee]),at=u.useMemo(()=>U.toEntityId&&I.find(fe=>String(fe.id)===String(U.toEntityId))||null,[I,U.toEntityId]),st=u.useMemo(()=>Se(at),[at]),nt=u.useMemo(()=>te==="from"?ge||(P&&U.fromEntityId===P&&X||A&&U.fromEntityId===A&&X?X:""):te==="to"?st||(P&&U.toEntityId===P&&X||z&&U.toEntityId===z&&X?X:""):"",[te,ge,st,U.fromEntityId,U.toEntityId,P,X,A,z]),ze=u.useMemo(()=>J==="reverse"?te==="to"?"from":"to":"from",[J,te]),ft=u.useMemo(()=>J==="reverse"?te==="to"?"to":"from":"to",[J,te]),zt=u.useMemo(()=>{const fe=nt?String(nt):"";if(fe){if(te==="from")return{typeId:fe,role:ze};if(te==="to")return{typeId:fe,role:ft}}return ge?{typeId:String(ge),role:ze}:st?{typeId:String(st),role:ft}:null},[nt,te,ge,st,ze,ft]),Rt=u.useMemo(()=>{if(!D?.length)return[];const fe=(Ve,vt,Nt)=>{if(!Nt)return Ve;const Et=String(Nt);return Ve.filter(jt=>{const Wt=$o(jt,vt);return Wt.length===0?!0:Wt.includes(Et)})};let he=D;if(zt){const{typeId:Ve,role:vt}=zt;he=fe(he,vt,Ve)}return he=fe(he,ze,ge),he=fe(he,ft,st),he},[D,zt,ze,ft,ge,st]),pt=u.useMemo(()=>U.relationshipTypeId?D.find(fe=>String(fe.id)===String(U.relationshipTypeId)):null,[D,U.relationshipTypeId]),ct=u.useMemo(()=>pt?$o(pt,ze):[],[pt,ze]),yt=u.useMemo(()=>pt?$o(pt,ft):[],[pt,ft]),Tt=u.useMemo(()=>ct.length>0?String(ct[0]):"",[ct]),Ft=u.useMemo(()=>yt.length>0?String(yt[0]):"",[yt]),kt=fe=>{const he=fe==="target"?"reverse":"forward";xt(""),J!==he&&R(Ve=>{const vt={...Ve,relationshipTypeId:""};if(!N){const Nt=P||"";if(he==="reverse"){const Et=z||Nt;Et&&(vt.toEntityId=Et,f&&Ve.fromEntityId===Et&&(vt.fromEntityId=""))}else{const Et=A||Nt;Et&&(vt.fromEntityId=Et,h&&Ve.toEntityId===Et&&(vt.toEntityId=""))}}return vt}),ie(Ve=>Ve===he?Ve:he)},Zt=u.useCallback(fe=>{if(fe==="from"){if(te==="from")return;if(!ct.length){l?.("This entity type is not allowed for this relationship.","warning");return}}else{if(te==="to")return;if(!yt.length){l?.("This entity type is not allowed for this relationship.","warning");return}}Ct(fe)},[ct.length,yt.length,te,l]);u.useEffect(()=>{(Mt==="from"&&ct.length===0||Mt==="to"&&yt.length===0)&&Ct(null)},[Mt,ct.length,yt.length]);const Lt=u.useMemo(()=>{if(!ct.length)return I;const fe=new Set(ct);return I.filter(he=>fe.has(Se(he)))},[I,ct]),Kt=u.useMemo(()=>{if(!yt.length)return I;const fe=new Set(yt);return I.filter(he=>fe.has(Se(he)))},[I,yt]);u.useEffect(()=>{if(!U.relationshipTypeId)return;Rt.some(he=>String(he.id)===String(U.relationshipTypeId))||R(he=>({...he,relationshipTypeId:""}))},[Rt,U.relationshipTypeId]),u.useEffect(()=>{if(!U.relationshipTypeId||!ge)return;if(f||h||P){xt("");return}const fe=String(ge),he=D.find(jt=>String(jt.id)===String(U.relationshipTypeId));if(!he)return;const Ve=$o(he,"from"),vt=$o(he,"to"),Nt=Ve.includes(fe),Et=vt.includes(fe);if(Nt&&Et){xt("");return}if(Nt&&J!=="forward"){ie("forward"),xt("");return}if(!Nt&&Et){const jt="Direction auto-corrected because this entity is only allowed as a target.";J!=="reverse"?(ie("reverse"),xt(jt)):xt(Wt=>Wt||jt);return}!Nt&&!Et&&(xt(""),R(jt=>({...jt,relationshipTypeId:""})))},[U.relationshipTypeId,ge,D,J,f,h,P]),u.useEffect(()=>{if(!U.fromEntityId||!ct.length)return;const fe=new Set(ct),he=I.find(vt=>String(vt.id)===String(U.fromEntityId));if(!he)return;const Ve=Se(he);(!Ve||!fe.has(Ve))&&R(vt=>({...vt,fromEntityId:""}))},[ct,I,U.fromEntityId]),u.useEffect(()=>{if(!U.toEntityId||!yt.length)return;const fe=new Set(yt),he=I.find(vt=>String(vt.id)===String(U.toEntityId));if(!he)return;const Ve=Se(he);(!Ve||!fe.has(Ve))&&R(vt=>({...vt,toEntityId:""}))},[yt,I,U.toEntityId]);const se=u.useMemo(()=>{if(!pt)return"";const fe=Wo(pt,ze);return fe.length?fe.map(he=>he?.name||he?.entityType?.name||he?.entity_type?.name||"Unknown type").join(", "):""},[pt,ze]),be=u.useMemo(()=>{if(!pt)return"";const fe=Wo(pt,ft);return fe.length?fe.map(he=>he?.name||he?.entityType?.name||he?.entity_type?.name||"Unknown type").join(", "):""},[pt,ft]),je=ze==="from"?"source":"target",Ze=ft==="from"?"source":"target",dt=`Allowed ${je}s`,gt=`Allowed ${Ze}s`,oe=u.useMemo(()=>pt&&(J==="reverse"?pt.to_name||pt.toName:pt.from_name||pt.fromName)||"",[pt,J]),re=u.useMemo(()=>pt&&(J==="reverse"?pt.from_name||pt.fromName:pt.to_name||pt.toName)||"",[pt,J]),Ne=u.useMemo(()=>pt?Wo(pt,ze).map(fe=>MS(fe)).filter(fe=>fe&&fe.trim()):[],[pt,ze]),Be=u.useMemo(()=>pt?Wo(pt,ft).map(fe=>MS(fe)).filter(fe=>fe&&fe.trim()):[],[pt,ft]),Ke=u.useMemo(()=>!pt||!Ne.length&&!Be.length?"":Ne.length&&Be.length?`This relationship can only be initiated from ${Qu(Ne)} and targets ${Qu(Be)}.`:Ne.length?`This relationship can only be initiated from ${Qu(Ne)}.`:`This relationship targets ${Qu(Be)}.`,[pt,Ne,Be]),ot=u.useMemo(()=>{if(!te||!pt)return"";const fe=nt?String(nt):"";if(!fe)return"";if(te==="from"){if(ct.length>0&&!ct.includes(fe))return ee?"This entity is not an allowed source for the selected relationship type. Try switching perspective.":"This entity is not an allowed target for the selected relationship type. Try switching perspective."}else if(te==="to"&&yt.length>0&&!yt.includes(fe))return ee?"This entity is not an allowed target for the selected relationship type. Try switching perspective.":"This entity is not an allowed source for the selected relationship type. Try switching perspective.";return""},[te,pt,nt,ct,yt,ee]),Oe=u.useMemo(()=>te?te==="from"?ee?"This entity is fixed as the source for this relationship.":"This field is locked to the current entity.":te==="to"?ee?"This field is locked to the current entity.":"This entity is fixed as the target for this relationship.":"":"",[te,ee]),ce=!!ot;u.useEffect(()=>{let fe=!1;const he=()=>{C.current=0,R({fromEntityId:H==="forward"?A:"",toEntityId:H==="reverse"?z:"",relationshipTypeId:""}),G([O()]),ie(H),We(""),Ct(null)};return!N||!t?(he(),Re(!1),()=>{}):((async()=>{Re(!0),We("");try{const vt=await M4(t),Nt=vt?.data||vt;if(!Nt)throw new Error("Relationship not found");if(!fe){const Et=Nt.from_entity_id||Nt.fromEntityId||Nt.from_entity?.id||Nt.fromEntity?.id||"",jt=Nt.to_entity_id||Nt.toEntityId||Nt.to_entity?.id||Nt.toEntity?.id||"",Wt=Nt.entity_relationship_type_id||Nt.relationship_type_id||Nt.relationshipType?.id||Nt.relationship_type?.id||"";R({fromEntityId:Et?String(Et):"",toEntityId:jt?String(jt):"",relationshipTypeId:Wt?String(Wt):""}),ie(T(Nt.context)||"forward"),G(E(M(Nt.context)))}}catch(vt){fe||We(vt.message||"Failed to load relationship")}finally{fe||Re(!1)}})(),()=>{fe=!0})},[t,N,E,M,O,T,H,A,z]),u.useEffect(()=>{if(N)return;const fe=p==="target"?"reverse":"forward";ie(he=>he===fe?he:fe)},[p,N]),u.useEffect(()=>{if(N||!te)return;const fe=P||"",he=te==="from"?A||fe:z||fe;he&&R(Ve=>{const vt=te==="from"?"fromEntityId":"toEntityId";if(Ve[vt]===he)return Ve;const Nt={...Ve,[vt]:he};return te==="from"&&h&&Ve.toEntityId===he&&(Nt.toEntityId=""),te==="to"&&f&&Ve.fromEntityId===he&&(Nt.fromEntityId=""),Nt})},[N,te,f,h,A,z,P]);const Ue=fe=>he=>{const{value:Ve}=he.target;R(vt=>{if(N)return{...vt,[fe]:Ve};const Nt={...vt,relationshipTypeId:Ve};return te==="from"?Nt.toEntityId="":te==="to"&&(Nt.fromEntityId=""),Nt}),Ct(null)},Ge=fe=>{const{value:he}=fe.target;Ct(Ve=>Ve==="from"?null:Ve),R(Ve=>({...Ve,fromEntityId:he}))},ut=fe=>{const{value:he}=fe.target;Ct(Ve=>Ve==="to"?null:Ve),R(Ve=>({...Ve,toEntityId:he}))},ae=u.useCallback(()=>{Ct(null)},[]),Xe=u.useCallback((fe,he)=>{const Ve=fe==="to"?"to":"from",vt=he?String(he):"";Qe(Nt=>({...Nt,[Ve]:vt})),At.current[Ve]&&clearTimeout(At.current[Ve]),At.current[Ve]=setTimeout(()=>{Qe(Nt=>({...Nt,[Ve]:""})),At.current[Ve]=null},2e3)},[]),$e=u.useCallback((fe,he)=>{const Ve=PI(he);if(!Ve)return;const vt=String(Ve.id);F(Wt=>{const ln={...Ve,id:vt},dn=Wt.findIndex(Qt=>String(Qt.id)===vt);if(dn>=0){const Qt=[...Wt];return Qt[dn]={...Qt[dn],...ln},Qt}return[ln,...Wt]}),fe==="from"?R(Wt=>({...Wt,fromEntityId:vt})):fe==="to"&&R(Wt=>({...Wt,toEntityId:vt})),Xe(fe,vt),Ct(null);const Nt=fe==="from"?je:Ze,Et=`${Nt[0].toUpperCase()}${Nt.slice(1)}`,jt=Et?`New ${Et} entity added and selected.`:"New entity added and selected.";l?.(jt,"success")},[Xe,je,Ze,l]);u.useEffect(()=>{const fe=At.current;return()=>{Object.values(fe).forEach(he=>{he&&clearTimeout(he)})}},[]);const Je=(fe,he)=>Ve=>{const{value:vt}=Ve.target;G(Nt=>Nt.map(Et=>Et.id===fe?{...Et,[he]:vt}:Et))},bt=()=>{G(fe=>[...fe,O()])},St=fe=>{G(he=>E(he.filter(Ve=>Ve.id!==fe)))},_e=async fe=>{if(fe.preventDefault(),!e){We("Select a world before creating relationships.");return}const he=U.fromEntityId.trim(),Ve=U.toEntityId.trim(),vt=U.relationshipTypeId.trim();if(!he||!Ve){We("Both entities are required.");return}if(!vt){We("Relationship type is required.");return}const Nt={};q.forEach(({key:Qt,value:ha})=>{const ka=Qt.trim();ka&&(ka.startsWith("__")||(Nt[ka]=HI(ha)))});const Et=J==="reverse"?"reverse":"forward";Nt.__direction=Et;let jt=he,Wt=Ve;Et==="reverse"&&(!P||U.fromEntityId===P)&&(jt=Ve,Wt=he);const dn={world_id:e,from_entity_id:jt,to_entity_id:Wt,relationship_type_id:vt,bidirectional:!0,context:Nt};try{if(it(!0),We(""),N)await k4(t,dn),i?.("edit");else{const Qt=await xN(dn),ha=Qt?.data??Qt,ka=ha?.data??ha;i?.("create",ka)}}catch(Qt){We(Qt.message||"Failed to save relationship")}finally{it(!1)}},tt=Z||Q||Pe||ne,mt=!!zt?.typeId&&Rt.length===0;return u.useEffect(()=>{if(!S)return;S({mode:N?"edit":"create",saving:Ce,isBusy:tt,submitLabel:Ce?"Saving...":N?"Save Changes":"Create Relationship",submitDisabled:Ce||tt||ce,cancelDisabled:Ce})},[S,N,Ce,tt,ce]),a.jsxs("form",{id:v,className:"entity-form relationship-form",onSubmit:_e,children:[a.jsx(UI,{value:W,onChange:kt,disabled:Ce||tt}),ot&&a.jsx("div",{className:"alert warning",role:"alert",children:ot}),ke&&a.jsx("div",{className:"alert warning",role:"status",children:ke}),a.jsxs("div",{className:"form-two-column",children:[a.jsxs("div",{className:`form-group${He.from&&He.from===U.fromEntityId?" entity-select-highlight":""}`,children:[a.jsx("label",{htmlFor:"relationship-from-entity",children:"From Entity *"}),a.jsxs("select",{id:"relationship-from-entity",value:U.fromEntityId,onChange:Ge,disabled:Ce||tt||te==="from",required:!0,"data-autofocus":ve==="from"?!0:void 0,children:[a.jsx("option",{value:"",children:"Select entity..."}),Lt.map(fe=>a.jsx("option",{value:fe.id,children:fe.name},fe.id))]}),te==="from"&&Oe&&a.jsx("p",{className:"field-hint",children:Oe}),j&&oe&&a.jsxs("p",{className:"field-hint",children:["Displayed label: ",oe]}),j&&pt&&se&&a.jsxs("p",{className:"field-hint",children:[dt,": ",se]}),te!=="from"&&a.jsx("div",{className:"inline-create-trigger",children:ct.length>0?a.jsx("button",{type:"button",className:"link-button",onClick:()=>Zt("from"),disabled:Mt==="from",children:"+ Create new"}):a.jsx("button",{type:"button",className:"link-button disabled",disabled:!0,children:"+ Create new"})}),te!=="from"&&ct.length===0&&a.jsx("p",{className:"inline-create-hint disabled",children:"Inline creation isnt available for this relationship."}),pt&&ct.length>0&&Lt.length===0&&a.jsxs("p",{className:"field-hint",children:["No entities match the allowed ",je," types yet. Use + Create new to add one without leaving this page."]}),te!=="from"&&Mt==="from"&&a.jsx(TS,{allowedTypeIds:ct,defaultTypeId:Tt,worldId:e,entityTypes:B,onCreated:fe=>$e("from",fe),onCancel:ae,onToast:l},`inline-from-${U.relationshipTypeId}`)]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type",children:"Relationship Type *"}),a.jsxs("select",{id:"relationship-type",value:U.relationshipTypeId,onChange:Ue("relationshipTypeId"),disabled:Ce||tt||!Rt.length,required:!0,children:[a.jsx("option",{value:"",children:"Select type..."}),Rt.map(fe=>{const he=fe.from_name||fe.fromName||fe.name,Ve=fe.to_name||fe.toName||fe.name,vt=he===Ve?he:`${he}  ${Ve}`;return a.jsxs("option",{value:fe.id,children:[fe.name,"  ",vt]},fe.id)})]}),mt&&a.jsx("p",{className:"field-hint",children:"No relationship types include the selected entity type."}),Ke&&a.jsx("p",{className:"helper-hint",children:Ke})]})]}),a.jsx("div",{className:"form-two-column",children:a.jsxs("div",{className:`form-group${He.to&&He.to===U.toEntityId?" entity-select-highlight":""}`,children:[a.jsx("label",{htmlFor:"relationship-to-entity",children:"To Entity *"}),a.jsxs("select",{id:"relationship-to-entity",value:U.toEntityId,onChange:ut,disabled:Ce||tt||te==="to",required:!0,"data-autofocus":ve==="to"?!0:void 0,children:[a.jsx("option",{value:"",children:"Select entity..."}),Kt.map(fe=>a.jsx("option",{value:fe.id,children:fe.name},fe.id))]}),te==="to"&&Oe&&a.jsx("p",{className:"field-hint",children:Oe}),j&&re&&a.jsxs("p",{className:"field-hint",children:["Displayed label: ",re]}),j&&pt&&be&&a.jsxs("p",{className:"field-hint",children:[gt,": ",be]}),te!=="to"&&a.jsx("div",{className:"inline-create-trigger",children:yt.length>0?a.jsx("button",{type:"button",className:"link-button",onClick:()=>Zt("to"),disabled:Mt==="to",children:"+ Create new"}):a.jsx("button",{type:"button",className:"link-button disabled",disabled:!0,children:"+ Create new"})}),te!=="to"&&yt.length===0&&a.jsx("p",{className:"inline-create-hint disabled",children:"Inline creation isnt available for this relationship."}),pt&&yt.length>0&&Kt.length===0&&a.jsxs("p",{className:"field-hint",children:["No entities match the allowed ",Ze," types yet. Use + Create new to add one without losing your place."]}),te!=="to"&&Mt==="to"&&a.jsx(TS,{allowedTypeIds:yt,defaultTypeId:Ft,worldId:e,entityTypes:B,onCreated:fe=>$e("to",fe),onCancel:ae,onToast:l},`inline-to-${U.relationshipTypeId}`)]})}),_&&a.jsxs("div",{className:"metadata-editor",children:[a.jsxs("div",{className:"metadata-header",children:[a.jsxs("h3",{children:["Context ",le?"":"(optional)"]}),a.jsx("button",{type:"button",className:"btn neutral",onClick:bt,disabled:Ce||tt,children:"Add field"})]}),a.jsx("div",{className:"metadata-list",children:q.map((fe,he)=>a.jsxs("div",{className:"metadata-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`context-key-${fe.id}`,className:"sr-only",children:["Context key ",he+1]}),a.jsx("input",{id:`context-key-${fe.id}`,type:"text",placeholder:"Key",value:fe.key,onChange:Je(fe.id,"key"),disabled:Ce||tt})]}),a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:`context-value-${fe.id}`,className:"sr-only",children:["Context value ",he+1]}),a.jsx("input",{id:`context-value-${fe.id}`,type:"text",placeholder:"Value",value:fe.value,onChange:Je(fe.id,"value"),disabled:Ce||tt})]}),a.jsx("div",{className:"metadata-actions",children:a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>St(fe.id),disabled:Ce||tt||q.length===1,title:"Remove field",children:""})})]},fe.id))})]}),tt&&a.jsx("div",{className:"form-loading",role:"status",children:"Loading data..."}),qe&&a.jsx("div",{className:"form-error",role:"alert",children:qe}),!w&&a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:r,disabled:Ce,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:Ce||tt||ce,children:Ce?"Saving...":N?"Save Changes":"Create Relationship"})]})]})}function GI(e){return a.jsx(YI,{...e})}const XI=new Set(["system_admin"]),RS=(e="create")=>({mode:e,submitLabel:e==="edit"?"Save Changes":"Create Relationship",submitDisabled:!1,cancelDisabled:!1,saving:!1,isBusy:!1});function KI(){const{user:e,token:t,sessionReady:r}=En(),{selectedCampaign:i,activeWorld:l,activeWorldId:c,selectedContextType:f,contextKey:m}=Bn(),h=zI("rel_builder_v2"),[p,y]=u.useState(!1),[g,v]=u.useState(!1),[S,w]=u.useState([]),[N,j]=u.useState([]),[_,C]=u.useState({}),O=u.useRef({}),[E,T]=u.useState(!1),[M,A]=u.useState(!1),[z,P]=u.useState(""),[X,H]=u.useState(null),[Y,V]=u.useState(""),[I,F]=u.useState(null),[D,L]=u.useState(()=>RS("create")),[B,k]=u.useState(""),[U,R]=u.useState(""),q=c||"",G=!!q,J=u.useRef(`${q}:${m}`),ie=u.useRef(`relationship-form-${Math.random().toString(36).slice(2)}`),Z=(le="create")=>{L(RS(le))},me=u.useCallback((le,Se="info")=>{F({message:le,tone:Se})},[]);u.useEffect(()=>{if(!I)return;const le=setTimeout(()=>F(null),3500);return()=>clearTimeout(le)},[I]);const Q=u.useMemo(()=>!i||!e?"":i.members?.find(Se=>Se.user_id===e.id)?.role||"",[i,e]),ue=u.useMemo(()=>{const le=i?.world||l;if(!le||!e?.id)return!1;const Se=le.created_by||le.creator?.id||le.owner_id||le.owner?.id||"";return Se?String(Se)===String(e.id):!1},[i,l,e?.id]),ne=u.useMemo(()=>!e||!q?!1:XI.has(e.role)?!0:f==="world"?ue:!!(i&&(Q==="dm"||ue)),[e,q,f,i,Q,ue]),we=u.useCallback(async le=>{const Se=Array.from(new Set(le.map(nt=>nt==null?"":String(nt)).filter(Boolean)));if(Se.length===0)return;const Ee=O.current,ge=Se.filter(nt=>!Ee[nt]);if(ge.length===0)return;const at=await Promise.all(ge.map(async nt=>{try{const ze=await rr(nt),ft=Ha(ze);return{id:nt,data:ft}}catch(ze){return console.error(" Failed to resolve entity",ze),{id:nt,data:null}}})),st={};at.forEach(({id:nt,data:ze})=>{ze?st[nt]={id:ze.id||nt,name:ze.name||`Entity ${nt}`,typeName:ze.entityType?.name||ze.entity_type?.name||""}:st[nt]={id:nt,name:`Entity #${nt}`,typeName:""}}),O.current={...O.current,...st},C(nt=>({...nt,...st}))},[]),Pe=u.useCallback(async le=>{const Se=le?{worldId:le}:{};A(!0);try{const Ee=await bf(Se),ge=Array.isArray(Ee)?Ee:Array.isArray(Ee?.data)?Ee.data:[];j(ge)}catch(Ee){console.error(" Failed to load relationship types",Ee),me(Ee.message||"Failed to load relationship types","error"),j([])}finally{A(!1)}},[me]);u.useEffect(()=>{if(!q){j([]);return}Pe(q)},[Pe,q,m]);const Re=u.useCallback(async le=>{const Se=le??q;if(!Se||!t)return w([]),[];T(!0),P("");try{const Ee=await T4(Se),ge=Array.isArray(Ee)?Ee:Array.isArray(Ee?.data)?Ee.data:[];w(ge);const at=[];return ge.forEach(st=>{const nt=st.from_entity_id||st.fromEntityId||st.from_entity?.id||st.fromEntity?.id||"",ze=st.to_entity_id||st.toEntityId||st.to_entity?.id||st.toEntity?.id||"";nt&&at.push(nt),ze&&at.push(ze)}),await we(at),ge}catch(Ee){return console.error(" Failed to load relationships",Ee),w([]),P(Ee.message||"Failed to load relationships"),[]}finally{T(!1)}},[q,t,we,m]);u.useEffect(()=>{if(!q||!t){w([]),O.current={},C({});return}Re(q)},[q,t,Re,m]),u.useEffect(()=>{const le=`${q}:${m}`;J.current!==le&&(p&&y(!1),g&&v(!1),H(null),F(null),k(""),R(""),P(""),O.current={},C({}),J.current=le)},[q,m,p,g]);const Ce=u.useMemo(()=>{const le=new Map;return N.forEach(Se=>{Se?.id&&le.set(String(Se.id),Se)}),le},[N]),it=le=>{if(!le)return"";if(typeof le=="object"&&le!==null&&!Array.isArray(le)){const Se=le.__direction||le.direction;return Se?String(Se):""}return""},qe=u.useMemo(()=>S.map(le=>{const Se=le.from_entity_id||le.fromEntityId||le.from_entity?.id||le.fromEntity?.id||"",Ee=le.to_entity_id||le.toEntityId||le.to_entity?.id||le.toEntity?.id||"",ge=le.entity_relationship_type_id||le.relationship_type_id||le.relationshipType?.id||le.relationship_type?.id||"",at=le.relationshipType||le.relationship_type||Ce.get(String(ge))||{},st=at.name||le.relationshipTypeName||Ce.get(String(ge))?.name||"",nt=at.from_name||at.fromName||Ce.get(String(ge))?.from_name||Ce.get(String(ge))?.fromName||st,ze=at.to_name||at.toName||Ce.get(String(ge))?.to_name||Ce.get(String(ge))?.toName||st,ft=it(le.context),zt=ft==="reverse"?ze:nt,Rt=!!(le.bidirectional??le.is_bidirectional??le.two_way??!1);return{...le,fromEntityId:Se?String(Se):"",toEntityId:Ee?String(Ee):"",relationshipTypeId:ge?String(ge):"",typeName:zt,direction:ft,typeFromName:nt,typeToName:ze,bidirectional:Rt,fromEntityName:le.fromEntity?.name||le.from_entity?.name||le.fromEntityName||"",toEntityName:le.toEntity?.name||le.to_entity?.name||le.toEntityName||"",fromEntityTypeName:le.fromEntity?.entityType?.name||le.from_entity?.entity_type?.name||"",toEntityTypeName:le.toEntity?.entityType?.name||le.to_entity?.entity_type?.name||""}}),[S,Ce]),We=i?`${i.name}${l?.name?`  ${l.name}`:""}`:G?`World  ${l?.name||"Untitled world"}`:"",ke=u.useCallback((le,Se="",Ee="")=>{if(!le)return"";const ge=_[le],at=ge?.name||Se||`Entity #${le}`,st=ge?.typeName||Ee;return st?`${at} (${st})`:at},[_]),xt=u.useMemo(()=>{const le=U.trim().toLowerCase();return qe.filter(Se=>{if(B&&Se.relationshipTypeId!==B)return!1;if(!le)return!0;const Ee=ke(Se.fromEntityId,Se.fromEntityName,Se.fromEntityTypeName).toLowerCase(),ge=ke(Se.toEntityId,Se.toEntityName,Se.toEntityTypeName).toLowerCase();return Ee.includes(le)||ge.includes(le)})},[qe,B,U,ke]);if(!r)return a.jsx("p",{children:"Restoring session..."});if(!t)return a.jsx("p",{children:"Authenticating..."});const Mt=xt.length>0,Ct=X?"Edit Relationship":"Add Relationship",At=()=>{q&&Re(q)},He=()=>{if(!(!ne||!q)){if(h){y(!0);return}H(null),Z("create"),v(!0)}},Qe=le=>{!ne||!le?.id||(H(le.id),Z("edit"),v(!0))},W=()=>{v(!1),H(null),Z("create")},ee=(le={})=>{L(Se=>({...Se,...le}))},te=async(le,Se)=>{if(W(),!!q){if(await Re(q),le==="create"&&Se){const Ee=ke(Se.from_entity_id,Se?.from_entity?.name,Se?.from_entity?.entityType?.name||Se?.from_entity?.entity_type?.name),ge=ke(Se.to_entity_id,Se?.to_entity?.name,Se?.to_entity?.entityType?.name||Se?.to_entity?.entity_type?.name),at=Se?.relationshipType?.name||"relationship";me(`Added ${Ee}  ${ge} (${at}).`,"success");return}me(le==="create"?"Relationship created":"Relationship updated","success")}},ve=async le=>{if(!ne||!le?.id)return;const Se=ke(le.fromEntityId,le.fromEntityName,le.fromEntityTypeName),Ee=ke(le.toEntityId,le.toEntityName,le.toEntityTypeName);if(window.confirm(`Delete relationship "${Se}"  "${Ee}"? This action cannot be undone.`))try{V(le.id),await D4(le.id),me("Relationship deleted","success"),q&&await Re(q)}catch(at){console.error(" Failed to delete relationship",at),me(at.message||"Failed to delete relationship","error")}finally{V("")}};return a.jsxs("section",{className:"entities-page relationships-page",children:[a.jsxs("div",{className:"entities-header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Entity Relationships"}),G?a.jsx("p",{className:"entities-subtitle",children:We}):a.jsx("p",{className:"entities-subtitle",children:"Select a campaign or world you own to choose a world context."})]}),a.jsxs("div",{className:"entities-controls",children:[a.jsxs("select",{value:B,onChange:le=>k(le.target.value),disabled:M||N.length===0,title:"Filter by relationship type",children:[a.jsx("option",{value:"",children:"All types"}),N.map(le=>a.jsx("option",{value:String(le.id),children:le.name},le.id))]}),a.jsx(Vy,{value:U,onChange:R}),a.jsx("button",{type:"button",className:"icon-btn",title:"Refresh relationships",onClick:At,disabled:!q||E,children:a.jsx(zl,{size:16})}),a.jsxs("button",{type:"button",className:"btn submit",onClick:He,disabled:!ne||!q||E,children:[a.jsx(Pa,{size:16})," Add Relationship"]})]})]}),i&&G&&!ne&&a.jsx("div",{className:"alert info",role:"status",children:"You can view existing relationships, but only the world owner, a campaign DM, or a system administrator can create or edit them."}),I&&a.jsx("div",{className:`toast-banner ${I.tone}`,role:"status",children:I.message}),z&&a.jsx("div",{className:"alert error",role:"alert",children:z}),E?a.jsx("div",{className:"empty-state",children:"Loading relationships..."}):q?Mt?a.jsx("div",{className:"entities-table-wrapper",children:a.jsxs("table",{className:"entities-table relationships-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"From Entity"}),a.jsx("th",{children:"Relationship Type"}),a.jsx("th",{children:"To Entity"}),a.jsx("th",{children:"Bidirectional"}),ne&&a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:xt.map(le=>{const Se=ke(le.fromEntityId,le.fromEntityName,le.fromEntityTypeName),Ee=ke(le.toEntityId,le.toEntityName,le.toEntityTypeName);return a.jsxs("tr",{children:[a.jsx("td",{children:Se}),a.jsx("td",{children:le.typeName||""}),a.jsx("td",{children:Ee}),a.jsx("td",{children:a.jsx("span",{className:`visibility-badge ${le.bidirectional?"badge-visible":"badge-hidden"}`,children:le.bidirectional?"Yes":"No"})}),ne&&a.jsx("td",{className:"actions-column",children:a.jsxs("div",{className:"entity-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",onClick:()=>Qe(le),title:"Edit relationship",disabled:E,children:a.jsx(ar,{size:16})}),a.jsx("button",{type:"button",className:"icon-btn danger",onClick:()=>ve(le),title:"Delete relationship",disabled:Y===le.id,children:a.jsx(fa,{size:16})})]})})]},le.id)})})]})}):a.jsx("div",{className:"empty-state",children:B||U?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"empty-title",children:"No relationships match your filters."}),a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>{k(""),R("")},children:"Clear filters"})]}):ne?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"empty-title",children:"No relationships yet."}),a.jsxs("button",{type:"button",className:"btn submit",onClick:He,disabled:!q,children:[a.jsx(Pa,{size:16})," Add your first relationship"]})]}):a.jsx("p",{className:"empty-title",children:"No relationships to display."})}):a.jsx("div",{className:"empty-state",children:"Select a campaign or world you own to view its relationships."}),h&&a.jsx(Yr,{isOpen:p,onClose:()=>y(!1),title:"Add Relationship",description:"Link two entities in this world.",size:"lg",children:a.jsx(SN,{worldId:q,existingRelationships:S||[],onCreated:()=>{y(!1),Re(q),me("Relationship created","success")},onCancel:()=>y(!1)})}),a.jsx(Yr,{isOpen:g,onClose:W,title:Ct,size:"lg",footerActions:a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:W,disabled:D.cancelDisabled,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",form:ie.current,disabled:D.submitDisabled,children:D.submitLabel})]}),children:a.jsx(GI,{worldId:q,relationshipId:X,onCancel:W,onSaved:te,onStateChange:ee,formId:ie.current,hideActions:!0})})]})}const WI=new Set(["system_admin"]),ZI=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},kS=(e=[])=>!Array.isArray(e)||e.length===0?"":e.map(t=>t?.name||t?.label||"Unknown").filter(Boolean).join(", "),QI=e=>{if(!e)return"";const t=e.from_name||e.fromName||e.name||"",r=e.to_name||e.toName||e.name||"";return`${t}  ${r}`};function JI(){const e=zn(),t=Ya(),{user:r,token:i,sessionReady:l}=En(),{selectedCampaign:c}=Bn(),[f,m]=u.useState([]),[h,p]=u.useState(!1),[y,g]=u.useState(""),[v,S]=u.useState(null),[w,N]=u.useState(""),j=u.useMemo(()=>{if(!c?.world)return"";const I=c.world;return I.created_by||I.creator?.id||I.owner_id||I.owner?.id||""},[c]),_=!!(r?.id&&j===r.id),C=u.useMemo(()=>r?r.role&&WI.has(r.role)?!0:_:!1,[r,_]),O=c?.world?.id??"",E=!!O,T=u.useRef(O),M=u.useMemo(()=>{if(!c)return"";const I=c.name||"Selected campaign",F=c.world?.name;return F?`${I}  ${F}`:I},[c]);u.useEffect(()=>{if(!v)return;const I=setTimeout(()=>S(null),3500);return()=>clearTimeout(I)},[v]);const A=u.useCallback((I,F="info")=>{S({message:I,tone:F})},[]),z=u.useCallback(()=>{e(t.pathname,{replace:!0,state:{}})},[t.pathname,e]);u.useEffect(()=>{if(t.state?.toast){const{message:I,tone:F}=t.state.toast;A(I,F),z()}},[t.state,A,z]),u.useEffect(()=>{T.current!==O&&(T.current=O,m([]),g(""),p(!1),S(null),N(""))},[O]);const P=u.useCallback(async()=>{if(!(!i||!C)){if(!O){m([]),g("");return}p(!0),g("");try{const I=await bf({worldId:O}),F=Array.isArray(I)?I:Array.isArray(I?.data)?I.data:[];m(F)}catch(I){console.error(" Failed to load relationship types",I),m([]),g(I.message||"Failed to load relationship types")}finally{p(!1)}}},[i,C,O]);u.useEffect(()=>{if(!(!l||!i||!C)){if(!O){m([]),p(!1),g("");return}P()}},[l,i,C,O,P]);const X=()=>{!i||h||!E||!C||P()},H=()=>{!C||!E||e("/relationship-types/new")},Y=I=>{!C||!I?.id||e(`/relationship-types/${I.id}/edit`)},V=async I=>{if(!(!C||!E||!I?.id||!window.confirm(`Delete relationship type "${I.name}"? This cannot be undone.`)))try{N(I.id),await $4(I.id),A("Relationship type deleted","success"),await P()}catch(D){console.error(" Failed to delete relationship type",D),A(D.message||"Failed to delete relationship type","error")}finally{N("")}};return l?i?C?a.jsxs("section",{className:"entity-types-page relationship-types-page",children:[a.jsxs("div",{className:"entity-types-header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Relationship Types"}),c?a.jsxs("p",{className:"entity-types-subtitle",children:[M,E?`  ${f.length} types defined`:""]}):a.jsx("p",{className:"entity-types-subtitle",children:"Select a campaign from the header to choose a world context."})]}),a.jsxs("div",{className:"entity-types-actions",children:[a.jsx("button",{type:"button",className:"icon-btn",title:"Refresh",onClick:X,disabled:h||!E,children:a.jsx(zl,{size:16})}),a.jsxs("button",{type:"button",className:"btn submit",onClick:H,disabled:h||!E,children:[a.jsx(Pa,{size:18})," Add Relationship Type"]})]})]}),v&&a.jsx("div",{className:`toast-banner ${v.tone}`,children:v.message}),y&&a.jsx("div",{className:"alert error",children:y}),a.jsx("div",{className:"entity-types-table-wrapper",children:E?h?a.jsx("div",{className:"empty-state",children:"Loading relationship types..."}):f.length===0?a.jsx("div",{className:"empty-state",children:"No relationship types defined yet."}):a.jsxs("table",{className:"entity-types-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Name"}),a.jsx("th",{children:"Directional Labels"}),a.jsx("th",{children:"World"}),a.jsx("th",{children:"Allowed Sources"}),a.jsx("th",{children:"Allowed Targets"}),a.jsx("th",{children:"Created"}),a.jsx("th",{className:"actions-column",children:"Actions"})]})}),a.jsx("tbody",{children:f.map(I=>{const F=I.createdAt||I.created_at;return a.jsxs("tr",{children:[a.jsx("td",{children:I.name}),a.jsx("td",{children:QI(I)}),a.jsx("td",{children:I.world?.name||""}),a.jsx("td",{children:kS(I.from_entity_types)}),a.jsx("td",{children:kS(I.to_entity_types)}),a.jsx("td",{children:ZI(F)}),a.jsxs("td",{className:"actions-column",children:[a.jsx("button",{className:"icon-btn",title:"Edit",onClick:()=>Y(I),disabled:h||w===I.id,children:a.jsx(ar,{size:16})}),a.jsx("button",{className:"icon-btn danger",title:"Delete",onClick:()=>V(I),disabled:w===I.id,children:a.jsx(fa,{size:16})})]})]},I.id)})})]}):a.jsx("div",{className:"empty-state",children:"Select a campaign from the header to view relationship types."})})]}):a.jsxs("section",{className:"entity-types-page relationship-types-page",children:[a.jsx("div",{className:"entity-types-header",children:a.jsx("h1",{children:"Relationship Types"})}),a.jsx("div",{className:"alert info",children:"Only system administrators or the world owner can manage relationship types."})]}):a.jsx("p",{children:"Authenticating..."}):a.jsx("p",{children:"Restoring session..."})}const DS=e=>Array.isArray(e)?[...new Set(e.map(t=>t?String(t):"").filter(Boolean))]:[],IS=(e={})=>({name:e?.name||"",fromName:e?.from_name||e?.fromName||"",toName:e?.to_name||e?.toName||"",description:e?.description||"",worldId:e?.world?.id||e?.world_id||"",fromEntityTypeIds:DS((e?.from_entity_types||[]).map(t=>t?.id||t?.entity_type_id)),toEntityTypeIds:DS((e?.to_entity_types||[]).map(t=>t?.id||t?.entity_type_id))}),LS=(e=[],t=[])=>{if(e.length!==t.length)return!1;const r=[...e].sort(),i=[...t].sort();return r.every((l,c)=>l===i[c])};function FN({initialValues:e={},entityTypes:t=[],worlds:r=[],saving:i=!1,optionsLoading:l=!1,errorMessage:c="",onSubmit:f,onCancel:m}){const h=u.useMemo(()=>IS(e),[e]),[p,y]=u.useState(h),[g,v]=u.useState("");u.useEffect(()=>{y(IS(e)),v("")},[e]),u.useEffect(()=>{v(c||"")},[c]);const S=u.useMemo(()=>p.name!==h.name||p.fromName!==h.fromName||p.toName!==h.toName||p.description!==h.description||p.worldId!==h.worldId||!LS(p.fromEntityTypeIds,h.fromEntityTypeIds)||!LS(p.toEntityTypeIds,h.toEntityTypeIds),[h,p]),w=u.useMemo(()=>Array.isArray(t)?t.map(O=>{const E=O?.id||O?.entity_type_id||O?.entityTypeId||O?.value||"";if(!E)return null;const T=O?.world_id||O?.worldId||O?.world?.id||"";return{value:String(E),label:O?.name||O?.label||"Untitled type",worldId:T?String(T):""}}).filter(Boolean):[],[t]),N=u.useMemo(()=>{const O=p.worldId?String(p.worldId):"";return O?w.filter(E=>E.worldId===O):[]},[w,p.worldId]);u.useEffect(()=>{if(!(p.worldId?String(p.worldId):"")){y(T=>T.fromEntityTypeIds.length===0&&T.toEntityTypeIds.length===0?T:{...T,fromEntityTypeIds:[],toEntityTypeIds:[]});return}const E=new Set(N.map(T=>T.value));y(T=>{const M=T.fromEntityTypeIds.filter(z=>E.has(String(z))),A=T.toEntityTypeIds.filter(z=>E.has(String(z)));return M.length===T.fromEntityTypeIds.length&&A.length===T.toEntityTypeIds.length?T:{...T,fromEntityTypeIds:M,toEntityTypeIds:A}})},[N,p.worldId]);const j=O=>E=>{const{value:T}=E.target;y(M=>({...M,[O]:T}))},_=O=>(E=[])=>{const T=Array.isArray(E)?E:[];y(M=>({...M,[O]:T}))},C=async O=>{O.preventDefault();const E=p.name.trim(),T=p.fromName.trim(),M=p.toName.trim();if(!E)return v("Name is required.");if(!T)return v("Provide a label for the source direction.");if(!M)return v("Provide a label for the target direction.");if(!p.worldId)return v("Select a world for this relationship type.");if(!p.fromEntityTypeIds.length)return v("Select at least one allowed source entity type.");if(!p.toEntityTypeIds.length)return v("Select at least one allowed target entity type.");v("");const A={name:E,from_name:T,to_name:M,description:p.description?.trim()||"",world_id:p.worldId,from_entity_type_ids:p.fromEntityTypeIds,to_entity_type_ids:p.toEntityTypeIds};try{if(await f?.(A)===!1)return}catch(z){v(z.message||"Failed to save relationship type")}};return a.jsxs("form",{className:"relationship-type-form",onSubmit:C,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-name",children:"Name *"}),a.jsx("input",{id:"relationship-type-name",type:"text",value:p.name,onChange:j("name"),placeholder:"e.g. Enemy",disabled:i||l,autoFocus:!0})]}),a.jsxs("div",{className:"form-two-column",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-from-name",children:"Source relationship label *"}),a.jsx("input",{id:"relationship-type-from-name",type:"text",value:p.fromName,onChange:j("fromName"),placeholder:"e.g. Parent of",disabled:i||l})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-to-name",children:"Target relationship label *"}),a.jsx("input",{id:"relationship-type-to-name",type:"text",value:p.toName,onChange:j("toName"),placeholder:"e.g. Child of",disabled:i||l})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-description",children:"Description"}),a.jsx("textarea",{id:"relationship-type-description",value:p.description,onChange:j("description"),placeholder:"Optional description",rows:4,disabled:i||l,className:"textarea-field"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-world",children:"World *"}),a.jsxs("select",{id:"relationship-type-world",value:p.worldId,onChange:j("worldId"),disabled:i||l,required:!0,children:[a.jsx("option",{value:"",children:"Select world..."}),r.map(O=>a.jsx("option",{value:O.id,children:O.name},O.id))]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-from-entities",children:"Allowed source entity types *"}),a.jsx(Ts,{selected:p.fromEntityTypeIds,options:N,onChange:_("fromEntityTypeIds"),placeholder:"Search entity types...",disabled:i||l,loading:l,noOptionsMessage:p.worldId?"No entity types available for this world.":"Select a world to choose entity types."})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"relationship-type-to-entities",children:"Allowed target entity types *"}),a.jsx(Ts,{selected:p.toEntityTypeIds,options:N,onChange:_("toEntityTypeIds"),placeholder:"Search entity types...",disabled:i||l,loading:l,noOptionsMessage:p.worldId?"No entity types available for this world.":"Select a world to choose entity types."})]}),g&&a.jsx("div",{className:"form-error",children:g}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:m,disabled:i,children:"Cancel"}),a.jsx("button",{type:"submit",className:"btn submit",disabled:i||l||!S,children:i?"Saving...":"Save"})]})]})}function eL(){const e=zn(),{user:t,token:r,sessionReady:i}=En(),{selectedCampaign:l}=Bn(),[c,f]=u.useState([]),[m,h]=u.useState(!1),[p,y]=u.useState(""),[g,v]=u.useState(""),[S,w]=u.useState(!1),N=u.useMemo(()=>{if(!l?.world)return"";const A=l.world;return A.created_by||A.creator?.id||A.owner_id||A.owner?.id||""},[l]),j=!!(t?.id&&N===t.id),_=u.useMemo(()=>t?t.role==="system_admin"?!0:j:!1,[t,j]),C=l?.world?.id??"",O=u.useMemo(()=>{if(!l?.world?.id)return[];const A=l.world;return[{id:A.id,name:A.name||"Untitled world"}]},[l]),E=u.useCallback(async()=>{if(!r||!C){f([]),y("Select a campaign to choose a world context before creating relationship types.");return}h(!0),y("");try{const A=await Qr({worldId:C}),z=Array.isArray(A?.data)?A.data:Array.isArray(A)?A:[];f(z)}catch(A){console.error(" Failed to load relationship type options",A),f([]),y(A.message||"Failed to load supporting data")}finally{h(!1)}},[r,C]);if(u.useEffect(()=>{!i||!r||E()},[i,r,E]),!i)return a.jsx("p",{children:"Restoring session..."});if(!r)return a.jsx("p",{children:"Authenticating..."});if(!_)return a.jsxs("section",{className:"page relationship-type-form-page limited-access",children:[a.jsx("h1",{children:"Create Relationship Type"}),a.jsx("p",{children:"Only system administrators or the world owner can create relationship types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]});if(!C)return a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Create Relationship Type"}),a.jsx("p",{children:"Select a campaign from the header to choose a world context before creating relationship types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]});const T=()=>e("/relationship-types"),M=async A=>{if(S)return!1;v(""),w(!0);try{const z={...A,world_id:A.world_id??A.worldId??A.world?.id??C};if(!z.world_id)throw new Error("A world must be selected before creating a relationship type");console.log(" Final payload being sent:",z);const P=await O4(z),X=P?.data??P;if(!X||!X.id)throw new Error("Failed to create relationship type");return e("/relationship-types",{state:{toast:{message:"Relationship type created",tone:"success"}}}),!0}catch(z){return console.error(" Failed to create relationship type",z),v(z.message||"Failed to create relationship type"),!1}finally{w(!1)}};return a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Create Relationship Type"}),a.jsx("p",{className:"page-subtitle",children:"Define the directional names and allowed entity types for this relationship."}),p&&a.jsx("div",{className:"alert error",children:p}),a.jsx(FN,{initialValues:{world_id:C},entityTypes:c,worlds:O,saving:S,optionsLoading:m,errorMessage:g,onSubmit:M,onCancel:T})]})}function tL(){const e=zn(),{id:t}=vs(),{user:r,token:i,sessionReady:l}=En(),{selectedCampaign:c}=Bn(),[f,m]=u.useState([]),[h,p]=u.useState(!1),[y,g]=u.useState(""),[v,S]=u.useState(""),[w,N]=u.useState(null),[j,_]=u.useState(!0),[C,O]=u.useState(""),[E,T]=u.useState(!1),M=r?.role==="system_admin",A=u.useMemo(()=>{if(!c||!r)return!1;const B=c.world?.created_by??c.world?.creator?.id??c.world?.owner_id??c.world?.owner?.id??"";return B?B===r.id:!1},[c,r]),z=u.useMemo(()=>!!(M||A),[M,A]),P=c?.world?.id??"",X=c?.world?.name??"",H=u.useMemo(()=>{if(!w)return null;const B=w?.world?.id||w?.world_id||w?.worldId||"";if(!B)return null;const k=w?.world?.name||w?.world_name||w?.worldName||"";return{id:B,name:k||"Untitled world"}},[w]),[Y,V]=u.useState([]);u.useEffect(()=>{const B=[];P&&B.push({id:P,name:X||"Untitled world"}),H&&!B.some(k=>k.id===H.id)&&B.push(H),V(B)},[P,X,H]);const I=u.useCallback(async()=>{if(i){p(!0),g("");try{const B=P||H?.id||w?.world?.id||w?.world_id||"";if(!B){m([]),g("Select a campaign to choose a world context before editing relationship types.");return}const k=await Qr({worldId:B}),U=Array.isArray(k?.data)?k.data:Array.isArray(k)?k:[];m(U)}catch(B){console.error(" Failed to load relationship type options",B),m([]),g(B.message||"Failed to load supporting data")}finally{p(!1)}}},[i,P,H,w]),F=u.useCallback(async()=>{if(!(!i||!t)){_(!0),O("");try{const B=await L4(t),k=B?.data??B;if(!k)throw new Error("Relationship type not found");N(k)}catch(B){console.error(" Failed to load relationship type",B),O(B.message||"Failed to load relationship type"),N(null)}finally{_(!1)}}},[t,i]);if(u.useEffect(()=>{!l||!i||F()},[l,i,F]),u.useEffect(()=>{!l||!i||j||I()},[l,i,j,I]),!l)return a.jsx("p",{children:"Restoring session..."});if(!i)return a.jsx("p",{children:"Authenticating..."});if(!z)return a.jsxs("section",{className:"page relationship-type-form-page limited-access",children:[a.jsx("h1",{children:"Edit Relationship Type"}),a.jsx("p",{children:"Only system administrators can edit relationship types."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]});const D=()=>e("/relationship-types"),L=async B=>{if(E||!t)return!1;S(""),T(!0);try{const k={...B,world_id:B.world_id||B.worldId||B.selectedWorldId||B.world?.id||P||w?.world_id};if(!k.world_id)throw new Error("A world must be selected before saving changes");const U=await z4(t,k),R=U?.data??U;if(!R||!R.id)throw new Error("Failed to update relationship type");return e("/relationship-types",{state:{toast:{message:"Relationship type updated",tone:"success"}}}),!0}catch(k){return console.error(" Failed to update relationship type",k),S(k.message||"Failed to update relationship type"),!1}finally{T(!1)}};return j?a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Edit Relationship Type"}),a.jsx("div",{className:"form-status",children:"Loading relationship type..."})]}):C||!w?a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Edit Relationship Type"}),a.jsx("div",{className:"alert error",children:C||"Relationship type not found."}),a.jsx("button",{type:"button",className:"btn cancel",onClick:()=>e("/relationship-types"),children:"Back to Relationship Types"})]}):a.jsxs("section",{className:"page relationship-type-form-page",children:[a.jsx("h1",{children:"Edit Relationship Type"}),a.jsx("p",{className:"page-subtitle",children:"Update the directional labels or allowed entity types for this relationship."}),y&&a.jsx("div",{className:"alert error",children:y}),a.jsx(FN,{initialValues:w,entityTypes:f,worlds:Y,saving:E,optionsLoading:h,errorMessage:v,onSubmit:L,onCancel:D})]})}function nL(){return a.jsx("section",{className:"page-placeholder",children:a.jsx("h1",{children:"Entity Secrets Page  Coming Soon"})})}function aL({children:e}){const{token:t,sessionReady:r}=En();return r?t?e:a.jsx(Xo,{to:"/login",replace:!0}):a.jsx("p",{children:"Restoring session..."})}function ma(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let r=0,i;r<e.length;r++)(i=ma(e[r]))!==""&&(t+=(t&&" ")+i);else for(let r in e)e[r]&&(t+=(t&&" ")+r);return t}var pp={exports:{}},yp={},gp={exports:{}},bp={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OS;function sL(){if(OS)return bp;OS=1;var e=Nc();function t(g,v){return g===v&&(g!==0||1/g===1/v)||g!==g&&v!==v}var r=typeof Object.is=="function"?Object.is:t,i=e.useState,l=e.useEffect,c=e.useLayoutEffect,f=e.useDebugValue;function m(g,v){var S=v(),w=i({inst:{value:S,getSnapshot:v}}),N=w[0].inst,j=w[1];return c(function(){N.value=S,N.getSnapshot=v,h(N)&&j({inst:N})},[g,S,v]),l(function(){return h(N)&&j({inst:N}),g(function(){h(N)&&j({inst:N})})},[g]),f(S),S}function h(g){var v=g.getSnapshot;g=g.value;try{var S=v();return!r(g,S)}catch{return!0}}function p(g,v){return v()}var y=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?p:m;return bp.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:y,bp}var zS;function rL(){return zS||(zS=1,gp.exports=sL()),gp.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $S;function iL(){if($S)return yp;$S=1;var e=Nc(),t=rL();function r(p,y){return p===y&&(p!==0||1/p===1/y)||p!==p&&y!==y}var i=typeof Object.is=="function"?Object.is:r,l=t.useSyncExternalStore,c=e.useRef,f=e.useEffect,m=e.useMemo,h=e.useDebugValue;return yp.useSyncExternalStoreWithSelector=function(p,y,g,v,S){var w=c(null);if(w.current===null){var N={hasValue:!1,value:null};w.current=N}else N=w.current;w=m(function(){function _(M){if(!C){if(C=!0,O=M,M=v(M),S!==void 0&&N.hasValue){var A=N.value;if(S(A,M))return E=A}return E=M}if(A=E,i(O,M))return A;var z=v(M);return S!==void 0&&S(A,z)?(O=M,A):(O=M,E=z)}var C=!1,O,E,T=g===void 0?null:g;return[function(){return _(y())},T===null?void 0:function(){return _(T())}]},[y,g,v,S]);var j=l(p,w[0],w[1]);return f(function(){N.hasValue=!0,N.value=j},[j]),h(j),j},yp}var FS;function lL(){return FS||(FS=1,pp.exports=iL()),pp.exports}var oL=lL();const cL=ki(oL),uL={},BS=e=>{let t;const r=new Set,i=(y,g)=>{const v=typeof y=="function"?y(t):y;if(!Object.is(v,t)){const S=t;t=g??(typeof v!="object"||v===null)?v:Object.assign({},t,v),r.forEach(w=>w(t,S))}},l=()=>t,h={setState:i,getState:l,getInitialState:()=>p,subscribe:y=>(r.add(y),()=>r.delete(y)),destroy:()=>{(uL?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},p=t=e(i,l,h);return h},dL=e=>e?BS(e):BS,{useDebugValue:fL}=De,{useSyncExternalStoreWithSelector:mL}=cL,hL=e=>e;function BN(e,t=hL,r){const i=mL(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return fL(i),i}const US=(e,t)=>{const r=dL(e),i=(l,c=t)=>BN(r,l,c);return Object.assign(i,r),i},pL=(e,t)=>e?US(e,t):US;function sa(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[i,l]of e)if(!Object.is(l,t.get(i)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(const i of r)if(!Object.prototype.hasOwnProperty.call(t,i)||!Object.is(e[i],t[i]))return!1;return!0}var yL={value:()=>{}};function xf(){for(var e=0,t=arguments.length,r={},i;e<t;++e){if(!(i=arguments[e]+"")||i in r||/[\s.]/.test(i))throw new Error("illegal type: "+i);r[i]=[]}return new wd(r)}function wd(e){this._=e}function gL(e,t){return e.trim().split(/^|\s+/).map(function(r){var i="",l=r.indexOf(".");if(l>=0&&(i=r.slice(l+1),r=r.slice(0,l)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:i}})}wd.prototype=xf.prototype={constructor:wd,on:function(e,t){var r=this._,i=gL(e+"",r),l,c=-1,f=i.length;if(arguments.length<2){for(;++c<f;)if((l=(e=i[c]).type)&&(l=bL(r[l],e.name)))return l;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++c<f;)if(l=(e=i[c]).type)r[l]=qS(r[l],e.name,t);else if(t==null)for(l in r)r[l]=qS(r[l],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new wd(e)},call:function(e,t){if((l=arguments.length-2)>0)for(var r=new Array(l),i=0,l,c;i<l;++i)r[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(c=this._[e],i=0,l=c.length;i<l;++i)c[i].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],l=0,c=i.length;l<c;++l)i[l].value.apply(t,r)}};function bL(e,t){for(var r=0,i=e.length,l;r<i;++r)if((l=e[r]).name===t)return l.value}function qS(e,t,r){for(var i=0,l=e.length;i<l;++i)if(e[i].name===t){e[i]=yL,e=e.slice(0,i).concat(e.slice(i+1));break}return r!=null&&e.push({name:t,value:r}),e}var ay="http://www.w3.org/1999/xhtml";const HS={svg:"http://www.w3.org/2000/svg",xhtml:ay,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Sf(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),HS.hasOwnProperty(t)?{space:HS[t],local:e}:e}function vL(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===ay&&t.documentElement.namespaceURI===ay?t.createElement(e):t.createElementNS(r,e)}}function xL(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function UN(e){var t=Sf(e);return(t.local?xL:vL)(t)}function SL(){}function lg(e){return e==null?SL:function(){return this.querySelector(e)}}function wL(e){typeof e!="function"&&(e=lg(e));for(var t=this._groups,r=t.length,i=new Array(r),l=0;l<r;++l)for(var c=t[l],f=c.length,m=i[l]=new Array(f),h,p,y=0;y<f;++y)(h=c[y])&&(p=e.call(h,h.__data__,y,c))&&("__data__"in h&&(p.__data__=h.__data__),m[y]=p);return new Va(i,this._parents)}function NL(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function EL(){return[]}function qN(e){return e==null?EL:function(){return this.querySelectorAll(e)}}function jL(e){return function(){return NL(e.apply(this,arguments))}}function _L(e){typeof e=="function"?e=jL(e):e=qN(e);for(var t=this._groups,r=t.length,i=[],l=[],c=0;c<r;++c)for(var f=t[c],m=f.length,h,p=0;p<m;++p)(h=f[p])&&(i.push(e.call(h,h.__data__,p,f)),l.push(h));return new Va(i,l)}function HN(e){return function(){return this.matches(e)}}function PN(e){return function(t){return t.matches(e)}}var CL=Array.prototype.find;function AL(e){return function(){return CL.call(this.children,e)}}function TL(){return this.firstElementChild}function ML(e){return this.select(e==null?TL:AL(typeof e=="function"?e:PN(e)))}var RL=Array.prototype.filter;function kL(){return Array.from(this.children)}function DL(e){return function(){return RL.call(this.children,e)}}function IL(e){return this.selectAll(e==null?kL:DL(typeof e=="function"?e:PN(e)))}function LL(e){typeof e!="function"&&(e=HN(e));for(var t=this._groups,r=t.length,i=new Array(r),l=0;l<r;++l)for(var c=t[l],f=c.length,m=i[l]=[],h,p=0;p<f;++p)(h=c[p])&&e.call(h,h.__data__,p,c)&&m.push(h);return new Va(i,this._parents)}function VN(e){return new Array(e.length)}function OL(){return new Va(this._enter||this._groups.map(VN),this._parents)}function zd(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}zd.prototype={constructor:zd,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function zL(e){return function(){return e}}function $L(e,t,r,i,l,c){for(var f=0,m,h=t.length,p=c.length;f<p;++f)(m=t[f])?(m.__data__=c[f],i[f]=m):r[f]=new zd(e,c[f]);for(;f<h;++f)(m=t[f])&&(l[f]=m)}function FL(e,t,r,i,l,c,f){var m,h,p=new Map,y=t.length,g=c.length,v=new Array(y),S;for(m=0;m<y;++m)(h=t[m])&&(v[m]=S=f.call(h,h.__data__,m,t)+"",p.has(S)?l[m]=h:p.set(S,h));for(m=0;m<g;++m)S=f.call(e,c[m],m,c)+"",(h=p.get(S))?(i[m]=h,h.__data__=c[m],p.delete(S)):r[m]=new zd(e,c[m]);for(m=0;m<y;++m)(h=t[m])&&p.get(v[m])===h&&(l[m]=h)}function BL(e){return e.__data__}function UL(e,t){if(!arguments.length)return Array.from(this,BL);var r=t?FL:$L,i=this._parents,l=this._groups;typeof e!="function"&&(e=zL(e));for(var c=l.length,f=new Array(c),m=new Array(c),h=new Array(c),p=0;p<c;++p){var y=i[p],g=l[p],v=g.length,S=qL(e.call(y,y&&y.__data__,p,i)),w=S.length,N=m[p]=new Array(w),j=f[p]=new Array(w),_=h[p]=new Array(v);r(y,g,N,j,_,S,t);for(var C=0,O=0,E,T;C<w;++C)if(E=N[C]){for(C>=O&&(O=C+1);!(T=j[O])&&++O<w;);E._next=T||null}}return f=new Va(f,i),f._enter=m,f._exit=h,f}function qL(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function HL(){return new Va(this._exit||this._groups.map(VN),this._parents)}function PL(e,t,r){var i=this.enter(),l=this,c=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),t!=null&&(l=t(l),l&&(l=l.selection())),r==null?c.remove():r(c),i&&l?i.merge(l).order():l}function VL(e){for(var t=e.selection?e.selection():e,r=this._groups,i=t._groups,l=r.length,c=i.length,f=Math.min(l,c),m=new Array(l),h=0;h<f;++h)for(var p=r[h],y=i[h],g=p.length,v=m[h]=new Array(g),S,w=0;w<g;++w)(S=p[w]||y[w])&&(v[w]=S);for(;h<l;++h)m[h]=r[h];return new Va(m,this._parents)}function YL(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var i=e[t],l=i.length-1,c=i[l],f;--l>=0;)(f=i[l])&&(c&&f.compareDocumentPosition(c)^4&&c.parentNode.insertBefore(f,c),c=f);return this}function GL(e){e||(e=XL);function t(g,v){return g&&v?e(g.__data__,v.__data__):!g-!v}for(var r=this._groups,i=r.length,l=new Array(i),c=0;c<i;++c){for(var f=r[c],m=f.length,h=l[c]=new Array(m),p,y=0;y<m;++y)(p=f[y])&&(h[y]=p);h.sort(t)}return new Va(l,this._parents).order()}function XL(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function KL(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function WL(){return Array.from(this)}function ZL(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],l=0,c=i.length;l<c;++l){var f=i[l];if(f)return f}return null}function QL(){let e=0;for(const t of this)++e;return e}function JL(){return!this.node()}function e5(e){for(var t=this._groups,r=0,i=t.length;r<i;++r)for(var l=t[r],c=0,f=l.length,m;c<f;++c)(m=l[c])&&e.call(m,m.__data__,c,l);return this}function t5(e){return function(){this.removeAttribute(e)}}function n5(e){return function(){this.removeAttributeNS(e.space,e.local)}}function a5(e,t){return function(){this.setAttribute(e,t)}}function s5(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function r5(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function i5(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function l5(e,t){var r=Sf(e);if(arguments.length<2){var i=this.node();return r.local?i.getAttributeNS(r.space,r.local):i.getAttribute(r)}return this.each((t==null?r.local?n5:t5:typeof t=="function"?r.local?i5:r5:r.local?s5:a5)(r,t))}function YN(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function o5(e){return function(){this.style.removeProperty(e)}}function c5(e,t,r){return function(){this.style.setProperty(e,t,r)}}function u5(e,t,r){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,r)}}function d5(e,t,r){return arguments.length>1?this.each((t==null?o5:typeof t=="function"?u5:c5)(e,t,r??"")):Dl(this.node(),e)}function Dl(e,t){return e.style.getPropertyValue(t)||YN(e).getComputedStyle(e,null).getPropertyValue(t)}function f5(e){return function(){delete this[e]}}function m5(e,t){return function(){this[e]=t}}function h5(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function p5(e,t){return arguments.length>1?this.each((t==null?f5:typeof t=="function"?h5:m5)(e,t)):this.node()[e]}function GN(e){return e.trim().split(/^|\s+/)}function og(e){return e.classList||new XN(e)}function XN(e){this._node=e,this._names=GN(e.getAttribute("class")||"")}XN.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function KN(e,t){for(var r=og(e),i=-1,l=t.length;++i<l;)r.add(t[i])}function WN(e,t){for(var r=og(e),i=-1,l=t.length;++i<l;)r.remove(t[i])}function y5(e){return function(){KN(this,e)}}function g5(e){return function(){WN(this,e)}}function b5(e,t){return function(){(t.apply(this,arguments)?KN:WN)(this,e)}}function v5(e,t){var r=GN(e+"");if(arguments.length<2){for(var i=og(this.node()),l=-1,c=r.length;++l<c;)if(!i.contains(r[l]))return!1;return!0}return this.each((typeof t=="function"?b5:t?y5:g5)(r,t))}function x5(){this.textContent=""}function S5(e){return function(){this.textContent=e}}function w5(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function N5(e){return arguments.length?this.each(e==null?x5:(typeof e=="function"?w5:S5)(e)):this.node().textContent}function E5(){this.innerHTML=""}function j5(e){return function(){this.innerHTML=e}}function _5(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function C5(e){return arguments.length?this.each(e==null?E5:(typeof e=="function"?_5:j5)(e)):this.node().innerHTML}function A5(){this.nextSibling&&this.parentNode.appendChild(this)}function T5(){return this.each(A5)}function M5(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function R5(){return this.each(M5)}function k5(e){var t=typeof e=="function"?e:UN(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function D5(){return null}function I5(e,t){var r=typeof e=="function"?e:UN(e),i=t==null?D5:typeof t=="function"?t:lg(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),i.apply(this,arguments)||null)})}function L5(){var e=this.parentNode;e&&e.removeChild(this)}function O5(){return this.each(L5)}function z5(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function $5(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function F5(e){return this.select(e?$5:z5)}function B5(e){return arguments.length?this.property("__data__",e):this.node().__data__}function U5(e){return function(t){e.call(this,t,this.__data__)}}function q5(e){return e.trim().split(/^|\s+/).map(function(t){var r="",i=t.indexOf(".");return i>=0&&(r=t.slice(i+1),t=t.slice(0,i)),{type:t,name:r}})}function H5(e){return function(){var t=this.__on;if(t){for(var r=0,i=-1,l=t.length,c;r<l;++r)c=t[r],(!e.type||c.type===e.type)&&c.name===e.name?this.removeEventListener(c.type,c.listener,c.options):t[++i]=c;++i?t.length=i:delete this.__on}}}function P5(e,t,r){return function(){var i=this.__on,l,c=U5(t);if(i){for(var f=0,m=i.length;f<m;++f)if((l=i[f]).type===e.type&&l.name===e.name){this.removeEventListener(l.type,l.listener,l.options),this.addEventListener(l.type,l.listener=c,l.options=r),l.value=t;return}}this.addEventListener(e.type,c,r),l={type:e.type,name:e.name,value:t,listener:c,options:r},i?i.push(l):this.__on=[l]}}function V5(e,t,r){var i=q5(e+""),l,c=i.length,f;if(arguments.length<2){var m=this.node().__on;if(m){for(var h=0,p=m.length,y;h<p;++h)for(l=0,y=m[h];l<c;++l)if((f=i[l]).type===y.type&&f.name===y.name)return y.value}return}for(m=t?P5:H5,l=0;l<c;++l)this.each(m(i[l],t,r));return this}function ZN(e,t,r){var i=YN(e),l=i.CustomEvent;typeof l=="function"?l=new l(t,r):(l=i.document.createEvent("Event"),r?(l.initEvent(t,r.bubbles,r.cancelable),l.detail=r.detail):l.initEvent(t,!1,!1)),e.dispatchEvent(l)}function Y5(e,t){return function(){return ZN(this,e,t)}}function G5(e,t){return function(){return ZN(this,e,t.apply(this,arguments))}}function X5(e,t){return this.each((typeof t=="function"?G5:Y5)(e,t))}function*K5(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],l=0,c=i.length,f;l<c;++l)(f=i[l])&&(yield f)}var QN=[null];function Va(e,t){this._groups=e,this._parents=t}function Ac(){return new Va([[document.documentElement]],QN)}function W5(){return this}Va.prototype=Ac.prototype={constructor:Va,select:wL,selectAll:_L,selectChild:ML,selectChildren:IL,filter:LL,data:UL,enter:OL,exit:HL,join:PL,merge:VL,selection:W5,order:YL,sort:GL,call:KL,nodes:WL,node:ZL,size:QL,empty:JL,each:e5,attr:l5,style:d5,property:p5,classed:v5,text:N5,html:C5,raise:T5,lower:R5,append:k5,insert:I5,remove:O5,clone:F5,datum:B5,on:V5,dispatch:X5,[Symbol.iterator]:K5};function ss(e){return typeof e=="string"?new Va([[document.querySelector(e)]],[document.documentElement]):new Va([[e]],QN)}function Z5(e){let t;for(;t=e.sourceEvent;)e=t;return e}function ms(e,t){if(e=Z5(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var i=r.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}if(t.getBoundingClientRect){var l=t.getBoundingClientRect();return[e.clientX-l.left-t.clientLeft,e.clientY-l.top-t.clientTop]}}return[e.pageX,e.pageY]}const Q5={passive:!1},hc={capture:!0,passive:!1};function vp(e){e.stopImmediatePropagation()}function _l(e){e.preventDefault(),e.stopImmediatePropagation()}function JN(e){var t=e.document.documentElement,r=ss(e).on("dragstart.drag",_l,hc);"onselectstart"in t?r.on("selectstart.drag",_l,hc):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function eE(e,t){var r=e.document.documentElement,i=ss(e).on("dragstart.drag",null);t&&(i.on("click.drag",_l,hc),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in r?i.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}const Ju=e=>()=>e;function sy(e,{sourceEvent:t,subject:r,target:i,identifier:l,active:c,x:f,y:m,dx:h,dy:p,dispatch:y}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:l,enumerable:!0,configurable:!0},active:{value:c,enumerable:!0,configurable:!0},x:{value:f,enumerable:!0,configurable:!0},y:{value:m,enumerable:!0,configurable:!0},dx:{value:h,enumerable:!0,configurable:!0},dy:{value:p,enumerable:!0,configurable:!0},_:{value:y}})}sy.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function J5(e){return!e.ctrlKey&&!e.button}function eO(){return this.parentNode}function tO(e,t){return t??{x:e.x,y:e.y}}function nO(){return navigator.maxTouchPoints||"ontouchstart"in this}function aO(){var e=J5,t=eO,r=tO,i=nO,l={},c=xf("start","drag","end"),f=0,m,h,p,y,g=0;function v(E){E.on("mousedown.drag",S).filter(i).on("touchstart.drag",j).on("touchmove.drag",_,Q5).on("touchend.drag touchcancel.drag",C).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function S(E,T){if(!(y||!e.call(this,E,T))){var M=O(this,t.call(this,E,T),E,T,"mouse");M&&(ss(E.view).on("mousemove.drag",w,hc).on("mouseup.drag",N,hc),JN(E.view),vp(E),p=!1,m=E.clientX,h=E.clientY,M("start",E))}}function w(E){if(_l(E),!p){var T=E.clientX-m,M=E.clientY-h;p=T*T+M*M>g}l.mouse("drag",E)}function N(E){ss(E.view).on("mousemove.drag mouseup.drag",null),eE(E.view,p),_l(E),l.mouse("end",E)}function j(E,T){if(e.call(this,E,T)){var M=E.changedTouches,A=t.call(this,E,T),z=M.length,P,X;for(P=0;P<z;++P)(X=O(this,A,E,T,M[P].identifier,M[P]))&&(vp(E),X("start",E,M[P]))}}function _(E){var T=E.changedTouches,M=T.length,A,z;for(A=0;A<M;++A)(z=l[T[A].identifier])&&(_l(E),z("drag",E,T[A]))}function C(E){var T=E.changedTouches,M=T.length,A,z;for(y&&clearTimeout(y),y=setTimeout(function(){y=null},500),A=0;A<M;++A)(z=l[T[A].identifier])&&(vp(E),z("end",E,T[A]))}function O(E,T,M,A,z,P){var X=c.copy(),H=ms(P||M,T),Y,V,I;if((I=r.call(E,new sy("beforestart",{sourceEvent:M,target:v,identifier:z,active:f,x:H[0],y:H[1],dx:0,dy:0,dispatch:X}),A))!=null)return Y=I.x-H[0]||0,V=I.y-H[1]||0,function F(D,L,B){var k=H,U;switch(D){case"start":l[z]=F,U=f++;break;case"end":delete l[z],--f;case"drag":H=ms(B||L,T),U=f;break}X.call(D,E,new sy(D,{sourceEvent:L,subject:I,target:v,identifier:z,active:U,x:H[0]+Y,y:H[1]+V,dx:H[0]-k[0],dy:H[1]-k[1],dispatch:X}),A)}}return v.filter=function(E){return arguments.length?(e=typeof E=="function"?E:Ju(!!E),v):e},v.container=function(E){return arguments.length?(t=typeof E=="function"?E:Ju(E),v):t},v.subject=function(E){return arguments.length?(r=typeof E=="function"?E:Ju(E),v):r},v.touchable=function(E){return arguments.length?(i=typeof E=="function"?E:Ju(!!E),v):i},v.on=function(){var E=c.on.apply(c,arguments);return E===c?v:E},v.clickDistance=function(E){return arguments.length?(g=(E=+E)*E,v):Math.sqrt(g)},v}function cg(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function tE(e,t){var r=Object.create(e.prototype);for(var i in t)r[i]=t[i];return r}function Tc(){}var pc=.7,$d=1/pc,Cl="\\s*([+-]?\\d+)\\s*",yc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Rs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",sO=/^#([0-9a-f]{3,8})$/,rO=new RegExp(`^rgb\\(${Cl},${Cl},${Cl}\\)$`),iO=new RegExp(`^rgb\\(${Rs},${Rs},${Rs}\\)$`),lO=new RegExp(`^rgba\\(${Cl},${Cl},${Cl},${yc}\\)$`),oO=new RegExp(`^rgba\\(${Rs},${Rs},${Rs},${yc}\\)$`),cO=new RegExp(`^hsl\\(${yc},${Rs},${Rs}\\)$`),uO=new RegExp(`^hsla\\(${yc},${Rs},${Rs},${yc}\\)$`),PS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};cg(Tc,gc,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:VS,formatHex:VS,formatHex8:dO,formatHsl:fO,formatRgb:YS,toString:YS});function VS(){return this.rgb().formatHex()}function dO(){return this.rgb().formatHex8()}function fO(){return nE(this).formatHsl()}function YS(){return this.rgb().formatRgb()}function gc(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=sO.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?GS(t):r===3?new Ta(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?ed(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?ed(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=rO.exec(e))?new Ta(t[1],t[2],t[3],1):(t=iO.exec(e))?new Ta(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=lO.exec(e))?ed(t[1],t[2],t[3],t[4]):(t=oO.exec(e))?ed(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=cO.exec(e))?WS(t[1],t[2]/100,t[3]/100,1):(t=uO.exec(e))?WS(t[1],t[2]/100,t[3]/100,t[4]):PS.hasOwnProperty(e)?GS(PS[e]):e==="transparent"?new Ta(NaN,NaN,NaN,0):null}function GS(e){return new Ta(e>>16&255,e>>8&255,e&255,1)}function ed(e,t,r,i){return i<=0&&(e=t=r=NaN),new Ta(e,t,r,i)}function mO(e){return e instanceof Tc||(e=gc(e)),e?(e=e.rgb(),new Ta(e.r,e.g,e.b,e.opacity)):new Ta}function ry(e,t,r,i){return arguments.length===1?mO(e):new Ta(e,t,r,i??1)}function Ta(e,t,r,i){this.r=+e,this.g=+t,this.b=+r,this.opacity=+i}cg(Ta,ry,tE(Tc,{brighter(e){return e=e==null?$d:Math.pow($d,e),new Ta(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?pc:Math.pow(pc,e),new Ta(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ta(Ai(this.r),Ai(this.g),Ai(this.b),Fd(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:XS,formatHex:XS,formatHex8:hO,formatRgb:KS,toString:KS}));function XS(){return`#${_i(this.r)}${_i(this.g)}${_i(this.b)}`}function hO(){return`#${_i(this.r)}${_i(this.g)}${_i(this.b)}${_i((isNaN(this.opacity)?1:this.opacity)*255)}`}function KS(){const e=Fd(this.opacity);return`${e===1?"rgb(":"rgba("}${Ai(this.r)}, ${Ai(this.g)}, ${Ai(this.b)}${e===1?")":`, ${e})`}`}function Fd(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ai(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function _i(e){return e=Ai(e),(e<16?"0":"")+e.toString(16)}function WS(e,t,r,i){return i<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new hs(e,t,r,i)}function nE(e){if(e instanceof hs)return new hs(e.h,e.s,e.l,e.opacity);if(e instanceof Tc||(e=gc(e)),!e)return new hs;if(e instanceof hs)return e;e=e.rgb();var t=e.r/255,r=e.g/255,i=e.b/255,l=Math.min(t,r,i),c=Math.max(t,r,i),f=NaN,m=c-l,h=(c+l)/2;return m?(t===c?f=(r-i)/m+(r<i)*6:r===c?f=(i-t)/m+2:f=(t-r)/m+4,m/=h<.5?c+l:2-c-l,f*=60):m=h>0&&h<1?0:f,new hs(f,m,h,e.opacity)}function pO(e,t,r,i){return arguments.length===1?nE(e):new hs(e,t,r,i??1)}function hs(e,t,r,i){this.h=+e,this.s=+t,this.l=+r,this.opacity=+i}cg(hs,pO,tE(Tc,{brighter(e){return e=e==null?$d:Math.pow($d,e),new hs(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?pc:Math.pow(pc,e),new hs(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*t,l=2*r-i;return new Ta(xp(e>=240?e-240:e+120,l,i),xp(e,l,i),xp(e<120?e+240:e-120,l,i),this.opacity)},clamp(){return new hs(ZS(this.h),td(this.s),td(this.l),Fd(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Fd(this.opacity);return`${e===1?"hsl(":"hsla("}${ZS(this.h)}, ${td(this.s)*100}%, ${td(this.l)*100}%${e===1?")":`, ${e})`}`}}));function ZS(e){return e=(e||0)%360,e<0?e+360:e}function td(e){return Math.max(0,Math.min(1,e||0))}function xp(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const aE=e=>()=>e;function yO(e,t){return function(r){return e+r*t}}function gO(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(i){return Math.pow(e+i*t,r)}}function bO(e){return(e=+e)==1?sE:function(t,r){return r-t?gO(t,r,e):aE(isNaN(t)?r:t)}}function sE(e,t){var r=t-e;return r?yO(e,r):aE(isNaN(e)?t:e)}const QS=(function e(t){var r=bO(t);function i(l,c){var f=r((l=ry(l)).r,(c=ry(c)).r),m=r(l.g,c.g),h=r(l.b,c.b),p=sE(l.opacity,c.opacity);return function(y){return l.r=f(y),l.g=m(y),l.b=h(y),l.opacity=p(y),l+""}}return i.gamma=e,i})(1);function zr(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}var iy=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Sp=new RegExp(iy.source,"g");function vO(e){return function(){return e}}function xO(e){return function(t){return e(t)+""}}function SO(e,t){var r=iy.lastIndex=Sp.lastIndex=0,i,l,c,f=-1,m=[],h=[];for(e=e+"",t=t+"";(i=iy.exec(e))&&(l=Sp.exec(t));)(c=l.index)>r&&(c=t.slice(r,c),m[f]?m[f]+=c:m[++f]=c),(i=i[0])===(l=l[0])?m[f]?m[f]+=l:m[++f]=l:(m[++f]=null,h.push({i:f,x:zr(i,l)})),r=Sp.lastIndex;return r<t.length&&(c=t.slice(r),m[f]?m[f]+=c:m[++f]=c),m.length<2?h[0]?xO(h[0].x):vO(t):(t=h.length,function(p){for(var y=0,g;y<t;++y)m[(g=h[y]).i]=g.x(p);return m.join("")})}var JS=180/Math.PI,ly={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function rE(e,t,r,i,l,c){var f,m,h;return(f=Math.sqrt(e*e+t*t))&&(e/=f,t/=f),(h=e*r+t*i)&&(r-=e*h,i-=t*h),(m=Math.sqrt(r*r+i*i))&&(r/=m,i/=m,h/=m),e*i<t*r&&(e=-e,t=-t,h=-h,f=-f),{translateX:l,translateY:c,rotate:Math.atan2(t,e)*JS,skewX:Math.atan(h)*JS,scaleX:f,scaleY:m}}var nd;function wO(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?ly:rE(t.a,t.b,t.c,t.d,t.e,t.f)}function NO(e){return e==null||(nd||(nd=document.createElementNS("http://www.w3.org/2000/svg","g")),nd.setAttribute("transform",e),!(e=nd.transform.baseVal.consolidate()))?ly:(e=e.matrix,rE(e.a,e.b,e.c,e.d,e.e,e.f))}function iE(e,t,r,i){function l(p){return p.length?p.pop()+" ":""}function c(p,y,g,v,S,w){if(p!==g||y!==v){var N=S.push("translate(",null,t,null,r);w.push({i:N-4,x:zr(p,g)},{i:N-2,x:zr(y,v)})}else(g||v)&&S.push("translate("+g+t+v+r)}function f(p,y,g,v){p!==y?(p-y>180?y+=360:y-p>180&&(p+=360),v.push({i:g.push(l(g)+"rotate(",null,i)-2,x:zr(p,y)})):y&&g.push(l(g)+"rotate("+y+i)}function m(p,y,g,v){p!==y?v.push({i:g.push(l(g)+"skewX(",null,i)-2,x:zr(p,y)}):y&&g.push(l(g)+"skewX("+y+i)}function h(p,y,g,v,S,w){if(p!==g||y!==v){var N=S.push(l(S)+"scale(",null,",",null,")");w.push({i:N-4,x:zr(p,g)},{i:N-2,x:zr(y,v)})}else(g!==1||v!==1)&&S.push(l(S)+"scale("+g+","+v+")")}return function(p,y){var g=[],v=[];return p=e(p),y=e(y),c(p.translateX,p.translateY,y.translateX,y.translateY,g,v),f(p.rotate,y.rotate,g,v),m(p.skewX,y.skewX,g,v),h(p.scaleX,p.scaleY,y.scaleX,y.scaleY,g,v),p=y=null,function(S){for(var w=-1,N=v.length,j;++w<N;)g[(j=v[w]).i]=j.x(S);return g.join("")}}}var EO=iE(wO,"px, ","px)","deg)"),jO=iE(NO,", ",")",")"),_O=1e-12;function ew(e){return((e=Math.exp(e))+1/e)/2}function CO(e){return((e=Math.exp(e))-1/e)/2}function AO(e){return((e=Math.exp(2*e))-1)/(e+1)}const TO=(function e(t,r,i){function l(c,f){var m=c[0],h=c[1],p=c[2],y=f[0],g=f[1],v=f[2],S=y-m,w=g-h,N=S*S+w*w,j,_;if(N<_O)_=Math.log(v/p)/t,j=function(A){return[m+A*S,h+A*w,p*Math.exp(t*A*_)]};else{var C=Math.sqrt(N),O=(v*v-p*p+i*N)/(2*p*r*C),E=(v*v-p*p-i*N)/(2*v*r*C),T=Math.log(Math.sqrt(O*O+1)-O),M=Math.log(Math.sqrt(E*E+1)-E);_=(M-T)/t,j=function(A){var z=A*_,P=ew(T),X=p/(r*C)*(P*AO(t*z+T)-CO(T));return[m+X*S,h+X*w,p*P/ew(t*z+T)]}}return j.duration=_*1e3*t/Math.SQRT2,j}return l.rho=function(c){var f=Math.max(.001,+c),m=f*f,h=m*m;return e(f,m,h)},l})(Math.SQRT2,2,4);var Il=0,Zo=0,Fo=0,lE=1e3,Bd,Qo,Ud=0,Mi=0,wf=0,bc=typeof performance=="object"&&performance.now?performance:Date,oE=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function ug(){return Mi||(oE(MO),Mi=bc.now()+wf)}function MO(){Mi=0}function qd(){this._call=this._time=this._next=null}qd.prototype=cE.prototype={constructor:qd,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?ug():+r)+(t==null?0:+t),!this._next&&Qo!==this&&(Qo?Qo._next=this:Bd=this,Qo=this),this._call=e,this._time=r,oy()},stop:function(){this._call&&(this._call=null,this._time=1/0,oy())}};function cE(e,t,r){var i=new qd;return i.restart(e,t,r),i}function RO(){ug(),++Il;for(var e=Bd,t;e;)(t=Mi-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Il}function tw(){Mi=(Ud=bc.now())+wf,Il=Zo=0;try{RO()}finally{Il=0,DO(),Mi=0}}function kO(){var e=bc.now(),t=e-Ud;t>lE&&(wf-=t,Ud=e)}function DO(){for(var e,t=Bd,r,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:Bd=r);Qo=e,oy(i)}function oy(e){if(!Il){Zo&&(Zo=clearTimeout(Zo));var t=e-Mi;t>24?(e<1/0&&(Zo=setTimeout(tw,e-bc.now()-wf)),Fo&&(Fo=clearInterval(Fo))):(Fo||(Ud=bc.now(),Fo=setInterval(kO,lE)),Il=1,oE(tw))}}function nw(e,t,r){var i=new qd;return t=t==null?0:+t,i.restart(l=>{i.stop(),e(l+t)},t,r),i}var IO=xf("start","end","cancel","interrupt"),LO=[],uE=0,aw=1,cy=2,Nd=3,sw=4,uy=5,Ed=6;function Nf(e,t,r,i,l,c){var f=e.__transition;if(!f)e.__transition={};else if(r in f)return;OO(e,r,{name:t,index:i,group:l,on:IO,tween:LO,time:c.time,delay:c.delay,duration:c.duration,ease:c.ease,timer:null,state:uE})}function dg(e,t){var r=xs(e,t);if(r.state>uE)throw new Error("too late; already scheduled");return r}function Ls(e,t){var r=xs(e,t);if(r.state>Nd)throw new Error("too late; already running");return r}function xs(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function OO(e,t,r){var i=e.__transition,l;i[t]=r,r.timer=cE(c,0,r.time);function c(p){r.state=aw,r.timer.restart(f,r.delay,r.time),r.delay<=p&&f(p-r.delay)}function f(p){var y,g,v,S;if(r.state!==aw)return h();for(y in i)if(S=i[y],S.name===r.name){if(S.state===Nd)return nw(f);S.state===sw?(S.state=Ed,S.timer.stop(),S.on.call("interrupt",e,e.__data__,S.index,S.group),delete i[y]):+y<t&&(S.state=Ed,S.timer.stop(),S.on.call("cancel",e,e.__data__,S.index,S.group),delete i[y])}if(nw(function(){r.state===Nd&&(r.state=sw,r.timer.restart(m,r.delay,r.time),m(p))}),r.state=cy,r.on.call("start",e,e.__data__,r.index,r.group),r.state===cy){for(r.state=Nd,l=new Array(v=r.tween.length),y=0,g=-1;y<v;++y)(S=r.tween[y].value.call(e,e.__data__,r.index,r.group))&&(l[++g]=S);l.length=g+1}}function m(p){for(var y=p<r.duration?r.ease.call(null,p/r.duration):(r.timer.restart(h),r.state=uy,1),g=-1,v=l.length;++g<v;)l[g].call(e,y);r.state===uy&&(r.on.call("end",e,e.__data__,r.index,r.group),h())}function h(){r.state=Ed,r.timer.stop(),delete i[t];for(var p in i)return;delete e.__transition}}function jd(e,t){var r=e.__transition,i,l,c=!0,f;if(r){t=t==null?null:t+"";for(f in r){if((i=r[f]).name!==t){c=!1;continue}l=i.state>cy&&i.state<uy,i.state=Ed,i.timer.stop(),i.on.call(l?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete r[f]}c&&delete e.__transition}}function zO(e){return this.each(function(){jd(this,e)})}function $O(e,t){var r,i;return function(){var l=Ls(this,e),c=l.tween;if(c!==r){i=r=c;for(var f=0,m=i.length;f<m;++f)if(i[f].name===t){i=i.slice(),i.splice(f,1);break}}l.tween=i}}function FO(e,t,r){var i,l;if(typeof r!="function")throw new Error;return function(){var c=Ls(this,e),f=c.tween;if(f!==i){l=(i=f).slice();for(var m={name:t,value:r},h=0,p=l.length;h<p;++h)if(l[h].name===t){l[h]=m;break}h===p&&l.push(m)}c.tween=l}}function BO(e,t){var r=this._id;if(e+="",arguments.length<2){for(var i=xs(this.node(),r).tween,l=0,c=i.length,f;l<c;++l)if((f=i[l]).name===e)return f.value;return null}return this.each((t==null?$O:FO)(r,e,t))}function fg(e,t,r){var i=e._id;return e.each(function(){var l=Ls(this,i);(l.value||(l.value={}))[t]=r.apply(this,arguments)}),function(l){return xs(l,i).value[t]}}function dE(e,t){var r;return(typeof t=="number"?zr:t instanceof gc?QS:(r=gc(t))?(t=r,QS):SO)(e,t)}function UO(e){return function(){this.removeAttribute(e)}}function qO(e){return function(){this.removeAttributeNS(e.space,e.local)}}function HO(e,t,r){var i,l=r+"",c;return function(){var f=this.getAttribute(e);return f===l?null:f===i?c:c=t(i=f,r)}}function PO(e,t,r){var i,l=r+"",c;return function(){var f=this.getAttributeNS(e.space,e.local);return f===l?null:f===i?c:c=t(i=f,r)}}function VO(e,t,r){var i,l,c;return function(){var f,m=r(this),h;return m==null?void this.removeAttribute(e):(f=this.getAttribute(e),h=m+"",f===h?null:f===i&&h===l?c:(l=h,c=t(i=f,m)))}}function YO(e,t,r){var i,l,c;return function(){var f,m=r(this),h;return m==null?void this.removeAttributeNS(e.space,e.local):(f=this.getAttributeNS(e.space,e.local),h=m+"",f===h?null:f===i&&h===l?c:(l=h,c=t(i=f,m)))}}function GO(e,t){var r=Sf(e),i=r==="transform"?jO:dE;return this.attrTween(e,typeof t=="function"?(r.local?YO:VO)(r,i,fg(this,"attr."+e,t)):t==null?(r.local?qO:UO)(r):(r.local?PO:HO)(r,i,t))}function XO(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function KO(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function WO(e,t){var r,i;function l(){var c=t.apply(this,arguments);return c!==i&&(r=(i=c)&&KO(e,c)),r}return l._value=t,l}function ZO(e,t){var r,i;function l(){var c=t.apply(this,arguments);return c!==i&&(r=(i=c)&&XO(e,c)),r}return l._value=t,l}function QO(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var i=Sf(e);return this.tween(r,(i.local?WO:ZO)(i,t))}function JO(e,t){return function(){dg(this,e).delay=+t.apply(this,arguments)}}function e7(e,t){return t=+t,function(){dg(this,e).delay=t}}function t7(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?JO:e7)(t,e)):xs(this.node(),t).delay}function n7(e,t){return function(){Ls(this,e).duration=+t.apply(this,arguments)}}function a7(e,t){return t=+t,function(){Ls(this,e).duration=t}}function s7(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?n7:a7)(t,e)):xs(this.node(),t).duration}function r7(e,t){if(typeof t!="function")throw new Error;return function(){Ls(this,e).ease=t}}function i7(e){var t=this._id;return arguments.length?this.each(r7(t,e)):xs(this.node(),t).ease}function l7(e,t){return function(){var r=t.apply(this,arguments);if(typeof r!="function")throw new Error;Ls(this,e).ease=r}}function o7(e){if(typeof e!="function")throw new Error;return this.each(l7(this._id,e))}function c7(e){typeof e!="function"&&(e=HN(e));for(var t=this._groups,r=t.length,i=new Array(r),l=0;l<r;++l)for(var c=t[l],f=c.length,m=i[l]=[],h,p=0;p<f;++p)(h=c[p])&&e.call(h,h.__data__,p,c)&&m.push(h);return new ir(i,this._parents,this._name,this._id)}function u7(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,i=t.length,l=r.length,c=Math.min(i,l),f=new Array(i),m=0;m<c;++m)for(var h=t[m],p=r[m],y=h.length,g=f[m]=new Array(y),v,S=0;S<y;++S)(v=h[S]||p[S])&&(g[S]=v);for(;m<i;++m)f[m]=t[m];return new ir(f,this._parents,this._name,this._id)}function d7(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function f7(e,t,r){var i,l,c=d7(t)?dg:Ls;return function(){var f=c(this,e),m=f.on;m!==i&&(l=(i=m).copy()).on(t,r),f.on=l}}function m7(e,t){var r=this._id;return arguments.length<2?xs(this.node(),r).on.on(e):this.each(f7(r,e,t))}function h7(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function p7(){return this.on("end.remove",h7(this._id))}function y7(e){var t=this._name,r=this._id;typeof e!="function"&&(e=lg(e));for(var i=this._groups,l=i.length,c=new Array(l),f=0;f<l;++f)for(var m=i[f],h=m.length,p=c[f]=new Array(h),y,g,v=0;v<h;++v)(y=m[v])&&(g=e.call(y,y.__data__,v,m))&&("__data__"in y&&(g.__data__=y.__data__),p[v]=g,Nf(p[v],t,r,v,p,xs(y,r)));return new ir(c,this._parents,t,r)}function g7(e){var t=this._name,r=this._id;typeof e!="function"&&(e=qN(e));for(var i=this._groups,l=i.length,c=[],f=[],m=0;m<l;++m)for(var h=i[m],p=h.length,y,g=0;g<p;++g)if(y=h[g]){for(var v=e.call(y,y.__data__,g,h),S,w=xs(y,r),N=0,j=v.length;N<j;++N)(S=v[N])&&Nf(S,t,r,N,v,w);c.push(v),f.push(y)}return new ir(c,f,t,r)}var b7=Ac.prototype.constructor;function v7(){return new b7(this._groups,this._parents)}function x7(e,t){var r,i,l;return function(){var c=Dl(this,e),f=(this.style.removeProperty(e),Dl(this,e));return c===f?null:c===r&&f===i?l:l=t(r=c,i=f)}}function fE(e){return function(){this.style.removeProperty(e)}}function S7(e,t,r){var i,l=r+"",c;return function(){var f=Dl(this,e);return f===l?null:f===i?c:c=t(i=f,r)}}function w7(e,t,r){var i,l,c;return function(){var f=Dl(this,e),m=r(this),h=m+"";return m==null&&(h=m=(this.style.removeProperty(e),Dl(this,e))),f===h?null:f===i&&h===l?c:(l=h,c=t(i=f,m))}}function N7(e,t){var r,i,l,c="style."+t,f="end."+c,m;return function(){var h=Ls(this,e),p=h.on,y=h.value[c]==null?m||(m=fE(t)):void 0;(p!==r||l!==y)&&(i=(r=p).copy()).on(f,l=y),h.on=i}}function E7(e,t,r){var i=(e+="")=="transform"?EO:dE;return t==null?this.styleTween(e,x7(e,i)).on("end.style."+e,fE(e)):typeof t=="function"?this.styleTween(e,w7(e,i,fg(this,"style."+e,t))).each(N7(this._id,e)):this.styleTween(e,S7(e,i,t),r).on("end.style."+e,null)}function j7(e,t,r){return function(i){this.style.setProperty(e,t.call(this,i),r)}}function _7(e,t,r){var i,l;function c(){var f=t.apply(this,arguments);return f!==l&&(i=(l=f)&&j7(e,f,r)),i}return c._value=t,c}function C7(e,t,r){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,_7(e,t,r??""))}function A7(e){return function(){this.textContent=e}}function T7(e){return function(){var t=e(this);this.textContent=t??""}}function M7(e){return this.tween("text",typeof e=="function"?T7(fg(this,"text",e)):A7(e==null?"":e+""))}function R7(e){return function(t){this.textContent=e.call(this,t)}}function k7(e){var t,r;function i(){var l=e.apply(this,arguments);return l!==r&&(t=(r=l)&&R7(l)),t}return i._value=e,i}function D7(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,k7(e))}function I7(){for(var e=this._name,t=this._id,r=mE(),i=this._groups,l=i.length,c=0;c<l;++c)for(var f=i[c],m=f.length,h,p=0;p<m;++p)if(h=f[p]){var y=xs(h,t);Nf(h,e,r,p,f,{time:y.time+y.delay+y.duration,delay:0,duration:y.duration,ease:y.ease})}return new ir(i,this._parents,e,r)}function L7(){var e,t,r=this,i=r._id,l=r.size();return new Promise(function(c,f){var m={value:f},h={value:function(){--l===0&&c()}};r.each(function(){var p=Ls(this,i),y=p.on;y!==e&&(t=(e=y).copy(),t._.cancel.push(m),t._.interrupt.push(m),t._.end.push(h)),p.on=t}),l===0&&c()})}var O7=0;function ir(e,t,r,i){this._groups=e,this._parents=t,this._name=r,this._id=i}function mE(){return++O7}var Qs=Ac.prototype;ir.prototype={constructor:ir,select:y7,selectAll:g7,selectChild:Qs.selectChild,selectChildren:Qs.selectChildren,filter:c7,merge:u7,selection:v7,transition:I7,call:Qs.call,nodes:Qs.nodes,node:Qs.node,size:Qs.size,empty:Qs.empty,each:Qs.each,on:m7,attr:GO,attrTween:QO,style:E7,styleTween:C7,text:M7,textTween:D7,remove:p7,tween:BO,delay:t7,duration:s7,ease:i7,easeVarying:o7,end:L7,[Symbol.iterator]:Qs[Symbol.iterator]};function z7(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var $7={time:null,delay:0,duration:250,ease:z7};function F7(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}function B7(e){var t,r;e instanceof ir?(t=e._id,e=e._name):(t=mE(),(r=$7).time=ug(),e=e==null?null:e+"");for(var i=this._groups,l=i.length,c=0;c<l;++c)for(var f=i[c],m=f.length,h,p=0;p<m;++p)(h=f[p])&&Nf(h,e,t,p,f,r||F7(h,t));return new ir(i,this._parents,e,t)}Ac.prototype.interrupt=zO;Ac.prototype.transition=B7;const ad=e=>()=>e;function U7(e,{sourceEvent:t,target:r,transform:i,dispatch:l}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:l}})}function nr(e,t,r){this.k=e,this.x=t,this.y=r}nr.prototype={constructor:nr,scale:function(e){return e===1?this:new nr(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new nr(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var sr=new nr(1,0,0);nr.prototype;function wp(e){e.stopImmediatePropagation()}function Bo(e){e.preventDefault(),e.stopImmediatePropagation()}function q7(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function H7(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function rw(){return this.__zoom||sr}function P7(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function V7(){return navigator.maxTouchPoints||"ontouchstart"in this}function Y7(e,t,r){var i=e.invertX(t[0][0])-r[0][0],l=e.invertX(t[1][0])-r[1][0],c=e.invertY(t[0][1])-r[0][1],f=e.invertY(t[1][1])-r[1][1];return e.translate(l>i?(i+l)/2:Math.min(0,i)||Math.max(0,l),f>c?(c+f)/2:Math.min(0,c)||Math.max(0,f))}function hE(){var e=q7,t=H7,r=Y7,i=P7,l=V7,c=[0,1/0],f=[[-1/0,-1/0],[1/0,1/0]],m=250,h=TO,p=xf("start","zoom","end"),y,g,v,S=500,w=150,N=0,j=10;function _(I){I.property("__zoom",rw).on("wheel.zoom",z,{passive:!1}).on("mousedown.zoom",P).on("dblclick.zoom",X).filter(l).on("touchstart.zoom",H).on("touchmove.zoom",Y).on("touchend.zoom touchcancel.zoom",V).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}_.transform=function(I,F,D,L){var B=I.selection?I.selection():I;B.property("__zoom",rw),I!==B?T(I,F,D,L):B.interrupt().each(function(){M(this,arguments).event(L).start().zoom(null,typeof F=="function"?F.apply(this,arguments):F).end()})},_.scaleBy=function(I,F,D,L){_.scaleTo(I,function(){var B=this.__zoom.k,k=typeof F=="function"?F.apply(this,arguments):F;return B*k},D,L)},_.scaleTo=function(I,F,D,L){_.transform(I,function(){var B=t.apply(this,arguments),k=this.__zoom,U=D==null?E(B):typeof D=="function"?D.apply(this,arguments):D,R=k.invert(U),q=typeof F=="function"?F.apply(this,arguments):F;return r(O(C(k,q),U,R),B,f)},D,L)},_.translateBy=function(I,F,D,L){_.transform(I,function(){return r(this.__zoom.translate(typeof F=="function"?F.apply(this,arguments):F,typeof D=="function"?D.apply(this,arguments):D),t.apply(this,arguments),f)},null,L)},_.translateTo=function(I,F,D,L,B){_.transform(I,function(){var k=t.apply(this,arguments),U=this.__zoom,R=L==null?E(k):typeof L=="function"?L.apply(this,arguments):L;return r(sr.translate(R[0],R[1]).scale(U.k).translate(typeof F=="function"?-F.apply(this,arguments):-F,typeof D=="function"?-D.apply(this,arguments):-D),k,f)},L,B)};function C(I,F){return F=Math.max(c[0],Math.min(c[1],F)),F===I.k?I:new nr(F,I.x,I.y)}function O(I,F,D){var L=F[0]-D[0]*I.k,B=F[1]-D[1]*I.k;return L===I.x&&B===I.y?I:new nr(I.k,L,B)}function E(I){return[(+I[0][0]+ +I[1][0])/2,(+I[0][1]+ +I[1][1])/2]}function T(I,F,D,L){I.on("start.zoom",function(){M(this,arguments).event(L).start()}).on("interrupt.zoom end.zoom",function(){M(this,arguments).event(L).end()}).tween("zoom",function(){var B=this,k=arguments,U=M(B,k).event(L),R=t.apply(B,k),q=D==null?E(R):typeof D=="function"?D.apply(B,k):D,G=Math.max(R[1][0]-R[0][0],R[1][1]-R[0][1]),J=B.__zoom,ie=typeof F=="function"?F.apply(B,k):F,Z=h(J.invert(q).concat(G/J.k),ie.invert(q).concat(G/ie.k));return function(me){if(me===1)me=ie;else{var Q=Z(me),ue=G/Q[2];me=new nr(ue,q[0]-Q[0]*ue,q[1]-Q[1]*ue)}U.zoom(null,me)}})}function M(I,F,D){return!D&&I.__zooming||new A(I,F)}function A(I,F){this.that=I,this.args=F,this.active=0,this.sourceEvent=null,this.extent=t.apply(I,F),this.taps=0}A.prototype={event:function(I){return I&&(this.sourceEvent=I),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(I,F){return this.mouse&&I!=="mouse"&&(this.mouse[1]=F.invert(this.mouse[0])),this.touch0&&I!=="touch"&&(this.touch0[1]=F.invert(this.touch0[0])),this.touch1&&I!=="touch"&&(this.touch1[1]=F.invert(this.touch1[0])),this.that.__zoom=F,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(I){var F=ss(this.that).datum();p.call(I,this.that,new U7(I,{sourceEvent:this.sourceEvent,target:_,transform:this.that.__zoom,dispatch:p}),F)}};function z(I,...F){if(!e.apply(this,arguments))return;var D=M(this,F).event(I),L=this.__zoom,B=Math.max(c[0],Math.min(c[1],L.k*Math.pow(2,i.apply(this,arguments)))),k=ms(I);if(D.wheel)(D.mouse[0][0]!==k[0]||D.mouse[0][1]!==k[1])&&(D.mouse[1]=L.invert(D.mouse[0]=k)),clearTimeout(D.wheel);else{if(L.k===B)return;D.mouse=[k,L.invert(k)],jd(this),D.start()}Bo(I),D.wheel=setTimeout(U,w),D.zoom("mouse",r(O(C(L,B),D.mouse[0],D.mouse[1]),D.extent,f));function U(){D.wheel=null,D.end()}}function P(I,...F){if(v||!e.apply(this,arguments))return;var D=I.currentTarget,L=M(this,F,!0).event(I),B=ss(I.view).on("mousemove.zoom",q,!0).on("mouseup.zoom",G,!0),k=ms(I,D),U=I.clientX,R=I.clientY;JN(I.view),wp(I),L.mouse=[k,this.__zoom.invert(k)],jd(this),L.start();function q(J){if(Bo(J),!L.moved){var ie=J.clientX-U,Z=J.clientY-R;L.moved=ie*ie+Z*Z>N}L.event(J).zoom("mouse",r(O(L.that.__zoom,L.mouse[0]=ms(J,D),L.mouse[1]),L.extent,f))}function G(J){B.on("mousemove.zoom mouseup.zoom",null),eE(J.view,L.moved),Bo(J),L.event(J).end()}}function X(I,...F){if(e.apply(this,arguments)){var D=this.__zoom,L=ms(I.changedTouches?I.changedTouches[0]:I,this),B=D.invert(L),k=D.k*(I.shiftKey?.5:2),U=r(O(C(D,k),L,B),t.apply(this,F),f);Bo(I),m>0?ss(this).transition().duration(m).call(T,U,L,I):ss(this).call(_.transform,U,L,I)}}function H(I,...F){if(e.apply(this,arguments)){var D=I.touches,L=D.length,B=M(this,F,I.changedTouches.length===L).event(I),k,U,R,q;for(wp(I),U=0;U<L;++U)R=D[U],q=ms(R,this),q=[q,this.__zoom.invert(q),R.identifier],B.touch0?!B.touch1&&B.touch0[2]!==q[2]&&(B.touch1=q,B.taps=0):(B.touch0=q,k=!0,B.taps=1+!!y);y&&(y=clearTimeout(y)),k&&(B.taps<2&&(g=q[0],y=setTimeout(function(){y=null},S)),jd(this),B.start())}}function Y(I,...F){if(this.__zooming){var D=M(this,F).event(I),L=I.changedTouches,B=L.length,k,U,R,q;for(Bo(I),k=0;k<B;++k)U=L[k],R=ms(U,this),D.touch0&&D.touch0[2]===U.identifier?D.touch0[0]=R:D.touch1&&D.touch1[2]===U.identifier&&(D.touch1[0]=R);if(U=D.that.__zoom,D.touch1){var G=D.touch0[0],J=D.touch0[1],ie=D.touch1[0],Z=D.touch1[1],me=(me=ie[0]-G[0])*me+(me=ie[1]-G[1])*me,Q=(Q=Z[0]-J[0])*Q+(Q=Z[1]-J[1])*Q;U=C(U,Math.sqrt(me/Q)),R=[(G[0]+ie[0])/2,(G[1]+ie[1])/2],q=[(J[0]+Z[0])/2,(J[1]+Z[1])/2]}else if(D.touch0)R=D.touch0[0],q=D.touch0[1];else return;D.zoom("touch",r(O(U,R,q),D.extent,f))}}function V(I,...F){if(this.__zooming){var D=M(this,F).event(I),L=I.changedTouches,B=L.length,k,U;for(wp(I),v&&clearTimeout(v),v=setTimeout(function(){v=null},S),k=0;k<B;++k)U=L[k],D.touch0&&D.touch0[2]===U.identifier?delete D.touch0:D.touch1&&D.touch1[2]===U.identifier&&delete D.touch1;if(D.touch1&&!D.touch0&&(D.touch0=D.touch1,delete D.touch1),D.touch0)D.touch0[1]=this.__zoom.invert(D.touch0[0]);else if(D.end(),D.taps===2&&(U=ms(U,this),Math.hypot(g[0]-U[0],g[1]-U[1])<j)){var R=ss(this).on("dblclick.zoom");R&&R.apply(this,arguments)}}}return _.wheelDelta=function(I){return arguments.length?(i=typeof I=="function"?I:ad(+I),_):i},_.filter=function(I){return arguments.length?(e=typeof I=="function"?I:ad(!!I),_):e},_.touchable=function(I){return arguments.length?(l=typeof I=="function"?I:ad(!!I),_):l},_.extent=function(I){return arguments.length?(t=typeof I=="function"?I:ad([[+I[0][0],+I[0][1]],[+I[1][0],+I[1][1]]]),_):t},_.scaleExtent=function(I){return arguments.length?(c[0]=+I[0],c[1]=+I[1],_):[c[0],c[1]]},_.translateExtent=function(I){return arguments.length?(f[0][0]=+I[0][0],f[1][0]=+I[1][0],f[0][1]=+I[0][1],f[1][1]=+I[1][1],_):[[f[0][0],f[0][1]],[f[1][0],f[1][1]]]},_.constrain=function(I){return arguments.length?(r=I,_):r},_.duration=function(I){return arguments.length?(m=+I,_):m},_.interpolate=function(I){return arguments.length?(h=I,_):h},_.on=function(){var I=p.on.apply(p,arguments);return I===p?_:I},_.clickDistance=function(I){return arguments.length?(N=(I=+I)*I,_):Math.sqrt(N)},_.tapDistance=function(I){return arguments.length?(j=+I,_):j},_}const Ef=u.createContext(null),G7=Ef.Provider,lr={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,t)=>`Couldn't create edge for ${e?"target":"source"} handle id: "${e?t.targetHandle:t.sourceHandle}", edge id: ${t.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},pE=lr.error001();function In(e,t){const r=u.useContext(Ef);if(r===null)throw new Error(pE);return BN(r,e,t)}const na=()=>{const e=u.useContext(Ef);if(e===null)throw new Error(pE);return u.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy}),[e])},X7=e=>e.userSelectionActive?"none":"all";function mg({position:e,children:t,className:r,style:i,...l}){const c=In(X7),f=`${e}`.split("-");return De.createElement("div",{className:ma(["react-flow__panel",r,...f]),style:{...i,pointerEvents:c},...l},t)}function K7({proOptions:e,position:t="bottom-right"}){return e?.hideAttribution?null:De.createElement(mg,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},De.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}const W7=({x:e,y:t,label:r,labelStyle:i={},labelShowBg:l=!0,labelBgStyle:c={},labelBgPadding:f=[2,4],labelBgBorderRadius:m=2,children:h,className:p,...y})=>{const g=u.useRef(null),[v,S]=u.useState({x:0,y:0,width:0,height:0}),w=ma(["react-flow__edge-textwrapper",p]);return u.useEffect(()=>{if(g.current){const N=g.current.getBBox();S({x:N.x,y:N.y,width:N.width,height:N.height})}},[r]),typeof r>"u"||!r?null:De.createElement("g",{transform:`translate(${e-v.width/2} ${t-v.height/2})`,className:w,visibility:v.width?"visible":"hidden",...y},l&&De.createElement("rect",{width:v.width+2*f[0],x:-f[0],y:-f[1],height:v.height+2*f[1],className:"react-flow__edge-textbg",style:c,rx:m,ry:m}),De.createElement("text",{className:"react-flow__edge-text",y:v.height/2,dy:"0.3em",ref:g,style:i},r),h)};var Z7=u.memo(W7);const hg=e=>({width:e.offsetWidth,height:e.offsetHeight}),Ll=(e,t=0,r=1)=>Math.min(Math.max(e,t),r),pg=(e={x:0,y:0},t)=>({x:Ll(e.x,t[0][0],t[1][0]),y:Ll(e.y,t[0][1],t[1][1])}),iw=(e,t,r)=>e<t?Ll(Math.abs(e-t),1,50)/50:e>r?-Ll(Math.abs(e-r),1,50)/50:0,yE=(e,t)=>{const r=iw(e.x,35,t.width-35)*20,i=iw(e.y,35,t.height-35)*20;return[r,i]},gE=e=>e.getRootNode?.()||window?.document,bE=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),vc=({x:e,y:t,width:r,height:i})=>({x:e,y:t,x2:e+r,y2:t+i}),vE=({x:e,y:t,x2:r,y2:i})=>({x:e,y:t,width:r-e,height:i-t}),lw=e=>({...e.positionAbsolute||{x:0,y:0},width:e.width||0,height:e.height||0}),Q7=(e,t)=>vE(bE(vc(e),vc(t))),dy=(e,t)=>{const r=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),i=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(r*i)},J7=e=>rs(e.width)&&rs(e.height)&&rs(e.x)&&rs(e.y),rs=e=>!isNaN(e)&&isFinite(e),Vn=Symbol.for("internals"),xE=["Enter"," ","Escape"],e6=(e,t)=>{},t6=e=>"nativeEvent"in e;function fy(e){const r=(t6(e)?e.nativeEvent:e).composedPath?.()?.[0]||e.target;return["INPUT","SELECT","TEXTAREA"].includes(r?.nodeName)||r?.hasAttribute("contenteditable")||!!r?.closest(".nokey")}const SE=e=>"clientX"in e,Pr=(e,t)=>{const r=SE(e),i=r?e.clientX:e.touches?.[0].clientX,l=r?e.clientY:e.touches?.[0].clientY;return{x:i-(t?.left??0),y:l-(t?.top??0)}},Hd=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0,Mc=({id:e,path:t,labelX:r,labelY:i,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:g,markerStart:v,interactionWidth:S=20})=>De.createElement(De.Fragment,null,De.createElement("path",{id:e,style:y,d:t,fill:"none",className:"react-flow__edge-path",markerEnd:g,markerStart:v}),S&&De.createElement("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:S,className:"react-flow__edge-interaction"}),l&&rs(r)&&rs(i)?De.createElement(Z7,{x:r,y:i,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p}):null);Mc.displayName="BaseEdge";function Uo(e,t,r){return r===void 0?r:i=>{const l=t().edges.find(c=>c.id===e);l&&r(i,{...l})}}function wE({sourceX:e,sourceY:t,targetX:r,targetY:i}){const l=Math.abs(r-e)/2,c=r<e?r+l:r-l,f=Math.abs(i-t)/2,m=i<t?i+f:i-f;return[c,m,l,f]}function NE({sourceX:e,sourceY:t,targetX:r,targetY:i,sourceControlX:l,sourceControlY:c,targetControlX:f,targetControlY:m}){const h=e*.125+l*.375+f*.375+r*.125,p=t*.125+c*.375+m*.375+i*.125,y=Math.abs(h-e),g=Math.abs(p-t);return[h,p,y,g]}var Ri;(function(e){e.Strict="strict",e.Loose="loose"})(Ri||(Ri={}));var Ci;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(Ci||(Ci={}));var xc;(function(e){e.Partial="partial",e.Full="full"})(xc||(xc={}));var qr;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(qr||(qr={}));var Pd;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Pd||(Pd={}));var Bt;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(Bt||(Bt={}));function ow({pos:e,x1:t,y1:r,x2:i,y2:l}){return e===Bt.Left||e===Bt.Right?[.5*(t+i),r]:[t,.5*(r+l)]}function EE({sourceX:e,sourceY:t,sourcePosition:r=Bt.Bottom,targetX:i,targetY:l,targetPosition:c=Bt.Top}){const[f,m]=ow({pos:r,x1:e,y1:t,x2:i,y2:l}),[h,p]=ow({pos:c,x1:i,y1:l,x2:e,y2:t}),[y,g,v,S]=NE({sourceX:e,sourceY:t,targetX:i,targetY:l,sourceControlX:f,sourceControlY:m,targetControlX:h,targetControlY:p});return[`M${e},${t} C${f},${m} ${h},${p} ${i},${l}`,y,g,v,S]}const yg=u.memo(({sourceX:e,sourceY:t,targetX:r,targetY:i,sourcePosition:l=Bt.Bottom,targetPosition:c=Bt.Top,label:f,labelStyle:m,labelShowBg:h,labelBgStyle:p,labelBgPadding:y,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:w,interactionWidth:N})=>{const[j,_,C]=EE({sourceX:e,sourceY:t,sourcePosition:l,targetX:r,targetY:i,targetPosition:c});return De.createElement(Mc,{path:j,labelX:_,labelY:C,label:f,labelStyle:m,labelShowBg:h,labelBgStyle:p,labelBgPadding:y,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:w,interactionWidth:N})});yg.displayName="SimpleBezierEdge";const cw={[Bt.Left]:{x:-1,y:0},[Bt.Right]:{x:1,y:0},[Bt.Top]:{x:0,y:-1},[Bt.Bottom]:{x:0,y:1}},n6=({source:e,sourcePosition:t=Bt.Bottom,target:r})=>t===Bt.Left||t===Bt.Right?e.x<r.x?{x:1,y:0}:{x:-1,y:0}:e.y<r.y?{x:0,y:1}:{x:0,y:-1},uw=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function a6({source:e,sourcePosition:t=Bt.Bottom,target:r,targetPosition:i=Bt.Top,center:l,offset:c}){const f=cw[t],m=cw[i],h={x:e.x+f.x*c,y:e.y+f.y*c},p={x:r.x+m.x*c,y:r.y+m.y*c},y=n6({source:h,sourcePosition:t,target:p}),g=y.x!==0?"x":"y",v=y[g];let S=[],w,N;const j={x:0,y:0},_={x:0,y:0},[C,O,E,T]=wE({sourceX:e.x,sourceY:e.y,targetX:r.x,targetY:r.y});if(f[g]*m[g]===-1){w=l.x??C,N=l.y??O;const A=[{x:w,y:h.y},{x:w,y:p.y}],z=[{x:h.x,y:N},{x:p.x,y:N}];f[g]===v?S=g==="x"?A:z:S=g==="x"?z:A}else{const A=[{x:h.x,y:p.y}],z=[{x:p.x,y:h.y}];if(g==="x"?S=f.x===v?z:A:S=f.y===v?A:z,t===i){const V=Math.abs(e[g]-r[g]);if(V<=c){const I=Math.min(c-1,c-V);f[g]===v?j[g]=(h[g]>e[g]?-1:1)*I:_[g]=(p[g]>r[g]?-1:1)*I}}if(t!==i){const V=g==="x"?"y":"x",I=f[g]===m[V],F=h[V]>p[V],D=h[V]<p[V];(f[g]===1&&(!I&&F||I&&D)||f[g]!==1&&(!I&&D||I&&F))&&(S=g==="x"?A:z)}const P={x:h.x+j.x,y:h.y+j.y},X={x:p.x+_.x,y:p.y+_.y},H=Math.max(Math.abs(P.x-S[0].x),Math.abs(X.x-S[0].x)),Y=Math.max(Math.abs(P.y-S[0].y),Math.abs(X.y-S[0].y));H>=Y?(w=(P.x+X.x)/2,N=S[0].y):(w=S[0].x,N=(P.y+X.y)/2)}return[[e,{x:h.x+j.x,y:h.y+j.y},...S,{x:p.x+_.x,y:p.y+_.y},r],w,N,E,T]}function s6(e,t,r,i){const l=Math.min(uw(e,t)/2,uw(t,r)/2,i),{x:c,y:f}=t;if(e.x===c&&c===r.x||e.y===f&&f===r.y)return`L${c} ${f}`;if(e.y===f){const p=e.x<r.x?-1:1,y=e.y<r.y?1:-1;return`L ${c+l*p},${f}Q ${c},${f} ${c},${f+l*y}`}const m=e.x<r.x?1:-1,h=e.y<r.y?-1:1;return`L ${c},${f+l*h}Q ${c},${f} ${c+l*m},${f}`}function my({sourceX:e,sourceY:t,sourcePosition:r=Bt.Bottom,targetX:i,targetY:l,targetPosition:c=Bt.Top,borderRadius:f=5,centerX:m,centerY:h,offset:p=20}){const[y,g,v,S,w]=a6({source:{x:e,y:t},sourcePosition:r,target:{x:i,y:l},targetPosition:c,center:{x:m,y:h},offset:p});return[y.reduce((j,_,C)=>{let O="";return C>0&&C<y.length-1?O=s6(y[C-1],_,y[C+1],f):O=`${C===0?"M":"L"}${_.x} ${_.y}`,j+=O,j},""),g,v,S,w]}const jf=u.memo(({sourceX:e,sourceY:t,targetX:r,targetY:i,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,sourcePosition:g=Bt.Bottom,targetPosition:v=Bt.Top,markerEnd:S,markerStart:w,pathOptions:N,interactionWidth:j})=>{const[_,C,O]=my({sourceX:e,sourceY:t,sourcePosition:g,targetX:r,targetY:i,targetPosition:v,borderRadius:N?.borderRadius,offset:N?.offset});return De.createElement(Mc,{path:_,labelX:C,labelY:O,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:S,markerStart:w,interactionWidth:j})});jf.displayName="SmoothStepEdge";const gg=u.memo(e=>De.createElement(jf,{...e,pathOptions:u.useMemo(()=>({borderRadius:0,offset:e.pathOptions?.offset}),[e.pathOptions?.offset])}));gg.displayName="StepEdge";function r6({sourceX:e,sourceY:t,targetX:r,targetY:i}){const[l,c,f,m]=wE({sourceX:e,sourceY:t,targetX:r,targetY:i});return[`M ${e},${t}L ${r},${i}`,l,c,f,m]}const bg=u.memo(({sourceX:e,sourceY:t,targetX:r,targetY:i,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:g,markerStart:v,interactionWidth:S})=>{const[w,N,j]=r6({sourceX:e,sourceY:t,targetX:r,targetY:i});return De.createElement(Mc,{path:w,labelX:N,labelY:j,label:l,labelStyle:c,labelShowBg:f,labelBgStyle:m,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:g,markerStart:v,interactionWidth:S})});bg.displayName="StraightEdge";function sd(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function dw({pos:e,x1:t,y1:r,x2:i,y2:l,c}){switch(e){case Bt.Left:return[t-sd(t-i,c),r];case Bt.Right:return[t+sd(i-t,c),r];case Bt.Top:return[t,r-sd(r-l,c)];case Bt.Bottom:return[t,r+sd(l-r,c)]}}function jE({sourceX:e,sourceY:t,sourcePosition:r=Bt.Bottom,targetX:i,targetY:l,targetPosition:c=Bt.Top,curvature:f=.25}){const[m,h]=dw({pos:r,x1:e,y1:t,x2:i,y2:l,c:f}),[p,y]=dw({pos:c,x1:i,y1:l,x2:e,y2:t,c:f}),[g,v,S,w]=NE({sourceX:e,sourceY:t,targetX:i,targetY:l,sourceControlX:m,sourceControlY:h,targetControlX:p,targetControlY:y});return[`M${e},${t} C${m},${h} ${p},${y} ${i},${l}`,g,v,S,w]}const Vd=u.memo(({sourceX:e,sourceY:t,targetX:r,targetY:i,sourcePosition:l=Bt.Bottom,targetPosition:c=Bt.Top,label:f,labelStyle:m,labelShowBg:h,labelBgStyle:p,labelBgPadding:y,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:w,pathOptions:N,interactionWidth:j})=>{const[_,C,O]=jE({sourceX:e,sourceY:t,sourcePosition:l,targetX:r,targetY:i,targetPosition:c,curvature:N?.curvature});return De.createElement(Mc,{path:_,labelX:C,labelY:O,label:f,labelStyle:m,labelShowBg:h,labelBgStyle:p,labelBgPadding:y,labelBgBorderRadius:g,style:v,markerEnd:S,markerStart:w,interactionWidth:j})});Vd.displayName="BezierEdge";const vg=u.createContext(null),i6=vg.Provider;vg.Consumer;const l6=()=>u.useContext(vg),o6=e=>"id"in e&&"source"in e&&"target"in e,c6=({source:e,sourceHandle:t,target:r,targetHandle:i})=>`reactflow__edge-${e}${t||""}-${r}${i||""}`,hy=(e,t)=>typeof e>"u"?"":typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(i=>`${i}=${e[i]}`).join("&")}`,u6=(e,t)=>t.some(r=>r.source===e.source&&r.target===e.target&&(r.sourceHandle===e.sourceHandle||!r.sourceHandle&&!e.sourceHandle)&&(r.targetHandle===e.targetHandle||!r.targetHandle&&!e.targetHandle)),d6=(e,t)=>{if(!e.source||!e.target)return t;let r;return o6(e)?r={...e}:r={...e,id:c6(e)},u6(r,t)?t:t.concat(r)},py=({x:e,y:t},[r,i,l],c,[f,m])=>{const h={x:(e-r)/l,y:(t-i)/l};return c?{x:f*Math.round(h.x/f),y:m*Math.round(h.y/m)}:h},_E=({x:e,y:t},[r,i,l])=>({x:e*l+r,y:t*l+i}),Ti=(e,t=[0,0])=>{if(!e)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const r=(e.width??0)*t[0],i=(e.height??0)*t[1],l={x:e.position.x-r,y:e.position.y-i};return{...l,positionAbsolute:e.positionAbsolute?{x:e.positionAbsolute.x-r,y:e.positionAbsolute.y-i}:l}},_f=(e,t=[0,0])=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const r=e.reduce((i,l)=>{const{x:c,y:f}=Ti(l,t).positionAbsolute;return bE(i,vc({x:c,y:f,width:l.width||0,height:l.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return vE(r)},CE=(e,t,[r,i,l]=[0,0,1],c=!1,f=!1,m=[0,0])=>{const h={x:(t.x-r)/l,y:(t.y-i)/l,width:t.width/l,height:t.height/l},p=[];return e.forEach(y=>{const{width:g,height:v,selectable:S=!0,hidden:w=!1}=y;if(f&&!S||w)return!1;const{positionAbsolute:N}=Ti(y,m),j={x:N.x,y:N.y,width:g||0,height:v||0},_=dy(h,j),C=typeof g>"u"||typeof v>"u"||g===null||v===null,O=c&&_>0,E=(g||0)*(v||0);(C||O||_>=E||y.dragging)&&p.push(y)}),p},AE=(e,t)=>{const r=e.map(i=>i.id);return t.filter(i=>r.includes(i.source)||r.includes(i.target))},TE=(e,t,r,i,l,c=.1)=>{const f=t/(e.width*(1+c)),m=r/(e.height*(1+c)),h=Math.min(f,m),p=Ll(h,i,l),y=e.x+e.width/2,g=e.y+e.height/2,v=t/2-y*p,S=r/2-g*p;return{x:v,y:S,zoom:p}},xi=(e,t=0)=>e.transition().duration(t);function fw(e,t,r,i){return(t[r]||[]).reduce((l,c)=>(`${e.id}-${c.id}-${r}`!==i&&l.push({id:c.id||null,type:r,nodeId:e.id,x:(e.positionAbsolute?.x??0)+c.x+c.width/2,y:(e.positionAbsolute?.y??0)+c.y+c.height/2}),l),[])}function f6(e,t,r,i,l,c){const{x:f,y:m}=Pr(e),p=t.elementsFromPoint(f,m).find(w=>w.classList.contains("react-flow__handle"));if(p){const w=p.getAttribute("data-nodeid");if(w){const N=xg(void 0,p),j=p.getAttribute("data-handleid"),_=c({nodeId:w,id:j,type:N});if(_){const C=l.find(O=>O.nodeId===w&&O.type===N&&O.id===j);return{handle:{id:j,type:N,nodeId:w,x:C?.x||r.x,y:C?.y||r.y},validHandleResult:_}}}}let y=[],g=1/0;if(l.forEach(w=>{const N=Math.sqrt((w.x-r.x)**2+(w.y-r.y)**2);if(N<=i){const j=c(w);N<=g&&(N<g?y=[{handle:w,validHandleResult:j}]:N===g&&y.push({handle:w,validHandleResult:j}),g=N)}}),!y.length)return{handle:null,validHandleResult:ME()};if(y.length===1)return y[0];const v=y.some(({validHandleResult:w})=>w.isValid),S=y.some(({handle:w})=>w.type==="target");return y.find(({handle:w,validHandleResult:N})=>S?w.type==="target":v?N.isValid:!0)||y[0]}const m6={source:null,target:null,sourceHandle:null,targetHandle:null},ME=()=>({handleDomNode:null,isValid:!1,connection:m6,endHandle:null});function RE(e,t,r,i,l,c,f){const m=l==="target",h=f.querySelector(`.react-flow__handle[data-id="${e?.nodeId}-${e?.id}-${e?.type}"]`),p={...ME(),handleDomNode:h};if(h){const y=xg(void 0,h),g=h.getAttribute("data-nodeid"),v=h.getAttribute("data-handleid"),S=h.classList.contains("connectable"),w=h.classList.contains("connectableend"),N={source:m?g:r,sourceHandle:m?v:i,target:m?r:g,targetHandle:m?i:v};p.connection=N,S&&w&&(t===Ri.Strict?m&&y==="source"||!m&&y==="target":g!==r||v!==i)&&(p.endHandle={nodeId:g,handleId:v,type:y},p.isValid=c(N))}return p}function h6({nodes:e,nodeId:t,handleId:r,handleType:i}){return e.reduce((l,c)=>{if(c[Vn]){const{handleBounds:f}=c[Vn];let m=[],h=[];f&&(m=fw(c,f,"source",`${t}-${r}-${i}`),h=fw(c,f,"target",`${t}-${r}-${i}`)),l.push(...m,...h)}return l},[])}function xg(e,t){return e||(t?.classList.contains("target")?"target":t?.classList.contains("source")?"source":null)}function Np(e){e?.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function p6(e,t){let r=null;return t?r="valid":e&&!t&&(r="invalid"),r}function kE({event:e,handleId:t,nodeId:r,onConnect:i,isTarget:l,getState:c,setState:f,isValidConnection:m,edgeUpdaterType:h,onReconnectEnd:p}){const y=gE(e.target),{connectionMode:g,domNode:v,autoPanOnConnect:S,connectionRadius:w,onConnectStart:N,panBy:j,getNodes:_,cancelConnection:C}=c();let O=0,E;const{x:T,y:M}=Pr(e),A=y?.elementFromPoint(T,M),z=xg(h,A),P=v?.getBoundingClientRect();if(!P||!z)return;let X,H=Pr(e,P),Y=!1,V=null,I=!1,F=null;const D=h6({nodes:_(),nodeId:r,handleId:t,handleType:z}),L=()=>{if(!S)return;const[U,R]=yE(H,P);j({x:U,y:R}),O=requestAnimationFrame(L)};f({connectionPosition:H,connectionStatus:null,connectionNodeId:r,connectionHandleId:t,connectionHandleType:z,connectionStartHandle:{nodeId:r,handleId:t,type:z},connectionEndHandle:null}),N?.(e,{nodeId:r,handleId:t,handleType:z});function B(U){const{transform:R}=c();H=Pr(U,P);const{handle:q,validHandleResult:G}=f6(U,y,py(H,R,!1,[1,1]),w,D,J=>RE(J,g,r,t,l?"target":"source",m,y));if(E=q,Y||(L(),Y=!0),F=G.handleDomNode,V=G.connection,I=G.isValid,f({connectionPosition:E&&I?_E({x:E.x,y:E.y},R):H,connectionStatus:p6(!!E,I),connectionEndHandle:G.endHandle}),!E&&!I&&!F)return Np(X);V.source!==V.target&&F&&(Np(X),X=F,F.classList.add("connecting","react-flow__handle-connecting"),F.classList.toggle("valid",I),F.classList.toggle("react-flow__handle-valid",I))}function k(U){(E||F)&&V&&I&&i?.(V),c().onConnectEnd?.(U),h&&p?.(U),Np(X),C(),cancelAnimationFrame(O),Y=!1,I=!1,V=null,F=null,y.removeEventListener("mousemove",B),y.removeEventListener("mouseup",k),y.removeEventListener("touchmove",B),y.removeEventListener("touchend",k)}y.addEventListener("mousemove",B),y.addEventListener("mouseup",k),y.addEventListener("touchmove",B),y.addEventListener("touchend",k)}const mw=()=>!0,y6=e=>({connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName}),g6=(e,t,r)=>i=>{const{connectionStartHandle:l,connectionEndHandle:c,connectionClickStartHandle:f}=i;return{connecting:l?.nodeId===e&&l?.handleId===t&&l?.type===r||c?.nodeId===e&&c?.handleId===t&&c?.type===r,clickConnecting:f?.nodeId===e&&f?.handleId===t&&f?.type===r}},DE=u.forwardRef(({type:e="source",position:t=Bt.Top,isValidConnection:r,isConnectable:i=!0,isConnectableStart:l=!0,isConnectableEnd:c=!0,id:f,onConnect:m,children:h,className:p,onMouseDown:y,onTouchStart:g,...v},S)=>{const w=f||null,N=e==="target",j=na(),_=l6(),{connectOnClick:C,noPanClassName:O}=In(y6,sa),{connecting:E,clickConnecting:T}=In(g6(_,w,e),sa);_||j.getState().onError?.("010",lr.error010());const M=P=>{const{defaultEdgeOptions:X,onConnect:H,hasDefaultEdges:Y}=j.getState(),V={...X,...P};if(Y){const{edges:I,setEdges:F}=j.getState();F(d6(V,I))}H?.(V),m?.(V)},A=P=>{if(!_)return;const X=SE(P);l&&(X&&P.button===0||!X)&&kE({event:P,handleId:w,nodeId:_,onConnect:M,isTarget:N,getState:j.getState,setState:j.setState,isValidConnection:r||j.getState().isValidConnection||mw}),X?y?.(P):g?.(P)},z=P=>{const{onClickConnectStart:X,onClickConnectEnd:H,connectionClickStartHandle:Y,connectionMode:V,isValidConnection:I}=j.getState();if(!_||!Y&&!l)return;if(!Y){X?.(P,{nodeId:_,handleId:w,handleType:e}),j.setState({connectionClickStartHandle:{nodeId:_,type:e,handleId:w}});return}const F=gE(P.target),D=r||I||mw,{connection:L,isValid:B}=RE({nodeId:_,id:w,type:e},V,Y.nodeId,Y.handleId||null,Y.type,D,F);B&&M(L),H?.(P),j.setState({connectionClickStartHandle:null})};return De.createElement("div",{"data-handleid":w,"data-nodeid":_,"data-handlepos":t,"data-id":`${_}-${w}-${e}`,className:ma(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",O,p,{source:!N,target:N,connectable:i,connectablestart:l,connectableend:c,connecting:T,connectionindicator:i&&(l&&!E||c&&E)}]),onMouseDown:A,onTouchStart:A,onClick:C?z:void 0,ref:S,...v},h)});DE.displayName="Handle";var Xr=u.memo(DE);const IE=({data:e,isConnectable:t,targetPosition:r=Bt.Top,sourcePosition:i=Bt.Bottom})=>De.createElement(De.Fragment,null,De.createElement(Xr,{type:"target",position:r,isConnectable:t}),e?.label,De.createElement(Xr,{type:"source",position:i,isConnectable:t}));IE.displayName="DefaultNode";var yy=u.memo(IE);const LE=({data:e,isConnectable:t,sourcePosition:r=Bt.Bottom})=>De.createElement(De.Fragment,null,e?.label,De.createElement(Xr,{type:"source",position:r,isConnectable:t}));LE.displayName="InputNode";var OE=u.memo(LE);const zE=({data:e,isConnectable:t,targetPosition:r=Bt.Top})=>De.createElement(De.Fragment,null,De.createElement(Xr,{type:"target",position:r,isConnectable:t}),e?.label);zE.displayName="OutputNode";var $E=u.memo(zE);const Sg=()=>null;Sg.displayName="GroupNode";const b6=e=>({selectedNodes:e.getNodes().filter(t=>t.selected),selectedEdges:e.edges.filter(t=>t.selected).map(t=>({...t}))}),rd=e=>e.id;function v6(e,t){return sa(e.selectedNodes.map(rd),t.selectedNodes.map(rd))&&sa(e.selectedEdges.map(rd),t.selectedEdges.map(rd))}const FE=u.memo(({onSelectionChange:e})=>{const t=na(),{selectedNodes:r,selectedEdges:i}=In(b6,v6);return u.useEffect(()=>{const l={nodes:r,edges:i};e?.(l),t.getState().onSelectionChange.forEach(c=>c(l))},[r,i,e]),null});FE.displayName="SelectionListener";const x6=e=>!!e.onSelectionChange;function S6({onSelectionChange:e}){const t=In(x6);return e||t?De.createElement(FE,{onSelectionChange:e}):null}const w6=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset});function bl(e,t){u.useEffect(()=>{typeof e<"u"&&t(e)},[e])}function cn(e,t,r){u.useEffect(()=>{typeof t<"u"&&r({[e]:t})},[t])}const N6=({nodes:e,edges:t,defaultNodes:r,defaultEdges:i,onConnect:l,onConnectStart:c,onConnectEnd:f,onClickConnectStart:m,onClickConnectEnd:h,nodesDraggable:p,nodesConnectable:y,nodesFocusable:g,edgesFocusable:v,edgesUpdatable:S,elevateNodesOnSelect:w,minZoom:N,maxZoom:j,nodeExtent:_,onNodesChange:C,onEdgesChange:O,elementsSelectable:E,connectionMode:T,snapGrid:M,snapToGrid:A,translateExtent:z,connectOnClick:P,defaultEdgeOptions:X,fitView:H,fitViewOptions:Y,onNodesDelete:V,onEdgesDelete:I,onNodeDrag:F,onNodeDragStart:D,onNodeDragStop:L,onSelectionDrag:B,onSelectionDragStart:k,onSelectionDragStop:U,noPanClassName:R,nodeOrigin:q,rfId:G,autoPanOnConnect:J,autoPanOnNodeDrag:ie,onError:Z,connectionRadius:me,isValidConnection:Q,nodeDragThreshold:ue})=>{const{setNodes:ne,setEdges:we,setDefaultNodesAndEdges:Pe,setMinZoom:Re,setMaxZoom:Ce,setTranslateExtent:it,setNodeExtent:qe,reset:We}=In(w6,sa),ke=na();return u.useEffect(()=>{const xt=i?.map(Mt=>({...Mt,...X}));return Pe(r,xt),()=>{We()}},[]),cn("defaultEdgeOptions",X,ke.setState),cn("connectionMode",T,ke.setState),cn("onConnect",l,ke.setState),cn("onConnectStart",c,ke.setState),cn("onConnectEnd",f,ke.setState),cn("onClickConnectStart",m,ke.setState),cn("onClickConnectEnd",h,ke.setState),cn("nodesDraggable",p,ke.setState),cn("nodesConnectable",y,ke.setState),cn("nodesFocusable",g,ke.setState),cn("edgesFocusable",v,ke.setState),cn("edgesUpdatable",S,ke.setState),cn("elementsSelectable",E,ke.setState),cn("elevateNodesOnSelect",w,ke.setState),cn("snapToGrid",A,ke.setState),cn("snapGrid",M,ke.setState),cn("onNodesChange",C,ke.setState),cn("onEdgesChange",O,ke.setState),cn("connectOnClick",P,ke.setState),cn("fitViewOnInit",H,ke.setState),cn("fitViewOnInitOptions",Y,ke.setState),cn("onNodesDelete",V,ke.setState),cn("onEdgesDelete",I,ke.setState),cn("onNodeDrag",F,ke.setState),cn("onNodeDragStart",D,ke.setState),cn("onNodeDragStop",L,ke.setState),cn("onSelectionDrag",B,ke.setState),cn("onSelectionDragStart",k,ke.setState),cn("onSelectionDragStop",U,ke.setState),cn("noPanClassName",R,ke.setState),cn("nodeOrigin",q,ke.setState),cn("rfId",G,ke.setState),cn("autoPanOnConnect",J,ke.setState),cn("autoPanOnNodeDrag",ie,ke.setState),cn("onError",Z,ke.setState),cn("connectionRadius",me,ke.setState),cn("isValidConnection",Q,ke.setState),cn("nodeDragThreshold",ue,ke.setState),bl(e,ne),bl(t,we),bl(N,Re),bl(j,Ce),bl(z,it),bl(_,qe),null},hw={display:"none"},E6={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},BE="react-flow__node-desc",UE="react-flow__edge-desc",j6="react-flow__aria-live",_6=e=>e.ariaLiveMessage;function C6({rfId:e}){const t=In(_6);return De.createElement("div",{id:`${j6}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:E6},t)}function A6({rfId:e,disableKeyboardA11y:t}){return De.createElement(De.Fragment,null,De.createElement("div",{id:`${BE}-${e}`,style:hw},"Press enter or space to select a node.",!t&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),De.createElement("div",{id:`${UE}-${e}`,style:hw},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!t&&De.createElement(C6,{rfId:e}))}var Sc=(e=null,t={actInsideInputWithModifier:!0})=>{const[r,i]=u.useState(!1),l=u.useRef(!1),c=u.useRef(new Set([])),[f,m]=u.useMemo(()=>{if(e!==null){const p=(Array.isArray(e)?e:[e]).filter(g=>typeof g=="string").map(g=>g.split("+")),y=p.reduce((g,v)=>g.concat(...v),[]);return[p,y]}return[[],[]]},[e]);return u.useEffect(()=>{const h=typeof document<"u"?document:null,p=t?.target||h;if(e!==null){const y=S=>{if(l.current=S.ctrlKey||S.metaKey||S.shiftKey,(!l.current||l.current&&!t.actInsideInputWithModifier)&&fy(S))return!1;const N=yw(S.code,m);c.current.add(S[N]),pw(f,c.current,!1)&&(S.preventDefault(),i(!0))},g=S=>{if((!l.current||l.current&&!t.actInsideInputWithModifier)&&fy(S))return!1;const N=yw(S.code,m);pw(f,c.current,!0)?(i(!1),c.current.clear()):c.current.delete(S[N]),S.key==="Meta"&&c.current.clear(),l.current=!1},v=()=>{c.current.clear(),i(!1)};return p?.addEventListener("keydown",y),p?.addEventListener("keyup",g),window.addEventListener("blur",v),()=>{p?.removeEventListener("keydown",y),p?.removeEventListener("keyup",g),window.removeEventListener("blur",v)}}},[e,i]),r};function pw(e,t,r){return e.filter(i=>r||i.length===t.size).some(i=>i.every(l=>t.has(l)))}function yw(e,t){return t.includes(e)?"code":"key"}function qE(e,t,r,i){const l=e.parentNode||e.parentId;if(!l)return r;const c=t.get(l),f=Ti(c,i);return qE(c,t,{x:(r.x??0)+f.x,y:(r.y??0)+f.y,z:(c[Vn]?.z??0)>(r.z??0)?c[Vn]?.z??0:r.z??0},i)}function HE(e,t,r){e.forEach(i=>{const l=i.parentNode||i.parentId;if(l&&!e.has(l))throw new Error(`Parent node ${l} not found`);if(l||r?.[i.id]){const{x:c,y:f,z:m}=qE(i,e,{...i.position,z:i[Vn]?.z??0},t);i.positionAbsolute={x:c,y:f},i[Vn].z=m,r?.[i.id]&&(i[Vn].isParent=!0)}})}function Ep(e,t,r,i){const l=new Map,c={},f=i?1e3:0;return e.forEach(m=>{const h=(rs(m.zIndex)?m.zIndex:0)+(m.selected?f:0),p=t.get(m.id),y={...m,positionAbsolute:{x:m.position.x,y:m.position.y}},g=m.parentNode||m.parentId;g&&(c[g]=!0);const v=p?.type&&p?.type!==m.type;Object.defineProperty(y,Vn,{enumerable:!1,value:{handleBounds:v?void 0:p?.[Vn]?.handleBounds,z:h}}),l.set(m.id,y)}),HE(l,r,c),l}function PE(e,t={}){const{getNodes:r,width:i,height:l,minZoom:c,maxZoom:f,d3Zoom:m,d3Selection:h,fitViewOnInitDone:p,fitViewOnInit:y,nodeOrigin:g}=e(),v=t.initial&&!p&&y;if(m&&h&&(v||!t.initial)){const w=r().filter(j=>{const _=t.includeHiddenNodes?j.width&&j.height:!j.hidden;return t.nodes?.length?_&&t.nodes.some(C=>C.id===j.id):_}),N=w.every(j=>j.width&&j.height);if(w.length>0&&N){const j=_f(w,g),{x:_,y:C,zoom:O}=TE(j,i,l,t.minZoom??c,t.maxZoom??f,t.padding??.1),E=sr.translate(_,C).scale(O);return typeof t.duration=="number"&&t.duration>0?m.transform(xi(h,t.duration),E):m.transform(h,E),!0}}return!1}function T6(e,t){return e.forEach(r=>{const i=t.get(r.id);i&&t.set(i.id,{...i,[Vn]:i[Vn],selected:r.selected})}),new Map(t)}function M6(e,t){return t.map(r=>{const i=e.find(l=>l.id===r.id);return i&&(r.selected=i.selected),r})}function id({changedNodes:e,changedEdges:t,get:r,set:i}){const{nodeInternals:l,edges:c,onNodesChange:f,onEdgesChange:m,hasDefaultNodes:h,hasDefaultEdges:p}=r();e?.length&&(h&&i({nodeInternals:T6(e,l)}),f?.(e)),t?.length&&(p&&i({edges:M6(t,c)}),m?.(t))}const vl=()=>{},R6={zoomIn:vl,zoomOut:vl,zoomTo:vl,getZoom:()=>1,setViewport:vl,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:vl,fitBounds:vl,project:e=>e,screenToFlowPosition:e=>e,flowToScreenPosition:e=>e,viewportInitialized:!1},k6=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection}),D6=()=>{const e=na(),{d3Zoom:t,d3Selection:r}=In(k6,sa);return u.useMemo(()=>r&&t?{zoomIn:l=>t.scaleBy(xi(r,l?.duration),1.2),zoomOut:l=>t.scaleBy(xi(r,l?.duration),1/1.2),zoomTo:(l,c)=>t.scaleTo(xi(r,c?.duration),l),getZoom:()=>e.getState().transform[2],setViewport:(l,c)=>{const[f,m,h]=e.getState().transform,p=sr.translate(l.x??f,l.y??m).scale(l.zoom??h);t.transform(xi(r,c?.duration),p)},getViewport:()=>{const[l,c,f]=e.getState().transform;return{x:l,y:c,zoom:f}},fitView:l=>PE(e.getState,l),setCenter:(l,c,f)=>{const{width:m,height:h,maxZoom:p}=e.getState(),y=typeof f?.zoom<"u"?f.zoom:p,g=m/2-l*y,v=h/2-c*y,S=sr.translate(g,v).scale(y);t.transform(xi(r,f?.duration),S)},fitBounds:(l,c)=>{const{width:f,height:m,minZoom:h,maxZoom:p}=e.getState(),{x:y,y:g,zoom:v}=TE(l,f,m,h,p,c?.padding??.1),S=sr.translate(y,g).scale(v);t.transform(xi(r,c?.duration),S)},project:l=>{const{transform:c,snapToGrid:f,snapGrid:m}=e.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),py(l,c,f,m)},screenToFlowPosition:l=>{const{transform:c,snapToGrid:f,snapGrid:m,domNode:h}=e.getState();if(!h)return l;const{x:p,y}=h.getBoundingClientRect(),g={x:l.x-p,y:l.y-y};return py(g,c,f,m)},flowToScreenPosition:l=>{const{transform:c,domNode:f}=e.getState();if(!f)return l;const{x:m,y:h}=f.getBoundingClientRect(),p=_E(l,c);return{x:p.x+m,y:p.y+h}},viewportInitialized:!0}:R6,[t,r])};function wg(){const e=D6(),t=na(),r=u.useCallback(()=>t.getState().getNodes().map(N=>({...N})),[]),i=u.useCallback(N=>t.getState().nodeInternals.get(N),[]),l=u.useCallback(()=>{const{edges:N=[]}=t.getState();return N.map(j=>({...j}))},[]),c=u.useCallback(N=>{const{edges:j=[]}=t.getState();return j.find(_=>_.id===N)},[]),f=u.useCallback(N=>{const{getNodes:j,setNodes:_,hasDefaultNodes:C,onNodesChange:O}=t.getState(),E=j(),T=typeof N=="function"?N(E):N;if(C)_(T);else if(O){const M=T.length===0?E.map(A=>({type:"remove",id:A.id})):T.map(A=>({item:A,type:"reset"}));O(M)}},[]),m=u.useCallback(N=>{const{edges:j=[],setEdges:_,hasDefaultEdges:C,onEdgesChange:O}=t.getState(),E=typeof N=="function"?N(j):N;if(C)_(E);else if(O){const T=E.length===0?j.map(M=>({type:"remove",id:M.id})):E.map(M=>({item:M,type:"reset"}));O(T)}},[]),h=u.useCallback(N=>{const j=Array.isArray(N)?N:[N],{getNodes:_,setNodes:C,hasDefaultNodes:O,onNodesChange:E}=t.getState();if(O){const M=[..._(),...j];C(M)}else if(E){const T=j.map(M=>({item:M,type:"add"}));E(T)}},[]),p=u.useCallback(N=>{const j=Array.isArray(N)?N:[N],{edges:_=[],setEdges:C,hasDefaultEdges:O,onEdgesChange:E}=t.getState();if(O)C([..._,...j]);else if(E){const T=j.map(M=>({item:M,type:"add"}));E(T)}},[]),y=u.useCallback(()=>{const{getNodes:N,edges:j=[],transform:_}=t.getState(),[C,O,E]=_;return{nodes:N().map(T=>({...T})),edges:j.map(T=>({...T})),viewport:{x:C,y:O,zoom:E}}},[]),g=u.useCallback(({nodes:N,edges:j})=>{const{nodeInternals:_,getNodes:C,edges:O,hasDefaultNodes:E,hasDefaultEdges:T,onNodesDelete:M,onEdgesDelete:A,onNodesChange:z,onEdgesChange:P}=t.getState(),X=(N||[]).map(F=>F.id),H=(j||[]).map(F=>F.id),Y=C().reduce((F,D)=>{const L=D.parentNode||D.parentId,B=!X.includes(D.id)&&L&&F.find(U=>U.id===L);return(typeof D.deletable=="boolean"?D.deletable:!0)&&(X.includes(D.id)||B)&&F.push(D),F},[]),V=O.filter(F=>typeof F.deletable=="boolean"?F.deletable:!0),I=V.filter(F=>H.includes(F.id));if(Y||I){const F=AE(Y,V),D=[...I,...F],L=D.reduce((B,k)=>(B.includes(k.id)||B.push(k.id),B),[]);if((T||E)&&(T&&t.setState({edges:O.filter(B=>!L.includes(B.id))}),E&&(Y.forEach(B=>{_.delete(B.id)}),t.setState({nodeInternals:new Map(_)}))),L.length>0&&(A?.(D),P&&P(L.map(B=>({id:B,type:"remove"})))),Y.length>0&&(M?.(Y),z)){const B=Y.map(k=>({id:k.id,type:"remove"}));z(B)}}},[]),v=u.useCallback(N=>{const j=J7(N),_=j?null:t.getState().nodeInternals.get(N.id);return!j&&!_?[null,null,j]:[j?N:lw(_),_,j]},[]),S=u.useCallback((N,j=!0,_)=>{const[C,O,E]=v(N);return C?(_||t.getState().getNodes()).filter(T=>{if(!E&&(T.id===O.id||!T.positionAbsolute))return!1;const M=lw(T),A=dy(M,C);return j&&A>0||A>=C.width*C.height}):[]},[]),w=u.useCallback((N,j,_=!0)=>{const[C]=v(N);if(!C)return!1;const O=dy(C,j);return _&&O>0||O>=C.width*C.height},[]);return u.useMemo(()=>({...e,getNodes:r,getNode:i,getEdges:l,getEdge:c,setNodes:f,setEdges:m,addNodes:h,addEdges:p,toObject:y,deleteElements:g,getIntersectingNodes:S,isNodeIntersecting:w}),[e,r,i,l,c,f,m,h,p,y,g,S,w])}const I6={actInsideInputWithModifier:!1};var L6=({deleteKeyCode:e,multiSelectionKeyCode:t})=>{const r=na(),{deleteElements:i}=wg(),l=Sc(e,I6),c=Sc(t);u.useEffect(()=>{if(l){const{edges:f,getNodes:m}=r.getState(),h=m().filter(y=>y.selected),p=f.filter(y=>y.selected);i({nodes:h,edges:p}),r.setState({nodesSelectionActive:!1})}},[l]),u.useEffect(()=>{r.setState({multiSelectionActive:c})},[c])};function O6(e){const t=na();u.useEffect(()=>{let r;const i=()=>{if(!e.current)return;const l=hg(e.current);(l.height===0||l.width===0)&&t.getState().onError?.("004",lr.error004()),t.setState({width:l.width||500,height:l.height||500})};return i(),window.addEventListener("resize",i),e.current&&(r=new ResizeObserver(()=>i()),r.observe(e.current)),()=>{window.removeEventListener("resize",i),r&&e.current&&r.unobserve(e.current)}},[])}const Ng={position:"absolute",width:"100%",height:"100%",top:0,left:0},z6=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,ld=e=>({x:e.x,y:e.y,zoom:e.k}),xl=(e,t)=>e.target.closest(`.${t}`),gw=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),bw=e=>{const t=e.ctrlKey&&Hd()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t},$6=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler,userSelectionActive:e.userSelectionActive}),F6=({onMove:e,onMoveStart:t,onMoveEnd:r,onPaneContextMenu:i,zoomOnScroll:l=!0,zoomOnPinch:c=!0,panOnScroll:f=!1,panOnScrollSpeed:m=.5,panOnScrollMode:h=Ci.Free,zoomOnDoubleClick:p=!0,elementsSelectable:y,panOnDrag:g=!0,defaultViewport:v,translateExtent:S,minZoom:w,maxZoom:N,zoomActivationKeyCode:j,preventScrolling:_=!0,children:C,noWheelClassName:O,noPanClassName:E})=>{const T=u.useRef(),M=na(),A=u.useRef(!1),z=u.useRef(!1),P=u.useRef(null),X=u.useRef({x:0,y:0,zoom:0}),{d3Zoom:H,d3Selection:Y,d3ZoomHandler:V,userSelectionActive:I}=In($6,sa),F=Sc(j),D=u.useRef(0),L=u.useRef(!1),B=u.useRef();return O6(P),u.useEffect(()=>{if(P.current){const k=P.current.getBoundingClientRect(),U=hE().scaleExtent([w,N]).translateExtent(S),R=ss(P.current).call(U),q=sr.translate(v.x,v.y).scale(Ll(v.zoom,w,N)),G=[[0,0],[k.width,k.height]],J=U.constrain()(q,G,S);U.transform(R,J),U.wheelDelta(bw),M.setState({d3Zoom:U,d3Selection:R,d3ZoomHandler:R.on("wheel.zoom"),transform:[J.x,J.y,J.k],domNode:P.current.closest(".react-flow")})}},[]),u.useEffect(()=>{Y&&H&&(f&&!F&&!I?Y.on("wheel.zoom",k=>{if(xl(k,O))return!1;k.preventDefault(),k.stopImmediatePropagation();const U=Y.property("__zoom").k||1;if(k.ctrlKey&&c){const Q=ms(k),ue=bw(k),ne=U*Math.pow(2,ue);H.scaleTo(Y,ne,Q,k);return}const R=k.deltaMode===1?20:1;let q=h===Ci.Vertical?0:k.deltaX*R,G=h===Ci.Horizontal?0:k.deltaY*R;!Hd()&&k.shiftKey&&h!==Ci.Vertical&&(q=k.deltaY*R,G=0),H.translateBy(Y,-(q/U)*m,-(G/U)*m,{internal:!0});const J=ld(Y.property("__zoom")),{onViewportChangeStart:ie,onViewportChange:Z,onViewportChangeEnd:me}=M.getState();clearTimeout(B.current),L.current||(L.current=!0,t?.(k,J),ie?.(J)),L.current&&(e?.(k,J),Z?.(J),B.current=setTimeout(()=>{r?.(k,J),me?.(J),L.current=!1},150))},{passive:!1}):typeof V<"u"&&Y.on("wheel.zoom",function(k,U){if(!_&&k.type==="wheel"&&!k.ctrlKey||xl(k,O))return null;k.preventDefault(),V.call(this,k,U)},{passive:!1}))},[I,f,h,Y,H,V,F,c,_,O,t,e,r]),u.useEffect(()=>{H&&H.on("start",k=>{if(!k.sourceEvent||k.sourceEvent.internal)return null;D.current=k.sourceEvent?.button;const{onViewportChangeStart:U}=M.getState(),R=ld(k.transform);A.current=!0,X.current=R,k.sourceEvent?.type==="mousedown"&&M.setState({paneDragging:!0}),U?.(R),t?.(k.sourceEvent,R)})},[H,t]),u.useEffect(()=>{H&&(I&&!A.current?H.on("zoom",null):I||H.on("zoom",k=>{const{onViewportChange:U}=M.getState();if(M.setState({transform:[k.transform.x,k.transform.y,k.transform.k]}),z.current=!!(i&&gw(g,D.current??0)),(e||U)&&!k.sourceEvent?.internal){const R=ld(k.transform);U?.(R),e?.(k.sourceEvent,R)}}))},[I,H,e,g,i]),u.useEffect(()=>{H&&H.on("end",k=>{if(!k.sourceEvent||k.sourceEvent.internal)return null;const{onViewportChangeEnd:U}=M.getState();if(A.current=!1,M.setState({paneDragging:!1}),i&&gw(g,D.current??0)&&!z.current&&i(k.sourceEvent),z.current=!1,(r||U)&&z6(X.current,k.transform)){const R=ld(k.transform);X.current=R,clearTimeout(T.current),T.current=setTimeout(()=>{U?.(R),r?.(k.sourceEvent,R)},f?150:0)}})},[H,f,g,r,i]),u.useEffect(()=>{H&&H.filter(k=>{const U=F||l,R=c&&k.ctrlKey;if((g===!0||Array.isArray(g)&&g.includes(1))&&k.button===1&&k.type==="mousedown"&&(xl(k,"react-flow__node")||xl(k,"react-flow__edge")))return!0;if(!g&&!U&&!f&&!p&&!c||I||!p&&k.type==="dblclick"||xl(k,O)&&k.type==="wheel"||xl(k,E)&&(k.type!=="wheel"||f&&k.type==="wheel"&&!F)||!c&&k.ctrlKey&&k.type==="wheel"||!U&&!f&&!R&&k.type==="wheel"||!g&&(k.type==="mousedown"||k.type==="touchstart")||Array.isArray(g)&&!g.includes(k.button)&&k.type==="mousedown")return!1;const q=Array.isArray(g)&&g.includes(k.button)||!k.button||k.button<=1;return(!k.ctrlKey||k.type==="wheel")&&q})},[I,H,l,c,f,p,g,y,F]),De.createElement("div",{className:"react-flow__renderer",ref:P,style:Ng},C)},B6=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function U6(){const{userSelectionActive:e,userSelectionRect:t}=In(B6,sa);return e&&t?De.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}function vw(e,t){const r=t.parentNode||t.parentId,i=e.find(l=>l.id===r);if(i){const l=t.position.x+t.width-i.width,c=t.position.y+t.height-i.height;if(l>0||c>0||t.position.x<0||t.position.y<0){if(i.style={...i.style},i.style.width=i.style.width??i.width,i.style.height=i.style.height??i.height,l>0&&(i.style.width+=l),c>0&&(i.style.height+=c),t.position.x<0){const f=Math.abs(t.position.x);i.position.x=i.position.x-f,i.style.width+=f,t.position.x=0}if(t.position.y<0){const f=Math.abs(t.position.y);i.position.y=i.position.y-f,i.style.height+=f,t.position.y=0}i.width=i.style.width,i.height=i.style.height}}}function VE(e,t){if(e.some(i=>i.type==="reset"))return e.filter(i=>i.type==="reset").map(i=>i.item);const r=e.filter(i=>i.type==="add").map(i=>i.item);return t.reduce((i,l)=>{const c=e.filter(m=>m.id===l.id);if(c.length===0)return i.push(l),i;const f={...l};for(const m of c)if(m)switch(m.type){case"select":{f.selected=m.selected;break}case"position":{typeof m.position<"u"&&(f.position=m.position),typeof m.positionAbsolute<"u"&&(f.positionAbsolute=m.positionAbsolute),typeof m.dragging<"u"&&(f.dragging=m.dragging),f.expandParent&&vw(i,f);break}case"dimensions":{typeof m.dimensions<"u"&&(f.width=m.dimensions.width,f.height=m.dimensions.height),typeof m.updateStyle<"u"&&(f.style={...f.style||{},...m.dimensions}),typeof m.resizing=="boolean"&&(f.resizing=m.resizing),f.expandParent&&vw(i,f);break}case"remove":return i}return i.push(f),i},r)}function YE(e,t){return VE(e,t)}function q6(e,t){return VE(e,t)}const $r=(e,t)=>({id:e,type:"select",selected:t});function Nl(e,t){return e.reduce((r,i)=>{const l=t.includes(i.id);return!i.selected&&l?(i.selected=!0,r.push($r(i.id,!0))):i.selected&&!l&&(i.selected=!1,r.push($r(i.id,!1))),r},[])}const jp=(e,t)=>r=>{r.target===t.current&&e?.(r)},H6=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging}),GE=u.memo(({isSelecting:e,selectionMode:t=xc.Full,panOnDrag:r,onSelectionStart:i,onSelectionEnd:l,onPaneClick:c,onPaneContextMenu:f,onPaneScroll:m,onPaneMouseEnter:h,onPaneMouseMove:p,onPaneMouseLeave:y,children:g})=>{const v=u.useRef(null),S=na(),w=u.useRef(0),N=u.useRef(0),j=u.useRef(),{userSelectionActive:_,elementsSelectable:C,dragging:O}=In(H6,sa),E=()=>{S.setState({userSelectionActive:!1,userSelectionRect:null}),w.current=0,N.current=0},T=V=>{c?.(V),S.getState().resetSelectedElements(),S.setState({nodesSelectionActive:!1})},M=V=>{if(Array.isArray(r)&&r?.includes(2)){V.preventDefault();return}f?.(V)},A=m?V=>m(V):void 0,z=V=>{const{resetSelectedElements:I,domNode:F}=S.getState();if(j.current=F?.getBoundingClientRect(),!C||!e||V.button!==0||V.target!==v.current||!j.current)return;const{x:D,y:L}=Pr(V,j.current);I(),S.setState({userSelectionRect:{width:0,height:0,startX:D,startY:L,x:D,y:L}}),i?.(V)},P=V=>{const{userSelectionRect:I,nodeInternals:F,edges:D,transform:L,onNodesChange:B,onEdgesChange:k,nodeOrigin:U,getNodes:R}=S.getState();if(!e||!j.current||!I)return;S.setState({userSelectionActive:!0,nodesSelectionActive:!1});const q=Pr(V,j.current),G=I.startX??0,J=I.startY??0,ie={...I,x:q.x<G?q.x:G,y:q.y<J?q.y:J,width:Math.abs(q.x-G),height:Math.abs(q.y-J)},Z=R(),me=CE(F,ie,L,t===xc.Partial,!0,U),Q=AE(me,D).map(ne=>ne.id),ue=me.map(ne=>ne.id);if(w.current!==ue.length){w.current=ue.length;const ne=Nl(Z,ue);ne.length&&B?.(ne)}if(N.current!==Q.length){N.current=Q.length;const ne=Nl(D,Q);ne.length&&k?.(ne)}S.setState({userSelectionRect:ie})},X=V=>{if(V.button!==0)return;const{userSelectionRect:I}=S.getState();!_&&I&&V.target===v.current&&T?.(V),S.setState({nodesSelectionActive:w.current>0}),E(),l?.(V)},H=V=>{_&&(S.setState({nodesSelectionActive:w.current>0}),l?.(V)),E()},Y=C&&(e||_);return De.createElement("div",{className:ma(["react-flow__pane",{dragging:O,selection:e}]),onClick:Y?void 0:jp(T,v),onContextMenu:jp(M,v),onWheel:jp(A,v),onMouseEnter:Y?void 0:h,onMouseDown:Y?z:void 0,onMouseMove:Y?P:p,onMouseUp:Y?X:void 0,onMouseLeave:Y?H:y,ref:v,style:Ng},g,De.createElement(U6,null))});GE.displayName="Pane";function XE(e,t){const r=e.parentNode||e.parentId;if(!r)return!1;const i=t.get(r);return i?i.selected?!0:XE(i,t):!1}function xw(e,t,r){let i=e;do{if(i?.matches(t))return!0;if(i===r.current)return!1;i=i.parentElement}while(i);return!1}function P6(e,t,r,i){return Array.from(e.values()).filter(l=>(l.selected||l.id===i)&&(!l.parentNode||l.parentId||!XE(l,e))&&(l.draggable||t&&typeof l.draggable>"u")).map(l=>({id:l.id,position:l.position||{x:0,y:0},positionAbsolute:l.positionAbsolute||{x:0,y:0},distance:{x:r.x-(l.positionAbsolute?.x??0),y:r.y-(l.positionAbsolute?.y??0)},delta:{x:0,y:0},extent:l.extent,parentNode:l.parentNode||l.parentId,parentId:l.parentNode||l.parentId,width:l.width,height:l.height,expandParent:l.expandParent}))}function V6(e,t){return!t||t==="parent"?t:[t[0],[t[1][0]-(e.width||0),t[1][1]-(e.height||0)]]}function KE(e,t,r,i,l=[0,0],c){const f=V6(e,e.extent||i);let m=f;const h=e.parentNode||e.parentId;if(e.extent==="parent"&&!e.expandParent)if(h&&e.width&&e.height){const g=r.get(h),{x:v,y:S}=Ti(g,l).positionAbsolute;m=g&&rs(v)&&rs(S)&&rs(g.width)&&rs(g.height)?[[v+e.width*l[0],S+e.height*l[1]],[v+g.width-e.width+e.width*l[0],S+g.height-e.height+e.height*l[1]]]:m}else c?.("005",lr.error005()),m=f;else if(e.extent&&h&&e.extent!=="parent"){const g=r.get(h),{x:v,y:S}=Ti(g,l).positionAbsolute;m=[[e.extent[0][0]+v,e.extent[0][1]+S],[e.extent[1][0]+v,e.extent[1][1]+S]]}let p={x:0,y:0};if(h){const g=r.get(h);p=Ti(g,l).positionAbsolute}const y=m&&m!=="parent"?pg(t,m):t;return{position:{x:y.x-p.x,y:y.y-p.y},positionAbsolute:y}}function _p({nodeId:e,dragItems:t,nodeInternals:r}){const i=t.map(l=>({...r.get(l.id),position:l.position,positionAbsolute:l.positionAbsolute}));return[e?i.find(l=>l.id===e):i[0],i]}const Sw=(e,t,r,i)=>{const l=t.querySelectorAll(e);if(!l||!l.length)return null;const c=Array.from(l),f=t.getBoundingClientRect(),m={x:f.width*i[0],y:f.height*i[1]};return c.map(h=>{const p=h.getBoundingClientRect();return{id:h.getAttribute("data-handleid"),position:h.getAttribute("data-handlepos"),x:(p.left-f.left-m.x)/r,y:(p.top-f.top-m.y)/r,...hg(h)}})};function qo(e,t,r){return r===void 0?r:i=>{const l=t().nodeInternals.get(e);l&&r(i,{...l})}}function gy({id:e,store:t,unselect:r=!1,nodeRef:i}){const{addSelectedNodes:l,unselectNodesAndEdges:c,multiSelectionActive:f,nodeInternals:m,onError:h}=t.getState(),p=m.get(e);if(!p){h?.("012",lr.error012(e));return}t.setState({nodesSelectionActive:!1}),p.selected?(r||p.selected&&f)&&(c({nodes:[p],edges:[]}),requestAnimationFrame(()=>i?.current?.blur())):l([e])}function Y6(){const e=na();return u.useCallback(({sourceEvent:r})=>{const{transform:i,snapGrid:l,snapToGrid:c}=e.getState(),f=r.touches?r.touches[0].clientX:r.clientX,m=r.touches?r.touches[0].clientY:r.clientY,h={x:(f-i[0])/i[2],y:(m-i[1])/i[2]};return{xSnapped:c?l[0]*Math.round(h.x/l[0]):h.x,ySnapped:c?l[1]*Math.round(h.y/l[1]):h.y,...h}},[])}function Cp(e){return(t,r,i)=>e?.(t,i)}function WE({nodeRef:e,disabled:t=!1,noDragClassName:r,handleSelector:i,nodeId:l,isSelectable:c,selectNodesOnDrag:f}){const m=na(),[h,p]=u.useState(!1),y=u.useRef([]),g=u.useRef({x:null,y:null}),v=u.useRef(0),S=u.useRef(null),w=u.useRef({x:0,y:0}),N=u.useRef(null),j=u.useRef(!1),_=u.useRef(!1),C=u.useRef(!1),O=Y6();return u.useEffect(()=>{if(e?.current){const E=ss(e.current),T=({x:z,y:P})=>{const{nodeInternals:X,onNodeDrag:H,onSelectionDrag:Y,updateNodePositions:V,nodeExtent:I,snapGrid:F,snapToGrid:D,nodeOrigin:L,onError:B}=m.getState();g.current={x:z,y:P};let k=!1,U={x:0,y:0,x2:0,y2:0};if(y.current.length>1&&I){const q=_f(y.current,L);U=vc(q)}if(y.current=y.current.map(q=>{const G={x:z-q.distance.x,y:P-q.distance.y};D&&(G.x=F[0]*Math.round(G.x/F[0]),G.y=F[1]*Math.round(G.y/F[1]));const J=[[I[0][0],I[0][1]],[I[1][0],I[1][1]]];y.current.length>1&&I&&!q.extent&&(J[0][0]=q.positionAbsolute.x-U.x+I[0][0],J[1][0]=q.positionAbsolute.x+(q.width??0)-U.x2+I[1][0],J[0][1]=q.positionAbsolute.y-U.y+I[0][1],J[1][1]=q.positionAbsolute.y+(q.height??0)-U.y2+I[1][1]);const ie=KE(q,G,X,J,L,B);return k=k||q.position.x!==ie.position.x||q.position.y!==ie.position.y,q.position=ie.position,q.positionAbsolute=ie.positionAbsolute,q}),!k)return;V(y.current,!0,!0),p(!0);const R=l?H:Cp(Y);if(R&&N.current){const[q,G]=_p({nodeId:l,dragItems:y.current,nodeInternals:X});R(N.current,q,G)}},M=()=>{if(!S.current)return;const[z,P]=yE(w.current,S.current);if(z!==0||P!==0){const{transform:X,panBy:H}=m.getState();g.current.x=(g.current.x??0)-z/X[2],g.current.y=(g.current.y??0)-P/X[2],H({x:z,y:P})&&T(g.current)}v.current=requestAnimationFrame(M)},A=z=>{const{nodeInternals:P,multiSelectionActive:X,nodesDraggable:H,unselectNodesAndEdges:Y,onNodeDragStart:V,onSelectionDragStart:I}=m.getState();_.current=!0;const F=l?V:Cp(I);(!f||!c)&&!X&&l&&(P.get(l)?.selected||Y()),l&&c&&f&&gy({id:l,store:m,nodeRef:e});const D=O(z);if(g.current=D,y.current=P6(P,H,D,l),F&&y.current){const[L,B]=_p({nodeId:l,dragItems:y.current,nodeInternals:P});F(z.sourceEvent,L,B)}};if(t)E.on(".drag",null);else{const z=aO().on("start",P=>{const{domNode:X,nodeDragThreshold:H}=m.getState();H===0&&A(P),C.current=!1;const Y=O(P);g.current=Y,S.current=X?.getBoundingClientRect()||null,w.current=Pr(P.sourceEvent,S.current)}).on("drag",P=>{const X=O(P),{autoPanOnNodeDrag:H,nodeDragThreshold:Y}=m.getState();if(P.sourceEvent.type==="touchmove"&&P.sourceEvent.touches.length>1&&(C.current=!0),!C.current){if(!j.current&&_.current&&H&&(j.current=!0,M()),!_.current){const V=X.xSnapped-(g?.current?.x??0),I=X.ySnapped-(g?.current?.y??0);Math.sqrt(V*V+I*I)>Y&&A(P)}(g.current.x!==X.xSnapped||g.current.y!==X.ySnapped)&&y.current&&_.current&&(N.current=P.sourceEvent,w.current=Pr(P.sourceEvent,S.current),T(X))}}).on("end",P=>{if(!(!_.current||C.current)&&(p(!1),j.current=!1,_.current=!1,cancelAnimationFrame(v.current),y.current)){const{updateNodePositions:X,nodeInternals:H,onNodeDragStop:Y,onSelectionDragStop:V}=m.getState(),I=l?Y:Cp(V);if(X(y.current,!1,!1),I){const[F,D]=_p({nodeId:l,dragItems:y.current,nodeInternals:H});I(P.sourceEvent,F,D)}}}).filter(P=>{const X=P.target;return!P.button&&(!r||!xw(X,`.${r}`,e))&&(!i||xw(X,i,e))});return E.call(z),()=>{E.on(".drag",null)}}}},[e,t,r,i,c,m,l,f,O]),h}function ZE(){const e=na();return u.useCallback(r=>{const{nodeInternals:i,nodeExtent:l,updateNodePositions:c,getNodes:f,snapToGrid:m,snapGrid:h,onError:p,nodesDraggable:y}=e.getState(),g=f().filter(C=>C.selected&&(C.draggable||y&&typeof C.draggable>"u")),v=m?h[0]:5,S=m?h[1]:5,w=r.isShiftPressed?4:1,N=r.x*v*w,j=r.y*S*w,_=g.map(C=>{if(C.positionAbsolute){const O={x:C.positionAbsolute.x+N,y:C.positionAbsolute.y+j};m&&(O.x=h[0]*Math.round(O.x/h[0]),O.y=h[1]*Math.round(O.y/h[1]));const{positionAbsolute:E,position:T}=KE(C,O,i,l,void 0,p);C.position=T,C.positionAbsolute=E}return C});c(_,!0,!1)},[])}const Al={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var Ho=e=>{const t=({id:r,type:i,data:l,xPos:c,yPos:f,xPosOrigin:m,yPosOrigin:h,selected:p,onClick:y,onMouseEnter:g,onMouseMove:v,onMouseLeave:S,onContextMenu:w,onDoubleClick:N,style:j,className:_,isDraggable:C,isSelectable:O,isConnectable:E,isFocusable:T,selectNodesOnDrag:M,sourcePosition:A,targetPosition:z,hidden:P,resizeObserver:X,dragHandle:H,zIndex:Y,isParent:V,noDragClassName:I,noPanClassName:F,initialized:D,disableKeyboardA11y:L,ariaLabel:B,rfId:k,hasHandleBounds:U})=>{const R=na(),q=u.useRef(null),G=u.useRef(null),J=u.useRef(A),ie=u.useRef(z),Z=u.useRef(i),me=O||C||y||g||v||S,Q=ZE(),ue=qo(r,R.getState,g),ne=qo(r,R.getState,v),we=qo(r,R.getState,S),Pe=qo(r,R.getState,w),Re=qo(r,R.getState,N),Ce=We=>{const{nodeDragThreshold:ke}=R.getState();if(O&&(!M||!C||ke>0)&&gy({id:r,store:R,nodeRef:q}),y){const xt=R.getState().nodeInternals.get(r);xt&&y(We,{...xt})}},it=We=>{if(!fy(We)&&!L)if(xE.includes(We.key)&&O){const ke=We.key==="Escape";gy({id:r,store:R,unselect:ke,nodeRef:q})}else C&&p&&Object.prototype.hasOwnProperty.call(Al,We.key)&&(R.setState({ariaLiveMessage:`Moved selected node ${We.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~c}, y: ${~~f}`}),Q({x:Al[We.key].x,y:Al[We.key].y,isShiftPressed:We.shiftKey}))};u.useEffect(()=>()=>{G.current&&(X?.unobserve(G.current),G.current=null)},[]),u.useEffect(()=>{if(q.current&&!P){const We=q.current;(!D||!U||G.current!==We)&&(G.current&&X?.unobserve(G.current),X?.observe(We),G.current=We)}},[P,D,U]),u.useEffect(()=>{const We=Z.current!==i,ke=J.current!==A,xt=ie.current!==z;q.current&&(We||ke||xt)&&(We&&(Z.current=i),ke&&(J.current=A),xt&&(ie.current=z),R.getState().updateNodeDimensions([{id:r,nodeElement:q.current,forceUpdate:!0}]))},[r,i,A,z]);const qe=WE({nodeRef:q,disabled:P||!C,noDragClassName:I,handleSelector:H,nodeId:r,isSelectable:O,selectNodesOnDrag:M});return P?null:De.createElement("div",{className:ma(["react-flow__node",`react-flow__node-${i}`,{[F]:C},_,{selected:p,selectable:O,parent:V,dragging:qe}]),ref:q,style:{zIndex:Y,transform:`translate(${m}px,${h}px)`,pointerEvents:me?"all":"none",visibility:D?"visible":"hidden",...j},"data-id":r,"data-testid":`rf__node-${r}`,onMouseEnter:ue,onMouseMove:ne,onMouseLeave:we,onContextMenu:Pe,onClick:Ce,onDoubleClick:Re,onKeyDown:T?it:void 0,tabIndex:T?0:void 0,role:T?"button":void 0,"aria-describedby":L?void 0:`${BE}-${k}`,"aria-label":B},De.createElement(i6,{value:r},De.createElement(e,{id:r,data:l,type:i,xPos:c,yPos:f,selected:p,isConnectable:E,sourcePosition:A,targetPosition:z,dragging:qe,dragHandle:H,zIndex:Y})))};return t.displayName="NodeWrapper",u.memo(t)};const G6=e=>{const t=e.getNodes().filter(r=>r.selected);return{..._f(t,e.nodeOrigin),transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`,userSelectionActive:e.userSelectionActive}};function X6({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:r}){const i=na(),{width:l,height:c,x:f,y:m,transformString:h,userSelectionActive:p}=In(G6,sa),y=ZE(),g=u.useRef(null);if(u.useEffect(()=>{r||g.current?.focus({preventScroll:!0})},[r]),WE({nodeRef:g}),p||!l||!c)return null;const v=e?w=>{const N=i.getState().getNodes().filter(j=>j.selected);e(w,N)}:void 0,S=w=>{Object.prototype.hasOwnProperty.call(Al,w.key)&&y({x:Al[w.key].x,y:Al[w.key].y,isShiftPressed:w.shiftKey})};return De.createElement("div",{className:ma(["react-flow__nodesselection","react-flow__container",t]),style:{transform:h}},De.createElement("div",{ref:g,className:"react-flow__nodesselection-rect",onContextMenu:v,tabIndex:r?void 0:-1,onKeyDown:r?void 0:S,style:{width:l,height:c,top:m,left:f}}))}var K6=u.memo(X6);const W6=e=>e.nodesSelectionActive,QE=({children:e,onPaneClick:t,onPaneMouseEnter:r,onPaneMouseMove:i,onPaneMouseLeave:l,onPaneContextMenu:c,onPaneScroll:f,deleteKeyCode:m,onMove:h,onMoveStart:p,onMoveEnd:y,selectionKeyCode:g,selectionOnDrag:v,selectionMode:S,onSelectionStart:w,onSelectionEnd:N,multiSelectionKeyCode:j,panActivationKeyCode:_,zoomActivationKeyCode:C,elementsSelectable:O,zoomOnScroll:E,zoomOnPinch:T,panOnScroll:M,panOnScrollSpeed:A,panOnScrollMode:z,zoomOnDoubleClick:P,panOnDrag:X,defaultViewport:H,translateExtent:Y,minZoom:V,maxZoom:I,preventScrolling:F,onSelectionContextMenu:D,noWheelClassName:L,noPanClassName:B,disableKeyboardA11y:k})=>{const U=In(W6),R=Sc(g),q=Sc(_),G=q||X,J=q||M,ie=R||v&&G!==!0;return L6({deleteKeyCode:m,multiSelectionKeyCode:j}),De.createElement(F6,{onMove:h,onMoveStart:p,onMoveEnd:y,onPaneContextMenu:c,elementsSelectable:O,zoomOnScroll:E,zoomOnPinch:T,panOnScroll:J,panOnScrollSpeed:A,panOnScrollMode:z,zoomOnDoubleClick:P,panOnDrag:!R&&G,defaultViewport:H,translateExtent:Y,minZoom:V,maxZoom:I,zoomActivationKeyCode:C,preventScrolling:F,noWheelClassName:L,noPanClassName:B},De.createElement(GE,{onSelectionStart:w,onSelectionEnd:N,onPaneClick:t,onPaneMouseEnter:r,onPaneMouseMove:i,onPaneMouseLeave:l,onPaneContextMenu:c,onPaneScroll:f,panOnDrag:G,isSelecting:!!ie,selectionMode:S},e,U&&De.createElement(K6,{onSelectionContextMenu:D,noPanClassName:B,disableKeyboardA11y:k})))};QE.displayName="FlowRenderer";var Z6=u.memo(QE);function Q6(e){return In(u.useCallback(r=>e?CE(r.nodeInternals,{x:0,y:0,width:r.width,height:r.height},r.transform,!0):r.getNodes(),[e]))}function J6(e){const t={input:Ho(e.input||OE),default:Ho(e.default||yy),output:Ho(e.output||$E),group:Ho(e.group||Sg)},r={},i=Object.keys(e).filter(l=>!["input","default","output","group"].includes(l)).reduce((l,c)=>(l[c]=Ho(e[c]||yy),l),r);return{...t,...i}}const e8=({x:e,y:t,width:r,height:i,origin:l})=>!r||!i?{x:e,y:t}:l[0]<0||l[1]<0||l[0]>1||l[1]>1?{x:e,y:t}:{x:e-r*l[0],y:t-i*l[1]},t8=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions,onError:e.onError}),JE=e=>{const{nodesDraggable:t,nodesConnectable:r,nodesFocusable:i,elementsSelectable:l,updateNodeDimensions:c,onError:f}=In(t8,sa),m=Q6(e.onlyRenderVisibleElements),h=u.useRef(),p=u.useMemo(()=>{if(typeof ResizeObserver>"u")return null;const y=new ResizeObserver(g=>{const v=g.map(S=>({id:S.target.getAttribute("data-id"),nodeElement:S.target,forceUpdate:!0}));c(v)});return h.current=y,y},[]);return u.useEffect(()=>()=>{h?.current?.disconnect()},[]),De.createElement("div",{className:"react-flow__nodes",style:Ng},m.map(y=>{let g=y.type||"default";e.nodeTypes[g]||(f?.("003",lr.error003(g)),g="default");const v=e.nodeTypes[g]||e.nodeTypes.default,S=!!(y.draggable||t&&typeof y.draggable>"u"),w=!!(y.selectable||l&&typeof y.selectable>"u"),N=!!(y.connectable||r&&typeof y.connectable>"u"),j=!!(y.focusable||i&&typeof y.focusable>"u"),_=e.nodeExtent?pg(y.positionAbsolute,e.nodeExtent):y.positionAbsolute,C=_?.x??0,O=_?.y??0,E=e8({x:C,y:O,width:y.width??0,height:y.height??0,origin:e.nodeOrigin});return De.createElement(v,{key:y.id,id:y.id,className:y.className,style:y.style,type:g,data:y.data,sourcePosition:y.sourcePosition||Bt.Bottom,targetPosition:y.targetPosition||Bt.Top,hidden:y.hidden,xPos:C,yPos:O,xPosOrigin:E.x,yPosOrigin:E.y,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!y.selected,isDraggable:S,isSelectable:w,isConnectable:N,isFocusable:j,resizeObserver:p,dragHandle:y.dragHandle,zIndex:y[Vn]?.z??0,isParent:!!y[Vn]?.isParent,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!y.width&&!!y.height,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,ariaLabel:y.ariaLabel,hasHandleBounds:!!y[Vn]?.handleBounds})}))};JE.displayName="NodeRenderer";var n8=u.memo(JE);const a8=(e,t,r)=>r===Bt.Left?e-t:r===Bt.Right?e+t:e,s8=(e,t,r)=>r===Bt.Top?e-t:r===Bt.Bottom?e+t:e,ww="react-flow__edgeupdater",Nw=({position:e,centerX:t,centerY:r,radius:i=10,onMouseDown:l,onMouseEnter:c,onMouseOut:f,type:m})=>De.createElement("circle",{onMouseDown:l,onMouseEnter:c,onMouseOut:f,className:ma([ww,`${ww}-${m}`]),cx:a8(t,i,e),cy:s8(r,i,e),r:i,stroke:"transparent",fill:"transparent"}),r8=()=>!0;var Sl=e=>{const t=({id:r,className:i,type:l,data:c,onClick:f,onEdgeDoubleClick:m,selected:h,animated:p,label:y,labelStyle:g,labelShowBg:v,labelBgStyle:S,labelBgPadding:w,labelBgBorderRadius:N,style:j,source:_,target:C,sourceX:O,sourceY:E,targetX:T,targetY:M,sourcePosition:A,targetPosition:z,elementsSelectable:P,hidden:X,sourceHandleId:H,targetHandleId:Y,onContextMenu:V,onMouseEnter:I,onMouseMove:F,onMouseLeave:D,reconnectRadius:L,onReconnect:B,onReconnectStart:k,onReconnectEnd:U,markerEnd:R,markerStart:q,rfId:G,ariaLabel:J,isFocusable:ie,isReconnectable:Z,pathOptions:me,interactionWidth:Q,disableKeyboardA11y:ue})=>{const ne=u.useRef(null),[we,Pe]=u.useState(!1),[Re,Ce]=u.useState(!1),it=na(),qe=u.useMemo(()=>`url('#${hy(q,G)}')`,[q,G]),We=u.useMemo(()=>`url('#${hy(R,G)}')`,[R,G]);if(X)return null;const ke=Ee=>{const{edges:ge,addSelectedEdges:at,unselectNodesAndEdges:st,multiSelectionActive:nt}=it.getState(),ze=ge.find(ft=>ft.id===r);ze&&(P&&(it.setState({nodesSelectionActive:!1}),ze.selected&&nt?(st({nodes:[],edges:[ze]}),ne.current?.blur()):at([r])),f&&f(Ee,ze))},xt=Uo(r,it.getState,m),Mt=Uo(r,it.getState,V),Ct=Uo(r,it.getState,I),At=Uo(r,it.getState,F),He=Uo(r,it.getState,D),Qe=(Ee,ge)=>{if(Ee.button!==0)return;const{edges:at,isValidConnection:st}=it.getState(),nt=ge?C:_,ze=(ge?Y:H)||null,ft=ge?"target":"source",zt=st||r8,Rt=ge,pt=at.find(Tt=>Tt.id===r);Ce(!0),k?.(Ee,pt,ft);const ct=Tt=>{Ce(!1),U?.(Tt,pt,ft)};kE({event:Ee,handleId:ze,nodeId:nt,onConnect:Tt=>B?.(pt,Tt),isTarget:Rt,getState:it.getState,setState:it.setState,isValidConnection:zt,edgeUpdaterType:ft,onReconnectEnd:ct})},W=Ee=>Qe(Ee,!0),ee=Ee=>Qe(Ee,!1),te=()=>Pe(!0),ve=()=>Pe(!1),le=!P&&!f,Se=Ee=>{if(!ue&&xE.includes(Ee.key)&&P){const{unselectNodesAndEdges:ge,addSelectedEdges:at,edges:st}=it.getState();Ee.key==="Escape"?(ne.current?.blur(),ge({edges:[st.find(ze=>ze.id===r)]})):at([r])}};return De.createElement("g",{className:ma(["react-flow__edge",`react-flow__edge-${l}`,i,{selected:h,animated:p,inactive:le,updating:we}]),onClick:ke,onDoubleClick:xt,onContextMenu:Mt,onMouseEnter:Ct,onMouseMove:At,onMouseLeave:He,onKeyDown:ie?Se:void 0,tabIndex:ie?0:void 0,role:ie?"button":"img","data-testid":`rf__edge-${r}`,"aria-label":J===null?void 0:J||`Edge from ${_} to ${C}`,"aria-describedby":ie?`${UE}-${G}`:void 0,ref:ne},!Re&&De.createElement(e,{id:r,source:_,target:C,selected:h,animated:p,label:y,labelStyle:g,labelShowBg:v,labelBgStyle:S,labelBgPadding:w,labelBgBorderRadius:N,data:c,style:j,sourceX:O,sourceY:E,targetX:T,targetY:M,sourcePosition:A,targetPosition:z,sourceHandleId:H,targetHandleId:Y,markerStart:qe,markerEnd:We,pathOptions:me,interactionWidth:Q}),Z&&De.createElement(De.Fragment,null,(Z==="source"||Z===!0)&&De.createElement(Nw,{position:A,centerX:O,centerY:E,radius:L,onMouseDown:W,onMouseEnter:te,onMouseOut:ve,type:"source"}),(Z==="target"||Z===!0)&&De.createElement(Nw,{position:z,centerX:T,centerY:M,radius:L,onMouseDown:ee,onMouseEnter:te,onMouseOut:ve,type:"target"})))};return t.displayName="EdgeWrapper",u.memo(t)};function i8(e){const t={default:Sl(e.default||Vd),straight:Sl(e.bezier||bg),step:Sl(e.step||gg),smoothstep:Sl(e.step||jf),simplebezier:Sl(e.simplebezier||yg)},r={},i=Object.keys(e).filter(l=>!["default","bezier"].includes(l)).reduce((l,c)=>(l[c]=Sl(e[c]||Vd),l),r);return{...t,...i}}function Ew(e,t,r=null){const i=(r?.x||0)+t.x,l=(r?.y||0)+t.y,c=r?.width||t.width,f=r?.height||t.height;switch(e){case Bt.Top:return{x:i+c/2,y:l};case Bt.Right:return{x:i+c,y:l+f/2};case Bt.Bottom:return{x:i+c/2,y:l+f};case Bt.Left:return{x:i,y:l+f/2}}}function jw(e,t){return e?e.length===1||!t?e[0]:t&&e.find(r=>r.id===t)||null:null}const l8=(e,t,r,i,l,c)=>{const f=Ew(r,e,t),m=Ew(c,i,l);return{sourceX:f.x,sourceY:f.y,targetX:m.x,targetY:m.y}};function o8({sourcePos:e,targetPos:t,sourceWidth:r,sourceHeight:i,targetWidth:l,targetHeight:c,width:f,height:m,transform:h}){const p={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x+r,t.x+l),y2:Math.max(e.y+i,t.y+c)};p.x===p.x2&&(p.x2+=1),p.y===p.y2&&(p.y2+=1);const y=vc({x:(0-h[0])/h[2],y:(0-h[1])/h[2],width:f/h[2],height:m/h[2]}),g=Math.max(0,Math.min(y.x2,p.x2)-Math.max(y.x,p.x)),v=Math.max(0,Math.min(y.y2,p.y2)-Math.max(y.y,p.y));return Math.ceil(g*v)>0}function _w(e){const t=e?.[Vn]?.handleBounds||null,r=t&&e?.width&&e?.height&&typeof e?.positionAbsolute?.x<"u"&&typeof e?.positionAbsolute?.y<"u";return[{x:e?.positionAbsolute?.x||0,y:e?.positionAbsolute?.y||0,width:e?.width||0,height:e?.height||0},t,!!r]}const c8=[{level:0,isMaxLevel:!0,edges:[]}];function u8(e,t,r=!1){let i=-1;const l=e.reduce((f,m)=>{const h=rs(m.zIndex);let p=h?m.zIndex:0;if(r){const y=t.get(m.target),g=t.get(m.source),v=m.selected||y?.selected||g?.selected,S=Math.max(g?.[Vn]?.z||0,y?.[Vn]?.z||0,1e3);p=(h?m.zIndex:0)+(v?S:0)}return f[p]?f[p].push(m):f[p]=[m],i=p>i?p:i,f},{}),c=Object.entries(l).map(([f,m])=>{const h=+f;return{edges:m,level:h,isMaxLevel:h===i}});return c.length===0?c8:c}function d8(e,t,r){const i=In(u.useCallback(l=>e?l.edges.filter(c=>{const f=t.get(c.source),m=t.get(c.target);return f?.width&&f?.height&&m?.width&&m?.height&&o8({sourcePos:f.positionAbsolute||{x:0,y:0},targetPos:m.positionAbsolute||{x:0,y:0},sourceWidth:f.width,sourceHeight:f.height,targetWidth:m.width,targetHeight:m.height,width:l.width,height:l.height,transform:l.transform})}):l.edges,[e,t]));return u8(i,t,r)}const f8=({color:e="none",strokeWidth:t=1})=>De.createElement("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),m8=({color:e="none",strokeWidth:t=1})=>De.createElement("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),Cw={[Pd.Arrow]:f8,[Pd.ArrowClosed]:m8};function h8(e){const t=na();return u.useMemo(()=>Object.prototype.hasOwnProperty.call(Cw,e)?Cw[e]:(t.getState().onError?.("009",lr.error009(e)),null),[e])}const p8=({id:e,type:t,color:r,width:i=12.5,height:l=12.5,markerUnits:c="strokeWidth",strokeWidth:f,orient:m="auto-start-reverse"})=>{const h=h8(t);return h?De.createElement("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${i}`,markerHeight:`${l}`,viewBox:"-10 -10 20 20",markerUnits:c,orient:m,refX:"0",refY:"0"},De.createElement(h,{color:r,strokeWidth:f})):null},y8=({defaultColor:e,rfId:t})=>r=>{const i=[];return r.edges.reduce((l,c)=>([c.markerStart,c.markerEnd].forEach(f=>{if(f&&typeof f=="object"){const m=hy(f,t);i.includes(m)||(l.push({id:m,color:f.color||e,...f}),i.push(m))}}),l),[]).sort((l,c)=>l.id.localeCompare(c.id))},ej=({defaultColor:e,rfId:t})=>{const r=In(u.useCallback(y8({defaultColor:e,rfId:t}),[e,t]),(i,l)=>!(i.length!==l.length||i.some((c,f)=>c.id!==l[f].id)));return De.createElement("defs",null,r.map(i=>De.createElement(p8,{id:i.id,key:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient})))};ej.displayName="MarkerDefinitions";var g8=u.memo(ej);const b8=e=>({nodesConnectable:e.nodesConnectable,edgesFocusable:e.edgesFocusable,edgesUpdatable:e.edgesUpdatable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals,onError:e.onError}),tj=({defaultMarkerColor:e,onlyRenderVisibleElements:t,elevateEdgesOnSelect:r,rfId:i,edgeTypes:l,noPanClassName:c,onEdgeContextMenu:f,onEdgeMouseEnter:m,onEdgeMouseMove:h,onEdgeMouseLeave:p,onEdgeClick:y,onEdgeDoubleClick:g,onReconnect:v,onReconnectStart:S,onReconnectEnd:w,reconnectRadius:N,children:j,disableKeyboardA11y:_})=>{const{edgesFocusable:C,edgesUpdatable:O,elementsSelectable:E,width:T,height:M,connectionMode:A,nodeInternals:z,onError:P}=In(b8,sa),X=d8(t,z,r);return T?De.createElement(De.Fragment,null,X.map(({level:H,edges:Y,isMaxLevel:V})=>De.createElement("svg",{key:H,style:{zIndex:H},width:T,height:M,className:"react-flow__edges react-flow__container"},V&&De.createElement(g8,{defaultColor:e,rfId:i}),De.createElement("g",null,Y.map(I=>{const[F,D,L]=_w(z.get(I.source)),[B,k,U]=_w(z.get(I.target));if(!L||!U)return null;let R=I.type||"default";l[R]||(P?.("011",lr.error011(R)),R="default");const q=l[R]||l.default,G=A===Ri.Strict?k.target:(k.target??[]).concat(k.source??[]),J=jw(D.source,I.sourceHandle),ie=jw(G,I.targetHandle),Z=J?.position||Bt.Bottom,me=ie?.position||Bt.Top,Q=!!(I.focusable||C&&typeof I.focusable>"u"),ue=I.reconnectable||I.updatable,ne=typeof v<"u"&&(ue||O&&typeof ue>"u");if(!J||!ie)return P?.("008",lr.error008(J,I)),null;const{sourceX:we,sourceY:Pe,targetX:Re,targetY:Ce}=l8(F,J,Z,B,ie,me);return De.createElement(q,{key:I.id,id:I.id,className:ma([I.className,c]),type:R,data:I.data,selected:!!I.selected,animated:!!I.animated,hidden:!!I.hidden,label:I.label,labelStyle:I.labelStyle,labelShowBg:I.labelShowBg,labelBgStyle:I.labelBgStyle,labelBgPadding:I.labelBgPadding,labelBgBorderRadius:I.labelBgBorderRadius,style:I.style,source:I.source,target:I.target,sourceHandleId:I.sourceHandle,targetHandleId:I.targetHandle,markerEnd:I.markerEnd,markerStart:I.markerStart,sourceX:we,sourceY:Pe,targetX:Re,targetY:Ce,sourcePosition:Z,targetPosition:me,elementsSelectable:E,onContextMenu:f,onMouseEnter:m,onMouseMove:h,onMouseLeave:p,onClick:y,onEdgeDoubleClick:g,onReconnect:v,onReconnectStart:S,onReconnectEnd:w,reconnectRadius:N,rfId:i,ariaLabel:I.ariaLabel,isFocusable:Q,isReconnectable:ne,pathOptions:"pathOptions"in I?I.pathOptions:void 0,interactionWidth:I.interactionWidth,disableKeyboardA11y:_})})))),j):null};tj.displayName="EdgeRenderer";var v8=u.memo(tj);const x8=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function S8({children:e}){const t=In(x8);return De.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:t}},e)}function w8(e){const t=wg(),r=u.useRef(!1);u.useEffect(()=>{!r.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),r.current=!0)},[e,t.viewportInitialized])}const N8={[Bt.Left]:Bt.Right,[Bt.Right]:Bt.Left,[Bt.Top]:Bt.Bottom,[Bt.Bottom]:Bt.Top},nj=({nodeId:e,handleType:t,style:r,type:i=qr.Bezier,CustomComponent:l,connectionStatus:c})=>{const{fromNode:f,handleId:m,toX:h,toY:p,connectionMode:y}=In(u.useCallback(M=>({fromNode:M.nodeInternals.get(e),handleId:M.connectionHandleId,toX:(M.connectionPosition.x-M.transform[0])/M.transform[2],toY:(M.connectionPosition.y-M.transform[1])/M.transform[2],connectionMode:M.connectionMode}),[e]),sa),g=f?.[Vn]?.handleBounds;let v=g?.[t];if(y===Ri.Loose&&(v=v||g?.[t==="source"?"target":"source"]),!f||!v)return null;const S=m?v.find(M=>M.id===m):v[0],w=S?S.x+S.width/2:(f.width??0)/2,N=S?S.y+S.height/2:f.height??0,j=(f.positionAbsolute?.x??0)+w,_=(f.positionAbsolute?.y??0)+N,C=S?.position,O=C?N8[C]:null;if(!C||!O)return null;if(l)return De.createElement(l,{connectionLineType:i,connectionLineStyle:r,fromNode:f,fromHandle:S,fromX:j,fromY:_,toX:h,toY:p,fromPosition:C,toPosition:O,connectionStatus:c});let E="";const T={sourceX:j,sourceY:_,sourcePosition:C,targetX:h,targetY:p,targetPosition:O};return i===qr.Bezier?[E]=jE(T):i===qr.Step?[E]=my({...T,borderRadius:0}):i===qr.SmoothStep?[E]=my(T):i===qr.SimpleBezier?[E]=EE(T):E=`M${j},${_} ${h},${p}`,De.createElement("path",{d:E,fill:"none",className:"react-flow__connection-path",style:r})};nj.displayName="ConnectionLine";const E8=e=>({nodeId:e.connectionNodeId,handleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,connectionStatus:e.connectionStatus,width:e.width,height:e.height});function j8({containerStyle:e,style:t,type:r,component:i}){const{nodeId:l,handleType:c,nodesConnectable:f,width:m,height:h,connectionStatus:p}=In(E8,sa);return!(l&&c&&m&&f)?null:De.createElement("svg",{style:e,width:m,height:h,className:"react-flow__edges react-flow__connectionline react-flow__container"},De.createElement("g",{className:ma(["react-flow__connection",p])},De.createElement(nj,{nodeId:l,handleType:c,style:t,type:r,CustomComponent:i,connectionStatus:p})))}function Aw(e,t){return u.useRef(null),na(),u.useMemo(()=>t(e),[e])}const aj=({nodeTypes:e,edgeTypes:t,onMove:r,onMoveStart:i,onMoveEnd:l,onInit:c,onNodeClick:f,onEdgeClick:m,onNodeDoubleClick:h,onEdgeDoubleClick:p,onNodeMouseEnter:y,onNodeMouseMove:g,onNodeMouseLeave:v,onNodeContextMenu:S,onSelectionContextMenu:w,onSelectionStart:N,onSelectionEnd:j,connectionLineType:_,connectionLineStyle:C,connectionLineComponent:O,connectionLineContainerStyle:E,selectionKeyCode:T,selectionOnDrag:M,selectionMode:A,multiSelectionKeyCode:z,panActivationKeyCode:P,zoomActivationKeyCode:X,deleteKeyCode:H,onlyRenderVisibleElements:Y,elementsSelectable:V,selectNodesOnDrag:I,defaultViewport:F,translateExtent:D,minZoom:L,maxZoom:B,preventScrolling:k,defaultMarkerColor:U,zoomOnScroll:R,zoomOnPinch:q,panOnScroll:G,panOnScrollSpeed:J,panOnScrollMode:ie,zoomOnDoubleClick:Z,panOnDrag:me,onPaneClick:Q,onPaneMouseEnter:ue,onPaneMouseMove:ne,onPaneMouseLeave:we,onPaneScroll:Pe,onPaneContextMenu:Re,onEdgeContextMenu:Ce,onEdgeMouseEnter:it,onEdgeMouseMove:qe,onEdgeMouseLeave:We,onReconnect:ke,onReconnectStart:xt,onReconnectEnd:Mt,reconnectRadius:Ct,noDragClassName:At,noWheelClassName:He,noPanClassName:Qe,elevateEdgesOnSelect:W,disableKeyboardA11y:ee,nodeOrigin:te,nodeExtent:ve,rfId:le})=>{const Se=Aw(e,J6),Ee=Aw(t,i8);return w8(c),De.createElement(Z6,{onPaneClick:Q,onPaneMouseEnter:ue,onPaneMouseMove:ne,onPaneMouseLeave:we,onPaneContextMenu:Re,onPaneScroll:Pe,deleteKeyCode:H,selectionKeyCode:T,selectionOnDrag:M,selectionMode:A,onSelectionStart:N,onSelectionEnd:j,multiSelectionKeyCode:z,panActivationKeyCode:P,zoomActivationKeyCode:X,elementsSelectable:V,onMove:r,onMoveStart:i,onMoveEnd:l,zoomOnScroll:R,zoomOnPinch:q,zoomOnDoubleClick:Z,panOnScroll:G,panOnScrollSpeed:J,panOnScrollMode:ie,panOnDrag:me,defaultViewport:F,translateExtent:D,minZoom:L,maxZoom:B,onSelectionContextMenu:w,preventScrolling:k,noDragClassName:At,noWheelClassName:He,noPanClassName:Qe,disableKeyboardA11y:ee},De.createElement(S8,null,De.createElement(v8,{edgeTypes:Ee,onEdgeClick:m,onEdgeDoubleClick:p,onlyRenderVisibleElements:Y,onEdgeContextMenu:Ce,onEdgeMouseEnter:it,onEdgeMouseMove:qe,onEdgeMouseLeave:We,onReconnect:ke,onReconnectStart:xt,onReconnectEnd:Mt,reconnectRadius:Ct,defaultMarkerColor:U,noPanClassName:Qe,elevateEdgesOnSelect:!!W,disableKeyboardA11y:ee,rfId:le},De.createElement(j8,{style:C,type:_,component:O,containerStyle:E})),De.createElement("div",{className:"react-flow__edgelabel-renderer"}),De.createElement(n8,{nodeTypes:Se,onNodeClick:f,onNodeDoubleClick:h,onNodeMouseEnter:y,onNodeMouseMove:g,onNodeMouseLeave:v,onNodeContextMenu:S,selectNodesOnDrag:I,onlyRenderVisibleElements:Y,noPanClassName:Qe,noDragClassName:At,disableKeyboardA11y:ee,nodeOrigin:te,nodeExtent:ve,rfId:le})))};aj.displayName="GraphView";var _8=u.memo(aj);const by=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Ir={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:by,nodeExtent:by,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:Ri.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:e6,isValidConnection:void 0},C8=()=>pL((e,t)=>({...Ir,setNodes:r=>{const{nodeInternals:i,nodeOrigin:l,elevateNodesOnSelect:c}=t();e({nodeInternals:Ep(r,i,l,c)})},getNodes:()=>Array.from(t().nodeInternals.values()),setEdges:r=>{const{defaultEdgeOptions:i={}}=t();e({edges:r.map(l=>({...i,...l}))})},setDefaultNodesAndEdges:(r,i)=>{const l=typeof r<"u",c=typeof i<"u",f=l?Ep(r,new Map,t().nodeOrigin,t().elevateNodesOnSelect):new Map;e({nodeInternals:f,edges:c?i:[],hasDefaultNodes:l,hasDefaultEdges:c})},updateNodeDimensions:r=>{const{onNodesChange:i,nodeInternals:l,fitViewOnInit:c,fitViewOnInitDone:f,fitViewOnInitOptions:m,domNode:h,nodeOrigin:p}=t(),y=h?.querySelector(".react-flow__viewport");if(!y)return;const g=window.getComputedStyle(y),{m22:v}=new window.DOMMatrixReadOnly(g.transform),S=r.reduce((N,j)=>{const _=l.get(j.id);if(_?.hidden)l.set(_.id,{..._,[Vn]:{..._[Vn],handleBounds:void 0}});else if(_){const C=hg(j.nodeElement);!!(C.width&&C.height&&(_.width!==C.width||_.height!==C.height||j.forceUpdate))&&(l.set(_.id,{..._,[Vn]:{..._[Vn],handleBounds:{source:Sw(".source",j.nodeElement,v,p),target:Sw(".target",j.nodeElement,v,p)}},...C}),N.push({id:_.id,type:"dimensions",dimensions:C}))}return N},[]);HE(l,p);const w=f||c&&!f&&PE(t,{initial:!0,...m});e({nodeInternals:new Map(l),fitViewOnInitDone:w}),S?.length>0&&i?.(S)},updateNodePositions:(r,i=!0,l=!1)=>{const{triggerNodeChanges:c}=t(),f=r.map(m=>{const h={id:m.id,type:"position",dragging:l};return i&&(h.positionAbsolute=m.positionAbsolute,h.position=m.position),h});c(f)},triggerNodeChanges:r=>{const{onNodesChange:i,nodeInternals:l,hasDefaultNodes:c,nodeOrigin:f,getNodes:m,elevateNodesOnSelect:h}=t();if(r?.length){if(c){const p=YE(r,m()),y=Ep(p,l,f,h);e({nodeInternals:y})}i?.(r)}},addSelectedNodes:r=>{const{multiSelectionActive:i,edges:l,getNodes:c}=t();let f,m=null;i?f=r.map(h=>$r(h,!0)):(f=Nl(c(),r),m=Nl(l,[])),id({changedNodes:f,changedEdges:m,get:t,set:e})},addSelectedEdges:r=>{const{multiSelectionActive:i,edges:l,getNodes:c}=t();let f,m=null;i?f=r.map(h=>$r(h,!0)):(f=Nl(l,r),m=Nl(c(),[])),id({changedNodes:m,changedEdges:f,get:t,set:e})},unselectNodesAndEdges:({nodes:r,edges:i}={})=>{const{edges:l,getNodes:c}=t(),f=r||c(),m=i||l,h=f.map(y=>(y.selected=!1,$r(y.id,!1))),p=m.map(y=>$r(y.id,!1));id({changedNodes:h,changedEdges:p,get:t,set:e})},setMinZoom:r=>{const{d3Zoom:i,maxZoom:l}=t();i?.scaleExtent([r,l]),e({minZoom:r})},setMaxZoom:r=>{const{d3Zoom:i,minZoom:l}=t();i?.scaleExtent([l,r]),e({maxZoom:r})},setTranslateExtent:r=>{t().d3Zoom?.translateExtent(r),e({translateExtent:r})},resetSelectedElements:()=>{const{edges:r,getNodes:i}=t(),c=i().filter(m=>m.selected).map(m=>$r(m.id,!1)),f=r.filter(m=>m.selected).map(m=>$r(m.id,!1));id({changedNodes:c,changedEdges:f,get:t,set:e})},setNodeExtent:r=>{const{nodeInternals:i}=t();i.forEach(l=>{l.positionAbsolute=pg(l.position,r)}),e({nodeExtent:r,nodeInternals:new Map(i)})},panBy:r=>{const{transform:i,width:l,height:c,d3Zoom:f,d3Selection:m,translateExtent:h}=t();if(!f||!m||!r.x&&!r.y)return!1;const p=sr.translate(i[0]+r.x,i[1]+r.y).scale(i[2]),y=[[0,0],[l,c]],g=f?.constrain()(p,y,h);return f.transform(m,g),i[0]!==g.x||i[1]!==g.y||i[2]!==g.k},cancelConnection:()=>e({connectionNodeId:Ir.connectionNodeId,connectionHandleId:Ir.connectionHandleId,connectionHandleType:Ir.connectionHandleType,connectionStatus:Ir.connectionStatus,connectionStartHandle:Ir.connectionStartHandle,connectionEndHandle:Ir.connectionEndHandle}),reset:()=>e({...Ir})}),Object.is),sj=({children:e})=>{const t=u.useRef(null);return t.current||(t.current=C8()),De.createElement(G7,{value:t.current},e)};sj.displayName="ReactFlowProvider";const rj=({children:e})=>u.useContext(Ef)?De.createElement(De.Fragment,null,e):De.createElement(sj,null,e);rj.displayName="ReactFlowWrapper";const A8={input:OE,default:yy,output:$E,group:Sg},T8={default:Vd,straight:bg,step:gg,smoothstep:jf,simplebezier:yg},M8=[0,0],R8=[15,15],k8={x:0,y:0,zoom:1},D8={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},ij=u.forwardRef(({nodes:e,edges:t,defaultNodes:r,defaultEdges:i,className:l,nodeTypes:c=A8,edgeTypes:f=T8,onNodeClick:m,onEdgeClick:h,onInit:p,onMove:y,onMoveStart:g,onMoveEnd:v,onConnect:S,onConnectStart:w,onConnectEnd:N,onClickConnectStart:j,onClickConnectEnd:_,onNodeMouseEnter:C,onNodeMouseMove:O,onNodeMouseLeave:E,onNodeContextMenu:T,onNodeDoubleClick:M,onNodeDragStart:A,onNodeDrag:z,onNodeDragStop:P,onNodesDelete:X,onEdgesDelete:H,onSelectionChange:Y,onSelectionDragStart:V,onSelectionDrag:I,onSelectionDragStop:F,onSelectionContextMenu:D,onSelectionStart:L,onSelectionEnd:B,connectionMode:k=Ri.Strict,connectionLineType:U=qr.Bezier,connectionLineStyle:R,connectionLineComponent:q,connectionLineContainerStyle:G,deleteKeyCode:J="Backspace",selectionKeyCode:ie="Shift",selectionOnDrag:Z=!1,selectionMode:me=xc.Full,panActivationKeyCode:Q="Space",multiSelectionKeyCode:ue=Hd()?"Meta":"Control",zoomActivationKeyCode:ne=Hd()?"Meta":"Control",snapToGrid:we=!1,snapGrid:Pe=R8,onlyRenderVisibleElements:Re=!1,selectNodesOnDrag:Ce=!0,nodesDraggable:it,nodesConnectable:qe,nodesFocusable:We,nodeOrigin:ke=M8,edgesFocusable:xt,edgesUpdatable:Mt,elementsSelectable:Ct,defaultViewport:At=k8,minZoom:He=.5,maxZoom:Qe=2,translateExtent:W=by,preventScrolling:ee=!0,nodeExtent:te,defaultMarkerColor:ve="#b1b1b7",zoomOnScroll:le=!0,zoomOnPinch:Se=!0,panOnScroll:Ee=!1,panOnScrollSpeed:ge=.5,panOnScrollMode:at=Ci.Free,zoomOnDoubleClick:st=!0,panOnDrag:nt=!0,onPaneClick:ze,onPaneMouseEnter:ft,onPaneMouseMove:zt,onPaneMouseLeave:Rt,onPaneScroll:pt,onPaneContextMenu:ct,children:yt,onEdgeContextMenu:Tt,onEdgeDoubleClick:Ft,onEdgeMouseEnter:kt,onEdgeMouseMove:Zt,onEdgeMouseLeave:Lt,onEdgeUpdate:Kt,onEdgeUpdateStart:se,onEdgeUpdateEnd:be,onReconnect:je,onReconnectStart:Ze,onReconnectEnd:dt,reconnectRadius:gt=10,edgeUpdaterRadius:oe=10,onNodesChange:re,onEdgesChange:Ne,noDragClassName:Be="nodrag",noWheelClassName:Ke="nowheel",noPanClassName:ot="nopan",fitView:Oe=!1,fitViewOptions:ce,connectOnClick:Ue=!0,attributionPosition:Ge,proOptions:ut,defaultEdgeOptions:ae,elevateNodesOnSelect:Xe=!0,elevateEdgesOnSelect:$e=!1,disableKeyboardA11y:Je=!1,autoPanOnConnect:bt=!0,autoPanOnNodeDrag:St=!0,connectionRadius:_e=20,isValidConnection:tt,onError:mt,style:fe,id:he,nodeDragThreshold:Ve,...vt},Nt)=>{const Et=he||"1";return De.createElement("div",{...vt,style:{...fe,...D8},ref:Nt,className:ma(["react-flow",l]),"data-testid":"rf__wrapper",id:he},De.createElement(rj,null,De.createElement(_8,{onInit:p,onMove:y,onMoveStart:g,onMoveEnd:v,onNodeClick:m,onEdgeClick:h,onNodeMouseEnter:C,onNodeMouseMove:O,onNodeMouseLeave:E,onNodeContextMenu:T,onNodeDoubleClick:M,nodeTypes:c,edgeTypes:f,connectionLineType:U,connectionLineStyle:R,connectionLineComponent:q,connectionLineContainerStyle:G,selectionKeyCode:ie,selectionOnDrag:Z,selectionMode:me,deleteKeyCode:J,multiSelectionKeyCode:ue,panActivationKeyCode:Q,zoomActivationKeyCode:ne,onlyRenderVisibleElements:Re,selectNodesOnDrag:Ce,defaultViewport:At,translateExtent:W,minZoom:He,maxZoom:Qe,preventScrolling:ee,zoomOnScroll:le,zoomOnPinch:Se,zoomOnDoubleClick:st,panOnScroll:Ee,panOnScrollSpeed:ge,panOnScrollMode:at,panOnDrag:nt,onPaneClick:ze,onPaneMouseEnter:ft,onPaneMouseMove:zt,onPaneMouseLeave:Rt,onPaneScroll:pt,onPaneContextMenu:ct,onSelectionContextMenu:D,onSelectionStart:L,onSelectionEnd:B,onEdgeContextMenu:Tt,onEdgeDoubleClick:Ft,onEdgeMouseEnter:kt,onEdgeMouseMove:Zt,onEdgeMouseLeave:Lt,onReconnect:je??Kt,onReconnectStart:Ze??se,onReconnectEnd:dt??be,reconnectRadius:gt??oe,defaultMarkerColor:ve,noDragClassName:Be,noWheelClassName:Ke,noPanClassName:ot,elevateEdgesOnSelect:$e,rfId:Et,disableKeyboardA11y:Je,nodeOrigin:ke,nodeExtent:te}),De.createElement(N6,{nodes:e,edges:t,defaultNodes:r,defaultEdges:i,onConnect:S,onConnectStart:w,onConnectEnd:N,onClickConnectStart:j,onClickConnectEnd:_,nodesDraggable:it,nodesConnectable:qe,nodesFocusable:We,edgesFocusable:xt,edgesUpdatable:Mt,elementsSelectable:Ct,elevateNodesOnSelect:Xe,minZoom:He,maxZoom:Qe,nodeExtent:te,onNodesChange:re,onEdgesChange:Ne,snapToGrid:we,snapGrid:Pe,connectionMode:k,translateExtent:W,connectOnClick:Ue,defaultEdgeOptions:ae,fitView:Oe,fitViewOptions:ce,onNodesDelete:X,onEdgesDelete:H,onNodeDragStart:A,onNodeDrag:z,onNodeDragStop:P,onSelectionDrag:I,onSelectionDragStart:V,onSelectionDragStop:F,noPanClassName:ot,nodeOrigin:ke,rfId:Et,autoPanOnConnect:bt,autoPanOnNodeDrag:St,onError:mt,connectionRadius:_e,isValidConnection:tt,nodeDragThreshold:Ve}),De.createElement(S6,{onSelectionChange:Y}),yt,De.createElement(K7,{proOptions:ut,position:Ge}),De.createElement(A6,{rfId:Et,disableKeyboardA11y:Je})))});ij.displayName="ReactFlow";const lj=({id:e,x:t,y:r,width:i,height:l,style:c,color:f,strokeColor:m,strokeWidth:h,className:p,borderRadius:y,shapeRendering:g,onClick:v,selected:S})=>{const{background:w,backgroundColor:N}=c||{},j=f||w||N;return De.createElement("rect",{className:ma(["react-flow__minimap-node",{selected:S},p]),x:t,y:r,rx:y,ry:y,width:i,height:l,fill:j,stroke:m,strokeWidth:h,shapeRendering:g,onClick:v?_=>v(_,e):void 0})};lj.displayName="MiniMapNode";var I8=u.memo(lj);const L8=e=>e.nodeOrigin,O8=e=>e.getNodes().filter(t=>!t.hidden&&t.width&&t.height),Ap=e=>e instanceof Function?e:()=>e;function z8({nodeStrokeColor:e="transparent",nodeColor:t="#e2e2e2",nodeClassName:r="",nodeBorderRadius:i=5,nodeStrokeWidth:l=2,nodeComponent:c=I8,onClick:f}){const m=In(O8,sa),h=In(L8),p=Ap(t),y=Ap(e),g=Ap(r),v=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return De.createElement(De.Fragment,null,m.map(S=>{const{x:w,y:N}=Ti(S,h).positionAbsolute;return De.createElement(c,{key:S.id,x:w,y:N,width:S.width,height:S.height,style:S.style,selected:S.selected,className:g(S),color:p(S),borderRadius:i,strokeColor:y(S),strokeWidth:l,shapeRendering:v,onClick:f,id:S.id})}))}var $8=u.memo(z8);const F8=200,B8=150,U8=e=>{const t=e.getNodes(),r={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:r,boundingRect:t.length>0?Q7(_f(t,e.nodeOrigin),r):r,rfId:e.rfId}},q8="react-flow__minimap-desc";function oj({style:e,className:t,nodeStrokeColor:r="transparent",nodeColor:i="#e2e2e2",nodeClassName:l="",nodeBorderRadius:c=5,nodeStrokeWidth:f=2,nodeComponent:m,maskColor:h="rgb(240, 240, 240, 0.6)",maskStrokeColor:p="none",maskStrokeWidth:y=1,position:g="bottom-right",onClick:v,onNodeClick:S,pannable:w=!1,zoomable:N=!1,ariaLabel:j="React Flow mini map",inversePan:_=!1,zoomStep:C=10,offsetScale:O=5}){const E=na(),T=u.useRef(null),{boundingRect:M,viewBB:A,rfId:z}=In(U8,sa),P=e?.width??F8,X=e?.height??B8,H=M.width/P,Y=M.height/X,V=Math.max(H,Y),I=V*P,F=V*X,D=O*V,L=M.x-(I-M.width)/2-D,B=M.y-(F-M.height)/2-D,k=I+D*2,U=F+D*2,R=`${q8}-${z}`,q=u.useRef(0);q.current=V,u.useEffect(()=>{if(T.current){const ie=ss(T.current),Z=ue=>{const{transform:ne,d3Selection:we,d3Zoom:Pe}=E.getState();if(ue.sourceEvent.type!=="wheel"||!we||!Pe)return;const Re=-ue.sourceEvent.deltaY*(ue.sourceEvent.deltaMode===1?.05:ue.sourceEvent.deltaMode?1:.002)*C,Ce=ne[2]*Math.pow(2,Re);Pe.scaleTo(we,Ce)},me=ue=>{const{transform:ne,d3Selection:we,d3Zoom:Pe,translateExtent:Re,width:Ce,height:it}=E.getState();if(ue.sourceEvent.type!=="mousemove"||!we||!Pe)return;const qe=q.current*Math.max(1,ne[2])*(_?-1:1),We={x:ne[0]-ue.sourceEvent.movementX*qe,y:ne[1]-ue.sourceEvent.movementY*qe},ke=[[0,0],[Ce,it]],xt=sr.translate(We.x,We.y).scale(ne[2]),Mt=Pe.constrain()(xt,ke,Re);Pe.transform(we,Mt)},Q=hE().on("zoom",w?me:null).on("zoom.wheel",N?Z:null);return ie.call(Q),()=>{ie.on("zoom",null)}}},[w,N,_,C]);const G=v?ie=>{const Z=ms(ie);v(ie,{x:Z[0],y:Z[1]})}:void 0,J=S?(ie,Z)=>{const me=E.getState().nodeInternals.get(Z);S(ie,me)}:void 0;return De.createElement(mg,{position:g,style:e,className:ma(["react-flow__minimap",t]),"data-testid":"rf__minimap"},De.createElement("svg",{width:P,height:X,viewBox:`${L} ${B} ${k} ${U}`,role:"img","aria-labelledby":R,ref:T,onClick:G},j&&De.createElement("title",{id:R},j),De.createElement($8,{onClick:J,nodeColor:i,nodeStrokeColor:r,nodeBorderRadius:c,nodeClassName:l,nodeStrokeWidth:f,nodeComponent:m}),De.createElement("path",{className:"react-flow__minimap-mask",d:`M${L-D},${B-D}h${k+D*2}v${U+D*2}h${-k-D*2}z
        M${A.x},${A.y}h${A.width}v${A.height}h${-A.width}z`,fill:h,fillRule:"evenodd",stroke:p,strokeWidth:y,pointerEvents:"none"})))}oj.displayName="MiniMap";var H8=u.memo(oj);function P8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},De.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function V8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},De.createElement("path",{d:"M0 0h32v4.2H0z"}))}function Y8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},De.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function G8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},De.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function X8(){return De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},De.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const Jo=({children:e,className:t,...r})=>De.createElement("button",{type:"button",className:ma(["react-flow__controls-button",t]),...r},e);Jo.displayName="ControlButton";const K8=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),cj=({style:e,showZoom:t=!0,showFitView:r=!0,showInteractive:i=!0,fitViewOptions:l,onZoomIn:c,onZoomOut:f,onFitView:m,onInteractiveChange:h,className:p,children:y,position:g="bottom-left"})=>{const v=na(),[S,w]=u.useState(!1),{isInteractive:N,minZoomReached:j,maxZoomReached:_}=In(K8,sa),{zoomIn:C,zoomOut:O,fitView:E}=wg();if(u.useEffect(()=>{w(!0)},[]),!S)return null;const T=()=>{C(),c?.()},M=()=>{O(),f?.()},A=()=>{E(l),m?.()},z=()=>{v.setState({nodesDraggable:!N,nodesConnectable:!N,elementsSelectable:!N}),h?.(!N)};return De.createElement(mg,{className:ma(["react-flow__controls",p]),position:g,style:e,"data-testid":"rf__controls"},t&&De.createElement(De.Fragment,null,De.createElement(Jo,{onClick:T,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:_},De.createElement(P8,null)),De.createElement(Jo,{onClick:M,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:j},De.createElement(V8,null))),r&&De.createElement(Jo,{className:"react-flow__controls-fitview",onClick:A,title:"fit view","aria-label":"fit view"},De.createElement(Y8,null)),i&&De.createElement(Jo,{className:"react-flow__controls-interactive",onClick:z,title:"toggle interactivity","aria-label":"toggle interactivity"},N?De.createElement(X8,null):De.createElement(G8,null)),y)};cj.displayName="Controls";var W8=u.memo(cj),ys;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(ys||(ys={}));function Z8({color:e,dimensions:t,lineWidth:r}){return De.createElement("path",{stroke:e,strokeWidth:r,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`})}function Q8({color:e,radius:t}){return De.createElement("circle",{cx:t,cy:t,r:t,fill:e})}const J8={[ys.Dots]:"#91919a",[ys.Lines]:"#eee",[ys.Cross]:"#e2e2e2"},ez={[ys.Dots]:1,[ys.Lines]:1,[ys.Cross]:6},tz=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function uj({id:e,variant:t=ys.Dots,gap:r=20,size:i,lineWidth:l=1,offset:c=2,color:f,style:m,className:h}){const p=u.useRef(null),{transform:y,patternId:g}=In(tz,sa),v=f||J8[t],S=i||ez[t],w=t===ys.Dots,N=t===ys.Cross,j=Array.isArray(r)?r:[r,r],_=[j[0]*y[2]||1,j[1]*y[2]||1],C=S*y[2],O=N?[C,C]:_,E=w?[C/c,C/c]:[O[0]/c,O[1]/c];return De.createElement("svg",{className:ma(["react-flow__background",h]),style:{...m,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:p,"data-testid":"rf__background"},De.createElement("pattern",{id:g+e,x:y[0]%_[0],y:y[1]%_[1],width:_[0],height:_[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${E[0]},-${E[1]})`},w?De.createElement(Q8,{color:v,radius:C/c}):De.createElement(Z8,{dimensions:O,color:v,lineWidth:l})),De.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${g+e})`}))}uj.displayName="Background";var nz=u.memo(uj);const az=420,sz=520,rz=16,od=(e,t,r)=>Math.min(Math.max(e,t),r),Tw=e=>e?.type?.name||e?.typeName||"Entity";function iz({position:e,cluster:t,onClose:r,onAddToBoard:i,onReturnToGroup:l,onSetTargetEntity:c,onOpenEntityInfo:f,releasedEntityIds:m=[]}){const{label:h,relationshipType:p,entities:y=[],placedEntityIds:g=[],sourceId:v}=t||{},[S,w]=u.useState(null),[N,j]=u.useState(null),[_,C]=u.useState({x:e?.x??100,y:e?.y??100}),O=u.useRef(null),E=u.useRef(null),T=u.useCallback(()=>{const B=S?.parentElement;if(B){const k=B.getBoundingClientRect();return{left:k.left,top:k.top,width:k.width,height:k.height}}return{left:0,top:0,width:window.innerWidth,height:window.innerHeight}},[S]),M=u.useMemo(()=>new Set((Array.isArray(g)?g:[]).map(String)),[g]),A=u.useMemo(()=>new Set((Array.isArray(m)?m:[]).map(String)),[m]),z=u.useMemo(()=>Array.isArray(y)?y.filter(B=>!A.has(String(B.id))):[],[y,A]),P=z.length,X=u.useMemo(()=>{const B=T(),k=O.current?.offsetWidth??az,U=O.current?.offsetHeight??Math.min(B.height*.7,sz),R=rz;return{minX:R,minY:R,maxX:Math.max(R,B.width-k-R),maxY:Math.max(R,B.height-U-R),containerRect:B,entityCount:P}},[P,T]);u.useEffect(()=>{const B=document.querySelector(".react-flow__renderer")||document.querySelector(".react-flow")||document.body,k=document.createElement("div");return k.style.position=B===document.body?"fixed":"absolute",k.style.top="0",k.style.left="0",k.style.right="0",k.style.bottom="0",k.style.zIndex="2500",k.style.pointerEvents="auto",B.appendChild(k),w(k),()=>B.removeChild(k)},[]),u.useEffect(()=>{C({x:od(e?.x??100,X.minX,X.maxX),y:od(e?.y??100,X.minY,X.maxY)})},[X,e?.x,e?.y]);const H=u.useCallback(B=>{if(!E.current)return;const{offsetX:k,offsetY:U,bounds:R,containerRect:q}=E.current,G=od(B.clientX-q.left-k,R.minX,R.maxX),J=od(B.clientY-q.top-U,R.minY,R.maxY);C({x:G,y:J})},[]),Y=u.useCallback(()=>{E.current=null,window.removeEventListener("pointermove",H),window.removeEventListener("pointerup",Y),window.removeEventListener("pointercancel",Y)},[H]),V=B=>{if(B.button!==0||B.target.closest("button")||B.target.closest(".cluster-popup-entity"))return;B.preventDefault(),B.stopPropagation();const k=X,U=k.containerRect||T(),R=B.clientX-U.left-(_?.x??k.minX),q=B.clientY-U.top-(_?.y??k.minY);E.current={offsetX:R,offsetY:q,bounds:k,containerRect:U},window.addEventListener("pointermove",H),window.addEventListener("pointerup",Y),window.addEventListener("pointercancel",Y)};u.useEffect(()=>()=>Y(),[Y]);const I=u.useCallback(()=>{Y(),r?.()},[Y,r]);u.useEffect(()=>{const B=k=>k.key==="Escape"&&I();return document.addEventListener("keydown",B),()=>document.removeEventListener("keydown",B)},[I]),u.useEffect(()=>{j(null)},[t?.id]);const F=u.useCallback((B,k)=>{k||j(U=>U===B?null:B)},[]),D=u.useCallback(B=>{B&&(A.has(String(B))||(i?.(t,B),j(null)))},[t,i,A]),L=u.useCallback(B=>{B&&(l?.(t,B),j(null))},[t,l]);return S?x1.createPortal(a.jsx("div",{className:"cluster-popup-overlay",children:a.jsxs("div",{ref:O,className:"cluster-popup-panel",style:{top:`${_?.y??100}px`,left:`${_?.x??100}px`},children:[a.jsxs("div",{className:"cluster-popup-header",onPointerDown:V,children:[a.jsxs("div",{className:"cluster-popup-title",children:[a.jsx("div",{className:"cluster-popup-relationship",children:p||"Cluster"}),a.jsx("div",{className:"cluster-popup-label",children:h||"Entities"})]}),a.jsx("button",{onClick:I,className:"cluster-popup-close","aria-label":"Close cluster",children:a.jsx("span",{"aria-hidden":"true",children:""})})]}),a.jsx("div",{className:"cluster-popup-instructions",children:"Use the action icons to set a relationship target, open entity details, or add and manage entities on the board."}),a.jsx("div",{className:"cluster-popup-entities",children:z.length?z.map(B=>{const k=String(B.id),U=M.has(k)||A.has(k),R=N===k,q=v!=null&&k===String(v);return a.jsxs("div",{className:`cluster-popup-entity ${U?"is-placed":""} ${R?"is-selected":""}`,title:B.name||`Entity ${B.id}`,onClick:()=>F(k,U),children:[a.jsx("div",{className:"cluster-popup-entity-header",children:a.jsx("div",{className:"cluster-popup-entity-name",children:B.name||`Entity ${B.id}`})}),a.jsx("div",{className:"cluster-popup-entity-meta",title:Tw(B),children:Tw(B)}),a.jsxs("div",{className:"cluster-popup-entity-actions",role:"group","aria-label":"Entity actions",children:[U?a.jsx("button",{type:"button",className:"cluster-popup-entity-action",onClick:G=>{G.stopPropagation(),L(B)},onPointerDown:G=>G.stopPropagation(),"aria-label":"Recall entity to cluster",title:"Recall to cluster",disabled:!l,children:a.jsx(zl,{size:16,"aria-hidden":"true"})}):a.jsx("button",{type:"button",className:"cluster-popup-entity-action is-primary",onClick:G=>{G.stopPropagation(),D(k)},onPointerDown:G=>G.stopPropagation(),"aria-label":"Add entity to board",title:"Add to board",disabled:!i,children:a.jsx(Pa,{size:16,"aria-hidden":"true"})}),a.jsx("button",{type:"button",className:"cluster-popup-entity-action",onClick:G=>{G.stopPropagation(),f?.(k)},onPointerDown:G=>G.stopPropagation(),"aria-label":"Open entity details",title:"Open details",disabled:!f,children:a.jsx(E1,{size:16,"aria-hidden":"true"})}),!q&&a.jsx("button",{type:"button",className:"cluster-popup-entity-action",onClick:G=>{G.stopPropagation(),c?.(k)},onPointerDown:G=>G.stopPropagation(),"aria-label":"Use as relationship source",title:"Set as source",disabled:!c,children:a.jsx(By,{size:16,"aria-hidden":"true"})})]})]},B.id)}):a.jsx("div",{className:"cluster-popup-empty",children:"No entities in this cluster."})})]})}),S):null}function lz({id:e,data:t}){const[r,i]=u.useState(!1),[l,c]=u.useState({x:0,y:0}),[f,m]=u.useState([]);u.useEffect(()=>{const j=t?.containedIds||t?.data?.containedIds||[],_=t?.allNodes||t?.data?.allNodes||[];if(j.length&&_.length){const C=_.filter(O=>j.includes(O.id));m(C)}else m([])},[t]);const h=j=>{j.stopPropagation();const C=(document.querySelector(".react-flow__renderer")||document.querySelector(".react-flow"))?.getBoundingClientRect(),O=C?.width??window.innerWidth,E=C?.height??window.innerHeight,T=420,M=Math.min(E*.7,520),A=16,z=j.clientX-(C?.left??0),P=j.clientY-(C?.top??0);let X=z+A,H=P-M/2;const Y=O-T-A,V=A;X>Y&&(X=Math.max(V,z-T-A)),X=Math.max(V,Math.min(X,Y));const I=E-M-A,F=A;H<F?H=F:H>I&&(H=I),c({x:X,y:H}),i(!0)},p=()=>i(!1),y=u.useMemo(()=>new Set((t?.placedEntityIds||[]).map(j=>String(j))),[t?.placedEntityIds]),g=f.length,v=t?.count??g+y.size,S=g,w=v?`contains ${S} of ${v}`:"contains 0 of 0",N=t?.relationshipType||t?.label||"Cluster";return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"cluster-node",onClick:h,children:[a.jsx(Xr,{id:"top",type:"target",position:Bt.Top,style:{width:12,height:12,background:"#fcd34d",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(120, 53, 15, 0.2)"}}),a.jsx("div",{className:"cluster-node__header",children:a.jsx("div",{className:"cluster-node__badge",children:S})}),a.jsx("div",{className:"cluster-node__label",children:N}),a.jsx("div",{className:"cluster-node__count",children:w}),a.jsx(Xr,{id:"bottom",type:"source",position:Bt.Bottom,style:{width:12,height:12,background:"#fcd34d",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(120, 53, 15, 0.2)"}})]}),r&&a.jsx(iz,{position:l,cluster:{id:e,label:t?.label,entities:f,relationshipType:t?.relationshipType,sourceId:t?.sourceId,placedEntityIds:t?.placedEntityIds||[]},onClose:p,onAddToBoard:t?.onAddToBoard,onReturnToGroup:t?.onReturnToGroup,onSetTargetEntity:t?.onSetTargetEntity,onOpenEntityInfo:t?.onOpenEntityInfo,releasedEntityIds:t?.manuallyReleasedIds||[]})]})}function oz({data:e}){const t=!!e?.isCenter,r=e?.label||"Entity",i=e?.typeName||"Entity",l=e?.style||{},c=e?.entityId||e?.id,f=e?.imageUrl||Bl(e?.entity),m=p=>{p?.preventDefault(),p?.stopPropagation(),!(!e?.onSetTarget||!c||t)&&e.onSetTarget(String(c))},h=p=>{p?.preventDefault(),p?.stopPropagation(),!(!e?.onOpenInfo||!c)&&e.onOpenInfo(String(c))};return a.jsxs("div",{className:`entity-node ${t?"entity-node--center":"entity-node--standard"}`,style:{...l},children:[a.jsx(Xr,{id:"top",type:"target",position:Bt.Top,style:{width:12,height:12,background:"#cbd5f5",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(15, 23, 42, 0.25)"}}),t&&a.jsx("span",{className:"entity-node__center-indicator"}),a.jsxs("div",{className:"entity-node__content",children:[a.jsxs("div",{className:"entity-node__row entity-node__row--title",children:[f?a.jsx("div",{className:"entity-node__avatar","aria-hidden":"true",children:a.jsx("img",{src:f,alt:"",loading:"lazy"})}):null,a.jsx("div",{className:"entity-node__label",title:r,children:r})]}),a.jsxs("div",{className:"entity-node__row entity-node__row--meta",children:[a.jsx("div",{className:`entity-node__type-pill ${t?"is-center":""}`,children:i}),a.jsxs("div",{className:"entity-node__actions","aria-hidden":!e?.onSetTarget&&!e?.onOpenInfo,children:[a.jsx("button",{type:"button",className:"entity-node__action",onClick:m,onPointerDown:p=>p.stopPropagation(),"aria-label":"Use as relationship source",disabled:t||!e?.onSetTarget,children:a.jsx(By,{size:16,strokeWidth:2.25,absoluteStrokeWidth:!0,"aria-hidden":"true"})}),a.jsx("button",{type:"button",className:"entity-node__action",onClick:h,onPointerDown:p=>p.stopPropagation(),"aria-label":"Open entity in new window",disabled:!e?.onOpenInfo,children:a.jsx(Fy,{size:16,strokeWidth:2.25,absoluteStrokeWidth:!0,"aria-hidden":"true"})})]})]})]}),a.jsx(Xr,{id:"bottom",type:"source",position:Bt.Bottom,style:{width:12,height:12,background:"#cbd5f5",border:"1px solid #fff",borderRadius:"999px",boxShadow:"0 1px 2px rgba(15, 23, 42, 0.25)"}})]})}const Rc=220,Cf=160,Kr=220,wc=120,Eg=40,dj=5,ta="Related",cz=40,uz=120,Tp=Math.max(Kr,Rc)+cz,fj=wc+uz,Yd=Kr+Eg,dz=Kr+40,vy=/(part of|owned by|managed by|works for|reports to|child of|belongs to|member of|subsidiary of|division of|child)/i,Mw=/(owns|manages|contains|has member|employs|parent of|parent|oversees|supervises|leads)/i,mj=/(owns|contains|parent|manages|supervises|leads|employs|has member|has child)/i,fz=/(child of|belongs to|part of|owned by|managed by|reports to|works for)/i,mz=/\s*\(linked to source\)/gi;function va(e,t){if(typeof e=="string"){const r=e.replace(mz,"").trim();if(r)return r}return t}function Tl(e){if(!e)return!1;const t=e?.type;return t==="cluster"||t==="clusterNode"}function hz(e){if(!e)return{width:Kr,height:wc};const t=Number(e?.width),r=Number(e?.height),i=Number.isFinite(t)?t:Tl(e)?Rc:Kr,l=Number.isFinite(r)?r:Tl(e)?Cf:wc;return{width:i,height:l}}function pz(e,t,r){if(!e||!t||!(r instanceof Map))return!1;let i=String(t);const l=String(e),c=new Set;for(;i&&!c.has(i);){if(c.add(i),i===l)return!0;const f=r.get(i)?.parentId;i=f!=null?String(f):null}return!1}function Rw(e){if(!e)return null;const t=String(e.id??"");if(!t)return null;const r=va(e?.name,`Entity ${t}`),i=e?.type?.name||e?.typeName||"Entity";return{...e,id:t,name:r,typeName:i}}function yz(e,t){if(!e)return{parentId:null,childId:null};const r=e?.fromEntityId!=null?String(e.fromEntityId):null,i=e?.toEntityId!=null?String(e.toEntityId):null,l=e?.relationshipType;let c=r&&i?r:null,f=r&&i?i:null;const m=l&&typeof l=="object"?l:null,h=(...C)=>{for(const O of C)if(O!=null&&O!=="")return O;return null},p=h(m?.from_label,m?.fromLabel,m?.from_name,m?.fromName),y=h(m?.to_label,m?.toLabel,m?.to_name,m?.toName),g=C=>typeof C=="string"&&vy.test(C),v=C=>typeof C=="string"&&Mw.test(C),S=g(p),w=g(y),N=v(p),j=v(y);w&&!S?(c=i,f=r):S&&!w?(c=r,f=i):N&&!j?(c=i,f=r):j&&!N&&(c=r,f=i);const _=(()=>{if(!l)return"";if(typeof l=="string")return l.toLowerCase();const C=l?.label||l?.name||l?.from_label||l?.to_label||"";return String(C).toLowerCase()})();if(r&&i&&_){const C=/(parent|owns|contains)/.test(_);if(/(child|belongs to|part of)/.test(_)&&!C){const E=c;c=f,f=E}}return!c&&!f&&r&&i&&_&&(vy.test(_)?(c=i,f=r):Mw.test(_)&&(c=r,f=i)),{parentId:c,childId:f}}function hj(e,t){if(!e)return null;const r=e?.from_entity??e?.fromEntityId??e?.from??e?.source??e?.sourceId??null,i=e?.to_entity??e?.toEntityId??e?.to??e?.target??e?.targetId??null,l=r!=null?String(r):null,c=i!=null?String(i):null;if(!l||!c||l===c)return null;const f=e?.id!=null&&e.id!==""?String(e.id):`edge-${l}-${c}`,m=e?.relationshipType??e?.type??e?.data?.relationshipType??null,h={fromEntityId:l,toEntityId:c,relationshipType:m},{parentId:p,childId:y}=yz(h),g=m&&typeof m=="object"?{id:m?.id??null,name:m?.name||m?.label||m?.from_label||m?.to_label||null,label:m?.label??null,from_label:m?.from_label??null,to_label:m?.to_label??null}:m,v=(()=>{if(!g)return e?.label||e?.typeName||e?.data?.typeName||ta;if(typeof g=="string")return g||ta;const{from_label:j,to_label:_,label:C,name:O}=g;return t!=null&&String(t)===l?j||C||O||ta:t!=null&&String(t)===c?_||C||O||ta:C||O||j||_||ta})(),S=String(v||ta).trim()||ta,w=!g||typeof g=="string"?(typeof g=="string"?g:null)||ta:g?.name||g?.label||g?.from_label||g?.to_label||ta,N=g&&typeof g=="object"?g?.id??null:null;return{id:f,source:p??l,target:y??c,parentId:p,childId:y,label:S,typeName:w??ta,typeId:N??null,fromEntityId:l,toEntityId:c,relationshipType:g??null,relationshipLabel:S,raw:e}}function gz(e,t,r=dj,i=null,l=1){const c=[],f=new Map,m=[],h=new Set,p=i!=null?String(i):null;if(!Array.isArray(t)||!t.length)return{clusters:c,suppressedNodes:f,edges:t||[]};const y=new Map((Array.isArray(e)?e:[]).map(E=>[String(E?.id??""),E])),g=new Map;p&&g.set(p,0),y.forEach((E,T)=>{const M=typeof E?.data?.level=="number"?E.data.level:typeof E?.level=="number"?E.level:null;M!=null&&Number.isFinite(M)&&g.set(T,M)});const v=new Map,S=new Map;t.forEach(E=>{if(!E)return;const T=E.parentId||E.source||null,M=E.childId||E.target||null;if(!T||!M)return;const A=String(T),z=String(M),P=y.get(A)||e.find(H=>String(H?.id??"")===A);!P||P.inCluster||(y.get(z)||e.find(H=>String(H?.id??"")===z))?.inCluster||(v.has(A)||v.set(A,new Set),v.get(A).add(z),S.has(z)||S.set(z,new Set),S.get(z).add(A))});const w=new Map;if(p){w.set(p,{parentId:null});const E=new Set,T=[p];for(;T.length;){const M=T.pop();if(!M||E.has(M))continue;E.add(M),w.has(M)||w.set(M,{parentId:null});const A=S.get(M);if(A&&A.size){const[z]=Array.from(A),P=z!=null?String(z):null;if(P){const X=w.get(M)||{};X.parentId?w.set(M,{...X}):w.set(M,{...X,parentId:P}),A.forEach(H=>{const Y=H!=null?String(H):null;Y&&(w.has(Y)||w.set(Y,{parentId:null}),E.has(Y)||T.push(Y))})}}}}const N=new Set(g.keys());if(p){N.add(p);const E=S.get(p);E&&E.forEach(T=>{g.has(T)||g.set(T,0),N.add(T)})}const j=Array.from(N);for(;j.length;){const E=j.shift();if(!E)continue;const T=g.get(E);if(T==null||!Number.isFinite(T))continue;const M=v.get(E);M&&M.forEach(A=>{const z=T+1,P=g.get(A);(P==null||z<P)&&(g.set(A,z),j.push(A))})}const _=new Map;if(t.forEach(E=>{if(!E)return;const T=E.parentId||E.source||null,M=E.childId||E.target||null;if(!T||!M)return;const A=String(T),z=String(M);if(!A||!z||A===z)return;const P=y.get(A),X=y.get(z);if(P?.inCluster||X?.inCluster)return;const H=g.get(A)??0,Y=g.get(z)??H+1;if(H>=l||Y>l)return;const V=String(E.relationshipLabel||E.label||ta).trim()||ta,I=E.typeName&&String(E.typeName).trim()||(typeof E.relationshipType=="object"?String(E.relationshipType?.name||E.relationshipType?.label||E.relationshipType?.from_label||E.relationshipType?.to_label||"").trim():null)||null,F=E.typeId!=null?String(E.typeId):E.relationshipType&&typeof E.relationshipType=="object"&&E.relationshipType?.id!=null?String(E.relationshipType.id):null,D=I||F||"unknown-type",L=`${A}-${D}`;_.has(L)||_.set(L,{parentId:A,typeName:I,typeId:F,typeKey:D,relationshipLabel:V,childMap:new Map});const B=_.get(L);B.childMap.has(z)||B.childMap.set(z,[]),B.childMap.get(z).push(E)}),_.forEach(E=>{if(y.get(E.parentId)?.inCluster||e.find(F=>String(F?.id??"")===E.parentId)?.inCluster)return;const M=Array.from(E.childMap.keys()).filter(F=>!y.get(F)?.inCluster);if(M.length<r)return;const A=Az(E.typeName||E.typeKey),z=`cluster-${E.parentId}-${A}`,P=g.get(E.parentId)??0,X=E.typeName||E.relationshipLabel||ta,H=M.filter(F=>!y.get(F)?.inCluster);if(!H.length)return;const Y={id:z,parentId:E.parentId,relationshipType:X,typeName:E.typeName,typeId:E.typeId,containedIds:[...H],label:"",count:0,parentLevel:P},V=p&&Y.containedIds.length?Y.containedIds.filter(F=>pz(F,p,w)):[],I=new Set(V);V.length&&(Y.containedIds=Y.containedIds.filter(F=>!I.has(F)),V.forEach(F=>{const D=y.get(F)||null;D&&(D.isExpandedProtected=!0,D.inCluster&&(D.inCluster=!1));const L=e.find(B=>String(B?.id??"")===F);L&&L!==D&&(L.isExpandedProtected=!0,L.inCluster&&(L.inCluster=!1))})),Y.containedIds.length&&(Y.containedIds.forEach(F=>{const D=e.find(L=>String(L?.id??"")===F)||y.get(F);D&&(D.inCluster=!0)}),Y.count=Y.containedIds.length,Y.label=`${X} (${Y.count})`,c.push(Y),H.forEach(F=>{if(I.has(F))return;const D=y.get(F)||e.find(B=>String(B?.id??"")===F)||null;if(D?.isExpandedProtected){D.inCluster=!1;return}f.set(F,{clusterId:Y.id,parentId:E.parentId,relationshipType:X,typeName:E.typeName,typeId:E.typeId,entity:D}),D&&(D.inCluster=!0),(E.childMap.get(F)||[]).forEach(B=>h.add(B.id))}),m.push({id:`edge-${E.parentId}-${Y.id}`,source:E.parentId,target:Y.id,label:Y.label,parentId:E.parentId,childId:Y.id,relationshipLabel:X,relationshipType:X,typeName:E.typeName,typeId:E.typeId,isClusterEdge:!0}))}),!c.length)return{clusters:c,suppressedNodes:f,edges:t};const O=[...t.filter(E=>{if(!E||h.has(E.id))return!1;const T=String(E.target??E.childId??"");if(T&&f.has(T))return!1;const M=String(E.source??E.parentId??"");return!(M&&f.has(M))}),...m];return{clusters:c,suppressedNodes:f,edges:O}}function bz(e,{isCenter:t=!1}={}){const r=String(e.id),i=va(e?.name,`Entity ${r}`),l=e?.typeName||"Entity",c=!!e?.isExpandedProtected,f=Bl(e);return{id:r,type:"entity",width:Kr,height:wc,isExpandedProtected:c,position:{x:0,y:0},data:{label:i,typeName:l,entityId:r,isCenter:t,isExpandedProtected:c,imageUrl:f}}}function vz(e,t){const r=e.relationshipType||ta,i=e.label||r,l=e.count??(Array.isArray(e.containedIds)?e.containedIds.length:0),c=typeof e.parentLevel=="number"&&Number.isFinite(e.parentLevel)?e.parentLevel:null;return{id:e.id,type:"cluster",width:Rc,height:Cf,position:{x:0,y:0},data:{label:i,relationshipType:r,containedIds:e.containedIds,count:l,sourceId:e.parentId,placedEntityIds:[],allNodes:t,parentLevel:c}}}function xz(e,t,r){const i=r!=null?String(r):null;t.forEach(l=>{if(!l)return;const c=String(l.id);e.has(c)||e.set(c,c===i?0:1)}),i&&e.set(i,0),e.forEach((l,c)=>{(typeof l!="number"||!Number.isFinite(l))&&e.set(c,c===i?0:1)})}function Sz(e,t){let r=1/0;t.forEach(m=>{if(!m)return;const h=e.get(m.id);typeof h=="number"&&Number.isFinite(h)&&h<r&&(r=h)}),Number.isFinite(r)||(r=0);const i=new Map,l=new Map;t.forEach(m=>{if(!m)return;const p=(e.get(m.id)??0)-r;l.set(m.id,p),i.has(p)||i.set(p,[]),i.get(p).push(m)});const c=Array.from(i.keys()).sort((m,h)=>m-h),f=new Map;return c.forEach(m=>{const h=i.get(m)||[];h.sort((p,y)=>{const g=p?.data?.label||p.id,v=y?.data?.label||y.id;return g.localeCompare(v)}),f.set(m,h)}),{groups:f,visualLevels:l}}function xy(e){if(!e)return"";const t=typeof e?.data?.label=="string"?e.data.label.trim():"";if(t)return t;const r=typeof e?.name=="string"?e.name.trim():"";return r||(e?.id!=null?String(e.id):"")}function pj(e,t){const r=xy(e),i=xy(t);return r.localeCompare(i)}function wz(e,t,r,i={}){const{centerId:l=null}=i,c=l!=null?String(l):null,f=new Map;e.forEach(h=>{if(!h)return;const p=h?.parentId??h?.data?.parentId??h?.source??h?.data?.source??null,y=h?.childId??h?.data?.childId??h?.target??h?.data?.target??null,g=p!=null?String(p):null,v=y!=null?String(y):null;if(!g||!v||g===v)return;const S=yj(h),w=_z(h),N=Si(S)||Si(w),j=!!S&&(jz(S)||mj.test(S)),_={parentId:g,relationshipKey:N,relationshipName:w,indicatesParental:j};f.has(v)||f.set(v,[]),f.get(v).push(_)});const m=new Map;return f.forEach((h,p)=>{let y=null,g=1/0,v="",S=null,w="",N="";h.forEach(j=>{if(!j)return;const _=j.parentId,C=t.get(_);if(typeof C!="number"||!Number.isFinite(C))return;const O=r.get(_),E=xy(O);if(y==null||C<g){y=_,g=C,v=E,S=j,w=Si(j?.relationshipKey),N=j?.relationshipName??"";return}if(C===g){const T=!!S?.indicatesParental;if(!!j?.indicatesParental&&!T){y=_,v=E,S=j,w=Si(j?.relationshipKey),N=j?.relationshipName??"";return}E.localeCompare(v)<0&&(y=_,v=E,S=j,w=Si(j?.relationshipKey),N=j?.relationshipName??"")}}),y!=null&&m.set(p,{parentId:y,relationshipKey:w,relationshipName:N,indicatesParental:!!S?.indicatesParental})}),r.forEach((h,p)=>{if(!h)return;const y=String(p);if(!y||m.has(y)||!Tl(h))return;const g=[h.parentId,h.data?.parentId,h.data?.sourceId,h.data?.source].map(w=>w!=null?String(w):null).filter(Boolean);let v=g.find(w=>r.has(w));!v&&g.length&&(v=g[0]);const S=t.get(y)??1/0;if(!v){const w=Array.isArray(h?.data?.containedIds)?h.data.containedIds.map(N=>N!=null?String(N):null).filter(N=>{if(!N||!r.has(N))return!1;const j=t.get(N);return typeof j=="number"&&Number.isFinite(j)&&j<S}):[];w.length&&(w.sort((N,j)=>{const _=t.get(N)??1/0,C=t.get(j)??1/0;return _===C?N.localeCompare(j):_-C}),v=w[0])}if(!v&&c&&r.has(c)&&(v=c===y?null:c),v){const w=[typeof h?.data?.relationshipType=="string"?h.data.relationshipType:null,typeof h?.relationshipType=="string"?h.relationshipType:null].filter(_=>typeof _=="string"&&_.trim()),N=w.length?w[0].trim():"",j=Si(N);m.set(y,{parentId:v,relationshipKey:j,relationshipName:N})}}),m}function Sy(e,t){if(!e||!t)return null;const r=e.get(t);return r?typeof r=="string"?{parentId:r,relationshipKey:"",relationshipName:""}:typeof r=="object"?{parentId:r?.parentId!=null?String(r.parentId):r?.sourceId!=null?String(r.sourceId):null,relationshipKey:Si(r?.relationshipKey),relationshipName:typeof r?.relationshipName=="string"?r.relationshipName:""}:null:null}function Nz(e){return(t,r)=>{if(!t&&!r)return 0;if(!t)return 1;if(!r)return-1;const i=Sy(e,t.id),l=Sy(e,r.id),c=i?.relationshipKey||"",f=l?.relationshipKey||"";if(c&&f){const m=c.localeCompare(f);if(m!==0)return m}else{if(c)return-1;if(f)return 1}return pj(t,r)}}function Ez(e,t=new Map){const r=new Map;let i=1/0;const l=0,c=Array.from(e.keys()).sort((y,g)=>y-g);c.forEach(y=>{const g=e.get(y)||[];if(!g.length)return;const v=new Map,S=[],w=new Set;g.forEach(E=>{const M=Sy(t,E.id)?.parentId??null,A=M?r.get(M):null;if(M&&A){v.has(M)||v.set(M,[]),v.get(M).push(E);return}S.push(E)});const N=[],j=Nz(t);if(v.forEach((E,T)=>{const M=r.get(T);if(!M){E.forEach(z=>S.push(z));return}const A=[...E].sort(j);N.push({anchorX:M.x,nodes:A,parentId:T})}),S.length){const E=[...S].sort(pj);N.push({anchorX:null,nodes:E,parentId:null})}N.sort((E,T)=>E.anchorX!=null&&T.anchorX!=null?E.anchorX-T.anchorX:E.anchorX!=null?-1:T.anchorX!=null?1:0);let _=!1,C=-1/0,O=0;N.forEach(E=>{const T=(E.nodes.length-1)*Tp;let M;E.anchorX!=null?M=E.anchorX-T/2:M=_&&Number.isFinite(C)?C+Tp:-T/2;const A=l+y*fj,z=[];if(E.nodes.forEach((P,X)=>{const H=Tp;let Y=M+X*H;E.anchorX==null&&_&&Number.isFinite(C)&&Y<=C&&(Y=C+H);let V=0,I=`${Math.round(Y*100)}`;for(;w.has(I)&&V<100;)Y+=H,V+=1,I=`${Math.round(Y*100)}`;w.add(I),z.push(Y),r.set(P.id,{x:Y,y:A,level:y,levelIndex:O}),O+=1,Y<i&&(i=Y),Y>C&&(C=Y)}),z.length){const P=Math.max(...z);P>C&&(C=P)}_=!0})});const f=[];c.forEach(y=>{(e.get(y)||[]).forEach(v=>{if(!v)return;const S=v?.id!=null?String(v.id):null;S&&r.has(S)&&f.push({id:S,node:v})})});const m=[];f.forEach(({id:y,node:g})=>{const v=r.get(y);if(!v)return;const{width:S,height:w}=hz(g),N=v.level??null,j={width:S,height:w,level:N,position:{...v}};!!(g?.data&&g.data.isUserPlaced||g?.isUserPlaced)||m.forEach(C=>{if(!(j.level!=null&&C.level!=null&&j.level===C.level||Math.abs(j.position.y-C.position.y)<Math.max(j.height,C.height,wc)))return;const E=C.position.x+C.width,T=Math.max(C.position.x+dz,E+40);j.position.x<T&&(j.position.x=T)}),r.set(y,{...v,x:j.position.x}),m.push({id:y,width:j.width,height:j.height,level:j.level,position:{...j.position}})}),i=1/0,r.forEach(y=>{y.x<i&&(i=y.x)});const h=Number.isFinite(i)&&i<0?-i:0,p=new Map;return r.forEach((y,g)=>{p.set(g,{x:y.x+h,y:y.y,level:y.level,levelIndex:y.levelIndex})}),p}function jz(e){return e?vy.test(String(e)):!1}function yj(e){if(!e)return"";const t=e?.data?.relationshipType??e?.relationshipType??e?.label??e?.relationshipLabel??"";if(typeof t=="string")return t.toLowerCase();if(t&&typeof t=="object"){const r=t?.label??t?.name??t?.from_label??t?.to_label??"";if(typeof r=="string")return r.toLowerCase()}return""}function _z(e){if(!e)return"";const t=e?.data?.relationshipType??e?.relationshipType??e?.label??e?.relationshipLabel??"";if(typeof t=="string")return t.trim();if(t&&typeof t=="object"){const r=t?.label??t?.name??t?.from_label??t?.to_label??"";if(typeof r=="string")return r.trim()}return""}function Si(e){if(typeof e=="string"){const t=e.trim();return t?t.toLowerCase():""}return""}function Cz(e,t){const r=new Map;if(!e)return r;const i=String(e);r.set(i,0);const l=new Map,c=new Map;t.forEach(m=>{if(!m)return;const h=m?.parentId??m?.data?.parentId??m?.source??null,p=m?.childId??m?.data?.childId??m?.target??null,y=h!=null?String(h):null,g=p!=null?String(p):null;!y||!g||y===g||(l.has(y)||l.set(y,new Set),l.get(y).add(g),c.has(g)||c.set(g,new Set),c.get(g).add(y))});const f=[i];for(;f.length;){const m=f.shift();if(!m)continue;const h=r.get(m)??0,p=c.get(m);p&&p.forEach(g=>{const v=g!=null?String(g):null;if(!v)return;const S=h-1,w=r.get(v);(w==null||S<w)&&(r.set(v,S),f.push(v))});const y=l.get(m);y&&y.forEach(g=>{const v=g!=null?String(g):null;if(!v)return;const S=h+1,w=r.get(v);(w==null||S<w)&&(r.set(v,S),f.push(v))})}return r}function ec(e,t,r){const i=Array.isArray(e)?e.map(E=>({...E,id:String(E.id),data:{...E.data}})):[];if(!i.length)return e;const l=i.filter(E=>Tl(E)),c=i.filter(E=>!Tl(E)),f=c.filter(E=>!E.inCluster),m=f.length?f:c,h=new Map;m.forEach(E=>h.set(E.id,E)),l.forEach(E=>h.set(E.id,E));const p=Array.from(h.values());if(!p.length)return e;const y=r!=null?String(r):p[0]?.id??null;if(!y)return e;const g=new Set(p.map(E=>E.id)),S=(Array.isArray(t)?t.map((E,T)=>{if(!E)return null;const M=E?.source!=null?String(E.source):"",A=E?.target!=null?String(E.target):"";if(!M||!A||M===A)return null;const z=E?.data?.relationshipType||E?.data?.typeName||E?.label||"",P=E?.data?.parentId??E?.parentId??E?.data?.parent??null,X=E?.data?.childId??E?.childId??null,H=P!=null?String(P):null,Y=X!=null?String(X):null;return{id:E?.id!=null?String(E.id):`edge-${T}`,source:M,target:A,label:E?.label||z||ta,data:{relationshipType:z||ta,parentId:H,childId:Y},parentId:H,childId:Y}}).filter(Boolean):[]).map(E=>{if(!E)return null;const T={...E,data:{...E.data||{}}},M=T.source||"",A=T.target||"";if(!M||!A||M===A)return null;let z=T.parentId!=null?String(T.parentId):null,P=T.childId!=null?String(T.childId):null;if(!z||!P){let X=M,H=A;const Y=yj(T),V=Y&&mj.test(Y);if(Y&&fz.test(Y)&&!V){const F=X;X=H,H=F}z=z??X,P=P??H}return(!z||!P||z===P)&&(z=M,P=A),T.source=z,T.target=P,T.parentId=z,T.childId=P,T.data={...T.data,parentId:z,childId:P},T}).filter(Boolean).filter(E=>g.has(E.source)&&g.has(E.target)),w=Cz(y,S);xz(w,p,y),p.forEach(E=>{if(!E||!Tl(E))return;const T=E.parentId??E.data?.parentId??E.data?.sourceId??E.data?.source??null;if(!T)return;const M=String(T),A=w.get(M)??0;w.set(E.id,A+1)});const{groups:N,visualLevels:j}=Sz(w,p),_=new Map(p.map(E=>[E.id,E])),C=wz(S,w,_,{centerId:y}),O=Ez(N,C);return i.map(E=>{const T=w.get(E.id)??0,M=j.get(E.id)??T,A={x:E?.position?.x??0,y:M*fj,level:M,levelIndex:E?.data?.levelIndex??0},z=O.get(E.id)||A;return{...E,position:{x:z.x,y:z.y},data:{...E.data,level:T,visualLevel:z.level??M,levelIndex:z.levelIndex}}})}function Az(e){return String(e??"group").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function Tz(e){return Array.from(e.values()).map(t=>({id:t.id,name:t.name,typeName:t.typeName,isExpandedProtected:!!t.isExpandedProtected}))}function Mz(e){const t=new Map;return Array.isArray(e)&&e.forEach(r=>{if(!r||r.isClusterEdge||r?.data?.isClusterEdge||r?.data?.isClusterChildEdge)return;const i=r?.parentId??r?.source??null,l=r?.childId??r?.target??null;if(i==null||l==null)return;const c=String(i),f=String(l);f&&(t.has(f)||t.set(f,new Set),t.get(f).add(c))}),t}function Rz({centerId:e=null,parentLookup:t=new Map,suppressedIds:r=new Set,candidateIds:i=new Set,alwaysIncludeIds:l=new Set}){const c=new Map,f=e!=null?String(e):null,m=new Set(l instanceof Set?Array.from(l).map(String):Array.isArray(l)?l.map(p=>String(p)):[]);function h(p,y=new Set){const g=String(p);if(!g)return!1;if(c.has(g))return c.get(g);if(r.has(g)||!i.has(g)&&!m.has(g))return c.set(g,!1),!1;if(f&&g===f||m.has(g))return c.set(g,!0),!0;const v=t.get(g);if(!v||v.size===0)return c.set(g,!0),!0;if(y.has(g))return c.set(g,!1),!1;y.add(g);let S=!1;for(const w of v){const N=String(w);if(N&&!r.has(N)){if(!i.has(N)&&!m.has(N)){S=!0;continue}if(m.has(N)){S=!0;continue}h(N,y)&&(S=!0)}}return y.delete(g),S?(c.set(g,!0),!0):(c.set(g,!1),!1)}return h}function kz(e,t,r=dj,i={}){const l=t!=null?String(t):null,c=Array.isArray(e?.nodes)?e.nodes:[],f=Array.isArray(e?.edges)?e.edges:[],m=new Map;if(c.forEach(Z=>{const me=Rw(Z);me&&m.set(me.id,me)}),!l)return{nodes:[],edges:[],suppressedNodes:new Map,clusters:[]};if(!m.has(l)){const Z=Rw(c[0]);Z?m.set(l,{...Z,id:l}):m.set(l,{id:l,name:`Entity ${l}`,typeName:"Entity"})}const h=f.map(Z=>hj(Z,l)).filter(Boolean),p=Array.from(m.values()),y=i?.alwaysIncludeIds,g=new Set(y instanceof Set?Array.from(y).map(String):Array.isArray(y)?y.map(Z=>String(Z)):y&&typeof y=="object"?Object.values(y).map(Z=>String(Z)):[]),{clusters:v,suppressedNodes:S,edges:w}=gz(p,h,r,l),N=Tz(m),j=S instanceof Map?S:new Map(Object.entries(S||{}).map(([Z,me])=>[String(Z),me])),_=new Map;j.forEach((Z,me)=>{const Q=String(me),ue=Z?.clusterId!=null?String(Z.clusterId):null,ne=Z?.parentId!=null?String(Z.parentId):null,we=Z?.relationshipType||ta,Pe=Z?.entity||m.get(Q)||null;_.set(Q,{clusterId:ue,parentId:ne,relationshipType:we,entity:Pe?{...Pe,id:Q,name:va(Pe?.name,`Entity ${Q}`),typeName:Pe?.typeName||Pe?.type?.name||"Entity",isExpandedProtected:!!Pe?.isExpandedProtected}:null})}),g.forEach(Z=>{_.delete(String(Z))});const C=new Set(Array.from(_.keys())),O=(Array.isArray(v)?v:[]).map(Z=>vz(Z,N)),T=p.map(Z=>bz(Z,{isCenter:Z.id===l})).filter(Z=>!C.has(String(Z.id))),M=new Set(T.map(Z=>String(Z.id)));l!=null&&M.add(String(l)),g.forEach(Z=>{M.add(String(Z))});const A=Mz(h),z=Rz({centerId:l,parentLookup:A,suppressedIds:C,candidateIds:M,alwaysIncludeIds:g}),P=T.filter(Z=>z(String(Z.id))),X=new Set(P.map(Z=>String(Z.id))),Y=[...P.filter(Z=>{const me=String(Z.id);if(!me)return!1;const Q=A.get(me);if(!Q||!Q.size)return!0;for(const ue of Q){const ne=ue!=null?String(ue):"";if(ne&&X.has(ne))return!0}return!1}),...O],V=new Set(Y.map(Z=>String(Z.id))),I=h.filter(Z=>{if(!Z)return!1;const me=Z.parentId!=null?Z.parentId:Z.source!=null?Z.source:null;if(me==null)return!0;const Q=String(me);return!(!V.has(Q)||C.has(Q))}),D=(Array.isArray(w)&&w.length?w:I).filter(Z=>{if(!Z)return!1;if(Z.isClusterEdge)return!0;const me=Z.parentId!=null?Z.parentId:Z.source!=null?Z.source:null;if(me!=null){const Pe=String(me);if(!V.has(Pe)||C.has(Pe))return!1}const Q=Z.source!=null?Z.source:Z.parentId!=null?Z.parentId:null,ue=Z.target!=null?Z.target:Z.childId!=null?Z.childId:null,ne=Q!=null?String(Q):"",we=ue!=null?String(ue):"";return!(ne&&C.has(ne)||we&&C.has(we))}),L=new Set;D.forEach(Z=>{const me=Z.source!=null?String(Z.source):Z.parentId!=null?String(Z.parentId):null,Q=Z.target!=null?String(Z.target):Z.childId!=null?String(Z.childId):null;me&&L.add(me),Q&&L.add(Q)}),l&&L.add(l);const B=Y.filter(Z=>L.has(String(Z.id))),k=new Set(l!=null?[String(l)]:[]);let U=!0;for(;U;){U=!1;for(const Z of D){if(!Z)continue;const me=Z.parentId!=null?Z.parentId:Z.source!=null?Z.source:null,Q=Z.childId!=null?Z.childId:Z.target!=null?Z.target:null,ue=me!=null?String(me):"",ne=Q!=null?String(Q):"",we=!!ue,Pe=!!ne;we&&k.has(ue)&&Pe&&!k.has(ne)&&(k.add(ne),U=!0),Pe&&k.has(ne)&&we&&!k.has(ue)&&(k.add(ue),U=!0)}}const R=B.filter(Z=>k.has(String(Z.id))),G=D.filter(Z=>{const me=Z.parentId!=null?String(Z.parentId):String(Z.source??""),Q=Z.childId!=null?String(Z.childId):String(Z.target??"");return me&&Q&&k.has(me)&&k.has(Q)}).map(Z=>({id:Z.id,source:Z.source,target:Z.target,type:"smoothstep",animated:!Z.isClusterEdge,label:Z.label||Z.relationshipLabel||ta,data:{relationshipType:Z.relationshipLabel||Z.label||ta,parentId:Z.parentId??null,childId:Z.childId??null,isClusterEdge:!!Z.isClusterEdge},parentId:Z.parentId??null,childId:Z.childId??null,sourceHandle:"bottom",targetHandle:"top"})),J=ec(R,G,l),ie=J.filter(Z=>Z.type==="cluster");return{nodes:J,edges:G,suppressedNodes:_,clusters:ie}}function Dz(e,t,r=[]){if(!e||!t)return null;const i=e?.position?.x??0,l=e?.position?.y??0,c=e?.width??Rc,f=e?.height??Cf,m=String(t.id),h=Bl(t),p=Array.isArray(r)?r.map(_=>String(_)):[],y=p.indexOf(m),g=Math.max(p.length-1,0)*Yd,v=i+c/2,S=v-g/2,w=Kr,N=y>=0?S+y*Yd-w/2:v-w/2,j=l+f+Eg;return{id:m,type:"entity",position:{x:N,y:j},data:{label:va(t.name,`Entity ${m}`),typeName:t?.type?.name||t?.typeName||"Entity",isCenter:!1,isAdHoc:!0,entityId:m,imageUrl:h}}}function cd(e,t,r=[]){if(!t||!Array.isArray(r)||r.length===0)return e;const i=r.map(N=>String(N)),l=new Map(i.map((N,j)=>[N,j])),c=t?.position?.x??0,f=t?.position?.y??0,m=t?.width??Rc,h=t?.height??Cf,p=f+h+Eg,y=(i.length-1)*Yd,v=c+m/2-y/2;let S=!1;const w=e.map(N=>{if(N.type!=="entity"||!N.data?.isAdHoc)return N;const j=l.get(String(N.id));if(j==null)return N;const _=N?.width??Kr,C=v+j*Yd-_/2,O=p;return N?.position?.x===C&&N?.position?.y===O?N:(S=!0,{...N,position:{x:C,y:O}})});return S?w:e}function Iz(e,t){return hj(e,t)}function gj({onRefocus:e,onZoomToFit:t,onAutoArrange:r,depth:i,onIncreaseDepth:l,onDecreaseDepth:c}){return a.jsxs("div",{className:"relationship-toolbar",role:"toolbar","aria-label":"Relationship viewer controls",children:[a.jsxs("div",{className:"relationship-toolbar__actions",children:[a.jsxs("button",{type:"button",className:"relationship-toolbar__button",onClick:e,children:[a.jsx(By,{"aria-hidden":"true"}),a.jsx("span",{children:"Refocus"})]}),a.jsxs("button",{type:"button",className:"relationship-toolbar__button",onClick:t,children:[a.jsx(VT,{"aria-hidden":"true"}),a.jsx("span",{children:"Zoom to fit"})]}),a.jsxs("button",{type:"button",className:"relationship-toolbar__button",onClick:r,children:[a.jsx(IM,{"aria-hidden":"true"}),a.jsx("span",{children:"Auto arrange"})]})]}),a.jsxs("div",{className:"relationship-toolbar__levels","aria-label":"Relationship depth controls",children:[a.jsx("span",{className:"relationship-toolbar__levels-label",children:"Levels"}),a.jsxs("div",{className:"relationship-toolbar__levels-controls",children:[a.jsx("button",{type:"button",className:"relationship-toolbar__levels-button",onClick:l,disabled:i>=3,"aria-label":"Increase relationship depth",children:a.jsx(Pa,{"aria-hidden":"true"})}),a.jsx("span",{className:"relationship-toolbar__levels-value","aria-live":"polite",children:i}),a.jsx("button",{type:"button",className:"relationship-toolbar__levels-button",onClick:c,disabled:i<=1,"aria-label":"Decrease relationship depth",children:a.jsx(A1,{"aria-hidden":"true"})})]})]})]})}gj.propTypes={onRefocus:rn.func.isRequired,onZoomToFit:rn.func.isRequired,onAutoArrange:rn.func.isRequired,depth:rn.number.isRequired,onIncreaseDepth:rn.func.isRequired,onDecreaseDepth:rn.func.isRequired};const Lz={cluster:lz,entity:oz},Oz={},zz="Related";function $z(e){const t=new Map;return Array.isArray(e)&&e.forEach(r=>{if(!r)return;const i=r?.parentId!=null?r.parentId:r?.source!=null?r.source:null,l=r?.childId!=null?r.childId:r?.target!=null?r.target:null;if(i==null||l==null)return;const c=String(i),f=String(l);!c||!f||c===f||(t.has(c)||t.set(c,[]),t.get(c).push(r))}),t}function Fz(e,t){const r=new Map;if(!e)return r;const i=String(e);if(!i)return r;r.set(i,0);const l=[i],c=new Set([i]);for(;l.length;){const f=l.shift();if(!f)continue;const m=r.get(f)??0,h=t.get(f);!h||!h.length||h.forEach(p=>{if(!p)return;const y=p?.childId!=null?p.childId:p?.target!=null?p.target:null,g=y!=null?String(y):null;!g||c.has(g)||g===f||(r.set(g,m+1),c.add(g),l.push(g))})}return r}function Bz(e){const t=new Map;return Array.isArray(e)&&e.forEach(r=>{if(!r)return;const i=r?.parentId!=null?r.parentId:r?.source!=null?r.source:null,l=r?.childId!=null?r.childId:r?.target!=null?r.target:null;if(i==null||l==null)return;const c=String(i),f=String(l);!c||!f||c===f||(t.has(f)||t.set(f,new Set),t.get(f).add(c))}),t}function Uz(e,t,r=null){const i=e!=null?String(e):null;if(!i)return new Set;const l=Bz(t);if(!l.size)return new Set;const c=new Set,f=[],m=new Map,h=l.get(i);for(h&&h.size&&h.forEach(p=>{const y=String(p);y&&(c.add(y),f.push(y),m.set(y,1))});f.length;){const p=f.shift();if(!p)continue;const y=m.get(p)??1;if(r!=null&&y>=r)continue;const g=l.get(p);!g||!g.size||g.forEach(v=>{const S=String(v);if(!S||S===p||c.has(S))return;const w=y+1;r!=null&&w>r||(c.add(S),m.set(S,w),f.push(S))})}return c}function kw(e){if(!e)return null;const t=e?.parentId!=null?e.parentId:e?.source!=null?e.source:null,r=e?.childId!=null?e.childId:e?.target!=null?e.target:null,i=t!=null?String(t):null,l=r!=null?String(r):null;if(!i||!l||i===l)return null;const c=e?.relationshipLabel||e?.label||e?.typeName||zz;return{id:e?.id!=null&&e.id!==""?String(e.id):`edge-${i}-${l}`,source:i,target:l,type:"smoothstep",animated:!e?.isClusterEdge,label:c,data:{relationshipType:c,parentId:i,childId:l,isClusterEdge:!!e?.isClusterEdge},parentId:i,childId:l,sourceHandle:"bottom",targetHandle:"top"}}function qz(){const{entityId:e}=vs(),t=zn(),[r,i]=u.useState(!0),[l,c]=u.useState(null),[f,m]=u.useState([]),[h,p]=u.useState([]),[y,g]=u.useState({}),[v,S]=u.useState(null),[w,N]=u.useState(1),[j,_]=u.useState(null),[C,O]=u.useState(null),[E,T]=u.useState(null),[M,A]=u.useState(!1),[z,P]=u.useState([]),[X,H]=u.useState([]),Y=u.useRef(new Map),V=u.useRef(new Map),I=u.useRef(new Map),F=u.useRef(new Set),D=u.useRef([]),L=u.useRef([]),B=u.useRef([]),k=u.useRef(new Map),U=u.useRef(new Set),R=u.useRef(null),q=u.useRef(new Map),G=u.useRef(new Map),J=u.useRef(null),ie=u.useCallback(W=>{if(!Array.isArray(W)||!W.length)return W;const ee=k.current;if(!(ee instanceof Map)||!ee.size)return W;let te=!1;const ve=W.map(le=>{if(!le||!(le.type==="entity"||le.type==="cluster"))return le;const Ee=ee.get(String(le.id));return Ee?(te=!0,{...le,position:{x:Ee.x,y:Ee.y},positionAbsolute:{x:Ee.x,y:Ee.y}}):le});return te?ve:W},[]);u.useEffect(()=>{D.current=f},[f]),u.useEffect(()=>{L.current=h},[h]),u.useEffect(()=>()=>{J.current!=null&&(clearTimeout(J.current),J.current=null)},[]),u.useEffect(()=>{const W=e!=null?String(e):null;if(W&&R.current!==W){R.current=W,k.current=new Map,U.current=new Set,g({});return}W||(R.current=null,k.current=new Map,U.current=new Set,g({}))},[e]),u.useEffect(()=>{if(!j){O(null),T(null),A(!1),P([]),H([]);return}let W=!1;return(async()=>{A(!0),T(null),O(null);try{const te=await rr(j);if(W)return;const ve=Ha(te);O(ve||null)}catch(te){if(W)return;console.error("Failed to load entity info:",te),O(null),T(te.message||"Failed to load entity info")}finally{W||A(!1)}})(),()=>{W=!0}},[j]);const Z=u.useMemo(()=>C&&(C.entity_type_id||C.entityType?.id||C.entity_type?.id)||null,[C]);u.useEffect(()=>{if(!Z){P([]),H([]);return}let W=!1;return(async()=>{try{const[te,ve]=await Promise.all([uf(Z).catch(le=>(console.error(" Failed to load drawer field order",le),null)),df(Z).catch(le=>(console.error(" Failed to load drawer field rules",le),null))]);if(W)return;P(Gr(te)),H(Gr(ve))}catch(te){if(W)return;console.error(" Failed to load drawer field layout",te),P([]),H([])}})(),()=>{W=!0}},[Z]);const me=u.useCallback(W=>m(ee=>YE(W,ee)),[]),Q=u.useCallback(W=>p(ee=>q6(W,ee)),[]),ue=u.useCallback(W=>{W&&t(`/entities/${W}/relationship-viewer`)},[t]),ne=u.useCallback(W=>{if(!W)return;const ee=String(W);_(te=>te===ee?te:ee)},[]),we=u.useCallback(()=>{_(null),O(null),T(null),A(!1)},[]),Pe=u.useCallback(W=>{W&&F.current.delete(String(W))},[]),Re=u.useCallback(W=>{W&&F.current.add(String(W))},[]),Ce=u.useCallback(W=>{if(!W)return new Map;const ee=String(W),te=Array.isArray(L.current)?L.current:[],ve=new Map,le=[ee],Se=new Set;for(;le.length;){const Ee=le.pop();!Ee||Se.has(Ee)||(Se.add(Ee),te.forEach(ge=>{if(!ge||ge?.data?.isClusterEdge||ge?.data?.isClusterChildEdge)return;const at=ge?.parentId??ge?.data?.parentId??ge?.source??null,st=ge?.childId??ge?.data?.childId??ge?.target??null;if(at==null||st==null)return;const nt=String(at);if(nt!==Ee)return;const ze=String(st);if(!(!ze||ze===ee)){if(!ve.has(ze)){const ft=ge?.data?.relationshipType||ge?.relationshipLabel||ge?.label||"Related";ve.set(ze,{parentId:nt,relationshipType:ft})}Se.has(ze)||le.push(ze)}}))}return ve},[]),it=u.useCallback((W,ee)=>{if(W==null||ee==null)return;const te=String(W);if(!te)return;const ve=G.current instanceof Map?G.current:null;!ve||U.current.has(te)&&ve.has(te)||ve.set(te,ee)},[]),qe=u.useCallback((W,ee)=>{if(!W)return;const te=String(typeof W=="string"?W:W?.id??W?.data?.id??W);if(!te)return;const ve=D.current.find(re=>String(re.id)===te&&re.type==="cluster");if(!ve)return;const le=U.current,Ee=B.current.find(re=>String(re.id)===te)||{id:te,relationshipType:ve?.data?.relationshipType||ve?.data?.label||"Related",label:ve?.data?.label||ve?.data?.relationshipType||"Related",containedIds:(ve?.data?.containedIds||[]).map(re=>String(re)).filter(re=>!le.has(re)),parentId:ve?.data?.sourceId!=null?String(ve.data.sourceId):null},ge=Y.current,at=I.current,st=V.current;if(!(ge instanceof Map)||!(at instanceof Map))return;const nt=ee??(typeof W=="object"&&W?.entityId!=null?W.entityId:null),ze=nt!=null?String(nt):null;if(ze&&le.has(ze))return;const ft=new Map;Array.isArray(D.current)&&D.current.forEach(re=>{if(!re||re.type&&re.type!=="entity")return;const Ne=String(re.id);Ne&&ft.set(Ne,re)}),at instanceof Map&&at.forEach((re,Ne)=>{if(!re)return;const Be=String(Ne);Be&&ft.set(Be,re)}),(Array.isArray(ve?.data?.allNodes)?ve.data.allNodes:[]).forEach(re=>{if(!re||re?.type&&re.type!=="entity")return;const Ne=re?.id!=null?String(re.id):null;if(!Ne||ft.has(Ne))return;const Be=re?.data||{},Ke=Be?.label||re?.name||Be?.name||`Entity ${Ne}`,ot={id:Ne,type:re?.type||"entity",position:re?.position||{x:0,y:0},data:{...Be,label:va(Ke,`Entity ${Ne}`),typeName:Be?.typeName||Be?.type?.name||re?.typeName||re?.type&&re?.type.name||"Entity",entityId:Be?.entityId!=null?String(Be.entityId):Ne,isAdHoc:Be?.isAdHoc!=null?!!Be.isAdHoc:!0,isExpandedProtected:!!Be?.isExpandedProtected}};ft.set(Ne,ot)});let Rt=ze?[ze].filter(re=>ge.has(re)):[];if(Rt.length===0&&ze&&(Rt=[String(ze)]),!Rt.length)if(ze){const re=String(ze);ge.delete(re),at.delete(re),st instanceof Map&&st.delete(re),U.current.add(re)}else{Pe(te);return}const pt=Rt.map(re=>{const Ne=String(re);return{id:Ne,definition:at.get(Ne)||ft.get(Ne)||null,meta:st.get(Ne)||ge.get(Ne)||null}}).filter(re=>{if(!re?.definition)return!1;const Ne=re?.id!=null?String(re.id):null;return Ne?!le.has(Ne):!1});if(!pt.length){ze||Pe(te);return}const ct=Ee.parentId!=null?String(Ee.parentId):null,yt=new Set(D.current.map(re=>String(re.id))),Tt=pt.filter(({id:re,meta:Ne})=>{const Be=re!=null?String(re):null;if(Be&&le.has(Be))return!1;const Ke=Ne?.parentId!=null?String(Ne.parentId):ct;return ct&&Ke!==ct?!1:Ke?ge.has(Ke)?!1:yt.has(Ke):!0});if(!Tt.length)return;Tt.forEach(({id:re})=>{const Ne=String(re);Ne&&le.add(Ne)});const Ft=Ee.relationshipType||Ee.label||"Related",kt=[...L.current];Tt.forEach(({id:re})=>{ge.delete(String(re))});const Zt=[],Lt=[],Kt=q.current instanceof Map?q.current:new Map,se=G.current instanceof Map?G.current:new Map,be=Number.isFinite(Number(w))?Number(w):null;if(Kt.size){const re=V.current instanceof Map?V.current:new Map,Ne=new Set(Array.isArray(D.current)?D.current.map(Ue=>String(Ue.id)):[]),Be=new Set,Ke=new Set;Tt.forEach(({id:Ue})=>{if(!Ue)return;const Ge=String(Ue);Ne.add(Ge),Be.add(Ge)});const ot=Tt.map(({id:Ue})=>String(Ue)),Oe=new Set,ce=new Set;for(;ot.length;){const Ue=ot.shift();if(!Ue||Oe.has(Ue))continue;Oe.add(Ue);const Ge=se.get(Ue)??0;if(be!=null&&Ge!=null&&Ge>=be)continue;const ut=Kt.get(Ue);!ut||!ut.length||ut.forEach(ae=>{if(!ae)return;const Xe=ae?.childId!=null?ae.childId:ae?.target!=null?ae.target:null,$e=Xe!=null?String(Xe):null;if(!$e||$e===Ue)return;const Je=Ge+1;if(be!=null&&Number.isFinite(be)&&Je>be)return;if(Ne.has($e))it($e,Je),Be.has($e)&&ot.push($e);else if(!Ke.has($e)){let St=null;if(ge.has($e)){const _e=at.get($e);if(!_e)return;ge.delete($e),at.delete($e),re.delete($e),le.add($e),St=_e}else{const _e=ft.get($e);if(!_e)return;const tt=_e?.data?.label||_e?.data?.name||`Entity ${$e}`;St={..._e,id:String($e),type:_e.type||"entity",position:_e.position||{x:0,y:0},data:{..._e?.data,label:va(tt,`Entity ${$e}`),typeName:_e?.data?.typeName||_e?.data?.type?.name||"Entity",entityId:_e?.data?.entityId!=null?String(_e.data.entityId):String($e),isAdHoc:_e?.data?.isAdHoc!=null?!!_e.data.isAdHoc:!0,isExpandedProtected:!!_e?.data?.isExpandedProtected}}}St&&(Zt.push({id:$e,definition:St}),Ke.add($e),Ne.add($e),Be.add($e),ot.push($e),it($e,Je),ft.set($e,St))}it($e,Je);const bt=kw(ae);bt&&!ce.has(bt.id)&&(ce.add(bt.id),Lt.push(bt))})}if(Lt.length){const Ue=new Set(kt.map(Ge=>Ge.id));Lt.forEach(Ge=>{!Ge||Ue.has(Ge.id)||(Ue.add(Ge.id),kt.push(Ge))})}}const je=Ee.containedIds.filter(re=>{const Ne=String(re);return le.has(Ne)?!1:ge.has(Ne)});g(re=>{const Ne={...re};let Be=!1;return Tt.forEach(({id:Ke})=>{Ne[Ke]||(Ne[Ke]={clusterId:Ee.id,relationshipType:Ee.relationshipType||null,sourceId:Ee.parentId||null},Be=!0)}),Be?Ne:re}),Lt.length&&p(re=>{const Ne=new Set(re.map(Ke=>Ke.id)),Be=Lt.filter(Ke=>!Ne.has(Ke.id));return Be.length?[...re,...Be]:re}),m(re=>{const Ne=re.find(ae=>String(ae.id)===te&&ae.type==="cluster");if(!Ne)return re;const Be=new Set(re.map(ae=>String(ae.id)));let Ke=re,ot=!1;const Oe=new Set((Ne.data?.placedEntityIds||[]).map(ae=>String(ae)));Tt.forEach(({id:ae,definition:Xe,meta:$e})=>{const Je=String(ae);if(Oe.add(Je),Be.has(Je))return;const bt=$e?.entity||{id:ae,name:Xe?.data?.label||`Entity ${ae}`,typeName:Xe?.data?.typeName||Xe?.data?.type?.name||"Entity",isExpandedProtected:!!Xe?.data?.isExpandedProtected},St=Dz(Ne,bt,Array.from(Oe))||Xe;if(!St)return;const _e=va(St.data?.label,`Entity ${ae}`),tt=va(bt?.name,_e),mt={...St,id:String(ae),type:"entity",data:{...St.data,label:tt,typeName:bt?.typeName||St.data?.typeName||"Entity",entityId:String(ae),isAdHoc:!0,onSetTarget:ue,onOpenInfo:ne,isExpandedProtected:!!bt?.isExpandedProtected}};Be.add(Je),ot=!0,Ke=[...Ke,mt];const fe=`cluster-context-${te}-${Je}`;if(!L.current.find(Ve=>Ve.id===fe)){const Ve={id:fe,source:te,target:Je,type:"smoothstep",animated:!1,label:"",style:{stroke:"#bbb",strokeDasharray:"4 2"},data:{isClusterContext:!0,parentId:te,childId:Je},sourceHandle:"bottom",targetHandle:"top"};L.current.push(Ve),p(vt=>[...vt,Ve])}}),Zt.forEach(({id:ae,definition:Xe})=>{if(!ae||Be.has(String(ae)))return;const $e={...Xe,id:String(ae),type:"entity",data:{...Xe?.data,label:Xe?.data?.label||Xe?.data?.name||`Entity ${ae}`,typeName:Xe?.data?.typeName||Xe?.data?.type?.name||"Entity",entityId:String(ae),isAdHoc:!0,onSetTarget:ue,onOpenInfo:ne,isExpandedProtected:!!Xe?.data?.isExpandedProtected}};Be.add(String(ae)),ot=!0,Ke=[...Ke,$e]});const ce=Array.from(Oe),Ue=`${Ft} (${je.length})`;let Ge=Ke.map(ae=>String(ae.id)!==te||ae.type!=="cluster"?ae:{...ae,data:{...ae.data,placedEntityIds:ce,manuallyReleasedIds:ce,label:Ue}});const ut=Ge.find(ae=>String(ae.id)===te&&ae.type==="cluster")||Ne;return Ge=cd(Ge,ut,ce),!ot&&!re.some(Xe=>String(Xe.id)!==te||Xe.type!=="cluster"?!1:Xe.data?.label!==Ue)?re:ie(ec(Ge,kt))});const Ze=`${Ft} (${je.length})`;Ee.label=Ze,B.current=B.current.map(re=>String(re.id)===te?{...re,label:Ze}:re);const dt=re=>{if(!Array.isArray(re)||!re.length)return[];const Ne=q.current instanceof Map?q.current:new Map,Be=G.current instanceof Map?G.current:new Map,Ke=U.current,ot=Y.current instanceof Map?Y.current:null,Oe=I.current instanceof Map?I.current:null,ce=V.current instanceof Map?V.current:null;if(!Oe)return[];const Ue=Number.isFinite(Number(w))?Number(w):null,Ge=new Set(L.current.map(Je=>String(Je.id))),ut=[],ae=[],Xe=new Map,$e=new Set;if(re.forEach(Je=>{const bt=Je!=null?String(Je):null;if(!bt)return;const St=Ne.get(bt)||[],_e=Be.get(bt),tt=Number.isFinite(_e)?_e+1:null;St.forEach(mt=>{if(!mt)return;const fe=mt?.childId!=null?mt.childId:mt?.target!=null?mt.target:null,he=fe!=null?String(fe):null;if(!he||he===bt||Ke.has(he))return;const Ve=kw(mt);if(Ve&&!Ge.has(Ve.id)&&(Ge.add(Ve.id),ut.push(Ve)),!(Ue==null||tt!=null&&tt<=Ue)||!Oe.has(he))return;const Nt=Oe.get(he);if(!Nt)return;const Et=ce&&ce.get(he)||ot&&ot.get(he)||null;Oe.delete(he),ot&&ot.delete(he),ce&&ce.delete(he);const jt=Ke.has(he);Ke.add(he),tt!=null&&(!jt||!Be.has(he))&&it(he,tt);const Wt=Et?.entity||null,ln=va(Nt?.data?.label,va(Nt?.data?.name,`Entity ${he}`)),dn=va(Wt?.name,ln),Qt={...Nt,id:he,type:"entity",data:{...Nt?.data,label:dn,typeName:Wt?.typeName||Nt?.data?.typeName||Nt?.data?.type?.name||"Entity",entityId:he,isAdHoc:!0,onSetTarget:ue,onOpenInfo:ne,isExpandedProtected:!!(Wt?.isExpandedProtected??Nt?.data?.isExpandedProtected)}};ae.push(Qt),$e.add(he),Et?.clusterId&&Xe.set(he,{clusterId:String(Et.clusterId),relationshipType:Et?.relationshipType||null,sourceId:Et?.parentId!=null?String(Et.parentId):null})})}),ut.length){const Je=ut.filter(Boolean);Je.length&&(L.current=[...L.current,...Je],p(bt=>[...bt,...Je]))}return ae.length&&m(Je=>{const bt=new Set(Je.map(mt=>String(mt.id))),St=ae.filter(mt=>{const fe=mt?.id!=null?String(mt.id):null;return!fe||bt.has(fe)?!1:(bt.add(fe),!0)});if(!St.length)return Je;const _e=[...Je,...St],tt=ec(_e,L.current);return ie(tt)}),Xe.size&&g(Je=>{const bt={...Je};let St=!1;return Xe.forEach((_e,tt)=>{const mt=bt[tt];(!mt||mt.clusterId!==_e.clusterId||mt.relationshipType!==_e.relationshipType||mt.sourceId!==_e.sourceId)&&(bt[tt]=_e,St=!0)}),St?bt:Je}),Array.from($e)},gt=new Set,oe=[...Tt.map(({id:re})=>String(re)),...Zt.map(({id:re})=>String(re))].filter(Boolean);for(;oe.length;){const re=[];for(;oe.length;){const Be=oe.shift();!Be||gt.has(Be)||re.push(Be)}if(!re.length)break;const Ne=dt(re);re.forEach(Be=>gt.add(Be)),Ne.forEach(Be=>{gt.has(Be)||oe.push(Be)})}},[ie,ne,ue,it,Pe,w]),We=u.useCallback((W,ee)=>{if(!W||!ee)return;const te=String(ee.id),ve=String(W.id);if(ee?.isExpandedProtected||D.current.some(ct=>String(ct?.id)===te&&ct?.data?.isExpandedProtected))return;const Se=new Map(D.current.map(ct=>[String(ct.id),ct])),Ee=Ce(te),at=Array.from(Ee.entries()).map(([ct])=>String(ct)).filter(ct=>{if(ct===te)return!1;const yt=Se.get(ct);return!(!yt||yt?.data?.isExpandedProtected)}),st=new Set(at);U.current.delete(te),k.current.delete(te),at.forEach(ct=>{U.current.delete(String(ct)),k.current.delete(String(ct))}),g(ct=>{const yt={...ct};let Tt=!1;return yt[te]&&(delete yt[te],Tt=!0),at.forEach(Ft=>{yt[Ft]&&(delete yt[Ft],Tt=!0)}),Tt?yt:ct});let nt=[];m(ct=>{const yt=ct.find(Lt=>Lt.id===W.id);let Ft=ct.filter(Lt=>{const Kt=String(Lt.id);return Kt===te&&Lt.type==="entity"?!Lt.data?.isAdHoc:st.has(Kt)&&Lt.type==="entity"?!!Lt.data?.isExpandedProtected:!0}).map(Lt=>{if(Lt.id!==W.id||Lt.type!=="cluster")return Lt;const Kt=new Set((Lt.data?.placedEntityIds||[]).map(String));return Kt.has(te)?(Kt.delete(te),{...Lt,data:{...Lt.data,placedEntityIds:Array.from(Kt),manuallyReleasedIds:Array.from(Kt)}}):Lt});const kt=Ft.find(Lt=>Lt.id===W.id&&Lt.type==="cluster"),Zt=kt?.data?.placedEntityIds?.map(Lt=>String(Lt))||[];return nt=Zt,ie(cd(Ft,kt||yt,Zt))}),p(ct=>{const yt=new Set([te,...at]);return ct.filter(Tt=>{const Ft=Tt?.source!=null?String(Tt.source):Tt?.parentId!=null?String(Tt.parentId):null,kt=Tt?.target!=null?String(Tt.target):Tt?.childId!=null?String(Tt.childId):null;return!(Ft&&yt.has(Ft)||kt&&yt.has(kt))})});const ze=W.relationshipType||W.label||"Related",ft=va(ee?.name,`Entity ${te}`),zt={clusterId:ve,parentId:W.sourceId?String(W.sourceId):null,relationshipType:ze,entity:{id:te,name:ft,typeName:ee?.typeName||ee?.type?.name||"Entity",type:ee?.type}};Y.current.set(te,zt),V.current.set(te,zt),I.current.set(te,{id:te,type:"entity",position:{x:0,y:0},data:{label:ft,typeName:ee?.typeName||ee?.type?.name||"Entity",entityId:te,isAdHoc:!0,isExpandedProtected:!!ee?.isExpandedProtected}});const Rt=B.current.find(ct=>ct.id===ve);if(Rt){const ct=U.current,yt=W.containedIds.filter(Ft=>{const kt=String(Ft);return ct.has(kt)?!1:Y.current.has(kt)}),Tt=`${Rt.relationshipType||W.relationshipType||"Related"} (${yt.length})`;Rt.label=Tt,B.current=B.current.map(Ft=>Ft.id===ve?{...Ft,label:Tt}:Ft),m(Ft=>Ft.map(kt=>String(kt.id)!==ve||kt.type!=="cluster"?kt:{...kt,data:{...kt.data,label:Tt}}))}nt.length?Pe(ve):Re(ve);const pt=Array.isArray(B.current)?B.current:[];at.forEach(ct=>{const yt=Se.get(ct);if(!yt)return;const Tt=Ee.get(ct)||{},Ft=Tt?.parentId!=null?String(Tt.parentId):null,kt=Tt?.relationshipType||"Related",Zt=pt.find(Kt=>{if(!Kt)return!1;const se=Kt?.parentId!=null?String(Kt.parentId):null;return se&&Ft&&se!==Ft?!1:Array.isArray(Kt?.containedIds)?Kt.containedIds.some(be=>String(be)===String(ct)):!1}),Lt={clusterId:Zt?String(Zt.id):null,parentId:Ft,relationshipType:kt,entity:{id:String(ct),name:yt?.data?.label||`Entity ${ct}`,typeName:yt?.data?.typeName||yt?.data?.type?.name||"Entity",type:yt?.data?.type||null,isExpandedProtected:!!yt?.data?.isExpandedProtected}};Y.current.set(String(ct),Lt),V.current.set(String(ct),Lt),I.current.set(String(ct),{id:String(ct),type:"entity",position:{x:0,y:0},data:{label:yt?.data?.label||`Entity ${ct}`,typeName:yt?.data?.typeName||yt?.data?.type?.name||"Entity",entityId:String(ct),isAdHoc:!0,isExpandedProtected:!!yt?.data?.isExpandedProtected}})})},[ie,Ce,Re,Pe]),ke=u.useCallback(W=>{if(!W)return;const ee=String(typeof W=="string"?W:W?.id??W?.data?.id??W);if(!ee)return;const te=B.current.find(nt=>String(nt.id)===ee);if(!te)return;const ve=Y.current,le=V.current,Se=te.containedIds.filter(nt=>D.current.some(ze=>String(ze.id)===String(nt)));if(!Se.length){Re(ee);return}Se.forEach(nt=>{const ze=String(nt);U.current.delete(ze),k.current.delete(ze);const ft=D.current.find(Rt=>String(Rt.id)===ze);ft?.type==="entity"&&I.current.set(ze,{id:ze,type:"entity",position:{x:0,y:0},data:{label:ft.data?.label||`Entity ${ze}`,typeName:ft.data?.typeName||"Entity",entityId:ze,isAdHoc:!0,isExpandedProtected:!!ft.data?.isExpandedProtected}});const zt=le.get(ze)||{clusterId:ee,parentId:te.parentId||null,relationshipType:te.relationshipType||te.label||"Related",entity:ft?.data?{id:ze,name:ft.data?.label||`Entity ${ze}`,typeName:ft.data?.typeName||"Entity",isExpandedProtected:!!ft.data?.isExpandedProtected}:I.current.get(ze)?.data?{id:ze,name:I.current.get(ze)?.data?.label||`Entity ${ze}`,typeName:I.current.get(ze)?.data?.typeName||"Entity",isExpandedProtected:!!I.current.get(ze)?.data?.isExpandedProtected}:null};ve.set(ze,zt),le.set(ze,zt)});const Ee=L.current.filter(nt=>{const ze=String(nt.source),ft=String(nt.target);return!Se.includes(ze)&&!Se.includes(ft)});p(Ee),g(nt=>{const ze={...nt};let ft=!1;return Se.forEach(zt=>{ze[zt]&&(delete ze[zt],ft=!0)}),ft?ze:nt});const ge=U.current,at=te.containedIds.filter(nt=>{const ze=String(nt);return ge.has(ze)?!1:ve.has(ze)}),st=`${te.relationshipType||te.label||"Related"} (${at.length})`;te.label=st,B.current=B.current.map(nt=>String(nt.id)===ee?{...nt,label:st}:nt),m(nt=>{const ft=nt.filter(zt=>!Se.includes(String(zt.id))).map(zt=>String(zt.id)!==ee||zt.type!=="cluster"?zt:{...zt,data:{...zt.data,placedEntityIds:te.containedIds.filter(Rt=>{const pt=String(Rt);return ge.has(pt)?!1:!ve.has(pt)}).map(Rt=>String(Rt)),manuallyReleasedIds:te.containedIds.filter(Rt=>{const pt=String(Rt);return ge.has(pt)?!1:!ve.has(pt)}).map(Rt=>String(Rt)),label:st}});return ie(ec(ft,Ee))}),Re(ee)},[ie,Re]),xt=u.useCallback((W,ee)=>{if(!ee||ee.type!=="entity"&&ee.type!=="cluster")return;const te=String(ee.id);if(k.current.set(te,{x:ee?.position?.x??0,y:ee?.position?.y??0}),ee.type!=="entity")return;const ve=te,le=y[ve];if(!le?.clusterId)return;const Se=document.querySelector(`[data-id="${le.clusterId}"]`),Ee=document.querySelector(`[data-id="${ve}"]`);if(!Se||!Ee)return;const ge=Se.getBoundingClientRect(),at=Ee.getBoundingClientRect(),st=at.left+at.width/2,nt=at.top+at.height/2;if(!(st>=ge.left&&st<=ge.right&&nt>=ge.top&&nt<=ge.bottom))return;const ft=f.find(zt=>zt.id===le.clusterId);ft&&(ee?.data?.isExpandedProtected||We({id:ft.id,relationshipType:ft.data?.relationshipType,sourceId:ft.data?.sourceId,placedEntityIds:ft.data?.placedEntityIds||[]},{id:ve,name:ee?.data?.label,typeName:ee?.data?.typeName,isExpandedProtected:!!ee?.data?.isExpandedProtected}))},[y,We,f]);u.useEffect(()=>{m(W=>{const ee=Object.entries(y).reduce((ve,[le,Se])=>{const Ee=Se?.clusterId;if(!Ee)return ve;const ge=String(Ee);return ve[ge]||(ve[ge]=[]),ve[ge].push(String(le)),ve},{});let te=W.map(ve=>{if(ve.type!=="cluster")return ve;const le=ee[ve.id]||[],Se=(ve.data?.placedEntityIds||[]).map(ge=>String(ge));return le.length!==Se.length||le.some((ge,at)=>ge!==Se[at])?{...ve,data:{...ve.data,placedEntityIds:le,manuallyReleasedIds:le}}:ve});for(const[ve,le]of Object.entries(ee)){const Se=te.find(Ee=>Ee.id===ve&&Ee.type==="cluster");Se&&(te=cd(te,Se,le))}return ie(te)})},[ie,y]),u.useEffect(()=>{if(!e)return;let W=!0;async function ee(){i(!0),c(null);try{const te=Y.current instanceof Map?Array.from(Y.current.entries()):[],ve=new Map(te.map(([ct,yt])=>[String(ct),yt])),le=new Set(ve.keys()),Ee=await ZR(e,w)??{};let ge=Array.isArray(Ee.edges)?Ee.edges:[];le.size&&Array.isArray(Ee.edges)&&(ge=Ee.edges.filter(ct=>{const yt=ct?.from_entity??ct?.fromEntityId??ct?.from??ct?.source??ct?.sourceId??null,Tt=ct?.to_entity??ct?.toEntityId??ct?.to??ct?.target??ct?.targetId??null,Ft=yt!=null?String(yt):null,kt=Tt!=null?String(Tt):null,Zt=Ft?le.has(Ft):!1,Lt=kt?le.has(kt):!1;return!Zt&&!Lt?!0:!(Zt&&Lt)}));const at=ge.map(ct=>Iz(ct,e)).filter(Boolean),st=$z(at);q.current=st,G.current=Fz(e,st);const nt=Number.isFinite(Number(w))?Number(w):null,ze=Uz(e,at,nt),{nodes:ft,edges:zt,suppressedNodes:Rt,clusters:pt}=kz({...Ee,edges:ge},e,void 0,{alwaysIncludeIds:ze});if(W){const ct=Oe=>Oe?Oe.type==="cluster"?{...Oe,data:{...Oe.data,onAddToBoard:(ce,Ue)=>qe(ce,Ue),onReturnToGroup:We,onCollapseCluster:ke,onSetTargetEntity:ue,onOpenEntityInfo:ne,placedEntityIds:[]}}:Oe.type==="entity"?{...Oe,data:{...Oe.data,onSetTarget:ue,onOpenInfo:ne}}:{...Oe}:null,yt=U.current,Tt=ft.map(ct),Ft=Object.entries(y).reduce((Oe,[ce,Ue])=>{const Ge=Ue?.clusterId!=null?String(Ue.clusterId):null;return Ge&&(Oe.has(Ge)||Oe.set(Ge,[]),Oe.get(Ge).push(String(ce))),Oe},new Map),kt=Oe=>{const ce=Array.isArray(Oe)?Oe.map(Ue=>String(Ue)):[];return yt.size?ce.filter(Ue=>!yt.has(Ue)):ce},Zt=Oe=>{if(!Oe)return Oe;const ce=Oe?.id!=null?String(Oe.id):null,Ue=kt(Oe?.data?.containedIds||[]),Ge=ce&&Ft.has(ce)?Ft.get(ce):[],ut=Array.isArray(Ge)?Ge.map(ae=>String(ae)):[];return{...Oe,data:{...Oe?.data,containedIds:Ue,count:Ue.length+ut.length,placedEntityIds:ut,manuallyReleasedIds:ut}}},Lt=Tt.map(Oe=>Oe?.type==="cluster"?Zt(Oe):Oe),Kt=new Map,se=Rt,be=(Oe,ce)=>{if(yt.has(Oe))return;const Ue=va(ce?.entity?.name,`Entity ${Oe}`);Kt.set(Oe,{clusterId:ce?.clusterId!=null?String(ce.clusterId):null,parentId:ce?.parentId!=null?String(ce.parentId):null,relationshipType:ce?.relationshipType||"Related",entity:ce?.entity?{...ce.entity,id:String(ce.entity.id??Oe),name:Ue,typeName:ce.entity?.typeName||ce.entity?.type?.name||"Entity",isExpandedProtected:!!ce.entity?.isExpandedProtected}:null})};se instanceof Map?se.forEach((Oe,ce)=>{const Ue=String(ce);be(Ue,Oe)}):Object.entries(se||{}).forEach(([Oe,ce])=>{const Ue=String(Oe);be(Ue,ce)}),Y.current=Kt,V.current=new Map(Kt);const je=new Map;se instanceof Map?se.forEach((Oe,ce)=>{const Ue=String(ce),Ge=Oe?.entity||null,ut=va(Ge?.name,`Entity ${Ue}`);je.set(Ue,{id:Ue,type:"entity",position:{x:0,y:0},data:{label:ut,typeName:Ge?.typeName||Ge?.type?.name||"Entity",entityId:Ue,isAdHoc:!0,isExpandedProtected:!!Ge?.isExpandedProtected}})}):Object.entries(se||{}).forEach(([Oe,ce])=>{const Ue=String(Oe),Ge=ce?.entity||null,ut=va(Ge?.name,`Entity ${Ue}`);je.set(Ue,{id:Ue,type:"entity",position:{x:0,y:0},data:{label:ut,typeName:Ge?.typeName||Ge?.type?.name||"Entity",entityId:Ue,isAdHoc:!0,isExpandedProtected:!!Ge?.isExpandedProtected}})}),I.current=je;const Ze=new Set,gt=(Array.isArray(pt)?pt:Lt.filter(Oe=>Oe.type==="cluster")).map(Oe=>Zt(Oe));gt.forEach(Oe=>{Ze.add(String(Oe.id))}),F.current=Ze;const oe=gt.map(Oe=>({id:String(Oe.id),relationshipType:Oe?.data?.relationshipType||Oe?.data?.label||"Related",label:Oe?.data?.label||Oe?.data?.relationshipType||"Related",containedIds:(Oe?.data?.containedIds||[]).map(ce=>String(ce)),parentId:Oe?.data?.sourceId!=null?String(Oe.data.sourceId):null}));B.current=oe;const re=new Map(Array.isArray(D.current)?D.current.map(Oe=>[String(Oe.id),Oe]):[]),Ne=[...Lt];yt.forEach(Oe=>{const ce=String(Oe);if(Ne.some(ut=>String(ut.id)===ce))return;const Ue=re.get(ce);if(Ue){Ne.push(Ue);return}const Ge=je.get(ce);if(Ge){const ut=ct(Ge);ut&&Ne.push({...ut,id:ce,type:"entity"})}});const Be=new Set(Array.isArray(zt)?zt.map(Oe=>Oe.id):[]),Ke=(Array.isArray(L.current)?L.current:[]).filter(Oe=>{if(!Oe||Be.has(Oe.id))return!1;const ce=Oe?.data?.childId??Oe?.target??Oe?.data?.targetId??null,Ue=Oe?.data?.parentId??Oe?.source??Oe?.data?.sourceId??null,Ge=ce!=null?String(ce):null,ut=Ue!=null?String(Ue):null;return!!(Ge&&yt.has(Ge)||ut&&yt.has(ut))}),ot=Array.isArray(zt)?[...zt,...Ke]:Ke;m(ie(Ne)),p(ot)}}catch(te){W&&c(te.message||"Failed to load graph")}finally{W&&i(!1)}}return ee(),()=>{W=!1}},[ie,e,w,qe,ke,ne,We,ue]);const Mt=u.useCallback(()=>{if(!v||!e)return;const W=String(e),ee=v.getNode(W);if(!ee)return;const te=ee.width??0,ve=ee.height??0,le=ee.position.x+te/2,Se=ee.position.y+ve/2;v.setCenter(le,Se,{zoom:Math.max(1,v.getZoom()),duration:500})},[e,v]),Ct=u.useCallback(()=>{!v||!f.length||v.fitView({padding:.2,duration:500})},[f.length,v]),At=u.useCallback(()=>{e&&(m(W=>{if(!W?.length)return W;const ee=ec(W,h,e),te=new Map(ee.map(ge=>[String(ge.id),{...ge.position}])),ve=W.map(ge=>{const at=te.get(String(ge.id));return!at||ge?.position?.x===at.x&&ge?.position?.y===at.y?ge:{...ge,position:{...at}}}),le=Object.entries(y).reduce((ge,[at,st])=>{const nt=st?.clusterId;if(!nt)return ge;const ze=String(nt);return ge[ze]||(ge[ze]=[]),ge[ze].push(String(at)),ge},{});if(!Object.keys(le).length)return ve;let Se=ve.map(ge=>{if(ge.type!=="cluster")return ge;const at=le[ge.id]||[],st=(ge.data?.placedEntityIds||[]).map(String);return at.length!==st.length||at.some((ze,ft)=>ze!==st[ft])?{...ge,data:{...ge.data,placedEntityIds:at,manuallyReleasedIds:at}}:ge});for(const[ge,at]of Object.entries(le)){const st=Se.find(nt=>nt.id===ge&&nt.type==="cluster");st&&(Se=cd(Se,st,at))}const Ee=k.current;return Ee instanceof Map&&Ee.size&&Se.forEach(ge=>{if(!ge||!(ge.type==="entity"||ge.type==="cluster"))return;const st=String(ge.id);Ee.has(st)&&Ee.set(st,{x:ge.position?.x??0,y:ge.position?.y??0})}),ie(Se)}),v&&requestAnimationFrame(()=>{v.fitView({padding:.2,duration:400})}))},[ie,y,h,e,v]),He=u.useCallback(()=>{N(W=>Math.min(3,W+1))},[]),Qe=u.useCallback(()=>{N(W=>Math.max(1,W-1))},[]);return r?a.jsx("p",{className:"p-4",children:"Loading graph..."}):l?a.jsxs("p",{className:"p-4 text-red-500",children:["Error: ",l]}):f.length?a.jsxs("div",{className:"flex flex-col h-screen w-full bg-gray-100",children:[a.jsx("header",{className:"p-4 border-b bg-white shadow-sm",children:a.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Relationship Explorer"})}),a.jsxs("div",{className:"flex-1 min-h-0 flex flex-col bg-slate-100",children:[a.jsx(gj,{onRefocus:Mt,onZoomToFit:Ct,onAutoArrange:At,depth:w,onIncreaseDepth:He,onDecreaseDepth:Qe}),a.jsx("div",{className:"flex-1 min-h-0 relative",children:a.jsx("div",{className:"w-full h-full relative",style:{height:"calc(100vh - 80px)"},children:a.jsxs(ij,{nodes:f,edges:h,onNodesChange:me,onEdgesChange:Q,onNodeDragStop:xt,nodeTypes:Lz,edgeTypes:Oz,fitView:!0,onInit:S,children:[a.jsx(H8,{}),a.jsx(W8,{}),a.jsx(nz,{gap:16})]})})})]}),a.jsx(Qy,{entityId:j,entity:C,isLoading:M,error:E,onClose:we,fieldOrder:z,fieldRules:X})]}):a.jsx("p",{className:"p-4",children:"No relationships found for this entity."})}function Po({step:e,title:t,subtitle:r,children:i,disabled:l=!1}){return a.jsxs("section",{className:`step-card${l?" step-card--disabled":""}`,"aria-disabled":l,children:[a.jsxs("header",{className:"step-card__header",children:[a.jsx("span",{className:"step-card__badge",children:e}),a.jsxs("div",{children:[a.jsx("h3",{className:"step-card__title",children:t}),r&&a.jsx("p",{className:"step-card__subtitle",children:r})]})]}),a.jsx("div",{className:"step-card__body",children:i})]})}const Dw=["B","KB","MB","GB"];function Hz(e){if(!Number.isFinite(e)||e<=0)return"0 B";const t=Math.min(Math.floor(Math.log(e)/Math.log(1024)),Dw.length-1),r=e/1024**t;return`${r.toFixed(r>=10||t===0?0:1)} ${Dw[t]}`}function Pz({files:e=[],selectedId:t,onSelect:r,onDelete:i}){return e.length?a.jsx("ul",{className:"uploaded-file-list",children:e.map(l=>{const c=l.id===t;return a.jsxs("li",{className:`uploaded-file-list__item${c?" is-selected":""}`,children:[a.jsxs("button",{type:"button",className:"uploaded-file-list__select",onClick:()=>r(c?null:l.id),children:[a.jsx(qp,{size:16}),a.jsx("span",{className:"uploaded-file-list__name",children:l.file_name}),a.jsx("span",{className:"uploaded-file-list__meta",children:Hz(l.size_bytes)})]}),a.jsx("button",{type:"button",className:"uploaded-file-list__delete",onClick:()=>i(l.id),"aria-label":`Delete ${l.file_name}`,children:a.jsx(fa,{size:16})})]},l.id)})}):a.jsx("p",{className:"uploaded-file-list__empty",children:"No files uploaded yet."})}function Vz({isOpen:e,onClose:t,preview:r,previewing:i,importing:l,onImport:c,error:f}){if(!e)return null;const m=!!(r&&!i&&!l);return a.jsxs("div",{className:"preview-popout",role:"dialog","aria-modal":"true",children:[a.jsx("div",{className:"preview-popout__overlay",onClick:t}),a.jsxs("div",{className:"preview-popout__panel",children:[a.jsxs("header",{className:"preview-popout__header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"Import Preview"}),a.jsx("p",{children:"Review the summary before running the upload."})]}),a.jsx("button",{type:"button",onClick:t,"aria-label":"Close preview",className:"preview-popout__close",children:a.jsx(Ra,{size:20})})]}),a.jsxs("div",{className:"preview-popout__content",children:[i&&a.jsxs("div",{className:"preview-popout__state",children:[a.jsx(Nn,{className:"spin",size:28}),a.jsx("p",{children:"Generating preview"})]}),!i&&f&&a.jsxs("div",{className:"preview-popout__alert preview-popout__alert--error",children:[a.jsx(Aa,{size:18}),a.jsx("span",{children:f})]}),!i&&r&&a.jsxs("div",{className:"preview-popout__summary",children:[a.jsxs("div",{className:"preview-popout__summary-grid",children:[a.jsx(ud,{label:"Total rows",value:r.total}),a.jsx(ud,{label:"To create",value:r.createCount,tone:"success"}),a.jsx(ud,{label:"Duplicates",value:r.duplicateCount,tone:"warn"}),a.jsx(ud,{label:"Invalid",value:r.invalidCount,tone:"error"})]}),r.duplicateCount>0&&Array.isArray(r.duplicates)&&a.jsxs("div",{className:"preview-popout__list",children:[a.jsx("h3",{children:"Duplicate rows"}),a.jsx("ul",{children:r.duplicates.map(h=>a.jsxs("li",{children:[a.jsxs("span",{children:["Row ",h.row]}),a.jsx("span",{className:"preview-popout__list-name",children:h.name})]},h.row))})]}),r.invalidCount>0&&Array.isArray(r.invalidRows)&&a.jsxs("div",{className:"preview-popout__list",children:[a.jsx("h3",{children:"Invalid rows"}),a.jsx("ul",{children:r.invalidRows.map(h=>a.jsxs("li",{children:[a.jsxs("span",{children:["Row ",h.row]}),a.jsx("span",{className:"preview-popout__list-name",children:h.reason})]},h.row))})]})]})]}),a.jsxs("footer",{className:"preview-popout__footer",children:[a.jsx("button",{type:"button",className:"preview-popout__dismiss",onClick:t,children:"Cancel"}),a.jsxs("button",{type:"button",className:"preview-popout__confirm",disabled:!m,onClick:c,children:[l?a.jsx(Nn,{className:"spin",size:18}):a.jsx(yT,{size:18}),"Run upload"]})]})]})]})}function ud({label:e,value:t,tone:r}){return a.jsxs("div",{className:`summary-metric${r?` summary-metric--${r}`:""}`,children:[a.jsx("span",{className:"summary-metric__label",children:e}),a.jsx("span",{className:"summary-metric__value",children:t}),r==="success"&&a.jsx("span",{className:"summary-metric__icon",children:a.jsx(Qd,{size:18})}),r==="warn"&&a.jsx("span",{className:"summary-metric__icon",children:a.jsx(Aa,{size:18})}),r==="error"&&a.jsx("span",{className:"summary-metric__icon",children:a.jsx(Aa,{size:18})})]})}function Yz(){const{token:e}=En(),{activeWorldId:t,contextKey:r}=Bn(),i=t||"",[l,c]=u.useState(null),[f,m]=u.useState(!1),[h,p]=u.useState(""),[y,g]=u.useState(""),[v,S]=u.useState([]),[w,N]=u.useState([]),[j,_]=u.useState(""),[C,O]=u.useState(null),[E,T]=u.useState(!1),[M,A]=u.useState(!1),[z,P]=u.useState(!1),[X,H]=u.useState(null),[Y,V]=u.useState(!1),[I,F]=u.useState(""),D=u.useRef(null);u.useEffect(()=>{(async()=>{if(!i){N([]);return}T(!0);try{const Q=await W1(i),ue=Array.isArray(Q?.data)?Q.data:Array.isArray(Q)?Q:[];N(ue)}catch(Q){console.warn(" Failed to load entity types",Q),N([])}finally{T(!1)}})()},[i,r]);const L=async()=>{try{const me=await fetch("/api/entities/upload",{headers:{Authorization:`Bearer ${e}`}});if(!me.ok)throw new Error("Failed to fetch uploads");const Q=await me.json();S(Q.files||[])}catch(me){console.warn(" Could not fetch uploads",me)}};u.useEffect(()=>{e&&L()},[e]);const B=me=>{const Q=me.target.files?.[0]??null;c(Q),p(""),g("")},k=async()=>{if(!l)return g("Please select a file to upload.");const me=new FormData;me.append("file",l),m(!0),p(""),g("");try{const Q=await fetch("/api/entities/upload",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:me}),ue=await Q.json();if(!Q.ok)throw new Error(ue.message||"Upload failed");p("File uploaded successfully."),c(null),D.current&&(D.current.value=""),await L()}catch(Q){console.error("Upload error:",Q),g(Q.message)}finally{m(!1)}},U=async me=>{if(window.confirm("Delete this upload?"))try{const Q=await fetch(`/api/entities/upload/${me}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),ue=await Q.json();if(!Q.ok)throw new Error(ue.message||"Failed to delete file");p("File deleted."),C===me&&(O(null),H(null)),await L()}catch(Q){console.error(" Delete error:",Q),g(Q.message)}},R=async()=>{if(j){g(""),p("");try{const me=await fetch(`/api/entities/template/${j}`,{headers:{Authorization:`Bearer ${e}`}});if(!me.ok)throw new Error("Failed to generate template");const Q=await me.blob(),ue=window.URL.createObjectURL(Q),ne=document.createElement("a");ne.href=ue,ne.download="Entity_Template.xlsx",document.body.appendChild(ne),ne.click(),ne.remove(),window.URL.revokeObjectURL(ue),p("Template generated successfully.")}catch(me){console.error(" Template generation failed",me),g("Failed to generate template")}}},q=async()=>{if(!j)return g("Select an Entity Type first.");if(!C)return g("Select an uploaded file to preview.");if(!i)return g("Select a world context before previewing.");P(!0),V(!0),H(null),F(""),p(""),g("");try{const me=await fetch(`/api/entities/preview/${j}`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({fileId:C,worldId:i})}),Q=await me.json();if(!me.ok||!Q.success)throw new Error(Q.message||"Preview failed");H(Q.summary)}catch(me){console.error(" Preview failed:",me),F(me.message)}finally{P(!1)}},G=async()=>{if(!j)return g("Select an Entity Type first.");if(!C)return g("Select an uploaded file to import.");if(!i)return g("Select a world context before importing.");A(!0),p(""),g("");try{const me=await fetch(`/api/entities/import/${j}`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({fileId:C,worldId:i})}),Q=await me.json();if(!me.ok)throw new Error(Q.message||"Import failed");p(Q.message||"Import completed successfully."),V(!1),H(null),await L()}catch(me){console.error(" Import error:",me),F(me.message)}finally{A(!1)}},J=()=>{M||z||(V(!1),F(""))},ie=u.useMemo(()=>w.find(me=>String(me.id)===String(j))?.name??"",[w,j]),Z=u.useMemo(()=>v.find(me=>me.id===C)??null,[v,C]);return u.useEffect(()=>{O(null),H(null),V(!1),c(null),D.current&&(D.current.value=""),p(""),g(""),F("")},[j]),a.jsxs("div",{className:"bulk-upload-page",children:[a.jsxs("div",{className:"bulk-upload-page__header",children:[a.jsx("h1",{className:"bulk-upload-page__title",children:"Bulk Entity Upload"}),a.jsx("p",{className:"bulk-upload-page__subtitle",children:"Follow the guided steps to prepare your template, upload a data file, preview the import, and launch the upload from a dedicated review panel."})]}),h&&a.jsxs("div",{className:"bulk-upload-page__status",children:[a.jsx(Qd,{size:18}),a.jsx("span",{children:h})]}),y&&a.jsxs("div",{className:"bulk-upload-page__status bulk-upload-page__status--error",children:[a.jsx(Aa,{size:18}),a.jsx("span",{children:y})]}),a.jsxs("div",{className:"bulk-upload-page__grid",children:[a.jsx(Po,{step:"Select",title:"Choose an entity type",subtitle:E?"Loading entity types for this world...":"Pick which entity type you want to work with. Steps unlock after choosing.",children:a.jsxs("select",{value:j,onChange:me=>_(me.target.value),className:"entity-type-select",children:[a.jsx("option",{value:"",children:E?"Loading":"Select Entity Type"}),w.map(me=>a.jsx("option",{value:me.id,children:me.name},me.id))]})}),j&&a.jsxs(a.Fragment,{children:[a.jsx(Po,{step:1,title:"Generate a template",subtitle:"Download a spreadsheet tailored to the selected entity type.",children:a.jsxs("div",{className:"step-actions",children:[a.jsxs("button",{type:"button",className:"primary-action",onClick:R,children:[a.jsx(NT,{size:18}),"Download template"]}),ie&&a.jsxs("span",{className:"selected-file-banner",children:[a.jsx(Ii,{size:16})," Template matches ",ie]})]})}),a.jsxs(Po,{step:2,title:"Upload your file",subtitle:"Upload the filled spreadsheet and pick which file to preview.",children:[a.jsxs("div",{className:"file-input",children:[a.jsxs("label",{htmlFor:"bulk-upload-file",children:[a.jsx(L0,{size:20}),a.jsxs("div",{children:[a.jsx("div",{className:"file-input__name",children:l?l.name:"Select a file to upload"}),a.jsx("small",{children:"Supported format: Excel (.xlsx)"})]})]}),a.jsx("input",{ref:D,id:"bulk-upload-file",type:"file",hidden:!0,onChange:B}),a.jsxs("button",{type:"button",className:"secondary-action",onClick:k,disabled:!l||f,children:[f?a.jsx(Nn,{className:"spin",size:18}):a.jsx(L0,{size:18}),"Upload file"]})]}),Z&&a.jsxs("div",{className:"selected-file-banner",children:[a.jsx(_T,{size:16})," Selected file: ",Z.file_name]}),a.jsx(Pz,{files:v,selectedId:C,onSelect:me=>{O(me),H(null)},onDelete:U})]}),a.jsx(Po,{step:3,title:"Run a preview",subtitle:"Review potential changes in the popout before committing to an upload.",children:a.jsxs("div",{className:"step-actions",children:[a.jsxs("button",{type:"button",className:"primary-action",onClick:q,disabled:!C||z,children:[z?a.jsx(Nn,{className:"spin",size:18}):a.jsx(C1,{size:18}),"Preview import"]}),a.jsx("span",{className:"bulk-upload-page__empty-state",children:"The upload can only be launched from the preview popout."})]})}),a.jsx(Po,{step:4,title:"Launch the upload",subtitle:"Confirm the summary inside the popout, then run the upload from there.",children:a.jsxs("div",{className:"step-actions",children:[a.jsxs("span",{className:"bulk-upload-page__empty-state",children:["After reviewing the preview, use the ",a.jsx("strong",{children:"Run upload"})," button in the panel to finish."]}),a.jsxs("span",{className:"selected-file-banner",children:[a.jsx(w1,{size:16})," Preview popout controls the final import."]})]})})]})]}),a.jsx(Vz,{isOpen:Y,onClose:J,preview:X,previewing:z,importing:M,onImport:G,error:I})]})}function wy({content:e="",mentions:t=[],segments:r=null,noteId:i="note",textClassName:l="note-text",mentionClassName:c="note-mention",renderEmpty:f=null}){const m=u.useMemo(()=>Array.isArray(r)?r:mc(e,t),[e,t,r]);return!m||m.length===0?typeof f=="function"?f():null:m.map((h,p)=>{if(h.type==="mention"&&h.entityId){const y=h.entityName||"entity";return a.jsxs("span",{className:c,children:["@",y,a.jsx(Is,{entityId:h.entityId,entityName:y})]},`${i}-mention-${p}`)}return a.jsx("span",{className:l,children:h.text},`${i}-text-${p}`)})}const Gz=2500,Cs=Object.freeze([]),Xz="Use @ to tag entities mentioned in this session.",Mp=(e="create")=>({mode:e,submitLabel:e==="edit"?"Save Changes":"Create Entity",submitDisabled:!1,cancelDisabled:!1,accessButtonVisible:!1,accessButtonDisabled:!1}),Rp=e=>{if(!e)return{id:"",sessionDate:"",sessionTitle:"Session note",content:"",mentions:Cs,createdAt:null,updatedAt:null,author:null,lastEditor:null};const t=e.sessionDate??e.session_date??"",r=e.sessionTitle??e.session_title??"Session note",i=typeof e.content=="string"?e.content:"",l=Array.isArray(e.mentions)?e.mentions.filter(Boolean).map(c=>{const f=c?.entityName??c?.entity_name??c?.label??c?.name??"",m=kl(f);return{...c,entityName:m}}):Cs;return{id:e.id??"",sessionDate:t,sessionTitle:r,content:i,mentions:l,createdAt:e.createdAt??e.created_at??null,updatedAt:e.updatedAt??e.updated_at??null,author:e.author??null,lastEditor:e.lastEditor??null}},dd=()=>new Date().toISOString().slice(0,10),fd=e=>{if(!e)return"Undated session";const t=/^\d{4}-\d{2}-\d{2}$/.test(e)?`${e}T00:00:00Z`:e,r=new Date(t);return Number.isNaN(r.getTime())?e:r.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},Kz=e=>{if(!e)return"";const t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};function Wz(){const{user:e}=En(),{selectedCampaign:t,selectedCampaignId:r}=Bn(),[i,l]=u.useState({items:Cs,loading:!1,error:""}),[c,f]=u.useState(""),[m,h]=u.useState(null),[p,y]=u.useState(!1),[g,v]=u.useState({status:"idle",lastSaved:"",error:""}),[S,w]=u.useState(""),[N,j]=u.useState(!1),[_,C]=u.useState(!1),[O,E]=u.useState(""),T=u.useRef(null),M=u.useRef(""),A=u.useRef(null),z=u.useRef(!1),P=u.useRef(""),[X,H]=u.useState(!1),[Y,V]=u.useState(()=>Mp("create")),[I,F]=u.useState("details"),D=u.useRef(`entity-form-${Math.random().toString(36).slice(2)}`),L=u.useMemo(()=>t?.world?.id?t.world.id:t?.world_id?t.world_id:"",[t]),B=u.useMemo(()=>!t||!Array.isArray(t.members)||!e?null:t.members.find(Qe=>Qe?.user_id===e.id)?.role??null,[t,e]),k=u.useMemo(()=>e?.role==="system_admin"?!0:B==="dm",[B,e]),U=u.useMemo(()=>e?.role==="system_admin"||B==="dm"?!0:B==="player"?(t?.world?.entity_creation_scope??"")===dc.ALL_PLAYERS:!1,[B,e,t]),R=u.useCallback(async()=>{if(r){l(He=>({...He,loading:!0,error:""}));try{const He=await qM(r),Qe=Array.isArray(He?.data)?He.data:Array.isArray(He)?He:[];l({items:Qe,loading:!1,error:""})}catch(He){console.error(" Failed to load session notes",He),l({items:Cs,loading:!1,error:He?.message||"Failed to load session notes"})}}},[r]);u.useEffect(()=>{if(!r){l({items:Cs,loading:!1,error:""}),f(""),h(null),A.current=null;return}R()},[r,R]),u.useEffect(()=>{T.current=m},[m]),u.useEffect(()=>{M.current=c},[c]);const q=u.useMemo(()=>Array.isArray(i.items)?[...i.items].sort((He,Qe)=>{const W=(He?.session_date??He?.sessionDate??"")||"",ee=(Qe?.session_date??Qe?.sessionDate??"")||"";if(W&&ee&&W!==ee)return ee.localeCompare(W);const te=new Date(He?.updated_at??He?.updatedAt??He?.created_at??He?.createdAt??0).getTime();return new Date(Qe?.updated_at??Qe?.updatedAt??Qe?.created_at??Qe?.createdAt??0).getTime()-te}):Cs,[i.items]),G=u.useMemo(()=>{const He=S.trim().toLowerCase();return He?q.filter(Qe=>{if(!Qe)return!1;const W=String(Qe?.session_title??Qe?.sessionTitle??"Session note").toLowerCase(),ee=String(Qe?.content??"").toLowerCase(),te=fd(Qe?.session_date??Qe?.sessionDate??"").toString().toLowerCase();return W.includes(He)||ee.includes(He)||te.includes(He)}):q},[S,q]),J=u.useMemo(()=>c&&q.find(He=>He?.id===c)||null,[q,c]),ie=u.useMemo(()=>m?.sessionDate?fd(m.sessionDate):"Undated session",[m?.sessionDate]),Z=u.useMemo(()=>m?.updatedAt?Kz(m.updatedAt):"",[m?.updatedAt]),me=u.useMemo(()=>m?.content?mc(m.content,m.mentions):Cs,[m?.content,m?.mentions]);u.useEffect(()=>{const He=S.trim().length>0,Qe=G.length>0?G:q;if(!c&&Qe.length>0){f(Qe[0].id);return}if(He&&G.length===0){c&&f(""),h(null),A.current=null;return}if(c&&G.length>0&&!G.some(te=>te?.id===c)){f(G[0].id);return}if(!c){h(null),A.current=null;return}if(!J){f(""),h(null),A.current=null;return}const W=Rp(J);h(W),A.current=W,v(ee=>({...ee,status:"idle",error:""}))},[G,S,J,c,q]),u.useEffect(()=>{if(!c){j(!1);return}if(P.current&&P.current===c){j(!0),P.current="";return}j(!1)},[c]),u.useEffect(()=>{E("")},[c]),u.useEffect(()=>{w("")},[r]);const Q=u.useCallback((He,Qe)=>{const W=typeof Qe=="string"?Qe:typeof He?.target?.value=="string"?He.target.value:"";h(ee=>ee&&{...ee,content:W})},[]),ue=u.useCallback(async(He,Qe)=>{const W=He?.trim()??"";if(typeof Qe=="function"){if(!L||W.length===0){Qe([]);return}try{const ee=await of({worldId:L,query:W,limit:8}),te=Array.isArray(ee?.data)?ee.data:ee,ve=Array.isArray(te)?te.map(le=>{const Se=le?.id??le?.entity?.id;if(!Se)return null;const Ee=le?.name||le?.displayName||le?.entity?.name||"Unnamed entity",ge=kl(Ee)||"Unnamed entity";return{id:Se,display:ge}}).filter(Boolean):[];Qe(ve)}catch(ee){console.error(" Failed to search entities for mentions",ee),Qe([])}}},[L]),ne=u.useCallback((He,Qe)=>{h(W=>W&&{...W,[He]:Qe})},[]),we=u.useMemo(()=>{if(!m?.id)return!1;const He={sessionTitle:(m.sessionTitle||"").trim(),sessionDate:m.sessionDate||"",content:m.content||""},Qe=A.current||{},W={sessionTitle:(Qe.sessionTitle||"").trim(),sessionDate:Qe.sessionDate||"",content:Qe.content||""};return JSON.stringify(He)!==JSON.stringify(W)},[m]),Pe=u.useCallback(async()=>{const He=r,Qe=M.current,W=T.current;if(!He||!Qe||!W||z.current)return;const ee={sessionTitle:W.sessionTitle?.trim()||"Session note",sessionDate:W.sessionDate||dd(),content:W.content||""},te=A.current||{},ve={sessionTitle:te.sessionTitle?.trim()||"Session note",sessionDate:te.sessionDate||dd(),content:te.content||""};if(JSON.stringify(ee)!==JSON.stringify(ve))try{z.current=!0,v(ge=>({...ge,status:"saving",error:""}));const le=await PM(He,Qe,ee),Se=le?.data??le,Ee=Rp(Se);A.current=Ee,h(Ee),l(ge=>{const at=Array.isArray(ge.items)?ge.items:Cs,st=at.some(nt=>nt?.id===Se?.id)?at.map(nt=>nt?.id===Se?.id?{...nt,...Se}:nt):[Se,...at];return{...ge,items:st}}),v({status:"saved",lastSaved:new Date().toISOString(),error:""})}catch(le){console.error(" Failed to save session note",le),v(Se=>({...Se,status:"error",error:le?.message||"Failed to save session note"}))}finally{z.current=!1}},[r]);u.useEffect(()=>{if(!r||!m?.id||!we||z.current)return;const He=setTimeout(()=>{Pe()},Gz);return()=>clearTimeout(He)},[m,we,Pe,r]);const Re=u.useCallback(()=>{Pe()},[Pe]),Ce=u.useCallback(async()=>{const He=r,Qe=M.current;if(!(!He||!Qe)){C(!0),E("");try{await VM(He,Qe),l(W=>{const te=(Array.isArray(W.items)?W.items:Cs).filter(ve=>String(ve?.id)!==String(Qe));return{...W,items:te}}),M.current="",f(""),h(null),A.current=null,v({status:"idle",lastSaved:"",error:""})}catch(W){console.error(" Failed to delete session note",W),E(W?.message||"Failed to delete session note")}finally{C(!1)}}},[r]),it=u.useCallback(async()=>{if(r){y(!0),v(He=>({...He,error:""}));try{const He=await HM(r,{sessionTitle:`Session on ${fd(dd())}`,sessionDate:dd()}),Qe=He?.data??He,W=Rp(Qe);l(ee=>{const ve=(Array.isArray(ee.items)?ee.items:Cs).filter(le=>le?.id!==Qe?.id);return{...ee,items:[Qe,...ve],error:""}}),w(""),P.current=Qe.id,f(Qe.id),h(W),A.current=W,j(!0),v({status:"idle",lastSaved:"",error:""})}catch(He){console.error(" Failed to create session note",He),v(Qe=>({...Qe,status:"error",error:He?.message||"Failed to create session note"}))}finally{y(!1)}}},[r]),qe=u.useCallback(()=>{L&&(V(Mp("create")),F("details"),H(!0))},[L]),We=u.useCallback(()=>{H(!1),V(Mp("create")),F("details")},[]),ke=u.useCallback(He=>{He&&V(Qe=>({...Qe,...He}))},[]),xt=u.useCallback(async He=>{We()},[We]),Mt=t?.name??"",Ct=q.length,At=u.useMemo(()=>{if(g.status==="saving")return"Saving";if(g.status==="error")return"Changes not saved";if(g.status==="saved"&&g.lastSaved){const He=new Date(g.lastSaved);return Number.isNaN(He.getTime())?"Saved":`Saved ${He.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})}`}return we?"Unsaved changes":""},[we,g]);return r?a.jsxs("div",{className:"notes-page",children:[a.jsx("div",{className:"notes-header",children:a.jsxs("div",{className:"notes-title",children:[a.jsx("h1",{children:"Session Notes"}),a.jsxs("p",{children:["Chronicle every game night for the ",a.jsx("strong",{children:Mt})," campaign, @mention key entities, and keep everyone aligned with auto-saving notes."]})]})}),a.jsxs("div",{className:"session-notes-meta",children:[a.jsxs("span",{children:[a.jsx(k1,{size:16})," Players and DMs can add or update notes."," ",a.jsx(I0,{size:16})," ",Ct," ",Ct===1?"session":"sessions"," tracked."]}),At?a.jsxs("span",{className:`session-notes-autosave status-${g.status}`,children:[g.status==="saving"?a.jsx(Nn,{size:14,className:"spinner"}):g.status==="saved"?a.jsx(N1,{size:14}):g.status==="error"?a.jsx(qa,{size:14}):we?a.jsx(F0,{size:14}):null,a.jsx("span",{children:At})]}):null]}),i.error&&a.jsxs("div",{className:"notes-error",role:"alert",children:[a.jsxs("strong",{children:[a.jsx(qa,{size:18})," Unable to load session notes"]}),a.jsx("span",{children:i.error})]}),a.jsxs("div",{className:"session-notes-layout",children:[a.jsxs("aside",{className:"session-notes-sidebar",children:[a.jsxs("label",{className:"session-notes-search",htmlFor:"session-notes-search-input",children:[a.jsx(ic,{size:16}),a.jsx("input",{id:"session-notes-search-input",type:"search",placeholder:"Search session notes",value:S,onChange:He=>w(He.target.value)})]}),a.jsxs("button",{type:"button",className:"session-notes-item-button session-notes-new-button",onClick:it,disabled:p||i.loading,children:[p?a.jsx(Nn,{size:16,className:"spinner"}):a.jsx(Pa,{size:16}),a.jsx("span",{children:p?"Creating":"New Session"})]}),a.jsx("div",{className:"session-notes-list-container",children:i.loading?a.jsxs("div",{className:"session-notes-loading",children:[a.jsx(Nn,{size:18,className:"spinner"}),a.jsx("span",{children:"Loading session notes"})]}):G.length===0?q.length===0?a.jsxs("div",{className:"notes-empty",children:[a.jsx(Ii,{size:20}),a.jsx("strong",{children:"No session notes yet"}),a.jsx("span",{children:"Create the first note to kick off your campaign journal."})]}):a.jsxs("div",{className:"notes-empty",children:[a.jsx(ic,{size:18}),a.jsx("strong",{children:"No matches"}),a.jsxs("span",{children:["No session notes include ",S.trim(),"."]})]}):a.jsx("ul",{className:"session-notes-list",role:"list",children:G.map(He=>{const Qe=He?.id,W=Qe===c,ee=He?.session_title??He?.sessionTitle??"Session note",te=fd(He?.session_date??He?.sessionDate);return a.jsx("li",{className:`session-notes-item ${W?"active":""}`,children:a.jsxs("button",{type:"button",className:"session-notes-item-button",onClick:()=>f(Qe),children:[a.jsx("span",{className:"session-note-card-title",children:ee}),a.jsx("span",{className:"session-note-card-date",children:te})]})},Qe)})})})]}),a.jsx("section",{className:"session-notes-panel",children:m?.id?a.jsxs("div",{className:"session-note-shell",children:[a.jsxs("header",{className:"session-note-header",children:[a.jsx("div",{className:"session-note-heading",children:a.jsx("h2",{children:m.sessionTitle||"Session note"})}),a.jsxs("div",{className:"session-note-toolbar",children:[k?a.jsxs("button",{type:"button",className:"session-note-action danger",onClick:Ce,disabled:_,children:[_?a.jsx(Nn,{size:16,className:"spinner"}):a.jsx(fa,{size:16}),a.jsx("span",{children:_?"Deleting":"Delete"})]}):null,a.jsxs("button",{type:"button",className:"session-note-action",onClick:()=>j(He=>!He),children:[N?a.jsx(E1,{size:16}):a.jsx(tM,{size:16}),a.jsx("span",{children:N?"View note":"Edit note"})]}),N&&U?a.jsxs("button",{type:"button",className:"session-note-action primary",onClick:qe,children:[a.jsx(Pa,{size:16}),a.jsx("span",{children:"Create Entity"})]}):null]})]}),O?a.jsxs("div",{className:"session-note-error",role:"alert",children:[a.jsx(qa,{size:16}),a.jsx("span",{children:O})]}):null,N?a.jsxs("div",{className:"session-note-form",children:[a.jsxs("div",{className:"session-note-fields session-note-fields-row",children:[a.jsxs("div",{className:"session-note-field",children:[a.jsx("label",{htmlFor:"session-note-title",children:"Title"}),a.jsx("input",{id:"session-note-title",type:"text",value:m.sessionTitle||"",onChange:He=>ne("sessionTitle",He.target.value),placeholder:"The mystery of the Violet Spire"})]}),a.jsxs("div",{className:"session-note-field",children:[a.jsx("label",{htmlFor:"session-note-date",children:"Session date"}),a.jsx("input",{id:"session-note-date",type:"date",value:m.sessionDate||"",onChange:He=>ne("sessionDate",He.target.value),max:"9999-12-31"})]})]}),a.jsxs("div",{className:"session-note-fields",children:[a.jsx("label",{htmlFor:"session-note-content",children:"Notes"}),a.jsx("div",{className:"session-note-editor-field",children:a.jsx(Od,{value:m.content||"",onChange:Q,markup:"@[__display__](__id__)",placeholder:Xz,className:"session-note-mentions",inputProps:{id:"session-note-content",className:"session-note-textarea","aria-label":"Session note content",rows:14},children:a.jsx(Rl,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(He,Qe)=>`@${Qe}`,data:ue,appendSpaceOnAdd:!0})})}),a.jsx("div",{className:"session-note-save-button",children:a.jsxs("button",{type:"button",className:"session-note-action primary",onClick:Re,disabled:g.status==="saving"||!we,children:[g.status==="saving"?a.jsx(Nn,{size:16,className:"spinner"}):a.jsx(F0,{size:16}),a.jsx("span",{children:g.status==="saving"?"Saving":"Save now"})]})}),me.length>0?a.jsxs("div",{className:"session-note-preview","aria-live":"polite",children:[a.jsx("h3",{children:"Preview"}),a.jsx("div",{className:"session-note-preview-content",children:a.jsx(wy,{segments:me,noteId:`${m?.id||"note"}-preview`,textClassName:"session-note-text",mentionClassName:"session-note-mention"})})]}):null]}),a.jsx("div",{className:"session-note-actions",children:m.author?.username?a.jsxs("span",{className:"session-note-meta",children:["Created by ",m.author.username,m.lastEditor?.username&&m.lastEditor.username!==m.author.username?`  Last updated by ${m.lastEditor.username}`:""]}):null})]}):a.jsxs("article",{className:"session-note-view","aria-live":"polite",children:[a.jsxs("div",{className:"session-note-view-meta",children:[a.jsxs("span",{children:[a.jsx(I0,{size:16})," ",ie]}),Z?a.jsxs("span",{children:["Updated ",Z]}):null]}),a.jsx("div",{className:"session-note-view-body",children:a.jsx(wy,{segments:me,noteId:`${m?.id||"note"}-view`,textClassName:"session-note-text",mentionClassName:"session-note-mention",renderEmpty:()=>a.jsx("p",{className:"session-note-view-empty",children:"No notes captured yet."})})}),m.author?.username?a.jsxs("div",{className:"session-note-view-meta session-note-view-authors",children:[a.jsxs("span",{children:["Created by ",m.author.username]}),m.lastEditor?.username&&m.lastEditor.username!==m.author.username?a.jsxs("span",{children:["Last updated by ",m.lastEditor.username]}):null]}):null]})]}):a.jsxs("div",{className:"notes-helper",children:[a.jsx(Hp,{size:28}),a.jsx("strong",{children:"Select a session to get started"}),a.jsx("span",{children:"Create a new note or choose one from the list to see its details."})]})})]}),a.jsx(Yr,{isOpen:X,onClose:We,title:"Create Entity",width:420,footerActions:a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"btn cancel",onClick:We,disabled:Y.cancelDisabled,children:"Cancel"}),Y.accessButtonVisible&&a.jsx("button",{type:"button",className:"btn secondary",onClick:()=>F(He=>He==="access"?"details":"access"),disabled:Y.accessButtonDisabled,children:I==="access"?"Details":"Access"}),a.jsx("button",{type:"submit",className:"btn submit",form:D.current,disabled:Y.submitDisabled,children:Y.submitLabel})]}),children:a.jsx(pN,{worldId:L,entityId:null,onCancel:We,onSaved:xt,formId:D.current,onStateChange:ke,hideActions:!0,activeView:I,onViewChange:F,defaultCampaignId:r||""})})]}):a.jsxs("div",{className:"notes-page",children:[a.jsx("div",{className:"notes-header",children:a.jsxs("div",{className:"notes-title",children:[a.jsx("h1",{children:"Session Notes"}),a.jsx("p",{children:"Select a campaign from the header to start collecting your notes."})]})}),a.jsxs("div",{className:"notes-helper",children:[a.jsx(Hp,{size:28}),a.jsx("strong",{children:"No campaign selected"}),a.jsx("span",{children:"Pick a campaign to unlock collaborative session notes."})]})]})}const Zz={private:"Private",party:"Party",companions:"Companions",dm:"DM"},Qz=[{value:"private",label:"Private"},{value:"companions",label:"My Companions"}],Jz=[{value:"private",label:"Private"},{value:"party",label:"Share with Party"}],e$="What do you want to remember?",t$=e=>{if(!e)return"";const t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})},vi=e=>{const t=[e?.entityId,e?.entity_id,e?.entity?.id];for(const r of t)if(r)return String(r);return""},kp=e=>{const t=[e?.author?.id,e?.createdBy,e?.created_by];for(const r of t)if(r)return String(r);return""},Iw=e=>{const t=e?.author;return t?.username?t.username:t?.email?t.email:e?.character?.name?`${e.character.name} (Character)`:(e?.created_by,"Unknown author")},Lw=e=>e?.entity?.name?e.entity.name:typeof e?.entityName=="string"&&e.entityName.trim()?e.entityName:"Unnamed entity",Ny=e=>{const t=[e?.entity?.entityTypeId,e?.entity?.entity_type_id,e?.entity?.entityType?.id,e?.entity?.entityType?.entity_type_id];for(const r of t)if(r)return String(r);return""},n$=(e,t=new Map)=>{if(e?.entity?.entityType?.name)return e.entity.entityType.name;const r=Ny(e);return r&&t.has(r)?t.get(r):""};function a$(){const{selectedCampaign:e,selectedCampaignId:t}=Bn(),{user:r}=En(),[i,l]=u.useState({items:[],loading:!1,error:""}),[c,f]=u.useState(""),[m,h]=u.useState(""),[p,y]=u.useState(""),[g,v]=u.useState(null),[S,w]=u.useState(""),[N,j]=u.useState("private"),[_,C]=u.useState(""),[O,E]=u.useState(!1),[T,M]=u.useState(null),[A,z]=u.useState(""),[P,X]=u.useState([]),[H,Y]=u.useState(!1),[V,I]=u.useState(""),[F,D]=u.useState([]),[L,B]=u.useState(!1),k=u.useCallback(async()=>{if(t){l(W=>({...W,loading:!0,error:""}));try{const W=await UM(t),ee=Array.isArray(W?.data)?W.data:Array.isArray(W)?W:[];l({items:ee,loading:!1,error:""})}catch(W){console.error(" Failed to load campaign entity notes",W),l({items:[],loading:!1,error:W?.message||"Failed to load entity notes"})}}},[t]);u.useEffect(()=>{if(!t){l({items:[],loading:!1,error:""});return}k()},[t,k]),u.useEffect(()=>{f(""),h(""),y(""),v(null),w(""),j("private"),C(""),z("")},[t]);const R=u.useMemo(()=>!e||!r?.id?null:(Array.isArray(e.members)?e.members:[]).find(te=>{if(!te)return!1;const ve=te.user_id??te.userId??te.user?.id??te.id??null;return ve?String(ve)===String(r.id):!1})||null,[e,r?.id])?.role??null,q=u.useMemo(()=>r?.role==="system_admin"?!0:R==="dm",[R,r?.role]),G=u.useMemo(()=>R==="player",[R]),J=u.useMemo(()=>e?.world?.id?e.world.id:e?.world_id?e.world_id:"",[e]);u.useEffect(()=>{let W=!1;return J?((async()=>{B(!0);try{const te=await Qr({worldId:J});if(W)return;const le=(Array.isArray(te?.data)?te.data:Array.isArray(te)?te:[]).map(Se=>({id:Se?.id?String(Se.id):"",name:Se?.name||"Unnamed type"})).filter(Se=>Se.id);D(le)}catch(te){if(W)return;console.error("Failed to load entity types",te),D([])}finally{W||B(!1)}})(),()=>{W=!0}):(D([]),B(!1),()=>{W=!0})},[J]);const ie=u.useMemo(()=>q?Jz:Qz,[q]),Z=u.useCallback(W=>{if(!r||!W)return!1;const ee=W?.author?.id??W?.createdBy??W?.created_by??W?.authorId??W?.author_id??null;return ee?String(ee)===String(r.id):!1},[r]);u.useEffect(()=>{let W=!1;return!G||!t?(X([]),Y(!1),I(""),C(""),()=>{W=!0}):((async()=>{Y(!0),I("");try{const te=await Ds({scope:"my",campaign_id:t});if(W)return;const le=(Array.isArray(te?.data)?te.data:Array.isArray(te)?te:[]).map(Se=>({id:Se?.id?String(Se.id):"",name:Se?.name||"Unnamed character"})).filter(Se=>Se.id);X(le),le.length===1?C(le[0].id):le.some(Se=>Se.id===_)||C("")}catch(te){if(W)return;console.error("Failed to load characters for notes",te),X([]),C(""),I(te.message||"Failed to load characters")}finally{W||Y(!1)}})(),()=>{W=!0})},[G,t,_]);const me=u.useCallback(async(W,ee)=>{const te=W?.trim()??"";if(typeof ee!="function")return;if(te.length===0){ee([]);return}let ve="";if(g){const Ee=i.items.find(ge=>ge?.id===g);Ee&&(ve=vi(Ee))}if(ve||(ve=c||""),!ve){ee([]);return}const le=i.items.find(Ee=>vi(Ee)===ve),Se=le?.entity?.world_id??le?.entity?.world?.id??"";if(!Se){ee([]);return}try{const Ee=await of({worldId:Se,query:te,limit:8}),ge=Array.isArray(Ee?.data)?Ee.data:Ee,at=Array.isArray(ge)?ge.map(st=>{const nt=st?.id??st?.entity?.id;if(!nt)return null;const ze=st?.name||st?.displayName||st?.entity?.name||"Unnamed entity",ft=kl(ze)||"Unnamed entity";return{id:nt,display:ft}}).filter(Boolean):[];ee(at)}catch(Ee){console.error("Failed to search entities for mentions",Ee),ee([])}},[c,i.items,g]),Q=u.useCallback(W=>{if(!W)return;const ee=W?.characterId??W?.character_id??"";v(W.id),w(W?.content??""),j(W?.shareType??W?.share_type??"private"),C(ee),z("")},[]),ue=u.useCallback(()=>{v(null),w(""),j("private"),C(""),z("")},[]),ne=u.useCallback((W,ee)=>{const te=typeof ee=="string"?ee:typeof W?.target?.value=="string"?W.target.value:"";w(te),z("")},[]),we=u.useCallback(async W=>{if(!W||!t)return;const ee=S.trim();if(!ee){z("Please enter a note before saving");return}const te=vi(W);if(!te){z("Unable to determine entity for this note");return}const ve=W?.characterId??W?.character_id??"";if(G&&ve&&!_){z("Select which character this note is for");return}E(!0),z("");try{const le={content:ee,shareType:N,campaignId:t};G&&_&&(le.characterId=_);const Se=await G1(te,W.id,le),Ee=Se?.data||Se;if(!Ee)throw new Error("Note could not be updated");l(ge=>{const at=Array.isArray(ge?.items)?ge.items.slice():[],st=Ee?.id;if(!st)return ge;const nt=at.findIndex(ze=>ze?.id===st);if(nt>=0){const ze=[...at];return ze[nt]=Ee,{items:ze,loading:!1,error:""}}return ge}),ue()}catch(le){console.error("Failed to update note",le),z(le.message||"Failed to update note")}finally{E(!1)}},[t,S,N,_,G,ue]),Pe=u.useCallback(async W=>{if(!W?.id||!t||!window.confirm("Are you sure you want to delete this note? This action cannot be undone."))return;const te=vi(W);if(!te){z("Unable to determine entity for this note");return}M(W.id),z("");try{await X1(te,W.id,{campaignId:t}),l(ve=>({items:(Array.isArray(ve?.items)?ve.items.slice():[]).filter(Ee=>Ee?.id!==W.id),loading:!1,error:""}))}catch(ve){console.error("Failed to delete note",ve),z(ve.message||"Failed to delete note")}finally{M(null)}},[t]),Re=u.useCallback(W=>{const ee=mc(W?.content,W?.mentions);return ee.length?ee.map((te,ve)=>{if(te.type==="mention"&&te.entityId){const le=`${W?.id||"note"}-mention-${ve}`,Se=te.entityName||"entity";return a.jsxs("span",{className:"note-mention",children:["@",Se]},le)}return a.jsx("span",{className:"note-text",children:te.text},`${W?.id||"note"}-text-${ve}`)}):null},[]),Ce=u.useMemo(()=>Array.isArray(i.items)?[...i.items].sort((W,ee)=>{const te=new Date(W?.created_at||W?.createdAt||0).getTime(),ve=new Date(ee?.created_at||ee?.createdAt||0).getTime();return Number.isNaN(ve)?-1:Number.isNaN(te)?1:ve-te}):[],[i.items]),it=u.useMemo(()=>{const W=new Map;return Ce.forEach(ee=>{const te=vi(ee);if(!te)return;const ve=Lw(ee);W.has(te)||W.set(te,ve)}),Array.from(W.entries()).map(([ee,te])=>({id:ee,name:te})).sort((ee,te)=>ee.name.localeCompare(te.name,void 0,{sensitivity:"base"}))},[Ce]),qe=u.useMemo(()=>{const W=new Map;return Ce.forEach(ee=>{const te=kp(ee);if(!te)return;const ve=Iw(ee);W.has(te)||W.set(te,ve)}),Array.from(W.entries()).map(([ee,te])=>({id:ee,name:te})).sort((ee,te)=>ee.name.localeCompare(te.name,void 0,{sensitivity:"base"}))},[Ce]),We=u.useMemo(()=>{const W=new Map;return F.forEach(ee=>{ee.id&&W.set(ee.id,ee.name)}),W},[F]),ke=u.useMemo(()=>{const W=new Map;return Ce.forEach(ee=>{const te=Ny(ee);if(!te)return;const ve=n$(ee,We)||`Type ${te.slice(0,8)}`;W.has(te)||W.set(te,ve)}),Array.from(W.entries()).map(([ee,te])=>({id:ee,name:te})).sort((ee,te)=>ee.name.localeCompare(te.name,void 0,{sensitivity:"base"}))},[Ce,We]),xt=u.useMemo(()=>Ce.filter(W=>{const ee=vi(W),te=kp(W),ve=Ny(W);return!(c&&ee!==c||m&&te!==m||p&&ve!==p)}),[Ce,c,m,p]),Mt=u.useCallback(()=>{if(!r?.id)return;const W=String(r.id),ee=qe.find(te=>Ce.find(le=>kp(le)===te.id&&Z(le))!==void 0);ee?(h(ee.id),f("")):qe.some(te=>te.id===W)&&(h(W),f(""))},[r?.id,qe,Ce,Z]),Ct=e?.name??"",At=xt.length,He=Ce.length,Qe=!!(c||m||p);return t?a.jsxs("div",{className:"notes-page",children:[a.jsxs("div",{className:"notes-header",children:[a.jsxs("div",{className:"notes-title",children:[a.jsx("h1",{children:"Entity Notes"}),a.jsxs("p",{children:["Browse the notes created for entities in the"," ",a.jsx("strong",{children:Ct})," campaign, filter by entity or author, and jump back into the context of your adventures."]})]}),a.jsx("div",{className:"notes-actions",children:a.jsxs("button",{type:"button",className:"notes-action-button",onClick:k,disabled:i.loading,title:"Reload notes",children:[a.jsx(zl,{size:16}),a.jsx("span",{children:i.loading?"Loading":"Reload"})]})})]}),a.jsxs("div",{className:"notes-filters",children:[a.jsxs("div",{className:"notes-filter-group",children:[a.jsx("label",{htmlFor:"entity-filter",children:"Entity"}),a.jsxs("select",{id:"entity-filter",value:c,onChange:W=>f(W.target.value),disabled:i.loading||it.length===0,children:[a.jsx("option",{value:"",children:"All entities"}),it.map(W=>a.jsx("option",{value:W.id,children:W.name},W.id))]})]}),a.jsxs("div",{className:"notes-filter-group",children:[a.jsx("label",{htmlFor:"author-filter",children:"Author"}),a.jsxs("select",{id:"author-filter",value:m,onChange:W=>h(W.target.value),disabled:i.loading||qe.length===0,children:[a.jsx("option",{value:"",children:"All authors"}),qe.map(W=>a.jsx("option",{value:W.id,children:W.name},W.id))]})]}),a.jsxs("div",{className:"notes-filter-group",children:[a.jsx("label",{htmlFor:"entity-type-filter",children:"Entity type"}),a.jsxs("select",{id:"entity-type-filter",value:p,onChange:W=>y(W.target.value),disabled:i.loading||ke.length===0,children:[a.jsx("option",{value:"",children:"All entity types"}),ke.map(W=>a.jsx("option",{value:W.id,children:W.name},W.id))]})]}),a.jsxs("button",{type:"button",className:"notes-action-button",onClick:()=>{f(""),h(""),y("")},disabled:!Qe,children:[a.jsx(Jd,{size:16}),a.jsx("span",{children:"Reset filters"})]}),r?.id&&a.jsx("button",{type:"button",className:"notes-action-button",onClick:Mt,title:"Show only my notes",children:a.jsx("span",{children:"My notes"})})]}),a.jsxs("div",{className:"notes-meta",children:[a.jsxs("span",{children:["Showing ",a.jsx("strong",{children:At})," of ",a.jsx("strong",{children:He})," ",He===1?"note":"notes",Qe?" (filtered)":""]}),i.loading&&a.jsx("span",{children:"Loading latest notes"})]}),i.error&&a.jsxs("div",{className:"notes-error",role:"alert",children:[a.jsxs("strong",{children:[a.jsx(qa,{size:18})," Unable to load entity notes"]}),a.jsx("span",{children:i.error})]}),!i.loading&&!i.error&&xt.length===0&&a.jsxs("div",{className:"notes-empty",children:[a.jsx("strong",{children:"No notes to show"}),a.jsx("span",{children:He===0?"No entity notes have been shared in this campaign yet.":"Adjust your filters to see more notes."})]}),A&&a.jsxs("div",{className:"notes-error",role:"alert",children:[a.jsxs("strong",{children:[a.jsx(qa,{size:18})," Error"]}),a.jsx("span",{children:A})]}),xt.length>0&&a.jsx("div",{className:"notes-list",children:xt.map(W=>{const ee=vi(W),te=String(W?.shareType||W?.share_type||"private"),ve=W?.created_at||W?.createdAt,le=ve?new Date(ve):null,Se=t$(le),Ee=le&&!Number.isNaN(le.getTime())?le.toISOString():"",ge=Iw(W),at=W?.character?.name??"",st=Lw(W),nt=g===W?.id,ze=Z(W);return a.jsx("article",{className:"note-card",children:nt?a.jsxs("div",{className:"entity-notes-strict-edit-panel",style:{padding:"1rem"},children:[a.jsx(Od,{value:S,onChange:ne,markup:"@[__display__](__id__)",placeholder:e$,className:"entity-note-mentions",inputProps:{className:"entity-notes-strict-textarea","aria-label":"Edit note content",rows:5,required:!0},children:a.jsx(Rl,{trigger:"@",markup:"@[__display__](__id__)",displayTransform:(ft,zt)=>`@${zt}`,data:me,appendSpaceOnAdd:!0})}),a.jsx("p",{style:{marginTop:"0.75rem",marginBottom:"0.5rem",fontWeight:600},children:"Share with"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"0.75rem"},children:ie.map(ft=>a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx("input",{type:"radio",name:`entity-note-share-edit-${W.id}`,value:ft.value,checked:N===ft.value,onChange:()=>j(ft.value),disabled:O}),ft.value==="private"?"Private":ft.value==="party"?"Share with Party":ft.label]},ft.value))}),G&&P.length>0&&a.jsxs("div",{style:{marginBottom:"0.75rem"},children:[a.jsx("label",{htmlFor:`edit-character-${W.id}`,style:{display:"block",marginBottom:"0.25rem",fontWeight:600},children:"Character"}),a.jsx("select",{id:`edit-character-${W.id}`,value:_,onChange:ft=>C(ft.target.value),disabled:H||P.length===1,style:{width:"100%",padding:"0.5rem",borderRadius:"8px",border:"1px solid #cbd5f5"},children:P.map(ft=>a.jsx("option",{value:ft.id,children:ft.name},ft.id))})]}),A?a.jsxs("div",{className:"notes-error",style:{marginTop:"0.75rem",marginBottom:"0.75rem"},children:[a.jsx(qa,{size:16}),a.jsx("span",{children:A})]}):null,a.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.75rem"},children:[a.jsx("button",{type:"button",className:"notes-action-button",onClick:()=>we(W),disabled:O||!S.trim(),children:O?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:16,style:{animation:"spinner-rotate 1s linear infinite"}}),"Saving"]}):"Save"}),a.jsx("button",{type:"button",className:"notes-action-button",onClick:ue,disabled:O,style:{background:"#64748b"},children:"Cancel"})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("header",{className:"note-card-header",children:[a.jsx("div",{className:"note-entity-meta",children:a.jsx("h2",{children:ee?a.jsxs("span",{className:"entity-link-with-preview",children:[a.jsx(Jt,{to:`/entities/${ee}`,className:"entity-name-link",children:st}),a.jsx(Is,{entityId:ee,entityName:st})]}):st})}),a.jsx("div",{className:"note-tags",children:a.jsx("span",{className:`note-tag share-${te}`,children:Zz[te]??te})})]}),a.jsxs("div",{className:"note-details",children:[a.jsxs("span",{children:["Author: ",ge]}),at?a.jsxs("span",{children:["Character: ",at]}):null,Se?a.jsxs("span",{children:["Created:"," ",a.jsx("time",{dateTime:Ee||void 0,children:Se})]}):null]}),a.jsx("div",{className:"note-content",children:Re(W)||a.jsx(wy,{content:W?.content,mentions:W?.mentions,noteId:W?.id||ee||"note",textClassName:"note-text",mentionClassName:"note-mention"})}),ze&&a.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",paddingTop:"0.75rem",borderTop:"1px solid rgba(15, 23, 42, 0.1)"},children:[a.jsxs("button",{type:"button",className:"notes-action-button",onClick:()=>Q(W),style:{background:"#1e40af",color:"#fff"},children:[a.jsx(T1,{size:14}),a.jsx("span",{children:"Edit"})]}),a.jsxs("button",{type:"button",className:"notes-action-button",onClick:()=>Pe(W),disabled:T===W.id,style:{background:"#dc2626",color:"#fff"},children:[T===W.id?a.jsx(Nn,{size:14,className:"spin",style:{animation:"spinner-rotate 1s linear infinite"}}):a.jsx(fa,{size:14}),a.jsx("span",{children:T===W.id?"Deleting":"Delete"})]})]})]})},W.id??`${ee}-${Ee||"unknown"}`)})})]}):a.jsxs("div",{className:"notes-page",children:[a.jsx("div",{className:"notes-header",children:a.jsxs("div",{className:"notes-title",children:[a.jsx("h1",{children:"Entity Notes"}),a.jsx("p",{children:"Select a campaign from the header to view entity notes."})]})}),a.jsxs("div",{className:"notes-empty",children:[a.jsx("strong",{children:"No campaign selected"}),a.jsx("span",{children:"Pick a campaign to explore its shared entity notes."})]})]})}const s$=(e,t)=>_t.post("/access/bulk/apply",e,t),r$=({worldId:e})=>{if(!e)return Promise.reject(new Error("worldId is required"));const t=new URLSearchParams({worldId:e});return _t.get(`/access/bulk/runs?${t.toString()}`)},i$=e=>e?_t.get(`/access/bulk/runs/${e}`):Promise.reject(new Error("runId is required")),l$=e=>e?_t.post(`/access/bulk/runs/${e}/revert`):Promise.reject(new Error("runId is required")),bj=e=>{if(!e)return Promise.reject(new Error("worldId is required"));const t=new URLSearchParams({worldId:e});return _t.get(`/access/collections?${t.toString()}`)},o$=e=>_t.post("/access/collections",e),c$=(e,t)=>e?_t.put(`/access/collections/${e}`,t):Promise.reject(new Error("Collection id is required")),u$=e=>e?_t.delete(`/access/collections/${e}`):Promise.reject(new Error("Collection id is required")),d$=e=>e?_t.get(`/access/collections/${e}/entities`):Promise.reject(new Error("Collection id is required")),Js=1e3,ya={NAME:"name",NAME_DESCRIPTION:"nameDescription",ALL_DATA:"allData",ALL_DATA_RELATIONSHIPS:"allDataRelationships"},_d=[{value:ya.NAME,label:"Name only",description:"Matches entity names only."},{value:ya.NAME_DESCRIPTION,label:"Name & description",description:"Matches entity names and their descriptions."},{value:ya.ALL_DATA,label:"All data",description:"Matches names, descriptions, and visible data fields."},{value:ya.ALL_DATA_RELATIONSHIPS,label:"All data & relationships",description:"Matches every field plus reference values, ideal for relationship lookups."}],Ow={[ya.NAME]:"Filter entities by name",[ya.NAME_DESCRIPTION]:"Search names or descriptions",[ya.ALL_DATA]:"Search names, descriptions, and data fields",[ya.ALL_DATA_RELATIONSHIPS]:"Search across data and related entities"},zw=140,nc=(e,t)=>{if(t==null||typeof t=="number"&&!Number.isFinite(t))return;const i=(t instanceof Date?t.toISOString():String(t)).trim().toLowerCase();i&&e.add(i)},Ey=(e,t,r)=>{if(e!=null){if(typeof e=="string"||typeof e=="number"||typeof e=="boolean"){nc(r,e);return}if(e instanceof Date){nc(r,e);return}if(Array.isArray(e)){e.forEach(i=>Ey(i,t,r));return}t&&typeof e=="object"&&Object.values(e).forEach(i=>Ey(i,t,r))}},f$=(e,t)=>{if(!e)return[];const r=t&&_d.some(l=>l.value===t)?t:ya.NAME,i=new Set;return nc(i,e.name),r!==ya.NAME&&nc(i,e.description),(r===ya.ALL_DATA||r===ya.ALL_DATA_RELATIONSHIPS)&&(nc(i,e.entityType?.name),e.metadata&&typeof e.metadata=="object"&&Ey(e.metadata,r===ya.ALL_DATA_RELATIONSHIPS,i)),Array.from(i)},$w=(e,t="start")=>{if(!e)return null;const r=new Date(e);return Number.isNaN(r.getTime())?null:(t==="end"?r.setHours(23,59,59,999):r.setHours(0,0,0,0),r.getTime())},Fw=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})},m$=e=>{if(!e)return"";const t=Fw(e.updatedAt||e.updated_at);if(t)return`Updated ${t}`;const r=Fw(e.createdAt||e.created_at);return r?`Created ${r}`:""},h$=e=>{if(!e)return"";const t=e.summary||e.summary_text||e.description||e.system_prompt||e.notes||"",r=typeof t=="string"?t.replace(/\s+/g," ").trim():"";return r?r.length<=zw?r:`${r.slice(0,zw-1).trim()}`:""},Vo=({label:e,count:t,options:r=[],selectedValues:i=[],onToggle:l,disabled:c})=>{const f=m=>{c||l(String(m))};return a.jsxs("div",{className:"token-selector",children:[a.jsxs("div",{className:"token-selector__label-row",children:[a.jsx("span",{children:e}),a.jsxs("span",{className:"token-selector__count",children:["(",t,")"]})]}),a.jsx("div",{className:"token-selector__chips",role:"listbox","aria-multiselectable":!0,children:r.length===0?a.jsx("p",{className:"token-selector__empty",children:"No options available."}):r.map(m=>{const h=String(m.id),p=i.includes(h);return a.jsx("button",{type:"button",className:`token-selector__chip ${p?"selected":""}`,onClick:()=>f(h),"aria-pressed":p,disabled:c,children:m.label},h)})})]})},Lr=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],Dp=(e,t="name")=>e.map(r=>({id:String(r.id??r.value??r),label:r[t]||r.name||r.email||r.id})),Bw=e=>{const t=e.filter(r=>r.count>0).map(r=>`${r.count} ${r.label}${r.count===1?"":"s"}`);return t.length===0?"":t.length===1?t[0]:t.length===2?`${t[0]} and ${t[1]}`:`${t.slice(0,-1).join(", ")}, and ${t[t.length-1]}`};function Uw(){const{worldId:e,campaignId:t}=vs(),r=zn(),{user:i}=En(),{selectedCampaign:l,selectedCampaignId:c,setSelectedCampaignId:f,loading:m}=Bn(),[h,p]=u.useState(null),[y,g]=u.useState(""),[v,S]=u.useState(!0),[w,N]=u.useState([]),[j,_]=u.useState([]),[C,O]=u.useState([]),[E,T]=u.useState([]),[M,A]=u.useState(!1),[z,P]=u.useState(""),[X,H]=u.useState(""),[Y,V]=u.useState(ya.NAME),[I,F]=u.useState(""),[D,L]=u.useState(""),[B,k]=u.useState([]),[U,R]=u.useState(!1),[q,G]=u.useState(""),[J,ie]=u.useState(null),[Z,me]=u.useState({readCampaignIds:[],readUserIds:[],readCharacterIds:[],writeCampaignIds:[],writeUserIds:[],description:""}),[Q,ue]=u.useState("unchanged"),[ne,we]=u.useState("unchanged"),[Pe,Re]=u.useState(!1),[Ce,it]=u.useState("manual"),[qe,We]=u.useState([]),[ke,xt]=u.useState(!1),[Mt,Ct]=u.useState(""),[At,He]=u.useState(""),[Qe,W]=u.useState(null),[ee,te]=u.useState(!1),ve=!!t,le=t?String(t):"",Se=u.useMemo(()=>!ve||!le||!c?!1:String(c)===le,[ve,le,c]),Ee=ve&&Se?l:null,ge=e||Ee?.world?.id||"";u.useEffect(()=>{!ve||!le||String(c||"")!==le&&f(le)},[ve,le,c,f]);const at=u.useMemo(()=>ve||!h||!i?!1:String(h.created_by)===String(i.id),[ve,h,i]),st=u.useMemo(()=>!ve||!Ee||!i?.id||!Array.isArray(Ee.members)?!1:Ee.members.some(_e=>_e?.user_id===i.id&&_e?.role==="dm"),[Ee,ve,i]),nt=!!(ve&&Ee&&st),ze=at||nt;u.useEffect(()=>{if(!ge||!ze){We([]),Ct(""),He(""),W(null);return}let _e=!1;return(async()=>{xt(!0),Ct("");try{const mt=await bj(ge),fe=Lr(mt);_e||We(fe)}catch(mt){_e||(console.error("Failed to load collections",mt),We([]),Ct(mt.message||"Failed to load collections"))}finally{_e||xt(!1)}})(),()=>{_e=!0}},[ge,ze]),u.useEffect(()=>{if(ve){if(!le){g("Campaign id is required to use this tool."),S(!1);return}if(!Ee){if(m){S(!0);return}g("Campaign not found or unavailable for your account."),S(!1);return}p(Ee.world||null),g(""),S(!1);return}if(!e){g("A world id is required to use the bulk access tool."),S(!1);return}(async()=>{S(!0),g("");try{const tt=await $l(),fe=Lr(tt).find(he=>String(he.id)===String(e));if(!fe){g("World not found or unavailable."),p(null);return}p(fe)}catch(tt){console.error("Failed to load worlds",tt),g(tt.message||"Failed to load world data"),p(null)}finally{S(!1)}})()},[Ee,m,ve,le,e]);const ft=u.useCallback(async()=>{if(!(!ge||!ze)){A(!0),P("");try{if(ve&&Ee){const[_e,tt]=await Promise.all([oc(ge),Ds({campaign_id:Ee.id})]);N(Lr(_e)),_([Ee]),O(Lr(tt));const mt=Array.isArray(Ee.members)?Ee.members.map(fe=>({id:String(fe.user_id),username:fe.user?.username||fe.user?.email||fe.user_id})):[];T(mt)}else{const[_e,tt,mt,fe]=await Promise.all([oc(ge),_c({world_id:ge}),Ds({world_id:ge}),ng()]);N(Lr(_e)),_(Lr(tt)),O(Lr(mt)),T(Lr(fe))}}catch(_e){console.error("Failed to load bulk access data",_e),P(_e.message||"Unable to load world data")}finally{A(!1)}}},[Ee,ze,ve,ge]);u.useEffect(()=>{ft()},[ft]);const zt=u.useMemo(()=>ve?new Set((C||[]).map(_e=>String(_e.id))):new Set,[C,ve]),Rt=u.useMemo(()=>{if(!ve)return w;if(!Ee)return[];const _e=String(Ee.id);return w.filter(tt=>(tt.read_access??"global")==="global"||(Array.isArray(tt.read_campaign_ids)?tt.read_campaign_ids.map(Ve=>String(Ve)):[]).includes(_e)?!0:(Array.isArray(tt.read_character_ids)?tt.read_character_ids.map(Ve=>String(Ve)):[]).some(Ve=>zt.has(Ve)))},[Ee,zt,w,ve]);u.useEffect(()=>{const _e=new Set(Rt.map(tt=>tt.id));k(tt=>{const mt=tt.filter(fe=>_e.has(fe));return mt.length===tt.length?tt:mt})},[Rt]);const pt=u.useMemo(()=>{const _e=X.trim().toLowerCase(),tt=$w(I,"start"),mt=$w(D,"end");return Rt.filter(fe=>{const he=fe.createdAt??fe.created_at??null;if(tt!==null||mt!==null){if(!he)return!1;const vt=new Date(he).getTime();if(Number.isNaN(vt)||tt!==null&&vt<tt||mt!==null&&vt>mt)return!1}if(!_e)return!0;const Ve=f$(fe,Y);return Ve.length?Ve.some(vt=>vt.includes(_e)):!1})},[Rt,X,Y,I,D]),ct=u.useMemo(()=>_d.find(_e=>_e.value===Y),[Y]),yt=Ow[Y]||Ow[ya.NAME],Tt=_e=>{const tt=_e.target.value,mt=_d.some(fe=>fe.value===tt);V(mt?tt:ya.NAME)},Ft=()=>{F(""),L("")};u.useEffect(()=>{if(!ve||!Ee)return;const _e=String(Ee.id),tt=new Set([_e]),mt=new Set((E||[]).map(he=>String(he.id))),fe=new Set((C||[]).map(he=>String(he.id)));me(he=>{const Ve=(ln,dn)=>ln.filter(Qt=>dn.has(String(Qt))),vt=Ve(he.readCampaignIds,tt),Nt=Ve(he.writeCampaignIds,tt),Et=Ve(he.readUserIds,mt),jt=Ve(he.writeUserIds,mt),Wt=Ve(he.readCharacterIds,fe);return vt.length===he.readCampaignIds.length&&Nt.length===he.writeCampaignIds.length&&Et.length===he.readUserIds.length&&jt.length===he.writeUserIds.length&&Wt.length===he.readCharacterIds.length?he:{...he,readCampaignIds:vt,writeCampaignIds:Nt,readUserIds:Et,writeUserIds:jt,readCharacterIds:Wt}})},[Ee,C,ve,E]);const kt=B.length,Zt=kt>=Js,Lt=kt>0;u.useEffect(()=>{kt===0&&Re(!1)},[kt]);const Kt=_e=>{G(""),k(tt=>tt.includes(_e)?tt.filter(mt=>mt!==_e):tt.length>=Js?(G(`You can only select ${Js} entities at a time.`),tt):[...tt,_e])},se=()=>{G(""),k(_e=>{const tt=new Set(_e);for(const mt of pt){if(tt.size>=Js)break;tt.add(mt.id)}return tt.size>Js&&G(`Selection capped at ${Js} entities.`),Array.from(tt)})},be=()=>{k([]),G(""),Ce==="collection"&&(He(""),W(null))},je=_e=>{const tt=_e.target.value;it(tt),G(""),tt==="manual"?(He(""),W(null)):k([])},Ze=async _e=>{const tt=_e.target.value;if(He(tt),W(null),G(""),!tt){k([]);return}te(!0);try{const mt=await d$(tt),fe=mt?.data||mt,he=Array.isArray(fe?.entityIds)?fe.entityIds:[];k(he),W({entityIds:he,entityCount:fe?.entityCount??he.length,totalCount:fe?.totalCount??he.length,truncated:!!fe?.truncated}),fe?.truncated&&G(`Only the first ${Js} entities were loaded from this collection.`)}catch(mt){console.error("Failed to resolve collection entities",mt),G(mt.message||"Failed to load collection entities"),k([]),W(null)}finally{te(!1)}},dt=_e=>{const{value:tt}=_e.target;me(mt=>({...mt,description:tt}))},gt=_e=>tt=>{const mt=tt.target.value;_e==="read"?(ue(mt),mt==="unchanged"&&me(fe=>({...fe,readCampaignIds:[],readUserIds:[],readCharacterIds:[]}))):(we(mt),mt==="unchanged"&&me(fe=>({...fe,writeCampaignIds:[],writeUserIds:[]})))},oe=_e=>tt=>{const mt=String(tt);me(fe=>{const he=fe[_e]||[],vt=he.includes(mt)?he.filter(Nt=>Nt!==mt):[...he,mt];return{...fe,[_e]:vt}})},re=Q==="activated",Ne=ne==="activated",Be=u.useMemo(()=>re?Z.readCampaignIds.length+Z.readUserIds.length+Z.readCharacterIds.length>0:!1,[Z,re]),Ke=u.useMemo(()=>Ne?Z.writeCampaignIds.length+Z.writeUserIds.length>0:!1,[Z,Ne]),ot=re||Ne,Oe=u.useMemo(()=>{if(!re)return"";const _e=Bw([{label:"campaign",count:Z.readCampaignIds.length},{label:"user",count:Z.readUserIds.length},{label:"character",count:Z.readCharacterIds.length}]);return _e?`You will add read access for ${_e}.`:""},[Z,re]),ce=u.useMemo(()=>{if(!Ne)return"";const _e=Bw([{label:"campaign",count:Z.writeCampaignIds.length},{label:"user",count:Z.writeUserIds.length}]);return _e?`You will add write access for ${_e}.`:""},[Z,Ne]),Ue=ze&&B.length>0&&ot&&!U,Ge=async _e=>{if(_e.preventDefault(),!ze){G("You do not have permission to apply bulk access updates.");return}if(!B.length){G("Select at least one entity to continue.");return}if(!ot){G("Select at least one access type to update.");return}if(re&&!Be){G("Add at least one read campaign, character, or user.");return}if(Ne&&!Ke){G("Add at least one campaign or user to grant write access.");return}const tt={entityIds:B,readAccess:re?"selective":"unchanged",writeAccess:Ne?"selective":"unchanged",readCampaignIds:re?Z.readCampaignIds:[],readUserIds:re?Z.readUserIds:[],readCharacterIds:re?Z.readCharacterIds:[],writeCampaignIds:Ne?Z.writeCampaignIds:[],writeUserIds:Ne?Z.writeUserIds:[],description:Z.description};R(!0),G(""),ie(null);try{const mt=await s$(tt,{includeCampaignContext:!!(ve&&Ee)}),fe=mt?.data||mt;ie({runId:fe.runId,count:fe.count})}catch(mt){console.error("Failed to apply bulk access",mt),G(mt.message||"Unable to apply bulk access update")}finally{R(!1)}},ut=u.useMemo(()=>ve&&Ee?[{id:String(Ee.id),label:Ee.name}]:Dp(j),[Ee,j,ve]),ae=u.useMemo(()=>Dp(E,"username"),[E]),Xe=u.useMemo(()=>Dp(C),[C]),$e=u.useMemo(()=>{const _e=new Map;return w.forEach(tt=>{_e.set(tt.id,tt)}),_e},[w]),Je=u.useMemo(()=>!Qe||!Array.isArray(Qe.entityIds)?[]:Qe.entityIds.slice(0,10).map(_e=>$e.get(_e)?.name||_e),[Qe,$e]);if(v)return a.jsx("div",{className:"bulk-access-page",children:a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading world context"]})});if(y)return a.jsxs("div",{className:"bulk-access-page",children:[a.jsxs("div",{className:"bulk-access-alert error",children:[a.jsx(Aa,{size:16})," ",y]}),a.jsx("button",{type:"button",className:"link-button",onClick:()=>r(-1),children:"Go back"})]});if(!ze){const _e=ve?"Only a DM for this campaign can access this tool.":"Only the world owner can access this tool.";return a.jsx("div",{className:"bulk-access-page",children:a.jsxs("div",{className:"bulk-access-alert warning",children:[a.jsx(Aa,{size:16})," ",_e]})})}const bt=ve?"Campaign Admin  Access":"World Admin  Manual Access",St=ve?Ee?.name:h?.name;return a.jsxs("div",{className:"bulk-access-page",children:[a.jsxs("div",{className:"bulk-access-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"bulk-access-eyebrow",children:bt}),a.jsxs("h1",{children:["Bulk Access Editor  ",St||""]})]}),at&&a.jsx("div",{className:"bulk-access-header-actions",children:a.jsx(Jt,{to:`/worlds/${e}/access/audit`,className:"ghost-button",children:"View audit log"})})]}),a.jsx("p",{className:"bulk-access-helper bulk-access-topline",children:"This tool adds access to selected entities. It does not remove current access."}),nt&&Ee&&a.jsxs("div",{className:"bulk-access-context-banner",children:["You are updating access in Campaign: ",a.jsx("strong",{children:Ee.name})]}),z&&a.jsxs("div",{className:"bulk-access-alert warning",children:[a.jsx(Aa,{size:16})," ",z]}),J&&a.jsxs("div",{className:"bulk-access-alert success",children:[a.jsx(Qd,{size:16})," Applied access updates to ",J.count," entities  Run ",J.runId,at&&a.jsx(Jt,{to:`/worlds/${e}/access/audit`,className:"inline-link",children:"Review run"})]}),q&&a.jsxs("div",{className:"bulk-access-alert error",children:[a.jsx(Aa,{size:16})," ",q]}),a.jsxs("div",{className:"bulk-access-grid",children:[a.jsxs("section",{className:"bulk-access-card",children:[a.jsxs("header",{children:[a.jsxs("h2",{children:[a.jsx(gM,{size:18})," Choose entities (",kt,"/",Js,")"]}),a.jsxs("div",{className:"bulk-access-entity-actions",children:[!Pe&&a.jsx("button",{type:"button",className:"ghost-button",onClick:se,disabled:Zt||Ce!=="manual",children:"Select filtered"}),a.jsx("button",{type:"button",className:"ghost-button",onClick:be,children:"Clear selection"}),Lt&&a.jsx("button",{type:"button",className:"ghost-button",onClick:()=>Re(_e=>!_e),children:Pe?"Expand":"Collapse"})]})]}),Pe?a.jsx("div",{className:"bulk-access-entity-collapsed-summary",children:a.jsxs("p",{children:[a.jsx("strong",{children:kt})," ",kt===1?"entity":"entities"," selected."]})}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"bulk-access-selection-mode",children:[a.jsxs("label",{children:[a.jsx("input",{type:"radio",value:"manual",checked:Ce==="manual",onChange:je}),"Select manually"]}),a.jsxs("label",{children:[a.jsx("input",{type:"radio",value:"collection",checked:Ce==="collection",onChange:je}),"Use collection"]})]}),Ce==="collection"?a.jsxs("div",{className:"bulk-access-collection-panel",children:[ke&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading collections"]}),!ke&&Mt&&a.jsx("p",{className:"bulk-access-helper warning",children:Mt}),!ke&&!Mt&&qe.length===0&&a.jsxs("p",{className:"bulk-access-helper",children:["No collections available.",at&&!ve&&e&&a.jsxs(a.Fragment,{children:[" ",a.jsx(Jt,{to:`/worlds/${e}/collections`,className:"inline-link",children:"Create one in the collections manager"}),"."]})]}),qe.length>0&&a.jsxs("select",{value:At,onChange:Ze,children:[a.jsx("option",{value:"",children:"Select a collection"}),qe.map(_e=>a.jsxs("option",{value:_e.id,children:[_e.name,"  ",_e.entityCount??_e.entity_ids?.length??0," entities"]},_e.id))]}),ee&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Resolving collection"]}),Qe&&a.jsxs("div",{className:"bulk-access-collection-preview",children:[a.jsxs("p",{children:[a.jsx("strong",{children:Qe.entityCount})," entities selected from this collection."]}),Qe.truncated&&a.jsxs("p",{className:"bulk-access-helper warning",children:["Only the first ",Js," entities can be updated at a time."]}),Je.length>0&&a.jsx("ul",{children:Je.map((_e,tt)=>a.jsx("li",{children:_e},`${_e}-${tt}`))})]}),Ce==="collection"&&at&&!ve&&e&&a.jsx(Jt,{to:`/worlds/${e}/collections`,className:"inline-link",children:"Manage collections"})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"entity-filter",children:[a.jsxs("div",{className:"entity-filter__row entity-filter__row--search",children:[a.jsxs("div",{className:"entity-filter__input",children:[a.jsx("label",{htmlFor:"bulk-access-entity-search",children:"Search"}),a.jsx("input",{id:"bulk-access-entity-search",type:"text",placeholder:yt,value:X,onChange:_e=>H(_e.target.value)})]}),a.jsxs("div",{className:"entity-filter__scope",children:[a.jsx("label",{htmlFor:"bulk-access-entity-scope",children:"Search scope"}),a.jsx("select",{id:"bulk-access-entity-scope",value:Y,onChange:Tt,children:_d.map(_e=>a.jsx("option",{value:_e.value,children:_e.label},_e.value))})]})]}),a.jsxs("div",{className:"entity-filter__row entity-filter__dates",children:[a.jsxs("div",{className:"entity-filter__date-field",children:[a.jsx("label",{htmlFor:"bulk-access-created-after",children:"Created after"}),a.jsx("input",{id:"bulk-access-created-after",type:"date",value:I,onChange:_e=>F(_e.target.value)})]}),a.jsxs("div",{className:"entity-filter__date-field",children:[a.jsx("label",{htmlFor:"bulk-access-created-before",children:"Created before"}),a.jsx("input",{id:"bulk-access-created-before",type:"date",value:D,onChange:_e=>L(_e.target.value)})]}),(I||D)&&a.jsx("button",{type:"button",className:"ghost-button entity-filter__clear-dates",onClick:Ft,children:"Clear dates"})]}),ct?.description&&a.jsx("p",{className:"bulk-access-helper",children:ct.description})]}),a.jsxs("div",{className:"entity-selector-list",children:[M&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading entities"]}),!M&&pt.length===0&&a.jsx("p",{className:"bulk-access-helper",children:ve?"No entities are visible within this campaign context.":"No entities match the current filter."}),!M&&pt.map(_e=>{const tt=m$(_e),mt=h$(_e);return a.jsxs("label",{className:"entity-row",children:[a.jsx("input",{type:"checkbox",checked:B.includes(_e.id),onChange:()=>Kt(_e.id),disabled:Zt&&!B.includes(_e.id)}),a.jsxs("div",{className:"entity-row__main",children:[a.jsx("span",{className:"entity-name",children:_e.name}),a.jsxs("div",{className:"entity-row__meta",children:[_e.entityType?.name&&a.jsx("span",{className:"entity-type",children:_e.entityType.name}),tt&&a.jsx("span",{className:"entity-row__meta-text",children:tt})]}),mt&&a.jsx("p",{className:"entity-row__summary",children:mt})]}),a.jsx(Is,{entityId:_e.id,entityName:_e.name,className:"entity-row__preview"})]},_e.id)})]})]})]})]}),a.jsxs("section",{className:"bulk-access-card bulk-access-card--form",children:[a.jsx("header",{children:a.jsx("h2",{children:"Access configuration"})}),a.jsxs("form",{className:"bulk-access-form",onSubmit:Ge,children:[a.jsxs("div",{className:"access-section",children:[a.jsxs("div",{className:"access-section__header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"access-section__eyebrow",children:"Step 1"}),a.jsx("h3",{children:"Read access"})]}),a.jsxs("label",{className:"access-mode-select",children:[a.jsx("span",{children:"Mode"}),a.jsxs("select",{value:Q,onChange:gt("read"),children:[a.jsx("option",{value:"unchanged",children:"Unchanged"}),a.jsx("option",{value:"activated",children:"Activated"})]})]})]}),a.jsx("p",{className:"bulk-access-helper access-helper-text",children:"This adds new access. It does not remove current access."}),re&&a.jsxs("div",{className:"access-section__content",children:[a.jsxs("div",{className:"access-section__grid",children:[a.jsx(Vo,{label:"Read campaigns",count:Z.readCampaignIds.length,options:ut,selectedValues:Z.readCampaignIds,onToggle:oe("readCampaignIds")}),a.jsx(Vo,{label:"Read users",count:Z.readUserIds.length,options:ae,selectedValues:Z.readUserIds,onToggle:oe("readUserIds")})]}),a.jsx(Vo,{label:"Read characters",count:Z.readCharacterIds.length,options:Xe,selectedValues:Z.readCharacterIds,onToggle:oe("readCharacterIds")})]})]}),a.jsxs("div",{className:"access-section",children:[a.jsxs("div",{className:"access-section__header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"access-section__eyebrow",children:"Step 2"}),a.jsx("h3",{children:"Write access"})]}),a.jsxs("label",{className:"access-mode-select",children:[a.jsx("span",{children:"Mode"}),a.jsxs("select",{value:ne,onChange:gt("write"),children:[a.jsx("option",{value:"unchanged",children:"Unchanged"}),a.jsx("option",{value:"activated",children:"Activated"})]})]})]}),a.jsx("p",{className:"bulk-access-helper access-helper-text",children:"This adds new access. It does not remove current access."}),Ne&&a.jsx("div",{className:"access-section__content",children:a.jsxs("div",{className:"access-section__grid",children:[a.jsx(Vo,{label:"Write campaigns",count:Z.writeCampaignIds.length,options:ut,selectedValues:Z.writeCampaignIds,onToggle:oe("writeCampaignIds")}),a.jsx(Vo,{label:"Write users",count:Z.writeUserIds.length,options:ae,selectedValues:Z.writeUserIds,onToggle:oe("writeUserIds")})]})})]}),a.jsxs("label",{className:"bulk-access-description",children:["Description (optional)",a.jsx("textarea",{name:"description",value:Z.description,onChange:dt,rows:1,placeholder:"Explain why this access change was applied"})]}),a.jsxs("div",{className:"bulk-access-summary",children:[Oe&&a.jsx("p",{children:Oe}),ce&&a.jsx("p",{children:ce}),!Oe&&!ce&&a.jsx("p",{className:"bulk-access-helper",children:"No access changes selected yet."}),!ot&&a.jsx("p",{className:"bulk-access-helper warning",children:"Select at least one access type to update."}),re&&!Be&&a.jsx("p",{className:"bulk-access-helper warning",children:"Add at least one read audience."}),Ne&&!Ke&&a.jsx("p",{className:"bulk-access-helper warning",children:"Add at least one write audience."})]}),a.jsxs("div",{className:"bulk-access-footer",children:[a.jsxs("div",{className:"bulk-access-footer__selection-info",children:[a.jsx("strong",{children:kt})," ",kt===1?"entity":"entities"," selected"]}),a.jsx("button",{type:"submit",className:"primary-button",disabled:!Ue||U,children:U?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:16})," Applying"]}):"Confirm and Apply"})]})]})]})]})]})}const qw=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],Hw=e=>{if(!e)return"";try{return new Date(e).toLocaleString()}catch{return e}},_s=(e=[])=>!Array.isArray(e)||e.length===0?"":e.join(", ");function p$(){const{worldId:e}=vs(),t=zn(),{user:r}=En(),[i,l]=u.useState(null),[c,f]=u.useState(""),[m,h]=u.useState(!0),[p,y]=u.useState([]),[g,v]=u.useState(!1),[S,w]=u.useState(""),[N,j]=u.useState(null),[_,C]=u.useState(!1),[O,E]=u.useState(""),[T,M]=u.useState(!1),[A,z]=u.useState(""),P=u.useMemo(()=>!i||!r?!1:String(i.created_by)===String(r.id),[i,r]);u.useEffect(()=>{if(!e){f("Missing world id"),h(!1);return}(async()=>{h(!0),f("");try{const D=await $l(),B=qw(D).find(k=>String(k.id)===String(e));if(!B){f("World not found or unavailable"),l(null);return}l(B)}catch(D){console.error("Failed to load worlds",D),f(D.message||"Unable to load world data"),l(null)}finally{h(!1)}})()},[e]);const X=u.useCallback(async F=>{if(F){w(F),C(!0),E("");try{const D=await i$(F),L=D?.data||D;j(L)}catch(D){console.error("Failed to load run detail",D),E(D.message||"Unable to load run details"),j(null)}finally{C(!1)}}},[]),H=u.useCallback(async()=>{if(!(!e||!P)){v(!0),E("");try{const F=await r$({worldId:e}),D=qw(F);if(y(D),D.length===0){j(null),w("");return}(!S||!D.some(L=>L.id===S))&&await X(D[0].id)}catch(F){console.error("Failed to load bulk runs",F),E(F.message||"Unable to load audit runs"),y([])}finally{v(!1)}}},[X,P,S,e]);u.useEffect(()=>{H()},[H]);const Y=async()=>{if(!(!S||!window.confirm("Revert this entire run? This cannot be undone."))){M(!0),E(""),z("");try{const F=await l$(S),D=F?.data||F;z(`Run ${D.runId} reverted successfully.`),await H(),await X(S)}catch(F){console.error("Failed to revert run",F),E(F.message||"Unable to revert run")}finally{M(!1)}}},V=F=>F?.reverted?"Reverted":"Active",I=(F,D,L)=>a.jsxs("div",{className:"audit-diff-row",children:[a.jsx("span",{className:"audit-diff-label",children:F}),a.jsxs("div",{className:"audit-diff-values",children:[a.jsx("span",{className:"old",children:D}),a.jsx(w1,{size:14}),a.jsx("span",{className:"new",children:L})]})]},F);return m?a.jsx("div",{className:"bulk-audit-page",children:a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading world context"]})}):c?a.jsxs("div",{className:"bulk-audit-page",children:[a.jsxs("div",{className:"bulk-access-alert error",children:[a.jsx(Aa,{size:16})," ",c]}),a.jsx("button",{type:"button",className:"link-button",onClick:()=>t(-1),children:"Go back"})]}):P?a.jsxs("div",{className:"bulk-audit-page",children:[a.jsxs("div",{className:"bulk-access-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"bulk-access-eyebrow",children:"World Admin  Access Audit"}),a.jsxs("h1",{children:["Bulk Access Runs  ",i?.name]})]}),a.jsx("div",{className:"bulk-access-header-actions",children:a.jsx(Jt,{to:`/worlds/${e}/access/bulk`,className:"ghost-button",children:"Back to editor"})})]}),O&&a.jsxs("div",{className:"bulk-access-alert error",children:[a.jsx(Aa,{size:16})," ",O]}),A&&a.jsxs("div",{className:"bulk-access-alert success",children:[a.jsx(R1,{size:16})," ",A]}),a.jsxs("div",{className:"bulk-audit-grid",children:[a.jsxs("section",{className:"bulk-access-card",children:[a.jsxs("header",{children:[a.jsxs("h2",{children:[a.jsx(j1,{size:18})," Audit runs (",p.length,")"]}),a.jsx("button",{type:"button",className:"ghost-button",onClick:H,disabled:g,children:g?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:14})," Refreshing"]}):"Refresh"})]}),a.jsxs("div",{className:"audit-run-list",children:[g&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading runs"]}),!g&&p.length===0&&a.jsx("p",{className:"bulk-access-helper",children:"No bulk access runs have been recorded for this world."}),!g&&p.map(F=>a.jsxs("button",{type:"button",className:`audit-run-row ${S===F.id?"active":""}`,onClick:()=>X(F.id),children:[a.jsxs("div",{children:[a.jsxs("p",{className:"audit-run-title",children:["Run ",F.id]}),a.jsxs("p",{className:"audit-run-meta",children:[Hw(F.createdAt||F.created_at),"  ",F.change_count||F.entity_count||0," entities"]}),a.jsxs("p",{className:"audit-run-meta",children:[F.campaignContext?.name?`Campaign  ${F.campaignContext.name}`:"Scope  World"," ",F.role_used==="dm"?" DM run":" Owner run"]})]}),a.jsx("span",{className:`status-pill ${F.reverted?"reverted":"active"}`,children:V(F)})]},F.id))]})]}),a.jsxs("section",{className:"bulk-access-card",children:[a.jsxs("header",{children:[a.jsx("h2",{children:"Run details"}),N&&a.jsx("button",{type:"button",className:"ghost-button",onClick:Y,disabled:N.reverted||T,children:T?a.jsxs(a.Fragment,{children:[a.jsx(Nn,{className:"spin",size:14})," Reverting"]}):a.jsxs(a.Fragment,{children:[a.jsx(zl,{size:14})," Revert run"]})})]}),!N&&a.jsx("p",{className:"bulk-access-helper",children:"Select a run to see the access changes."}),_&&a.jsxs("p",{className:"bulk-access-helper",children:[a.jsx(Nn,{className:"spin",size:16})," Loading details"]}),N&&!_&&a.jsxs("div",{className:"audit-detail",children:[a.jsxs("div",{className:"audit-detail-meta",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Status:"})," ",N.reverted?"Reverted":"Active"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"User:"})," ",N.actor?.username||"Unknown user"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"User role:"})," ",N.role_used==="dm"?"Campaign DM":"World owner"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Scope:"})," ",N.campaignContext?.name||"World-wide"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Created:"})," ",Hw(N.createdAt||N.created_at)]}),N.description&&a.jsxs("p",{children:[a.jsx("strong",{children:"Description:"})," ",N.description]})]}),a.jsx("div",{className:"audit-changes",children:N.changes?.map(F=>{const D=F.entity?.name||F.entity_id;return a.jsxs("div",{className:"audit-change-card",children:[a.jsxs("div",{className:"audit-change-header",children:[a.jsx("p",{className:"audit-change-title",children:D}),a.jsxs("span",{className:"audit-change-subtitle",children:["Entity ",F.entity_id]})]}),a.jsxs("div",{className:"audit-change-body",children:[I("Read access",F.old_read_access,F.entity?.read_access||""),I("Write access",F.old_write_access,F.entity?.write_access||""),I("Read campaigns",_s(F.old_read_campaign_names!==void 0?F.old_read_campaign_names:F.old_read_campaign_ids),_s(F.entity?.read_campaign_names!==void 0?F.entity.read_campaign_names:F.entity?.read_campaign_ids)),I("Read users",_s(F.old_read_user_names!==void 0?F.old_read_user_names:F.old_read_user_ids),_s(F.entity?.read_user_names!==void 0?F.entity.read_user_names:F.entity?.read_user_ids)),I("Read characters",_s(F.old_read_character_ids),_s(F.entity?.read_character_ids)),I("Write campaigns",_s(F.old_write_campaign_names!==void 0?F.old_write_campaign_names:F.old_write_campaign_ids),_s(F.entity?.write_campaign_names!==void 0?F.entity.write_campaign_names:F.entity?.write_campaign_ids)),I("Write users",_s(F.old_write_user_names!==void 0?F.old_write_user_names:F.old_write_user_ids),_s(F.entity?.write_user_names!==void 0?F.entity.write_user_names:F.entity?.write_user_ids))]})]},F.id)})})]})]})]})]}):a.jsx("div",{className:"bulk-audit-page",children:a.jsxs("div",{className:"bulk-access-alert warning",children:[a.jsx(Aa,{size:16})," Only the world owner can view audit runs."]})})}const Yo=1e3,Ip=e=>Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],Lp={name:"",description:"",shared:!1,entityIds:[]};function y$(){const{worldId:e}=vs(),t=zn(),{user:r,sessionReady:i}=En(),[l,c]=u.useState(null),[f,m]=u.useState(!0),[h,p]=u.useState(""),[y,g]=u.useState(!1),[v,S]=u.useState([]),[w,N]=u.useState([]),[j,_]=u.useState(""),[C,O]=u.useState("view"),[E,T]=u.useState(""),[M,A]=u.useState(Lp),[z,P]=u.useState(!1),[X,H]=u.useState(""),[Y,V]=u.useState(""),[I,F]=u.useState(!1),[D,L]=u.useState(!1),[B,k]=u.useState(!1),[U,R]=u.useState(null),[q,G]=u.useState(!1),J=u.useMemo(()=>{if(!l||!r)return!1;const ee=l.created_by||l.creator?.id||l.owner?.id||l.owner_id||null;return ee&&r.id&&String(ee)===String(r.id)},[l,r]),ie=u.useCallback(async()=>{if(e)try{const ee=await bj(e),te=Ip(ee);S(te)}catch(ee){console.error("Failed to load collections",ee),p(ee.message||"Failed to load collections")}},[e]),Z=u.useCallback(async()=>{if(e)try{const ee=await oc(e),te=Ip(ee);N(te)}catch(ee){console.error("Failed to load entities for world",ee),p(ee.message||"Failed to load entities for this world")}},[e]);u.useEffect(()=>{if(!i||!e)return;(async()=>{m(!0),p(""),g(!1),c(null);try{const te=await $l(),le=Ip(te).find(Ee=>String(Ee.id)===String(e));if(!le){p("World not found or unavailable");return}c(le);const Se=le.created_by||le.creator?.id||le.owner?.id||le.owner_id||null;if(!r||!Se||String(Se)!==String(r.id)){g(!0);return}await Promise.all([ie(),Z()])}catch(te){console.error("Failed to load collections manager",te),p(te.message||"Failed to load collections manager")}finally{m(!1)}})()},[ie,Z,i,r,e]);const me=ee=>te=>{const ve=ee==="shared"?te.target.checked:te.target.value;A(le=>({...le,[ee]:ve})),P(!0),H(""),V("")},Q=ee=>{H(""),V(""),A(te=>{const ve=new Set(te.entityIds||[]);if(ve.has(ee))ve.delete(ee);else{if(ve.size>=Yo)return H(`Collections can include up to ${Yo} entities.`),te;ve.add(ee)}return P(!0),{...te,entityIds:Array.from(ve)}})},ue=u.useMemo(()=>{if(!j)return w;const ee=j.toLowerCase();return w.filter(te=>(te.name||"").toLowerCase().includes(ee))},[w,j]),ne=u.useMemo(()=>[...v].sort((ee,te)=>ee.shared&&!te.shared?-1:te.shared&&!ee.shared?1:(ee.name||"").localeCompare(te.name||"",void 0,{sensitivity:"base"})),[v]),we=u.useCallback(()=>{T(""),A(Lp),O("view"),P(!1),H(""),V("")},[]),Pe=u.useCallback(ee=>{ee&&(T(ee.id),A({name:ee.name||"",description:ee.description||"",shared:!!ee.shared,entityIds:Array.isArray(ee.entityIds)?ee.entityIds:[]}),O("edit"),P(!1),H(""),V(""))},[]),Re=ee=>{if(z){R(ee),k(!0);return}Ce(ee)},Ce=ee=>{k(!1),R(null),ee&&(ee.type==="select"?Pe(ee.payload):ee.type==="create"?(O("create"),T(""),A(Lp),P(!1),H(""),V("")):ee.type==="close"&&we())},it=ee=>{Re({type:"select",payload:ee,label:ee.name})},qe=()=>{Re({type:"create",label:"start a new collection"})},We=()=>{Re({type:"close",label:"leave this editor"})},ke=()=>{k(!1),R(null)},xt=()=>{Ce(U)},Mt=u.useCallback(async()=>{if(!e)return H("A world id is required to save this collection."),!1;if(!M.name.trim())return H("Name is required."),!1;if(M.entityIds.length>Yo)return H(`Collections can include up to ${Yo} entities.`),!1;const ee={worldId:e,name:M.name.trim(),description:M.description,shared:M.shared,entityIds:M.entityIds};F(!0),H(""),V("");try{let te;C==="edit"&&E?te=await c$(E,ee):te=await o$(ee);const ve=te?.data||te;return ve?(S(le=>{const Se=le.findIndex(Ee=>Ee.id===ve.id);if(Se>=0){const Ee=[...le];return Ee[Se]=ve,Ee}return[...le,ve]}),Pe(ve),O("edit"),V("Collection saved successfully."),P(!1)):await ie(),!0}catch(te){return console.error("Failed to save collection",te),H(te.message||"Failed to save collection"),!1}finally{F(!1)}},[Pe,M,ie,C,E,e]),Ct=async ee=>{ee.preventDefault(),await Mt()},At=async()=>{if(E&&confirm("Delete this collection? This cannot be undone.")){L(!0),H(""),V("");try{await u$(E),S(ee=>ee.filter(te=>te.id!==E)),we(),V("Collection deleted.")}catch(ee){console.error("Failed to delete collection",ee),H(ee.message||"Failed to delete collection")}finally{L(!1)}}},He=async()=>{G(!0);const ee=await Mt();G(!1),ee&&Ce(U)};if(u.useEffect(()=>{const ee=te=>{z&&(te.preventDefault(),te.returnValue="")};return window.addEventListener("beforeunload",ee),()=>window.removeEventListener("beforeunload",ee)},[z]),!i)return a.jsx("p",{className:"collections-helper",children:"Restoring session"});if(!e)return a.jsx("p",{className:"collections-helper",children:"World id is required."});if(f)return a.jsx("div",{className:"collections-page",children:a.jsxs("p",{className:"collections-helper",children:[a.jsx(Nn,{size:16,className:"spin"})," Loading collections"]})});if(h)return a.jsxs("div",{className:"collections-page",children:[a.jsxs("div",{className:"collections-alert error",children:[a.jsx(Aa,{size:16})," ",h]}),a.jsx("button",{type:"button",className:"link-button",onClick:()=>t(-1),children:"Go back"})]});if(y||!J)return a.jsx("div",{className:"collections-page",children:a.jsxs("div",{className:"collections-alert warning",children:[a.jsx(Aa,{size:16})," Only the world owner can manage collections."]})});const Qe=l?.name||"",W=M.entityIds.length;return a.jsxs("div",{className:"collections-page",children:[a.jsxs("div",{className:"collections-header",children:[a.jsxs("div",{children:[a.jsx("p",{className:"collections-eyebrow",children:"World Admin  Collections"}),a.jsx("h1",{children:Qe})]}),a.jsx("div",{className:"collections-header-actions",children:a.jsx("button",{type:"button",className:"primary-button",onClick:qe,children:"New collection"})})]}),Y&&a.jsxs("div",{className:"collections-alert success",children:[a.jsx(Qd,{size:16})," ",Y]}),X&&a.jsxs("div",{className:"collections-alert error",children:[a.jsx(Aa,{size:16})," ",X]}),a.jsxs("div",{className:"collections-grid",children:[a.jsxs("section",{className:"collections-card",children:[a.jsxs("header",{children:[a.jsx("h2",{children:"Collections"}),a.jsxs("p",{className:"collections-helper",children:[v.length," saved  Shared sets are available to campaign DMs"]})]}),a.jsx("div",{className:"collections-table-wrapper",children:ne.length===0?a.jsx("p",{className:"collections-helper",children:"No collections yet. Create one to get started."}):a.jsxs("table",{className:"collections-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Name"}),a.jsx("th",{children:"Shared"}),a.jsx("th",{children:"Entities"}),a.jsx("th",{children:"Updated"})]})}),a.jsx("tbody",{children:ne.map(ee=>{const te=E===ee.id;return a.jsxs("tr",{className:te?"active":"",onClick:()=>it(ee),children:[a.jsxs("td",{children:[a.jsx("span",{className:"collection-name",children:ee.name}),ee.description&&a.jsx("span",{className:"collection-description",children:ee.description})]}),a.jsx("td",{children:ee.shared?a.jsxs("span",{className:"shared-chip",children:[a.jsx(k1,{size:14})," Shared"]}):a.jsx("span",{className:"shared-chip private",children:"Owner only"})}),a.jsx("td",{children:ee.entityCount??ee.entity_ids?.length??0}),a.jsx("td",{children:ee.updatedAt?new Date(ee.updatedAt).toLocaleString():""})]},ee.id)})})]})})]}),a.jsx("section",{className:"collections-card",children:C==="view"&&!E?a.jsx("div",{className:"collections-placeholder",children:a.jsx("p",{children:"Select a collection to edit or create a new one."})}):a.jsxs("form",{className:"collections-form",onSubmit:Ct,children:[a.jsxs("header",{children:[a.jsx("h2",{children:C==="edit"?"Edit collection":"New collection"}),a.jsxs("p",{className:"collections-helper",children:[W,"/",Yo," entities selected"]})]}),a.jsxs("label",{children:["Name",a.jsx("input",{type:"text",value:M.name,onChange:me("name"),required:!0})]}),a.jsxs("label",{children:["Description (optional)",a.jsx("textarea",{value:M.description,onChange:me("description"),rows:3})]}),a.jsxs("label",{className:"checkbox-label",children:[a.jsx("input",{type:"checkbox",checked:M.shared,onChange:me("shared")}),"Share with DMs in this world"]}),a.jsxs("div",{className:"collections-entity-picker",children:[a.jsxs("div",{className:"collections-entity-toolbar",children:[a.jsx("span",{children:"Entities"}),a.jsx("input",{type:"text",placeholder:"Filter by name",value:j,onChange:ee=>_(ee.target.value)})]}),a.jsx("div",{className:"collections-entity-list",children:ue.length===0?a.jsx("p",{className:"collections-helper",children:"No entities match this filter."}):a.jsx("ul",{children:ue.map(ee=>{const te=M.entityIds.includes(ee.id);return a.jsx("li",{children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:te,onChange:()=>Q(ee.id)}),a.jsx("span",{className:"entity-name",children:ee.name}),a.jsx("span",{className:"entity-type",children:ee.entityType?.name||""})]})},ee.id)})})})]}),a.jsxs("div",{className:"collections-form-actions",children:[a.jsx("button",{type:"submit",className:"primary-button",disabled:I,children:I?"Saving":"Save collection"}),C==="edit"&&a.jsx("button",{type:"button",className:"ghost-button",onClick:At,disabled:D,children:D?"Deleting":"Delete"}),a.jsx("button",{type:"button",className:"ghost-button",onClick:We,children:"Close"})]})]})})]}),a.jsx(vN,{open:B,destinationLabel:U?.label||"",saving:q,onSaveAndContinue:He,onContinueWithoutSaving:xt,onStay:ke})]})}const g$="http://localhost:3000/api/auth";function b$(){const e=Zr();if(!e)throw new Error("Missing or invalid token");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function v$(e,t="request"){if(e.status===401)throw new Error("Unauthorized");if(!e.ok){const r=await e.json().catch(()=>({message:"Unknown error"}));throw new Error(r.message||`Failed to ${t}`)}return e.json()}async function x$(e,t){const r=await fetch(`${g$}/change-password`,{method:"POST",headers:b$(),body:JSON.stringify({currentPassword:e,newPassword:t})});return v$(r,"change password")}function S$(){const[e,t]=u.useState(""),[r,i]=u.useState(""),[l,c]=u.useState(""),[f,m]=u.useState(""),[h,p]=u.useState(""),[y,g]=u.useState(!1),v=async S=>{S.preventDefault(),m(""),p(""),g(!0);try{if(!e||!r||!l){m("All fields are required"),g(!1);return}if(r.length<6){m("New password must be at least 6 characters long"),g(!1);return}if(r!==l){m("New password and confirmation do not match"),g(!1);return}await x$(e,r),p("Password changed successfully"),t(""),i(""),c("")}catch(w){m(w.message||"Failed to change password. Please try again.")}finally{g(!1)}};return a.jsx("div",{className:"settings-page",children:a.jsxs("div",{className:"settings-container",children:[a.jsxs("div",{className:"settings-header",children:[a.jsx("h1",{className:"settings-title",children:"Security"}),a.jsx("p",{className:"settings-subtitle",children:"Manage your account security"})]}),a.jsxs("div",{className:"settings-section",children:[a.jsx("h2",{className:"settings-section-title",children:"Change Password"}),a.jsx("p",{className:"settings-section-description",children:"Enter your current password and choose a new password to update your account security."}),a.jsxs("form",{onSubmit:v,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"current-password",children:"Current Password"}),a.jsx("input",{id:"current-password",type:"password",value:e,onChange:S=>t(S.target.value),placeholder:"Enter current password",required:!0,disabled:y})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"new-password",children:"New Password"}),a.jsx("input",{id:"new-password",type:"password",value:r,onChange:S=>i(S.target.value),placeholder:"Enter new password (minimum 6 characters)",required:!0,minLength:6,disabled:y})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"confirm-password",children:"Confirm New Password"}),a.jsx("input",{id:"confirm-password",type:"password",value:l,onChange:S=>c(S.target.value),placeholder:"Confirm new password",required:!0,disabled:y})]}),f&&a.jsx("p",{className:"error-msg",children:f}),h&&a.jsx("p",{className:"success-msg",children:h}),a.jsx("button",{type:"submit",disabled:y,className:"settings-submit-btn",children:y?"Changing password...":"Change Password"})]})]})]})})}const w$=[{value:"",label:"All types"},{value:"entity_comment",label:"Entity comments"},{value:"entity_mention_entity_note",label:"Entity mentions (notes)"},{value:"entity_mention_session_note",label:"Entity mentions (sessions)"},{value:"session_note_added",label:"Session notes"},{value:"session_note_updated",label:"Session notes"},{value:"request_note_added",label:"Feature/Bug notes"},{value:"request_status_changed",label:"Feature/Bug status"},{value:"request_assigned",label:"Feature/Bug assignments"}],N$=e=>{const{type:t,metadata:r={}}=e;switch(t){case"entity_comment":return`${r.author_name||"Someone"} commented on ${r.entity_name||"an entity"}`;case"entity_mention_entity_note":return`${r.author_name||"Someone"} mentioned ${r.related_entity_name||"an entity"} in a note`;case"entity_mention_session_note":return`${r.author_name||"Someone"} mentioned ${r.related_entity_name||"an entity"} in a session note`;case"session_note_added":return`${r.author_name||"Someone"} created a session note${r.campaign_name?` for ${r.campaign_name}`:""}: ${r.session_title||"Untitled"}`;case"session_note_updated":return`${r.author_name||"Someone"} updated a session note${r.campaign_name?` for ${r.campaign_name}`:""}: ${r.session_title||"Untitled"}`;case"request_note_added":return`${r.author_name||"Someone"} added a note to "${r.request_title||"a feature/bug"}"`;case"request_status_changed":return`Status changed for "${r.request_title||"a feature/bug"}"`;case"request_assigned":return`You were assigned to "${r.request_title||"a feature/bug"}"`;default:return"New notification"}},E$=e=>{if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const i=new Date-t,l=Math.floor(i/6e4),c=Math.floor(i/36e5),f=Math.floor(i/864e5);return l<1?"Just now":l<60?`${l}m ago`:c<24?`${c}h ago`:f<7?`${f}d ago`:t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})};function j$(){const{notifications:e,markRead:t,markAllRead:r,refresh:i}=H1(),{selectedCampaignId:l,campaigns:c,setSelectedCampaignId:f}=Bn(),m=zn(),[h,p]=u.useState(!1),[y,g]=u.useState([]),[v,S]=u.useState(1),[w,N]=u.useState(!0),[j,_]=u.useState(""),[C,O]=u.useState(""),[E,T]=u.useState(l||""),[M,A]=u.useState({open:!1,notification:null}),z=async(L=1,B=!1)=>{p(!0);try{const k={page:L,limit:50};j==="unread"?k.read="false":j==="read"&&(k.read="true"),C&&(k.type=C),E&&(k.campaignId=E);const U=await U1(k),R=Array.isArray(U?.data)?U.data:[],q=U?.pagination||{};g(B?G=>[...G,...R]:R),N(q.page<q.pages)}catch(k){console.error("Failed to load notifications",k)}finally{p(!1)}};u.useEffect(()=>{z(1,!1)},[j,C,E]);const P=async L=>{try{await t(L.id),g(B=>B.map(k=>k.id===L.id?{...k,read:!0,readAt:new Date().toISOString()}:k))}catch(B){console.error("Failed to mark notification read",B)}},X=async()=>{try{const L={};E&&(L.campaignId=E),C&&(L.type=C),await r(L),i(),z(v,!1)}catch(L){console.error("Failed to mark all notifications read",L)}},H=L=>{if(L.actionUrl)m(L.actionUrl);else{const{type:B,metadata:k={}}=L;if(B==="entity_comment"||B==="entity_mention_entity_note"){const U=k.entity_id||k.related_entity_id,R=L.campaignId||L.campaign?.id||E;U&&m(`/entities/${U}${R?`?campaignId=${R}`:""}#notes`)}else if(B==="session_note_added"||B==="session_note_updated"||B==="entity_mention_session_note"){const U=L.campaignId||L.campaign?.id||k.target_id||E;m(`/notes/session${U?`?campaignId=${U}`:""}`)}else if(B==="request_note_added"||B==="request_status_changed"||B==="request_assigned"){const U=k.request_id||k.requestId;m(U?`/requests/${U}`:"/requests")}}},Y=async L=>{L.read||await P(L);const B=L.campaignId||L.campaign?.id||"";if(B&&B!==(l||"")){A({open:!0,notification:L});return}H(L)},V=()=>{const{notification:L}=M;if(!L)return;const B=L.campaignId||L.campaign?.id||"";B&&f(B),A({open:!1,notification:null}),setTimeout(()=>{H(L)},100)},I=()=>{A({open:!1,notification:null})},F=y.filter(L=>!L.read).length,D=u.useMemo(()=>[{value:"",label:"All campaigns"},...(c||[]).map(L=>({value:L.id,label:L.name}))],[c]);return a.jsxs("div",{className:"notification-list-page",children:[a.jsxs("div",{className:"notification-list-header",children:[a.jsx("h1",{children:"Notifications"}),a.jsx("div",{className:"notification-list-actions",children:F>0&&a.jsxs("button",{type:"button",className:"notification-list-mark-all-read",onClick:X,disabled:h,children:[a.jsx(cT,{size:18}),"Mark all read"]})})]}),a.jsxs("div",{className:"notification-list-filters",children:[a.jsxs("select",{className:"notification-list-filter",value:j,onChange:L=>{_(L.target.value),S(1)},children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"unread",children:"Unread"}),a.jsx("option",{value:"read",children:"Read"})]}),a.jsx("select",{className:"notification-list-filter",value:C,onChange:L=>{O(L.target.value),S(1)},children:w$.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))}),a.jsx("select",{className:"notification-list-filter",value:E,onChange:L=>{T(L.target.value),S(1)},children:D.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))})]}),a.jsxs("div",{className:"notification-list-content",children:[h&&y.length===0?a.jsx("div",{className:"notification-list-empty",children:"Loading..."}):y.length===0?a.jsxs("div",{className:"notification-list-empty",children:[a.jsx("p",{children:"No notifications found."}),a.jsx("p",{className:"notification-list-empty-hint",children:"You're all caught up!"})]}):a.jsx("div",{className:"notification-list-items",children:y.map(L=>a.jsxs("div",{className:`notification-list-item ${L.read?"read":"unread"}`,onClick:()=>Y(L),children:[a.jsxs("div",{className:"notification-list-item-content",children:[a.jsxs("div",{className:"notification-list-item-header",children:[a.jsx("p",{className:"notification-list-item-message",children:N$(L)}),!L.read&&a.jsx("div",{className:"notification-list-item-dot"})]}),a.jsxs("div",{className:"notification-list-item-meta",children:[a.jsx("span",{className:"notification-list-item-time",children:E$(L.createdAt)}),L.campaign&&a.jsx("span",{className:"notification-list-item-campaign",children:L.campaign.name})]})]}),!L.read&&a.jsx("button",{type:"button",className:"notification-list-item-mark-read",onClick:B=>{B.stopPropagation(),P(L)},title:"Mark as read",children:a.jsx(N1,{size:16})})]},L.id))}),w&&a.jsx("div",{className:"notification-list-load-more",children:a.jsx("button",{type:"button",onClick:()=>{const L=v+1;S(L),z(L,!0)},disabled:h,children:h?"Loading...":"Load more"})})]}),a.jsx(P1,{open:M.open,campaignName:M.notification?.campaign?.name||"",onSwitch:V,onCancel:I})]})}function _$(){const{selectedCampaignId:e,campaigns:t}=Bn(),[r,i]=u.useState([]),[l,c]=u.useState(!1),[f,m]=u.useState(e||""),[h,p]=u.useState(null),y=async()=>{c(!0);try{const w=await p4(f||void 0),N=Array.isArray(w?.data)?w.data:[];i(N)}catch(w){console.error("Failed to load followed entities",w)}finally{c(!1)}};u.useEffect(()=>{y()},[f]);const g=async(w,N)=>{if(!(!w||!N||h===w)){p(w);try{await gN(w,N),i(j=>j.filter(_=>!(_.entityId===w&&_.campaignId===N)))}catch(j){console.error("Failed to unfollow entity",j)}finally{p(null)}}},v=u.useMemo(()=>[{value:"",label:"All campaigns"},...(t||[]).map(w=>({value:w.id,label:w.name}))],[t]),S=u.useMemo(()=>{const w={};return r.forEach(N=>{const j=N.campaignId||"no-campaign";w[j]||(w[j]={campaign:N.campaign,entities:[]}),w[j].entities.push(N)}),w},[r]);return a.jsxs("div",{className:"followed-entities-page",children:[a.jsxs("div",{className:"followed-entities-header",children:[a.jsx("h1",{children:"Followed Entities"}),a.jsx("div",{className:"followed-entities-actions",children:a.jsx("select",{className:"followed-entities-filter",value:f,onChange:w=>m(w.target.value),children:v.map(w=>a.jsx("option",{value:w.value,children:w.label},w.value))})})]}),a.jsx("div",{className:"followed-entities-content",children:l?a.jsx("div",{className:"followed-entities-empty",children:"Loading..."}):r.length===0?a.jsxs("div",{className:"followed-entities-empty",children:[a.jsx("p",{children:"No followed entities found."}),a.jsx("p",{className:"followed-entities-empty-hint",children:"Follow entities from their detail pages to receive notifications when they're commented on or mentioned."})]}):a.jsx("div",{className:"followed-entities-list",children:Object.entries(S).map(([w,N])=>a.jsxs("div",{className:"followed-entities-group",children:[a.jsx("h2",{className:"followed-entities-group-title",children:N.campaign?.name||"No campaign context"}),a.jsx("div",{className:"followed-entities-items",children:N.entities.map(j=>a.jsxs("div",{className:"followed-entities-item",children:[a.jsx(Jt,{to:`/entities/${j.entityId}${j.campaignId?`?campaignId=${j.campaignId}`:""}`,className:"followed-entities-item-link",children:a.jsxs("div",{className:"followed-entities-item-content",children:[a.jsx("h3",{className:"followed-entities-item-name",children:j.entity?.name||"Unnamed entity"}),j.entity?.entityType&&a.jsx("span",{className:"followed-entities-item-type",children:j.entity.entityType.name})]})}),a.jsx("button",{type:"button",className:"followed-entities-item-unfollow",onClick:()=>g(j.entityId,j.campaignId),disabled:h===j.entityId,title:"Unfollow",children:h===j.entityId?a.jsx(Md,{size:18}):a.jsx(Ly,{size:18})})]},`${j.entityId}-${j.campaignId}`))})]},w))})})]})}const C$=(e={})=>{const t=new URLSearchParams;Object.entries(e).forEach(([l,c])=>{c!=null&&c!==""&&t.set(l,c)});const r=t.toString(),i=r?`/requests?${r}`:"/requests";return _t.get(i)},A$=e=>_t.get(`/requests/${e}`),T$=e=>_t.post("/requests",e),M$=(e,t)=>_t.patch(`/requests/${e}`,t),R$=e=>_t.delete(`/requests/${e}`),k$={open:"blue",in_progress:"orange",testing:"yellow",resolved:"green",closed:"gray",backlog:"purple"};function vj({status:e}){const t=k$[e]||"gray",r=e?e.split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" "):"Unknown";return a.jsx("span",{className:`request-status-badge request-status-badge--${t}`,children:r})}function D$({request:e}){const t=r=>{if(!r)return"";const i=new Date(r);if(Number.isNaN(i.getTime()))return"";const c=new Date-i,f=Math.floor(c/6e4),m=Math.floor(c/36e5),h=Math.floor(c/864e5);return f<1?"Just now":f<60?`${f}m ago`:m<24?`${m}h ago`:h<7?`${h}d ago`:i.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})};return a.jsxs(Jt,{to:`/requests/${e.id}`,className:"request-card",children:[a.jsxs("div",{className:"request-card__header",children:[a.jsxs("div",{className:"request-card__type",children:[e.type==="bug"?a.jsx(Oy,{size:16,className:"request-card__type-icon"}):a.jsx(Ii,{size:16,className:"request-card__type-icon"}),a.jsx("span",{className:"request-card__type-label",children:e.type==="bug"?"Bug":"Feature"})]}),a.jsx(vj,{status:e.status})]}),a.jsx("h3",{className:"request-card__title",children:e.title}),a.jsx("p",{className:"request-card__description",children:e.description.length>150?`${e.description.substring(0,150)}...`:e.description}),a.jsxs("div",{className:"request-card__footer",children:[a.jsxs("div",{className:"request-card__meta",children:[a.jsxs("span",{className:"request-card__creator",children:["by ",e.creator?.username||"Unknown"]}),e.assignee&&a.jsxs("span",{className:"request-card__assignee",children:[" ",e.assignee.username]})]}),a.jsxs("div",{className:"request-card__time",children:[a.jsx($y,{size:14}),a.jsx("span",{children:t(e.createdAt)})]})]})]})}function I$(){const{user:e}=En(),t=e?.role==="system_admin",[r,i]=u.useState([]),[l,c]=u.useState(!1),[f,m]=u.useState({type:"",status:"",isInBacklog:""}),[h,p]=u.useState({page:1,limit:20,total:0,pages:0}),y=async(w=1)=>{c(!0);try{const N={page:w,limit:h.limit,...f};Object.keys(N).forEach(_=>{(N[_]===""||N[_]===null||N[_]===void 0)&&delete N[_]});const j=await C$(N);i(Array.isArray(j?.data)?j.data:[]),p(j?.pagination||h)}catch(N){console.error("Failed to load requests",N),alert("Failed to load requests")}finally{c(!1)}};u.useEffect(()=>{y(1)},[f]);const g=(w,N)=>{m(j=>({...j,[w]:N}))},v=()=>{m({type:"",status:"",isInBacklog:""})},S=Object.values(f).some(w=>w!=="");return a.jsxs("div",{className:"request-list-page",children:[a.jsxs("div",{className:"request-list-page__header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Feature/Bugs"}),a.jsxs("div",{className:"request-list-page__subtitle-wrapper",children:[a.jsx("p",{className:"request-list-page__subtitle",children:t?"All bug reports and feature requests":"Your bug reports and feature requests"}),t&&a.jsx("span",{className:"request-list-page__admin-badge",children:"Admin View"})]})]}),a.jsxs(Jt,{to:"/requests/new",className:"request-list-page__create-button",children:[a.jsx(Pa,{size:20}),"New Request"]})]}),a.jsxs("div",{className:"request-list-page__filters",children:[a.jsxs("div",{className:"request-list-page__filter-group",children:[a.jsx(Jd,{size:16}),a.jsx("label",{htmlFor:"filter-type",children:"Type:"}),a.jsxs("select",{id:"filter-type",value:f.type,onChange:w=>g("type",w.target.value),className:"request-list-page__filter-select",children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"bug",children:"Bug"}),a.jsx("option",{value:"feature",children:"Feature"})]})]}),a.jsxs("div",{className:"request-list-page__filter-group",children:[a.jsx("label",{htmlFor:"filter-status",children:"Status:"}),a.jsxs("select",{id:"filter-status",value:f.status,onChange:w=>g("status",w.target.value),className:"request-list-page__filter-select",children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"open",children:"Open"}),a.jsx("option",{value:"in_progress",children:"In Progress"}),a.jsx("option",{value:"testing",children:"Testing"}),a.jsx("option",{value:"resolved",children:"Resolved"}),a.jsx("option",{value:"closed",children:"Closed"}),a.jsx("option",{value:"backlog",children:"Backlog"})]})]}),t&&a.jsxs("div",{className:"request-list-page__filter-group",children:[a.jsx("label",{htmlFor:"filter-backlog",children:"Backlog:"}),a.jsxs("select",{id:"filter-backlog",value:f.isInBacklog,onChange:w=>g("isInBacklog",w.target.value),className:"request-list-page__filter-select",children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"true",children:"In Backlog"}),a.jsx("option",{value:"false",children:"Not in Backlog"})]})]}),S&&a.jsx("button",{onClick:v,className:"request-list-page__clear-filters",children:"Clear Filters"})]}),l?a.jsx("div",{className:"request-list-page__loading",children:"Loading requests..."}):r.length===0?a.jsxs("div",{className:"request-list-page__empty",children:[a.jsx("p",{children:"No requests found"}),a.jsx(Jt,{to:"/requests/new",className:"request-list-page__empty-link",children:"Create your first request"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"request-list-page__grid",children:r.map(w=>a.jsx(D$,{request:w},w.id))}),h.pages>1&&a.jsxs("div",{className:"request-list-page__pagination",children:[a.jsx("button",{onClick:()=>y(h.page-1),disabled:h.page<=1,className:"request-list-page__pagination-button",children:"Previous"}),a.jsxs("span",{className:"request-list-page__pagination-info",children:["Page ",h.page," of ",h.pages," (",h.total," total)"]}),a.jsx("button",{onClick:()=>y(h.page+1),disabled:h.page>=h.pages,className:"request-list-page__pagination-button",children:"Next"})]})]})]})}const xj=e=>_t.get(`/requests/${e}/notes`),Sj=(e,t)=>_t.post(`/requests/${e}/notes`,t),L$=(e,t,r)=>_t.patch(`/requests/${e}/notes/${t}`,r),wj=(e,t)=>_t.delete(`/requests/${e}/notes/${t}`),O$=Object.freeze(Object.defineProperty({__proto__:null,createRequestNote:Sj,deleteRequestNote:wj,fetchRequestNotes:xj,updateRequestNote:L$},Symbol.toStringTag,{value:"Module"})),z$="modulepreload",$$=function(e){return"/"+e},Pw={},F$=function(t,r,i){let l=Promise.resolve();if(r&&r.length>0){let h=function(p){return Promise.all(p.map(y=>Promise.resolve(y).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),m=f?.nonce||f?.getAttribute("nonce");l=h(r.map(p=>{if(p=$$(p),p in Pw)return;Pw[p]=!0;const y=p.endsWith(".css"),g=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${g}`))return;const v=document.createElement("link");if(v.rel=y?"stylesheet":z$,y||(v.as="script"),v.crossOrigin="",v.href=p,m&&v.setAttribute("nonce",m),document.head.appendChild(v),y)return new Promise((S,w)=>{v.addEventListener("load",S),v.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${p}`)))})}))}function c(f){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=f,window.dispatchEvent(m),!m.defaultPrevented)throw f}return l.then(f=>{for(const m of f||[])m.status==="rejected"&&c(m.reason);return t().catch(c)})};function B$({onSubmit:e,loading:t=!1}){const[r,i]=u.useState(""),l=c=>{c.preventDefault(),r.trim()&&(e(r.trim()),i(""))};return a.jsxs("form",{onSubmit:l,className:"request-note-form",children:[a.jsx("textarea",{value:r,onChange:c=>i(c.target.value),placeholder:"Add a note...",className:"request-note-form__textarea",rows:3,disabled:t}),a.jsx("div",{className:"request-note-form__actions",children:a.jsxs("button",{type:"submit",disabled:!r.trim()||t,className:"request-note-form__submit",children:[a.jsx(dM,{size:16}),t?"Adding...":"Add Note"]})})]})}function U$({requestId:e,canAddNote:t}){const{user:r}=En(),[i,l]=u.useState([]),[c,f]=u.useState(!1),[m,h]=u.useState(!1),[p,y]=u.useState(null),[g,v]=u.useState(""),S=async()=>{f(!0);try{const E=await xj(e);l(Array.isArray(E?.data)?E.data:[])}catch(E){console.error("Failed to load notes",E)}finally{f(!1)}};u.useEffect(()=>{e&&S()},[e]);const w=async E=>{h(!0);try{await Sj(e,{content:E}),await S()}catch(T){console.error("Failed to add note",T),alert("Failed to add note")}finally{h(!1)}},N=async E=>{if(confirm("Are you sure you want to delete this note?"))try{await wj(e,E),await S()}catch(T){console.error("Failed to delete note",T),alert("Failed to delete note")}},j=E=>{y(E.id),v(E.content)},_=()=>{y(null),v("")},C=async E=>{try{const{updateRequestNote:T}=await F$(async()=>{const{updateRequestNote:M}=await Promise.resolve().then(()=>O$);return{updateRequestNote:M}},[]);await T(e,E,{content:g}),y(null),v(""),await S()}catch(T){console.error("Failed to update note",T),alert("Failed to update note")}},O=E=>{if(!E)return"";const T=new Date(E);if(Number.isNaN(T.getTime()))return"";const A=new Date-T,z=Math.floor(A/6e4),P=Math.floor(A/36e5),X=Math.floor(A/864e5);return z<1?"Just now":z<60?`${z}m ago`:P<24?`${P}h ago`:X<7?`${X}d ago`:T.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})};return c?a.jsx("div",{className:"request-notes__loading",children:"Loading notes..."}):a.jsxs("div",{className:"request-notes",children:[a.jsxs("div",{className:"request-notes__header",children:[a.jsx(KT,{size:20}),a.jsxs("h3",{children:["Notes (",i.length,")"]})]}),t&&a.jsx(B$,{onSubmit:w,loading:m}),a.jsx("div",{className:"request-notes__list",children:i.length===0?a.jsx("div",{className:"request-notes__empty",children:"No notes yet"}):i.map(E=>a.jsx("div",{className:"request-note",children:p===E.id?a.jsxs("div",{className:"request-note__edit",children:[a.jsx("textarea",{value:g,onChange:T=>v(T.target.value),className:"request-note__edit-textarea",rows:3}),a.jsxs("div",{className:"request-note__edit-actions",children:[a.jsx("button",{onClick:()=>C(E.id),className:"request-note__edit-save",children:"Save"}),a.jsx("button",{onClick:_,className:"request-note__edit-cancel",children:"Cancel"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"request-note__content",children:E.content}),a.jsxs("div",{className:"request-note__footer",children:[a.jsxs("div",{className:"request-note__meta",children:[a.jsx("span",{className:"request-note__author",children:E.author?.username||"Unknown"}),a.jsx("span",{className:"request-note__time",children:O(E.createdAt)})]}),r?.id===E.createdBy&&a.jsxs("div",{className:"request-note__actions",children:[a.jsx("button",{onClick:()=>j(E),className:"request-note__action",title:"Edit note",children:a.jsx(T1,{size:14})}),a.jsx("button",{onClick:()=>N(E.id),className:"request-note__action",title:"Delete note",children:a.jsx(fa,{size:14})})]})]})]})},E.id))})]})}function q$(){const{id:e}=vs(),t=zn(),{user:r}=En(),i=r?.role==="system_admin",[l,c]=u.useState(null),[f,m]=u.useState(!1),[h,p]=u.useState(!1),[y,g]=u.useState([]),[v,S]=u.useState(!1),[w,N]=u.useState(!1),[j,_]=u.useState({status:"",assignedTo:"",testerId:"",priority:"",isInBacklog:!1}),C=async()=>{m(!0);try{const A=await A$(e);if(A?.success&&A?.data){const z=A.data;c(z),_({status:z.status||"",assignedTo:z.assignedTo||"",testerId:z.testerId||"",priority:z.priority||"",isInBacklog:z.isInBacklog||!1})}else throw new Error("Request not found")}catch(A){console.error("Failed to load request",A),alert(A.message||"Failed to load request"),t("/requests")}finally{m(!1)}};u.useEffect(()=>{e&&C()},[e]),u.useEffect(()=>{i&&w&&O()},[i,w]);const O=async()=>{S(!0);try{const A=await ng();g(Array.isArray(A?.data)?A.data:[])}catch(A){console.error("Failed to load users",A)}finally{S(!1)}},E=async()=>{p(!0);try{const A={};if(j.status&&j.status!==l.status&&(A.status=j.status),j.assignedTo!==l.assignedTo&&(A.assignedTo=j.assignedTo||null),j.testerId!==l.testerId&&(A.testerId=j.testerId||null),j.priority!==l.priority&&(A.priority=j.priority||null),j.isInBacklog!==l.isInBacklog&&(A.isInBacklog=j.isInBacklog),Object.keys(A).length===0){N(!1);return}await M$(e,A),await C(),N(!1)}catch(A){console.error("Failed to update request",A),alert("Failed to update request")}finally{p(!1)}},T=async()=>{if(confirm("Are you sure you want to delete this request? This action cannot be undone."))try{await R$(e),t("/requests")}catch(A){console.error("Failed to delete request",A),alert("Failed to delete request")}},M=l&&(i||String(l.createdBy)===String(r?.id)||String(l.testerId)===String(r?.id));return f?a.jsx("div",{className:"request-detail-page__loading",children:"Loading request..."}):l?a.jsxs("div",{className:"request-detail-page",children:[a.jsxs("div",{className:"request-detail-page__header",children:[a.jsxs(Jt,{to:"/requests",className:"request-detail-page__back",children:[a.jsx(Iy,{size:20}),"Back to Feature/Bugs"]}),a.jsxs("div",{className:"request-detail-page__title-section",children:[a.jsxs("div",{className:"request-detail-page__type-badge",children:[l.type==="bug"?a.jsx(Oy,{size:20,className:"request-detail-page__type-icon"}):a.jsx(Ii,{size:20,className:"request-detail-page__type-icon"}),a.jsx("span",{children:l.type==="bug"?"Bug":"Feature"})]}),a.jsx("h1",{children:l.title}),a.jsxs("div",{className:"request-detail-page__meta",children:[a.jsx(vj,{status:l.status}),l.priority&&a.jsxs("span",{className:"request-detail-page__priority",children:["Priority: ",l.priority]}),l.isInBacklog&&a.jsx("span",{className:"request-detail-page__backlog-badge",children:"In Backlog"})]})]})]}),a.jsx("div",{className:"request-detail-page__content",children:a.jsxs("div",{className:"request-detail-page__main",children:[a.jsxs("div",{className:"request-detail-page__section",children:[a.jsx("h2",{children:"Description"}),a.jsx("div",{className:"request-detail-page__description",children:l.description.split(`
`).map((A,z)=>a.jsx("p",{children:A},z))})]}),a.jsxs("div",{className:"request-detail-page__section",children:[a.jsx("h2",{children:"Details"}),a.jsxs("dl",{className:"request-detail-page__details",children:[a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Created by:"}),a.jsx("dd",{children:l.creator?.username||"Unknown"})]}),a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Created:"}),a.jsx("dd",{children:new Date(l.createdAt).toLocaleString()})]}),l.assignee&&a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Assigned to:"}),a.jsx("dd",{children:l.assignee.username})]}),l.tester&&a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Tester:"}),a.jsx("dd",{children:l.tester.username})]}),l.updatedAt!==l.createdAt&&a.jsxs("div",{className:"request-detail-page__detail-row",children:[a.jsx("dt",{children:"Last updated:"}),a.jsx("dd",{children:new Date(l.updatedAt).toLocaleString()})]})]})]}),i&&a.jsxs("div",{className:"request-detail-page__section",children:[a.jsxs("div",{className:"request-detail-page__admin-header",children:[a.jsx("h2",{children:"Admin Controls"}),a.jsxs("button",{onClick:()=>N(!w),className:`request-detail-page__admin-toggle ${w?"request-detail-page__admin-toggle--active":""}`,type:"button",children:[a.jsx(M1,{size:18}),a.jsx("span",{children:w?"Hide Controls":"Show Controls"}),a.jsx(Ur,{size:16,className:`request-detail-page__admin-toggle-icon ${w?"request-detail-page__admin-toggle-icon--rotated":""}`})]})]}),w&&a.jsxs("div",{className:"request-detail-page__admin-form",children:[a.jsxs("div",{className:"request-detail-page__admin-field",children:[a.jsx("label",{children:"Status:"}),a.jsxs("select",{value:j.status,onChange:A=>_(z=>({...z,status:A.target.value})),className:"request-detail-page__admin-select",children:[a.jsx("option",{value:"open",children:"Open"}),a.jsx("option",{value:"in_progress",children:"In Progress"}),a.jsx("option",{value:"testing",children:"Testing"}),a.jsx("option",{value:"resolved",children:"Resolved"}),a.jsx("option",{value:"closed",children:"Closed"}),a.jsx("option",{value:"backlog",children:"Backlog"})]})]}),a.jsxs("div",{className:"request-detail-page__admin-field",children:[a.jsx("label",{children:"Tester:"}),a.jsxs("select",{value:j.testerId,onChange:A=>_(z=>({...z,testerId:A.target.value})),className:"request-detail-page__admin-select",disabled:v,children:[a.jsx("option",{value:"",children:"None"}),y.map(A=>a.jsxs("option",{value:A.id,children:[A.username," ",A.email?`(${A.email})`:""]},A.id))]})]}),a.jsxs("div",{className:"request-detail-page__admin-field",children:[a.jsx("label",{children:"Priority:"}),a.jsxs("select",{value:j.priority,onChange:A=>_(z=>({...z,priority:A.target.value})),className:"request-detail-page__admin-select",children:[a.jsx("option",{value:"",children:"None"}),a.jsx("option",{value:"low",children:"Low"}),a.jsx("option",{value:"medium",children:"Medium"}),a.jsx("option",{value:"high",children:"High"})]})]}),a.jsx("div",{className:"request-detail-page__admin-field",children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:j.isInBacklog,onChange:A=>_(z=>({...z,isInBacklog:A.target.checked}))}),"In Backlog"]})}),a.jsxs("div",{className:"request-detail-page__admin-actions",children:[a.jsx("button",{onClick:E,disabled:h,className:"request-detail-page__admin-save",children:h?"Saving...":"Save Changes"}),a.jsxs("button",{onClick:T,className:"request-detail-page__admin-delete",children:[a.jsx(fa,{size:16}),"Delete Request"]})]})]})]}),a.jsx(U$,{requestId:e,canAddNote:M})]})})]}):null}function H$(){const e=zn(),[t,r]=u.useState(!1),[i,l]=u.useState({type:"bug",title:"",description:"",priority:""}),[c,f]=u.useState({}),m=y=>{const{name:g,value:v}=y.target;l(S=>({...S,[g]:v})),c[g]&&f(S=>({...S,[g]:""}))},h=()=>{const y={};return i.title.trim()||(y.title="Title is required"),i.description.trim()||(y.description="Description is required"),f(y),Object.keys(y).length===0},p=async y=>{if(y.preventDefault(),!!h()){r(!0);try{const g={type:i.type,title:i.title.trim(),description:i.description.trim(),priority:i.priority||null},v=await T$(g);if(v?.success&&v?.data?.id)e(`/requests/${v.data.id}`);else throw new Error("Failed to create request")}catch(g){console.error("Failed to create request",g),alert(g.message||"Failed to create request")}finally{r(!1)}}};return a.jsxs("div",{className:"create-request-page",children:[a.jsxs("div",{className:"create-request-page__header",children:[a.jsxs("button",{onClick:()=>e("/requests"),className:"create-request-page__back",children:[a.jsx(Iy,{size:20}),"Back to Feature/Bugs"]}),a.jsx("h1",{children:"Create Feature/Bug Request"})]}),a.jsxs("form",{onSubmit:p,className:"create-request-form",children:[a.jsxs("div",{className:"create-request-form__section",children:[a.jsx("label",{className:"create-request-form__label",children:"Type"}),a.jsxs("div",{className:"create-request-form__type-options",children:[a.jsxs("label",{className:"create-request-form__type-option",children:[a.jsx("input",{type:"radio",name:"type",value:"bug",checked:i.type==="bug",onChange:m}),a.jsx(Oy,{size:20}),a.jsx("span",{children:"Bug"})]}),a.jsxs("label",{className:"create-request-form__type-option",children:[a.jsx("input",{type:"radio",name:"type",value:"feature",checked:i.type==="feature",onChange:m}),a.jsx(Ii,{size:20}),a.jsx("span",{children:"Feature"})]})]})]}),a.jsxs("div",{className:"create-request-form__section",children:[a.jsxs("label",{htmlFor:"title",className:"create-request-form__label",children:["Title ",a.jsx("span",{className:"create-request-form__required",children:"*"})]}),a.jsx("input",{id:"title",name:"title",type:"text",value:i.title,onChange:m,className:`create-request-form__input ${c.title?"create-request-form__input--error":""}`,placeholder:"Brief description of the issue or feature",disabled:t}),c.title&&a.jsx("div",{className:"create-request-form__error",children:c.title})]}),a.jsxs("div",{className:"create-request-form__section",children:[a.jsxs("label",{htmlFor:"description",className:"create-request-form__label",children:["Description ",a.jsx("span",{className:"create-request-form__required",children:"*"})]}),a.jsx("textarea",{id:"description",name:"description",value:i.description,onChange:m,className:`create-request-form__textarea ${c.description?"create-request-form__textarea--error":""}`,placeholder:"Provide detailed information about the bug or feature request...",rows:8,disabled:t}),c.description&&a.jsx("div",{className:"create-request-form__error",children:c.description})]}),a.jsxs("div",{className:"create-request-form__section",children:[a.jsx("label",{htmlFor:"priority",className:"create-request-form__label",children:"Priority (optional)"}),a.jsxs("select",{id:"priority",name:"priority",value:i.priority,onChange:m,className:"create-request-form__select",disabled:t,children:[a.jsx("option",{value:"",children:"None"}),a.jsx("option",{value:"low",children:"Low"}),a.jsx("option",{value:"medium",children:"Medium"}),a.jsx("option",{value:"high",children:"High"})]})]}),a.jsxs("div",{className:"create-request-form__actions",children:[a.jsx("button",{type:"button",onClick:()=>e("/requests"),className:"create-request-form__cancel",disabled:t,children:"Cancel"}),a.jsx("button",{type:"submit",className:"create-request-form__submit",disabled:t,children:t?"Creating...":"Submit Request"})]})]})]})}const P$=I2(u2(a.jsxs(a.Fragment,{children:[a.jsx(Yt,{path:"/login",element:a.jsx(H3,{})}),a.jsxs(Yt,{path:"/",element:a.jsx(aL,{children:a.jsx(fk,{})}),children:[a.jsx(Yt,{index:!0,element:a.jsx(hk,{})}),a.jsx(Yt,{path:"worlds",element:a.jsx(n3,{})}),a.jsx(Yt,{path:"worlds/:id",element:a.jsx(c3,{})}),a.jsx(Yt,{path:"worlds/:worldId/access/bulk",element:a.jsx(Uw,{})}),a.jsx(Yt,{path:"worlds/:worldId/access/audit",element:a.jsx(p$,{})}),a.jsx(Yt,{path:"worlds/:worldId/collections",element:a.jsx(y$,{})}),a.jsx(Yt,{path:"campaigns/:campaignId/access/bulk",element:a.jsx(Uw,{})}),a.jsxs(Yt,{path:"campaigns",children:[a.jsx(Yt,{index:!0,element:a.jsx(Xo,{to:"/campaigns/my",replace:!0})}),a.jsx(Yt,{path:"my",element:a.jsx(Hu,{scope:"my"})}),a.jsx(Yt,{path:"my/:id",element:a.jsx(Hu,{scope:"my"})}),a.jsx(Yt,{path:"all",element:a.jsx(Hu,{scope:"all"})}),a.jsx(Yt,{path:"all/:id",element:a.jsx(Hu,{scope:"all"})})]}),a.jsx(Yt,{path:"entities",element:a.jsx(f4,{})}),a.jsx(Yt,{path:"entities/bulk-upload",element:a.jsx(Yz,{})}),a.jsx(Yt,{path:"entities/followed",element:a.jsx(_$,{})}),a.jsx(Yt,{path:"entities/:entityId/relationship-viewer",element:a.jsx(qz,{})}),a.jsx(Yt,{path:"entities/:id",element:a.jsx(dI,{})}),a.jsxs(Yt,{path:"entity-types",children:[a.jsx(Yt,{index:!0,element:a.jsx(hI,{})}),a.jsx(Yt,{path:"new",element:a.jsx(kI,{})}),a.jsx(Yt,{path:":id/fields",element:a.jsx(AI,{})})]}),a.jsxs(Yt,{path:"relationship-types",children:[a.jsx(Yt,{index:!0,element:a.jsx(JI,{})}),a.jsx(Yt,{path:"new",element:a.jsx(eL,{})}),a.jsx(Yt,{path:":id/edit",element:a.jsx(tL,{})})]}),a.jsx(Yt,{path:"entity-relationships",element:a.jsx(KI,{})}),a.jsx(Yt,{path:"entity-secrets",element:a.jsx(nL,{})}),a.jsxs(Yt,{path:"notes",children:[a.jsx(Yt,{index:!0,element:a.jsx(Xo,{to:"/notes/session",replace:!0})}),a.jsx(Yt,{path:"session",element:a.jsx(Wz,{})}),a.jsx(Yt,{path:"entities",element:a.jsx(a$,{})})]}),a.jsxs(Yt,{path:"characters",children:[a.jsx(Yt,{index:!0,element:a.jsx(Xo,{to:"/characters/my",replace:!0})}),a.jsx(Yt,{path:"my",element:a.jsx(Dr,{scope:"my"})}),a.jsx(Yt,{path:"my/:id",element:a.jsx(Dr,{scope:"my"})}),a.jsx(Yt,{path:"others",element:a.jsx(Dr,{scope:"others"})}),a.jsx(Yt,{path:"others/:id",element:a.jsx(Dr,{scope:"others"})}),a.jsx(Yt,{path:"companions",element:a.jsx(Dr,{scope:"companions"})}),a.jsx(Yt,{path:"companions/:id",element:a.jsx(Dr,{scope:"companions"})}),a.jsx(Yt,{path:"all",element:a.jsx(Dr,{scope:"all"})}),a.jsx(Yt,{path:"all/:id",element:a.jsx(Dr,{scope:"all"})})]}),a.jsx(Yt,{path:"users",element:a.jsx(q3,{})}),a.jsx(Yt,{path:"security",element:a.jsx(S$,{})}),a.jsx(Yt,{path:"notifications",element:a.jsx(j$,{})}),a.jsxs(Yt,{path:"requests",children:[a.jsx(Yt,{index:!0,element:a.jsx(I$,{})}),a.jsx(Yt,{path:"new",element:a.jsx(H$,{})}),a.jsx(Yt,{path:":id",element:a.jsx(q$,{})})]})]}),a.jsx(Yt,{path:"*",element:a.jsx(Xo,{to:"/",replace:!0})})]})));function V$(){return a.jsx(X2,{router:P$})}DC.createRoot(document.getElementById("root")).render(a.jsx(u.StrictMode,{children:a.jsx(tR,{children:a.jsx(LI,{children:a.jsx(OM,{children:a.jsx(JM,{children:a.jsx(LR,{children:a.jsx(V$,{})})})})})})}));
